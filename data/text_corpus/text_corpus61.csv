index,text
305,flow duration curves fdcs represent the percentage of time or duration during which a given streamflow is equaled or exceeded flow duration curves provide a rapid and direct response to the behavior of water resources in a basin thus predicting fdcs is important in basins with little or no monitoring for both all time and seasonal periods the geostatistical approach for predicting fdcs at ungauged sites represents an advancement in this research topic however poor results have been observed particularly overestimates positive bias for high durations i e low flows this study aims to predict fdcs in all time and seasonal periods by using a geostatistical approach based on models toward unbiased prediction streamflow data from 81 stream gauges made available by the brazilian national water agency ana have been used these stations have a high spatial density and are well spread across the study area to map the fdcs and consequently all their quantiles the scale and shape parameters of the fdcs were modeled geostatistically first some basic assumptions for the fdc parameters such as data normality and spatial stationarity were verified after an inference by the maximum likelihood method was performed to fit the geostatistical models and estimate the best model forms we compared them with the benchmark models i e regression models finally the spatial interpolation was performed and the performance was assessed by a leave one out cross validation the geostatistical models yielded better fits and performance for mapping the fdcs than the regression models both the median of relative residuals for all time and seasonal periods were unbiased for the entire duration we suggest that the fixed effect modeling of the geostatistical models associated with external drifts led to this better and unbiased performance keywords flow duration curve ungauged basin kriging maximum likelihood 1 introduction flow duration curves fdcs represent the percentage of time or duration in which the streamflow has been equaled or exceeded over a historical period vogel and fennessey 1994 fdcs characterize the hydrological behavior of the basins as a result of the integration among climate morphology soil permeability and other factors statistically fdcs represent a probability distribution adjusted to a historical streamflow series i e a survivor function for a given probability of equaling or exceeding an event castellarin 2014 even though some variations exist fdcs are generally constructed on the basis of daily streamflows considering either each year individually or an entire recorded period in this work we lay focus on daily fdcs for all time and seasonal recorded periods which are important for the design and maintenance of water supply systems irrigation planning and management waste load allocation sedimentation studies and hydropower generation vogel and fennessey 1995 moreover knowledge of fdcs enable the determination of streamflows which are used as references for granting water rights and minimum thresholds for river maintenance for instance in brazil the streamflow which is equaled or exceeded 95 of the time q 95 is used as a minimum threshold for surface water use in interstate rivers ana 2020 as for the brazilian states non interstate rivers each one has its own streamflow reference for instance in the state of santa catarina the streamflow with 98 duration time q 98 is the threshold for surface water use sds 2021 as the fdcs provide an important characterization of the magnitude of streamflows in a basin continuous streamflow measurements are required however due to the absence of monitoring streamflow data are not available for whole drainage systems due to the importance of predicting fdcs at ungauged sites an intense research field exists fennessey and vogel 1990 castellarin et al 2004 li et al 2010 costa et al 2014 pugliese et al 2014 2016 castellarin et al 2018 ridolfi et al 2020 through the growing concern of predictions of sites without monitoring the international association of hydrological sciences iahs has promoted an initiative to encourage forecasting studies in basins without monitoring called predictions in ungauged basins pub sivapalan et al 2003 prediction of fdcs at ungauged sites is one of the main aims of pub due to its widespread use of fdcs for the planning and management of water resources table 1 presents a summary of studies on the prediction of fdcs at ungauged sites these previous studies suggest that the prediction of fdcs at ungauged basins has migrated from regional regression to geostatistical approaches to predict fdcs in sites without monitoring the literature presents different methodologies castellarin 2014 among these the prediction by regional regression equations is utilized often both to estimate the fdc quantiles and also parameters of probabilistic models that represent the fdc mohamoud 2008 li et al 2010 longobardi and villani 2013 costa et al 2014 requena et al 2018 the disadvantage of this methodology is the need to delimit hydrologically homogeneous regions moreover regional regression models have uncertainties due to the number of physical and climatic variables that affect the water regime of a basin castellarin et al 2007 the geostatistical approaches provide an interesting alternative since they use regional hydrological information based on the distance between gauged basins to interpolate this information at ungauged basins skøien et al 2005 müller and thompson 2015 pugliese et al 2014 used the top kriging method skøien et al 2005 to spatially interpolate standardized fdcs by using the long term mean streamflow q thereby estimating the fdcs in sites without monitoring this method may provide an improved performance compared to the multivariate regression methods as it only requires historical series information on streamflow pugliese et al 2016 however poor performances have been reported for areas with a high mean annual temperature low mean elevation low runoff ratio and high potential evapotranspiration as well as for predicting flows in the high duration portion of the fdc i e the low flows pugliese et al 2016 castellarin et al 2018 probably specific geographic areas as described are not representative of the entire region studied i e the local mean in these areas differs slightly from the global mean over the entire region thus spatial interpolations can yield poor estimates due to the presence of local spatial trends diggle and ribeiro 2007 proposed a geostatistical approach based on the gaussian stationary model represented by eq 1 the parameter adjustment is performed using the statistical inference methods based on a maximum likelihood function obtained from a multivariate gaussian distribution this approach is advantageous because the adjustment is applied directly to the data and not to an empiric semivariogram as is done by the method of least squares 1 y x i μ x i s x i ε x i in the equation y x i is the sampled value of the variable to be estimated in a site x i μ x i is the fixed effect which corresponds to a constant mean or to the functions of covariates e g total stream length length of the main channel drainage density shape factor and precipitation known as trend models that represent a spatially varying mean s x i is random effects accounting for spatial correlation and ε x i is the model residuals the geostatistical approach based on gaussian stationary models has not yet been investigated for dealing with spatial local trends causing systematic errors i e biased predictions and yielding low performance for fdc mapping pugliese et al 2014 2016 castellarin et al 2018 in particular high durations low flows are challenging to predict and subject to positive bias overestimates at ungauged sites castellarin et al 2004 2007 hence this study intends to i interpolate fdc parameters geostatistically hypothesizing that the geostatistical approach proposed eq 1 outperforms the regression approach only μ x i component of eq 1 ii map the q 98 flow from the fdc obtained in all time and seasonal periods for the state of santa catarina brazil and iii discuss the improvement and scalability of the novel geostatistical approach unveiled the article is structured as follows first section 2 presents the study area data sets and methodology employed to predict fdcs at ungauged sites next section 3 presents the results then section 4 presents our key findings and answers the hypothesis finally section 5 concludes the study and highlights the recommendations and outlooks for further research based on our findings 2 materials and methods 2 1 study area and data sets the state of santa catarina is located in southern brazil between latitudes 25 57 41 s and 29 23 55 s and between longitudes 48 19 37 w and 53 50 00 w in this study the daily average streamflow data was used from 81 stream gauges the streamflow series were divided in all time and seasonal periods covering summer december january and february autumn march april and may winter june july and august and spring september october and november the data are managed by the national water agency ana and made available at the website http hidroweb ana gov br default asp the temporal coverage of the gauged streamflow data is shown in fig 1 seasons with incomplete data were discarded when the availability of data was lower than 80 most stream gauges are located in the state of santa catarina in an area of 95 734 km 2 while the remaining ones are located in the neighboring states of paran and rio grande do sul fig 2 the rugged terrain of santa catarina is characterized by i coastal plains close to the coast ii coastal mountain ranges formed by the sea mountain range and the geral mountain range which divide the state into the coastal plain and the central plateau region and iii the western plateau which occupies most of the state and holds the highest point with 1831 m above sea level the geral mountain range is the most important mountain of santa catarina from a hydrographic viewpoint it crosses through the middle of the state at distances between 55 km and 200 km from the atlantic ocean and forms the highlands highest values in fig 2 dividing the state into two drainage systems one where the rivers flow to the atlantic ocean and the other in which they flow inland to the paraná river basin a digital elevation model dem with 90 m of spatial resolution was obtained through mosaicking 20 images of the shuttle radar topography mission srtm jarvis et al 2008 the srtm images are made available by the consortium for spatial information cgiar csi at the website http srtm csi cgiar org the vector files necessary for the geographical representation of the study area were made available by the center for information on environmental resources and hydrometeorology of santa catarina ciram and by ana at the websites http ciram epagri sc gov br mapoteca and http metadados ana gov br geonetwork srv pt main home respectively the geographical information system gis grass 7 0 1 grass development team 2016 was used to geoprocess the aforementioned files 2 2 delimitation morphometrical and rainfall characterization of the stream gauge basins the basins were delimited using the dem and the geographic location of the stream gauges furthermore some morphometric variables were determined such as i compactness coefficient k c which is the ratio between the basins perimeter and the diameter of a circle with the same basin area ii total stream length l d m which is the sum of the length of every branch iii length of the main channel l t m which is the length of the longest succession of segments that connect a source to the outlet of the basin iv drainage density d d km km 2 which is the ratio between the total length of the river network and the basin area v highest elevation difference δ z m which is the difference between the elevation of the highest topographic point and the elevation of the basin s outlet vi shape factor k f which is the ratio between the area of the basin and the square of the length of the main channel vii first order stream frequency f r which is the ratio between the number of branches of order 1 following the strahler hierarchy strahler 1957 and the area of the basin viii average elevation z m which is the average elevation represented by the dem pixels within the basin ix average slope s m m 1 which is the average slope of the dem pixels within the basin i0 drainage area a km 2 which is the sum of the pixel areas within the polygon that delimits the drainage basin xi number of streams n which is the number of branches of the river network xii topological diameter d t which is the number of links by which the main channel can be divided based on its junctions and xiii perimeter p m which is the length of the contour of the figure resulting from the projection of the basin on a horizontal plane besides the aforementioned variables the horton ratios horton 1945 were determined on the basis of the fluvial hierarchy of the same author which are i4 elongation ratio r a l which is the ratio between the diameter of the circle covering the same area as the basin and the length of the main channel i5 area ratio r a r which is the average of the ratio between the average basin area of streams for a given order i and the average basin area of streams to a lower order i 1 i6 bifurcation ratio r b which is the ratio of the average number of bifurcations of streams of a given order i to that of streams of the next higher order i 1 i7 circularity ratio r c which is the ratio between the area of the basin and the area of a circle having the same perimeter as the basin i8 length ratio r l which is the ratio of the average length of streams of a given superior order i 1 to that of streams of the order i and i9 slope ratio r s which is the ratio of the average slope of a given superior order stream i 1 to that of the average slope of the stream order i the precipitation maps raster images were obtained from wolff et al 2020 the maps represent the average precipitation for the annual and seasonal periods covering summer december january and february autumn march april and may winter june july and august and spring september october and november thus the average precipitation was determined for the stream gauge basin areas the sig grass 7 0 1 grass development team 2016 through the extension r basin di leo and di stefano 2013 was used to delineate the basins and to obtain the aforementioned variables 2 3 flow duration curves using the ratio between the daily streamflow and the drainage areas of the stream gauge basins eq 2 the specific streamflows q e s p were obtained as follows 2 q e s p q a in which q e s p is the daily specific streamflow in m 3 s 1 km 2 q is the daily average streamflow in m 3 s 1 and a is the drainage area of the stream gauge basin in km 2 therefore the streamflow data were standardized by basin areas as the areas are directly related to the magnitude of the streamflow merz and blöschl 2005 skøien et al 2005 the q e s p were fitted to a lognormal ln distribution for representing the flow duration curves fdcs over all time and for each seasonal period according to li et al 2010 the ln distribution a is parsimonious and involves the lowest number of parameters possible b the ln distribution has a simple parametric form with just two parameters c the parameters can be easily estimated for example using the maximum likelihood method ml with the log transformed data d the parameters in a parsimonious model usually have fairly clear physical interpretation and are rarely mistaken for each other studying the distributions of seasonal river flows bowers et al 2012 concluded that discharge data in wet seasons were well approximated by a ln distribution blum et al 2017 highlight that the ln distribution provided a good approximation of fdcs for some regions in the united states of america e g for coastal plains and the pacific coast which are climatically similar to this study area moreover fig 3 illustrates the cullen and frey 1999 diagram where we can observe that the ln distribution is a good candidate for modeling our streamflow data set we can observe that the gamma distribution was the best candidate represented by the larger number of points near its reference line however the gamma distribution has more parameters than the ln distribution and the parameters of the gamma distribution are not physically distinguishable thus for this reason and following the works referenced above we decided to use the ln distribution to fit our streamflow data we have evidence that the ln distribution is representative of the fdcs in our study area we assume the ln distribution for the sake of simplicity an extensive study related to the effect of other distributions should be done including goodness of fit statistics to get better insights on the distribution that best fits the fdcs of this region however this is beyond the scope of the present study the functions survivor and inverse survivor of the ln distribution were applied as follows 3 s x 1 φ ln x μ σ 4 z p exp μ σ φ 1 1 p in which μ and σ are the parameters that represent the scale and shape of the ln distribution respectively φ is the cumulative distribution function of the normal distribution x is the observed variable and φ 1 1 p is the inverse function of the cumulative distribution function of the normal distribution according to a probability p of equality or exceedance s x represents the probability of values being greater or equal to the sampled values x whereas z p represents the value of the variable x for a given probability p of values being greater or equal to x summing up the flow duration curve is equivalent to the inverse of the survival function the method of maximum likelihood was used to fit the parameters of ln for this method the parameters μ and σ represented the mean and standard deviation of the log transformation of the data respectively therefore the fdcs were obtained by replacing the specific flow q e s p from eq 2 by z p in eq 4 as follows 5 q p exp μ σ φ 1 1 p a in which q p corresponds to the flow duration thereby the all time and seasonal fdcs were obtained for all stream gauges as well as for the parameters μ and σ 2 4 geostatistical modeling of the flow duration curve parameters the assumptions of geostatistical modeling according to diggle and ribeiro 2007 are i spatial stationarity of the response variables in this case flow duration curve fdc parameters μ and σ ii a spatial correlation of the geostatistical model depending only on the distance between the observation sites and iii an almost normal distribution of the variable to be interpolated the model that describes the spatial dependency geostatistical model through a random effect that accounts for spatial autocorrelation considering a set of observations of the fdc parameters μ and σ y x i y x n is given by the relation observed in eq 1 given the condition of non spatial stationarity and consequently an average that is not representative of the whole sample the spatial trend must be removed by modeling of the fixed effect μ x i the trend model μ x i can be expressed by predictor variables such as the basin centroid coordinates and spatially referenced variables external drifts associated with geomorphological or climatic characteristics in other words the trend model is a simple regression model i e without random effects the spatially correlated random effect s x i is represented by a covariance function c h defined as the product of a variance parameter σ 2 by a correlation function of a defined positive ρ h in which h is the distance that separates a pair of variables located in space therefore it gives an indication of similarity between these variables which vary according to the distance between them the covariance functions employed were the following i exponential ii gaussian iii spherical iv circular and v matérn with smoothness parameter κ equal to 1 5 and vi matérn with smoothness parameter κ equal to 2 5 the last component of the geostatistical model ε x i is the nugget effect this is a term used to represent the unexplained variance τ 2 from one point to another which can occur due to measurement errors or undetected low variations to adjust the geostatistical model parameters the maximum likelihood method was applied cox and hinkley 1974 in case of a high skewness and non normality of the response variable here they are μ and σ fdc parameters the fit of the geostatistical model parameters can become impractical due to the impossibility of likelihood function numerical maximization diggle and ribeiro 2007 if this is the case the transformation of the response variable to a gaussian distribution normalization should be performed a common normalization is by the family of functions box cox box and cox 1964 in studies related to the geostatistical modeling of the fdc the normalization is not employed and the mapping performance is not influenced pugliese et al 2016 castellarin et al 2018 therefore normality is not considered a strong assumption by using 24 covariates from the morphometrical and rainfall characterizations of the stream gauge basins six covariance functions and univariate and bivariate models with linear and quadratic relations to the trend models we tested 5 810 combinations of geostatistical models in total as for the regression models we studied 969 model combinations basically the regression models are the geostatistical models without the random effect i e they are the trend models geostatistical models covariance functions 5810 6 969 these geostatistical and regression model combinations were applied for predicting both the μ and σ fdc parameters at ungauged sites to select the best geostatistical and regression models we employed the akaike information criterion aic akaike 1983 therefore the best models were selected based on the lowest aic values since the process to delineate hydrologically homogeneous regions is not employed for the geostatistical approach to make the approaches comparable to each other in terms of the steps in the methodology we applied the regression approach to the whole study area rather than hydrologically homogenous regions later to assess the performance of the best geostatistical and regression models a leave one out cross validation loocv was employed for both the μ and σ fdc parameters loocv systematically left out each observation and predicted the particular observation at its location using the remaining observations we build the fdcs by employing their parameters after the loocv and comparing them to the observed fdcs thus 99 streamflow quantiles were selected for discretization and evaluation of fdcs by the modified kling gupta efficiency kge kling et al 2012 kge has its optimal value at unity and is defined as 6 kge 1 ρ 1 2 β 1 2 γ 1 2 where ρ is the correlation coefficient β is the bias ratio 7 β μ e μ o and γ is the variability ratio 8 γ cv e cv o σ e μ o μ e σ o where estimates are e observations are o and cv is the coefficient of variation in the above equations we used the r statistical software 3 3 1 r core team 2020 with packages mass venables and ripley 2002 rgdal bivand et al 2019 geor ribeiro and diggle 2020 and hydrogof mauricio zambrano bigiarini 2020 for the analyses aforementioned 3 results 3 1 rainfall patterns and morphometric characterization of the stream gauge basins first the basins were delimited to characterize the stream gauges the delimitation process was automated in a geographic information system environment the basin areas ranged approximately from 103 to 12 000 km 2 fig 4 the 81 stream gauge basins studied were characterized morphometrically and with regard to their rainfall pattern these characterizations were important to study the physical and climatic covariates that act on the hydrologic regime of a basin table 2 displays the 24 covariates obtained from the morphometrical and rainfall characterization 3 2 flow duration curve parameters the lognormal ln distribution was fitted to the specific streamflow values q e s p for all time and for each seasonal period moreover the scale μ and shape σ parameters were estimated to represent the mean and standard deviation of the specific streamflow logarithms respectively thereby the flow duration curves fdcs of the stream gauges were obtained with the survivor function of the ln distribution to spatially interpolate the fdc parameters it is important that they follow a gaussian distribution approximately as the mean and median values of the parameters were proximate there was an indication that they had a symmetrical distribution table 3 furthermore table 3 highlights the parameter values of the box cox transformation λ and the 95 confidence interval the σ parameter of the summer period displayed the highest difference to the ideal value λ 1 which indicates that no transformation is necessary five of ten fdc parameters are out the confidence intervals to accept normality however we observe that this non normality of some parameters did not yield problems in the estimation of the geostatistical model parameters and kriging predictions as evident in section 3 4 specifically the predictions do not overestimate or underestimate streamflow quantiles and achieve the study s goal of generating unbiased estimates of the fdc furthermore the assumption of normality is not strong for geostatistical modeling of the fdc and has been ignored in prior studies see pugliese et al 2016 castellarin et al 2018 3 3 fit of the models we selected the geostatistical models eq 1 with best fit by the akaike information criterion aic table 4 highlights the best fitted geostatistical models besides deriving the most parsimonious geostatistical model this approach is used to verify whether the addition of the random effect s x i improves the model estimation or not comparing the aic value for the non spatial model component i e fixed effect μ x i of eq 1 to the aic value for the geostatistical model in its complete form with μ x i and s x i we can conclude which model structure with or without s x i is the better by the lower aic value regarding the μ parameters of the flow duration curves fdcs a direct relation with the slope ratio r s was observed for the trend models table 4 for the all time and seasonal periods of summer autumn winter and spring this relationship was quadratic with the covariates average annual precipitation p a longitude x average autumn precipitation p autumn average winter precipitation p winter and basin mean slope s respectively as for the σ parameters we did not observe a recurrent covariate for all periods however the topological diameter d t displayed in three periods all time summer and winter all the best trend models presented bivariate quadratic relations table 4 thus considering a constant mean in the geostatistical models we did not observe a better fit the study area had different classes of topography and climate this explained the second order polynomial trend on the covariates in relation to the covariance functions the gaussian function presented the best fit for five geostatistical models among the ten studied table 4 this function is a member of the matérn family of functions and is obtained when the parameter κ on the other hand the spherical and circular covariance functions are members of the spherical family of functions the matérn family of functions is more adaptable to different data compared with the spherical also the gaussian function is more compatible with maximum likelihood estimation than the spherical function which is only once differentiable at a point of the function h range causing technical difficulties with maximum likelihood estimation diggle and ribeiro 2007 table 5 highlights the best fitted regression models the regression models tested in this study are analogous to the geostatistical models without their spatial component i e they are basically the trend models represented by the fixed effect μ x i for the μ parameters of the fdcs we observed that the p both for the all time and seasonal periods showed up in all best fitted models table 5 with regard to the σ parameters of the fdcs the recursive covariate was x in the bivariate quadratic form comparing the aic values of the regression models with the geostatistical models we highlighted the lower aic values of the geostatistical models which yielded the best fits thus fdc parameters and fdcs themselves were better represented by taking into consideration the spatial correlation among the fdc parameters observed at gauged sites subsequently all parameters of the geostatistical models were directly estimated by using the maximum likelihood method among them the β parameters corresponded with the mean which is the μ x i component i e the trend models the covariance function parameters σ 2 and ϕ represented the s x i component and parameter τ 2 corresponded to the residual variance i e the component ε x i the values of these parameters are illustrated in table 6 the variance parameter σ 2 also referred to as the sill had the largest values for μ and the lowest values were observed for σ the μ parameter indicates the scale of fdcs which exhibited a higher variance than the shape of the fdcs σ the ϕ parameter is the range for the spherical and circular covariance functions and is the practical range in the matérn family of functions including the exponential and gaussian functions the range in both cases refers to the distance at which fdc parameters are no longer autocorrelated and in the practical range this distance is defined where the autocorrelation coefficient is 0 05 diggle and ribeiro 2007 the fdc scale parameters μ s summer and μ s spring correspond to the circular covariance function and the shape σ s spring to the spherical covariance function thus the ϕ values result in the distances in which these fdc parameters are spatially correlated being 103 80 93 88 and 254 17 km respectively the matérn family of covariance functions are associated with the other fdc parameters the distances in which these functions are autocorrelated are 3 ϕ 3 1 2 ϕ and 4 75 ϕ for exponential gaussian and matérn with κ 1 5 respectively diggle and ribeiro 2007 thus the highest practical range was observed for the μ s autumn parameter 4 75 58 41 277 45 km and the smallest practical range was for the μ s winter parameter 3 1 2 29 88 51 75 km except for the autumn season we observed that the shape parameter of the fdcs showed a greater range than the scale parameter i e the shape of the fdcs are correlated to each other for longer distances than the scale finally the τ 2 parameter also called nugget effect reveals the noise ε x i of the geostatistical model i e the unexplained variance as with σ 2 which is grouped as a variance parameter and therefore displays a similar behavior i e a higher variance for the scale parameter and a lower variance for the shape parameter of the fdcs 3 4 performance of the predicted flow duration curves to complete the analysis and verify if the spatial interpolation yielded a good performance a leave one out cross validation loocv was performed for both the geostatistical and regression approaches fig 5 shows the modified kling gupta efficiency kge kling et al 2012 between the predicted fdcs and observed fdcs for 99 streamflow quantiles 0 1 0 2 0 99 in all periods the geostatistical approach outperforms the regression approach for the geostatistical models the mean kge values for the quantiles were 0 71 0 76 0 80 0 64 and 0 58 for the all time summer autumn winter and spring periods respectively as for the regression models the kge values reached 0 60 0 62 0 74 0 56 and 0 52 for the comparable periods the streamflow equaled or exceeded 98 of the time q 98 is the reference streamflow used to authorize surface water use sds 2021 therefore this is the streamflow quantile most important in santa catarina state in terms of surface water assessment for the geostatistical approach q 98 yielded kge values of 0 72 0 69 0 82 0 57 and 0 63 for all time summer autumn winter and spring respectively the regression approach had kge values of 0 68 0 64 0 79 0 44 and 0 50 for the equivalent periods thus the geostatistical approach delivered better results than regression for surface water management in the state of santa catarina since the geostatistical approach yielded the best results fig 6 highlights the relative residuals of the flow durations for it i e the difference between the predicted and observed fdc for a given site divided by the observed one computed for each of the 99 quantiles evaluated overestimates are more accentuated than the underestimates and this pattern is similar across the flow durations for each period however these biases are observed in the classes with few counts shades of gray the majority of counts are observed to be close to zero shades of gray close to black and the median behavior red lines confirm that the geostatistical approach employed here is unbiased for all flow durations and periods studied 3 5 flow duration curve predictions at ungauged basins once the geostatistical models were selected the flow duration curve fdc parameters were interpolated by using a kriging system as the fixed effect μ x i of the fitted geostatistical models table 4 corresponds to a trend model given by a set of covariates the kriging system is known as kriging with external drift ked and the weights are determined by the covariance function parameters adjusted to the trend model residuals the interpolation by ked is considered linear unbiased and with minimum variance blup best linear unbiased predictor these properties are defined as i linear its estimations are linear weighted combinations of available data ii unbiased aims for an error or residual mean value equal to zero and iii best because it minimizes the variance of the errors isaaks and srivastava 1989 p 278 with the proposed methodology it is possible to obtain the entire duration curve thus any streamflow related to duration can be estimated moreover the long term mean streamflow can be estimated directly by integrating the fdcs the regionalization model is made available at the website https github com wwolff7 tese dados this model is convenient to use because it is only necessary to input the basin centroid coordinates and area considering the importance of the streamflow equaled or exceeded 98 of the time q 98 for water management in the state of santa catarina we mapped this streamflow quantile standardized by area q 98 e s p for all time and seasonal periods the interpolated surface of q 98 e s p for all time period in the state of santa catarina is shown in fig 7 similar to the geographic pattern of rainfall as observed in wolff et al 2020 the variation in q 98 e s p follows the distribution of mountain chains and highlands besides rainfall and terrain there are aquifers that have a hydrogeologic influence on streamflows in particular low flows such as q 98 e s p that are sustained by groundwater inputs baseflow during dry periods the regions with the lowest values of q 98 e s p in the state were the south coast and the far west with values of about 2 to 4 m 3 h 1 km 2 the highest values occurred in the northern and central coast regions with values between 16 and 27 m 3 h 1 km 2 in the center of the state the santa catarina highlands and north central area the q 98 e s p was in the range of 6 to 12 m 3 h 1 km 2 and 10 to 14 m 3 h 1 km 2 respectively as observed for q 98 e s p for all time period the highest values for the seasonal q 98 e s p were observed in the northern and central coast regions which are part of the drainage system directed toward the atlantic ocean fig 8 the mean and lowest values were observed in the central and western regions of the state respectively these regions are part of the drainage system directed inland to the paran river basin 4 discussion the results of this study revealed that geostatistical modeling outperforms regression modeling for predicting flow duration curves fdcs at ungauged basins in a subtropical study area the better fit tables 4 and 5 and performance fig 5 were not only observed for predicting fdcs built by using the whole streamflow series but also for the seasonal streamflow series an important aspect to be considered for the geostatistical approach employed here is that it did not delineate hydrologically homogeneous regions as commonly applied in a regional regression approach since we performed an exploratory analysis to remove spatial trends trend models in table 4 we accounted for heterogeneity in the study area and reduced to possible causes of errors reaching a good performance pugliese et al 2016 recommend that the practice of dispensing with the delineation of homogeneous regions may be unsuitable for heterogeneous study areas however that recommendation does not take into account the application of a trend model and this is the reason why hydrologically homogeneous regions may not be required the hypothesis whether or not hydrologically homogeneous regions would improve our approach should be addressed in a next study another beneficial aspect of the proposed method in this study is that the inference by maximum likelihood allows an estimation of the geostatistical model parameters based on the data rather than an emprical semivariogram as is done by the method of least squares thus a direct comparison of models may be performed based on model selection methods by likelihood e g aic for driving the most parsimonious choice i e the trade off between the number of parameters and the maximum likelihood value for previous geostatistical approaches biased estimates have been a problem mainly for low flows i e the high duration portion of the fdc pugliese et al 2016 castellarin et al 2018 however that problem was not observed by the geostatistical approach proposed here fig 6 different from the previous approaches we performed an exploratory analysis to remove spatial trends trend models in table 4 alongside extensive geostatistical modeling assessed by maximum likelihood thus our approach yielded unbiased estimates for the entire fdc although we use a kriging system like previous studies biased estimates are not observed in this study fig 6 the approach applied here led us to identify spatial trend relations and model them i e the mean represented by the fixed effect μ x i of the geostatistical model was not considered constant over the region and basin descriptors were employed to define the form of the mean table 4 thus in general the linear weighting scheme of the kriging system did not deliver biased estimates once the mean was smoothed over the region we observed that accounting for the spatial autocorrelation of fdc parameters s x i improved the fit of the geostatistical model compared to excluding that component of the model based on lower akaike information criterion aic values table 4 therefore the study hypothesis was accepted and there was statistical evidence that the fdc parameters for the all time and seasonal periods are spatially autocorrelated these results were important because they showed that variability of the fdc parameters had a spatial pattern based on the aic goodness of fit measure previous studies like the current study concluded that geostatistical approaches were better than regression approaches to interpolate fdcs spatially castellarin 2014 pugliese et al 2016 castellarin et al 2018 another important feature of the geostatistical approach applied here was the monotonicity i e fdcs predicted at ungauged basins were non increasing positive defined functions over the interval of the exceedance probability p 0 1 the monotonic property of the fdc was preserved here because we interpolated fdc parameters instead of the multiple regression of the fdc quantiles which does not take into account the interdependency among quantiles and can lead to non monotonic results farmer et al 2014 pugliese et al 2016 the hydrography of the state of santa catarina is characterized by the presence of the geral mountain range fig 2 which divides the watercourses that drain into the atlantic ocean from those that drain inland this mountain range is the chief factor that sets the climate variability and streamflow regime the μ parameter of the fdcs corresponds with the scale of the curve and consequently represents the magnitude of the flow duration the results in table 4 highlight the importance of the slope ratio r s for the quantitative characterization of the fdc over the stream gauge basins i e all the trend models presented r s as a predictor the eastern side of the geral mountain range presents steeper slopes and consequently larger r s and fdc magnitudes in basins draining toward the atlantic ocean as for headwater basins that drain inland lower values of r s were reached apart from r s the average precipitation for the annual autumn and winter periods was employed in the trend models for the μ parameter of the fdcs in the respective periods table 4 this is a common variable used as a predictor in models for predicting fdcs at ungauged sites highlighting its relevance in the streamflow regime li et al 2010 costa et al 2014 atieh et al 2015 pugliese et al 2016 requena et al 2018 castellarin et al 2018 ridolfi et al 2020 according to the σ parameter of the fdcs i e the fdc shape parameter the topological diameter d t was the most frequent covariate in the trend models table 4 having a direct relation with the length and tributary numbers of the main channel in a basin d t represents the number of links in which the main channel can be divided on the basis of the junctions the shape parameter represents the average flow by allocating the inflection point position of a fdc i e the median where 50 of the flow is above it for instance fdcs that have a linear form i e high standard deviation have shorter less complex drainage networks i e a lower topological diameter while for fdcs with the extreme flows ranging close to the median i e low standard deviation basins with extensive drainage networks the effect of routing sustains steady streamflows in these basins hence the routing behavior of the basins that drive the σ parameter variability and its spatial trend in the study region is better represented by d t instead of using d t costa et al 2014 and atieh et al 2015 employed the basin shape factor another variable that characterizes the main stem of the drainage network for estimating the fdc shape parameter in regression and neural network methods respectively with regard to spatial variation we studied the streamflow equaled or exceeded 98 of the time divided by area q 98 e s p for the all time and seasonal periods the lowest values of q 98 e s p observed in the south coast of santa catarina state are in agreement with the lowest values of rainfall observed in the state wolff et al 2020 this behavior can be explained by the presence of the falkland current in the region and by local changes in the atmospheric circulation these are shaped by the free passage of winds coming from the ocean which lose their humidity on their way to the geral mountain range yielding low values of streamflow and rainfall the largest low flows occurred in the central and north coast and can be related to the atlantic tropical mass originating from the center of the high subtropical pressures in the atlantic being characterized as hot and humid this mass acts on the north center coast of the state and brings high precipitation and consequently streamflow besides the effect of the atlantic tropical mass in the region there is another important factor responsible for the high precipitation and streamflow in the center and north coast where higher values are observed the distance from the coast to the geral and sea mountain range is the lowest being 57 km from the north coast to the sea mountain range and 63 km from the center to the geral mountain range fig 2 hence orographic precipitation is observed as being caused by humid winds blowing from the atlantic ocean toward the mountains first the winds reach the hillslopes then the air masses ascend inducing the condensation of water vapor and finally the precipitation occurs the hydrogeological characteristic of the state is another factor that explains the spatial distribution of q 98 e s p in the whole coastal region the crystalline southeast aquifer is present where it has an extensive outcrop area machado 2013 as a rule local rainfall is considered to be sufficient to guarantee perennial rivers and recharge to the aquifer in which groundwater reserves are restored due to a large outcrop area therefore even in periods of drought storage obtained in rainy seasons ensures a higher availability of the q 98 e s p in the central and western regions of the state there is the presence of the geral mountain range aquifer which lies above the guarani aquifer in the western region of the state the aquifer is deeper and the groundwater fluxes to the water courses are smaller on the other hand in the central region the aquifer has its outcrop and thus a higher contribution to the watercourses occurs machado 2013 therefore this explains why the central region has larger q 98 e s p compared to the western region despite sharing hydrogeological features different from the coastal region in which the range of the streamflow values coincided with those of precipitation and could be explained by the same orographic and climatic factors this was not observed in the western region of the state despite having a high rainfall the western region presented low streamflow values this suggested that most of the rainfall was being stored by the geral mountain range aquifer located in the region it has basalt fractures and has been classified as porous extensive and quite productive machado 2013 the discussion of q 98 e s p variability associated with hydrogeological features reinforces the importance of studying the spatial trend of the fdc σ parameter i e the fdc shape parameter hydrogeological features drive the capability of the basin to store regulate and control the streamflow yielding flatter or steeper fdcs according to the increased or decreased water storage respectively castellarin et al 2018 5 conclusions mapping the flow duration curve fdc parameters all information obtained through the fdcs may be mapped as well e g streamflow quantiles reservoir volumes see wolff et al 2017 for retrieving reservoir volumes from fdc and long term mean streamflows i e through fdc integration for its whole domain because regression models may not be satisfactory we applied a geostatistical approach for interpolation fdcs at ungauged basins which improved the fit of the models and the spatial interpolation performance the present study shows the first application of a geostatistical approach based on models aiming to remove spatial trends and map fdcs for all time and seasonal periods in a subtropical region the state of santa catarina brazil we reached moderate bias in predictions for all flow durations i e without many underestimates or overestimates the all time and seasonal representation of the fdcs provide better insights into the seasonal dynamics of the streamflows in seasons where the streamflows are greater a greater amount of surface water resources may be authorized for use and vice versa thus this study may deliver a likely tool for water availability management at ungauged locations in the state of santa catarina the geostatistical modeling proposed here contributes to the existing knowledge base as follows i the geostatistical modeling is performed using the maximum likelihood method both for model selection and parameter estimation this gives the approach a straightforward and automated characteristic in which all parameters of the geostatistical model are fitted at one go i e the fit is performed directly to the data rather than to the empirical semivariogram ii 24 covariates external drifts associated with the morphometric and climatic characteristics are taken into account for modeling the fixed effect μ x i of the geostatistical model removing spatial trends and serving as a substitute for delineating hydrologically homogeneous regions iii continuous fdcs are predicted by mapping the fdc parameters which preserves the monotonic non increasing property of the fdc as a fundamental requirement of cumulative frequency distributions iv after obtaining the geostatistical model parameters a tool to predict fdcs with minimum input data can be provided i e basin area and centroid coordinates for kriging of the fdc parameters and predicting the fdcs themselves v the median of relative errors were close to zero for the entire duration different from similar studies where they reported poor performance for higher duration i e low flows castellarin 2014 pugliese et al 2014 2016 finally instead of using the basin centroids point as reference for geostatistical modeling and spatial predicting of the fdc parameters we suggest that future studies should use the basin areas area as reference such as the top kriging approach developed by skøien et al 2005 a comparative study between our approach and that of skøien et al 2005 should give better insights about how representing the fdc parameters spatially i e as basin centroids or areas interferes in the mapping performance and how these approaches can complement each other i e model based geostatistics applied for top kriging moreover another suggestion would be to introduce the streamflow data fit to the probabilistic distributions e g lognormal gamma and kappa into the geostatistical modeling thus the geostatistical modeling procedure should select a probability distribution trend models and spatial covariance functions credit authorship contribution statement wagner wolff formal analysis writing original draft writing review editing sergio nascimento duarte formal analysis writing original draft writing review editing declaration of competing interest authors declare that they have no conflict of interest acknowledgements we gratefully acknowledge the consortium for spatial information cgiar csi the center for information on environmental resources and hydrometeorology of santa catarina ciram and the national water agency ana for providing the data used in this research this study was financed in part by the coordenação de aperfeiçoamento de pessoal de nível superior brasil capes finance code 001 
305,flow duration curves fdcs represent the percentage of time or duration during which a given streamflow is equaled or exceeded flow duration curves provide a rapid and direct response to the behavior of water resources in a basin thus predicting fdcs is important in basins with little or no monitoring for both all time and seasonal periods the geostatistical approach for predicting fdcs at ungauged sites represents an advancement in this research topic however poor results have been observed particularly overestimates positive bias for high durations i e low flows this study aims to predict fdcs in all time and seasonal periods by using a geostatistical approach based on models toward unbiased prediction streamflow data from 81 stream gauges made available by the brazilian national water agency ana have been used these stations have a high spatial density and are well spread across the study area to map the fdcs and consequently all their quantiles the scale and shape parameters of the fdcs were modeled geostatistically first some basic assumptions for the fdc parameters such as data normality and spatial stationarity were verified after an inference by the maximum likelihood method was performed to fit the geostatistical models and estimate the best model forms we compared them with the benchmark models i e regression models finally the spatial interpolation was performed and the performance was assessed by a leave one out cross validation the geostatistical models yielded better fits and performance for mapping the fdcs than the regression models both the median of relative residuals for all time and seasonal periods were unbiased for the entire duration we suggest that the fixed effect modeling of the geostatistical models associated with external drifts led to this better and unbiased performance keywords flow duration curve ungauged basin kriging maximum likelihood 1 introduction flow duration curves fdcs represent the percentage of time or duration in which the streamflow has been equaled or exceeded over a historical period vogel and fennessey 1994 fdcs characterize the hydrological behavior of the basins as a result of the integration among climate morphology soil permeability and other factors statistically fdcs represent a probability distribution adjusted to a historical streamflow series i e a survivor function for a given probability of equaling or exceeding an event castellarin 2014 even though some variations exist fdcs are generally constructed on the basis of daily streamflows considering either each year individually or an entire recorded period in this work we lay focus on daily fdcs for all time and seasonal recorded periods which are important for the design and maintenance of water supply systems irrigation planning and management waste load allocation sedimentation studies and hydropower generation vogel and fennessey 1995 moreover knowledge of fdcs enable the determination of streamflows which are used as references for granting water rights and minimum thresholds for river maintenance for instance in brazil the streamflow which is equaled or exceeded 95 of the time q 95 is used as a minimum threshold for surface water use in interstate rivers ana 2020 as for the brazilian states non interstate rivers each one has its own streamflow reference for instance in the state of santa catarina the streamflow with 98 duration time q 98 is the threshold for surface water use sds 2021 as the fdcs provide an important characterization of the magnitude of streamflows in a basin continuous streamflow measurements are required however due to the absence of monitoring streamflow data are not available for whole drainage systems due to the importance of predicting fdcs at ungauged sites an intense research field exists fennessey and vogel 1990 castellarin et al 2004 li et al 2010 costa et al 2014 pugliese et al 2014 2016 castellarin et al 2018 ridolfi et al 2020 through the growing concern of predictions of sites without monitoring the international association of hydrological sciences iahs has promoted an initiative to encourage forecasting studies in basins without monitoring called predictions in ungauged basins pub sivapalan et al 2003 prediction of fdcs at ungauged sites is one of the main aims of pub due to its widespread use of fdcs for the planning and management of water resources table 1 presents a summary of studies on the prediction of fdcs at ungauged sites these previous studies suggest that the prediction of fdcs at ungauged basins has migrated from regional regression to geostatistical approaches to predict fdcs in sites without monitoring the literature presents different methodologies castellarin 2014 among these the prediction by regional regression equations is utilized often both to estimate the fdc quantiles and also parameters of probabilistic models that represent the fdc mohamoud 2008 li et al 2010 longobardi and villani 2013 costa et al 2014 requena et al 2018 the disadvantage of this methodology is the need to delimit hydrologically homogeneous regions moreover regional regression models have uncertainties due to the number of physical and climatic variables that affect the water regime of a basin castellarin et al 2007 the geostatistical approaches provide an interesting alternative since they use regional hydrological information based on the distance between gauged basins to interpolate this information at ungauged basins skøien et al 2005 müller and thompson 2015 pugliese et al 2014 used the top kriging method skøien et al 2005 to spatially interpolate standardized fdcs by using the long term mean streamflow q thereby estimating the fdcs in sites without monitoring this method may provide an improved performance compared to the multivariate regression methods as it only requires historical series information on streamflow pugliese et al 2016 however poor performances have been reported for areas with a high mean annual temperature low mean elevation low runoff ratio and high potential evapotranspiration as well as for predicting flows in the high duration portion of the fdc i e the low flows pugliese et al 2016 castellarin et al 2018 probably specific geographic areas as described are not representative of the entire region studied i e the local mean in these areas differs slightly from the global mean over the entire region thus spatial interpolations can yield poor estimates due to the presence of local spatial trends diggle and ribeiro 2007 proposed a geostatistical approach based on the gaussian stationary model represented by eq 1 the parameter adjustment is performed using the statistical inference methods based on a maximum likelihood function obtained from a multivariate gaussian distribution this approach is advantageous because the adjustment is applied directly to the data and not to an empiric semivariogram as is done by the method of least squares 1 y x i μ x i s x i ε x i in the equation y x i is the sampled value of the variable to be estimated in a site x i μ x i is the fixed effect which corresponds to a constant mean or to the functions of covariates e g total stream length length of the main channel drainage density shape factor and precipitation known as trend models that represent a spatially varying mean s x i is random effects accounting for spatial correlation and ε x i is the model residuals the geostatistical approach based on gaussian stationary models has not yet been investigated for dealing with spatial local trends causing systematic errors i e biased predictions and yielding low performance for fdc mapping pugliese et al 2014 2016 castellarin et al 2018 in particular high durations low flows are challenging to predict and subject to positive bias overestimates at ungauged sites castellarin et al 2004 2007 hence this study intends to i interpolate fdc parameters geostatistically hypothesizing that the geostatistical approach proposed eq 1 outperforms the regression approach only μ x i component of eq 1 ii map the q 98 flow from the fdc obtained in all time and seasonal periods for the state of santa catarina brazil and iii discuss the improvement and scalability of the novel geostatistical approach unveiled the article is structured as follows first section 2 presents the study area data sets and methodology employed to predict fdcs at ungauged sites next section 3 presents the results then section 4 presents our key findings and answers the hypothesis finally section 5 concludes the study and highlights the recommendations and outlooks for further research based on our findings 2 materials and methods 2 1 study area and data sets the state of santa catarina is located in southern brazil between latitudes 25 57 41 s and 29 23 55 s and between longitudes 48 19 37 w and 53 50 00 w in this study the daily average streamflow data was used from 81 stream gauges the streamflow series were divided in all time and seasonal periods covering summer december january and february autumn march april and may winter june july and august and spring september october and november the data are managed by the national water agency ana and made available at the website http hidroweb ana gov br default asp the temporal coverage of the gauged streamflow data is shown in fig 1 seasons with incomplete data were discarded when the availability of data was lower than 80 most stream gauges are located in the state of santa catarina in an area of 95 734 km 2 while the remaining ones are located in the neighboring states of paran and rio grande do sul fig 2 the rugged terrain of santa catarina is characterized by i coastal plains close to the coast ii coastal mountain ranges formed by the sea mountain range and the geral mountain range which divide the state into the coastal plain and the central plateau region and iii the western plateau which occupies most of the state and holds the highest point with 1831 m above sea level the geral mountain range is the most important mountain of santa catarina from a hydrographic viewpoint it crosses through the middle of the state at distances between 55 km and 200 km from the atlantic ocean and forms the highlands highest values in fig 2 dividing the state into two drainage systems one where the rivers flow to the atlantic ocean and the other in which they flow inland to the paraná river basin a digital elevation model dem with 90 m of spatial resolution was obtained through mosaicking 20 images of the shuttle radar topography mission srtm jarvis et al 2008 the srtm images are made available by the consortium for spatial information cgiar csi at the website http srtm csi cgiar org the vector files necessary for the geographical representation of the study area were made available by the center for information on environmental resources and hydrometeorology of santa catarina ciram and by ana at the websites http ciram epagri sc gov br mapoteca and http metadados ana gov br geonetwork srv pt main home respectively the geographical information system gis grass 7 0 1 grass development team 2016 was used to geoprocess the aforementioned files 2 2 delimitation morphometrical and rainfall characterization of the stream gauge basins the basins were delimited using the dem and the geographic location of the stream gauges furthermore some morphometric variables were determined such as i compactness coefficient k c which is the ratio between the basins perimeter and the diameter of a circle with the same basin area ii total stream length l d m which is the sum of the length of every branch iii length of the main channel l t m which is the length of the longest succession of segments that connect a source to the outlet of the basin iv drainage density d d km km 2 which is the ratio between the total length of the river network and the basin area v highest elevation difference δ z m which is the difference between the elevation of the highest topographic point and the elevation of the basin s outlet vi shape factor k f which is the ratio between the area of the basin and the square of the length of the main channel vii first order stream frequency f r which is the ratio between the number of branches of order 1 following the strahler hierarchy strahler 1957 and the area of the basin viii average elevation z m which is the average elevation represented by the dem pixels within the basin ix average slope s m m 1 which is the average slope of the dem pixels within the basin i0 drainage area a km 2 which is the sum of the pixel areas within the polygon that delimits the drainage basin xi number of streams n which is the number of branches of the river network xii topological diameter d t which is the number of links by which the main channel can be divided based on its junctions and xiii perimeter p m which is the length of the contour of the figure resulting from the projection of the basin on a horizontal plane besides the aforementioned variables the horton ratios horton 1945 were determined on the basis of the fluvial hierarchy of the same author which are i4 elongation ratio r a l which is the ratio between the diameter of the circle covering the same area as the basin and the length of the main channel i5 area ratio r a r which is the average of the ratio between the average basin area of streams for a given order i and the average basin area of streams to a lower order i 1 i6 bifurcation ratio r b which is the ratio of the average number of bifurcations of streams of a given order i to that of streams of the next higher order i 1 i7 circularity ratio r c which is the ratio between the area of the basin and the area of a circle having the same perimeter as the basin i8 length ratio r l which is the ratio of the average length of streams of a given superior order i 1 to that of streams of the order i and i9 slope ratio r s which is the ratio of the average slope of a given superior order stream i 1 to that of the average slope of the stream order i the precipitation maps raster images were obtained from wolff et al 2020 the maps represent the average precipitation for the annual and seasonal periods covering summer december january and february autumn march april and may winter june july and august and spring september october and november thus the average precipitation was determined for the stream gauge basin areas the sig grass 7 0 1 grass development team 2016 through the extension r basin di leo and di stefano 2013 was used to delineate the basins and to obtain the aforementioned variables 2 3 flow duration curves using the ratio between the daily streamflow and the drainage areas of the stream gauge basins eq 2 the specific streamflows q e s p were obtained as follows 2 q e s p q a in which q e s p is the daily specific streamflow in m 3 s 1 km 2 q is the daily average streamflow in m 3 s 1 and a is the drainage area of the stream gauge basin in km 2 therefore the streamflow data were standardized by basin areas as the areas are directly related to the magnitude of the streamflow merz and blöschl 2005 skøien et al 2005 the q e s p were fitted to a lognormal ln distribution for representing the flow duration curves fdcs over all time and for each seasonal period according to li et al 2010 the ln distribution a is parsimonious and involves the lowest number of parameters possible b the ln distribution has a simple parametric form with just two parameters c the parameters can be easily estimated for example using the maximum likelihood method ml with the log transformed data d the parameters in a parsimonious model usually have fairly clear physical interpretation and are rarely mistaken for each other studying the distributions of seasonal river flows bowers et al 2012 concluded that discharge data in wet seasons were well approximated by a ln distribution blum et al 2017 highlight that the ln distribution provided a good approximation of fdcs for some regions in the united states of america e g for coastal plains and the pacific coast which are climatically similar to this study area moreover fig 3 illustrates the cullen and frey 1999 diagram where we can observe that the ln distribution is a good candidate for modeling our streamflow data set we can observe that the gamma distribution was the best candidate represented by the larger number of points near its reference line however the gamma distribution has more parameters than the ln distribution and the parameters of the gamma distribution are not physically distinguishable thus for this reason and following the works referenced above we decided to use the ln distribution to fit our streamflow data we have evidence that the ln distribution is representative of the fdcs in our study area we assume the ln distribution for the sake of simplicity an extensive study related to the effect of other distributions should be done including goodness of fit statistics to get better insights on the distribution that best fits the fdcs of this region however this is beyond the scope of the present study the functions survivor and inverse survivor of the ln distribution were applied as follows 3 s x 1 φ ln x μ σ 4 z p exp μ σ φ 1 1 p in which μ and σ are the parameters that represent the scale and shape of the ln distribution respectively φ is the cumulative distribution function of the normal distribution x is the observed variable and φ 1 1 p is the inverse function of the cumulative distribution function of the normal distribution according to a probability p of equality or exceedance s x represents the probability of values being greater or equal to the sampled values x whereas z p represents the value of the variable x for a given probability p of values being greater or equal to x summing up the flow duration curve is equivalent to the inverse of the survival function the method of maximum likelihood was used to fit the parameters of ln for this method the parameters μ and σ represented the mean and standard deviation of the log transformation of the data respectively therefore the fdcs were obtained by replacing the specific flow q e s p from eq 2 by z p in eq 4 as follows 5 q p exp μ σ φ 1 1 p a in which q p corresponds to the flow duration thereby the all time and seasonal fdcs were obtained for all stream gauges as well as for the parameters μ and σ 2 4 geostatistical modeling of the flow duration curve parameters the assumptions of geostatistical modeling according to diggle and ribeiro 2007 are i spatial stationarity of the response variables in this case flow duration curve fdc parameters μ and σ ii a spatial correlation of the geostatistical model depending only on the distance between the observation sites and iii an almost normal distribution of the variable to be interpolated the model that describes the spatial dependency geostatistical model through a random effect that accounts for spatial autocorrelation considering a set of observations of the fdc parameters μ and σ y x i y x n is given by the relation observed in eq 1 given the condition of non spatial stationarity and consequently an average that is not representative of the whole sample the spatial trend must be removed by modeling of the fixed effect μ x i the trend model μ x i can be expressed by predictor variables such as the basin centroid coordinates and spatially referenced variables external drifts associated with geomorphological or climatic characteristics in other words the trend model is a simple regression model i e without random effects the spatially correlated random effect s x i is represented by a covariance function c h defined as the product of a variance parameter σ 2 by a correlation function of a defined positive ρ h in which h is the distance that separates a pair of variables located in space therefore it gives an indication of similarity between these variables which vary according to the distance between them the covariance functions employed were the following i exponential ii gaussian iii spherical iv circular and v matérn with smoothness parameter κ equal to 1 5 and vi matérn with smoothness parameter κ equal to 2 5 the last component of the geostatistical model ε x i is the nugget effect this is a term used to represent the unexplained variance τ 2 from one point to another which can occur due to measurement errors or undetected low variations to adjust the geostatistical model parameters the maximum likelihood method was applied cox and hinkley 1974 in case of a high skewness and non normality of the response variable here they are μ and σ fdc parameters the fit of the geostatistical model parameters can become impractical due to the impossibility of likelihood function numerical maximization diggle and ribeiro 2007 if this is the case the transformation of the response variable to a gaussian distribution normalization should be performed a common normalization is by the family of functions box cox box and cox 1964 in studies related to the geostatistical modeling of the fdc the normalization is not employed and the mapping performance is not influenced pugliese et al 2016 castellarin et al 2018 therefore normality is not considered a strong assumption by using 24 covariates from the morphometrical and rainfall characterizations of the stream gauge basins six covariance functions and univariate and bivariate models with linear and quadratic relations to the trend models we tested 5 810 combinations of geostatistical models in total as for the regression models we studied 969 model combinations basically the regression models are the geostatistical models without the random effect i e they are the trend models geostatistical models covariance functions 5810 6 969 these geostatistical and regression model combinations were applied for predicting both the μ and σ fdc parameters at ungauged sites to select the best geostatistical and regression models we employed the akaike information criterion aic akaike 1983 therefore the best models were selected based on the lowest aic values since the process to delineate hydrologically homogeneous regions is not employed for the geostatistical approach to make the approaches comparable to each other in terms of the steps in the methodology we applied the regression approach to the whole study area rather than hydrologically homogenous regions later to assess the performance of the best geostatistical and regression models a leave one out cross validation loocv was employed for both the μ and σ fdc parameters loocv systematically left out each observation and predicted the particular observation at its location using the remaining observations we build the fdcs by employing their parameters after the loocv and comparing them to the observed fdcs thus 99 streamflow quantiles were selected for discretization and evaluation of fdcs by the modified kling gupta efficiency kge kling et al 2012 kge has its optimal value at unity and is defined as 6 kge 1 ρ 1 2 β 1 2 γ 1 2 where ρ is the correlation coefficient β is the bias ratio 7 β μ e μ o and γ is the variability ratio 8 γ cv e cv o σ e μ o μ e σ o where estimates are e observations are o and cv is the coefficient of variation in the above equations we used the r statistical software 3 3 1 r core team 2020 with packages mass venables and ripley 2002 rgdal bivand et al 2019 geor ribeiro and diggle 2020 and hydrogof mauricio zambrano bigiarini 2020 for the analyses aforementioned 3 results 3 1 rainfall patterns and morphometric characterization of the stream gauge basins first the basins were delimited to characterize the stream gauges the delimitation process was automated in a geographic information system environment the basin areas ranged approximately from 103 to 12 000 km 2 fig 4 the 81 stream gauge basins studied were characterized morphometrically and with regard to their rainfall pattern these characterizations were important to study the physical and climatic covariates that act on the hydrologic regime of a basin table 2 displays the 24 covariates obtained from the morphometrical and rainfall characterization 3 2 flow duration curve parameters the lognormal ln distribution was fitted to the specific streamflow values q e s p for all time and for each seasonal period moreover the scale μ and shape σ parameters were estimated to represent the mean and standard deviation of the specific streamflow logarithms respectively thereby the flow duration curves fdcs of the stream gauges were obtained with the survivor function of the ln distribution to spatially interpolate the fdc parameters it is important that they follow a gaussian distribution approximately as the mean and median values of the parameters were proximate there was an indication that they had a symmetrical distribution table 3 furthermore table 3 highlights the parameter values of the box cox transformation λ and the 95 confidence interval the σ parameter of the summer period displayed the highest difference to the ideal value λ 1 which indicates that no transformation is necessary five of ten fdc parameters are out the confidence intervals to accept normality however we observe that this non normality of some parameters did not yield problems in the estimation of the geostatistical model parameters and kriging predictions as evident in section 3 4 specifically the predictions do not overestimate or underestimate streamflow quantiles and achieve the study s goal of generating unbiased estimates of the fdc furthermore the assumption of normality is not strong for geostatistical modeling of the fdc and has been ignored in prior studies see pugliese et al 2016 castellarin et al 2018 3 3 fit of the models we selected the geostatistical models eq 1 with best fit by the akaike information criterion aic table 4 highlights the best fitted geostatistical models besides deriving the most parsimonious geostatistical model this approach is used to verify whether the addition of the random effect s x i improves the model estimation or not comparing the aic value for the non spatial model component i e fixed effect μ x i of eq 1 to the aic value for the geostatistical model in its complete form with μ x i and s x i we can conclude which model structure with or without s x i is the better by the lower aic value regarding the μ parameters of the flow duration curves fdcs a direct relation with the slope ratio r s was observed for the trend models table 4 for the all time and seasonal periods of summer autumn winter and spring this relationship was quadratic with the covariates average annual precipitation p a longitude x average autumn precipitation p autumn average winter precipitation p winter and basin mean slope s respectively as for the σ parameters we did not observe a recurrent covariate for all periods however the topological diameter d t displayed in three periods all time summer and winter all the best trend models presented bivariate quadratic relations table 4 thus considering a constant mean in the geostatistical models we did not observe a better fit the study area had different classes of topography and climate this explained the second order polynomial trend on the covariates in relation to the covariance functions the gaussian function presented the best fit for five geostatistical models among the ten studied table 4 this function is a member of the matérn family of functions and is obtained when the parameter κ on the other hand the spherical and circular covariance functions are members of the spherical family of functions the matérn family of functions is more adaptable to different data compared with the spherical also the gaussian function is more compatible with maximum likelihood estimation than the spherical function which is only once differentiable at a point of the function h range causing technical difficulties with maximum likelihood estimation diggle and ribeiro 2007 table 5 highlights the best fitted regression models the regression models tested in this study are analogous to the geostatistical models without their spatial component i e they are basically the trend models represented by the fixed effect μ x i for the μ parameters of the fdcs we observed that the p both for the all time and seasonal periods showed up in all best fitted models table 5 with regard to the σ parameters of the fdcs the recursive covariate was x in the bivariate quadratic form comparing the aic values of the regression models with the geostatistical models we highlighted the lower aic values of the geostatistical models which yielded the best fits thus fdc parameters and fdcs themselves were better represented by taking into consideration the spatial correlation among the fdc parameters observed at gauged sites subsequently all parameters of the geostatistical models were directly estimated by using the maximum likelihood method among them the β parameters corresponded with the mean which is the μ x i component i e the trend models the covariance function parameters σ 2 and ϕ represented the s x i component and parameter τ 2 corresponded to the residual variance i e the component ε x i the values of these parameters are illustrated in table 6 the variance parameter σ 2 also referred to as the sill had the largest values for μ and the lowest values were observed for σ the μ parameter indicates the scale of fdcs which exhibited a higher variance than the shape of the fdcs σ the ϕ parameter is the range for the spherical and circular covariance functions and is the practical range in the matérn family of functions including the exponential and gaussian functions the range in both cases refers to the distance at which fdc parameters are no longer autocorrelated and in the practical range this distance is defined where the autocorrelation coefficient is 0 05 diggle and ribeiro 2007 the fdc scale parameters μ s summer and μ s spring correspond to the circular covariance function and the shape σ s spring to the spherical covariance function thus the ϕ values result in the distances in which these fdc parameters are spatially correlated being 103 80 93 88 and 254 17 km respectively the matérn family of covariance functions are associated with the other fdc parameters the distances in which these functions are autocorrelated are 3 ϕ 3 1 2 ϕ and 4 75 ϕ for exponential gaussian and matérn with κ 1 5 respectively diggle and ribeiro 2007 thus the highest practical range was observed for the μ s autumn parameter 4 75 58 41 277 45 km and the smallest practical range was for the μ s winter parameter 3 1 2 29 88 51 75 km except for the autumn season we observed that the shape parameter of the fdcs showed a greater range than the scale parameter i e the shape of the fdcs are correlated to each other for longer distances than the scale finally the τ 2 parameter also called nugget effect reveals the noise ε x i of the geostatistical model i e the unexplained variance as with σ 2 which is grouped as a variance parameter and therefore displays a similar behavior i e a higher variance for the scale parameter and a lower variance for the shape parameter of the fdcs 3 4 performance of the predicted flow duration curves to complete the analysis and verify if the spatial interpolation yielded a good performance a leave one out cross validation loocv was performed for both the geostatistical and regression approaches fig 5 shows the modified kling gupta efficiency kge kling et al 2012 between the predicted fdcs and observed fdcs for 99 streamflow quantiles 0 1 0 2 0 99 in all periods the geostatistical approach outperforms the regression approach for the geostatistical models the mean kge values for the quantiles were 0 71 0 76 0 80 0 64 and 0 58 for the all time summer autumn winter and spring periods respectively as for the regression models the kge values reached 0 60 0 62 0 74 0 56 and 0 52 for the comparable periods the streamflow equaled or exceeded 98 of the time q 98 is the reference streamflow used to authorize surface water use sds 2021 therefore this is the streamflow quantile most important in santa catarina state in terms of surface water assessment for the geostatistical approach q 98 yielded kge values of 0 72 0 69 0 82 0 57 and 0 63 for all time summer autumn winter and spring respectively the regression approach had kge values of 0 68 0 64 0 79 0 44 and 0 50 for the equivalent periods thus the geostatistical approach delivered better results than regression for surface water management in the state of santa catarina since the geostatistical approach yielded the best results fig 6 highlights the relative residuals of the flow durations for it i e the difference between the predicted and observed fdc for a given site divided by the observed one computed for each of the 99 quantiles evaluated overestimates are more accentuated than the underestimates and this pattern is similar across the flow durations for each period however these biases are observed in the classes with few counts shades of gray the majority of counts are observed to be close to zero shades of gray close to black and the median behavior red lines confirm that the geostatistical approach employed here is unbiased for all flow durations and periods studied 3 5 flow duration curve predictions at ungauged basins once the geostatistical models were selected the flow duration curve fdc parameters were interpolated by using a kriging system as the fixed effect μ x i of the fitted geostatistical models table 4 corresponds to a trend model given by a set of covariates the kriging system is known as kriging with external drift ked and the weights are determined by the covariance function parameters adjusted to the trend model residuals the interpolation by ked is considered linear unbiased and with minimum variance blup best linear unbiased predictor these properties are defined as i linear its estimations are linear weighted combinations of available data ii unbiased aims for an error or residual mean value equal to zero and iii best because it minimizes the variance of the errors isaaks and srivastava 1989 p 278 with the proposed methodology it is possible to obtain the entire duration curve thus any streamflow related to duration can be estimated moreover the long term mean streamflow can be estimated directly by integrating the fdcs the regionalization model is made available at the website https github com wwolff7 tese dados this model is convenient to use because it is only necessary to input the basin centroid coordinates and area considering the importance of the streamflow equaled or exceeded 98 of the time q 98 for water management in the state of santa catarina we mapped this streamflow quantile standardized by area q 98 e s p for all time and seasonal periods the interpolated surface of q 98 e s p for all time period in the state of santa catarina is shown in fig 7 similar to the geographic pattern of rainfall as observed in wolff et al 2020 the variation in q 98 e s p follows the distribution of mountain chains and highlands besides rainfall and terrain there are aquifers that have a hydrogeologic influence on streamflows in particular low flows such as q 98 e s p that are sustained by groundwater inputs baseflow during dry periods the regions with the lowest values of q 98 e s p in the state were the south coast and the far west with values of about 2 to 4 m 3 h 1 km 2 the highest values occurred in the northern and central coast regions with values between 16 and 27 m 3 h 1 km 2 in the center of the state the santa catarina highlands and north central area the q 98 e s p was in the range of 6 to 12 m 3 h 1 km 2 and 10 to 14 m 3 h 1 km 2 respectively as observed for q 98 e s p for all time period the highest values for the seasonal q 98 e s p were observed in the northern and central coast regions which are part of the drainage system directed toward the atlantic ocean fig 8 the mean and lowest values were observed in the central and western regions of the state respectively these regions are part of the drainage system directed inland to the paran river basin 4 discussion the results of this study revealed that geostatistical modeling outperforms regression modeling for predicting flow duration curves fdcs at ungauged basins in a subtropical study area the better fit tables 4 and 5 and performance fig 5 were not only observed for predicting fdcs built by using the whole streamflow series but also for the seasonal streamflow series an important aspect to be considered for the geostatistical approach employed here is that it did not delineate hydrologically homogeneous regions as commonly applied in a regional regression approach since we performed an exploratory analysis to remove spatial trends trend models in table 4 we accounted for heterogeneity in the study area and reduced to possible causes of errors reaching a good performance pugliese et al 2016 recommend that the practice of dispensing with the delineation of homogeneous regions may be unsuitable for heterogeneous study areas however that recommendation does not take into account the application of a trend model and this is the reason why hydrologically homogeneous regions may not be required the hypothesis whether or not hydrologically homogeneous regions would improve our approach should be addressed in a next study another beneficial aspect of the proposed method in this study is that the inference by maximum likelihood allows an estimation of the geostatistical model parameters based on the data rather than an emprical semivariogram as is done by the method of least squares thus a direct comparison of models may be performed based on model selection methods by likelihood e g aic for driving the most parsimonious choice i e the trade off between the number of parameters and the maximum likelihood value for previous geostatistical approaches biased estimates have been a problem mainly for low flows i e the high duration portion of the fdc pugliese et al 2016 castellarin et al 2018 however that problem was not observed by the geostatistical approach proposed here fig 6 different from the previous approaches we performed an exploratory analysis to remove spatial trends trend models in table 4 alongside extensive geostatistical modeling assessed by maximum likelihood thus our approach yielded unbiased estimates for the entire fdc although we use a kriging system like previous studies biased estimates are not observed in this study fig 6 the approach applied here led us to identify spatial trend relations and model them i e the mean represented by the fixed effect μ x i of the geostatistical model was not considered constant over the region and basin descriptors were employed to define the form of the mean table 4 thus in general the linear weighting scheme of the kriging system did not deliver biased estimates once the mean was smoothed over the region we observed that accounting for the spatial autocorrelation of fdc parameters s x i improved the fit of the geostatistical model compared to excluding that component of the model based on lower akaike information criterion aic values table 4 therefore the study hypothesis was accepted and there was statistical evidence that the fdc parameters for the all time and seasonal periods are spatially autocorrelated these results were important because they showed that variability of the fdc parameters had a spatial pattern based on the aic goodness of fit measure previous studies like the current study concluded that geostatistical approaches were better than regression approaches to interpolate fdcs spatially castellarin 2014 pugliese et al 2016 castellarin et al 2018 another important feature of the geostatistical approach applied here was the monotonicity i e fdcs predicted at ungauged basins were non increasing positive defined functions over the interval of the exceedance probability p 0 1 the monotonic property of the fdc was preserved here because we interpolated fdc parameters instead of the multiple regression of the fdc quantiles which does not take into account the interdependency among quantiles and can lead to non monotonic results farmer et al 2014 pugliese et al 2016 the hydrography of the state of santa catarina is characterized by the presence of the geral mountain range fig 2 which divides the watercourses that drain into the atlantic ocean from those that drain inland this mountain range is the chief factor that sets the climate variability and streamflow regime the μ parameter of the fdcs corresponds with the scale of the curve and consequently represents the magnitude of the flow duration the results in table 4 highlight the importance of the slope ratio r s for the quantitative characterization of the fdc over the stream gauge basins i e all the trend models presented r s as a predictor the eastern side of the geral mountain range presents steeper slopes and consequently larger r s and fdc magnitudes in basins draining toward the atlantic ocean as for headwater basins that drain inland lower values of r s were reached apart from r s the average precipitation for the annual autumn and winter periods was employed in the trend models for the μ parameter of the fdcs in the respective periods table 4 this is a common variable used as a predictor in models for predicting fdcs at ungauged sites highlighting its relevance in the streamflow regime li et al 2010 costa et al 2014 atieh et al 2015 pugliese et al 2016 requena et al 2018 castellarin et al 2018 ridolfi et al 2020 according to the σ parameter of the fdcs i e the fdc shape parameter the topological diameter d t was the most frequent covariate in the trend models table 4 having a direct relation with the length and tributary numbers of the main channel in a basin d t represents the number of links in which the main channel can be divided on the basis of the junctions the shape parameter represents the average flow by allocating the inflection point position of a fdc i e the median where 50 of the flow is above it for instance fdcs that have a linear form i e high standard deviation have shorter less complex drainage networks i e a lower topological diameter while for fdcs with the extreme flows ranging close to the median i e low standard deviation basins with extensive drainage networks the effect of routing sustains steady streamflows in these basins hence the routing behavior of the basins that drive the σ parameter variability and its spatial trend in the study region is better represented by d t instead of using d t costa et al 2014 and atieh et al 2015 employed the basin shape factor another variable that characterizes the main stem of the drainage network for estimating the fdc shape parameter in regression and neural network methods respectively with regard to spatial variation we studied the streamflow equaled or exceeded 98 of the time divided by area q 98 e s p for the all time and seasonal periods the lowest values of q 98 e s p observed in the south coast of santa catarina state are in agreement with the lowest values of rainfall observed in the state wolff et al 2020 this behavior can be explained by the presence of the falkland current in the region and by local changes in the atmospheric circulation these are shaped by the free passage of winds coming from the ocean which lose their humidity on their way to the geral mountain range yielding low values of streamflow and rainfall the largest low flows occurred in the central and north coast and can be related to the atlantic tropical mass originating from the center of the high subtropical pressures in the atlantic being characterized as hot and humid this mass acts on the north center coast of the state and brings high precipitation and consequently streamflow besides the effect of the atlantic tropical mass in the region there is another important factor responsible for the high precipitation and streamflow in the center and north coast where higher values are observed the distance from the coast to the geral and sea mountain range is the lowest being 57 km from the north coast to the sea mountain range and 63 km from the center to the geral mountain range fig 2 hence orographic precipitation is observed as being caused by humid winds blowing from the atlantic ocean toward the mountains first the winds reach the hillslopes then the air masses ascend inducing the condensation of water vapor and finally the precipitation occurs the hydrogeological characteristic of the state is another factor that explains the spatial distribution of q 98 e s p in the whole coastal region the crystalline southeast aquifer is present where it has an extensive outcrop area machado 2013 as a rule local rainfall is considered to be sufficient to guarantee perennial rivers and recharge to the aquifer in which groundwater reserves are restored due to a large outcrop area therefore even in periods of drought storage obtained in rainy seasons ensures a higher availability of the q 98 e s p in the central and western regions of the state there is the presence of the geral mountain range aquifer which lies above the guarani aquifer in the western region of the state the aquifer is deeper and the groundwater fluxes to the water courses are smaller on the other hand in the central region the aquifer has its outcrop and thus a higher contribution to the watercourses occurs machado 2013 therefore this explains why the central region has larger q 98 e s p compared to the western region despite sharing hydrogeological features different from the coastal region in which the range of the streamflow values coincided with those of precipitation and could be explained by the same orographic and climatic factors this was not observed in the western region of the state despite having a high rainfall the western region presented low streamflow values this suggested that most of the rainfall was being stored by the geral mountain range aquifer located in the region it has basalt fractures and has been classified as porous extensive and quite productive machado 2013 the discussion of q 98 e s p variability associated with hydrogeological features reinforces the importance of studying the spatial trend of the fdc σ parameter i e the fdc shape parameter hydrogeological features drive the capability of the basin to store regulate and control the streamflow yielding flatter or steeper fdcs according to the increased or decreased water storage respectively castellarin et al 2018 5 conclusions mapping the flow duration curve fdc parameters all information obtained through the fdcs may be mapped as well e g streamflow quantiles reservoir volumes see wolff et al 2017 for retrieving reservoir volumes from fdc and long term mean streamflows i e through fdc integration for its whole domain because regression models may not be satisfactory we applied a geostatistical approach for interpolation fdcs at ungauged basins which improved the fit of the models and the spatial interpolation performance the present study shows the first application of a geostatistical approach based on models aiming to remove spatial trends and map fdcs for all time and seasonal periods in a subtropical region the state of santa catarina brazil we reached moderate bias in predictions for all flow durations i e without many underestimates or overestimates the all time and seasonal representation of the fdcs provide better insights into the seasonal dynamics of the streamflows in seasons where the streamflows are greater a greater amount of surface water resources may be authorized for use and vice versa thus this study may deliver a likely tool for water availability management at ungauged locations in the state of santa catarina the geostatistical modeling proposed here contributes to the existing knowledge base as follows i the geostatistical modeling is performed using the maximum likelihood method both for model selection and parameter estimation this gives the approach a straightforward and automated characteristic in which all parameters of the geostatistical model are fitted at one go i e the fit is performed directly to the data rather than to the empirical semivariogram ii 24 covariates external drifts associated with the morphometric and climatic characteristics are taken into account for modeling the fixed effect μ x i of the geostatistical model removing spatial trends and serving as a substitute for delineating hydrologically homogeneous regions iii continuous fdcs are predicted by mapping the fdc parameters which preserves the monotonic non increasing property of the fdc as a fundamental requirement of cumulative frequency distributions iv after obtaining the geostatistical model parameters a tool to predict fdcs with minimum input data can be provided i e basin area and centroid coordinates for kriging of the fdc parameters and predicting the fdcs themselves v the median of relative errors were close to zero for the entire duration different from similar studies where they reported poor performance for higher duration i e low flows castellarin 2014 pugliese et al 2014 2016 finally instead of using the basin centroids point as reference for geostatistical modeling and spatial predicting of the fdc parameters we suggest that future studies should use the basin areas area as reference such as the top kriging approach developed by skøien et al 2005 a comparative study between our approach and that of skøien et al 2005 should give better insights about how representing the fdc parameters spatially i e as basin centroids or areas interferes in the mapping performance and how these approaches can complement each other i e model based geostatistics applied for top kriging moreover another suggestion would be to introduce the streamflow data fit to the probabilistic distributions e g lognormal gamma and kappa into the geostatistical modeling thus the geostatistical modeling procedure should select a probability distribution trend models and spatial covariance functions credit authorship contribution statement wagner wolff formal analysis writing original draft writing review editing sergio nascimento duarte formal analysis writing original draft writing review editing declaration of competing interest authors declare that they have no conflict of interest acknowledgements we gratefully acknowledge the consortium for spatial information cgiar csi the center for information on environmental resources and hydrometeorology of santa catarina ciram and the national water agency ana for providing the data used in this research this study was financed in part by the coordenação de aperfeiçoamento de pessoal de nível superior brasil capes finance code 001 
306,we develop and validate a three dimensional particle method based on an enhanced weakly compressible mps approach for modeling immersed dense granular flows for this purpose we adopt a generalized rheological model using a regularized visco inertial rheology for all regimes of multiphase granular flow moreover we propose a new consistent formulation to estimate the effective pressure of the solid skeleton based on the continuity equation of the pore water to improve the accuracy of the multiphase particle methods especially near boundaries and interfaces we introduce a modified high order diffusive term by employing the convergent form of the laplacian operator the effectiveness of the new diffusive term is particularly demonstrated by modeling the hydrostatic pressure of two fluid phases further coupling the generalized rheology model with the flow equations we investigate the gravity driven granular flows in the immersed granular collapse and slide in three dimensions as a part of this study we represent the experiment on the immersed granular collapse to validate the model the evolution and runout length of the granular bulk are compared with those from experiments confirming good compatibility overall the qualitative and quantitative results justify the proposed developments shown to be essential for predicting different states of the immersed granular flows graphical abstract image graphical abstract keywords meshfree particle methods weakly compressible moving particle semi implicit method wc mps multiphase flows dense granular flows 1 introduction multiphase flow of solid grains interacting with fluid exists in many hydro environmental systems such as sediment erosions debris flows and submarine avalanches guazzelli and pouliquen 2018 mahdi et al 2019 these so called multiphase granular flows can have devastating socio economic impacts fritz et al 2009 tan and chen 2017 the experimental measurements and numerical models are the engineers tools to understand the complex physics of these problems to optimize the engineering designs and mitigate related hazards the numerical models have advantages in eliminating the expenses and surmounting the limits of the experimental researches however dealing with the highly dynamic interfacial flows including mixing processes of the solid grains and fluid phase requires advanced rheology models and numerical developments guazzelli and pouliquen 2018 baumgarten and kamrin 2019 the conventional mesh based eulerian approaches struggle to simulate the complicated deformations and fragmentations of interfacial flows yan et al 2020 rycroft et al 2020 meanwhile mesh free lagrangian methods have been shown to be effective for simulating such problems including complex interactions of fluids and sediments e g canelas et al 2016 harada et al 2017 li et al 2019 kazemi et al 2020 xu et al 2020 discrete based mesh free models e g the discrete element method are known to be accurate models for in depth analysis while are computationally expensive baumgarten and kamrin 2019 in contrast the continuum based mesh free particle methods at the macroscopic level or simply particle methods such as moving particle semi implicit mps and smoothed particle hydrodynamic sph methods homogenize the bulk volume of the mixture into moving particles being scalable and hence more computationally affordable in these models the lagrangian form of governing equations coupled with the constitutive laws calculates the interaction forces as the moving particles are the material points simulating the advection process particle methods due to their lagrangian nature have demonstrated promising capabilities in solving scientific and engineering problems gotoh and khayyer 2016 sph and mps as the two most popular particle methods initially proposed by gingold and monaghan 1977 and koshizuka and oka 1996 koshizuka et al 1998 respectively have been widely applied and developed for simulating complex fluid flow targeting hydro environmental problems e g harada et al 2017 kazemi et al 2020 snelling et al 2020 khayyer et al 2019 robb et al 2016 amaro et al 2020 these methods share many algorithms and techniques and produce similar results in many cases amaro et al 2020 souto iglesias et al 2013 however mps as a kernel derivative free method has more flexibility in the choice of the kernel function and resolves the instability issues that arise from the derivative of the kernel function in the inter particle force terms of the original sph formulations swegle et al 1995 monaghan 2000 furthermore mps uses the non dimensional particle number density as a substitute for the real density which naturally addresses the density discontinuities at the phase interfaces of multiphase simulations hu and adams 2006 shakibaeinia and jin 2010 proposed the weakly compressible version of the mps method denoted as wc mps by solving the equation of state instead of the poisson equation for updating the pressure field they have extended and validated the wc mps method for incompressible and multiphase problems in various hydrodynamic conditions shakibaeinia and jin 2012 shakibaeinia and jin 2011 shakibaeinia and jin 2012 furthermore this method has been the focus of many research studies for simulating complex flows e g xu and jin 2016 wang et al 2019 ye et al 2020 zheng et al 2020 and specifically developed for the dry and saturated granular flows e g ke et al 2020 tajnesaie et al 2018 nodoushan and shakibaeinia 2018 xu et al 2017 fu and jin 2015 jandaghian and shakibaeinia 2020 enhanced the wc mps method by introducing a conservative system of equations supplied with the diffusive term and the corrected particle shifting technique recently jandaghian et al 2021 developed the particle regularization techniques of this so called enhanced wc mps ewc mps model for capturing the non linear behavior of violent free surface problems in this study the ewc mps method is coupled with the rheological models and further improved and validated for simulating the multiphase granular flows many empirical and numerical studies have been devoted to introducing general and reliable constitutive equations for capturing the different regimes of the granular flows i e the free fall inertial and viscous regimes guazzelli and pouliquen 2018 jop et al 2006 e g baumgarten and kamrin 2019 midi 2004 amarsid et al 2017 particularly for the immersed and dense granular flows representing a versatile model for understanding the underlying physics of the mixture is more challenging since both inertial and viscous regimes may control the mechanical behavior of the flow amarsid et al 2017 furthermore in these rheology models an accurate estimation of the normal stress i e the effective pressure within the solid skeleton is essential for detecting the yielded and non yielded flow regions with this regard the commonly used hydrostatic assumption for calculating the pore water pressure includes the complexity and limitations of detecting interfaces and ignores the hydrodynamic aspects of the granular flows in the rheology equation moreover the unphysical pressure noises as the common problem of particle methods antuono et al 2010 arising from the numerical and approximation errors can significantly affect the accuracy of the results resolving these modeling issues requires developing a unified framework for the immersed granular flow rheology model e g baumgarten and kamrin 2019 amarsid et al 2017 boyer et al 2011 and implementing higher order operators e g xu and jin 2016 antuono et al 2010 the particle regularization techniques e g sun et al 2017 krimi et al 2020 and the artificial diffusive terms e g antuono et al 2010 monaghan 1992 for ensuring the stability and accuracy of the numerical simulations the rheology models in the continuum based methods consider non newtonian behaviors for the dense granular flows guazzelli and pouliquen 2018 bingham types viscoplastic models the bingham plastic and the herschel bulkley models have been frequently utilized and validated in particle methods e g shakibaeinia and jin 2012 manenti et al 2012 fourtakas and rogers 2016 zubeldia et al 2018 krimi et al 2018 more recently the local μ i rheology proposed by jop et al 2006 and forterre and pouliquen 2008 as a function of the flow and material properties has drawn attention for the dry and submerged problems e g ke et al 2020 tajnesaie et al 2018 chauchat and médale 2014 for immersed conditions of the dense granular flows different non newtonian models are developed according to the experimental and numerical results e g see amarsid et al 2017 boyer et al 2011 cassar et al 2005 stickel and powell 2005 guazzelli and pouliquen 2018 presented a comprehensive review of the rheology of concentrated granular suspensions regarding the immersed granular flow in the low stokes limit boyer et al 2011 conducted a series of pressure imposed shearing experiments to represent unified rheology amarsid et al 2017 with some dimensional analysis and simulating the inertial and viscous regimes of the mixture by a coupled molecular dynamics lattice boltzmann method introduced a unified rheology model for capturing the dry and immersed granular flows baumgarten and kamrin 2019 combined the former models in a single formulation to simulate the granular flows using a two phase model in the context of particle methods rodriguez paz and bonet 2004 employed the generalized visco plastic fluid gvf model proposed by chen and ling 1996 as a semiempirical model to calculate the total shear stress of the debris flow with a corrected sph method hosseini et al 2007 modeled single phase non newtonian fluid flows using the power law bingham plastic and herschel bulkley constitutive models with an explicit sph approach nabian mohammad and farhadi 2017 utilized the bingham and the gvf rheological models to simulate the granular multiphase flows in an incompressible mps scheme to eliminate the numerical problem of pressure dependent erosion at the interface khanpour et al 2016 and zubeldia et al 2018 employed the shields criterion in the weakly compressible sph framework to determine the sediment erosion threshold while the constitutive model determines the effective viscosity of the sublayer sediment phase based on bingham viscoplastic models in the wc mps framework shakibaeinia and jin 2011 simulated the two phase mobile bed dam break shakibaeinia and jin 2012 including the non linear behavior of the granular material by the gvf model jafari nodoushan et al 2018 employed the regularized form of the local μ i rheology to model the submerged and dry granular collapses further tajnesaie et al 2018 developed the same model to simulate the granular landslide in a two dimensional configuration and compared the results with the heschel bulkley model recently ke et al 2020 investigated the role of the μ i rheology for the dry granular slide and dam break via the standard wc mps method the sediment rheology model is pressure dependent and requires determining the granular effective pressure within the mixture phase for calculating the effective viscosity the two phase mixture models which solve separate sets of equations for each granular and fluid phase calculate the effective pressure within the solid phase directly e g baumgarten and kamrin 2019 pahar and dhar 2017 bui and nguyen 2017 however the single phase multi density multi viscosity models require a supplementary approach to estimate the pore water pressure of the mixture phase in particle methods different approaches are proposed for determining the effective pressure within the granular material the majority of the sph and mps models e g manenti et al 2012 nabian mohammad and farhadi 2017 jafari nodoushan et al 2018 bui and fukagawa 2013 assume the lithostatic condition for the fluid and or sediment phases to predict the pore water pressure neglecting the hydrodynamics of the mixture flow ghaïtanellis et al 2018 appended an additional equation to the sediment model to calculate the soil skeleton stress independently via solving the laplacian of the effective pressure accompanied by the boundary conditions of the model in general these approaches involve the free surface and interface detections limiting the capability of the particle method for dealing with highly deformed multiphase flows to avoid this issue fourtakas and rogers 2016 and zubeldia et al 2018 employed a modified equation of state eos of the wc sph model by using the density of the saturated sediment to estimate the pore water pressure however since their model considers different reference pressure within the eos for the total and pore water pressure the pressure oscillations due to the slight compressibility affect the sediment model overestimating the viscosity for the submerged conditions ghaïtanellis et al 2018 since in the mps sph methods the kernel truncates at the free surface of the fluid and in the vicinity of the solid boundary the standard diffusive term added to the continuity equation diverges the density field this leads to unphysical pressure prediction affecting the overall mechanical behavior of the fluid flow particularly in the long term simulations in the case of granular flows where the constitutive equation and yield flow behavior are highly sensitive to the pressure field and its vibrations such unphysical divergence can largely affect the results in general by adding a numerical diffusion term to the continuity equation e g in the δ sph antuono et al 2010 molteni and colagrossi 2009 and the ewc mps methods jandaghian and shakibaeinia 2020 the high frequency pressure fluctuations have been eliminated however dealing with the density discontinuity at the interfaces of multiphase problems still requires special treatments to overcome these numerical issues sun et al 2019 applied the diffusive term by the convergent form of the laplacian operator originally proposed by antuono et al 2010 for the single fluid phase problems for the multiphase problems restricting the diffusive term between the fluid particles within the same phase in this case the renormalization matrix and the first order density gradient operators are also limited to the same phase particles similarly zheng and chen 2019 proposed the convergent formulation for the diffusive term in the multiphase sph model employing the oscillation of density increment instead of the density variable krimi et al 2018 proposed another form of the diffusive term for the multiphase wc sph method for dealing with the density discontinuity at the interface however the proposed term violates the mass conservation and ignores the higher order spatial terms required for reducing the kernel truncation errors at the free surface and in the vicinity of the solid boundary fourtakas et al 2019 introduced a new form of the diffusive term for the single fluid phase problems by substituting the dynamic density with the total density in the original formulation of molteni and colagrossi 2009 they showed that the new diffusive term by removing the hydrostatic density from the total density improves the pressure estimation close to the boundaries only for problems where the gravitational force is dominant fourtakas et al 2019 nevertheless it should be noted that the proposed diffusive term unlike the diffusive term proposed by antuono et al 2010 with the higher order gradient violates the conservation of mass considering that it is not an antisymmetric equation see antuono et al 2012 in this paper we aim to develop a robust and accurate ewc mps method for predicting the evolution of the immersed granular flows concerning its different regimes this model benefits from the enhancement techniques required for the stability and accuracy of such fluid flow besides the particle number density updated via the continuity and diffusive equations deals with the density discontinuity issues which affect the pressure field here we extend the developments to three dimensional and multiphase problems developing a generalized rheology model we adopt and regularize the visco inertial rheology model to capture the inertial and viscous regimes through a single formulation moreover based on the continuity equation of the pore water phase as a barotropic fluid we propose a consistent formulation to eliminate the complexity for detecting the interface meanwhile include the dynamics of the fluid flow within the effective pressure estimation in the proposed model we implement the sub particle scale sps turbulent model for the fluid phase and the higher order velocity gradient operator to improve the accuracy of the numerical model we modify the diffusive term in the context of mps for dealing with multiphase problems including the pressure dependent shear models the new diffusive term aims to alleviate the kernel truncation and density discontinuity issues of the multiphase problems and remove the unphysical pressure noises to include the physical effects of the removable gate in the initial stage of the fluid flow we implement virtual gates imposing the shear and pressure interactions first a simple hydrostatic pressure is modeled to show the effectiveness of the modified diffusive term further we simulate and validate challenging benchmark cases of the granular flows the immersed granular collapse and landslide the mixture behavior in the former is identified by the viscous and inertial regimes whilst in the latter the inertial regime is dominant due to the extreme flow deformation to validate the immersed granular collapse we conduct a complementary experiment representing the evolution and runout length of the deposit the submerged and deformable landslide is validated by the available experimental results we investigate and fully characterize the flow regimes of these problems and evaluate the effectiveness of the proposed developments for capturing the complex mechanical behavior of such multiphase flows 2 governing equations and constitutive laws 2 1 basic assumptions the immersed granular flows consist of a mixture of solid grains and viscous fluid i e water in this study the mixture of solid grains and interstitial pore water is considered as a single continuum further the constitutive laws represent the ambient water ω w as a newtonian and the mixture ω m as non newtonian fluid phases see fig 1 the mathematical models correspond to the mechanical behavior of the fluid phases and their interactions based on the following assumptions we derive the generic mathematical and numerical frameworks of the fluid domain i the mixture of solid grains and water is a non colloidal and non brownian suspension ii the water and mixture phases are barotropic fluids iii no mass exchange and heat transfer occur between the fluid phases iv terzaghi s stress principle specifies the effective pressure of the sediment skeleton with the first assumption we employ the local rheology model that characterizes the granular flow with the volume fraction of the solid grains and the bulk friction coefficient considering the gravitational and shear forces baumgarten and kamrin 2019 amarsid et al 2017 the second assumption allows the mathematical model to update the pressure of the fluid phases as a function of the density variations baumgarten and kamrin 2019 considering the third assumption and neglecting the compressibility of the pore water and the solid skeleton of the grains signify that the volume fraction of the granular phase remains invariant further the single phase and continuum based models ignore the relative velocity between the interstitial fluid and solid grain the fourth assumption is used to estimate the normal stress between the solid grains required for the rheological properties of the mixture in this paper the subscripts w g m f and pw denote the flow and material properties of water the solid grains the mixture of solid grains and water the overall fluid domain as the union of the water and mixture phases i e ω f ω w ω m and the pore water respectively see fig 1 also 0 as a superscript or subscript of the flow properties stands for the initial condition or the reference values 2 2 flow equations the navier stokes governing equations in the lagrangian framework describe the continuum flows as panton 2013 1 d ρ dt ρ v ρ d v dt p τ ρ f d r dt v in which the pressure the shear and the body forces per unit volume p τ and ρf respectively determine the acceleration d v d t of a fluid with a density of ρ the velocity vector and its divergence i e v and v the mass volume expansion rate updates the position r and the rate of change of the density d ρ d t respectively in the weakly compressible fluid models the equation of state as a function of the material density calculates the mechanical pressure i e p f ρ the rheology models account for the viscous forces within the multiphase fluid flows the general form of the rheology models considers the shear stress as a linear or non linear function of the strain rate tensor e and its principal invariants the first second and third principal invariants ie v 0 i i e 1 2 e e and iiie respectively based on the reiner rivlin equation for an incompressible mixture flow chen and ling 1996 assuming the shear stress independent of iiie and e 2 terms represents the shear stress tensor as follows chen and ling 1996 2 τ e 2 η e where η is the effective or apparent dynamic viscosity of the fluid phase this effective viscosity includes the shear behaviors of the fluid flow considering the rate of deformation and the material and hydrodynamic properties for both newtonian and non newtonian fluids the incompressibility assumption i e v 0 sets e equal to the deviatoric part of the rate of deformation e where e 0 5 v v t and the superscript t stands for the transpose of the matrix in the momentum equation the divergence of the shear stress includes the viscous forces through the system of equations 1 considering the incompressibility condition and neglecting the gradient of dynamic viscosity over the domain i e η 0 even at the interfaces simplifies the viscous force to shakibaeinia and jin 2011 tajnesaie et al 2018 3 τ η 2 v this force stands for the shear behaviors of both newtonian and non newtonian fluids for newtonian and incompressible fluids a linear relationship exists between its true viscosity and the strain rate tensor in the case of the granular flows the solid grains immersed in newtonian fluids like water with the true viscosity of μ w increases the viscosity of the fluid as μ w 1 5 2ϕ by the volume fraction ϕ guazzelli and pouliquen 2018 baumgarten and kamrin 2019 moreover the turbulence eddy viscosity ν t based on the large eddy simulation model lo and shao 2002 can be added to include the turbulence effects within the effective dynamic viscosity of the water as follows 4 η w μ w 1 5 2 ϕ ρ w ν t we calculate the turbulence eddy viscosity with ν t c s δ l 2 4 i i e in which δl is the mixing length and the smagorinsky coefficient cs is set to 0 12 for non newtonian fluids ideally the rheology model should be capable of capturing the mechanical behaviors such as the shear thinning the shear thickening and the flow threshold the experimental studies show that granular flows contain these non linear behaviors stickel and powell 2005 accordingly the continuum based models consider the granular flows as non newtonian and incompressible fluids where the rheology model includes their shear behaviors through the effective viscosity 2 3 a regularized visco inertial model here we employ the rheology model proposed by baumgarten and kamrin 2019 combining boyer et al 2011 and amarsid et al 2017 models to simulate the viscous and inertial regimes of the granular flows within a single formulation as analyzed by amarsid et al 2017 in this model the non dimensional numbers controlling the flow behaviors are the inertial number i the viscous number iv and the mixed number im defined as follows 5 i m i 2 2 i v i γ d g ρ g p g i v μ w γ p g where dg and ρ g are the mean diameter and the true density of the solid grains respectively the normal stress between the solid grains pg is the effective pressure of the solid skeleton p eff in the immersed condition the magnitude of the shear rate γ is equal to 4 i i e for an incompressible fluid the general form of the viscosity model hereinafter denoted as the visco inertial model is given by baumgarten and kamrin 2019 6 μ i v i m ϕ μ 1 δ μ b i m 1 5 2 ϕ i v a i m in which δμ μ2 μ1 and ϕ is the volume fraction of the solid grains the material parameters a and b including the upper and lower limits of the friction coefficient μ2 and μ1 respectively can be specified by fitting the numerical and experimental results in the steady state shearing flows baumgarten and kamrin 2019 in the context of this model the stokes number defined as st i 2 iv determines the regimes of the granular flows if st the inertial number is dominant i e im i and by setting b i 0 and μ f 0 eq 6 reproduces the μ i rheology implemented for the dry granular flows i 0 being an empirical coefficient of the rheology baumgarten and kamrin 2019 showed that for st 0 where i m 2 i v eq 6 fits with the data collected from the viscosity models and experimental measurements represented by chang and powell 1994 stickel and powell 2005 and boyer et al 2011 for the inertial and viscous regimes these empirical models govern the dense granular flows suggesting i 0 2 i v 0 1 i m 0 6 and 0 st conditions baumgarten and kamrin 2019 considering the visco inertial model the effective viscosity for the incompressible mixture η m forms to 7 η m μ i v i m ϕ p g γ to use eq 7 within the viscous force 3 the singularity issue as γ 0 should be resolved by employing the regularization techniques chauchat and médale 2014 here we utilize a combination of the bercovier and engelman 1980 regularization formulation and the simple regularization model represented by frigaard and nouar 2005 within the term containing the yield stress τ y μ1 pg and the post failure terms i e the second and third terms on the right hand side of eq 6 therefore by substituting the dimensionless numbers 5 into μ iv im ϕ we obtain the effective viscosity formulation as follows 8 η m τ y γ 2 λ r 2 δ μ p g b p g d g 2 ρ g 2 μ w γ λ r γ 5 ϕ 2 a μ w p g γ 2 d g 2 ρ g 2 μ w γ λ r 2 in which the regularization parameter λ r is a small value to avoid the singularity and the normal stress is assumed to remain positive over the mixture phase i e λ r 1 and pg 0 see appendix a to specify the yield stress for the non cohesive granular material with the internal friction angle θ we employ the drucker prager yield criteria as τ y μ 1 p g 2 3 sin θ p g 3 sin θ in eq 8 unlike the bingham types and the generalized viscoplastic models the post failure terms contain the material and flow properties within a single formulation for the dry and immersed conditions moreover when γ is strictly zero the regularized effective viscosity is definite unlike the papanastasiou regularization technique chauchat and médale 2014 and no further consideration is required 2 4 consistent effective pressure for the immersed granular flows the effective pressure of the sediment skeleton plays a key role in the constitutive model eq 8 to capture the mechanical behavior of the highly dynamic multiphase granular flows the rheology model should predict a dynamic pore water pressure applying the lithostatic condition not only requires detecting the interfaces beforehand but also ignores the dynamics of the mixture s motion for estimating the effective pressure this has limited the capability of the well developed particle methods e g tajnesaie et al 2018 ghaïtanellis et al 2018 jandaghian and shakibaeinia 2019 amicarelli et al 2017 for dealing with highly deformed interfaces in the immersed granular flows here we propose a consistent approach based on the mass conservation law of the pore water within the mixture phase to calculate the effective pressure dynamically for this purpose we employ the main assumptions already considered in the single phase continuum based models for the fully submerged granular flows the assumptions i iv in section 2 1 the continuity equation governing the partial density of the pore water ρ p w 1 ϕ ρ w is given as 9 1 ρ p w d w ρ p w d t 1 v m d w v m d t 0 where d w d t is the material time derivative on the water phase bandara and soga 2015 the second term of this equation stands for the rate of volume expansion and can be substituted by the divergence of the velocity field v pw as vm being the volume of the material particle eq 9 specifies the evolution of the true water density of the mixture phase ρ w as a barotropic fluid for calculating the pore water pressure baumgarten and kamrin 2019 since the single phase models treat the mixture of grains and pore water as a single continuum the fluid flow within the solid skeleton is neglected accordingly we can assume that the volume fraction remains invariant i e ϕ constant and the pore water phase follows the same velocity and position as the mixture phase i e v pw v and d w d t d d t therefore we summarize the general form of the constitutive relation for the pore water pressure within the immersed granular phase as follows 10 1 ρ w d ρ w dt 1 v m d v m dt 0 p pw f ρ w by solving eq 10 we supply the continuum based model with a direct method to update the pore water pressure field within the mixture phase without the need for detecting interfaces with the initial hydrostatic condition for the density and pressure fields the spatial divergence of the velocity field v determines the evolution of ρ w eventually terzaghi s effective stress and the equation of state for the mixture and pore water phases determine the effective pressure p eff p ppw it should be highlighted that the rheology model only utilizes the effective pressure to calculate the effective viscosity and the mixture inertial numbers through eq 8 meanwhile the velocity field of the mixture phase v along with the bulk properties of the fluid flow p and ρ are calculated via the system of equations represented as the multiphase model in eq 1 3 numerical model 3 1 the discrete system the continuum based models homogenize the representative volume of the water and solid grains into continuous fluid phases the approximation procedure of the particle methods discretizes the fluid domain into moving calculation points carrying the material and flow properties fig 1 the approximation operator for the quantities and derivatives of the flow variables represents the discretize particle system koshizuka et al 2018 liu and liu 2003 in the conservative wc mps method jandaghian and shakibaeinia 2020 the right hand sides of the differential equations 1 are approximated for a generic particle i as follows 11 d n i dt n i v i ρ i d v i dt p i η 2 v i ρ i f i d r i dt v i where the particle number density ni is updated via the continuity equation and η is the dynamic viscosity the density of particles is constant in the momentum equation ρ i ρ0i the true density of fluid particles while the pressure is updated by the equation of state given as 12 p i b 0 n i n 0 γ 1 where γ 7 shakibaeinia and jin 2010 for the multiphase fluid flows the fluid bulk modulus b 0 is set to be identical over the domain as b 0 c 0 2 ρ 0 γ where c 0 and ρ0 are the artificial sound speed and the true density of the reference fluid phase respectively colagrossi and landrini 2003 with c 0 10 v max where v max is the maximum expected velocity of the problem the mach number remains less than 0 1 limiting the compressibility of the fluid to 1 it is worthy to mention that this mps method for multiphase fluid flows resolves the discontinuity issue occurring at the interfaces via using the particle number density as the substitute for the density variable like hu and adams 2006 and the identical bulk modulus for all the fluid phases in the approximation procedure the kernel function w smooths the differential operators of eq 11 over the particles fig 1 the normalization factor n 0 as a constant value over the computational domain is the kernel summation of the fluid particles over their neighbor particles n at the initial state of particles l 0 and away from boundaries i e n 0 i j n w r i j r e at t 0 as rij r j r i re and re being the influence radius of the kernel function set to 3 1l 0 with considering the conjugate form of the gradient and divergence operators in the context of mps formulations we derive the approximation operators of the fluid flow variables as follows 13 v i d n 0 i j n n j n i v ij r ij e ij w ij p i d n 0 i j n n i p j n j n j p i n i e ij r ij w ij η 2 v i 2 d n 0 i j n η ij v ij r ij 2 w ij in which wij w rij re and d 1 2 3 is the number of space dimensions the rational kernel function koshizuka et al 1998 is used in all the simulations the pressure force vectors lie on the unit direction vectors between particle i and j e ij r ij rij conserving the linear and angular momentum of the system while laplacian of the velocity vector with the direction of v ij v j v i only conserves the linear momentum one should note that in the absence of shear stresses and external forces the approximated form of the governing equations conserves the total energy of the system e i e d e d t 0 0 in our model the harmonic mean determines the effective dynamic viscosity acting between particles i and j as η ij 2η i η j η i η j shakibaeinia and jin 2012 to ensure the numerical stability and eliminate the particle clustering i e the tensile instability we implement the corrected particle shifting algorithm the cps technique proposed in the ewc mps method jandaghian and shakibaeinia 2020 regularizing their position vector by the corrected particle shifting vector δr i as r i r i δ r i the proposed cps is applicable to the three dimensional problems without any adjustment regarding the implemented free surface detection algorithm and the interface treatments this approach utilizes the summation of the kernel function i e the particle concentration defined as i j n w i j n 0 and hence acts independently from the material properties of the fluid phases in the multiphase problems in this study the particle shifting coefficient is set to 0 04 l 0 2 further we limit the magnitude of the shifting vector as δr i min 0 25 v i δt 0 2l 0 δr i δr i δr i to reduce the energy manipulation that may occur by the convection of material and flow properties of the fluid particles where the potential energy is dominant 3 2 modified diffusive term jandaghian and shakibaeinia 2020 introduced the diffusive term in the wc mps method to eliminate high frequency pressure fluctuations by adding the diffusive term di to the right hand side of the continuity equation this numerical correction has proved to be effective and essential for obtaining a smooth pressure field in particle methods e g jandaghian and shakibaeinia 2020 molteni and colagrossi 2009 nevertheless the standard form of the diffusive terms proposed by molteni and colagrossi 2009 for wc sph and jandaghian and shakibaeinia 2020 for wc mps unphysically diverges the pressure field at the free surface as the kernel function truncates antuono et al 2010 the same issue exists in the vicinity of the solid boundary particles where the inner product of the normal vector to the solid wall and the gravitational force is non zero i e n s g 0 in this case the density of the fluid particles close to the solid boundary particles decreases affecting the overall pressure field in the long term simulations this divergence occurs as the solid boundary particles are excluded from the diffusive term of the fluid particles required for conserving the total mass of the fluid phase particularly for problems where the mechanical behavior of the fluid flow depends on the pressure parameter implementing a convergent diffusive term over the fluid domain becomes essential e g for calculating the effective viscosity of the sediment phase in this study moreover in the multiphase problems the diffusive term as a function of the density in the standard delta sph requires special treatment at the interface of the fluid phases due to the discontinuity of the density field by only applying the diffusive term among the same phase particles e g in fourtakas and rogers 2016 sun et al 2019 the kernel function truncates at the interface diverging the density field although the higher order gradient formulation reduces the associated errors for highly deformable interfacial flows this is still incompetent here we represent a modified diffusive term in the context of the wc mps method to surmount the numerical issues arising from the kernel truncations at the boundaries to do so we employ the convergent form of laplacian and taylor s expansion series based on the work of antuono et al 2010 further utilizing the particle number density ni gives an independent diffusive term with respect to the density discontinuities at the interfaces of multiphase problems the general form of the modified diffusive term denoted by d i m is given as 14 d i m δ m p s δ t c 0 2 n 0 2 n i where the time step of calculation δt the reference sound speed and the normalization factor c 0 and n 0 respectively and the non dimensional coefficient 0 δ mps 1 determine the intensity of the numerical correction jandaghian and shakibaeinia 2020 to supply the model with the global convergent equation for laplacian of the particle number density we consider 15 2 n i 2 d n 0 i j n ψ i j w i j r i j 2 where based on taylor s series ψ ij is given by 16 ψ i j n j n i 1 2 n i c n j c r i j recovering the convergence all over the fluid domain antuono et al 2010 the gradient of ni in the mps formulations is approximated via 17 n i c d n 0 i j n n j n i r i j c i e i j w i j in which the corrective matrix c i increases the operator s order of accuracy and is as follows jandaghian and shakibaeinia 2020 18 c i d n 0 i j n r i j r i j e i j w i j 1 while i and j ω f and is the outer product of two vectors eventually the modified diffusive term denoted as d i m forms to 19 d i m δ m p s δ t c 0 2 n 0 2 d n 0 i j n n j n i 1 2 n i c n j c r i j w i j r i j 2 limited among the fluid particles i e i and j ω f therefore by adding this term to the continuity equation proposed in the enhanced wc mps model we obtain 20 1 n i d n i d t v i d i m for updating the particle number density field in the multiphase problems the modified diffusive term acts independently from the density discontinuity at the fluid interfaces and benefits from the continuous particle number density field this is possible as the identical bulk modulus b 0 ρ 0 c 0 2 γ and the normalization factor are used to define the particle number density and calculate the pressure fields in all the fluid phases further this diffusive model conserves the total mass of the system i e i n i d i m v i 0 as vi is the volume of the particle in multiphase test cases the implementation and effectiveness of the modified diffusive term are specifically discussed in section 4 1 recently jandaghian et al 2021 adopted this diffusive term eq 19 for simulating and validating violent free surface flows 3 3 a generalized rheology model for immersed granular flows the numerical model calculates the effective viscosity of each fluid particle concerning its material properties and flow variables here we propose a generalized rheology model to couple with the ewc mps method by implementing the regularized visco inertial rheology model along with the consistent effective pressure the regularized visco inertial model eq 8 determines the effective viscosity of the fluid particles containing the granular material i ω m through 21 η i τ y i γ i 2 λ r 2 δ μ p g i b p g i d g 2 ρ g 2 μ w γ i λ r γ i 5 ϕ i 2 a μ w p g i γ i 2 d g 2 ρ g 2 μ w γ i λ r 2 in which the normal stress between the solid grains pg i wherein the immersed condition pg i p eff i gives the yield stress as τ y i μ1 pg i and γ i 4 i i e i in this study we choose λ r 0 001 to avoid the singularity issue the constitutive model for newtonian fluid eq 4 updates the effective viscosity of the water particles i ω w as a function of the shear rate magnitude γ i and the smoothed volume fraction φ i by 22 η i μ w 1 5 2 ϕ i ρ 0 w c s r e 2 γ i where μ w 0 001 pa s ρ 0 w 1000 k g m 3 for water and the smoothing length re is considered as the mixing length for the turbulence sub particle scale model with cs 0 12 see lo and shao 2002 duan and chen 2015 here we have ignored the implementation of favre averaging for the turbulence viscosity calculations see dalrymple and rogers 2006 by neglecting the weak compressibility of the fluid model the numerical model estimates the volume fraction over the fluid particles as follows 23 ϕ i i n ϕ j w ij i n w ij considering that for i ω w ϕ i 0 and for i ω m ϕ i ϕ ϕ being the volume fraction of the solid grains and with the third order spiky kernel function it should be noted that the local volume fraction of the fluid particles ϕ i remains invariant during the simulation although its approximated value varies in the immersed problems as the interface deforms overall the terms containing ϕ i in the rheology model aim to include the effects of the suspended granular materials through the effective viscosities at the interface where ϕ i for i ω m decreases while for i ω w increases baumgarten and kamrin 2019 moreover we set τ y i ω m 0 if ϕ i becomes less that 0 25ϕ we employ the corrective matrix c i eq 18 to increase the order of accuracy for estimating the velocity gradient through 24 v i c d n 0 i j n v i j r i j c i e i j w i j used to calculate the second invariant of the strain rate tensor iie i 0 5e i e i where e i 0 5 v i c v i c t to implement the consistent effective pressure proposed in section 2 4 we consider the rate of volume expansion of the particles i e v i 1 d v i d t by the velocity divergence and the diffusive term as v i d i m to update the true density of the pore water hence we discretize the system of eq 10 in the lagrangian framework for the mixture particles as follows 25 1 ρ w i d ρ w i dt v i d i m i ω m p p w i b 0 ρ w i ρ 0 w γ 1 assuming invariant pore water porosity for the particles note that the right hand side of the continuity equation of 25 is already estimated for updating the particle number density field through eq 20 with terzaghi s effective stress p eff i pi ppw i and the equation of state 12 for pi and ppw i as the functions of n i n 0 ρ i ρ 0 m and the identical b 0 where the true density of the mixture phase ρ 0 m 1 ϕ ρ 0 w ϕ ρ g the general form of the effective pressure reduces to 26 p eff i b 0 n i n 0 γ ρ w i ρ 0 w γ i ω m the proposed model not only calculates the effective pressure dynamically but also removes the need for tracking the interfaces without additional calculation costs it is worthy to note that since the presented model updates pi and ppwi with an identical bulk modulus the pressure oscillations due to the slight compressibility of the numerical model are filtered out from the effective pressure calculation otherwise using different reference pressures in the equation of state or the hydrostatic assumption for the pore water pressure affects the stable viscosity field required for capturing the mechanical behavior of the submerged granular flows since this introduces the low frequency oscillations into the effective pressure field 3 4 virtual moving gates in experimental setups of the immersed granular flows including the gravity flow driven problems a physical gate contains the fluid phases at the initial stage different mechanisms have been implemented for removing the gate to release the mixture or fluid phase and form the granular flow e g a sluice gate is lifted or withdrawn into a bottom cavity of the channel see rondon et al 2011 and grilli et al 2017 the gate as a moving object interacts with the fluid and granular phases through the pressure and friction forces these interactions may have impacts on the initial stage of the flow as the gate is being removed depending on the thickness and the roughness of the gate and the material properties of the fluid phases including the physical effects of the gate associated with its high true velocity within the numerical simulations has been a challenge in terms of stability and accuracy of the model therefore the numerical models mostly ignore the presence of the gate and its influence on the initial condition of the fluid flows e g krimi et al 2018 ghaïtanellis et al 2018 shi et al 2019 here we employ virtual moving gates to include the effects of the removable gate in the governing equations of the fluid particles while ignoring its physical thickness representing the thickness of the physical gate requires the use of extremely small particles affecting the computational efficiency we explain the implementation of the virtual gate method through a simple example in which a gate separates the fluid phases as being lifted in the y direction fig 2 we model the virtual gates by two sets of virtual particles with the particle distance of l 0 arranged in three layers parallel to the centerline of the gate the virtual particles at the left side interact with the fluid at the right side of the gate and vice versa each set of virtual particles which are fixed with respect to each other represents a virtual gate denoted as vg1 and vg2 delimiting the two regions of the channel i e the left and right sides of the gate s centerline these virtual gates are faced on the interface of the two regions identified as r1 and r2 see fig 2 the true velocity of the gate v g updates the vertical position yg of the virtual gates and r1 and r2 regions it should be noted that the fluid particles within r1 or r2 only interact with the virtual particles of vg1 or vg2 at the other side of the centerline while ignoring the fluid particles within r2 or r1 and the virtual particles of vg2 or vg1 further vg1 and vg2 neglect the presence of each other and the solid boundary particles regarding the flow properties of the virtual particles we update their pressure via the generalized wall boundary condition by adami et al 2012 smoothing the fluid particles pressure on the virtual particle as p i i j n p j w i j i j n w i j where i vg1 or vg2 and j r1 or r2 the velocity and viscosity of the virtual particles included in the continuity and momentum equations of the fluid particles need to be adjusted based on the spatial resolution and the expected initial stage of the case study e g see table 4 however they are moved with the true velocity of the gate v g hence the pressure of the virtual particles repels the fluid particles from passing the centerline to the other region and their assigned velocity and viscosity simulate the friction between the gate and the fluid particles 3 5 initial and boundary conditions the continuity equation in the ewc mps method enables assigning the initial pressure to the particles considering the theoretical solution of a problem including the initial velocity v i 0 position r i 0 and the boundary conditions the initial pressure of the fluid particles p i 0 can be calculated then the inverse form of the equation of state gives the initial particle number density of the particles through n i 0 n 0 p i 0 b 0 1 1 γ in this study we assign the initial hydrostatic pressure to the fluid particles without changing their positions subtracting the equivalent hydrostatic water pressure p pw i 0 from the total initial pressure of the mixture particles p i 0 determines the initial effective pressure of the mixture particles as p eff i 0 p i 0 p pw i 0 with the inverse form of the equation of state we assign the initial true water density of the mixture particles ρ w i 0 corresponding to the initial pore water pressure we employ the fixed dynamic boundary condition for treating the wall and ghost particles denoted as the solid boundary particles ω s based on the work of crespo et al 2015 fig 1 represents the classification of the particles including the fluid and solid boundary particles in the dynamic boundary condition implemented in this study the pressure of the closest wall particle is assigned to the ghost particles further in the governing equations of the fluid particles the velocity of the fluid particle interacting with the solid boundary is assigned to the ghost particles whereas the wall particles have zero velocity table 1 to update the particle number density of the wall particle via the continuity equation without the diffusive term the velocity of all the boundary particles remains zero for approximating the gradient of the velocity of the fluid particles v i we assign the fluid s velocity to the wall ghost particles to avoid large amounts of iie i i e i ω f j ω s and rij re v j v i in eq 24 see table 1 at the vicinity of the solid boundary or the virtual gates we assign the particle number density and a fraction of effective viscosity of the fluid particles given by γ s η i to the wall and ghost particles i e i ω f j ω s or vg1 or vg2 and rij re η j γ s η i and nj ni in eq 11 the constant and dimensionless coefficient 0 γ s 1 adjusts the friction magnitude between the fluid and wall particles based on the problem specifics furthermore the volume fraction of the fluid particles close to the solid boundaries is given to its neighbor boundary virtual gate particles i e i ω f j ω s or vg1 or vg2 and rij re ϕ j ϕ i in eq 23 regarding the particle stabilization technique the cps technique involves the solid boundary particles for determining the free surface regions and the shifting vector by assigning the particle concentration of the closest wall particle calculated like the fluid particles to the neighbor ghost particles 3 6 solution algorithm the symplectic time integration algorithm by monaghan and rafiee 2013 solves the discrete system of equations as a second order and explicit scheme see appendix b in addition to the courant friedrichs lewy stability condition the shear force due to the maximum viscosity controls the time steps of the calculation δt as follows violeau and leroy 2014 27 δ t min c c f l l 0 c 0 0 125 ρ m l 0 2 η m a x in this study we set the ccfl coefficient to 0 5 for all the simulations however for simulating the granular flows the diffusion stability condition is dominant and the maximum viscosity η max enforces the shear force condition for the numerical stability of the time integration scheme to accelerate the computations we implement the numerical model in parallel frameworks with compute unified device architecture cuda c programming language using the massive parallelism of the graphical processing unit gpu devices see appendix b for more details this speeds up simulating three dimensional problems with high shear stresses studied in the present work it should be highlighted that the developments proposed and validated in this paper are independent of the programming language and the parallel algorithms used and can be directly extended to other continuum based particle methods 4 results and discussions we implement the proposed developments in the three dimensional model of the ewc mps method to capture the complex mechanical properties of the multiphase granular flows first we validate and discuss the role of the modified diffusive term by simulating the hydrostatic pressure in a simple multiphase problem further we study the gravity driven immersed granular flows through the granular collapse and landslide benchmark cases we represent a set of experimental results for validating the granular collapse test case in the submerged conditions while for the immersed granular landslides we validate the numerical simulations by the work of pilvar et al 2019 4 1 hydrostatic pressure for two fluid phases we simulate the hydrostatic pressure in a multiphase test case krimi et al 2018 rezavand et al 2020 to show the effectiveness of the modified diffusive term in this problem a steady reservoir is filled with two inviscid and immiscible fluids as the lighter phase with the density ρ l 1000 kg m 3 is on the top of the heavier phase with the density ρ h 2000 kg m 3 ρ l ρ h 0 5 each fluid phase has 0 1 m height subjected to the constant gravitational force g 0 gy 0 where gy 9 81 m s 2 the particles are initially located on a hexagonal lattice with the spatial resolution defined as r h l 0 fig 3 the symplectic time integration scheme with ccfl 0 5 solves the governing equations for 10 seconds of simulation considering the lighter fluid as the reference phase the reference sound speed and the bulk modulus are set to c 0 10 2 g y h and b 0 ρ l c 0 2 γ respectively δ mps is set to 0 1 for all the test cases and the particle shifting technique is deactivated the initial pressure p i 0 of the fluid particles are calculated based on the initial hydrostatic condition then the inverse form of the equation of state determines the initial particle number density field n i 0 fig 3 concerning the different formulations for ψ ij in the diffusive term eq 15 we define three strategies to simulate this multiphase problem the test cases 1a 1b and 1c in table 2 the results show that the standard form of the diffusive term causes the pressure field to diverge at the free surface and the vicinity of the bottom wall fig 4 1a the kernel truncation at these regions locally manipulates the particle number density field leading to unstable pressure fields in the long term simulation of the problem further case 1a shows that this diffusive term overestimates pressure at the interface of the fluid phases by employing the convergent form of laplacian operator without the higher order gradient formulation i e with n i case 1b the particle number density field still diverges close to the bottom wall nevertheless the numerical pressure at the interface is compatible with the theoretical result and the overall pressure field becomes stable after t 3 s in case 1c the proposed diffusive term with the higher order gradient i e n c i is implemented in the convergent form of laplacian operator acting between all the fluid particles eq 19 this diffusive term solves the kernel truncation issue at the free surface and the vicinity of the wall comparing case 1b vs 1c in fig 4 exhibits the key role the first order gradient plays in the accuracy of the pressure approximation as the kernel function truncates fig 5 illustrates the uniform particle distribution and the smooth pressure field obtained by the three cases at t 10 s however implementing the standard diffusive term underestimates the pressure at the vicinity of the bottom wall in the long term simulation fig 5 1a overall the results confirm that the modified diffusive term as a function of the particle number density and without being limited to the same phase particles unlike the multiphase sph models e g sun et al 2019 estimates accurate pressure field over the fluid domain while is independent of the accuracy of the corrective matrix eq 18 at the interface of the fluid phases to quantify the improvement achieved by the modified diffusive term similar to the work of fourtakas et al 2019 we conduct the particle convergence study considering different spatial resolutions set as r 50 100 and 200 with the theoretical solution of this problem we estimate the normalized root mean square error nrmse of the pressure the magnitude of velocity and the total kinetic energy of fluid particles ek fig 6 compares the theoretical hydrostatic pressure with the extracted numerical pressure at x 0 1 m and t 10 s of the cases 1a and 1c where the errors are normalized by the maximum analytical pressure of the corresponding fluid phase although the nrmse of the model with the standard diffusive term reduces by increasing the resolution the pressure in the vicinity of the bottom wall still diverges considerably in the long term simulation as for case 1a with r 200 nrmse 1 87 however the modified diffusive term decreases the nrmse significantly by the order of one magnitude as the numerical pressure converges to the analytical pressure across the fluid phase as for case 1c with r 200 nrmse 0 154 fig 7 illustrates the velocity profile in the middle section at t 10 s and the temporal evolution of the total kinetic energy where the errors of v and ek are normalized by g y h and the total potential energy which in this problem is 45 05 j respectively the nrmse of the velocity and the total kinetic energy are negligible for both 1a and 1c cases i e nrmse 0 01 nevertheless with the modified diffusive term the velocity field convergence to the theoretical velocity of zero with fewer numerical errors it should be noted that the initial hexagonal distribution of the particles has eliminated the initial particle rearrangement and its associated noises that occur with the cartesian particle distribution in the initial time steps of the simulation see jandaghian and shakibaeinia 2020 in fig 8 we plot the nrmse of the total kinetic energy and the pressure with the different resolutions using the logarithmic scale to identify the order of convergence for the total kinetic energy the order of convergence is estimated as 1 56 and 1 69 for 1a and 1c respectively showing satisfactory results as it slightly increases with implementing the modified diffusive term the divergence of the pressure in the vicinity of the wall with the standard diffusive term affects the order of convergence of this variable as is approximately less than one i e case 1a o 0 74 whereas with the modified diffusive term i e case 1c the order of convergence increases considerably to o 1 35 confirming the effectiveness of the model in predicting accurate pressure field 4 2 immersed granular collapse the immersed granular collapse has been widely modeled for understanding the mechanical properties of the granular flows in various hydrodynamic conditions e g rondon et al 2011 balmforth and kerswell 2005 wang et al 2017 bougouin and lacaze 2018 capturing the different states of the granular flow in this problem the viscous and or inertial regimes has been a great challenge for numerical models e g baumgarten and kamrin 2019 jafari nodoushan et al 2018 savage et al 2014 wang et al 2017 lee and huang 2018 here by simulating this gravity driven test case we investigate the role of the modified diffusive term the regularized visco inertial model and the consistent effective pressure we validate the three dimensional numerical model developed in the context of the ewc mps method by the experimental results conducted and presented as a part of the present work fig 9 illustrates the initial setup and geometrical properties of the physical and numerical models we conducted the experiment in a steady and horizontal channel of the rectangular cross section wb lb with a sluice gate located at x l 0 as the gate opens with v g 1 m s in the y direction the column of the mixture collapses under the gravitational force with g 0 gy 0 and gy 9 81 m s 2 propagating on the smooth bottom wall of the channel with the aspect ratio of the granular column equal to one i e h 0 l 0 1 the final deposit is expected to form a triangular shape where the final height becomes less than the initial height rondon et al 2011 table 3 contains the material properties of the spherical glass beads with a mean diameter of 0 0008 m and ρ g 2470 kg m 3 fully submerged in ambient water with ρ 0 w 1000 k g m 3 and μ w 0 001 pa s we neglect brownian effects as the grains are large enough i e as dg 100 μm the physical properties used in the effective viscosity equation correspond to the rheology model baumgarten and kamrin 2019 validated by the experimental data we recorded the evolution of the collapse from the sidewall of the reservoir to extract the interface profiles and the spreading runout length of the granular deposit depending on the material properties of the fluid phase and the solid grains the viscous and or inertial regimes occur in the immersed granular collapse cassar et al 2005 bougouin and lacaze 2018 considering the dimensionless numbers the stokes number st here is defined as the ratio of the viscous timescale to the free fall timescale and the grain water density ratio r ρ g ρ 0 w 0 5 the immersed granular collapse in the present study falls within the viscous inertial regime as st 5 4 and r 1 6 bougouin and lacaze 2018 in the numerical model we discretize the computational domain with the initial particle distance l 0 the total particle count presented in table 4 consists of the water mixture solid boundary and virtual gates particles to ensure the incompressibility of the fluid model we set the reference sound speed to 24 m s we should note that in this problem the viscous force limits the time steps of the calculation through eq 27 as η max 1000 pa s we implement the particle packing algorithm to eliminate the noise arising from the transition of the initial cubic particle distribution to the low energy configuration similar to colagrossi et al 2012 the new position of the fluid particles are used to calculate n 0 by averaging the kernel summation over the interior fluid particles and initialize the main simulations i e apply the initial hydrostatic condition fig 9 b the virtual particle j representing the moving gate interacts with the fluid particle i within r1 or r2 regions in fig 9 b through the governing equations although the virtual particles are moved with the true velocity of the physical gate v g 1 m s their virtual velocity included in the momentum and continuity equations of the fluid particles is adjusted according to table 4 for different spatial resolutions e g with l 0 0 003 m for i vg1 or vg2 v i 0 0 0 2 0 0 also for the shear force between the fluid particles i and the virtual and wall particles j the dimensionless coefficient of the viscosity γ s is given in table 4 e g with l 0 0 003 m η j 0 2η i we extract the numerical results from the middle and sidewall sections of the channel specified in fig 9 to represent them in two dimensional x y graphs we define five different strategies for simulating the immersed granular collapse concerning the implementation of the diffusive term the effective pressure and the rheology model table 5 the test case 2a contains all the developments proposed in the present work and can be denoted as the reference numerical model in the diffusive term δ mps 0 6 for all the test cases except 2b to detect the free surface particles and for the stability of the model the cps technique is activated table 6 identifies the timesteps in which the comparison of the experimental and numerical results is carried out the nondimensional time scale t is given by t g y h 0 h 0 being the initial height of the granular column we consider the reference time t0 0 0 as the immersed granular column commences to collapse on the bottom wall of the channel shown in fig 11 while the gate is being opened and still l l 0 l is the length of granular deposit on the bottom wall in the x direction we re initialize the true density of water within the mixture particles ρ w i assuming the hydrostatic condition for the pore water pressure we represent the three dimensional configuration of the immersed granular collapse case 2a with l 0 0 003 m in fig 10 the viscosity field in the logarithmic scale and the effective pressure within the mixture particles at t4 and t6 respectively and the pressure field of the water particles at t8 see the results in the supplementary materials for movies of the experiment and the numerical simulations the physical effects of the virtual gate implemented at the initial stages of the granular flow are well illustrated in the movies also the fixed solid boundary particles include the shear force between the walls of the channel and the fluid particles in the numerical simulations this allows the 3d model to capture the effects of the reservoir s corners on the overall evolution of the granular deposit due to the confinement of the granular phase at the two corners the maximum viscosity occurs forming the curve shape surface of the mixture on the back wall also observed in the experiments fig 10 a d it should be highlighted that the two dimensional models are incapable of capturing this aspect of the granular collapse jandaghian and shakibaeinia 2019 plotting the interface profiles of the experimental results the left column of fig 11 on the sidewall sections of the numerical simulation of case 2a with l 0 0 003 m in the right column of fig 11 we compare the time evolution of the granular collapse the rapid opening of the vertical gate creates vortices suspending the solid grains in water at the initial stage fig 11 t0 this makes digitizing the interface profiles of the experiment difficult and slightly affects the deformation of the granular phase in the early stages at t2 furthermore since the virtual gate neglects the physical thickness of the gate which is 0 005 m in the experiment the shear stress causing the suspension of the grains is partially simulated via the numerical model however comparing the interface profiles in the following steps of the granular collapse shows good compatibility between the numerical and experimental results next we investigate the effect of the initial particle distance or size on the time evolutions of the mixture phase in the case of granular flows the choice of the particle distance is not only controlled by the convergence of the numerical technique but also by the validity of the continuum assumption considering the continuum assumption in the governing equations the smallest numerical elements here the particles must be much larger than the diameter of the physical elements here the solid grains and pore water guazzelli and pouliquen 2018 baveye and sposito 1984 with the particle and grain sizes being close i e l 0 dg the mixture particles would contain a limited number of solid grains violating the continuum assumption of the numerical model ghaïtanellis et al 2018 on the other hand the representative elementary volume should be much smaller than the characteristic length of the problem to mathematically represent its vicinity in the calculations baveye and sposito 1984 therefore the initial particle spacing should satisfy both conditions simultaneously otherwise either the rheology model defined for a continuous effective fluid becomes invalid or the approximation errors increase affecting the mechanical behavior of the mixture phase to determine the optimum particle size of the model we simulate the immersed granular collapse with different spatial resolutions l 0 0 004 0 0035 0 003 0 002 0 0015 m with the adjusted boundary conditions given by table 4 fig 12 compares the dimensionless interface profiles of the numerical simulations with those from the experiment at the sidewall of the reservoir at t2 t6 and the final stage the results of case 2a with l 0 0 004 and 0 0035 m show considerable incompatibilities between the numerical and experimental profiles this apparent discrepancy can be explained by the large initial particle distance with regards to the problem characteristic length which increases the approximation errors and leads to inaccurate interaction forces between the solid boundaries and fluid particles nevertheless the interface profiles with l 0 0 003 m are in good agreement with the experimental profiles whereas the case l 0 0 0015 m shows slightly more deformation of the granular collapse at t6 furthermore we plot the normalized runout distances i e l l 0 1 in the left graph of fig 13 a clear discrepancy between the experimental and numerical runout distances of the immersed granular collapse with l 0 0 004 and 0 0035 m exists while the runout lengths of cases with the smaller particle sizes particularly with l 0 0 003 and 0 002 m are consistent with the experimental measurement although the case with l 0 0 0015 m considering the adjusted boundary conditions table 4 predicts the final stage of the granular deposit it overestimates the runout length during the collapse i e t2 t t7 to quantify the accuracy of the results we compute the root mean squared error rmse of the normalized runout distances and plot them against the non dimensional ratio of l 0 dg in the right graph of fig 13 the table presented in fig 13 shows the number of solid gains that each mixture particle represents n g in 3d and the corresponding errors of the normalized runout length for coarse particle sizes i e l 0 0 004 and 0 0035 m the rms errors are considerable equal to 0 4972 and 0 1597 respectively by decreasing the particle size to 0 003 and 0 002 m the errors significantly reduce rmse 0 0509 and 0 0499 respectively confirming the good agreement between the numerical and experimental results and the convergence of the model however with the smallest particle size of l 0 0 0015 m the rmse increases to 0 0963 this illustrates that when the mixture particle contains a limited number of solid grains for l 0 1 875dg n g 8 in the 3d problem may violate the continuum assumption of the granular mass leading the rheology model to become incapable of capturing the accurate evolutions of the granular mass in this case overestimating the deformations through a similar study ghaïtanellis et al 2018 obtained equivalent outcomes showing the overestimation of sediment erosion with l 0 2dg and concluded that the minimum error is achieved by l 0 3dg that is due to the fact that with smaller particle sizes the macroscopic scale would reach the size of the discrete elements of the system and thus it would no longer be the representative elementary volume of the continuum model ghaïtanellis et al 2018 overall the interface profiles and the spreading length of the case 2a with l 0 0 003 and 0 002 m are consistent with the experimental measurements as the model predicts the evolution of the immersed granular collapse with the rmse of the normalized runout distance 0 05 accordingly we choose l 0 0 003 m where l 0 3 75dg for the following simulations of the immersed granular flows represented in this paper in table 7 we can compare the calculation time per iteration i e per time step of the simulations concerning the number of fluid particles and the different particle sizes an nvidia v100 volta gpu device is used for running the parallel part of the code written by cuda c parallel programming language see appendix b since the results in table 7 cannot be used for discussing the efficiency of the gpu implementation and also considering the scope of the current work we postpone investigating the performance analysis and the scalability of the gpu accelerated code to future works 4 2 1 role of diffusive term here we study the role of the diffusive term in simulating the immersed granular collapse the modified diffusive term included in the continuity equation presents a uniform pressure field fig 14 2a without the diffusive term the high frequency pressure noises affect the mechanical behavior of the granular collapse fig 14 case 2b this leads to unphysical deformation of the granular flow by overestimating the effective viscosity as incompatibility exists between the experimental interface profiles and the numerical results of case 2b fig 14 and fig 15 case 2b however the modified diffusive term shows a uniform viscosity field required for capturing the shear properties of the granular flow fig 15 case 2a the results emphasize implementing the diffusive term as an effective numerical correction approach for eliminating the high frequency pressure fluctuations that exist in the numerical model moreover we compare the modified diffusive term with the standard diffusive term where ψ ij nj ni i e case 2a vs case 2c we plot the mixture particles position against their total numerical pressure i e yi pi fig 16 while the standard diffusive term reduces the total pressure in the vicinity of the bottom wall the modified diffusive term eliminates the kernel truncation errors and represents a stable pressure field at the final stage of the collapse it should be noted that the standard diffusive term manipulates the pressure particularly in the vicinity of the wall and hence affects the mechanical properties of the immersed granular collapse where the effective pressure plays an essential role in the constitutive law 4 2 2 role of effective viscosity we implemented the regularized visco inertial rheology model to capture the viscous and inertial regimes of the immersed granular flows through a single formulation fig 17 indicates that the non dimensional numbers iv i and im defined in eq 5 and st i 2 iv are within the limit defined for validating the visco inertial model the viscous number remains below 0 01 value while the inertial number i is dominant in the yielded region controlling the post failure terms of the effective viscosity i e the second and third terms in the right hand side of eq 6 the range of the stokes number which varies from zero to 40 over the simulation acknowledges the visco inertial regime expected from this granular flow considering the material and flow characteristics furthermore fig 18 shows that the approximated volume fraction of the mixture particles ϕ i from eq 23 reduces at the interface applying the effects of the suspension of the solid grains in their rheology model the proposed model for the effective viscosity of the water particles eq 22 includes the turbulent properties of the fluid flow and the volume fraction of the solid grains at the interface these effects are essential to be considered in the constitutive law as the dynamic viscosity of water particles increases considerably 30 times the reference viscosity of water μ w in the highly deformed regions impacting on the mechanical behavior of the granular flow fig 18 furthermore we compare the μ iv im ϕ model with the μ i rheology validated in tajnesaie et al 2018 hosseini et al 2019 considering the same yield stress terms the inertial number of the μ i rheology is a function of the drag coefficient cd and water density i γ d g ρ 0 w c d p eff and is included in the post failure term of case 2d as follows chauchat and médale 2014 28 η i τ y i γ i 2 λ r 2 δ μ p eff i i 0 p eff i d g 2 ρ 0 w c d γ i λ r where i 0 b and cd 0 47 for i ω m the other calculation and boundary conditions of case 2d are identical to case 2a see appendix a for more details regarding the regularized μ i rheology the viscosity fields of the mixture particles in the logarithmic scale obtained via the rheology models are plotted in fig 19 thanks to the diffusive term implemented cases 2a and 2d represent smooth viscosity fields comparing the interface profiles with the experimental results shows that the μ i rheology reproduces almost similar evolution of the granular collapse this indicates that the yield stress term as a function of the effective pressure and the strain rate magnitude is dominant in the rheology of the granular collapse however the result shows that the μ i model underestimates the post failure viscosity as the granular phase collapses leading to incompatibility between the normalized runout distance of case 2d and the experimental result fig 21 while including the mixed number im and the term containing the volume fraction ϕ within the regularized visco inertial model eq 21 implemented in case 2a simulates an accurate spreading length of the granular deposit 4 2 3 role of effective pressure in the next step we evaluate the role of the consistent effective pressure in the rheology of the immersed granular collapse to do so we employ the hydrostatic assumption for the pore water pressure in test case 2e and compare the results with case 2a which contains the proposed eq 26 in case 2e with the same calculation and boundary conditions as case 2a the hydrostatic assumption calculates the pore water pressure according to the spatial position of the mixture particle and the free surface of the water phase i e p ef f i p i ρ 0 w g y h w i y i where hw i is the height of water column in which the mixture particle is located and yi is the position of the mixture particle from the bottom wall of the channel fig 20 compares the effective pressure fields of case 2a vs case 2e the results show that the consistent effective pressure by including the hydrodynamics properties of the mixture particles within the rheology model predicts accurate evolutions of the mixture phase forming the granular deposit however in case 2e the hydrostatic assumption overestimates the effective pressure at the yielded regions increasing the viscosity this may result from the low frequency oscillation of the pressure inserted in the effective pressure estimation hence the evolution of the granular collapse simulated by case 2e becomes inconsistent with the experimental results fig 20 particularly the runout distance of case 2e versus the other test cases and the experimental results confirms the overestimation of effective pressure affecting the granular flow fig 21 4 3 immersed granular landslide simulating the immersed granular landslide deals with complex mechanical behaviors concerning the mixture of solid grains and water due to the highly dynamic granular flow this characteristic of the granular landslide challenges the numerical models for capturing and predicting its evolution several experimental and numerical studies have focused on the landslides to represent a practical tool for predicting the mixture flow and generated waves e g cassar et al 2005 grilli et al 2017 pilvar et al 2019 couston et al 2015 kim et al 2019 yu and lee 2019 miller et al 2017 particle methods have been widely applied for dealing with such a problem e g tan and chen 2017 snelling et al 2020 tajnesaie et al 2018 fu and jin 2015 krimi et al 2018 capone et al 2010 manenti et al 2018 here to show the effectiveness of the proposed developments we simulate the immersed granular landslide in the three dimensional configuration via the ewc mps method we set up the numerical model based on the physical model of test case s7 in pilvar et al 2019 fig 22 in this multiphase problem the triangle heap of the solid grains with l g hg dimensions and the same material properties presented in table 3 is submerged within ambient water on an inclined plane with a slope angle of 45 degree as the physical gate is lifted with v g 1 m s the granular bulk as the mixture phase slides on the smooth wall under the gravitational forces g meanwhile the drag force induced by water suspends the solid grains forming vortices rolling the mixture phase pilvar et al 2019 with three different strategies defined in table 8 we simulate the immersed granular landslide in which the particles with the initial spacing of 0 003 m discretize the computational domain the corresponding particle count including the solid boundaries and virtual gates is 895 912 the output of the particle packing method is considered as the initial distribution of particles for calculating the averaged n 0 of the internal particles and applying the initial hydrostatic pressure fig 22 the nondimensional time scale is set to t t g y h 0 h 0 being the initial height of the granular phase from the bottom wall equal to 0 22 m we extract the numerical results from the middle and sidewall sections of the channel to validate with the experimental measurements at the time steps given in table 9 the sound speed within the bulk modulus is set to 24 m s and η max 400 pa s in all the test cases in this section we implement the cps method as the particle regularization technique and the modified diffusive term eq 19 with δ mps 0 6 in analogy to the previous test case the virtual moving particles representing the physical gate are moved with the true velocity of 1 0 m s in the y direction while their velocity parameter included in the governing equations of the fluid particles is set to 0 2v g to simulate the semi slip boundary condition we reduce the viscosity of the wall or the virtual particle j interacting with the fluid particle i to 0 1 of the effective viscosity of the fluid particle i e η j 0 1η i as if γ s 0 1 as the virtual gate is being opened and until the runout length l remains almost equal to l g i e until t0 shown in fig 23 a the model reinitializes the pore water density imposing the hydrostatic condition we represent the three dimensional results of the immersed granular landslide case 3a in fig 23 the initial stage at t0 the approximated volume fraction and the velocity of the mixture particles at t3 and t4 respectively and the final stage of the granular landslide see the supplementary results for the movies of the simulated granular slide with the free surface detection algorithm implemented as a part of the cps technique the generated wave formed by the submerged landslide is identified fig 23 b shows that the approximated volume fraction reduces at the interface due to the inter phase shear forces suspending the mixture particles and forming circulations within the fluid flow the bulk of the mixture with an average velocity of around 0 5 m s approaches the slope toe at t4 and the mixture particles come to rest on the bottom wall at t 1 49 seconds fig 23 c d however few mixture particles remain suspended within the water phase as the viscous forces damp the kinetic energy and balance their weight to validate the developed three dimensional model we extract the numerical results from a viewpoint almost identical to the position of the camera used in the experiment which is perpendicular to the sidewall and above the bottom wall of the channel we represent the evolution of the submerged granular landslide simulated by case 3a and the scaled snapshots taken from the multimedia file of the experiment provided in pilvar et al 2019 in the right and left columns of fig 24 respectively plotting the outlines of the mixture particles the continuous green lines on the corresponding snapshots of the experiment we compare the overall deformation of the landslide in the experiment as the gate opens the rapid fluid flow suspends the solid grains in the water expanding the volume of the mixture i e reducing the local mass the numerical model needs to simulate the water flow between the solid gains as a deformable porous media to capture this mixing process since the governing equations eq 11 do not simulate the mass exchange between the fluid particles the current model overlooks the volume expansion observed at the initial stages of the landslide particularly at t2 the evolution of the mixture becomes incompatible with the experimental profile this occurs as the numerical model initially overestimates the velocity of the mixture particles with the constant mass however we should note that the overall deformations of the landslide simulated by the proposed model are comparable to the experimental figures fig 24 further the results show that the constitutive laws implemented through eqs 21 and 22 indirectly include the interphase drag force creating vortices and suspending the mixture particles from the interface for t t2 fig 25 illustrates the velocity vectors representing the counterclockwise circulation of the fluid flow as the mixture particles approach the slope toe at t4 moreover we observe that the normalized runout distance of case 3a is in good agreement with the experimental measurement almost identical to the experimental profile particularly for t t6 where the main evolution of the landslide occurs fig 26 nevertheless the particles separated from the granular bulk remain suspended for t t7 while in the experiment the solid grains settle increasing the runout distance in the x direction treating the mixture as an effective fluid in the single phase formulations represented by the mixture particles might cause this discrepancy between the numerical and experimental runout distances at the late stages the non dimensional numbers governing the visco inertial model are represented in fig 27 while the viscous number remains below 0 015 the inertial number surpasses the limit suggested for the rheology model however the mixed number in the main body of the mixture phase is below its maximum limit i e i m 0 6 the local stokes number varies between 0 and 100 over the mixture phase indicating the different states of the immersed granular flow captured by the regularized visco inertial model we implement the local μ i rheology based on the inertial number given by eq 28 in case 3b and achieved almost identical results to case 3a comparing the runout distances of case 3a with 3b in fig 26 confirms that both rheology models predict the same evolution of the granular since the inertial regime is dominant in this landslide unlike the immersed granular collapse test case fig 28 shows that in regions where the separation from the granular bulk occurs the approximated volume fraction of the mixture particles reduces to almost half of the reference volume fraction of the mixture phase ϕ further considering the turbulence model within the dynamic viscosity of the water particles is shown to be effective and essential for simulating the interphase forces as η i μ w increases considerably in the region with the high strain rate magnitudes it should be noted that the free surface detection algorithm implemented within the cps technique represents the generated wave by the landslide in fig 28 at t2 t4 and t6 in test case 3c we implement the hydrostatic pore water pressure to update the effective pressure within the mixture particles the evolution of the landslide simulated by case 3a and 3c are compared in fig 29 at t3 like the granular collapse test case 2e the hydrostatic assumption in case 3c overestimates the viscosity field by neglecting the hydrodynamic aspects of the fluid flow in the case of 3a with the consistent effective pressure included in the rheology model the fluidity expected in the mixture is well captured particularly the runout length of case 3c compared with the experimental and the other test cases in fig 26 indicates the overestimation of the effective pressure via the hydrostatic assumption for the pore water pressure moreover fig 29 shows the effectiveness of the modified diffusive term for estimating a smooth pressure field i e by eliminating the high frequency pressure noises over the fluid domain 5 conclusion we represented a developed single phase particle method based on the ewc mps method capable of simulating mechanical behaviors of the immersed granular flows this multi viscosity multi density system proved to be effective and essential for simulating the interactions between water and mixture phases we developed the rheology model via the regularized visco inertial model the consistent effective pressure and higher order operators for the velocity gradient and the diffusive term in the context of multiphase problems further we included the turbulent viscosity and the linear effects of the suspension at the interface within the constitutive laws we showed the effectiveness of the modified diffusive term by predicting the hydrostatic pressure in a two dimensional steady tank filled with two fluid phases the convergence study that we conducted for this benchmark case confirmed that the modified diffusive term significantly reduces the numerical errors and increases the order of convergence of the results by eliminating the kernel truncation errors and thus predicting accurate particle number density near the boundaries we simulated the three dimensional gravity driven granular collapse and the deformable landslide to verify and validate the multiphase model the results represented the capability of the proposed developments in capturing the complex flow deformation including the viscous and inertial regimes further the modified diffusive term proved to be essential for removing the noisy pressure field and obtain an accurate viscosity prediction the regularized visco inertial rheology model consists of non dimensional numbers and the approximated volume fraction of the mixture particles simulated the time evolution and the dominant flow regimes of the immersed granular problems furthermore utilizing the proposed constitutive relation for calculating the pore water pressure not only exempts the model from the complexity of detecting the interface but also results in an accurate and stable viscosity field although the single phase and continuum based model is still incapable of modeling the fluid flow between the solid grains the developed model represents promising outcomes in simulating the suspension process and forming the flow circulations within the mixture and water phases overall the compatibility between the numerical results and the presented experimental measurements confirmed the robustness of the proposed developments for studying the underlying physics of the immersed granular flows the model we have developed in this study can be employed for validating the generated waves by the transitional and submerged landslides in large scale problems this may require conducting three dimensional experiments of the granular flows in various hydrodynamic conditions and with different granular materials e g kim et al 2019 miller et al 2017 it is also worthwhile to investigate the convergence of the modified diffusive term for high density ratio fluid flows and evaluate the gpu implementations for simulating large scale 3d problems moreover the non local rheology models kamrin 2019 can be coupled with the governing equations to study the nonlocal effects of the granular shear properties in the multiphase flows meanwhile the ewc mps method of this work can be extensible to the two phase mixture models baumgarten and kamrin 2019 shi et al 2019 capable of simulating the fluid flow through the solid grains to include the role of saturation degree in the rheology model credit authorship contribution statement mojtaba jandaghian conceptualization methodology software data curtion visualization formal analysis investigation writing original draft abdelkader krimi methodology data curtion writing review editing ahmad shakibaeinia supervision conceptualization methodology data curation investigation writing review editing funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment the authors would like to thank the anonymous reviewers for their valuable comments and suggestions that truly improved the accuracy and quality of the representation of the results this research utilized the high performance computing resources of computecanada and calculquebec canada financial support of this research was provided by the natural sciences and engineering research council of canada nserc and polytechnique montréal canada also the authors would like to acknowledge nvidia united states for supporting this research through their gpu grant program supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2021 103908 appendix c supplementary materials movie 1 a movie from the experiment of the immersed granular collapse image video 1 movie 2 the velocity field of the 3d immersed granular collapse simulated with the different particle sizes image video 2 movie 3 the approximated volume fraction left and the pressure field right of the 3d immersed granular collapse image video 3 movie 4 the approximated volume fraction left and the velocity field right of the 3d immersed granular slide image video 4 appendix a derivation of the regularized rheology equations here we derive the regularized constitutive equations of the visco inertial rheology μ iv im ϕ and the μ i rheology used in the simulations in the form of eqs 21 and 28 respectively both rheology models diverge as the magnitude of the strain rate tensor vanishes i e γ 0 the regularization techniques have been represented to resolve this singularity issue in the computational models see chauchat and médale 2014 for the visco inertial rheology eq 6 we employ eq 7 to write the effective viscosity of the mixture phase η m as follows a 1 η m μ 1 p g γ δ μ p g b i m γ γ 5 ϕ 2 a i v p g i m γ which contains the yield stress the first term on the right hand side denoted as term 1 and the post failure the second and third terms denoted as term 2 and 3 terms in our proposed rheology model the bercovier and engelman 1980 formulation regularizes the yield stress term given as a 2 term 1 τ y γ 2 λ r 2 in which τ y μ1 pg and λ r being the regularization parameter set as λ r 1 with inserting the non dimensional numbers 5 and some mathematical simplifications we can rewrite the second term as a 3 term 2 δ μ p g b p g d g 2 ρ g 2 μ w γ γ using the simple model for the regularization represented in frigaard and nouar 2005 of the 2 μ f γ term and by noting that pg 0 the second term reduces to a 4 term 2 δ μ p g b p g d g 2 ρ g 2 μ w γ λ r γ the third term by substituting the non dimensional numbers 5 into the equation is given as follows a 5 term 3 5 ϕ 2 a μ w p g γ 2 d g 2 ρ g 2 μ w γ and considering the bercovier and engelman 1980 regularization equation reads a 6 term 3 5 ϕ 2 a μ w p g γ 2 d g 2 ρ g 2 μ w γ λ r 2 eventually substituting the terms a 2 a 4 and a 6 into eq a 1 the regularized visco inertial model would be the following equation a 7 η m τ y γ 2 λ r 2 δ μ p g b p g d g 2 ρ g 2 μ w γ λ r γ 5 ϕ 2 a μ w p g γ 2 d g 2 ρ g 2 μ w γ λ r 2 used as eq 21 in the numerical model for the μ i rheology model proposed by jop et al 2006 as a 8 μ i μ 1 δ μ i 0 i 1 the effective dynamic viscosity of the mixture phase given by eq 7 would be a 9 η m μ i p g γ μ 1 p g γ δ μ p g i 0 i γ γ where the yield stress term can be regularized similar to eq a 2 by substituting the inertial number of the immersed granular flows i e i γ d g ρ 0 w c d p eff tajnesaie et al 2018 cassar et al 2005 and the simple model for regularizing the post failure term the regularized μ i rheology equation is represented as follows chauchat and médale 2014 a 10 η m τ y γ 2 λ r 2 δ μ p g i 0 p g d g 2 ρ 0 w c d γ λ r which in the numerical model is implemented as eq 28 appendix b the solution algorithm based on the symplectic scheme in this paper we employed the explicit second order symplectic scheme represented by monaghan and rafiee 2013 as the time integration algorithm this time integrator solves the governing equations and applies the boundary conditions in two stages of calculations identified in fig b 1 the first stage calculates the flow properties at the mid point t δt 2 with the mid point values the second stage updates the velocity field and therefore the position and the particle number density fields at t δt in this stage the divergence of the velocity eq 13 and the modified diffusive term eq 19 are functions of the particle number density at the mid point i e n t δt 2 the numerical model consists of subroutines run on the computer processing unit cpu or the graphical processing unit gpu as the host and device parts of the code respectively we adopted cuda c as the parallel programming language to utilize the massive parallelism of the gpu s threads the host section of the code initializes the model i e allocates memories reads the geometry file and transfers data from the host to the gpu s memories and saves the data for the post processing tasks the device section implements the neighbor search algorithm see shakibaeinia and jin 2010 and the main temporal loop of solving the governing equations i e eq 11 and 12 supplied with the modified diffusive term eq 20 and the corrected particle shifting technique see jandaghian and shakibaeinia 2020 fig b 1 in the temporal loop of the calculation the viscosity field η i is calculated at the beginning of the first and second half of each time step moreover the particle stabilization technique only regulates the fluid particles in the second stage of the scheme in advance of estimating the particle number density field also the properties of the solid boundary and the virtual gates are updated at the end of each stage of the scheme 
306,we develop and validate a three dimensional particle method based on an enhanced weakly compressible mps approach for modeling immersed dense granular flows for this purpose we adopt a generalized rheological model using a regularized visco inertial rheology for all regimes of multiphase granular flow moreover we propose a new consistent formulation to estimate the effective pressure of the solid skeleton based on the continuity equation of the pore water to improve the accuracy of the multiphase particle methods especially near boundaries and interfaces we introduce a modified high order diffusive term by employing the convergent form of the laplacian operator the effectiveness of the new diffusive term is particularly demonstrated by modeling the hydrostatic pressure of two fluid phases further coupling the generalized rheology model with the flow equations we investigate the gravity driven granular flows in the immersed granular collapse and slide in three dimensions as a part of this study we represent the experiment on the immersed granular collapse to validate the model the evolution and runout length of the granular bulk are compared with those from experiments confirming good compatibility overall the qualitative and quantitative results justify the proposed developments shown to be essential for predicting different states of the immersed granular flows graphical abstract image graphical abstract keywords meshfree particle methods weakly compressible moving particle semi implicit method wc mps multiphase flows dense granular flows 1 introduction multiphase flow of solid grains interacting with fluid exists in many hydro environmental systems such as sediment erosions debris flows and submarine avalanches guazzelli and pouliquen 2018 mahdi et al 2019 these so called multiphase granular flows can have devastating socio economic impacts fritz et al 2009 tan and chen 2017 the experimental measurements and numerical models are the engineers tools to understand the complex physics of these problems to optimize the engineering designs and mitigate related hazards the numerical models have advantages in eliminating the expenses and surmounting the limits of the experimental researches however dealing with the highly dynamic interfacial flows including mixing processes of the solid grains and fluid phase requires advanced rheology models and numerical developments guazzelli and pouliquen 2018 baumgarten and kamrin 2019 the conventional mesh based eulerian approaches struggle to simulate the complicated deformations and fragmentations of interfacial flows yan et al 2020 rycroft et al 2020 meanwhile mesh free lagrangian methods have been shown to be effective for simulating such problems including complex interactions of fluids and sediments e g canelas et al 2016 harada et al 2017 li et al 2019 kazemi et al 2020 xu et al 2020 discrete based mesh free models e g the discrete element method are known to be accurate models for in depth analysis while are computationally expensive baumgarten and kamrin 2019 in contrast the continuum based mesh free particle methods at the macroscopic level or simply particle methods such as moving particle semi implicit mps and smoothed particle hydrodynamic sph methods homogenize the bulk volume of the mixture into moving particles being scalable and hence more computationally affordable in these models the lagrangian form of governing equations coupled with the constitutive laws calculates the interaction forces as the moving particles are the material points simulating the advection process particle methods due to their lagrangian nature have demonstrated promising capabilities in solving scientific and engineering problems gotoh and khayyer 2016 sph and mps as the two most popular particle methods initially proposed by gingold and monaghan 1977 and koshizuka and oka 1996 koshizuka et al 1998 respectively have been widely applied and developed for simulating complex fluid flow targeting hydro environmental problems e g harada et al 2017 kazemi et al 2020 snelling et al 2020 khayyer et al 2019 robb et al 2016 amaro et al 2020 these methods share many algorithms and techniques and produce similar results in many cases amaro et al 2020 souto iglesias et al 2013 however mps as a kernel derivative free method has more flexibility in the choice of the kernel function and resolves the instability issues that arise from the derivative of the kernel function in the inter particle force terms of the original sph formulations swegle et al 1995 monaghan 2000 furthermore mps uses the non dimensional particle number density as a substitute for the real density which naturally addresses the density discontinuities at the phase interfaces of multiphase simulations hu and adams 2006 shakibaeinia and jin 2010 proposed the weakly compressible version of the mps method denoted as wc mps by solving the equation of state instead of the poisson equation for updating the pressure field they have extended and validated the wc mps method for incompressible and multiphase problems in various hydrodynamic conditions shakibaeinia and jin 2012 shakibaeinia and jin 2011 shakibaeinia and jin 2012 furthermore this method has been the focus of many research studies for simulating complex flows e g xu and jin 2016 wang et al 2019 ye et al 2020 zheng et al 2020 and specifically developed for the dry and saturated granular flows e g ke et al 2020 tajnesaie et al 2018 nodoushan and shakibaeinia 2018 xu et al 2017 fu and jin 2015 jandaghian and shakibaeinia 2020 enhanced the wc mps method by introducing a conservative system of equations supplied with the diffusive term and the corrected particle shifting technique recently jandaghian et al 2021 developed the particle regularization techniques of this so called enhanced wc mps ewc mps model for capturing the non linear behavior of violent free surface problems in this study the ewc mps method is coupled with the rheological models and further improved and validated for simulating the multiphase granular flows many empirical and numerical studies have been devoted to introducing general and reliable constitutive equations for capturing the different regimes of the granular flows i e the free fall inertial and viscous regimes guazzelli and pouliquen 2018 jop et al 2006 e g baumgarten and kamrin 2019 midi 2004 amarsid et al 2017 particularly for the immersed and dense granular flows representing a versatile model for understanding the underlying physics of the mixture is more challenging since both inertial and viscous regimes may control the mechanical behavior of the flow amarsid et al 2017 furthermore in these rheology models an accurate estimation of the normal stress i e the effective pressure within the solid skeleton is essential for detecting the yielded and non yielded flow regions with this regard the commonly used hydrostatic assumption for calculating the pore water pressure includes the complexity and limitations of detecting interfaces and ignores the hydrodynamic aspects of the granular flows in the rheology equation moreover the unphysical pressure noises as the common problem of particle methods antuono et al 2010 arising from the numerical and approximation errors can significantly affect the accuracy of the results resolving these modeling issues requires developing a unified framework for the immersed granular flow rheology model e g baumgarten and kamrin 2019 amarsid et al 2017 boyer et al 2011 and implementing higher order operators e g xu and jin 2016 antuono et al 2010 the particle regularization techniques e g sun et al 2017 krimi et al 2020 and the artificial diffusive terms e g antuono et al 2010 monaghan 1992 for ensuring the stability and accuracy of the numerical simulations the rheology models in the continuum based methods consider non newtonian behaviors for the dense granular flows guazzelli and pouliquen 2018 bingham types viscoplastic models the bingham plastic and the herschel bulkley models have been frequently utilized and validated in particle methods e g shakibaeinia and jin 2012 manenti et al 2012 fourtakas and rogers 2016 zubeldia et al 2018 krimi et al 2018 more recently the local μ i rheology proposed by jop et al 2006 and forterre and pouliquen 2008 as a function of the flow and material properties has drawn attention for the dry and submerged problems e g ke et al 2020 tajnesaie et al 2018 chauchat and médale 2014 for immersed conditions of the dense granular flows different non newtonian models are developed according to the experimental and numerical results e g see amarsid et al 2017 boyer et al 2011 cassar et al 2005 stickel and powell 2005 guazzelli and pouliquen 2018 presented a comprehensive review of the rheology of concentrated granular suspensions regarding the immersed granular flow in the low stokes limit boyer et al 2011 conducted a series of pressure imposed shearing experiments to represent unified rheology amarsid et al 2017 with some dimensional analysis and simulating the inertial and viscous regimes of the mixture by a coupled molecular dynamics lattice boltzmann method introduced a unified rheology model for capturing the dry and immersed granular flows baumgarten and kamrin 2019 combined the former models in a single formulation to simulate the granular flows using a two phase model in the context of particle methods rodriguez paz and bonet 2004 employed the generalized visco plastic fluid gvf model proposed by chen and ling 1996 as a semiempirical model to calculate the total shear stress of the debris flow with a corrected sph method hosseini et al 2007 modeled single phase non newtonian fluid flows using the power law bingham plastic and herschel bulkley constitutive models with an explicit sph approach nabian mohammad and farhadi 2017 utilized the bingham and the gvf rheological models to simulate the granular multiphase flows in an incompressible mps scheme to eliminate the numerical problem of pressure dependent erosion at the interface khanpour et al 2016 and zubeldia et al 2018 employed the shields criterion in the weakly compressible sph framework to determine the sediment erosion threshold while the constitutive model determines the effective viscosity of the sublayer sediment phase based on bingham viscoplastic models in the wc mps framework shakibaeinia and jin 2011 simulated the two phase mobile bed dam break shakibaeinia and jin 2012 including the non linear behavior of the granular material by the gvf model jafari nodoushan et al 2018 employed the regularized form of the local μ i rheology to model the submerged and dry granular collapses further tajnesaie et al 2018 developed the same model to simulate the granular landslide in a two dimensional configuration and compared the results with the heschel bulkley model recently ke et al 2020 investigated the role of the μ i rheology for the dry granular slide and dam break via the standard wc mps method the sediment rheology model is pressure dependent and requires determining the granular effective pressure within the mixture phase for calculating the effective viscosity the two phase mixture models which solve separate sets of equations for each granular and fluid phase calculate the effective pressure within the solid phase directly e g baumgarten and kamrin 2019 pahar and dhar 2017 bui and nguyen 2017 however the single phase multi density multi viscosity models require a supplementary approach to estimate the pore water pressure of the mixture phase in particle methods different approaches are proposed for determining the effective pressure within the granular material the majority of the sph and mps models e g manenti et al 2012 nabian mohammad and farhadi 2017 jafari nodoushan et al 2018 bui and fukagawa 2013 assume the lithostatic condition for the fluid and or sediment phases to predict the pore water pressure neglecting the hydrodynamics of the mixture flow ghaïtanellis et al 2018 appended an additional equation to the sediment model to calculate the soil skeleton stress independently via solving the laplacian of the effective pressure accompanied by the boundary conditions of the model in general these approaches involve the free surface and interface detections limiting the capability of the particle method for dealing with highly deformed multiphase flows to avoid this issue fourtakas and rogers 2016 and zubeldia et al 2018 employed a modified equation of state eos of the wc sph model by using the density of the saturated sediment to estimate the pore water pressure however since their model considers different reference pressure within the eos for the total and pore water pressure the pressure oscillations due to the slight compressibility affect the sediment model overestimating the viscosity for the submerged conditions ghaïtanellis et al 2018 since in the mps sph methods the kernel truncates at the free surface of the fluid and in the vicinity of the solid boundary the standard diffusive term added to the continuity equation diverges the density field this leads to unphysical pressure prediction affecting the overall mechanical behavior of the fluid flow particularly in the long term simulations in the case of granular flows where the constitutive equation and yield flow behavior are highly sensitive to the pressure field and its vibrations such unphysical divergence can largely affect the results in general by adding a numerical diffusion term to the continuity equation e g in the δ sph antuono et al 2010 molteni and colagrossi 2009 and the ewc mps methods jandaghian and shakibaeinia 2020 the high frequency pressure fluctuations have been eliminated however dealing with the density discontinuity at the interfaces of multiphase problems still requires special treatments to overcome these numerical issues sun et al 2019 applied the diffusive term by the convergent form of the laplacian operator originally proposed by antuono et al 2010 for the single fluid phase problems for the multiphase problems restricting the diffusive term between the fluid particles within the same phase in this case the renormalization matrix and the first order density gradient operators are also limited to the same phase particles similarly zheng and chen 2019 proposed the convergent formulation for the diffusive term in the multiphase sph model employing the oscillation of density increment instead of the density variable krimi et al 2018 proposed another form of the diffusive term for the multiphase wc sph method for dealing with the density discontinuity at the interface however the proposed term violates the mass conservation and ignores the higher order spatial terms required for reducing the kernel truncation errors at the free surface and in the vicinity of the solid boundary fourtakas et al 2019 introduced a new form of the diffusive term for the single fluid phase problems by substituting the dynamic density with the total density in the original formulation of molteni and colagrossi 2009 they showed that the new diffusive term by removing the hydrostatic density from the total density improves the pressure estimation close to the boundaries only for problems where the gravitational force is dominant fourtakas et al 2019 nevertheless it should be noted that the proposed diffusive term unlike the diffusive term proposed by antuono et al 2010 with the higher order gradient violates the conservation of mass considering that it is not an antisymmetric equation see antuono et al 2012 in this paper we aim to develop a robust and accurate ewc mps method for predicting the evolution of the immersed granular flows concerning its different regimes this model benefits from the enhancement techniques required for the stability and accuracy of such fluid flow besides the particle number density updated via the continuity and diffusive equations deals with the density discontinuity issues which affect the pressure field here we extend the developments to three dimensional and multiphase problems developing a generalized rheology model we adopt and regularize the visco inertial rheology model to capture the inertial and viscous regimes through a single formulation moreover based on the continuity equation of the pore water phase as a barotropic fluid we propose a consistent formulation to eliminate the complexity for detecting the interface meanwhile include the dynamics of the fluid flow within the effective pressure estimation in the proposed model we implement the sub particle scale sps turbulent model for the fluid phase and the higher order velocity gradient operator to improve the accuracy of the numerical model we modify the diffusive term in the context of mps for dealing with multiphase problems including the pressure dependent shear models the new diffusive term aims to alleviate the kernel truncation and density discontinuity issues of the multiphase problems and remove the unphysical pressure noises to include the physical effects of the removable gate in the initial stage of the fluid flow we implement virtual gates imposing the shear and pressure interactions first a simple hydrostatic pressure is modeled to show the effectiveness of the modified diffusive term further we simulate and validate challenging benchmark cases of the granular flows the immersed granular collapse and landslide the mixture behavior in the former is identified by the viscous and inertial regimes whilst in the latter the inertial regime is dominant due to the extreme flow deformation to validate the immersed granular collapse we conduct a complementary experiment representing the evolution and runout length of the deposit the submerged and deformable landslide is validated by the available experimental results we investigate and fully characterize the flow regimes of these problems and evaluate the effectiveness of the proposed developments for capturing the complex mechanical behavior of such multiphase flows 2 governing equations and constitutive laws 2 1 basic assumptions the immersed granular flows consist of a mixture of solid grains and viscous fluid i e water in this study the mixture of solid grains and interstitial pore water is considered as a single continuum further the constitutive laws represent the ambient water ω w as a newtonian and the mixture ω m as non newtonian fluid phases see fig 1 the mathematical models correspond to the mechanical behavior of the fluid phases and their interactions based on the following assumptions we derive the generic mathematical and numerical frameworks of the fluid domain i the mixture of solid grains and water is a non colloidal and non brownian suspension ii the water and mixture phases are barotropic fluids iii no mass exchange and heat transfer occur between the fluid phases iv terzaghi s stress principle specifies the effective pressure of the sediment skeleton with the first assumption we employ the local rheology model that characterizes the granular flow with the volume fraction of the solid grains and the bulk friction coefficient considering the gravitational and shear forces baumgarten and kamrin 2019 amarsid et al 2017 the second assumption allows the mathematical model to update the pressure of the fluid phases as a function of the density variations baumgarten and kamrin 2019 considering the third assumption and neglecting the compressibility of the pore water and the solid skeleton of the grains signify that the volume fraction of the granular phase remains invariant further the single phase and continuum based models ignore the relative velocity between the interstitial fluid and solid grain the fourth assumption is used to estimate the normal stress between the solid grains required for the rheological properties of the mixture in this paper the subscripts w g m f and pw denote the flow and material properties of water the solid grains the mixture of solid grains and water the overall fluid domain as the union of the water and mixture phases i e ω f ω w ω m and the pore water respectively see fig 1 also 0 as a superscript or subscript of the flow properties stands for the initial condition or the reference values 2 2 flow equations the navier stokes governing equations in the lagrangian framework describe the continuum flows as panton 2013 1 d ρ dt ρ v ρ d v dt p τ ρ f d r dt v in which the pressure the shear and the body forces per unit volume p τ and ρf respectively determine the acceleration d v d t of a fluid with a density of ρ the velocity vector and its divergence i e v and v the mass volume expansion rate updates the position r and the rate of change of the density d ρ d t respectively in the weakly compressible fluid models the equation of state as a function of the material density calculates the mechanical pressure i e p f ρ the rheology models account for the viscous forces within the multiphase fluid flows the general form of the rheology models considers the shear stress as a linear or non linear function of the strain rate tensor e and its principal invariants the first second and third principal invariants ie v 0 i i e 1 2 e e and iiie respectively based on the reiner rivlin equation for an incompressible mixture flow chen and ling 1996 assuming the shear stress independent of iiie and e 2 terms represents the shear stress tensor as follows chen and ling 1996 2 τ e 2 η e where η is the effective or apparent dynamic viscosity of the fluid phase this effective viscosity includes the shear behaviors of the fluid flow considering the rate of deformation and the material and hydrodynamic properties for both newtonian and non newtonian fluids the incompressibility assumption i e v 0 sets e equal to the deviatoric part of the rate of deformation e where e 0 5 v v t and the superscript t stands for the transpose of the matrix in the momentum equation the divergence of the shear stress includes the viscous forces through the system of equations 1 considering the incompressibility condition and neglecting the gradient of dynamic viscosity over the domain i e η 0 even at the interfaces simplifies the viscous force to shakibaeinia and jin 2011 tajnesaie et al 2018 3 τ η 2 v this force stands for the shear behaviors of both newtonian and non newtonian fluids for newtonian and incompressible fluids a linear relationship exists between its true viscosity and the strain rate tensor in the case of the granular flows the solid grains immersed in newtonian fluids like water with the true viscosity of μ w increases the viscosity of the fluid as μ w 1 5 2ϕ by the volume fraction ϕ guazzelli and pouliquen 2018 baumgarten and kamrin 2019 moreover the turbulence eddy viscosity ν t based on the large eddy simulation model lo and shao 2002 can be added to include the turbulence effects within the effective dynamic viscosity of the water as follows 4 η w μ w 1 5 2 ϕ ρ w ν t we calculate the turbulence eddy viscosity with ν t c s δ l 2 4 i i e in which δl is the mixing length and the smagorinsky coefficient cs is set to 0 12 for non newtonian fluids ideally the rheology model should be capable of capturing the mechanical behaviors such as the shear thinning the shear thickening and the flow threshold the experimental studies show that granular flows contain these non linear behaviors stickel and powell 2005 accordingly the continuum based models consider the granular flows as non newtonian and incompressible fluids where the rheology model includes their shear behaviors through the effective viscosity 2 3 a regularized visco inertial model here we employ the rheology model proposed by baumgarten and kamrin 2019 combining boyer et al 2011 and amarsid et al 2017 models to simulate the viscous and inertial regimes of the granular flows within a single formulation as analyzed by amarsid et al 2017 in this model the non dimensional numbers controlling the flow behaviors are the inertial number i the viscous number iv and the mixed number im defined as follows 5 i m i 2 2 i v i γ d g ρ g p g i v μ w γ p g where dg and ρ g are the mean diameter and the true density of the solid grains respectively the normal stress between the solid grains pg is the effective pressure of the solid skeleton p eff in the immersed condition the magnitude of the shear rate γ is equal to 4 i i e for an incompressible fluid the general form of the viscosity model hereinafter denoted as the visco inertial model is given by baumgarten and kamrin 2019 6 μ i v i m ϕ μ 1 δ μ b i m 1 5 2 ϕ i v a i m in which δμ μ2 μ1 and ϕ is the volume fraction of the solid grains the material parameters a and b including the upper and lower limits of the friction coefficient μ2 and μ1 respectively can be specified by fitting the numerical and experimental results in the steady state shearing flows baumgarten and kamrin 2019 in the context of this model the stokes number defined as st i 2 iv determines the regimes of the granular flows if st the inertial number is dominant i e im i and by setting b i 0 and μ f 0 eq 6 reproduces the μ i rheology implemented for the dry granular flows i 0 being an empirical coefficient of the rheology baumgarten and kamrin 2019 showed that for st 0 where i m 2 i v eq 6 fits with the data collected from the viscosity models and experimental measurements represented by chang and powell 1994 stickel and powell 2005 and boyer et al 2011 for the inertial and viscous regimes these empirical models govern the dense granular flows suggesting i 0 2 i v 0 1 i m 0 6 and 0 st conditions baumgarten and kamrin 2019 considering the visco inertial model the effective viscosity for the incompressible mixture η m forms to 7 η m μ i v i m ϕ p g γ to use eq 7 within the viscous force 3 the singularity issue as γ 0 should be resolved by employing the regularization techniques chauchat and médale 2014 here we utilize a combination of the bercovier and engelman 1980 regularization formulation and the simple regularization model represented by frigaard and nouar 2005 within the term containing the yield stress τ y μ1 pg and the post failure terms i e the second and third terms on the right hand side of eq 6 therefore by substituting the dimensionless numbers 5 into μ iv im ϕ we obtain the effective viscosity formulation as follows 8 η m τ y γ 2 λ r 2 δ μ p g b p g d g 2 ρ g 2 μ w γ λ r γ 5 ϕ 2 a μ w p g γ 2 d g 2 ρ g 2 μ w γ λ r 2 in which the regularization parameter λ r is a small value to avoid the singularity and the normal stress is assumed to remain positive over the mixture phase i e λ r 1 and pg 0 see appendix a to specify the yield stress for the non cohesive granular material with the internal friction angle θ we employ the drucker prager yield criteria as τ y μ 1 p g 2 3 sin θ p g 3 sin θ in eq 8 unlike the bingham types and the generalized viscoplastic models the post failure terms contain the material and flow properties within a single formulation for the dry and immersed conditions moreover when γ is strictly zero the regularized effective viscosity is definite unlike the papanastasiou regularization technique chauchat and médale 2014 and no further consideration is required 2 4 consistent effective pressure for the immersed granular flows the effective pressure of the sediment skeleton plays a key role in the constitutive model eq 8 to capture the mechanical behavior of the highly dynamic multiphase granular flows the rheology model should predict a dynamic pore water pressure applying the lithostatic condition not only requires detecting the interfaces beforehand but also ignores the dynamics of the mixture s motion for estimating the effective pressure this has limited the capability of the well developed particle methods e g tajnesaie et al 2018 ghaïtanellis et al 2018 jandaghian and shakibaeinia 2019 amicarelli et al 2017 for dealing with highly deformed interfaces in the immersed granular flows here we propose a consistent approach based on the mass conservation law of the pore water within the mixture phase to calculate the effective pressure dynamically for this purpose we employ the main assumptions already considered in the single phase continuum based models for the fully submerged granular flows the assumptions i iv in section 2 1 the continuity equation governing the partial density of the pore water ρ p w 1 ϕ ρ w is given as 9 1 ρ p w d w ρ p w d t 1 v m d w v m d t 0 where d w d t is the material time derivative on the water phase bandara and soga 2015 the second term of this equation stands for the rate of volume expansion and can be substituted by the divergence of the velocity field v pw as vm being the volume of the material particle eq 9 specifies the evolution of the true water density of the mixture phase ρ w as a barotropic fluid for calculating the pore water pressure baumgarten and kamrin 2019 since the single phase models treat the mixture of grains and pore water as a single continuum the fluid flow within the solid skeleton is neglected accordingly we can assume that the volume fraction remains invariant i e ϕ constant and the pore water phase follows the same velocity and position as the mixture phase i e v pw v and d w d t d d t therefore we summarize the general form of the constitutive relation for the pore water pressure within the immersed granular phase as follows 10 1 ρ w d ρ w dt 1 v m d v m dt 0 p pw f ρ w by solving eq 10 we supply the continuum based model with a direct method to update the pore water pressure field within the mixture phase without the need for detecting interfaces with the initial hydrostatic condition for the density and pressure fields the spatial divergence of the velocity field v determines the evolution of ρ w eventually terzaghi s effective stress and the equation of state for the mixture and pore water phases determine the effective pressure p eff p ppw it should be highlighted that the rheology model only utilizes the effective pressure to calculate the effective viscosity and the mixture inertial numbers through eq 8 meanwhile the velocity field of the mixture phase v along with the bulk properties of the fluid flow p and ρ are calculated via the system of equations represented as the multiphase model in eq 1 3 numerical model 3 1 the discrete system the continuum based models homogenize the representative volume of the water and solid grains into continuous fluid phases the approximation procedure of the particle methods discretizes the fluid domain into moving calculation points carrying the material and flow properties fig 1 the approximation operator for the quantities and derivatives of the flow variables represents the discretize particle system koshizuka et al 2018 liu and liu 2003 in the conservative wc mps method jandaghian and shakibaeinia 2020 the right hand sides of the differential equations 1 are approximated for a generic particle i as follows 11 d n i dt n i v i ρ i d v i dt p i η 2 v i ρ i f i d r i dt v i where the particle number density ni is updated via the continuity equation and η is the dynamic viscosity the density of particles is constant in the momentum equation ρ i ρ0i the true density of fluid particles while the pressure is updated by the equation of state given as 12 p i b 0 n i n 0 γ 1 where γ 7 shakibaeinia and jin 2010 for the multiphase fluid flows the fluid bulk modulus b 0 is set to be identical over the domain as b 0 c 0 2 ρ 0 γ where c 0 and ρ0 are the artificial sound speed and the true density of the reference fluid phase respectively colagrossi and landrini 2003 with c 0 10 v max where v max is the maximum expected velocity of the problem the mach number remains less than 0 1 limiting the compressibility of the fluid to 1 it is worthy to mention that this mps method for multiphase fluid flows resolves the discontinuity issue occurring at the interfaces via using the particle number density as the substitute for the density variable like hu and adams 2006 and the identical bulk modulus for all the fluid phases in the approximation procedure the kernel function w smooths the differential operators of eq 11 over the particles fig 1 the normalization factor n 0 as a constant value over the computational domain is the kernel summation of the fluid particles over their neighbor particles n at the initial state of particles l 0 and away from boundaries i e n 0 i j n w r i j r e at t 0 as rij r j r i re and re being the influence radius of the kernel function set to 3 1l 0 with considering the conjugate form of the gradient and divergence operators in the context of mps formulations we derive the approximation operators of the fluid flow variables as follows 13 v i d n 0 i j n n j n i v ij r ij e ij w ij p i d n 0 i j n n i p j n j n j p i n i e ij r ij w ij η 2 v i 2 d n 0 i j n η ij v ij r ij 2 w ij in which wij w rij re and d 1 2 3 is the number of space dimensions the rational kernel function koshizuka et al 1998 is used in all the simulations the pressure force vectors lie on the unit direction vectors between particle i and j e ij r ij rij conserving the linear and angular momentum of the system while laplacian of the velocity vector with the direction of v ij v j v i only conserves the linear momentum one should note that in the absence of shear stresses and external forces the approximated form of the governing equations conserves the total energy of the system e i e d e d t 0 0 in our model the harmonic mean determines the effective dynamic viscosity acting between particles i and j as η ij 2η i η j η i η j shakibaeinia and jin 2012 to ensure the numerical stability and eliminate the particle clustering i e the tensile instability we implement the corrected particle shifting algorithm the cps technique proposed in the ewc mps method jandaghian and shakibaeinia 2020 regularizing their position vector by the corrected particle shifting vector δr i as r i r i δ r i the proposed cps is applicable to the three dimensional problems without any adjustment regarding the implemented free surface detection algorithm and the interface treatments this approach utilizes the summation of the kernel function i e the particle concentration defined as i j n w i j n 0 and hence acts independently from the material properties of the fluid phases in the multiphase problems in this study the particle shifting coefficient is set to 0 04 l 0 2 further we limit the magnitude of the shifting vector as δr i min 0 25 v i δt 0 2l 0 δr i δr i δr i to reduce the energy manipulation that may occur by the convection of material and flow properties of the fluid particles where the potential energy is dominant 3 2 modified diffusive term jandaghian and shakibaeinia 2020 introduced the diffusive term in the wc mps method to eliminate high frequency pressure fluctuations by adding the diffusive term di to the right hand side of the continuity equation this numerical correction has proved to be effective and essential for obtaining a smooth pressure field in particle methods e g jandaghian and shakibaeinia 2020 molteni and colagrossi 2009 nevertheless the standard form of the diffusive terms proposed by molteni and colagrossi 2009 for wc sph and jandaghian and shakibaeinia 2020 for wc mps unphysically diverges the pressure field at the free surface as the kernel function truncates antuono et al 2010 the same issue exists in the vicinity of the solid boundary particles where the inner product of the normal vector to the solid wall and the gravitational force is non zero i e n s g 0 in this case the density of the fluid particles close to the solid boundary particles decreases affecting the overall pressure field in the long term simulations this divergence occurs as the solid boundary particles are excluded from the diffusive term of the fluid particles required for conserving the total mass of the fluid phase particularly for problems where the mechanical behavior of the fluid flow depends on the pressure parameter implementing a convergent diffusive term over the fluid domain becomes essential e g for calculating the effective viscosity of the sediment phase in this study moreover in the multiphase problems the diffusive term as a function of the density in the standard delta sph requires special treatment at the interface of the fluid phases due to the discontinuity of the density field by only applying the diffusive term among the same phase particles e g in fourtakas and rogers 2016 sun et al 2019 the kernel function truncates at the interface diverging the density field although the higher order gradient formulation reduces the associated errors for highly deformable interfacial flows this is still incompetent here we represent a modified diffusive term in the context of the wc mps method to surmount the numerical issues arising from the kernel truncations at the boundaries to do so we employ the convergent form of laplacian and taylor s expansion series based on the work of antuono et al 2010 further utilizing the particle number density ni gives an independent diffusive term with respect to the density discontinuities at the interfaces of multiphase problems the general form of the modified diffusive term denoted by d i m is given as 14 d i m δ m p s δ t c 0 2 n 0 2 n i where the time step of calculation δt the reference sound speed and the normalization factor c 0 and n 0 respectively and the non dimensional coefficient 0 δ mps 1 determine the intensity of the numerical correction jandaghian and shakibaeinia 2020 to supply the model with the global convergent equation for laplacian of the particle number density we consider 15 2 n i 2 d n 0 i j n ψ i j w i j r i j 2 where based on taylor s series ψ ij is given by 16 ψ i j n j n i 1 2 n i c n j c r i j recovering the convergence all over the fluid domain antuono et al 2010 the gradient of ni in the mps formulations is approximated via 17 n i c d n 0 i j n n j n i r i j c i e i j w i j in which the corrective matrix c i increases the operator s order of accuracy and is as follows jandaghian and shakibaeinia 2020 18 c i d n 0 i j n r i j r i j e i j w i j 1 while i and j ω f and is the outer product of two vectors eventually the modified diffusive term denoted as d i m forms to 19 d i m δ m p s δ t c 0 2 n 0 2 d n 0 i j n n j n i 1 2 n i c n j c r i j w i j r i j 2 limited among the fluid particles i e i and j ω f therefore by adding this term to the continuity equation proposed in the enhanced wc mps model we obtain 20 1 n i d n i d t v i d i m for updating the particle number density field in the multiphase problems the modified diffusive term acts independently from the density discontinuity at the fluid interfaces and benefits from the continuous particle number density field this is possible as the identical bulk modulus b 0 ρ 0 c 0 2 γ and the normalization factor are used to define the particle number density and calculate the pressure fields in all the fluid phases further this diffusive model conserves the total mass of the system i e i n i d i m v i 0 as vi is the volume of the particle in multiphase test cases the implementation and effectiveness of the modified diffusive term are specifically discussed in section 4 1 recently jandaghian et al 2021 adopted this diffusive term eq 19 for simulating and validating violent free surface flows 3 3 a generalized rheology model for immersed granular flows the numerical model calculates the effective viscosity of each fluid particle concerning its material properties and flow variables here we propose a generalized rheology model to couple with the ewc mps method by implementing the regularized visco inertial rheology model along with the consistent effective pressure the regularized visco inertial model eq 8 determines the effective viscosity of the fluid particles containing the granular material i ω m through 21 η i τ y i γ i 2 λ r 2 δ μ p g i b p g i d g 2 ρ g 2 μ w γ i λ r γ i 5 ϕ i 2 a μ w p g i γ i 2 d g 2 ρ g 2 μ w γ i λ r 2 in which the normal stress between the solid grains pg i wherein the immersed condition pg i p eff i gives the yield stress as τ y i μ1 pg i and γ i 4 i i e i in this study we choose λ r 0 001 to avoid the singularity issue the constitutive model for newtonian fluid eq 4 updates the effective viscosity of the water particles i ω w as a function of the shear rate magnitude γ i and the smoothed volume fraction φ i by 22 η i μ w 1 5 2 ϕ i ρ 0 w c s r e 2 γ i where μ w 0 001 pa s ρ 0 w 1000 k g m 3 for water and the smoothing length re is considered as the mixing length for the turbulence sub particle scale model with cs 0 12 see lo and shao 2002 duan and chen 2015 here we have ignored the implementation of favre averaging for the turbulence viscosity calculations see dalrymple and rogers 2006 by neglecting the weak compressibility of the fluid model the numerical model estimates the volume fraction over the fluid particles as follows 23 ϕ i i n ϕ j w ij i n w ij considering that for i ω w ϕ i 0 and for i ω m ϕ i ϕ ϕ being the volume fraction of the solid grains and with the third order spiky kernel function it should be noted that the local volume fraction of the fluid particles ϕ i remains invariant during the simulation although its approximated value varies in the immersed problems as the interface deforms overall the terms containing ϕ i in the rheology model aim to include the effects of the suspended granular materials through the effective viscosities at the interface where ϕ i for i ω m decreases while for i ω w increases baumgarten and kamrin 2019 moreover we set τ y i ω m 0 if ϕ i becomes less that 0 25ϕ we employ the corrective matrix c i eq 18 to increase the order of accuracy for estimating the velocity gradient through 24 v i c d n 0 i j n v i j r i j c i e i j w i j used to calculate the second invariant of the strain rate tensor iie i 0 5e i e i where e i 0 5 v i c v i c t to implement the consistent effective pressure proposed in section 2 4 we consider the rate of volume expansion of the particles i e v i 1 d v i d t by the velocity divergence and the diffusive term as v i d i m to update the true density of the pore water hence we discretize the system of eq 10 in the lagrangian framework for the mixture particles as follows 25 1 ρ w i d ρ w i dt v i d i m i ω m p p w i b 0 ρ w i ρ 0 w γ 1 assuming invariant pore water porosity for the particles note that the right hand side of the continuity equation of 25 is already estimated for updating the particle number density field through eq 20 with terzaghi s effective stress p eff i pi ppw i and the equation of state 12 for pi and ppw i as the functions of n i n 0 ρ i ρ 0 m and the identical b 0 where the true density of the mixture phase ρ 0 m 1 ϕ ρ 0 w ϕ ρ g the general form of the effective pressure reduces to 26 p eff i b 0 n i n 0 γ ρ w i ρ 0 w γ i ω m the proposed model not only calculates the effective pressure dynamically but also removes the need for tracking the interfaces without additional calculation costs it is worthy to note that since the presented model updates pi and ppwi with an identical bulk modulus the pressure oscillations due to the slight compressibility of the numerical model are filtered out from the effective pressure calculation otherwise using different reference pressures in the equation of state or the hydrostatic assumption for the pore water pressure affects the stable viscosity field required for capturing the mechanical behavior of the submerged granular flows since this introduces the low frequency oscillations into the effective pressure field 3 4 virtual moving gates in experimental setups of the immersed granular flows including the gravity flow driven problems a physical gate contains the fluid phases at the initial stage different mechanisms have been implemented for removing the gate to release the mixture or fluid phase and form the granular flow e g a sluice gate is lifted or withdrawn into a bottom cavity of the channel see rondon et al 2011 and grilli et al 2017 the gate as a moving object interacts with the fluid and granular phases through the pressure and friction forces these interactions may have impacts on the initial stage of the flow as the gate is being removed depending on the thickness and the roughness of the gate and the material properties of the fluid phases including the physical effects of the gate associated with its high true velocity within the numerical simulations has been a challenge in terms of stability and accuracy of the model therefore the numerical models mostly ignore the presence of the gate and its influence on the initial condition of the fluid flows e g krimi et al 2018 ghaïtanellis et al 2018 shi et al 2019 here we employ virtual moving gates to include the effects of the removable gate in the governing equations of the fluid particles while ignoring its physical thickness representing the thickness of the physical gate requires the use of extremely small particles affecting the computational efficiency we explain the implementation of the virtual gate method through a simple example in which a gate separates the fluid phases as being lifted in the y direction fig 2 we model the virtual gates by two sets of virtual particles with the particle distance of l 0 arranged in three layers parallel to the centerline of the gate the virtual particles at the left side interact with the fluid at the right side of the gate and vice versa each set of virtual particles which are fixed with respect to each other represents a virtual gate denoted as vg1 and vg2 delimiting the two regions of the channel i e the left and right sides of the gate s centerline these virtual gates are faced on the interface of the two regions identified as r1 and r2 see fig 2 the true velocity of the gate v g updates the vertical position yg of the virtual gates and r1 and r2 regions it should be noted that the fluid particles within r1 or r2 only interact with the virtual particles of vg1 or vg2 at the other side of the centerline while ignoring the fluid particles within r2 or r1 and the virtual particles of vg2 or vg1 further vg1 and vg2 neglect the presence of each other and the solid boundary particles regarding the flow properties of the virtual particles we update their pressure via the generalized wall boundary condition by adami et al 2012 smoothing the fluid particles pressure on the virtual particle as p i i j n p j w i j i j n w i j where i vg1 or vg2 and j r1 or r2 the velocity and viscosity of the virtual particles included in the continuity and momentum equations of the fluid particles need to be adjusted based on the spatial resolution and the expected initial stage of the case study e g see table 4 however they are moved with the true velocity of the gate v g hence the pressure of the virtual particles repels the fluid particles from passing the centerline to the other region and their assigned velocity and viscosity simulate the friction between the gate and the fluid particles 3 5 initial and boundary conditions the continuity equation in the ewc mps method enables assigning the initial pressure to the particles considering the theoretical solution of a problem including the initial velocity v i 0 position r i 0 and the boundary conditions the initial pressure of the fluid particles p i 0 can be calculated then the inverse form of the equation of state gives the initial particle number density of the particles through n i 0 n 0 p i 0 b 0 1 1 γ in this study we assign the initial hydrostatic pressure to the fluid particles without changing their positions subtracting the equivalent hydrostatic water pressure p pw i 0 from the total initial pressure of the mixture particles p i 0 determines the initial effective pressure of the mixture particles as p eff i 0 p i 0 p pw i 0 with the inverse form of the equation of state we assign the initial true water density of the mixture particles ρ w i 0 corresponding to the initial pore water pressure we employ the fixed dynamic boundary condition for treating the wall and ghost particles denoted as the solid boundary particles ω s based on the work of crespo et al 2015 fig 1 represents the classification of the particles including the fluid and solid boundary particles in the dynamic boundary condition implemented in this study the pressure of the closest wall particle is assigned to the ghost particles further in the governing equations of the fluid particles the velocity of the fluid particle interacting with the solid boundary is assigned to the ghost particles whereas the wall particles have zero velocity table 1 to update the particle number density of the wall particle via the continuity equation without the diffusive term the velocity of all the boundary particles remains zero for approximating the gradient of the velocity of the fluid particles v i we assign the fluid s velocity to the wall ghost particles to avoid large amounts of iie i i e i ω f j ω s and rij re v j v i in eq 24 see table 1 at the vicinity of the solid boundary or the virtual gates we assign the particle number density and a fraction of effective viscosity of the fluid particles given by γ s η i to the wall and ghost particles i e i ω f j ω s or vg1 or vg2 and rij re η j γ s η i and nj ni in eq 11 the constant and dimensionless coefficient 0 γ s 1 adjusts the friction magnitude between the fluid and wall particles based on the problem specifics furthermore the volume fraction of the fluid particles close to the solid boundaries is given to its neighbor boundary virtual gate particles i e i ω f j ω s or vg1 or vg2 and rij re ϕ j ϕ i in eq 23 regarding the particle stabilization technique the cps technique involves the solid boundary particles for determining the free surface regions and the shifting vector by assigning the particle concentration of the closest wall particle calculated like the fluid particles to the neighbor ghost particles 3 6 solution algorithm the symplectic time integration algorithm by monaghan and rafiee 2013 solves the discrete system of equations as a second order and explicit scheme see appendix b in addition to the courant friedrichs lewy stability condition the shear force due to the maximum viscosity controls the time steps of the calculation δt as follows violeau and leroy 2014 27 δ t min c c f l l 0 c 0 0 125 ρ m l 0 2 η m a x in this study we set the ccfl coefficient to 0 5 for all the simulations however for simulating the granular flows the diffusion stability condition is dominant and the maximum viscosity η max enforces the shear force condition for the numerical stability of the time integration scheme to accelerate the computations we implement the numerical model in parallel frameworks with compute unified device architecture cuda c programming language using the massive parallelism of the graphical processing unit gpu devices see appendix b for more details this speeds up simulating three dimensional problems with high shear stresses studied in the present work it should be highlighted that the developments proposed and validated in this paper are independent of the programming language and the parallel algorithms used and can be directly extended to other continuum based particle methods 4 results and discussions we implement the proposed developments in the three dimensional model of the ewc mps method to capture the complex mechanical properties of the multiphase granular flows first we validate and discuss the role of the modified diffusive term by simulating the hydrostatic pressure in a simple multiphase problem further we study the gravity driven immersed granular flows through the granular collapse and landslide benchmark cases we represent a set of experimental results for validating the granular collapse test case in the submerged conditions while for the immersed granular landslides we validate the numerical simulations by the work of pilvar et al 2019 4 1 hydrostatic pressure for two fluid phases we simulate the hydrostatic pressure in a multiphase test case krimi et al 2018 rezavand et al 2020 to show the effectiveness of the modified diffusive term in this problem a steady reservoir is filled with two inviscid and immiscible fluids as the lighter phase with the density ρ l 1000 kg m 3 is on the top of the heavier phase with the density ρ h 2000 kg m 3 ρ l ρ h 0 5 each fluid phase has 0 1 m height subjected to the constant gravitational force g 0 gy 0 where gy 9 81 m s 2 the particles are initially located on a hexagonal lattice with the spatial resolution defined as r h l 0 fig 3 the symplectic time integration scheme with ccfl 0 5 solves the governing equations for 10 seconds of simulation considering the lighter fluid as the reference phase the reference sound speed and the bulk modulus are set to c 0 10 2 g y h and b 0 ρ l c 0 2 γ respectively δ mps is set to 0 1 for all the test cases and the particle shifting technique is deactivated the initial pressure p i 0 of the fluid particles are calculated based on the initial hydrostatic condition then the inverse form of the equation of state determines the initial particle number density field n i 0 fig 3 concerning the different formulations for ψ ij in the diffusive term eq 15 we define three strategies to simulate this multiphase problem the test cases 1a 1b and 1c in table 2 the results show that the standard form of the diffusive term causes the pressure field to diverge at the free surface and the vicinity of the bottom wall fig 4 1a the kernel truncation at these regions locally manipulates the particle number density field leading to unstable pressure fields in the long term simulation of the problem further case 1a shows that this diffusive term overestimates pressure at the interface of the fluid phases by employing the convergent form of laplacian operator without the higher order gradient formulation i e with n i case 1b the particle number density field still diverges close to the bottom wall nevertheless the numerical pressure at the interface is compatible with the theoretical result and the overall pressure field becomes stable after t 3 s in case 1c the proposed diffusive term with the higher order gradient i e n c i is implemented in the convergent form of laplacian operator acting between all the fluid particles eq 19 this diffusive term solves the kernel truncation issue at the free surface and the vicinity of the wall comparing case 1b vs 1c in fig 4 exhibits the key role the first order gradient plays in the accuracy of the pressure approximation as the kernel function truncates fig 5 illustrates the uniform particle distribution and the smooth pressure field obtained by the three cases at t 10 s however implementing the standard diffusive term underestimates the pressure at the vicinity of the bottom wall in the long term simulation fig 5 1a overall the results confirm that the modified diffusive term as a function of the particle number density and without being limited to the same phase particles unlike the multiphase sph models e g sun et al 2019 estimates accurate pressure field over the fluid domain while is independent of the accuracy of the corrective matrix eq 18 at the interface of the fluid phases to quantify the improvement achieved by the modified diffusive term similar to the work of fourtakas et al 2019 we conduct the particle convergence study considering different spatial resolutions set as r 50 100 and 200 with the theoretical solution of this problem we estimate the normalized root mean square error nrmse of the pressure the magnitude of velocity and the total kinetic energy of fluid particles ek fig 6 compares the theoretical hydrostatic pressure with the extracted numerical pressure at x 0 1 m and t 10 s of the cases 1a and 1c where the errors are normalized by the maximum analytical pressure of the corresponding fluid phase although the nrmse of the model with the standard diffusive term reduces by increasing the resolution the pressure in the vicinity of the bottom wall still diverges considerably in the long term simulation as for case 1a with r 200 nrmse 1 87 however the modified diffusive term decreases the nrmse significantly by the order of one magnitude as the numerical pressure converges to the analytical pressure across the fluid phase as for case 1c with r 200 nrmse 0 154 fig 7 illustrates the velocity profile in the middle section at t 10 s and the temporal evolution of the total kinetic energy where the errors of v and ek are normalized by g y h and the total potential energy which in this problem is 45 05 j respectively the nrmse of the velocity and the total kinetic energy are negligible for both 1a and 1c cases i e nrmse 0 01 nevertheless with the modified diffusive term the velocity field convergence to the theoretical velocity of zero with fewer numerical errors it should be noted that the initial hexagonal distribution of the particles has eliminated the initial particle rearrangement and its associated noises that occur with the cartesian particle distribution in the initial time steps of the simulation see jandaghian and shakibaeinia 2020 in fig 8 we plot the nrmse of the total kinetic energy and the pressure with the different resolutions using the logarithmic scale to identify the order of convergence for the total kinetic energy the order of convergence is estimated as 1 56 and 1 69 for 1a and 1c respectively showing satisfactory results as it slightly increases with implementing the modified diffusive term the divergence of the pressure in the vicinity of the wall with the standard diffusive term affects the order of convergence of this variable as is approximately less than one i e case 1a o 0 74 whereas with the modified diffusive term i e case 1c the order of convergence increases considerably to o 1 35 confirming the effectiveness of the model in predicting accurate pressure field 4 2 immersed granular collapse the immersed granular collapse has been widely modeled for understanding the mechanical properties of the granular flows in various hydrodynamic conditions e g rondon et al 2011 balmforth and kerswell 2005 wang et al 2017 bougouin and lacaze 2018 capturing the different states of the granular flow in this problem the viscous and or inertial regimes has been a great challenge for numerical models e g baumgarten and kamrin 2019 jafari nodoushan et al 2018 savage et al 2014 wang et al 2017 lee and huang 2018 here by simulating this gravity driven test case we investigate the role of the modified diffusive term the regularized visco inertial model and the consistent effective pressure we validate the three dimensional numerical model developed in the context of the ewc mps method by the experimental results conducted and presented as a part of the present work fig 9 illustrates the initial setup and geometrical properties of the physical and numerical models we conducted the experiment in a steady and horizontal channel of the rectangular cross section wb lb with a sluice gate located at x l 0 as the gate opens with v g 1 m s in the y direction the column of the mixture collapses under the gravitational force with g 0 gy 0 and gy 9 81 m s 2 propagating on the smooth bottom wall of the channel with the aspect ratio of the granular column equal to one i e h 0 l 0 1 the final deposit is expected to form a triangular shape where the final height becomes less than the initial height rondon et al 2011 table 3 contains the material properties of the spherical glass beads with a mean diameter of 0 0008 m and ρ g 2470 kg m 3 fully submerged in ambient water with ρ 0 w 1000 k g m 3 and μ w 0 001 pa s we neglect brownian effects as the grains are large enough i e as dg 100 μm the physical properties used in the effective viscosity equation correspond to the rheology model baumgarten and kamrin 2019 validated by the experimental data we recorded the evolution of the collapse from the sidewall of the reservoir to extract the interface profiles and the spreading runout length of the granular deposit depending on the material properties of the fluid phase and the solid grains the viscous and or inertial regimes occur in the immersed granular collapse cassar et al 2005 bougouin and lacaze 2018 considering the dimensionless numbers the stokes number st here is defined as the ratio of the viscous timescale to the free fall timescale and the grain water density ratio r ρ g ρ 0 w 0 5 the immersed granular collapse in the present study falls within the viscous inertial regime as st 5 4 and r 1 6 bougouin and lacaze 2018 in the numerical model we discretize the computational domain with the initial particle distance l 0 the total particle count presented in table 4 consists of the water mixture solid boundary and virtual gates particles to ensure the incompressibility of the fluid model we set the reference sound speed to 24 m s we should note that in this problem the viscous force limits the time steps of the calculation through eq 27 as η max 1000 pa s we implement the particle packing algorithm to eliminate the noise arising from the transition of the initial cubic particle distribution to the low energy configuration similar to colagrossi et al 2012 the new position of the fluid particles are used to calculate n 0 by averaging the kernel summation over the interior fluid particles and initialize the main simulations i e apply the initial hydrostatic condition fig 9 b the virtual particle j representing the moving gate interacts with the fluid particle i within r1 or r2 regions in fig 9 b through the governing equations although the virtual particles are moved with the true velocity of the physical gate v g 1 m s their virtual velocity included in the momentum and continuity equations of the fluid particles is adjusted according to table 4 for different spatial resolutions e g with l 0 0 003 m for i vg1 or vg2 v i 0 0 0 2 0 0 also for the shear force between the fluid particles i and the virtual and wall particles j the dimensionless coefficient of the viscosity γ s is given in table 4 e g with l 0 0 003 m η j 0 2η i we extract the numerical results from the middle and sidewall sections of the channel specified in fig 9 to represent them in two dimensional x y graphs we define five different strategies for simulating the immersed granular collapse concerning the implementation of the diffusive term the effective pressure and the rheology model table 5 the test case 2a contains all the developments proposed in the present work and can be denoted as the reference numerical model in the diffusive term δ mps 0 6 for all the test cases except 2b to detect the free surface particles and for the stability of the model the cps technique is activated table 6 identifies the timesteps in which the comparison of the experimental and numerical results is carried out the nondimensional time scale t is given by t g y h 0 h 0 being the initial height of the granular column we consider the reference time t0 0 0 as the immersed granular column commences to collapse on the bottom wall of the channel shown in fig 11 while the gate is being opened and still l l 0 l is the length of granular deposit on the bottom wall in the x direction we re initialize the true density of water within the mixture particles ρ w i assuming the hydrostatic condition for the pore water pressure we represent the three dimensional configuration of the immersed granular collapse case 2a with l 0 0 003 m in fig 10 the viscosity field in the logarithmic scale and the effective pressure within the mixture particles at t4 and t6 respectively and the pressure field of the water particles at t8 see the results in the supplementary materials for movies of the experiment and the numerical simulations the physical effects of the virtual gate implemented at the initial stages of the granular flow are well illustrated in the movies also the fixed solid boundary particles include the shear force between the walls of the channel and the fluid particles in the numerical simulations this allows the 3d model to capture the effects of the reservoir s corners on the overall evolution of the granular deposit due to the confinement of the granular phase at the two corners the maximum viscosity occurs forming the curve shape surface of the mixture on the back wall also observed in the experiments fig 10 a d it should be highlighted that the two dimensional models are incapable of capturing this aspect of the granular collapse jandaghian and shakibaeinia 2019 plotting the interface profiles of the experimental results the left column of fig 11 on the sidewall sections of the numerical simulation of case 2a with l 0 0 003 m in the right column of fig 11 we compare the time evolution of the granular collapse the rapid opening of the vertical gate creates vortices suspending the solid grains in water at the initial stage fig 11 t0 this makes digitizing the interface profiles of the experiment difficult and slightly affects the deformation of the granular phase in the early stages at t2 furthermore since the virtual gate neglects the physical thickness of the gate which is 0 005 m in the experiment the shear stress causing the suspension of the grains is partially simulated via the numerical model however comparing the interface profiles in the following steps of the granular collapse shows good compatibility between the numerical and experimental results next we investigate the effect of the initial particle distance or size on the time evolutions of the mixture phase in the case of granular flows the choice of the particle distance is not only controlled by the convergence of the numerical technique but also by the validity of the continuum assumption considering the continuum assumption in the governing equations the smallest numerical elements here the particles must be much larger than the diameter of the physical elements here the solid grains and pore water guazzelli and pouliquen 2018 baveye and sposito 1984 with the particle and grain sizes being close i e l 0 dg the mixture particles would contain a limited number of solid grains violating the continuum assumption of the numerical model ghaïtanellis et al 2018 on the other hand the representative elementary volume should be much smaller than the characteristic length of the problem to mathematically represent its vicinity in the calculations baveye and sposito 1984 therefore the initial particle spacing should satisfy both conditions simultaneously otherwise either the rheology model defined for a continuous effective fluid becomes invalid or the approximation errors increase affecting the mechanical behavior of the mixture phase to determine the optimum particle size of the model we simulate the immersed granular collapse with different spatial resolutions l 0 0 004 0 0035 0 003 0 002 0 0015 m with the adjusted boundary conditions given by table 4 fig 12 compares the dimensionless interface profiles of the numerical simulations with those from the experiment at the sidewall of the reservoir at t2 t6 and the final stage the results of case 2a with l 0 0 004 and 0 0035 m show considerable incompatibilities between the numerical and experimental profiles this apparent discrepancy can be explained by the large initial particle distance with regards to the problem characteristic length which increases the approximation errors and leads to inaccurate interaction forces between the solid boundaries and fluid particles nevertheless the interface profiles with l 0 0 003 m are in good agreement with the experimental profiles whereas the case l 0 0 0015 m shows slightly more deformation of the granular collapse at t6 furthermore we plot the normalized runout distances i e l l 0 1 in the left graph of fig 13 a clear discrepancy between the experimental and numerical runout distances of the immersed granular collapse with l 0 0 004 and 0 0035 m exists while the runout lengths of cases with the smaller particle sizes particularly with l 0 0 003 and 0 002 m are consistent with the experimental measurement although the case with l 0 0 0015 m considering the adjusted boundary conditions table 4 predicts the final stage of the granular deposit it overestimates the runout length during the collapse i e t2 t t7 to quantify the accuracy of the results we compute the root mean squared error rmse of the normalized runout distances and plot them against the non dimensional ratio of l 0 dg in the right graph of fig 13 the table presented in fig 13 shows the number of solid gains that each mixture particle represents n g in 3d and the corresponding errors of the normalized runout length for coarse particle sizes i e l 0 0 004 and 0 0035 m the rms errors are considerable equal to 0 4972 and 0 1597 respectively by decreasing the particle size to 0 003 and 0 002 m the errors significantly reduce rmse 0 0509 and 0 0499 respectively confirming the good agreement between the numerical and experimental results and the convergence of the model however with the smallest particle size of l 0 0 0015 m the rmse increases to 0 0963 this illustrates that when the mixture particle contains a limited number of solid grains for l 0 1 875dg n g 8 in the 3d problem may violate the continuum assumption of the granular mass leading the rheology model to become incapable of capturing the accurate evolutions of the granular mass in this case overestimating the deformations through a similar study ghaïtanellis et al 2018 obtained equivalent outcomes showing the overestimation of sediment erosion with l 0 2dg and concluded that the minimum error is achieved by l 0 3dg that is due to the fact that with smaller particle sizes the macroscopic scale would reach the size of the discrete elements of the system and thus it would no longer be the representative elementary volume of the continuum model ghaïtanellis et al 2018 overall the interface profiles and the spreading length of the case 2a with l 0 0 003 and 0 002 m are consistent with the experimental measurements as the model predicts the evolution of the immersed granular collapse with the rmse of the normalized runout distance 0 05 accordingly we choose l 0 0 003 m where l 0 3 75dg for the following simulations of the immersed granular flows represented in this paper in table 7 we can compare the calculation time per iteration i e per time step of the simulations concerning the number of fluid particles and the different particle sizes an nvidia v100 volta gpu device is used for running the parallel part of the code written by cuda c parallel programming language see appendix b since the results in table 7 cannot be used for discussing the efficiency of the gpu implementation and also considering the scope of the current work we postpone investigating the performance analysis and the scalability of the gpu accelerated code to future works 4 2 1 role of diffusive term here we study the role of the diffusive term in simulating the immersed granular collapse the modified diffusive term included in the continuity equation presents a uniform pressure field fig 14 2a without the diffusive term the high frequency pressure noises affect the mechanical behavior of the granular collapse fig 14 case 2b this leads to unphysical deformation of the granular flow by overestimating the effective viscosity as incompatibility exists between the experimental interface profiles and the numerical results of case 2b fig 14 and fig 15 case 2b however the modified diffusive term shows a uniform viscosity field required for capturing the shear properties of the granular flow fig 15 case 2a the results emphasize implementing the diffusive term as an effective numerical correction approach for eliminating the high frequency pressure fluctuations that exist in the numerical model moreover we compare the modified diffusive term with the standard diffusive term where ψ ij nj ni i e case 2a vs case 2c we plot the mixture particles position against their total numerical pressure i e yi pi fig 16 while the standard diffusive term reduces the total pressure in the vicinity of the bottom wall the modified diffusive term eliminates the kernel truncation errors and represents a stable pressure field at the final stage of the collapse it should be noted that the standard diffusive term manipulates the pressure particularly in the vicinity of the wall and hence affects the mechanical properties of the immersed granular collapse where the effective pressure plays an essential role in the constitutive law 4 2 2 role of effective viscosity we implemented the regularized visco inertial rheology model to capture the viscous and inertial regimes of the immersed granular flows through a single formulation fig 17 indicates that the non dimensional numbers iv i and im defined in eq 5 and st i 2 iv are within the limit defined for validating the visco inertial model the viscous number remains below 0 01 value while the inertial number i is dominant in the yielded region controlling the post failure terms of the effective viscosity i e the second and third terms in the right hand side of eq 6 the range of the stokes number which varies from zero to 40 over the simulation acknowledges the visco inertial regime expected from this granular flow considering the material and flow characteristics furthermore fig 18 shows that the approximated volume fraction of the mixture particles ϕ i from eq 23 reduces at the interface applying the effects of the suspension of the solid grains in their rheology model the proposed model for the effective viscosity of the water particles eq 22 includes the turbulent properties of the fluid flow and the volume fraction of the solid grains at the interface these effects are essential to be considered in the constitutive law as the dynamic viscosity of water particles increases considerably 30 times the reference viscosity of water μ w in the highly deformed regions impacting on the mechanical behavior of the granular flow fig 18 furthermore we compare the μ iv im ϕ model with the μ i rheology validated in tajnesaie et al 2018 hosseini et al 2019 considering the same yield stress terms the inertial number of the μ i rheology is a function of the drag coefficient cd and water density i γ d g ρ 0 w c d p eff and is included in the post failure term of case 2d as follows chauchat and médale 2014 28 η i τ y i γ i 2 λ r 2 δ μ p eff i i 0 p eff i d g 2 ρ 0 w c d γ i λ r where i 0 b and cd 0 47 for i ω m the other calculation and boundary conditions of case 2d are identical to case 2a see appendix a for more details regarding the regularized μ i rheology the viscosity fields of the mixture particles in the logarithmic scale obtained via the rheology models are plotted in fig 19 thanks to the diffusive term implemented cases 2a and 2d represent smooth viscosity fields comparing the interface profiles with the experimental results shows that the μ i rheology reproduces almost similar evolution of the granular collapse this indicates that the yield stress term as a function of the effective pressure and the strain rate magnitude is dominant in the rheology of the granular collapse however the result shows that the μ i model underestimates the post failure viscosity as the granular phase collapses leading to incompatibility between the normalized runout distance of case 2d and the experimental result fig 21 while including the mixed number im and the term containing the volume fraction ϕ within the regularized visco inertial model eq 21 implemented in case 2a simulates an accurate spreading length of the granular deposit 4 2 3 role of effective pressure in the next step we evaluate the role of the consistent effective pressure in the rheology of the immersed granular collapse to do so we employ the hydrostatic assumption for the pore water pressure in test case 2e and compare the results with case 2a which contains the proposed eq 26 in case 2e with the same calculation and boundary conditions as case 2a the hydrostatic assumption calculates the pore water pressure according to the spatial position of the mixture particle and the free surface of the water phase i e p ef f i p i ρ 0 w g y h w i y i where hw i is the height of water column in which the mixture particle is located and yi is the position of the mixture particle from the bottom wall of the channel fig 20 compares the effective pressure fields of case 2a vs case 2e the results show that the consistent effective pressure by including the hydrodynamics properties of the mixture particles within the rheology model predicts accurate evolutions of the mixture phase forming the granular deposit however in case 2e the hydrostatic assumption overestimates the effective pressure at the yielded regions increasing the viscosity this may result from the low frequency oscillation of the pressure inserted in the effective pressure estimation hence the evolution of the granular collapse simulated by case 2e becomes inconsistent with the experimental results fig 20 particularly the runout distance of case 2e versus the other test cases and the experimental results confirms the overestimation of effective pressure affecting the granular flow fig 21 4 3 immersed granular landslide simulating the immersed granular landslide deals with complex mechanical behaviors concerning the mixture of solid grains and water due to the highly dynamic granular flow this characteristic of the granular landslide challenges the numerical models for capturing and predicting its evolution several experimental and numerical studies have focused on the landslides to represent a practical tool for predicting the mixture flow and generated waves e g cassar et al 2005 grilli et al 2017 pilvar et al 2019 couston et al 2015 kim et al 2019 yu and lee 2019 miller et al 2017 particle methods have been widely applied for dealing with such a problem e g tan and chen 2017 snelling et al 2020 tajnesaie et al 2018 fu and jin 2015 krimi et al 2018 capone et al 2010 manenti et al 2018 here to show the effectiveness of the proposed developments we simulate the immersed granular landslide in the three dimensional configuration via the ewc mps method we set up the numerical model based on the physical model of test case s7 in pilvar et al 2019 fig 22 in this multiphase problem the triangle heap of the solid grains with l g hg dimensions and the same material properties presented in table 3 is submerged within ambient water on an inclined plane with a slope angle of 45 degree as the physical gate is lifted with v g 1 m s the granular bulk as the mixture phase slides on the smooth wall under the gravitational forces g meanwhile the drag force induced by water suspends the solid grains forming vortices rolling the mixture phase pilvar et al 2019 with three different strategies defined in table 8 we simulate the immersed granular landslide in which the particles with the initial spacing of 0 003 m discretize the computational domain the corresponding particle count including the solid boundaries and virtual gates is 895 912 the output of the particle packing method is considered as the initial distribution of particles for calculating the averaged n 0 of the internal particles and applying the initial hydrostatic pressure fig 22 the nondimensional time scale is set to t t g y h 0 h 0 being the initial height of the granular phase from the bottom wall equal to 0 22 m we extract the numerical results from the middle and sidewall sections of the channel to validate with the experimental measurements at the time steps given in table 9 the sound speed within the bulk modulus is set to 24 m s and η max 400 pa s in all the test cases in this section we implement the cps method as the particle regularization technique and the modified diffusive term eq 19 with δ mps 0 6 in analogy to the previous test case the virtual moving particles representing the physical gate are moved with the true velocity of 1 0 m s in the y direction while their velocity parameter included in the governing equations of the fluid particles is set to 0 2v g to simulate the semi slip boundary condition we reduce the viscosity of the wall or the virtual particle j interacting with the fluid particle i to 0 1 of the effective viscosity of the fluid particle i e η j 0 1η i as if γ s 0 1 as the virtual gate is being opened and until the runout length l remains almost equal to l g i e until t0 shown in fig 23 a the model reinitializes the pore water density imposing the hydrostatic condition we represent the three dimensional results of the immersed granular landslide case 3a in fig 23 the initial stage at t0 the approximated volume fraction and the velocity of the mixture particles at t3 and t4 respectively and the final stage of the granular landslide see the supplementary results for the movies of the simulated granular slide with the free surface detection algorithm implemented as a part of the cps technique the generated wave formed by the submerged landslide is identified fig 23 b shows that the approximated volume fraction reduces at the interface due to the inter phase shear forces suspending the mixture particles and forming circulations within the fluid flow the bulk of the mixture with an average velocity of around 0 5 m s approaches the slope toe at t4 and the mixture particles come to rest on the bottom wall at t 1 49 seconds fig 23 c d however few mixture particles remain suspended within the water phase as the viscous forces damp the kinetic energy and balance their weight to validate the developed three dimensional model we extract the numerical results from a viewpoint almost identical to the position of the camera used in the experiment which is perpendicular to the sidewall and above the bottom wall of the channel we represent the evolution of the submerged granular landslide simulated by case 3a and the scaled snapshots taken from the multimedia file of the experiment provided in pilvar et al 2019 in the right and left columns of fig 24 respectively plotting the outlines of the mixture particles the continuous green lines on the corresponding snapshots of the experiment we compare the overall deformation of the landslide in the experiment as the gate opens the rapid fluid flow suspends the solid grains in the water expanding the volume of the mixture i e reducing the local mass the numerical model needs to simulate the water flow between the solid gains as a deformable porous media to capture this mixing process since the governing equations eq 11 do not simulate the mass exchange between the fluid particles the current model overlooks the volume expansion observed at the initial stages of the landslide particularly at t2 the evolution of the mixture becomes incompatible with the experimental profile this occurs as the numerical model initially overestimates the velocity of the mixture particles with the constant mass however we should note that the overall deformations of the landslide simulated by the proposed model are comparable to the experimental figures fig 24 further the results show that the constitutive laws implemented through eqs 21 and 22 indirectly include the interphase drag force creating vortices and suspending the mixture particles from the interface for t t2 fig 25 illustrates the velocity vectors representing the counterclockwise circulation of the fluid flow as the mixture particles approach the slope toe at t4 moreover we observe that the normalized runout distance of case 3a is in good agreement with the experimental measurement almost identical to the experimental profile particularly for t t6 where the main evolution of the landslide occurs fig 26 nevertheless the particles separated from the granular bulk remain suspended for t t7 while in the experiment the solid grains settle increasing the runout distance in the x direction treating the mixture as an effective fluid in the single phase formulations represented by the mixture particles might cause this discrepancy between the numerical and experimental runout distances at the late stages the non dimensional numbers governing the visco inertial model are represented in fig 27 while the viscous number remains below 0 015 the inertial number surpasses the limit suggested for the rheology model however the mixed number in the main body of the mixture phase is below its maximum limit i e i m 0 6 the local stokes number varies between 0 and 100 over the mixture phase indicating the different states of the immersed granular flow captured by the regularized visco inertial model we implement the local μ i rheology based on the inertial number given by eq 28 in case 3b and achieved almost identical results to case 3a comparing the runout distances of case 3a with 3b in fig 26 confirms that both rheology models predict the same evolution of the granular since the inertial regime is dominant in this landslide unlike the immersed granular collapse test case fig 28 shows that in regions where the separation from the granular bulk occurs the approximated volume fraction of the mixture particles reduces to almost half of the reference volume fraction of the mixture phase ϕ further considering the turbulence model within the dynamic viscosity of the water particles is shown to be effective and essential for simulating the interphase forces as η i μ w increases considerably in the region with the high strain rate magnitudes it should be noted that the free surface detection algorithm implemented within the cps technique represents the generated wave by the landslide in fig 28 at t2 t4 and t6 in test case 3c we implement the hydrostatic pore water pressure to update the effective pressure within the mixture particles the evolution of the landslide simulated by case 3a and 3c are compared in fig 29 at t3 like the granular collapse test case 2e the hydrostatic assumption in case 3c overestimates the viscosity field by neglecting the hydrodynamic aspects of the fluid flow in the case of 3a with the consistent effective pressure included in the rheology model the fluidity expected in the mixture is well captured particularly the runout length of case 3c compared with the experimental and the other test cases in fig 26 indicates the overestimation of the effective pressure via the hydrostatic assumption for the pore water pressure moreover fig 29 shows the effectiveness of the modified diffusive term for estimating a smooth pressure field i e by eliminating the high frequency pressure noises over the fluid domain 5 conclusion we represented a developed single phase particle method based on the ewc mps method capable of simulating mechanical behaviors of the immersed granular flows this multi viscosity multi density system proved to be effective and essential for simulating the interactions between water and mixture phases we developed the rheology model via the regularized visco inertial model the consistent effective pressure and higher order operators for the velocity gradient and the diffusive term in the context of multiphase problems further we included the turbulent viscosity and the linear effects of the suspension at the interface within the constitutive laws we showed the effectiveness of the modified diffusive term by predicting the hydrostatic pressure in a two dimensional steady tank filled with two fluid phases the convergence study that we conducted for this benchmark case confirmed that the modified diffusive term significantly reduces the numerical errors and increases the order of convergence of the results by eliminating the kernel truncation errors and thus predicting accurate particle number density near the boundaries we simulated the three dimensional gravity driven granular collapse and the deformable landslide to verify and validate the multiphase model the results represented the capability of the proposed developments in capturing the complex flow deformation including the viscous and inertial regimes further the modified diffusive term proved to be essential for removing the noisy pressure field and obtain an accurate viscosity prediction the regularized visco inertial rheology model consists of non dimensional numbers and the approximated volume fraction of the mixture particles simulated the time evolution and the dominant flow regimes of the immersed granular problems furthermore utilizing the proposed constitutive relation for calculating the pore water pressure not only exempts the model from the complexity of detecting the interface but also results in an accurate and stable viscosity field although the single phase and continuum based model is still incapable of modeling the fluid flow between the solid grains the developed model represents promising outcomes in simulating the suspension process and forming the flow circulations within the mixture and water phases overall the compatibility between the numerical results and the presented experimental measurements confirmed the robustness of the proposed developments for studying the underlying physics of the immersed granular flows the model we have developed in this study can be employed for validating the generated waves by the transitional and submerged landslides in large scale problems this may require conducting three dimensional experiments of the granular flows in various hydrodynamic conditions and with different granular materials e g kim et al 2019 miller et al 2017 it is also worthwhile to investigate the convergence of the modified diffusive term for high density ratio fluid flows and evaluate the gpu implementations for simulating large scale 3d problems moreover the non local rheology models kamrin 2019 can be coupled with the governing equations to study the nonlocal effects of the granular shear properties in the multiphase flows meanwhile the ewc mps method of this work can be extensible to the two phase mixture models baumgarten and kamrin 2019 shi et al 2019 capable of simulating the fluid flow through the solid grains to include the role of saturation degree in the rheology model credit authorship contribution statement mojtaba jandaghian conceptualization methodology software data curtion visualization formal analysis investigation writing original draft abdelkader krimi methodology data curtion writing review editing ahmad shakibaeinia supervision conceptualization methodology data curation investigation writing review editing funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment the authors would like to thank the anonymous reviewers for their valuable comments and suggestions that truly improved the accuracy and quality of the representation of the results this research utilized the high performance computing resources of computecanada and calculquebec canada financial support of this research was provided by the natural sciences and engineering research council of canada nserc and polytechnique montréal canada also the authors would like to acknowledge nvidia united states for supporting this research through their gpu grant program supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2021 103908 appendix c supplementary materials movie 1 a movie from the experiment of the immersed granular collapse image video 1 movie 2 the velocity field of the 3d immersed granular collapse simulated with the different particle sizes image video 2 movie 3 the approximated volume fraction left and the pressure field right of the 3d immersed granular collapse image video 3 movie 4 the approximated volume fraction left and the velocity field right of the 3d immersed granular slide image video 4 appendix a derivation of the regularized rheology equations here we derive the regularized constitutive equations of the visco inertial rheology μ iv im ϕ and the μ i rheology used in the simulations in the form of eqs 21 and 28 respectively both rheology models diverge as the magnitude of the strain rate tensor vanishes i e γ 0 the regularization techniques have been represented to resolve this singularity issue in the computational models see chauchat and médale 2014 for the visco inertial rheology eq 6 we employ eq 7 to write the effective viscosity of the mixture phase η m as follows a 1 η m μ 1 p g γ δ μ p g b i m γ γ 5 ϕ 2 a i v p g i m γ which contains the yield stress the first term on the right hand side denoted as term 1 and the post failure the second and third terms denoted as term 2 and 3 terms in our proposed rheology model the bercovier and engelman 1980 formulation regularizes the yield stress term given as a 2 term 1 τ y γ 2 λ r 2 in which τ y μ1 pg and λ r being the regularization parameter set as λ r 1 with inserting the non dimensional numbers 5 and some mathematical simplifications we can rewrite the second term as a 3 term 2 δ μ p g b p g d g 2 ρ g 2 μ w γ γ using the simple model for the regularization represented in frigaard and nouar 2005 of the 2 μ f γ term and by noting that pg 0 the second term reduces to a 4 term 2 δ μ p g b p g d g 2 ρ g 2 μ w γ λ r γ the third term by substituting the non dimensional numbers 5 into the equation is given as follows a 5 term 3 5 ϕ 2 a μ w p g γ 2 d g 2 ρ g 2 μ w γ and considering the bercovier and engelman 1980 regularization equation reads a 6 term 3 5 ϕ 2 a μ w p g γ 2 d g 2 ρ g 2 μ w γ λ r 2 eventually substituting the terms a 2 a 4 and a 6 into eq a 1 the regularized visco inertial model would be the following equation a 7 η m τ y γ 2 λ r 2 δ μ p g b p g d g 2 ρ g 2 μ w γ λ r γ 5 ϕ 2 a μ w p g γ 2 d g 2 ρ g 2 μ w γ λ r 2 used as eq 21 in the numerical model for the μ i rheology model proposed by jop et al 2006 as a 8 μ i μ 1 δ μ i 0 i 1 the effective dynamic viscosity of the mixture phase given by eq 7 would be a 9 η m μ i p g γ μ 1 p g γ δ μ p g i 0 i γ γ where the yield stress term can be regularized similar to eq a 2 by substituting the inertial number of the immersed granular flows i e i γ d g ρ 0 w c d p eff tajnesaie et al 2018 cassar et al 2005 and the simple model for regularizing the post failure term the regularized μ i rheology equation is represented as follows chauchat and médale 2014 a 10 η m τ y γ 2 λ r 2 δ μ p g i 0 p g d g 2 ρ 0 w c d γ λ r which in the numerical model is implemented as eq 28 appendix b the solution algorithm based on the symplectic scheme in this paper we employed the explicit second order symplectic scheme represented by monaghan and rafiee 2013 as the time integration algorithm this time integrator solves the governing equations and applies the boundary conditions in two stages of calculations identified in fig b 1 the first stage calculates the flow properties at the mid point t δt 2 with the mid point values the second stage updates the velocity field and therefore the position and the particle number density fields at t δt in this stage the divergence of the velocity eq 13 and the modified diffusive term eq 19 are functions of the particle number density at the mid point i e n t δt 2 the numerical model consists of subroutines run on the computer processing unit cpu or the graphical processing unit gpu as the host and device parts of the code respectively we adopted cuda c as the parallel programming language to utilize the massive parallelism of the gpu s threads the host section of the code initializes the model i e allocates memories reads the geometry file and transfers data from the host to the gpu s memories and saves the data for the post processing tasks the device section implements the neighbor search algorithm see shakibaeinia and jin 2010 and the main temporal loop of solving the governing equations i e eq 11 and 12 supplied with the modified diffusive term eq 20 and the corrected particle shifting technique see jandaghian and shakibaeinia 2020 fig b 1 in the temporal loop of the calculation the viscosity field η i is calculated at the beginning of the first and second half of each time step moreover the particle stabilization technique only regulates the fluid particles in the second stage of the scheme in advance of estimating the particle number density field also the properties of the solid boundary and the virtual gates are updated at the end of each stage of the scheme 
307,data driven modeling with machine learning ml algorithms in hydrologic modeling and forecasting suffers a number of pitfalls and challenges including variable selection bias resubstitution validation inconsistent validation processes for different algorithms and model selection using the test set they lead to incorrect model development and biased overly optimistic performance estimates and thus unreliable models this study presents a novel model building and testing workflow that addresses common machine learning ml challenges and pitfalls the presented workflow incorporates optional variable transformation and preprocessing techniques and applies to various ml model types variable selection algorithms and resampling techniques we demonstrate its performance through streamflow forecasting for the bow river basin alberta canada using four conventional ml algorithms ann svm elm and rbf networks driven by local hydrometeorological conditions and large scale climate indices using the cross validation average out of sample results and a separate test set the prediction accuracy estimate bias the relative difference between the model performance estimated using the validation sets and a separate test set was empirically estimated to be 5 6 4 4 2 5 and 3 0 for the seasonal may june and july models respectively in addition the streamflow forecasting models had an average coefficient of determination of 0 85 preprocessing and dimensionality reduction through principal component analysis pca was detrimental to prediction accuracy snow water equivalent from individual snow courses proved the most important predictor for bow river streamflow while global climate indices including the pdo amo and pna increased the nash sutcliffe efficiency by 6 to 50 finally although forecasting skill decreased with increasing forecast lead time satisfactory forecasts nse 0 5 could be obtained two months in advance of the spring melt at the end of february extensions of this study should address the tendency of different variable selection algorithms to pick irrelevant or redundant predictors after changes in training data keywords machine learning data driven modeling model workflow variable selection seasonal streamflow forecasting forecast lead time 1 introduction data driven modeling with machine learning ml algorithms is one of the most rapidly developing topics in the field of hydrologic modeling and forecasting in addition to streamflow forecasting ml algorithms have been applied to areas such as urban water demand forecasting estimation of flow duration curves at ungauged sites and rainfall runoff modeling schmidt et al 2020 however both model development and performance estimation of data driven ml models for such applications suffer a number of challenges and pitfalls quilty and adamowski 2018 schmidt et al 2020 solomatine and ostfeld 2008 wu et al 2013 zhang et al 2015 zheng et al 2018 such common challenges and pitfalls include variable selection bias resubstitution validation and inconsistent validation processes and resamples for different algorithms as well as model selection by the test set a key challenge facing ml applications is variable selection bias which results in the selection of irrelevant or redundant predictors selection bias occurs when the same data are used both to create a model from a training set and to select the associated input predictors in practice this means that the variable selection process was not considered part of the model building process kuhn and johnson 2013 liu and motoda 2007 quilty and adamowski 2020 schmidt et al 2020 it leads to improved performance for the same data set when compared with model development without selection bias however the results are sensitive and repeating the same variable selection process with a slightly different training set can lead to different results because the uncertainty from the variable selection process can be far greater than the uncertainty of the model ambroise and mclachlan 2002 quilty and adamowski 2020 even if the best predictors are selected the performance estimates from this process are biased because they do not reflect the uncertainty involved in the variable selection process and its impact on this result kuhn and johnson 2013 quilty et al 2019 quilty and adamowski 2020 short historical records large numbers of predictors and complex and powerful ml models increase the likelihood of selection bias and all are commonly encountered in applying ml algorithms to hydrologic modeling and forecasting another common pitfall involves testing a model with the same data used to train it which is called resubstitution validation raschka 2020 wu et al 2013 zheng et al 2018 this second pitfall produces an overly optimistic performance estimation due to overfitting solomatine and ostfeld 2008 wu et al 2013 which causes a model to match the training data too well such that it applies more poorly to unseen data or data that was not included in the training set to train the model properly and avoid overfitting an additional validation dataset is required a popular approach uses k fold cross validation to build the model and ensure it generalizes to unseen data however using cross validation to estimate the model performance could lead to biased estimates the cross validation estimate is biased since the model was already exposed to the data in the validation set which guided the selection of the variables algorithm model structure and hyperparameter values during model training and validation raschka 2020 solomatine and ostfeld 2008 if a test set cannot be used because of limited historical records performance estimates from the cross validation only are likely overly optimistic in terms of prediction accuracy however for comparing among a set of models and selecting the best model the biased optimistic estimates from cross validation can be used given that the performance estimations of all models are affected evenly raschka 2020 a third pitfall involves the use of different validation processes and resamples for different algorithms both cross validation and resampling processes must be consistent across the different algorithms under consideration in order to ensure the performance estimation bias affects them equally and that the model behaviors and error ranges are comparable between different algorithms in partitioning data between training and validation datasets any data transformation or preprocessing must be applied as part of the cross validation process and not performed independently in advance hastie et al 2009 quilty and adamowski 2018 since it could otherwise 1 leak information about the mean and the variance of the validation set to the training data if the full training validation dataset was preprocessed independently in advance or 2 compromise the test data if the entire dataset is used such leaks influence both model selection and the estimation of the model s generalization performance and prediction accuracy on unseen data a fourth related pitfall is using the test set for algorithm selection or for optimizing the model hyperparameters which are the settings or tuning parameters of a machine learning algorithm that aid the control of algorithm behavior and dictate the flexibility or complexity of a model quilty and adamowski 2020 raschka 2020 solomatine and ostfeld 2008 choosing a model based on the test set leaks information from the test set to the model and produces an optimistic or biased estimate of the model performance test sets must be used only to estimate model performance because cross validation results give a more robust perspective of model generalization to new datasets they should be used instead for making model choices and final model selection falling into the traps identified above in building data driven ml models and in estimating their performance can lead to less interpretable ml models since they may then include irrelevant or redundant predictors in the model worse failing to avoid the pitfalls can lead to poorer generalization performance on unseen data and a biased estimate of the developed model s future prediction accuracy and thus uncertain unreliable model results this study therefore presents a novel model building and testing workflow with an appropriate resampling and testing process which 1 addresses the impact of uncertainty involved in the input variable selection on the bias in the estimated prediction performance while considering the uncertainty in the model structure and input data 2 addresses the variable selection bias by including the variable selection process in model building 3 prevents falling into the other pits identified above and 4 includes optional variable transformation and preprocessing techniques recent studies have identified the need to consider both input variable selection and model structure decisions within the model building framework to ensure robustness of the results kim et al 2020 quilty et al 2019 quilty and adamowski 2020 schmidt et al 2020 to the best of our knowledge this is the first paper in the field of hydrology to present a single systematic workflow to address the uncertainty of input variable selection model structure and input data simultaneously to demonstrate the performance of the proposed workflow we developed a streamflow forecasting model for the cordilleran and snowmelt dominated bow river basin in alberta canada by using ml algorithms with a combination of local hydrometeorological conditions and large scale climate indices the streamflow forecasts at monthly to seasonal time scales are themselves essential for optimal planning of water resources particularly for seasonal reservoir operation and planning such forecasts can improve water use efficiency and provide early drought and flood warning danandeh mehr et al 2014 their importance is only rising as climate change intensifies the hydrological cycle and causes more frequent and hazardous flood and drought events national academies of sciences engineering and medicine 2016 schmidt et al 2020 reliable forecasts are inherently complex and challenging because streamflow is generated by various processes with stochastic non linear and non stationary characteristics el shafie et al 2009 there are two general categories of streamflow forecasting models data driven models and process based models data driven models are more practical than process based models in cases where precise runoff forecasts are more important than an understanding of physical catchment processes liu et al 2014 such models are based on establishing statistical inference between inputs in the form of antecedent conditions such as observed flow snowpack and precipitation as well as large scale climate signals and seasonal or monthly streamflow over forecasting time horizon singh 2016 we applied and tested four different ml algorithms artificial neural networks ann support vector machines svm extreme learning machines elm and radial basis function networks rbf further multiple linear regression mlr is also included as a simple and easy to understand reference model for comparison against the relatively more complex ml algorithms note that we have selected these particular ml algorithms because more complicated approaches are not suitable for our limited input data and short historical records reliable results from a data driven model require ten times the number of observations as the degrees of freedom abu mostafa et al 2012 because of its large set of potential input variables and relatively short historical record of snowpack values which are one of the most important streamflow predictors in the area the bow river basin provides a highly relevant case study location our focus is summer season streamflow forecasting to match seasonal irrigation needs in southern alberta which accounts for over 70 of all irrigated land in canada after applying the presented workflow to our example we then further analyzed the trained models to 1 select the best ml algorithm based on its generalization performance and compare the performance of nonlinear ml models to mlr 2 test the impact of reducing dimensionality by principal component analysis pca as an optional preprocessing technique 3 determine the key predictors for streamflow in the bow river basin and 4 investigate the impact of increasing the lead time on prediction accuracy the remainder of this paper is organized as follows in the next section we review the related ml algorithm applications in the literature input variables along with their links to streamflow variability and streamflow drivers in the study area section 3 gives background on the study area section 4 presents the workflow and methodological details for data transformation preprocessing as well as variable selection and ml algorithms hyperparameter tuning prediction accuracy estimation and other evaluation measures empirical results and discussion are in section 5 while summary and concluding remarks are provided in section 6 2 background this section reviews previous studies on input variable selection and model structure uncertainties as well as applications of the machine learning algorithms to streamflow forecasting in addition it explores local hydrometeorological variables and global climate indices that are associated with the variability in streamflow and or the variability in other local variables that contribute to streamflow generation such as temperature precipitation and snow cover 2 1 uncertainty in input variable selection and model structure input variable selection is critical to the development of reliable data driven models galelli et al 2014 kim et al 2020 quilty et al 2016 quilty and adamowski 2020 recent studies show that careful variable selection can improve the model performance and that its impact on the performance is problem dependent quilty and adamowski 2020 tyralis and papacharalampous 2017 the uncertainty in input variable selection stems from the dependence of the variable selection algorithm on both the input data and the model structure used to select the variables quilty and adamowski 2018 proposed the wavelet data driven forecasting framework to address the incorrect use of wavelet based models when applied to real world forecasting problems quilty et al 2019 developed the stochastic data driven forecasting framework sddff its single wavelet based counterparts swddff and ensemble multiwavelet based version ew sddff which addressed input data input variable selection parameter and model output uncertainty in the respective models finally quilty and adamowski 2020 explored swddff and sddff by varying the level of uncertainty in the two approaches 1 none 2 model parameters 3 model parameters and output and 4 input variable selection as well as model parameters and output the inclusion of wavelet decomposition and input variable selection uncertainty led to significant gains in forecast accuracy and reliability compared to the alternatives kim et al 2020 proposed an approach to deal with uncertainty in model structure and input variable selection using a modified backward elimination procedure for a ann model this approach generates a number of input layers where each layer represents a set of the potential input variables our study addresses a gap in the literature by proposing a workflow that handles uncertainties in input variable selection model structure and input data and avoids introducing other sources of potential performance estimation bias 2 2 brief review of machine learning algorithms numerous data driven conventional and machine learning models have been applied to streamflow forecasting for decades conventional time series models such as linear regression lr multiple linear regression mlr and auto regressive integrated moving average arima have been used to forecast streamflows however they are unable to capture the non linearity of the streamflow response to the input variables hydrologists have therefore used machine learning techniques over the past two decades as flexible and robust techniques that overcome the drawbacks of conventional models and incorporate the inherent nonlinearity of hydrological datasets without their explicit definition el shafie et al 2009 he et al 2014 humphrey et al 2016 kuhn and johnson 2013 maier and dandy 2000 rieker and labadie 2012 tan et al 2018 yaseen et al 2016c artificial neural networks ann support vector machines svm and radial basis function networks rbf are the most widely used ml algorithms for streamflow modeling and forecasting yaseen et al 2015 shabri and suhartono 2012 compared the performance of svm ann and arima models for the kinta river in perak peninsular malaysia and found the svm model outperformed the others rasouli et al 2012 found that svm outperformed mlr lima et al 2016 compared linear to nonlinear approaches and found that nonlinear flow forecasting models for englishman river georgia usa and stave river bc canada had better skills than the linear models ghorbani et al 2016 compared svm ann and mlr models for big cypress river texas usa and reported that svm and ann performed better than mlr in estimating peak discharge values which mlr tended to underestimate they noted that ann was flexible but that its training was time consuming kalra et al 2013a b built svm ann and mlr models to forecast spring summer streamflow for north platte river usa the svm model outperformed the others for all tested cases the same results were achieved for an svm model for the upper colorado river basin usa kalra and ahmad 2009 carrier et al 2013 found better results for an svm model than mlr model forecasts in the western united states he et al 2014 examined ann svm and adaptive neural fuzzy inference system anfis approaches for forecasting river flow in a semiarid environment and similarly concluded that the svm model outperformed the others yaseen et al 2015 explored the literature on machine learning approaches in streamflow forecasting and concluded that svm produces accurate and robust classification results for forecasting streamflow and that it copes well with noisy data yaseen et al 2016b demonstrated superior performance of rbf over ann kisi and cigizoglu 2007 found that rbf was superior to ann and grnn for both short term and long term river streamflow forecasting in addition to ann svm and rbf extreme learning machines elm offer excellent modeling capabilities including a simple neural network structure randomly assigned weights and a fast learning process yaseen et al 2016a and can produce similar results to svm huang et al 2012 elm has also been applied in hydrological studies deo and şahin 2015 applied elm to model the monthly effective drought index they demonstrated a significant improvement in forecasting performance over ann as well as a 32 times faster training speed yadav et al 2016 found comparable performance among online sequential elm svm and ann and that the elm model had the minimum prediction error deo and şahin 2016 found the elm model for streamflow forecasting in queensland australia provided superior results to ann models importantly all the studies described above found that nonlinear models outperformed linear models and that the latter tended to underestimate peak values further although several studies found that elm rbf and svm outperformed ann no single model outperformed the others in all cases study conclusions from different locations can depend on the associated catchment hydrology and the nature of input data used so it is important to try various models and select the best model for each case therefore ann rbf svm and elm along with mlr were investigated in this study 2 3 input variables to develop a streamflow forecasting model all possible predictors of streamflow generation processes must be considered for a given study area especially in mountainous areas with high variability for a data driven forecasting model the local hydrometeorological variables typically considered are streamflow behzad et al 2009 jain and kumar 2007 kisi and cimen 2011 noori et al 2011 nourani et al 2011 precipitation behzad et al 2009 li et al 2010 noori et al 2011 nourani et al 2011 temperature behzad et al 2009 noori et al 2011 and solar radiation noori et al 2011 previous studies have also found that the use of large scale climate indices as predictors improves streamflow forecasting skill in combination with the local hydrometeorological observations for example rasouli et al 2012 reported best results for a daily streamflow forecasting model for a basin in british columbia canada that mixed local observations and climate indices especially at longer lead times of 5 7 days where the lead time represented the lag between release of the streamflow prediction and observation of the corresponding streamflow makkeasorn et al 2008 argued that large scale climate indices incorporating sea surface temperature anomalies may capture some climate change impacts and improve the forecasting accuracy because climate patterns are inter connected and no single climate index explains all climatic variability within a river basin climate indices are typically used in groups kalra et al 2013b various large scale climate indices are associated with snowpack air temperature and precipitation variability during winter and summer seasons in north america and in particular western canada the pacific decadal oscillation pdo a decadal scale oscillation characterized by the leading principal component of the north pacific sst anomalies mantua et al 1997 influences runoff timing in canada burn 2008 gobena and gan 2006 found that interdecadal streamflow signals were in good agreement with the pdo index and that their variations dominated streamflow variability in the bow river basin in the summer positive pdo phases lead to drier conditions and a higher frequency of low streamflow events bonsal and shabbar 2011 and to below normal winter precipitation and above normal winter temperatures in western canada while negative pdo phases have opposite effects bonsal et al 2001 the el niño southern oscillation enso represents the prominent interannual variability produced by equatorial pacific sea surface temperature sst anomalies hsieh and tang 2001 during the summer shabbar and skinner 2004 found that el niño events led to drier conditions while la niña events conversely produced excess moisture over western canada likewise el niño events have been shown to produce warmer winter weather slightly higher than normal snowfall and increased spring streamflows while la niña produces the opposite effects which are more concentrated in western canada hsieh and tang 2001 the traditional index for enso in the pacific ocean is called the southern oscillation index soi which measures the difference in sea level pressure occurring between tahiti and darwin during el niño or la niña events ladd and gajewski 2009 several other indices related to enso also monitor the sst anomalies averaged across a given region in the tropical pacific niño1 2 niño3 niño3 4 and niño4 gobena and gan 2009 moradi et al 2020 the pacific north american pattern pna relates temperature and precipitation anomalies across north america to conditions over the pacific ocean and is strongly related to snow cover variability over north america brown and goodison 1996 a higher pna index is related to lower snow cover and a positive pna is associated with above average temperatures over western canada in alberta positive pna is associated with below average winter precipitation and reduced snow cover bonsal and shabbar 2011 brown and goodison 1996 pna effects on streamflow vary regionally over southwestern canada gobena and gan 2009 finally the atlantic multidecadal oscillation amo represents sst variability in the north atlantic ocean the positive phase of the winter amo tends to be associated with dry summer conditions over the central and northern regions of the canadian prairies bonsal and shabbar 2011 3 study area the bow river watercourse is 587 km long stretching from the bow glacier in the canadian rockies eastward through the city of calgary to its confluence with the oldman river west of medicine hat alberta and drains an area of 25 300 km2 the annual precipitation exceeds 700 mm in its mountainous headwaters but then decreases significantly eastward to give 330 mm of mean annual precipitation the bow has a higher natural flow yield than its three surrounding subbasins because of the large portion of its basin within the rockies its streamflow typically peaks during the spring summer melt freshet however variable topography low average annual precipitation 600 mm and high winds particularly in the mountainous portion of the basin that generates most of the runoff render the basin prone to water shortages and emphasize the importance of reliable runoff forecasts to support water managers decisions the bow river basin is important for irrigation of the total water allocations in the bow river basin 77 or the total sum of water license of 1 160 000 dam3 year is allocated to three irrigation districts that comprise a total of 259 600 hectares while about 10 is allocated to the city of calgary alberta agriculture and forestry 2020 fig 1 shows the study location the bow river streamflow in the summer months clearly exhibits high natural variability fig 2 water managers in alberta currently use rocky mountain snowpack survey values reservoir winter storage levels modeled soil moisture content in the spring and normal seasonal rainfall volumes and temperatures to estimate the water supply and to plan for the next irrigation season however the forecasts are uncertain and relying on them for planning poses risks for irrigators and other users jean and davies 2016 as shown below machine learning models can significantly improve streamflow forecasting accuracy 4 methods to address the variable selection bias and other pitfalls identified above we introduce here a novel workflow with five main stages 1 data collection and preparation 2 data partitioning for training and validation and for testing and performance evaluation 3 model building with optional data transformation and preprocessing variable selection and hyperparameter tuning 4 model training with the best identified ml algorithm selected variables and tuned hyperparameters on the entire training validation set and 5 final model testing using the test dataset the workflow features two resampling or cross validation loops an outer loop for application of the variable selection algorithm to identify the predictor set with the minimum residual sum of squares rss and an inner loop for application of the exhaustive search or grid search algorithm to identify the optimal hyperparameters corresponding to the minimum rss note that the workflow can accommodate other hyperparameter tuning algorithms such as random search algorithms fig 3 shows the complete model building and testing workflow which is flexible and can be applied to any ml algorithm variable selection algorithm and resampling method sections of fig 3 associated with the five stages of the workflow listed above are indicated in the figure while further details on these stages are provided below 4 1 data collection and preparation the first stage of model building is data collection for both local hydro meteorological variables and large scale climate indices for the bow river basin local scale historical records of monthly average precipitation minimum maximum and average temperatures snow water equivalent average humidity and estimated solar radiation data as well as streamflow data generated as monthly averaged naturalized historical flow records were collected for the upper bow river watershed in southern alberta data from mountainous upstream areas of the bow river basin is critical because a substantial portion of the runoff comes from this area however relatively fewer stations exist in this mountainous area compared to the foothills and records are short and sometimes incomplete of the 21 active snow courses in the area nine records begin in 1970 while the remaining stations date from 1981 with some missing records snow water equivalent swe data were extracted from snow course data obtained from alberta environment and parks darcy talma personal communication 2020 monthly average swe for individual stations with 20 years of data or more were used township data from alberta agriculture and forestry aaf was used for historical precipitation temperature humidity and estimated solar radiation records https agriculture alberta ca acis alberta weather data viewer jsp aaf interpolates and averages township data from up to eight nearby meteorological stations for each township in alberta for the 50 townships within the basin boundaries the interpolated data were downloaded and averaged over the basin table 1 lists the local hydrometeorological input variables used in the study and their sources eleven potential large scale climate indices were also tested as potential input variables five of the selected indices represent the el niño southern oscillation enso niño1 2 niño3 niño3 4 and niño4 and the southern oscillation index soi the other six indices include the atlantic multidecadal oscillation amo the arctic oscillation ao the north atlantic oscillation nao the north pacific index np the pacific decadal oscillation pdo and the pacific north american pattern pna because previous studies found that using new indices constructed by spatially averaging climate data offered no obvious advantage gobena and gan 2009 we used only standard climate indices available in the literature table 2 lists the eleven large scale predictors and their sources monthly time series of the abovementioned indices were retrieved from the listed websites after collection of all the data local and global predictor variables were grouped into three different input datasets for forecasting seasonal runoff s1 included only climate index predictors from 1950 to 2019 i e no local predictor variables s2 included a combination of local observations and climate indices from 1970 to 2019 and s3 built on s2 with more comprehensive and complete swe records but a shorter record of 1981 to 2019 table 3 summarizes the statistical characteristics of the summer streamflow for the full period of the input dataset 4 2 data partitioning training validation and testing sets before any transformation or preprocessing of the input data the entire dataset was partitioned into training and test sets the ratio of the test set to the entire dataset is somewhat arbitrary and depends on the number of observations in the input dataset and the type of application typical values range from 20 to 40 we used 30 of the entire dataset for testing which falls within the typical range identified and 70 for training validation 4 3 model building 4 3 1 data transformation and preprocessing to ensure the input variables in each dataset shared a common scale that avoided distorting variations in the values each of the three input datasets was 1 normalized to a mean of zero by subtracting the average value of each variable and 2 adjusted to a standard deviation of one by dividing each variable by its standard deviation normalization improves the numerical stability of calculations kuhn and johnson 2013 and may also speed up ml model tuning as an optional data preprocessing step principal component analysis pca transforms input variable sets into smaller groups or principal components pc that capture most of the information in the original set by finding linear combinations of them by reducing the dimensionality of the modeling problem pca can improve model handling of the input variables dehghani et al 2014 noori et al 2011 schmidt et al 2020 wilks 2019 in addition it eliminates dependencies between input variables by creating uncorrelated predictors to study its effect on prediction accuracy input variables were transformed in this study into principal components which were then ordered and a scree plot used to retain the components that represented 95 of the variability in the data schmidt et al 2020 finally data transformation and preprocessing where applicable was used as a part of the cross validation process hastie et al 2009 quilty and adamowski 2018 to avoid leaking information about the mean and the variance of the validation set to the training data 4 3 2 selection of input variables although it is important to consider many potential predictors as input to an ml model a smaller number of input predictors improves the chances of finding the best model for the output or target variable by reducing the number of possible candidate models liu and motoda 2007 the goal of variable selection is to find the optimal combination of predictors that maximizes the overall prediction accuracy the method for best predictor selection removes irrelevant and redundant predictors and generates more reliable forecasts further a reduced set of predictors simplifies the model and reduces data collection costs to select predictors we adopted a stepwise variable selection algorithm that starts by choosing the single best variable identified as the single variable model that has the minimum residual sum of squares the model accuracy is then improved in a stepwise manner by adding the variable that reduces the residual sum of squares by the next largest amount with subsequent additions of input variables one at a time the forward stepwise selection is a greedy algorithm once it includes a predictor in the model it cannot remove it later therefore a better algorithm must also account for the fact that some variables become redundant predictors that improved prediction accuracy at an earlier stage of the selection process may subsequently reduce the overall prediction accuracy therefore we coupled it with a backward elimination algorithm that reexamined all the previously selected variables for inclusion or exclusion after each new variable was selected this addition and removal of predictors continued until all those that improved the overall prediction accuracy were added and no further addition to improve performance was possible the advantage of using the stepwise variable selection algorithm a wrapper approach over a filter type variable selection algorithm is that the stepwise approach directly evaluates model performance when the input variables are used in combination rather than considering only highly influential input variables that can have their potency negated when used in combination kuhn and johnson 2019 liu and motoda 2007 although a third variable selection methods class called embedded methods can be more efficient and less computationally expensive than the wrapper methods their application is restricted to specific ml algorithms if the modelled process can be better fit by a ml algorithm that does not have an embedded method then the prediction performance of the developed model is sub optimal whereas the application of the wrapper methods is generic to any ml supervised learning algorithm kuhn and johnson 2019 embedded methods can perform variable selection as a part of the model building process and avoid variable selection bias however it is important to exercise caution when comparing the performance across different machine learning algorithms and their respective embedded methods or wrapper filter methods if different feature selection algorithm types were used to avoid introducing other biases into the comparison such as resubstitution validation inconsistent validation sets across different algorithms and model selection using the testing set 4 3 3 ml algorithms and hyperparameter tuning the streamflow forecasting models were based on antecedent conditions represented by input variables in monthly forms and lagged by 1 12 months to represent conditions up to one year ahead of the forecast issue date further to study the effect of lead time on the forecasting accuracy an additional six datasets were prepared containing only input variables available at the time of prediction the tested lead times ranged from one to six months shorter lead times made more variables available to the model and hence improved accuracy the longest lead time six months corresponded to october of the previous year october is the start of the water year in canada and the obtained forecasting accuracy was low enough that longer lead times than six months were unnecessary the lead times of 1 6 months are the same for the seasonal may june and july models further predicting average seasonal june and july streamflows after the spring melt has no practical value therefore forecasts were not produced after the end of april for the four cases and longer lead times were calculated at monthly time steps for each month from october of the previous year to march of the current year for swe we used both basin averages section 4 1 and values from individual snow courses for which the model was allowed to assign weights separately five different model types were assessed for seasonal and monthly streamflow forecasting multiple linear regression mlr artificial neural network ann support vector machine svm extreme learning machine elm and radial basis function neural network rbf a total of 76 models was developed first two sets of twenty models were developed including seasonal may june and july models for each of the five ml algorithms 4 models x 5 algorithms one of these sets of 20 models included preprocessing with pca while the other set of 20 models did not the models with pca are called mlr pc ann pc svm pc elm pc and rbf pc below further to investigate the impacts of longer lead times and compare between datasets s1 s2 and s3 an additional 36 rbf models were developed including 24 rbf models for seasonal and monthly forecasted streamflows with lead times up to six months four rbf models to compare between datasets s2 and s3 and eight rbf models to compare datasets with only local hydrometeorological variables part of dataset s2 or global climate indices dataset s1 4 3 3 1 multiple linear regression mlr multiple linear regression mlr can produce a simple fast and easy to understand reference model for comparison against the machine learning models linear regression assumes the streamflow is a linear combination of the input variables the general form of the mlr model is bishop 1996 1 f x c o c 1 x 1 c 2 x 2 c n x n where f x is the forecasted streamflow x 1 x 2 xn are n numbers of independent variables c 1 c 2 cn are the unknown values of the coefficients and is the error term these values represent the local behavior and are estimated by the least square method 4 3 3 2 artificial neural network ann neural networks are a class of flexible nonlinear models with an appropriate number of nonlinear processing units neural networks can learn from historical data and estimate any complex functional relationship with high accuracy the most popular ann for time series forecasting is the feed forward model dehghani et al 2014 noori et al 2011 yaseen et al 2015 structurally an ann consists of an input layer that receives external information an output layer and one or more intermediate hidden layers that separate the input and output layers miller and forte 2017 in this study each feed forward ann was trained with the standard backpropagation algorithm to minimize the mean squared error using gradient descent to calculate the error function gradient iteratively and with sigmoidal and linear type activation functions for the hidden and output layers respectively a single hidden layer feedforward networks slfns with a nonlinear activation function and a number of hidden neurons nh less than or equal to the number of distinct samples ns can approximate any function and learn with zero error huang and babri 1998 an exhaustive or grid search was used to find the optimum structure of the ann which involved trials of all possible hidden neuron numbers between 2 and ns and selection of nh associated with the least error across all the samples in addition values from zero to 40 were investigated for the regularization or weight decay parameter to avoid under fitting we set the maximum number of epochs or iterations to 1 0e 6 to ensure that this number is not reached before the error is below the absolute tolerance 1 0e 4 or the optimizer becomes unable to reduce the error by 1 0e 8 4 3 3 3 support vector machine svm originally developed by vapnik 2000 svm is one of the most effective prediction models it uses kernel functions to transform complex nonlinear input variables into linear form by mapping them into a higher dimensional space to allow for a linear solution in the higher space that matches the nonlinear solution in the initial nonlinear space svm is expressed by 2 f x i 1 ns w i k x x i b b where wi and b b are the model parameters ns is the number of training samples to be estimated k x xi is the kernel function and f x is the forecasted streamflow çimen 2008 the model parameters are determined by minimizing the regularized empirical risk function çimen 2008 3 r r e g f x c x i x l ε y i f x 1 2 w 2 where c is the cost parameter a regularization parameter that influences the tradeoff between model complexity and approximation error and l ε is the loss function which is the standard vapnik s ε intensive loss function in this study the radial basis function kernel was used çimen 2008 4 k x x i e x x i 2 2 σ 2 and an exhaustive search was conducted to find the cost and sigma tuning parameter 4 3 3 4 extreme learning machine elm an elm is structured as a single layer feed forward neural network slfn with a faster more computationally efficient algorithm than the backpropagation and support vector machine algorithms among others ali et al 2018 the enhanced performance is linked to the randomization of the input weights and biases lima et al 2015 such that the output weights have unique least squares solutions obtained by the moore penrose generalized inverse function huang and siew 2004 considering ns training data samples the slfn can be expressed by huang et al 2004 5 f x i 1 a b i g w i x i b i where bi represents output weights to be estimated for the hidden layers with a hidden nodes g is the activation function wi and bi are the weights and biases and f x is the forecasted streamflow an exhaustive search was used to determine the optimum structure and activation function of the elm numbers of hidden nodes between 1 and 10000 were tested as well as sigmoid sine radial basis hard limit symmetric hard limit satlins tan sigmoid triangular basis and positive linear activation functions the number of hidden neurons and the activation functions were optimized for the minimum residual sum of squares and the associated optimal setting was selected in the output layer which generated the streamflow forecast a linear transfer function was adopted a common practice in hydrological time series forecasting deo and şahin 2015 4 3 3 5 radial basis function network rbf rbf is a class of adaptive networks that was first introduced by broomhead and lowe 1988 an rbf shares the same slfn structure as elm and ann with three layers input hidden and output the hidden layer uses a gaussian radial basis activation function rather than the sigmoid function used by ann a radial basis function is any real valued function whose value only depends on an arbitrary distance measure between an input value and a center where the input value is the data point at which the function is evaluated according to another data point which is the center and the absolute difference between the two points is the distance which represents the effect of the center on the neighboring points and is inversely proportional to its square root in our study a linear type function was used for the output layer an exhaustive search was used to find the optimum number of hidden nodes of the rbf with values between 2 and ns investigated the number of hidden neurons nh associated with the minimum residual sum of squares was selected 4 3 4 model calibration and performance evaluation a cross validation scheme with observations split randomly into 10 subsets of equal size folds was employed to investigate the forecasting skill of the models one subset was treated as the validation set 10 and the remaining subsets 90 formed the training set the model was then trained with the training set and evaluated with the validation set the process was repeated until each subset had been used as a validation set comparison of model predictions and test set observations formed the basis of performance measure estimations this 10 fold cross validation approach was used because it balances the error bias with the variance and is commonly used in practical machine learning applications abu mostafa et al 2012 kuhn and johnson 2013 solomatine and ostfeld 2008 the cross validation was repeated 3 times to estimate model performance for 30 different validation sets which can efficiently increase the precision of the estimated cross validation performance while retaining a small bias kuhn and johnson 2013 and give a robust estimate of the generalization performance and the variability that might affect the results if different resamples were considered finally all transformations and preprocessing of training subsets were implemented within the cross validation scheme to avoid bias in the performance estimation through information potentially leaked from the training to the validation set we used two resampling loops to properly resample the variable selection process an outer loop encompassed the entire training validation process and applied the variable selection algorithm within which split the training validation data to 90 for training and 10 for validation an inner loop then further split the training data 90 from the outer loop to 90 for training and 10 for validation for use in optimizing and tuning model hyperparameters using two resampling loops can significantly reduce the chances of over fitting the predictors boulesteix and strobl 2009 kuhn and johnson 2019 2013 the outer loop was repeated q n k times where q is the number of steps required for the variable selection algorithm to stop and n and k are the number of repetitions and folds of the outer loop respectively the inner loop was repeated n k times each time the outer loop was called where n is the number of repetitions and k is the number of folds of the inner loop it should be noted that each time a validation set stage 3 or test set stage 5 is passed to the model it is transformed using the transformation parameters calculated from the respective training set further ppredictions generated from the developed models where the target variable was transformed must be back transformed to their original scale before calculating the rss this back transformation must be applied multiple times when estimating the rss during validation inside the inner and outer loops as well as when testing the performance of the final model the trained and validated models were evaluated with statistical measures of goodness of fit and absolute error as recommended by legates and mccabe 2005 models with higher goodness of fit and minimum values of rmse and mean absolute error mae are recognized to perform better than other models our study applied the mae rmse mean absolute percentage error mape coefficient of determination r2 and nash sutcliffe coefficient of efficiency nse measures 4 4 final model training and testing the model with the best generalization performance in the training validation process was then selected and trained on the training validation dataset and the prediction accuracy over the test set was estimated because of the short length historical record available we implemented preliminary runs using the outlined model building process shown in fig 3 in the preliminary runs we used 70 of the entire datasets for training validation and 30 for testing we applied stepwise variable selection and compared the performance of the five ml algorithms the combination of input variables and ml with the best generalization performance was selected as the final model and tested with the test set then we empirically estimated the bias in the prediction accuracy which is the relative difference between the model performance estimated using the validation sets and a separate test set on future data using only the cross validation results further to compare between datasets s1 s2 and s3 we used 30 of dataset s3 as the test set to ensure similar test set size and target variable values across the three datasets variable selection algorithms and machine learning methods were applied using the r programming language r core team 2020 specifically the caret kuhn 2020 rsnns bergmeir and benítez 2012 kernlab karatzoglou et al 2004 and dplyr wickham et al 2020 packages 5 results and discussion the results and discussion focus on dataset s2 which outperformed both s1 and s3 forecasts obtained using dataset s3 were less reliable because of its shorter training record additionally dataset s1 had a longer training record but a smaller number of input variables which affected the forecasting accuracy to illustrate this point table 4 compares results among input datasets s1 s2 and s3 for their four best performing models which were rbf models in all cases dataset s3 is omitted from further discussion while s1 will be discussed later in the comparison between global and local input variables in addition the prediction accuracy bias was empirically estimated using the average out of sample cross validation and a separate test set and was found to be very small for example the seasonal may june and july rbf models without pca had an estimated prediction accuracy from the training validation process of approximately 20 54 22 27 36 38 and 23 49 m3 s respectively the rmse calculated using a separate test set for the seasonal may june and july models were 21 75 21 32 37 33 and 22 8 m3 s respectively hence the average estimated prediction performance bias was less than 1 2 m3 s 5 5 4 4 2 5 and 3 0 for the seasonal may june and july models respectively therefore the presented workflow can give a reasonable estimate of the prediction accuracy on the test set using cross validation average out of sample results additionally because of the short historical record where every data point is potentially needed to determine model parameters from this point on we relied on the repeated cross validation process to estimate the prediction accuracy kuhn and johnson 2013 while keeping in mind that a small bias may exist in this estimate table 5 lists the average out of sample performance measures for dataset s2 for the period of 1970 2019 for the seasonal may june and july models fig 4 summarizes the overall performance evaluation measures for the twenty machine learning models the tuned mlr ann svm elm and rbf monthly and seasonal forecasting models including the median interquartile ranges and outliers for the 30 3 times repeated 10 fold cross validation out of sample forecasts each for the period 1970 2019 the nonlinear models all outperformed the seasonal and monthly mlr models and the rbf model provided the best average prediction accuracy and performance consistency across different resamples the svm model had overall better forecasting accuracy and evaluation measures smaller mae and rmse higher r2 and nse than both the elm and ann models fig 5 compares the rbf summer season and monthly forecasting models against the observed streamflow for the period from 1970 to 2019 for the seasonal may june and july streamflows the average rbf out of sample forecasts over the period from 1970 to 2019 had coefficients of determination of 0 9 0 8 0 82 and 0 88 and nse coefficients of 0 82 0 72 0 75 and 0 80 in addition to model performance evaluation we investigated all model predictors and extracted their relative importance measured as the accumulated percentage decrease in the estimated error for each predictor added to the model values are shown in fig 6 while different models selected different predictors for the four monthly and seasonal streamflows they shared many common attributes first the dominant variables selected in the four cases were the snow water equivalent swe from individual snow courses the swe at sunshine village in march and or april was the top predictor for the seasonal june and july models and the 6th most important predictor in may perhaps because of the central location of the sunshine village snow course in the mountainous portion of the watershed among the global climate indices the pdo in september was the 2nd most important predictor for june forecasts and the pdo values in may and june of the previous year were among the top ten predictors in the july forecasting model inputs from other global climate indices such as the amo and pna were also important in some forecasts further the importance of global climate indices increased with the length of the forecast lead time as in the cases of the june one month lead time and july two months lead time models the arctic oscillation ao the north atlantic oscillation nao the north pacific index np were unimportant for all four models in addition soi and other el niño indices were not good predictors despite their general connection to snow cover variability and temperature in the study area this result may be attributed to the fact that responses to enso events vary substantially bonsal and shabbar 2008 although may streamflows did not exhibit as much variability as june streamflows fig 2 they had the least accurate predictions further the interannual variability in the may streamflows explained by the may prediction models was the lowest across all model types as shown by the r2 value in table 5 we therefore investigated the factors related to best versus worst performance for the may models focusing on two sets of ten years one set with the highest residuals worst performance and the other with the lowest residuals best performance as shown in fig 7 revealed that the most difficult years to predict were those with a significantly lower may streamflow which has a median of 0 13 compared to a median of 0 4 for the best years while there was no clear difference based on the full summer season streamflow whether the year in question was dry or wet given no clear difference in the total seasonal streamflow the worst years were likely those in which the snowpack melted later in june as indicated by the significantly lower minimum and maximum temperatures in may which have medians below 0 3 and 0 2 for the worst years compared to medians greater than 0 5 for best years and higher june streamflow values which nullified the predictive power of the snowpack the most important predictor of may streamflow as shown in fig 6 the same conclusion results from a recognition that the worst years were generally colder than the best years particularly in terms of the may maximum temperature as shown in fig 7 in contrast there was no significant difference in may precipitation for the best and worst years which suggests that the snowpack melt for the worst years resulted from an increase in maximum temperature rather than rain on snow events finally note the difference in the soi values between the best and worst years which indicates that may streamflows in la niña years were harder to predict although a number of studies have suggested the use of pca dehghani et al 2014 hao et al 2018 mortensen et al 2018 noori et al 2011 salas et al 2011 its value for predictor preprocessing to improve model accuracy is not clearly established therefore we investigated predictor preprocessing with pca using dataset s2 for both seasonal and monthly models with the effects on rmse shown in fig 8 clearly pca decreased forecasting accuracy with the average prediction error increasing in almost all cases except for the mlr in july this result shows that for carefully selected and uncorrelated input predictors and nonlinear models using pca may still eliminate important information this behavior can be attributed to one or more of the following reasons 1 pca does not consider the target variable when summarizing variability 2 pca is a linear transformation for the input variables which require different treatment by nonlinear models and 3 the loss of important information resulted from retaining only the principal components comprising 95 of the variance kuhn and johnson 2013 results from three sets of predictors were compared in order to clarify the effect of global climate indices on projection accuracy 1 hydrometeorological variables combined with global climate indices 2 local hydrometeorological variables only and 3 global climate indices only input dataset s2 provided the combination of hydrometeorological and climate index values local hydrometeorological predictors alone were obtained from s2 by omitting global climate indices from the dataset global climate index predictors were obtained from dataset s3 fig 9 shows the effect of the three input datasets on the forecasting performance incorporating the global climate indices in the predictor set clearly improved the model forecasting skill significantly while using local climate indices only caused a 10 25 reduction in forecasting skill adding global climate index predictors clearly improved streamflow prediction accuracy particularly at longer lead times finally fig 10 shows the forecasting performance for longer lead times of one to six months for the seasonal june and july forecasts the forecasting skill in march at a one month lead time was lower than in april but the loss in skill was small in comparison with cases of more than two month lead time october february of practical significance for government agencies and water managers although forecasting skill decreased with increasing the lead time satisfactory forecasts nse 0 5 could also be obtained two months in advance of the spring melt in february 6 summary and conclusions data driven modeling with ml algorithms is one of the most rapidly developing topics in the field of hydrologic modeling and forecasting especially for its ability to exploit increasing volumes of available data however the complexity of the models and their ability to extract useful information from input data requires following a careful model building process this study identified and addressed pitfalls and challenges facing data driven ml modeling in hydrology with a novel workflow fig 3 that avoids both by representing the uncertainty involved in variable selection further it leads to better generalization performance on unseen data with unbiased estimation of the prediction accuracy the workflow addresses selection bias by considering variable selection as a part of the model building process and using two resampling or cross validation loops to reduce the chance of overfitting to the predictors it also uses repeated k fold cross validation to avoid the resubstitution validation problem the workflow has a consistent generic model building process applicable to any ml algorithm that allows an equal effect of the performance estimation bias on all models which is important for cases where relatively short historical records will not permit the use of a test set it also limits the role of the test set to estimate the prediction accuracy rather than model selection finally it ensures that input variable transformation and preprocessing occur inside cross validation to avoid leaking information about the mean and variance of the validation data to the training data the flexibility of the workflow for application to any ml model variable selection algorithm or resampling method allows it to serve as a guide for future machine learning studies in hydrology to demonstrate the performance of the new workflow we developed 76 monthly may june and july and seasonal streamflow forecasting models for a study location with a relatively short historical record and a large number of predictors compared to samples the cordilleran snowmelt dominated bow river basin in alberta canada we used four different ml algorithms ann svm elm and rbf and compared them against a more traditional multiple linear regression approach in applying the new workflow we first empirically estimated the bias in the prediction accuracy using the cross validation results and a separate test set and found the bias to be very small less than 1 m3 s 5 this result indicated that following a robust and appropriate resampling and validation process presented in the workflow improved our estimates of the generalization performance which guides the selection of more accurate models the performance of each ml model was evaluated using standard statistical metrics mean absolute error mae root mean square error rmse coefficient of determination r2 and nash sutcliffe model efficiency coefficient nse the rbf performed best of the five model types in terms of average prediction accuracy and consistency in performance across different resamples specifically for the seasonal and monthly predictions rbf out of sample forecasts over the period from 1970 to 2019 had coefficients of determination of 0 90 0 80 0 82 and 0 88 and nash sutcliffe efficiency coefficients of 0 82 0 72 0 75 and 0 80 preprocessing input variables with pca was found to be detrimental to prediction accuracy the relative importance of each predictor on model accuracy was investigated in terms of the reduction in model error with its inclusion swe was the most important predictor for seasonal and monthly models further using swe values from individual snow course stations with an individual assignment of model weight for each station produced better results than an average swe over the basin for the seasonal models swe measures in march and the previous year s summer temperature and precipitation were the most important predictors for the may models prediction accuracies were significantly affected by a late snowpack melt in june an aggregated seasonal forecast abated such temporal effects further including global climate indices especially the pacific decadal oscillation index atlantic multidecadal oscillation index and pacific north american pattern index improved nash sutcliffe coefficient of efficiency by 6 to 50 of practical significance for government agencies and water managers we found that although forecasting skill decreased with increasing forecast lead time satisfactory forecasts nse 0 5 could be obtained two months in advance of the spring melt at the end of february we also found that a combination of global climate indices and local hydrometeorological variables led to improved models and forecasting performance therefore reliable seasonal and monthly streamflow forecasts could be obtained for the bow river basin using rbf and a combination of local hydrometeorological conditions and large scale climate indices rbf forecasts can be applied to support integrated water resources management in alberta extensions of this study should focus on improving understanding of the tendency of different variable selection algorithms to pick irrelevant or redundant predictors with changes in training data better understanding of variable selection algorithms can also improve a major drawback of the proposed workflow high computational complexity by finding simpler variable selection algorithms that can lead to similar streamflow forecasting model accuracy additionally exploring an emerging paradigm theory guided data science may improve the interpretability of ml models by limiting the search space through imposing background knowledge of the modeled process babovic 2009 chadalawada et al 2020 herath et al 2020 karpatne et al 2017 the application of the presented workflow could be extended to modeling at finer temporal time resolutions such as weekly or even daily the supplementary materials demonstrate the impact of increasing the number of observations or of modeling at finer temporal resolutions on the workflow runtime for different ml algorithms they show that a relative increase in the number of observations by 80 times can lead to a relative increase in the measured runtimes from a minimum of 2 5 elm to a maximum of 40 times svm with an average of 14 times greater finally we encourage other researchers to experiment further and evaluate the application of the presented workflow to forecast different processes including rainfall evaporation and urban water demand credit authorship contribution statement amr gharib conceptualization methodology formal analysis software writing original draft evan g r davies supervision conceptualization formal analysis writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we thank dr nesa ilich for his valuable contributions and revisions and for his provision of the naturalized streamflow data we also thank dr john quilty of the university of waterloo and two anonymous reviewers for their helpful comments on and revisions to the manuscript this work was supported financially by the university of alberta mitacs accelerate fellowship and optimal solutions ltd it also benefited indirectly from funding to project ai 2336 seasonal operational model for water management within irrigation districts of alberta innovates with matching support from the city of calgary and the bow river brid eastern eid raymond rid st mary river smrid taber tid and western wid irrigation districts in alberta canada supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2021 103920 appendix supplementary materials image application 1 
307,data driven modeling with machine learning ml algorithms in hydrologic modeling and forecasting suffers a number of pitfalls and challenges including variable selection bias resubstitution validation inconsistent validation processes for different algorithms and model selection using the test set they lead to incorrect model development and biased overly optimistic performance estimates and thus unreliable models this study presents a novel model building and testing workflow that addresses common machine learning ml challenges and pitfalls the presented workflow incorporates optional variable transformation and preprocessing techniques and applies to various ml model types variable selection algorithms and resampling techniques we demonstrate its performance through streamflow forecasting for the bow river basin alberta canada using four conventional ml algorithms ann svm elm and rbf networks driven by local hydrometeorological conditions and large scale climate indices using the cross validation average out of sample results and a separate test set the prediction accuracy estimate bias the relative difference between the model performance estimated using the validation sets and a separate test set was empirically estimated to be 5 6 4 4 2 5 and 3 0 for the seasonal may june and july models respectively in addition the streamflow forecasting models had an average coefficient of determination of 0 85 preprocessing and dimensionality reduction through principal component analysis pca was detrimental to prediction accuracy snow water equivalent from individual snow courses proved the most important predictor for bow river streamflow while global climate indices including the pdo amo and pna increased the nash sutcliffe efficiency by 6 to 50 finally although forecasting skill decreased with increasing forecast lead time satisfactory forecasts nse 0 5 could be obtained two months in advance of the spring melt at the end of february extensions of this study should address the tendency of different variable selection algorithms to pick irrelevant or redundant predictors after changes in training data keywords machine learning data driven modeling model workflow variable selection seasonal streamflow forecasting forecast lead time 1 introduction data driven modeling with machine learning ml algorithms is one of the most rapidly developing topics in the field of hydrologic modeling and forecasting in addition to streamflow forecasting ml algorithms have been applied to areas such as urban water demand forecasting estimation of flow duration curves at ungauged sites and rainfall runoff modeling schmidt et al 2020 however both model development and performance estimation of data driven ml models for such applications suffer a number of challenges and pitfalls quilty and adamowski 2018 schmidt et al 2020 solomatine and ostfeld 2008 wu et al 2013 zhang et al 2015 zheng et al 2018 such common challenges and pitfalls include variable selection bias resubstitution validation and inconsistent validation processes and resamples for different algorithms as well as model selection by the test set a key challenge facing ml applications is variable selection bias which results in the selection of irrelevant or redundant predictors selection bias occurs when the same data are used both to create a model from a training set and to select the associated input predictors in practice this means that the variable selection process was not considered part of the model building process kuhn and johnson 2013 liu and motoda 2007 quilty and adamowski 2020 schmidt et al 2020 it leads to improved performance for the same data set when compared with model development without selection bias however the results are sensitive and repeating the same variable selection process with a slightly different training set can lead to different results because the uncertainty from the variable selection process can be far greater than the uncertainty of the model ambroise and mclachlan 2002 quilty and adamowski 2020 even if the best predictors are selected the performance estimates from this process are biased because they do not reflect the uncertainty involved in the variable selection process and its impact on this result kuhn and johnson 2013 quilty et al 2019 quilty and adamowski 2020 short historical records large numbers of predictors and complex and powerful ml models increase the likelihood of selection bias and all are commonly encountered in applying ml algorithms to hydrologic modeling and forecasting another common pitfall involves testing a model with the same data used to train it which is called resubstitution validation raschka 2020 wu et al 2013 zheng et al 2018 this second pitfall produces an overly optimistic performance estimation due to overfitting solomatine and ostfeld 2008 wu et al 2013 which causes a model to match the training data too well such that it applies more poorly to unseen data or data that was not included in the training set to train the model properly and avoid overfitting an additional validation dataset is required a popular approach uses k fold cross validation to build the model and ensure it generalizes to unseen data however using cross validation to estimate the model performance could lead to biased estimates the cross validation estimate is biased since the model was already exposed to the data in the validation set which guided the selection of the variables algorithm model structure and hyperparameter values during model training and validation raschka 2020 solomatine and ostfeld 2008 if a test set cannot be used because of limited historical records performance estimates from the cross validation only are likely overly optimistic in terms of prediction accuracy however for comparing among a set of models and selecting the best model the biased optimistic estimates from cross validation can be used given that the performance estimations of all models are affected evenly raschka 2020 a third pitfall involves the use of different validation processes and resamples for different algorithms both cross validation and resampling processes must be consistent across the different algorithms under consideration in order to ensure the performance estimation bias affects them equally and that the model behaviors and error ranges are comparable between different algorithms in partitioning data between training and validation datasets any data transformation or preprocessing must be applied as part of the cross validation process and not performed independently in advance hastie et al 2009 quilty and adamowski 2018 since it could otherwise 1 leak information about the mean and the variance of the validation set to the training data if the full training validation dataset was preprocessed independently in advance or 2 compromise the test data if the entire dataset is used such leaks influence both model selection and the estimation of the model s generalization performance and prediction accuracy on unseen data a fourth related pitfall is using the test set for algorithm selection or for optimizing the model hyperparameters which are the settings or tuning parameters of a machine learning algorithm that aid the control of algorithm behavior and dictate the flexibility or complexity of a model quilty and adamowski 2020 raschka 2020 solomatine and ostfeld 2008 choosing a model based on the test set leaks information from the test set to the model and produces an optimistic or biased estimate of the model performance test sets must be used only to estimate model performance because cross validation results give a more robust perspective of model generalization to new datasets they should be used instead for making model choices and final model selection falling into the traps identified above in building data driven ml models and in estimating their performance can lead to less interpretable ml models since they may then include irrelevant or redundant predictors in the model worse failing to avoid the pitfalls can lead to poorer generalization performance on unseen data and a biased estimate of the developed model s future prediction accuracy and thus uncertain unreliable model results this study therefore presents a novel model building and testing workflow with an appropriate resampling and testing process which 1 addresses the impact of uncertainty involved in the input variable selection on the bias in the estimated prediction performance while considering the uncertainty in the model structure and input data 2 addresses the variable selection bias by including the variable selection process in model building 3 prevents falling into the other pits identified above and 4 includes optional variable transformation and preprocessing techniques recent studies have identified the need to consider both input variable selection and model structure decisions within the model building framework to ensure robustness of the results kim et al 2020 quilty et al 2019 quilty and adamowski 2020 schmidt et al 2020 to the best of our knowledge this is the first paper in the field of hydrology to present a single systematic workflow to address the uncertainty of input variable selection model structure and input data simultaneously to demonstrate the performance of the proposed workflow we developed a streamflow forecasting model for the cordilleran and snowmelt dominated bow river basin in alberta canada by using ml algorithms with a combination of local hydrometeorological conditions and large scale climate indices the streamflow forecasts at monthly to seasonal time scales are themselves essential for optimal planning of water resources particularly for seasonal reservoir operation and planning such forecasts can improve water use efficiency and provide early drought and flood warning danandeh mehr et al 2014 their importance is only rising as climate change intensifies the hydrological cycle and causes more frequent and hazardous flood and drought events national academies of sciences engineering and medicine 2016 schmidt et al 2020 reliable forecasts are inherently complex and challenging because streamflow is generated by various processes with stochastic non linear and non stationary characteristics el shafie et al 2009 there are two general categories of streamflow forecasting models data driven models and process based models data driven models are more practical than process based models in cases where precise runoff forecasts are more important than an understanding of physical catchment processes liu et al 2014 such models are based on establishing statistical inference between inputs in the form of antecedent conditions such as observed flow snowpack and precipitation as well as large scale climate signals and seasonal or monthly streamflow over forecasting time horizon singh 2016 we applied and tested four different ml algorithms artificial neural networks ann support vector machines svm extreme learning machines elm and radial basis function networks rbf further multiple linear regression mlr is also included as a simple and easy to understand reference model for comparison against the relatively more complex ml algorithms note that we have selected these particular ml algorithms because more complicated approaches are not suitable for our limited input data and short historical records reliable results from a data driven model require ten times the number of observations as the degrees of freedom abu mostafa et al 2012 because of its large set of potential input variables and relatively short historical record of snowpack values which are one of the most important streamflow predictors in the area the bow river basin provides a highly relevant case study location our focus is summer season streamflow forecasting to match seasonal irrigation needs in southern alberta which accounts for over 70 of all irrigated land in canada after applying the presented workflow to our example we then further analyzed the trained models to 1 select the best ml algorithm based on its generalization performance and compare the performance of nonlinear ml models to mlr 2 test the impact of reducing dimensionality by principal component analysis pca as an optional preprocessing technique 3 determine the key predictors for streamflow in the bow river basin and 4 investigate the impact of increasing the lead time on prediction accuracy the remainder of this paper is organized as follows in the next section we review the related ml algorithm applications in the literature input variables along with their links to streamflow variability and streamflow drivers in the study area section 3 gives background on the study area section 4 presents the workflow and methodological details for data transformation preprocessing as well as variable selection and ml algorithms hyperparameter tuning prediction accuracy estimation and other evaluation measures empirical results and discussion are in section 5 while summary and concluding remarks are provided in section 6 2 background this section reviews previous studies on input variable selection and model structure uncertainties as well as applications of the machine learning algorithms to streamflow forecasting in addition it explores local hydrometeorological variables and global climate indices that are associated with the variability in streamflow and or the variability in other local variables that contribute to streamflow generation such as temperature precipitation and snow cover 2 1 uncertainty in input variable selection and model structure input variable selection is critical to the development of reliable data driven models galelli et al 2014 kim et al 2020 quilty et al 2016 quilty and adamowski 2020 recent studies show that careful variable selection can improve the model performance and that its impact on the performance is problem dependent quilty and adamowski 2020 tyralis and papacharalampous 2017 the uncertainty in input variable selection stems from the dependence of the variable selection algorithm on both the input data and the model structure used to select the variables quilty and adamowski 2018 proposed the wavelet data driven forecasting framework to address the incorrect use of wavelet based models when applied to real world forecasting problems quilty et al 2019 developed the stochastic data driven forecasting framework sddff its single wavelet based counterparts swddff and ensemble multiwavelet based version ew sddff which addressed input data input variable selection parameter and model output uncertainty in the respective models finally quilty and adamowski 2020 explored swddff and sddff by varying the level of uncertainty in the two approaches 1 none 2 model parameters 3 model parameters and output and 4 input variable selection as well as model parameters and output the inclusion of wavelet decomposition and input variable selection uncertainty led to significant gains in forecast accuracy and reliability compared to the alternatives kim et al 2020 proposed an approach to deal with uncertainty in model structure and input variable selection using a modified backward elimination procedure for a ann model this approach generates a number of input layers where each layer represents a set of the potential input variables our study addresses a gap in the literature by proposing a workflow that handles uncertainties in input variable selection model structure and input data and avoids introducing other sources of potential performance estimation bias 2 2 brief review of machine learning algorithms numerous data driven conventional and machine learning models have been applied to streamflow forecasting for decades conventional time series models such as linear regression lr multiple linear regression mlr and auto regressive integrated moving average arima have been used to forecast streamflows however they are unable to capture the non linearity of the streamflow response to the input variables hydrologists have therefore used machine learning techniques over the past two decades as flexible and robust techniques that overcome the drawbacks of conventional models and incorporate the inherent nonlinearity of hydrological datasets without their explicit definition el shafie et al 2009 he et al 2014 humphrey et al 2016 kuhn and johnson 2013 maier and dandy 2000 rieker and labadie 2012 tan et al 2018 yaseen et al 2016c artificial neural networks ann support vector machines svm and radial basis function networks rbf are the most widely used ml algorithms for streamflow modeling and forecasting yaseen et al 2015 shabri and suhartono 2012 compared the performance of svm ann and arima models for the kinta river in perak peninsular malaysia and found the svm model outperformed the others rasouli et al 2012 found that svm outperformed mlr lima et al 2016 compared linear to nonlinear approaches and found that nonlinear flow forecasting models for englishman river georgia usa and stave river bc canada had better skills than the linear models ghorbani et al 2016 compared svm ann and mlr models for big cypress river texas usa and reported that svm and ann performed better than mlr in estimating peak discharge values which mlr tended to underestimate they noted that ann was flexible but that its training was time consuming kalra et al 2013a b built svm ann and mlr models to forecast spring summer streamflow for north platte river usa the svm model outperformed the others for all tested cases the same results were achieved for an svm model for the upper colorado river basin usa kalra and ahmad 2009 carrier et al 2013 found better results for an svm model than mlr model forecasts in the western united states he et al 2014 examined ann svm and adaptive neural fuzzy inference system anfis approaches for forecasting river flow in a semiarid environment and similarly concluded that the svm model outperformed the others yaseen et al 2015 explored the literature on machine learning approaches in streamflow forecasting and concluded that svm produces accurate and robust classification results for forecasting streamflow and that it copes well with noisy data yaseen et al 2016b demonstrated superior performance of rbf over ann kisi and cigizoglu 2007 found that rbf was superior to ann and grnn for both short term and long term river streamflow forecasting in addition to ann svm and rbf extreme learning machines elm offer excellent modeling capabilities including a simple neural network structure randomly assigned weights and a fast learning process yaseen et al 2016a and can produce similar results to svm huang et al 2012 elm has also been applied in hydrological studies deo and şahin 2015 applied elm to model the monthly effective drought index they demonstrated a significant improvement in forecasting performance over ann as well as a 32 times faster training speed yadav et al 2016 found comparable performance among online sequential elm svm and ann and that the elm model had the minimum prediction error deo and şahin 2016 found the elm model for streamflow forecasting in queensland australia provided superior results to ann models importantly all the studies described above found that nonlinear models outperformed linear models and that the latter tended to underestimate peak values further although several studies found that elm rbf and svm outperformed ann no single model outperformed the others in all cases study conclusions from different locations can depend on the associated catchment hydrology and the nature of input data used so it is important to try various models and select the best model for each case therefore ann rbf svm and elm along with mlr were investigated in this study 2 3 input variables to develop a streamflow forecasting model all possible predictors of streamflow generation processes must be considered for a given study area especially in mountainous areas with high variability for a data driven forecasting model the local hydrometeorological variables typically considered are streamflow behzad et al 2009 jain and kumar 2007 kisi and cimen 2011 noori et al 2011 nourani et al 2011 precipitation behzad et al 2009 li et al 2010 noori et al 2011 nourani et al 2011 temperature behzad et al 2009 noori et al 2011 and solar radiation noori et al 2011 previous studies have also found that the use of large scale climate indices as predictors improves streamflow forecasting skill in combination with the local hydrometeorological observations for example rasouli et al 2012 reported best results for a daily streamflow forecasting model for a basin in british columbia canada that mixed local observations and climate indices especially at longer lead times of 5 7 days where the lead time represented the lag between release of the streamflow prediction and observation of the corresponding streamflow makkeasorn et al 2008 argued that large scale climate indices incorporating sea surface temperature anomalies may capture some climate change impacts and improve the forecasting accuracy because climate patterns are inter connected and no single climate index explains all climatic variability within a river basin climate indices are typically used in groups kalra et al 2013b various large scale climate indices are associated with snowpack air temperature and precipitation variability during winter and summer seasons in north america and in particular western canada the pacific decadal oscillation pdo a decadal scale oscillation characterized by the leading principal component of the north pacific sst anomalies mantua et al 1997 influences runoff timing in canada burn 2008 gobena and gan 2006 found that interdecadal streamflow signals were in good agreement with the pdo index and that their variations dominated streamflow variability in the bow river basin in the summer positive pdo phases lead to drier conditions and a higher frequency of low streamflow events bonsal and shabbar 2011 and to below normal winter precipitation and above normal winter temperatures in western canada while negative pdo phases have opposite effects bonsal et al 2001 the el niño southern oscillation enso represents the prominent interannual variability produced by equatorial pacific sea surface temperature sst anomalies hsieh and tang 2001 during the summer shabbar and skinner 2004 found that el niño events led to drier conditions while la niña events conversely produced excess moisture over western canada likewise el niño events have been shown to produce warmer winter weather slightly higher than normal snowfall and increased spring streamflows while la niña produces the opposite effects which are more concentrated in western canada hsieh and tang 2001 the traditional index for enso in the pacific ocean is called the southern oscillation index soi which measures the difference in sea level pressure occurring between tahiti and darwin during el niño or la niña events ladd and gajewski 2009 several other indices related to enso also monitor the sst anomalies averaged across a given region in the tropical pacific niño1 2 niño3 niño3 4 and niño4 gobena and gan 2009 moradi et al 2020 the pacific north american pattern pna relates temperature and precipitation anomalies across north america to conditions over the pacific ocean and is strongly related to snow cover variability over north america brown and goodison 1996 a higher pna index is related to lower snow cover and a positive pna is associated with above average temperatures over western canada in alberta positive pna is associated with below average winter precipitation and reduced snow cover bonsal and shabbar 2011 brown and goodison 1996 pna effects on streamflow vary regionally over southwestern canada gobena and gan 2009 finally the atlantic multidecadal oscillation amo represents sst variability in the north atlantic ocean the positive phase of the winter amo tends to be associated with dry summer conditions over the central and northern regions of the canadian prairies bonsal and shabbar 2011 3 study area the bow river watercourse is 587 km long stretching from the bow glacier in the canadian rockies eastward through the city of calgary to its confluence with the oldman river west of medicine hat alberta and drains an area of 25 300 km2 the annual precipitation exceeds 700 mm in its mountainous headwaters but then decreases significantly eastward to give 330 mm of mean annual precipitation the bow has a higher natural flow yield than its three surrounding subbasins because of the large portion of its basin within the rockies its streamflow typically peaks during the spring summer melt freshet however variable topography low average annual precipitation 600 mm and high winds particularly in the mountainous portion of the basin that generates most of the runoff render the basin prone to water shortages and emphasize the importance of reliable runoff forecasts to support water managers decisions the bow river basin is important for irrigation of the total water allocations in the bow river basin 77 or the total sum of water license of 1 160 000 dam3 year is allocated to three irrigation districts that comprise a total of 259 600 hectares while about 10 is allocated to the city of calgary alberta agriculture and forestry 2020 fig 1 shows the study location the bow river streamflow in the summer months clearly exhibits high natural variability fig 2 water managers in alberta currently use rocky mountain snowpack survey values reservoir winter storage levels modeled soil moisture content in the spring and normal seasonal rainfall volumes and temperatures to estimate the water supply and to plan for the next irrigation season however the forecasts are uncertain and relying on them for planning poses risks for irrigators and other users jean and davies 2016 as shown below machine learning models can significantly improve streamflow forecasting accuracy 4 methods to address the variable selection bias and other pitfalls identified above we introduce here a novel workflow with five main stages 1 data collection and preparation 2 data partitioning for training and validation and for testing and performance evaluation 3 model building with optional data transformation and preprocessing variable selection and hyperparameter tuning 4 model training with the best identified ml algorithm selected variables and tuned hyperparameters on the entire training validation set and 5 final model testing using the test dataset the workflow features two resampling or cross validation loops an outer loop for application of the variable selection algorithm to identify the predictor set with the minimum residual sum of squares rss and an inner loop for application of the exhaustive search or grid search algorithm to identify the optimal hyperparameters corresponding to the minimum rss note that the workflow can accommodate other hyperparameter tuning algorithms such as random search algorithms fig 3 shows the complete model building and testing workflow which is flexible and can be applied to any ml algorithm variable selection algorithm and resampling method sections of fig 3 associated with the five stages of the workflow listed above are indicated in the figure while further details on these stages are provided below 4 1 data collection and preparation the first stage of model building is data collection for both local hydro meteorological variables and large scale climate indices for the bow river basin local scale historical records of monthly average precipitation minimum maximum and average temperatures snow water equivalent average humidity and estimated solar radiation data as well as streamflow data generated as monthly averaged naturalized historical flow records were collected for the upper bow river watershed in southern alberta data from mountainous upstream areas of the bow river basin is critical because a substantial portion of the runoff comes from this area however relatively fewer stations exist in this mountainous area compared to the foothills and records are short and sometimes incomplete of the 21 active snow courses in the area nine records begin in 1970 while the remaining stations date from 1981 with some missing records snow water equivalent swe data were extracted from snow course data obtained from alberta environment and parks darcy talma personal communication 2020 monthly average swe for individual stations with 20 years of data or more were used township data from alberta agriculture and forestry aaf was used for historical precipitation temperature humidity and estimated solar radiation records https agriculture alberta ca acis alberta weather data viewer jsp aaf interpolates and averages township data from up to eight nearby meteorological stations for each township in alberta for the 50 townships within the basin boundaries the interpolated data were downloaded and averaged over the basin table 1 lists the local hydrometeorological input variables used in the study and their sources eleven potential large scale climate indices were also tested as potential input variables five of the selected indices represent the el niño southern oscillation enso niño1 2 niño3 niño3 4 and niño4 and the southern oscillation index soi the other six indices include the atlantic multidecadal oscillation amo the arctic oscillation ao the north atlantic oscillation nao the north pacific index np the pacific decadal oscillation pdo and the pacific north american pattern pna because previous studies found that using new indices constructed by spatially averaging climate data offered no obvious advantage gobena and gan 2009 we used only standard climate indices available in the literature table 2 lists the eleven large scale predictors and their sources monthly time series of the abovementioned indices were retrieved from the listed websites after collection of all the data local and global predictor variables were grouped into three different input datasets for forecasting seasonal runoff s1 included only climate index predictors from 1950 to 2019 i e no local predictor variables s2 included a combination of local observations and climate indices from 1970 to 2019 and s3 built on s2 with more comprehensive and complete swe records but a shorter record of 1981 to 2019 table 3 summarizes the statistical characteristics of the summer streamflow for the full period of the input dataset 4 2 data partitioning training validation and testing sets before any transformation or preprocessing of the input data the entire dataset was partitioned into training and test sets the ratio of the test set to the entire dataset is somewhat arbitrary and depends on the number of observations in the input dataset and the type of application typical values range from 20 to 40 we used 30 of the entire dataset for testing which falls within the typical range identified and 70 for training validation 4 3 model building 4 3 1 data transformation and preprocessing to ensure the input variables in each dataset shared a common scale that avoided distorting variations in the values each of the three input datasets was 1 normalized to a mean of zero by subtracting the average value of each variable and 2 adjusted to a standard deviation of one by dividing each variable by its standard deviation normalization improves the numerical stability of calculations kuhn and johnson 2013 and may also speed up ml model tuning as an optional data preprocessing step principal component analysis pca transforms input variable sets into smaller groups or principal components pc that capture most of the information in the original set by finding linear combinations of them by reducing the dimensionality of the modeling problem pca can improve model handling of the input variables dehghani et al 2014 noori et al 2011 schmidt et al 2020 wilks 2019 in addition it eliminates dependencies between input variables by creating uncorrelated predictors to study its effect on prediction accuracy input variables were transformed in this study into principal components which were then ordered and a scree plot used to retain the components that represented 95 of the variability in the data schmidt et al 2020 finally data transformation and preprocessing where applicable was used as a part of the cross validation process hastie et al 2009 quilty and adamowski 2018 to avoid leaking information about the mean and the variance of the validation set to the training data 4 3 2 selection of input variables although it is important to consider many potential predictors as input to an ml model a smaller number of input predictors improves the chances of finding the best model for the output or target variable by reducing the number of possible candidate models liu and motoda 2007 the goal of variable selection is to find the optimal combination of predictors that maximizes the overall prediction accuracy the method for best predictor selection removes irrelevant and redundant predictors and generates more reliable forecasts further a reduced set of predictors simplifies the model and reduces data collection costs to select predictors we adopted a stepwise variable selection algorithm that starts by choosing the single best variable identified as the single variable model that has the minimum residual sum of squares the model accuracy is then improved in a stepwise manner by adding the variable that reduces the residual sum of squares by the next largest amount with subsequent additions of input variables one at a time the forward stepwise selection is a greedy algorithm once it includes a predictor in the model it cannot remove it later therefore a better algorithm must also account for the fact that some variables become redundant predictors that improved prediction accuracy at an earlier stage of the selection process may subsequently reduce the overall prediction accuracy therefore we coupled it with a backward elimination algorithm that reexamined all the previously selected variables for inclusion or exclusion after each new variable was selected this addition and removal of predictors continued until all those that improved the overall prediction accuracy were added and no further addition to improve performance was possible the advantage of using the stepwise variable selection algorithm a wrapper approach over a filter type variable selection algorithm is that the stepwise approach directly evaluates model performance when the input variables are used in combination rather than considering only highly influential input variables that can have their potency negated when used in combination kuhn and johnson 2019 liu and motoda 2007 although a third variable selection methods class called embedded methods can be more efficient and less computationally expensive than the wrapper methods their application is restricted to specific ml algorithms if the modelled process can be better fit by a ml algorithm that does not have an embedded method then the prediction performance of the developed model is sub optimal whereas the application of the wrapper methods is generic to any ml supervised learning algorithm kuhn and johnson 2019 embedded methods can perform variable selection as a part of the model building process and avoid variable selection bias however it is important to exercise caution when comparing the performance across different machine learning algorithms and their respective embedded methods or wrapper filter methods if different feature selection algorithm types were used to avoid introducing other biases into the comparison such as resubstitution validation inconsistent validation sets across different algorithms and model selection using the testing set 4 3 3 ml algorithms and hyperparameter tuning the streamflow forecasting models were based on antecedent conditions represented by input variables in monthly forms and lagged by 1 12 months to represent conditions up to one year ahead of the forecast issue date further to study the effect of lead time on the forecasting accuracy an additional six datasets were prepared containing only input variables available at the time of prediction the tested lead times ranged from one to six months shorter lead times made more variables available to the model and hence improved accuracy the longest lead time six months corresponded to october of the previous year october is the start of the water year in canada and the obtained forecasting accuracy was low enough that longer lead times than six months were unnecessary the lead times of 1 6 months are the same for the seasonal may june and july models further predicting average seasonal june and july streamflows after the spring melt has no practical value therefore forecasts were not produced after the end of april for the four cases and longer lead times were calculated at monthly time steps for each month from october of the previous year to march of the current year for swe we used both basin averages section 4 1 and values from individual snow courses for which the model was allowed to assign weights separately five different model types were assessed for seasonal and monthly streamflow forecasting multiple linear regression mlr artificial neural network ann support vector machine svm extreme learning machine elm and radial basis function neural network rbf a total of 76 models was developed first two sets of twenty models were developed including seasonal may june and july models for each of the five ml algorithms 4 models x 5 algorithms one of these sets of 20 models included preprocessing with pca while the other set of 20 models did not the models with pca are called mlr pc ann pc svm pc elm pc and rbf pc below further to investigate the impacts of longer lead times and compare between datasets s1 s2 and s3 an additional 36 rbf models were developed including 24 rbf models for seasonal and monthly forecasted streamflows with lead times up to six months four rbf models to compare between datasets s2 and s3 and eight rbf models to compare datasets with only local hydrometeorological variables part of dataset s2 or global climate indices dataset s1 4 3 3 1 multiple linear regression mlr multiple linear regression mlr can produce a simple fast and easy to understand reference model for comparison against the machine learning models linear regression assumes the streamflow is a linear combination of the input variables the general form of the mlr model is bishop 1996 1 f x c o c 1 x 1 c 2 x 2 c n x n where f x is the forecasted streamflow x 1 x 2 xn are n numbers of independent variables c 1 c 2 cn are the unknown values of the coefficients and is the error term these values represent the local behavior and are estimated by the least square method 4 3 3 2 artificial neural network ann neural networks are a class of flexible nonlinear models with an appropriate number of nonlinear processing units neural networks can learn from historical data and estimate any complex functional relationship with high accuracy the most popular ann for time series forecasting is the feed forward model dehghani et al 2014 noori et al 2011 yaseen et al 2015 structurally an ann consists of an input layer that receives external information an output layer and one or more intermediate hidden layers that separate the input and output layers miller and forte 2017 in this study each feed forward ann was trained with the standard backpropagation algorithm to minimize the mean squared error using gradient descent to calculate the error function gradient iteratively and with sigmoidal and linear type activation functions for the hidden and output layers respectively a single hidden layer feedforward networks slfns with a nonlinear activation function and a number of hidden neurons nh less than or equal to the number of distinct samples ns can approximate any function and learn with zero error huang and babri 1998 an exhaustive or grid search was used to find the optimum structure of the ann which involved trials of all possible hidden neuron numbers between 2 and ns and selection of nh associated with the least error across all the samples in addition values from zero to 40 were investigated for the regularization or weight decay parameter to avoid under fitting we set the maximum number of epochs or iterations to 1 0e 6 to ensure that this number is not reached before the error is below the absolute tolerance 1 0e 4 or the optimizer becomes unable to reduce the error by 1 0e 8 4 3 3 3 support vector machine svm originally developed by vapnik 2000 svm is one of the most effective prediction models it uses kernel functions to transform complex nonlinear input variables into linear form by mapping them into a higher dimensional space to allow for a linear solution in the higher space that matches the nonlinear solution in the initial nonlinear space svm is expressed by 2 f x i 1 ns w i k x x i b b where wi and b b are the model parameters ns is the number of training samples to be estimated k x xi is the kernel function and f x is the forecasted streamflow çimen 2008 the model parameters are determined by minimizing the regularized empirical risk function çimen 2008 3 r r e g f x c x i x l ε y i f x 1 2 w 2 where c is the cost parameter a regularization parameter that influences the tradeoff between model complexity and approximation error and l ε is the loss function which is the standard vapnik s ε intensive loss function in this study the radial basis function kernel was used çimen 2008 4 k x x i e x x i 2 2 σ 2 and an exhaustive search was conducted to find the cost and sigma tuning parameter 4 3 3 4 extreme learning machine elm an elm is structured as a single layer feed forward neural network slfn with a faster more computationally efficient algorithm than the backpropagation and support vector machine algorithms among others ali et al 2018 the enhanced performance is linked to the randomization of the input weights and biases lima et al 2015 such that the output weights have unique least squares solutions obtained by the moore penrose generalized inverse function huang and siew 2004 considering ns training data samples the slfn can be expressed by huang et al 2004 5 f x i 1 a b i g w i x i b i where bi represents output weights to be estimated for the hidden layers with a hidden nodes g is the activation function wi and bi are the weights and biases and f x is the forecasted streamflow an exhaustive search was used to determine the optimum structure and activation function of the elm numbers of hidden nodes between 1 and 10000 were tested as well as sigmoid sine radial basis hard limit symmetric hard limit satlins tan sigmoid triangular basis and positive linear activation functions the number of hidden neurons and the activation functions were optimized for the minimum residual sum of squares and the associated optimal setting was selected in the output layer which generated the streamflow forecast a linear transfer function was adopted a common practice in hydrological time series forecasting deo and şahin 2015 4 3 3 5 radial basis function network rbf rbf is a class of adaptive networks that was first introduced by broomhead and lowe 1988 an rbf shares the same slfn structure as elm and ann with three layers input hidden and output the hidden layer uses a gaussian radial basis activation function rather than the sigmoid function used by ann a radial basis function is any real valued function whose value only depends on an arbitrary distance measure between an input value and a center where the input value is the data point at which the function is evaluated according to another data point which is the center and the absolute difference between the two points is the distance which represents the effect of the center on the neighboring points and is inversely proportional to its square root in our study a linear type function was used for the output layer an exhaustive search was used to find the optimum number of hidden nodes of the rbf with values between 2 and ns investigated the number of hidden neurons nh associated with the minimum residual sum of squares was selected 4 3 4 model calibration and performance evaluation a cross validation scheme with observations split randomly into 10 subsets of equal size folds was employed to investigate the forecasting skill of the models one subset was treated as the validation set 10 and the remaining subsets 90 formed the training set the model was then trained with the training set and evaluated with the validation set the process was repeated until each subset had been used as a validation set comparison of model predictions and test set observations formed the basis of performance measure estimations this 10 fold cross validation approach was used because it balances the error bias with the variance and is commonly used in practical machine learning applications abu mostafa et al 2012 kuhn and johnson 2013 solomatine and ostfeld 2008 the cross validation was repeated 3 times to estimate model performance for 30 different validation sets which can efficiently increase the precision of the estimated cross validation performance while retaining a small bias kuhn and johnson 2013 and give a robust estimate of the generalization performance and the variability that might affect the results if different resamples were considered finally all transformations and preprocessing of training subsets were implemented within the cross validation scheme to avoid bias in the performance estimation through information potentially leaked from the training to the validation set we used two resampling loops to properly resample the variable selection process an outer loop encompassed the entire training validation process and applied the variable selection algorithm within which split the training validation data to 90 for training and 10 for validation an inner loop then further split the training data 90 from the outer loop to 90 for training and 10 for validation for use in optimizing and tuning model hyperparameters using two resampling loops can significantly reduce the chances of over fitting the predictors boulesteix and strobl 2009 kuhn and johnson 2019 2013 the outer loop was repeated q n k times where q is the number of steps required for the variable selection algorithm to stop and n and k are the number of repetitions and folds of the outer loop respectively the inner loop was repeated n k times each time the outer loop was called where n is the number of repetitions and k is the number of folds of the inner loop it should be noted that each time a validation set stage 3 or test set stage 5 is passed to the model it is transformed using the transformation parameters calculated from the respective training set further ppredictions generated from the developed models where the target variable was transformed must be back transformed to their original scale before calculating the rss this back transformation must be applied multiple times when estimating the rss during validation inside the inner and outer loops as well as when testing the performance of the final model the trained and validated models were evaluated with statistical measures of goodness of fit and absolute error as recommended by legates and mccabe 2005 models with higher goodness of fit and minimum values of rmse and mean absolute error mae are recognized to perform better than other models our study applied the mae rmse mean absolute percentage error mape coefficient of determination r2 and nash sutcliffe coefficient of efficiency nse measures 4 4 final model training and testing the model with the best generalization performance in the training validation process was then selected and trained on the training validation dataset and the prediction accuracy over the test set was estimated because of the short length historical record available we implemented preliminary runs using the outlined model building process shown in fig 3 in the preliminary runs we used 70 of the entire datasets for training validation and 30 for testing we applied stepwise variable selection and compared the performance of the five ml algorithms the combination of input variables and ml with the best generalization performance was selected as the final model and tested with the test set then we empirically estimated the bias in the prediction accuracy which is the relative difference between the model performance estimated using the validation sets and a separate test set on future data using only the cross validation results further to compare between datasets s1 s2 and s3 we used 30 of dataset s3 as the test set to ensure similar test set size and target variable values across the three datasets variable selection algorithms and machine learning methods were applied using the r programming language r core team 2020 specifically the caret kuhn 2020 rsnns bergmeir and benítez 2012 kernlab karatzoglou et al 2004 and dplyr wickham et al 2020 packages 5 results and discussion the results and discussion focus on dataset s2 which outperformed both s1 and s3 forecasts obtained using dataset s3 were less reliable because of its shorter training record additionally dataset s1 had a longer training record but a smaller number of input variables which affected the forecasting accuracy to illustrate this point table 4 compares results among input datasets s1 s2 and s3 for their four best performing models which were rbf models in all cases dataset s3 is omitted from further discussion while s1 will be discussed later in the comparison between global and local input variables in addition the prediction accuracy bias was empirically estimated using the average out of sample cross validation and a separate test set and was found to be very small for example the seasonal may june and july rbf models without pca had an estimated prediction accuracy from the training validation process of approximately 20 54 22 27 36 38 and 23 49 m3 s respectively the rmse calculated using a separate test set for the seasonal may june and july models were 21 75 21 32 37 33 and 22 8 m3 s respectively hence the average estimated prediction performance bias was less than 1 2 m3 s 5 5 4 4 2 5 and 3 0 for the seasonal may june and july models respectively therefore the presented workflow can give a reasonable estimate of the prediction accuracy on the test set using cross validation average out of sample results additionally because of the short historical record where every data point is potentially needed to determine model parameters from this point on we relied on the repeated cross validation process to estimate the prediction accuracy kuhn and johnson 2013 while keeping in mind that a small bias may exist in this estimate table 5 lists the average out of sample performance measures for dataset s2 for the period of 1970 2019 for the seasonal may june and july models fig 4 summarizes the overall performance evaluation measures for the twenty machine learning models the tuned mlr ann svm elm and rbf monthly and seasonal forecasting models including the median interquartile ranges and outliers for the 30 3 times repeated 10 fold cross validation out of sample forecasts each for the period 1970 2019 the nonlinear models all outperformed the seasonal and monthly mlr models and the rbf model provided the best average prediction accuracy and performance consistency across different resamples the svm model had overall better forecasting accuracy and evaluation measures smaller mae and rmse higher r2 and nse than both the elm and ann models fig 5 compares the rbf summer season and monthly forecasting models against the observed streamflow for the period from 1970 to 2019 for the seasonal may june and july streamflows the average rbf out of sample forecasts over the period from 1970 to 2019 had coefficients of determination of 0 9 0 8 0 82 and 0 88 and nse coefficients of 0 82 0 72 0 75 and 0 80 in addition to model performance evaluation we investigated all model predictors and extracted their relative importance measured as the accumulated percentage decrease in the estimated error for each predictor added to the model values are shown in fig 6 while different models selected different predictors for the four monthly and seasonal streamflows they shared many common attributes first the dominant variables selected in the four cases were the snow water equivalent swe from individual snow courses the swe at sunshine village in march and or april was the top predictor for the seasonal june and july models and the 6th most important predictor in may perhaps because of the central location of the sunshine village snow course in the mountainous portion of the watershed among the global climate indices the pdo in september was the 2nd most important predictor for june forecasts and the pdo values in may and june of the previous year were among the top ten predictors in the july forecasting model inputs from other global climate indices such as the amo and pna were also important in some forecasts further the importance of global climate indices increased with the length of the forecast lead time as in the cases of the june one month lead time and july two months lead time models the arctic oscillation ao the north atlantic oscillation nao the north pacific index np were unimportant for all four models in addition soi and other el niño indices were not good predictors despite their general connection to snow cover variability and temperature in the study area this result may be attributed to the fact that responses to enso events vary substantially bonsal and shabbar 2008 although may streamflows did not exhibit as much variability as june streamflows fig 2 they had the least accurate predictions further the interannual variability in the may streamflows explained by the may prediction models was the lowest across all model types as shown by the r2 value in table 5 we therefore investigated the factors related to best versus worst performance for the may models focusing on two sets of ten years one set with the highest residuals worst performance and the other with the lowest residuals best performance as shown in fig 7 revealed that the most difficult years to predict were those with a significantly lower may streamflow which has a median of 0 13 compared to a median of 0 4 for the best years while there was no clear difference based on the full summer season streamflow whether the year in question was dry or wet given no clear difference in the total seasonal streamflow the worst years were likely those in which the snowpack melted later in june as indicated by the significantly lower minimum and maximum temperatures in may which have medians below 0 3 and 0 2 for the worst years compared to medians greater than 0 5 for best years and higher june streamflow values which nullified the predictive power of the snowpack the most important predictor of may streamflow as shown in fig 6 the same conclusion results from a recognition that the worst years were generally colder than the best years particularly in terms of the may maximum temperature as shown in fig 7 in contrast there was no significant difference in may precipitation for the best and worst years which suggests that the snowpack melt for the worst years resulted from an increase in maximum temperature rather than rain on snow events finally note the difference in the soi values between the best and worst years which indicates that may streamflows in la niña years were harder to predict although a number of studies have suggested the use of pca dehghani et al 2014 hao et al 2018 mortensen et al 2018 noori et al 2011 salas et al 2011 its value for predictor preprocessing to improve model accuracy is not clearly established therefore we investigated predictor preprocessing with pca using dataset s2 for both seasonal and monthly models with the effects on rmse shown in fig 8 clearly pca decreased forecasting accuracy with the average prediction error increasing in almost all cases except for the mlr in july this result shows that for carefully selected and uncorrelated input predictors and nonlinear models using pca may still eliminate important information this behavior can be attributed to one or more of the following reasons 1 pca does not consider the target variable when summarizing variability 2 pca is a linear transformation for the input variables which require different treatment by nonlinear models and 3 the loss of important information resulted from retaining only the principal components comprising 95 of the variance kuhn and johnson 2013 results from three sets of predictors were compared in order to clarify the effect of global climate indices on projection accuracy 1 hydrometeorological variables combined with global climate indices 2 local hydrometeorological variables only and 3 global climate indices only input dataset s2 provided the combination of hydrometeorological and climate index values local hydrometeorological predictors alone were obtained from s2 by omitting global climate indices from the dataset global climate index predictors were obtained from dataset s3 fig 9 shows the effect of the three input datasets on the forecasting performance incorporating the global climate indices in the predictor set clearly improved the model forecasting skill significantly while using local climate indices only caused a 10 25 reduction in forecasting skill adding global climate index predictors clearly improved streamflow prediction accuracy particularly at longer lead times finally fig 10 shows the forecasting performance for longer lead times of one to six months for the seasonal june and july forecasts the forecasting skill in march at a one month lead time was lower than in april but the loss in skill was small in comparison with cases of more than two month lead time october february of practical significance for government agencies and water managers although forecasting skill decreased with increasing the lead time satisfactory forecasts nse 0 5 could also be obtained two months in advance of the spring melt in february 6 summary and conclusions data driven modeling with ml algorithms is one of the most rapidly developing topics in the field of hydrologic modeling and forecasting especially for its ability to exploit increasing volumes of available data however the complexity of the models and their ability to extract useful information from input data requires following a careful model building process this study identified and addressed pitfalls and challenges facing data driven ml modeling in hydrology with a novel workflow fig 3 that avoids both by representing the uncertainty involved in variable selection further it leads to better generalization performance on unseen data with unbiased estimation of the prediction accuracy the workflow addresses selection bias by considering variable selection as a part of the model building process and using two resampling or cross validation loops to reduce the chance of overfitting to the predictors it also uses repeated k fold cross validation to avoid the resubstitution validation problem the workflow has a consistent generic model building process applicable to any ml algorithm that allows an equal effect of the performance estimation bias on all models which is important for cases where relatively short historical records will not permit the use of a test set it also limits the role of the test set to estimate the prediction accuracy rather than model selection finally it ensures that input variable transformation and preprocessing occur inside cross validation to avoid leaking information about the mean and variance of the validation data to the training data the flexibility of the workflow for application to any ml model variable selection algorithm or resampling method allows it to serve as a guide for future machine learning studies in hydrology to demonstrate the performance of the new workflow we developed 76 monthly may june and july and seasonal streamflow forecasting models for a study location with a relatively short historical record and a large number of predictors compared to samples the cordilleran snowmelt dominated bow river basin in alberta canada we used four different ml algorithms ann svm elm and rbf and compared them against a more traditional multiple linear regression approach in applying the new workflow we first empirically estimated the bias in the prediction accuracy using the cross validation results and a separate test set and found the bias to be very small less than 1 m3 s 5 this result indicated that following a robust and appropriate resampling and validation process presented in the workflow improved our estimates of the generalization performance which guides the selection of more accurate models the performance of each ml model was evaluated using standard statistical metrics mean absolute error mae root mean square error rmse coefficient of determination r2 and nash sutcliffe model efficiency coefficient nse the rbf performed best of the five model types in terms of average prediction accuracy and consistency in performance across different resamples specifically for the seasonal and monthly predictions rbf out of sample forecasts over the period from 1970 to 2019 had coefficients of determination of 0 90 0 80 0 82 and 0 88 and nash sutcliffe efficiency coefficients of 0 82 0 72 0 75 and 0 80 preprocessing input variables with pca was found to be detrimental to prediction accuracy the relative importance of each predictor on model accuracy was investigated in terms of the reduction in model error with its inclusion swe was the most important predictor for seasonal and monthly models further using swe values from individual snow course stations with an individual assignment of model weight for each station produced better results than an average swe over the basin for the seasonal models swe measures in march and the previous year s summer temperature and precipitation were the most important predictors for the may models prediction accuracies were significantly affected by a late snowpack melt in june an aggregated seasonal forecast abated such temporal effects further including global climate indices especially the pacific decadal oscillation index atlantic multidecadal oscillation index and pacific north american pattern index improved nash sutcliffe coefficient of efficiency by 6 to 50 of practical significance for government agencies and water managers we found that although forecasting skill decreased with increasing forecast lead time satisfactory forecasts nse 0 5 could be obtained two months in advance of the spring melt at the end of february we also found that a combination of global climate indices and local hydrometeorological variables led to improved models and forecasting performance therefore reliable seasonal and monthly streamflow forecasts could be obtained for the bow river basin using rbf and a combination of local hydrometeorological conditions and large scale climate indices rbf forecasts can be applied to support integrated water resources management in alberta extensions of this study should focus on improving understanding of the tendency of different variable selection algorithms to pick irrelevant or redundant predictors with changes in training data better understanding of variable selection algorithms can also improve a major drawback of the proposed workflow high computational complexity by finding simpler variable selection algorithms that can lead to similar streamflow forecasting model accuracy additionally exploring an emerging paradigm theory guided data science may improve the interpretability of ml models by limiting the search space through imposing background knowledge of the modeled process babovic 2009 chadalawada et al 2020 herath et al 2020 karpatne et al 2017 the application of the presented workflow could be extended to modeling at finer temporal time resolutions such as weekly or even daily the supplementary materials demonstrate the impact of increasing the number of observations or of modeling at finer temporal resolutions on the workflow runtime for different ml algorithms they show that a relative increase in the number of observations by 80 times can lead to a relative increase in the measured runtimes from a minimum of 2 5 elm to a maximum of 40 times svm with an average of 14 times greater finally we encourage other researchers to experiment further and evaluate the application of the presented workflow to forecast different processes including rainfall evaporation and urban water demand credit authorship contribution statement amr gharib conceptualization methodology formal analysis software writing original draft evan g r davies supervision conceptualization formal analysis writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we thank dr nesa ilich for his valuable contributions and revisions and for his provision of the naturalized streamflow data we also thank dr john quilty of the university of waterloo and two anonymous reviewers for their helpful comments on and revisions to the manuscript this work was supported financially by the university of alberta mitacs accelerate fellowship and optimal solutions ltd it also benefited indirectly from funding to project ai 2336 seasonal operational model for water management within irrigation districts of alberta innovates with matching support from the city of calgary and the bow river brid eastern eid raymond rid st mary river smrid taber tid and western wid irrigation districts in alberta canada supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2021 103920 appendix supplementary materials image application 1 
308,the processes that affect reorganization of flow and transport in fractures during precipitation were investigated experimentally and numerically in order to highlight the interplay between calcite precipitation flow and growth substrate calcite was precipitated from a supersaturated solution at two different flow rates 0 4 or 12 cm3 hr 1 into artificial fractures made in dolomitic limestone although the inlet fluid composition and temperature were identical for all the experiments facture sealing and precipitation patterns were closely linked to the mineral substrate fracture geometry and flow field reorganization calcite precipitation rate is highly variable along and between the flow paths and depends on the local saturation index of the reactive fluid in addition calcite precipitates preferentially on calcite comparatively to dolomite substrate 2d reactive transport modeling accounting for the negative feedback between porosity and permeability decrease succeeded in quantitatively reproducing the experimental observations such as the evolution of the fracture void obtained from x ray micro tomography xmt the evolution of the calcium breakthrough concentration and fracture sealing the corresponding model was then used to evaluate the impacts of fluid flow and reactivity on randomly generated anisotropic fractures geometries simulation results reveal that the sealing capacity of fractures and associated reorganization of flow depends on the damköhler number i e the ratio between characteristic times for advective transport and reaction although other factors like the fracture geometry and kinetic law play also a role at this stage more importantly the existence of a critical saturation index for initiating precipitation onto mineral substrate can substantially impair the prediction of the sealing capacity and will depend on the spatial heterogeneity and connectivity of the mineral substrate most cases result in a strong precipitation gradient along the flow direction that will increase the permeability anisotropy however under certain conditions precipitation allows the fracture to recover more isotropic properties that will lead back to a more uniform flow field and sealing negative feedback between precipitation process and transport during fracture closure supports a strong reorganization of flow of supersaturated fluids during geo engineering operations keywords calcite precipitation reaction rate law fracture sealing dolomitic limestone permeability flow x ray microtomography negative feedback reactive transport modeling critical saturation index 1 introduction fractures are known to greatly influence the fate of fluids and contaminants in low permeability rocks reactive fluids have the potential to induce fractures noiriel et al 2010 detournay 2004 chen et al 2015 engelder and lacazette 1990 seal fractures noiriel et al 2010 macquarrie and mayer 2005 dobson et al 2003 morrow et al 2001 aben et al 2017 elkhoury et al 2015 or more generally modify the fracture network griffiths et al 2016 menefee et al 2020 their impact is significant on the preferential flowpaths through the host rock as well as on the global reactivity which in turn controls the fracture evolution berkowitz 2002 deng and spycher 2019 understanding the reorganization of flow inherent to precipitation reactions within fractures is of interest for management of several geo engineering applications for applications such as co2 sequestration and mineral trapping brunet et al 2018 huerta et al 2013 cao et al 2015 garcia rios et al 2016 kim and santamarina 2016 or biogrouting cuthbert et al 2013 mountassir et al 2013 phillips et al 2016 carbonate rapid mineralization could take advantage of permeability reduction to increase storage safety in contrast a reduction of injectivity could challenge geothermal exploitation griffiths et al 2016 wagner et al 2005 however in such shallow depth and low temperature contexts natural observations reveal that fractures are only partially filled with cement deposits contrary to what is observed at greater depth and higher temperature laubach et al 2019 at least two hypotheses could explain this observation i the sealing rate is too slow regarding the timescale and or kinetics of mineral precipitation in relation with the temperature pressure and fluid composition ii the deep reorganization of the flowpaths has diverted the reactive fluids away from the initial preferential precipitation paths leading a large proportion of non connected pores or compartmentalized areas to locally persist in the fracture void and reduce the self sealing capacity in any case partial or complete sealing of opening mode fractures results from complex and coupled physico chemical processes although the positive feedback between reactions flow and transport has been largely studied for dissolution in porous media and fractures macquarrie and mayer 2005 ortoleva et al 1987 daccord et al 1993 golfier et al 2002 renard et al 1998 hung and sepehrnoori 1989 steefel and lasaga 1990 noiriel and deng 2018 hoefner and fogler 1998 detwiler et al 2003 roded et al 2020 less studies have focused on the negative feedback that develops during precipitation processes cuthbert et al 2013 chaudhuri et al 2008 chaudhuri et al 2012 tartakovsky et al 2007 jones and detwiler 2019 yoo et al 2013 kang et al 2003 sallès et al 1993 liu et al 2006 andreani et al 2009 godinho et al 2016 godinho and withers 2018 niu and zhang 2019 dijk and berkowitz 1998 however with analogy to dissolution the péclet pe and damköhler numbers da defined locally as pe v l d 0 and da kr l 2 d 0 e g steefel and lasaga 1990 hoefner and fogler 1998 where v is the fluid velocity m s 1 d 0 molecular diffusion m2 s 1 kr a first order kinetic constant s 1 and l a characteristic length m e g the fracture aperture should be useful indicators to isolate different precipitation patterns and regimes for instance lee et al 1996 mentioned that uniform precipitation of calcite can be obtained under rapid flow condition high v or only slightly supersaturated solution with respect to calcite small kr thus isolating low da and high pe conditions for uniform precipitation this observation is consistent with numerical results obtained by tartakovsky et al 2007 using a model based on smoothed particle hydrodynamics they distinguished between two compact regimes of precipitation i e uniform compact at low da and high pe and non uniform compact at higher da a third dendrite like regime might exists at very high da tartakovsky et al 2007a 2007b kang et al 2004 although unlikely to be observable in natural conditions when precipitation results from the injection of a supersaturated solution the sole existence of compact regime may result from the rapid depletion of reactants along the flow paths thus leading to preferential precipitation near the inlet boundary the non linear dependency of the reaction rate to oversaturation should exacerbate this trend morse and mackenzie 1993 noiriel et al 2012 indeed the highest the saturation index log ω the strongest the dependence with an exponent n of the kinetic law greater than one when growth occurs by the spiral mechanism at both edges and screw dislocations or by 2d nucleation teng et al 2000 however although pe and da can provide useful information about the evolution of a particular system their use can be limited noiriel 2015 or complex to handle with especially when the reaction rate varies of several orders of magnitude along the flowpaths i e between far from equilibrium and close to equilibrium conditions when boundary conditions differ from flow of a supersaturated solution e g when precipitation results from solute mixing emmanuel and berkowitz 2005 or when rock heterogeneities exert a first degree influence on the local flow and transport conditions aben et al 2017 smith et al 2013 yang et al 2020 yoon et al 2017 the fact that their value evolves with reaction progress drives us to define reference numbers at the time of injection t 0 and fracture inlet x 0 namely da 0 and pe 0 in addition even under similar flow and chemistry conditions crystal growth dynamics is often different from a uniform covering at the surface observations of dotted or more spread cement bridges in several fractures dobson et al 2003 laubach et al 2019 gale et al 2010 fall et al 2012 point toward preferential nucleation and growth on some mineral substrate similarly to what has been observed in porous media noiriel 2015 noiriel et al 2016 giving to substrate surface energy an important role in initiating nucleation and growth fernandez martinez et al 2013 de yoreo and vekilov 2003 lioliou et al 2007 lin and singer 2005 the ability of the smallest pores to maintain a higher saturation with respect to crystallization is another source of precipitation heterogeneity putnis and mauthe 2001 pape et al 2005 variation in growth rate of different crystal facets development of crystallographic preferred orientations changes in specific surface area as competition for growth between neighboring crystals complicate the geometry evolution through time nollet et al 2006 manaka et al 2008 bons et al 2012 hilgers and urai 2002 theses aspects are worth consideration especially during syntaxial or antitaxial growth in fractures the impact of precipitation on the morphology and microstructure of fractures is currently a limitation in reactive transport modeling laubach et al 2019 most models relying on a continuum description at the representative elementary volume rev scale e g molins and knaber 2019 however several approaches are emerging to account for the impact of precipitate on fracture geometry evolution for instance investigation of precipitation using the level set method jones and detwiler 2019 seigneur et al 2017 or lattice boltzmann methods jones and detwiler 2019 yoon et al 2017 2015 ahkami et al 2020 are particularly interesting as they permit to evaluate in relationship with spatial mineral substrate heterogeneity the effect of new precipitate localization on the flow and transport properties at the continuum scale it is also possible to account for the feedback between flow and reactions and between the volume of precipitate and permeability through implementation of porosity permeability relationship steefel et al 2005 beckingham 2017 seigneur et al 2019 while these laws have allowed continuum scale models to reproduce experimental results e g poonoosamy et al 2019 2015 their use near clogging conditions have had limited success as emphasized by relatively high discrepancies in modeling results xie et al 2015 micro continuum models provide an alternative to continuum scale models these models describing the evolving fracture aperture field allow for capturing the processes that are important to fracture geometry alteration deng et al 2016 and can lead to a better understanding of the relevant processes and parameterization of continuum models in the present study a combination of experiments micro scale characterization and micro continuum reactive transport modeling was performed to elucidate the relative contribution of precipitation reactions and transport to flow reorganization and fracture sealing the objectives are to investigate how the flow rate the kinetic law the fracture aperture distribution and mineral substrate heterogeneities at the fracture walls affect precipitation as well as reorganization of flow and reactive transport through time for this purpose we investigated experimentally precipitation in four artificial fractures of simplified geometries at two different flow rates precipitation rates were calculated from effluent concentrations and 3d image difference obtained using x ray microtomography xmt experimental results were then used to constrain reactive transport modeling in more complex fracture geometries different simulation configurations were tested to evaluate the impacts of three factors on the negative feedback between chemistry transport and permeability reduction in fractures i reactive transport conditions ii fracture geometry and anisotropy and iii mineral heterogeneity distribution at the fracture walls 2 materials and methods 2 1 flow through laboratory experiments in fractures four flow through experiments were carried in artificial fractures made in a dolomitic limestone of tithonian age upper jurassic sampled in a quarry crayssac lot france the rock composition given by x ray diffraction xrd analysis is about 50 calcite and 50 dolomite with a minor amount of quartz and k feldspar the carbonate matrix is composed of a microsparitic cement of calcite and dolomite table 1 summarizes the experimental conditions a block was sewed drilled and possibly grooved to provide four cylindrical samples of 50 1 mm in length and 25 mm in diameter with three different fracture geometries i e planar sample cra1fa planar with two channels of 2 0 0 3 mm in width and 500 or 700 µm in depth grooved in the fracture plane samples cra2fa and cra3fa or trapezoidal sample cra4fa the two fracture walls were glued together with epoxy resin after intercalating glass wedges on their edges to prevent for closure or opening of the fracture during experiment resulting in a fracture width of 15 1 mm the external surface of the samples apart from the fracture inlet was also covered with epoxy resin to avoid precipitation the surface of the fracture walls was estimated from their geometry with the addition of the inlet surface of the sample which was not covered with epoxy resin the inlet fluid used in the experiments was a 50 50 mixture of cacl2 and nahco3 solutions prepared from reagent grade salts dissolved in deionized water and equilibrated with atmospheric pco2 the composition of the mixture is 1 87 0 03 mm cacl2 and 3 95 0 07 mm nahco3 and corresponds to a calcite saturation index log ω of 1 38 and so a saturation state ω of 24 after saturation and flushing with deionized water clean the fracture walls the samples were injected at the flow rate q 0 of either 0 4 cm3 h 1 using a syringe pump samples cra1fa and cra2fa or 12 cm3 h 1 using a peristaltic pump samples cra3fa and cra4fa 2 2 quantitative determination of the extent of the reaction 2 2 1 determination of the global precipitation rate dissolution of dolomite being considered as negligible during the experiments the amount of calcite precipitated in the fractures was determined from the difference in calcium concentration δca mol m 3 between the fracture inlet ca in and outlet ca out throughout the experiments the volume of precipitated calcite at time t i is given by 1 v c a l t i q 0 υ c a l t t 0 t t i δ ca t d t with q 0 the volumetric flow rate m3 s 1 and υcal the molar volume of calcite m3 mol 1 the global rate of precipitation r c a l is given by 2 r c a l δ n δ t δ v c a l υ c a l 1 δ t with δn the total amount of calcite precipitated mol and δt the duration of the experiment δt t 1 t0 2 2 2 determination of the local precipitation rate and crystal growth rate local rates of precipitation within the fractures were evaluated from x ray micro tomography imaging xmt and secondary electron microscopy sem analysis of the crystals formed at the fracture wall surfaces fracture geometries were characterized by x ray micro tomography on phoenix nanotom systems fédération de recherche fermat fr 3089 toulouse and umr 7359 géoressources nancy with a pixel size of 12 23 µm the data sets were collected before t0 and after the experiments t 1 except for cra4fa whose geometry assumed to be a perfect trapezoid was not imaged at t0 and was deduced from measurements near the fracture wedges at t 1 as precipitation was localized near the sample inlet only the upper part close to the inlet was imaged at t 1 image processing was carried out using avizo software once the data sets were segmented an algorithm was used to extract the fracture walls and aperture see noiriel et al 2013 for the procedure of fracture wall and aperture extraction the data sets were also registered to permit localization of precipitation within the fracture from volume subtractions i e v t1 v t0 with v t0 and v t1 the 3d fracture volumes at t0 and t1 respectively image difference leads to the determination of the local rate of precipitation rcal mol s 1 assuming that the reactive surface area sr and geometric surface area spix m2 are equal 3 r c a l δ n x y δ t δ a x y δ t 1 υ c a l s p i x with δn x y the local amount of calcite precipitated mol and a x y the local fracture aperture m given the resolution of the imagery the limit for difference in aperture detection is about two pixels i e 25 µm after the flow through experiments the fractures were opened to examine the new crystal location and morphology sem stood in for xmt to characterize the geometry of the new crystals with a finer resolution average crystal size was evaluated at different locations of the fracture walls from size measurement on about 30 crystals each time 2 3 reactive transport modeling 2 3 1 description of the model the 2d multi component reactive transport model hytec van der lee et al 2003 seigneur et al 2018 was used to simulate fracture geometry evolution as a result of calcite precipitation hytec is based on the operator splitting approach solving the flow and advection dispersion reaction problems sequentially in particular the model accounts for the feedback between calcite precipitation and the resulting changes of fracture porosity permeability and flow in the model the fractures are discretized in a 2d mesh that approximates the geometry of the fracture planes in each grid cell the porosity is related to the local fracture aperture a x y by 4 ϕ x y a x y d z where dz is the thickness of the domain perpendicular to the fracture wall 10 3 m permeability is computed using the relationship derived from the hagen poiseuille solution of the navier stokes equations e g brush and thomson 2003 5 k x y a x y 2 12 the saturated flow is described by 6 s s h t k h where ss is the specific storage coefficient m 1 k is the hydraulic conductivity m s 1 and h is the hydraulic head m hydraulic conductivity and permeability are related through the following expression 7 k ρ g μ k where g ρ and μ represent the gravitational acceleration 9 81 m s 2 fluid density 1000 kg m 3 and viscosity 10 3 pa s respectively all assumed constant in these simulations the boundary conditions to the flow problem are constant injection rate along the x direction at the top inlet of the domain and constant pressure h 0 at the bottom outlet while the left and right boundaries are set impermeable the flow equation is solved to provide the hydraulic head h m in each grid cell the fluid velocity is then computed based on darcy s law darcy 1856 8 v k h the computed fluid velocity is then used to solve the reactive transport problem 9 ϕ ψ i t ϕ d ψ i v ψ i ϕ m ν i m r m where ψ i is the total concentration of component i mol l 1 d is the dispersion tensor m2 s 1 rm is the kinetically controlled mineral reaction term mol l 1 s 1 m is the number of minerals and ν i m is the stoichiometric coefficient for the reaction the reaction rate of minerals is described by lasaga 1981 and we used the kinetic rate constant kcal 1 79 10 9 mol m 2 s 1 and the exponent n 1 12 obtained from continuously stirred precipitation experiments on calcite seeds noiriel et al 2012 the overall calcite precipitation rate rcal mol l 1 s 1 is defined differently depending on whether it occurs on the calcite or dolomite substrate by introducing a critical saturation state ω c r i t d o l to initiate nucleation onto dolomite substrate 10 r c a l k c a l s c a l δ ω c a l ω c r i t d o l s d o l ω c a l 1 n with δ a 1 if a 1 0 otherwise where s cal and s dol m2 l 1 are the specific surface area of calcite and dolomite respectively a is the ratio ω cal ω crit dol and ω cal is the saturation state with respect to calcite ω cal iap ksp with ksp the solubility product and iap the ion activity product precipitation of calcite starts onto dolomite substrate when ω cal ω crit dol whereupon the critical saturation state returns to 1 as mineral growth is expected to increase the specific surface area of mineral m noiriel et al 2012 emmanuel and berkowitz 2005 we choose to express it as 11 s m s 0 s g r o w t h where s 0 is the initial specific surface area and sgrowth is dependent on the volume fraction of solid precipitated unless explicitly mentioned sgrowth was taken equal to 0 21 m2 g 1 value obtained by noiriel et al 2012 for calcite seed crystals after precipitation experiments as a result the precipitation rate will increase during precipitation thus explaining a regular decrease in ca out with time in contrast sgrowth 0 m2 g 1 would maintain a quasi steady state ca out the variation of which would only result of changes in the fluid resident time in the fracture void in relationship with modifications of the flow field during sealing the diffusion coefficient d 0 is equal to 7 9 10 10 m2 s 1 and corresponds to the diffusion coefficient of ca2 at 25 c li and gregory 1974 the dispersion tensor d is reduced to two dispersion diffusion coefficients i e d x d 0 5 δ x d 0 longitudinally and dy d d 0 transversally where d is the dispersion coefficient set arbitrarily to 0 1 mm based on the fracture dimensions and 0 5δx represents the numerical dispersion i e half of the mesh length this way the longitudinal dispersivity remains about 3 times higher than the transverse dispersivity transport eq 9 is solved using the sequential iterative approach during which the evolution of the fracture aperture or porosity is computed based on the evolution of the mineral volume fraction the feedback on flow is treated explicitly after updating the local permeability following the kozeny carman relationship carman 1937 12 k x y k 0 x y ϕ x y ϕ 0 x y 3 1 ϕ 0 x y 1 ϕ x y 2 where k 0x y and ϕ0 x y are the initial local permeability and porosity respectively the volume fractions of calcite precipitated in the pore space can be evaluated from the porosity change 13 v f c a l 1 ϕ x y ϕ 0 x y or equivalently from the amount of calcite precipitated in the solid phase m3 m 3 14 v f c a l v c a l v r o c k calcite ϕ x y v c a l where vrock is the volume of rock in the mesh and calcite is the corresponding concentration of calcite mol l 1 throughout the simulations the porosity and permeability fields are extracted to compute the effective permeability at the fracture scale in directions parallel kx and perpendicular ky to the main flow direction indeed while local permeability is isotropic and evolves following the kozeny carman relationship the effective permeability at the fracture scale can display different properties due to non uniform evolution of the local permeability field to evaluate the evolution of effective permeability of the considered media flow eq 6 is solved using a head imposed configuration between two parallel boundaries similarly to permeameter conditions renard and de marsily 1997 the homogenized values of the hydraulic conductivity in the x and y direction are thus computed based on stationary fluid flow 2 3 2 simulation setup several sets of simulations using nine different fracture geometries were set up to better understand the different processes involved during precipitation in fractures in particular we explore the influence of i reactive transport parameters i e fluid reactivity and injection rate thanks to the advective damköhler daadv seigneur et al 2019 ii fracture geometry and iii mineral heterogeneity distribution at the fracture walls on the flow path evolution and permeability reduction in fractured media testing different configurations is motivated by the experimental observations where these parameters have shown to play a role in the fracture filling and flow reorganization first reactive transport modeling of the experiments was performed to validate and calibrate the model the three first fracture geometries used in the simulations are the planar fracture the planar fracture with two grooved channels and the trapezoidal fracture whose geometry is derived from the xmt imaging the fracture void domains of 50 0 15 0 mm are meshed with a 100 30 grid size fig 1 the initial and boundary conditions for fluid chemistry and flow are similar to the experiments table 1 the injected flow rate is imposed at the sample inlet in the x direction while a constant atmospheric pressure is set at the outlet the other external boundaries are no flow boundaries calcite and dolomite substrates are set in first instance as a continuum in every mesh in a 50 50 proportion with an equal initial specific surface area s cal s dol in a first approach precipitation is assumed to occur equally on both calcite and dolomite secondly a critical saturation state ω c r i t d o l 10 for precipitation onto dolomite is set this value was selected based on the sem observations of calcite growth onto dolomite matched against the saturation state maps obtained in the first set of simulations see further in section 3 1 the specific surface area is adjusted to fit with the calcium concentration measured at the sample outlet for experiment cra3fa in addition to modeling of the experiments six model fractures fig 2 a with a geometry more representative of natural fractures whose walls would experience an increase degree of shearing were generated using the synfrac software glover et al 1998 the motivation for simulating reactive transport in synthetic fractures is threefold first the geometries used in the present experiments are simplistic and the results are not meant to be extrapolated to natural media second the fluids commonly used to run experiments in the laboratory godinho et al 2016 godinho and withers 2018 noiriel et al 2012 wu et al 2010 lee and morse 1999 or in the field cuthbert et al 2013 are far oversaturated compared to saturation state encountered in most of natural waters the log of which rarely exceeds 1 so that the reactivity relevant to natural settings should be lower the choice of a high saturation index in experiments is linked to the precipitation rate of calcite which decreases exponentially along the fracture eq 10 thus constraining the duration of the experiments the latter being shorter a few days weeks when supersaturation is exaggerated the counterpart of this is a sharp reaction front godinho and withers 2018 morse and mackenzie 1993 noiriel et al 2012 hilgers and urai 2002 lee and morse 1999 driving to a rapid sealing of the sample inlet during experiments where precipitation rate is orders of magnitude higher than a few mm cm further however calibrating the model using well constrained experiments should permit extension of its application to more natural conditions i e with lower rcal third generating fracture allows for controlling the degree of geometric anisotropy of the fracture aperture parallel or perpendicular to the flow direction and for evaluating the effects of fracture wall mismatch and of the mineral heterogeneity distribution on the capacity of fractures to self healing the six different fracture geometries are set up from three starting fracture aperture fields generated with synfrac which differ by their anisotropy factor af 1 2 and 4 the grid size is 64 64 and the geometry of the fracture walls is periodic the aperture distributions are close to gaussian distributions with a mean aperture am of 400 1 µm and a standard deviation σ a of 152 2 µm leading to a roughness factor σ a am of 0 38 these values are consistent with data measured in natural limestone fractures after dissolution process noiriel et al 2013 2007 from these aperture fields six different fracture geometries of 128 64 grid sizes 51 2 25 6 mm are derived in the first cases the initial aperture fields are duplicated in the x direction to generate fracture geometries whose direction of stretching of the aperture field is parallel to the flow direction resulting in a higher correlation length λ x in the x direction in the second cases the initial aperture fields are first rotated 90 and then duplicated in the x direction to generate fracture geometries whose aperture field direction of stretching is perpendicular to the flow direction resulting in a higher correlation length λ y in the y direction table 2 summarizes the three sets of simulations with their investigated parameters the first set of simulations focuses on the impact of reactive transport on the evolution of the precipitate distribution in the fracture void and the reorganization of flow and thus the fracture anisotropy and the mineral heterogeneity distribution are kept invariant for that we define the advective damköhler number at time t 0 which is to some extent equivalent to d a 0 p e 0 as 15 d a a d v 0 α r 0 v 0 α r 0 q 0 where r 0 and v 0 are the rate of calcite precipitation r cal 0 and the average fluid velocity at t 0 respectively and α and α are coefficients the initial geometry used in that set of simulations is af 1 calcite nucleation is first assumed to occur homogeneously and at the same rate at the fracture walls so that calcite and dolomite are set in a 50 50 proportion in every mesh with an equal specific surface area s cal s dol both the injection rate and the mineral reactivity are increased or decreased compared to the experimental conditions to investigate a range of da adv 0 spanning four orders of magnitude a reference injection rate q 0 ref 12cm3 h 1 and precipitation rate at the fracture inlet r 0 ref 1 44 10 7 mol l 1 s 1 with n 1 12 eq 10 are set from the modeling conditions in fracture cra3fa in order to define at the inlet the reference da adv 0 ref β eight values of da adv 0 ranging from 0 1 to 300 β are explored by varying the injection rate q 0 ref 300 q q 0 ref and or the precipitation rate r 0 ref 100 r cal 0 r 0 ref to mimic injection of less reactive fluids at slower velocities the quantity r cal 0 r 0 ref is defined as the reactivity factor rf in the simulations table 2 evaluation of the dependence of the precipitation rate to the order of reaction was also achieved in a simulation using a lower exponent n 0 65 in the kinetic formulation eq 10 kcal was increased about 4 times to keep the same r 0 ref and reactivity factor rf 1 than in the reference simulation simulations are stopped either when complete sealing of the fracture is achieved i e for a permeability in the flow direction kx 10 11 m2 or when porosity reduction has reached a sufficient low value 10 15 regarding the duration of the simulation the second set of simulation evaluates the impact of the fracture anisotropy in relationship to the flow direction i e parallel or perpendicular to the aperture stretching direction in these simulations the six fracture geometries af 1 2 4 are used precipitation is still assumed to occur homogeneously on both calcite and dolomite at the fracture walls the same values of da adv 0 than in the first set of simulations are explored the third set of simulations accounts for the variability in mineral distribution at the fracture walls and for the existence of a critical saturation state ω c r i t d o l to initiate precipitation onto dolomite substrate in these simulations the mineral distributions are mapped on the fracture geometry af 4 with da adv 0 β and the simulations are compared with the previous simulation assuming a 50 50 mineral proportion in every mesh continuum representation of the mineral substrate three values of ω c r i t d o l are tested i e 10 20 and 30 the first value is derived from the experimental observations see further in section 3 1 the second further restricts precipitation onto dolomite in the last case precipitation onto dolomite is impossible due to the fact that ω c r i t d o l ω c a l 0 this case mimics what could happen when the critical saturation state with respect to a mineral is never reached and how it would affect fracture sealing six types of spatial distribution of minerals including three different mask patterns are considered mineral spatial heterogeneity is considered by varying the spatial distribution of calcite and dolomite volume fraction in every mesh with 50 of the meshes considered to contain only calcite and 50 only dolomite in the four first cases classification of the meshes is based from the generation of a 128 64 random field with uniform standard distribution to create the first random distribution the 50 smallest values are set to calcite mask 1 defining small mm size clusters as isolated spots of mineral of 400 400 µm2 in this case the mineral phases i e calcite or dolomite clusters are not connected through the fracture in the second random distribution mask 2 and inv mask2 the 1 5 smallest values are picked up as small calcite or dolomite spots and clusters are grown until the mineral fraction has reached 50 of the domain for these cases isolated spots of about 3 3 mm2 and cm size clusters are defined and only one mineral phase is connected through the fracture in the last two cases calcite and dolomite are correlated to the local aperture distribution in this case both mineral phases are connected through the fracture the 50 largest local apertures are either assigned calcite mask 3 or dolomite inv mask 3 mask3 configuration aims to evaluate the influence of pre existing fracture alteration prior to precipitation in multi mineral rocks the case calcite is assigned the largest apertures mimics a small degree of alteration of the fracture prior to precipitation where the higher dissolution rate for calcite compared to dolomite morse and arvidson 2002 would increase the fracture aperture in areas calcite is present noiriel et al 2007 ellis et al 2013 the case dolomite is assigned the largest apertures is the complementary case the different masks are presented in fig 2b 3 experimental results 3 1 calcite nucleation and growth at the fracture walls the size orientation and density of the calcite crystals newly precipitated at the fracture wall surfaces is highly variable and closely related to the calcite precipitation rate which depends on the mineral substrate the local saturation state with respect to calcite ω c a l and the local flux of reactants along the flowpaths xmt image difference between t1 and t0 and sem imaging after the experiments allow for determination of the areas where precipitation occurred in all samples precipitate amount is higher near the inlet of the fractures where ω c a l is the highest and the crystal size and density are shown to decrease progressively from the inlet to the outlet fig 3 growth of calcite proceeds by growth of heteronuclei on mineral substrate polycrystal growth results in blocky microstructures with epitaxial growth on existing micro sparite seed crystals the crystals are randomly oriented due to the multitude of orientations depicted by the seed crystals in the rock it is worth noting that a few dumbbell aragonite crystals are also noticed in the fracture void at low flow rate cra1fa and cra2fa the fracture aperture reduction is scarce and cannot be caught properly with xmt however individual crystals and crystal clusters are noticed at the fracture walls fig 3a at high flow rate cra3fa and cra4fa equant crystals grew on most of the fracture wall surfaces near the inlet whereas further in the fractures crystals grew preferentially onto calcite substrate compared to dolomite substrate fig 3b this effect has an increasing impact as far as the average crystal size decreases i e toward the outlet suggesting that nucleation on dolomite substrate requires a higher energy and so a higher critical saturation index log ω c r i t d o l crossing of sem observations of precipitate onto dolomite with modeling of experiment cra3fa see section 4 1 gives an estimate of ω c r i t d o l of 10 it is worth noting that precipitation is unlikely to initiate at the surface of silicates i e quartz and k feldspar fig 3 inserts 5 and 6 which remains uncovered until crystals grown on carbonates are big enough to combine fig 3 insert 4 precipitation is also localized in the areas of preferential flow fig 3b where crystals can be a dozen times bigger than in the areas of lower aperture multiple crystal orientations involving different facet growth rates and competition between neighboring crystals nollet et al 2006 that result in enclosed crystals are also visible locally despite ω c a l is assumed to be identical and contribute to the growth rate heterogeneity fig 3 insert 4 different induction times for precipitation noiriel et al 2016 stockmann et al 2011 and ostwald ripening steefel and van cappellen 1990 kile et al 2000 are other causes that can explain the difference in crystal sizes fracture sealing was observed at the inlet of samples cra3fa and cra4fa at high flow rates after 16 7 and 24 6 days of experiment respectively sealing was indicated by an expulsion of the sample from the jacket due to an abnormal pressure increase at the inlet which indicates that permeability was reduced to a value below 10 11 m2 assuming a pressure of 0 2 mpa at the inlet thus corresponding to a hydraulic aperture of about 10 µm although it corresponds more to partial sealing rather than complete sealing for which fracture permeabilities are reported in the range 10 14 10 17 m2 griffiths et al 2016 ye et al 2020 we can infer that complete sealing is close for cra3fa sealing corresponds to the closure of both the 170 µm width planar fracture surface and the 700 µm deep main channel inlet for cra4fa sealing corresponds to the closure of the trapezoidal inlet of minimum and maximum apertures of 170 µm and 400 µm respectively however it is worth noting that the main channels close to the inlet remain micro porous despite fracture sealing 3 2 fracture sealing rate 3 2 1 quantitative determination of the extend of the reaction the volume of calcite precipitated and the fracture scale sealing rate were estimated from δca between the sample inlet and outlet table 3 the amount of precipitate is over one order of magnitude higher for samples at high flow rate compare to low flow rate however the average ca out is quite similar for all the experiments indicating that kinetics globally controls the precipitation rate over the flow rate or the fluid resident time at high flow rate however a 30 time shorter resident time in the experiments explains why the global precipitation rate is 20 to 36 times higher compared to low flow rate 3 2 2 local precipitation rate based on imagery following eq 3 the local precipitation rate can also be calculated and mapped for samples cra3fa and cra4fa as shown in fig 4 the precipitation rate is higher close to the fracture inlet where supersaturation was the highest and decreases very quickly along the samples the precipitation rate is also higher in the channels for cra3fa the fracture closure rate near the inlet is about 8 µm d 1 in the main channel up to 25 µm d 1 for some single crystals and 5 µm d 1 in the planar sides the local rates in the two diverted channels are somewhat equivalent although both xmt and sem observations show that they are higher in the deeper channel two plumes with a high precipitation rate are also observed at each inlet termination i e next to the impermeable boundaries and certainly underline the final injection paths that preceded sealing for cra4fa the fracture closure rate near the inlet and in the area of higher aperture is about 5 µm d 1 in whereas it is only 3 µm d 1 in the area of lower aperture for cra1fa and cra2fa at low flow rate x ray micro tomography was not enough resolved to quantify changes in the fracture geometry however analysis of crystals using sem show the same patterns than for cra3fa and cra4fa although the crystal size is smaller e g from 15 8 7 3 µm to 0 5 0 2 µm between the inlet and outlet for cra1fa assuming roughly that the crystal size is equivalent to the aperture reduction this results in a fracture closure rate of about 0 4 µm d 1 near the inlet which reduces to about 0 01 µm d 1 near the outlet 4 reactive transport modeling 4 1 modeling of the experiment cases fig 5 shows the calcite precipitation patterns and the associated permeability reduction obtained in the simulations with a satisfactory visual agreement compared to the experiments cra3fa and cra4fa fig 4 both regarding the amount of precipitation near the inlet and the difference in the extent of precipitation in the main flowpaths a good agreement is also obtained with the experimental calcium outlet concentration and overall volume of precipitation fig 6 using an initial specific surface area s 0 of 60 m2 l 1 and a precipitation dependent term sgrowth of 0 21 m2 g 1 for all the samples the increase in specific surface area with precipitation further enhances the precipitation rate as far as the porosity decreases thus explaining a slight decrease of ca out with time nevertheless the volume precipitated is a bit overestimated for cra1fa and underestimated for cra4fa although it is possible to obtain better fits by adjusting the specific surface area we prefer to keep the same value for sm to validate the model for the different geometries and flow conditions modeling of experiment cra1fa which is equivalent to a simple 1d model allows for examining specifically the kinetic model which depends on both the kinetic formulation eq 10 and the evolution of the specific surface eq 11 for all cases explored a good agreement is found between experiment and simulation regarding the volume fraction of calcite precipitated along the flow path except near the inlet boundary where uncertainties remain fig 7 reducing s 0 to 8 m2 l 1 with no precipitation dependent surface area i e sgrowth 0 would decrease the amount of calcite precipitated near the inlet and permit to better fit with the total amount of calcite precipitated 4 4 mm3 vs 3 1 mm3 in table 3 a lower sm would also highlight the drop in precipitation rate linked to ω c r i t d o l which occurs at x 8 mm from the inlet where the gradient of precipitation is less pronounced in addition taking a constant specific surface area through the simulation i e sm s 0 would also largely modify the amount of calcite precipitated near the inlet compared to a variable specific surface area i e sm s 0 sgrowth fig 7 for instance increasing the value of sgrowth from 0 to 0 21 m2 g 1 results in a larger increase of precipitation near the inlet promoting the reduction in permeability and sealing of the fracture however it is worth noting that the behavior near the inlet is difficult to assess as i part of the sample inlet surface is also exposed to the inlet fluid in the experiment and ii the simulation critically relies on the models for reactive surface area and permeability evolution limiting the evaluation of the kinetic model the local changes in porosity and permeability significantly affect the flowpaths through time through a negative feedback between flow and transport supplementary video s1 reactive fluid is initially focused within the areas of higher apertures i e the main flow paths where the precipitation rate is higher indeed a higher renewal rate of the inlet fluid maintains a higher saturation index along the preferential flowpaths preferential filling of these flowpaths with calcite decreases locally the permeability thus leading to a progressive reorganization of the flow in areas initially deserted by the fluid whose permeability becomes at some point higher than the permeability in the filled flowpaths experiment cra2fa at low flow rate is the most efficient from the point of view of calcium uptake from the inlet fluid in the sense that the overall calcite precipitation was reduced only by a factor 8 10 compare to high flow rate while the calcium flux at the inlet boundary fca q 0 ca in is comparatively 30 times lower this is explained by the longer resident time which favors a higher consumption of calcium along the fracture however in result precipitation is more localized near the inlet fig 5a compare to high flow rate experiment cra3fa interestingly the simulations are able to reproduce the sealing observed experimentally when porosity reaches low values below 5 prediction of sealing becomes strongly dependent on the empirical porosity permeability relationship and on the choice of a critical porosity or permeability sgrowth plays also an important role by promoting precipitation where precipitation is more important i e near the inlet in the simulations almost complete sealing is assumed when fracture aperture is reduced to about 4 µm near the inlet like in the experiments thus corresponding to permeability decreases by 5 orders of magnitude given that threshold sealing at the inlet of cra3fa and cra4fa is almost completed after 20 and 22 5 days respectively fig 5b a further decrease in permeability by 9 orders of magnitude is reached after 23 and 25 days respectively it is worth noting that the geometry of the fracture plays an import role on the time required for sealing for instance cra3fa is unexpectedly sealed earlier than cra4fa despite a larger maximum aperture 700 versus 400 µm while mean apertures were comparable 280 5 µm in other words large aperture flow channels with high reactant flux fill more rapidly simulations also permit to account for different precipitation conditions onto the two mineral substrates fig 5a initially the specific surface area is the same for calcite and dolomite s cal s dol when considering a critical saturation state ω c r i t d o l there is a point beyond which the fluid is not sufficiently oversaturated to initiate precipitation on the dolomite substrate this results in a slight discontinuity in the downstream calcite precipitation pattern compared to the case ω c r i t d o l 0 fig 5a cases cra3fa as well as a lower precipitation rate difference in the two approaches mostly affects downstream calcite precipitation patterns with no effect near the inlet boundary 4 2 modeling of the synthetic fractures the reactive transport approach is then applied to the synthetic fractures in order to generalize the experimental observations to fracture geometries more relevant of the ones encountered in natural systems 4 2 1 effect of reactive transport conditions for the range of precipitation and flow rates tested in the simulations we observe very different precipitation patterns fig 8 two different regimes similarly to those described in the literature are identified depending on the value of da adv 0 i e non uniform compact precipitation and quite uniform precipitation tartakovsky et al 2007 precipitation is predicted to be compact i e highly localized at the inlet for the highest values of da adv 0 30 300β whereas it is more uniform along the flow paths for the lower values of da adv 0 0 1 0 3β at high da adv 0 precipitation is focused near the inlet and the solution becomes rapidly depleted in reactants leading to compact precipitation the rapid precipitation has a positive feedback on reactivity by increasing the specific surface area near the inlet favoring sealing potential for da adv 0 300β log ω c a l drops from 1 38 to 0 2 in the first millimeters and equilibrium is reached within the fracture precipitation starts in the main flow paths whose rapid filling leads to a quick reorganization of the flow at the inlet as a result sealing of the fracture is quick and happens for a low amount of calcium injected 0 01 mol and an average porosity reduction of less than 5 at low da adv 0 precipitation is more uniform in the fracture void especially for reactivity factors rf 1 n 1 12 for which ω c a l decreases by less than one unit through the fracture in the case rf 1 n 0 65 the lower dependence of the precipitation rate to the saturation index allows for more uniform precipitation along the fracture void as well as a result complete sealing of the fracture is expected to be quite slow but uniform and should only happen for a large amount of calcium injected as evidenced by an effective permeability reduction in the flow direction kx of less than one order of magnitude for a 10 global porosity reduction similar values of da adv 0 but one order of magnitude difference in both da 0 and pe 0 i e for da adv 0 3 and 30β do not lead exactly to the same precipitation patterns indeed for a similar porosity decrease permeability reduction is higher for the highest values of da 0 and pe 0 while sealing of the fracture is expected at some point it is worth noting that changes of the effective permeability parallel kx or perpendicular ky to the flow direction can be very different fig 9 for the uniform precipitation regime kx and ky decrease in the same ratio in contrast for the compact precipitation regime kx can decrease 5 orders of magnitude while ky is reduced by only 10 due to localization of precipitation at the inlet boundary the high discrepancies are the expression of the non uniform precipitation at the fracture scale 4 2 2 effect of fracture and flow anisotropy fig 10 shows the effect of the geometric anisotropy factor with regards to the flow direction af 1 2 or 4 or on the precipitation patterns and permeability reduction increasing anisotropy has only slight but opposite effects depending on the stretching direction of the aperture field stretching parallel to the flow direction both decreases the tortuosity of the flow paths and increases the longitudinal dispersivity zheng et al 2009 thus spreading the high reactive fluid over longest distances as a result precipitation is a little less localized at the inlet and more uniform along the flow paths local precipitation induced aperture reduction promotes the reorganization of flow paths precipitation being localized initially in the regions of higher porosity this has a net effect in reducing the fracture anisotropy but only at the low da adv 0 fig 10 in contrast aperture field stretching perpendicular to the flow direction increases the tortuosity of the flow paths thus increasing the residence time of the reactants and favoring precipitation and sealing near the inlet boundary changes in effective permeability parallel or perpendicularly to the flow direction fig 11 suggest only a slight impact of the orientation of the fractures with regards to the flow direction for most da adv 0 with the and permeability reduction curves getting more separated with increasing anisotropy factor figs 9 and 11 no impact is noticed at high da adv 0 where the rapid sealing at the inlet occurs whatever the fracture aperture field heterogeneity for the other values of da adv 0 whereas the permeability reduction curve is barely affected in the isotropic case fig 9 increasing af enhances the impact of fracture orientation to the permeability evolution fig 11 4 2 3 effect of mineral heterogeneity at the fracture walls for the range of mineral substrate distributions at the fracture wall masks 1 to 3 and inv mask 2 and 3 and critical saturation state ω c r i t d o l 10 20 and 30 tested in the simulations we observe evolutions of fracture geometry fig 12 and permeability fig 13 very different from the case calcite and dolomite substrates are set as a continuum the geometry and permeability evolutions are highly dependent of both ω c r i t d o l and the spatial distribution of mineral substrates using the continuum description for mineralogy i e 50 50 calcite dolomite in every mesh and in the condition of simulation af 4 and da adv 0 β increasing ω c r i t d o l restricts the fraction of fracture void where precipitation will occur onto dolomite substrate there is a limit at a certain distance from the inlet from which precipitation onto dolomite stops thus decreasing the amount of precipitated calcite downstream however precipitation near the inlet remains equivalent to what happens when no restriction is set for precipitation onto dolomite substrate i e ω c r i t d o l 1 except in the case ω c r i t d o l 30 for which precipitation is reduced to about a factor two at the inlet inherent to the fact δ a returns 0 in eq 10 as precipitation is localized near the inlet kx evolution remains quite similar for the different cases and it does not either affect the sealing capacity of the fracture in the same way ky is barely affected in contrast using the heterogeneous distribution of mineralogy with the different masks prevents precipitation from happening onto dolomite through part or totality of the fracture void i e in every 100 dolomite meshes where ω c r i t d o l ω c a l in that case the precipitation patterns and permeability evolution are highly dependent on the spatial distribution of mineral heterogeneity and the spatial continuity of the non reactive substrate increasing ω c r i t d o l enhances the heterogeneity of both precipitation and flow downstream but precipitation is not affected upstream fig 12 b no precipitation onto dolomite has two consequences first the fluid keeps a higher saturation index allowing precipitation to progress further in the fracture void however the porosity reduction remains slower as between 0 and 50 of the surface area in the domain is not reactive anymore explaining a more rapid drop in permeability with porosity reduction when ω c r i t d o l increases from 10 to 20 fig 13 taking the critical case ω c r i t d o l 30 as an example i e no precipitation onto dolomite through the whole domain we clearly see the differences between the different masks of heterogeneity in term of precipitation patterns permeability evolution and reorganization of flow fig 12 c f and supplementary video s2 precipitation only happens onto calcite and starts in high aperture areas hosting this substrate filling of these areas progressively drives the flow to areas where no precipitation is possible creating new flow paths independently of the negative feedback between flow and transport observed in the case precipitation is not restricted to one mineral phase in particular if the dolomite substrate is continuous in the flow direction i e for inv mask2 sealing will be impossible and the effective permeability kx decreases only slightly to reach a limit kx lim fig 13 consequently permeability cannot decrease further and flow stabilizes to a steady state in contrast if the dolomite substrate is not continuous flow will stop once precipitation onto calcite forms a barrier to flow i e for mask 1 and inv mask 2 the aperture correlated clusters mask3 and inv mask3 are interesting in the sense that the dolomite substrate is continuous in both cases so that no sealing is possible however the evolution of permeability is different depending on whether calcite is set in the large aperture fraction mask3 or low aperture fraction inv mask3 in these cases flow is naturally driven towards the main channels of larger aperture for the case mask3 they contain a substrate of calcite as a result the channel inlets fill rapidly with calcite thus provoking a more rapid permeability decrease with porosity reduction than inv mask3 up to the point the flow is diverted to the low aperture channels with a dolomite substrate in this case precipitation results in a large reorganization of flow precipitation being impossible onto dolomite permeability stabilizes whereas precipitation continues downstream on the calcite substrate supplementary video s2 in contrast for inv mask3 there is no precipitation in the main flow channels which contains dolomite calcite precipitation is still maintained in areas adjacent to the main channels through diffusion transverse dispersion but is slower consequently high saturation are maintained over longest distances and permeability decreases more smoothly with porosity reduction fig 13a although the drop is larger as a function of time than for mask3 fig 13b 5 discussion 5 1 precipitation process and reorganization of flow the precipitation regime strongly depends on da adv 0 at a given flow rate however the compact precipitation regime is also largely dependent on the shape of the kinetic rate law noiriel et al 2012 which is itself a function of the saturation index far from equilibrium conditions log ω c a l 0 8 will promote three dimensional growth of islands or two dimensional surface nucleation at the mineral surface these growth regimes result in high values of the exponent n 2 teng et al 2000 that will accentuate the strong drop of precipitation at the inlet as far as the reactants are consumed in contrast for moderate saturation indexes log ω c a l 0 8 the spiral growth mechanism results in an exponent n 1 teng et al 2000 in this case the drop in precipitation rate with the saturation index is less sharp especially near the equilibrium i e when 1 ω 0 where the precipitation rate is almost constant this would result in relatively uniform precipitation along the flow path testing an n 0 65 i e precipitation rate poorly dependent on the saturation state although the assumption is far fetched for mineral precipitation driven by injection of oversaturated fluids confirms the importance of the fluid reactivity path in the reorganization of flow specific surface area increase with precipitation can also promote the compact precipitation regime introducing a specific surface area dependent to the amount of new precipitate eq 12 clearly shows a positive feedback loop thus contributing to a faster sealing near the inlet the value of 0 21 m2 g 1 for sgrowth used in the simulations is questionable as it was obtained during precipitation onto calcite seeds no evident decrease of ca out with time supports a large increase in specific surface area during precipitation although the sensibility in determining δca from chemical analyses is low for precipitation studies whatever the extent of sm increase it should have large consequences on the evolution of precipitation patterns and time for sealing under constant sm conditions closure of the fracture would normally drive fluid with a higher supersaturation index further in the fracture void as a result of fluid velocity increase however when sm increases and despite the fluid velocity increase precipitation remains localized near the inlet this is particularly visible when looking at the level sets of ω c a l they move upward in the fracture as the reaction rate increases near the inlet see supplementary videos s1 and s2 as a result an increase in sm promotes as well the compact precipitation regime it is clear that the lack of constrains on the kinetic formulation is the primary source of uncertainty for modeling reactive transport and predicting the time required for complete sealing nevertheless these observations confirm that da adv 0 cannot solely be an indicator for the reaction regime noiriel 2015 as evolution of the local precipitation rate through time along the flow paths and through the fracture is a time and space dependent process 5 2 the importance of mineral substrate heterogeneity both the experiments and simulations have evidenced the role of mineral substrate distribution at the fracture walls on the evolution of fracture geometry and flow reorganization the modeling results show that mineral heterogeneity can have a profound impact larger than that of da adv 0 or fracture geometry on the precipitation regime reorganization of the flow and sealing capacity it will both depend on the spatial distribution of substrate clusters and on the ability for new crystals to grow at their surface in relationship with the critical saturation index log ω c r i t modeling with mineral spatial heterogeneity has shown that dolomite substrate or more generally any mineral phase whose surface energy is different from the primary mineral can significantly alter the filling of the fracture void in case precipitation is restrained or not permitted in specific fracture regions the spatial connectivity or conversely the absence of connectivity of the non reactive substrate will underling two extreme cases of permeability evolution with either i a rapid drop in permeability and fracture sealing for small and spatially non connected mineral substrate spots fig 13 or in contrast ii only a slight decrease of permeability that stabilizes when the non reactive substrate is connected through the void space consequently the nature and spatial organization of mineral substratescan change the precipitation regime for small non connected clusters the regime can be more compact in contrast for non reactive substrate connected through the fracture sealing might never be reached indeed large scale portions of the fracture void can fill up while flow is ultimately maintained in the network of non reactive substrate in absence of precipitation onto that substrate i e when ω c r i t ω c a l 0 some flow paths will remain free of precipitation thus preventing fracture sealing although not investigated in this study the proportion of non reactive mineral substrate at the fracture wall is certainly a key parameter that will control fracture spatial connectivity the concentration field of reactants and precipitate in the reactive and non reactive paths will also be largely dependent on the mineral substrate heterogeneity this is important for environmental studies e g when a contaminant is expected to be stabilized in a mineral phase e g guren et al 2020 kumari d et al 2016 or for biogrouting not only the capacity of sealing will be affected but the propagation distance of the chemical species will highly depend on the mineral substrate heterogeneity the modeling underlines the limits of the continuum approach in this context of selective precipitation onto a specific mineral phase as it does not resolve the possible connectivity of the mineral substrates in space this also agrees with the conclusion of li et al 2007 that the continuum model by averaging properties and representing the system as if it is well mixed does not resolve the pore scale structure when high concentration gradients develop although their conclusions were reached for dissolution of minerals with a high contrast in reactivity this can be extended to precipitation involving mineral substrates with different surface energy or affinity with the new precipitate however for precipitation mineral heterogeneity might prevent from sealing only when the non reactive substrate forms a connected network maintaining flow paths open for the reactive fluid in addition it is expected that the phenomenon is transient in reality as the model does not account for possible lateral growth of crystals that could finally cover the non reactive clusters at some point like observed experimentally near the fracture inlets bridges made between newly grown crystals might compensate for heterogeneous distribution of mineral substrate heterogeneity at the fracture walls in any case mineral heterogeneity should nevertheless promote a more uniform filling of the fractures when possible although we do not know yet whether the grain boundaries between the growing crystals and the non reactive substrate mineral remain or not micro porous and possibly connected flow channelization is also highly sensitive to mineral spatial distribution in rocks the negative feedback between reaction and flow tends to minimize local perturbations whereas precipitation localized on a specific substrate tends to magnify them the flow properties which are highly dependent on the spatial reduction of fracture aperture are therefore largely modified by the presence of mineral heterogeneity in this case the continuum approach would fail at describing the reorganization of flow and the persistence of open flow paths 5 3 evolution of the effective porous medium properties and implications for fracture sealing for engineering purposes reactive transport simulations often require large spatial scale models which rely on upscaled properties of the porous fractured media when subject to mineral dissolution precipitation reactions hence pore or fracture scale micro continuum simulations can be useful to better assess the evolution of the medium properties and feed continuum models with upscaled properties when precipitation occurs with no distinction of mineral substrate the extent of the porosity and permeability alteration and the porosity permeability relationship are highly dependent on daadv although this parameter alone might not be sufficient to fully describe fracture sealing for instance ahkami et al 2020 who isolated different precipitation regimes in fractured porous media must refer to both d a 0 p e 0 and p e 0 to define these regimes in addition it is difficult to provide a numerical value for daadv when regarding heterogeneous phase reactions like mineral precipitation noiriel 2015 so that we preferred to explore the effect of da adv 0 relatively to a reference parameter i e β the way the fracture can be sealed uniformly i e associated to a permeability reduction both along and across the main flow directions will depend on two factors i the precipitation kinetics in strong relationship with the saturation index and the specific surface area model and ii the mineral substrate distribution from our results it appears that only slow i e long term precipitation in conditions close to the equilibrium can guarantee proper sealing of fractures over large scales something required to ensure reservoir tightness and improvement of the mechanical properties of fractured rocks e g recovering cohesion aben et al 2017 bons et al 2012 high fluid velocities could help to obtain a similar result as well although the strong non linear decrease in precipitation kinetics of highly saturated fluids will be an obstacle to uniform fracture sealing as well as a possible increase of specific surface of minerals through precipitation in any case the ratio of the critical porosity defined as the porosity below which the fracture is sealed i e ϕ c lim k x 0 ϕ to the initial porosity i e ϕ c ϕ 0 can be a good indicator of the fracture sealing efficiency the critical porosity increases with decreasing da adv 0 and at a given da adv 0 it increases or decrease slightly depending on the anisotropy factor and flow orientation a high ϕ c ϕ 0 will result in a small fraction of the fracture void filled with calcite i e compact precipitation whereas a low ϕ c ϕ 0 will indicate uniform sealing of the pore space fig 14 when conditions for more uniform precipitation are encountered i e for low exponent n or da adv 0 the negative feedback between flow and transport will tend to decrease the permeability anisotropy of fractures so that at a larger scale the permeability in fractures can be described by an isotropic tensor in contrast non uniform compact precipitation driven by the non linear precipitation rate and or coupling between flow and reaction will act as a barrier to flow in the vicinity of the injection point this regime has the highest impact on permeability reduction and local sealing can be achieved quickly in far from equilibrium conditions and highda adv 0 values however in that case sealing will be restricted to a narrow band near the inlet boundary e g the injection well then the negative feedback between flow and transport will tend to increase the permeability anisotropy of fractures whatever the initial anisotropy factor or flow direction by inducing a drastic reduction of permeability in the flow direction kx whereas minor changes will be recorded transverse to the flow ky it is also difficult to decipher what will happen further from the injection point as non uniform precipitation will trigger development of anisotropic effective properties at larger scales regarding for instance porosity and permeability and cause important large scale reorganization of flow it is possible the fluids are diverted in other channels in the fracture switched to adjacent partially sealed fractures or that complete sealing compartmentalizes large scale fluid flow like observed in geothermal reservoirs griffiths et al 2016 these conditions are only valid however when precipitates cover the entire surface of the fracture walls when polymineralic fracture walls are considered mineral substrate heterogeneity and energy barriers for precipitation can delay jones and detwiler 2016 or even prevent sealing by reducing the specific surface area for precipitation or locally inhibiting precipitate nucleation and or growth the persistence of a micro porous network resulting from heterogeneous precipitation distribution at the surface of the different mineral substrates is also something to take into account which could pinpoint the limits of unconstrained continuum modeling in particular if precipitation is refrained from certain flow paths fig 12 critical porosity or sealing could never be reached in the model although in natural fractures lateral crystal growth is also possible in that case permeability and porosity will reach a lower limit the choice for a porosity permeability relationship will be critical as classical relationship could be unable to represent results when the precipitation is not uniformly distributed through the porous network beckingham et al 2017 in addition the choice of a unique porosity permeability relationship at the continuum scale is debatable even for a given geometry of fracture indeed it was shown here to strongly depend on the injection conditions and on the mineral spatial distribution at the fracture walls for a given rock fracture upscaling of porosity permeability at the continuum scale will rely on the hydro chemical conditions along the streamlines i e on the localization within the fractured domain however a coupled description of the problem using a micro continuum model that fully accounts of mineral distribution fracture geometry flow description fluid reactivity and possible feedback between chemistry geometry and transport is definitely helpful to decipher the time and space dependent evolution of reactive transport in fractures as to estimate time for sealing 6 conclusion we have presented a combination of experiments and reactive transport modeling to better characterize the effect of mineral precipitation on the flow reorganization and sealing in fractures in particular the impact of reactive transport driving forces i e reaction versus flow fracture geometry and mineral heterogeneity distribution at the fracture walls was investigated simulations exploring several flow rates fracture geometries precipitation rates and distribution and reactivity of mineral substrates which require a critical saturation state to initiate heterogeneous nucleation ω c r i t have been evaluated contrary to dissolution where a positive feedback between chemistry and flow can lead to a rapid localization of flow along preferential pathways precipitation tends to oppositely reorganize flow precipitation is first promoted in the preferential flowpaths where a higher saturation index and so a higher precipitation rate are maintained further in the fracture void through a negative feedback between reactions and transport the flow is progressively diverted from the initial highly conductive channels and reorganized until the fracture is sealed precipitation has shown to be non uniformly distributed both in the direction parallel and perpendicular to the main flow direction non uniform precipitation along the flow direction is related to the existence of main flowpaths that ensue both from the aperture field heterogeneity and the fracture anisotropy factor and to the balance between mineral reactivity and flow rate that can be expressed through the initial advective damköhler number i e da adv 0 high da adv 0 favor a rapid sealing near the inlet boundary whereas low da adv 0 can lead to complete and uniform sealing of the fracture the nonlinear decrease in mineral precipitation rate for highly saturated fluids in far from equilibrium conditions is a contributing factor to a rapid precipitation rate near the injection point in addition when sealing is highly localized near the fracture inlet it contributes to anisotropic permeability increase with kx dropping quickly in the flow direction while little changes in ky transverse to the flow are observed in contrast uniform precipitation regime should contribute to decreasing the permeability anisotropy of fracture exhibiting a high anisotropic factor overall the micro continuum approach of reactive transport in fractures has shown the ability to capture the major observations of the experiments calibration for one experiment cra3fa showed the model ability to make successful predictions for the results of other experiments under different flow rates and fracture geometries although much experiment effort is still required to better assess the kinetic law in particular with regard to the evolution of the specific surface of growing crystals these simulations show that a properly parameterized reactive transport model can reproduce precipitation patterns observed in anisotropic fractures even close to complete sealing at larger scale the fracture anisotropy does not appear as an obstacle for a 1d continuum description of fractured media during precipitation process as filling of the preferential flow paths will trigger transversally a reduction in aperture distribution heterogeneity with time however the continuum description at a larger scale could fail to describe the precipitation process of minerals of various affinities to mineral substrates at least in the short term and for large scale mineral substrate heterogeneity and connectivity i e when all the fracture wall surfaces have not been yet covered by the new precipitate the mineral substrate distribution definitely appears as an important factor that will drive the reorganization of flow with precipitation in particular when both mineral clusters are big in the x and y directions regarding to the fracture aperture and connected through a network and a high critical saturation index restricts precipitation on some substrates at the fracture walls it is also probable that the role of mineral distribution i e the rock texture dominates over da adv 0 or fracture geometry anisotropy for prediction of the fate of reactive fluids in geological reservoirs or aquifers it could constitute a new assumption to explain why fractures in shallow depth environments are only partially filled with cement deposits and do not seal totally at larger scale and considering a fracture network the increase in anisotropy of permeability can also lead to more complex reorganization of flow compared to what has been observed in this study these simulations also suggest that pore scale heterogeneities and anisotropy can exert a control on the distribution of the precipitates and hence on the evolution of the fractured medium properties application to natural systems exhibiting a high degree of heterogeneity in material properties e g local porosity and permeability mineral reactivity specific surface area will make these predictions more challenging the study points at future models that could better include rock textures and mineral spatial distribution to improve their reliability nevertheless the model remains a useful and computationally efficient tool to probe the interplay between precipitation reactions flow and transport in rocks with complex mineral textures statement we do not know what kind of statement must be provide here the author guide is not clear about it declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments we would like to thank laurent auberoux cm quartz for providing access to the crayssac quarry jérôme sterpenich géoressources nancy christophe tenailleau and benjamin duployer cirimat toulouse for xmt acquisitions we are also grateful for the sem technical support provided by philippe recourt université de lille 1 and thierry aigual get c noiriel acknowledges funding from cnrs insu through the project tellus cessur georac supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2021 103916 appendix supplementary materials image application 1 image application 2 image application 3 
308,the processes that affect reorganization of flow and transport in fractures during precipitation were investigated experimentally and numerically in order to highlight the interplay between calcite precipitation flow and growth substrate calcite was precipitated from a supersaturated solution at two different flow rates 0 4 or 12 cm3 hr 1 into artificial fractures made in dolomitic limestone although the inlet fluid composition and temperature were identical for all the experiments facture sealing and precipitation patterns were closely linked to the mineral substrate fracture geometry and flow field reorganization calcite precipitation rate is highly variable along and between the flow paths and depends on the local saturation index of the reactive fluid in addition calcite precipitates preferentially on calcite comparatively to dolomite substrate 2d reactive transport modeling accounting for the negative feedback between porosity and permeability decrease succeeded in quantitatively reproducing the experimental observations such as the evolution of the fracture void obtained from x ray micro tomography xmt the evolution of the calcium breakthrough concentration and fracture sealing the corresponding model was then used to evaluate the impacts of fluid flow and reactivity on randomly generated anisotropic fractures geometries simulation results reveal that the sealing capacity of fractures and associated reorganization of flow depends on the damköhler number i e the ratio between characteristic times for advective transport and reaction although other factors like the fracture geometry and kinetic law play also a role at this stage more importantly the existence of a critical saturation index for initiating precipitation onto mineral substrate can substantially impair the prediction of the sealing capacity and will depend on the spatial heterogeneity and connectivity of the mineral substrate most cases result in a strong precipitation gradient along the flow direction that will increase the permeability anisotropy however under certain conditions precipitation allows the fracture to recover more isotropic properties that will lead back to a more uniform flow field and sealing negative feedback between precipitation process and transport during fracture closure supports a strong reorganization of flow of supersaturated fluids during geo engineering operations keywords calcite precipitation reaction rate law fracture sealing dolomitic limestone permeability flow x ray microtomography negative feedback reactive transport modeling critical saturation index 1 introduction fractures are known to greatly influence the fate of fluids and contaminants in low permeability rocks reactive fluids have the potential to induce fractures noiriel et al 2010 detournay 2004 chen et al 2015 engelder and lacazette 1990 seal fractures noiriel et al 2010 macquarrie and mayer 2005 dobson et al 2003 morrow et al 2001 aben et al 2017 elkhoury et al 2015 or more generally modify the fracture network griffiths et al 2016 menefee et al 2020 their impact is significant on the preferential flowpaths through the host rock as well as on the global reactivity which in turn controls the fracture evolution berkowitz 2002 deng and spycher 2019 understanding the reorganization of flow inherent to precipitation reactions within fractures is of interest for management of several geo engineering applications for applications such as co2 sequestration and mineral trapping brunet et al 2018 huerta et al 2013 cao et al 2015 garcia rios et al 2016 kim and santamarina 2016 or biogrouting cuthbert et al 2013 mountassir et al 2013 phillips et al 2016 carbonate rapid mineralization could take advantage of permeability reduction to increase storage safety in contrast a reduction of injectivity could challenge geothermal exploitation griffiths et al 2016 wagner et al 2005 however in such shallow depth and low temperature contexts natural observations reveal that fractures are only partially filled with cement deposits contrary to what is observed at greater depth and higher temperature laubach et al 2019 at least two hypotheses could explain this observation i the sealing rate is too slow regarding the timescale and or kinetics of mineral precipitation in relation with the temperature pressure and fluid composition ii the deep reorganization of the flowpaths has diverted the reactive fluids away from the initial preferential precipitation paths leading a large proportion of non connected pores or compartmentalized areas to locally persist in the fracture void and reduce the self sealing capacity in any case partial or complete sealing of opening mode fractures results from complex and coupled physico chemical processes although the positive feedback between reactions flow and transport has been largely studied for dissolution in porous media and fractures macquarrie and mayer 2005 ortoleva et al 1987 daccord et al 1993 golfier et al 2002 renard et al 1998 hung and sepehrnoori 1989 steefel and lasaga 1990 noiriel and deng 2018 hoefner and fogler 1998 detwiler et al 2003 roded et al 2020 less studies have focused on the negative feedback that develops during precipitation processes cuthbert et al 2013 chaudhuri et al 2008 chaudhuri et al 2012 tartakovsky et al 2007 jones and detwiler 2019 yoo et al 2013 kang et al 2003 sallès et al 1993 liu et al 2006 andreani et al 2009 godinho et al 2016 godinho and withers 2018 niu and zhang 2019 dijk and berkowitz 1998 however with analogy to dissolution the péclet pe and damköhler numbers da defined locally as pe v l d 0 and da kr l 2 d 0 e g steefel and lasaga 1990 hoefner and fogler 1998 where v is the fluid velocity m s 1 d 0 molecular diffusion m2 s 1 kr a first order kinetic constant s 1 and l a characteristic length m e g the fracture aperture should be useful indicators to isolate different precipitation patterns and regimes for instance lee et al 1996 mentioned that uniform precipitation of calcite can be obtained under rapid flow condition high v or only slightly supersaturated solution with respect to calcite small kr thus isolating low da and high pe conditions for uniform precipitation this observation is consistent with numerical results obtained by tartakovsky et al 2007 using a model based on smoothed particle hydrodynamics they distinguished between two compact regimes of precipitation i e uniform compact at low da and high pe and non uniform compact at higher da a third dendrite like regime might exists at very high da tartakovsky et al 2007a 2007b kang et al 2004 although unlikely to be observable in natural conditions when precipitation results from the injection of a supersaturated solution the sole existence of compact regime may result from the rapid depletion of reactants along the flow paths thus leading to preferential precipitation near the inlet boundary the non linear dependency of the reaction rate to oversaturation should exacerbate this trend morse and mackenzie 1993 noiriel et al 2012 indeed the highest the saturation index log ω the strongest the dependence with an exponent n of the kinetic law greater than one when growth occurs by the spiral mechanism at both edges and screw dislocations or by 2d nucleation teng et al 2000 however although pe and da can provide useful information about the evolution of a particular system their use can be limited noiriel 2015 or complex to handle with especially when the reaction rate varies of several orders of magnitude along the flowpaths i e between far from equilibrium and close to equilibrium conditions when boundary conditions differ from flow of a supersaturated solution e g when precipitation results from solute mixing emmanuel and berkowitz 2005 or when rock heterogeneities exert a first degree influence on the local flow and transport conditions aben et al 2017 smith et al 2013 yang et al 2020 yoon et al 2017 the fact that their value evolves with reaction progress drives us to define reference numbers at the time of injection t 0 and fracture inlet x 0 namely da 0 and pe 0 in addition even under similar flow and chemistry conditions crystal growth dynamics is often different from a uniform covering at the surface observations of dotted or more spread cement bridges in several fractures dobson et al 2003 laubach et al 2019 gale et al 2010 fall et al 2012 point toward preferential nucleation and growth on some mineral substrate similarly to what has been observed in porous media noiriel 2015 noiriel et al 2016 giving to substrate surface energy an important role in initiating nucleation and growth fernandez martinez et al 2013 de yoreo and vekilov 2003 lioliou et al 2007 lin and singer 2005 the ability of the smallest pores to maintain a higher saturation with respect to crystallization is another source of precipitation heterogeneity putnis and mauthe 2001 pape et al 2005 variation in growth rate of different crystal facets development of crystallographic preferred orientations changes in specific surface area as competition for growth between neighboring crystals complicate the geometry evolution through time nollet et al 2006 manaka et al 2008 bons et al 2012 hilgers and urai 2002 theses aspects are worth consideration especially during syntaxial or antitaxial growth in fractures the impact of precipitation on the morphology and microstructure of fractures is currently a limitation in reactive transport modeling laubach et al 2019 most models relying on a continuum description at the representative elementary volume rev scale e g molins and knaber 2019 however several approaches are emerging to account for the impact of precipitate on fracture geometry evolution for instance investigation of precipitation using the level set method jones and detwiler 2019 seigneur et al 2017 or lattice boltzmann methods jones and detwiler 2019 yoon et al 2017 2015 ahkami et al 2020 are particularly interesting as they permit to evaluate in relationship with spatial mineral substrate heterogeneity the effect of new precipitate localization on the flow and transport properties at the continuum scale it is also possible to account for the feedback between flow and reactions and between the volume of precipitate and permeability through implementation of porosity permeability relationship steefel et al 2005 beckingham 2017 seigneur et al 2019 while these laws have allowed continuum scale models to reproduce experimental results e g poonoosamy et al 2019 2015 their use near clogging conditions have had limited success as emphasized by relatively high discrepancies in modeling results xie et al 2015 micro continuum models provide an alternative to continuum scale models these models describing the evolving fracture aperture field allow for capturing the processes that are important to fracture geometry alteration deng et al 2016 and can lead to a better understanding of the relevant processes and parameterization of continuum models in the present study a combination of experiments micro scale characterization and micro continuum reactive transport modeling was performed to elucidate the relative contribution of precipitation reactions and transport to flow reorganization and fracture sealing the objectives are to investigate how the flow rate the kinetic law the fracture aperture distribution and mineral substrate heterogeneities at the fracture walls affect precipitation as well as reorganization of flow and reactive transport through time for this purpose we investigated experimentally precipitation in four artificial fractures of simplified geometries at two different flow rates precipitation rates were calculated from effluent concentrations and 3d image difference obtained using x ray microtomography xmt experimental results were then used to constrain reactive transport modeling in more complex fracture geometries different simulation configurations were tested to evaluate the impacts of three factors on the negative feedback between chemistry transport and permeability reduction in fractures i reactive transport conditions ii fracture geometry and anisotropy and iii mineral heterogeneity distribution at the fracture walls 2 materials and methods 2 1 flow through laboratory experiments in fractures four flow through experiments were carried in artificial fractures made in a dolomitic limestone of tithonian age upper jurassic sampled in a quarry crayssac lot france the rock composition given by x ray diffraction xrd analysis is about 50 calcite and 50 dolomite with a minor amount of quartz and k feldspar the carbonate matrix is composed of a microsparitic cement of calcite and dolomite table 1 summarizes the experimental conditions a block was sewed drilled and possibly grooved to provide four cylindrical samples of 50 1 mm in length and 25 mm in diameter with three different fracture geometries i e planar sample cra1fa planar with two channels of 2 0 0 3 mm in width and 500 or 700 µm in depth grooved in the fracture plane samples cra2fa and cra3fa or trapezoidal sample cra4fa the two fracture walls were glued together with epoxy resin after intercalating glass wedges on their edges to prevent for closure or opening of the fracture during experiment resulting in a fracture width of 15 1 mm the external surface of the samples apart from the fracture inlet was also covered with epoxy resin to avoid precipitation the surface of the fracture walls was estimated from their geometry with the addition of the inlet surface of the sample which was not covered with epoxy resin the inlet fluid used in the experiments was a 50 50 mixture of cacl2 and nahco3 solutions prepared from reagent grade salts dissolved in deionized water and equilibrated with atmospheric pco2 the composition of the mixture is 1 87 0 03 mm cacl2 and 3 95 0 07 mm nahco3 and corresponds to a calcite saturation index log ω of 1 38 and so a saturation state ω of 24 after saturation and flushing with deionized water clean the fracture walls the samples were injected at the flow rate q 0 of either 0 4 cm3 h 1 using a syringe pump samples cra1fa and cra2fa or 12 cm3 h 1 using a peristaltic pump samples cra3fa and cra4fa 2 2 quantitative determination of the extent of the reaction 2 2 1 determination of the global precipitation rate dissolution of dolomite being considered as negligible during the experiments the amount of calcite precipitated in the fractures was determined from the difference in calcium concentration δca mol m 3 between the fracture inlet ca in and outlet ca out throughout the experiments the volume of precipitated calcite at time t i is given by 1 v c a l t i q 0 υ c a l t t 0 t t i δ ca t d t with q 0 the volumetric flow rate m3 s 1 and υcal the molar volume of calcite m3 mol 1 the global rate of precipitation r c a l is given by 2 r c a l δ n δ t δ v c a l υ c a l 1 δ t with δn the total amount of calcite precipitated mol and δt the duration of the experiment δt t 1 t0 2 2 2 determination of the local precipitation rate and crystal growth rate local rates of precipitation within the fractures were evaluated from x ray micro tomography imaging xmt and secondary electron microscopy sem analysis of the crystals formed at the fracture wall surfaces fracture geometries were characterized by x ray micro tomography on phoenix nanotom systems fédération de recherche fermat fr 3089 toulouse and umr 7359 géoressources nancy with a pixel size of 12 23 µm the data sets were collected before t0 and after the experiments t 1 except for cra4fa whose geometry assumed to be a perfect trapezoid was not imaged at t0 and was deduced from measurements near the fracture wedges at t 1 as precipitation was localized near the sample inlet only the upper part close to the inlet was imaged at t 1 image processing was carried out using avizo software once the data sets were segmented an algorithm was used to extract the fracture walls and aperture see noiriel et al 2013 for the procedure of fracture wall and aperture extraction the data sets were also registered to permit localization of precipitation within the fracture from volume subtractions i e v t1 v t0 with v t0 and v t1 the 3d fracture volumes at t0 and t1 respectively image difference leads to the determination of the local rate of precipitation rcal mol s 1 assuming that the reactive surface area sr and geometric surface area spix m2 are equal 3 r c a l δ n x y δ t δ a x y δ t 1 υ c a l s p i x with δn x y the local amount of calcite precipitated mol and a x y the local fracture aperture m given the resolution of the imagery the limit for difference in aperture detection is about two pixels i e 25 µm after the flow through experiments the fractures were opened to examine the new crystal location and morphology sem stood in for xmt to characterize the geometry of the new crystals with a finer resolution average crystal size was evaluated at different locations of the fracture walls from size measurement on about 30 crystals each time 2 3 reactive transport modeling 2 3 1 description of the model the 2d multi component reactive transport model hytec van der lee et al 2003 seigneur et al 2018 was used to simulate fracture geometry evolution as a result of calcite precipitation hytec is based on the operator splitting approach solving the flow and advection dispersion reaction problems sequentially in particular the model accounts for the feedback between calcite precipitation and the resulting changes of fracture porosity permeability and flow in the model the fractures are discretized in a 2d mesh that approximates the geometry of the fracture planes in each grid cell the porosity is related to the local fracture aperture a x y by 4 ϕ x y a x y d z where dz is the thickness of the domain perpendicular to the fracture wall 10 3 m permeability is computed using the relationship derived from the hagen poiseuille solution of the navier stokes equations e g brush and thomson 2003 5 k x y a x y 2 12 the saturated flow is described by 6 s s h t k h where ss is the specific storage coefficient m 1 k is the hydraulic conductivity m s 1 and h is the hydraulic head m hydraulic conductivity and permeability are related through the following expression 7 k ρ g μ k where g ρ and μ represent the gravitational acceleration 9 81 m s 2 fluid density 1000 kg m 3 and viscosity 10 3 pa s respectively all assumed constant in these simulations the boundary conditions to the flow problem are constant injection rate along the x direction at the top inlet of the domain and constant pressure h 0 at the bottom outlet while the left and right boundaries are set impermeable the flow equation is solved to provide the hydraulic head h m in each grid cell the fluid velocity is then computed based on darcy s law darcy 1856 8 v k h the computed fluid velocity is then used to solve the reactive transport problem 9 ϕ ψ i t ϕ d ψ i v ψ i ϕ m ν i m r m where ψ i is the total concentration of component i mol l 1 d is the dispersion tensor m2 s 1 rm is the kinetically controlled mineral reaction term mol l 1 s 1 m is the number of minerals and ν i m is the stoichiometric coefficient for the reaction the reaction rate of minerals is described by lasaga 1981 and we used the kinetic rate constant kcal 1 79 10 9 mol m 2 s 1 and the exponent n 1 12 obtained from continuously stirred precipitation experiments on calcite seeds noiriel et al 2012 the overall calcite precipitation rate rcal mol l 1 s 1 is defined differently depending on whether it occurs on the calcite or dolomite substrate by introducing a critical saturation state ω c r i t d o l to initiate nucleation onto dolomite substrate 10 r c a l k c a l s c a l δ ω c a l ω c r i t d o l s d o l ω c a l 1 n with δ a 1 if a 1 0 otherwise where s cal and s dol m2 l 1 are the specific surface area of calcite and dolomite respectively a is the ratio ω cal ω crit dol and ω cal is the saturation state with respect to calcite ω cal iap ksp with ksp the solubility product and iap the ion activity product precipitation of calcite starts onto dolomite substrate when ω cal ω crit dol whereupon the critical saturation state returns to 1 as mineral growth is expected to increase the specific surface area of mineral m noiriel et al 2012 emmanuel and berkowitz 2005 we choose to express it as 11 s m s 0 s g r o w t h where s 0 is the initial specific surface area and sgrowth is dependent on the volume fraction of solid precipitated unless explicitly mentioned sgrowth was taken equal to 0 21 m2 g 1 value obtained by noiriel et al 2012 for calcite seed crystals after precipitation experiments as a result the precipitation rate will increase during precipitation thus explaining a regular decrease in ca out with time in contrast sgrowth 0 m2 g 1 would maintain a quasi steady state ca out the variation of which would only result of changes in the fluid resident time in the fracture void in relationship with modifications of the flow field during sealing the diffusion coefficient d 0 is equal to 7 9 10 10 m2 s 1 and corresponds to the diffusion coefficient of ca2 at 25 c li and gregory 1974 the dispersion tensor d is reduced to two dispersion diffusion coefficients i e d x d 0 5 δ x d 0 longitudinally and dy d d 0 transversally where d is the dispersion coefficient set arbitrarily to 0 1 mm based on the fracture dimensions and 0 5δx represents the numerical dispersion i e half of the mesh length this way the longitudinal dispersivity remains about 3 times higher than the transverse dispersivity transport eq 9 is solved using the sequential iterative approach during which the evolution of the fracture aperture or porosity is computed based on the evolution of the mineral volume fraction the feedback on flow is treated explicitly after updating the local permeability following the kozeny carman relationship carman 1937 12 k x y k 0 x y ϕ x y ϕ 0 x y 3 1 ϕ 0 x y 1 ϕ x y 2 where k 0x y and ϕ0 x y are the initial local permeability and porosity respectively the volume fractions of calcite precipitated in the pore space can be evaluated from the porosity change 13 v f c a l 1 ϕ x y ϕ 0 x y or equivalently from the amount of calcite precipitated in the solid phase m3 m 3 14 v f c a l v c a l v r o c k calcite ϕ x y v c a l where vrock is the volume of rock in the mesh and calcite is the corresponding concentration of calcite mol l 1 throughout the simulations the porosity and permeability fields are extracted to compute the effective permeability at the fracture scale in directions parallel kx and perpendicular ky to the main flow direction indeed while local permeability is isotropic and evolves following the kozeny carman relationship the effective permeability at the fracture scale can display different properties due to non uniform evolution of the local permeability field to evaluate the evolution of effective permeability of the considered media flow eq 6 is solved using a head imposed configuration between two parallel boundaries similarly to permeameter conditions renard and de marsily 1997 the homogenized values of the hydraulic conductivity in the x and y direction are thus computed based on stationary fluid flow 2 3 2 simulation setup several sets of simulations using nine different fracture geometries were set up to better understand the different processes involved during precipitation in fractures in particular we explore the influence of i reactive transport parameters i e fluid reactivity and injection rate thanks to the advective damköhler daadv seigneur et al 2019 ii fracture geometry and iii mineral heterogeneity distribution at the fracture walls on the flow path evolution and permeability reduction in fractured media testing different configurations is motivated by the experimental observations where these parameters have shown to play a role in the fracture filling and flow reorganization first reactive transport modeling of the experiments was performed to validate and calibrate the model the three first fracture geometries used in the simulations are the planar fracture the planar fracture with two grooved channels and the trapezoidal fracture whose geometry is derived from the xmt imaging the fracture void domains of 50 0 15 0 mm are meshed with a 100 30 grid size fig 1 the initial and boundary conditions for fluid chemistry and flow are similar to the experiments table 1 the injected flow rate is imposed at the sample inlet in the x direction while a constant atmospheric pressure is set at the outlet the other external boundaries are no flow boundaries calcite and dolomite substrates are set in first instance as a continuum in every mesh in a 50 50 proportion with an equal initial specific surface area s cal s dol in a first approach precipitation is assumed to occur equally on both calcite and dolomite secondly a critical saturation state ω c r i t d o l 10 for precipitation onto dolomite is set this value was selected based on the sem observations of calcite growth onto dolomite matched against the saturation state maps obtained in the first set of simulations see further in section 3 1 the specific surface area is adjusted to fit with the calcium concentration measured at the sample outlet for experiment cra3fa in addition to modeling of the experiments six model fractures fig 2 a with a geometry more representative of natural fractures whose walls would experience an increase degree of shearing were generated using the synfrac software glover et al 1998 the motivation for simulating reactive transport in synthetic fractures is threefold first the geometries used in the present experiments are simplistic and the results are not meant to be extrapolated to natural media second the fluids commonly used to run experiments in the laboratory godinho et al 2016 godinho and withers 2018 noiriel et al 2012 wu et al 2010 lee and morse 1999 or in the field cuthbert et al 2013 are far oversaturated compared to saturation state encountered in most of natural waters the log of which rarely exceeds 1 so that the reactivity relevant to natural settings should be lower the choice of a high saturation index in experiments is linked to the precipitation rate of calcite which decreases exponentially along the fracture eq 10 thus constraining the duration of the experiments the latter being shorter a few days weeks when supersaturation is exaggerated the counterpart of this is a sharp reaction front godinho and withers 2018 morse and mackenzie 1993 noiriel et al 2012 hilgers and urai 2002 lee and morse 1999 driving to a rapid sealing of the sample inlet during experiments where precipitation rate is orders of magnitude higher than a few mm cm further however calibrating the model using well constrained experiments should permit extension of its application to more natural conditions i e with lower rcal third generating fracture allows for controlling the degree of geometric anisotropy of the fracture aperture parallel or perpendicular to the flow direction and for evaluating the effects of fracture wall mismatch and of the mineral heterogeneity distribution on the capacity of fractures to self healing the six different fracture geometries are set up from three starting fracture aperture fields generated with synfrac which differ by their anisotropy factor af 1 2 and 4 the grid size is 64 64 and the geometry of the fracture walls is periodic the aperture distributions are close to gaussian distributions with a mean aperture am of 400 1 µm and a standard deviation σ a of 152 2 µm leading to a roughness factor σ a am of 0 38 these values are consistent with data measured in natural limestone fractures after dissolution process noiriel et al 2013 2007 from these aperture fields six different fracture geometries of 128 64 grid sizes 51 2 25 6 mm are derived in the first cases the initial aperture fields are duplicated in the x direction to generate fracture geometries whose direction of stretching of the aperture field is parallel to the flow direction resulting in a higher correlation length λ x in the x direction in the second cases the initial aperture fields are first rotated 90 and then duplicated in the x direction to generate fracture geometries whose aperture field direction of stretching is perpendicular to the flow direction resulting in a higher correlation length λ y in the y direction table 2 summarizes the three sets of simulations with their investigated parameters the first set of simulations focuses on the impact of reactive transport on the evolution of the precipitate distribution in the fracture void and the reorganization of flow and thus the fracture anisotropy and the mineral heterogeneity distribution are kept invariant for that we define the advective damköhler number at time t 0 which is to some extent equivalent to d a 0 p e 0 as 15 d a a d v 0 α r 0 v 0 α r 0 q 0 where r 0 and v 0 are the rate of calcite precipitation r cal 0 and the average fluid velocity at t 0 respectively and α and α are coefficients the initial geometry used in that set of simulations is af 1 calcite nucleation is first assumed to occur homogeneously and at the same rate at the fracture walls so that calcite and dolomite are set in a 50 50 proportion in every mesh with an equal specific surface area s cal s dol both the injection rate and the mineral reactivity are increased or decreased compared to the experimental conditions to investigate a range of da adv 0 spanning four orders of magnitude a reference injection rate q 0 ref 12cm3 h 1 and precipitation rate at the fracture inlet r 0 ref 1 44 10 7 mol l 1 s 1 with n 1 12 eq 10 are set from the modeling conditions in fracture cra3fa in order to define at the inlet the reference da adv 0 ref β eight values of da adv 0 ranging from 0 1 to 300 β are explored by varying the injection rate q 0 ref 300 q q 0 ref and or the precipitation rate r 0 ref 100 r cal 0 r 0 ref to mimic injection of less reactive fluids at slower velocities the quantity r cal 0 r 0 ref is defined as the reactivity factor rf in the simulations table 2 evaluation of the dependence of the precipitation rate to the order of reaction was also achieved in a simulation using a lower exponent n 0 65 in the kinetic formulation eq 10 kcal was increased about 4 times to keep the same r 0 ref and reactivity factor rf 1 than in the reference simulation simulations are stopped either when complete sealing of the fracture is achieved i e for a permeability in the flow direction kx 10 11 m2 or when porosity reduction has reached a sufficient low value 10 15 regarding the duration of the simulation the second set of simulation evaluates the impact of the fracture anisotropy in relationship to the flow direction i e parallel or perpendicular to the aperture stretching direction in these simulations the six fracture geometries af 1 2 4 are used precipitation is still assumed to occur homogeneously on both calcite and dolomite at the fracture walls the same values of da adv 0 than in the first set of simulations are explored the third set of simulations accounts for the variability in mineral distribution at the fracture walls and for the existence of a critical saturation state ω c r i t d o l to initiate precipitation onto dolomite substrate in these simulations the mineral distributions are mapped on the fracture geometry af 4 with da adv 0 β and the simulations are compared with the previous simulation assuming a 50 50 mineral proportion in every mesh continuum representation of the mineral substrate three values of ω c r i t d o l are tested i e 10 20 and 30 the first value is derived from the experimental observations see further in section 3 1 the second further restricts precipitation onto dolomite in the last case precipitation onto dolomite is impossible due to the fact that ω c r i t d o l ω c a l 0 this case mimics what could happen when the critical saturation state with respect to a mineral is never reached and how it would affect fracture sealing six types of spatial distribution of minerals including three different mask patterns are considered mineral spatial heterogeneity is considered by varying the spatial distribution of calcite and dolomite volume fraction in every mesh with 50 of the meshes considered to contain only calcite and 50 only dolomite in the four first cases classification of the meshes is based from the generation of a 128 64 random field with uniform standard distribution to create the first random distribution the 50 smallest values are set to calcite mask 1 defining small mm size clusters as isolated spots of mineral of 400 400 µm2 in this case the mineral phases i e calcite or dolomite clusters are not connected through the fracture in the second random distribution mask 2 and inv mask2 the 1 5 smallest values are picked up as small calcite or dolomite spots and clusters are grown until the mineral fraction has reached 50 of the domain for these cases isolated spots of about 3 3 mm2 and cm size clusters are defined and only one mineral phase is connected through the fracture in the last two cases calcite and dolomite are correlated to the local aperture distribution in this case both mineral phases are connected through the fracture the 50 largest local apertures are either assigned calcite mask 3 or dolomite inv mask 3 mask3 configuration aims to evaluate the influence of pre existing fracture alteration prior to precipitation in multi mineral rocks the case calcite is assigned the largest apertures mimics a small degree of alteration of the fracture prior to precipitation where the higher dissolution rate for calcite compared to dolomite morse and arvidson 2002 would increase the fracture aperture in areas calcite is present noiriel et al 2007 ellis et al 2013 the case dolomite is assigned the largest apertures is the complementary case the different masks are presented in fig 2b 3 experimental results 3 1 calcite nucleation and growth at the fracture walls the size orientation and density of the calcite crystals newly precipitated at the fracture wall surfaces is highly variable and closely related to the calcite precipitation rate which depends on the mineral substrate the local saturation state with respect to calcite ω c a l and the local flux of reactants along the flowpaths xmt image difference between t1 and t0 and sem imaging after the experiments allow for determination of the areas where precipitation occurred in all samples precipitate amount is higher near the inlet of the fractures where ω c a l is the highest and the crystal size and density are shown to decrease progressively from the inlet to the outlet fig 3 growth of calcite proceeds by growth of heteronuclei on mineral substrate polycrystal growth results in blocky microstructures with epitaxial growth on existing micro sparite seed crystals the crystals are randomly oriented due to the multitude of orientations depicted by the seed crystals in the rock it is worth noting that a few dumbbell aragonite crystals are also noticed in the fracture void at low flow rate cra1fa and cra2fa the fracture aperture reduction is scarce and cannot be caught properly with xmt however individual crystals and crystal clusters are noticed at the fracture walls fig 3a at high flow rate cra3fa and cra4fa equant crystals grew on most of the fracture wall surfaces near the inlet whereas further in the fractures crystals grew preferentially onto calcite substrate compared to dolomite substrate fig 3b this effect has an increasing impact as far as the average crystal size decreases i e toward the outlet suggesting that nucleation on dolomite substrate requires a higher energy and so a higher critical saturation index log ω c r i t d o l crossing of sem observations of precipitate onto dolomite with modeling of experiment cra3fa see section 4 1 gives an estimate of ω c r i t d o l of 10 it is worth noting that precipitation is unlikely to initiate at the surface of silicates i e quartz and k feldspar fig 3 inserts 5 and 6 which remains uncovered until crystals grown on carbonates are big enough to combine fig 3 insert 4 precipitation is also localized in the areas of preferential flow fig 3b where crystals can be a dozen times bigger than in the areas of lower aperture multiple crystal orientations involving different facet growth rates and competition between neighboring crystals nollet et al 2006 that result in enclosed crystals are also visible locally despite ω c a l is assumed to be identical and contribute to the growth rate heterogeneity fig 3 insert 4 different induction times for precipitation noiriel et al 2016 stockmann et al 2011 and ostwald ripening steefel and van cappellen 1990 kile et al 2000 are other causes that can explain the difference in crystal sizes fracture sealing was observed at the inlet of samples cra3fa and cra4fa at high flow rates after 16 7 and 24 6 days of experiment respectively sealing was indicated by an expulsion of the sample from the jacket due to an abnormal pressure increase at the inlet which indicates that permeability was reduced to a value below 10 11 m2 assuming a pressure of 0 2 mpa at the inlet thus corresponding to a hydraulic aperture of about 10 µm although it corresponds more to partial sealing rather than complete sealing for which fracture permeabilities are reported in the range 10 14 10 17 m2 griffiths et al 2016 ye et al 2020 we can infer that complete sealing is close for cra3fa sealing corresponds to the closure of both the 170 µm width planar fracture surface and the 700 µm deep main channel inlet for cra4fa sealing corresponds to the closure of the trapezoidal inlet of minimum and maximum apertures of 170 µm and 400 µm respectively however it is worth noting that the main channels close to the inlet remain micro porous despite fracture sealing 3 2 fracture sealing rate 3 2 1 quantitative determination of the extend of the reaction the volume of calcite precipitated and the fracture scale sealing rate were estimated from δca between the sample inlet and outlet table 3 the amount of precipitate is over one order of magnitude higher for samples at high flow rate compare to low flow rate however the average ca out is quite similar for all the experiments indicating that kinetics globally controls the precipitation rate over the flow rate or the fluid resident time at high flow rate however a 30 time shorter resident time in the experiments explains why the global precipitation rate is 20 to 36 times higher compared to low flow rate 3 2 2 local precipitation rate based on imagery following eq 3 the local precipitation rate can also be calculated and mapped for samples cra3fa and cra4fa as shown in fig 4 the precipitation rate is higher close to the fracture inlet where supersaturation was the highest and decreases very quickly along the samples the precipitation rate is also higher in the channels for cra3fa the fracture closure rate near the inlet is about 8 µm d 1 in the main channel up to 25 µm d 1 for some single crystals and 5 µm d 1 in the planar sides the local rates in the two diverted channels are somewhat equivalent although both xmt and sem observations show that they are higher in the deeper channel two plumes with a high precipitation rate are also observed at each inlet termination i e next to the impermeable boundaries and certainly underline the final injection paths that preceded sealing for cra4fa the fracture closure rate near the inlet and in the area of higher aperture is about 5 µm d 1 in whereas it is only 3 µm d 1 in the area of lower aperture for cra1fa and cra2fa at low flow rate x ray micro tomography was not enough resolved to quantify changes in the fracture geometry however analysis of crystals using sem show the same patterns than for cra3fa and cra4fa although the crystal size is smaller e g from 15 8 7 3 µm to 0 5 0 2 µm between the inlet and outlet for cra1fa assuming roughly that the crystal size is equivalent to the aperture reduction this results in a fracture closure rate of about 0 4 µm d 1 near the inlet which reduces to about 0 01 µm d 1 near the outlet 4 reactive transport modeling 4 1 modeling of the experiment cases fig 5 shows the calcite precipitation patterns and the associated permeability reduction obtained in the simulations with a satisfactory visual agreement compared to the experiments cra3fa and cra4fa fig 4 both regarding the amount of precipitation near the inlet and the difference in the extent of precipitation in the main flowpaths a good agreement is also obtained with the experimental calcium outlet concentration and overall volume of precipitation fig 6 using an initial specific surface area s 0 of 60 m2 l 1 and a precipitation dependent term sgrowth of 0 21 m2 g 1 for all the samples the increase in specific surface area with precipitation further enhances the precipitation rate as far as the porosity decreases thus explaining a slight decrease of ca out with time nevertheless the volume precipitated is a bit overestimated for cra1fa and underestimated for cra4fa although it is possible to obtain better fits by adjusting the specific surface area we prefer to keep the same value for sm to validate the model for the different geometries and flow conditions modeling of experiment cra1fa which is equivalent to a simple 1d model allows for examining specifically the kinetic model which depends on both the kinetic formulation eq 10 and the evolution of the specific surface eq 11 for all cases explored a good agreement is found between experiment and simulation regarding the volume fraction of calcite precipitated along the flow path except near the inlet boundary where uncertainties remain fig 7 reducing s 0 to 8 m2 l 1 with no precipitation dependent surface area i e sgrowth 0 would decrease the amount of calcite precipitated near the inlet and permit to better fit with the total amount of calcite precipitated 4 4 mm3 vs 3 1 mm3 in table 3 a lower sm would also highlight the drop in precipitation rate linked to ω c r i t d o l which occurs at x 8 mm from the inlet where the gradient of precipitation is less pronounced in addition taking a constant specific surface area through the simulation i e sm s 0 would also largely modify the amount of calcite precipitated near the inlet compared to a variable specific surface area i e sm s 0 sgrowth fig 7 for instance increasing the value of sgrowth from 0 to 0 21 m2 g 1 results in a larger increase of precipitation near the inlet promoting the reduction in permeability and sealing of the fracture however it is worth noting that the behavior near the inlet is difficult to assess as i part of the sample inlet surface is also exposed to the inlet fluid in the experiment and ii the simulation critically relies on the models for reactive surface area and permeability evolution limiting the evaluation of the kinetic model the local changes in porosity and permeability significantly affect the flowpaths through time through a negative feedback between flow and transport supplementary video s1 reactive fluid is initially focused within the areas of higher apertures i e the main flow paths where the precipitation rate is higher indeed a higher renewal rate of the inlet fluid maintains a higher saturation index along the preferential flowpaths preferential filling of these flowpaths with calcite decreases locally the permeability thus leading to a progressive reorganization of the flow in areas initially deserted by the fluid whose permeability becomes at some point higher than the permeability in the filled flowpaths experiment cra2fa at low flow rate is the most efficient from the point of view of calcium uptake from the inlet fluid in the sense that the overall calcite precipitation was reduced only by a factor 8 10 compare to high flow rate while the calcium flux at the inlet boundary fca q 0 ca in is comparatively 30 times lower this is explained by the longer resident time which favors a higher consumption of calcium along the fracture however in result precipitation is more localized near the inlet fig 5a compare to high flow rate experiment cra3fa interestingly the simulations are able to reproduce the sealing observed experimentally when porosity reaches low values below 5 prediction of sealing becomes strongly dependent on the empirical porosity permeability relationship and on the choice of a critical porosity or permeability sgrowth plays also an important role by promoting precipitation where precipitation is more important i e near the inlet in the simulations almost complete sealing is assumed when fracture aperture is reduced to about 4 µm near the inlet like in the experiments thus corresponding to permeability decreases by 5 orders of magnitude given that threshold sealing at the inlet of cra3fa and cra4fa is almost completed after 20 and 22 5 days respectively fig 5b a further decrease in permeability by 9 orders of magnitude is reached after 23 and 25 days respectively it is worth noting that the geometry of the fracture plays an import role on the time required for sealing for instance cra3fa is unexpectedly sealed earlier than cra4fa despite a larger maximum aperture 700 versus 400 µm while mean apertures were comparable 280 5 µm in other words large aperture flow channels with high reactant flux fill more rapidly simulations also permit to account for different precipitation conditions onto the two mineral substrates fig 5a initially the specific surface area is the same for calcite and dolomite s cal s dol when considering a critical saturation state ω c r i t d o l there is a point beyond which the fluid is not sufficiently oversaturated to initiate precipitation on the dolomite substrate this results in a slight discontinuity in the downstream calcite precipitation pattern compared to the case ω c r i t d o l 0 fig 5a cases cra3fa as well as a lower precipitation rate difference in the two approaches mostly affects downstream calcite precipitation patterns with no effect near the inlet boundary 4 2 modeling of the synthetic fractures the reactive transport approach is then applied to the synthetic fractures in order to generalize the experimental observations to fracture geometries more relevant of the ones encountered in natural systems 4 2 1 effect of reactive transport conditions for the range of precipitation and flow rates tested in the simulations we observe very different precipitation patterns fig 8 two different regimes similarly to those described in the literature are identified depending on the value of da adv 0 i e non uniform compact precipitation and quite uniform precipitation tartakovsky et al 2007 precipitation is predicted to be compact i e highly localized at the inlet for the highest values of da adv 0 30 300β whereas it is more uniform along the flow paths for the lower values of da adv 0 0 1 0 3β at high da adv 0 precipitation is focused near the inlet and the solution becomes rapidly depleted in reactants leading to compact precipitation the rapid precipitation has a positive feedback on reactivity by increasing the specific surface area near the inlet favoring sealing potential for da adv 0 300β log ω c a l drops from 1 38 to 0 2 in the first millimeters and equilibrium is reached within the fracture precipitation starts in the main flow paths whose rapid filling leads to a quick reorganization of the flow at the inlet as a result sealing of the fracture is quick and happens for a low amount of calcium injected 0 01 mol and an average porosity reduction of less than 5 at low da adv 0 precipitation is more uniform in the fracture void especially for reactivity factors rf 1 n 1 12 for which ω c a l decreases by less than one unit through the fracture in the case rf 1 n 0 65 the lower dependence of the precipitation rate to the saturation index allows for more uniform precipitation along the fracture void as well as a result complete sealing of the fracture is expected to be quite slow but uniform and should only happen for a large amount of calcium injected as evidenced by an effective permeability reduction in the flow direction kx of less than one order of magnitude for a 10 global porosity reduction similar values of da adv 0 but one order of magnitude difference in both da 0 and pe 0 i e for da adv 0 3 and 30β do not lead exactly to the same precipitation patterns indeed for a similar porosity decrease permeability reduction is higher for the highest values of da 0 and pe 0 while sealing of the fracture is expected at some point it is worth noting that changes of the effective permeability parallel kx or perpendicular ky to the flow direction can be very different fig 9 for the uniform precipitation regime kx and ky decrease in the same ratio in contrast for the compact precipitation regime kx can decrease 5 orders of magnitude while ky is reduced by only 10 due to localization of precipitation at the inlet boundary the high discrepancies are the expression of the non uniform precipitation at the fracture scale 4 2 2 effect of fracture and flow anisotropy fig 10 shows the effect of the geometric anisotropy factor with regards to the flow direction af 1 2 or 4 or on the precipitation patterns and permeability reduction increasing anisotropy has only slight but opposite effects depending on the stretching direction of the aperture field stretching parallel to the flow direction both decreases the tortuosity of the flow paths and increases the longitudinal dispersivity zheng et al 2009 thus spreading the high reactive fluid over longest distances as a result precipitation is a little less localized at the inlet and more uniform along the flow paths local precipitation induced aperture reduction promotes the reorganization of flow paths precipitation being localized initially in the regions of higher porosity this has a net effect in reducing the fracture anisotropy but only at the low da adv 0 fig 10 in contrast aperture field stretching perpendicular to the flow direction increases the tortuosity of the flow paths thus increasing the residence time of the reactants and favoring precipitation and sealing near the inlet boundary changes in effective permeability parallel or perpendicularly to the flow direction fig 11 suggest only a slight impact of the orientation of the fractures with regards to the flow direction for most da adv 0 with the and permeability reduction curves getting more separated with increasing anisotropy factor figs 9 and 11 no impact is noticed at high da adv 0 where the rapid sealing at the inlet occurs whatever the fracture aperture field heterogeneity for the other values of da adv 0 whereas the permeability reduction curve is barely affected in the isotropic case fig 9 increasing af enhances the impact of fracture orientation to the permeability evolution fig 11 4 2 3 effect of mineral heterogeneity at the fracture walls for the range of mineral substrate distributions at the fracture wall masks 1 to 3 and inv mask 2 and 3 and critical saturation state ω c r i t d o l 10 20 and 30 tested in the simulations we observe evolutions of fracture geometry fig 12 and permeability fig 13 very different from the case calcite and dolomite substrates are set as a continuum the geometry and permeability evolutions are highly dependent of both ω c r i t d o l and the spatial distribution of mineral substrates using the continuum description for mineralogy i e 50 50 calcite dolomite in every mesh and in the condition of simulation af 4 and da adv 0 β increasing ω c r i t d o l restricts the fraction of fracture void where precipitation will occur onto dolomite substrate there is a limit at a certain distance from the inlet from which precipitation onto dolomite stops thus decreasing the amount of precipitated calcite downstream however precipitation near the inlet remains equivalent to what happens when no restriction is set for precipitation onto dolomite substrate i e ω c r i t d o l 1 except in the case ω c r i t d o l 30 for which precipitation is reduced to about a factor two at the inlet inherent to the fact δ a returns 0 in eq 10 as precipitation is localized near the inlet kx evolution remains quite similar for the different cases and it does not either affect the sealing capacity of the fracture in the same way ky is barely affected in contrast using the heterogeneous distribution of mineralogy with the different masks prevents precipitation from happening onto dolomite through part or totality of the fracture void i e in every 100 dolomite meshes where ω c r i t d o l ω c a l in that case the precipitation patterns and permeability evolution are highly dependent on the spatial distribution of mineral heterogeneity and the spatial continuity of the non reactive substrate increasing ω c r i t d o l enhances the heterogeneity of both precipitation and flow downstream but precipitation is not affected upstream fig 12 b no precipitation onto dolomite has two consequences first the fluid keeps a higher saturation index allowing precipitation to progress further in the fracture void however the porosity reduction remains slower as between 0 and 50 of the surface area in the domain is not reactive anymore explaining a more rapid drop in permeability with porosity reduction when ω c r i t d o l increases from 10 to 20 fig 13 taking the critical case ω c r i t d o l 30 as an example i e no precipitation onto dolomite through the whole domain we clearly see the differences between the different masks of heterogeneity in term of precipitation patterns permeability evolution and reorganization of flow fig 12 c f and supplementary video s2 precipitation only happens onto calcite and starts in high aperture areas hosting this substrate filling of these areas progressively drives the flow to areas where no precipitation is possible creating new flow paths independently of the negative feedback between flow and transport observed in the case precipitation is not restricted to one mineral phase in particular if the dolomite substrate is continuous in the flow direction i e for inv mask2 sealing will be impossible and the effective permeability kx decreases only slightly to reach a limit kx lim fig 13 consequently permeability cannot decrease further and flow stabilizes to a steady state in contrast if the dolomite substrate is not continuous flow will stop once precipitation onto calcite forms a barrier to flow i e for mask 1 and inv mask 2 the aperture correlated clusters mask3 and inv mask3 are interesting in the sense that the dolomite substrate is continuous in both cases so that no sealing is possible however the evolution of permeability is different depending on whether calcite is set in the large aperture fraction mask3 or low aperture fraction inv mask3 in these cases flow is naturally driven towards the main channels of larger aperture for the case mask3 they contain a substrate of calcite as a result the channel inlets fill rapidly with calcite thus provoking a more rapid permeability decrease with porosity reduction than inv mask3 up to the point the flow is diverted to the low aperture channels with a dolomite substrate in this case precipitation results in a large reorganization of flow precipitation being impossible onto dolomite permeability stabilizes whereas precipitation continues downstream on the calcite substrate supplementary video s2 in contrast for inv mask3 there is no precipitation in the main flow channels which contains dolomite calcite precipitation is still maintained in areas adjacent to the main channels through diffusion transverse dispersion but is slower consequently high saturation are maintained over longest distances and permeability decreases more smoothly with porosity reduction fig 13a although the drop is larger as a function of time than for mask3 fig 13b 5 discussion 5 1 precipitation process and reorganization of flow the precipitation regime strongly depends on da adv 0 at a given flow rate however the compact precipitation regime is also largely dependent on the shape of the kinetic rate law noiriel et al 2012 which is itself a function of the saturation index far from equilibrium conditions log ω c a l 0 8 will promote three dimensional growth of islands or two dimensional surface nucleation at the mineral surface these growth regimes result in high values of the exponent n 2 teng et al 2000 that will accentuate the strong drop of precipitation at the inlet as far as the reactants are consumed in contrast for moderate saturation indexes log ω c a l 0 8 the spiral growth mechanism results in an exponent n 1 teng et al 2000 in this case the drop in precipitation rate with the saturation index is less sharp especially near the equilibrium i e when 1 ω 0 where the precipitation rate is almost constant this would result in relatively uniform precipitation along the flow path testing an n 0 65 i e precipitation rate poorly dependent on the saturation state although the assumption is far fetched for mineral precipitation driven by injection of oversaturated fluids confirms the importance of the fluid reactivity path in the reorganization of flow specific surface area increase with precipitation can also promote the compact precipitation regime introducing a specific surface area dependent to the amount of new precipitate eq 12 clearly shows a positive feedback loop thus contributing to a faster sealing near the inlet the value of 0 21 m2 g 1 for sgrowth used in the simulations is questionable as it was obtained during precipitation onto calcite seeds no evident decrease of ca out with time supports a large increase in specific surface area during precipitation although the sensibility in determining δca from chemical analyses is low for precipitation studies whatever the extent of sm increase it should have large consequences on the evolution of precipitation patterns and time for sealing under constant sm conditions closure of the fracture would normally drive fluid with a higher supersaturation index further in the fracture void as a result of fluid velocity increase however when sm increases and despite the fluid velocity increase precipitation remains localized near the inlet this is particularly visible when looking at the level sets of ω c a l they move upward in the fracture as the reaction rate increases near the inlet see supplementary videos s1 and s2 as a result an increase in sm promotes as well the compact precipitation regime it is clear that the lack of constrains on the kinetic formulation is the primary source of uncertainty for modeling reactive transport and predicting the time required for complete sealing nevertheless these observations confirm that da adv 0 cannot solely be an indicator for the reaction regime noiriel 2015 as evolution of the local precipitation rate through time along the flow paths and through the fracture is a time and space dependent process 5 2 the importance of mineral substrate heterogeneity both the experiments and simulations have evidenced the role of mineral substrate distribution at the fracture walls on the evolution of fracture geometry and flow reorganization the modeling results show that mineral heterogeneity can have a profound impact larger than that of da adv 0 or fracture geometry on the precipitation regime reorganization of the flow and sealing capacity it will both depend on the spatial distribution of substrate clusters and on the ability for new crystals to grow at their surface in relationship with the critical saturation index log ω c r i t modeling with mineral spatial heterogeneity has shown that dolomite substrate or more generally any mineral phase whose surface energy is different from the primary mineral can significantly alter the filling of the fracture void in case precipitation is restrained or not permitted in specific fracture regions the spatial connectivity or conversely the absence of connectivity of the non reactive substrate will underling two extreme cases of permeability evolution with either i a rapid drop in permeability and fracture sealing for small and spatially non connected mineral substrate spots fig 13 or in contrast ii only a slight decrease of permeability that stabilizes when the non reactive substrate is connected through the void space consequently the nature and spatial organization of mineral substratescan change the precipitation regime for small non connected clusters the regime can be more compact in contrast for non reactive substrate connected through the fracture sealing might never be reached indeed large scale portions of the fracture void can fill up while flow is ultimately maintained in the network of non reactive substrate in absence of precipitation onto that substrate i e when ω c r i t ω c a l 0 some flow paths will remain free of precipitation thus preventing fracture sealing although not investigated in this study the proportion of non reactive mineral substrate at the fracture wall is certainly a key parameter that will control fracture spatial connectivity the concentration field of reactants and precipitate in the reactive and non reactive paths will also be largely dependent on the mineral substrate heterogeneity this is important for environmental studies e g when a contaminant is expected to be stabilized in a mineral phase e g guren et al 2020 kumari d et al 2016 or for biogrouting not only the capacity of sealing will be affected but the propagation distance of the chemical species will highly depend on the mineral substrate heterogeneity the modeling underlines the limits of the continuum approach in this context of selective precipitation onto a specific mineral phase as it does not resolve the possible connectivity of the mineral substrates in space this also agrees with the conclusion of li et al 2007 that the continuum model by averaging properties and representing the system as if it is well mixed does not resolve the pore scale structure when high concentration gradients develop although their conclusions were reached for dissolution of minerals with a high contrast in reactivity this can be extended to precipitation involving mineral substrates with different surface energy or affinity with the new precipitate however for precipitation mineral heterogeneity might prevent from sealing only when the non reactive substrate forms a connected network maintaining flow paths open for the reactive fluid in addition it is expected that the phenomenon is transient in reality as the model does not account for possible lateral growth of crystals that could finally cover the non reactive clusters at some point like observed experimentally near the fracture inlets bridges made between newly grown crystals might compensate for heterogeneous distribution of mineral substrate heterogeneity at the fracture walls in any case mineral heterogeneity should nevertheless promote a more uniform filling of the fractures when possible although we do not know yet whether the grain boundaries between the growing crystals and the non reactive substrate mineral remain or not micro porous and possibly connected flow channelization is also highly sensitive to mineral spatial distribution in rocks the negative feedback between reaction and flow tends to minimize local perturbations whereas precipitation localized on a specific substrate tends to magnify them the flow properties which are highly dependent on the spatial reduction of fracture aperture are therefore largely modified by the presence of mineral heterogeneity in this case the continuum approach would fail at describing the reorganization of flow and the persistence of open flow paths 5 3 evolution of the effective porous medium properties and implications for fracture sealing for engineering purposes reactive transport simulations often require large spatial scale models which rely on upscaled properties of the porous fractured media when subject to mineral dissolution precipitation reactions hence pore or fracture scale micro continuum simulations can be useful to better assess the evolution of the medium properties and feed continuum models with upscaled properties when precipitation occurs with no distinction of mineral substrate the extent of the porosity and permeability alteration and the porosity permeability relationship are highly dependent on daadv although this parameter alone might not be sufficient to fully describe fracture sealing for instance ahkami et al 2020 who isolated different precipitation regimes in fractured porous media must refer to both d a 0 p e 0 and p e 0 to define these regimes in addition it is difficult to provide a numerical value for daadv when regarding heterogeneous phase reactions like mineral precipitation noiriel 2015 so that we preferred to explore the effect of da adv 0 relatively to a reference parameter i e β the way the fracture can be sealed uniformly i e associated to a permeability reduction both along and across the main flow directions will depend on two factors i the precipitation kinetics in strong relationship with the saturation index and the specific surface area model and ii the mineral substrate distribution from our results it appears that only slow i e long term precipitation in conditions close to the equilibrium can guarantee proper sealing of fractures over large scales something required to ensure reservoir tightness and improvement of the mechanical properties of fractured rocks e g recovering cohesion aben et al 2017 bons et al 2012 high fluid velocities could help to obtain a similar result as well although the strong non linear decrease in precipitation kinetics of highly saturated fluids will be an obstacle to uniform fracture sealing as well as a possible increase of specific surface of minerals through precipitation in any case the ratio of the critical porosity defined as the porosity below which the fracture is sealed i e ϕ c lim k x 0 ϕ to the initial porosity i e ϕ c ϕ 0 can be a good indicator of the fracture sealing efficiency the critical porosity increases with decreasing da adv 0 and at a given da adv 0 it increases or decrease slightly depending on the anisotropy factor and flow orientation a high ϕ c ϕ 0 will result in a small fraction of the fracture void filled with calcite i e compact precipitation whereas a low ϕ c ϕ 0 will indicate uniform sealing of the pore space fig 14 when conditions for more uniform precipitation are encountered i e for low exponent n or da adv 0 the negative feedback between flow and transport will tend to decrease the permeability anisotropy of fractures so that at a larger scale the permeability in fractures can be described by an isotropic tensor in contrast non uniform compact precipitation driven by the non linear precipitation rate and or coupling between flow and reaction will act as a barrier to flow in the vicinity of the injection point this regime has the highest impact on permeability reduction and local sealing can be achieved quickly in far from equilibrium conditions and highda adv 0 values however in that case sealing will be restricted to a narrow band near the inlet boundary e g the injection well then the negative feedback between flow and transport will tend to increase the permeability anisotropy of fractures whatever the initial anisotropy factor or flow direction by inducing a drastic reduction of permeability in the flow direction kx whereas minor changes will be recorded transverse to the flow ky it is also difficult to decipher what will happen further from the injection point as non uniform precipitation will trigger development of anisotropic effective properties at larger scales regarding for instance porosity and permeability and cause important large scale reorganization of flow it is possible the fluids are diverted in other channels in the fracture switched to adjacent partially sealed fractures or that complete sealing compartmentalizes large scale fluid flow like observed in geothermal reservoirs griffiths et al 2016 these conditions are only valid however when precipitates cover the entire surface of the fracture walls when polymineralic fracture walls are considered mineral substrate heterogeneity and energy barriers for precipitation can delay jones and detwiler 2016 or even prevent sealing by reducing the specific surface area for precipitation or locally inhibiting precipitate nucleation and or growth the persistence of a micro porous network resulting from heterogeneous precipitation distribution at the surface of the different mineral substrates is also something to take into account which could pinpoint the limits of unconstrained continuum modeling in particular if precipitation is refrained from certain flow paths fig 12 critical porosity or sealing could never be reached in the model although in natural fractures lateral crystal growth is also possible in that case permeability and porosity will reach a lower limit the choice for a porosity permeability relationship will be critical as classical relationship could be unable to represent results when the precipitation is not uniformly distributed through the porous network beckingham et al 2017 in addition the choice of a unique porosity permeability relationship at the continuum scale is debatable even for a given geometry of fracture indeed it was shown here to strongly depend on the injection conditions and on the mineral spatial distribution at the fracture walls for a given rock fracture upscaling of porosity permeability at the continuum scale will rely on the hydro chemical conditions along the streamlines i e on the localization within the fractured domain however a coupled description of the problem using a micro continuum model that fully accounts of mineral distribution fracture geometry flow description fluid reactivity and possible feedback between chemistry geometry and transport is definitely helpful to decipher the time and space dependent evolution of reactive transport in fractures as to estimate time for sealing 6 conclusion we have presented a combination of experiments and reactive transport modeling to better characterize the effect of mineral precipitation on the flow reorganization and sealing in fractures in particular the impact of reactive transport driving forces i e reaction versus flow fracture geometry and mineral heterogeneity distribution at the fracture walls was investigated simulations exploring several flow rates fracture geometries precipitation rates and distribution and reactivity of mineral substrates which require a critical saturation state to initiate heterogeneous nucleation ω c r i t have been evaluated contrary to dissolution where a positive feedback between chemistry and flow can lead to a rapid localization of flow along preferential pathways precipitation tends to oppositely reorganize flow precipitation is first promoted in the preferential flowpaths where a higher saturation index and so a higher precipitation rate are maintained further in the fracture void through a negative feedback between reactions and transport the flow is progressively diverted from the initial highly conductive channels and reorganized until the fracture is sealed precipitation has shown to be non uniformly distributed both in the direction parallel and perpendicular to the main flow direction non uniform precipitation along the flow direction is related to the existence of main flowpaths that ensue both from the aperture field heterogeneity and the fracture anisotropy factor and to the balance between mineral reactivity and flow rate that can be expressed through the initial advective damköhler number i e da adv 0 high da adv 0 favor a rapid sealing near the inlet boundary whereas low da adv 0 can lead to complete and uniform sealing of the fracture the nonlinear decrease in mineral precipitation rate for highly saturated fluids in far from equilibrium conditions is a contributing factor to a rapid precipitation rate near the injection point in addition when sealing is highly localized near the fracture inlet it contributes to anisotropic permeability increase with kx dropping quickly in the flow direction while little changes in ky transverse to the flow are observed in contrast uniform precipitation regime should contribute to decreasing the permeability anisotropy of fracture exhibiting a high anisotropic factor overall the micro continuum approach of reactive transport in fractures has shown the ability to capture the major observations of the experiments calibration for one experiment cra3fa showed the model ability to make successful predictions for the results of other experiments under different flow rates and fracture geometries although much experiment effort is still required to better assess the kinetic law in particular with regard to the evolution of the specific surface of growing crystals these simulations show that a properly parameterized reactive transport model can reproduce precipitation patterns observed in anisotropic fractures even close to complete sealing at larger scale the fracture anisotropy does not appear as an obstacle for a 1d continuum description of fractured media during precipitation process as filling of the preferential flow paths will trigger transversally a reduction in aperture distribution heterogeneity with time however the continuum description at a larger scale could fail to describe the precipitation process of minerals of various affinities to mineral substrates at least in the short term and for large scale mineral substrate heterogeneity and connectivity i e when all the fracture wall surfaces have not been yet covered by the new precipitate the mineral substrate distribution definitely appears as an important factor that will drive the reorganization of flow with precipitation in particular when both mineral clusters are big in the x and y directions regarding to the fracture aperture and connected through a network and a high critical saturation index restricts precipitation on some substrates at the fracture walls it is also probable that the role of mineral distribution i e the rock texture dominates over da adv 0 or fracture geometry anisotropy for prediction of the fate of reactive fluids in geological reservoirs or aquifers it could constitute a new assumption to explain why fractures in shallow depth environments are only partially filled with cement deposits and do not seal totally at larger scale and considering a fracture network the increase in anisotropy of permeability can also lead to more complex reorganization of flow compared to what has been observed in this study these simulations also suggest that pore scale heterogeneities and anisotropy can exert a control on the distribution of the precipitates and hence on the evolution of the fractured medium properties application to natural systems exhibiting a high degree of heterogeneity in material properties e g local porosity and permeability mineral reactivity specific surface area will make these predictions more challenging the study points at future models that could better include rock textures and mineral spatial distribution to improve their reliability nevertheless the model remains a useful and computationally efficient tool to probe the interplay between precipitation reactions flow and transport in rocks with complex mineral textures statement we do not know what kind of statement must be provide here the author guide is not clear about it declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments we would like to thank laurent auberoux cm quartz for providing access to the crayssac quarry jérôme sterpenich géoressources nancy christophe tenailleau and benjamin duployer cirimat toulouse for xmt acquisitions we are also grateful for the sem technical support provided by philippe recourt université de lille 1 and thierry aigual get c noiriel acknowledges funding from cnrs insu through the project tellus cessur georac supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2021 103916 appendix supplementary materials image application 1 image application 2 image application 3 
309,observations show that instream vegetation has a strong impact on bedload transport however there is a scarcity of sediment transport predictors that directly account for the effects of plants and existing methods based on re calculation of roughness coefficients may present some inconsistencies the approach herein proposed extends einstein s parameters to include the effects of vegetation on sediment transport for implementation in existing bedload predictors of the form φ f ψ the new formulations are applicable in presence of submerged and emergent vegetation and reduce to the original einstein s parameters if vegetation is absent calibration is based on laboratory data for this purpose an extensive experimental program was carried out on a tilting glass walled flume with medium sand bed and plants represented by aluminum cylinders validation is based on published bedload measurements from the literature the results show a much better agreement between measurements and predictions when applying the extended parameters compared to using einstein s original ones predicted bedload rates have on average the same order of magnitude of the measured ones and quantitative agreement is substantially increased clear improvements were also observed when comparing the results with the bedload predictions of baptist s 2005 method which is based on the re calculation of bed roughness in the presence of vegetation keywords bedload predictor aquatic vegetation einstein s sediment transport parameters flume experiments 1 introduction vegetation provides a wide range of ecosystem services in rivers stephan and gutknecht 2002 ishikawa et al 2003 nepf 2012 e g soil stability water quality and ecological balance in general montakhab et al 2012 pasquino and gualtieri 2017 and has therefore a relevant role in river restoration projects armanini et al 2002 wilson et al w2003 kothyari et al 2009b augustijn et al 2011 yager and schmeeckle 2013 wang et al 2015a liu and zeng 2016 armanini and cavedon 2019 however the presence of plants increases the flow resistance and thus the water levels during flood conditions e g villada arroyave and crosato 2010 river vegetation whether instream or riparian plays a major role also in the morphological evolution of rivers tsujimoto 1999 murray and paola 2003 wu and he 2009 crosato and samir saleh 2011 camporeale et al 2013 le bouteiller and venditti 2014 2015 termini 2015 vargas luna et al 2018 2019 a three way mutual relationship exists among water flow sediment and vegetation processes james et al 2002 jordanova and james 2003 kothyari et al 2009a sukhodolov and sukhodolova 2005 wu et al 2005 not only does vegetation alter flow velocity and solid transport but at the same time flow and channel morphology influence vegetation establishment and growth corenblit et al 2007 2009 2011 bertoldi et al 2014 the complexity of the relationship between vegetation and river dynamics is also defined by innumerable possibilities of plant characteristics e g type size shape and distribution usually making it a difficult task for scientists engineers to approach vargas luna et al 2016 though some of these interactions are reasonably understood they are not completely quantifiable due to the still existing unpredictability around them which may lead to undesired effects especially near populated areas augustijn et al 2011 for this reason neglecting vegetation in river studies may lead to failure in the prediction of fluvial response to natural or man made changes vargas luna et al 2015 verschoren et al 2015 although the impacts of plants on hydrodynamics have been extensively studied e g armanini et al 2002 james et al 2002 järvelä 2002 defina and bixio 2005 kothyari et al 2009a 2009b evangelos 2012 vargas luna et al 2015 bywater reyes et al 2015 verschoren et al 2015 liu and zeng 2016 rubol et al 2016 there is still lack of information regarding the impact of plants on sediment transport current methods for the estimation of solid transport in vegetated streams are mostly based on the correction of the flow resistance coefficient reviews by augustijn et al 2008 2011 and vargas luna et al 2015 however while this approach is good for one and two dimensional hydrodynamic computations introducing the corrected coefficient in a sediment transport formula results in over prediction of the sediment transport rate baptist 2005 baptist et al 2007 for this reason the bed resistance coefficient is corrected again and then introduced in existing sediment transport formulas derived for unvegetated beds e g barfield et al 1979 raupach 1992 stone and shen 2002 baptist 2005 baptist et al 2007 as an alternative to bed roughness correction armanini and cavedon 2019 suggest another approach for the estimation of bedload in vegetated water courses rather than deriving a new formula from scratch for roughness correction their method consists of adjusting the definition of einstein s 1950 parameters i e the dimensionless transport rate φ and the flow intensity parameter ψ to take into account the presence of plants and their properties the adjusted parameters can be then introduced in the existing bedload transport formulas that can be expressed as φ f ψ such as meyer peter and müller s 1948 parker s 1979 ashmore s 1988 and armanini et al s 2015 among others in the absence of vegetation both parameters reduce to the original ones derived by einstein 1950 for unvegetated conditions the main limitation of the method is its exclusive applicability to channel beds with emergent vegetation this is a strong limitation for applicability on real rivers considering that the degree of plant submersion in river channels and floodplains changes with time due to variable discharge and with space depending on soil elevation and plant dimensions vargas luna et al 2015 this study extends the method of armanini and cavedon 2019 to derive a general expression of the two einstein s parameters applicable to channels with unvegetated and vegetated beds regardless of whether plants are submerged or emergent the new expressions derived in the framework of this study contain three parameters and one function to be calibrated on measured data most data on vegetated flow that can be found in the literature regard hydrodynamic variables e g armanini et al 2002 järvelä 2002 stephan and gutknecht 2002 stone and shen 2002 velasco et al 2003 evangelos 2012 termini 2015 whereas only few works deal with sediment transport e g james et al 2002 sharpe and james 2006 yager and schmeeckle 2013 armanini et al 2015 and only a small part of the latter deals with submerged vegetation vargas luna et al 2015 for this reason this work includes an extensive set of laboratory experiments meant to calibrate the new expressions in the experiments plants represented by rigid cylinders are set with different degrees of submersion and density sediment transport rates are measured at morphodynamic equilibrium when sediment output equals sediment input coinciding with stationary conditions at the scale of the entire flume reach scale in the flume morphodynamic equilibrium appears when the longitudinal bed slope has adapted to the boundary conditions after a long transition phase characterized by temporal slope changes as a part of the calibration procedure the proposed extended einstein parameters are introduced in the sediment transport formulas of meyer peter and müller 1948 parker 1979 ashmore 1988 and armanini et al 2015 and then bedload predictions are compared to the measured sediment transport rates the performance of the proposed method is tested in the validation phase which is based on independent datasets this time derived from published laboratory experiments baptist s 2003 jordanova and james 2003 kothyari et al s 2009a le bouteiller and venditti s 2015 recchia and mariotto s 2017 as well as on measurements performed on the capibaribe river in pernambuco brazil silva et al 2016 finally predictions by the new approach are also compared to the predictions of the widely adopted baptist s 2005 method e g villada arroyave and crosato 2010 2 derivation of extended einstein s parameters for the case of emergent vegetation armanini and cavedon 2019 found that it is not necessary to modify existing transport formulas but rather extend the dimensionless sediment transport rate φ and the flow intensity parameter ψ proposed by einstein 1950 1 φ q s d p g δ d p 2 ψ g δ d p u 2 where qs is the bedload rate per unit width dp is the median grain size g is the gravity acceleration δ is the submerged relative density of sediment and u is the shear velocity u τ 0 ρ with τ0 being the reach averaged bed shear stress and ρ the water density although einstein 1950 proposes his own bedload transport formula also other existing transport formulas can be written as a function of φ and ψ in the form 3 φ f ψ as for instance meyer peter and müller s 1948 parker s 1979 ashmore s 1988 and armanini et al s 2015 starting from a momentum balance of a generic control volume as a part of a channel with emergent vegetation armanini and cavedon 2019 adjusted einstein s parameters eqs 1 and 2 here renamed as φ e and ψ e where subscript e indicates a bed with emergent vegetation in 4 φ e q s d p g δ d p 1 α ω ω v 5 ψ e ψ t o t 1 β v ω v h d v h d p b v where ψ tot is the original einstein s flow intensity parameter related to the total flow resistance of the channel of the stream bed including the effects of vegetation if present h is the water depth dv is the characteristic diameter of the stems αω β v and bv are calibration parameters and ω v is the spatial density of the stems defined by eq 6 6 ω v n p π 4 d v 2 l b where np is the number of stems in the control volume l is the length of the reach and b is the channel width calibration of eqs 4 and 5 was carried out by armanini and cavedon 2019 on the basis of experimental data as a result the parameters αω β v and bv were finally given the values 5 40 and 0 respectively if vegetation is submerged the flow is substantially different from the one with emergent plants baptist 2005 vargas luna et al 2016 maji et al 2020 see fig 1 if plants are submerged it is possible to identify two flow layers the flow within the plants and the flow above the canopy the dominance of either of them depends on the submergence ratio of the plants additionally the turbulence generated by plant tops and by the stems if spatial density of vegetation is relatively low is strongly linked to sediment entrainment deposition and resuspension processes nepf 2012 see fig 1b for applications in 1d and 2d models sediment transport formulas are based on depth averaged flow velocity while relating average velocity to emergent vegetation scenarios might be less problematic fig 1a submerged cases require a closer analysis since depth averaged flow velocity may not be representative of either of the flow layers fig 1b also in this case the derivation of the new expressions for dimensionless transport rate and flow intensity parameter starts with a momentum balance for the control volume of a generic channel petryk and bosmajian 1975 armanini and cavedon 2019 this time with cylindrical submerged vegetation having length l and width b at morphodynamic equilibrium which is coincident with stationary conditions the gravity force is balanced by the friction force and the stem drag 7 ρ g a l i e τ 0 b l j 1 n p f d j where ρ is the fluid density a is the wet cross sectional area a bh ie is the slope of the energy line coincident with water level and bed slope under uniform flow conditions τ0 is the bed shear stress and fdj is the drag offered by a single stem often estimated as 8 f d j c d ρ h v d v u 2 2 with cd being the stem drag coefficient hv the height of the submerged part of the plant and u the depth averaged flow velocity note that in the case of submerged vegetation depth averaged flow velocity might not be representative of the flow rate in the vegetated layer additionally submerged vegetation induces turbulence at the top of the canopy and within plants if the stem density is low for this a correction factor should be included in eq 8 9 f d j f v c d ρ h v d v u 2 2 where fv is a function of water flow and depends on plant submergence and stem induced turbulence in this case by representing plants as rigid cylinders the coefficient cd is here set equal to 1 as recommended by fischer antze et al 2001 helmiö 2002 stoesser et al 2003 and vargas luna et al 2016 eq 7 then can be reworked to obtain the following relation for ie 10 i e τ 0 ρ g h 1 ρ g b h l j 1 n p f d j eq 10 can be reworked and simplified if the bed shear τ0 and the energy slope ie are expressed as follows if flow is assumed to be uniform 11 τ 0 ρ u 0 2 12 i e u t 2 g h where u 0 is the shear velocity related to the bed shear stress and u t is the shear velocity related to total channel resistance by introducing eqs 11 and 12 into eq 10 we obtain 13 u t 2 u 0 2 1 u u 0 2 n p 2 f v c d h v d v b l in which cd 1 rigid cylinder approximation in order to highlight the influence of the submergence ratio hv h in eq 13 it is possible to multiply the last term inside parentheses by h h then 14 u t 2 u 0 2 1 u u 0 2 n p 2 f v c d h d v b l h v h in a channel with a rough bed the ratio u u 0 can be expressed through the simple monomial formula armanini 2005 15 u u 0 a h d p b where a and b are calibration coefficients then eq 15 along with eq 6 describing vegetation spatial density can be substituted into eq 14 in such a way that 16 u t 2 u 0 2 1 β t o t ω v h d v h d p 2 b h v h with 17 β t o t a 2 f v c d 2 π using the original definition of the flow intensity parameter eq 2 it is possible to express eq 16 as 18 ψ t o t ψ 0 1 β t o t ω v h d v h d p 2 b h v h 1 where ψ0 is the original einstein s flow intensity parameter related to grain roughness only if the flow intensity parameter for a bed with submerged vegetation is assumed to be equal to ψ tot the bedload transport rate is overestimated whereas if it is assumed to be equal to ψ0 bedload transport is underestimated e g le bouteiller and venditti 2015 armanini and cavedon 2019 this implies that the actual flow intensity parameter here referred to as ψ v lies somewhere in between it is convenient then to express it as a function of ψ0 19 ψ v ε v ψ 0 with ε v 1 if eq 18 is expressed as 20 ψ 0 ψ t o t 1 β t o t ω v h d v h d p 2 b h v h then eq 19 becomes 21 ψ v ε v ψ t o t 1 β t o t ω v h d v h d p 2 b h v h in order to simplify eq 21 the influence of β tot and hv h is accounted for by introducing the calibration function kv instead being kv dependent on plant submergence ratio density and spatial distribution then we obtain 22 ψ v ψ t o t ε v k v ω v h d v h d p 2 b where coefficient ε v and exponent b are both calibration parameters the dimensionless sediment transport rate derived by armanini and cavedon 2019 for beds with emergent vegetation eq 4 appears to be also valid in the submerged case its derivation was based on the assumption of a reduction of the net exchange surface between bed and flow due to the presence of the stems regardless of the submergence ratio for this φ eq 1 is multiplied by the fraction of the active net exchange surface thus excluding the area occupied by the stems coefficient a ω is included in eq 4 to account for the actual effect of plants which is expected to be greater than the one that can be accounted for by only considering the stem cross sections calibration of eqs 4 and 22 is based on the results of an extensive experimental program furtherly discussed in the following sections 3 materials and methods 3 1 experiments a series of 16 experimental tests was carried out in the hydraulics laboratory of the department of civil environmental and mechanical engineering at the university of trento italy specifically to calibrate kv ε v and b in eq 22 and to check whether the expression of the dimensionless sediment transport rate derived for emergent plants by armanini and cavedon 2019 eq 4 can also be applied in the submerged cases 3 1 1 experimental setup the experimental facility consists of a glass walled tilting flume of dimensions 15 m 0 50 m fig 2 equipped with two pumps one allowing for water recirculation only and the other one for both water and sediment recirculation including an electromagnetic gauge for the measurement and control of the discharge this two pump system has the advantage of allowing for a wide variety of liquid discharge conditions as well as for experimental tests of long duration armanini and cavedon 2019 the latter is particularly important given the generally long time that it is necessary to reach the condition of morphodynamic equilibrium the flume is also equipped with a laser sensor for the measurement of the bed topography an ultrasonic limnimeter for the measurement of the water free surface and an acoustic doppler velocimeter adv for flow velocity measurements the mobile bed consists of a sand layer of thickness ranging from 0 09 m to 0 16 m depending on each test with d10 d50 and d90 being 0 3 0 41 and 0 48 mm respectively and specific weight of 2 518 kg m3 the uniformity coefficient of the sediment mixture is 1 43 so it is possible to consider this material as uniform or poorly graded the slope of the flume is adjustable and was fixed differently depending on the test ranging between 0 flat and 6 due to morphodynamic adaptation the imposed flume slope i b0 does not usually coincide with the final longitudinal bed slope measured at equilibrium conditions the downstream end of the flume is equipped with a tailgate that allowed for the regulation of water level vegetation is represented by rigid aluminum cylinders with diameter of 1 cm and height of 18 cm three spatial stem densities with staggered arrays were tested 200 stems m2 150 stems m2 as well as unvegetated bed fig 3 this type of configurations can be found qualitatively in sparse grass and young reed 3 1 2 experimental procedure and test duration water discharge stem spatial distribution initial bed slope thickness of the sand layer and height of the tailgate at the downstream end of the flume are set before the start of each test once the pumps are started the system becomes practically autonomous and only occasional control is required bedload transport rate water free surface elevation bed elevation and vertical velocity profiles are measured at regular intervals for bedload transport a metallic net of dimensions 1 38 m 0 95 m is placed at the downstream end of the flume for a short period of 1 to 3 minutes depending on how much sediment exited the flume each sample is weighted and then put to dry for 24 hours in an oven at a temperature of 105 c the weight of dry samples is divided by their corresponding sampling times in order to obtain the bedload rate this procedure is carried out three times a day during the whole extent of each test as the system approaches conditions of morphodynamic equilibrium consecutive sample weights tend to be more alike the measurement of the water free surface and bed elevations require a longer time reason for which based on the results of some preliminary tests it was decided to carry them out on a weekly basis considering that each single test had a duration of 2 4 weeks the results of preliminary tests allowed identifying this as the time necessary to reach morphodynamic equilibrium it is so long because the sediment transport rates are rather small in most cases the water surface elevation is measured with an ultrasonic limnimeter requiring an approximate time of three hours immediately after measuring water levels and for accuracy improving purposes of the laser recorder the facility is turned off and the sand bed is set to dry for several hours then 2d bed level measurements are carried out by recording point elevations every 0 5 cm in the transverse direction and every 3 cm in the longitudinal direction these measurements require approximately 10 hours equilibrium conditions are assessed on the observed weekly changes of bed level profiles and on the measured bedload rates finally the vertical velocity profile is measured with an acoustic doppler velocimeter adv also on a weekly basis seven cross sections along the flume were previously chosen and in each of them 5 to 8 points on a same vertical are selected to measure flow velocity depending on water depth 3 1 3 experimental tests a summary of the experimental conditions of each test i e water discharge stem spatial density initial flume slope sand layer thickness and tailgate height is presented in table 1 3 2 calibration of extended einstein parameters calibration of the extended einstein parameters defined by eqs 4 and 22 is carried out by implementing them in the formula of armanini et al 2015 namely 23 φ v 70 1 0 45 ψ v ψ v 1 ψ v e 0 45 ψ v the predictions given by substituting φ v and ψ v in the formula are compared to the bedload rates measured in the laboratory the values of the three parameters αω eq 4 ε v eq 22 and b eq 22 as well as the function kv eq 22 are optimized to best match laboratory data considering that the first step of calibration is based on one specific sediment transport formula armanini et al 2015 the calibrated formulations of φ v and ψ v are then implemented in other bedload formulas namely meyer peter and müller s 1948 parker s 1979 and ashmore s 1988 the estimations provided by these formulas are compared with the experimental measurements 3 3 performance assessment 3 3 1 validation validation of the extended einstein s parameters is carried out on independent datasets derived from the literature reporting measured sediment transport rates in flumes with either submerged or emergent vegetation including unvegetated conditions the experimental datasets used for this purpose are summarized in table 2 note that there are only a few published bedload experimental measurements for settings with submerged vegetation this does not mean that submerged plants have not been thoroughly studied but most work focuses on water flow two out of the three datasets available correspond to flexible plants though baptist 2003 used flexible cylindrical elements experiments with emergent vegetation are less scarce since for instance kothyari et al 2009a present over 50 settings in addition validation is also carried out on field data namely on the measurements performed on a vegetated reach of the capibaribe river in pernambuco brazil silva et al 2016 four monthly surveys january to april 2011 were carried out on a cross section free of flow perturbations local vegetation consists of e macrophyllus which is native to brazil and is characterized by having cylindrical rigid stems measurements were carried out under emergent vegetation conditions the validation procedure is the following either experimental or field conditions are introduced in the newly calibrated equations for the estimation of φ v and ψ v these are then introduced in the sediment transport equations of armanini et al 2015 meyer peter and müller 1948 as revised by wong and parker 2006 parker 1979 and ashmore 1988 so that the resulting predictions can be compared to the measured bedload rates in order to quantify the performance of implementing the extended einstein parameters four statistical measures are used the mean absolute error mae the mean relative error re the root mean square error rmse and the coefficient of determination r2 as defined according to eqs 24 to 27 respectively 24 m a e 1 n j 1 n x o j x p j 25 r e 1 n x o j x p j x o j 26 r m s e 1 n j 1 n x o j x p j 2 27 r 2 j 1 n x o j x o x p j x p 2 j 1 n x o j x o 2 j 1 n x p j x p 2 where n is the size of the sample i e the number of experiments in each dataset xoj and xpj correspond to observed and predicted values respectively and x o and x p are the mean values of both observed and predicted values 3 3 2 comparison with baptist s 2005 method the method developed by baptist 2005 is highly regarded as being one of the best ones for the estimation of bedload rates in channels with vegetated beds vargas luna et al 2015 it is based on the rigid cylinder approach for plant representation and considers uniform geometric properties the method consists of roughness coefficient re calculation taking into account plant characteristics assuming high vegetation density the total resistance coefficient cr expressed as a chézy coefficient is given by 28 c r 1 1 c b 2 c d a h v 2 g g κ ln h h v where cb is the roughness of the bare bed a is the projected area of the cylinders per unit volume and κ is the von karman s constant assumed to be 0 41 the roughness coefficient related to the grain friction only but in the presence of plants c b is defined as 29 c b c b g κ 1 c d a h v c b 2 2 g ln h h v estimations provided by the model of baptist 2005 are tested against the experimental datasets summarized in table 2 but without baptist s data 2003 and the field data provided by silva et al 2016 the results are then compared with the estimations provided by the present approach using the same statistical measures eqs 24 27 the use of this method requires cr to be derived from the available data via chézy s equation u c r h i i e assuming uniform flow this value is introduced in eq 28 for the iterative derivation of the bare soil roughness cb which is then introduced in eq 29 for the computation of c b this last value is the one used for shields parameter estimation and subsequent bedload rate prediction 3 4 flexible and non cylindrical vegetation the herein proposed extended einstein parameters eqs 4 and 22 are based on the assumption of rigid cylindrical vegetation but are intended for application on rivers with real vegetation the dataset of le bouteiller and venditti 2015 corresponds to measurements of bedload through flexible non cylindrical vegetation while the capibaribe river silva et al 2016 provides another case with real vegetation in order to apply the approach on flexible plants hv should coincide with the height of the deflected plant whereas dv in the case of non cylindrical geometries is estimated as the surface of the plant hit by the flow divided by hv 4 results 4 1 experimental results table 3 summarizes the experimental conditions at equilibrium the longitudinal bed slope i differs from the initial one in table 1 i b0 due to morphodynamic adaptation of the system cr corresponds to the channel resistance expressed as a chézy coefficient derived from the other variables results show that vegetation has a significant impact on bedload transport rates and bed morphology for instance tests 3 and 14 started with the same conditions of water discharge qw 0 018 m 3 s and in both cases the tailgate elevation was adjusted so that the water depth would be of about 8 cm however test 3 has a vegetated bed ω v 0 0157 and test 14 a bare one measurements show that without vegetation the bedload rate is more than 50 larger with a final bed slope that is slightly lower a similar increase in bedload rate was observed between tests 6 densely vegetated and 16 unvegetated carried out under the same water discharge qw 0 022 m 3 s and similar water depth at equilibrium tests 5 13 and 15 have the same water discharge qw 0 020 m 3 s and similar water depths by the time they all reached equilibrium i e close to 7 cm the first two have a vegetated bed ω v 0 0157 and ω v 0 0118 respectively and similar submergence ratios while the latter corresponded to an unvegetated scenario this time however the largest bedload rate was observed for the case with the sparse stem density test 13 and not for the unvegetated case test 15 the experimental results thus indicate that starting from a bare bed the bedload rate first increases and then decreases if vegetation density increases this is attributed to stem induced turbulence related to sparse vegetation with eddies reaching the bed between the stems which has been observed to increase bedload transport even with respect to unvegetated conditions nepf 2012 tang et al 2013 yager and schmeeckle 2013 wang et al 2015a 4 2 results of calibration 4 2 1 extended flow intensity parameter coefficient ε v and exponent b eq 22 were calibrated on the basis of the experimental results summarized in table 3 several values of ε v and b were tested in order to find the optimal combination a close analysis showed that for values of b above 0 1 ψ v can fall under the threshold of initiation of motion the performance of different combinations of these two parameters was assessed statistically according to eqs 24 to 27 the assessment showed that ε v 1 and b 0 are adequate for all experimental results on the other hand kv is mainly a function of submergence ratio and stem reynolds number red given by 30 r e d u v d v ν where ν is the kinematic viscosity of water and uv is the apparent flow velocity in the vegetation layer as defined by stone and shen 2002 31 u v u h v h after testing several fittings for the function kv it was found that the best one is given by the following expression 32 k v 57 25 r e d 0 041 h v h 0 91 note that for the case of emergent vegetation i e hv h 1 kv takes values between 34 and 42 5 for a wide range of values of red fig 4 for the most realistic values of red kv is close to 40 this corresponds to the calibrated value of β v in eq 4 for beds with emergent vegetation derived by armanini and cavedon 2019 4 2 2 extended dimensionless sediment transport although values between 3 and 7 were tested αω equal to 5 in eq 4 as proposed by armanini and cavedon 2019 for emergent vegetation proved to be valid in the case of beds with submerged vegetation this means that the calibrated expressions reduce to armanini and cavedon s eqs 4 and 5 if vegetation is emergent and to the original einstein s definitions for unvegetated beds this implies that the extension to einstein s parameters proposed here is not only applicable to the case in which vegetation is submerged but for the entire range of conditions from bare to vegetated beds from submerged to emergent plants 4 2 3 other bedload transport formulas the final part of the calibration procedure consisted of testing the newly derived φ v and ψ v on different transport formulas which can be written in the form φ f ψ namely the relations proposed by meyer peter and müller 1948 as revised by wong and parker 2006 parker 1979 and ashmore 1988 for each formula two estimations were carried out the first using the original einstein s parameters φ and ψ eqs 1 and 2 and the second one using the extended formulations with the calibrated values of αω eq 4 ε v and b eq 22 as well as the calibrated function kv eq 22 both sets of estimations were then compared to experimental measurements fig 5 shows the comparison between measured and estimated values by each of the different formulas fig 5 shows that the extended definitions of einstein s 1950 parameters significantly improve bedload predictions when compared to the results provided by the use of the original ones 4 3 results of performance assessment 4 3 1 validation the approach proposed here was tested separately on independent data including submerged and emergent vegetation in order to assess its performance under different independent conditions in general for the case of emergent vegetation the extended parameters substantially improve estimations by decreasing errors significantly in average mae is 27 times smaller re is 114 times smaller and rmse is 29 times smaller with respect to the ones estimated for predictions using the original parameters in addition r2 increases to values above 0 9 however regarding the experimental dataset of kothyari et al 2009a the proposed approach does not improve the estimations of a particular setting tree model type iii and for three of the bedload formulas even increases the rmse and decreases r2 mae and re displayed improved values this nonetheless might be related to what appears to be a few outliers in the reported data see appendix 1 in kothyari et al 2009a finally for the submerged case accuracy of predictions also appears to be significantly improved on average mae decreased 102 times re decreased 117 times and rmse decreased 92 times with respect to the ones estimated for predictions using the original parameters correlation r2 is also improved to values above 0 6 when originally they would not reach 0 4 there is a scarcity of experimental measurements available in the literature and in fact two of the three datasets used for this validation were derived for settings with submerged flexible vegetation as in the dataset of le bouteiller and venditti 2015 with non cylindrical plants with hv assumed to be the deflected height of plant and d v the average flow affected width predictions improve substantially though they still largely overestimate the bedload rate although the error is still significant using the original einstein s definition instead would result in overestimations that are even two orders of magnitude higher the performance of the proposed approach on each independent experimental dataset can be assessed through the statistical measures summarized in table 4 in all cases it was observed that the formulas by meyer peter and müller 1948 and ashmore 1988 provide the most accurate estimations though the use of armanini et al 2015 and parker 1979 is encouraged as well especially in settings with emergent vegetation as for the field dataset provided by silva et al 2016 the present approach yielded results in the same order of magnitude of the measurements when using the armanini et al s 2015 formula except for the value of the third survey march 2011 which was an order of magnitude lower than the measurement still there is a reasonably good agreement between measurements and estimation thus indicating the suitability of the new approach in real vegetated scenarios results are summarized in table 5 estimations obtained using the original einstein s parameters yielded results of several orders of magnitude up to five higher to the measurements for all the sediment transport formulas proposed table 5 4 3 2 comparison with baptist s 2005 method baptist s 2005 method provides better results compared to einstein s 1950 original parameters only in the case of submerged flexible plants with a non cylindrical geometry einstein 1950 is found to perform slightly better than baptist 2005 however the new approach herein presented still provided better results for most of the independent datasets and in the few cases in which baptist 2005 provides slightly better results e g type i and ii from kothyari et al 2009a both models actually perform similarly table 6 summarizes the comparison baptist s 2005 method was also used to compute the sediment transport rate for the field case silva et al 2016 the results show that even if the estimations might seem to improve with respect the ones provided by einstein s original definitions the present approach still outperforms baptist 2005 which still largely overestimates the bedload transport rates regardless of the sediment transport formula used a summary of its performance is included in table 7 fig 6 shows the comparison among the three approaches einstein s 1950 fig 6a baptist s 2005 fig 6b and the proposed method fig 6c all applied to the formula of armanini et al 2015 the discontinuous line indicates the dimensionless transport rate as a function of the flow intensity parameter the points are the experimental results of each external dataset baptist 2003 jordanova and james 2003 kothyari et al 2009a le bouteiller and venditti 2015 recchia and mariotto 2017 and the field survey silva et al 2016 note that the extended definitions of einstein s parameters proposed method provide a much better match between estimations and independent experimental and field data moreover fig 7 shows the same comparison but using the formula of meyer peter and muller 1948 5 discussion there is still an ongoing discussion on whether rigid cylinders are an accurate representation of instream vegetation at an experimental scale or if it is an oversimplification of plant geometry that does not reflect the actual effects of plants on flow and resistance in the literature it is possible to find major studies that approach the problem of instream or riparian vegetation through the use of cylindrical representations e g jordanova and james 2003 kothyari et al 2009a 2009b stone and shen 2002 yet some authors argue that plant flexibility plays a major role on flow velocity resistance and turbulence e g stephan and gutknecht 2002 reason for which it should not be neglected some authors include the process and effects of reconfiguration of a flexible plant due to the action of the flow e g velasco et al 2003 verschoren et al 2015 however none of these approaches have substituted the rigid cylinder approach that is still adopted in many studies both experimental and numerical and provides useful results an experimental study by armanini et al 2002 in which real sized trees were used concludes that drag coefficients of instream plants resemble those expected for isolated cylinders of similar diameters wunder et al 2011 found out that also deflected leafy willows have drag coefficients similar to the ones of cylindrical rods however the experimental study by vargas luna et al 2016 addresses the issue on whether or not cylindrical representations of smaller plants provide realistic results by comparing the effects of plastic real and cylindrical vegetation on water flow three useful conclusions emerge 1 the flow resistance of plastic real and cylindrical plants has the same order of magnitude 2 rigid cylinders are an adequate representation of grass type plants with high spatial density 3 rigid cylinders realistically represent pioneer vegetation on emerging bars and floodplains in particular if plants are sparse in conclusion there is experimental evidence proving that in a large number of cases representing instream vegetation by series of rigid cylinders is suitable to describe its effects on flow velocity resistance and sediment transport rates at least under conditions of high spatial density experimental observations indicate the strong influence of vegetation on bedload transport in general it was observed that instream vegetation contributes to a decrease of bedload transport and as a consequence bed slopes tend to be higher under vegetated conditions however an interesting observation was drawn for a particular set of three experiments 5 13 and 15 where water discharge and level were kept approximately constant but different vegetation densities were tested including the case of bare soil while the setting with the high stem density test 3 displayed the lowest bedload transport rate of the three the case with the low density test 13 presented a higher bedload transport rate than the unvegetated case test 15 this indicates the influence of stem induced turbulence as a driver for increasing sediment entrainment and transport in cases of low stem density this situation has been observed previously by other authors e g nepf 2012 tang et al 2013 yager and schmeeckle 2013 and wang et al 2015a but still need to be investigated 6 conclusions the ability to predict bedload transport rates for a variety of streams under different vegetation settings might be extremely useful when sediment management is crucial e g prediction of morphodynamic changes related to dam construction removal control of channel bed erosion through the use of plants e g kothyari et al 2009b wang et al 2015b devi and kumar 2016 restoration of river habitats e g armanini et al 2002 wilson et al 2003 or rehabilitation of urban rivers e g gonzález et al 2010 for this reason we present an approach for bedload estimation that rather than proposing a new transport equation from scratch extends fundamental definitions namely einstein s parameters to include the effects of vegetation by modifying these definitions existing transport equations which can be written in the form form φ f ψ remain unaffected and only the parameters φ and ψ eqs 1 and 2 are replaced with the new ones φ v and ψ v eqs 4 and 22 that already account for the presence of instream plants regardless of whether they are emergent or submerged the experiments on which the extended parameters were calibrated displayed froude numbers ranging from 0 23 to 0 85 subcritical flow with the exception of experiment 9 that displayed a value of froude number of 1 24 and shields parameters ranging from 0 44 to 0 74 bedload predictions by the present approach were validated on independent data found in the literature including some field surveys performed on the capibaribe river brazil silva et al 2016 where the local instream vegetation e macrophyllus is characterized by a cylindrical geometry the results show that the new approach is more suitable for channels with vegetated beds when compared to those yielded by employing the original einstein s parameters the approach proposed here performs better than the widely adopted baptist et al s 2007 method in most cases the statistical measures used i e mean absolute error mae mean relative error re root mean square error rmse and coefficient of determination r2 are substantially improved though the method was derived under the assumption of cylindrical rigid vegetation the accuracy of bedload estimations in the presence of flexible vegetation as in the cases of the datasets provided by baptist 2003 and le bouteiller and venditti 2015 also increased as for the sediment transport formulas selected for validation meyer peter and müller 1948 as revised by wong and parker 2006 appeared to provide the best bedload rates for the experimental settings however for the field surveys in the capibaribe river the armanini et al s 2015 formula eq 23 showed the best performance validation conditions presented froude numbers ranging from 0 08 to 1 77 while shields parameters ranged from 0 21 to 6 23 indicating a larger applicability range compared to calibration based on the experiments as a final remark even when the external datasets both from laboratory experiments and the field support the reliability of the present approach it has to be acknowledged that calibration was carried out on the basis of experimental tests that used a single grain size then more experiments are still required in order to identify whether different sediment sizes would results in differences in the values of the calibrated coefficients credit authorship contribution statement josé a bonilla porras conceptualization methodology validation formal analysis investigation writing original draft visualization aronne armanini conceptualization resources supervision funding acquisition alessandra crosato conceptualization writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was supported by the university of trento italy fund number 40201562 
309,observations show that instream vegetation has a strong impact on bedload transport however there is a scarcity of sediment transport predictors that directly account for the effects of plants and existing methods based on re calculation of roughness coefficients may present some inconsistencies the approach herein proposed extends einstein s parameters to include the effects of vegetation on sediment transport for implementation in existing bedload predictors of the form φ f ψ the new formulations are applicable in presence of submerged and emergent vegetation and reduce to the original einstein s parameters if vegetation is absent calibration is based on laboratory data for this purpose an extensive experimental program was carried out on a tilting glass walled flume with medium sand bed and plants represented by aluminum cylinders validation is based on published bedload measurements from the literature the results show a much better agreement between measurements and predictions when applying the extended parameters compared to using einstein s original ones predicted bedload rates have on average the same order of magnitude of the measured ones and quantitative agreement is substantially increased clear improvements were also observed when comparing the results with the bedload predictions of baptist s 2005 method which is based on the re calculation of bed roughness in the presence of vegetation keywords bedload predictor aquatic vegetation einstein s sediment transport parameters flume experiments 1 introduction vegetation provides a wide range of ecosystem services in rivers stephan and gutknecht 2002 ishikawa et al 2003 nepf 2012 e g soil stability water quality and ecological balance in general montakhab et al 2012 pasquino and gualtieri 2017 and has therefore a relevant role in river restoration projects armanini et al 2002 wilson et al w2003 kothyari et al 2009b augustijn et al 2011 yager and schmeeckle 2013 wang et al 2015a liu and zeng 2016 armanini and cavedon 2019 however the presence of plants increases the flow resistance and thus the water levels during flood conditions e g villada arroyave and crosato 2010 river vegetation whether instream or riparian plays a major role also in the morphological evolution of rivers tsujimoto 1999 murray and paola 2003 wu and he 2009 crosato and samir saleh 2011 camporeale et al 2013 le bouteiller and venditti 2014 2015 termini 2015 vargas luna et al 2018 2019 a three way mutual relationship exists among water flow sediment and vegetation processes james et al 2002 jordanova and james 2003 kothyari et al 2009a sukhodolov and sukhodolova 2005 wu et al 2005 not only does vegetation alter flow velocity and solid transport but at the same time flow and channel morphology influence vegetation establishment and growth corenblit et al 2007 2009 2011 bertoldi et al 2014 the complexity of the relationship between vegetation and river dynamics is also defined by innumerable possibilities of plant characteristics e g type size shape and distribution usually making it a difficult task for scientists engineers to approach vargas luna et al 2016 though some of these interactions are reasonably understood they are not completely quantifiable due to the still existing unpredictability around them which may lead to undesired effects especially near populated areas augustijn et al 2011 for this reason neglecting vegetation in river studies may lead to failure in the prediction of fluvial response to natural or man made changes vargas luna et al 2015 verschoren et al 2015 although the impacts of plants on hydrodynamics have been extensively studied e g armanini et al 2002 james et al 2002 järvelä 2002 defina and bixio 2005 kothyari et al 2009a 2009b evangelos 2012 vargas luna et al 2015 bywater reyes et al 2015 verschoren et al 2015 liu and zeng 2016 rubol et al 2016 there is still lack of information regarding the impact of plants on sediment transport current methods for the estimation of solid transport in vegetated streams are mostly based on the correction of the flow resistance coefficient reviews by augustijn et al 2008 2011 and vargas luna et al 2015 however while this approach is good for one and two dimensional hydrodynamic computations introducing the corrected coefficient in a sediment transport formula results in over prediction of the sediment transport rate baptist 2005 baptist et al 2007 for this reason the bed resistance coefficient is corrected again and then introduced in existing sediment transport formulas derived for unvegetated beds e g barfield et al 1979 raupach 1992 stone and shen 2002 baptist 2005 baptist et al 2007 as an alternative to bed roughness correction armanini and cavedon 2019 suggest another approach for the estimation of bedload in vegetated water courses rather than deriving a new formula from scratch for roughness correction their method consists of adjusting the definition of einstein s 1950 parameters i e the dimensionless transport rate φ and the flow intensity parameter ψ to take into account the presence of plants and their properties the adjusted parameters can be then introduced in the existing bedload transport formulas that can be expressed as φ f ψ such as meyer peter and müller s 1948 parker s 1979 ashmore s 1988 and armanini et al s 2015 among others in the absence of vegetation both parameters reduce to the original ones derived by einstein 1950 for unvegetated conditions the main limitation of the method is its exclusive applicability to channel beds with emergent vegetation this is a strong limitation for applicability on real rivers considering that the degree of plant submersion in river channels and floodplains changes with time due to variable discharge and with space depending on soil elevation and plant dimensions vargas luna et al 2015 this study extends the method of armanini and cavedon 2019 to derive a general expression of the two einstein s parameters applicable to channels with unvegetated and vegetated beds regardless of whether plants are submerged or emergent the new expressions derived in the framework of this study contain three parameters and one function to be calibrated on measured data most data on vegetated flow that can be found in the literature regard hydrodynamic variables e g armanini et al 2002 järvelä 2002 stephan and gutknecht 2002 stone and shen 2002 velasco et al 2003 evangelos 2012 termini 2015 whereas only few works deal with sediment transport e g james et al 2002 sharpe and james 2006 yager and schmeeckle 2013 armanini et al 2015 and only a small part of the latter deals with submerged vegetation vargas luna et al 2015 for this reason this work includes an extensive set of laboratory experiments meant to calibrate the new expressions in the experiments plants represented by rigid cylinders are set with different degrees of submersion and density sediment transport rates are measured at morphodynamic equilibrium when sediment output equals sediment input coinciding with stationary conditions at the scale of the entire flume reach scale in the flume morphodynamic equilibrium appears when the longitudinal bed slope has adapted to the boundary conditions after a long transition phase characterized by temporal slope changes as a part of the calibration procedure the proposed extended einstein parameters are introduced in the sediment transport formulas of meyer peter and müller 1948 parker 1979 ashmore 1988 and armanini et al 2015 and then bedload predictions are compared to the measured sediment transport rates the performance of the proposed method is tested in the validation phase which is based on independent datasets this time derived from published laboratory experiments baptist s 2003 jordanova and james 2003 kothyari et al s 2009a le bouteiller and venditti s 2015 recchia and mariotto s 2017 as well as on measurements performed on the capibaribe river in pernambuco brazil silva et al 2016 finally predictions by the new approach are also compared to the predictions of the widely adopted baptist s 2005 method e g villada arroyave and crosato 2010 2 derivation of extended einstein s parameters for the case of emergent vegetation armanini and cavedon 2019 found that it is not necessary to modify existing transport formulas but rather extend the dimensionless sediment transport rate φ and the flow intensity parameter ψ proposed by einstein 1950 1 φ q s d p g δ d p 2 ψ g δ d p u 2 where qs is the bedload rate per unit width dp is the median grain size g is the gravity acceleration δ is the submerged relative density of sediment and u is the shear velocity u τ 0 ρ with τ0 being the reach averaged bed shear stress and ρ the water density although einstein 1950 proposes his own bedload transport formula also other existing transport formulas can be written as a function of φ and ψ in the form 3 φ f ψ as for instance meyer peter and müller s 1948 parker s 1979 ashmore s 1988 and armanini et al s 2015 starting from a momentum balance of a generic control volume as a part of a channel with emergent vegetation armanini and cavedon 2019 adjusted einstein s parameters eqs 1 and 2 here renamed as φ e and ψ e where subscript e indicates a bed with emergent vegetation in 4 φ e q s d p g δ d p 1 α ω ω v 5 ψ e ψ t o t 1 β v ω v h d v h d p b v where ψ tot is the original einstein s flow intensity parameter related to the total flow resistance of the channel of the stream bed including the effects of vegetation if present h is the water depth dv is the characteristic diameter of the stems αω β v and bv are calibration parameters and ω v is the spatial density of the stems defined by eq 6 6 ω v n p π 4 d v 2 l b where np is the number of stems in the control volume l is the length of the reach and b is the channel width calibration of eqs 4 and 5 was carried out by armanini and cavedon 2019 on the basis of experimental data as a result the parameters αω β v and bv were finally given the values 5 40 and 0 respectively if vegetation is submerged the flow is substantially different from the one with emergent plants baptist 2005 vargas luna et al 2016 maji et al 2020 see fig 1 if plants are submerged it is possible to identify two flow layers the flow within the plants and the flow above the canopy the dominance of either of them depends on the submergence ratio of the plants additionally the turbulence generated by plant tops and by the stems if spatial density of vegetation is relatively low is strongly linked to sediment entrainment deposition and resuspension processes nepf 2012 see fig 1b for applications in 1d and 2d models sediment transport formulas are based on depth averaged flow velocity while relating average velocity to emergent vegetation scenarios might be less problematic fig 1a submerged cases require a closer analysis since depth averaged flow velocity may not be representative of either of the flow layers fig 1b also in this case the derivation of the new expressions for dimensionless transport rate and flow intensity parameter starts with a momentum balance for the control volume of a generic channel petryk and bosmajian 1975 armanini and cavedon 2019 this time with cylindrical submerged vegetation having length l and width b at morphodynamic equilibrium which is coincident with stationary conditions the gravity force is balanced by the friction force and the stem drag 7 ρ g a l i e τ 0 b l j 1 n p f d j where ρ is the fluid density a is the wet cross sectional area a bh ie is the slope of the energy line coincident with water level and bed slope under uniform flow conditions τ0 is the bed shear stress and fdj is the drag offered by a single stem often estimated as 8 f d j c d ρ h v d v u 2 2 with cd being the stem drag coefficient hv the height of the submerged part of the plant and u the depth averaged flow velocity note that in the case of submerged vegetation depth averaged flow velocity might not be representative of the flow rate in the vegetated layer additionally submerged vegetation induces turbulence at the top of the canopy and within plants if the stem density is low for this a correction factor should be included in eq 8 9 f d j f v c d ρ h v d v u 2 2 where fv is a function of water flow and depends on plant submergence and stem induced turbulence in this case by representing plants as rigid cylinders the coefficient cd is here set equal to 1 as recommended by fischer antze et al 2001 helmiö 2002 stoesser et al 2003 and vargas luna et al 2016 eq 7 then can be reworked to obtain the following relation for ie 10 i e τ 0 ρ g h 1 ρ g b h l j 1 n p f d j eq 10 can be reworked and simplified if the bed shear τ0 and the energy slope ie are expressed as follows if flow is assumed to be uniform 11 τ 0 ρ u 0 2 12 i e u t 2 g h where u 0 is the shear velocity related to the bed shear stress and u t is the shear velocity related to total channel resistance by introducing eqs 11 and 12 into eq 10 we obtain 13 u t 2 u 0 2 1 u u 0 2 n p 2 f v c d h v d v b l in which cd 1 rigid cylinder approximation in order to highlight the influence of the submergence ratio hv h in eq 13 it is possible to multiply the last term inside parentheses by h h then 14 u t 2 u 0 2 1 u u 0 2 n p 2 f v c d h d v b l h v h in a channel with a rough bed the ratio u u 0 can be expressed through the simple monomial formula armanini 2005 15 u u 0 a h d p b where a and b are calibration coefficients then eq 15 along with eq 6 describing vegetation spatial density can be substituted into eq 14 in such a way that 16 u t 2 u 0 2 1 β t o t ω v h d v h d p 2 b h v h with 17 β t o t a 2 f v c d 2 π using the original definition of the flow intensity parameter eq 2 it is possible to express eq 16 as 18 ψ t o t ψ 0 1 β t o t ω v h d v h d p 2 b h v h 1 where ψ0 is the original einstein s flow intensity parameter related to grain roughness only if the flow intensity parameter for a bed with submerged vegetation is assumed to be equal to ψ tot the bedload transport rate is overestimated whereas if it is assumed to be equal to ψ0 bedload transport is underestimated e g le bouteiller and venditti 2015 armanini and cavedon 2019 this implies that the actual flow intensity parameter here referred to as ψ v lies somewhere in between it is convenient then to express it as a function of ψ0 19 ψ v ε v ψ 0 with ε v 1 if eq 18 is expressed as 20 ψ 0 ψ t o t 1 β t o t ω v h d v h d p 2 b h v h then eq 19 becomes 21 ψ v ε v ψ t o t 1 β t o t ω v h d v h d p 2 b h v h in order to simplify eq 21 the influence of β tot and hv h is accounted for by introducing the calibration function kv instead being kv dependent on plant submergence ratio density and spatial distribution then we obtain 22 ψ v ψ t o t ε v k v ω v h d v h d p 2 b where coefficient ε v and exponent b are both calibration parameters the dimensionless sediment transport rate derived by armanini and cavedon 2019 for beds with emergent vegetation eq 4 appears to be also valid in the submerged case its derivation was based on the assumption of a reduction of the net exchange surface between bed and flow due to the presence of the stems regardless of the submergence ratio for this φ eq 1 is multiplied by the fraction of the active net exchange surface thus excluding the area occupied by the stems coefficient a ω is included in eq 4 to account for the actual effect of plants which is expected to be greater than the one that can be accounted for by only considering the stem cross sections calibration of eqs 4 and 22 is based on the results of an extensive experimental program furtherly discussed in the following sections 3 materials and methods 3 1 experiments a series of 16 experimental tests was carried out in the hydraulics laboratory of the department of civil environmental and mechanical engineering at the university of trento italy specifically to calibrate kv ε v and b in eq 22 and to check whether the expression of the dimensionless sediment transport rate derived for emergent plants by armanini and cavedon 2019 eq 4 can also be applied in the submerged cases 3 1 1 experimental setup the experimental facility consists of a glass walled tilting flume of dimensions 15 m 0 50 m fig 2 equipped with two pumps one allowing for water recirculation only and the other one for both water and sediment recirculation including an electromagnetic gauge for the measurement and control of the discharge this two pump system has the advantage of allowing for a wide variety of liquid discharge conditions as well as for experimental tests of long duration armanini and cavedon 2019 the latter is particularly important given the generally long time that it is necessary to reach the condition of morphodynamic equilibrium the flume is also equipped with a laser sensor for the measurement of the bed topography an ultrasonic limnimeter for the measurement of the water free surface and an acoustic doppler velocimeter adv for flow velocity measurements the mobile bed consists of a sand layer of thickness ranging from 0 09 m to 0 16 m depending on each test with d10 d50 and d90 being 0 3 0 41 and 0 48 mm respectively and specific weight of 2 518 kg m3 the uniformity coefficient of the sediment mixture is 1 43 so it is possible to consider this material as uniform or poorly graded the slope of the flume is adjustable and was fixed differently depending on the test ranging between 0 flat and 6 due to morphodynamic adaptation the imposed flume slope i b0 does not usually coincide with the final longitudinal bed slope measured at equilibrium conditions the downstream end of the flume is equipped with a tailgate that allowed for the regulation of water level vegetation is represented by rigid aluminum cylinders with diameter of 1 cm and height of 18 cm three spatial stem densities with staggered arrays were tested 200 stems m2 150 stems m2 as well as unvegetated bed fig 3 this type of configurations can be found qualitatively in sparse grass and young reed 3 1 2 experimental procedure and test duration water discharge stem spatial distribution initial bed slope thickness of the sand layer and height of the tailgate at the downstream end of the flume are set before the start of each test once the pumps are started the system becomes practically autonomous and only occasional control is required bedload transport rate water free surface elevation bed elevation and vertical velocity profiles are measured at regular intervals for bedload transport a metallic net of dimensions 1 38 m 0 95 m is placed at the downstream end of the flume for a short period of 1 to 3 minutes depending on how much sediment exited the flume each sample is weighted and then put to dry for 24 hours in an oven at a temperature of 105 c the weight of dry samples is divided by their corresponding sampling times in order to obtain the bedload rate this procedure is carried out three times a day during the whole extent of each test as the system approaches conditions of morphodynamic equilibrium consecutive sample weights tend to be more alike the measurement of the water free surface and bed elevations require a longer time reason for which based on the results of some preliminary tests it was decided to carry them out on a weekly basis considering that each single test had a duration of 2 4 weeks the results of preliminary tests allowed identifying this as the time necessary to reach morphodynamic equilibrium it is so long because the sediment transport rates are rather small in most cases the water surface elevation is measured with an ultrasonic limnimeter requiring an approximate time of three hours immediately after measuring water levels and for accuracy improving purposes of the laser recorder the facility is turned off and the sand bed is set to dry for several hours then 2d bed level measurements are carried out by recording point elevations every 0 5 cm in the transverse direction and every 3 cm in the longitudinal direction these measurements require approximately 10 hours equilibrium conditions are assessed on the observed weekly changes of bed level profiles and on the measured bedload rates finally the vertical velocity profile is measured with an acoustic doppler velocimeter adv also on a weekly basis seven cross sections along the flume were previously chosen and in each of them 5 to 8 points on a same vertical are selected to measure flow velocity depending on water depth 3 1 3 experimental tests a summary of the experimental conditions of each test i e water discharge stem spatial density initial flume slope sand layer thickness and tailgate height is presented in table 1 3 2 calibration of extended einstein parameters calibration of the extended einstein parameters defined by eqs 4 and 22 is carried out by implementing them in the formula of armanini et al 2015 namely 23 φ v 70 1 0 45 ψ v ψ v 1 ψ v e 0 45 ψ v the predictions given by substituting φ v and ψ v in the formula are compared to the bedload rates measured in the laboratory the values of the three parameters αω eq 4 ε v eq 22 and b eq 22 as well as the function kv eq 22 are optimized to best match laboratory data considering that the first step of calibration is based on one specific sediment transport formula armanini et al 2015 the calibrated formulations of φ v and ψ v are then implemented in other bedload formulas namely meyer peter and müller s 1948 parker s 1979 and ashmore s 1988 the estimations provided by these formulas are compared with the experimental measurements 3 3 performance assessment 3 3 1 validation validation of the extended einstein s parameters is carried out on independent datasets derived from the literature reporting measured sediment transport rates in flumes with either submerged or emergent vegetation including unvegetated conditions the experimental datasets used for this purpose are summarized in table 2 note that there are only a few published bedload experimental measurements for settings with submerged vegetation this does not mean that submerged plants have not been thoroughly studied but most work focuses on water flow two out of the three datasets available correspond to flexible plants though baptist 2003 used flexible cylindrical elements experiments with emergent vegetation are less scarce since for instance kothyari et al 2009a present over 50 settings in addition validation is also carried out on field data namely on the measurements performed on a vegetated reach of the capibaribe river in pernambuco brazil silva et al 2016 four monthly surveys january to april 2011 were carried out on a cross section free of flow perturbations local vegetation consists of e macrophyllus which is native to brazil and is characterized by having cylindrical rigid stems measurements were carried out under emergent vegetation conditions the validation procedure is the following either experimental or field conditions are introduced in the newly calibrated equations for the estimation of φ v and ψ v these are then introduced in the sediment transport equations of armanini et al 2015 meyer peter and müller 1948 as revised by wong and parker 2006 parker 1979 and ashmore 1988 so that the resulting predictions can be compared to the measured bedload rates in order to quantify the performance of implementing the extended einstein parameters four statistical measures are used the mean absolute error mae the mean relative error re the root mean square error rmse and the coefficient of determination r2 as defined according to eqs 24 to 27 respectively 24 m a e 1 n j 1 n x o j x p j 25 r e 1 n x o j x p j x o j 26 r m s e 1 n j 1 n x o j x p j 2 27 r 2 j 1 n x o j x o x p j x p 2 j 1 n x o j x o 2 j 1 n x p j x p 2 where n is the size of the sample i e the number of experiments in each dataset xoj and xpj correspond to observed and predicted values respectively and x o and x p are the mean values of both observed and predicted values 3 3 2 comparison with baptist s 2005 method the method developed by baptist 2005 is highly regarded as being one of the best ones for the estimation of bedload rates in channels with vegetated beds vargas luna et al 2015 it is based on the rigid cylinder approach for plant representation and considers uniform geometric properties the method consists of roughness coefficient re calculation taking into account plant characteristics assuming high vegetation density the total resistance coefficient cr expressed as a chézy coefficient is given by 28 c r 1 1 c b 2 c d a h v 2 g g κ ln h h v where cb is the roughness of the bare bed a is the projected area of the cylinders per unit volume and κ is the von karman s constant assumed to be 0 41 the roughness coefficient related to the grain friction only but in the presence of plants c b is defined as 29 c b c b g κ 1 c d a h v c b 2 2 g ln h h v estimations provided by the model of baptist 2005 are tested against the experimental datasets summarized in table 2 but without baptist s data 2003 and the field data provided by silva et al 2016 the results are then compared with the estimations provided by the present approach using the same statistical measures eqs 24 27 the use of this method requires cr to be derived from the available data via chézy s equation u c r h i i e assuming uniform flow this value is introduced in eq 28 for the iterative derivation of the bare soil roughness cb which is then introduced in eq 29 for the computation of c b this last value is the one used for shields parameter estimation and subsequent bedload rate prediction 3 4 flexible and non cylindrical vegetation the herein proposed extended einstein parameters eqs 4 and 22 are based on the assumption of rigid cylindrical vegetation but are intended for application on rivers with real vegetation the dataset of le bouteiller and venditti 2015 corresponds to measurements of bedload through flexible non cylindrical vegetation while the capibaribe river silva et al 2016 provides another case with real vegetation in order to apply the approach on flexible plants hv should coincide with the height of the deflected plant whereas dv in the case of non cylindrical geometries is estimated as the surface of the plant hit by the flow divided by hv 4 results 4 1 experimental results table 3 summarizes the experimental conditions at equilibrium the longitudinal bed slope i differs from the initial one in table 1 i b0 due to morphodynamic adaptation of the system cr corresponds to the channel resistance expressed as a chézy coefficient derived from the other variables results show that vegetation has a significant impact on bedload transport rates and bed morphology for instance tests 3 and 14 started with the same conditions of water discharge qw 0 018 m 3 s and in both cases the tailgate elevation was adjusted so that the water depth would be of about 8 cm however test 3 has a vegetated bed ω v 0 0157 and test 14 a bare one measurements show that without vegetation the bedload rate is more than 50 larger with a final bed slope that is slightly lower a similar increase in bedload rate was observed between tests 6 densely vegetated and 16 unvegetated carried out under the same water discharge qw 0 022 m 3 s and similar water depth at equilibrium tests 5 13 and 15 have the same water discharge qw 0 020 m 3 s and similar water depths by the time they all reached equilibrium i e close to 7 cm the first two have a vegetated bed ω v 0 0157 and ω v 0 0118 respectively and similar submergence ratios while the latter corresponded to an unvegetated scenario this time however the largest bedload rate was observed for the case with the sparse stem density test 13 and not for the unvegetated case test 15 the experimental results thus indicate that starting from a bare bed the bedload rate first increases and then decreases if vegetation density increases this is attributed to stem induced turbulence related to sparse vegetation with eddies reaching the bed between the stems which has been observed to increase bedload transport even with respect to unvegetated conditions nepf 2012 tang et al 2013 yager and schmeeckle 2013 wang et al 2015a 4 2 results of calibration 4 2 1 extended flow intensity parameter coefficient ε v and exponent b eq 22 were calibrated on the basis of the experimental results summarized in table 3 several values of ε v and b were tested in order to find the optimal combination a close analysis showed that for values of b above 0 1 ψ v can fall under the threshold of initiation of motion the performance of different combinations of these two parameters was assessed statistically according to eqs 24 to 27 the assessment showed that ε v 1 and b 0 are adequate for all experimental results on the other hand kv is mainly a function of submergence ratio and stem reynolds number red given by 30 r e d u v d v ν where ν is the kinematic viscosity of water and uv is the apparent flow velocity in the vegetation layer as defined by stone and shen 2002 31 u v u h v h after testing several fittings for the function kv it was found that the best one is given by the following expression 32 k v 57 25 r e d 0 041 h v h 0 91 note that for the case of emergent vegetation i e hv h 1 kv takes values between 34 and 42 5 for a wide range of values of red fig 4 for the most realistic values of red kv is close to 40 this corresponds to the calibrated value of β v in eq 4 for beds with emergent vegetation derived by armanini and cavedon 2019 4 2 2 extended dimensionless sediment transport although values between 3 and 7 were tested αω equal to 5 in eq 4 as proposed by armanini and cavedon 2019 for emergent vegetation proved to be valid in the case of beds with submerged vegetation this means that the calibrated expressions reduce to armanini and cavedon s eqs 4 and 5 if vegetation is emergent and to the original einstein s definitions for unvegetated beds this implies that the extension to einstein s parameters proposed here is not only applicable to the case in which vegetation is submerged but for the entire range of conditions from bare to vegetated beds from submerged to emergent plants 4 2 3 other bedload transport formulas the final part of the calibration procedure consisted of testing the newly derived φ v and ψ v on different transport formulas which can be written in the form φ f ψ namely the relations proposed by meyer peter and müller 1948 as revised by wong and parker 2006 parker 1979 and ashmore 1988 for each formula two estimations were carried out the first using the original einstein s parameters φ and ψ eqs 1 and 2 and the second one using the extended formulations with the calibrated values of αω eq 4 ε v and b eq 22 as well as the calibrated function kv eq 22 both sets of estimations were then compared to experimental measurements fig 5 shows the comparison between measured and estimated values by each of the different formulas fig 5 shows that the extended definitions of einstein s 1950 parameters significantly improve bedload predictions when compared to the results provided by the use of the original ones 4 3 results of performance assessment 4 3 1 validation the approach proposed here was tested separately on independent data including submerged and emergent vegetation in order to assess its performance under different independent conditions in general for the case of emergent vegetation the extended parameters substantially improve estimations by decreasing errors significantly in average mae is 27 times smaller re is 114 times smaller and rmse is 29 times smaller with respect to the ones estimated for predictions using the original parameters in addition r2 increases to values above 0 9 however regarding the experimental dataset of kothyari et al 2009a the proposed approach does not improve the estimations of a particular setting tree model type iii and for three of the bedload formulas even increases the rmse and decreases r2 mae and re displayed improved values this nonetheless might be related to what appears to be a few outliers in the reported data see appendix 1 in kothyari et al 2009a finally for the submerged case accuracy of predictions also appears to be significantly improved on average mae decreased 102 times re decreased 117 times and rmse decreased 92 times with respect to the ones estimated for predictions using the original parameters correlation r2 is also improved to values above 0 6 when originally they would not reach 0 4 there is a scarcity of experimental measurements available in the literature and in fact two of the three datasets used for this validation were derived for settings with submerged flexible vegetation as in the dataset of le bouteiller and venditti 2015 with non cylindrical plants with hv assumed to be the deflected height of plant and d v the average flow affected width predictions improve substantially though they still largely overestimate the bedload rate although the error is still significant using the original einstein s definition instead would result in overestimations that are even two orders of magnitude higher the performance of the proposed approach on each independent experimental dataset can be assessed through the statistical measures summarized in table 4 in all cases it was observed that the formulas by meyer peter and müller 1948 and ashmore 1988 provide the most accurate estimations though the use of armanini et al 2015 and parker 1979 is encouraged as well especially in settings with emergent vegetation as for the field dataset provided by silva et al 2016 the present approach yielded results in the same order of magnitude of the measurements when using the armanini et al s 2015 formula except for the value of the third survey march 2011 which was an order of magnitude lower than the measurement still there is a reasonably good agreement between measurements and estimation thus indicating the suitability of the new approach in real vegetated scenarios results are summarized in table 5 estimations obtained using the original einstein s parameters yielded results of several orders of magnitude up to five higher to the measurements for all the sediment transport formulas proposed table 5 4 3 2 comparison with baptist s 2005 method baptist s 2005 method provides better results compared to einstein s 1950 original parameters only in the case of submerged flexible plants with a non cylindrical geometry einstein 1950 is found to perform slightly better than baptist 2005 however the new approach herein presented still provided better results for most of the independent datasets and in the few cases in which baptist 2005 provides slightly better results e g type i and ii from kothyari et al 2009a both models actually perform similarly table 6 summarizes the comparison baptist s 2005 method was also used to compute the sediment transport rate for the field case silva et al 2016 the results show that even if the estimations might seem to improve with respect the ones provided by einstein s original definitions the present approach still outperforms baptist 2005 which still largely overestimates the bedload transport rates regardless of the sediment transport formula used a summary of its performance is included in table 7 fig 6 shows the comparison among the three approaches einstein s 1950 fig 6a baptist s 2005 fig 6b and the proposed method fig 6c all applied to the formula of armanini et al 2015 the discontinuous line indicates the dimensionless transport rate as a function of the flow intensity parameter the points are the experimental results of each external dataset baptist 2003 jordanova and james 2003 kothyari et al 2009a le bouteiller and venditti 2015 recchia and mariotto 2017 and the field survey silva et al 2016 note that the extended definitions of einstein s parameters proposed method provide a much better match between estimations and independent experimental and field data moreover fig 7 shows the same comparison but using the formula of meyer peter and muller 1948 5 discussion there is still an ongoing discussion on whether rigid cylinders are an accurate representation of instream vegetation at an experimental scale or if it is an oversimplification of plant geometry that does not reflect the actual effects of plants on flow and resistance in the literature it is possible to find major studies that approach the problem of instream or riparian vegetation through the use of cylindrical representations e g jordanova and james 2003 kothyari et al 2009a 2009b stone and shen 2002 yet some authors argue that plant flexibility plays a major role on flow velocity resistance and turbulence e g stephan and gutknecht 2002 reason for which it should not be neglected some authors include the process and effects of reconfiguration of a flexible plant due to the action of the flow e g velasco et al 2003 verschoren et al 2015 however none of these approaches have substituted the rigid cylinder approach that is still adopted in many studies both experimental and numerical and provides useful results an experimental study by armanini et al 2002 in which real sized trees were used concludes that drag coefficients of instream plants resemble those expected for isolated cylinders of similar diameters wunder et al 2011 found out that also deflected leafy willows have drag coefficients similar to the ones of cylindrical rods however the experimental study by vargas luna et al 2016 addresses the issue on whether or not cylindrical representations of smaller plants provide realistic results by comparing the effects of plastic real and cylindrical vegetation on water flow three useful conclusions emerge 1 the flow resistance of plastic real and cylindrical plants has the same order of magnitude 2 rigid cylinders are an adequate representation of grass type plants with high spatial density 3 rigid cylinders realistically represent pioneer vegetation on emerging bars and floodplains in particular if plants are sparse in conclusion there is experimental evidence proving that in a large number of cases representing instream vegetation by series of rigid cylinders is suitable to describe its effects on flow velocity resistance and sediment transport rates at least under conditions of high spatial density experimental observations indicate the strong influence of vegetation on bedload transport in general it was observed that instream vegetation contributes to a decrease of bedload transport and as a consequence bed slopes tend to be higher under vegetated conditions however an interesting observation was drawn for a particular set of three experiments 5 13 and 15 where water discharge and level were kept approximately constant but different vegetation densities were tested including the case of bare soil while the setting with the high stem density test 3 displayed the lowest bedload transport rate of the three the case with the low density test 13 presented a higher bedload transport rate than the unvegetated case test 15 this indicates the influence of stem induced turbulence as a driver for increasing sediment entrainment and transport in cases of low stem density this situation has been observed previously by other authors e g nepf 2012 tang et al 2013 yager and schmeeckle 2013 and wang et al 2015a but still need to be investigated 6 conclusions the ability to predict bedload transport rates for a variety of streams under different vegetation settings might be extremely useful when sediment management is crucial e g prediction of morphodynamic changes related to dam construction removal control of channel bed erosion through the use of plants e g kothyari et al 2009b wang et al 2015b devi and kumar 2016 restoration of river habitats e g armanini et al 2002 wilson et al 2003 or rehabilitation of urban rivers e g gonzález et al 2010 for this reason we present an approach for bedload estimation that rather than proposing a new transport equation from scratch extends fundamental definitions namely einstein s parameters to include the effects of vegetation by modifying these definitions existing transport equations which can be written in the form form φ f ψ remain unaffected and only the parameters φ and ψ eqs 1 and 2 are replaced with the new ones φ v and ψ v eqs 4 and 22 that already account for the presence of instream plants regardless of whether they are emergent or submerged the experiments on which the extended parameters were calibrated displayed froude numbers ranging from 0 23 to 0 85 subcritical flow with the exception of experiment 9 that displayed a value of froude number of 1 24 and shields parameters ranging from 0 44 to 0 74 bedload predictions by the present approach were validated on independent data found in the literature including some field surveys performed on the capibaribe river brazil silva et al 2016 where the local instream vegetation e macrophyllus is characterized by a cylindrical geometry the results show that the new approach is more suitable for channels with vegetated beds when compared to those yielded by employing the original einstein s parameters the approach proposed here performs better than the widely adopted baptist et al s 2007 method in most cases the statistical measures used i e mean absolute error mae mean relative error re root mean square error rmse and coefficient of determination r2 are substantially improved though the method was derived under the assumption of cylindrical rigid vegetation the accuracy of bedload estimations in the presence of flexible vegetation as in the cases of the datasets provided by baptist 2003 and le bouteiller and venditti 2015 also increased as for the sediment transport formulas selected for validation meyer peter and müller 1948 as revised by wong and parker 2006 appeared to provide the best bedload rates for the experimental settings however for the field surveys in the capibaribe river the armanini et al s 2015 formula eq 23 showed the best performance validation conditions presented froude numbers ranging from 0 08 to 1 77 while shields parameters ranged from 0 21 to 6 23 indicating a larger applicability range compared to calibration based on the experiments as a final remark even when the external datasets both from laboratory experiments and the field support the reliability of the present approach it has to be acknowledged that calibration was carried out on the basis of experimental tests that used a single grain size then more experiments are still required in order to identify whether different sediment sizes would results in differences in the values of the calibrated coefficients credit authorship contribution statement josé a bonilla porras conceptualization methodology validation formal analysis investigation writing original draft visualization aronne armanini conceptualization resources supervision funding acquisition alessandra crosato conceptualization writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was supported by the university of trento italy fund number 40201562 
