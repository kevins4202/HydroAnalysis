index,text
625,this paper presents a scaled reformulation of a robust second order discontinuous galerkin dg2 solver for the shallow water equations swe with guiding principles on how it can be naturally extended to fit into the multiresolution analysis of multiwavelets mw multiresolution analysis applied to the flow and topography data enables the creation of an adaptive mwdg2 solution on a non uniform grid the multiresolution analysis also permits control of the adaptive model error by a single user prescribed parameter this results in an adaptive mwdg2 solver that can fully exploit the local de compression of piecewise linear modelled data and from which a first order finite volume version fv1 is directly obtainable based on the haar wavelet hfv1 for local de compression of piecewise constant modelled data the behaviour of the adaptive hfv1 and mwdg2 solvers is systematically studied on a number of well known hydraulic tests that cover all elementary aspects relevant to accurate efficient and robust modelling the adaptive solvers are run starting from a baseline mesh with a single element and their accuracy and efficiency are measured referring to standard fv1 and dg2 simulations on the uniform grid involving the finest resolution accessible by the adaptive solvers our findings reveal that the mwdg2 solver can achieve the same accuracy as the dg2 solver but with a greater efficiency than the fv1 solver due to the smoothness of its piecewise linear basis which enables more aggressive coarsening than with the piecewise constant basis in the hfv1 solver this suggests a great potential for the mwdg2 solver to efficiently handle the depth and breadth in resolution variability while also being a multiresolution mesh generator accompanying model software and simulation data are openly available online keywords adaptive multiresolution schemes scaled discontinuous galerkin and finite volume hydraulic models multi wavelet data de compression performance comparisons 1 introduction explicit godunov type finite volume schemes toro and garcia navarro 2007 have become standard in hydraulic models teng et al 2017 in essence the finite volume fv foundation uses a piecewise constant representation of flow variables over a local mesh element in a first order accurate framework fv1 piecewise constant data can be evolved element wise driven by spatial flux exchange through element boundaries while only needing data from adjacent neighbours to complete riemann flux calculations this locality in storage and evolution of piecewise constant data offers practical advantages such as suitability for parallelisation lacasta et al 2013 sanders et al 2010 and makes wetting and drying a lot easier to handle hou et al 2013 medeiros and hagen 2013 however the fv1 approach suffers from excessive numerical diffusion which can only be alleviated by using fine resolution meshes often leading to unacceptable computational costs and meshing inflexibilities over large spatial domains attempts to incorporate classical adaptive mesh refinement strategies within the fv1 approach are shown to cause adverse effects such as keeping a coarsest mesh resolution that is fine enough increasing model sensitivity to tuning many adaptivity parameters and impacting overall conservativeness zhou et al 2013 kesserwani and liang 2015 liang et al 2015 donat et al 2014 these adverse effects are not alleviated with higher order fv methods that involve non local interpolation of piecewise constant data li 2010 an and yu 2014 a numerical modelling strategy is still desired that can inherently automate and initialise mesh resolution and improve runtime efficiency within the fv1 approach the discontinuous galerkin dg method extends the foundation of the fv1 approach by shaping local piecewise polynomial solutions from a discrete element wise formulation of the conservative model equation s dg methods significantly reduce numerical diffusion even on very coarse meshes e g at a grid resolution exceeding 10 m2 and have excellent conservation properties minatti et al 2016 kesserwani 2013 kesserwani and wang 2014 bokhove 2005 compared to a fv counterpart the dg method has a much larger cost per mesh element in terms of data storage and computing time and such cost is proportional to the desired order of accuracy even with a simplified second order dg dg2 method for practical conveniences kesserwani et al 2018 runtime costs on uniform meshes are 7 15 times greater than with first and second order accurate fv alternatives kesserwani 2013 kesserwani and wang 2014 classical adaptive mesh refinement strategies with dg methods do not seem a practical way forward because they still suffer from many of the adverse effects reported for the fv1 method kesserwani and liang 2015 kesserwani and liang 2012 a sparse numerical modelling strategy which can make dg2 as efficient as fv1 is thus highly desired to increase accuracy and coverage in handling high resolution modelled data adaptive wavelet based schemes offer an attractive route to overcome many of the adverse effects observed in classical adaptive mesh refinement methods liang et al 2015 donat et al 2014 li 2010 an and yu 2014 kesserwani and liang 2012 liang and borthwick 2009 when applied to the reformulation of fv1 models these schemes introduce a multiresolution analysis to de compress piecewise constant modelled data mapped by the haar wavelet from within the local basis of the fv1 method harten 1995 cohen et al 2003 müller 2002 minbashian et al 2017 archibald et al 2011 wang et al 2016 we term this haar wavelet variant of fv1 the hfv1 method haleem et al 2015 were the first to propose an hfv1 approach for solving the shallow water equations swe with irregular topography and wet dry fronts demonstrating that hfv1 directly inherits the robustness properties of the underlying fv1 scheme however haleem et al 2015 did not fully leverage the local de compressibility property of wavelets instead their hfv1 approach retained some of the aforementioned adverse effects by still relying on an extrinsic gradient sensor alongside its extra user specified parameter and use of relatively fine initial meshes with very few resolution levels haleem et al 2015 more recently adaptive multiwavelet based schemes have been devised based on a multiresolution analysis implemented using multiwavelets mw within the local basis of dg methods hovhannisyan et al 2014 gerhard et al 2015 gerhard et al 2015 gerhard and müller 2014 adaptive mwdg schemes have also been proposed for the solution of the swe in the works of gerhard et al 2015 kesserwani et al 2015 caviedes voullième and kesserwani 2015 who have highlighted the ability of these approaches to achieve resolution refinement and coarsening driven by a single user prescribed parameter rigorously transfer and recover data between disparate resolution levels thereby allowing arbitrarily large resolution gaps and any degree of mesh coarsening and readily preserve accuracy conservation and robustness properties of the underlying dg scheme starting with a robust dg2 hydrodynamic model mw can be introduced subject to appropriate scaling of the dg2 local basis functions to form an mwdg2 scheme in which piecewise linear modelled data can be analysed scaled and assembled into an adaptive solution compared to the hfv1 adaptive solver which relies on piecewise constant modelled data mw allow greater compression rates however the strength of this property relating to standard fv1 and dg2 models is not yet identified from consistent mwdg2 and hfv1 schemes that fully exploit local multi wavelet compression of data this paper studies the behaviour of multi wavelets integrated within robust fv1 and dg2 solvers and identifies the extent of their benefits and limitations for hydraulic modelling in section 2 a practical implementation of an mwdg2 solver is presented that fully exploits local mw compression of data and in which an hfv1 solver is obtained by direct simplification from the mwdg2 formulation section 2 4 section 2 includes also the formulation of a scaled dg2 solver section 2 1 with guiding principles on how it readily fits into the multiresolution analysis of mw section 2 2 to form the so called adaptive mwdg2 scheme section 2 3 in section 3 the adaptive hfv1 and mwdg2 solvers are systematically tested and compared in the simulation of well known hydraulic tests that cover elementary aspects relevant to accurate efficient and robust hydraulic modelling the adaptive solvers are run starting from an initial mesh with a single element spanning the entire domain and the accuracy and efficiency of the adaptive solvers are quantified in relation to standard fv1 and dg2 simulations on the uniform grid involving the finest resolution accessible to the adaptive solvers in section 4 key findings and conclusions of this work are summarised numerical simulation data shaw and kesserwani 2018 and a fortran 2003 implementation of the hfv1 mwdg2 shallow flow models shaw et al 2018 are available to download from zenodo instructions for running the models and interpreting the data are provided in appendix 1 2 adaptive mwdg2 scheme this section outlines the implementation details of an mwdg2 solver for the conservative form of the standard swe with source terms over a 1d domain ω written as 1 t u x f u s u where t and x represent partial derivatives with respect to t and x u x t is the vector of the state variables at a location x and time t f u is the spatial flux vector and s u is a vector including bed and friction slope terms these vectors are given by 2 u h q f q q 2 h g h 2 2 and s 0 s b s f where g m s2 is gravity h m is the water height q hv m2 s is the flow discharge per unit width with v m s being the velocity and z x is the topography function in the bed slope source term sb gh x z the term sf cfv v represents the energy loss due to friction effects with c f g n m 2 h 1 3 in which nm is the manning s bed roughness coefficient 2 1 scaled dg2 formulation the 1d domain ω is divided into a set of m elements ii i 1 m by means of m 1 interface points x i 1 2 i 1 m 1 such that ii x i 1 2 x i 1 2 is a segment with ω i 1 m i i and i i i i 1 x i 1 2 an element ii has the centre x i 1 2 x i 1 2 x i 1 2 and size δx x i 1 2 x i 1 2 ii can be mapped into a reference element 1 1 by the following change of variable ξ x 2 x xi δx therefore ξ x such that x ξ xi ξ δx 2 can be used to position ii onto 1 1 2 1 1 finite element weak form by multiplying eq 1 by a test function ν x integrating by parts to remove x on the flux term and moving the flux terms to the rhs the following weak form can be obtained cockburn and shu 2001 3 ω t u x t ν x d x f u x t ν x ω ω f u x t x ν x d x ω s u x t ν x d x it is worth noting that in eq 3 the incorporation of appropriate local bases functions orthonormal compactly supported and discontinuous as choices for the test function ν x and for expanding an approximate solution u h hh qh t to u are key ingredients to designing an adaptive mwdg scheme hovhannisyan et al 2014 gerhard et al 2015 these choices are needed in order to i embed local resolution variability into the basis functions shaping the dg spatial operators via a dual basis ii expand a local dg approximate solution that is compatible with multi scale decomposition offered by mw via a primal basis and iii get the identity matrix as the only multiplier of the time derivative term t u in the lhs of eq 3 via deploying bi orthonormal primal and dual bases the key concepts relevant to these basis functions are introduced next as appropriate 2 1 2 choice of bi orthonormal bases the starting point is to consider the legendre basis of polynomials up to first order within the scope of designing a dg2 scheme cockburn and shu 2001 this basis is denoted by p p 0 p 1 t with p 0 ξ 1 and p 1 ξ ξ as such it is compactly supported on 1 1 inherently discontinuous at ξ 1 and orthogonal for the l 2 norm defined by the following inner product 4 f g ω f ξ g ξ d ξ the basis p is normalised for the l 2 norm to produce the l 2 orthonormal basis p p 0 p 1 t such that p k p k δ k k where δ kk 1 for k k and δ kk 0 otherwise the components of the orthonormal basis p are alpert et al 2002 5 p k ξ 2 k 1 2 p k ξ k 0 1 and ξ 1 1 from the orthonormal basis components p 0 and p 1 the local primal and dual bases can be defined over ii which are denoted as ϕ i φ i 0 x φ i 1 x t and ϕ i φ i 0 x φ i 1 x t with 6 φ i k x 2 p k ξ x k 0 1 and x i i 7 φ i k x φ i k x δ x k 0 1 and x i i each of the primal and the dual bases is compactly supported orthogonal and discontinuous at the interfaces x i 1 2 of the element ii these bases are bi orthonormal since the following relationship holds 8 φ i k φ i k δ i i δ k k 2 1 3 dg2 operators by choosing the test function ν x as the components of the dual basis φ i k x in eq 7 and exploiting their orthogonality and compact support properties the weak form in eq 3 becomes 9 x i 1 2 x i 1 2 t u φ i k x d x l i k u k 0 1 where l i k u are operators involving spatial evaluations of flux and source terms given by 10 l i k f u φ i k x x i 1 2 x i 1 2 x i 1 2 x i 1 2 f u x φ i k x d x x i 1 2 x i 1 2 s u φ i k x d x u is replaced by an approximate solution u h expressed in terms of the primal basis as 11 u h x t i i k 0 1 u i k t φ i k x u i 0 t 3 ξ x u i 1 t in which u i 0 t and u i 1 t are expansion coefficients or modes representing an average and a slope characterising the local linear approximation of u h over ii the initial state of the coefficients at the rhs of eq 11 u i k 0 is obtained by projecting a given initial condition u 0 x u x 0 onto the dual basis as follows 12 u i k 0 u 0 φ i k x i 1 2 x i 1 2 u 0 x φ i k x d x which once mapped into the reference element 1 1 for applying k 1 gauss legendre quadrature rules and then manipulated to involve interface evaluations kesserwani et al 2010 yield the following expressions for initialising the initial average and slope coefficients 13 u i 0 0 1 2 u 0 x i 1 2 u 0 x i 1 2 14 u i 1 0 1 2 3 u 0 x i 1 2 u 0 x i 1 2 now considering eqs 9 10 with u h instead of u and exploiting the bi orthonormality property via eq 8 the system of pdes is locally decoupled to solve for two independent odes over ii 15 t u i k t l i k u h k 0 1 the time derivative in eq 15 is solved using an explicit two stage runge kutta rk2 time stepping scheme e g as described in kesserwani et al 2010 which requires evaluation of the spatial dg2 operators l i k u h to evolve u i k t over ii over each rk2 stage for simplicity the local dg2 operators l i k u h is denoted hereafter by l i k which can be expressed as 16 l i k f u h x i 1 2 t φ i k x i 1 2 f u h x i 1 2 t φ i k x i 1 2 x i 1 2 x i 1 2 f u h x t x φ i k x d x x i 1 2 x i 1 2 s u h x t φ i k x d x adopting discontinuous basis functions allows u h to be discontinuous at the element interfaces x i 1 2 to incorporate both limits u h x i 1 2 t and u h x i 1 2 t in the flux evaluation therein a numerical flux function f is introduced as is usually done in godunov type finite volume methods toro and garcia navarro 2007 toro 2001 by further mapping l i k onto the reference element where k 1 gauss legendre quadrature rules can be applied to approximate volume integral terms of the flux and source terms and by considering only the bed slope source term s b 0 sb t eq 16 becomes 17 l i 0 1 δ x f i 1 2 f i 1 2 δ x s b u i 0 x z h 18 l i 1 3 δ x f i 1 2 f i 1 2 f u i 0 u i 1 f u i 0 u i 1 δ x 2 3 s b u i 0 u i 1 x z h s b u i 0 u i 1 x z h in eq 18 f i 1 2 f u i 1 2 u i 1 2 represents a flux evaluation at x i 1 2 via a two argument numerical flux function f based on the harten lax and van leer approximate riemann solver toro 2001 u i 1 2 u h x i 1 2 t i i and u i 1 2 u h x i 1 2 t i i 1 denote the limits of u h at both sides from x i 1 2 which are known as riemann states at which wetting and drying considerations occur as outlined later in section 2 3 3 these limits can obtained from eq 11 as follows 19 u i 1 2 u i 0 t 3 u i 1 t and u i 1 2 u i 1 0 t 3 u i 1 1 t the bed slope discretisation in s b is performed by expanding zh locally over ii onto the primal basis consistently with the shaping of the local approximate solution eqs 11 14 20 z h x i i z i 0 3 ξ x z i 1 with z i 0 and z i 1 being time independent modes for the topography term approximation which can be initialised as in eqs 13 14 by 21 z i 0 1 2 z x i 1 2 z x i 1 2 22 z i 1 1 2 3 z x i 1 2 z x i 1 2 the discretisation is then completed by extracting an approximate partial derivative while mapping from the reference element 23 x z h i i 2 3 δ x z i 1 therefore the expressions of the bed slope source terms involved in eqs 17 and 18 become 24 s b u h x t x z h 2 3 δ x i 0 g h h x t z i 1 substituting eq 24 into eqs 17 and 18 the dg2 operators can be further simplified to 25 l i 0 1 δ x f i 1 2 f i 1 2 0 2 g 3 h i 0 z i 1 26 l i 1 3 δ x f i 1 2 f i 1 2 f u i 0 u i 1 f u i 0 u i 1 0 2 g h i 1 z i 1 2 1 4 extension to multiresolution bases from the same l 2 orthonormal basis p a series of child bases p n n can be defined given its property of being a refinable function alpert et al 2002 keinert 2004 alpert 1993 where n is a positive integer indicating the refinement level which will hereafter be used as a bracketed superscript to avoid notation confusion with other indexes these child bases arise from the father basis p 0 p and preserve its properties the supports of these child bases at any refinement level n can be associated with a grid g n based on n dyadic sub divisions of the support 1 1 of p hence g n spans 1 1 such that g n j 0 2 n 1 i j n where i j n j 0 1 2 n 1 is a set of non overlapping sub divisions of 1 1 moreover a sub division i j n can be regarded as a sub element of 1 1 taking the following form 27 i j n χ j 1 2 χ j 1 2 with χ j 1 2 1 2 2 n j are interface points forming sub elements i j n j 0 1 2 n 1 and the index j 0 1 2 n 1 representing the position of i j n in g n on which the components p j n of the basis p n p j n j can be obtained by translation and dilatation of p as follows 28 p j n χ 2 n p 2 n χ 1 2 j 1 χ i j n from the compact support and l 2 orthonormality properties of p n n the grids g n n form a hierarchy spanning 1 1 i e n g n 1 1 and are globally nested across all refinement levels while having local and non overlapping support at each level n similarly on a mesh element ii x i 1 2 x i 1 2 a hierarchy of nested grids g i n n can be defined such that g i n j 0 2 n 1 i j i n with i j i n j 0 1 2 n 1 now denoting sub divisions of ii with i j i n representing a sub element of ii at a position j relative to refinement level n namely 29 i j i n x j 1 2 i n x j 1 2 i n in eq 29 x j 1 2 i n x i 1 2 δ x n j are interface points forming sub elements i j i n j 0 1 2 n 1 and δx n δx 2 n is the grid spacing relative to grid g i n with positions j such that j 0 1 2 n 1 for convenience of presentation sub elements i j i n will hereafter be denoted by i e n where index e is shorthand for j i to position sub elements in ii thereby sub elements i e n can be linked to i j n by translation into 1 1 this also makes it easy to keep consistent with the notation associated with the dg2 method presented previously sections 2 1 1 2 1 3 for application at sub elements i e n which take the following form 30 i e n x e 1 2 n x e 1 2 n with x e n and δ x e n being the centre position and the size of a sub element i e n respectively on i e n g i n bi orthonormal dual and primal bases denoted by ϕ e and ϕ e can be defined via the refined bases p j n j by analogy recall eqs 6 7 and take the form 31 ϕ e n x 2 p j n χ x i e n i i 32 ϕ e n x ϕ e n x δ x n x i e n i i where χ x 2 x x e n δ x e n is a change of variable used to map the position x i e n into i j n adopting the local basis functions in eqs 31 32 and reworking the steps in section 2 1 3 yield similar dg2 operators for any sub element i e n g i n which are similar to eqs 25 26 but with index e instead of i and the grid spacing δx n of g i n instead of δx such dg2 operators can be applied to evolve dg2 modes u e 0 t and u e 1 t spanning local flow solutions u h x t i e n over any sub element i e n g i n n starting from initial flow modes as described in eqs 13 and 14 with index e instead of i similarly topography modes z e 0 and z e 1 on i e n can be initialised as in eqs 21 and 22 for use in the dg2 operators on i e n to ease the presentation in the following sections dg2 flow and topography modes u e 0 t u e 1 t z e 0 and z e 1 will be considered component wise and the scalar variable u h q z will be used to represent any physical quantities in u h q t and z since each u has dg2 modes which are actually its spectral components in terms of average and slope coefficients dg2 modes of any physical quantity u on sub elements i e n g i n n will be denoted as u e n u e 0 n u e 1 n 2 2 multiresolution analysis from the same l 2 orthonormal basis p child bases p n n and multiwavelet bases ψ n n can be defined this allows multiresolution analysis to be performed which is summarised in this section with a view to presenting how it is directly applicable to analysing the behaviour of the dg2 modes on multiresolution bases 2 2 1 relationship between the scaling bases p n n from the properties of the scaling bases p n n defined on the hierarchy of grids g n n it is possible to produce a recurrence relationship for binary merging of two adjacent components of the bases belonging to g n 1 to form the components of the bases in g n without loss of generality it suffices to outline the relationship linking an elementary father basis p j n and its child bases p 2 j n 1 p 2 j 1 n 1 in particular for the case between g 0 and g 1 where n j 0 this relationship between the scaling bases can be achieved by involving the so called low pass filter matrices h 0 and h 1 alpert et al 2002 alpert 1993 which allow p j n to be expressed as linear combination of p 2 j n 1 and p 2 j 1 n 1 33 p j n h 0 p 2 j n 1 h 1 p 2 j 1 n 1 34 h 0 p j n p 2 j n 1 1 2 0 6 4 2 4 35 h 1 p j n p 2 j 1 n 1 1 2 0 6 4 2 4 2 2 2 multiwavelet bases and their relationship to the scaling bases now reconsidering the father basis p a mother basis of wavelets ψ or multiwavelets alpert et al 2002 can be defined on g 0 1 1 which represents the encoded l 2 orthonormal difference between p p 0 0 and the components of its two child bases p 0 1 p 1 1 supported on g 1 1 0 0 1 in essence ψ represents the l 2 orthonormal complement of p 0 0 p in g 1 therefore ψ is one refinement level higher than p 0 0 and spans g 0 g 1 taking the form alpert et al 2002 36 ψ χ ψ 0 0 χ ψ 1 0 χ 37 ψ 0 0 χ 3 2 2 χ 1 χ i 0 1 3 2 2 χ 1 χ i 1 1 and ψ 1 0 χ 1 2 3 χ 2 χ i 0 1 1 2 3 χ 2 χ i 1 1 with i 0 1 1 0 and i 1 1 0 1 denoting the two shifts forming g 1 for generality relating to eq 27 note that ψ admits a discontinuity at χ 0 which offers an advantage for the analysis of signals with discontinuities moreover ψ and p are bi orthonormal with the former inheriting the properties of the latter hence a series of child multiwavelets ψ n n can be defined on the hierarchy of grids g n n by translation and dilatation of ψ such that on a grid g n j 0 2 n 1 i j n ψ n ψ j n j 0 1 2 n 1 where each ψ j n takes the following form 38 ψ j n χ 2 n ψ 2 n χ 1 2 j 1 χ i j n from the scaling bases binary merging of two adjacent components belonging to g n 1 can be achieved to produce the components of the multiwavelet bases in g n again it suffices to outline the relationship linking an elementary multiwavelet basis ψ j n in g n to the scaling bases p 2 j n 1 p 2 j 1 n 1 in g n 1 for n j 0 this relationship can be expressed by using the so called high pass filter matrices g 0 and g 1 which allow ψ j n to be derived as linear combination of p 2 j n 1 and p 2 j 1 n 1 39 ψ j n g 0 p 2 j n 1 g 1 p 2 j 1 n 1 40 g 0 ψ j n p 2 j n 1 0 1 2 2 4 6 4 41 g 1 ψ j n p 2 j 1 n 1 0 1 2 2 4 6 4 2 2 3 single scale vs multi scale expansions the definition of scaling and multiwavelet bases on the hierarchy of grids g n n allows for two interchangeable ways to approximate a given scalar signal s ξ defined on 1 1 given a grid g n j 0 2 n 1 i j n associated with the scaling bases p n p j n j 0 1 2 n 1 an approximation sh ξ of the signal s ξ can be obtained by expanding it onto the bases p n as follows alpert et al 2002 42 s h ξ j 0 2 n 1 s h χ i j n in which s h χ i j n is a piecewise linear expansions onto each basis p j n that is compactly supported on the sub element i j n the signal approximation can therefore be expressed as 43 s h i j n s j n p j n s j 0 n p j 0 n s j 1 n p j 1 n where s j n s j 0 n s j 1 n denotes local scale coefficients expanding s h χ i j n onto the basis p j n which can be initialised as s j k n s p j k n with k 0 1 this type of description i e in eqs 42 and 43 is called single scale expansion as it only involves scale coefficicents from the grid g n at a single scale refinement level n another way to expand sh ξ is to involve the multiwavelet bases by doing so the single scale description of in eqs 42 43 can be recursively decomposed to produce a so called multi scale expansion this form of description sums up the features of sh ξ via wavelet coefficients throughout grids g 0 g n 1 to its background information at its coarsest level i e the scale coefficients on g 0 hence the multi scale expansion takes the form alpert et al 2002 44 s h ξ s h ξ i 0 0 l 0 n 1 j 0 2 l 1 d j l χ ψ j l χ 45 d j l ψ j l d j 0 n ψ j 0 l d j 1 n ψ j 1 l with d j l d j 0 l d j 1 l denoting the local details also known as detail coefficients or wavelet coefficients they can be initialised as d j k l s ψ j k l with k 0 1 the multi scale expansion in eqs 44 and 45 clearly distinguishes the details of sh ξ between successively higher resolution which become increasingly significant with increasing levels of non smoothness in sh ξ while remaining negligible where sh ξ is smooth therefore it provides a mechanism to analyse decompose and reconstruct the approximate signal sh ξ across the grids in the hierarchy g n n 2 2 4 two scale transformations between coefficients from the link between the high and low pass filter matrices alpert et al 2002 outlined previously in eqs 34 35 and 40 41 relationships for scaling up or down recurrently relevant coefficients between subsequent resolution levels n and n 1 can be produced namely 46 s j n h 0 s 2 j n 1 h 1 s 2 j 1 n 1 d j n g 0 s 2 j n 1 g 1 s 2 j 1 n 1 47 s 2 j n 1 h 0 t s j n g 0 t d j n s 2 j 1 n 1 h 1 t s j n g 1 t d j n eq 46 is useful to encode or extract the scale and detail coefficients s j n and d j n at a sub element i j n g n from the scale coefficients s 2 j n 1 and s 2 j 1 n 1 of its two child sub elements i 2 j n 1 i 2 j 1 n 1 g n 1 it applies in a descending order across refinement levels starting from sub elements on the finest grid g l with l being a maximum refinement level prescribed by a user this results in a multi scale expansion as in eq 44 compressing the details across the whole hierarchy g n n 0 1 l eq 47 is used in the opposite sense to decode or combine scale and wavelet coefficients at any i j n n l 1 1 0 to generate their scale coefficients located one resolution higher i e the scale coefficients on the two sub elements i 2 j n 1 and i 2 j 1 n 1 given a multi scale expansion eq 47 can successively be applied in an ascending order starting from the information available at the coarsest grid g 0 to retrieve a single scale expansion as in eq 42 up to any refinement level n 0 n l 2 2 5 extension of the analysis for the dg2 modes on multiresolution bases to extend the validlity of the analysis in sections 2 2 1 2 2 4 from bases p n n spanning 1 1 to the multiresolution bases ϕ e n n spanning ii it suffices to consider eq 31 and the notation adopted in section 2 1 4 now eqs 42 45 can be reused for any physical component u with u h i i being its expansion on ii by coefficients u e n n e as in eq 42 each u e n contains the expansion coefficients of a local linear dg2 solution on sub elements i e n i i as in eq 43 or dg2 modes as u e n u e 0 n u e 1 n over a selected grid g i n e 0 2 n 1 i e n of the hierarchy of grids g i n n dg2 modes u e n e 0 1 2 n 1 can be initialised for the single scale expansion u h i i which actually represents an assembled dg2 solution on grid g i n alternatively a multi scale expansion is also possible as in eqs 44 and 45 which is actually a compressed mwdg2 solution allowing to access the details d e l l e with d e l d e 0 l d e 1 l living on lower resolution grids g i l l n 1 1 0 these details can be initialised from the dg2 modes on g i n for the physical components u h z q z as explained later in section 2 3 1 with this change of bases and variable the two scale transformation formulae in eqs 46 47 should be re scaled by 2 to make them relevant to the dg2 modes and their associated details leading to modified formulae 48 u e n 1 2 h 0 u 2 e n 1 h 1 u 2 e 1 n 1 d e n 1 2 g 0 u 2 e n 1 g 1 u 2 e 1 n 1 49 u 2 e n 1 2 h 0 t u e n g 0 t d e n u 2 e 1 n 1 2 h 1 t u e n g 1 t d e n as detailed later in section 2 3 eqs 48 49 can be directly deployed within the scaled dg2 method as needed to encode information via eq 48 i e binary merging of dg2 modes on g i n 1 to generate coarser modes and or their details on g i n or decode information via eq 49 i e adding up the details and modes on g i n to generate the dg2 modes on g i n 1 encoding is key to produce scan and distinguish the details across successive refinement levels from within the compressed mwdg2 solution whereas decoding is key to generate an assembled dg2 solution from a set of carefully selected dg2 modes relative to sub elements with non uniform size δx n 2 3 multiresolution scaled dg2 adaptive solution this section describes how multiresolution analysis section 2 2 can be used directly within the scaled dg2 formulation section 2 1 to produce the so called adaptive mwdg2 numerical solution the starting point is to set a desired maximum refinement level l and thereby refine the coarsest discretisation of the domain ω i 1 m i i to be at the finest uniform resolution allowable a uniform mesh with 2 l m sub elements now each element i i has 2 l sub elements i e l e 0 1 2 l 1 such that i i g i l e 1 2 l 1 i e l given that the combined mwdg2 functioning can be applied element wise we hereafter assume that the coarsest grid spanning ω is made by a single element hence we take m 1 without loss of generality now g i l represents the finest uniform discretisation for ω which is made of sub elements i e l e 0 1 2 l 1 on each sub element i e l dg2 modes u e l u e 0 l u e 1 l with u h q z can be initialised in terms of flow and topography data section 2 1 4 forming an assembled dg2 solution on the finest grid g i l for initial pre processing section 2 3 1 2 3 1 pre processing generation of initial detail coefficients t 0 s initially dg2 modes u e l e 0 1 2 l 1 of the flow and topography are only available on g i l from these modes details d e n n e living on the lower resolution grids g i n n l 1 1 0 can be encoded this is achieved by successive application of eq 48 in a descending order starting from refinement level l 1 until reaching the coarsest level 0 where both the coarsest modes u 0 0 and details d 0 0 become available moreover details representing the water height h were encoded based on the dg2 modes representing the free surface elevation h z which was found necessary to avoid producing misinformative details for h when the topography is very steep in what follows the details d e n n e will be actually associated with components u h z q z from the details d e n n e an alternative set of normalised detail magnitudes denoted by d ˇ e n n e can be generated this set is needed to enable measuring the significance of all detail coefficents combined regardless of which physical quantity u they represent namely a normalised detail magnitude d ˇ e n is a scalar evaluated from from its detail d e n as gerhard et al 2015 50 d ˇ e n m a x d e 0 n d e 1 n m a x 1 m a x u e 0 l e where m a x u e 0 l e is the maximum of the average coefficients of the dg2 modes on g i l also across the hierarchy g i n n l 1 0 due to variational boundness across refinement levels note that at the starting time all details d e n n e for all variables u h z q z are fully accessible on g i n n l 1 1 0 they can be ascendingly summed upon the coarsest dg2 modes u 0 0 on ii to form a compressed mwdg2 solution on g i n n l 1 0 which is as accurate as the assembled dg2 solution on g i l later when t 0 details d e n n e of the flow variables u h z q are subjected to constant change given the time dependent nature of h z and q section 2 3 4 while the details of z do not change with time 2 3 2 prediction regularisation and decoding adaptive solution generation t 0 s by analysing the magnitude of the normalised details in the hierarchy g i n n l 1 0 an adaptive grid at a present time t denoted by g i a t can be formed by selecting certain sub elements 51 g i a t i e n g i n n 0 n l 0 e 2 l 1 and ω n e i e n the act of measuring normalised detail magnitudes is here refered to as prediction and involves four subsequent steps for deciding the sub elements forming g i a t firstly an error threshold ε needs to be prescribed such that 0 ε 1 which is a parameter chosen by the user to decide which details can be ignored while there is no unique choice for ε an optimal range of choices exists to keep the accuracy of assembled dg2 solution on g i a t at the same level as the finest resolution accessible on g i l at time t via the compressed mwdg2 solution hovhannisyan et al 2014 an optimal choice for ε is expected to be somewhere between 10 4 and 10 2 arguably the choice of ε is rather heuristic context specific and seemigly dependent on the order of accuracy of the dg scheme harten 1995 cohen et al 2003 gerhard et al 2015 an analysis on the choice of ε for the adaptive hfv1 and mwdg2 solvers used in the present work is carried out later in section 3 1 1 secondly normalised details d ˇ e n n e living on g i n n l 1 1 0 are compared to ε for indentifying the significant details in doing so their magnitudes are scanned level wise in an ascending order n 0 1 l 1 and compared to level depedent error thresholds ε n such that ε n 2 n l ε within this process a detail d e n is classified as significant if 52 d ˇ e n ε n meanwhile sub elements i e n with significant details are flagged as active meaning they are plausible candidates for inclusion in g i a t thirdly re flagging of active sub elements i e n is needed for regularisation to ensure that significant details can be re accessed within a tree structure in fact across g i l 1 g i 1 and g i 0 whenever any child details d 2 e n or d 2 e 1 n is significant on g i n its parent detail d e n 1 on g i n 1 can only be significant and should be made accessible for possible use later in the generation of an assembled dg2 solution on g i a t thus regularisation is the act of ensuring that such sub elements i e n 1 are also flagged as active when many mother elements are used m 1 regularisation should also consider activating those sub elements located at the boundaries across the elements which is necessary to ensure that the modelling information can propagate across different elements fourthly all significant details d e n at a present time t are revisited to also predict whether their significance is likely to remain or increase at time t δt with δt denoting the simulation time step such a detail is here referred to as extra significant and can be identified by 53 d ˇ e n 2 m 1 ε n in eq 53 m is the order of accuracy of the prediction operator cohen et al 2003 which is chosen such that k m a x m k m a x 1 with kmax being the polynomial order of the dg solution in this work m is taken equal to 1 5 though it may be useful to note that any other choice within this range was found appropriate when a detail d e n is extra significant the set of active sub elements is enlarged to include in addition to i e n its child sub elements i 2 e n 1 and i 2 e 1 n 1 this step is necessary to ensure that no significant features in the adaptive flow solution u h z q on g i a t are overlooked on g i a t δ t when generating future details section 2 3 4 finally a dg2 solution on g i a t can be decided by ascendingly inspecting the tree of details starting from the coarsest details d 0 0 and dg2 modes u 0 0 while decoding that is while climbing the details tree n 0 1 2 and n l 1 eq 49 is successively applied to decode local dg2 modes u e n on active sub elements i e n inspection of details is aborted under two circumstances i when a detail d e n switches status to becoming insignificant for the first time with its local dg2 modes u e n selected for generating the assembled dg2 solution on g i a t or otherwise ii inspection and decoding reached g i l 1 with certain details d e l 1 remaining significant and their local dg2 modes u e l 1 are already decoded then a last round of decoding is applied to yield the child modes u 2 e l and u 2 e 1 l on g i l for inclusion while generating the assembled dg2 solution on g i a t the adaptive dg2 solution can now be viewed as a series of carefully selected dg2 modes forming an assembled dg2 solution on the non uniform grid g i a t each local dg2 mode should then be updated by applying the scaled dg2 formulation as described in section 2 3 3 prior to this the dg2 modes representing the water height h should be restored by subtracting the modes representing the topography z from those of the free surface elevation h z then the scaled dg2 formulation can be applied to update the dg2 modes of the main flow data u h q as previously described sections 2 1 3 and 2 1 4 2 3 3 rk2 dg2 update elevating the modes of the assembled dg2 solution to time t δt by applying the scaled dg2 formulation described in section 2 1 4 each local mode in u e n relevant to the main flow data u h q is updated within a standard rk2 time stepping while doing so key treatments are incorporated in the rk2 dg2 update to ensure stability around sharp solution gradients together with conservative incorporation of source terms with wetting and drying these treatments are well reported for the unscaled rk2 dg2 method kesserwani and liang 2012 herein they are re applied with few modifications to accommodate the scaling introduced to the present dg2 method and the changes related to using the standard swe model instead of the pre balanced model liang and borthwick 2009 and to further exploit the details ensuring the generation of a robust assembled dg2 solution these treatments are summarised in the rest of this section double localisation and slope limiting local slope limiting is needed for certain slope coefficients u e 1 l of the flow variables u h q slope limiting is a necessary process prior to each rk stage to prevent development of gibbs phenomena around sharp solution gradients it should only be triggered at such portions in the solution otherwise it can degrade the conservative character of dg2 modes in any other portions of the dg2 solution or even affect robustness e g see examples within kesserwani and liang 2012 kesserwani and liang 2012 therefore double localisation is applied to cautiously restrict the application of the slope limiter to the portions of the assembled dg2 solution at which sharp gradients are about to form the first localisation step consists of only considering the active slope coefficients at the maximum refinement level l u e 1 l for possible limiting in fact dg2 modes u e l at refinement level l can only be active whenever sustained by a tree of significant details as previously described in section 2 3 2 and also proved in vuik and ryan 2014 when this happens u e l should be representative of a local feature occurring in the assembled dg2 solution such a local feature can either be a sharp discontinuity i e a shock wave or shockless representing a solution kink e g a front of a rarefaction wave or a rapidly changing state e g due to a wetting and or a drying process therefore a second localisation step is needed to avoid slope limiting around any shockless feature within the assembled dg2 solution this can be achieved by further subjecting those active slope coefficients u e 1 l to krivodonova s shock detector krivodonova et al 2004 which is here used with a detection threshold 9 instead of 1 krivodonova et al 2004 to ensure it only detects slope coefficients associated with the presence of a sharp solution discontinuity after double localisation the relevant slope coefficients can then be limited by a slope limiter function such as the generalised minmod i e eq 2 9 in cockburn and shu 2001 which is here used moreover shock detection and limiting is applied component wise on u h z q with the component h z used instead of h to ensure that the presence of sharp terrain gradients will not mistakenly trigger any slope limiting on the slope coefficients representing the water height h after double localisation and limiting limited slope coefficients for h can be deduced from the limited slope coefficents of h z by subtracting the slope coefficients of z it may be useful to note that without double localisation the quality of the assembled dg2 solution compared to the dg2 solution on a uniform grid might undergo more significant deterioration as a result of unnecessary calls of the generalised minmod limiter in effect the limiter tends to either zero or unnecessarily substitute the true dg2 slope coefficients in any case this leads to false slope coefficients being used during encoding eq 48 resulting in false details in the compressed mwdg2 solution which would manifest themselves in a deteriorated assembled dg2 solution after decoding eq 49 well balanced and depth positivity preserving dg2 modes the selected dg2 modes forming the assembled dg2 solution on g i a t are revised based on the wetting and drying condition described in kesserwani and liang 2012 which is applied here with the following changes firstly eq 19 is used to generate the original riemann states for the components u h z h q instead of eq 12 in kesserwani and liang 2012 secondly revised states for the components u z h z q are reconstructed from original states under conditions ensuring both depth positivity and well balancedness i e using eqs 14 16 in kesserwani and liang 2012 these revised states should be used to calculate riemann fluxes across the sub elements forming g i a t thirdly eqs 13 14 and 21 22 are reused to reconstruct dg2 modes based on the revised riemann states fourthly revised dg2 modes of the h variable are deduced from those of the h z variable by subtracting the revised dg2 modes of the z variable finally revised dg2 modes of u z h q and riemann fluxes become availabe to evaluate the dg2 operators eqs 25 26 when applying the present wetting and drying condition it may be useful to note two key aspects the first is about the continuity property of the dg2 topography projection in eq 20 although eqs 21 22 ensure that the continuity of the dg2 topography projection holds on a static uniform grid kesserwani 2013 this property does not necessarily hold for the assembled dg2 topography projection on g i a t in fact this topography projection is subject to constant decoding eq 49 from the compressed mwdg2 solution based on coefficients eqs 34 35 and 40 41 associated with decompositions from essentially discontinuous functions eqs 31 32 and 36 37 hence involving the free surface elevation h z as an intermediate variable as in kesserwani and liang 2012 is found necessary to achieve wetting and drying without relying on the continuity property for the assembled dg2 topography projection on g i a t the second aspect is about a specific time step restriction criterion to ensure depth positivity for the average coefficients with time evolution by denoting h e 0 t and h e 0 t δ t the average coefficients of the water height variable at times t and t δt respectively the following formula can be obtained using a similar reasoning as in kesserwani and liang 2012 54 h e 0 t δ t 1 2 c r h e 0 t in eq 54 cr stands for the courant number relative to the courant friedrichs lewy condition which restricts the time step size δt within explicit time integration schemes from eq 54 it is clear that whenever h e 0 t 0 cr must be 0 5 to also ensure that h e 0 t δ t 0 while condition 54 may be irrelevant for the rk2 dg2 method for which cr 0 3 cockburn and shu 2001 it is found critical to preserve the stability of its first order finite volume variant for which cr 1 as described later section 2 4 scaled implicit friction term discretisation prior to each rk2 time step the dg2 modes of the discharge are modified to add friction contribution as done for the unscaled dg2 formulation i e see section 2 5 within kesserwani and liang 2012 the same approach is applied for the scaled dg2 method used in this work leading to similar expressions as in kesserwani and liang 2012 i e eq 36 in section 2 5 of kesserwani and liang 2012 for adding friction into the discharge slope coefficients but without having any of the 3 s due to to the use of rescaled basis functions 2 3 4 truncation and encoding forming a new compressed mwdg2 solution to create new details the updated dg2 modes which form the assembled dg2 solution on g i a t should be used to reform a compressed mwdg2 solution on g i n n l 1 1 0 dg2 flow modes for the components u h q are only defined for the sub elements in g i n n l 1 1 0 that spanned g i a t the other sub elements remained inactive hence have non existent dg2 flow modes in this work truncation is the process of initialising zero details throughout g i n n l 1 1 0 in particular at the inactive sub elements to keep them subject to potential activation in the next round i e while redoing the process described in section 2 3 2 over the active sub elements belonging also to g i a t encoding is done by successively applying eq 48 level wise in decending order this generates new flow details from the updated dg2 modes and thereby addresses any irrelevant zeroing introduced previously by truncation as in the pre processing step section 2 3 1 encoding should be applied on the components u h z q after truncation and encoding a full set of new details d e n n e is available for which an alternative set of normalised details d ˇ e n n e can be produced via eq 50 see section 2 3 1 with new sets of details in place the process sections 2 3 2 2 3 4 can be repeated to evolve the adaptive solution up to a specific simulation time 2 4 first order variant adaptive haar finite volume hfv1 scheme the hfv1 adaptive solution is effectively an mwdg1 method formulated upon the same scaling and wavelet basis described in sections 2 1 2 3 but only considering the the zeroth component of the legendre basis i e p 0 ξ 1 hence neglecting the slope coefficents now the local approximate solution u h in eq 11 becomes piecewise constant which can be initialised by eq 13 and updated by the operator 17 the filter matrices are thus made of a single scalar given by 55 h 0 h 1 g 0 g 1 1 2 with which eqs 48 49 are applied to encode and or decode coefficents u e n and or d e n these coefficients now include only one component representing the piecewise constant averaged data the adaptive hfv1 solution is processed as described in section 2 3 while omitting all the routines involving slope coefficents e g double localisation and limiting explicit first order time marching is applied for time integration but with courant number not exceeding 0 5 to ensure depth posivity see section 2 3 3 for comparison purposes the highest permissible courant number shared by the mwdg2 and hfv1 adaptive solutions i e cr 0 3 is chosen to run all the simulations in section 3 3 numerical tests seven diagnostic tests are conducted to identify and compare the behaviour of the adaptive hfv1 and mwdg2 solution schemes with reference to the standard first order finite volume fv1 and second order discontinuous galerkin dg2 schemes on uniform grids the first test considers a dam break flow on a wet and flat domain with a shock wave on which wavelet adaptivity related issues and choices are thoroughly analysed to find a setting where the adaptive solvers are as numerically accurate as their uniform grid counterparts at the finest resolution available while remaining computationally more efficient in the second test the predictive accuracy of the adaptive solvers is re explored for dam breaks over a dry bed to assess their sensibility in tracking dynamic flow evolution with wet dry front propagation over frictionless and frictional beds shockless dam break flows over a dry domain are examined in the third test to further inspect the properties of the hfv1 and mwdg2 solvers in capturing a wet dry front accelerating downhill and decelerating uphill the fourth test introduces topography with discontinuities and kinks partially submerged below a lake at rest the test is used to examine the automated mesh generation capability of the adaptive hfv1 and mwdg2 solvers and to assess their ability to preserve well balanced adaptive solutions with zero flow in the fifth test steady state flows are explored to study the convergence property of the adaptive solvers to steady state and to verify further their well balancedness for non zero flows the sixth test uses an oscillatory flow in a parabolic bowl to measure the numerical conservation of mass and energy in a frictionless and physically closed domain where the solvers are subjected to a perpetually moving wet dry fronts with periodically vanishing velocities the final test simulates a laboratory flume experiment of a frictional dam break flow over a trapezoidal hump including an analysis of the trade off between maximum refinement level and computational efficiency except when clearly stated for a specific test the following setting is used as a standard adaptive hfv1 and mwdg2 solution runs start from a single mother element m 1 with nine refinement levels l 9 hence yielding an adaptive grid g i a with number of sub elements between 20 1 and 29 512 uniform fv1 and dg2 solution runs are made at the finest resolution accessible to the adaptive solvers hence on grid g i 9 with 512 elements all solution runs are carried out using the same basic parameters namely cr 0 3 for the time step selection 10 4 for dry sub element detection and 9 for krivodonova s shock detector krivodonova et al 2004 with the mwdg2 dg2 solvers all the simulation results presented here are made available for access as supplementary materials shaw and kesserwani 2018 the fortran 2003 code used to run these tests is available for download on zenodo shaw et al 2018 instructions for running the models and interpreting the data are provided in appendix 1 3 1 dam break flow on a wet domain with shock shock wave transients are characteristic of hydrodynamic flows which are typically short lived during a long time simulation in reality they could well represent an impact event perturbing the flow over the whole simulation domain fine mesh spacing is typically desired over a relatively short period of time when the shock occurs and propagates but such resolution may no longer be required as the shock dissipates to explore the characteristics of wavelet based adaptivity within the hfv1 mwdg2 solutions with discontinuities including shocks the classical dam break test with a flat topography is considered therefore a one dimensional frictionless and wet domain is assumed of length between x 0 and x 50 m with a hypothetical dam located at x 25 m the dam separates two water bodies with different initial values of the water height h the initial conditions are a zero discharge and a discontinuous water profile given by 56 h x 0 6 i f x 25 2 i f x 25 this results in a flow profile including a shock wave and rarefaction wave which propagate away from the initial dam position in opposite directions separated by a constant state toro 2001 assuming open domain boundaries both waves are expected to be present by t 3 s before entirely exiting the domain by t 10 s five series of runs are performed using different solver configurations with the same initial conditions each with a specific purpose as detailed in the following 3 1 1 optimal choice for the error threshold driving wavelet adaptivity in this first series of tests the adaptive hfv1 mwdg2 solvers are employed to identify the error threshold section 2 3 2 that ensures a fair balance between the numerical accuracy and the computational efficiency of the adaptive solvers adaptive and uniform solution schemes are run for the standard setting which yields a uniform grid with 512 elements for the fv1 dg2 solutions δx 0 098 m and an adaptive grid that can allow up to 512 sub elements δx 9 0 098 m for the hfv1 mwdg2 solutions to measure accuracy the normalised ℓ2 error is calculated while varying the additivity error threshold from ε 10 6 to ε 10 1 fig 1 a the ℓ2 errors are evaluated for the water height variable at t 2 5 s when both shock and rarefaction waves are still present in the domain see fig 2 a normalised ℓ2 error is calculated as 57 ℓ 2 h e 0 l h t 2 δ x l h t 2 δ x l where ht is the analytical water height as described in delestre et al 2013 the ℓ2 error for the adaptive solutions is always evaluated on the finest uniform grid available namely g i l by prior conversion from a compressed solution on g i a into an assembled solution on g i l section 2 2 5 in fig 1a the ℓ2 errors of the adaptive hfv1 mwdg2 solvers for various error threshold values are compared to the ℓ2 errors relative to their uniform fv1 dg2 counterparts on the finest grid these results show that both adaptive hfv1 mwdg2 solvers can preserve the ℓ2 accuracy of the underlying uniform fv1 dg2 solvers respectively up to an error threshold value of ε 10 2 particularly for ε 10 2 the errors of the mwdg2 solution remain lower than the errors of the uniform fv1 solution on the finest grid as expected due to the second order accurate nature of the mwdg2 solver with ε 10 1 the ℓ2 errors of hfv1 mwdg2 exceed the ℓ2 errors of uniform fv1 dg2 counterparts on the finest grid with 29 elements although they remain bounded by the uniform fv1 dg2 s errors that are two order of resolution coarser on the grid with 27 elements nonetheless with ε 10 1 the ℓ2 error of mwdg2 is noted to exceed the ℓ2 error of fv1 on the finest grid making it a less compelling choice to further benefit from the dg2 accuracy hence the error threshold ε 10 3 is found to be a rational choice to keep the predictive accuracy of the adaptive solvers at the same level as their uniform counterparts on the finest grid available and to achieve second order accuracy with the mwdg2 solver computational efficiency is measured as the cpu time needed to complete a 40 s long simulation and including the pre processing step section 2 3 1 fig 1b shows the cpu times for the adaptive hfv1 mwdg2 solvers evaluated for all the error thresholds used in the accuracy analysis fig 1a along with the cpu times for the uniform fv1 and dg2 simulations on the finest grid 512 elements as the error threshold increases the cpu time of the adaptive hfv1 mwdg2 solvers decreases initially and becomes practically constant for ε 10 3 for the considered error thresholds the mwdg2 solver results in 2 3 to 140 times faster simulations than the uniform dg2 solver on the finest grid in contrast the adaptive hfv1 solver could only be faster than the uniform fv1 solver on the finest grid for ε 10 4 most likely due to dominance of the wavelet adaptivity overhead section 3 1 5 on the finest uniform grid the dg2 solver is found to be around 8 times more expensive than the fv1 solver although the mwdg2 solver with ε 10 3 exhibits better performance than the fv1 solver these tests indicate that an error threshold of ε 10 3 is an optimal choice for the adaptive mwdg2 solver to preserve the accuracy of the uniform dg2 solver without exceeding the runtime of the uniform fv1 solver this choice is also suitable for the adaptive hfv1 solver to deliver simulations that are as accurate as the uniform fv1 solver but computationally more efficient unless stated otherwise in the remainder of section 3 ε 10 3 is adopted as a default choice for the error threshold value 3 1 2 adaptive solution predictability of relevant flow features t 2 5 s the second series of tests compares adaptive solutions of water height and discharge and mainly examines the grid prediction ability relevant to the hfv1 and mwdg2 solvers the adaptive solutions are analysed at t 2 5 s when both shock and rarefaction waves still exist the adaptive solutions are illustrated in fig 2 which shows a good agreement with the analytical solutions the hfv1 predictions fig 2a c show more pronounced numerical diffusion than the mwdg2 predictions which is in fact expected given the first order nature of the hfv1 scheme in terms of resolution predictability as shown in fig 2b both hfv1 and mwdg2 correctly predict the finest resolution around the shock i e refinement level 9 further showing ability to allow large gaps in resolution levels without failing in regions of uniform flow at the constant state and downstream of the shock the hfv1 and mwdg2 solutions predicted the coarsest resolutions at refinement level 5 and 4 respectively it is not surprising that mwdg2 yields coarser refinement levels than hfv1 as the former always have smaller errors than the latter for ε 10 3 section 3 1 1 nonetheless both hfv1 and mwdg2 solvers seem able to sensibly select suitable refinement levels for their adaptive solution in the locality of a shock and throughout the constant state fig 2 for 20 x 50 however in prediction of the rarefaction wave mwdg2 presents a remarkable behaviour as compared to hfv1 there the mwdg2 solution uses refinement level 8 around the rarefaction s head and tail preserves level 7 in between them and allows a sharp drop to level 5 downstream of the head also the mwdg2 solution does not even access the maximum refinement level 9 as opposed to the hfv1 solution that deploys it to indistinguishably compute the extent of the rarefaction these results suggest that the wavelet adaptivity combined with the mwdg2 solver can produce an adaptive solution that is more accurate and economical on grid resolution demands 3 1 3 size of coarse baseline grid vs maximum refinement level this third series of runs aims to analyse the trade off between coarseness of the initial grid versus depth in maximum refinement level a known adverse effect of conventional adaptive mesh refinement methods is the need of an initial coarse mesh that is yet fine enough for the flow solver to sense the triggering features of the initial flow conditions donat et al 2014 haleem et al 2015 among many other adverse effects zhou et al 2013 kesserwani and liang 2015 liang et al 2015 li 2010 an and yu 2014 delis et al 2011 wavelet based adaptivity can overcome this drawback permitting the initialisation of simulations from a very coarse initial mesh as small as two elements caviedes voullième and kesserwani 2015 or even a single element sections 3 1 1 3 1 2 to study this characteristic for the adaptive hfv1 and mwdg2 solutions they are here reconsidered with different settings based on doubling the baseline grid size in conjunction with systematic lowering of the maximum refinement level but on the basis of fixing the maximum allowed number of sub elements to 512 the parameters m l are varied as m l 1 9 2 8 4 7 8 6 16 5 32 4 64 3 128 2 256 1 and runs are made with ε 10 3 as in sections 3 1 1 the accuracy of the adaptive solvers is evaluated at t 2 5 s according to eq 57 and their computational efficiency is assessed based on the cpu runtime taken to complete a 40 s simulation in terms of accuracy the same qualitative predictions are noted for hfv1 and mwdg2 solvers respectively under the different setting for m l each of the solvers show identical depth and discharge predictions which are quite similar to those illustrated in fig 2a c and for this reason not presented here they also yield the same number and size for the sub element forming their assembled solutions consistent with the profile shown in fig 2b this observation is also reinforced by the fact that the same normalised ℓ2 error magnitude plotted in fig 1 for ε 10 3 is retrieved for all the settings as for the runtime efficiency it is found to be different for each solver under the different settings fig 3 shows the cpu time cost for each solver relative to each setting m l as the number of mother elements exceeds 32 fig 3 the adaptive solvers experience an increase in cpu times as expected in fact by t 10 s the flow domain contains very smooth profiles for which the adaptive solvers can at best select an adaptive grid at the coarsest resolution allowable with m elements prior to completing the 40 s simulation section 3 1 4 in particular the runtime of mwdg2 becomes significantly more costly with increasing number of mother elements to an extent that the underlying dg2 operational costs are overwhelming fig 3 for m 128 however as long as the baseline grids do not exceed 32 mother elements the adaptive hfv1 and mwdg2 solvers required similar runtime costs these findings indicate that the accuracy of the adaptive solvers is not affected by severe coarsening in the baseline grid but such an action is necessary to fully exploit wavelet adaptivity traits to boost efficiency in particular with mwdg2 3 1 4 coarsening ability and time step size over long time evolution the fourth series of runs investigates the dynamic behaviour of the adaptive solutions as the transient dam break evolves and dissipates in the open computational domain during the 40 s simulation the standard setting is used to re run the hfv1 mwdg2 solvers together with the default error threshold while inspecting their coarsening ability and the size of their time step as time evolved fig 4 shows the time history for the number of sub elements and of the time step size during the presence of the rarefaction wave in the domain t 10 s fig 4a reveals that the hfv1 solver requires 3 times more sub elements than the mwdg2 solver in line with the results in section 3 1 2 see fig 2 fig 4a shows that hfv1 with its piecewise constant basis involved a maximum of 233 sub elements to represent the sloping rarefaction wave whereas mwdg2 with its piecewise linear basis uses just 83 sub elements for representing the same rarefaction wave and does that more accurately than hfv1 beyond t 10 s the maximum number of sub elements with mwdg2 shows much faster decrease than with hfv1 and reaches the single mother element about 10 s earlier see zoom in portion in fig 4a this behaviour is expected with both solvers as by t 10 s the waves exited the domain and only small solution perturbations remain relatedly the time histories of the adaptive time step size are illustrated in fig 4b showing predominantly larger time steps with mwdg2 than with hfv1 the first noticeable increase in time step size for the mwdg2 solver is achieved by t 3 5 s when the shock wave exits the domain more increase in time step size is seen by t 10 s when both waves have exited the domain this increase becomes more significant from t 23 s when mwdg2 uses less than four sub elements from t 27 s the mwdg2 solver uses a time step around δt 1 5 s which is roughly twice the time step used by hfv1 over this period this analysis supports the findings highlighted at the end of section 3 1 2 suggesting that the mwdg2 solver is more accurate and less cpu intensive for simulations over large spatial domains and long time scales 3 1 5 computational overhead due to wavelet adaptivity the final series of tests examines the computational overhead associated with wavelet adaptivity in the hfv1 and mwdg2 solutions wavelet adaptivity reduces the number of sub elements producing coarser solutions that allow longer time steps section 3 1 4 fewer sub elements and bigger time steps reduce the overall computational cost sections 3 1 1 and 3 1 4 but the compression and assembly mechanisms via transformations 48 and 49 as detailed in section 2 3 involved in the adaptivity calculations introduce some computational overhead that may dominate the overall computational cost fig 1b to identify the extent of this overhead the computational trade off between the adaptive calculations and the uniform ones is analysed considering their cumulative cpu runtimes respectively throughout the 40 s simulations fig 5 the adaptive and uniform solvers are run based on the standard setting in fig 5a the evolution of the cumulative runtimes generated by the fv1 and hfv1 are compared for the first 15 s the adaptive hfv1 solver is found to be slower than the uniform fv1 solver due to the computational overhead associated with wavelet adaptivity later after the shock and rarefaction waves exit the domain the adaptive hfv1 solution is coarsened aggressively fig 4 and the associated gain in computational efficiency is seen to outweigh the adaptivity overhead nonetheless the entire 40 s long hfv1 simulation is noted to complete in less than half the cpu time of the uniform fv1 simulation on the finest grid this indicates that adaptive hfv1 modelling is more practical when simulating flows with smooth profiles with the adaptive mwdg2 solver as shown in fig 2b the computational overhead due to wavelet adaptivity remains insignificant relative to the uniform dg2 simulation also this overhead is found to be lower than the wavelet adaptivity overhead experienced in the hfv1 simulation compare the zoom in portions in fig 5a and fig 5b at least for t 15 s when the rarefaction did not leave the domain most strikingly the adaptive mwdg2 solver is found to complete the 40 s simulation almost as quickly as the adaptive hfv1 solver in summary when simulating a dam break flow with a shock occurring on a wet domain the adaptive hfv1 mwdg2 solvers with ε 10 3 preserve the numerical accuracy of their corresponding uniform fv1 dg2 solvers hfv1 mwdg2 are most effective on very coarse baseline grids down to a single mother element once the waves have left the domain both solvers are able to represent the spatially uniform solution with just one element hfv1 is about twice as fast as fv1 and mwdg2 is about 20 times faster than dg2 with mwdg2 achieving greater accuracy than hfv1 at the same speed 3 2 dam break flow on a dry domain without shock as shown in section 3 1 wavelet adaptivity can easily refine the solution in the locality of a shock wave because wavelets act as a kind of jump detector vuik and ryan 2014 however a dam break wave usually happens over a dry domain without experiencing shock formation when topographic effects are neglected in this case a wetting front propagation occurs downstream when friction effects are also neglected the wave front shape is smooth including a wet dry front that should be modelled with enough resolution to properly track arrival time friction retards the arrival of the wet dry front and steepens the wave front which must also be captured with fine resolution to represent the wave tip in this test some key properties of the adaptive hfv1 and mwdg2 solvers are re explored when simulating dam break flows over a dry and flat bed considering frictionless and frictional cases for which analytical or semi analytical solutions exist delestre et al 2013 3 2 1 frictionless case the test configuration is the same as the dam break on a wet domain section 3 1 1 except for the initial water height h which is given by 58 h x 0 6 i f x 25 0 i f x 25 the adaptive hfv1 mwdg2 solutions are considered with the standard setting tests are run for t 1 3 s and normalised ℓ2 errors are calculated using eq 57 by differencing numerical solutions with the analytical solution for the same range of choices for the error threshold between ε 10 6 and ε 10 1 fig 6 illustrates the respective normalised ℓ2 errors for the hfv1 mwdg2 solvers fig 6 also includes the ℓ2 errors of the fv1 dg2 solvers on two uniform grids with 27 128 elements and 29 512 elements showing lesser magnitudes with dg2 as expected for all the error thresholds the hfv1 and mwdg2 solution remained more accurate than the corresponding uniform fv1 and dg2 solutions on the grid with 128 elements fig 6 the mwdg2 solver is always more accurate than fv1 as opposed to the previous test compare fig 6 with fig 1a with ε 10 2 the hfv1 and mwdg2 solutions become almost as accurate as their corresponding uniform solutions on the finest grid although they are somewhat less accurate this behaviour is not observed in the previous test compare fig 6 with fig 1a where the ℓ2 errors of the hfv1 mwdg2 solvers overlap with the ℓ2 errors of the uniform fv1 dg2 solvers on the finest grid possibly in this test the water height and flow profiles are largely curved which is the case where the fv1 dg2 solvers benefit more from an increase in the resolution of the uniform grid also the flow states in the previous test remain unchanged over a significant portion in the domain fig 2 which causes less loss of relevant information within the hfv1 mwdg2 solvers during de compression due to propagation of round off errors in eqs 48 49 here dg2 and mwdg2 achieved lower ℓ2 errors than in the previous test most likely owing to the double localisation process that switched off the slope limiter given the shockless nature of this dam break flow the results in fig 6 indicate that ε 10 3 and ε 10 2 seem to be good choices to maximise the efficiency for hfv1 mwdg2 runs and deliver comparable accuracy to the uniform fv1 dg2 runs on the finest grid a qualitative analysis of the adaptive hfv1 and mwdg2 solutions at t 1 3 s is presented in fig 7 a and 7b which includes a comparison between the water height profiles predicted by hfv1 and mwdg2 for the aforementioned error thresholds and the analytical solution hfv1 and mwdg2 predictions are noted to be in good agreement with the analytical solution however the hfv1 solution is seen to experience numerical diffusion at the wet dry front and at the tail of the wave slightly overestimating the region upstream of the initial dam position and underestimating the position of the wave front see magnified portions within fig 7a and 7b these effects do not seem to improve when lowering the error threshold from ε 10 2 to ε 10 3 and are not visible in the mwdg2 solution which provides better overall alignment with analytical solution as expected from a second order accurate numerical model in terms of resolution demand as illustrated in fig 7c and 7d mwdg2 allows coarser refinement levels than hfv1 and chooses more sensibly where to use the finest levels with ε 10 2 and ε 10 3 the hfv1 solution involved the two finest refinement levels namely still accessing levels 8 and 9 to represent the full extent of the sloping water surface fig 7c and 7d the mwdg2 solution does not exceed levels 7 to represent this zone except where it should namely at the kink and wet dry front notably with ε 10 2 mwdg2 uses level 6 and below along the smoothing wave level 7 at the kink but without accessing any higher refinement levels despite being available considering also that mwdg2 predictions are nearly similar at ε 10 2 and ε 10 3 see fig 6b and compare fig 7a vs 7b lowering ε can reduce model accessibility to the finest refinement levels as desired for some simulations that do not demand high resolution while keeping these finest levels re accessible as needed for other simulations see also section 3 7 3 2 2 frictional case for the frictional dam break case the configuration is identical except that the manning coefficient nm 0 016 m1 3 s 1 which is selected by calibration to fit the semi analytical solution available in terms of the chézy factor delestre et al 2013 adaptive hfv1 and mwdg2 solutions are produced for the same error thresholds ε 10 3 and ε 10 2 which are illustrated in fig 8 a and 8b respectively together with the semi analytical solution at t 1 3 s outside of the wave tip region upstream of the wet dry front hfv1 mwdg2 solutions perform very similarly to those in the corresponding frictionless test section 3 2 1 at the wave tip region the semi analytical solution is actually based on interpolation assuming a parabola delestre et al 2013 as such no exact comparisons can be made therein nevertheless hfv1 mwdg2 solutions are found to agree well with the semi analytical solution in the wave tip region with mwdg2 producing a steeper wave front profile fig 8c and 8d illustrate the corresponding refinement levels used by the adaptive solvers with ε 10 3 and ε 10 2 respectively the adaptive hfv1 mwdg2 solutions show almost the same behaviour for the refinement levels as the frictionless case compare fig 7c and 7d with fig 8c and 8d respectively however at the wet dry front mwdg2 retains the maximum refinement level even with ε 10 2 due to the steeper wave front induced by friction the frictional and frictionless dam break tests demonstrate further the ability of the adaptive hfv1 and mwdg2 solvers to simulate the propagation of dynamic waves over a dry domain mwdg2 alleviates the numerical diffusion errors expected in the fv1 or hfv1 solutions with much lower refinement levels with an error threshold of ε 10 2 mwdg2 does not need to access the maximum refinement level apart at the wet dry front when the wave front is steepened by friction this suggests that the error threshold can be further relied on to reduce model access to the finest resolutions available as relevant for certain simulations even when they are set to perform at very high resolution 3 3 dam break flow descending and ascending sloping and dry beds in this test the performance of the adaptive hfv1 mwdg2 solvers is further examined for dam break flows featuring a wet dry front that accelerates or decelerates as it descends or ascends a sloping bed a dam break wave upsloping is initially used in xing et al 2010 a more challenging variant is considered here as proposed in kesserwani and liang 2012 including a case where the wave downslopes the initial dam is assumed centred at x 0 m in a 15 m 15 m domain upstream of the dam x 0 the initial water elevation h z is equal to 8 m and the water height is assumed to be zero downstream of the dam x 0 a wall is assumed to exist at the upstream end x 15 m which can be accounted for by reflective boundary conditions free outflow is assumed at the downstream end x 15 m by transmissive boundary conditions the topography is linear with a slope angle α namely 59 z x 1 x t a n α two cases are considered with α values in eq 59 first a dam break ascending with α π 6 and second a dam break descending with α π 6 the upslope dam break is simulated for t 1 s whereas the downslope dam break is simulated for t 0 75 s both cases are assumed frictionless simulations are performed using the standard setting with the uniform fv1 and dg2 solvers on a grid with 512 elements and with the adaptive hfv1 and mwdg2 solvers taken with the default error threshold m 1 l 9 and ε 10 3 in fig 9 a and 9b the water depth predictions made by the adaptive hfv1 mwdg2 and uniform fv1 mwdg2 solvers are illustrated showing comparable profiles that also match existing results kesserwani and liang 2012 the difference between the predictions is more noticeable for the discharge profiles as shown in fig 9e and 9f compared to mwdg2 dg2 fv1 hfv1 predictions exhibit numerical diffusion at the start of the wave as expected given the difference in the accuracy orders between the corresponding numerical formulations despite this these discrepancies are more prominent for the upslope dam break case see x 11 m in fig 9e vs at x 6 m in fig 9f suggesting that the second order variants provide better predictions with increased level of vigour in the wave propagation at the wave front the discrepancies become more noticeable in both the upslope and downslope dam break cases see x 10 m in fig 9e vs at x 12 m in fig 9f therein informed further by the results in fig 7a mwdg2 dg2 are expected to more accurately follow the evolution of the wet dry front as they both deploy piecewise linear solutions to integrate topography and wetting and drying as opposed to hfv1 fv1 that use piecewise constant solutions in terms of refinement level predictions which are illustrated in fig 9c and 9d the hfv1 solution only used the maximum level 9 hence yielding identical results to those delivered by the fv1 solution in both upslope and downslope dam break case this over prediction is associated with the use of a piecewise constant basis in hfv1 that yields a staircase pattern for the linear topography approximation making the solver trigger the maximum refinement level at ε 10 3 note that the proposed wavelet adaptivity formulations indistinguishably use the details of the flow and topography variables to generate the adaptive solution in contrast the mwdg2 solver in both cases predicted refinement level 8 to track the start of the wave and levels 6 and 7 thereafter upstream of the wave front for the upslope dam break case mwdg2 does not access the maximum refinement level 9 at the wave front but uses refinement level 8 instead this is in contrast with the downslope case where level 9 is retained therein and level 4 is selected before upstream of the depression wave such differences in refinement level predictions are expected given the different flow physics involved in the upslope and downslope dam break cases namely the wet dry front advance is slower in the former case whereas wave recession at the start is delayed in the latter case the propagation of the wet dry front in the numerical simulations can be compared to the analytical position of the wet dry front xf t given by 60 x f t 2 t 8 g cos α 1 2 g t 2 tan α the numerical position of the wet dry front is calculated based on the first sub element at which the water height is bigger than 10 2 m scanning sub elements from left to right fig 10 a and 10b show the time evolution of wet dry front positions for the upslope and downslope dam break cases respectively as seen in fig 10 fv1 calculates a slower front advance consistently under predicting the analytical solution by the end of the simulations fv1 and identically hfv1 positions the front about 2 m and 1 m below the true position for the upslope and downslope dam break cases respectively the dg2 solver tracks the upslope and downslope wet dry fronts more accurately than the fv1 solver however showing an over predictive tendency the adaptive mwdg2 solver is seen to preserve the accurate solution of the underlying dg2 solver the frontal evolution obtained with the dg2 and adaptive mwdg2 solvers compares favourably with results using the rkdg2 lft solver presented in kesserwani and liang 2012 1 1 in their fig 4b the analytical front evolution plot for the downslope case is incorrect their numerical results are more closely aligned with the correct analytical front evolution presented here in fig 10b in summary the adaptive hfv1 solver is not found as effective as in the previous dam break tests on flat beds because of its piecewise constant basis that can yield over refinement when approximating a sloping topography profile the adaptive mwdg2 solver uses a piecewise linear basis that can exactly represent the sloping topography at any refinement level so the mwdg2 solver is able to coarsen more effectively than hfv1 while proving more accurate and economical 3 4 well balanced property and mesh generation ability this test examines the initial mesh generation ability of the adaptive solvers and their well balanced property in reproducing a lake at rest unlike the idealised sloping topography in the previous test real terrain is fractally multi scale non smooth and often discontinuous as in the presence of buildings preserving quiescent flow over an irregular topography is challenging for numerical shallow water models in particular at partially wet zones located at bed discontinuities kesserwani 2013 kesserwani et al 2018 to assess the full extent of well balancedness a lake at rest test has been proposed sharifian et al 2018 based on an idealised topography with smooth sloping and discontinuous regions see fig 12 the lake at rest is defined on 0 m 50 m with an initial water elevation h z 2 m such that three scenarios occur exactly dry at a peak h 0 m at the curved hump submerged portion h 0 m at the triangular hump and unsubmerged portion with two wet dry fronts h 0 m at the rectangular hump the adaptive and uniform solvers are applied to compute the lake at rest conditions with zero initial discharge q 0 m2 s 1 simulations are executed for a relatively long time evolution namely t 100 s corresponding to about 16 000 time steps considering two error thresholds ε 10 1 and ε 10 3 with the standard setting m 1 and l 9 a robust and well balanced solver should preserve the initial water state and the initial zero discharge unperturbed as time evolves fig 11 shows the discharges computed by the adaptive and uniform solvers all the numerical discharges are observed to be very close to machine precision fig 11 and the initial water elevation remains unchanged fig 12 for all the solvers throughout the simulation slightly larger discharge predictions are noted with mwdg2 at ε 10 3 than with mwdg2 at ε 10 1 fig 11b and with hfv1 fig 11a this behaviour is expected as the smaller the ε the more mwdg2 will access eqs 48 49 causing more knock on effects due to rounding of the irrational numbers involved in the filter banks nonetheless this increase in error is negligible even after very long time evolution fig 11b also shows two spikes in the discharge predictions occurring around the discontinuities of the rectangular hump for dg2 and mwdg2 at ε 10 3 these spikes however do not grow over the 100 s long simulation and their magnitude is noted to be smaller with grid coarsening e g compare with the mwdg2 predictions at ε 10 1 these results confirm that the adaptive hfv1 mwdg2 solvers are well balanced noting also that the negative water height below the rectangular hump remains unmodified with time evolution fig 12 the sharp edges of the rectangular hump effectively become internal boundaries which there is no need to manually recognise since the initial water elevation can intersect the topography without affecting the well balancedness of the solution this property seems therefore to be instrumental to deal with the presence of buildings during the mesh generation process since h z and q are unvarying in this test the assembled initial adaptive solution is solely selected driven by the topographic features the well balanced hfv1 mwdg2 solvers can therefore be used as mesh generators subject to choosing an error threshold the mesh generation ability of these solvers is particularly explored by further analysing their refinement level predictions fig 12a and 12b include the refinement levels predicted by the hfv1 and mwdg2 solvers respectively at the rectangular hump both hfv1 and mwdg2 solvers are seen to select the maximum level 9 at the sharp edges and to coarsen effectively in between them where the topography is smooth for this hump the smooth portion is flat and the sharp edged portions are strongly discontinuous the former portion is readily represented by coarse piecewise constant and piecewise linear data while the latter portion can easily be detected by both representations the choice of the error threshold seems to have little effect on representing this obstacle as very similar refinement levels are predicted therein by both hfv1 and mwdg2 solvers at ε 10 3 and at ε 10 1 the curved and triangular humps are less easily represented by the hfv1 piecewise constant basis at ε 10 3 hfv1 used the maximum refinement level 9 in these two regions fig 12a more effective coarsening at these two humps is noted by choosing ε 10 1 where hfv1 uses only refinement levels 8 or below mwdg2 coarsens the triangular hump much more sensibly than hfv1 at ε 10 3 it uses the maximum refinement level only at the kinks at the base of the triangle fig 12b and much coarser levels at the tip that is positioned exactly at the centre of the domain at the curved hump mwdg2 still predicts the maximum refinement level 9 even at ε 10 3 which could be signalling that more resolution is needed to cover curved terrain shapes with ε 10 1 the triangular and curved hump are relatively less resolved with mwdg2 than with hfv1 with mwdg2 predicting level 7 and below however taking ε 10 1 is likely to make the hfv1 or the mwdg2 solvers unable to preserve enough accuracy recall sections 3 1 1 and 3 2 1 with a maximum refinement level l 9 and an error threshold ε 10 3 mwdg2 used the maximum refinement level at the discontinuities of the rectangular hump and the kinks of the triangular hump as expected but also throughout the curved hump to explore whether the usage of level 9 throughout the curved hump is an over refinement or a requirement the mwdg2 solver is re run by increasing the maximum refinement level to l 14 under the same error threshold fig 13 shows the profile of the corresponding refinement levels remarkably now the mwdg2 solver only accesses the maximum refinement level 14 at the strong discontinuities of the rectangular hump at the kinks mwdg2 predicts level 12 for the triangular hump and level 13 for the curved hump that has steeper kinks moreover analysis of the mwdg2 solution provides information on the necessary refinement levels required to represent the smooth humps i e suggesting the need for level 6 and 10 to discretise the slope and curvature involved in the triangular and curved humps respectively these results imply that mwdg2 can effectively be used to initialise mesh resolution in a localised manner as needed this property could potentially be useful towards making more effective use of very high resolution lidar data without overloading the simulation and gives the user direct control over the extent of resolution deepness at which topography is represented within the model via choosing ε 3 5 convergence to well balanced steady states with non zero flows over a hump in this series of tests the adaptive hfv1 and mwdg2 solvers are given steady boundary conditions to study their convergence ability in reaching steady states with flows over a hump following delestre et al 2013 the one dimensional domain is 0 m 25 m with a topographic hump given by 61 z x 0 2 0 005 x 10 2 i f 8 m x 12 m 0 e l s e w h e r e tests are performed to assess the rate of convergence upon three steady flow regimes subcritical supercritical and transcritical with a stationary shock the initial and boundary conditions used in each tests are available in table 1 simulations are performed with the uniform fv1 and dg2 solvers and the adaptive hfv1 and mwdg2 solvers both taken with the standard setting and ε 10 3 a simulation is set to stop whenever the ℓ 2 difference in water height between the current and previous time steps becomes in the range of machine precision the time history of the ℓ 2 difference for all three tests are shown in fig 14 the fv1 dg2 hfv1 and mwdg2 solvers all converge to machine precision in the subcritical test fig 14a and supercritical test fig 14b for the subcritical test all solvers converge to machine precision within about 300 500 s with the hfv1 and mwdg2 solvers being slightly faster than their fv1 and dg2 counterparts fig 14a in the supercritical test the fv1 and dg2 solvers converge after about 10 s with the adaptive solvers converging slightly later fig 14b compared to the supercritical case converging to steady subcritical flow takes longer because the flow is relatively weak and adjustment towards balance is consequently slower the transcritical case involves a transition from subcritical to supercritical flow with another transition back to subcritical flow downstream of a stationary shock unsurprisingly convergence to this transcritical steady state is the slowest of all three cases fig 14c fv1 and dg2 solvers on a uniform mesh converge to machine precision after about 800 s and the adaptive hfv1 solver after about 450 s the adaptive mwdg2 solver does not converge beyond 10 4 with ε 10 3 this stagnation in ℓ 2 difference with mwdg2 at ε 10 3 is likely due to the intrusion of the slope limiter triggered by noise eventually accumulating from rounding of irrational numbers at the same location see also the related discussion in the next paragraph regardless when ε is reduced to 10 5 the mwdg2 solver converges to machine precision at a faster rate than the dg2 solver fig 14c overall convergence rates for all solvers are of the same order of magnitude for a given flow regime and all solvers are able to converge to machine precision the steady state solutions of water elevation and discharge are included in fig 15 for all three flow regimes the numerical solutions of water height are in close agreement all showing no visual difference with their corresponding analytical profiles delestre et al 2013 which were not illustrated for clarity as can be seen in fig 15g 15i anomalies in discharge predictions are apparent in the fv1 and hfv1 solutions these anomalies are usually expected to reduce with an improved fv based topography discretisation technique apart where a shock develops kesserwani 2013 haleem et al 2015 caleffi and valiani 2017 however all these types of anomaly do not appear when using dg2 and mwdg2 solvers compared to the dg2 uniform solver the mwdg2 solver presents some tiny anomalies in the discharge predictions these anomalies are different to those induced by the hfv1 and fv1 solvers and are comparatively negligible they are seen to occur at locations where there are gaps in refinement levels see also fig 15d 15f most likely these tiny anomalies are caused by constant de compression of the mwdg2 solution at the same location when the adaptive grid and solution become static in time this can eventually lead to low levels of noise due to accumulation of round off errors which can generate knock on effects such as triggering the slope limiter as discussed in the previous paragraph such tiny noises can be avoided by either increasing the convergence tolerance or lessening ε in fig 15 the corresponding refinement levels predicted by the adaptive hfv1 and mwdg2 solutions are shown for the subcritical case fig 15d supercritical case fig 15e and transcritical case fig 15f both solvers require higher refinement levels only in the locality of the hump with very few sub elements involving the maximum refinement level 9 corresponding with δx 9 0 049 m elsewhere the solution is coarsened aggressively down to refinement level 2 corresponding with δx 2 6 25 m using an adaptivity threshold of ε 10 3 the adaptive mwdg2 solver coarsens the solution more effectively than hfv1 in the locality of the hump for the transcritical solution to converge to machine precision mwdg2 required an adaptivity threshold ε 10 5 and with this choice mwdg2 behaves similarly to hfv1 using the maximum refinement level for the entire region of the hump fig 15f in summary with a suitable choice of adaptivity threshold all hfv1 and mwdg2 solvers converge to steady state solutions down to machine precision at about the same rate as the fv1 and dg2 solvers on a uniform mesh they are also found to be as well balanced as the underlying fv1 and dg2 uniform solvers adaptive hfv1 and mwdg2 solutions are coarsened down to refinement level 2 using elements that are 128 times coarser than the finest elements 3 6 conservation of integral properties for an oscillatory flow in a parabolic bowl to analyse conservation properties over a long time evolution the uniform and adaptive solvers are applied to simulate an oscillatory flow over topography as shown in lhomme et al 2010 excessive numerical diffusion in shallow water models acts to dissipate energy and damp oscillatory flows assuming a frictionless topography there are no sources or sinks of energy which makes this test suitable to challenge the ability of a shallow water model to conserve mass and energy in the presence of moving wet dry fronts as in delestre et al 2013 an initially sloping water elevation is contained in a parabolic bowl defined on a one dimensional domain in the interval 0 m 4 m given by 62 z x h 0 1 a 2 x 2 2 1 the exact solutions of the water height and the velocity are 63 h x t h 0 1 a x 2 b 2 g h 0 cos 2 g h 0 a t 2 1 i f x 1 t x x 2 t 0 m e l s e w h e r e 64 v x t b sin 2 g h 0 a t i f x 1 t x x 2 t 0 m s e l s e w h e r e where x 1 t and x 2 t are the locations of the wet dry interfaces at time t h 0 0 5 m and a 1 m delestre et al 2013 the initial water height and flow velocity conditions can be obtained from eqs 63 64 transmissive boundary conditions are imposed at both boundaries but the parabolic bowl restricts the water to the domain interior the uniform and adaptive solvers are applied considering the standard setting with the default error threshold 512 elements with the uniform solvers vs l 9 m 1 and ε 10 3 with the adaptive solvers tests are integrated for 36 11 s corresponding to 18 periods of oscillation the period to complete one oscillatory cycle is t 2 π a 2 g h 0 the solution of the parabolic bowl behaves like a pendulum with turning points occurring every half period 0t 0 5t 1t 1 5t when the flow velocity is zero at each period 0t 1t 2t the analytical water elevation is equal to the initial water elevation and at each intermediate period 0 5t 1 5t 2 5t the analytical water elevation is a mirror image of the initial water elevation 3 6 1 qualitative comparisons after 9 periods numerical solutions using the fv1 dg2 adaptive hfv1 and mwdg2 solvers are compared with the analytical solution in fig 16 the dg2 and mwdg2 solutions of water elevation closely agree with the analytical solution after 9 periods fig 16a and 9 5 periods fig 16b in contrast oscillations are damped by the first order accurate fv1 and hfv1 solvers and the water elevation after 9 periods no longer reaches the maximum initial water elevation for the velocity predictions the dg2 solver obtains calculations that are consistently close to the analytical solution of v 0 m s 1 after 9 periods fig 16e and 9 5 periods fig 16f the adaptive mwdg2 solver also achieves small flow velocities except around the wet dry fronts the fv1 and hfv1 solutions have flow velocity errors of about 0 4 m s 1 with larger error magnitudes in the locality of the wet dry fronts the refinement levels predicted by the adaptive hfv1 and mwdg2 solvers are presented corresponding to the solution after 9 periods fig 16c and 9 5 periods fig 16d the hfv1 solver uses the maximum refinement level 9 throughout the domain as expected given the curved shape of the parabolic topography recall the analysis in section 3 4 the adaptive mwdg2 solver uses the maximum refinement level just at the wet dry fronts and temporarily in some dry regions where small scale noise occurs in the solutions such noise can be reduced by slightly increasing the error threshold apart from these isolated regions mwdg2 uses only refinement level 7 resulting in almost four times fewer elements than the uniform solvers with 512 elements 3 6 2 mass conservation and energy conservation the frictionless parabolic bowl is a closed system with no sources or sinks of mass or energy as the water oscillates within the bowl there is an exchange between kinetic and potential energy but the total energy is conserved the time evolution of total mass and total energy is measured in order to assess the conservation properties of the numerical solvers only the average coefficients are used in both mass and energy calculations which were evaluated for the assembled solution on g i a that is the total mass produced by the adaptive solvers on g i a is calculated as 65 m e g i a h e 0 n δ x e n from eq 65 the mass difference δm is evaluated as δm t m t m 0 with m 0 m 0 being the initial mass at t 0 s the mass difference is normalised relative to the initial mass as 66 δ m t δ m t m 0 the total energy is calculated as the sum of kinetic and potential energy vreugdenhil 1994 67 e e g i a 1 2 h e 0 n v e 0 n 2 h e 0 n z e 0 n 2 z e 0 n 2 δ x e n which is normalised relative to the initial total energy e 0 e 0 such that 68 ê t e t e 0 for the uniform solvers eqs 65 68 are applied for their assembled solution on g i l instead of g i a the time histories of the normalised mass difference are illustrated in fig 17 a for the fv1 and dg2 solvers on a uniform mesh and the adaptive hfv1 and mwdg2 solvers the fv1 hfv1 and dg2 solvers conserve mass to machine precision fig 17a the hfv1 solver retains refinement level 9 yielding simulations on an equivalent grid as the fv1 solver but at a higher cost here hfv1 does not zero any detail coefficient and so gets unnecessarily overloaded with overhead cost due to haar wavelet adaptivity recall the analysis in section 3 1 5 unsurprisingly hfv1 delivers the same level of conservativeness as the uniform fv1 solver for both mass and energy quantities fig 17 the mwdg2 solver constantly altered refinement levels between 7 and 9 resulting in a loss of information due to zeroing of detail coefficients given also that the multi wavelet adaptivity of the mwdg2 solver must filter both average and slope coefficients via constant rounding of the irrational numbers involved in the filters these effects result in a very small linear growth in mass fig 17a nonetheless mwdg2 mass conservation errors are still close to machine precision even after 18 periods of oscillation the normalised total energy is also measured at each time step for the fv1 dg2 hfv1 and mwdg2 solvers fig 17b as expected for a first order solver fv1 and hfv1 dissipate energy quite rapidly losing about 13 of the initial energy after 18 periods of oscillation in contrast the dg2 solver on a uniform mesh achieves excellent energy conservation losing less than 1 of the initial energy after 18 periods despite the adaptive mwdg2 solver coarsening the solution to refinement level 7 it is only slightly more dissipative than the dg2 solver with mwdg2 losing less than 2 of the initial energy for such a dynamic oscillatory flow over a curved topography with wet dry fronts hfv1 with ε 10 3 delivers the same predictive accuracy as the uniform fv1 solver on the finest grid but is expected to be more costly to run section 3 1 5 employing hfv1 with bigger ε gives an under performance relative to the present accuracy of fv1 and so may not be a feasible option for this type of simulation the dg2 solver on the finest uniform grid shows excellent conservation properties for both mass and energy quantities the adaptive mwdg2 is likely to be more efficient than hfv1 for this type of simulation and preserves the conservation properties of the dg2 solver with inconsequential effects 3 7 numerical simulation of a laboratory dam break over a trapezoidal hump ozmen cagatay and kocaman 2011 conducted a laboratory flume experiment of a dam break flow over a trapezoidal hump this test involves a wet dry front advancing over a frictional topography wave overtopping on a building like hump and a topographically reflected shock wave in particular it is an ideal benchmark to validate the practicality of the hfv1 and mwdg2 solvers in modelling realistic aspects of shallow water flows in a multi scale setting and in relation to the increase in maximum refinement level the physical experiment ozmen cagatay and kocaman 2011 was conducted in an 8 9 m long acrylic glass flume with the configuration illustrated in fig 18 the topography and initial water elevation profile are the same for the numerical tests presented here with an initial zero discharge a reflective boundary condition is imposed at the upstream boundary and a transmissive boundary condition is imposed downstream the manning coefficient for acrylic glass is 0 01 m1 3 s 1 the water in the flume was photographed at regular time intervals and the water elevation profile was measured to an accuracy of about 1 mm experimental measurements of water elevation are compared with numerical solutions at time t 11 9 t 23 05 and t 41 84 where t is a nondimensionalised time t g h 0 t with h 0 0 25 m denoting the initial height behind the gate located at x 0 4 65 m numerical solutions are obtained using the fv1 and dg2 solvers on a uniform mesh with 2 l elements and adaptive hfv1 and mwdg2 solvers on a baseline grid with a single mother element a maximum refinement level l and with the default error threshold ε 10 3 tests are performed with l 7 9 and 11 corresponding to a finest grid spacing of δx 7 0 070 m δx 9 0 017 m and δx 11 0 0043 m or respectively to 128 512 and 2048 elements for the finest uniform grid as shown in fig 19 a 19c at l 9 the adaptive and uniform solutions closely agree with the experimental observations at t 11 9 t 23 05 and t 41 84 since the topography and fine scale flows are well resolved at δx 9 0 017 m while a similar behaviour for the adaptive and uniform solutions is expected at l 11 as δx 11 δx 9 with l 7 the topography and fine scale flow cannot be sufficiently resolved by the fv1 and hfv1 solvers using a piecewise constant basis fig 19d and 19e at t 11 9 fv1 and hfv1 simulations produce insufficient overtopping on the lee side of the obstacle fig 19d and at t 11 9 and t 23 05 fig 19e the reflected wave is positioned far upstream compared to the experimental observations numerical diffusion is particularly evident in the fv1 and hfv1 solutions at t 23 05 which is not present in the same solutions on the finer mesh using l 9 in contrast since the dg2 and mwdg2 solvers use a piecewise linear basis the fine scale features are still well resolved even at l 7 with δx 7 0 070 m using the same test kesserwani and wang 2014 achieved accurate dg2 solutions using a significantly coarser mesh of δx 0 22 m and obtained second order muscl fv solutions with errors similar to those obtained with the fv1 and hfv1 solvers in terms of refinement level predictions both adaptive hfv1 and mwdg2 solvers are observed to fully refine around the trapezoidal obstacle given the sloping character of its sides and the dynamic nature of the flow to realistically analyse efficiency benefits of the adaptive solvers their cumulative cpu time costs are further recorded for completing 30 s numerical simulations corresponding to t 188 s the elapsed cpu time is measured at every time step and these time series are illustrated for l 7 fig 20 upper part l 9 fig 20 middle part and l 11 fig 20 lower part at l 7 with δx 7 0 070 m the fv1 and adaptive hfv1 solvers complete the simulation the fastest fig 20 upper part but produce somewhat inaccurate solutions since the grid is relatively coarse fig 19 lower parts accurate solutions are achieved using the dg2 and mwdg2 solvers but the adaptive mwdg2 solver completes the simulation in about half the time of dg2 on a grid with 27 128 uniform elements at l 9 with δx 9 0 017 m the hfv1 and mwdg2 solvers complete the simulation around the same time fig 20 middle part the dg2 solver is about five times more computationally expensive and completes the simulation after 10 3 s of cpu time at this grid resolution the fv1 solver remains the most computationally efficient choice and produces a solution with similar accuracy to the other solvers fig 19 upper parts at l 11 with δx 11 0 0043 m no improvement in solution accuracy is expected since the flow in the 8 9 m long flume is already well resolved with coarser meshes however at l 11 the adaptive mwdg2 solver is surprisingly the first to finish the simulation followed by the fv1 and adaptive hfv1 solvers fig 20 lower part and compared to the dg2 solver on a uniform mesh the mwdg2 solver is 27 times faster clearly with increased maximum refinement level mwdg2 tends to become faster than the uniform fv1 solver on the finest grid and ultimately than the hfv1 solver in terms of resolution accuracy taking l 11 is unnecessary for this test as l 9 provide sufficient resolution but does still pay off with an increase in mwdg2 solver s efficiency given also that mwdg2 provides superior accuracy with l 7 i e up to a resolution of 0 070 m the mwdg2 solver could be even more beneficial in favour of accuracy when the finest resolution involved in the adaptive grid is roughly 0 1 m hence the mwdg2 solver seems to be a promising alternative for simulations over a large domain 10 km and more in horizontal length scale allowing multi scale features that are as small as 0 1 m nonetheless at a lower runtime cost than the uniform fv1 solver on the finest grid available and at nearly the same accuracy as the expensive uniform dg2 solver on the finest grid 4 summary and conclusions a scaled second order discontinuous galerkin dg2 solver of the shallow water equations swe was presented section 2 1 with guiding principles on how it extends to incorporate multiresolution analysis section 2 2 based on multiwavelets mw to form the so called adaptive mwdg2 solver section 2 3 our aim has been to explain this framework in a way that is understandable by water engineers and modellers and to unravel its relevant benefits for improving the accuracy efficiency and autonomy of godunov type hydrodynamic models in the adaptive mwdg2 solver flow and topography data at various resolution levels are compressed in a single dataset of details or wavelet coefficients section 2 3 1 from these details a multiresolution dg2 solution can be created and assembled on a non uniform grid by retaining the significant details and adding them to the coarsest solution discretisation significant details were identified by comparing their magnitude to an error threshold ε section 2 3 2 the scaled dg2 solver can directly be applied to evolve the multiresolution dg2 solution on an adaptive non uniform grid section 2 3 3 zero valued detail coefficients were imposed to complete the dataset of details as time evolved section 2 3 4 a first order version was produced based on the haar wavelet within the finite volume hfv1 method section 2 4 the behaviour of the adaptive hfv1 and mwdg2 solvers was studied systematically and compared against the standard first order finite volume fv1 and second order discontinuous galerkin dg2 solvers on a uniform grid seven tests were used to diagnostically explore the performance of the adaptive multi wavelet based solvers which covered all the elementary aspects relevant to accurate efficient and robust hydraulic modelling section 3 adaptive solver simulations started from a coarsest grid discretisation with m mother elements with each allowing a maximum of 2 l sub elements a maximum refinement level l yielding m number of sub elements m 2 l the uniform solver simulations considered the grid at the finest resolution available with m 2 l elements the numerical results consistently reinforced the conclusion that the multi wavelet based solvers offer many attractive properties including the ability to i automate the formulation of an initial multiresolution mesh ii use very few or a single mother element s as a baseline grid iii allow large gaps across resolution levels iv preserve robustness accuracy and conservation properties of the standard uniform solvers and v adapt modelling resolution and data simply with reference to the user prescribed error threshold ε more strikingly findings from this study newly identify a range for the error threshold ε where the adaptive mwdg2 solver can deliver simulations that are not only as accurate as the uniform dg2 simulations but also faster than the simulations delivered by both the adaptive hfv1 solver and the uniform fv1 solver mainly mwdg2 outperformed hfv1 as a result of the sloping nature of its local piecewise linear solutions which allowed much more aggressive coarsening at the zones in the flow solution and topographic data involving different levels of smoothness at these zones the adaptive hfv1 solver consistently over refined up to becoming even more expensive than the uniform fv1 solver since hfv1 was dominated by a wavelet adaptivity overhead in contrast the adaptive mwdg2 solver more sensibly predicted coarser solutions and did not access the finest resolution level unless necessary around very steep solution gradients the efficiency of the adaptive mwdg2 solver was found to increase by increasing the maximum refinement level l though its predictive accuracy remained visually close to the first order solver predictions at a very fine resolution namely around δx l 0 07 m our results therefore offer new evidence that an mwdg2 modelling approach has the potential to increase the accuracy runtime efficiency and spatial coverage for hydraulic modelling applications for which the maximum refinement level is associated with an urban resolution grid approx around 0 1 m in horizontal length scale a robust two dimensional 2d extension of the mwdg2 approach on quadrilateral elements is under development and testing to enable a more realistic assessment of the true potential of multi wavelet based approaches for 2d hydraulic modelling applications acknowledgements the authors wish to thank dr matthias rauter norwegian geotechnical institute for providing the semi analytical solution of the 1d frictional dam break test case and mr xitong sun for his insightful discussions on the derivation of the high pass filters we also thank prof onno bokhove university of leeds for their helpful advice during the testing and validation of the adaptive wavelet based numerical solver this work is part of the seamless wave project software infrastructure formulti purpose flood modelling at various scales based on wavelets which is funded by the uk engineering and physical sciences research council epsrc grant ep r007349 1 for information about the seamless wave project visit https www seamlesswave com appendix 1 instructions for running the fv1 dg2 hfv1 and mwdg2 solvers compilation the seamless wave numerical solvers are implemented in fortran 2003 and can be compiled using a recent version of gfortran and cmake other fortran compilers have not been tested to compile the code from the root directory of the unzipped zenodo download mkdir build cd build cmake make j running the numerical solvers the fv1 dg2 hfv1 and mwdg2 solvers are all implemented in a single executable run simulation to display usage information about required and optional command line switches run simulation help all the test cases that appear in this article are preconfigured to run one of the test cases run simulation testcase maxrefinementlevel solver solver writer writer where testcase is one of dambreakwet section 3 1 dambreakdry frictionless dambreakmanning frictional section 3 2 dambreakupslope dambreakdownslope section 3 3 lakeatrest section 3 4 steadysubcritical steadysupercritical steadytranscriticalshock section 3 5 parabolicbowlswashes section 3 6 dambreakonehump section 3 7 to solve on a uniform mesh use maxrefinementlevel to create a mesh with 2l elements and choose solver to be either fv1 or dg2 to calculate an adaptive solution include the switch epsilon value with value being a double precision number between 0 and 1 when epsilon is specified adaptive refinement is allowed up to the given maxrefinementlevel solver is still either fv1 or dg2 for an adaptive solution the solver will write space delimited plain text data depending on the choice of writer the following writers output data corresponding to the end of the simulation cellcentresolution topography water depth discharge and refinement level data piecewisesolution as cellcentresolution but data is at the interface limits l2error calculate the ℓ2 error between numerical and analytic solutions the following writers output data at every timestep cpu elapsed cpu time timestep size of δt elementcount total element count convergence ℓ2 convergence in water depth energy domain integrals of mass and energy wetdryfront the position of the wet dry front sample sample data at a specified sample position additional optional switches are documented by using run simulation help 
625,this paper presents a scaled reformulation of a robust second order discontinuous galerkin dg2 solver for the shallow water equations swe with guiding principles on how it can be naturally extended to fit into the multiresolution analysis of multiwavelets mw multiresolution analysis applied to the flow and topography data enables the creation of an adaptive mwdg2 solution on a non uniform grid the multiresolution analysis also permits control of the adaptive model error by a single user prescribed parameter this results in an adaptive mwdg2 solver that can fully exploit the local de compression of piecewise linear modelled data and from which a first order finite volume version fv1 is directly obtainable based on the haar wavelet hfv1 for local de compression of piecewise constant modelled data the behaviour of the adaptive hfv1 and mwdg2 solvers is systematically studied on a number of well known hydraulic tests that cover all elementary aspects relevant to accurate efficient and robust modelling the adaptive solvers are run starting from a baseline mesh with a single element and their accuracy and efficiency are measured referring to standard fv1 and dg2 simulations on the uniform grid involving the finest resolution accessible by the adaptive solvers our findings reveal that the mwdg2 solver can achieve the same accuracy as the dg2 solver but with a greater efficiency than the fv1 solver due to the smoothness of its piecewise linear basis which enables more aggressive coarsening than with the piecewise constant basis in the hfv1 solver this suggests a great potential for the mwdg2 solver to efficiently handle the depth and breadth in resolution variability while also being a multiresolution mesh generator accompanying model software and simulation data are openly available online keywords adaptive multiresolution schemes scaled discontinuous galerkin and finite volume hydraulic models multi wavelet data de compression performance comparisons 1 introduction explicit godunov type finite volume schemes toro and garcia navarro 2007 have become standard in hydraulic models teng et al 2017 in essence the finite volume fv foundation uses a piecewise constant representation of flow variables over a local mesh element in a first order accurate framework fv1 piecewise constant data can be evolved element wise driven by spatial flux exchange through element boundaries while only needing data from adjacent neighbours to complete riemann flux calculations this locality in storage and evolution of piecewise constant data offers practical advantages such as suitability for parallelisation lacasta et al 2013 sanders et al 2010 and makes wetting and drying a lot easier to handle hou et al 2013 medeiros and hagen 2013 however the fv1 approach suffers from excessive numerical diffusion which can only be alleviated by using fine resolution meshes often leading to unacceptable computational costs and meshing inflexibilities over large spatial domains attempts to incorporate classical adaptive mesh refinement strategies within the fv1 approach are shown to cause adverse effects such as keeping a coarsest mesh resolution that is fine enough increasing model sensitivity to tuning many adaptivity parameters and impacting overall conservativeness zhou et al 2013 kesserwani and liang 2015 liang et al 2015 donat et al 2014 these adverse effects are not alleviated with higher order fv methods that involve non local interpolation of piecewise constant data li 2010 an and yu 2014 a numerical modelling strategy is still desired that can inherently automate and initialise mesh resolution and improve runtime efficiency within the fv1 approach the discontinuous galerkin dg method extends the foundation of the fv1 approach by shaping local piecewise polynomial solutions from a discrete element wise formulation of the conservative model equation s dg methods significantly reduce numerical diffusion even on very coarse meshes e g at a grid resolution exceeding 10 m2 and have excellent conservation properties minatti et al 2016 kesserwani 2013 kesserwani and wang 2014 bokhove 2005 compared to a fv counterpart the dg method has a much larger cost per mesh element in terms of data storage and computing time and such cost is proportional to the desired order of accuracy even with a simplified second order dg dg2 method for practical conveniences kesserwani et al 2018 runtime costs on uniform meshes are 7 15 times greater than with first and second order accurate fv alternatives kesserwani 2013 kesserwani and wang 2014 classical adaptive mesh refinement strategies with dg methods do not seem a practical way forward because they still suffer from many of the adverse effects reported for the fv1 method kesserwani and liang 2015 kesserwani and liang 2012 a sparse numerical modelling strategy which can make dg2 as efficient as fv1 is thus highly desired to increase accuracy and coverage in handling high resolution modelled data adaptive wavelet based schemes offer an attractive route to overcome many of the adverse effects observed in classical adaptive mesh refinement methods liang et al 2015 donat et al 2014 li 2010 an and yu 2014 kesserwani and liang 2012 liang and borthwick 2009 when applied to the reformulation of fv1 models these schemes introduce a multiresolution analysis to de compress piecewise constant modelled data mapped by the haar wavelet from within the local basis of the fv1 method harten 1995 cohen et al 2003 müller 2002 minbashian et al 2017 archibald et al 2011 wang et al 2016 we term this haar wavelet variant of fv1 the hfv1 method haleem et al 2015 were the first to propose an hfv1 approach for solving the shallow water equations swe with irregular topography and wet dry fronts demonstrating that hfv1 directly inherits the robustness properties of the underlying fv1 scheme however haleem et al 2015 did not fully leverage the local de compressibility property of wavelets instead their hfv1 approach retained some of the aforementioned adverse effects by still relying on an extrinsic gradient sensor alongside its extra user specified parameter and use of relatively fine initial meshes with very few resolution levels haleem et al 2015 more recently adaptive multiwavelet based schemes have been devised based on a multiresolution analysis implemented using multiwavelets mw within the local basis of dg methods hovhannisyan et al 2014 gerhard et al 2015 gerhard et al 2015 gerhard and müller 2014 adaptive mwdg schemes have also been proposed for the solution of the swe in the works of gerhard et al 2015 kesserwani et al 2015 caviedes voullième and kesserwani 2015 who have highlighted the ability of these approaches to achieve resolution refinement and coarsening driven by a single user prescribed parameter rigorously transfer and recover data between disparate resolution levels thereby allowing arbitrarily large resolution gaps and any degree of mesh coarsening and readily preserve accuracy conservation and robustness properties of the underlying dg scheme starting with a robust dg2 hydrodynamic model mw can be introduced subject to appropriate scaling of the dg2 local basis functions to form an mwdg2 scheme in which piecewise linear modelled data can be analysed scaled and assembled into an adaptive solution compared to the hfv1 adaptive solver which relies on piecewise constant modelled data mw allow greater compression rates however the strength of this property relating to standard fv1 and dg2 models is not yet identified from consistent mwdg2 and hfv1 schemes that fully exploit local multi wavelet compression of data this paper studies the behaviour of multi wavelets integrated within robust fv1 and dg2 solvers and identifies the extent of their benefits and limitations for hydraulic modelling in section 2 a practical implementation of an mwdg2 solver is presented that fully exploits local mw compression of data and in which an hfv1 solver is obtained by direct simplification from the mwdg2 formulation section 2 4 section 2 includes also the formulation of a scaled dg2 solver section 2 1 with guiding principles on how it readily fits into the multiresolution analysis of mw section 2 2 to form the so called adaptive mwdg2 scheme section 2 3 in section 3 the adaptive hfv1 and mwdg2 solvers are systematically tested and compared in the simulation of well known hydraulic tests that cover elementary aspects relevant to accurate efficient and robust hydraulic modelling the adaptive solvers are run starting from an initial mesh with a single element spanning the entire domain and the accuracy and efficiency of the adaptive solvers are quantified in relation to standard fv1 and dg2 simulations on the uniform grid involving the finest resolution accessible to the adaptive solvers in section 4 key findings and conclusions of this work are summarised numerical simulation data shaw and kesserwani 2018 and a fortran 2003 implementation of the hfv1 mwdg2 shallow flow models shaw et al 2018 are available to download from zenodo instructions for running the models and interpreting the data are provided in appendix 1 2 adaptive mwdg2 scheme this section outlines the implementation details of an mwdg2 solver for the conservative form of the standard swe with source terms over a 1d domain ω written as 1 t u x f u s u where t and x represent partial derivatives with respect to t and x u x t is the vector of the state variables at a location x and time t f u is the spatial flux vector and s u is a vector including bed and friction slope terms these vectors are given by 2 u h q f q q 2 h g h 2 2 and s 0 s b s f where g m s2 is gravity h m is the water height q hv m2 s is the flow discharge per unit width with v m s being the velocity and z x is the topography function in the bed slope source term sb gh x z the term sf cfv v represents the energy loss due to friction effects with c f g n m 2 h 1 3 in which nm is the manning s bed roughness coefficient 2 1 scaled dg2 formulation the 1d domain ω is divided into a set of m elements ii i 1 m by means of m 1 interface points x i 1 2 i 1 m 1 such that ii x i 1 2 x i 1 2 is a segment with ω i 1 m i i and i i i i 1 x i 1 2 an element ii has the centre x i 1 2 x i 1 2 x i 1 2 and size δx x i 1 2 x i 1 2 ii can be mapped into a reference element 1 1 by the following change of variable ξ x 2 x xi δx therefore ξ x such that x ξ xi ξ δx 2 can be used to position ii onto 1 1 2 1 1 finite element weak form by multiplying eq 1 by a test function ν x integrating by parts to remove x on the flux term and moving the flux terms to the rhs the following weak form can be obtained cockburn and shu 2001 3 ω t u x t ν x d x f u x t ν x ω ω f u x t x ν x d x ω s u x t ν x d x it is worth noting that in eq 3 the incorporation of appropriate local bases functions orthonormal compactly supported and discontinuous as choices for the test function ν x and for expanding an approximate solution u h hh qh t to u are key ingredients to designing an adaptive mwdg scheme hovhannisyan et al 2014 gerhard et al 2015 these choices are needed in order to i embed local resolution variability into the basis functions shaping the dg spatial operators via a dual basis ii expand a local dg approximate solution that is compatible with multi scale decomposition offered by mw via a primal basis and iii get the identity matrix as the only multiplier of the time derivative term t u in the lhs of eq 3 via deploying bi orthonormal primal and dual bases the key concepts relevant to these basis functions are introduced next as appropriate 2 1 2 choice of bi orthonormal bases the starting point is to consider the legendre basis of polynomials up to first order within the scope of designing a dg2 scheme cockburn and shu 2001 this basis is denoted by p p 0 p 1 t with p 0 ξ 1 and p 1 ξ ξ as such it is compactly supported on 1 1 inherently discontinuous at ξ 1 and orthogonal for the l 2 norm defined by the following inner product 4 f g ω f ξ g ξ d ξ the basis p is normalised for the l 2 norm to produce the l 2 orthonormal basis p p 0 p 1 t such that p k p k δ k k where δ kk 1 for k k and δ kk 0 otherwise the components of the orthonormal basis p are alpert et al 2002 5 p k ξ 2 k 1 2 p k ξ k 0 1 and ξ 1 1 from the orthonormal basis components p 0 and p 1 the local primal and dual bases can be defined over ii which are denoted as ϕ i φ i 0 x φ i 1 x t and ϕ i φ i 0 x φ i 1 x t with 6 φ i k x 2 p k ξ x k 0 1 and x i i 7 φ i k x φ i k x δ x k 0 1 and x i i each of the primal and the dual bases is compactly supported orthogonal and discontinuous at the interfaces x i 1 2 of the element ii these bases are bi orthonormal since the following relationship holds 8 φ i k φ i k δ i i δ k k 2 1 3 dg2 operators by choosing the test function ν x as the components of the dual basis φ i k x in eq 7 and exploiting their orthogonality and compact support properties the weak form in eq 3 becomes 9 x i 1 2 x i 1 2 t u φ i k x d x l i k u k 0 1 where l i k u are operators involving spatial evaluations of flux and source terms given by 10 l i k f u φ i k x x i 1 2 x i 1 2 x i 1 2 x i 1 2 f u x φ i k x d x x i 1 2 x i 1 2 s u φ i k x d x u is replaced by an approximate solution u h expressed in terms of the primal basis as 11 u h x t i i k 0 1 u i k t φ i k x u i 0 t 3 ξ x u i 1 t in which u i 0 t and u i 1 t are expansion coefficients or modes representing an average and a slope characterising the local linear approximation of u h over ii the initial state of the coefficients at the rhs of eq 11 u i k 0 is obtained by projecting a given initial condition u 0 x u x 0 onto the dual basis as follows 12 u i k 0 u 0 φ i k x i 1 2 x i 1 2 u 0 x φ i k x d x which once mapped into the reference element 1 1 for applying k 1 gauss legendre quadrature rules and then manipulated to involve interface evaluations kesserwani et al 2010 yield the following expressions for initialising the initial average and slope coefficients 13 u i 0 0 1 2 u 0 x i 1 2 u 0 x i 1 2 14 u i 1 0 1 2 3 u 0 x i 1 2 u 0 x i 1 2 now considering eqs 9 10 with u h instead of u and exploiting the bi orthonormality property via eq 8 the system of pdes is locally decoupled to solve for two independent odes over ii 15 t u i k t l i k u h k 0 1 the time derivative in eq 15 is solved using an explicit two stage runge kutta rk2 time stepping scheme e g as described in kesserwani et al 2010 which requires evaluation of the spatial dg2 operators l i k u h to evolve u i k t over ii over each rk2 stage for simplicity the local dg2 operators l i k u h is denoted hereafter by l i k which can be expressed as 16 l i k f u h x i 1 2 t φ i k x i 1 2 f u h x i 1 2 t φ i k x i 1 2 x i 1 2 x i 1 2 f u h x t x φ i k x d x x i 1 2 x i 1 2 s u h x t φ i k x d x adopting discontinuous basis functions allows u h to be discontinuous at the element interfaces x i 1 2 to incorporate both limits u h x i 1 2 t and u h x i 1 2 t in the flux evaluation therein a numerical flux function f is introduced as is usually done in godunov type finite volume methods toro and garcia navarro 2007 toro 2001 by further mapping l i k onto the reference element where k 1 gauss legendre quadrature rules can be applied to approximate volume integral terms of the flux and source terms and by considering only the bed slope source term s b 0 sb t eq 16 becomes 17 l i 0 1 δ x f i 1 2 f i 1 2 δ x s b u i 0 x z h 18 l i 1 3 δ x f i 1 2 f i 1 2 f u i 0 u i 1 f u i 0 u i 1 δ x 2 3 s b u i 0 u i 1 x z h s b u i 0 u i 1 x z h in eq 18 f i 1 2 f u i 1 2 u i 1 2 represents a flux evaluation at x i 1 2 via a two argument numerical flux function f based on the harten lax and van leer approximate riemann solver toro 2001 u i 1 2 u h x i 1 2 t i i and u i 1 2 u h x i 1 2 t i i 1 denote the limits of u h at both sides from x i 1 2 which are known as riemann states at which wetting and drying considerations occur as outlined later in section 2 3 3 these limits can obtained from eq 11 as follows 19 u i 1 2 u i 0 t 3 u i 1 t and u i 1 2 u i 1 0 t 3 u i 1 1 t the bed slope discretisation in s b is performed by expanding zh locally over ii onto the primal basis consistently with the shaping of the local approximate solution eqs 11 14 20 z h x i i z i 0 3 ξ x z i 1 with z i 0 and z i 1 being time independent modes for the topography term approximation which can be initialised as in eqs 13 14 by 21 z i 0 1 2 z x i 1 2 z x i 1 2 22 z i 1 1 2 3 z x i 1 2 z x i 1 2 the discretisation is then completed by extracting an approximate partial derivative while mapping from the reference element 23 x z h i i 2 3 δ x z i 1 therefore the expressions of the bed slope source terms involved in eqs 17 and 18 become 24 s b u h x t x z h 2 3 δ x i 0 g h h x t z i 1 substituting eq 24 into eqs 17 and 18 the dg2 operators can be further simplified to 25 l i 0 1 δ x f i 1 2 f i 1 2 0 2 g 3 h i 0 z i 1 26 l i 1 3 δ x f i 1 2 f i 1 2 f u i 0 u i 1 f u i 0 u i 1 0 2 g h i 1 z i 1 2 1 4 extension to multiresolution bases from the same l 2 orthonormal basis p a series of child bases p n n can be defined given its property of being a refinable function alpert et al 2002 keinert 2004 alpert 1993 where n is a positive integer indicating the refinement level which will hereafter be used as a bracketed superscript to avoid notation confusion with other indexes these child bases arise from the father basis p 0 p and preserve its properties the supports of these child bases at any refinement level n can be associated with a grid g n based on n dyadic sub divisions of the support 1 1 of p hence g n spans 1 1 such that g n j 0 2 n 1 i j n where i j n j 0 1 2 n 1 is a set of non overlapping sub divisions of 1 1 moreover a sub division i j n can be regarded as a sub element of 1 1 taking the following form 27 i j n χ j 1 2 χ j 1 2 with χ j 1 2 1 2 2 n j are interface points forming sub elements i j n j 0 1 2 n 1 and the index j 0 1 2 n 1 representing the position of i j n in g n on which the components p j n of the basis p n p j n j can be obtained by translation and dilatation of p as follows 28 p j n χ 2 n p 2 n χ 1 2 j 1 χ i j n from the compact support and l 2 orthonormality properties of p n n the grids g n n form a hierarchy spanning 1 1 i e n g n 1 1 and are globally nested across all refinement levels while having local and non overlapping support at each level n similarly on a mesh element ii x i 1 2 x i 1 2 a hierarchy of nested grids g i n n can be defined such that g i n j 0 2 n 1 i j i n with i j i n j 0 1 2 n 1 now denoting sub divisions of ii with i j i n representing a sub element of ii at a position j relative to refinement level n namely 29 i j i n x j 1 2 i n x j 1 2 i n in eq 29 x j 1 2 i n x i 1 2 δ x n j are interface points forming sub elements i j i n j 0 1 2 n 1 and δx n δx 2 n is the grid spacing relative to grid g i n with positions j such that j 0 1 2 n 1 for convenience of presentation sub elements i j i n will hereafter be denoted by i e n where index e is shorthand for j i to position sub elements in ii thereby sub elements i e n can be linked to i j n by translation into 1 1 this also makes it easy to keep consistent with the notation associated with the dg2 method presented previously sections 2 1 1 2 1 3 for application at sub elements i e n which take the following form 30 i e n x e 1 2 n x e 1 2 n with x e n and δ x e n being the centre position and the size of a sub element i e n respectively on i e n g i n bi orthonormal dual and primal bases denoted by ϕ e and ϕ e can be defined via the refined bases p j n j by analogy recall eqs 6 7 and take the form 31 ϕ e n x 2 p j n χ x i e n i i 32 ϕ e n x ϕ e n x δ x n x i e n i i where χ x 2 x x e n δ x e n is a change of variable used to map the position x i e n into i j n adopting the local basis functions in eqs 31 32 and reworking the steps in section 2 1 3 yield similar dg2 operators for any sub element i e n g i n which are similar to eqs 25 26 but with index e instead of i and the grid spacing δx n of g i n instead of δx such dg2 operators can be applied to evolve dg2 modes u e 0 t and u e 1 t spanning local flow solutions u h x t i e n over any sub element i e n g i n n starting from initial flow modes as described in eqs 13 and 14 with index e instead of i similarly topography modes z e 0 and z e 1 on i e n can be initialised as in eqs 21 and 22 for use in the dg2 operators on i e n to ease the presentation in the following sections dg2 flow and topography modes u e 0 t u e 1 t z e 0 and z e 1 will be considered component wise and the scalar variable u h q z will be used to represent any physical quantities in u h q t and z since each u has dg2 modes which are actually its spectral components in terms of average and slope coefficients dg2 modes of any physical quantity u on sub elements i e n g i n n will be denoted as u e n u e 0 n u e 1 n 2 2 multiresolution analysis from the same l 2 orthonormal basis p child bases p n n and multiwavelet bases ψ n n can be defined this allows multiresolution analysis to be performed which is summarised in this section with a view to presenting how it is directly applicable to analysing the behaviour of the dg2 modes on multiresolution bases 2 2 1 relationship between the scaling bases p n n from the properties of the scaling bases p n n defined on the hierarchy of grids g n n it is possible to produce a recurrence relationship for binary merging of two adjacent components of the bases belonging to g n 1 to form the components of the bases in g n without loss of generality it suffices to outline the relationship linking an elementary father basis p j n and its child bases p 2 j n 1 p 2 j 1 n 1 in particular for the case between g 0 and g 1 where n j 0 this relationship between the scaling bases can be achieved by involving the so called low pass filter matrices h 0 and h 1 alpert et al 2002 alpert 1993 which allow p j n to be expressed as linear combination of p 2 j n 1 and p 2 j 1 n 1 33 p j n h 0 p 2 j n 1 h 1 p 2 j 1 n 1 34 h 0 p j n p 2 j n 1 1 2 0 6 4 2 4 35 h 1 p j n p 2 j 1 n 1 1 2 0 6 4 2 4 2 2 2 multiwavelet bases and their relationship to the scaling bases now reconsidering the father basis p a mother basis of wavelets ψ or multiwavelets alpert et al 2002 can be defined on g 0 1 1 which represents the encoded l 2 orthonormal difference between p p 0 0 and the components of its two child bases p 0 1 p 1 1 supported on g 1 1 0 0 1 in essence ψ represents the l 2 orthonormal complement of p 0 0 p in g 1 therefore ψ is one refinement level higher than p 0 0 and spans g 0 g 1 taking the form alpert et al 2002 36 ψ χ ψ 0 0 χ ψ 1 0 χ 37 ψ 0 0 χ 3 2 2 χ 1 χ i 0 1 3 2 2 χ 1 χ i 1 1 and ψ 1 0 χ 1 2 3 χ 2 χ i 0 1 1 2 3 χ 2 χ i 1 1 with i 0 1 1 0 and i 1 1 0 1 denoting the two shifts forming g 1 for generality relating to eq 27 note that ψ admits a discontinuity at χ 0 which offers an advantage for the analysis of signals with discontinuities moreover ψ and p are bi orthonormal with the former inheriting the properties of the latter hence a series of child multiwavelets ψ n n can be defined on the hierarchy of grids g n n by translation and dilatation of ψ such that on a grid g n j 0 2 n 1 i j n ψ n ψ j n j 0 1 2 n 1 where each ψ j n takes the following form 38 ψ j n χ 2 n ψ 2 n χ 1 2 j 1 χ i j n from the scaling bases binary merging of two adjacent components belonging to g n 1 can be achieved to produce the components of the multiwavelet bases in g n again it suffices to outline the relationship linking an elementary multiwavelet basis ψ j n in g n to the scaling bases p 2 j n 1 p 2 j 1 n 1 in g n 1 for n j 0 this relationship can be expressed by using the so called high pass filter matrices g 0 and g 1 which allow ψ j n to be derived as linear combination of p 2 j n 1 and p 2 j 1 n 1 39 ψ j n g 0 p 2 j n 1 g 1 p 2 j 1 n 1 40 g 0 ψ j n p 2 j n 1 0 1 2 2 4 6 4 41 g 1 ψ j n p 2 j 1 n 1 0 1 2 2 4 6 4 2 2 3 single scale vs multi scale expansions the definition of scaling and multiwavelet bases on the hierarchy of grids g n n allows for two interchangeable ways to approximate a given scalar signal s ξ defined on 1 1 given a grid g n j 0 2 n 1 i j n associated with the scaling bases p n p j n j 0 1 2 n 1 an approximation sh ξ of the signal s ξ can be obtained by expanding it onto the bases p n as follows alpert et al 2002 42 s h ξ j 0 2 n 1 s h χ i j n in which s h χ i j n is a piecewise linear expansions onto each basis p j n that is compactly supported on the sub element i j n the signal approximation can therefore be expressed as 43 s h i j n s j n p j n s j 0 n p j 0 n s j 1 n p j 1 n where s j n s j 0 n s j 1 n denotes local scale coefficients expanding s h χ i j n onto the basis p j n which can be initialised as s j k n s p j k n with k 0 1 this type of description i e in eqs 42 and 43 is called single scale expansion as it only involves scale coefficicents from the grid g n at a single scale refinement level n another way to expand sh ξ is to involve the multiwavelet bases by doing so the single scale description of in eqs 42 43 can be recursively decomposed to produce a so called multi scale expansion this form of description sums up the features of sh ξ via wavelet coefficients throughout grids g 0 g n 1 to its background information at its coarsest level i e the scale coefficients on g 0 hence the multi scale expansion takes the form alpert et al 2002 44 s h ξ s h ξ i 0 0 l 0 n 1 j 0 2 l 1 d j l χ ψ j l χ 45 d j l ψ j l d j 0 n ψ j 0 l d j 1 n ψ j 1 l with d j l d j 0 l d j 1 l denoting the local details also known as detail coefficients or wavelet coefficients they can be initialised as d j k l s ψ j k l with k 0 1 the multi scale expansion in eqs 44 and 45 clearly distinguishes the details of sh ξ between successively higher resolution which become increasingly significant with increasing levels of non smoothness in sh ξ while remaining negligible where sh ξ is smooth therefore it provides a mechanism to analyse decompose and reconstruct the approximate signal sh ξ across the grids in the hierarchy g n n 2 2 4 two scale transformations between coefficients from the link between the high and low pass filter matrices alpert et al 2002 outlined previously in eqs 34 35 and 40 41 relationships for scaling up or down recurrently relevant coefficients between subsequent resolution levels n and n 1 can be produced namely 46 s j n h 0 s 2 j n 1 h 1 s 2 j 1 n 1 d j n g 0 s 2 j n 1 g 1 s 2 j 1 n 1 47 s 2 j n 1 h 0 t s j n g 0 t d j n s 2 j 1 n 1 h 1 t s j n g 1 t d j n eq 46 is useful to encode or extract the scale and detail coefficients s j n and d j n at a sub element i j n g n from the scale coefficients s 2 j n 1 and s 2 j 1 n 1 of its two child sub elements i 2 j n 1 i 2 j 1 n 1 g n 1 it applies in a descending order across refinement levels starting from sub elements on the finest grid g l with l being a maximum refinement level prescribed by a user this results in a multi scale expansion as in eq 44 compressing the details across the whole hierarchy g n n 0 1 l eq 47 is used in the opposite sense to decode or combine scale and wavelet coefficients at any i j n n l 1 1 0 to generate their scale coefficients located one resolution higher i e the scale coefficients on the two sub elements i 2 j n 1 and i 2 j 1 n 1 given a multi scale expansion eq 47 can successively be applied in an ascending order starting from the information available at the coarsest grid g 0 to retrieve a single scale expansion as in eq 42 up to any refinement level n 0 n l 2 2 5 extension of the analysis for the dg2 modes on multiresolution bases to extend the validlity of the analysis in sections 2 2 1 2 2 4 from bases p n n spanning 1 1 to the multiresolution bases ϕ e n n spanning ii it suffices to consider eq 31 and the notation adopted in section 2 1 4 now eqs 42 45 can be reused for any physical component u with u h i i being its expansion on ii by coefficients u e n n e as in eq 42 each u e n contains the expansion coefficients of a local linear dg2 solution on sub elements i e n i i as in eq 43 or dg2 modes as u e n u e 0 n u e 1 n over a selected grid g i n e 0 2 n 1 i e n of the hierarchy of grids g i n n dg2 modes u e n e 0 1 2 n 1 can be initialised for the single scale expansion u h i i which actually represents an assembled dg2 solution on grid g i n alternatively a multi scale expansion is also possible as in eqs 44 and 45 which is actually a compressed mwdg2 solution allowing to access the details d e l l e with d e l d e 0 l d e 1 l living on lower resolution grids g i l l n 1 1 0 these details can be initialised from the dg2 modes on g i n for the physical components u h z q z as explained later in section 2 3 1 with this change of bases and variable the two scale transformation formulae in eqs 46 47 should be re scaled by 2 to make them relevant to the dg2 modes and their associated details leading to modified formulae 48 u e n 1 2 h 0 u 2 e n 1 h 1 u 2 e 1 n 1 d e n 1 2 g 0 u 2 e n 1 g 1 u 2 e 1 n 1 49 u 2 e n 1 2 h 0 t u e n g 0 t d e n u 2 e 1 n 1 2 h 1 t u e n g 1 t d e n as detailed later in section 2 3 eqs 48 49 can be directly deployed within the scaled dg2 method as needed to encode information via eq 48 i e binary merging of dg2 modes on g i n 1 to generate coarser modes and or their details on g i n or decode information via eq 49 i e adding up the details and modes on g i n to generate the dg2 modes on g i n 1 encoding is key to produce scan and distinguish the details across successive refinement levels from within the compressed mwdg2 solution whereas decoding is key to generate an assembled dg2 solution from a set of carefully selected dg2 modes relative to sub elements with non uniform size δx n 2 3 multiresolution scaled dg2 adaptive solution this section describes how multiresolution analysis section 2 2 can be used directly within the scaled dg2 formulation section 2 1 to produce the so called adaptive mwdg2 numerical solution the starting point is to set a desired maximum refinement level l and thereby refine the coarsest discretisation of the domain ω i 1 m i i to be at the finest uniform resolution allowable a uniform mesh with 2 l m sub elements now each element i i has 2 l sub elements i e l e 0 1 2 l 1 such that i i g i l e 1 2 l 1 i e l given that the combined mwdg2 functioning can be applied element wise we hereafter assume that the coarsest grid spanning ω is made by a single element hence we take m 1 without loss of generality now g i l represents the finest uniform discretisation for ω which is made of sub elements i e l e 0 1 2 l 1 on each sub element i e l dg2 modes u e l u e 0 l u e 1 l with u h q z can be initialised in terms of flow and topography data section 2 1 4 forming an assembled dg2 solution on the finest grid g i l for initial pre processing section 2 3 1 2 3 1 pre processing generation of initial detail coefficients t 0 s initially dg2 modes u e l e 0 1 2 l 1 of the flow and topography are only available on g i l from these modes details d e n n e living on the lower resolution grids g i n n l 1 1 0 can be encoded this is achieved by successive application of eq 48 in a descending order starting from refinement level l 1 until reaching the coarsest level 0 where both the coarsest modes u 0 0 and details d 0 0 become available moreover details representing the water height h were encoded based on the dg2 modes representing the free surface elevation h z which was found necessary to avoid producing misinformative details for h when the topography is very steep in what follows the details d e n n e will be actually associated with components u h z q z from the details d e n n e an alternative set of normalised detail magnitudes denoted by d ˇ e n n e can be generated this set is needed to enable measuring the significance of all detail coefficents combined regardless of which physical quantity u they represent namely a normalised detail magnitude d ˇ e n is a scalar evaluated from from its detail d e n as gerhard et al 2015 50 d ˇ e n m a x d e 0 n d e 1 n m a x 1 m a x u e 0 l e where m a x u e 0 l e is the maximum of the average coefficients of the dg2 modes on g i l also across the hierarchy g i n n l 1 0 due to variational boundness across refinement levels note that at the starting time all details d e n n e for all variables u h z q z are fully accessible on g i n n l 1 1 0 they can be ascendingly summed upon the coarsest dg2 modes u 0 0 on ii to form a compressed mwdg2 solution on g i n n l 1 0 which is as accurate as the assembled dg2 solution on g i l later when t 0 details d e n n e of the flow variables u h z q are subjected to constant change given the time dependent nature of h z and q section 2 3 4 while the details of z do not change with time 2 3 2 prediction regularisation and decoding adaptive solution generation t 0 s by analysing the magnitude of the normalised details in the hierarchy g i n n l 1 0 an adaptive grid at a present time t denoted by g i a t can be formed by selecting certain sub elements 51 g i a t i e n g i n n 0 n l 0 e 2 l 1 and ω n e i e n the act of measuring normalised detail magnitudes is here refered to as prediction and involves four subsequent steps for deciding the sub elements forming g i a t firstly an error threshold ε needs to be prescribed such that 0 ε 1 which is a parameter chosen by the user to decide which details can be ignored while there is no unique choice for ε an optimal range of choices exists to keep the accuracy of assembled dg2 solution on g i a t at the same level as the finest resolution accessible on g i l at time t via the compressed mwdg2 solution hovhannisyan et al 2014 an optimal choice for ε is expected to be somewhere between 10 4 and 10 2 arguably the choice of ε is rather heuristic context specific and seemigly dependent on the order of accuracy of the dg scheme harten 1995 cohen et al 2003 gerhard et al 2015 an analysis on the choice of ε for the adaptive hfv1 and mwdg2 solvers used in the present work is carried out later in section 3 1 1 secondly normalised details d ˇ e n n e living on g i n n l 1 1 0 are compared to ε for indentifying the significant details in doing so their magnitudes are scanned level wise in an ascending order n 0 1 l 1 and compared to level depedent error thresholds ε n such that ε n 2 n l ε within this process a detail d e n is classified as significant if 52 d ˇ e n ε n meanwhile sub elements i e n with significant details are flagged as active meaning they are plausible candidates for inclusion in g i a t thirdly re flagging of active sub elements i e n is needed for regularisation to ensure that significant details can be re accessed within a tree structure in fact across g i l 1 g i 1 and g i 0 whenever any child details d 2 e n or d 2 e 1 n is significant on g i n its parent detail d e n 1 on g i n 1 can only be significant and should be made accessible for possible use later in the generation of an assembled dg2 solution on g i a t thus regularisation is the act of ensuring that such sub elements i e n 1 are also flagged as active when many mother elements are used m 1 regularisation should also consider activating those sub elements located at the boundaries across the elements which is necessary to ensure that the modelling information can propagate across different elements fourthly all significant details d e n at a present time t are revisited to also predict whether their significance is likely to remain or increase at time t δt with δt denoting the simulation time step such a detail is here referred to as extra significant and can be identified by 53 d ˇ e n 2 m 1 ε n in eq 53 m is the order of accuracy of the prediction operator cohen et al 2003 which is chosen such that k m a x m k m a x 1 with kmax being the polynomial order of the dg solution in this work m is taken equal to 1 5 though it may be useful to note that any other choice within this range was found appropriate when a detail d e n is extra significant the set of active sub elements is enlarged to include in addition to i e n its child sub elements i 2 e n 1 and i 2 e 1 n 1 this step is necessary to ensure that no significant features in the adaptive flow solution u h z q on g i a t are overlooked on g i a t δ t when generating future details section 2 3 4 finally a dg2 solution on g i a t can be decided by ascendingly inspecting the tree of details starting from the coarsest details d 0 0 and dg2 modes u 0 0 while decoding that is while climbing the details tree n 0 1 2 and n l 1 eq 49 is successively applied to decode local dg2 modes u e n on active sub elements i e n inspection of details is aborted under two circumstances i when a detail d e n switches status to becoming insignificant for the first time with its local dg2 modes u e n selected for generating the assembled dg2 solution on g i a t or otherwise ii inspection and decoding reached g i l 1 with certain details d e l 1 remaining significant and their local dg2 modes u e l 1 are already decoded then a last round of decoding is applied to yield the child modes u 2 e l and u 2 e 1 l on g i l for inclusion while generating the assembled dg2 solution on g i a t the adaptive dg2 solution can now be viewed as a series of carefully selected dg2 modes forming an assembled dg2 solution on the non uniform grid g i a t each local dg2 mode should then be updated by applying the scaled dg2 formulation as described in section 2 3 3 prior to this the dg2 modes representing the water height h should be restored by subtracting the modes representing the topography z from those of the free surface elevation h z then the scaled dg2 formulation can be applied to update the dg2 modes of the main flow data u h q as previously described sections 2 1 3 and 2 1 4 2 3 3 rk2 dg2 update elevating the modes of the assembled dg2 solution to time t δt by applying the scaled dg2 formulation described in section 2 1 4 each local mode in u e n relevant to the main flow data u h q is updated within a standard rk2 time stepping while doing so key treatments are incorporated in the rk2 dg2 update to ensure stability around sharp solution gradients together with conservative incorporation of source terms with wetting and drying these treatments are well reported for the unscaled rk2 dg2 method kesserwani and liang 2012 herein they are re applied with few modifications to accommodate the scaling introduced to the present dg2 method and the changes related to using the standard swe model instead of the pre balanced model liang and borthwick 2009 and to further exploit the details ensuring the generation of a robust assembled dg2 solution these treatments are summarised in the rest of this section double localisation and slope limiting local slope limiting is needed for certain slope coefficients u e 1 l of the flow variables u h q slope limiting is a necessary process prior to each rk stage to prevent development of gibbs phenomena around sharp solution gradients it should only be triggered at such portions in the solution otherwise it can degrade the conservative character of dg2 modes in any other portions of the dg2 solution or even affect robustness e g see examples within kesserwani and liang 2012 kesserwani and liang 2012 therefore double localisation is applied to cautiously restrict the application of the slope limiter to the portions of the assembled dg2 solution at which sharp gradients are about to form the first localisation step consists of only considering the active slope coefficients at the maximum refinement level l u e 1 l for possible limiting in fact dg2 modes u e l at refinement level l can only be active whenever sustained by a tree of significant details as previously described in section 2 3 2 and also proved in vuik and ryan 2014 when this happens u e l should be representative of a local feature occurring in the assembled dg2 solution such a local feature can either be a sharp discontinuity i e a shock wave or shockless representing a solution kink e g a front of a rarefaction wave or a rapidly changing state e g due to a wetting and or a drying process therefore a second localisation step is needed to avoid slope limiting around any shockless feature within the assembled dg2 solution this can be achieved by further subjecting those active slope coefficients u e 1 l to krivodonova s shock detector krivodonova et al 2004 which is here used with a detection threshold 9 instead of 1 krivodonova et al 2004 to ensure it only detects slope coefficients associated with the presence of a sharp solution discontinuity after double localisation the relevant slope coefficients can then be limited by a slope limiter function such as the generalised minmod i e eq 2 9 in cockburn and shu 2001 which is here used moreover shock detection and limiting is applied component wise on u h z q with the component h z used instead of h to ensure that the presence of sharp terrain gradients will not mistakenly trigger any slope limiting on the slope coefficients representing the water height h after double localisation and limiting limited slope coefficients for h can be deduced from the limited slope coefficents of h z by subtracting the slope coefficients of z it may be useful to note that without double localisation the quality of the assembled dg2 solution compared to the dg2 solution on a uniform grid might undergo more significant deterioration as a result of unnecessary calls of the generalised minmod limiter in effect the limiter tends to either zero or unnecessarily substitute the true dg2 slope coefficients in any case this leads to false slope coefficients being used during encoding eq 48 resulting in false details in the compressed mwdg2 solution which would manifest themselves in a deteriorated assembled dg2 solution after decoding eq 49 well balanced and depth positivity preserving dg2 modes the selected dg2 modes forming the assembled dg2 solution on g i a t are revised based on the wetting and drying condition described in kesserwani and liang 2012 which is applied here with the following changes firstly eq 19 is used to generate the original riemann states for the components u h z h q instead of eq 12 in kesserwani and liang 2012 secondly revised states for the components u z h z q are reconstructed from original states under conditions ensuring both depth positivity and well balancedness i e using eqs 14 16 in kesserwani and liang 2012 these revised states should be used to calculate riemann fluxes across the sub elements forming g i a t thirdly eqs 13 14 and 21 22 are reused to reconstruct dg2 modes based on the revised riemann states fourthly revised dg2 modes of the h variable are deduced from those of the h z variable by subtracting the revised dg2 modes of the z variable finally revised dg2 modes of u z h q and riemann fluxes become availabe to evaluate the dg2 operators eqs 25 26 when applying the present wetting and drying condition it may be useful to note two key aspects the first is about the continuity property of the dg2 topography projection in eq 20 although eqs 21 22 ensure that the continuity of the dg2 topography projection holds on a static uniform grid kesserwani 2013 this property does not necessarily hold for the assembled dg2 topography projection on g i a t in fact this topography projection is subject to constant decoding eq 49 from the compressed mwdg2 solution based on coefficients eqs 34 35 and 40 41 associated with decompositions from essentially discontinuous functions eqs 31 32 and 36 37 hence involving the free surface elevation h z as an intermediate variable as in kesserwani and liang 2012 is found necessary to achieve wetting and drying without relying on the continuity property for the assembled dg2 topography projection on g i a t the second aspect is about a specific time step restriction criterion to ensure depth positivity for the average coefficients with time evolution by denoting h e 0 t and h e 0 t δ t the average coefficients of the water height variable at times t and t δt respectively the following formula can be obtained using a similar reasoning as in kesserwani and liang 2012 54 h e 0 t δ t 1 2 c r h e 0 t in eq 54 cr stands for the courant number relative to the courant friedrichs lewy condition which restricts the time step size δt within explicit time integration schemes from eq 54 it is clear that whenever h e 0 t 0 cr must be 0 5 to also ensure that h e 0 t δ t 0 while condition 54 may be irrelevant for the rk2 dg2 method for which cr 0 3 cockburn and shu 2001 it is found critical to preserve the stability of its first order finite volume variant for which cr 1 as described later section 2 4 scaled implicit friction term discretisation prior to each rk2 time step the dg2 modes of the discharge are modified to add friction contribution as done for the unscaled dg2 formulation i e see section 2 5 within kesserwani and liang 2012 the same approach is applied for the scaled dg2 method used in this work leading to similar expressions as in kesserwani and liang 2012 i e eq 36 in section 2 5 of kesserwani and liang 2012 for adding friction into the discharge slope coefficients but without having any of the 3 s due to to the use of rescaled basis functions 2 3 4 truncation and encoding forming a new compressed mwdg2 solution to create new details the updated dg2 modes which form the assembled dg2 solution on g i a t should be used to reform a compressed mwdg2 solution on g i n n l 1 1 0 dg2 flow modes for the components u h q are only defined for the sub elements in g i n n l 1 1 0 that spanned g i a t the other sub elements remained inactive hence have non existent dg2 flow modes in this work truncation is the process of initialising zero details throughout g i n n l 1 1 0 in particular at the inactive sub elements to keep them subject to potential activation in the next round i e while redoing the process described in section 2 3 2 over the active sub elements belonging also to g i a t encoding is done by successively applying eq 48 level wise in decending order this generates new flow details from the updated dg2 modes and thereby addresses any irrelevant zeroing introduced previously by truncation as in the pre processing step section 2 3 1 encoding should be applied on the components u h z q after truncation and encoding a full set of new details d e n n e is available for which an alternative set of normalised details d ˇ e n n e can be produced via eq 50 see section 2 3 1 with new sets of details in place the process sections 2 3 2 2 3 4 can be repeated to evolve the adaptive solution up to a specific simulation time 2 4 first order variant adaptive haar finite volume hfv1 scheme the hfv1 adaptive solution is effectively an mwdg1 method formulated upon the same scaling and wavelet basis described in sections 2 1 2 3 but only considering the the zeroth component of the legendre basis i e p 0 ξ 1 hence neglecting the slope coefficents now the local approximate solution u h in eq 11 becomes piecewise constant which can be initialised by eq 13 and updated by the operator 17 the filter matrices are thus made of a single scalar given by 55 h 0 h 1 g 0 g 1 1 2 with which eqs 48 49 are applied to encode and or decode coefficents u e n and or d e n these coefficients now include only one component representing the piecewise constant averaged data the adaptive hfv1 solution is processed as described in section 2 3 while omitting all the routines involving slope coefficents e g double localisation and limiting explicit first order time marching is applied for time integration but with courant number not exceeding 0 5 to ensure depth posivity see section 2 3 3 for comparison purposes the highest permissible courant number shared by the mwdg2 and hfv1 adaptive solutions i e cr 0 3 is chosen to run all the simulations in section 3 3 numerical tests seven diagnostic tests are conducted to identify and compare the behaviour of the adaptive hfv1 and mwdg2 solution schemes with reference to the standard first order finite volume fv1 and second order discontinuous galerkin dg2 schemes on uniform grids the first test considers a dam break flow on a wet and flat domain with a shock wave on which wavelet adaptivity related issues and choices are thoroughly analysed to find a setting where the adaptive solvers are as numerically accurate as their uniform grid counterparts at the finest resolution available while remaining computationally more efficient in the second test the predictive accuracy of the adaptive solvers is re explored for dam breaks over a dry bed to assess their sensibility in tracking dynamic flow evolution with wet dry front propagation over frictionless and frictional beds shockless dam break flows over a dry domain are examined in the third test to further inspect the properties of the hfv1 and mwdg2 solvers in capturing a wet dry front accelerating downhill and decelerating uphill the fourth test introduces topography with discontinuities and kinks partially submerged below a lake at rest the test is used to examine the automated mesh generation capability of the adaptive hfv1 and mwdg2 solvers and to assess their ability to preserve well balanced adaptive solutions with zero flow in the fifth test steady state flows are explored to study the convergence property of the adaptive solvers to steady state and to verify further their well balancedness for non zero flows the sixth test uses an oscillatory flow in a parabolic bowl to measure the numerical conservation of mass and energy in a frictionless and physically closed domain where the solvers are subjected to a perpetually moving wet dry fronts with periodically vanishing velocities the final test simulates a laboratory flume experiment of a frictional dam break flow over a trapezoidal hump including an analysis of the trade off between maximum refinement level and computational efficiency except when clearly stated for a specific test the following setting is used as a standard adaptive hfv1 and mwdg2 solution runs start from a single mother element m 1 with nine refinement levels l 9 hence yielding an adaptive grid g i a with number of sub elements between 20 1 and 29 512 uniform fv1 and dg2 solution runs are made at the finest resolution accessible to the adaptive solvers hence on grid g i 9 with 512 elements all solution runs are carried out using the same basic parameters namely cr 0 3 for the time step selection 10 4 for dry sub element detection and 9 for krivodonova s shock detector krivodonova et al 2004 with the mwdg2 dg2 solvers all the simulation results presented here are made available for access as supplementary materials shaw and kesserwani 2018 the fortran 2003 code used to run these tests is available for download on zenodo shaw et al 2018 instructions for running the models and interpreting the data are provided in appendix 1 3 1 dam break flow on a wet domain with shock shock wave transients are characteristic of hydrodynamic flows which are typically short lived during a long time simulation in reality they could well represent an impact event perturbing the flow over the whole simulation domain fine mesh spacing is typically desired over a relatively short period of time when the shock occurs and propagates but such resolution may no longer be required as the shock dissipates to explore the characteristics of wavelet based adaptivity within the hfv1 mwdg2 solutions with discontinuities including shocks the classical dam break test with a flat topography is considered therefore a one dimensional frictionless and wet domain is assumed of length between x 0 and x 50 m with a hypothetical dam located at x 25 m the dam separates two water bodies with different initial values of the water height h the initial conditions are a zero discharge and a discontinuous water profile given by 56 h x 0 6 i f x 25 2 i f x 25 this results in a flow profile including a shock wave and rarefaction wave which propagate away from the initial dam position in opposite directions separated by a constant state toro 2001 assuming open domain boundaries both waves are expected to be present by t 3 s before entirely exiting the domain by t 10 s five series of runs are performed using different solver configurations with the same initial conditions each with a specific purpose as detailed in the following 3 1 1 optimal choice for the error threshold driving wavelet adaptivity in this first series of tests the adaptive hfv1 mwdg2 solvers are employed to identify the error threshold section 2 3 2 that ensures a fair balance between the numerical accuracy and the computational efficiency of the adaptive solvers adaptive and uniform solution schemes are run for the standard setting which yields a uniform grid with 512 elements for the fv1 dg2 solutions δx 0 098 m and an adaptive grid that can allow up to 512 sub elements δx 9 0 098 m for the hfv1 mwdg2 solutions to measure accuracy the normalised ℓ2 error is calculated while varying the additivity error threshold from ε 10 6 to ε 10 1 fig 1 a the ℓ2 errors are evaluated for the water height variable at t 2 5 s when both shock and rarefaction waves are still present in the domain see fig 2 a normalised ℓ2 error is calculated as 57 ℓ 2 h e 0 l h t 2 δ x l h t 2 δ x l where ht is the analytical water height as described in delestre et al 2013 the ℓ2 error for the adaptive solutions is always evaluated on the finest uniform grid available namely g i l by prior conversion from a compressed solution on g i a into an assembled solution on g i l section 2 2 5 in fig 1a the ℓ2 errors of the adaptive hfv1 mwdg2 solvers for various error threshold values are compared to the ℓ2 errors relative to their uniform fv1 dg2 counterparts on the finest grid these results show that both adaptive hfv1 mwdg2 solvers can preserve the ℓ2 accuracy of the underlying uniform fv1 dg2 solvers respectively up to an error threshold value of ε 10 2 particularly for ε 10 2 the errors of the mwdg2 solution remain lower than the errors of the uniform fv1 solution on the finest grid as expected due to the second order accurate nature of the mwdg2 solver with ε 10 1 the ℓ2 errors of hfv1 mwdg2 exceed the ℓ2 errors of uniform fv1 dg2 counterparts on the finest grid with 29 elements although they remain bounded by the uniform fv1 dg2 s errors that are two order of resolution coarser on the grid with 27 elements nonetheless with ε 10 1 the ℓ2 error of mwdg2 is noted to exceed the ℓ2 error of fv1 on the finest grid making it a less compelling choice to further benefit from the dg2 accuracy hence the error threshold ε 10 3 is found to be a rational choice to keep the predictive accuracy of the adaptive solvers at the same level as their uniform counterparts on the finest grid available and to achieve second order accuracy with the mwdg2 solver computational efficiency is measured as the cpu time needed to complete a 40 s long simulation and including the pre processing step section 2 3 1 fig 1b shows the cpu times for the adaptive hfv1 mwdg2 solvers evaluated for all the error thresholds used in the accuracy analysis fig 1a along with the cpu times for the uniform fv1 and dg2 simulations on the finest grid 512 elements as the error threshold increases the cpu time of the adaptive hfv1 mwdg2 solvers decreases initially and becomes practically constant for ε 10 3 for the considered error thresholds the mwdg2 solver results in 2 3 to 140 times faster simulations than the uniform dg2 solver on the finest grid in contrast the adaptive hfv1 solver could only be faster than the uniform fv1 solver on the finest grid for ε 10 4 most likely due to dominance of the wavelet adaptivity overhead section 3 1 5 on the finest uniform grid the dg2 solver is found to be around 8 times more expensive than the fv1 solver although the mwdg2 solver with ε 10 3 exhibits better performance than the fv1 solver these tests indicate that an error threshold of ε 10 3 is an optimal choice for the adaptive mwdg2 solver to preserve the accuracy of the uniform dg2 solver without exceeding the runtime of the uniform fv1 solver this choice is also suitable for the adaptive hfv1 solver to deliver simulations that are as accurate as the uniform fv1 solver but computationally more efficient unless stated otherwise in the remainder of section 3 ε 10 3 is adopted as a default choice for the error threshold value 3 1 2 adaptive solution predictability of relevant flow features t 2 5 s the second series of tests compares adaptive solutions of water height and discharge and mainly examines the grid prediction ability relevant to the hfv1 and mwdg2 solvers the adaptive solutions are analysed at t 2 5 s when both shock and rarefaction waves still exist the adaptive solutions are illustrated in fig 2 which shows a good agreement with the analytical solutions the hfv1 predictions fig 2a c show more pronounced numerical diffusion than the mwdg2 predictions which is in fact expected given the first order nature of the hfv1 scheme in terms of resolution predictability as shown in fig 2b both hfv1 and mwdg2 correctly predict the finest resolution around the shock i e refinement level 9 further showing ability to allow large gaps in resolution levels without failing in regions of uniform flow at the constant state and downstream of the shock the hfv1 and mwdg2 solutions predicted the coarsest resolutions at refinement level 5 and 4 respectively it is not surprising that mwdg2 yields coarser refinement levels than hfv1 as the former always have smaller errors than the latter for ε 10 3 section 3 1 1 nonetheless both hfv1 and mwdg2 solvers seem able to sensibly select suitable refinement levels for their adaptive solution in the locality of a shock and throughout the constant state fig 2 for 20 x 50 however in prediction of the rarefaction wave mwdg2 presents a remarkable behaviour as compared to hfv1 there the mwdg2 solution uses refinement level 8 around the rarefaction s head and tail preserves level 7 in between them and allows a sharp drop to level 5 downstream of the head also the mwdg2 solution does not even access the maximum refinement level 9 as opposed to the hfv1 solution that deploys it to indistinguishably compute the extent of the rarefaction these results suggest that the wavelet adaptivity combined with the mwdg2 solver can produce an adaptive solution that is more accurate and economical on grid resolution demands 3 1 3 size of coarse baseline grid vs maximum refinement level this third series of runs aims to analyse the trade off between coarseness of the initial grid versus depth in maximum refinement level a known adverse effect of conventional adaptive mesh refinement methods is the need of an initial coarse mesh that is yet fine enough for the flow solver to sense the triggering features of the initial flow conditions donat et al 2014 haleem et al 2015 among many other adverse effects zhou et al 2013 kesserwani and liang 2015 liang et al 2015 li 2010 an and yu 2014 delis et al 2011 wavelet based adaptivity can overcome this drawback permitting the initialisation of simulations from a very coarse initial mesh as small as two elements caviedes voullième and kesserwani 2015 or even a single element sections 3 1 1 3 1 2 to study this characteristic for the adaptive hfv1 and mwdg2 solutions they are here reconsidered with different settings based on doubling the baseline grid size in conjunction with systematic lowering of the maximum refinement level but on the basis of fixing the maximum allowed number of sub elements to 512 the parameters m l are varied as m l 1 9 2 8 4 7 8 6 16 5 32 4 64 3 128 2 256 1 and runs are made with ε 10 3 as in sections 3 1 1 the accuracy of the adaptive solvers is evaluated at t 2 5 s according to eq 57 and their computational efficiency is assessed based on the cpu runtime taken to complete a 40 s simulation in terms of accuracy the same qualitative predictions are noted for hfv1 and mwdg2 solvers respectively under the different setting for m l each of the solvers show identical depth and discharge predictions which are quite similar to those illustrated in fig 2a c and for this reason not presented here they also yield the same number and size for the sub element forming their assembled solutions consistent with the profile shown in fig 2b this observation is also reinforced by the fact that the same normalised ℓ2 error magnitude plotted in fig 1 for ε 10 3 is retrieved for all the settings as for the runtime efficiency it is found to be different for each solver under the different settings fig 3 shows the cpu time cost for each solver relative to each setting m l as the number of mother elements exceeds 32 fig 3 the adaptive solvers experience an increase in cpu times as expected in fact by t 10 s the flow domain contains very smooth profiles for which the adaptive solvers can at best select an adaptive grid at the coarsest resolution allowable with m elements prior to completing the 40 s simulation section 3 1 4 in particular the runtime of mwdg2 becomes significantly more costly with increasing number of mother elements to an extent that the underlying dg2 operational costs are overwhelming fig 3 for m 128 however as long as the baseline grids do not exceed 32 mother elements the adaptive hfv1 and mwdg2 solvers required similar runtime costs these findings indicate that the accuracy of the adaptive solvers is not affected by severe coarsening in the baseline grid but such an action is necessary to fully exploit wavelet adaptivity traits to boost efficiency in particular with mwdg2 3 1 4 coarsening ability and time step size over long time evolution the fourth series of runs investigates the dynamic behaviour of the adaptive solutions as the transient dam break evolves and dissipates in the open computational domain during the 40 s simulation the standard setting is used to re run the hfv1 mwdg2 solvers together with the default error threshold while inspecting their coarsening ability and the size of their time step as time evolved fig 4 shows the time history for the number of sub elements and of the time step size during the presence of the rarefaction wave in the domain t 10 s fig 4a reveals that the hfv1 solver requires 3 times more sub elements than the mwdg2 solver in line with the results in section 3 1 2 see fig 2 fig 4a shows that hfv1 with its piecewise constant basis involved a maximum of 233 sub elements to represent the sloping rarefaction wave whereas mwdg2 with its piecewise linear basis uses just 83 sub elements for representing the same rarefaction wave and does that more accurately than hfv1 beyond t 10 s the maximum number of sub elements with mwdg2 shows much faster decrease than with hfv1 and reaches the single mother element about 10 s earlier see zoom in portion in fig 4a this behaviour is expected with both solvers as by t 10 s the waves exited the domain and only small solution perturbations remain relatedly the time histories of the adaptive time step size are illustrated in fig 4b showing predominantly larger time steps with mwdg2 than with hfv1 the first noticeable increase in time step size for the mwdg2 solver is achieved by t 3 5 s when the shock wave exits the domain more increase in time step size is seen by t 10 s when both waves have exited the domain this increase becomes more significant from t 23 s when mwdg2 uses less than four sub elements from t 27 s the mwdg2 solver uses a time step around δt 1 5 s which is roughly twice the time step used by hfv1 over this period this analysis supports the findings highlighted at the end of section 3 1 2 suggesting that the mwdg2 solver is more accurate and less cpu intensive for simulations over large spatial domains and long time scales 3 1 5 computational overhead due to wavelet adaptivity the final series of tests examines the computational overhead associated with wavelet adaptivity in the hfv1 and mwdg2 solutions wavelet adaptivity reduces the number of sub elements producing coarser solutions that allow longer time steps section 3 1 4 fewer sub elements and bigger time steps reduce the overall computational cost sections 3 1 1 and 3 1 4 but the compression and assembly mechanisms via transformations 48 and 49 as detailed in section 2 3 involved in the adaptivity calculations introduce some computational overhead that may dominate the overall computational cost fig 1b to identify the extent of this overhead the computational trade off between the adaptive calculations and the uniform ones is analysed considering their cumulative cpu runtimes respectively throughout the 40 s simulations fig 5 the adaptive and uniform solvers are run based on the standard setting in fig 5a the evolution of the cumulative runtimes generated by the fv1 and hfv1 are compared for the first 15 s the adaptive hfv1 solver is found to be slower than the uniform fv1 solver due to the computational overhead associated with wavelet adaptivity later after the shock and rarefaction waves exit the domain the adaptive hfv1 solution is coarsened aggressively fig 4 and the associated gain in computational efficiency is seen to outweigh the adaptivity overhead nonetheless the entire 40 s long hfv1 simulation is noted to complete in less than half the cpu time of the uniform fv1 simulation on the finest grid this indicates that adaptive hfv1 modelling is more practical when simulating flows with smooth profiles with the adaptive mwdg2 solver as shown in fig 2b the computational overhead due to wavelet adaptivity remains insignificant relative to the uniform dg2 simulation also this overhead is found to be lower than the wavelet adaptivity overhead experienced in the hfv1 simulation compare the zoom in portions in fig 5a and fig 5b at least for t 15 s when the rarefaction did not leave the domain most strikingly the adaptive mwdg2 solver is found to complete the 40 s simulation almost as quickly as the adaptive hfv1 solver in summary when simulating a dam break flow with a shock occurring on a wet domain the adaptive hfv1 mwdg2 solvers with ε 10 3 preserve the numerical accuracy of their corresponding uniform fv1 dg2 solvers hfv1 mwdg2 are most effective on very coarse baseline grids down to a single mother element once the waves have left the domain both solvers are able to represent the spatially uniform solution with just one element hfv1 is about twice as fast as fv1 and mwdg2 is about 20 times faster than dg2 with mwdg2 achieving greater accuracy than hfv1 at the same speed 3 2 dam break flow on a dry domain without shock as shown in section 3 1 wavelet adaptivity can easily refine the solution in the locality of a shock wave because wavelets act as a kind of jump detector vuik and ryan 2014 however a dam break wave usually happens over a dry domain without experiencing shock formation when topographic effects are neglected in this case a wetting front propagation occurs downstream when friction effects are also neglected the wave front shape is smooth including a wet dry front that should be modelled with enough resolution to properly track arrival time friction retards the arrival of the wet dry front and steepens the wave front which must also be captured with fine resolution to represent the wave tip in this test some key properties of the adaptive hfv1 and mwdg2 solvers are re explored when simulating dam break flows over a dry and flat bed considering frictionless and frictional cases for which analytical or semi analytical solutions exist delestre et al 2013 3 2 1 frictionless case the test configuration is the same as the dam break on a wet domain section 3 1 1 except for the initial water height h which is given by 58 h x 0 6 i f x 25 0 i f x 25 the adaptive hfv1 mwdg2 solutions are considered with the standard setting tests are run for t 1 3 s and normalised ℓ2 errors are calculated using eq 57 by differencing numerical solutions with the analytical solution for the same range of choices for the error threshold between ε 10 6 and ε 10 1 fig 6 illustrates the respective normalised ℓ2 errors for the hfv1 mwdg2 solvers fig 6 also includes the ℓ2 errors of the fv1 dg2 solvers on two uniform grids with 27 128 elements and 29 512 elements showing lesser magnitudes with dg2 as expected for all the error thresholds the hfv1 and mwdg2 solution remained more accurate than the corresponding uniform fv1 and dg2 solutions on the grid with 128 elements fig 6 the mwdg2 solver is always more accurate than fv1 as opposed to the previous test compare fig 6 with fig 1a with ε 10 2 the hfv1 and mwdg2 solutions become almost as accurate as their corresponding uniform solutions on the finest grid although they are somewhat less accurate this behaviour is not observed in the previous test compare fig 6 with fig 1a where the ℓ2 errors of the hfv1 mwdg2 solvers overlap with the ℓ2 errors of the uniform fv1 dg2 solvers on the finest grid possibly in this test the water height and flow profiles are largely curved which is the case where the fv1 dg2 solvers benefit more from an increase in the resolution of the uniform grid also the flow states in the previous test remain unchanged over a significant portion in the domain fig 2 which causes less loss of relevant information within the hfv1 mwdg2 solvers during de compression due to propagation of round off errors in eqs 48 49 here dg2 and mwdg2 achieved lower ℓ2 errors than in the previous test most likely owing to the double localisation process that switched off the slope limiter given the shockless nature of this dam break flow the results in fig 6 indicate that ε 10 3 and ε 10 2 seem to be good choices to maximise the efficiency for hfv1 mwdg2 runs and deliver comparable accuracy to the uniform fv1 dg2 runs on the finest grid a qualitative analysis of the adaptive hfv1 and mwdg2 solutions at t 1 3 s is presented in fig 7 a and 7b which includes a comparison between the water height profiles predicted by hfv1 and mwdg2 for the aforementioned error thresholds and the analytical solution hfv1 and mwdg2 predictions are noted to be in good agreement with the analytical solution however the hfv1 solution is seen to experience numerical diffusion at the wet dry front and at the tail of the wave slightly overestimating the region upstream of the initial dam position and underestimating the position of the wave front see magnified portions within fig 7a and 7b these effects do not seem to improve when lowering the error threshold from ε 10 2 to ε 10 3 and are not visible in the mwdg2 solution which provides better overall alignment with analytical solution as expected from a second order accurate numerical model in terms of resolution demand as illustrated in fig 7c and 7d mwdg2 allows coarser refinement levels than hfv1 and chooses more sensibly where to use the finest levels with ε 10 2 and ε 10 3 the hfv1 solution involved the two finest refinement levels namely still accessing levels 8 and 9 to represent the full extent of the sloping water surface fig 7c and 7d the mwdg2 solution does not exceed levels 7 to represent this zone except where it should namely at the kink and wet dry front notably with ε 10 2 mwdg2 uses level 6 and below along the smoothing wave level 7 at the kink but without accessing any higher refinement levels despite being available considering also that mwdg2 predictions are nearly similar at ε 10 2 and ε 10 3 see fig 6b and compare fig 7a vs 7b lowering ε can reduce model accessibility to the finest refinement levels as desired for some simulations that do not demand high resolution while keeping these finest levels re accessible as needed for other simulations see also section 3 7 3 2 2 frictional case for the frictional dam break case the configuration is identical except that the manning coefficient nm 0 016 m1 3 s 1 which is selected by calibration to fit the semi analytical solution available in terms of the chézy factor delestre et al 2013 adaptive hfv1 and mwdg2 solutions are produced for the same error thresholds ε 10 3 and ε 10 2 which are illustrated in fig 8 a and 8b respectively together with the semi analytical solution at t 1 3 s outside of the wave tip region upstream of the wet dry front hfv1 mwdg2 solutions perform very similarly to those in the corresponding frictionless test section 3 2 1 at the wave tip region the semi analytical solution is actually based on interpolation assuming a parabola delestre et al 2013 as such no exact comparisons can be made therein nevertheless hfv1 mwdg2 solutions are found to agree well with the semi analytical solution in the wave tip region with mwdg2 producing a steeper wave front profile fig 8c and 8d illustrate the corresponding refinement levels used by the adaptive solvers with ε 10 3 and ε 10 2 respectively the adaptive hfv1 mwdg2 solutions show almost the same behaviour for the refinement levels as the frictionless case compare fig 7c and 7d with fig 8c and 8d respectively however at the wet dry front mwdg2 retains the maximum refinement level even with ε 10 2 due to the steeper wave front induced by friction the frictional and frictionless dam break tests demonstrate further the ability of the adaptive hfv1 and mwdg2 solvers to simulate the propagation of dynamic waves over a dry domain mwdg2 alleviates the numerical diffusion errors expected in the fv1 or hfv1 solutions with much lower refinement levels with an error threshold of ε 10 2 mwdg2 does not need to access the maximum refinement level apart at the wet dry front when the wave front is steepened by friction this suggests that the error threshold can be further relied on to reduce model access to the finest resolutions available as relevant for certain simulations even when they are set to perform at very high resolution 3 3 dam break flow descending and ascending sloping and dry beds in this test the performance of the adaptive hfv1 mwdg2 solvers is further examined for dam break flows featuring a wet dry front that accelerates or decelerates as it descends or ascends a sloping bed a dam break wave upsloping is initially used in xing et al 2010 a more challenging variant is considered here as proposed in kesserwani and liang 2012 including a case where the wave downslopes the initial dam is assumed centred at x 0 m in a 15 m 15 m domain upstream of the dam x 0 the initial water elevation h z is equal to 8 m and the water height is assumed to be zero downstream of the dam x 0 a wall is assumed to exist at the upstream end x 15 m which can be accounted for by reflective boundary conditions free outflow is assumed at the downstream end x 15 m by transmissive boundary conditions the topography is linear with a slope angle α namely 59 z x 1 x t a n α two cases are considered with α values in eq 59 first a dam break ascending with α π 6 and second a dam break descending with α π 6 the upslope dam break is simulated for t 1 s whereas the downslope dam break is simulated for t 0 75 s both cases are assumed frictionless simulations are performed using the standard setting with the uniform fv1 and dg2 solvers on a grid with 512 elements and with the adaptive hfv1 and mwdg2 solvers taken with the default error threshold m 1 l 9 and ε 10 3 in fig 9 a and 9b the water depth predictions made by the adaptive hfv1 mwdg2 and uniform fv1 mwdg2 solvers are illustrated showing comparable profiles that also match existing results kesserwani and liang 2012 the difference between the predictions is more noticeable for the discharge profiles as shown in fig 9e and 9f compared to mwdg2 dg2 fv1 hfv1 predictions exhibit numerical diffusion at the start of the wave as expected given the difference in the accuracy orders between the corresponding numerical formulations despite this these discrepancies are more prominent for the upslope dam break case see x 11 m in fig 9e vs at x 6 m in fig 9f suggesting that the second order variants provide better predictions with increased level of vigour in the wave propagation at the wave front the discrepancies become more noticeable in both the upslope and downslope dam break cases see x 10 m in fig 9e vs at x 12 m in fig 9f therein informed further by the results in fig 7a mwdg2 dg2 are expected to more accurately follow the evolution of the wet dry front as they both deploy piecewise linear solutions to integrate topography and wetting and drying as opposed to hfv1 fv1 that use piecewise constant solutions in terms of refinement level predictions which are illustrated in fig 9c and 9d the hfv1 solution only used the maximum level 9 hence yielding identical results to those delivered by the fv1 solution in both upslope and downslope dam break case this over prediction is associated with the use of a piecewise constant basis in hfv1 that yields a staircase pattern for the linear topography approximation making the solver trigger the maximum refinement level at ε 10 3 note that the proposed wavelet adaptivity formulations indistinguishably use the details of the flow and topography variables to generate the adaptive solution in contrast the mwdg2 solver in both cases predicted refinement level 8 to track the start of the wave and levels 6 and 7 thereafter upstream of the wave front for the upslope dam break case mwdg2 does not access the maximum refinement level 9 at the wave front but uses refinement level 8 instead this is in contrast with the downslope case where level 9 is retained therein and level 4 is selected before upstream of the depression wave such differences in refinement level predictions are expected given the different flow physics involved in the upslope and downslope dam break cases namely the wet dry front advance is slower in the former case whereas wave recession at the start is delayed in the latter case the propagation of the wet dry front in the numerical simulations can be compared to the analytical position of the wet dry front xf t given by 60 x f t 2 t 8 g cos α 1 2 g t 2 tan α the numerical position of the wet dry front is calculated based on the first sub element at which the water height is bigger than 10 2 m scanning sub elements from left to right fig 10 a and 10b show the time evolution of wet dry front positions for the upslope and downslope dam break cases respectively as seen in fig 10 fv1 calculates a slower front advance consistently under predicting the analytical solution by the end of the simulations fv1 and identically hfv1 positions the front about 2 m and 1 m below the true position for the upslope and downslope dam break cases respectively the dg2 solver tracks the upslope and downslope wet dry fronts more accurately than the fv1 solver however showing an over predictive tendency the adaptive mwdg2 solver is seen to preserve the accurate solution of the underlying dg2 solver the frontal evolution obtained with the dg2 and adaptive mwdg2 solvers compares favourably with results using the rkdg2 lft solver presented in kesserwani and liang 2012 1 1 in their fig 4b the analytical front evolution plot for the downslope case is incorrect their numerical results are more closely aligned with the correct analytical front evolution presented here in fig 10b in summary the adaptive hfv1 solver is not found as effective as in the previous dam break tests on flat beds because of its piecewise constant basis that can yield over refinement when approximating a sloping topography profile the adaptive mwdg2 solver uses a piecewise linear basis that can exactly represent the sloping topography at any refinement level so the mwdg2 solver is able to coarsen more effectively than hfv1 while proving more accurate and economical 3 4 well balanced property and mesh generation ability this test examines the initial mesh generation ability of the adaptive solvers and their well balanced property in reproducing a lake at rest unlike the idealised sloping topography in the previous test real terrain is fractally multi scale non smooth and often discontinuous as in the presence of buildings preserving quiescent flow over an irregular topography is challenging for numerical shallow water models in particular at partially wet zones located at bed discontinuities kesserwani 2013 kesserwani et al 2018 to assess the full extent of well balancedness a lake at rest test has been proposed sharifian et al 2018 based on an idealised topography with smooth sloping and discontinuous regions see fig 12 the lake at rest is defined on 0 m 50 m with an initial water elevation h z 2 m such that three scenarios occur exactly dry at a peak h 0 m at the curved hump submerged portion h 0 m at the triangular hump and unsubmerged portion with two wet dry fronts h 0 m at the rectangular hump the adaptive and uniform solvers are applied to compute the lake at rest conditions with zero initial discharge q 0 m2 s 1 simulations are executed for a relatively long time evolution namely t 100 s corresponding to about 16 000 time steps considering two error thresholds ε 10 1 and ε 10 3 with the standard setting m 1 and l 9 a robust and well balanced solver should preserve the initial water state and the initial zero discharge unperturbed as time evolves fig 11 shows the discharges computed by the adaptive and uniform solvers all the numerical discharges are observed to be very close to machine precision fig 11 and the initial water elevation remains unchanged fig 12 for all the solvers throughout the simulation slightly larger discharge predictions are noted with mwdg2 at ε 10 3 than with mwdg2 at ε 10 1 fig 11b and with hfv1 fig 11a this behaviour is expected as the smaller the ε the more mwdg2 will access eqs 48 49 causing more knock on effects due to rounding of the irrational numbers involved in the filter banks nonetheless this increase in error is negligible even after very long time evolution fig 11b also shows two spikes in the discharge predictions occurring around the discontinuities of the rectangular hump for dg2 and mwdg2 at ε 10 3 these spikes however do not grow over the 100 s long simulation and their magnitude is noted to be smaller with grid coarsening e g compare with the mwdg2 predictions at ε 10 1 these results confirm that the adaptive hfv1 mwdg2 solvers are well balanced noting also that the negative water height below the rectangular hump remains unmodified with time evolution fig 12 the sharp edges of the rectangular hump effectively become internal boundaries which there is no need to manually recognise since the initial water elevation can intersect the topography without affecting the well balancedness of the solution this property seems therefore to be instrumental to deal with the presence of buildings during the mesh generation process since h z and q are unvarying in this test the assembled initial adaptive solution is solely selected driven by the topographic features the well balanced hfv1 mwdg2 solvers can therefore be used as mesh generators subject to choosing an error threshold the mesh generation ability of these solvers is particularly explored by further analysing their refinement level predictions fig 12a and 12b include the refinement levels predicted by the hfv1 and mwdg2 solvers respectively at the rectangular hump both hfv1 and mwdg2 solvers are seen to select the maximum level 9 at the sharp edges and to coarsen effectively in between them where the topography is smooth for this hump the smooth portion is flat and the sharp edged portions are strongly discontinuous the former portion is readily represented by coarse piecewise constant and piecewise linear data while the latter portion can easily be detected by both representations the choice of the error threshold seems to have little effect on representing this obstacle as very similar refinement levels are predicted therein by both hfv1 and mwdg2 solvers at ε 10 3 and at ε 10 1 the curved and triangular humps are less easily represented by the hfv1 piecewise constant basis at ε 10 3 hfv1 used the maximum refinement level 9 in these two regions fig 12a more effective coarsening at these two humps is noted by choosing ε 10 1 where hfv1 uses only refinement levels 8 or below mwdg2 coarsens the triangular hump much more sensibly than hfv1 at ε 10 3 it uses the maximum refinement level only at the kinks at the base of the triangle fig 12b and much coarser levels at the tip that is positioned exactly at the centre of the domain at the curved hump mwdg2 still predicts the maximum refinement level 9 even at ε 10 3 which could be signalling that more resolution is needed to cover curved terrain shapes with ε 10 1 the triangular and curved hump are relatively less resolved with mwdg2 than with hfv1 with mwdg2 predicting level 7 and below however taking ε 10 1 is likely to make the hfv1 or the mwdg2 solvers unable to preserve enough accuracy recall sections 3 1 1 and 3 2 1 with a maximum refinement level l 9 and an error threshold ε 10 3 mwdg2 used the maximum refinement level at the discontinuities of the rectangular hump and the kinks of the triangular hump as expected but also throughout the curved hump to explore whether the usage of level 9 throughout the curved hump is an over refinement or a requirement the mwdg2 solver is re run by increasing the maximum refinement level to l 14 under the same error threshold fig 13 shows the profile of the corresponding refinement levels remarkably now the mwdg2 solver only accesses the maximum refinement level 14 at the strong discontinuities of the rectangular hump at the kinks mwdg2 predicts level 12 for the triangular hump and level 13 for the curved hump that has steeper kinks moreover analysis of the mwdg2 solution provides information on the necessary refinement levels required to represent the smooth humps i e suggesting the need for level 6 and 10 to discretise the slope and curvature involved in the triangular and curved humps respectively these results imply that mwdg2 can effectively be used to initialise mesh resolution in a localised manner as needed this property could potentially be useful towards making more effective use of very high resolution lidar data without overloading the simulation and gives the user direct control over the extent of resolution deepness at which topography is represented within the model via choosing ε 3 5 convergence to well balanced steady states with non zero flows over a hump in this series of tests the adaptive hfv1 and mwdg2 solvers are given steady boundary conditions to study their convergence ability in reaching steady states with flows over a hump following delestre et al 2013 the one dimensional domain is 0 m 25 m with a topographic hump given by 61 z x 0 2 0 005 x 10 2 i f 8 m x 12 m 0 e l s e w h e r e tests are performed to assess the rate of convergence upon three steady flow regimes subcritical supercritical and transcritical with a stationary shock the initial and boundary conditions used in each tests are available in table 1 simulations are performed with the uniform fv1 and dg2 solvers and the adaptive hfv1 and mwdg2 solvers both taken with the standard setting and ε 10 3 a simulation is set to stop whenever the ℓ 2 difference in water height between the current and previous time steps becomes in the range of machine precision the time history of the ℓ 2 difference for all three tests are shown in fig 14 the fv1 dg2 hfv1 and mwdg2 solvers all converge to machine precision in the subcritical test fig 14a and supercritical test fig 14b for the subcritical test all solvers converge to machine precision within about 300 500 s with the hfv1 and mwdg2 solvers being slightly faster than their fv1 and dg2 counterparts fig 14a in the supercritical test the fv1 and dg2 solvers converge after about 10 s with the adaptive solvers converging slightly later fig 14b compared to the supercritical case converging to steady subcritical flow takes longer because the flow is relatively weak and adjustment towards balance is consequently slower the transcritical case involves a transition from subcritical to supercritical flow with another transition back to subcritical flow downstream of a stationary shock unsurprisingly convergence to this transcritical steady state is the slowest of all three cases fig 14c fv1 and dg2 solvers on a uniform mesh converge to machine precision after about 800 s and the adaptive hfv1 solver after about 450 s the adaptive mwdg2 solver does not converge beyond 10 4 with ε 10 3 this stagnation in ℓ 2 difference with mwdg2 at ε 10 3 is likely due to the intrusion of the slope limiter triggered by noise eventually accumulating from rounding of irrational numbers at the same location see also the related discussion in the next paragraph regardless when ε is reduced to 10 5 the mwdg2 solver converges to machine precision at a faster rate than the dg2 solver fig 14c overall convergence rates for all solvers are of the same order of magnitude for a given flow regime and all solvers are able to converge to machine precision the steady state solutions of water elevation and discharge are included in fig 15 for all three flow regimes the numerical solutions of water height are in close agreement all showing no visual difference with their corresponding analytical profiles delestre et al 2013 which were not illustrated for clarity as can be seen in fig 15g 15i anomalies in discharge predictions are apparent in the fv1 and hfv1 solutions these anomalies are usually expected to reduce with an improved fv based topography discretisation technique apart where a shock develops kesserwani 2013 haleem et al 2015 caleffi and valiani 2017 however all these types of anomaly do not appear when using dg2 and mwdg2 solvers compared to the dg2 uniform solver the mwdg2 solver presents some tiny anomalies in the discharge predictions these anomalies are different to those induced by the hfv1 and fv1 solvers and are comparatively negligible they are seen to occur at locations where there are gaps in refinement levels see also fig 15d 15f most likely these tiny anomalies are caused by constant de compression of the mwdg2 solution at the same location when the adaptive grid and solution become static in time this can eventually lead to low levels of noise due to accumulation of round off errors which can generate knock on effects such as triggering the slope limiter as discussed in the previous paragraph such tiny noises can be avoided by either increasing the convergence tolerance or lessening ε in fig 15 the corresponding refinement levels predicted by the adaptive hfv1 and mwdg2 solutions are shown for the subcritical case fig 15d supercritical case fig 15e and transcritical case fig 15f both solvers require higher refinement levels only in the locality of the hump with very few sub elements involving the maximum refinement level 9 corresponding with δx 9 0 049 m elsewhere the solution is coarsened aggressively down to refinement level 2 corresponding with δx 2 6 25 m using an adaptivity threshold of ε 10 3 the adaptive mwdg2 solver coarsens the solution more effectively than hfv1 in the locality of the hump for the transcritical solution to converge to machine precision mwdg2 required an adaptivity threshold ε 10 5 and with this choice mwdg2 behaves similarly to hfv1 using the maximum refinement level for the entire region of the hump fig 15f in summary with a suitable choice of adaptivity threshold all hfv1 and mwdg2 solvers converge to steady state solutions down to machine precision at about the same rate as the fv1 and dg2 solvers on a uniform mesh they are also found to be as well balanced as the underlying fv1 and dg2 uniform solvers adaptive hfv1 and mwdg2 solutions are coarsened down to refinement level 2 using elements that are 128 times coarser than the finest elements 3 6 conservation of integral properties for an oscillatory flow in a parabolic bowl to analyse conservation properties over a long time evolution the uniform and adaptive solvers are applied to simulate an oscillatory flow over topography as shown in lhomme et al 2010 excessive numerical diffusion in shallow water models acts to dissipate energy and damp oscillatory flows assuming a frictionless topography there are no sources or sinks of energy which makes this test suitable to challenge the ability of a shallow water model to conserve mass and energy in the presence of moving wet dry fronts as in delestre et al 2013 an initially sloping water elevation is contained in a parabolic bowl defined on a one dimensional domain in the interval 0 m 4 m given by 62 z x h 0 1 a 2 x 2 2 1 the exact solutions of the water height and the velocity are 63 h x t h 0 1 a x 2 b 2 g h 0 cos 2 g h 0 a t 2 1 i f x 1 t x x 2 t 0 m e l s e w h e r e 64 v x t b sin 2 g h 0 a t i f x 1 t x x 2 t 0 m s e l s e w h e r e where x 1 t and x 2 t are the locations of the wet dry interfaces at time t h 0 0 5 m and a 1 m delestre et al 2013 the initial water height and flow velocity conditions can be obtained from eqs 63 64 transmissive boundary conditions are imposed at both boundaries but the parabolic bowl restricts the water to the domain interior the uniform and adaptive solvers are applied considering the standard setting with the default error threshold 512 elements with the uniform solvers vs l 9 m 1 and ε 10 3 with the adaptive solvers tests are integrated for 36 11 s corresponding to 18 periods of oscillation the period to complete one oscillatory cycle is t 2 π a 2 g h 0 the solution of the parabolic bowl behaves like a pendulum with turning points occurring every half period 0t 0 5t 1t 1 5t when the flow velocity is zero at each period 0t 1t 2t the analytical water elevation is equal to the initial water elevation and at each intermediate period 0 5t 1 5t 2 5t the analytical water elevation is a mirror image of the initial water elevation 3 6 1 qualitative comparisons after 9 periods numerical solutions using the fv1 dg2 adaptive hfv1 and mwdg2 solvers are compared with the analytical solution in fig 16 the dg2 and mwdg2 solutions of water elevation closely agree with the analytical solution after 9 periods fig 16a and 9 5 periods fig 16b in contrast oscillations are damped by the first order accurate fv1 and hfv1 solvers and the water elevation after 9 periods no longer reaches the maximum initial water elevation for the velocity predictions the dg2 solver obtains calculations that are consistently close to the analytical solution of v 0 m s 1 after 9 periods fig 16e and 9 5 periods fig 16f the adaptive mwdg2 solver also achieves small flow velocities except around the wet dry fronts the fv1 and hfv1 solutions have flow velocity errors of about 0 4 m s 1 with larger error magnitudes in the locality of the wet dry fronts the refinement levels predicted by the adaptive hfv1 and mwdg2 solvers are presented corresponding to the solution after 9 periods fig 16c and 9 5 periods fig 16d the hfv1 solver uses the maximum refinement level 9 throughout the domain as expected given the curved shape of the parabolic topography recall the analysis in section 3 4 the adaptive mwdg2 solver uses the maximum refinement level just at the wet dry fronts and temporarily in some dry regions where small scale noise occurs in the solutions such noise can be reduced by slightly increasing the error threshold apart from these isolated regions mwdg2 uses only refinement level 7 resulting in almost four times fewer elements than the uniform solvers with 512 elements 3 6 2 mass conservation and energy conservation the frictionless parabolic bowl is a closed system with no sources or sinks of mass or energy as the water oscillates within the bowl there is an exchange between kinetic and potential energy but the total energy is conserved the time evolution of total mass and total energy is measured in order to assess the conservation properties of the numerical solvers only the average coefficients are used in both mass and energy calculations which were evaluated for the assembled solution on g i a that is the total mass produced by the adaptive solvers on g i a is calculated as 65 m e g i a h e 0 n δ x e n from eq 65 the mass difference δm is evaluated as δm t m t m 0 with m 0 m 0 being the initial mass at t 0 s the mass difference is normalised relative to the initial mass as 66 δ m t δ m t m 0 the total energy is calculated as the sum of kinetic and potential energy vreugdenhil 1994 67 e e g i a 1 2 h e 0 n v e 0 n 2 h e 0 n z e 0 n 2 z e 0 n 2 δ x e n which is normalised relative to the initial total energy e 0 e 0 such that 68 ê t e t e 0 for the uniform solvers eqs 65 68 are applied for their assembled solution on g i l instead of g i a the time histories of the normalised mass difference are illustrated in fig 17 a for the fv1 and dg2 solvers on a uniform mesh and the adaptive hfv1 and mwdg2 solvers the fv1 hfv1 and dg2 solvers conserve mass to machine precision fig 17a the hfv1 solver retains refinement level 9 yielding simulations on an equivalent grid as the fv1 solver but at a higher cost here hfv1 does not zero any detail coefficient and so gets unnecessarily overloaded with overhead cost due to haar wavelet adaptivity recall the analysis in section 3 1 5 unsurprisingly hfv1 delivers the same level of conservativeness as the uniform fv1 solver for both mass and energy quantities fig 17 the mwdg2 solver constantly altered refinement levels between 7 and 9 resulting in a loss of information due to zeroing of detail coefficients given also that the multi wavelet adaptivity of the mwdg2 solver must filter both average and slope coefficients via constant rounding of the irrational numbers involved in the filters these effects result in a very small linear growth in mass fig 17a nonetheless mwdg2 mass conservation errors are still close to machine precision even after 18 periods of oscillation the normalised total energy is also measured at each time step for the fv1 dg2 hfv1 and mwdg2 solvers fig 17b as expected for a first order solver fv1 and hfv1 dissipate energy quite rapidly losing about 13 of the initial energy after 18 periods of oscillation in contrast the dg2 solver on a uniform mesh achieves excellent energy conservation losing less than 1 of the initial energy after 18 periods despite the adaptive mwdg2 solver coarsening the solution to refinement level 7 it is only slightly more dissipative than the dg2 solver with mwdg2 losing less than 2 of the initial energy for such a dynamic oscillatory flow over a curved topography with wet dry fronts hfv1 with ε 10 3 delivers the same predictive accuracy as the uniform fv1 solver on the finest grid but is expected to be more costly to run section 3 1 5 employing hfv1 with bigger ε gives an under performance relative to the present accuracy of fv1 and so may not be a feasible option for this type of simulation the dg2 solver on the finest uniform grid shows excellent conservation properties for both mass and energy quantities the adaptive mwdg2 is likely to be more efficient than hfv1 for this type of simulation and preserves the conservation properties of the dg2 solver with inconsequential effects 3 7 numerical simulation of a laboratory dam break over a trapezoidal hump ozmen cagatay and kocaman 2011 conducted a laboratory flume experiment of a dam break flow over a trapezoidal hump this test involves a wet dry front advancing over a frictional topography wave overtopping on a building like hump and a topographically reflected shock wave in particular it is an ideal benchmark to validate the practicality of the hfv1 and mwdg2 solvers in modelling realistic aspects of shallow water flows in a multi scale setting and in relation to the increase in maximum refinement level the physical experiment ozmen cagatay and kocaman 2011 was conducted in an 8 9 m long acrylic glass flume with the configuration illustrated in fig 18 the topography and initial water elevation profile are the same for the numerical tests presented here with an initial zero discharge a reflective boundary condition is imposed at the upstream boundary and a transmissive boundary condition is imposed downstream the manning coefficient for acrylic glass is 0 01 m1 3 s 1 the water in the flume was photographed at regular time intervals and the water elevation profile was measured to an accuracy of about 1 mm experimental measurements of water elevation are compared with numerical solutions at time t 11 9 t 23 05 and t 41 84 where t is a nondimensionalised time t g h 0 t with h 0 0 25 m denoting the initial height behind the gate located at x 0 4 65 m numerical solutions are obtained using the fv1 and dg2 solvers on a uniform mesh with 2 l elements and adaptive hfv1 and mwdg2 solvers on a baseline grid with a single mother element a maximum refinement level l and with the default error threshold ε 10 3 tests are performed with l 7 9 and 11 corresponding to a finest grid spacing of δx 7 0 070 m δx 9 0 017 m and δx 11 0 0043 m or respectively to 128 512 and 2048 elements for the finest uniform grid as shown in fig 19 a 19c at l 9 the adaptive and uniform solutions closely agree with the experimental observations at t 11 9 t 23 05 and t 41 84 since the topography and fine scale flows are well resolved at δx 9 0 017 m while a similar behaviour for the adaptive and uniform solutions is expected at l 11 as δx 11 δx 9 with l 7 the topography and fine scale flow cannot be sufficiently resolved by the fv1 and hfv1 solvers using a piecewise constant basis fig 19d and 19e at t 11 9 fv1 and hfv1 simulations produce insufficient overtopping on the lee side of the obstacle fig 19d and at t 11 9 and t 23 05 fig 19e the reflected wave is positioned far upstream compared to the experimental observations numerical diffusion is particularly evident in the fv1 and hfv1 solutions at t 23 05 which is not present in the same solutions on the finer mesh using l 9 in contrast since the dg2 and mwdg2 solvers use a piecewise linear basis the fine scale features are still well resolved even at l 7 with δx 7 0 070 m using the same test kesserwani and wang 2014 achieved accurate dg2 solutions using a significantly coarser mesh of δx 0 22 m and obtained second order muscl fv solutions with errors similar to those obtained with the fv1 and hfv1 solvers in terms of refinement level predictions both adaptive hfv1 and mwdg2 solvers are observed to fully refine around the trapezoidal obstacle given the sloping character of its sides and the dynamic nature of the flow to realistically analyse efficiency benefits of the adaptive solvers their cumulative cpu time costs are further recorded for completing 30 s numerical simulations corresponding to t 188 s the elapsed cpu time is measured at every time step and these time series are illustrated for l 7 fig 20 upper part l 9 fig 20 middle part and l 11 fig 20 lower part at l 7 with δx 7 0 070 m the fv1 and adaptive hfv1 solvers complete the simulation the fastest fig 20 upper part but produce somewhat inaccurate solutions since the grid is relatively coarse fig 19 lower parts accurate solutions are achieved using the dg2 and mwdg2 solvers but the adaptive mwdg2 solver completes the simulation in about half the time of dg2 on a grid with 27 128 uniform elements at l 9 with δx 9 0 017 m the hfv1 and mwdg2 solvers complete the simulation around the same time fig 20 middle part the dg2 solver is about five times more computationally expensive and completes the simulation after 10 3 s of cpu time at this grid resolution the fv1 solver remains the most computationally efficient choice and produces a solution with similar accuracy to the other solvers fig 19 upper parts at l 11 with δx 11 0 0043 m no improvement in solution accuracy is expected since the flow in the 8 9 m long flume is already well resolved with coarser meshes however at l 11 the adaptive mwdg2 solver is surprisingly the first to finish the simulation followed by the fv1 and adaptive hfv1 solvers fig 20 lower part and compared to the dg2 solver on a uniform mesh the mwdg2 solver is 27 times faster clearly with increased maximum refinement level mwdg2 tends to become faster than the uniform fv1 solver on the finest grid and ultimately than the hfv1 solver in terms of resolution accuracy taking l 11 is unnecessary for this test as l 9 provide sufficient resolution but does still pay off with an increase in mwdg2 solver s efficiency given also that mwdg2 provides superior accuracy with l 7 i e up to a resolution of 0 070 m the mwdg2 solver could be even more beneficial in favour of accuracy when the finest resolution involved in the adaptive grid is roughly 0 1 m hence the mwdg2 solver seems to be a promising alternative for simulations over a large domain 10 km and more in horizontal length scale allowing multi scale features that are as small as 0 1 m nonetheless at a lower runtime cost than the uniform fv1 solver on the finest grid available and at nearly the same accuracy as the expensive uniform dg2 solver on the finest grid 4 summary and conclusions a scaled second order discontinuous galerkin dg2 solver of the shallow water equations swe was presented section 2 1 with guiding principles on how it extends to incorporate multiresolution analysis section 2 2 based on multiwavelets mw to form the so called adaptive mwdg2 solver section 2 3 our aim has been to explain this framework in a way that is understandable by water engineers and modellers and to unravel its relevant benefits for improving the accuracy efficiency and autonomy of godunov type hydrodynamic models in the adaptive mwdg2 solver flow and topography data at various resolution levels are compressed in a single dataset of details or wavelet coefficients section 2 3 1 from these details a multiresolution dg2 solution can be created and assembled on a non uniform grid by retaining the significant details and adding them to the coarsest solution discretisation significant details were identified by comparing their magnitude to an error threshold ε section 2 3 2 the scaled dg2 solver can directly be applied to evolve the multiresolution dg2 solution on an adaptive non uniform grid section 2 3 3 zero valued detail coefficients were imposed to complete the dataset of details as time evolved section 2 3 4 a first order version was produced based on the haar wavelet within the finite volume hfv1 method section 2 4 the behaviour of the adaptive hfv1 and mwdg2 solvers was studied systematically and compared against the standard first order finite volume fv1 and second order discontinuous galerkin dg2 solvers on a uniform grid seven tests were used to diagnostically explore the performance of the adaptive multi wavelet based solvers which covered all the elementary aspects relevant to accurate efficient and robust hydraulic modelling section 3 adaptive solver simulations started from a coarsest grid discretisation with m mother elements with each allowing a maximum of 2 l sub elements a maximum refinement level l yielding m number of sub elements m 2 l the uniform solver simulations considered the grid at the finest resolution available with m 2 l elements the numerical results consistently reinforced the conclusion that the multi wavelet based solvers offer many attractive properties including the ability to i automate the formulation of an initial multiresolution mesh ii use very few or a single mother element s as a baseline grid iii allow large gaps across resolution levels iv preserve robustness accuracy and conservation properties of the standard uniform solvers and v adapt modelling resolution and data simply with reference to the user prescribed error threshold ε more strikingly findings from this study newly identify a range for the error threshold ε where the adaptive mwdg2 solver can deliver simulations that are not only as accurate as the uniform dg2 simulations but also faster than the simulations delivered by both the adaptive hfv1 solver and the uniform fv1 solver mainly mwdg2 outperformed hfv1 as a result of the sloping nature of its local piecewise linear solutions which allowed much more aggressive coarsening at the zones in the flow solution and topographic data involving different levels of smoothness at these zones the adaptive hfv1 solver consistently over refined up to becoming even more expensive than the uniform fv1 solver since hfv1 was dominated by a wavelet adaptivity overhead in contrast the adaptive mwdg2 solver more sensibly predicted coarser solutions and did not access the finest resolution level unless necessary around very steep solution gradients the efficiency of the adaptive mwdg2 solver was found to increase by increasing the maximum refinement level l though its predictive accuracy remained visually close to the first order solver predictions at a very fine resolution namely around δx l 0 07 m our results therefore offer new evidence that an mwdg2 modelling approach has the potential to increase the accuracy runtime efficiency and spatial coverage for hydraulic modelling applications for which the maximum refinement level is associated with an urban resolution grid approx around 0 1 m in horizontal length scale a robust two dimensional 2d extension of the mwdg2 approach on quadrilateral elements is under development and testing to enable a more realistic assessment of the true potential of multi wavelet based approaches for 2d hydraulic modelling applications acknowledgements the authors wish to thank dr matthias rauter norwegian geotechnical institute for providing the semi analytical solution of the 1d frictional dam break test case and mr xitong sun for his insightful discussions on the derivation of the high pass filters we also thank prof onno bokhove university of leeds for their helpful advice during the testing and validation of the adaptive wavelet based numerical solver this work is part of the seamless wave project software infrastructure formulti purpose flood modelling at various scales based on wavelets which is funded by the uk engineering and physical sciences research council epsrc grant ep r007349 1 for information about the seamless wave project visit https www seamlesswave com appendix 1 instructions for running the fv1 dg2 hfv1 and mwdg2 solvers compilation the seamless wave numerical solvers are implemented in fortran 2003 and can be compiled using a recent version of gfortran and cmake other fortran compilers have not been tested to compile the code from the root directory of the unzipped zenodo download mkdir build cd build cmake make j running the numerical solvers the fv1 dg2 hfv1 and mwdg2 solvers are all implemented in a single executable run simulation to display usage information about required and optional command line switches run simulation help all the test cases that appear in this article are preconfigured to run one of the test cases run simulation testcase maxrefinementlevel solver solver writer writer where testcase is one of dambreakwet section 3 1 dambreakdry frictionless dambreakmanning frictional section 3 2 dambreakupslope dambreakdownslope section 3 3 lakeatrest section 3 4 steadysubcritical steadysupercritical steadytranscriticalshock section 3 5 parabolicbowlswashes section 3 6 dambreakonehump section 3 7 to solve on a uniform mesh use maxrefinementlevel to create a mesh with 2l elements and choose solver to be either fv1 or dg2 to calculate an adaptive solution include the switch epsilon value with value being a double precision number between 0 and 1 when epsilon is specified adaptive refinement is allowed up to the given maxrefinementlevel solver is still either fv1 or dg2 for an adaptive solution the solver will write space delimited plain text data depending on the choice of writer the following writers output data corresponding to the end of the simulation cellcentresolution topography water depth discharge and refinement level data piecewisesolution as cellcentresolution but data is at the interface limits l2error calculate the ℓ2 error between numerical and analytic solutions the following writers output data at every timestep cpu elapsed cpu time timestep size of δt elementcount total element count convergence ℓ2 convergence in water depth energy domain integrals of mass and energy wetdryfront the position of the wet dry front sample sample data at a specified sample position additional optional switches are documented by using run simulation help 
626,we imaged the steady state flow of brine and decane oil at different fractional flows during dual injection in a micro porous limestone estaillades using x ray micro tomography we applied differential imaging to a distinguish micro porous regions from macro pores and b determine fluid pore occupancy in both regions and relative permeability at a capillary number ca 7 3 10 6 the sample porosity was approximately 28 with 7 in macro pores and 21 in pores that could not be directly resolved micro porosity fluid occupancy in micro porosity was classified into three sub phases micro pore space with oil micro pore space with brine and micro pores partially filled with oil and brine our method indicated an initially higher oil recovery from micro porosity consistent with waterflooding in a water wet rock the fractional flow and relative permeabilities of the two fluids were obtained from measurements of the pressure differential across the sample and the saturation calculated from the images the brine saturation and relative permeabilities are impacted by the presence of water wet micro porosity which provides additional connectivity to the phases furthermore we find that in addition to brine and decane a fraction of the macroscopic pore space contains an intermittent phase which is occupied either by brine or decane during the hour long scan time pore and throat occupancy of oil brine and intermittent phase were obtained from images at different fractional flows using the generalized pore network extracted from the image of macro pores the intermittent phase where the occupancy fluctuated between oil filled and brine filled was predominantly located in the small and intermediate size pores and throats overall we establish a new experimental methodology to i quantify initial and recovered oil in micro pores ii characterise intermittent flow and iii measure steady state relative permeability in carbonates which is shown to be greatly influenced by micro porosity keywords micro ct imaging two phase flow micro porosity relative permeability intermittency differential imaging 1 introduction carbonates are known to have a complex pore space whose heterogeneous structure and connectivity have a significant impact on flow transport and reactive properties gouze et al 2008 bijeljic et al 2013 norouzi apourvari and arns 2016 in particular micro porosity while it may control the flow and transport behaviour is challenging to describe using current imaging and modelling methods ghous et al 2007 tian and wang 2018 x ray computed micro tomography micro ct has been used to image multiphase flow configurations in geologically related studies complex pore scale phenomena in carbonates have been captured at reservoir conditions and related petrophysical parameters measured directly in the pore space arns et al 2005 akbarabadi and piri 2013 blunt et al 2013 wildenschild and sheppard 2013 mahani et al 2015 when combined with an appropriate image processing method the wealth of information on multi fluid distributions in complex pore geometries can be obtained directly from a micro ct experiment recently an improved understanding of the role of micro porosity in single phase flow in carbonates lin et al 2016 bijeljic et al 2018 and two phase flow in a dual porosity sandstone lin et al 2017 has been provided using differential imaging micro tomography importantly the differential imaging method provides information on additional connectivity between macro pores through micro porosity the quantification of micro porosity can then be used in modelling studies bijeljic et al 2018 tian and wang 2018 furthermore differential imaging was used during steady state two phase flow in bentheimer sandstone gao et al 2017 in which an intermittent phase was distinguished in the macroscopic pore space which was periodically occupied by either oil or brine this method is designed to capture rapid displacements during the comparatively slow micro ct scan in this work we will combine these two applications of differential imaging to study two phase flow in a micro porous carbonate for which the pore space is more complex multiphase flow is controlled by the balance between capillary and viscous forces which is impacted by several factors including wettability and pore structure blunt 2017 different flow regimes are characterized by the ratio of viscous to capillary forces conventionally described by the capillary number ca μv σ where µ is the mean viscosity of the flowing phases υ is the total darcy velocity and σ is the interfacial tension at sufficiently low ca both oil and the aqueous phase water or brine flow through unchanging distinct and connected pathways in contrast the non wetting fluid is broken up into discrete ganglia at sufficiently high ca chatenever and calhoun jr 1952 payatakes 1982 avraam and payatakes 1996 tallakstad et al 2009 this behaviour can be encapsulated in a phase or regime diagram datta et al 2014a 2014b armstrong et al 2016 using fast synchrotron imaging at high ca ganglion dynamics was observed in a sandstone rücker et al 2015a furthermore reynolds et al 2017 observed dynamic changes in connectivity even at low ca in a bentheimer sandstone gao et al 2017 also observed intermittent pore occupancy of brine and decane during simultaneous injection in the pore space of bentheimer sandstone for ca 7 5 10 6 pak et al 2015 studied displacement in a complex carbonate and showed how large trapped ganglia of the non wetting phase are broken up for ca 10 5 however the role of micro porosity on the pore scale displacement dynamics has not been explored relative permeability describes the averaged flow behaviour of immiscible fluids and is used to predict field scale oil recovery carbon dioxide storage and contaminant transport compared with the expensive and time consuming conventional measurement of relative permeability at the cm scale using steady state or unsteady state methods johnson et al 1959 kokkedee et al 1996 pore scale imaging not only provides insights into displacement processes but the flow experiments can be faster since the volume investigated is typically smaller than a standard core sample turner et al 2004 and hussain et al 2014 computed the relative permeability from the fluid distribution imaged during a displacement when flow was stopped during scanning the same approach was employed using fluid distributions found from a synchrotron imaging imbibition experiment in a water wet sandstone without stopping flow berg et al 2015 2016 rücker et al 2015b however the relative permeabilities were not directly measured from the pressure drop across the sample but inferred from a flow computation on the image which may introduce considerable uncertainties for the case of carbonates where it is challenging to resolve all the pore space explicitly aghaei and piri 2015 measured and computed the relative permeability from micro ct images for both drainage and imbibition experiments in a water wet sandstone zou et al 2018 extended this work to study a mixed wet sandstone and to explore the pore scale displacement dynamics however these studies did not consider carbonate rocks with complex pore geometries and significant micro porosity gharbi and blunt 2012 blunt et al 2013 ott et al 2015 prodanović et al 2015 in our previous work gao et al 2017 lin et al 2018 we developed a method based on differential imaging to visualise flow regimes both at low and high ca combined with a direct measurement of relative permeability for bentheimer sandstone as mentioned previously intermittent pore occupancy was observed at high flow rates in this paper we examine pore occupancy in two phase flow in the complex pore space of estaillades carbonate with significant sub resolution micro porosity our goal is to examine the impact of micro porosity on fluid distribution and relative permeability measured directly from the pressure differential at different fractional flows the ratio of brine flow rate to the total flow rate of oil and brine during a steady state experiment 2 experimental methodology 2 1 rock samples and fluid properties the sample used here is estaillades carbonate which contains approximately 97 9 calcite and 2 1 quartz analysis conducted at weatherford laboratories east grinstead uk the sample called a core was a cylinder 6 01 0 01 mm in diameter and 51 34 0 01 mm in length the absolute permeability of the same sample was found from darcy s law and the pressure differential measured at two flow rates 0 2 ml min and 0 5 ml min to be 1 06 0 02 10 13 m2 the total porosity estimated from the micro ct image in section 3 2 was 28 4 0 5 out of which micro porosity accounted for 21 5 while the macro porosity was 6 9 the helium porosity of the same sample was 30 3 0 2 the image based value is slightly lower indicating that some micro porosity was not captured the non wetting phase was decane that has a density of 730 kg m3 n decane acros organics and a viscosity of 0 838 mpa s provided by pubchem open chemistry database to provide an optimal contrast between brine oil and rock phases 30 wt potassium iodide ki brine was used as the wetting aqueous phase the density of brine was measured to be 1263 2 kg m3 at ambient conditions by weighing a 1 ml drop of the liquid the viscosity of brine is 0 82 0 01 mpas using the pendant drop method andreas et al 1938 stauffer 1965 the interfacial tension between brine and decane was measured to be 47 2 mn m at ambient conditions by a ramé hart apparatus 590 f4 series 2 2 in situ x ray tomography methodology fig 1 shows our experimental design we used a hassler type flow cell made of carbon fibre around 1 mm thick that is transparent to x rays the estaillades sample was placed in a fluoro polymer elastomer viton sleeve approximately 1 mm thick and metal fittings at both ends were used to connect the core to the fluid flow lines brine and decane were injected through two separate ports to ensure that two fluids flowed into the sample simultaneously the total flow rate of this experiment was 0 7 ml min which was kept fixed during the whole experiment at various fractional flows the capillary number was calculated from the total flow rate the viscosity used in the calculation of capillary number is the mean value of oil and brine viscosities thus the capillary number for this experiment was 7 3 10 6 the fractional flow was defined as the volumetric injection rate of the aqueous phase divided by the total fluid rate of both the oil and aqueous phases fw qw qt where qw is the aqueous brine phase darcy velocity and qt is the total velocity the capillary number is at the upper end of that encountered in reservoir settings and was chosen so that some intermittent flow would be observed based on our previous work in a sandstone gao et al 2017 the experiments were performed using the following procedure 1 a confining pressure of 2 mpa was established within the cell to compress the viton sleeve outside the sample to prevent any fluid bypass two dry air scans were taken of the upper and lower parts of the core over a period of 80 min at ambient conditions the overlap between the scans was approximately 25 this overlap was used to stitch the two scans together 2 co2 was injected into the rock sample for more than 30 min to replace the air 3 brine was injected and the sample was fully saturated with brine a differential pressure transducer pd 33x keller was installed along the tubing the linked to the tubing at the inlet of the core holder and the linked to the tubing of the outlet of core holder the tubing between the main flow line and the transducer remained full of brine during the experiment and it was assumed that the transducer measured the pressure difference in the brine phase the range of the differential pressure transducer was 50 000 kpa and the accuracy was 0 05 for the whole range 4 more than 1000 pore volumes of brine were flushed into the sample at 1 ml min to ensure the rock was fully filled with brine 1000d high pressure syringe pumps were used to inject both oil and brine teledyne isco syringe pumps the flow range of the pump was from 0 1 ml min to 408 ml min and the accuracy was 0 5 5 two brine scans lasting 80 min were taken as the same position as the dry scans a back pressure of 2000 kpa was set for the whole system 6 oil was injected primary drainage at a high flow rate of 2 ml min for 30 min to obtain a uniform initial brine saturation 7 oil injection was continued at a flow rate of 0 7 ml min while the brine fractional flow was 0 injection continued until the flow reached steady state which could be recognized by observing a stable and constant pressure drop for more than 2 h in our experiment it took approximately 20 h to reach steady state then scans were taken at the same position of the core over a period of 80 min without stopping the flow 8 step 7 was repeated for fractional flows fw of 0 15 0 3 0 5 0 7 and 0 85 while keeping the total volumetric flow rate fixed the oil flow rate decreased from 0 595 ml min to 0 105 ml min and the brine flow rate increased from 0 105 ml min to 0 595 ml min this whole process was an imbibition displacement in this water wet sample brine was the wetting phase at the same time the pressure drop across the whole sample was recorded during the experiment it took approximately 16 25 h for each fractional flow experiment to reach steady state two scans were taken at the same position of the core over a period of 80 min without stopping the flow 9 high flow rate 2 ml min brine injection was performed for 30 min to reach the residual oil saturation then brine injection continued at 0 7 ml min to measure the steady state pressure difference when the fractional flow was 1 10 after cleaning all the tubing and end fittings used in the experiment steps 7 to 9 were applied to the whole system without the rock sample the pressure drops of the tubing itself were recorded at all fractional flows which ranged from 2 kpa to 20 kpa the lowest pressure drop was obtained when f w was 0 while the largest was obtained when f w was 0 85 11 the pressure differences along the cores were calculated by subtracting the pressure drops along the tubing measured at step 10 from the total pressure drops measured from steps 7 to 9 the fluid configurations were imaged using a zeiss xrm 510 x ray microscope at a voxel size of 3 58 µm using a flat panel detector the x ray energy was 75 kev the exposure time was 0 5 s and the number of projections was 1601 all these projections were reconstructed into a three dimensional image using proprietary software on the versa system two images were taken and then stitched together to obtain a larger field of view to analyse then the stitched images were cropped into cylindrical sections to avoid the sleeve shown at the boundaries of the core the stitched image size was 1582 1582 2789 voxels 5 66 mm in diameter and 9 98 mm in length which represents a bulk volume of 251 1 mm3 all reconstructed images were registered to the dry scan image to have the same orientation and the lanczos algorithm was used to resample them burger and burge 2016 3 results and discussion we first present the differential imaging method used to distinguish micro and macro pore space in section 3 1 then in sections 3 2 and 3 3 we demonstrate how to quantify the fluid occupancy in the micro and macro pore space using the differential imaging method furthermore in section 3 4 we study change in fluid occupancy with fractional flow while the associated steady state relative permeability measurements are presented in section 3 5 in section 3 6 we quantify and examine the intermittent phase dependence on pore and throat size 3 1 characterization of micro and macro pore space in contrast to the earlier studies on sandstones estaillades carbonate has a bimodal pore structure with inter granular macro porosity and micro porosity whose pore throat radius distribution clearly shows two peaks around 0 2 and 10 µm from mercury injection capillary pressure analysis bijeljic et al 2013 alyafei and blunt 2016 as shown in the cross sectional images in fig 2 fig 2a and b show the images of the dry scan and the scan of the sample saturated with 30wt ki brine respectively we have designed the experiment so that brine has the strongest x ray adsorption even greater than solid and appears bright white in the raw images using the differential imaging method we subtract the dry scan from the brine scan to distinguish micro porosity from macroscopic pore space fig 2c is the difference image between fig 2b and a from which solid grain macro pore space and micro porosity can be discriminated a non local means filter was applied on the differential images to reduce the noise while preserving edges buades et al 2005 2008 then intensity based thresholding was used to segment the image into different phases lin et al 2016 the histogram of the grey scale ct numbers which represents the x ray attenuation for the dry scan is presented in fig 3 here solid grain micro porous and macro pore space can be distinguished for which fluid occupancy is studied in sections 3 2 and 3 3 3 2 fluid occupancy and porosity in the micro pore space grey scale images are illustrated in fig 4 where two dimensional cross sections of three dimensional raw micro ct images over a range of fractional flows are presented the grey represents grains and intermittent phase in macro pores as well as micro porosity the black is stable oil in macro pores while the white is brine in macro pores the first observation is that there are some voxels in the micro porous space which did not change grey scale value for all fractional flows indicating that they were always filled with brine the second observation is that with increasing fractional flow some voxels in the micro porous space significantly increased their grey scale value which became similar to the value of brine only voxels these are the regions which are indicated by the red circles this shows that oil in the micro porosity was displaced by brine differential imaging can be used to discriminate the fluid occupancy in micro porosity separating the voxels filled only with brine and the voxels that were partially filled by brine and oil this fluid occupancy was then determined by calculating the difference image between the fully brine saturated scan and the scan at each fractional flow image normalization was then used to ensure that the grey scale value of each voxel was the same for the images taken at different fractional flows if the fluid occupancy was unchanged thus the peak values of the grey scale histogram distribution for multiphase images were rescaled to be the same as those of the brine saturated image then the difference image between the brine scan and the multiphase flow scan is defined as 1 c t difference c t brine scan c t multiphase scan c t 0 where ct is the ct number of each voxel and ct0 is a constant value to avoid negative grey scale values the difference images between the brine saturated scan and the multiphase flow scan clearly identify changes in fluid occupancy fig 5 shows the difference images at different fractional flows for this experiment black represents solid grain phase and unchanged brine while white indicates oil in macro pores there are also grey regions which can represent either an intermittent phase indicating that some of the time these regions were oil filled and at other times brine filled during the scan time of 40 min or oil in the micro porous phase as shown in the red circles 3 2 1 determination of fluid occupancy based porosity based on the analysis of oil and brine pore occupancy at all fractional flows we found that 85 5 of the micro pore space was saturated only with brine see table 1 oil did not occupy these pores because of the high capillary entry pressure hence we distinguished four phases solid grain micro pore phase i always occupied by brine micro pore phase ii which contains both oil and brine and macro pore space as shown in fig 6 the histograms of ct number for all grey scale voxels in the dry image are plotted for each phase as shown in fig 7 the red curve represents solid grain phase the green represents micro pore phase i the orange represents micro pore phase ii and the blue represents macro pore phase in the dry image the contribution to the total porosity from micro pore phase ii was estimated as 2 ϕ m i c r o p o r e ii p m i c r o p o r e ii ϕ m i c r o p o r e ii p m i c r o p o r e ii c t m i c r o p o r e ii c t s o l i d g r a i n c t m a c r o p o r e c t s o l i d g r a i n where ϕ microporeii is the porosity contribution of micro pore phase ii p microporeii is the fraction of the micro pore phase ii to the total volume including grains ϕ m i c r o p o r e ii is the porosity of the micro pore phase ii which was calculated to be 0 70 in this sample the grey scale values where the peak values are located for each pore space in the histogram are denoted as ctsolidgrain for the solid grain phase ctmicropore i for the micro pore phase i occupied by brine only ctmicropore ii for the micro pore phase ii occupied by brine and or oil and ctmacropore for the macro pore phase the porosity of each phase measured using the differential imaging method is shown in table 1 3 2 2 fluid occupancy in micro pore space flow heterogeneity in carbonates is affected by the presence of micro porosity using the differential imaging method we now distinguish pore occupancy in the microscopic pore space the raw images were segmented based on the four phase masks shown in fig 6 and the difference images shown in fig 5 furthermore oil brine and partially filled micro pores were segmented based on the grey scale distribution histogram of micro pore space ii shown in fig 8 in the multiphase images the contribution to the brine saturation in the partially filled micro pores was estimated as 3 s w p f m i c r o p o r e ii ϕ p f m s w ϕ p f m c t p f m i c r o p o r e s c t o i l c t b r i n e c t o i l where s w p f m i c r o p o r e ii is the contribution to the brine saturation in partially filled micro pores in micro pore space ii ϕ pfm is the fraction of the partially filled micro pore space to the total pore volume of micro pore space ii the grey scale values where the peak values are located for each phase in the histogram are denoted as ctoil for the oil in micro pore space ii ctpfmicropores for the partially filled micro pores and ctbrine for the brine in micro pore space ii for a fractional flow of 0 5 the fraction of brine in partially filled micro pore space is 0 333 shown in fig 8 and the fraction of the partially filled micro pores in total pore space is 0 192 shown in table 2 so the contribution to the total brine saturation from partially filled micro pores in micro pore space ii is the product of these two numbers giving the value of 0 064 fluid occupancy in micro pore space for all fractional flows is provided in table 2 3 3 fluid occupancy in the macro pore space the differential image shown in fig 5 was segmented to obtain the oil phase white and the intermittent phase grey in the macro pores then the brine phase was obtained by subtracting the oil and intermittent phase from the macro pore phase the fluids in the macro pores shown in fig 9 was segmented into brine blue oil red and intermittent yellow phases using these segmented label images as a reference separate raw images for each phase were extracted fig 10 shows the histograms of the grey scale values of the image at a fractional flow of 0 5 for the oil brine and intermittent phase of the macro pore space in the macro pore space the contribution of the intermittent phase in the macro pores to the brine saturation was estimated as 4 s w i n t e r m a c r o p o r e ϕ i n t e r s w ϕ i n t e r c t i n t e r m i t t e n c y c t o i l c t b r i n e c t o i l where s w i n t e r m a c r o p o r e is the contribution of the intermittent phase to the brine saturation and ϕ inter is the fraction of the intermittent phase to the total pore volume the grey scale values where the peak values are located for each phase in the histogram were denoted as ctoil for the stable oil phase ctintermittency for the intermittent phase ctbrine for the stable brine phase and s w denotes the proportion of brine in the intermittent phase for illustration for a fractional flow of 0 5 the fraction of brine in the intermittent phase is 0 470 shown in fig 10 and the fraction of the intermittent phase in total pore space is 0 237 shown in table 2 hence the contribution to the total brine saturation in the intermittent phase is 0 111 in the next section we provide fluid occupancy in the macro pore space for all fractional flows 3 4 fluid occupancy in the macro and micro pore space and dependence on fractional flow the brine saturation in the micro pore space macro pore space and the total saturation along the image are shown in fig 11 the uncertainty in saturation averaged over each slice of the total pore space is approximately 3 including 2 for micropores and 1 for macropores the amount of brine in the macro pore space was approximately constant however the fraction of brine in the micro pore space varied along the image because estaillades has a heterogeneous pore structure overall the brine saturation was not uniform along the image because micro porosity made a significant contribution to the total brine saturation from the profiles we observe that a considerable fraction of micro porosity became occupied by brine that displaced oil when the fractional flow was initially increased from 0 to 0 15 further increases resulted in a smaller oil displacement that is non uniform along the core reflecting the complex micro porous space these findings illustrate that in a water wet rock pore filling during waterflood occurs in order of increasing size and hence the micro porosity is preferentially filled first this is further confirmed from the plots of remaining oil saturation in micro and macro pore space shown in fig 12 the normalised oil saturation decreased faster in the micro porous regions with smaller pores until a fractional flow of 0 85 table 2 lists the fractions of oil and brine in the macro and micro porous regions 3 5 relative permeability as mentioned in section 2 2 the pressure difference across the rock sample at steady state conditions was measured using the differential pressure transducer shown in fig 1 fig 13 shows the mean pressure differentials at different fractional flows during the last two hours as well as the corresponding standard deviation we have subtracted the pressure drop in the flow lines themselves see step 10 of the experimental procedure in section 2 2 when the fractional flow was 0 and 1 the pressure profile was smooth which indicates an unchanging fluid configuration however there were rapid pressure fluctuations during intermediate fractional flows as observed previously sinha and hansen 2012 sinha et al 2017 for this experiment the range of the fluctuations was from 0 55 kpa to 8 63 kpa in the bentheimer experiment at the same ca gao et al 2017 the range was from 0 12 kpa to 10 72 kpa the pressure fluctuations are indicative of pore scale rearrangements and have a magnitude equal to a typical capillary pressure which is approximately 12 5 kpa calculated from 2σ r where σ is the interfacial tension and r is the average throat radius of 7 5 µm for estaillades blunt 2017 the relative permeability was calculated by 5 k r w q w μ w l δ p k k r o q o μ o l δ p k where krw is the brine relative permeability kro is the oil relative permeability μ w is the brine viscosity pa s μ o is the oil viscosity pa s qw is the brine darcy velocity flow rate per unit area m s qo is the oil darcy velocity m s l is the length of the whole sample m k is the absolute permeability m2 and δp is the pressure difference across the sample pa we do not need to correct for capillary pressure gradients the capillary end effect as there is no discernable saturation gradient across the core see fig 11 lin et al 2018 table 3 shows the wetting phase saturation and the measured oil and brine relative permeabilities at each fractional flow the saturation values shown in the table are calculated from the scanned region of the core fig 14 shows the estimated fractional flow curves at steady state for estaillades carbonate studied here and bentheimer sandstone measured in previous work gao et al 2017 together with the relative permeabilities for these two rocks the uncertainties in saturation are estimated from the root mean square uncertainties in phase volume total volume and porosity during image segmentation in both figures the uncertainties in relative permeability consider uncertainties in the measurement of the length and diameter of the sample the absolute permeability pressure measurements accuracy of the pressure transducers and the pump rates at the end of primary drainage the initial brine saturation for estaillades was 0 588 0 020 while at the end of imbibition the residual oil saturation was 0 145 0 016 the initial brine saturation for bentheimer was 0 145 0 031 while the residual oil saturation was 0 337 0 030 both the sandstone and carbonate samples are strongly water wet the micro porosity has a significant impact on the relative permeability of estaillades carbonate since brine occupies micro pores there is a considerable shift to higher brine saturations compared to bentheimer sandstone moreover the estaillades water brine relative permeability rises more steeply and to higher values which is an indication of the enhanced permeability and connectivity from micro porous regions the residual oil saturation is lower than in the sandstone this is partly due to the higher initial brine saturation and also due to additional connectivity through oil filled micro porosity preventing complete disconnection of the oil in contrast the oil that only occupies a small fraction of the micro porosity has a relative permeability that is similar in shape to the sandstone albeit shifted to higher brine saturation 3 6 pore and throat occupancy of the intermittent phase we now test the hypothesis that the existence of intermittent phase in the macroscopic pore space depends on pore and or throat size a generalized pore network extraction algorithm raeini et al 2017 was used to subdivide macroscopic pore space into pores bounded by throat surfaces each voxel is assigned to a unique pore as well as to a unique throat the closest throat surface the volume of the pore and throat voxels and their inscribed radii were used to analyse the statistics of the pore and throat fluid occupancy the pores and throats in the network were sorted based on their radii and divided into bins of equal volume these bins are then used to compute the volume fraction of pores and throats in each bin whose centres were filled with oil brine or the intermittent phase fig 15 shows the results for different fractional flow images as expected for a water wet brine wetting medium the oil occupies the larger pores while brine preferentially resides in small pores and throats there is more brine in the throats than pores as throats represent restrictions in the void space however brine is seen in some larger elements and in general the tendency for brine to reside strictly in the smaller pores and throats is less marked than that observed in water wet sandstones bultreys et al 2018 in particular when the oil is trapped for fw 1 we see oil and brine in elements of all sizes with only a weak preference for oil to remain in larger pores the reason for this is likely to be the presence of micro porosity as shown in table 2 some oil also resides in the micro porosity hence a much wider range of pore sizes are occupied by both phases than encountered typically in sandstones the exact occupancy will be controlled by pore size local pore geometry and connectivity and we even see some oil trapped in the micro porosity at the end of the experiment fig 11 as evident in fig 15 we mostly see the intermittent phase for intermediate fractional flows for fw 0 and fw 1 the flow paths are fixed as only one phase is flowing however when both phases simultaneously flow through the rock there are regions of the pore space where during the period of the scan sometimes oil is present and sometimes brine this shows that the flow pathways are not fixed but that a dynamic or intermittent connectivity is observed this fluctuating occupancy has been seen directly using fast synchrotron imaging in bentheimer sandstone reynolds et al 2017 intermittency has also been seen in bentheimer at the same ca and fluids as considered here gao et al 2017 compared to the sandstone however the fraction of the pores occupied by the intermittent phase in the carbonate was smaller for example when fw 0 5 the fraction of the pores occupied by the intermittent phase in the macro pore space was 0 24 in estaillades while it was 0 33 in bentheimer sandstone the intermittent phase is seen mainly in the intermediate sized and smaller macro pores as opposed to only the intermediate sized pores in a sandstone the physical explanation of intermittency is that the flowing fluids have sufficient energy to periodically open more conductive flow channels reynolds et al 2017 at lower flow rates there is insufficient energy to overcome the capillary pressure barriers that block short cuts in the flow in a carbonate oil and brine are also present in micro porosity and so it is not surprising that even some of the smaller macro pores allow intermittent connectivity at moderately high flow rates facilitating flow through both the macro and micro porous regions 4 conclusions we have established a novel experimental and image analysis methodology to measure the pore occupancy relative permeability and flow intermittency in a complex micro porous carbonate we have demonstrated this by conducting steady state waterflood experiments on an estaillades limestone sample at a capillary number ca 7 3 10 6 and performing differential imaging to distinguish macro pore space explicitly resolvable in the image and micro porosity together with fluid occupancy estaillades is a heterogeneous carbonate composed of approximately 27 solid grains 7 macro pores and 66 micro pores that could not be explicitly resolved from micro ct images we were able to quantitatively describe four phases solid grain pores occupied only by brine micro pore space i micro pores partially filled by oil and brine micro pore space ii and macro pore space which itself can contain oil water or can be intermittent during multiphase flow we could distinguish three types of fluid occupancy in the micro pore space ii filled with oil filled with brine and partially saturated with both brine and oil present the micro porosity contributed significantly to the total porosity the fully brine saturated portion of the pore space approximately 57 of the total pore volume of the rock contributed to a large initial brine saturation after primary drainage shifting the relative permeabilities to the right compared to bentheimer sandstone however some of the micro porosity approximately 10 of the whole sample initially contained oil that was displaced during waterflooding the enhanced connectivity of the pore space through micro porosity led to a higher end point water relative permeability and a lower residual oil saturation than observed for a sandstone under similar conditions our method indicated initially relatively higher recovery from micro porosity this is expected in a water wet rock where the wetting phase preferentially fills the smaller pores in the macro pore space the intermittent phase was identified by the differential imaging method showing that there were some regions of the pore space that were occupied alternately by oil and brine the intermittent phase was seen principally in the smaller and intermediate sized pores and the fraction of the pore space showing this fluctuating occupancy was slightly smaller than in bentheimer sandstone under the same conditions this experimental technique is readily applicable to other systems in which micro porosity plays an important role including mixed wet carbonates future work could include a wide variety of the pore scale multiphase flow problems including those at the conditions representative of subsurface aquifers oil and gas fields and other deep geological systems acknowledgements we gratefully acknowledge funding from the qatar carbonates and carbon storage research centre qccsrc provided jointly by qatar petroleum shell and the qatar science technology park and the imperial college consortium on pore scale modelling the authors acknowledge mr graham nash dr edward bailey dr saurabh shan and mr vincenzo cunsolo for their assistance in the laboratory the experimental data are available online at https www bgs ac uk services ngdc citeddata catalogue f899eb2f 37a4 4dec 9b59 432f11250894 html 
626,we imaged the steady state flow of brine and decane oil at different fractional flows during dual injection in a micro porous limestone estaillades using x ray micro tomography we applied differential imaging to a distinguish micro porous regions from macro pores and b determine fluid pore occupancy in both regions and relative permeability at a capillary number ca 7 3 10 6 the sample porosity was approximately 28 with 7 in macro pores and 21 in pores that could not be directly resolved micro porosity fluid occupancy in micro porosity was classified into three sub phases micro pore space with oil micro pore space with brine and micro pores partially filled with oil and brine our method indicated an initially higher oil recovery from micro porosity consistent with waterflooding in a water wet rock the fractional flow and relative permeabilities of the two fluids were obtained from measurements of the pressure differential across the sample and the saturation calculated from the images the brine saturation and relative permeabilities are impacted by the presence of water wet micro porosity which provides additional connectivity to the phases furthermore we find that in addition to brine and decane a fraction of the macroscopic pore space contains an intermittent phase which is occupied either by brine or decane during the hour long scan time pore and throat occupancy of oil brine and intermittent phase were obtained from images at different fractional flows using the generalized pore network extracted from the image of macro pores the intermittent phase where the occupancy fluctuated between oil filled and brine filled was predominantly located in the small and intermediate size pores and throats overall we establish a new experimental methodology to i quantify initial and recovered oil in micro pores ii characterise intermittent flow and iii measure steady state relative permeability in carbonates which is shown to be greatly influenced by micro porosity keywords micro ct imaging two phase flow micro porosity relative permeability intermittency differential imaging 1 introduction carbonates are known to have a complex pore space whose heterogeneous structure and connectivity have a significant impact on flow transport and reactive properties gouze et al 2008 bijeljic et al 2013 norouzi apourvari and arns 2016 in particular micro porosity while it may control the flow and transport behaviour is challenging to describe using current imaging and modelling methods ghous et al 2007 tian and wang 2018 x ray computed micro tomography micro ct has been used to image multiphase flow configurations in geologically related studies complex pore scale phenomena in carbonates have been captured at reservoir conditions and related petrophysical parameters measured directly in the pore space arns et al 2005 akbarabadi and piri 2013 blunt et al 2013 wildenschild and sheppard 2013 mahani et al 2015 when combined with an appropriate image processing method the wealth of information on multi fluid distributions in complex pore geometries can be obtained directly from a micro ct experiment recently an improved understanding of the role of micro porosity in single phase flow in carbonates lin et al 2016 bijeljic et al 2018 and two phase flow in a dual porosity sandstone lin et al 2017 has been provided using differential imaging micro tomography importantly the differential imaging method provides information on additional connectivity between macro pores through micro porosity the quantification of micro porosity can then be used in modelling studies bijeljic et al 2018 tian and wang 2018 furthermore differential imaging was used during steady state two phase flow in bentheimer sandstone gao et al 2017 in which an intermittent phase was distinguished in the macroscopic pore space which was periodically occupied by either oil or brine this method is designed to capture rapid displacements during the comparatively slow micro ct scan in this work we will combine these two applications of differential imaging to study two phase flow in a micro porous carbonate for which the pore space is more complex multiphase flow is controlled by the balance between capillary and viscous forces which is impacted by several factors including wettability and pore structure blunt 2017 different flow regimes are characterized by the ratio of viscous to capillary forces conventionally described by the capillary number ca μv σ where µ is the mean viscosity of the flowing phases υ is the total darcy velocity and σ is the interfacial tension at sufficiently low ca both oil and the aqueous phase water or brine flow through unchanging distinct and connected pathways in contrast the non wetting fluid is broken up into discrete ganglia at sufficiently high ca chatenever and calhoun jr 1952 payatakes 1982 avraam and payatakes 1996 tallakstad et al 2009 this behaviour can be encapsulated in a phase or regime diagram datta et al 2014a 2014b armstrong et al 2016 using fast synchrotron imaging at high ca ganglion dynamics was observed in a sandstone rücker et al 2015a furthermore reynolds et al 2017 observed dynamic changes in connectivity even at low ca in a bentheimer sandstone gao et al 2017 also observed intermittent pore occupancy of brine and decane during simultaneous injection in the pore space of bentheimer sandstone for ca 7 5 10 6 pak et al 2015 studied displacement in a complex carbonate and showed how large trapped ganglia of the non wetting phase are broken up for ca 10 5 however the role of micro porosity on the pore scale displacement dynamics has not been explored relative permeability describes the averaged flow behaviour of immiscible fluids and is used to predict field scale oil recovery carbon dioxide storage and contaminant transport compared with the expensive and time consuming conventional measurement of relative permeability at the cm scale using steady state or unsteady state methods johnson et al 1959 kokkedee et al 1996 pore scale imaging not only provides insights into displacement processes but the flow experiments can be faster since the volume investigated is typically smaller than a standard core sample turner et al 2004 and hussain et al 2014 computed the relative permeability from the fluid distribution imaged during a displacement when flow was stopped during scanning the same approach was employed using fluid distributions found from a synchrotron imaging imbibition experiment in a water wet sandstone without stopping flow berg et al 2015 2016 rücker et al 2015b however the relative permeabilities were not directly measured from the pressure drop across the sample but inferred from a flow computation on the image which may introduce considerable uncertainties for the case of carbonates where it is challenging to resolve all the pore space explicitly aghaei and piri 2015 measured and computed the relative permeability from micro ct images for both drainage and imbibition experiments in a water wet sandstone zou et al 2018 extended this work to study a mixed wet sandstone and to explore the pore scale displacement dynamics however these studies did not consider carbonate rocks with complex pore geometries and significant micro porosity gharbi and blunt 2012 blunt et al 2013 ott et al 2015 prodanović et al 2015 in our previous work gao et al 2017 lin et al 2018 we developed a method based on differential imaging to visualise flow regimes both at low and high ca combined with a direct measurement of relative permeability for bentheimer sandstone as mentioned previously intermittent pore occupancy was observed at high flow rates in this paper we examine pore occupancy in two phase flow in the complex pore space of estaillades carbonate with significant sub resolution micro porosity our goal is to examine the impact of micro porosity on fluid distribution and relative permeability measured directly from the pressure differential at different fractional flows the ratio of brine flow rate to the total flow rate of oil and brine during a steady state experiment 2 experimental methodology 2 1 rock samples and fluid properties the sample used here is estaillades carbonate which contains approximately 97 9 calcite and 2 1 quartz analysis conducted at weatherford laboratories east grinstead uk the sample called a core was a cylinder 6 01 0 01 mm in diameter and 51 34 0 01 mm in length the absolute permeability of the same sample was found from darcy s law and the pressure differential measured at two flow rates 0 2 ml min and 0 5 ml min to be 1 06 0 02 10 13 m2 the total porosity estimated from the micro ct image in section 3 2 was 28 4 0 5 out of which micro porosity accounted for 21 5 while the macro porosity was 6 9 the helium porosity of the same sample was 30 3 0 2 the image based value is slightly lower indicating that some micro porosity was not captured the non wetting phase was decane that has a density of 730 kg m3 n decane acros organics and a viscosity of 0 838 mpa s provided by pubchem open chemistry database to provide an optimal contrast between brine oil and rock phases 30 wt potassium iodide ki brine was used as the wetting aqueous phase the density of brine was measured to be 1263 2 kg m3 at ambient conditions by weighing a 1 ml drop of the liquid the viscosity of brine is 0 82 0 01 mpas using the pendant drop method andreas et al 1938 stauffer 1965 the interfacial tension between brine and decane was measured to be 47 2 mn m at ambient conditions by a ramé hart apparatus 590 f4 series 2 2 in situ x ray tomography methodology fig 1 shows our experimental design we used a hassler type flow cell made of carbon fibre around 1 mm thick that is transparent to x rays the estaillades sample was placed in a fluoro polymer elastomer viton sleeve approximately 1 mm thick and metal fittings at both ends were used to connect the core to the fluid flow lines brine and decane were injected through two separate ports to ensure that two fluids flowed into the sample simultaneously the total flow rate of this experiment was 0 7 ml min which was kept fixed during the whole experiment at various fractional flows the capillary number was calculated from the total flow rate the viscosity used in the calculation of capillary number is the mean value of oil and brine viscosities thus the capillary number for this experiment was 7 3 10 6 the fractional flow was defined as the volumetric injection rate of the aqueous phase divided by the total fluid rate of both the oil and aqueous phases fw qw qt where qw is the aqueous brine phase darcy velocity and qt is the total velocity the capillary number is at the upper end of that encountered in reservoir settings and was chosen so that some intermittent flow would be observed based on our previous work in a sandstone gao et al 2017 the experiments were performed using the following procedure 1 a confining pressure of 2 mpa was established within the cell to compress the viton sleeve outside the sample to prevent any fluid bypass two dry air scans were taken of the upper and lower parts of the core over a period of 80 min at ambient conditions the overlap between the scans was approximately 25 this overlap was used to stitch the two scans together 2 co2 was injected into the rock sample for more than 30 min to replace the air 3 brine was injected and the sample was fully saturated with brine a differential pressure transducer pd 33x keller was installed along the tubing the linked to the tubing at the inlet of the core holder and the linked to the tubing of the outlet of core holder the tubing between the main flow line and the transducer remained full of brine during the experiment and it was assumed that the transducer measured the pressure difference in the brine phase the range of the differential pressure transducer was 50 000 kpa and the accuracy was 0 05 for the whole range 4 more than 1000 pore volumes of brine were flushed into the sample at 1 ml min to ensure the rock was fully filled with brine 1000d high pressure syringe pumps were used to inject both oil and brine teledyne isco syringe pumps the flow range of the pump was from 0 1 ml min to 408 ml min and the accuracy was 0 5 5 two brine scans lasting 80 min were taken as the same position as the dry scans a back pressure of 2000 kpa was set for the whole system 6 oil was injected primary drainage at a high flow rate of 2 ml min for 30 min to obtain a uniform initial brine saturation 7 oil injection was continued at a flow rate of 0 7 ml min while the brine fractional flow was 0 injection continued until the flow reached steady state which could be recognized by observing a stable and constant pressure drop for more than 2 h in our experiment it took approximately 20 h to reach steady state then scans were taken at the same position of the core over a period of 80 min without stopping the flow 8 step 7 was repeated for fractional flows fw of 0 15 0 3 0 5 0 7 and 0 85 while keeping the total volumetric flow rate fixed the oil flow rate decreased from 0 595 ml min to 0 105 ml min and the brine flow rate increased from 0 105 ml min to 0 595 ml min this whole process was an imbibition displacement in this water wet sample brine was the wetting phase at the same time the pressure drop across the whole sample was recorded during the experiment it took approximately 16 25 h for each fractional flow experiment to reach steady state two scans were taken at the same position of the core over a period of 80 min without stopping the flow 9 high flow rate 2 ml min brine injection was performed for 30 min to reach the residual oil saturation then brine injection continued at 0 7 ml min to measure the steady state pressure difference when the fractional flow was 1 10 after cleaning all the tubing and end fittings used in the experiment steps 7 to 9 were applied to the whole system without the rock sample the pressure drops of the tubing itself were recorded at all fractional flows which ranged from 2 kpa to 20 kpa the lowest pressure drop was obtained when f w was 0 while the largest was obtained when f w was 0 85 11 the pressure differences along the cores were calculated by subtracting the pressure drops along the tubing measured at step 10 from the total pressure drops measured from steps 7 to 9 the fluid configurations were imaged using a zeiss xrm 510 x ray microscope at a voxel size of 3 58 µm using a flat panel detector the x ray energy was 75 kev the exposure time was 0 5 s and the number of projections was 1601 all these projections were reconstructed into a three dimensional image using proprietary software on the versa system two images were taken and then stitched together to obtain a larger field of view to analyse then the stitched images were cropped into cylindrical sections to avoid the sleeve shown at the boundaries of the core the stitched image size was 1582 1582 2789 voxels 5 66 mm in diameter and 9 98 mm in length which represents a bulk volume of 251 1 mm3 all reconstructed images were registered to the dry scan image to have the same orientation and the lanczos algorithm was used to resample them burger and burge 2016 3 results and discussion we first present the differential imaging method used to distinguish micro and macro pore space in section 3 1 then in sections 3 2 and 3 3 we demonstrate how to quantify the fluid occupancy in the micro and macro pore space using the differential imaging method furthermore in section 3 4 we study change in fluid occupancy with fractional flow while the associated steady state relative permeability measurements are presented in section 3 5 in section 3 6 we quantify and examine the intermittent phase dependence on pore and throat size 3 1 characterization of micro and macro pore space in contrast to the earlier studies on sandstones estaillades carbonate has a bimodal pore structure with inter granular macro porosity and micro porosity whose pore throat radius distribution clearly shows two peaks around 0 2 and 10 µm from mercury injection capillary pressure analysis bijeljic et al 2013 alyafei and blunt 2016 as shown in the cross sectional images in fig 2 fig 2a and b show the images of the dry scan and the scan of the sample saturated with 30wt ki brine respectively we have designed the experiment so that brine has the strongest x ray adsorption even greater than solid and appears bright white in the raw images using the differential imaging method we subtract the dry scan from the brine scan to distinguish micro porosity from macroscopic pore space fig 2c is the difference image between fig 2b and a from which solid grain macro pore space and micro porosity can be discriminated a non local means filter was applied on the differential images to reduce the noise while preserving edges buades et al 2005 2008 then intensity based thresholding was used to segment the image into different phases lin et al 2016 the histogram of the grey scale ct numbers which represents the x ray attenuation for the dry scan is presented in fig 3 here solid grain micro porous and macro pore space can be distinguished for which fluid occupancy is studied in sections 3 2 and 3 3 3 2 fluid occupancy and porosity in the micro pore space grey scale images are illustrated in fig 4 where two dimensional cross sections of three dimensional raw micro ct images over a range of fractional flows are presented the grey represents grains and intermittent phase in macro pores as well as micro porosity the black is stable oil in macro pores while the white is brine in macro pores the first observation is that there are some voxels in the micro porous space which did not change grey scale value for all fractional flows indicating that they were always filled with brine the second observation is that with increasing fractional flow some voxels in the micro porous space significantly increased their grey scale value which became similar to the value of brine only voxels these are the regions which are indicated by the red circles this shows that oil in the micro porosity was displaced by brine differential imaging can be used to discriminate the fluid occupancy in micro porosity separating the voxels filled only with brine and the voxels that were partially filled by brine and oil this fluid occupancy was then determined by calculating the difference image between the fully brine saturated scan and the scan at each fractional flow image normalization was then used to ensure that the grey scale value of each voxel was the same for the images taken at different fractional flows if the fluid occupancy was unchanged thus the peak values of the grey scale histogram distribution for multiphase images were rescaled to be the same as those of the brine saturated image then the difference image between the brine scan and the multiphase flow scan is defined as 1 c t difference c t brine scan c t multiphase scan c t 0 where ct is the ct number of each voxel and ct0 is a constant value to avoid negative grey scale values the difference images between the brine saturated scan and the multiphase flow scan clearly identify changes in fluid occupancy fig 5 shows the difference images at different fractional flows for this experiment black represents solid grain phase and unchanged brine while white indicates oil in macro pores there are also grey regions which can represent either an intermittent phase indicating that some of the time these regions were oil filled and at other times brine filled during the scan time of 40 min or oil in the micro porous phase as shown in the red circles 3 2 1 determination of fluid occupancy based porosity based on the analysis of oil and brine pore occupancy at all fractional flows we found that 85 5 of the micro pore space was saturated only with brine see table 1 oil did not occupy these pores because of the high capillary entry pressure hence we distinguished four phases solid grain micro pore phase i always occupied by brine micro pore phase ii which contains both oil and brine and macro pore space as shown in fig 6 the histograms of ct number for all grey scale voxels in the dry image are plotted for each phase as shown in fig 7 the red curve represents solid grain phase the green represents micro pore phase i the orange represents micro pore phase ii and the blue represents macro pore phase in the dry image the contribution to the total porosity from micro pore phase ii was estimated as 2 ϕ m i c r o p o r e ii p m i c r o p o r e ii ϕ m i c r o p o r e ii p m i c r o p o r e ii c t m i c r o p o r e ii c t s o l i d g r a i n c t m a c r o p o r e c t s o l i d g r a i n where ϕ microporeii is the porosity contribution of micro pore phase ii p microporeii is the fraction of the micro pore phase ii to the total volume including grains ϕ m i c r o p o r e ii is the porosity of the micro pore phase ii which was calculated to be 0 70 in this sample the grey scale values where the peak values are located for each pore space in the histogram are denoted as ctsolidgrain for the solid grain phase ctmicropore i for the micro pore phase i occupied by brine only ctmicropore ii for the micro pore phase ii occupied by brine and or oil and ctmacropore for the macro pore phase the porosity of each phase measured using the differential imaging method is shown in table 1 3 2 2 fluid occupancy in micro pore space flow heterogeneity in carbonates is affected by the presence of micro porosity using the differential imaging method we now distinguish pore occupancy in the microscopic pore space the raw images were segmented based on the four phase masks shown in fig 6 and the difference images shown in fig 5 furthermore oil brine and partially filled micro pores were segmented based on the grey scale distribution histogram of micro pore space ii shown in fig 8 in the multiphase images the contribution to the brine saturation in the partially filled micro pores was estimated as 3 s w p f m i c r o p o r e ii ϕ p f m s w ϕ p f m c t p f m i c r o p o r e s c t o i l c t b r i n e c t o i l where s w p f m i c r o p o r e ii is the contribution to the brine saturation in partially filled micro pores in micro pore space ii ϕ pfm is the fraction of the partially filled micro pore space to the total pore volume of micro pore space ii the grey scale values where the peak values are located for each phase in the histogram are denoted as ctoil for the oil in micro pore space ii ctpfmicropores for the partially filled micro pores and ctbrine for the brine in micro pore space ii for a fractional flow of 0 5 the fraction of brine in partially filled micro pore space is 0 333 shown in fig 8 and the fraction of the partially filled micro pores in total pore space is 0 192 shown in table 2 so the contribution to the total brine saturation from partially filled micro pores in micro pore space ii is the product of these two numbers giving the value of 0 064 fluid occupancy in micro pore space for all fractional flows is provided in table 2 3 3 fluid occupancy in the macro pore space the differential image shown in fig 5 was segmented to obtain the oil phase white and the intermittent phase grey in the macro pores then the brine phase was obtained by subtracting the oil and intermittent phase from the macro pore phase the fluids in the macro pores shown in fig 9 was segmented into brine blue oil red and intermittent yellow phases using these segmented label images as a reference separate raw images for each phase were extracted fig 10 shows the histograms of the grey scale values of the image at a fractional flow of 0 5 for the oil brine and intermittent phase of the macro pore space in the macro pore space the contribution of the intermittent phase in the macro pores to the brine saturation was estimated as 4 s w i n t e r m a c r o p o r e ϕ i n t e r s w ϕ i n t e r c t i n t e r m i t t e n c y c t o i l c t b r i n e c t o i l where s w i n t e r m a c r o p o r e is the contribution of the intermittent phase to the brine saturation and ϕ inter is the fraction of the intermittent phase to the total pore volume the grey scale values where the peak values are located for each phase in the histogram were denoted as ctoil for the stable oil phase ctintermittency for the intermittent phase ctbrine for the stable brine phase and s w denotes the proportion of brine in the intermittent phase for illustration for a fractional flow of 0 5 the fraction of brine in the intermittent phase is 0 470 shown in fig 10 and the fraction of the intermittent phase in total pore space is 0 237 shown in table 2 hence the contribution to the total brine saturation in the intermittent phase is 0 111 in the next section we provide fluid occupancy in the macro pore space for all fractional flows 3 4 fluid occupancy in the macro and micro pore space and dependence on fractional flow the brine saturation in the micro pore space macro pore space and the total saturation along the image are shown in fig 11 the uncertainty in saturation averaged over each slice of the total pore space is approximately 3 including 2 for micropores and 1 for macropores the amount of brine in the macro pore space was approximately constant however the fraction of brine in the micro pore space varied along the image because estaillades has a heterogeneous pore structure overall the brine saturation was not uniform along the image because micro porosity made a significant contribution to the total brine saturation from the profiles we observe that a considerable fraction of micro porosity became occupied by brine that displaced oil when the fractional flow was initially increased from 0 to 0 15 further increases resulted in a smaller oil displacement that is non uniform along the core reflecting the complex micro porous space these findings illustrate that in a water wet rock pore filling during waterflood occurs in order of increasing size and hence the micro porosity is preferentially filled first this is further confirmed from the plots of remaining oil saturation in micro and macro pore space shown in fig 12 the normalised oil saturation decreased faster in the micro porous regions with smaller pores until a fractional flow of 0 85 table 2 lists the fractions of oil and brine in the macro and micro porous regions 3 5 relative permeability as mentioned in section 2 2 the pressure difference across the rock sample at steady state conditions was measured using the differential pressure transducer shown in fig 1 fig 13 shows the mean pressure differentials at different fractional flows during the last two hours as well as the corresponding standard deviation we have subtracted the pressure drop in the flow lines themselves see step 10 of the experimental procedure in section 2 2 when the fractional flow was 0 and 1 the pressure profile was smooth which indicates an unchanging fluid configuration however there were rapid pressure fluctuations during intermediate fractional flows as observed previously sinha and hansen 2012 sinha et al 2017 for this experiment the range of the fluctuations was from 0 55 kpa to 8 63 kpa in the bentheimer experiment at the same ca gao et al 2017 the range was from 0 12 kpa to 10 72 kpa the pressure fluctuations are indicative of pore scale rearrangements and have a magnitude equal to a typical capillary pressure which is approximately 12 5 kpa calculated from 2σ r where σ is the interfacial tension and r is the average throat radius of 7 5 µm for estaillades blunt 2017 the relative permeability was calculated by 5 k r w q w μ w l δ p k k r o q o μ o l δ p k where krw is the brine relative permeability kro is the oil relative permeability μ w is the brine viscosity pa s μ o is the oil viscosity pa s qw is the brine darcy velocity flow rate per unit area m s qo is the oil darcy velocity m s l is the length of the whole sample m k is the absolute permeability m2 and δp is the pressure difference across the sample pa we do not need to correct for capillary pressure gradients the capillary end effect as there is no discernable saturation gradient across the core see fig 11 lin et al 2018 table 3 shows the wetting phase saturation and the measured oil and brine relative permeabilities at each fractional flow the saturation values shown in the table are calculated from the scanned region of the core fig 14 shows the estimated fractional flow curves at steady state for estaillades carbonate studied here and bentheimer sandstone measured in previous work gao et al 2017 together with the relative permeabilities for these two rocks the uncertainties in saturation are estimated from the root mean square uncertainties in phase volume total volume and porosity during image segmentation in both figures the uncertainties in relative permeability consider uncertainties in the measurement of the length and diameter of the sample the absolute permeability pressure measurements accuracy of the pressure transducers and the pump rates at the end of primary drainage the initial brine saturation for estaillades was 0 588 0 020 while at the end of imbibition the residual oil saturation was 0 145 0 016 the initial brine saturation for bentheimer was 0 145 0 031 while the residual oil saturation was 0 337 0 030 both the sandstone and carbonate samples are strongly water wet the micro porosity has a significant impact on the relative permeability of estaillades carbonate since brine occupies micro pores there is a considerable shift to higher brine saturations compared to bentheimer sandstone moreover the estaillades water brine relative permeability rises more steeply and to higher values which is an indication of the enhanced permeability and connectivity from micro porous regions the residual oil saturation is lower than in the sandstone this is partly due to the higher initial brine saturation and also due to additional connectivity through oil filled micro porosity preventing complete disconnection of the oil in contrast the oil that only occupies a small fraction of the micro porosity has a relative permeability that is similar in shape to the sandstone albeit shifted to higher brine saturation 3 6 pore and throat occupancy of the intermittent phase we now test the hypothesis that the existence of intermittent phase in the macroscopic pore space depends on pore and or throat size a generalized pore network extraction algorithm raeini et al 2017 was used to subdivide macroscopic pore space into pores bounded by throat surfaces each voxel is assigned to a unique pore as well as to a unique throat the closest throat surface the volume of the pore and throat voxels and their inscribed radii were used to analyse the statistics of the pore and throat fluid occupancy the pores and throats in the network were sorted based on their radii and divided into bins of equal volume these bins are then used to compute the volume fraction of pores and throats in each bin whose centres were filled with oil brine or the intermittent phase fig 15 shows the results for different fractional flow images as expected for a water wet brine wetting medium the oil occupies the larger pores while brine preferentially resides in small pores and throats there is more brine in the throats than pores as throats represent restrictions in the void space however brine is seen in some larger elements and in general the tendency for brine to reside strictly in the smaller pores and throats is less marked than that observed in water wet sandstones bultreys et al 2018 in particular when the oil is trapped for fw 1 we see oil and brine in elements of all sizes with only a weak preference for oil to remain in larger pores the reason for this is likely to be the presence of micro porosity as shown in table 2 some oil also resides in the micro porosity hence a much wider range of pore sizes are occupied by both phases than encountered typically in sandstones the exact occupancy will be controlled by pore size local pore geometry and connectivity and we even see some oil trapped in the micro porosity at the end of the experiment fig 11 as evident in fig 15 we mostly see the intermittent phase for intermediate fractional flows for fw 0 and fw 1 the flow paths are fixed as only one phase is flowing however when both phases simultaneously flow through the rock there are regions of the pore space where during the period of the scan sometimes oil is present and sometimes brine this shows that the flow pathways are not fixed but that a dynamic or intermittent connectivity is observed this fluctuating occupancy has been seen directly using fast synchrotron imaging in bentheimer sandstone reynolds et al 2017 intermittency has also been seen in bentheimer at the same ca and fluids as considered here gao et al 2017 compared to the sandstone however the fraction of the pores occupied by the intermittent phase in the carbonate was smaller for example when fw 0 5 the fraction of the pores occupied by the intermittent phase in the macro pore space was 0 24 in estaillades while it was 0 33 in bentheimer sandstone the intermittent phase is seen mainly in the intermediate sized and smaller macro pores as opposed to only the intermediate sized pores in a sandstone the physical explanation of intermittency is that the flowing fluids have sufficient energy to periodically open more conductive flow channels reynolds et al 2017 at lower flow rates there is insufficient energy to overcome the capillary pressure barriers that block short cuts in the flow in a carbonate oil and brine are also present in micro porosity and so it is not surprising that even some of the smaller macro pores allow intermittent connectivity at moderately high flow rates facilitating flow through both the macro and micro porous regions 4 conclusions we have established a novel experimental and image analysis methodology to measure the pore occupancy relative permeability and flow intermittency in a complex micro porous carbonate we have demonstrated this by conducting steady state waterflood experiments on an estaillades limestone sample at a capillary number ca 7 3 10 6 and performing differential imaging to distinguish macro pore space explicitly resolvable in the image and micro porosity together with fluid occupancy estaillades is a heterogeneous carbonate composed of approximately 27 solid grains 7 macro pores and 66 micro pores that could not be explicitly resolved from micro ct images we were able to quantitatively describe four phases solid grain pores occupied only by brine micro pore space i micro pores partially filled by oil and brine micro pore space ii and macro pore space which itself can contain oil water or can be intermittent during multiphase flow we could distinguish three types of fluid occupancy in the micro pore space ii filled with oil filled with brine and partially saturated with both brine and oil present the micro porosity contributed significantly to the total porosity the fully brine saturated portion of the pore space approximately 57 of the total pore volume of the rock contributed to a large initial brine saturation after primary drainage shifting the relative permeabilities to the right compared to bentheimer sandstone however some of the micro porosity approximately 10 of the whole sample initially contained oil that was displaced during waterflooding the enhanced connectivity of the pore space through micro porosity led to a higher end point water relative permeability and a lower residual oil saturation than observed for a sandstone under similar conditions our method indicated initially relatively higher recovery from micro porosity this is expected in a water wet rock where the wetting phase preferentially fills the smaller pores in the macro pore space the intermittent phase was identified by the differential imaging method showing that there were some regions of the pore space that were occupied alternately by oil and brine the intermittent phase was seen principally in the smaller and intermediate sized pores and the fraction of the pore space showing this fluctuating occupancy was slightly smaller than in bentheimer sandstone under the same conditions this experimental technique is readily applicable to other systems in which micro porosity plays an important role including mixed wet carbonates future work could include a wide variety of the pore scale multiphase flow problems including those at the conditions representative of subsurface aquifers oil and gas fields and other deep geological systems acknowledgements we gratefully acknowledge funding from the qatar carbonates and carbon storage research centre qccsrc provided jointly by qatar petroleum shell and the qatar science technology park and the imperial college consortium on pore scale modelling the authors acknowledge mr graham nash dr edward bailey dr saurabh shan and mr vincenzo cunsolo for their assistance in the laboratory the experimental data are available online at https www bgs ac uk services ngdc citeddata catalogue f899eb2f 37a4 4dec 9b59 432f11250894 html 
627,we propose a physics based macroscale formulation of multiphase porous media flows that both honors the validity of darcy s law in steady or near steady flows and accommodates the effects of heterogeneities and nonlinearities in unsteady flows the new formulation recognizes that parameters characterizing the system operate at different length scales in particular the use of darcy s law predicated on the assumption of near steady flows requires dynamic length scales owing to the possibility of rapid fluctuations in rock properties and fluid saturations attributable to heterogeneity and nonlinearity we accommodate these dynamic length scales through dynamic spatial averaging the length and position of the averaging window are characterized by the length of the mixing zone and the direction of propagation of information in the transport process we validate the proposed formulation by comparing highly accurate two dimensional numerical solutions against core scale displacement experiments the proposed paradigm is consistent with the classical multiphase darcy formulation in the sense that the latter also represents the results of an averaging approach keywords multiphase flow nonequilibrium models high resolution methods flow instability 1 introduction accurate mathematical description of multiphase flows in porous media is essential in many practical problems including groundwater contaminant remediation geological storage of co2 and petroleum reservoir engineering house et al 2006 juanes 2008 qiao et al 2018 bench or field scale simulation of fluid displacement processes in these applications requires macroscale mathematical formulations which replace the details of flow in the pores with spatially averaged descriptions abriola and pinder 1985 bear 2013 jiang and younis 2015 wang and shahvali 2016 chabanon et al 2017 these formulations involve partial differential equations pdes arising from the conservation of mass momentum and energy leveque 1992 this paper presents a new formulation of porous medium flow based on length scale averaging that accommodates effects associated with spatially heterogeneous media and the nonlinearities inherent in multi fluid flows darcy s law represents the classic macroscale expression of the conservation of momentum for a single fluid phase flowing in a porous solid it establishes a linear field equation in which the macroscale darcy velocity is proportional to the gradient of a field potential such as the pressure or hydraulic head whitaker 1986 strictly speaking darcy s law is valid for low reynolds number single fluid steady flows in which fluid inertia is negligible hubbert 1956 whitaker 1986 dullien 2012 neuman 1977 in some regimes such as slow flows in nearly homogeneous porous media it is reasonable to treat the flow as nearly steady since fluid parcels encounter slowly fluctuating rock properties however unless the steady state velocity field is established in highly heterogeneous media the hypothesis of nearly steady flow may not be valid especially at displacement fronts further problems arise in multi fluid flows following muskat and meres 1936 wyckoff and botset 1936 leverett 1941 engineers common extend darcy s law to these flows via the use of nonlinear constitutive relations such as relative permeabilities and capillary pressure even though relative permeabilities and capillary pressure are often assumed to be local functions of saturation they also depend on other nonlinear parameters such as saturation history and composition dependent rock wettability and fluid viscosities avraam and payatakes 1995 tang and kovscek 2011 honarpour 2018 as with heterogeneities these nonlinear effects can also call into question the assumption of nearly steady flow since fluids in the mixing zone at a displacement front may encounter rapidly fluctuating rock properties and fluid saturations in short since darcy s law is predicated on the assumption of steady flows its straightforward application in highly heterogeneous media and in the presence of nonlinearities neglects the variable length scales over which rock properties and fluid saturations vary the new formulation presented in this paper addresses this difficulty accommodating dynamic length scales through dynamic spatial averaging the length and position of the averaging window are driven by the mixing zone length and the direction of propagation of information in the transport process the resulting nonlocal model is consistent in spirit with the classical multiphase darcy formulation in the sense that the latter also represents the results of an averaging approach in the remainder of the paper we review previous work then develop the new model we focus on flow regimes where flow is appropriately described using darcy s law or its extension to multi fluid flow in that context the viscous forces are significant compared to the capillary forces we then validate the proposed formulation by comparing highly accurate two dimensional numerical solutions against core scale displacement experiments we close with a discussion of the results and some conclusions 2 previous work in multi fluid flows the assumption that constitutive relations depend solely on saturation at a point effectively collapses the functional dependencies along other dimensions such as saturation history even under conditions where constitutive relations may reasonably be expressed as functions only of local saturation numerical solutions using high accuracy numerical methods and precisely measured constitutive relations still fail to model experimental observations riaz et al 2007 wang et al 2018 these results are not surprising in their classical and most prevalent form constitutive relations rest on the pivotal assumption of instantaneous local equilibrium and are expressed as functions solely of local saturation barenblatt et al 1997 ren et al 2017 this assumption may violate the steady state requirement that the flow minimizes the dissipation of energy across the medium king et al 1995 compounding this difficulty is the fact that relative permeabilities and capillary pressure are measured based on the assumption of steady state equilibrium conditions then used to describe dynamic processes the steady state assumption may adequately approximate systems in which the characteristic time scale of the flow process is large compared to the time it takes for the system to accommodate a perturbation in flow conditions but there are many cases of interest such as co2 injection into geologic formations where this assumption fails to reflect the physics aryana and kovscek 2012 the resulting inaccuracy sharply reduces the predictive capability of the classical darcy muskat model muskat and meres 1936 for unstable multiphase flow processes riaz et al 2007 barenblatt et al 2003 several investigators have proposed nonequilibrium models to address this deficiency hassanizadeh and gray 1993a b h g proposed a dynamic capillary pressure saturation relationship motivated by volume averaging of microscopic flow equations and thermodynamic considerations in this model the dynamic capillary pressure differs from the static capillary pressure by the product of a dynamic coefficient τ and the local rate of change of saturation hassanizadeh et al 2002 the h g model does not incorporate nonequilibrium effects in the relative permeabilities juanes 2008 a nonequilibrium model proposed by barenblatt 1971 barenblatt and gilman 1987 bne rests on the argument that wetting and non wetting phases flowing simultaneously establish separate networks of flow pathways that connect the flowing portion of each phase any change in capillary pressure causes a reconfiguration of flow pathways barenblatt et al 2003 this reconfiguration changes the connectivity of the flowing phases and the overall hydraulic conductance the characteristic time required for the flow field to transition from one steady state arrangement of pathways to another is the redistribution or relaxation time τ by evaluating the constitutive parameters at time t τ after relaxation the bne model addresses nonequilibrium effects in both relative permeability and capillary pressure it also effectively relies on a future solution other alternative constitutive models include the extension of capillary pressure to dynamic conditions by kalaydjian 1987 and dynamic capillary pressure relations that depend on specific interfacial areas and euler characteristic joekar niasar et al 2010 mcclure et al 2018 niessner and hassanizadeh 2008 aryana and kovscek 2013 a k presented a general nonequilibrium formulation that incorporates temporal averages by replacing the local saturation with an integral over the transient redistribution time window to implement a model of this type one must solve for a series of future solutions simultaneously which is not practical the bne model circumvents this difficulty effectively replacing the time integral by a low order numerical quadrature using the local future solution at the end of the window of integration in place of the time integral the h g and bne models lend insight into the implications of unsteady flows the implementation of these models in large scale numerical simulators however suffers from two important drawbacks first redistribution time cannot be directly extracted from experiments for most flow conditions as a result it often becomes a fitting parameter in practice barenblatt et al 2003 ren et al 2017 second the inclusion of these models results in fully nonlinear pdes whose numerical stability and convergence are sensitive to the numerical value of τ and its magnitude relative to the time step size hassanizadeh et al 2002 as a consequence of the difficulties large scale commercial simulators and most research grade simulators rely on the classical formulation of the constitutive relations and do not attempt to account for nonequilibrium effects 3 proposed model the model advanced in this paper rests on two observations first time and space are related via the transport equation second darcy s law is an expression for steady state flow and fluid mobility and constitutive relations are established experimentally based on equilibrium or steady state conditions honarpour 2018 this is true regardless of the experimental method used to measure the constitutive functions the method can be unsteady but the estimation is still based on the aforementioned assumptions in practice however macroscale models are used to simulate unsteady and dynamic conditions therefore we should expect to upscale local saturation information to a length scale at which the assumption of near steady flow is valid a scale that can be extracted from observations of stable or unstable flows directly and is not a fitting parameter 3 1 motivation to motivate the second observation recall that a representative elementary volume rev is a finite spatial volume whose diameter is the smallest characteristic scale at which variables such as the porosity are well defined panfilov 2013 strictly speaking the linear relation between velocity and the gradient field expressed by darcy s law is valid only under steady state conditions irmay 1958 as a result classical macroscale formulations hinge on the fundamental assumption of local phase equilibrium barenblatt et al 2003 and steady flow in the multiphase extension of darcy s law constitutive functions are assumed to be functions of fluid phase saturations not on the specific fluid configurations at the sub rev scale for this assumption to be valid either the fluid configurations in the pores must relax instantaneously to their steady state configurations or we must average the saturations over a length scale at which the details of transient sub rev fluid configurations are negligible to describe unsteady flow processes therefore requires a constitutive relation averaging length that may vary in size and may differ from the averaging length used for such properties as the porosity we refer to the former as the dynamic averaging length and the latter as the static averaging length the common practice of treating constitutive relations as functions of local saturation thus implicitly assumes that the static and dynamic averaging lengths are the same we hypothesize that this assumption is a source of disagreement between numerical solutions and experimental observations for unsteady flows the effective values of the saturation dependent constitutive functions which define the flux for a given state of saturation can differ significantly from their values obtained from standard measurements barenblatt et al 2003 3 2 formulation we propose a multiscale view in which saturation dependent constitutive relations must be averaged over dynamic averaging lengths at each point x in space and time t we define the effective saturation as the weighted average of saturation along the unique particle path passing through the point over an interval of length l centered about the given point the parameter l is the dynamic averaging length it is a measure of the length of the mixing zone and may be calculated from observations of the mixing zone at a given time t as shown in the sketch in fig 1 s i shock and s i ahead represent invading phase saturation values at the shock and ahead of the front the theoretical displacement front respectively s i shock is obtained from the solution of the buckley leverett equation buckley and leverett 1942 we calculate l as the distance between the locus of the theoretical saturation shock s i shock as predicted by the buckley leverett equation buckley and leverett 1942 and the locus of the actual toe of the invading front s i ahead from the corresponding experimental observations this procedure approximates the length of the mixing zone while conserving mass that is diffused in the physical observations around the location of the sharp front predicted by the buckley leverett equation a critical question for the proposed model is how to determine the length of the mixing zone which is driven by the interaction between nonlinearity in the flow equations and geologic heterogeneity furtado and pereira 2003 the length of the mixing zone does not serve as a tuning parameter instead we must obtain it through observations recent advances in reservoir monitoring methods e g 4d time lapse seismic monitoring and seismoelectric coupling facilitate the surveillance of evolution of saturation profiles revil et al 2013 djuraev et al 2017 watanabe et al 2017 based on which the dynamic length of the mixing zone may be estimated in addition numerical investigations furtado and pereira 2003 borges et al 2008a and experimental observations aryana and kovscek 2012 suggest that fluid mixing of two phase immiscible flows in porous media exhibits scaling behavior that can be extracted from observations of the flow knowledge of this scaling behavior may reduce the number of observations needed for accurate estimates of the dynamic mixing zone length the main point is that realistic simulation of multiphase displacement requires realistic estimates of the mixing zone length and methods exist to obtain them the weighted averaging must respect the direction of flow in many applications the time dependent pdes governing multiphase flow in porous media are either hyperbolic or nearly so in the sense that dissipation due to capillarity exerts a small smoothing influence on otherwise sharp fronts the equations propagate information from upstream to downstream in the weighted averaging we assign weights of zero to points in the averaging interval that are downstream in the upstream direction points that are closer to the center of the interval are expected to influence the constitutive relation for the point of interest more heavily therefore points in the upstream direction have weights that decrease with distance from the center of the interval we begin with a parametrization x σ t of a typical particle path using arc length as the parameter σ the saturation s of a fluid along this path is s x σ t which at a fixed time we abbreviate as s σ at the point on the particle path where σ ζ we calculate the corresponding effective saturation η ζ as a weighted average of upwind saturation values that lie 1 along the particle path passing through x ζ at time t ζ and 2 within an arc length of l 2 along the particle path 3 1 η ζ ζ l 2 ζ w σ s σ d σ here l is the width of mixing zone at t and w σ 4 l 1 2 l σ ζ ζ l 2 σ ζ is the weighting function with this choice the weighting function integrates to 1 i e w σ d σ 1 and decreases linearly from the current point ζ along the particle path to a point at distance l 2 upstream the choice of the linear weighting function is motivated by the expectation that information farther in the upstream direction from a given point will have less impact on the state of flow at that point moreover we choose a linear weighting function in the absence of information that may guide us to a more complex formulation which may require additional effectively tuning parameters unlike the h g and bne models which may require the use of iterative methods to solve at each time step the proposed averaging approach results in quasi linear equations which lend themselves to explicit time stepping schemes moreover the proposed upstream weighted averaging is performed along the particle path at each point and the associated computational cost does not increase in higher dimensions e g in two versus three dimensions given the velocity field we calculate values of the effective saturation η and evaluate the saturation dependent constitutive relations at η to check that the proposed approach is consistent with the classical approach consider the limiting case in which saturation values relax to steady state values instantaneously in this limiting case the dynamic averaging length vanishes and we recover the classical formulation in this case the effective and actual saturation values are the same an important consideration in the development of the mathematical model is availability of appropriate numerical schemes the classical constitutive relations of multiphase flow in porous media lead to quasi linear pdes mathematical theory is well established for scalar quasi linear pdes the inclusion of prominent non equilibrium models in the constitutive relations e g bne and h g models leads to more challenging fully nonlinear pdes where nonlinearities depend not only on the solution but also on the derivative of the solution bocharov et al 1989 van duijn et al 2007 the proposed non equilibrium model leads to quasi linear pdes for which mathematical theory is well developed especially for scalar quasi linear pdes for instance in the context of the buckley leverett equation buckley and leverett 1942 fourier stability analysis anderson and wendt 1995 isaacson and keller 2012 smith 1985 reveals that the proposed model leads to conditionally stable explicit time stepping schemes 4 numerical simulation 4 1 problem set up we tested this formulation using two dimensional numerical simulations of two phase fluid displacements on a rectangle having width w and length l the invading phase with viscosity μi is injected into the porous medium at the left boundary x 0 with a constant velocity u 0 y t u 0 u 0 displacing the resident phase with viscosity μr we assume that the invading phase pressure is constant at the outlet x l the no flow boundary condition u n 0 is imposed at the bottom and top boundaries y 0 and y w where n is the unit vector normal to the boundaries for simplicity we assume incompressible and isothermal conditions the porous medium is homogeneous with a constant permeability k and porosity ϕ the governing equations are 4 1 2 ψ k λ t ξ 1 k λ t ξ u k u u x u y y ψ u x 0 x ψ ϕ t s i u f i ξ k f i ξ λ r ξ p c ξ q i here ψ is the fluctuating component of the stream function ψ k is the unit vector in the positive z direction ux and uy are scalar components of u along x and y axes respectively subscripts i and r denote the invading and the resident phases respectively we use ξ to denote either their actual or effective saturation values depending on the numerical experiment being conducted the total mobility is λ t ξ λ i ξ λ r ξ pc ξ is the capillary pressure u is the total velocity and qi is the volumetric flow rate of the invading phase the derivation of system 4 1 is referred to wang et al 2018 due to the use of a vorticity stream function formulation tryggvason and aref 1983 meiburg and homsy 1988 tan and homsy 1988 rogerson and meiburg 1993 phase pressure does not serve as a simulation variable the classical model referred to as cla assumes ξ s i and the proposed spatial averaging model referred to as sa assumes ξ η i 4 2 numerical scheme 4 2 1 computation of effective saturation the relation between the effective saturation η and the actual saturation s which passes through the point σ ζ is given by eq 3 1 in a cartesian coordinate system the upwind cell of a given cell is determined based on the direction of flow velocity of the given cell the discrete form of eq 3 1 is given by 4 2 η k 0 m w σ k s σ k where σk denotes a value of arc length σ assigned to each cell in the computational grid through which the particle path passes w σ k σ k 1 σ k w σ d σ k is the index of upwind cells associated with the target cell k 0 refers to the target cell itself m is the maximum number of upwind cells along the particle path such that ζ σ m l 2 and ζ σ m 1 l 2 are satisfied or cell m 1 is located out of the discrete domain as shown in the sketch in fig 2 cells filled in gray denote upwind cells of the target cell filled in black σk is approximated given by 4 3 σ k ζ k 0 ζ j 1 k d j 1 j k 1 where d j 1 j is the distance between the center of neighboring cells j 1 and j 4 2 2 discretization of governing equations to calculate velocity components ux and uy we apply the fourier transform to the first equation in system 4 1 resulting in 4 4 f ψ f k λ t ξ 1 k λ t ξ u k k x 2 k y 2 where f denotes the fourier transform operator and kx and ky are wave numbers along the x and y axes respectively the spatial derivative term 1 k λ t ξ is computed with sixth order compact finite differences lele 1992 the first order spatial derivatives of f ψ are given by kutz 2013 4 5 f x ψ i k x f ψ and f y ψ i k y f ψ where i 2 1 the spatial derivatives x ψ and y ψ of the fluctuating component of the stream function are computed by performing an inverse transform on both sides of eq 4 5 the numerical scheme for the transport equation in system 4 1 is obtained from integration of that equation over cell v j ℓ 4 6 v j ℓ ϕ t s i d a v j ℓ f i ξ u n d s v j ℓ k f i ξ λ r ξ p c ξ n d s where the external invading phase volumetric flow rate is assumed to be zero q i 0 v j l is assumed to be rectangular with area of δxδy the spatial derivative of the dissipation flux is computed using fourth order central differences to reduce numerical dispersion arising from the discretization of the convection flux and to capture saturation fronts without introducing misleading oscillations a high order total variation diminishing tvd scheme harten 1983 sweby 1984 is applied to the convection flux this work implements the central upwind scheme kurganov and levy 2000 kurganov and tadmor 2000 kurganov et al 2001 where the intermediate values are constructed using the fifth order weighted essentially nonoscillatory weno scheme jiang and shu 1996 shu 2009 details of the discretization of convection flux are presented in appendix a the third order tvd runge kutta method gottlieb and shu 1998 gottlieb et al 2001 is used for the temporal discretization the transport equation in system 4 1 is rewritten as 4 7 d s i d t l ξ u where l ξ u 1 ϕ δ x δ y c ξ u d ξ c ξ u and d ξ are approximations to the discretization of convection and dissipation fluxes respectively the time marching scheme over t n t n 1 is given by 4 8 s i 1 s i n δ t l s i n u n 1 s i 2 3 4 s i n 1 4 s i 1 1 4 δ t l s i 1 u n 1 s i n 1 1 3 s i n 2 3 s i 2 2 3 δ t l s i 2 u n 1 and 4 9 η i 1 s i n δ t l η i n u n 1 η i 2 3 4 s i n 1 4 η i 1 1 4 δ t l η i 1 u n 1 s i n 1 1 3 s i n 2 3 η i 2 2 3 δ t l η i 2 u n 1 for the cla and sa models respectively the superscript n and n 1 denote time step counters δt is time step size 4 3 experimental data simulation input physical observations used in this study are based on a series of core scale displacement experiments the centerpiece of the drainage experiments is a strongly water wet cylindrical berea sandstone cores 5 08 cm in diameter and 60 cm in length the imbibition experiments are conducted using a strongly water wet cylindrical berea sandstone cores 5 1 cm in diameter and 52 cm in length the cores are characterized as homogeneous porous media with negligible variations in porosity and permeability along the main direction of flow at the initial stage cores are saturated with the resident phase uniformly x ray tomography is used to collect in situ saturation distribution data nondestructively tang and kovscek 2011 aryana and kovscek 2012 simulation parameters representative of the experiments are used in numerical simulation models data shown in table 1 represent core scale imbibition and drainage displacement experiments using pairs of immiscible fluids the viscosity ratio in table 1 is the ratio of the viscosity of resident fluid to that of the invading fluid endpoint and total shock mobility ratios are often used as indicators of the onset of flow instability hagoort 1974 yortsos and hickernell 1989 riaz and tchelepi 2004 beliveau 2009 berg and ott 2012 where mobility ratios larger than unity indicate an unstable displacement corresponding simulation parameters are presented in table 2 imbibition relative permeability functions are based on steady state measurements tang and kovscek 2011 and for drainage corey type relative permeability functions corey 1954 are used where the end points and exponents are guided by steady state displacement experiments aryana and kovscek 2013 we use capillary pressure data obtained from a mercury intrusion experiment ren et al 2017 random perturbations are introduced in the initial condition ruith and meiburg 2000 riaz and tchelepi 2006 we choose the spatial mesh size to be no greater than the critical wavelength resulting from a linear stability analysis to resolve all relevant physical scales chuoke et al 1959 hagoort 1974 saffman and taylor 1988 feder 2013 for each case we plot one dimensional profiles of saturation versus dimensionless distance xd obtained by averaging the saturation along cross sectional lines perpendicular to the x direction at three different times dimensionless dynamic averaging lengths ld and the associated dimensionless simulation times td which represent injected pore volumes are tabulated in table 3 5 results and discussions figs 3 and 4 show saturation maps obtained from two dimensional numerical solutions and their equivalent one dimensional saturation profiles obtained by cross sectional averaging along with experimental data are presented in figs 5 and 6 these results demonstrate the efficacy of the proposed model in capturing physical observations the agreement between the proposed model and physical observations is especially pronounced when compared to solutions of the classical formulation we compare experimental data and numerical solutions for two cases stable displacements in which the invading fluid displaces the resident fluid in a piston like fashion and unstable displacements in which the invading fluid forms viscous fingers as it moves downstream endpoint mobility ratio appears to be an appropriate criterion for the onset of instabilities in the experiments whereas total shock mobility ratio is a better indicator of the onset of flow instabilities in the simulation results saturation maps presented in figs 3 and 4 show that for the fluid systems in experiments 1 and 3 fluctuations in the interface decay as displacement progresses so the displacement is stable the mixing zone becomes a thin piston like band perpendicular to the injection direction the resulting one dimensional saturation profiles exhibit relatively sharp fronts for fluid systems given by experiments 2 and 4 fluctuations grow and develop into prominent viscous fingers these fingers grow longer with time indicating unstable displacement the viscous fingers are reflected as spreading fronts in the cross sectionally averaged saturation profiles in figs 5b and 5 d first consider the results of the cla model as shown in fig 5 cross sectionally averaged saturation profiles obtained from two dimensional simulations using the cla model fail to capture the dynamics of the displacement fronts observed in experiments in the cases of stable displacement as indicated by the total shock mobility ratio simulation results exhibit relatively sharp fronts as shown in figs 5a and 5 c in cases of unstable displacement shown in figs 5b and 5 d saturation profiles from the cla model show evolving fronts with increasing length of the mixing zone in both cases the cla model exhibits significant deviations from the experimental data next consider the results of the sa model proposed in this paper saturation maps presented in figs 3a and 4 a show that for the cases of stable displacement in comparison with the cla model the sa model produces smoother transition zones in the vicinity of the saturation fronts the highly resolved viscous fingers that appear in figs 3b and 4 b are smeared and variations in the amplitude of fingers are reduced this smearing is reflected in the cross sectionally averaged saturation profiles as spreading of the saturation front this numerical spreading lengthens the mixing zone for all the four experiments saturation profiles obtained from the sa model are in remarkable agreement with experimental data and they appear to capture the evolving nature of instabilities observed in the experiments as an additional benefit the sa model alleviates the numerical instability and convergence issues arising from the bne and h g nonequilibrium models accordingly we discretized the proposed model using an explicit time stepping scheme the dynamic length scales in the sa model are extracted directly from experimental observations 6 conclusion this paper proposes a novel self consistent and physics based mathematical formulation for the relative permeabilities and capillary functions used to model multiphase flow in porous media we replace the standard dependencies of these constitutive variables on fluid saturation at a point by dependencies on spatial averages along particle paths the resulting formulation evaluates the variables at saturation values that better reflect the scales over which one can reasonably treat the pore scale fluid distribution as nearly steady state in this respect the new model honors the steady state assumption underlying the extension of darcy s law to multiple phases the averaging window is dynamic and its length scale may be directly obtained from physical observations to test the new model we developed a two dimensional high resolution numerical simulator that resolves all relevant physical scales and elucidates the predictive capabilities of the classical and proposed models across a wide range of parameters and experimental observations the simulator casts the flow equations in a vorticity stream function form the fourier transform is used to solve the vorticity stream function equation the advective flux in the transport equation is computed using a central upwind scheme where the intermediate values are constructed using the fifth order weno scheme the coupled vorticity stream function equation and the transport equation are solved in a sequential manner through explicit time stepping we compare numerical results for homogeneous porous media with core scale imbibition and drainage experiments in the literature saturation maps obtained using the proposed model demonstrate that the averaging of saturations over dynamic length scales has a diffusive effect which smears of viscous fingers that are otherwise well resolved via the classical model the proposed model captures reproducible relevant properties of the evolving fronts in the experiments namely the length of the mixing zone and the position of the leading edge of the front in one dimensional saturation profiles the proposed model is consistent with the physics and is predictive in stable and unstable fluid displacements acknowledgments the corresponding author gratefully acknowledges the donors of the american chemical society petroleum research fund 55795 dni9 for partial support of this research the writing stage of this research was supported as part of the center for mechanistic control of water hydrocarbon rock interactions in unconventional and tight oil formations cmc uf an energy frontier research center funded bythe u s department of energy office of science under doe bes award de sc0019165 the corresponding author also thanks prof frederico furtado and prof victor ginting for our lively discussions appendix a discretization of the convection flux in transport equation the central upwind scheme kurganov and tadmor 2000 kurganov and levy 2000 kurganov et al 2001 is applied to the convection flux for brevity we consider one dimensional system of cells with uniform spacing the semi discrete central upwind scheme kurganov et al 2001 is given by the dissipation flux is not included in the description below a 1 d d t s i j u x j ϕ δ x f ξ θ j 1 2 f ξ θ j 1 2 where a 2 f ξ θ j 1 2 a j 1 2 f ξ j 1 2 a j 1 2 f ξ j 1 2 a j 1 2 a j 1 2 a j 1 2 a j 1 2 a j 1 2 a j 1 2 ξ j 1 2 ξ j 1 2 and f ξ f i ξ subscript i denotes the invading phase in eq a 2 ξ j 1 2 and ξ j 1 2 are left and right intermediate values at cell interface x j 1 2 a j 1 2 and a j 1 2 are local speeds of propagation at cell interface x j 1 2 in this work we take kurganov et al 2001 2007 a 3 a j 1 2 a j 1 2 a j 1 2 where a 4 a j 1 2 max ξ ξ j 1 2 ξ j 1 2 f ξ substituting eq a 3 into eq a 2 the numerical flux reduces to a 5 f ξ θ j 1 2 f ξ j 1 2 f ξ j 1 2 2 a j 1 2 2 ξ j 1 2 ξ j 1 2 f ξ θ j 1 2 is obtained in a similar fashion given by a 6 f ξ θ j 1 2 f ξ j 1 2 f ξ j 1 2 2 a j 1 2 2 ξ j 1 2 ξ j 1 2 intermediate values ξ j 1 2 and ξ j 1 2 are constructed using the fifth order weighted essentially nonoscillatory weno scheme jiang and shu 1996 shu 2009 reconstructions are based on five point stencils with one point biased to the left ξ j 1 2 and one point biased to the right ξ j 1 2 respectively ξ j 1 2 is computed using the stencil i i 2 i i 1 i i i i 1 i i 2 given by shi et al 2002 zahran 2009 a 7 ξ j 1 2 i 0 2 w i ξ j 1 2 i where a 8 ξ j 1 2 0 1 6 2 ξ j 2 7 ξ j 1 11 ξ j ξ j 1 2 1 1 6 ξ j 1 5 ξ j 2 ξ j 1 ξ j 1 2 2 1 6 2 ξ j 5 ξ j 1 ξ j 2 and w i are nonlinear weights given by a 9 w i w i k 0 2 w k where a 10 w k γ k β k with the linear weights given by γ 0 0 1 γ 1 0 6 and γ 2 0 3 β k are the smoothness indicators given by borges et al 2008b a 11 β k β k ε β k ε τ 5 where ε is a parameter used to avoid the division by zero in the denominator β k is given by shi et al 2002 a 12 β 0 13 12 ξ j 2 2 ξ j 1 ξ j 2 1 4 ξ j 2 4 ξ j 1 3 ξ j 2 β 1 13 12 ξ j 1 2 ξ j ξ j 1 2 1 4 ξ j 1 ξ j 1 2 β 2 13 12 ξ j 2 ξ j 1 ξ j 2 2 1 4 3 ξ j 4 ξ j 1 ξ j 2 2 and a 13 τ 5 β 0 β 2 ξ j 1 2 is computed using the stencil i i 1 i i i i 1 i i 2 i i 3 given by a 14 ξ j 1 2 i 0 2 w i ξ j 1 2 i where a 15 ξ j 1 2 0 1 6 ξ j 1 5 ξ j 2 ξ j 1 ξ j 1 2 1 1 6 2 ξ j 5 ξ j 1 ξ j 2 ξ j 1 2 2 1 6 11 ξ j 1 7 ξ j 2 2 ξ j 3 and w i are nonlinear weights given by a 16 w i w i k 0 2 w k where a 17 w k γ k β k with the linear weights given by γ 0 0 3 γ 1 0 6 and γ 2 0 1 β k are the smoothness indicators given by a 18 β k β k ε β k ε τ 5 where β k is given by a 19 β 0 13 12 ξ j 1 2 ξ j ξ j 1 2 1 4 ξ j 1 4 ξ j 3 ξ j 1 2 β 1 13 12 ξ j 2 ξ j 1 ξ j 2 2 1 4 ξ j ξ j 2 2 β 2 13 12 ξ j 1 2 ξ j 2 ξ j 3 2 1 4 3 ξ j 1 4 ξ j 2 ξ j 3 2 and a 20 τ 5 β 0 β 2 supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 05 010 appendix b supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
627,we propose a physics based macroscale formulation of multiphase porous media flows that both honors the validity of darcy s law in steady or near steady flows and accommodates the effects of heterogeneities and nonlinearities in unsteady flows the new formulation recognizes that parameters characterizing the system operate at different length scales in particular the use of darcy s law predicated on the assumption of near steady flows requires dynamic length scales owing to the possibility of rapid fluctuations in rock properties and fluid saturations attributable to heterogeneity and nonlinearity we accommodate these dynamic length scales through dynamic spatial averaging the length and position of the averaging window are characterized by the length of the mixing zone and the direction of propagation of information in the transport process we validate the proposed formulation by comparing highly accurate two dimensional numerical solutions against core scale displacement experiments the proposed paradigm is consistent with the classical multiphase darcy formulation in the sense that the latter also represents the results of an averaging approach keywords multiphase flow nonequilibrium models high resolution methods flow instability 1 introduction accurate mathematical description of multiphase flows in porous media is essential in many practical problems including groundwater contaminant remediation geological storage of co2 and petroleum reservoir engineering house et al 2006 juanes 2008 qiao et al 2018 bench or field scale simulation of fluid displacement processes in these applications requires macroscale mathematical formulations which replace the details of flow in the pores with spatially averaged descriptions abriola and pinder 1985 bear 2013 jiang and younis 2015 wang and shahvali 2016 chabanon et al 2017 these formulations involve partial differential equations pdes arising from the conservation of mass momentum and energy leveque 1992 this paper presents a new formulation of porous medium flow based on length scale averaging that accommodates effects associated with spatially heterogeneous media and the nonlinearities inherent in multi fluid flows darcy s law represents the classic macroscale expression of the conservation of momentum for a single fluid phase flowing in a porous solid it establishes a linear field equation in which the macroscale darcy velocity is proportional to the gradient of a field potential such as the pressure or hydraulic head whitaker 1986 strictly speaking darcy s law is valid for low reynolds number single fluid steady flows in which fluid inertia is negligible hubbert 1956 whitaker 1986 dullien 2012 neuman 1977 in some regimes such as slow flows in nearly homogeneous porous media it is reasonable to treat the flow as nearly steady since fluid parcels encounter slowly fluctuating rock properties however unless the steady state velocity field is established in highly heterogeneous media the hypothesis of nearly steady flow may not be valid especially at displacement fronts further problems arise in multi fluid flows following muskat and meres 1936 wyckoff and botset 1936 leverett 1941 engineers common extend darcy s law to these flows via the use of nonlinear constitutive relations such as relative permeabilities and capillary pressure even though relative permeabilities and capillary pressure are often assumed to be local functions of saturation they also depend on other nonlinear parameters such as saturation history and composition dependent rock wettability and fluid viscosities avraam and payatakes 1995 tang and kovscek 2011 honarpour 2018 as with heterogeneities these nonlinear effects can also call into question the assumption of nearly steady flow since fluids in the mixing zone at a displacement front may encounter rapidly fluctuating rock properties and fluid saturations in short since darcy s law is predicated on the assumption of steady flows its straightforward application in highly heterogeneous media and in the presence of nonlinearities neglects the variable length scales over which rock properties and fluid saturations vary the new formulation presented in this paper addresses this difficulty accommodating dynamic length scales through dynamic spatial averaging the length and position of the averaging window are driven by the mixing zone length and the direction of propagation of information in the transport process the resulting nonlocal model is consistent in spirit with the classical multiphase darcy formulation in the sense that the latter also represents the results of an averaging approach in the remainder of the paper we review previous work then develop the new model we focus on flow regimes where flow is appropriately described using darcy s law or its extension to multi fluid flow in that context the viscous forces are significant compared to the capillary forces we then validate the proposed formulation by comparing highly accurate two dimensional numerical solutions against core scale displacement experiments we close with a discussion of the results and some conclusions 2 previous work in multi fluid flows the assumption that constitutive relations depend solely on saturation at a point effectively collapses the functional dependencies along other dimensions such as saturation history even under conditions where constitutive relations may reasonably be expressed as functions only of local saturation numerical solutions using high accuracy numerical methods and precisely measured constitutive relations still fail to model experimental observations riaz et al 2007 wang et al 2018 these results are not surprising in their classical and most prevalent form constitutive relations rest on the pivotal assumption of instantaneous local equilibrium and are expressed as functions solely of local saturation barenblatt et al 1997 ren et al 2017 this assumption may violate the steady state requirement that the flow minimizes the dissipation of energy across the medium king et al 1995 compounding this difficulty is the fact that relative permeabilities and capillary pressure are measured based on the assumption of steady state equilibrium conditions then used to describe dynamic processes the steady state assumption may adequately approximate systems in which the characteristic time scale of the flow process is large compared to the time it takes for the system to accommodate a perturbation in flow conditions but there are many cases of interest such as co2 injection into geologic formations where this assumption fails to reflect the physics aryana and kovscek 2012 the resulting inaccuracy sharply reduces the predictive capability of the classical darcy muskat model muskat and meres 1936 for unstable multiphase flow processes riaz et al 2007 barenblatt et al 2003 several investigators have proposed nonequilibrium models to address this deficiency hassanizadeh and gray 1993a b h g proposed a dynamic capillary pressure saturation relationship motivated by volume averaging of microscopic flow equations and thermodynamic considerations in this model the dynamic capillary pressure differs from the static capillary pressure by the product of a dynamic coefficient τ and the local rate of change of saturation hassanizadeh et al 2002 the h g model does not incorporate nonequilibrium effects in the relative permeabilities juanes 2008 a nonequilibrium model proposed by barenblatt 1971 barenblatt and gilman 1987 bne rests on the argument that wetting and non wetting phases flowing simultaneously establish separate networks of flow pathways that connect the flowing portion of each phase any change in capillary pressure causes a reconfiguration of flow pathways barenblatt et al 2003 this reconfiguration changes the connectivity of the flowing phases and the overall hydraulic conductance the characteristic time required for the flow field to transition from one steady state arrangement of pathways to another is the redistribution or relaxation time τ by evaluating the constitutive parameters at time t τ after relaxation the bne model addresses nonequilibrium effects in both relative permeability and capillary pressure it also effectively relies on a future solution other alternative constitutive models include the extension of capillary pressure to dynamic conditions by kalaydjian 1987 and dynamic capillary pressure relations that depend on specific interfacial areas and euler characteristic joekar niasar et al 2010 mcclure et al 2018 niessner and hassanizadeh 2008 aryana and kovscek 2013 a k presented a general nonequilibrium formulation that incorporates temporal averages by replacing the local saturation with an integral over the transient redistribution time window to implement a model of this type one must solve for a series of future solutions simultaneously which is not practical the bne model circumvents this difficulty effectively replacing the time integral by a low order numerical quadrature using the local future solution at the end of the window of integration in place of the time integral the h g and bne models lend insight into the implications of unsteady flows the implementation of these models in large scale numerical simulators however suffers from two important drawbacks first redistribution time cannot be directly extracted from experiments for most flow conditions as a result it often becomes a fitting parameter in practice barenblatt et al 2003 ren et al 2017 second the inclusion of these models results in fully nonlinear pdes whose numerical stability and convergence are sensitive to the numerical value of τ and its magnitude relative to the time step size hassanizadeh et al 2002 as a consequence of the difficulties large scale commercial simulators and most research grade simulators rely on the classical formulation of the constitutive relations and do not attempt to account for nonequilibrium effects 3 proposed model the model advanced in this paper rests on two observations first time and space are related via the transport equation second darcy s law is an expression for steady state flow and fluid mobility and constitutive relations are established experimentally based on equilibrium or steady state conditions honarpour 2018 this is true regardless of the experimental method used to measure the constitutive functions the method can be unsteady but the estimation is still based on the aforementioned assumptions in practice however macroscale models are used to simulate unsteady and dynamic conditions therefore we should expect to upscale local saturation information to a length scale at which the assumption of near steady flow is valid a scale that can be extracted from observations of stable or unstable flows directly and is not a fitting parameter 3 1 motivation to motivate the second observation recall that a representative elementary volume rev is a finite spatial volume whose diameter is the smallest characteristic scale at which variables such as the porosity are well defined panfilov 2013 strictly speaking the linear relation between velocity and the gradient field expressed by darcy s law is valid only under steady state conditions irmay 1958 as a result classical macroscale formulations hinge on the fundamental assumption of local phase equilibrium barenblatt et al 2003 and steady flow in the multiphase extension of darcy s law constitutive functions are assumed to be functions of fluid phase saturations not on the specific fluid configurations at the sub rev scale for this assumption to be valid either the fluid configurations in the pores must relax instantaneously to their steady state configurations or we must average the saturations over a length scale at which the details of transient sub rev fluid configurations are negligible to describe unsteady flow processes therefore requires a constitutive relation averaging length that may vary in size and may differ from the averaging length used for such properties as the porosity we refer to the former as the dynamic averaging length and the latter as the static averaging length the common practice of treating constitutive relations as functions of local saturation thus implicitly assumes that the static and dynamic averaging lengths are the same we hypothesize that this assumption is a source of disagreement between numerical solutions and experimental observations for unsteady flows the effective values of the saturation dependent constitutive functions which define the flux for a given state of saturation can differ significantly from their values obtained from standard measurements barenblatt et al 2003 3 2 formulation we propose a multiscale view in which saturation dependent constitutive relations must be averaged over dynamic averaging lengths at each point x in space and time t we define the effective saturation as the weighted average of saturation along the unique particle path passing through the point over an interval of length l centered about the given point the parameter l is the dynamic averaging length it is a measure of the length of the mixing zone and may be calculated from observations of the mixing zone at a given time t as shown in the sketch in fig 1 s i shock and s i ahead represent invading phase saturation values at the shock and ahead of the front the theoretical displacement front respectively s i shock is obtained from the solution of the buckley leverett equation buckley and leverett 1942 we calculate l as the distance between the locus of the theoretical saturation shock s i shock as predicted by the buckley leverett equation buckley and leverett 1942 and the locus of the actual toe of the invading front s i ahead from the corresponding experimental observations this procedure approximates the length of the mixing zone while conserving mass that is diffused in the physical observations around the location of the sharp front predicted by the buckley leverett equation a critical question for the proposed model is how to determine the length of the mixing zone which is driven by the interaction between nonlinearity in the flow equations and geologic heterogeneity furtado and pereira 2003 the length of the mixing zone does not serve as a tuning parameter instead we must obtain it through observations recent advances in reservoir monitoring methods e g 4d time lapse seismic monitoring and seismoelectric coupling facilitate the surveillance of evolution of saturation profiles revil et al 2013 djuraev et al 2017 watanabe et al 2017 based on which the dynamic length of the mixing zone may be estimated in addition numerical investigations furtado and pereira 2003 borges et al 2008a and experimental observations aryana and kovscek 2012 suggest that fluid mixing of two phase immiscible flows in porous media exhibits scaling behavior that can be extracted from observations of the flow knowledge of this scaling behavior may reduce the number of observations needed for accurate estimates of the dynamic mixing zone length the main point is that realistic simulation of multiphase displacement requires realistic estimates of the mixing zone length and methods exist to obtain them the weighted averaging must respect the direction of flow in many applications the time dependent pdes governing multiphase flow in porous media are either hyperbolic or nearly so in the sense that dissipation due to capillarity exerts a small smoothing influence on otherwise sharp fronts the equations propagate information from upstream to downstream in the weighted averaging we assign weights of zero to points in the averaging interval that are downstream in the upstream direction points that are closer to the center of the interval are expected to influence the constitutive relation for the point of interest more heavily therefore points in the upstream direction have weights that decrease with distance from the center of the interval we begin with a parametrization x σ t of a typical particle path using arc length as the parameter σ the saturation s of a fluid along this path is s x σ t which at a fixed time we abbreviate as s σ at the point on the particle path where σ ζ we calculate the corresponding effective saturation η ζ as a weighted average of upwind saturation values that lie 1 along the particle path passing through x ζ at time t ζ and 2 within an arc length of l 2 along the particle path 3 1 η ζ ζ l 2 ζ w σ s σ d σ here l is the width of mixing zone at t and w σ 4 l 1 2 l σ ζ ζ l 2 σ ζ is the weighting function with this choice the weighting function integrates to 1 i e w σ d σ 1 and decreases linearly from the current point ζ along the particle path to a point at distance l 2 upstream the choice of the linear weighting function is motivated by the expectation that information farther in the upstream direction from a given point will have less impact on the state of flow at that point moreover we choose a linear weighting function in the absence of information that may guide us to a more complex formulation which may require additional effectively tuning parameters unlike the h g and bne models which may require the use of iterative methods to solve at each time step the proposed averaging approach results in quasi linear equations which lend themselves to explicit time stepping schemes moreover the proposed upstream weighted averaging is performed along the particle path at each point and the associated computational cost does not increase in higher dimensions e g in two versus three dimensions given the velocity field we calculate values of the effective saturation η and evaluate the saturation dependent constitutive relations at η to check that the proposed approach is consistent with the classical approach consider the limiting case in which saturation values relax to steady state values instantaneously in this limiting case the dynamic averaging length vanishes and we recover the classical formulation in this case the effective and actual saturation values are the same an important consideration in the development of the mathematical model is availability of appropriate numerical schemes the classical constitutive relations of multiphase flow in porous media lead to quasi linear pdes mathematical theory is well established for scalar quasi linear pdes the inclusion of prominent non equilibrium models in the constitutive relations e g bne and h g models leads to more challenging fully nonlinear pdes where nonlinearities depend not only on the solution but also on the derivative of the solution bocharov et al 1989 van duijn et al 2007 the proposed non equilibrium model leads to quasi linear pdes for which mathematical theory is well developed especially for scalar quasi linear pdes for instance in the context of the buckley leverett equation buckley and leverett 1942 fourier stability analysis anderson and wendt 1995 isaacson and keller 2012 smith 1985 reveals that the proposed model leads to conditionally stable explicit time stepping schemes 4 numerical simulation 4 1 problem set up we tested this formulation using two dimensional numerical simulations of two phase fluid displacements on a rectangle having width w and length l the invading phase with viscosity μi is injected into the porous medium at the left boundary x 0 with a constant velocity u 0 y t u 0 u 0 displacing the resident phase with viscosity μr we assume that the invading phase pressure is constant at the outlet x l the no flow boundary condition u n 0 is imposed at the bottom and top boundaries y 0 and y w where n is the unit vector normal to the boundaries for simplicity we assume incompressible and isothermal conditions the porous medium is homogeneous with a constant permeability k and porosity ϕ the governing equations are 4 1 2 ψ k λ t ξ 1 k λ t ξ u k u u x u y y ψ u x 0 x ψ ϕ t s i u f i ξ k f i ξ λ r ξ p c ξ q i here ψ is the fluctuating component of the stream function ψ k is the unit vector in the positive z direction ux and uy are scalar components of u along x and y axes respectively subscripts i and r denote the invading and the resident phases respectively we use ξ to denote either their actual or effective saturation values depending on the numerical experiment being conducted the total mobility is λ t ξ λ i ξ λ r ξ pc ξ is the capillary pressure u is the total velocity and qi is the volumetric flow rate of the invading phase the derivation of system 4 1 is referred to wang et al 2018 due to the use of a vorticity stream function formulation tryggvason and aref 1983 meiburg and homsy 1988 tan and homsy 1988 rogerson and meiburg 1993 phase pressure does not serve as a simulation variable the classical model referred to as cla assumes ξ s i and the proposed spatial averaging model referred to as sa assumes ξ η i 4 2 numerical scheme 4 2 1 computation of effective saturation the relation between the effective saturation η and the actual saturation s which passes through the point σ ζ is given by eq 3 1 in a cartesian coordinate system the upwind cell of a given cell is determined based on the direction of flow velocity of the given cell the discrete form of eq 3 1 is given by 4 2 η k 0 m w σ k s σ k where σk denotes a value of arc length σ assigned to each cell in the computational grid through which the particle path passes w σ k σ k 1 σ k w σ d σ k is the index of upwind cells associated with the target cell k 0 refers to the target cell itself m is the maximum number of upwind cells along the particle path such that ζ σ m l 2 and ζ σ m 1 l 2 are satisfied or cell m 1 is located out of the discrete domain as shown in the sketch in fig 2 cells filled in gray denote upwind cells of the target cell filled in black σk is approximated given by 4 3 σ k ζ k 0 ζ j 1 k d j 1 j k 1 where d j 1 j is the distance between the center of neighboring cells j 1 and j 4 2 2 discretization of governing equations to calculate velocity components ux and uy we apply the fourier transform to the first equation in system 4 1 resulting in 4 4 f ψ f k λ t ξ 1 k λ t ξ u k k x 2 k y 2 where f denotes the fourier transform operator and kx and ky are wave numbers along the x and y axes respectively the spatial derivative term 1 k λ t ξ is computed with sixth order compact finite differences lele 1992 the first order spatial derivatives of f ψ are given by kutz 2013 4 5 f x ψ i k x f ψ and f y ψ i k y f ψ where i 2 1 the spatial derivatives x ψ and y ψ of the fluctuating component of the stream function are computed by performing an inverse transform on both sides of eq 4 5 the numerical scheme for the transport equation in system 4 1 is obtained from integration of that equation over cell v j ℓ 4 6 v j ℓ ϕ t s i d a v j ℓ f i ξ u n d s v j ℓ k f i ξ λ r ξ p c ξ n d s where the external invading phase volumetric flow rate is assumed to be zero q i 0 v j l is assumed to be rectangular with area of δxδy the spatial derivative of the dissipation flux is computed using fourth order central differences to reduce numerical dispersion arising from the discretization of the convection flux and to capture saturation fronts without introducing misleading oscillations a high order total variation diminishing tvd scheme harten 1983 sweby 1984 is applied to the convection flux this work implements the central upwind scheme kurganov and levy 2000 kurganov and tadmor 2000 kurganov et al 2001 where the intermediate values are constructed using the fifth order weighted essentially nonoscillatory weno scheme jiang and shu 1996 shu 2009 details of the discretization of convection flux are presented in appendix a the third order tvd runge kutta method gottlieb and shu 1998 gottlieb et al 2001 is used for the temporal discretization the transport equation in system 4 1 is rewritten as 4 7 d s i d t l ξ u where l ξ u 1 ϕ δ x δ y c ξ u d ξ c ξ u and d ξ are approximations to the discretization of convection and dissipation fluxes respectively the time marching scheme over t n t n 1 is given by 4 8 s i 1 s i n δ t l s i n u n 1 s i 2 3 4 s i n 1 4 s i 1 1 4 δ t l s i 1 u n 1 s i n 1 1 3 s i n 2 3 s i 2 2 3 δ t l s i 2 u n 1 and 4 9 η i 1 s i n δ t l η i n u n 1 η i 2 3 4 s i n 1 4 η i 1 1 4 δ t l η i 1 u n 1 s i n 1 1 3 s i n 2 3 η i 2 2 3 δ t l η i 2 u n 1 for the cla and sa models respectively the superscript n and n 1 denote time step counters δt is time step size 4 3 experimental data simulation input physical observations used in this study are based on a series of core scale displacement experiments the centerpiece of the drainage experiments is a strongly water wet cylindrical berea sandstone cores 5 08 cm in diameter and 60 cm in length the imbibition experiments are conducted using a strongly water wet cylindrical berea sandstone cores 5 1 cm in diameter and 52 cm in length the cores are characterized as homogeneous porous media with negligible variations in porosity and permeability along the main direction of flow at the initial stage cores are saturated with the resident phase uniformly x ray tomography is used to collect in situ saturation distribution data nondestructively tang and kovscek 2011 aryana and kovscek 2012 simulation parameters representative of the experiments are used in numerical simulation models data shown in table 1 represent core scale imbibition and drainage displacement experiments using pairs of immiscible fluids the viscosity ratio in table 1 is the ratio of the viscosity of resident fluid to that of the invading fluid endpoint and total shock mobility ratios are often used as indicators of the onset of flow instability hagoort 1974 yortsos and hickernell 1989 riaz and tchelepi 2004 beliveau 2009 berg and ott 2012 where mobility ratios larger than unity indicate an unstable displacement corresponding simulation parameters are presented in table 2 imbibition relative permeability functions are based on steady state measurements tang and kovscek 2011 and for drainage corey type relative permeability functions corey 1954 are used where the end points and exponents are guided by steady state displacement experiments aryana and kovscek 2013 we use capillary pressure data obtained from a mercury intrusion experiment ren et al 2017 random perturbations are introduced in the initial condition ruith and meiburg 2000 riaz and tchelepi 2006 we choose the spatial mesh size to be no greater than the critical wavelength resulting from a linear stability analysis to resolve all relevant physical scales chuoke et al 1959 hagoort 1974 saffman and taylor 1988 feder 2013 for each case we plot one dimensional profiles of saturation versus dimensionless distance xd obtained by averaging the saturation along cross sectional lines perpendicular to the x direction at three different times dimensionless dynamic averaging lengths ld and the associated dimensionless simulation times td which represent injected pore volumes are tabulated in table 3 5 results and discussions figs 3 and 4 show saturation maps obtained from two dimensional numerical solutions and their equivalent one dimensional saturation profiles obtained by cross sectional averaging along with experimental data are presented in figs 5 and 6 these results demonstrate the efficacy of the proposed model in capturing physical observations the agreement between the proposed model and physical observations is especially pronounced when compared to solutions of the classical formulation we compare experimental data and numerical solutions for two cases stable displacements in which the invading fluid displaces the resident fluid in a piston like fashion and unstable displacements in which the invading fluid forms viscous fingers as it moves downstream endpoint mobility ratio appears to be an appropriate criterion for the onset of instabilities in the experiments whereas total shock mobility ratio is a better indicator of the onset of flow instabilities in the simulation results saturation maps presented in figs 3 and 4 show that for the fluid systems in experiments 1 and 3 fluctuations in the interface decay as displacement progresses so the displacement is stable the mixing zone becomes a thin piston like band perpendicular to the injection direction the resulting one dimensional saturation profiles exhibit relatively sharp fronts for fluid systems given by experiments 2 and 4 fluctuations grow and develop into prominent viscous fingers these fingers grow longer with time indicating unstable displacement the viscous fingers are reflected as spreading fronts in the cross sectionally averaged saturation profiles in figs 5b and 5 d first consider the results of the cla model as shown in fig 5 cross sectionally averaged saturation profiles obtained from two dimensional simulations using the cla model fail to capture the dynamics of the displacement fronts observed in experiments in the cases of stable displacement as indicated by the total shock mobility ratio simulation results exhibit relatively sharp fronts as shown in figs 5a and 5 c in cases of unstable displacement shown in figs 5b and 5 d saturation profiles from the cla model show evolving fronts with increasing length of the mixing zone in both cases the cla model exhibits significant deviations from the experimental data next consider the results of the sa model proposed in this paper saturation maps presented in figs 3a and 4 a show that for the cases of stable displacement in comparison with the cla model the sa model produces smoother transition zones in the vicinity of the saturation fronts the highly resolved viscous fingers that appear in figs 3b and 4 b are smeared and variations in the amplitude of fingers are reduced this smearing is reflected in the cross sectionally averaged saturation profiles as spreading of the saturation front this numerical spreading lengthens the mixing zone for all the four experiments saturation profiles obtained from the sa model are in remarkable agreement with experimental data and they appear to capture the evolving nature of instabilities observed in the experiments as an additional benefit the sa model alleviates the numerical instability and convergence issues arising from the bne and h g nonequilibrium models accordingly we discretized the proposed model using an explicit time stepping scheme the dynamic length scales in the sa model are extracted directly from experimental observations 6 conclusion this paper proposes a novel self consistent and physics based mathematical formulation for the relative permeabilities and capillary functions used to model multiphase flow in porous media we replace the standard dependencies of these constitutive variables on fluid saturation at a point by dependencies on spatial averages along particle paths the resulting formulation evaluates the variables at saturation values that better reflect the scales over which one can reasonably treat the pore scale fluid distribution as nearly steady state in this respect the new model honors the steady state assumption underlying the extension of darcy s law to multiple phases the averaging window is dynamic and its length scale may be directly obtained from physical observations to test the new model we developed a two dimensional high resolution numerical simulator that resolves all relevant physical scales and elucidates the predictive capabilities of the classical and proposed models across a wide range of parameters and experimental observations the simulator casts the flow equations in a vorticity stream function form the fourier transform is used to solve the vorticity stream function equation the advective flux in the transport equation is computed using a central upwind scheme where the intermediate values are constructed using the fifth order weno scheme the coupled vorticity stream function equation and the transport equation are solved in a sequential manner through explicit time stepping we compare numerical results for homogeneous porous media with core scale imbibition and drainage experiments in the literature saturation maps obtained using the proposed model demonstrate that the averaging of saturations over dynamic length scales has a diffusive effect which smears of viscous fingers that are otherwise well resolved via the classical model the proposed model captures reproducible relevant properties of the evolving fronts in the experiments namely the length of the mixing zone and the position of the leading edge of the front in one dimensional saturation profiles the proposed model is consistent with the physics and is predictive in stable and unstable fluid displacements acknowledgments the corresponding author gratefully acknowledges the donors of the american chemical society petroleum research fund 55795 dni9 for partial support of this research the writing stage of this research was supported as part of the center for mechanistic control of water hydrocarbon rock interactions in unconventional and tight oil formations cmc uf an energy frontier research center funded bythe u s department of energy office of science under doe bes award de sc0019165 the corresponding author also thanks prof frederico furtado and prof victor ginting for our lively discussions appendix a discretization of the convection flux in transport equation the central upwind scheme kurganov and tadmor 2000 kurganov and levy 2000 kurganov et al 2001 is applied to the convection flux for brevity we consider one dimensional system of cells with uniform spacing the semi discrete central upwind scheme kurganov et al 2001 is given by the dissipation flux is not included in the description below a 1 d d t s i j u x j ϕ δ x f ξ θ j 1 2 f ξ θ j 1 2 where a 2 f ξ θ j 1 2 a j 1 2 f ξ j 1 2 a j 1 2 f ξ j 1 2 a j 1 2 a j 1 2 a j 1 2 a j 1 2 a j 1 2 a j 1 2 ξ j 1 2 ξ j 1 2 and f ξ f i ξ subscript i denotes the invading phase in eq a 2 ξ j 1 2 and ξ j 1 2 are left and right intermediate values at cell interface x j 1 2 a j 1 2 and a j 1 2 are local speeds of propagation at cell interface x j 1 2 in this work we take kurganov et al 2001 2007 a 3 a j 1 2 a j 1 2 a j 1 2 where a 4 a j 1 2 max ξ ξ j 1 2 ξ j 1 2 f ξ substituting eq a 3 into eq a 2 the numerical flux reduces to a 5 f ξ θ j 1 2 f ξ j 1 2 f ξ j 1 2 2 a j 1 2 2 ξ j 1 2 ξ j 1 2 f ξ θ j 1 2 is obtained in a similar fashion given by a 6 f ξ θ j 1 2 f ξ j 1 2 f ξ j 1 2 2 a j 1 2 2 ξ j 1 2 ξ j 1 2 intermediate values ξ j 1 2 and ξ j 1 2 are constructed using the fifth order weighted essentially nonoscillatory weno scheme jiang and shu 1996 shu 2009 reconstructions are based on five point stencils with one point biased to the left ξ j 1 2 and one point biased to the right ξ j 1 2 respectively ξ j 1 2 is computed using the stencil i i 2 i i 1 i i i i 1 i i 2 given by shi et al 2002 zahran 2009 a 7 ξ j 1 2 i 0 2 w i ξ j 1 2 i where a 8 ξ j 1 2 0 1 6 2 ξ j 2 7 ξ j 1 11 ξ j ξ j 1 2 1 1 6 ξ j 1 5 ξ j 2 ξ j 1 ξ j 1 2 2 1 6 2 ξ j 5 ξ j 1 ξ j 2 and w i are nonlinear weights given by a 9 w i w i k 0 2 w k where a 10 w k γ k β k with the linear weights given by γ 0 0 1 γ 1 0 6 and γ 2 0 3 β k are the smoothness indicators given by borges et al 2008b a 11 β k β k ε β k ε τ 5 where ε is a parameter used to avoid the division by zero in the denominator β k is given by shi et al 2002 a 12 β 0 13 12 ξ j 2 2 ξ j 1 ξ j 2 1 4 ξ j 2 4 ξ j 1 3 ξ j 2 β 1 13 12 ξ j 1 2 ξ j ξ j 1 2 1 4 ξ j 1 ξ j 1 2 β 2 13 12 ξ j 2 ξ j 1 ξ j 2 2 1 4 3 ξ j 4 ξ j 1 ξ j 2 2 and a 13 τ 5 β 0 β 2 ξ j 1 2 is computed using the stencil i i 1 i i i i 1 i i 2 i i 3 given by a 14 ξ j 1 2 i 0 2 w i ξ j 1 2 i where a 15 ξ j 1 2 0 1 6 ξ j 1 5 ξ j 2 ξ j 1 ξ j 1 2 1 1 6 2 ξ j 5 ξ j 1 ξ j 2 ξ j 1 2 2 1 6 11 ξ j 1 7 ξ j 2 2 ξ j 3 and w i are nonlinear weights given by a 16 w i w i k 0 2 w k where a 17 w k γ k β k with the linear weights given by γ 0 0 3 γ 1 0 6 and γ 2 0 1 β k are the smoothness indicators given by a 18 β k β k ε β k ε τ 5 where β k is given by a 19 β 0 13 12 ξ j 1 2 ξ j ξ j 1 2 1 4 ξ j 1 4 ξ j 3 ξ j 1 2 β 1 13 12 ξ j 2 ξ j 1 ξ j 2 2 1 4 ξ j ξ j 2 2 β 2 13 12 ξ j 1 2 ξ j 2 ξ j 3 2 1 4 3 ξ j 1 4 ξ j 2 ξ j 3 2 and a 20 τ 5 β 0 β 2 supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 05 010 appendix b supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
628,massive sediment motion in water with a free surface is an important kind of geophysical flows such as hyper concentrated sediment laden river flows discharging into estuarine delta and turbidity currents generated by subaqueous landslides one of the key and common characteristics of such flows is that interactions between water and sediment as well as those among sediment particles are equally important in affecting the sediment motion and the fluid flow this paper presents a numerical model that builds on and extends an earlier two phase sph model based on a continuum formulation of solid liquid mixtures shi et al 2017 to provide a unified description of massive sediment motion in free surface flows in the model a constitutive law based on the rheology of dense granular flow is introduced to express the intergranular stresses while the interphase drag force is determined by combining the ergun equation for dense solid fluid mixtures and the power law for dilute suspensions the proposed model is firstly applied to the study of collapse of loosely or densely packed granular columns submerged in water the computed surface profiles of the granular column are found to be in good agreement with the experimental data it shows that the loosely packed and the densely packed columns behave rather differently due to the differences in water sediment interaction processes the model is then used to simulate a dam break flow over a mobile sediment bed the computed configurations of the flow and the movable bed also agree well with the measured data the predicted position on the leading edge of the flow has a mean error of 0 8 while the mean error for the maximum bed height is 12 9 to further identify the dynamic processes involved effects of water sediment interactions on the motion of bed materials are investigated by examining the spatial and temporal variations of pressure and flow velocity as shown in the applications the proposed two phase sph model can successfully represent both the gravity driven underwater granular flows and the shear flow driven intense sediment transport implying its potential use in practical scenarios in which the two kinds of flows exist simultaneously such as landslides triggered by storm in shallow sea and flows resulted in barrier or dam breaks keywords two phase sph model sediment motion water sediment interactions underwater granular column collapse dam break erosion 1 introduction massive sediment motion in free surface flows often occurs in nature one example is the large scale submarine landslide which has been reported to be the main cause of several destructive tsunamis keating and mcguire 2000 lynett and liu 2002 the rapid erosion of riverbed by dam break flow which may result in significant morphological changes of the channel system and increased flooding risk is another typical case capart and young 1998 wu and wang 2007 consequently accurate prediction of massive sediment motion in free surface flows is essential in disaster prevention and mitigation as well as in infrastructure safety assessment massive sediment motion in free surface flows including the gravity induced underwater granular flow and the shear flow driven intense sediment transport is characterized by the high concentration of the particle phase although the flows may be different in driving forces the stresses generated by interphase and intergranular interactions within the solid liquid mixtures are intrinsically the same and play a similarly important role in the flows dong and zhang 2002 shi and yu 2015 lee and huang 2018 in some situations the large deformation of free water surface may also occur spinewine 2005 therefore a unified numerical model for different types of massive sediment motion is required to accurately describe the interactions not only between water and sediment but also among sediment particles at a wide range of sediment concentration and to be capable of capturing the complex deformation of the free water surface this is however not an easy task as most of the available numerical models for sediment motion adopt mesh based eulerian approach they have difficulties in simulating the complicated deformation and fragmentation of free water surface fu and jin 2016 at a more fundamental level it requires improved understanding and formulations of intergranular stresses and interphase forces bakhtyar et al 2010 chauchat 2018 with a two phase model in which the primary flow variables of both water and sediment are fully resolved dong and zhang 1999 bakhtyar et al 2010 mesh free particle methods such as the smoothed particle hydrodynamics sph and the moving particle semi implicit mps methods have proven to be powerful in tracking the violent motion of free water surface gotoh and khayyer 2018 and have also been introduced to the simulation of sediment laden flows ulrich et al 2013 fourtakas and rogers 2016 nodoushan et al 2018 however most of the existing particle models for sediment motion are not formulated strictly in the two phase framework instead they treat clear water and sediment water mixture as two immiscible fluids and represent the two phases by different sets of sph mps particles the sediment phase considered in these models is a mixture of water and sediment and variables of the mixture rather than those of each individual phase are solved as a result they are unable to address directly the intergranular stresses and the interphase forces furthermore suspended load cannot be rigorously resolved by these two immiscible fluid models and it was just approximated by a kernel averaged volumetric sediment concentration ulrich et al 2013 zubeldia et al 2018 only a few attempts bui et al 2007 wang et al 2016 pahar and dhar 2017 shi et al 2017 have been made to develop a complete two phase particle method for liquid solid mixtures all of which however contain some questionable assumptions for instance the variation of sediment concentration was ignored in pahar and dhar 2017 an idealized constitutive law for intergranular stresses i e the elastic perfect plastic model was assumed in bui et al 2007 shi et al 2017 recently presented a two phase sph model for suspended sediment motion in free surface flows which performed well both in idealized and in practical problems with suspended load however the formulations for intergranular stresses and interphase drag force in the model are not sufficiently accurate under high concentration conditions in this paper the two phase sph model developed by the authors shi et al 2017 which is formulated strictly in a two phase framework is extended to describe massive sediment motion it is aimed to give a unified description of gravity induced underwater granular flows and intense sediment transport by flowing water the structure of the model remains unchanged but a number of substantial improvements have been introduced to better describe the underlying physics of dense sediment motion specifically a constitutive law based on the rheology of dense granular flows is used to represent the intergranular stresses to estimate the interphase drag force in both high and low concentration regimes the gidaspow 1994 formula is adopted which combines the ergun equation for dense solid fluid mixtures and the power law for dilute suspensions the proposed model is applied to the studies of collapse of underwater granular columns and bed erosion by dam break flows in the former case the flow is driven by the falling of sediments into still water while in the latter the falling water causes rapid erosion of the mobile sediment bed and strong near bed sediment suspension the computed surface profiles of both loosely and densely packed granular columns submerged in still water with a free surface are compared with experimental data effects of water sediment interactions on the collapse of loosely densely packed columns are examined the fluid flow within the granular material is simulated and the evolution of water vortex in the process of granular column collapse is discussed for the dam break induced erosion problem the computed configurations of the free water surface and the movable bed are compared with experimental results the effects of water sediment interactions on both the motion of bed materials and the bed erosion process are investigated the rest of the paper is organized as follows the governing equations of the two phase model and their sph formulations are described in section 2 applications of the model to underwater granular column collapse and sediment transport by dam break flow are presented in sections 3 and 4 respectively finally conclusions are drawn in section 5 2 a two phase sph model for intense sediment transport 2 1 governing equations for the two phases the continuum description of a sediment water mixture flow is based on the assumption that water and sediment are coupled two phases within the domain of interest both phases are governed by the conservation laws for mass and momentum the general two fluid form of continuity and momentum equations for two phase flows originally derived by drew 1983 are employed in this study to deal with the turbulence of the two phases the sub particle scaling technique dalrymple and rogers 2006 mayrhofer et al 2015 is applied the governing conservation equations are then spatially filtered by virtue of the favre averaging shi et al 2017 the filtered continuity equations are 1 α f ρ f t α f ρ f u f j x j 0 2 α s ρ s t α s ρ s u s j x j 0 in which t is the time x is the coordinate and i j 1 2 3 represent the coordinate directions for which the summation convention is valid the subscripts f and s represent the water phase and the sediment phase respectively α is the volume fraction and α f α s 1 ρ is the density u is the velocity the filtered momentum equations for the two phases are written as 3 α f ρ f u f i t α f ρ f u f i u f j x j α f p f x i α f τ f i j 0 τ f i j t x j α f ρ f g i f i 4 α s ρ s u s i t α s ρ s u s i u s j x j α s p f x i α s τ s i j 0 τ s i j t x j α s ρ s g i f i where p is the pressure τ f 0 is the viscous stress of the water phase while τ s 0 is the intergranular stress of the sediment phase τ t is the sub particle scale sps stress g is the gravitational acceleration f is the force on the solid phase by water excluding the pressure gradient related buoyancy which is a part of the first terms on the right side of the momentum equations f is formulated in the subsection on two phase interactions the viscous stress τ f 0 and the intergranular stress τ s 0 are determined by 5 τ f i j 0 ρ f ν f 0 2 s f i j 2 3 s f l l δ i j 6 τ s i j 0 ρ s ν s 0 2 s s i j 2 3 s s l l δ i j p s δ i j 7 s k i j 1 2 u k i x j u k j x i in which k f s s k ij are the rate of strain tensors of the two phases ν f 0 and ν s 0 are the kinematic viscosities ps is the intergranular pressure of the sediment phase resulting from enduring contact collision and friction between the solid particles the viscosity ν s 0 and the pressure ps are estimated by a rheology based constitutive law for the sediment phase in the following subsection the sps stresses τ k t are modelled based on boussinesq hypothesis 8 τ k i j t ρ k ν k t 2 s k i j 2 3 s k l l δ i j where ν k t k f s are the eddy viscosities of the two phases the well known smagorinsky model smagorinsky 1963 is utilized to determine ν k t but a modification is made to consider the turbulence damping by sediment particles chen et al 2011 9 ν k t c k δ 2 s k 1 α s α s m n in which δ is the characteristic length of filter which is set to be the initial particle size in a sph model s is the rate of strain tensor and its norm s k 2 s k i j s k i j α sm is the maximum sediment volumetric concentration at which the turbulence is assumed to be totally suppressed n is a coefficient c is smagorinsky constant in this study α sm is set to be equal to the jamming volume fraction defined in the following subsection at which the dense sediment phase is in static as in shi et al 2017 n 5 and cf cs 0 1 in the present study the weakly compressible sph wcsph approach is adopted specifically the water phase is assumed to be weakly compressible and the water density ρ f is thus a variable the equation of state eos proposed by shi et al 2017 is utilized to compute the fluid pressure pf in the sediment water mixture 10 p f ρ f 0 c 0 2 ξ α f ρ f α s ρ f 0 α f ρ f α f ρ f α s ρ f 0 ρ f 0 ξ 1 where ξ 7 ρ f0 1000 kg m 3 is the reference water density at pf 0 c 0 is the sound speed in water at the reference density which is usually set to be ten times the maximum water velocity in the problem of interest 2 2 a rheology based constitutive law for intergranular stresses a constitutive law based on the rheology of dense granular flows lee et al 2016 chauchat 2018 is employed to represent the intergranular stresses of the particles phase in sediment water mixture flows this law depends on the frictional characteristic of granular materials i e the shear stress components are related to the pressure it has been successfully applied to bedload transport chiodi et al 2014 sheet flows lee et al 2016 and underwater granular column collapse lee and huang 2018 in the constitutive law the sediment pressure ps has two components a shear rate dependent component p s r for the rheological characteristics of the bulk granular materials and a shear rate independent component p s e for the enduring elastic contact between the solid particles 11 p s p s r p s e boyer et al 2011 and trulsson et al 2012 carefully investigated the rheological characteristics of the dense granular materials in an interstitial fluid it is found that the rheology of dense granular materials is dominated by both inter particle forces and viscosity of the interstitial fluid according to their results the shear rate dependent component p s r can be evaluated by 12 p s r c 1 α s α s 0 α s 2 ρ f ν f 0 c 2 ρ s d s 2 s s s s where α s0 is the jamming volume fraction which is the maximum packing fraction of the sheared granular particles ds is the diameter of sediment particles c 1 and c 2 are model parameters on the other hand when the packing fraction α s increases to the random loose packing concentration α the component p s e comes into play as the volume fraction increases further to the random close packing concentration α the granular materials present a transition from fluid like to solid like behavior johnson and jackson 1987 following hsu et al 2004 and lee et al 2016 the shear rate independent pressure p s e is estimated by 13 p s e 0 α s α k α s α χ 1 sin π α s α α α π 2 α s α in which k is a coefficient related to the young s modulus and the poisson s ratio of the solid material χ is a model parameter generally the parameters c 1 0 75 1 00 c 2 0 01 1 00 and χ 1 5 5 5 trulsson et al 2012 chiodi et al 2014 lee and huang 2018 chauchat 2018 and in the present computations their values as well as that of k are determined based on sensitivity studies in the applications values of α s0 α and α are set depending on the specific solid materials relating the viscous stress of sediment phase to the intergranular pressure according to the frictional law and introducing the papanastasiou regularization technique papanastasiou 1987 to avoid singularity in the expression for viscosity we obtain 14 ν s 0 μ p s ρ s s s 1 e m s s where μ is the friction coefficient of the assembly of sediment particles varying with the inertia number i m is a parameter for regularization fourtakas and rogers 2016 had examined the effect of m on the sediment stresses and accordingly m is set to be 50 in the present study a value at which the effect of regularization on sediment transport is negligible following boyer et al 2011 and trulsson et al 2012 the friction coefficient μ is estimated by 15 μ μ 1 μ 2 μ 1 1 i 0 i and the inertia number i is determined by 16 i α s 0 α s c 1 α s 2 where μ1 tan ϕ is the friction coefficient when i 0 and the assembly is in static with ϕ being the internal friction angle of the solid particles μ2 is the friction coefficient when i approaches infinite and the sediment moves extremely rapidly i 0 is a model parameter c 1 is the same parameter as in eq 12 in general μ2 tan ϕ 1 0 and i 0 0 1 0 3 lee et al 2016 and in this paper the values are determined according to a sensitivity analysis the present constitutive law can provide information on the pre yield and post yield regimes of the sediment phase and thereby avoids the need of special technique for yield judgment pahar and dhar 2017 zubeldia et al 2018 when the assembly of solid particles is in quasi static or static state the stress related to the shear rate independent pressure p s e plays a similar role to the yield stress in bingham and herschel bulkley models fourtakas and rogers 2016 for unyielded sediment the viscosity calculated by eq 14 is particularly large due to its zero shear rate which then keeps the solid phase static 2 3 two phase interactions in the proposed model the two phase interactions are formulated in terms of the primary flow variables of the two phases the pressure gradient related buoyancy on the solid particles is taken into account by the first term on the right side of eq 4 and other interphase forces are included in the term fi in the momentum equations generally fi consists of drag force virtual mass force lift force etc drew 1983 in a problem with high sediment concentration the drag force is predominant hsu et al 2004 wang et al 2016 lee and huang 2018 and hence for simplicity here only drag force is considered assuming the drag force to be proportional to the relative velocity between the two phases we have 17 f i γ α s u f i u s i in which the coefficient γ can be estimated based on the formula proposed by gidaspow 1994 18 γ 3 4 c d ρ f u f u s d s α f 1 65 α s 0 2 150 α s ρ f ν f 0 α f d s 2 1 75 ρ f u f u s d s α s 0 2 where cd is the drag coefficient for solid particles in an infinite fluid u is the norm of the velocity vector cd is a function of the particle reynolds number re s α f u f u s d s ν f 0 and can be determined by the well known schiller and naumann 1935 formula 19 c d 24 re s 1 0 0 15 re s 0 687 re s 1000 0 44 re s 1000 note that eq 18 is considered to be more robust than the power law for γ used by shi et al 2017 which is based on the study of sediment settling in still water by richardson and zaki 1954 and is not valid for α s 0 4 yin and koch 2007 lee and huang 2018 the gidaspow 1994 formula combines wen and yu 1966 s power law for dilute suspensions and the ergun equation originally obtained by ergun 1952 for pressure drop in the flow through packed columns and valid for dense solid fluid mixtures this formula has been well validated and widely applied to the study of intense sediment motion neri et al 2003 li et al 2018 si et al 2018 it is necessary to point out that in the present model the interphase momentum transfer term γ ν f t α s x i α f s c in the governing equations in shi et al 2017 which is due to the sps turbulence and results from the favre averaging in the spatial filtering is neglected as it was found to play a negligible role in the simulations of both underwater granular column collapse and bed erosion by dam break flows 2 4 governing equations in lagrangian form the solid liquid two phase system is discretized into a single set of sph particles which move with the water velocity and carry properties of both phases hence the substantial derivative of a physical quantity φ associated to a sph particle is expressed as 20 d φ d t φ t u f j φ x j note that the water is assumed to be weakly compressible while the sediment is incompressible thus the water density ρ f is an unknown while the sediment density ρ s is a constant with d ρ s d t 0 rewriting the eulerian form of the conservation equations 1 4 into lagrangian form by virtue of eq 20 the governing equations for water density sediment concentration water velocity and sediment velocity carried by a sph particle are obtained as 21 d α f ρ f d t α f ρ f u f j x j 22 d α s d t α s u f j x j α s u s j u f j x j 23 d u f i d t 1 ρ f 0 p f x i 1 α f ρ f α f ρ f t f i j x j g i γ α s α f ρ f u f i u s i 24 d u s i d t 1 ρ s p f x i 1 α s ρ s α s ρ s t s i j x j g i γ ρ s u f i u s i u s j u f j u s i x j where t k i j τ k i j 0 τ k i j t ρ k k f s the equation for the water density i e eq 21 comes from the continuity equation for the water phase and describes the evolution of α f ρ f due to the volume change of the sph particle for the sediment concentration α s the continuity equation for the sediment phase is rewritten into eq 22 with the first term on the right side representing the contribution of the volume change of the sph particle and the second term representing the effect of the inter particle sediment mass flux note that as the velocities of the two phases are different there may be mass and momentum fluxes of sediment among different sph particles eqs 23 and 24 are derived from the momentum conservation equations of the water and the sediment phases respectively the first four terms on the right side of the equations represent the effects of the fluid pressure the viscous and turbulence stresses the gravity and the interphase drag force the last term on the right side of eq 24 is a convection term for the inter particle sediment momentum flux and is also a result of the relative velocity between the two phases 2 5 sph formulations the detailed sph formulations of the proposed two phase model can be referred to shi et al 2017 here for completeness a short description as well as some improvements in the discretizations of fluid stress term and inter particle flux terms are presented in a sph model the value of a physical quantity φ carried by sph particle a i e φ a is approximated by the summation over all neighboring particles in the supporting domain of the kernel function w 25 φ a b φ b w a b v b in which φ b is the value of φ carried by the neighboring particle b vb is the volume of particle b defined by 26 v b m f α f ρ f b with mf being the water mass carried by the particle which remains constant during the simulations wab w x a x b h where x a and x b are the positions of particle a and b respectively h is the smoothing length of the kernel function w and is set to be 1 3 times the initial particle spacing in the present model the quintic kernel function proposed by wendland 1995 is utilized the volume of sediment phase carried by particle a vs a is given by 27 v s a v a α s a m f α f ρ f a α s a where va is the volume of particle a as time runs the water mass mf of particle a keeps constant while the sediment mass ms a ρ s vs a is variable according to eqs 21 and 22 the volume of sediment carried by a sph particle varies as a consequence of the inter particle fluxes of sediment mass the divergence of the water velocity at particle a is discretized as 28 u f j x j a b u f j b u f j a a w a b j v b in which 29 a w a b w r x a x b x a x b and a wab j is its component in j direction the symmetric scheme utilized in violeau and rogers 2016 which conserves momentum is adopted to formulate the fluid pressure terms i e the first terms on the right side of eqs 23 and 24 attention should be paid to the formulation of the shear stress terms as α s in the denominator may vanish when dealing with possible concentration discontinuity shi et al 2017 in eq 30 the shear stress term is separated into a gradient term of stress and a gradient term of concentration replace αkρk xj αkρk by ln αkρk xj which is a preferable form to increase the robustness of the model for problems with discontinuity of sediment concentration then the symmetric scheme proposed by ren et al 2014 is applied hence 30 1 α k ρ k α k ρ k t k i j x j a t k i j x j t k i j α k ρ k α k ρ k x j a t k i j x j t k i j ln α k ρ k x j a b t k i j a t k i j b 1 1 2 ln α k ρ k b α k ρ k a a w a b j v b an upwind scheme is proposed for the formulations of the inter particle sediment mass flux term i e the second term on the right side of eq 22 and sediment momentum flux term i e the fifth term on the right side of eq 24 31 α s u s j u f j x j a b α s a max u s j u f j a a w a b j 0 α s a max u s j u f j b a w a b j 0 α s b min u s j u f j a a w a b j 0 α s b min u s j u f j b a w a b j 0 v b 32 u s j u f j u s i x j a b u s i a u s i b min u s j u f j a a w a b j 0 min u s j u f j b a w a b j 0 v b finally the discretized sph equations for sediment water mixture flows become 33 d x i a d t u f i a 34 d α f ρ f a d t α f ρ f a b u f j b u f j a a w a b j v b 35 d α s a d t α s a b u f j b u f j a a w a b j v b b α s a max u s j u f j a a w a b j 0 α s a max u s j u f j b a w a b j 0 α s b min u s j u f j a a w a b j 0 α s b min u s j u f j b a w a b j 0 v b 36 d u f i a d t 1 ρ f 0 b p f a p f b a w a b i v b b t f i j a t f i j b 1 1 2 ln α f ρ f b α f ρ f a a w a b j v b g i γ a α s a α f ρ f a u f i u s i a 37 d u s i a d t 1 ρ s b p f a p f b a w a b i v b b t s i j a t s i j b 1 1 2 ln α s b α s a a w a b j v b g i γ a ρ s u f i u s i a b u s i a u s i b min u s j u f j a a w a b j 0 min u s j u f j b a w a b j 0 v b with the following eos for the water pressure 38 p f a ρ f 0 c 0 2 ξ α f ρ f a α s a ρ f 0 α f ρ f a α f ρ f a α s a ρ f 0 ρ f 0 ξ 1 note that eq 33 determines the position of the sph particle 2 6 time integration and shepard filtering the predictor corrector scheme of monaghan 1989 is adopted to integrate eqs 33 37 with respect to time the time step is variable and restricted by the numerical sound speed the maximum inertia forces and the viscous forces of the two phases through the cfl conditions ulrich et al 2013 shi et al 2017 the strategy of shepard filtering proposed by shi et al 2017 is utilized to damp the pressure oscillation in the sediment water mixture the filtering is performed every 20 time steps by reinitializing the water density of each particle according to 39 ρ f a b ρ f b w a b v b b w a b v b b m f b 1 α s b w a b b m f b α f ρ f b w a b both the water mass and the sediment mass carried by a sph particle are conserved in the shepard filtering resulting in 40 α f ρ f a α f ρ f a α f ρ f a α s a ρ f a ρ f a 41 α s a α s a α f ρ f a α s a ρ f a ρ f a 2 7 boundary conditions in sph models free water surface can be naturally tracked by particles but special attention should be paid to the solid wall boundaries in the present model the dynamic boundary condition proposed by crespo et al 2007 is employed to avoid the kernel truncation near the solid boundaries the solid boundary is represented by allocating three layers of sph particles along it which satisfy the same equations as those for the fluid particles but do not move in response to the computed forces exerted on them they keep fixed in position for immobile boundaries or move according to externally imposed trajectory for prescribed moving boundaries 2 8 numerical implementations the proposed model is implemented on the basis of the open source sph package gpusph which was originally developed by hérault et al 2010 gpusph is programmed with cuda and c and conducts parallel computations on nvidia cuda enabled graphics processing units gpus the numerical computations in the present study are carried out on an nvidia tesla k40c gpu with 2880 processor cores 3 collapse of underwater granular columns collapse of a submerged granular column under gravity is a classical problem of massive sediment motion in free surface flows which occurs in a variety of natural and hazardous processes such as underwater landslide and submarine avalanches rondon et al 2011 it has also been widely used as a benchmark problem for validation of numerical models for dense granular motion in fluid meruane et al 2010 savage et al 2014 wang et al 2017a si et al 2018 however the relevant collapsing process is still not well understood during collapse the sediment phase may be fluid like solid like or in a transition state according to its shear rate which makes modelling the behavior of the granular column very difficult the solid fluid interactions make the situation even more complicated the variation of the fluid pressure in the porous material can either stabilize or destabilize the assembly of particles iverson et al 2000 and the drag force between the solid particle and the fluid may resist or accelerate the collapsing process of the granular column depending on the relative velocity between the two phases si et al 2018 the initial volume fraction of the solid phase plays a very important role in the phenomenon rondon et al 2011 wang et al 2017b in this section the proposed two phase sph model is carefully validated and employed to investigate the effects of water sediment interactions on the collapse of loosely densely packed granular columns submerged in still water effects of the free surface motion are discussed as well rondon et al 2011 had conducted a well known experimental study on the role of initial porosity in the case of a granular column collapse in a viscous fluid due to the large fluid viscosity and the low ratio of the column height to the fluid depth in rondon et al 2011 the motion of the free surface resulting from the granular column collapse was negligible following rondon et al 2011 wang et al 2017b performed a similar experiment with a larger granular column size and using water as the ambient fluid in this experiment the fluctuation of free water surface was visible though not significant in the present study the proposed two phase sph model is applied to the experiment of wang et al 2017b the experiment of wang et al 2017b was conducted in a rectangular tank of 50cm long 10cm wide 15cm high as shown in fig 1 a granular column was initially confined at the left end of the tank by a removable gate the horizontal and the vertical directions are defined as x i e x 1 in the governing equations and z i e x 3 in the equations directions respectively l is the distance from the left end of the tank to the front of the granular avalanche and h is the height of the column at x 0 the particles used were glass beads of density ρ s 2500 k g m 3 and mean diameter ds 300 μm with an internal friction angle of φ 25 0 4 the granular column was prepared in both loose packing and dense packing state in the loose packing case the glass beads were gently poured into the space delimited by the wall and the gate resulting in an initial shape of l h 6 cm 8 cm granular column the initial sediment volume fraction of the loosely packed column was α s 0 53 0 005 in the dense packing case the tank was gently tapped and an initial solid volume fraction of α s 0 57 0 003 was obtained the initial length of the column l was 6 cm and the initial height of the column h was reduced to 7 8 cm the granular column was submerged in 10 cm deep water with fluid density ρ f 1000 k g m 3 and viscosity ν f 0 10 6 m 2 s the time period taken to remove the gate was shorter than 0 1 s and its influence on the column collapse could be ignored wang et al 2017b once the gate was removed the column collapsed and the final deposition of the granular mass was reached in just a few seconds the physical problem as described above can be treated as a two dimensional problem to simulate such a problem with a three dimensional numerical model the computational conditions are kept the same as those in the experiments except in the width direction of the tank y direction for which a periodic condition is imposed and a minimum 4 layers of sph interpolating particles are arranged the initial size of sph interpolating particles is set to be 0 002 m according to a convergence study and in the present simulations the solid fluid mixture is discretized into a set of 250 50 4 50000 sph particles besides the dynamic boundary condition is applied to the bottom and the sidewalls in x direction with three layers of fixed sph particles representing the solid boundaries hence in each computation a total of 50 000 interpolating particles for the two phase mixture and 4464 particles for the solid boundaries are used fig 2 shows the particle configuration at t 0 s after removal of the gate in the loose packing case in which the red particles are those carrying the initial sediment volume fraction 0 53 and represent the saturated granular column values of the model parameters and some physical quantities of the solid material used in the present simulations are summarized in table 1 the sensitivities of the granular avalanche front position l at t 0 5 s in the loose packing case and the column height h at t 4 0 s in the dense packing case to model parameters are shown in table 2 it is seen that the numerical results are not significantly affected by a variation of the parameters as long as the variation is limited in the specified range the parallel computations are carried out on an cuda enabled nvidia tesla k40c gpu and it requires about 25 min of computational time to simulate 1 s of the physical experiment 3 1 model validations figs 3 and 4 show the comparisons of the computed profiles of the granular column by the present model with the experimental data for the loose packing and dense packing cases respectively results of the earlier two phase sph model developed by shi et al 2017 are also presented the predictions by the present proposed model are generally in good agreement with the experimental data in both cases and are much more accurate than those by the model of shi et al 2017 small discrepancies are observed at t 0 5 s in the loose packing case and at t 1 0 s in the dense packing case but they are still acceptable for the loosely packed column upon the removal of the gate the whole upper part falls immediately leading to a thin surge of solid materials at the front of the granular mass the flow front moves quickly and stops at x 22 0 cm with a long runout distance l simultaneously the grains in the main body of the column flow down the surface and a triangular final deposition profile is reached in 2 5 s for the dense packing case a very different collapsing process is observed once the gate is removed particles at the upper right corner and on the lateral surface fall freely resulting in a steep profile with a round corner before t 1 0 s the left upper part of the column keeps unmoved at the initial stage and assumes a plateau like shape as time goes on the erosion propagates inward and the plateau is eroded gradually the flow front stops at x 18 0 cm in 1 5 s with a shorter runout distance than that in the loose packing case a bump is formed behind the flow front and the concave region between the column body and the bump is filled gradually by the particles falling down from the top of the column this so called hydraulic like granular jump behavior shown in the experiment wang et al 2017b is captured by the proposed model the final deposition profile of the initially densely packed column is obtained after 4 0 s implying a longer collapse duration than that in the loose packing case figs 5 and 6 show the sequential configurations of the free water surface for the loose packing and the dense packing cases respectively compared with the observed surface motion in the original video records available from the web version of wang et al 2017b the simulated fluctuations of the free water surface are consistent with the experimental results also as expected the water surface fluctuation in the dense packing case is smaller than that in the loose packing case due to a slower collapsing process specifically at the initial stage the collapsing column pulls down the water surface the free surface is thus disturbed and the wave propagates back and forth in the tank until it dissipates due to the fluid viscosity the evolutions of the solid volume fraction carried by the sph particles in the two cases are shown in figs 5 and 6 for the loose packing case as shown in the dark colored zone at the lower left corner of the granular pile the maximum solid volume fraction of the column increases from the initial value of 0 53 to about 0 55 in the early collapse stage and keeps increasing gradually as time goes on indicating a contraction behavior of the loosely packed column on the contrary for the dense packing case the value decreases from 0 57 to 0 56 in the initial stage presenting a dilation behavior of densely packed materials the result of the contraction dilation of the granular column is consistent with that found in rondon et al 2011 wang et al 2017b and lee and huang 2018 further validating the present two phase sph model in addition the suspension of solid particles around the flow front is well captured by the present model as shown in figs 5 b and 6 b the particles are suspended by the water vortices when rapid collapse occurs in the early stage of the process and soon settle down as the granular flow propagates this phenomenon is clearly shown in the original video records as shown in fig 7 3 2 water sediment interactions fig 8 shows the distributions of the fluid pressure of the sph particles in both the early and the final collapse stages for the loose packing case and fig 9 for the dense packing case note that the initial hydrostatic water pressure at the bottom of the tank is ρ f gh 981 pa for the loose packing case the fluid pressure in the lower part of the column increases due to the contraction of the granular material in the early stage of the collapse with a maximum value of 1200 pa reached the high pressure disperses with the spreading of the granular mass however for the dense packing case in fig 9 a large low pressure zone is observed in the column at the initial collapse stage and it lasts for quite some time it should be pointed out that fully restoration of the water pressure to the hydrostatic condition is not pursued in the present simulations due to a considerable increase of the computational efforts it is shown that the numerical results of the fluid pressure are consistent with those of wang et al 2017b and si et al 2018 the gradient of the fluid pressure field produces a force on the solid phase high pressure within the column in the loose packing case then leads to an outward force on the solid phase that accelerates the collapse while low pressure in the densely packed column leads to an inward force that helps to stabilize the granular column note that in fig 8 a due to lowering of the free water surface the fluid pressure within the upper column becomes smaller than the hydrostatic value at the same height this result is physically more realistic than that of si et al 2018 and lee and huang 2018 in which the rigid lid hypothesis is imposed on the water surface and thus the motion of the free surface is neglected effects of the interphase drag force on the granular column collapse are presented in figs 10 and 11 the distributions of the computed drag force at representative times in the two cases are shown in fig 10 f d γα s u f u s and its norm f d is normalized by ρ s g in both cases at the initial collapse stage the water is pulled down from a static state by the grains that are about to crush this in turn exerts a strong drag force on the solid particles which points inward to the core of the column and hinders the collapse the magnitude of the drag force near the column surface where the particles move rapidly is generally larger than that in the inner zone at the initial stage of collapse the magnitude of the drag force in the densely packed column with a maximum value of about 0 30 ρ s g is much larger than that in the loosely packed one with a maximum value of 0 14 ρ s g resulting in a more stable state of the granular mass in the dense packing case besides in the later stage when the magnitude of the drag force decreases with the deceleration of the collapse the drag force in the main part of the densely packed column at t 2 4 s is still stronger than that in the loosely packed material at t 1 0 s notably different from the situation in the main body of the column where the interphase drag helps to stabilize the granular column in the flow front the drag force on the solid particles may show a positive effect and drive the granular flow as shown in the zoomed in view in fig 10 b due to the stronger effect of the drag force in the flow front the granular flow in the loose packing case has a longer runout distance than that in the dense packing case to further identify the effects of the interphase drag force more simulations of the collapse are carried out using the present model but excluding the drag force γ 0 is set while the values of all the other parameters and coefficients are kept the same as in the above computations fig 11 shows comparisons of the computed sequential profiles of the granular column with and without the formulation of the drag force in both the loose packing and the dense packing cases when ignoring the drag force the columns move faster at the initial collapse stage with a wider spread of the particles and a smaller column height h at the left end of the tank however in the later stage for the loosely packed column the drag force on the solid particles drives the front part of the granular flow as shown in the comparisons at t 1 0 s and t 2 5 s in fig 11 a the situation is different for the dense packing case where the positive effect of the drag force is insignificant in almost the entire period of the collapse the column simulated without the drag effects has a larger runout distance than that including the interphase drag neglect of the drag force results in a longer duration of collapse in both cases the computed profiles of the deposit without the drag force for both loose and dense packing cases are quite similar as shown in figs 11 a and b which demonstrates that the importance of the initial solid volume fraction on column collapsing process can be revealed only when the water sediment drag is properly taken into account 3 3 evolution of vortices generated by granular column collapse the simulated evolutions of vortices generated by the granular column collapse are shown in figs 12 and 13 well representation of the dynamic process of these vortices is an advantage of the present numerical model it is shown that at the initial stage of the collapse a large vortex is induced by the movement of the solid grains for the loose packing case the vortex core is around the upper right corner of the column and the water velocity in the whole upper column is notable as shown in fig 12 a on the other hand for the dense packing case in fig 13 a the vortex core is around the right side surface of the column implying that the column collapse starts from the right side of the surface and propagates inward the moving layer of the water flow within the granular mass in the loose packing case is much thicker than that in the dense packing case during the later stage of the collapse process in both cases the vortex propagates and grows with the acceleration of the collapse as shown in figs 12 b and 13 b once the front of the granular flow stops the vortex moves upward and finally disappears due to the fluid viscosity the vortex can induce suspension of solid particles the areas encircled in figs 5 b and 6 b for the particle suspension are in the core of the vortices as shown in figs 12 b and 13 b the vortex may also be affected by the fluctuation of free water surface in fig 12 a the vortex is restricted by the free surface and the sinking of the surface increases the velocity of the water flowing into the upper part of the porous material resulting in a downward drag force on the solid particles in the upper column as shown in fig 10 a 4 sediment transport by dam break flows dam break over a movable bed may cause a significant amount of sediment to be eroded and transported leading to substantial changes of the downstream river morphology and possible damages to infrastructures it has long been the subject of many experimental and numerical studies in hydraulic and river engineering capart and young 1998 ran et al 2015 it is also a test case for meshless numerical models of sediment transport shakibaeinia and jin 2011 ulrich et al 2013 pahar and dhar 2017 zubeldia et al 2018 however due to the violent free surface motion and the complex bed erosion process development of a comprehensive numerical model for detailed description of the dam break erosion is still very challenging shakibaeinia and jin 2011 in this section the proposed two phase sph model is applied to the massive sediment transport caused by dam break flows to assess its predicative capability the case considered is the two dimensional experiment of dam break over a mobile bed carried out by spinewine 2005 which has been widely used to validate numerical models for bed erosion caused by dam break flows ran et al 2015 pahar and dhar 2017 the experiment was conducted in a 6 m long flume where the bottom was covered by a layer of saturated movable sediment material as shown in fig 14 a clear water column with a height hf of 0 40 m was initially blocked by a gate located at the middle of the flume the initial thickness of the saturated sediment directly below the clear water was h s1 0 07 m while that of the saturated bed on the downstream side of the gate was h s2 0 12 m thus an upward step made up of movable sediment particles was assumed the bed material was cylindrical pvc pellets which had a median equivalent spherical diameter of 3 9 mm a specific density of 1580 kg m3 a friction angle φ of 38º and no cohesion before lifting the gate the pvc pellets were initially compacted to the random close packing concentration α equal to 0 58 the computational conditions except those in the width direction of the flume are the same as those in the experiment similar to the simulations of the two dimensional underwater granular column collapse the periodic boundary condition is imposed in the width direction and 4 layers of sph interpolating particles are initially placed along the flume width for the three dimensional computations the dynamic boundary condition is applied to the bottom and the sidewalls in x direction and three layers of sph particles are fixed to represent the solid boundaries the initial size of the sph interpolating particles is 0 01 m and a total of 79 272 particles are utilized in the whole computational domain the initial sediment volume fraction carried by the sph particles in the movable bed is set to be the experimental value the gate is instantaneously removed and the effect of the time to remove the gate is neglected a sensitivity study on the dam break flow leading position at t 0 50 s is conducted as shown in table 2 values of the model parameters used in the present simulation are summarized in table 1 the gpu based parallel computation takes about 90 min to simulate 1 s of the physical experiment with a variable time step of about 4 10 6 s 4 1 model validations fig 15 shows the comparisons between the computed and the observed interfaces separating the three characteristic flow regions a clear water layer a moving bed layer with intense sediment transport and the static sediment bed general agreement between the numerical and the experimental results of all the interfaces is reasonable especially for the water surface and the surface of the moving bed in the regions near the gate such as at x 0 0 6 m in fig 15 b and at x 0 1 0 m in fig 15 d at the front of the dam break wave the simulated interfaces are also broadly comparable to the experimental results however at t 0 25 s a comparatively large error appears in the profiles of both the water surface and the moving bed layer which is believed to be caused by the neglect of the effect of gate removal fortunately the gate removal effect diminishes rapidly with the propagation of the dam break wave as shown in figs 15 b f fu and jin 2016 on the movable bed both humps and troughs are well captured which supports the rheology based constitutive law used in the model numerical results for the leading position of the flow and the maximum bed height at typical instants of time are compared with the experimental data in table 3 it is shown that the model accurately predicts the leading position of the dam break flow at all the typical instants except at t 0 25 s with a mean error of 0 8 prediction of the maximum bed height is also reliable with a mean error of 12 9 for a further verification of the present model a flat bed case i e a case in which the thickness of the saturated bed is the same on both upstream and downstream side of the gate or h s1 h s2 0 12 m is simulated in the experiment the initial height of the clear water column is hf 0 35 m the vertical profiles of the longitudinal velocity are measured in the range from x 0 95 m to the wave front with a spacing of 0 1 m similar to the results shown in fig 15 the computed interfaces at all the typical instants are in good agreement with the experimental data except at t 0 25 s a similar presentation of figures is thus omitted for concision in fig 16 comparisons of the horizontal velocity are made while the computed interfaces are also plotted generally the computed velocity profiles agree very well with the measured data except at certain positions close to the wave front in the clear water layer the horizontal velocity is shown to be rather uniform and in the moving bed layer it decreases nearly linearly with depth and becomes zero at the top of the static bed evolution of the movable bed is also well represented by the proposed numerical model 4 2 two phase interactions during bed erosion in this subsection numerical results on fluid pressure sediment concentration velocities of the two phases and interphase drag force at three different stages of dam break erosion namely the initial stage the intermediate stage and the final stage are discussed for a better understanding of the water sediment interactions and the underlying mechanisms in the bed erosion 4 2 1 initial stage fig 17 is the snapshot of particle configuration along with the distribution of sediment concentration carried by the sph particles and the pressure at t 0 15 s even though the computed bed profiles before t 0 25 s are not accurate enough due to the effect of the gate removal which is neglected in the numerical model the numerical results are still indicative of the dynamics of bed erosion at the initial stage fig 18 shows the distributions of the water velocity in the fluid column and in the granular material the sediment velocity over the granular bed and the drag force on the solid phase the dotted line in fig 17 b and the dashed lines in fig 18 represent the top of the moving bed layer obtained according to the particle configuration in fig 17 a immediately after the gate is removed the water in the upper part of the column falls down and the toe of the water column moves with a maximum velocity of 2 5 m s the water pushes the solid particles on the bed surface to move forward and pulls the particles and the fluid in the granular material upward the bed particles are washed out with a maximum particle velocity of 2 1 m s and the velocity of the fluid flow in the granular material is notable as well note that before removing the gate the hydrostatic fluid pressure in the bed on the upstream side of the gate is much larger than that in the bed downstream this discontinuity of pressure at the gate position disappears rapidly once the gate is removed this process is well simulated by the present model as shown in fig 17 b where the computed fluid pressure across the dotted interface is continuous with no apparent fluctuation which demonstrates the capability of the present sph model in predicting fluid pressure accurately the interphase drag and the fluid pressure play an important role in the bed erosion fig 18 b marks the region in which the magnitude of the dynamic pressure force α s p f d α s p f α s ρ s g is larger than 0 6 ρ s g g is the gravitational acceleration the vector in fig 18 c represents the drag force while the contour stands for the ratio of the magnitude of the drag force to that of the dynamic pressure force the contour line of f d α s p f d 1 is drawn to show the area where the interphase drag is stronger than the dynamic pressure force it shows that at the initial stage of the dam break erosion the magnitudes of the drag force and the dynamic pressure force are quite large with a value more than 0 5ρ s g near the gate position the drag force plays a greater role near the bed surface at the toe of the water column while the dynamic pressure force is more important at the leading edge of the dam break wave 4 2 2 intermediate stage fig 19 shows the particle configuration and the computed pressure at t 0 70 s and fig 20 presents the distributions of water velocity sediment velocity and interphase drag force the lines marks and contours are included with the same meanings as in figs 17 and 18 in fig 19 a humps and troughs on the granular bed are formed sediment suspension is observed mainly on the lee side of the humps in fig 19 b a high pressure zone is observed at the leading edge of the flow which is a result of the dam break wave impacting on the granular bed it is noticed that the bumps in the pressure distribution fall behind the humps on the bed implying the push of water on the humps the dam break flow propagates with more water involved at t 0 70 s a massive amount of water pours downstream with a maximum velocity larger than 2 5 m s it is shown in fig 20 a that the velocity in the free water layer above the bed in the downstream region x 0 m is almost invariant in the vertical direction consistent with the results of ran et al 2015 and spinewine and capart 2013 inside the granular bed the water velocity decreases rapidly towards the bottom in addition the streamlines have a similar shape of the interface between the water and the moving bed layer bed materials flow with the water and the magnitude of the sediment velocity on the lee side of the hump seems to be larger than that on the front side it is shown in figs 19 b and 20 b that the impact on the bed by the dam break wave results in a notable region where the dynamic pressure force plays a significant role in fig 20 c the magnitude of the drag force is not as large as that in fig 18 c the regions encircled by the contour line where the drag force is greater than the dynamic pressure force are located mainly in the troughs where an active sediment suspension exists inside the granular bed it seems that the dynamic pressure force plays a more important role than the interphase drag force 4 2 3 final stage figs 21 and 22 show the results of dam break erosion at t 1 50 s i e in the final stage in fig 21 a more sediment is suspended especially in the front part of the flow consistent with the observed turbidity above the bed in the experimental flow the bed particles are washed away and the humps are eroded the computed pressure is continuous and reasonable some high pressure zones occur at the leading edge of the dam break flow as it can be seen in fig 21 b and similarly large dynamic pressure force zone is marked in fig 22 b the water velocity in the front part of the dam break flow is still quite large and it is the same for the sediment velocity near the leading edge of the flow similar to the situation in the intermediate stage the interphase drag force is weak inside the granular material but quite strong near the moving bed surface the regions where the magnitude of the drag force is larger than that of the dynamic pressure force are corresponding to the regions where active sediment suspension exists 5 conclusions an improved two phase sph model based on the continuum formulation of solid liquid mixtures is proposed for massive sediment motion in free surface flows providing a unified description of gravity induced subaqueous granular flows and shear flow driven intense sediment transport a constitutive law based on the rheology of dense granular flows for the intergranular stresses of the solid phase and a drag force formula that combines the power law for dilute suspensions and the ergun equation for dense solid liquid mixtures are adopted for numerical solutions the governing equations are solved in a distinctive two phase sph framework and the numerical model is implemented in cuda and c the parallel computations are conducted on cuda enabled gpus the model is employed to investigate the collapses of both loosely and densely packed columns in water the computed profiles of the granular columns during the entire collapsing process are in very good agreement with the experimental data and the computed distributions of sediment concentration are also consistent with the experimental observations the behaviors of the loosely packed and the densely packed columns are found to be significantly different and based on the computed results of fluid pressure and interphase drag force along with the evolution of water vortices it is shown that a much lower pressure and a stronger interphase drag force in the densely packed column lead to a more stable state of the granular mass in the dense packing case in the case of dam break flows the computed profiles of the free water surface and the movable bed as well as the numerical results for the leading position of the flow and the maximum bed height are compared with the measured results it is shown that the numerical results are in good agreement with the experimental data furthermore to study the water sediment interactions during the bed erosion process the water pressure sediment concentration velocities of the two phases and interphase drag force in the early intermediate and final stages of the dam break erosion are computed the numerical results indicate that at the initial stage of erosion the interphase drag plays a greater role near the bed surface at the toe of the water column while the dynamic pressure force is more important at the leading edge of the dam break flow in the intermediate and the final stages the drag force is greater than the dynamic pressure force in the regions where active sediment suspension exists while inside the granular bed the dynamic pressure force seems to play a more important role in summary it is shown that the proposed two phase sph model successfully describes both the gravity induced underwater granular flows and the intense sediment transport by flowing water and reasonably represents the physics of massive sediment motion in water further applications of the model to certain practical scenarios in which the two kinds of flows exist simultaneously such as landslides triggered by storm in shallow sea and flows resulted in barrier or dam breaks are thus highly possible acknowledgments this work is jointly supported by national key research and development program most china under grant no 2018yfc0407506 projects from epsrc ep r02491x 1 and open research fund program of state key laboratory of hydroscience and engineering sklhse 2019 b 01 the proposed two phase sph model is implemented on the basis of the open source gpusph code developed by alexis hérault giuseppe bilotta and robert a dalrymple and the authors thank all the contributors supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 05 006 appendix supplementary materials image application 1 
628,massive sediment motion in water with a free surface is an important kind of geophysical flows such as hyper concentrated sediment laden river flows discharging into estuarine delta and turbidity currents generated by subaqueous landslides one of the key and common characteristics of such flows is that interactions between water and sediment as well as those among sediment particles are equally important in affecting the sediment motion and the fluid flow this paper presents a numerical model that builds on and extends an earlier two phase sph model based on a continuum formulation of solid liquid mixtures shi et al 2017 to provide a unified description of massive sediment motion in free surface flows in the model a constitutive law based on the rheology of dense granular flow is introduced to express the intergranular stresses while the interphase drag force is determined by combining the ergun equation for dense solid fluid mixtures and the power law for dilute suspensions the proposed model is firstly applied to the study of collapse of loosely or densely packed granular columns submerged in water the computed surface profiles of the granular column are found to be in good agreement with the experimental data it shows that the loosely packed and the densely packed columns behave rather differently due to the differences in water sediment interaction processes the model is then used to simulate a dam break flow over a mobile sediment bed the computed configurations of the flow and the movable bed also agree well with the measured data the predicted position on the leading edge of the flow has a mean error of 0 8 while the mean error for the maximum bed height is 12 9 to further identify the dynamic processes involved effects of water sediment interactions on the motion of bed materials are investigated by examining the spatial and temporal variations of pressure and flow velocity as shown in the applications the proposed two phase sph model can successfully represent both the gravity driven underwater granular flows and the shear flow driven intense sediment transport implying its potential use in practical scenarios in which the two kinds of flows exist simultaneously such as landslides triggered by storm in shallow sea and flows resulted in barrier or dam breaks keywords two phase sph model sediment motion water sediment interactions underwater granular column collapse dam break erosion 1 introduction massive sediment motion in free surface flows often occurs in nature one example is the large scale submarine landslide which has been reported to be the main cause of several destructive tsunamis keating and mcguire 2000 lynett and liu 2002 the rapid erosion of riverbed by dam break flow which may result in significant morphological changes of the channel system and increased flooding risk is another typical case capart and young 1998 wu and wang 2007 consequently accurate prediction of massive sediment motion in free surface flows is essential in disaster prevention and mitigation as well as in infrastructure safety assessment massive sediment motion in free surface flows including the gravity induced underwater granular flow and the shear flow driven intense sediment transport is characterized by the high concentration of the particle phase although the flows may be different in driving forces the stresses generated by interphase and intergranular interactions within the solid liquid mixtures are intrinsically the same and play a similarly important role in the flows dong and zhang 2002 shi and yu 2015 lee and huang 2018 in some situations the large deformation of free water surface may also occur spinewine 2005 therefore a unified numerical model for different types of massive sediment motion is required to accurately describe the interactions not only between water and sediment but also among sediment particles at a wide range of sediment concentration and to be capable of capturing the complex deformation of the free water surface this is however not an easy task as most of the available numerical models for sediment motion adopt mesh based eulerian approach they have difficulties in simulating the complicated deformation and fragmentation of free water surface fu and jin 2016 at a more fundamental level it requires improved understanding and formulations of intergranular stresses and interphase forces bakhtyar et al 2010 chauchat 2018 with a two phase model in which the primary flow variables of both water and sediment are fully resolved dong and zhang 1999 bakhtyar et al 2010 mesh free particle methods such as the smoothed particle hydrodynamics sph and the moving particle semi implicit mps methods have proven to be powerful in tracking the violent motion of free water surface gotoh and khayyer 2018 and have also been introduced to the simulation of sediment laden flows ulrich et al 2013 fourtakas and rogers 2016 nodoushan et al 2018 however most of the existing particle models for sediment motion are not formulated strictly in the two phase framework instead they treat clear water and sediment water mixture as two immiscible fluids and represent the two phases by different sets of sph mps particles the sediment phase considered in these models is a mixture of water and sediment and variables of the mixture rather than those of each individual phase are solved as a result they are unable to address directly the intergranular stresses and the interphase forces furthermore suspended load cannot be rigorously resolved by these two immiscible fluid models and it was just approximated by a kernel averaged volumetric sediment concentration ulrich et al 2013 zubeldia et al 2018 only a few attempts bui et al 2007 wang et al 2016 pahar and dhar 2017 shi et al 2017 have been made to develop a complete two phase particle method for liquid solid mixtures all of which however contain some questionable assumptions for instance the variation of sediment concentration was ignored in pahar and dhar 2017 an idealized constitutive law for intergranular stresses i e the elastic perfect plastic model was assumed in bui et al 2007 shi et al 2017 recently presented a two phase sph model for suspended sediment motion in free surface flows which performed well both in idealized and in practical problems with suspended load however the formulations for intergranular stresses and interphase drag force in the model are not sufficiently accurate under high concentration conditions in this paper the two phase sph model developed by the authors shi et al 2017 which is formulated strictly in a two phase framework is extended to describe massive sediment motion it is aimed to give a unified description of gravity induced underwater granular flows and intense sediment transport by flowing water the structure of the model remains unchanged but a number of substantial improvements have been introduced to better describe the underlying physics of dense sediment motion specifically a constitutive law based on the rheology of dense granular flows is used to represent the intergranular stresses to estimate the interphase drag force in both high and low concentration regimes the gidaspow 1994 formula is adopted which combines the ergun equation for dense solid fluid mixtures and the power law for dilute suspensions the proposed model is applied to the studies of collapse of underwater granular columns and bed erosion by dam break flows in the former case the flow is driven by the falling of sediments into still water while in the latter the falling water causes rapid erosion of the mobile sediment bed and strong near bed sediment suspension the computed surface profiles of both loosely and densely packed granular columns submerged in still water with a free surface are compared with experimental data effects of water sediment interactions on the collapse of loosely densely packed columns are examined the fluid flow within the granular material is simulated and the evolution of water vortex in the process of granular column collapse is discussed for the dam break induced erosion problem the computed configurations of the free water surface and the movable bed are compared with experimental results the effects of water sediment interactions on both the motion of bed materials and the bed erosion process are investigated the rest of the paper is organized as follows the governing equations of the two phase model and their sph formulations are described in section 2 applications of the model to underwater granular column collapse and sediment transport by dam break flow are presented in sections 3 and 4 respectively finally conclusions are drawn in section 5 2 a two phase sph model for intense sediment transport 2 1 governing equations for the two phases the continuum description of a sediment water mixture flow is based on the assumption that water and sediment are coupled two phases within the domain of interest both phases are governed by the conservation laws for mass and momentum the general two fluid form of continuity and momentum equations for two phase flows originally derived by drew 1983 are employed in this study to deal with the turbulence of the two phases the sub particle scaling technique dalrymple and rogers 2006 mayrhofer et al 2015 is applied the governing conservation equations are then spatially filtered by virtue of the favre averaging shi et al 2017 the filtered continuity equations are 1 α f ρ f t α f ρ f u f j x j 0 2 α s ρ s t α s ρ s u s j x j 0 in which t is the time x is the coordinate and i j 1 2 3 represent the coordinate directions for which the summation convention is valid the subscripts f and s represent the water phase and the sediment phase respectively α is the volume fraction and α f α s 1 ρ is the density u is the velocity the filtered momentum equations for the two phases are written as 3 α f ρ f u f i t α f ρ f u f i u f j x j α f p f x i α f τ f i j 0 τ f i j t x j α f ρ f g i f i 4 α s ρ s u s i t α s ρ s u s i u s j x j α s p f x i α s τ s i j 0 τ s i j t x j α s ρ s g i f i where p is the pressure τ f 0 is the viscous stress of the water phase while τ s 0 is the intergranular stress of the sediment phase τ t is the sub particle scale sps stress g is the gravitational acceleration f is the force on the solid phase by water excluding the pressure gradient related buoyancy which is a part of the first terms on the right side of the momentum equations f is formulated in the subsection on two phase interactions the viscous stress τ f 0 and the intergranular stress τ s 0 are determined by 5 τ f i j 0 ρ f ν f 0 2 s f i j 2 3 s f l l δ i j 6 τ s i j 0 ρ s ν s 0 2 s s i j 2 3 s s l l δ i j p s δ i j 7 s k i j 1 2 u k i x j u k j x i in which k f s s k ij are the rate of strain tensors of the two phases ν f 0 and ν s 0 are the kinematic viscosities ps is the intergranular pressure of the sediment phase resulting from enduring contact collision and friction between the solid particles the viscosity ν s 0 and the pressure ps are estimated by a rheology based constitutive law for the sediment phase in the following subsection the sps stresses τ k t are modelled based on boussinesq hypothesis 8 τ k i j t ρ k ν k t 2 s k i j 2 3 s k l l δ i j where ν k t k f s are the eddy viscosities of the two phases the well known smagorinsky model smagorinsky 1963 is utilized to determine ν k t but a modification is made to consider the turbulence damping by sediment particles chen et al 2011 9 ν k t c k δ 2 s k 1 α s α s m n in which δ is the characteristic length of filter which is set to be the initial particle size in a sph model s is the rate of strain tensor and its norm s k 2 s k i j s k i j α sm is the maximum sediment volumetric concentration at which the turbulence is assumed to be totally suppressed n is a coefficient c is smagorinsky constant in this study α sm is set to be equal to the jamming volume fraction defined in the following subsection at which the dense sediment phase is in static as in shi et al 2017 n 5 and cf cs 0 1 in the present study the weakly compressible sph wcsph approach is adopted specifically the water phase is assumed to be weakly compressible and the water density ρ f is thus a variable the equation of state eos proposed by shi et al 2017 is utilized to compute the fluid pressure pf in the sediment water mixture 10 p f ρ f 0 c 0 2 ξ α f ρ f α s ρ f 0 α f ρ f α f ρ f α s ρ f 0 ρ f 0 ξ 1 where ξ 7 ρ f0 1000 kg m 3 is the reference water density at pf 0 c 0 is the sound speed in water at the reference density which is usually set to be ten times the maximum water velocity in the problem of interest 2 2 a rheology based constitutive law for intergranular stresses a constitutive law based on the rheology of dense granular flows lee et al 2016 chauchat 2018 is employed to represent the intergranular stresses of the particles phase in sediment water mixture flows this law depends on the frictional characteristic of granular materials i e the shear stress components are related to the pressure it has been successfully applied to bedload transport chiodi et al 2014 sheet flows lee et al 2016 and underwater granular column collapse lee and huang 2018 in the constitutive law the sediment pressure ps has two components a shear rate dependent component p s r for the rheological characteristics of the bulk granular materials and a shear rate independent component p s e for the enduring elastic contact between the solid particles 11 p s p s r p s e boyer et al 2011 and trulsson et al 2012 carefully investigated the rheological characteristics of the dense granular materials in an interstitial fluid it is found that the rheology of dense granular materials is dominated by both inter particle forces and viscosity of the interstitial fluid according to their results the shear rate dependent component p s r can be evaluated by 12 p s r c 1 α s α s 0 α s 2 ρ f ν f 0 c 2 ρ s d s 2 s s s s where α s0 is the jamming volume fraction which is the maximum packing fraction of the sheared granular particles ds is the diameter of sediment particles c 1 and c 2 are model parameters on the other hand when the packing fraction α s increases to the random loose packing concentration α the component p s e comes into play as the volume fraction increases further to the random close packing concentration α the granular materials present a transition from fluid like to solid like behavior johnson and jackson 1987 following hsu et al 2004 and lee et al 2016 the shear rate independent pressure p s e is estimated by 13 p s e 0 α s α k α s α χ 1 sin π α s α α α π 2 α s α in which k is a coefficient related to the young s modulus and the poisson s ratio of the solid material χ is a model parameter generally the parameters c 1 0 75 1 00 c 2 0 01 1 00 and χ 1 5 5 5 trulsson et al 2012 chiodi et al 2014 lee and huang 2018 chauchat 2018 and in the present computations their values as well as that of k are determined based on sensitivity studies in the applications values of α s0 α and α are set depending on the specific solid materials relating the viscous stress of sediment phase to the intergranular pressure according to the frictional law and introducing the papanastasiou regularization technique papanastasiou 1987 to avoid singularity in the expression for viscosity we obtain 14 ν s 0 μ p s ρ s s s 1 e m s s where μ is the friction coefficient of the assembly of sediment particles varying with the inertia number i m is a parameter for regularization fourtakas and rogers 2016 had examined the effect of m on the sediment stresses and accordingly m is set to be 50 in the present study a value at which the effect of regularization on sediment transport is negligible following boyer et al 2011 and trulsson et al 2012 the friction coefficient μ is estimated by 15 μ μ 1 μ 2 μ 1 1 i 0 i and the inertia number i is determined by 16 i α s 0 α s c 1 α s 2 where μ1 tan ϕ is the friction coefficient when i 0 and the assembly is in static with ϕ being the internal friction angle of the solid particles μ2 is the friction coefficient when i approaches infinite and the sediment moves extremely rapidly i 0 is a model parameter c 1 is the same parameter as in eq 12 in general μ2 tan ϕ 1 0 and i 0 0 1 0 3 lee et al 2016 and in this paper the values are determined according to a sensitivity analysis the present constitutive law can provide information on the pre yield and post yield regimes of the sediment phase and thereby avoids the need of special technique for yield judgment pahar and dhar 2017 zubeldia et al 2018 when the assembly of solid particles is in quasi static or static state the stress related to the shear rate independent pressure p s e plays a similar role to the yield stress in bingham and herschel bulkley models fourtakas and rogers 2016 for unyielded sediment the viscosity calculated by eq 14 is particularly large due to its zero shear rate which then keeps the solid phase static 2 3 two phase interactions in the proposed model the two phase interactions are formulated in terms of the primary flow variables of the two phases the pressure gradient related buoyancy on the solid particles is taken into account by the first term on the right side of eq 4 and other interphase forces are included in the term fi in the momentum equations generally fi consists of drag force virtual mass force lift force etc drew 1983 in a problem with high sediment concentration the drag force is predominant hsu et al 2004 wang et al 2016 lee and huang 2018 and hence for simplicity here only drag force is considered assuming the drag force to be proportional to the relative velocity between the two phases we have 17 f i γ α s u f i u s i in which the coefficient γ can be estimated based on the formula proposed by gidaspow 1994 18 γ 3 4 c d ρ f u f u s d s α f 1 65 α s 0 2 150 α s ρ f ν f 0 α f d s 2 1 75 ρ f u f u s d s α s 0 2 where cd is the drag coefficient for solid particles in an infinite fluid u is the norm of the velocity vector cd is a function of the particle reynolds number re s α f u f u s d s ν f 0 and can be determined by the well known schiller and naumann 1935 formula 19 c d 24 re s 1 0 0 15 re s 0 687 re s 1000 0 44 re s 1000 note that eq 18 is considered to be more robust than the power law for γ used by shi et al 2017 which is based on the study of sediment settling in still water by richardson and zaki 1954 and is not valid for α s 0 4 yin and koch 2007 lee and huang 2018 the gidaspow 1994 formula combines wen and yu 1966 s power law for dilute suspensions and the ergun equation originally obtained by ergun 1952 for pressure drop in the flow through packed columns and valid for dense solid fluid mixtures this formula has been well validated and widely applied to the study of intense sediment motion neri et al 2003 li et al 2018 si et al 2018 it is necessary to point out that in the present model the interphase momentum transfer term γ ν f t α s x i α f s c in the governing equations in shi et al 2017 which is due to the sps turbulence and results from the favre averaging in the spatial filtering is neglected as it was found to play a negligible role in the simulations of both underwater granular column collapse and bed erosion by dam break flows 2 4 governing equations in lagrangian form the solid liquid two phase system is discretized into a single set of sph particles which move with the water velocity and carry properties of both phases hence the substantial derivative of a physical quantity φ associated to a sph particle is expressed as 20 d φ d t φ t u f j φ x j note that the water is assumed to be weakly compressible while the sediment is incompressible thus the water density ρ f is an unknown while the sediment density ρ s is a constant with d ρ s d t 0 rewriting the eulerian form of the conservation equations 1 4 into lagrangian form by virtue of eq 20 the governing equations for water density sediment concentration water velocity and sediment velocity carried by a sph particle are obtained as 21 d α f ρ f d t α f ρ f u f j x j 22 d α s d t α s u f j x j α s u s j u f j x j 23 d u f i d t 1 ρ f 0 p f x i 1 α f ρ f α f ρ f t f i j x j g i γ α s α f ρ f u f i u s i 24 d u s i d t 1 ρ s p f x i 1 α s ρ s α s ρ s t s i j x j g i γ ρ s u f i u s i u s j u f j u s i x j where t k i j τ k i j 0 τ k i j t ρ k k f s the equation for the water density i e eq 21 comes from the continuity equation for the water phase and describes the evolution of α f ρ f due to the volume change of the sph particle for the sediment concentration α s the continuity equation for the sediment phase is rewritten into eq 22 with the first term on the right side representing the contribution of the volume change of the sph particle and the second term representing the effect of the inter particle sediment mass flux note that as the velocities of the two phases are different there may be mass and momentum fluxes of sediment among different sph particles eqs 23 and 24 are derived from the momentum conservation equations of the water and the sediment phases respectively the first four terms on the right side of the equations represent the effects of the fluid pressure the viscous and turbulence stresses the gravity and the interphase drag force the last term on the right side of eq 24 is a convection term for the inter particle sediment momentum flux and is also a result of the relative velocity between the two phases 2 5 sph formulations the detailed sph formulations of the proposed two phase model can be referred to shi et al 2017 here for completeness a short description as well as some improvements in the discretizations of fluid stress term and inter particle flux terms are presented in a sph model the value of a physical quantity φ carried by sph particle a i e φ a is approximated by the summation over all neighboring particles in the supporting domain of the kernel function w 25 φ a b φ b w a b v b in which φ b is the value of φ carried by the neighboring particle b vb is the volume of particle b defined by 26 v b m f α f ρ f b with mf being the water mass carried by the particle which remains constant during the simulations wab w x a x b h where x a and x b are the positions of particle a and b respectively h is the smoothing length of the kernel function w and is set to be 1 3 times the initial particle spacing in the present model the quintic kernel function proposed by wendland 1995 is utilized the volume of sediment phase carried by particle a vs a is given by 27 v s a v a α s a m f α f ρ f a α s a where va is the volume of particle a as time runs the water mass mf of particle a keeps constant while the sediment mass ms a ρ s vs a is variable according to eqs 21 and 22 the volume of sediment carried by a sph particle varies as a consequence of the inter particle fluxes of sediment mass the divergence of the water velocity at particle a is discretized as 28 u f j x j a b u f j b u f j a a w a b j v b in which 29 a w a b w r x a x b x a x b and a wab j is its component in j direction the symmetric scheme utilized in violeau and rogers 2016 which conserves momentum is adopted to formulate the fluid pressure terms i e the first terms on the right side of eqs 23 and 24 attention should be paid to the formulation of the shear stress terms as α s in the denominator may vanish when dealing with possible concentration discontinuity shi et al 2017 in eq 30 the shear stress term is separated into a gradient term of stress and a gradient term of concentration replace αkρk xj αkρk by ln αkρk xj which is a preferable form to increase the robustness of the model for problems with discontinuity of sediment concentration then the symmetric scheme proposed by ren et al 2014 is applied hence 30 1 α k ρ k α k ρ k t k i j x j a t k i j x j t k i j α k ρ k α k ρ k x j a t k i j x j t k i j ln α k ρ k x j a b t k i j a t k i j b 1 1 2 ln α k ρ k b α k ρ k a a w a b j v b an upwind scheme is proposed for the formulations of the inter particle sediment mass flux term i e the second term on the right side of eq 22 and sediment momentum flux term i e the fifth term on the right side of eq 24 31 α s u s j u f j x j a b α s a max u s j u f j a a w a b j 0 α s a max u s j u f j b a w a b j 0 α s b min u s j u f j a a w a b j 0 α s b min u s j u f j b a w a b j 0 v b 32 u s j u f j u s i x j a b u s i a u s i b min u s j u f j a a w a b j 0 min u s j u f j b a w a b j 0 v b finally the discretized sph equations for sediment water mixture flows become 33 d x i a d t u f i a 34 d α f ρ f a d t α f ρ f a b u f j b u f j a a w a b j v b 35 d α s a d t α s a b u f j b u f j a a w a b j v b b α s a max u s j u f j a a w a b j 0 α s a max u s j u f j b a w a b j 0 α s b min u s j u f j a a w a b j 0 α s b min u s j u f j b a w a b j 0 v b 36 d u f i a d t 1 ρ f 0 b p f a p f b a w a b i v b b t f i j a t f i j b 1 1 2 ln α f ρ f b α f ρ f a a w a b j v b g i γ a α s a α f ρ f a u f i u s i a 37 d u s i a d t 1 ρ s b p f a p f b a w a b i v b b t s i j a t s i j b 1 1 2 ln α s b α s a a w a b j v b g i γ a ρ s u f i u s i a b u s i a u s i b min u s j u f j a a w a b j 0 min u s j u f j b a w a b j 0 v b with the following eos for the water pressure 38 p f a ρ f 0 c 0 2 ξ α f ρ f a α s a ρ f 0 α f ρ f a α f ρ f a α s a ρ f 0 ρ f 0 ξ 1 note that eq 33 determines the position of the sph particle 2 6 time integration and shepard filtering the predictor corrector scheme of monaghan 1989 is adopted to integrate eqs 33 37 with respect to time the time step is variable and restricted by the numerical sound speed the maximum inertia forces and the viscous forces of the two phases through the cfl conditions ulrich et al 2013 shi et al 2017 the strategy of shepard filtering proposed by shi et al 2017 is utilized to damp the pressure oscillation in the sediment water mixture the filtering is performed every 20 time steps by reinitializing the water density of each particle according to 39 ρ f a b ρ f b w a b v b b w a b v b b m f b 1 α s b w a b b m f b α f ρ f b w a b both the water mass and the sediment mass carried by a sph particle are conserved in the shepard filtering resulting in 40 α f ρ f a α f ρ f a α f ρ f a α s a ρ f a ρ f a 41 α s a α s a α f ρ f a α s a ρ f a ρ f a 2 7 boundary conditions in sph models free water surface can be naturally tracked by particles but special attention should be paid to the solid wall boundaries in the present model the dynamic boundary condition proposed by crespo et al 2007 is employed to avoid the kernel truncation near the solid boundaries the solid boundary is represented by allocating three layers of sph particles along it which satisfy the same equations as those for the fluid particles but do not move in response to the computed forces exerted on them they keep fixed in position for immobile boundaries or move according to externally imposed trajectory for prescribed moving boundaries 2 8 numerical implementations the proposed model is implemented on the basis of the open source sph package gpusph which was originally developed by hérault et al 2010 gpusph is programmed with cuda and c and conducts parallel computations on nvidia cuda enabled graphics processing units gpus the numerical computations in the present study are carried out on an nvidia tesla k40c gpu with 2880 processor cores 3 collapse of underwater granular columns collapse of a submerged granular column under gravity is a classical problem of massive sediment motion in free surface flows which occurs in a variety of natural and hazardous processes such as underwater landslide and submarine avalanches rondon et al 2011 it has also been widely used as a benchmark problem for validation of numerical models for dense granular motion in fluid meruane et al 2010 savage et al 2014 wang et al 2017a si et al 2018 however the relevant collapsing process is still not well understood during collapse the sediment phase may be fluid like solid like or in a transition state according to its shear rate which makes modelling the behavior of the granular column very difficult the solid fluid interactions make the situation even more complicated the variation of the fluid pressure in the porous material can either stabilize or destabilize the assembly of particles iverson et al 2000 and the drag force between the solid particle and the fluid may resist or accelerate the collapsing process of the granular column depending on the relative velocity between the two phases si et al 2018 the initial volume fraction of the solid phase plays a very important role in the phenomenon rondon et al 2011 wang et al 2017b in this section the proposed two phase sph model is carefully validated and employed to investigate the effects of water sediment interactions on the collapse of loosely densely packed granular columns submerged in still water effects of the free surface motion are discussed as well rondon et al 2011 had conducted a well known experimental study on the role of initial porosity in the case of a granular column collapse in a viscous fluid due to the large fluid viscosity and the low ratio of the column height to the fluid depth in rondon et al 2011 the motion of the free surface resulting from the granular column collapse was negligible following rondon et al 2011 wang et al 2017b performed a similar experiment with a larger granular column size and using water as the ambient fluid in this experiment the fluctuation of free water surface was visible though not significant in the present study the proposed two phase sph model is applied to the experiment of wang et al 2017b the experiment of wang et al 2017b was conducted in a rectangular tank of 50cm long 10cm wide 15cm high as shown in fig 1 a granular column was initially confined at the left end of the tank by a removable gate the horizontal and the vertical directions are defined as x i e x 1 in the governing equations and z i e x 3 in the equations directions respectively l is the distance from the left end of the tank to the front of the granular avalanche and h is the height of the column at x 0 the particles used were glass beads of density ρ s 2500 k g m 3 and mean diameter ds 300 μm with an internal friction angle of φ 25 0 4 the granular column was prepared in both loose packing and dense packing state in the loose packing case the glass beads were gently poured into the space delimited by the wall and the gate resulting in an initial shape of l h 6 cm 8 cm granular column the initial sediment volume fraction of the loosely packed column was α s 0 53 0 005 in the dense packing case the tank was gently tapped and an initial solid volume fraction of α s 0 57 0 003 was obtained the initial length of the column l was 6 cm and the initial height of the column h was reduced to 7 8 cm the granular column was submerged in 10 cm deep water with fluid density ρ f 1000 k g m 3 and viscosity ν f 0 10 6 m 2 s the time period taken to remove the gate was shorter than 0 1 s and its influence on the column collapse could be ignored wang et al 2017b once the gate was removed the column collapsed and the final deposition of the granular mass was reached in just a few seconds the physical problem as described above can be treated as a two dimensional problem to simulate such a problem with a three dimensional numerical model the computational conditions are kept the same as those in the experiments except in the width direction of the tank y direction for which a periodic condition is imposed and a minimum 4 layers of sph interpolating particles are arranged the initial size of sph interpolating particles is set to be 0 002 m according to a convergence study and in the present simulations the solid fluid mixture is discretized into a set of 250 50 4 50000 sph particles besides the dynamic boundary condition is applied to the bottom and the sidewalls in x direction with three layers of fixed sph particles representing the solid boundaries hence in each computation a total of 50 000 interpolating particles for the two phase mixture and 4464 particles for the solid boundaries are used fig 2 shows the particle configuration at t 0 s after removal of the gate in the loose packing case in which the red particles are those carrying the initial sediment volume fraction 0 53 and represent the saturated granular column values of the model parameters and some physical quantities of the solid material used in the present simulations are summarized in table 1 the sensitivities of the granular avalanche front position l at t 0 5 s in the loose packing case and the column height h at t 4 0 s in the dense packing case to model parameters are shown in table 2 it is seen that the numerical results are not significantly affected by a variation of the parameters as long as the variation is limited in the specified range the parallel computations are carried out on an cuda enabled nvidia tesla k40c gpu and it requires about 25 min of computational time to simulate 1 s of the physical experiment 3 1 model validations figs 3 and 4 show the comparisons of the computed profiles of the granular column by the present model with the experimental data for the loose packing and dense packing cases respectively results of the earlier two phase sph model developed by shi et al 2017 are also presented the predictions by the present proposed model are generally in good agreement with the experimental data in both cases and are much more accurate than those by the model of shi et al 2017 small discrepancies are observed at t 0 5 s in the loose packing case and at t 1 0 s in the dense packing case but they are still acceptable for the loosely packed column upon the removal of the gate the whole upper part falls immediately leading to a thin surge of solid materials at the front of the granular mass the flow front moves quickly and stops at x 22 0 cm with a long runout distance l simultaneously the grains in the main body of the column flow down the surface and a triangular final deposition profile is reached in 2 5 s for the dense packing case a very different collapsing process is observed once the gate is removed particles at the upper right corner and on the lateral surface fall freely resulting in a steep profile with a round corner before t 1 0 s the left upper part of the column keeps unmoved at the initial stage and assumes a plateau like shape as time goes on the erosion propagates inward and the plateau is eroded gradually the flow front stops at x 18 0 cm in 1 5 s with a shorter runout distance than that in the loose packing case a bump is formed behind the flow front and the concave region between the column body and the bump is filled gradually by the particles falling down from the top of the column this so called hydraulic like granular jump behavior shown in the experiment wang et al 2017b is captured by the proposed model the final deposition profile of the initially densely packed column is obtained after 4 0 s implying a longer collapse duration than that in the loose packing case figs 5 and 6 show the sequential configurations of the free water surface for the loose packing and the dense packing cases respectively compared with the observed surface motion in the original video records available from the web version of wang et al 2017b the simulated fluctuations of the free water surface are consistent with the experimental results also as expected the water surface fluctuation in the dense packing case is smaller than that in the loose packing case due to a slower collapsing process specifically at the initial stage the collapsing column pulls down the water surface the free surface is thus disturbed and the wave propagates back and forth in the tank until it dissipates due to the fluid viscosity the evolutions of the solid volume fraction carried by the sph particles in the two cases are shown in figs 5 and 6 for the loose packing case as shown in the dark colored zone at the lower left corner of the granular pile the maximum solid volume fraction of the column increases from the initial value of 0 53 to about 0 55 in the early collapse stage and keeps increasing gradually as time goes on indicating a contraction behavior of the loosely packed column on the contrary for the dense packing case the value decreases from 0 57 to 0 56 in the initial stage presenting a dilation behavior of densely packed materials the result of the contraction dilation of the granular column is consistent with that found in rondon et al 2011 wang et al 2017b and lee and huang 2018 further validating the present two phase sph model in addition the suspension of solid particles around the flow front is well captured by the present model as shown in figs 5 b and 6 b the particles are suspended by the water vortices when rapid collapse occurs in the early stage of the process and soon settle down as the granular flow propagates this phenomenon is clearly shown in the original video records as shown in fig 7 3 2 water sediment interactions fig 8 shows the distributions of the fluid pressure of the sph particles in both the early and the final collapse stages for the loose packing case and fig 9 for the dense packing case note that the initial hydrostatic water pressure at the bottom of the tank is ρ f gh 981 pa for the loose packing case the fluid pressure in the lower part of the column increases due to the contraction of the granular material in the early stage of the collapse with a maximum value of 1200 pa reached the high pressure disperses with the spreading of the granular mass however for the dense packing case in fig 9 a large low pressure zone is observed in the column at the initial collapse stage and it lasts for quite some time it should be pointed out that fully restoration of the water pressure to the hydrostatic condition is not pursued in the present simulations due to a considerable increase of the computational efforts it is shown that the numerical results of the fluid pressure are consistent with those of wang et al 2017b and si et al 2018 the gradient of the fluid pressure field produces a force on the solid phase high pressure within the column in the loose packing case then leads to an outward force on the solid phase that accelerates the collapse while low pressure in the densely packed column leads to an inward force that helps to stabilize the granular column note that in fig 8 a due to lowering of the free water surface the fluid pressure within the upper column becomes smaller than the hydrostatic value at the same height this result is physically more realistic than that of si et al 2018 and lee and huang 2018 in which the rigid lid hypothesis is imposed on the water surface and thus the motion of the free surface is neglected effects of the interphase drag force on the granular column collapse are presented in figs 10 and 11 the distributions of the computed drag force at representative times in the two cases are shown in fig 10 f d γα s u f u s and its norm f d is normalized by ρ s g in both cases at the initial collapse stage the water is pulled down from a static state by the grains that are about to crush this in turn exerts a strong drag force on the solid particles which points inward to the core of the column and hinders the collapse the magnitude of the drag force near the column surface where the particles move rapidly is generally larger than that in the inner zone at the initial stage of collapse the magnitude of the drag force in the densely packed column with a maximum value of about 0 30 ρ s g is much larger than that in the loosely packed one with a maximum value of 0 14 ρ s g resulting in a more stable state of the granular mass in the dense packing case besides in the later stage when the magnitude of the drag force decreases with the deceleration of the collapse the drag force in the main part of the densely packed column at t 2 4 s is still stronger than that in the loosely packed material at t 1 0 s notably different from the situation in the main body of the column where the interphase drag helps to stabilize the granular column in the flow front the drag force on the solid particles may show a positive effect and drive the granular flow as shown in the zoomed in view in fig 10 b due to the stronger effect of the drag force in the flow front the granular flow in the loose packing case has a longer runout distance than that in the dense packing case to further identify the effects of the interphase drag force more simulations of the collapse are carried out using the present model but excluding the drag force γ 0 is set while the values of all the other parameters and coefficients are kept the same as in the above computations fig 11 shows comparisons of the computed sequential profiles of the granular column with and without the formulation of the drag force in both the loose packing and the dense packing cases when ignoring the drag force the columns move faster at the initial collapse stage with a wider spread of the particles and a smaller column height h at the left end of the tank however in the later stage for the loosely packed column the drag force on the solid particles drives the front part of the granular flow as shown in the comparisons at t 1 0 s and t 2 5 s in fig 11 a the situation is different for the dense packing case where the positive effect of the drag force is insignificant in almost the entire period of the collapse the column simulated without the drag effects has a larger runout distance than that including the interphase drag neglect of the drag force results in a longer duration of collapse in both cases the computed profiles of the deposit without the drag force for both loose and dense packing cases are quite similar as shown in figs 11 a and b which demonstrates that the importance of the initial solid volume fraction on column collapsing process can be revealed only when the water sediment drag is properly taken into account 3 3 evolution of vortices generated by granular column collapse the simulated evolutions of vortices generated by the granular column collapse are shown in figs 12 and 13 well representation of the dynamic process of these vortices is an advantage of the present numerical model it is shown that at the initial stage of the collapse a large vortex is induced by the movement of the solid grains for the loose packing case the vortex core is around the upper right corner of the column and the water velocity in the whole upper column is notable as shown in fig 12 a on the other hand for the dense packing case in fig 13 a the vortex core is around the right side surface of the column implying that the column collapse starts from the right side of the surface and propagates inward the moving layer of the water flow within the granular mass in the loose packing case is much thicker than that in the dense packing case during the later stage of the collapse process in both cases the vortex propagates and grows with the acceleration of the collapse as shown in figs 12 b and 13 b once the front of the granular flow stops the vortex moves upward and finally disappears due to the fluid viscosity the vortex can induce suspension of solid particles the areas encircled in figs 5 b and 6 b for the particle suspension are in the core of the vortices as shown in figs 12 b and 13 b the vortex may also be affected by the fluctuation of free water surface in fig 12 a the vortex is restricted by the free surface and the sinking of the surface increases the velocity of the water flowing into the upper part of the porous material resulting in a downward drag force on the solid particles in the upper column as shown in fig 10 a 4 sediment transport by dam break flows dam break over a movable bed may cause a significant amount of sediment to be eroded and transported leading to substantial changes of the downstream river morphology and possible damages to infrastructures it has long been the subject of many experimental and numerical studies in hydraulic and river engineering capart and young 1998 ran et al 2015 it is also a test case for meshless numerical models of sediment transport shakibaeinia and jin 2011 ulrich et al 2013 pahar and dhar 2017 zubeldia et al 2018 however due to the violent free surface motion and the complex bed erosion process development of a comprehensive numerical model for detailed description of the dam break erosion is still very challenging shakibaeinia and jin 2011 in this section the proposed two phase sph model is applied to the massive sediment transport caused by dam break flows to assess its predicative capability the case considered is the two dimensional experiment of dam break over a mobile bed carried out by spinewine 2005 which has been widely used to validate numerical models for bed erosion caused by dam break flows ran et al 2015 pahar and dhar 2017 the experiment was conducted in a 6 m long flume where the bottom was covered by a layer of saturated movable sediment material as shown in fig 14 a clear water column with a height hf of 0 40 m was initially blocked by a gate located at the middle of the flume the initial thickness of the saturated sediment directly below the clear water was h s1 0 07 m while that of the saturated bed on the downstream side of the gate was h s2 0 12 m thus an upward step made up of movable sediment particles was assumed the bed material was cylindrical pvc pellets which had a median equivalent spherical diameter of 3 9 mm a specific density of 1580 kg m3 a friction angle φ of 38º and no cohesion before lifting the gate the pvc pellets were initially compacted to the random close packing concentration α equal to 0 58 the computational conditions except those in the width direction of the flume are the same as those in the experiment similar to the simulations of the two dimensional underwater granular column collapse the periodic boundary condition is imposed in the width direction and 4 layers of sph interpolating particles are initially placed along the flume width for the three dimensional computations the dynamic boundary condition is applied to the bottom and the sidewalls in x direction and three layers of sph particles are fixed to represent the solid boundaries the initial size of the sph interpolating particles is 0 01 m and a total of 79 272 particles are utilized in the whole computational domain the initial sediment volume fraction carried by the sph particles in the movable bed is set to be the experimental value the gate is instantaneously removed and the effect of the time to remove the gate is neglected a sensitivity study on the dam break flow leading position at t 0 50 s is conducted as shown in table 2 values of the model parameters used in the present simulation are summarized in table 1 the gpu based parallel computation takes about 90 min to simulate 1 s of the physical experiment with a variable time step of about 4 10 6 s 4 1 model validations fig 15 shows the comparisons between the computed and the observed interfaces separating the three characteristic flow regions a clear water layer a moving bed layer with intense sediment transport and the static sediment bed general agreement between the numerical and the experimental results of all the interfaces is reasonable especially for the water surface and the surface of the moving bed in the regions near the gate such as at x 0 0 6 m in fig 15 b and at x 0 1 0 m in fig 15 d at the front of the dam break wave the simulated interfaces are also broadly comparable to the experimental results however at t 0 25 s a comparatively large error appears in the profiles of both the water surface and the moving bed layer which is believed to be caused by the neglect of the effect of gate removal fortunately the gate removal effect diminishes rapidly with the propagation of the dam break wave as shown in figs 15 b f fu and jin 2016 on the movable bed both humps and troughs are well captured which supports the rheology based constitutive law used in the model numerical results for the leading position of the flow and the maximum bed height at typical instants of time are compared with the experimental data in table 3 it is shown that the model accurately predicts the leading position of the dam break flow at all the typical instants except at t 0 25 s with a mean error of 0 8 prediction of the maximum bed height is also reliable with a mean error of 12 9 for a further verification of the present model a flat bed case i e a case in which the thickness of the saturated bed is the same on both upstream and downstream side of the gate or h s1 h s2 0 12 m is simulated in the experiment the initial height of the clear water column is hf 0 35 m the vertical profiles of the longitudinal velocity are measured in the range from x 0 95 m to the wave front with a spacing of 0 1 m similar to the results shown in fig 15 the computed interfaces at all the typical instants are in good agreement with the experimental data except at t 0 25 s a similar presentation of figures is thus omitted for concision in fig 16 comparisons of the horizontal velocity are made while the computed interfaces are also plotted generally the computed velocity profiles agree very well with the measured data except at certain positions close to the wave front in the clear water layer the horizontal velocity is shown to be rather uniform and in the moving bed layer it decreases nearly linearly with depth and becomes zero at the top of the static bed evolution of the movable bed is also well represented by the proposed numerical model 4 2 two phase interactions during bed erosion in this subsection numerical results on fluid pressure sediment concentration velocities of the two phases and interphase drag force at three different stages of dam break erosion namely the initial stage the intermediate stage and the final stage are discussed for a better understanding of the water sediment interactions and the underlying mechanisms in the bed erosion 4 2 1 initial stage fig 17 is the snapshot of particle configuration along with the distribution of sediment concentration carried by the sph particles and the pressure at t 0 15 s even though the computed bed profiles before t 0 25 s are not accurate enough due to the effect of the gate removal which is neglected in the numerical model the numerical results are still indicative of the dynamics of bed erosion at the initial stage fig 18 shows the distributions of the water velocity in the fluid column and in the granular material the sediment velocity over the granular bed and the drag force on the solid phase the dotted line in fig 17 b and the dashed lines in fig 18 represent the top of the moving bed layer obtained according to the particle configuration in fig 17 a immediately after the gate is removed the water in the upper part of the column falls down and the toe of the water column moves with a maximum velocity of 2 5 m s the water pushes the solid particles on the bed surface to move forward and pulls the particles and the fluid in the granular material upward the bed particles are washed out with a maximum particle velocity of 2 1 m s and the velocity of the fluid flow in the granular material is notable as well note that before removing the gate the hydrostatic fluid pressure in the bed on the upstream side of the gate is much larger than that in the bed downstream this discontinuity of pressure at the gate position disappears rapidly once the gate is removed this process is well simulated by the present model as shown in fig 17 b where the computed fluid pressure across the dotted interface is continuous with no apparent fluctuation which demonstrates the capability of the present sph model in predicting fluid pressure accurately the interphase drag and the fluid pressure play an important role in the bed erosion fig 18 b marks the region in which the magnitude of the dynamic pressure force α s p f d α s p f α s ρ s g is larger than 0 6 ρ s g g is the gravitational acceleration the vector in fig 18 c represents the drag force while the contour stands for the ratio of the magnitude of the drag force to that of the dynamic pressure force the contour line of f d α s p f d 1 is drawn to show the area where the interphase drag is stronger than the dynamic pressure force it shows that at the initial stage of the dam break erosion the magnitudes of the drag force and the dynamic pressure force are quite large with a value more than 0 5ρ s g near the gate position the drag force plays a greater role near the bed surface at the toe of the water column while the dynamic pressure force is more important at the leading edge of the dam break wave 4 2 2 intermediate stage fig 19 shows the particle configuration and the computed pressure at t 0 70 s and fig 20 presents the distributions of water velocity sediment velocity and interphase drag force the lines marks and contours are included with the same meanings as in figs 17 and 18 in fig 19 a humps and troughs on the granular bed are formed sediment suspension is observed mainly on the lee side of the humps in fig 19 b a high pressure zone is observed at the leading edge of the flow which is a result of the dam break wave impacting on the granular bed it is noticed that the bumps in the pressure distribution fall behind the humps on the bed implying the push of water on the humps the dam break flow propagates with more water involved at t 0 70 s a massive amount of water pours downstream with a maximum velocity larger than 2 5 m s it is shown in fig 20 a that the velocity in the free water layer above the bed in the downstream region x 0 m is almost invariant in the vertical direction consistent with the results of ran et al 2015 and spinewine and capart 2013 inside the granular bed the water velocity decreases rapidly towards the bottom in addition the streamlines have a similar shape of the interface between the water and the moving bed layer bed materials flow with the water and the magnitude of the sediment velocity on the lee side of the hump seems to be larger than that on the front side it is shown in figs 19 b and 20 b that the impact on the bed by the dam break wave results in a notable region where the dynamic pressure force plays a significant role in fig 20 c the magnitude of the drag force is not as large as that in fig 18 c the regions encircled by the contour line where the drag force is greater than the dynamic pressure force are located mainly in the troughs where an active sediment suspension exists inside the granular bed it seems that the dynamic pressure force plays a more important role than the interphase drag force 4 2 3 final stage figs 21 and 22 show the results of dam break erosion at t 1 50 s i e in the final stage in fig 21 a more sediment is suspended especially in the front part of the flow consistent with the observed turbidity above the bed in the experimental flow the bed particles are washed away and the humps are eroded the computed pressure is continuous and reasonable some high pressure zones occur at the leading edge of the dam break flow as it can be seen in fig 21 b and similarly large dynamic pressure force zone is marked in fig 22 b the water velocity in the front part of the dam break flow is still quite large and it is the same for the sediment velocity near the leading edge of the flow similar to the situation in the intermediate stage the interphase drag force is weak inside the granular material but quite strong near the moving bed surface the regions where the magnitude of the drag force is larger than that of the dynamic pressure force are corresponding to the regions where active sediment suspension exists 5 conclusions an improved two phase sph model based on the continuum formulation of solid liquid mixtures is proposed for massive sediment motion in free surface flows providing a unified description of gravity induced subaqueous granular flows and shear flow driven intense sediment transport a constitutive law based on the rheology of dense granular flows for the intergranular stresses of the solid phase and a drag force formula that combines the power law for dilute suspensions and the ergun equation for dense solid liquid mixtures are adopted for numerical solutions the governing equations are solved in a distinctive two phase sph framework and the numerical model is implemented in cuda and c the parallel computations are conducted on cuda enabled gpus the model is employed to investigate the collapses of both loosely and densely packed columns in water the computed profiles of the granular columns during the entire collapsing process are in very good agreement with the experimental data and the computed distributions of sediment concentration are also consistent with the experimental observations the behaviors of the loosely packed and the densely packed columns are found to be significantly different and based on the computed results of fluid pressure and interphase drag force along with the evolution of water vortices it is shown that a much lower pressure and a stronger interphase drag force in the densely packed column lead to a more stable state of the granular mass in the dense packing case in the case of dam break flows the computed profiles of the free water surface and the movable bed as well as the numerical results for the leading position of the flow and the maximum bed height are compared with the measured results it is shown that the numerical results are in good agreement with the experimental data furthermore to study the water sediment interactions during the bed erosion process the water pressure sediment concentration velocities of the two phases and interphase drag force in the early intermediate and final stages of the dam break erosion are computed the numerical results indicate that at the initial stage of erosion the interphase drag plays a greater role near the bed surface at the toe of the water column while the dynamic pressure force is more important at the leading edge of the dam break flow in the intermediate and the final stages the drag force is greater than the dynamic pressure force in the regions where active sediment suspension exists while inside the granular bed the dynamic pressure force seems to play a more important role in summary it is shown that the proposed two phase sph model successfully describes both the gravity induced underwater granular flows and the intense sediment transport by flowing water and reasonably represents the physics of massive sediment motion in water further applications of the model to certain practical scenarios in which the two kinds of flows exist simultaneously such as landslides triggered by storm in shallow sea and flows resulted in barrier or dam breaks are thus highly possible acknowledgments this work is jointly supported by national key research and development program most china under grant no 2018yfc0407506 projects from epsrc ep r02491x 1 and open research fund program of state key laboratory of hydroscience and engineering sklhse 2019 b 01 the proposed two phase sph model is implemented on the basis of the open source gpusph code developed by alexis hérault giuseppe bilotta and robert a dalrymple and the authors thank all the contributors supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 05 006 appendix supplementary materials image application 1 
629,the water permeability of natural fractures is highly related to their morphological characteristics for fractures with irregular profiles and variable apertures it is challenging to define an appropriate aperture to apply the traditional cubic law for evaluating permeability in this study we propose a novel approach that integrates the standard deviation and the hurst exponent of a self affine fracture profile to characterise the effects of fracture morphology on permeability using cuckoo search algorithms a modified local cubic law was derived to evaluate permeability considering the roughness and hurst exponent of fractures the required number of segments for a fracture was obtained by comparing simulation results using lattice boltzmann methods the proposed permeability model and segment strategy were validated by experiments on rough fractures the results show that the number of segments required for the model can be directly derived from the dimensionless aperture i e mechanical aperture length of fracture media keywords rough fracture permeability evaluation self affine fractal profile local cubic law lattice boltzmann method segmentation algorithm 1 introduction fractures are widespread in rock masses and the fluid flow through them affects their mechanical properties by inducing deformation fracturing softening argillisation and corrosion renshaw 1995 tenthorey et al 2003 wang et al 2015a 2015b statistical data have shown that water seepage through rock masses and the resulting changes in permeability give rise to serious engineering problems such as water burst disasters lu and wang 2015 wu and wang 2006 and coal gas outbursts an and cheng 2014 xue et al 2015 additionally fractures greatly influence the transport of groundwater as well as water security berkowitz 2002 hariri ardebili et al 2013 for dams and reservoirs larger undetected fractures can cause severe engineering problems hariri ardebili et al 2013 zhang et al 2013 a better understanding of fracture geometry and the occurrence of fractures will allow for more effective water resource exploration and more accurate determinations of water protection regions as fractures increase the transport distance of contaminants jackson et al 2013 vengosh et al 2014 research on fluid flow through rock masses has mainly been concentrated on the characterisation of fracture surface geometry and the prediction of rock permeability babadagli et al 2015 brown 1987a ju et al 2013 lee et al 2015 2017 poon et al 1992 thompson and brown 1991 wang et al 2015a 2015b wu and ali 1978 yu and vayssade 1991 the scale of fractures ranges from a few microns to several kilometres azizmohammadi and matthäi 2017 berkowitz 2002 therefore the methods of evaluating permeability differ among the scales of fractures measuring large scale field permeability is difficult and is commonly performed using tracer migration experiments without a clear flow strategy for the fluid in fractures hadermann and heer 1996 to explore fluid flow mechanisms numerous small scale studies on fractures and permeability evaluations have been conducted these can mainly be classified into laboratory experiments e g babadagli et al 2015 develi and babadagli 2015 ju et al 2013 watanabe et al 2008 numerical simulations e g crandall et al 2010a 2010b unger and mase 1993 zhang et al 1996 and analytical derivations e g jin et al 2017 chakraborty 2008 small scale studies have primarily focused on the prediction of permeability and the impacts of physical and hydraulic parameters on permeability such as aperture temperature and fracture tomography bisdom et al 2016 kozusnikova and konecny 2011 talon et al 2010a 2010b wang et al 2016a 2016b wu et al 2017 malevich et al 2006 studied the fluid flow through three dimensional 3d fractures with variable apertures they proposed an analytical velocity in variable aperture fractures mourzenko et al 2018 provided a brief review of fluid flow through a single fracture and analysed more parameters with greater accuracy on larger samples moreover they also discussed some of the differences between large and small apertures in early studies the power law relationship cubic law between fracture apertures and water permeability was determined through experiments and analytical derivation under the assumption that fractures consist of a pair of parallel smooth plates however actual fractures are irregular with rough fracture surfaces and fracture surfaces have been shown to exhibit self affine fractal properties belem et al 2000 berkowitz 2002 brown 1987b mandelbrot 1982 poon et al 1992 wu and ali 1978 the roughness of fracture surfaces leads to phenomena such as increased flow resistance flow path tortuosity backflow eddy flow and even local turbulence develi and babadagli 2015 dou et al 2018 lee et al 2015 2017 thereby decreasing the effective aperture and flow through fractures mourzenko et al 1995 1996 1999 added the roughness exponent h into the variance of self affine surface elevations and discussed the effects of variance on the percolation and conductivity of fractures the tortuosity of fluid flow is the result of the restriction of rough profiles and the development of fluid flow develi and babadagli 2015 dou et al 2018 lee et al 2015 2017 tortuosity increases the flow path and decreases the actual pressure drop brush and thomson 2003 chen et al 2000 ghanbarian et al 2013 jin et al 2015 murata and saito 2003 chen et al 2000 noted that roughness and contact areas also cause inertial losses and initiate turbulence in eddy flows within corners berkowitz 2002 found that the adequacy of the cubic law for rough fractures is noteworthy because of the limited details that can be obtained from fractures and the flow patterns through them babadagli et al 2015 also indicated that the quantification of surface roughness is necessary because roughness causes channelling through fractures although many attempts e g auradou et al 2006 chen et al 2000 tenthorey et al 2003 have been made to study aspects of flow through single fractures research on the effects of roughness on hydraulic behaviour remains limited lee et al 2003 the permeability predicted by the cubic law deviates by a large margin from actual permeability bisdom et al 2016 talon et al 2010a 2010b zhu et al 2013 tsang 1984 indicated that the actual flow rate for a fracture can be three or more orders of magnitude lower than the value predicted using the parallel plate assumption to predict the permeability of rough fractures and evaluate the deviation between the actual value and the analytical value from the cubic law tremendous efforts e g babadagli et al 2015 develi and babadagli 2015 linga et al 2017 wang et al 2016a 2016b have been invested into characterizing the roughness of fractures and correcting the cubic law lomize 1951 proposed a roughness factor to describe the influence of roughness on permeability subsequently several studies babadagli et al 2015 develi and babadagli 2015 lomize 1951 witherspoon et al 1980 have been focused on describing the effects of fracture roughness although the effects of roughness are widely known to date the effects of roughness on permeability are still not well understood even if two fractures have the same roughness differences in the distribution of fracture height will lead to different flow behaviours and permeability jin et al 2017 since the effect of surface roughness on the fluid flow through fractures remains unclear two dimensional 2d fracture studies are still important previous studies have shown that many 3d fractures can be simplified into 2d problems or be studied from a 2d perspective crandall et al 2010a 2010b kong and chen 2018 koyama et al 2008 zhao et al 2018 moreover many studies have been focused on the influence of surface morphology on fluid flow in microchannels especially in the past two years e g dou et al 2018 felisa et al 2018 hajjar et al 2018 wang et al 2018 zeng et al 2018 zhang et al 2019 felisa et al 2018 studied the effects of variable apertures on fluid flow through rough fractures wang et al 2018 studied the permeability of single rough fractures and proposed a modified cubic law by considering flow tortuosity and aperture variability additionally zhang et al 2019 discussed the influences of the morphology of surface structures using the lattice boltzmann method lbm all of these studies have shown that fracture roughness has multiple and complex effects on fluid flow fracture roughness causes variations in the apertures of fractures for a fracture with variable apertures adopting the mean aperture to evaluate fracture permeability will cause deviations and errors generally the local cubic law lcl has been applied to predict the water permeability of fractures with variable apertures e g brown 1987b david 1993 iwai 1976 oron and berkowitz 1998 unger and mase 1993 mourzenko et al 2001 applied an lcl to study the effect of the roughness hurst exponent h on the estimation of permeability for self affine fractures with different fractal dimensions at the time that the lcl expanded the application of the cubic law it also introduced uncertainties such as the determination of measurement steps for fractures and the choice of fracture apertures berkowitz 2002 although the lcl has been subsequently improved wang et al 2015a 2015b wang and cardenas 2016 watanabe et al 2008 the artificial determination of the dividing steps is still performed e g watanabe et al 2008 which is both time consuming and may cause errors to our knowledge the determination of the number of decomposed segments for lcl has rarely been studied the estimated permeability using the lcl changes with the segmentation strategy for example one fracture can be decomposed into two parts three parts or n number of small parts causing the lcl permeabilities to differ in this study we aimed to determine the number of fracture segments needed when using the lcl to determine the appropriate number of segments for a fracture the several steps were adopted first a modified lcl considering the roughness and hurst exponents of fracture surfaces was proposed to evaluate the permeability of rough fractures secondly fractures were decomposed into different numbers of small parts by using an optimisation algorithm the cuckoo search algorithm cheung et al 2016 dong et al 2017 valian et al 2011 wang and zhong 2015 yang and deb 2009 subsequently the modified lcl and the statistical parameters of each segment were combined and the permeability was evaluated we then simulated the fluid flow through these rough fractures using the lbm due to its simplicity to deal with the complex geometrical boundaries by comparing the darcy permeabilities of the rough fractures and the permeabilities determined using the modified lcl the number needed to segment a fracture was determined finally the proposed lcl and the number needed to segment a fracture were validated via physical fluid flow experiments ju et al 2013 zhang 2016 2 permeability model 2 1 effects of roughness on fluid flow through fractures the fluid permeability of a fracture is closely related to its morphological characteristics such as roughness and the hurst exponent macroscopically the flow rate through a single smooth fracture is commonly evaluated using the cubic law witherspoon et al 1980 which is derived under the assumption that the fracture consists of two smooth parallel plates however actual rock fractures have rough walls and the height distributions of those walls generally exhibit fractal features brown and scholz 1985 mandelbrot 1982 odling 1994 therefore it is inaccurate to evaluate the water permeability of a rough fracture using the cubic law because it is only valid for fractures that exhibit very small variations in their apertures zhu et al 2013 consequently the effect of roughness should be taken into consideration when evaluating the water permeability of actual fractures lomize 1951 established an empirical permeability model for rough fractures by considering the roughness 1 κ b 3 12 1 17 σ b 1 5 1 where b is the mechanical aperture of the fractures and σ is the standard deviation of the fracture surface height values subsequently louis 1969 derived a similar permeability model with the coefficient of 8 8 rather than 17 many researchers e g chen et al 2009 jin et al 2017 ju et al 2013 2017 witherspoon et al 1980 zimmerman and bodvarsson 1996 have also investigated the effects of roughness on flow in open fractures and many have treated the effect of roughness as a factor that accounts for the deviation from the ideal cubic law the permeability estimation model can also be written in the form 2 κ b 3 12 f σ where the roughness factor f σ is equal to 1 17 σ b 1 5 in eq 1 in the study of witherspoon et al 1980 f σ varied from 1 04 to 1 65 for rough fractures in the cubic law and its variants a fixed aperture value determines the estimated permeability of a fracture this limits the application of the cubic law in variable aperture fractures to estimate the permeability of variable aperture fractures researchers divide rough fractures into multiple segments and apply the cubic law over each segment e g oron and berkowitz 1998 renshaw 1995 zhu et al 2013 from the relationships among all of the segments the permeability of the fracture can be derived for each small segment the flow rate can be written in the cubic law form as 3 q k b k 3 12 μ δ p k l k k 1 2 n where qk is the flow rate of the kth segment and δpk and lk are the decrease in pressure and the length of the kth segment respectively according to the law of conservation of fluid mass in fractures the flow rate through each segment should have the same value hence 4 q 1 q 2 q n q in addition to the equal flow rate the pressures and lengths of each segment have the following relationships 5 δ p 1 δ p 2 δ p n δ p 6 l 1 l 2 l n l 7 l 1 l 2 l n l 8 l k l k τ k 1 cos θ k where lk is the real length of the kth segment l is the total horizontal length of the segment τ k is the tortuosity of the kth segment which is equal to the ratio of lk to the horizontal length lk and θ k is the slope angle of kth line the tortuosity of each segment is integrated into the calculation of the local mechanical aperture of the kth segment bk the top and bottom profiles of a fracture are the same in the study and thus the vertical apertures bv are all the same along the fracture the local aperture bk bv cos θ k from eqs 3 to 7 the equivalent hydraulic aperture be may be easily derived as 9 b e 3 l k 1 n l k b k 3 such that when the fracture is a smooth parallel plate b 1 b 2 bn b and l l lk eq 9 can be written as be b and then the lcl degenerates into the classical cubic law the lcl may be used to approximate the permeability of a fracture by ignoring the roughness of each small segment however the roughness of each segment still affects fluid flow brown 1987a in order to remain consistent with the form of eq 1 the effect of roughness is added to the lcl eq 3 can then be rewritten as 10 q k b k 3 12 μ δ p k l k 1 f σ k 1 2 n while eq 10 was revised by renshaw 1995 into the form 11 q k b k 3 12 μ δ p k l k 1 1 σ k b k 2 1 5 k 1 2 n as is shown in eq 2 the f σ is a function of the mechanical aperture and the standard deviation of the heights of fracture profiles therefore the permeability of a rough fracture is determined by the aperture and the standard deviation the standard deviations of fracture profiles have been widely used to describe their roughness patir and cheng 1978 adopted the standard deviation of the height distribution function of a fracture profile σ to quantify the roughness of fracture profiles brown 1987a b also synthesised rough fractures with gaussian height distributions using standard deviations and discussed the effects of σ on fluid flow in this study the roughness of each fracture segment is represented by the standard deviation of the heights of all of the points along a fracture profile 2 2 modified permeability model considering fracture roughness and the hurst exponent eq 11 which takes into consideration the standard deviation in the height of a rough fracture profile extends the application of the cubic law and provides a more accurate assessment of permeability however considering the fractal features of rough fractures for two fractures with the same standard deviation in height the one with the larger fractal dimension will be the more irregular brown and scholz 1985 ju et al 2013 mandelbrot 1982 odling 1994 these irregularities add more hollows and bulges to the fracture and in turn increase their resistance to fluid flow thus the permeability of rough fractures is assumed to diminish with the increase in the fractal dimensions if the fractures have the same standard deviation in height and apertures this can be observed in the following results first an inverted v shaped fracture and a fractal fracture were synthesised as shown in fig 1 a c subsequently we extracted and reordered the coordinates of all of the points on these two fractures in the y axis vertical direction by magnitude the sorted data were then used to synthesise the two new fractures fig 1 b d finally the fluid flow in these four fracture media was simulated using the lbm from fig 1 it can be seen that reordering greatly effects the morphology of fractures notably the number of hollows in fracture d is far less than in fracture c moreover the fluctuation among adjacent points was obviously reduced after sorting in this study the hurst exponent was applied to describe such fluctuations the dimensions of the fracture media were 3 2 25 cm2 the vertical aperture i e the distance from the bottom profile to the top profile in the y direction of the four media was 0 315 cm additionally the coordinates in the y direction of all of the points were counted and their standard deviations were 0 432 cm from the lbm simulation results the darcy permeabilities of these media were found to be 3 003 10 4 cm2 7 35 10 4 cm2 2 126 10 4 cm2 3 648 10 4 cm2 for a b c and d respectively it was also found that the permeabilities of the reordered fracture media had much higher values than the original media since the standard deviation σ in the profile heights and the vertical apertures of fractures were the same the hurst exponents of the fracture profiles considerably contributed to the differences in permeability from the aforementioned analysis it is straightforward to conclude that the hurst exponent h which is regarded as a parameter describing the fluctuation among adjacent points should be considered in conjunction with the standard deviation σ of height to describe the mechanism of fracture roughness when evaluating the permeability of rough fractures thus considering the effect of the hurst exponent of a fracture we modified the model of renshaw 1995 into the following form 12 q k b k 3 12 μ δ p k l k 1 f σ b k 3 12 μ δ p k l k 1 1 f σ k h b k 2 1 5 k 1 2 n where the roughness factor f σ is now replaced by a function of σ and h from the comparison of permeabilities between fig 1 c and fig 1 d it was found that the permeability of fractures decreases with decreasing h for a given aperture and roughness the permeability also decreases with increasing σ if the fractures have the same aperture and hurst exponent by comparing the results of different combinations of σ and h f σ h σe 1 h was found to be a reasonable function and eq 12 was revised as follows 13 q k b k 3 12 μ δ p k l k 1 f σ b k 3 12 μ δ p k l k 1 1 σ k e 1 h b k 2 1 5 k 1 2 n where the roughness factor is a dimensionless parameter and proportional to the classical cubic law the form is also similar to that of eq 1 here the effect of e 1 h resembles the constant 17 in eq 1 except that e 1 h is determined by the morphology of a fracture combing eqs 3 through 9 and eq 13 the following relationship is derived 14 m n k 1 n l k b k 3 1 σ k 2 e 2 h b k 2 1 5 k 1 2 n in eq 14 both bk and σ k depend on the number of segments n therefore the right hand side depends on n we denoted this variable as m n in this study combing eq 4 and 9 there should be a segment number sn that satisfies the relationship m s n l b e 3 thus the step needed to decompose the fracture is marked as sn 3 numerical simulations and validation 3 1 rough fractures generated by the weierstrass mandelbrot function to validate the accuracy of the proposed model we calculated the water permeability of the rough fractures with self affine profiles generated using the weierstrass mandelbrot w m randomised function ausloos and berman 1985 berry and lewis 1980 ju et al 2013 yin and komvopoulos 2010 this function is expressed as 15 z x g i n l n h cos ϕ i cos 2 π γ i x l s ϕ i γ h i where z x is the profile height of the lateral distance x h is the hurst exponent of a profile and γ is the rescaling factor which controls the density distribution of frequencies and is equal to 1 5 the starting nl and end nh values of the summation define the maximum and minimum of the scale of a profile respectively ϕ i ranges from zero to 2π and determines the irregularity and randomness of a profile meanwhile g is the fractal roughness and ls is the period of the profile which is equal to ls when the starting value nl 0 it is then easy to obtain the standard deviations in height and fractal dimensions from natural fractures we can therefore determine a similar profile from the function as is well known rock fractures consist of two rough surfaces and the void space between them the extent of which is known as the fracture aperture in this study a profile generated using the w m function was duplicated and translated upward by a vertical aperture bv to form a fracture the hurst exponent h of a fracture controls the increments z x δx z x of rough fractures where δx represents a lag distance it has been verified that applying only one standard deviation in height to relate the effect of roughness on the fluid flow in fractures is not adequate thus in addition to the standard deviation in height the hurst exponent was also integrated into the permeability model described in section 2 2 the self affine property of real fractures is limited over a range of length scales mourzenko et al 1999 2011 the finite range is smaller than the whole fracture and larger than a microscopic characteristic length such as the typical size of the constituent grains of a rock or the radii of molecules the limited changes in the scale length can be demonstrated by nl and nh in the w m function for example 0 and 50 were selected to synthesise self affine fractures with ls 2048 and γ 1 5 therefore the maximum length scale was represented by the period of cos 2πγ 0 2048 2048 20 48 cm while the minimum length scale was the period of cos 2πγ 50 2048 3 21194 10 6 3 21194 10 8 cm the interval was approximately nine orders of magnitude for the self affine w m function additionally the discretisation of w m fractures into a lattice will also impact the length scale in this study the basic lattice length 1 0 01 cm in our lbm simulations from the scale range of the w m function in this study and the lattice scale the range of the self affine scale was determined to be approximately three orders of magnitude from 0 01 to 20 48 cm 3 2 lbm simulation lattice boltzmann methods can easily deal with complex boundaries and have been widely used in the simulations and studies of fluid flow behaviours jin et al 2017 ju et al 2017 tian and wang 2017 wang et al 2016a 2016b the process of a lbm simulation utilises a discrete lattice and a discrete time mcnamara and zanetti 1988 tian and wang 2017 instead of discretizing macroscopic continuum equations the lbm is based on microscopic models and mesoscopic kinetic equations from the bottom up approach benzi et al 1992 wolf gladrow 2000 lbm simulations have been developed to obtain solutions to the navier stokes ns equation at the macroscopic scale guo et al 2000 nithiarasu and ravindran 1998 succi 2001 in lbms the fluid and matrix phase are discretised into a square lattice with a spacing of δ x the time t is discretised in terms of the time step δ t and the velocity space is represented by a small set of velocities ci which must ensure that ciδ t is a vector that connects two adjacent lattice sites in this study a two dimensional d2q9 lattice model was employed to simulate fluid flow in 2d fractures where d and q are the spatial dimension and the number of discrete velocity vectors in the model respectively first a distribution function fi was set for each lattice that represented the lattice vector ci i e the mesoscopic velocity in the ith direction the mesoscopic velocity model for a d2q9 lattice model is illustrated in fig 2 in the bhatnagar gross krook lbgk model qian et al 1992 a single relaxation time τ lbm is used to simplify the collision operator then at time t the distribution function satisfies the discrete boltzmann equation 16 f i x e i δ t t δ t f i x t 1 τ lbm f i x t f i eq x t where the left hand side of the equation represents the streaming step and the right hand side represents the collision step the local equilibrium distribution function is denoted as f i eq which depends on the local macroscopic variables ρ and ρ u and must satisfy the relationships i f i eq ρ and i f i eq e i ρ u from the conservation of both mass and momentum a single relaxation time τ lbm and the d2q9 lattice structure with nine velocities e i cos π 2 i 1 sin π 2 i 1 for i 1 2 3 4 e i 2 cos π 2 i 1 π 4 sin π 2 i 1 π 4 for i 5 6 7 8 and e i 0 0 for i 0 are assumed for the lbm the equilibrium distribution function can be written as a second order form guo et al 2000 17 f i eq ρ ω i 1 3 e i u 9 2 e i u 2 9 2 u 2 where ω 0 4 9 ω 1 4 1 9 and ω 5 8 1 36 this expansion is valid only for small mach numbers u cs where c s c 3 1 3 represents the speed of sound the kinematic viscosity ν can be derived from the relaxation time 18 ν τ lbm 0 5 c s 2 τ lbm 0 5 3 a bounce back boundary condition was applied in the simulations to maintain zero velocity at fluid solid boundaries because there is virtually no velocity at such interfaces due to the high degree of irregularity of rough profiles additionally a small decline in pressure of 0 00001 from the left inlet to the right outlet was set to guarantee the reynolds number re 1 in this study 6 31 10 7 re 0 091 which is much less than 1 0 meaning that the fluids in fractures satisfy the requirements for laminar flow and meet the criteria of darcy s law zimmerman et al 1991 2004 many theoretical derivations and lbm simulations of fluid flow in smooth parallel flats have been performed with the results showing a good agreement between the analytical results of the classical cubic law and the permeability calculated using lbms guo et al 2000 jin et al 2017 wang et al 2016a 2016b to ensure the capability and accuracy of our lattice boltzmann model and considering the primary aim of this study we first calculated the permeability of a smooth parallel flat to water and compared the lbm results with the those of the classical cubic law see appendix a we then extended the program to compute the fluid flow through single rough fractures 3 3 segmentation method for fracture profiles using the cuckoo algorithm from eq 14 it is clear that the crucial parameter n should be confirmed before applying the modified lcl achieving such a value artificially is difficult because of the random and highly irregular topography of rough profiles moreover in order to maintain a ratio between the width of a fracture to its corresponding aperture in each small segment that is consistent with the requirements of laminar flow the value of n should not be too large konzuk and kueper 2004 to obtain a stable and efficient segmentation for rough fracture the cuckoo search algorithm was applied to solve the optimal partition the cuckoo search algorithm is an efficient optimisation method that was proposed by yang and deb 2009 subsequently much work has been done to improve its searching ability layeb and boussalia 2012 valian et al 2011 wang and zhong 2015 wang et al 2016a 2016b cheung et al 2016 proposed inhomogeneous updates for the cuckoo algorithm and comprehensively analysed its underlying theory the application of this method is straightforward as only a few parameters are needed a short introduction to the theory is presented in appendix b in the cuckoo search algorithm a nest represents a potential solution based on lévy flights the algorithm begins with the generation of a new solution around the original solution the old solution is then replaced by the solution with better fitness in terms of the objective function subsequently some of the worst solutions are discovered with a probability of pa and replaced by new solutions to simplify the implementation of the cuckoo search algorithm three idealised rules were hypothesised 1 one egg a potential solution is laid and placed randomly into one nest by a cuckoo 2 nests with higher quality eggs are preserved to the next generation 3 the progression has a fixed number of available host nests and a cuckoo egg can be detected by hosts bird with a probability of pa 0 1 3 4 optimal segmentation of rough fractures the results of traditional segmentation methods such as the division by the divider method or modified divider methods usually deviate substantially from the original profiles because of the complexity and random nature of profile morphologies in contrast to the rigid rules of division sugihara et al 1990 suggested dividing rough profiles from different starting points and then averaging the result nevertheless the resulting measurements still deviated significantly from their true position this is primarily because these dividing methods cannot intelligently choose the length of each segment the deviations of the traditional divider results are shown in fig 3 b segments indicated by black throws if we evaluate the permeability of a fracture using an approximate profile measured using traditional dividing methods the deviation between the two curves will introduce errors and even cause failure in the evaluation therefore in this study the cuckoo search algorithm was applied to search for an optimised trend an objective function is needed to evaluate the proximity of a trend to its original curve in the optimisation process we assumed that the curve is the best fitting when the total vertical distance tvd of all the points on the rough profile to the curve was minimised because the weierstrass mandelbrot profiles were almost horizontal at a large scale thus the objective function is expressed as 19 t v d i 1 n max d i where di represents the vertical distance of the ith point on the original profile black curve in fig 3 to the current trend line red curve and n max is the total number of points on a rough profile for a known rough profile the smaller the value of tvd the closer the trend is to the profile therefore by finding the most suitable curve we can obtain the minimum objective function three parameters α β and δ are needed in the search algorithm to minimise the objective function they have values of 5 1 4 and 1 3 respectively although the choice of these three parameters has little influence on the final results it should also be noted that the segmentation algorithm was only applied to decompose a rough fracture into multiple segments subsequently the decomposed segments and their corresponding parameters i e the length and the angle of each segment the standard deviation of di and tvd were used to estimate m n as in eq 14 however the lbm simulation was still based on the original fracture media black solid curve in fig 3 4 results and discussion 4 1 segmentation of rough fractures using the cuckoo algorithm the cuckoo search method has been verified by many researchers and our study demonstrates its efficacy in dividing self affine rough profiles we show the results of dividing by this method and compare them with those of the traditional approach in fig 3 the fracture shown in fig 3 a and b has 16 segments in both cases yet the curve in a fits much better than that in b the values of tvd for fig 3 a and b are 9662 737 and 18 309 118 respectively the profile was generated by the w m function with ls 2048 h 0 75 g 50 nl 0 nh 50 and x 1 2048 to further validate the search algorithm profiles with different values of h 0 99 0 9 0 8 0 7 0 6 and 0 5 were created the number of segments n into which the fractures were divided was set to range between 2 and 20 in this study to investigate the ratio of the aperture to fracture length fracture roughness the total fracture length the length of each segment and the fracture length required to establish a steady flow each profile was divided into multiple segments after which values of tvd σ and lm were calculated the results are shown graphically in fig 4 where it can also be seen that all three parameters exhibited a power law relationship with n the linear relationship between h and the exponents of the relationships between σ and n provide a method for estimating the fractal dimensions of rough profiles dong et al 2017 they also indicate that our new dividing method preserves the rough fractal characteristics of fractures 4 2 the modified lcl considering the effect of hurst exponent to validate the modified lcl a series of self affine fractures were created the hurst exponent h of actual fracture profiles both natural and artificial have been found to be centred within a narrow range at 0 8 brown and scholz 1985 poon et al 1992 schmittbuhl et al 1995 thus for simplicity and without losing generality we concentrated on the hydrodynamic problems in self affine fractures in a 2d context where h 0 99 0 9 0 8 0 7 0 6 for each h a series of rough fractures with different aperture openings were synthesised the numerical permeability κ ns was estimated by darcy s law after the fluid flow was fully developed using lbms which was then combined with the classical cubic law κ ns b e 2 12 from which it was easy to derive the equivalent hydraulic aperture be for one single rough fracture hence we could easily obtain l b e 3 for a fracture from the right hand side of eq 14 to determine the roughness and lengths of fractures the profiles were all divided into multiple segments from 2 to 200 using the segmentation method described in section 2 with the left hand side of eq 14 for each n a corresponding value of m n could be easily obtained some aspects of their relationships are shown in fig 5 from fig 5 it is apparent that m n decreases with the increase of n before reaching its minimum value for a small area and then increases with the increase of n this reflects that as n increases the analytical permeability increases first and reaches a maximum value for a period before decreasing this phenomenon becomes even more obvious with larger apertures and larger fractal dimensions we speculate that the main reason for this is that the correction effect of roughness on the permeability model is too heavy when decomposing the fracture profile with only a few segments however if a fracture is decomposed into a large number of segments the ratio of a fracture aperture to fracture length for a segment is too large to form a stable flow konzuk and kueper 2004 oron and berkowitz 1998 moreover the fracture segments are too short to fit their original fractal dimensions when dividing the profile with larger numbers of segments hence based on the requirements for the formation of stable flow and the reynolds approximation in self affine fractures mourzenko et al 1995 and while honouring the fracture topography oron and berkowitz 1998 fractures should not be divided into an excessive number of segments for 1 n 20 m n exhibits an approximately decreasing trend with the increase of n however there is no beneficial relationship expressed by the elementary functions between them and for this reason a bessel function was adopted to find the root for the appropriate sn as shown in fig 5 11 72068 1 188015 0 005463 and 1 933717 are the values of l b e 3 calculated from the corresponding lbm simulations with the cubic law for each aperture and fractal dimension we obtained the corresponding sn for a rough fracture it was then found that an approximate power law relationship exists between the dimensionless vertical aperture bv l and sn which is shown in fig 6 to obtain a scale independent relationship we divided the fractal vertical aperture uniformly by the length l of the sample size in fig 6 the power exponent is 0 9367 which can be approximated as 1 for this reason we show the relationship between sn and l bv in the inset panel in fig 6 and found that sn is proportional to l bv with the coefficient 0 15908 from this relationship the number required to segment a fracture profile can be directly derived from the dimensionless vertical aperture i e the ratio of the vertical aperture to the length of a fracture medium combing eq 14 the cubic law and the relationship shown in fig 6 one can easily obtain the permeability of a 2d rough fracture the potential relationships between sn and other parameters were also explored as is known in addition to the intrinsic morphology of a surface profile the measured length of a fracture profile is also closely related to the measured scale using the optimisation algorithm we compared the dimensionless mean length la l with sn in fig 7 the excellent power law relationship shown directly demonstrates the accuracy of the optimisation algorithm and indirectly indicates the suitability of sn the power exponent was also approximated to 1 therefore we plotted the dimensionless mean length with 1 sn in the inset of fig 7 a furthermore from the nearly linear relationships between 1 sn and la l and between sn and l bv one can speculate that there should also be a nearly linear relationship between la and bv because both of the two parameters have the dimensional unit of length we plotted them in fig 7 b the coefficient is 5 9914 which verifies the relationships among sn la l and l bv 4 3 experimental validation of the modified lcl to validate the accuracy of the modified lcl we used data from previous experiments ju et al 2013 zhang 2016 water flow experiments were conducted on the rough fractures generated by the w m function with fixed thicknesses apertures and different fractal dimensions the cross section of the fractures was a rectangle whose two sides were the thickness and the aperture as illustrated in fig 8 where 2a and 2b represent the thickness and the aperture of the fracture model respectively from fig 8 it can be seen that the 2d fracture fluid flow experiments always have a thickness parameter which causes the fluid flow through pseudo 3d fractures to differ from that in 2d fractures lee et al 2015 lee et al 2017 and zhang 2016 also showed that these kinds of fractures with finite thicknesses differ from 2d fractures where the fracture is implicitly assumed to be infinite in one direction moreover their simulation results indicated that the velocity distribution in the rectangular cross section may be approximated as an ellipse therefore experimental data should be carefully processed before being used for comparison with analytical figures for this reason it is important to understand the velocity distribution in a rectangular cross section of a fracture tube as shown in fig 8 chakraborty 2008 gave a variation of the exact solution of fluid flow velocity in a rectangular cross section graetz 1882 greenhill 1881 in which the velocity at the four solid boundaries was equal to zero the solution can be expressed in the form 20 u x y 16 a 2 π 3 1 μ d p d z n 0 1 n 2 n 1 3 1 cosh 2 n 1 π y 2 a cosh 2 n 1 π ε a 2 a cos 2 n 1 π x 2 a in eq 20 ε is the aspect ratio and 2a and 2b are the length of the cross section in major x and minor y axes respectively from eq 20 the flow rate q area f along the rectangle can be evaluated by integrating the velocity over the cross section while the unit width flow rate of an infinite width fracture with an aperture 2b is q line i 2b 3 1 12μ dp dz for a 2a width area the flow rate is q area i q line i 2a the ratio of q area i to q area f is denoted as ra and ra should be 1 because of the limit of zero velocity boundaries for q area f meanwhile the flow rate q line f along the short axis in the centre of the rectangle can be easily obtained from the corresponding integration the ratio of q line i to q line f is then denoted as rb similarly rb should also be 1 a rectangle with an extremely small ε can be regarded as an approximately infinite parallel fracture then both ra and rb should be approximately one to verify ra rb and eq 20 we set two small ε values to compare ra and rb when ε 0 2 we found that ra 1 1442 and rb 1 0008 while for ε 0 01 ra and ra are 1 0063 and 1 respectively the thickness of the apertures used by zhang 2016 was 5 mm and the apertures of the fractures were 2 27 2 38 2 55 2 96 and 3 81 mm using the same calculations we found the corresponding ra values to be 1 39972 1 42691 1 47076 1 58590 and 1 86919 respectively from these figures we know that if the thickness of a fracture is fixed with the increase in the aperture ra tends to increase from the data examined and relationships found infinite flow rates q area i through rectangular cross sectional fractures were calculated by multiplying the experimental data with their corresponding ra values which are listed in table 1 the permeabilities of fractures were calculated via darcy s law and q area i which represents the permeability of a fracture of infinite thickness or the permeability of a slice parallel to the y z plane as shown in fig 8 thus the permeability was denoted as κ exp which could be used to verify the proposed 2d permeability model in this validation the same digital fracture profiles as those of zhang 2016 were generated using the same fractal dimensions and the same w m function subsequently these profiles were duplicated and transformed with the same vertical apertures table 1 as performed by zhang 2016 and then the two matched profiles and the space between them shaped the fracture from the relationship shown in fig 6 we calculated sn for each fracture subsequently the fractures were segmented into sn smaller parts using the cuckoo search algorithm with the sampling parameters as described the standard deviation in height local aperture and the measured length of each small segment were counted to evaluate the permeability using eq 14 the permeability was denoted as κ lcl both κ lcl and κ exp are plotted in fig 9 against different fractal dimensions from fig 9 it can be seen that κ lcl is quite close to κ exp for different fractal dimensions from 1 1 to 1 4 for fractures with df 1 5 there exists an obvious deviation between the two permeabilities this phenomenon is consistent with our expectations since it has already been found that the proposed lcl can cause considerable errors for large fractal dimensions fortunately most of the fracture surfaces had fractal dimensions much smaller than 1 5 berkowitz 2002 mandelbrot 1982 this indicates that the modified lcl is sufficient for predicting the permeability of 2d rough fractures furthermore the comparison of permeability for df 1 1 1 4 is shown in the inset of fig 9 with the black line representing y x the proposed lcl permeability model was validated with the experimental data as all of the values plotted in the figure are close to the y x line the goodness of fit between the experimental permeabilities and the modified lcl permeabilities implies that the proposed model which takes into consideration the hurst exponent and roughness is effective for evaluating the permeability of 2d rough fractures or infinitely stretched fractures similar to that shown in fig 8 the errors in physical experiments and the approximations of sn and trend lines result in small deviations between the calculated and experimental data yet it is still reasonable for one to believe that the effects of the hurst exponent on fluid flow should be considered when evaluating the permeability of rough fractures it is noted that in their flow experiments a few researchers e g ju et al 2013 and zhang 2016 also used a straight rectangular cross sectional fracture with an aperture of 2 mm vertical aperture of 2 18 mm and a thickness of 5 mm the tested flow rate was 47 9 10 7 m3 s which can be applied to calculate the permeability with its corresponding ra and 1 μ dp dz the permeability of the fracture model was 2 93635 10 7 m2 while the cubic law permeability was 3 3333 10 7 m2 the deviation between them is most likely caused by the improper use of 1 μ dp dz the μ of water under 20 c and 10 c are 0 00102 pa s and 0 001308 pa s respectively the values of μ and dp used in their study were 0 001 pa s and 0 05 pa those parameters along with the thickness may have induced errors in the estimates of permeability moreover the component of the fluid i e water would likely also have influenced the dynamic viscosity by considering all of the possible effects of the test results we corrected the term dp μ by setting the experimental permeability and the cubic law permeability as equal for a parallel plate fracture obtaining the corrected dp μ with the new dp μ and q area i the permeabilities for rough fractures were calculated and compared 5 conclusions in this study self affine rough fractures generated by the w m function were used to study the fluid flow through single fractures mainly via numerical simulations an optimised segmentation strategy using the cuckoo search algorithm was applied to decompose fracture profiles into smaller parts based on the segmentation strategy and the effects of roughness a modified lcl was proposed accounting for the roughness and the hurst exponents of fracture profiles thereafter with the lbm simulation results of fluid flow through rough fractures the number needed to decompose a fracture into multiple small fractures was determined finally the newly proposed permeability model and the number needed to divide a fracture were validated by physical hydraulic experiments during this process a method of transforming pseudo 3d experimental data into 2d values was defined from this study several conclusions were drawn 1 the optimised segmentation strategy is reasonable for segmenting fracture profiles as excellent power law relationships can be seen between the number of segments n and several statistical parameters such as the minimum value of the total vertical distance tvd the total length of all of the segments lm and the standard deviation σ of the distances from all of the points on the original profile to the divided curves 2 the number of segments n is a crucial parameter for applying the modified lcl with different values of n different m n values were obtained using the modified lcl for a fracture with the relationship between m n and the corresponding lbm permeability the necessary dividing number sn can be determined additionally it was found that there is an inverse and proportional relationship between sn and the dimensionless aperture i e the ratio of the vertical aperture bv to the fracture medium length l such that sn 0 15908l bv this relationship appears to indicate that a larger sn is required to divide the fracture profile when the fracture medium is longer and a larger sn is also required to decompose the fracture profile when the aperture is narrower moreover it is a dimensionless relationship so one can obtain the sn from bv l without considering the units of the apertures 3 based on the comparisons of water permeability between experimental data and the values calculated from the proposed lcl the new permeability model which considers the roughness and hurst exponent and the number of segments required to divide fracture profiles from the dimensionless aperture is valid therefore the hurst exponents of fractures should be regarded as extra parameters of roughness to describe the effects of roughness on the permeability of rough fractures here we describe the influence of fracture roughness from the viewpoint of an optimised segmentation strategy numerical simulations and experimental validation the comparison between analytical values calculated using the proposed methods and experimental values indicates that the new permeability model is suitable for small scale rough fractures and that the hurst exponents of fractures have non negligible effects on evaluations of permeability more importantly it was found that the number of segments needed to divide a fracture when using the modified lcl can be easily determined from the dimensionless aperture alone the inversely proportional relationship between the dimensionless aperture and the dividing steps not only determines the number needed to divide a fracture but also provides insights into the formation conditions of steady flows funding we wish to acknowledge the financial support provided by the national natural science foundation of china grant nos 51 674 251 51 727 807 and 51 374 213 the state key research development program of china grant no 2016yfc0600705 the national major project for science and technology grant no 2017zx05049003 006 and the innovation teams of ten thousand talents program sponsored by the ministry of science and technology of china grant no 2016ra4067 conflict of interest none appendix a to verify the accuracy of the lbm simulation program we use the classical cubic law to validate the simulation of fluid flow in a smooth parallel flat by lbms straight fractures with a series of apertures were synthesised for the lbm simulations the compared permeabilities obtained using the two methods the classical cubic law and darcy s law calculated from the simulation results by lbms are shown in fig a1 the permeabilities estimated via the two methods had nearly the same value as the inset panel shows the velocity distribution after unit transformation of lbm simulation results for a straight channel length 0 1 m 500 lu with a pressure difference 0 9 10 5 pa a dynamic viscosity 0 001 pa s and an aperture of 0 004 m fits well with the analytical velocity distribution derived from transformed parameters and hydrodynamics the red scatter in the inset represents the relative errors between the lbm velocity and the analytical velocity appendix b at the beginning of the cuckoo search optimisation initial solutions were randomly sampled from the solution space b 1 x i j 0 rand k min j k max j i 1 2 n b where rand k min j k max j indicates a uniform random number from the minimum k min j to the maximum k max j of the jth value space j is in 1 nd nd is the dimension of the problem and nb is the number of broods solutions the updating of position x i is expressed as following b 2 x i k 1 x i k α l e vy β where k represents the kth iteration and α is the corresponding step size the operational symbol represents entry wise multiplication as the name suggests lévy β is the lévy flight distribution that is expressed as lévy β t 1 β with t as a random variable to simplify implementation lévy β was rewritten as b 3 l e vy β ϕ η θ 1 β ϕ γ 1 β sin π β 2 γ 1 β 2 β 2 β 1 2 1 β where the suggested value for β 1 5 yang and deb 2009 and both η and θ obey a normal distribution combining eqs b 2 and b 3 the updating rule may be rewritten as follows b 4 x i k 1 x i k α ϕ η θ 1 β x i k x g where x g is the current best solution in addition to being updated by better solutions the solutions are also updated for the discovery probability pa by hosts thus the updating rule is redefined as follows b 5 x i k 1 x i k r x m k x n k if p p a x i k otherwise where r is a scale factor that ranges from 0 to 1 m and n are random indices and p is a random number from zero to one based on quantum a mechanism cheung et al 2016 derived an inhomogeneous search strategy to improve the searching ability of the algorithm they added a new parameter the mean position x of all the nests in one iteration to update the rule such that b 6 x 1 n b i 1 n b x i cheung et al 2016 then rewrote the equation in the following form b 7 x i k 1 x i k α ϕ η θ 1 β x i k g k sr 2 3 1 x i k l x k x i k sr 1 3 2 3 x i k e g k x i k otherwise where l δ ln 1 η e δ exp η and sr is a random number in the range 0 1 as in the study of cheung et al 2016 the quantum trick l was replaced by e to guarantee that no large fluctuations occurred around the global best candidate nest in this study 
629,the water permeability of natural fractures is highly related to their morphological characteristics for fractures with irregular profiles and variable apertures it is challenging to define an appropriate aperture to apply the traditional cubic law for evaluating permeability in this study we propose a novel approach that integrates the standard deviation and the hurst exponent of a self affine fracture profile to characterise the effects of fracture morphology on permeability using cuckoo search algorithms a modified local cubic law was derived to evaluate permeability considering the roughness and hurst exponent of fractures the required number of segments for a fracture was obtained by comparing simulation results using lattice boltzmann methods the proposed permeability model and segment strategy were validated by experiments on rough fractures the results show that the number of segments required for the model can be directly derived from the dimensionless aperture i e mechanical aperture length of fracture media keywords rough fracture permeability evaluation self affine fractal profile local cubic law lattice boltzmann method segmentation algorithm 1 introduction fractures are widespread in rock masses and the fluid flow through them affects their mechanical properties by inducing deformation fracturing softening argillisation and corrosion renshaw 1995 tenthorey et al 2003 wang et al 2015a 2015b statistical data have shown that water seepage through rock masses and the resulting changes in permeability give rise to serious engineering problems such as water burst disasters lu and wang 2015 wu and wang 2006 and coal gas outbursts an and cheng 2014 xue et al 2015 additionally fractures greatly influence the transport of groundwater as well as water security berkowitz 2002 hariri ardebili et al 2013 for dams and reservoirs larger undetected fractures can cause severe engineering problems hariri ardebili et al 2013 zhang et al 2013 a better understanding of fracture geometry and the occurrence of fractures will allow for more effective water resource exploration and more accurate determinations of water protection regions as fractures increase the transport distance of contaminants jackson et al 2013 vengosh et al 2014 research on fluid flow through rock masses has mainly been concentrated on the characterisation of fracture surface geometry and the prediction of rock permeability babadagli et al 2015 brown 1987a ju et al 2013 lee et al 2015 2017 poon et al 1992 thompson and brown 1991 wang et al 2015a 2015b wu and ali 1978 yu and vayssade 1991 the scale of fractures ranges from a few microns to several kilometres azizmohammadi and matthäi 2017 berkowitz 2002 therefore the methods of evaluating permeability differ among the scales of fractures measuring large scale field permeability is difficult and is commonly performed using tracer migration experiments without a clear flow strategy for the fluid in fractures hadermann and heer 1996 to explore fluid flow mechanisms numerous small scale studies on fractures and permeability evaluations have been conducted these can mainly be classified into laboratory experiments e g babadagli et al 2015 develi and babadagli 2015 ju et al 2013 watanabe et al 2008 numerical simulations e g crandall et al 2010a 2010b unger and mase 1993 zhang et al 1996 and analytical derivations e g jin et al 2017 chakraborty 2008 small scale studies have primarily focused on the prediction of permeability and the impacts of physical and hydraulic parameters on permeability such as aperture temperature and fracture tomography bisdom et al 2016 kozusnikova and konecny 2011 talon et al 2010a 2010b wang et al 2016a 2016b wu et al 2017 malevich et al 2006 studied the fluid flow through three dimensional 3d fractures with variable apertures they proposed an analytical velocity in variable aperture fractures mourzenko et al 2018 provided a brief review of fluid flow through a single fracture and analysed more parameters with greater accuracy on larger samples moreover they also discussed some of the differences between large and small apertures in early studies the power law relationship cubic law between fracture apertures and water permeability was determined through experiments and analytical derivation under the assumption that fractures consist of a pair of parallel smooth plates however actual fractures are irregular with rough fracture surfaces and fracture surfaces have been shown to exhibit self affine fractal properties belem et al 2000 berkowitz 2002 brown 1987b mandelbrot 1982 poon et al 1992 wu and ali 1978 the roughness of fracture surfaces leads to phenomena such as increased flow resistance flow path tortuosity backflow eddy flow and even local turbulence develi and babadagli 2015 dou et al 2018 lee et al 2015 2017 thereby decreasing the effective aperture and flow through fractures mourzenko et al 1995 1996 1999 added the roughness exponent h into the variance of self affine surface elevations and discussed the effects of variance on the percolation and conductivity of fractures the tortuosity of fluid flow is the result of the restriction of rough profiles and the development of fluid flow develi and babadagli 2015 dou et al 2018 lee et al 2015 2017 tortuosity increases the flow path and decreases the actual pressure drop brush and thomson 2003 chen et al 2000 ghanbarian et al 2013 jin et al 2015 murata and saito 2003 chen et al 2000 noted that roughness and contact areas also cause inertial losses and initiate turbulence in eddy flows within corners berkowitz 2002 found that the adequacy of the cubic law for rough fractures is noteworthy because of the limited details that can be obtained from fractures and the flow patterns through them babadagli et al 2015 also indicated that the quantification of surface roughness is necessary because roughness causes channelling through fractures although many attempts e g auradou et al 2006 chen et al 2000 tenthorey et al 2003 have been made to study aspects of flow through single fractures research on the effects of roughness on hydraulic behaviour remains limited lee et al 2003 the permeability predicted by the cubic law deviates by a large margin from actual permeability bisdom et al 2016 talon et al 2010a 2010b zhu et al 2013 tsang 1984 indicated that the actual flow rate for a fracture can be three or more orders of magnitude lower than the value predicted using the parallel plate assumption to predict the permeability of rough fractures and evaluate the deviation between the actual value and the analytical value from the cubic law tremendous efforts e g babadagli et al 2015 develi and babadagli 2015 linga et al 2017 wang et al 2016a 2016b have been invested into characterizing the roughness of fractures and correcting the cubic law lomize 1951 proposed a roughness factor to describe the influence of roughness on permeability subsequently several studies babadagli et al 2015 develi and babadagli 2015 lomize 1951 witherspoon et al 1980 have been focused on describing the effects of fracture roughness although the effects of roughness are widely known to date the effects of roughness on permeability are still not well understood even if two fractures have the same roughness differences in the distribution of fracture height will lead to different flow behaviours and permeability jin et al 2017 since the effect of surface roughness on the fluid flow through fractures remains unclear two dimensional 2d fracture studies are still important previous studies have shown that many 3d fractures can be simplified into 2d problems or be studied from a 2d perspective crandall et al 2010a 2010b kong and chen 2018 koyama et al 2008 zhao et al 2018 moreover many studies have been focused on the influence of surface morphology on fluid flow in microchannels especially in the past two years e g dou et al 2018 felisa et al 2018 hajjar et al 2018 wang et al 2018 zeng et al 2018 zhang et al 2019 felisa et al 2018 studied the effects of variable apertures on fluid flow through rough fractures wang et al 2018 studied the permeability of single rough fractures and proposed a modified cubic law by considering flow tortuosity and aperture variability additionally zhang et al 2019 discussed the influences of the morphology of surface structures using the lattice boltzmann method lbm all of these studies have shown that fracture roughness has multiple and complex effects on fluid flow fracture roughness causes variations in the apertures of fractures for a fracture with variable apertures adopting the mean aperture to evaluate fracture permeability will cause deviations and errors generally the local cubic law lcl has been applied to predict the water permeability of fractures with variable apertures e g brown 1987b david 1993 iwai 1976 oron and berkowitz 1998 unger and mase 1993 mourzenko et al 2001 applied an lcl to study the effect of the roughness hurst exponent h on the estimation of permeability for self affine fractures with different fractal dimensions at the time that the lcl expanded the application of the cubic law it also introduced uncertainties such as the determination of measurement steps for fractures and the choice of fracture apertures berkowitz 2002 although the lcl has been subsequently improved wang et al 2015a 2015b wang and cardenas 2016 watanabe et al 2008 the artificial determination of the dividing steps is still performed e g watanabe et al 2008 which is both time consuming and may cause errors to our knowledge the determination of the number of decomposed segments for lcl has rarely been studied the estimated permeability using the lcl changes with the segmentation strategy for example one fracture can be decomposed into two parts three parts or n number of small parts causing the lcl permeabilities to differ in this study we aimed to determine the number of fracture segments needed when using the lcl to determine the appropriate number of segments for a fracture the several steps were adopted first a modified lcl considering the roughness and hurst exponents of fracture surfaces was proposed to evaluate the permeability of rough fractures secondly fractures were decomposed into different numbers of small parts by using an optimisation algorithm the cuckoo search algorithm cheung et al 2016 dong et al 2017 valian et al 2011 wang and zhong 2015 yang and deb 2009 subsequently the modified lcl and the statistical parameters of each segment were combined and the permeability was evaluated we then simulated the fluid flow through these rough fractures using the lbm due to its simplicity to deal with the complex geometrical boundaries by comparing the darcy permeabilities of the rough fractures and the permeabilities determined using the modified lcl the number needed to segment a fracture was determined finally the proposed lcl and the number needed to segment a fracture were validated via physical fluid flow experiments ju et al 2013 zhang 2016 2 permeability model 2 1 effects of roughness on fluid flow through fractures the fluid permeability of a fracture is closely related to its morphological characteristics such as roughness and the hurst exponent macroscopically the flow rate through a single smooth fracture is commonly evaluated using the cubic law witherspoon et al 1980 which is derived under the assumption that the fracture consists of two smooth parallel plates however actual rock fractures have rough walls and the height distributions of those walls generally exhibit fractal features brown and scholz 1985 mandelbrot 1982 odling 1994 therefore it is inaccurate to evaluate the water permeability of a rough fracture using the cubic law because it is only valid for fractures that exhibit very small variations in their apertures zhu et al 2013 consequently the effect of roughness should be taken into consideration when evaluating the water permeability of actual fractures lomize 1951 established an empirical permeability model for rough fractures by considering the roughness 1 κ b 3 12 1 17 σ b 1 5 1 where b is the mechanical aperture of the fractures and σ is the standard deviation of the fracture surface height values subsequently louis 1969 derived a similar permeability model with the coefficient of 8 8 rather than 17 many researchers e g chen et al 2009 jin et al 2017 ju et al 2013 2017 witherspoon et al 1980 zimmerman and bodvarsson 1996 have also investigated the effects of roughness on flow in open fractures and many have treated the effect of roughness as a factor that accounts for the deviation from the ideal cubic law the permeability estimation model can also be written in the form 2 κ b 3 12 f σ where the roughness factor f σ is equal to 1 17 σ b 1 5 in eq 1 in the study of witherspoon et al 1980 f σ varied from 1 04 to 1 65 for rough fractures in the cubic law and its variants a fixed aperture value determines the estimated permeability of a fracture this limits the application of the cubic law in variable aperture fractures to estimate the permeability of variable aperture fractures researchers divide rough fractures into multiple segments and apply the cubic law over each segment e g oron and berkowitz 1998 renshaw 1995 zhu et al 2013 from the relationships among all of the segments the permeability of the fracture can be derived for each small segment the flow rate can be written in the cubic law form as 3 q k b k 3 12 μ δ p k l k k 1 2 n where qk is the flow rate of the kth segment and δpk and lk are the decrease in pressure and the length of the kth segment respectively according to the law of conservation of fluid mass in fractures the flow rate through each segment should have the same value hence 4 q 1 q 2 q n q in addition to the equal flow rate the pressures and lengths of each segment have the following relationships 5 δ p 1 δ p 2 δ p n δ p 6 l 1 l 2 l n l 7 l 1 l 2 l n l 8 l k l k τ k 1 cos θ k where lk is the real length of the kth segment l is the total horizontal length of the segment τ k is the tortuosity of the kth segment which is equal to the ratio of lk to the horizontal length lk and θ k is the slope angle of kth line the tortuosity of each segment is integrated into the calculation of the local mechanical aperture of the kth segment bk the top and bottom profiles of a fracture are the same in the study and thus the vertical apertures bv are all the same along the fracture the local aperture bk bv cos θ k from eqs 3 to 7 the equivalent hydraulic aperture be may be easily derived as 9 b e 3 l k 1 n l k b k 3 such that when the fracture is a smooth parallel plate b 1 b 2 bn b and l l lk eq 9 can be written as be b and then the lcl degenerates into the classical cubic law the lcl may be used to approximate the permeability of a fracture by ignoring the roughness of each small segment however the roughness of each segment still affects fluid flow brown 1987a in order to remain consistent with the form of eq 1 the effect of roughness is added to the lcl eq 3 can then be rewritten as 10 q k b k 3 12 μ δ p k l k 1 f σ k 1 2 n while eq 10 was revised by renshaw 1995 into the form 11 q k b k 3 12 μ δ p k l k 1 1 σ k b k 2 1 5 k 1 2 n as is shown in eq 2 the f σ is a function of the mechanical aperture and the standard deviation of the heights of fracture profiles therefore the permeability of a rough fracture is determined by the aperture and the standard deviation the standard deviations of fracture profiles have been widely used to describe their roughness patir and cheng 1978 adopted the standard deviation of the height distribution function of a fracture profile σ to quantify the roughness of fracture profiles brown 1987a b also synthesised rough fractures with gaussian height distributions using standard deviations and discussed the effects of σ on fluid flow in this study the roughness of each fracture segment is represented by the standard deviation of the heights of all of the points along a fracture profile 2 2 modified permeability model considering fracture roughness and the hurst exponent eq 11 which takes into consideration the standard deviation in the height of a rough fracture profile extends the application of the cubic law and provides a more accurate assessment of permeability however considering the fractal features of rough fractures for two fractures with the same standard deviation in height the one with the larger fractal dimension will be the more irregular brown and scholz 1985 ju et al 2013 mandelbrot 1982 odling 1994 these irregularities add more hollows and bulges to the fracture and in turn increase their resistance to fluid flow thus the permeability of rough fractures is assumed to diminish with the increase in the fractal dimensions if the fractures have the same standard deviation in height and apertures this can be observed in the following results first an inverted v shaped fracture and a fractal fracture were synthesised as shown in fig 1 a c subsequently we extracted and reordered the coordinates of all of the points on these two fractures in the y axis vertical direction by magnitude the sorted data were then used to synthesise the two new fractures fig 1 b d finally the fluid flow in these four fracture media was simulated using the lbm from fig 1 it can be seen that reordering greatly effects the morphology of fractures notably the number of hollows in fracture d is far less than in fracture c moreover the fluctuation among adjacent points was obviously reduced after sorting in this study the hurst exponent was applied to describe such fluctuations the dimensions of the fracture media were 3 2 25 cm2 the vertical aperture i e the distance from the bottom profile to the top profile in the y direction of the four media was 0 315 cm additionally the coordinates in the y direction of all of the points were counted and their standard deviations were 0 432 cm from the lbm simulation results the darcy permeabilities of these media were found to be 3 003 10 4 cm2 7 35 10 4 cm2 2 126 10 4 cm2 3 648 10 4 cm2 for a b c and d respectively it was also found that the permeabilities of the reordered fracture media had much higher values than the original media since the standard deviation σ in the profile heights and the vertical apertures of fractures were the same the hurst exponents of the fracture profiles considerably contributed to the differences in permeability from the aforementioned analysis it is straightforward to conclude that the hurst exponent h which is regarded as a parameter describing the fluctuation among adjacent points should be considered in conjunction with the standard deviation σ of height to describe the mechanism of fracture roughness when evaluating the permeability of rough fractures thus considering the effect of the hurst exponent of a fracture we modified the model of renshaw 1995 into the following form 12 q k b k 3 12 μ δ p k l k 1 f σ b k 3 12 μ δ p k l k 1 1 f σ k h b k 2 1 5 k 1 2 n where the roughness factor f σ is now replaced by a function of σ and h from the comparison of permeabilities between fig 1 c and fig 1 d it was found that the permeability of fractures decreases with decreasing h for a given aperture and roughness the permeability also decreases with increasing σ if the fractures have the same aperture and hurst exponent by comparing the results of different combinations of σ and h f σ h σe 1 h was found to be a reasonable function and eq 12 was revised as follows 13 q k b k 3 12 μ δ p k l k 1 f σ b k 3 12 μ δ p k l k 1 1 σ k e 1 h b k 2 1 5 k 1 2 n where the roughness factor is a dimensionless parameter and proportional to the classical cubic law the form is also similar to that of eq 1 here the effect of e 1 h resembles the constant 17 in eq 1 except that e 1 h is determined by the morphology of a fracture combing eqs 3 through 9 and eq 13 the following relationship is derived 14 m n k 1 n l k b k 3 1 σ k 2 e 2 h b k 2 1 5 k 1 2 n in eq 14 both bk and σ k depend on the number of segments n therefore the right hand side depends on n we denoted this variable as m n in this study combing eq 4 and 9 there should be a segment number sn that satisfies the relationship m s n l b e 3 thus the step needed to decompose the fracture is marked as sn 3 numerical simulations and validation 3 1 rough fractures generated by the weierstrass mandelbrot function to validate the accuracy of the proposed model we calculated the water permeability of the rough fractures with self affine profiles generated using the weierstrass mandelbrot w m randomised function ausloos and berman 1985 berry and lewis 1980 ju et al 2013 yin and komvopoulos 2010 this function is expressed as 15 z x g i n l n h cos ϕ i cos 2 π γ i x l s ϕ i γ h i where z x is the profile height of the lateral distance x h is the hurst exponent of a profile and γ is the rescaling factor which controls the density distribution of frequencies and is equal to 1 5 the starting nl and end nh values of the summation define the maximum and minimum of the scale of a profile respectively ϕ i ranges from zero to 2π and determines the irregularity and randomness of a profile meanwhile g is the fractal roughness and ls is the period of the profile which is equal to ls when the starting value nl 0 it is then easy to obtain the standard deviations in height and fractal dimensions from natural fractures we can therefore determine a similar profile from the function as is well known rock fractures consist of two rough surfaces and the void space between them the extent of which is known as the fracture aperture in this study a profile generated using the w m function was duplicated and translated upward by a vertical aperture bv to form a fracture the hurst exponent h of a fracture controls the increments z x δx z x of rough fractures where δx represents a lag distance it has been verified that applying only one standard deviation in height to relate the effect of roughness on the fluid flow in fractures is not adequate thus in addition to the standard deviation in height the hurst exponent was also integrated into the permeability model described in section 2 2 the self affine property of real fractures is limited over a range of length scales mourzenko et al 1999 2011 the finite range is smaller than the whole fracture and larger than a microscopic characteristic length such as the typical size of the constituent grains of a rock or the radii of molecules the limited changes in the scale length can be demonstrated by nl and nh in the w m function for example 0 and 50 were selected to synthesise self affine fractures with ls 2048 and γ 1 5 therefore the maximum length scale was represented by the period of cos 2πγ 0 2048 2048 20 48 cm while the minimum length scale was the period of cos 2πγ 50 2048 3 21194 10 6 3 21194 10 8 cm the interval was approximately nine orders of magnitude for the self affine w m function additionally the discretisation of w m fractures into a lattice will also impact the length scale in this study the basic lattice length 1 0 01 cm in our lbm simulations from the scale range of the w m function in this study and the lattice scale the range of the self affine scale was determined to be approximately three orders of magnitude from 0 01 to 20 48 cm 3 2 lbm simulation lattice boltzmann methods can easily deal with complex boundaries and have been widely used in the simulations and studies of fluid flow behaviours jin et al 2017 ju et al 2017 tian and wang 2017 wang et al 2016a 2016b the process of a lbm simulation utilises a discrete lattice and a discrete time mcnamara and zanetti 1988 tian and wang 2017 instead of discretizing macroscopic continuum equations the lbm is based on microscopic models and mesoscopic kinetic equations from the bottom up approach benzi et al 1992 wolf gladrow 2000 lbm simulations have been developed to obtain solutions to the navier stokes ns equation at the macroscopic scale guo et al 2000 nithiarasu and ravindran 1998 succi 2001 in lbms the fluid and matrix phase are discretised into a square lattice with a spacing of δ x the time t is discretised in terms of the time step δ t and the velocity space is represented by a small set of velocities ci which must ensure that ciδ t is a vector that connects two adjacent lattice sites in this study a two dimensional d2q9 lattice model was employed to simulate fluid flow in 2d fractures where d and q are the spatial dimension and the number of discrete velocity vectors in the model respectively first a distribution function fi was set for each lattice that represented the lattice vector ci i e the mesoscopic velocity in the ith direction the mesoscopic velocity model for a d2q9 lattice model is illustrated in fig 2 in the bhatnagar gross krook lbgk model qian et al 1992 a single relaxation time τ lbm is used to simplify the collision operator then at time t the distribution function satisfies the discrete boltzmann equation 16 f i x e i δ t t δ t f i x t 1 τ lbm f i x t f i eq x t where the left hand side of the equation represents the streaming step and the right hand side represents the collision step the local equilibrium distribution function is denoted as f i eq which depends on the local macroscopic variables ρ and ρ u and must satisfy the relationships i f i eq ρ and i f i eq e i ρ u from the conservation of both mass and momentum a single relaxation time τ lbm and the d2q9 lattice structure with nine velocities e i cos π 2 i 1 sin π 2 i 1 for i 1 2 3 4 e i 2 cos π 2 i 1 π 4 sin π 2 i 1 π 4 for i 5 6 7 8 and e i 0 0 for i 0 are assumed for the lbm the equilibrium distribution function can be written as a second order form guo et al 2000 17 f i eq ρ ω i 1 3 e i u 9 2 e i u 2 9 2 u 2 where ω 0 4 9 ω 1 4 1 9 and ω 5 8 1 36 this expansion is valid only for small mach numbers u cs where c s c 3 1 3 represents the speed of sound the kinematic viscosity ν can be derived from the relaxation time 18 ν τ lbm 0 5 c s 2 τ lbm 0 5 3 a bounce back boundary condition was applied in the simulations to maintain zero velocity at fluid solid boundaries because there is virtually no velocity at such interfaces due to the high degree of irregularity of rough profiles additionally a small decline in pressure of 0 00001 from the left inlet to the right outlet was set to guarantee the reynolds number re 1 in this study 6 31 10 7 re 0 091 which is much less than 1 0 meaning that the fluids in fractures satisfy the requirements for laminar flow and meet the criteria of darcy s law zimmerman et al 1991 2004 many theoretical derivations and lbm simulations of fluid flow in smooth parallel flats have been performed with the results showing a good agreement between the analytical results of the classical cubic law and the permeability calculated using lbms guo et al 2000 jin et al 2017 wang et al 2016a 2016b to ensure the capability and accuracy of our lattice boltzmann model and considering the primary aim of this study we first calculated the permeability of a smooth parallel flat to water and compared the lbm results with the those of the classical cubic law see appendix a we then extended the program to compute the fluid flow through single rough fractures 3 3 segmentation method for fracture profiles using the cuckoo algorithm from eq 14 it is clear that the crucial parameter n should be confirmed before applying the modified lcl achieving such a value artificially is difficult because of the random and highly irregular topography of rough profiles moreover in order to maintain a ratio between the width of a fracture to its corresponding aperture in each small segment that is consistent with the requirements of laminar flow the value of n should not be too large konzuk and kueper 2004 to obtain a stable and efficient segmentation for rough fracture the cuckoo search algorithm was applied to solve the optimal partition the cuckoo search algorithm is an efficient optimisation method that was proposed by yang and deb 2009 subsequently much work has been done to improve its searching ability layeb and boussalia 2012 valian et al 2011 wang and zhong 2015 wang et al 2016a 2016b cheung et al 2016 proposed inhomogeneous updates for the cuckoo algorithm and comprehensively analysed its underlying theory the application of this method is straightforward as only a few parameters are needed a short introduction to the theory is presented in appendix b in the cuckoo search algorithm a nest represents a potential solution based on lévy flights the algorithm begins with the generation of a new solution around the original solution the old solution is then replaced by the solution with better fitness in terms of the objective function subsequently some of the worst solutions are discovered with a probability of pa and replaced by new solutions to simplify the implementation of the cuckoo search algorithm three idealised rules were hypothesised 1 one egg a potential solution is laid and placed randomly into one nest by a cuckoo 2 nests with higher quality eggs are preserved to the next generation 3 the progression has a fixed number of available host nests and a cuckoo egg can be detected by hosts bird with a probability of pa 0 1 3 4 optimal segmentation of rough fractures the results of traditional segmentation methods such as the division by the divider method or modified divider methods usually deviate substantially from the original profiles because of the complexity and random nature of profile morphologies in contrast to the rigid rules of division sugihara et al 1990 suggested dividing rough profiles from different starting points and then averaging the result nevertheless the resulting measurements still deviated significantly from their true position this is primarily because these dividing methods cannot intelligently choose the length of each segment the deviations of the traditional divider results are shown in fig 3 b segments indicated by black throws if we evaluate the permeability of a fracture using an approximate profile measured using traditional dividing methods the deviation between the two curves will introduce errors and even cause failure in the evaluation therefore in this study the cuckoo search algorithm was applied to search for an optimised trend an objective function is needed to evaluate the proximity of a trend to its original curve in the optimisation process we assumed that the curve is the best fitting when the total vertical distance tvd of all the points on the rough profile to the curve was minimised because the weierstrass mandelbrot profiles were almost horizontal at a large scale thus the objective function is expressed as 19 t v d i 1 n max d i where di represents the vertical distance of the ith point on the original profile black curve in fig 3 to the current trend line red curve and n max is the total number of points on a rough profile for a known rough profile the smaller the value of tvd the closer the trend is to the profile therefore by finding the most suitable curve we can obtain the minimum objective function three parameters α β and δ are needed in the search algorithm to minimise the objective function they have values of 5 1 4 and 1 3 respectively although the choice of these three parameters has little influence on the final results it should also be noted that the segmentation algorithm was only applied to decompose a rough fracture into multiple segments subsequently the decomposed segments and their corresponding parameters i e the length and the angle of each segment the standard deviation of di and tvd were used to estimate m n as in eq 14 however the lbm simulation was still based on the original fracture media black solid curve in fig 3 4 results and discussion 4 1 segmentation of rough fractures using the cuckoo algorithm the cuckoo search method has been verified by many researchers and our study demonstrates its efficacy in dividing self affine rough profiles we show the results of dividing by this method and compare them with those of the traditional approach in fig 3 the fracture shown in fig 3 a and b has 16 segments in both cases yet the curve in a fits much better than that in b the values of tvd for fig 3 a and b are 9662 737 and 18 309 118 respectively the profile was generated by the w m function with ls 2048 h 0 75 g 50 nl 0 nh 50 and x 1 2048 to further validate the search algorithm profiles with different values of h 0 99 0 9 0 8 0 7 0 6 and 0 5 were created the number of segments n into which the fractures were divided was set to range between 2 and 20 in this study to investigate the ratio of the aperture to fracture length fracture roughness the total fracture length the length of each segment and the fracture length required to establish a steady flow each profile was divided into multiple segments after which values of tvd σ and lm were calculated the results are shown graphically in fig 4 where it can also be seen that all three parameters exhibited a power law relationship with n the linear relationship between h and the exponents of the relationships between σ and n provide a method for estimating the fractal dimensions of rough profiles dong et al 2017 they also indicate that our new dividing method preserves the rough fractal characteristics of fractures 4 2 the modified lcl considering the effect of hurst exponent to validate the modified lcl a series of self affine fractures were created the hurst exponent h of actual fracture profiles both natural and artificial have been found to be centred within a narrow range at 0 8 brown and scholz 1985 poon et al 1992 schmittbuhl et al 1995 thus for simplicity and without losing generality we concentrated on the hydrodynamic problems in self affine fractures in a 2d context where h 0 99 0 9 0 8 0 7 0 6 for each h a series of rough fractures with different aperture openings were synthesised the numerical permeability κ ns was estimated by darcy s law after the fluid flow was fully developed using lbms which was then combined with the classical cubic law κ ns b e 2 12 from which it was easy to derive the equivalent hydraulic aperture be for one single rough fracture hence we could easily obtain l b e 3 for a fracture from the right hand side of eq 14 to determine the roughness and lengths of fractures the profiles were all divided into multiple segments from 2 to 200 using the segmentation method described in section 2 with the left hand side of eq 14 for each n a corresponding value of m n could be easily obtained some aspects of their relationships are shown in fig 5 from fig 5 it is apparent that m n decreases with the increase of n before reaching its minimum value for a small area and then increases with the increase of n this reflects that as n increases the analytical permeability increases first and reaches a maximum value for a period before decreasing this phenomenon becomes even more obvious with larger apertures and larger fractal dimensions we speculate that the main reason for this is that the correction effect of roughness on the permeability model is too heavy when decomposing the fracture profile with only a few segments however if a fracture is decomposed into a large number of segments the ratio of a fracture aperture to fracture length for a segment is too large to form a stable flow konzuk and kueper 2004 oron and berkowitz 1998 moreover the fracture segments are too short to fit their original fractal dimensions when dividing the profile with larger numbers of segments hence based on the requirements for the formation of stable flow and the reynolds approximation in self affine fractures mourzenko et al 1995 and while honouring the fracture topography oron and berkowitz 1998 fractures should not be divided into an excessive number of segments for 1 n 20 m n exhibits an approximately decreasing trend with the increase of n however there is no beneficial relationship expressed by the elementary functions between them and for this reason a bessel function was adopted to find the root for the appropriate sn as shown in fig 5 11 72068 1 188015 0 005463 and 1 933717 are the values of l b e 3 calculated from the corresponding lbm simulations with the cubic law for each aperture and fractal dimension we obtained the corresponding sn for a rough fracture it was then found that an approximate power law relationship exists between the dimensionless vertical aperture bv l and sn which is shown in fig 6 to obtain a scale independent relationship we divided the fractal vertical aperture uniformly by the length l of the sample size in fig 6 the power exponent is 0 9367 which can be approximated as 1 for this reason we show the relationship between sn and l bv in the inset panel in fig 6 and found that sn is proportional to l bv with the coefficient 0 15908 from this relationship the number required to segment a fracture profile can be directly derived from the dimensionless vertical aperture i e the ratio of the vertical aperture to the length of a fracture medium combing eq 14 the cubic law and the relationship shown in fig 6 one can easily obtain the permeability of a 2d rough fracture the potential relationships between sn and other parameters were also explored as is known in addition to the intrinsic morphology of a surface profile the measured length of a fracture profile is also closely related to the measured scale using the optimisation algorithm we compared the dimensionless mean length la l with sn in fig 7 the excellent power law relationship shown directly demonstrates the accuracy of the optimisation algorithm and indirectly indicates the suitability of sn the power exponent was also approximated to 1 therefore we plotted the dimensionless mean length with 1 sn in the inset of fig 7 a furthermore from the nearly linear relationships between 1 sn and la l and between sn and l bv one can speculate that there should also be a nearly linear relationship between la and bv because both of the two parameters have the dimensional unit of length we plotted them in fig 7 b the coefficient is 5 9914 which verifies the relationships among sn la l and l bv 4 3 experimental validation of the modified lcl to validate the accuracy of the modified lcl we used data from previous experiments ju et al 2013 zhang 2016 water flow experiments were conducted on the rough fractures generated by the w m function with fixed thicknesses apertures and different fractal dimensions the cross section of the fractures was a rectangle whose two sides were the thickness and the aperture as illustrated in fig 8 where 2a and 2b represent the thickness and the aperture of the fracture model respectively from fig 8 it can be seen that the 2d fracture fluid flow experiments always have a thickness parameter which causes the fluid flow through pseudo 3d fractures to differ from that in 2d fractures lee et al 2015 lee et al 2017 and zhang 2016 also showed that these kinds of fractures with finite thicknesses differ from 2d fractures where the fracture is implicitly assumed to be infinite in one direction moreover their simulation results indicated that the velocity distribution in the rectangular cross section may be approximated as an ellipse therefore experimental data should be carefully processed before being used for comparison with analytical figures for this reason it is important to understand the velocity distribution in a rectangular cross section of a fracture tube as shown in fig 8 chakraborty 2008 gave a variation of the exact solution of fluid flow velocity in a rectangular cross section graetz 1882 greenhill 1881 in which the velocity at the four solid boundaries was equal to zero the solution can be expressed in the form 20 u x y 16 a 2 π 3 1 μ d p d z n 0 1 n 2 n 1 3 1 cosh 2 n 1 π y 2 a cosh 2 n 1 π ε a 2 a cos 2 n 1 π x 2 a in eq 20 ε is the aspect ratio and 2a and 2b are the length of the cross section in major x and minor y axes respectively from eq 20 the flow rate q area f along the rectangle can be evaluated by integrating the velocity over the cross section while the unit width flow rate of an infinite width fracture with an aperture 2b is q line i 2b 3 1 12μ dp dz for a 2a width area the flow rate is q area i q line i 2a the ratio of q area i to q area f is denoted as ra and ra should be 1 because of the limit of zero velocity boundaries for q area f meanwhile the flow rate q line f along the short axis in the centre of the rectangle can be easily obtained from the corresponding integration the ratio of q line i to q line f is then denoted as rb similarly rb should also be 1 a rectangle with an extremely small ε can be regarded as an approximately infinite parallel fracture then both ra and rb should be approximately one to verify ra rb and eq 20 we set two small ε values to compare ra and rb when ε 0 2 we found that ra 1 1442 and rb 1 0008 while for ε 0 01 ra and ra are 1 0063 and 1 respectively the thickness of the apertures used by zhang 2016 was 5 mm and the apertures of the fractures were 2 27 2 38 2 55 2 96 and 3 81 mm using the same calculations we found the corresponding ra values to be 1 39972 1 42691 1 47076 1 58590 and 1 86919 respectively from these figures we know that if the thickness of a fracture is fixed with the increase in the aperture ra tends to increase from the data examined and relationships found infinite flow rates q area i through rectangular cross sectional fractures were calculated by multiplying the experimental data with their corresponding ra values which are listed in table 1 the permeabilities of fractures were calculated via darcy s law and q area i which represents the permeability of a fracture of infinite thickness or the permeability of a slice parallel to the y z plane as shown in fig 8 thus the permeability was denoted as κ exp which could be used to verify the proposed 2d permeability model in this validation the same digital fracture profiles as those of zhang 2016 were generated using the same fractal dimensions and the same w m function subsequently these profiles were duplicated and transformed with the same vertical apertures table 1 as performed by zhang 2016 and then the two matched profiles and the space between them shaped the fracture from the relationship shown in fig 6 we calculated sn for each fracture subsequently the fractures were segmented into sn smaller parts using the cuckoo search algorithm with the sampling parameters as described the standard deviation in height local aperture and the measured length of each small segment were counted to evaluate the permeability using eq 14 the permeability was denoted as κ lcl both κ lcl and κ exp are plotted in fig 9 against different fractal dimensions from fig 9 it can be seen that κ lcl is quite close to κ exp for different fractal dimensions from 1 1 to 1 4 for fractures with df 1 5 there exists an obvious deviation between the two permeabilities this phenomenon is consistent with our expectations since it has already been found that the proposed lcl can cause considerable errors for large fractal dimensions fortunately most of the fracture surfaces had fractal dimensions much smaller than 1 5 berkowitz 2002 mandelbrot 1982 this indicates that the modified lcl is sufficient for predicting the permeability of 2d rough fractures furthermore the comparison of permeability for df 1 1 1 4 is shown in the inset of fig 9 with the black line representing y x the proposed lcl permeability model was validated with the experimental data as all of the values plotted in the figure are close to the y x line the goodness of fit between the experimental permeabilities and the modified lcl permeabilities implies that the proposed model which takes into consideration the hurst exponent and roughness is effective for evaluating the permeability of 2d rough fractures or infinitely stretched fractures similar to that shown in fig 8 the errors in physical experiments and the approximations of sn and trend lines result in small deviations between the calculated and experimental data yet it is still reasonable for one to believe that the effects of the hurst exponent on fluid flow should be considered when evaluating the permeability of rough fractures it is noted that in their flow experiments a few researchers e g ju et al 2013 and zhang 2016 also used a straight rectangular cross sectional fracture with an aperture of 2 mm vertical aperture of 2 18 mm and a thickness of 5 mm the tested flow rate was 47 9 10 7 m3 s which can be applied to calculate the permeability with its corresponding ra and 1 μ dp dz the permeability of the fracture model was 2 93635 10 7 m2 while the cubic law permeability was 3 3333 10 7 m2 the deviation between them is most likely caused by the improper use of 1 μ dp dz the μ of water under 20 c and 10 c are 0 00102 pa s and 0 001308 pa s respectively the values of μ and dp used in their study were 0 001 pa s and 0 05 pa those parameters along with the thickness may have induced errors in the estimates of permeability moreover the component of the fluid i e water would likely also have influenced the dynamic viscosity by considering all of the possible effects of the test results we corrected the term dp μ by setting the experimental permeability and the cubic law permeability as equal for a parallel plate fracture obtaining the corrected dp μ with the new dp μ and q area i the permeabilities for rough fractures were calculated and compared 5 conclusions in this study self affine rough fractures generated by the w m function were used to study the fluid flow through single fractures mainly via numerical simulations an optimised segmentation strategy using the cuckoo search algorithm was applied to decompose fracture profiles into smaller parts based on the segmentation strategy and the effects of roughness a modified lcl was proposed accounting for the roughness and the hurst exponents of fracture profiles thereafter with the lbm simulation results of fluid flow through rough fractures the number needed to decompose a fracture into multiple small fractures was determined finally the newly proposed permeability model and the number needed to divide a fracture were validated by physical hydraulic experiments during this process a method of transforming pseudo 3d experimental data into 2d values was defined from this study several conclusions were drawn 1 the optimised segmentation strategy is reasonable for segmenting fracture profiles as excellent power law relationships can be seen between the number of segments n and several statistical parameters such as the minimum value of the total vertical distance tvd the total length of all of the segments lm and the standard deviation σ of the distances from all of the points on the original profile to the divided curves 2 the number of segments n is a crucial parameter for applying the modified lcl with different values of n different m n values were obtained using the modified lcl for a fracture with the relationship between m n and the corresponding lbm permeability the necessary dividing number sn can be determined additionally it was found that there is an inverse and proportional relationship between sn and the dimensionless aperture i e the ratio of the vertical aperture bv to the fracture medium length l such that sn 0 15908l bv this relationship appears to indicate that a larger sn is required to divide the fracture profile when the fracture medium is longer and a larger sn is also required to decompose the fracture profile when the aperture is narrower moreover it is a dimensionless relationship so one can obtain the sn from bv l without considering the units of the apertures 3 based on the comparisons of water permeability between experimental data and the values calculated from the proposed lcl the new permeability model which considers the roughness and hurst exponent and the number of segments required to divide fracture profiles from the dimensionless aperture is valid therefore the hurst exponents of fractures should be regarded as extra parameters of roughness to describe the effects of roughness on the permeability of rough fractures here we describe the influence of fracture roughness from the viewpoint of an optimised segmentation strategy numerical simulations and experimental validation the comparison between analytical values calculated using the proposed methods and experimental values indicates that the new permeability model is suitable for small scale rough fractures and that the hurst exponents of fractures have non negligible effects on evaluations of permeability more importantly it was found that the number of segments needed to divide a fracture when using the modified lcl can be easily determined from the dimensionless aperture alone the inversely proportional relationship between the dimensionless aperture and the dividing steps not only determines the number needed to divide a fracture but also provides insights into the formation conditions of steady flows funding we wish to acknowledge the financial support provided by the national natural science foundation of china grant nos 51 674 251 51 727 807 and 51 374 213 the state key research development program of china grant no 2016yfc0600705 the national major project for science and technology grant no 2017zx05049003 006 and the innovation teams of ten thousand talents program sponsored by the ministry of science and technology of china grant no 2016ra4067 conflict of interest none appendix a to verify the accuracy of the lbm simulation program we use the classical cubic law to validate the simulation of fluid flow in a smooth parallel flat by lbms straight fractures with a series of apertures were synthesised for the lbm simulations the compared permeabilities obtained using the two methods the classical cubic law and darcy s law calculated from the simulation results by lbms are shown in fig a1 the permeabilities estimated via the two methods had nearly the same value as the inset panel shows the velocity distribution after unit transformation of lbm simulation results for a straight channel length 0 1 m 500 lu with a pressure difference 0 9 10 5 pa a dynamic viscosity 0 001 pa s and an aperture of 0 004 m fits well with the analytical velocity distribution derived from transformed parameters and hydrodynamics the red scatter in the inset represents the relative errors between the lbm velocity and the analytical velocity appendix b at the beginning of the cuckoo search optimisation initial solutions were randomly sampled from the solution space b 1 x i j 0 rand k min j k max j i 1 2 n b where rand k min j k max j indicates a uniform random number from the minimum k min j to the maximum k max j of the jth value space j is in 1 nd nd is the dimension of the problem and nb is the number of broods solutions the updating of position x i is expressed as following b 2 x i k 1 x i k α l e vy β where k represents the kth iteration and α is the corresponding step size the operational symbol represents entry wise multiplication as the name suggests lévy β is the lévy flight distribution that is expressed as lévy β t 1 β with t as a random variable to simplify implementation lévy β was rewritten as b 3 l e vy β ϕ η θ 1 β ϕ γ 1 β sin π β 2 γ 1 β 2 β 2 β 1 2 1 β where the suggested value for β 1 5 yang and deb 2009 and both η and θ obey a normal distribution combining eqs b 2 and b 3 the updating rule may be rewritten as follows b 4 x i k 1 x i k α ϕ η θ 1 β x i k x g where x g is the current best solution in addition to being updated by better solutions the solutions are also updated for the discovery probability pa by hosts thus the updating rule is redefined as follows b 5 x i k 1 x i k r x m k x n k if p p a x i k otherwise where r is a scale factor that ranges from 0 to 1 m and n are random indices and p is a random number from zero to one based on quantum a mechanism cheung et al 2016 derived an inhomogeneous search strategy to improve the searching ability of the algorithm they added a new parameter the mean position x of all the nests in one iteration to update the rule such that b 6 x 1 n b i 1 n b x i cheung et al 2016 then rewrote the equation in the following form b 7 x i k 1 x i k α ϕ η θ 1 β x i k g k sr 2 3 1 x i k l x k x i k sr 1 3 2 3 x i k e g k x i k otherwise where l δ ln 1 η e δ exp η and sr is a random number in the range 0 1 as in the study of cheung et al 2016 the quantum trick l was replaced by e to guarantee that no large fluctuations occurred around the global best candidate nest in this study 
