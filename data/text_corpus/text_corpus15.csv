index,text
75,floods affect many aspects of our lives and our improved understanding of the processes driving the historical changes in this natural hazard can provide basic information to enhance our preparation and mitigation efforts here we analyze 3 885 streamgages across the conterminous united states and attribute the inter annual variability in annual maximum discharge to precipitation and temperature this is accomplished by first developing gamma regression models to describe the seasonal maximum discharge in terms of basin averaged precipitation temperature and antecedent wetness i e the basin averaged precipitation for the season prior to the one of interest and used as a proxy for antecedent soil moisture conditions these seasonal models are then mixed through a monte carlo approach to obtain the annual maximum discharge distribution despite its simplicity our results show that the developed statistical attribution approach can describe very well the inter annual variability in annual maximum discharge across the conterminous united states keywords attribution annual maximum discharge inter annual variability statistical modeling monte carlo simulation data availability data will be made available on request 1 introduction milly et al 2008 noted that stationarity is dead and cannot be assumed in modern design and management of hydraulic structures sparking a very interesting scientific debate around the issue e g villarini et al 2009 hirsch 2011 lins and cohn 2011 montanari and koutsoyiannis 2014 serinaldi and kilsby 2015 it is clear that stationarity and the idea that the distribution of the variable of interest does not change over time are more of a working assumption e g hirsch 2011 lins and cohn 2011 and that its validity is not really justified when working with long centennial to millennial records e g vogel and kroll 2020 possible violations of the validity of the stationarity assumption are associated with both the variability of the climate system whether natural or human induced and anthropogenic modifications of the river catchments much of the emphasis in the literature has been on the detection of abrupt and or slowly varying changes in flood peaks using non parametric tests e g pettitt test mann kendall test sen s slope estimator oftentimes the detection of changes was elusive for instance archfield et al 2016 performed an extensive evaluation of different flood characteristics across the united states and found limited evidence and a lack of spatial coherence in terms of trends in flood magnitude hodgkins et al 2019 also examined annual peak flow trends for streamgages in the conterminous united states concluding that the trend magnitude and direction vary strongly by region and basin type e g minimally altered regulated and urbanized other studies were conducted at the global scale still highlighting difficulties in detecting changes e g do et al 2017 slater et al 2021b the discussion so far has focused on the detection of the presence of possible changes without discussing how to attribute these changes once detected without attribution it is difficult to make meaningful statements about what the future may look like compared to the past villarini and wasko 2021 once an abrupt or slowly varying change is detected it is important to understand what caused the change the attribution of changes in flood distributions has hitherto received little attention as written in merz et al 2012 the current state of flood trend attribution is poor they highlighted that most of the studies focus on detection with the attribution part playing a negligible and secondary role they classify attribution efforts in soft and hard the soft attribution is speculative in nature based on their point of view hard attribution on the other hand requires three main attributes including consistency between the detected change and the physical mechanism s considered inconsistency with other drivers and a statement about our confidence in the attribution more broadly we can think of ongoing efforts to range from more qualitative and speculative to more quantitative and rigorous there has been a growing effort dedicated to understanding the causes of the detected changes villarini and slater 2017 and slater et al 2021a provide an extensive discussion and references about attribution in particular slater et al 2021a describe attribution efforts as belonging to two broad categories empirical and simulation based the former generally includes regression based efforts is less computational expensive than approaches that model directly the physical processes but it also suffers from many of the limitations commonly encountered in models of this kind e g correlation versus causation more complex relationships among predictors and processes the simulation based attribution approach on the other hand takes the lead from the use of mathematical governing equations that describe the physical processes at play the strength of this approach lies in being rooted in processes at the expenses of very large computational costs moreover ryberg 2022 and barth et al 2022 discussed and applied the multiple working hypotheses method to attribute the detected trends and change points in annual peak streamflow data across the united states one element to consider is that attribution follows detection we attribute a change only if detected at a given significance level however what do we do if no change is detected what does it mean for the estimation of future design values should we assume that stationarity should be the default assumption as mentioned in villarini and wasko 2021 the lack of a detected change should not be interpreted as a lack of a signal but rather as a lack of evidence to conclude that a change is present here we take a different view from the standard detection attribution approach rather than attributing changes only when they exist we want to understand the drivers responsible for the inter annual variability in annual maximum discharge and this is the goal of this study the advantage of this approach over trying to explain trends or shifts is that it does not require an a priori detection of a change moreover it allows capturing patterns that are more complex than only slowly varying or abrupt ones including multi decadal variability and the lack of a statistically significant change because our effort covers thousands of locations across a large area like the conterminous united states we will follow an empirical approach and develop regression models that describe the inter annual variability in annual maximum peak discharge in light of climate related variables the paper is organized as follows section 2 summarizes the data and provides an overview of the regression models used to describe the annual maximum records section 3 presents the results followed by section 4 where we summarize the main findings and conclude the paper 2 data and methodology we consider united states geological survey usgs streamgages distributed across the conterminous united states for which the basin boundary information is available from usgs streamgage nhdplus version 1 basins 2011 we select 3 885 streamgages with at least 30 years of mean daily discharge observations during the 1980 2019 period we consider a year and each season as complete if they have at least 90 completeness in terms of daily observations fig 1 the 5th and 95th percentiles of their catchment sizes range from 44 km2 to 25 794 km2 with a median value of 886 km2 inset plot in fig 1 we focus on mean daily discharge because their time series are longer than the available instantaneous discharge records and allow the modeling of seasonal maxima which would not be possible by using the annual instantaneous peak maxima however one caveat to consider is that the peaks based on daily values are smaller than their instantaneous counterparts especially for small basins we further classify the streamgages into reference and non reference gages according to the geospatial attributes of gages for evaluating streamflow version ii gages ii dataset falcone 2011 to examine whether there are differences in the models performance between these two groups the reference status indicates that a given watershed has been minimally disturbed and subject to minimal hydrologic alterations while the non reference gages represent a group of basins that have been affected by human activities such as flow regulation and changes in land use for each year we can extract the largest daily value at a given basin and develop statistical models that capture the changes over time in the annual maximum mean daily discharge while this approach is straightforward it does not reflect the different physical processes that may have driven the individual extreme e g snowmelt tropical cyclones e g hirschboeck 1987 smith et al 2011 barth et al 2017 villarini and slater 2017 here we address this issue by developing statistical models for the seasonal maximum mean daily discharge using the meteorological season winter december to february spring march to may summer june to august and fall september to november as a proxy for different flood generating mechanisms because it is the most commonly used definition worldwide therefore our response variable at a given location is the seasonal maximum mean daily discharge in terms of predictors we consider precipitation the major driver of flooding through direct indirect runoff and temperature affecting the magnitude of floods by changing rainfall patterns e g wasko and sharma 2015 soil moisture e g wasko and sharma 2017 and the timing and the amount of snowmelt and evapotranspiration e g trenberth et al 2003 stewart 2009 as fundamental drivers of extreme discharge this approach is also consistent with neri et al 2019 who modeled the seasonal frequency of flooding across the central united states and found that these climate variables played the largest role in explaining the seasonal variability in flood counts we use the observed monthly total precipitation mm and monthly mean temperature c from the parameter elevation regression on independent slopes model prism dataset a gridded product with a resolution of 4 km daly et al 2002 2008 to employ these variables as predictors of the seasonal maximum mean daily discharge series i e predictand we calculate basin and season averaged precipitation and temperature time series for all 3 885 basins additionally we include the basin and season averaged precipitation and temperature prior to the season of interest lagged predictors e g winter precipitation is used to represent the antecedent wetness conditions for the spring as proxies for other processes such as antecedent wetness snow accumulation and evapotranspiration e g kam and sheffield 2016 slater and villarini 2017 in terms of statistical models we use the generalized additive model in location scale and shape gamlss rigby and stasinopoulos 2005 to model the inter annual variability in seasonal maximum mean daily discharge series gamlss is a flexible modeling framework that allows modeling the parameters of several different distributions as linear nonlinear or nonparametric smoothing functions of explanatory variables based on previous studies we use the gamma distribution for flood discharge modeling e g slater and villarini 2017 slater et al 2019 the probability density function pdf of the gamma distribution can be expressed using location μ and scale σ parameters as follows rigby et al 2019 1 f y μ σ y 1 σ 2 1 e y σ 2 μ σ 2 μ 1 σ 2 γ 1 σ 2 for y 0 μ 0 and σ 0 where μ is the mean and μ2σ2 is the variance of the distribution if discharge observations include zero values we use the zero adjusted gamma zaga distribution to account for the probability of zero values the pdf of the zaga distribution can be expressed as follows 2 f y μ σ ν ν if y 0 1 ν y 1 σ 2 1 e y σ 2 μ σ 2 μ 1 σ 2 γ 1 σ 2 if y 0 where ν is the probability of zero 1 ν μ is the mean and 1 ν μ2 ν σ2 is the variance of the distribution to consider the attribution of seasonal maximum discharge to precipitation and temperature i e major drivers of extreme flooding the distribution parameters are modeled using four basin and season averaged drivers i e predictors covariates eq 1 seasonal average of basin averaged monthly total precipitation in the concurrent season concurrent precipitation pcon eq 2 seasonal average of basin averaged monthly mean temperature in the concurrent season concurrent temperature tcon eq 3 seasonal average of basin averaged monthly total precipitation in the previous season lagged precipitation plag and eq 4 seasonal average of basin averaged monthly mean temperature in the previous season lagged temperature tlag the location and scale parameters of the full model are defined using a logarithmic link function to ensure positive values as follows 3 l o g μ μ 0 μ 1 p c o n μ 2 t c o n μ 3 p l a g μ 4 t l a g 4 l o g σ σ 0 σ 1 p c o n σ 2 t c o n σ 3 p l a g σ 4 t l a g when the zaga distribution is applied the ν parameter is additionally modeled as a function of concurrent covariates using a logit link function to ensure the range of 0 ν 1 as follows 5 l o g ν 1 ν ν 0 ν 1 p c o n ν 2 t c o n we consider all possible linear combinations of predictors in each parameter and we fit models from 1949 to 2019 start year depends on data availability and select the best one based on schwarz bayesian criterion sbc schwarz 1978 once we have selected the best model for each season we combine seasonal models and generate the annual maximum mean daily discharge series through a monte carlo approach here we consider the period between september of the previous year and august of the following year to obtain the annual maxima for a given year the simulation experiments are conducted as follows 1 generate the seasonal maximum mean daily discharge value for ith year q i s m s e a s o n from the fitted gamma or zaga distribution q i 1 s m s o n q i s m s o n q i 1 s m s o n q i s m d j f q i 1 s m d j f q i 2 s m d j f q i s m m a m q i 1 s m m a m q i 2 s m m a m q i s m j j a q i 1 s m j j a q i 2 s m j j a 2 select the annual maximum value in the ith year q i a m q i a m max q i 1 s m s o n q i s m d j f q i s m m a m q i s m j j a q i 1 a m max q i s m s o n q i 1 s m d j f q i 1 s m m a m q i 1 s m j j a q i 2 a m max q i 1 s m s o n q i 2 s m d j f q i 2 s m m a m q i 2 s m j j a 3 iterate steps eqs 1 2 1 000 times and obtain different percentiles e g 5th 25th 50th median 75th and 95th of the annual maximum mean daily discharge series this approach has the advantage of allowing for the mixture of different seasonal maxima in a way consistent with the observational records i e it does not a priori establish a fixed mixing ratio but rather allows for the sampling of the mixture of the four gamma distributions based on the seasonal models to evaluate how well the selected model describes the year to year changes in flood extremes we compute the spearman correlation coefficient between observations and the median of the modeled seasonal and annual maximum mean daily discharge series 3 results and discussion we fit the models and select the best one according to the sbc for every season at all 3 885 sites as an example fig 2 shows the model fits for the sacramento river above bend bridge near red bluff california usgs 11377100 despite the simplicity of these models they can capture well the year to year variability in the seasonal maxima fig 2 panels a d moreover fig 2e shows that the good performance at the seasonal level translates in good performance at the annual scale by using the monte carlo approach described in section 2 as we expand the perspective from one site to the scale of the contiguous united states the overall good performance translates to the 3 885 sites considered here fig 3 for the fall season the fitted models reproduce well the observations with the median correlation coefficients between the observations and the median of the fitted distribution of 0 79 our fitted models perform better in the western and eastern united states compared to the intermountain west encompassing the rocky mountains top left panel in fig 3 the winter season exhibits a similar pattern although generally showing slightly lower performance median correlation coefficient of 0 7 for the spring and summer seasons the fitted models show an overall good performance across the conterminous united states fig 3 bottom panels based on the boxplots in fig 3 75 of all streamgages have a correlation coefficient around 0 6 suggesting that these simple statistical models can describe well the inter annual variability in seasonal maximum mean daily discharge based on the results in fig 4 most of the annual maxima tend to occur in the winter and spring seasons with lower percentages in the summer and the smallest contributions in the fall in the winter the performance of our models increases as the seasonal contribution to the annual maxima increases in the spring the performance of the models is generally good regardless of how many peaks occur while it decreases slightly in the summer as the percentage contributions become larger in the fall the performance of the models is generally good when up to 30 of the annual maxima are recorded in the september november months and decreases for the few sites in which the percentage values are larger than 30 the results in fig 4 indicate that these statistical models perform well especially for those seasons that contribute the most to the flood peak seasonality the results so far only tell us that these models can describe the observational records but not what the physical processes responsible for these good performances are we summarize the covariates selected for each seasonal model in figs 5 7 in terms of the magnitude of seasonal peak discharge fig 5 concurrent and lagged precipitations are consistently selected and these predictors are positively related to discharge maxima across the united states regardless of the season first and second columns in fig 5 concurrent precipitation is selected in the fall almost everywhere while this is not the case in the winter particularly in the northern great plains and the upper midwest because of snow accumulations and frozen rivers in the spring these regions where much of the flood discharge is tied to snowmelt runoff show that lagged precipitation is more important than the concurrent one in the summer lagged rather than concurrent precipitation is more often selected in the mountainous regions in the west including the sierra nevada and the rockies because of snowmelt runoff e g mccabe and clark 2005 these results indicate that seasonal precipitation is the main driver to control the magnitude of seasonal peak discharge despite the regional and seasonal difference of its physical mechanism on the other hand temperature exhibits a more variable behavior third and last columns in fig 5 concurrent temperature e g winter temperature as predictor for the statistical model for winter maximum discharge is positively related to seasonal discharge in fall and winter particularly in the u s west coast and the upper midwest in winter spring and summer temperature negatively contributes to discharge maxima mainly in the central and eastern regions see also neri et al 2019 for similar results these findings suggest that temperature plays a more regional and season dependent role by different physical mechanisms compared to precipitation in fall and winter warmer temperatures can induce snowmelt runoff resulting in large and extreme floods when occurring in tandem with rainfalls this is particularly true in the western mountains the upper midwest and northeast where rain on snow events occurs frequently e g li et al 2019 on the contrary warmer temperatures decrease the magnitude of flood discharges by reducing snowpack which can vary regionally and seasonally depending on elevation and the timing of snowmelt e g stewart 2009 pradhanang et al 2013 warmer temperatures can also reduce flood discharge by causing higher evapotranspiration and drier soil moisture conditions e g berghuijs et al 2016 our results are generally consistent with the role of temperature through different physical processes depending on season and region in terms of the drivers controlling the variability of seasonal maximum discharge fig 6 the spatial coherence is smaller compared to what observed for the μ parameter for instance concurrent and lagged precipitation variables are selected at 13 5 27 6 of the stations and generally have a negative relationship first and second columns in fig 6 this is a much smaller percentage compared to 52 7 93 1 for the mean i e μ parameter the concurrent and lagged temperature variables are selected at 7 9 15 3 of the stations with coefficients that are both positive and negative third and last columns in fig 6 in the case of the stations where seasonal maximum discharge includes zeroes the concurrent precipitation is negatively related to the probability of zero discharge occurrence at 27 51 of the stations fig 7 not surprisingly precipitation has a negative coefficient indicating that the larger the basin averaged precipitation the smaller the probability of zero flow in summary these results provide supporting evidence that our statistical framework is suitable to attribute the observed changes in peak discharge to precipitation and temperature building on the good results in fig 3 we use a monte carlo approach to combine the four seasonal distributions as described in section 2 the first step is to ensure that the seasonality in the annual maximum peak records is captured by our sampling technique as shown in fig 8 our proposed approach can reproduce the seasonality of flooding very well lending confidence to its suitability for the modeling of the annual maxima not only is the seasonality captured but also the inter annual variability of the annual maximum daily discharge fig 9 top panel with the median correlation coefficients between the observations and the median of the simulated annual maxima of 0 68 with 95 75 of all simulated series having a correlation coefficient larger than 0 41 0 58 these results indicate that our statistical attribution framework allows modeling the inter annual variability in annual maximum discharge series well by capturing the different flood processes given the emphasis on the climate drivers we explore where there are differences in model performance between reference and non reference basins as shown in the boxplots in fig 9 the model performance for these two groups is almost identical with the median correlation coefficients between observations and statistical model of 0 65 and 0 68 for reference and non reference streamgages respectively moreover the overall distributions of the correlation coefficients are almost identical we also examined the role of reservoirs by stratifying the results for the non reference sites depending on the density of dams and major dams based on the gages ii metadata without finding any clear pattern fig 10 overall these findings indicate that climate system can explain much of the inter annual variability in annual maximum discharge across the conterminous united states this major role of the climate system for extreme flood variability is consistent with ficklin et al 2018 who showed that there are no significant differences between trends of reference and human modified streamflow characteristics we also examine whether there is a dependence of the performance of the statistical models on catchment size fig 11 when considering all 3 885 sites together there is no significant correlation between model performance and basin size when stratifying the sites into reference and non reference sites both groups show a very weak dependence on drainage area pearson correlation coefficients of 0 09 and 0 03 for reference and non reference sites respectively suggesting that the model performance is good across the range of basin sizes considered here 4 summary and conclusion we have developed a statistical framework to describe the inter annual variability in annual maximum mean daily discharge we first modeled seasonal maximum mean daily discharge as a proxy for different flood generating mechanisms and then combined the seasonal results via a monte carlo approach we applied our approach to 3 885 usgs streamgages across the conterminous united states the main findings of this study can be summarized as follows 1 we selected simple basin averaged predictors that we thought as playing a major role in driving the flood response across the conterminous united states more specifically we used concurrent and lagged basin and season averaged precipitation and temperature as predictors covariates we found that our seasonal models were able to describe well the seasonal maximum mean daily discharge with a median correlation coefficient between the observations and the median of the fitted distribution around 0 7 or higher 2 basin and season averaged precipitation plays an important role in the magnitude of seasonal peak discharge consistently across the united states regardless of seasons while the temperature shows regional and seasonal dependent behaviors 3 the mixture of seasonal models led to a good performance in reproducing the observed year to year variability in annual maximum mean daily discharge with the median correlation coefficient between observations and the median of the simulated distribution of 0 68 and with 95 of all streamgages having a correlation coefficient larger than 0 41 4 there is no significant difference of the overall distributions of the correlation coefficients between reference and non reference streamgages highlighting the role of the climate system in driving the observed inter annual variability in annual maximum discharge while the detection of trends or shifts in flood extremes is still a scientifically interesting issue the lack of an attribution of these changes to physical processes limits our capability of extending these changes into the future villarini and wasko 2021 the simple extrapolation of past trends into the future should be done with extreme care and avoided if at all possible because of the large uncertainties associated with this approach and its lack of physical understanding e g cooley 2013 serinaldi and kilsby 2015 here we found that much of the changes in annual maximum peak discharge can be attributed to changes in the climate system for both reference and non reference sites it is worth underscoring that we are not claiming that human modifications of the basins do not necessarily play a role but our results suggest that if important these alterations have a more muted impact compared to what exerted by the climate system moreover we use the seasons as proxies for different distinct flood generating mechanisms assuming that the daily maxima within a season are caused by the same flood agent while we believe that this assumption is appropriate at the scale of our analyses and supported by the good results obtained other approaches could be used to model the flood peaks according to different processes based on the results of our analyses we believe that despite its simplicity our approach can be used to provide basic information to assess future changes in flood frequency across the conterminous united states credit authorship contribution statement hanbeen kim methodology software formal analysis investigation data curation writing original draft writing review editing visualization gabriele villarini conceptualization methodology formal analysis investigation writing original draft writing review editing visualization supervision project administration funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was supported in part by the usace institute for water resources the comments by three anonymous reviewers are gratefully acknowledged 
75,floods affect many aspects of our lives and our improved understanding of the processes driving the historical changes in this natural hazard can provide basic information to enhance our preparation and mitigation efforts here we analyze 3 885 streamgages across the conterminous united states and attribute the inter annual variability in annual maximum discharge to precipitation and temperature this is accomplished by first developing gamma regression models to describe the seasonal maximum discharge in terms of basin averaged precipitation temperature and antecedent wetness i e the basin averaged precipitation for the season prior to the one of interest and used as a proxy for antecedent soil moisture conditions these seasonal models are then mixed through a monte carlo approach to obtain the annual maximum discharge distribution despite its simplicity our results show that the developed statistical attribution approach can describe very well the inter annual variability in annual maximum discharge across the conterminous united states keywords attribution annual maximum discharge inter annual variability statistical modeling monte carlo simulation data availability data will be made available on request 1 introduction milly et al 2008 noted that stationarity is dead and cannot be assumed in modern design and management of hydraulic structures sparking a very interesting scientific debate around the issue e g villarini et al 2009 hirsch 2011 lins and cohn 2011 montanari and koutsoyiannis 2014 serinaldi and kilsby 2015 it is clear that stationarity and the idea that the distribution of the variable of interest does not change over time are more of a working assumption e g hirsch 2011 lins and cohn 2011 and that its validity is not really justified when working with long centennial to millennial records e g vogel and kroll 2020 possible violations of the validity of the stationarity assumption are associated with both the variability of the climate system whether natural or human induced and anthropogenic modifications of the river catchments much of the emphasis in the literature has been on the detection of abrupt and or slowly varying changes in flood peaks using non parametric tests e g pettitt test mann kendall test sen s slope estimator oftentimes the detection of changes was elusive for instance archfield et al 2016 performed an extensive evaluation of different flood characteristics across the united states and found limited evidence and a lack of spatial coherence in terms of trends in flood magnitude hodgkins et al 2019 also examined annual peak flow trends for streamgages in the conterminous united states concluding that the trend magnitude and direction vary strongly by region and basin type e g minimally altered regulated and urbanized other studies were conducted at the global scale still highlighting difficulties in detecting changes e g do et al 2017 slater et al 2021b the discussion so far has focused on the detection of the presence of possible changes without discussing how to attribute these changes once detected without attribution it is difficult to make meaningful statements about what the future may look like compared to the past villarini and wasko 2021 once an abrupt or slowly varying change is detected it is important to understand what caused the change the attribution of changes in flood distributions has hitherto received little attention as written in merz et al 2012 the current state of flood trend attribution is poor they highlighted that most of the studies focus on detection with the attribution part playing a negligible and secondary role they classify attribution efforts in soft and hard the soft attribution is speculative in nature based on their point of view hard attribution on the other hand requires three main attributes including consistency between the detected change and the physical mechanism s considered inconsistency with other drivers and a statement about our confidence in the attribution more broadly we can think of ongoing efforts to range from more qualitative and speculative to more quantitative and rigorous there has been a growing effort dedicated to understanding the causes of the detected changes villarini and slater 2017 and slater et al 2021a provide an extensive discussion and references about attribution in particular slater et al 2021a describe attribution efforts as belonging to two broad categories empirical and simulation based the former generally includes regression based efforts is less computational expensive than approaches that model directly the physical processes but it also suffers from many of the limitations commonly encountered in models of this kind e g correlation versus causation more complex relationships among predictors and processes the simulation based attribution approach on the other hand takes the lead from the use of mathematical governing equations that describe the physical processes at play the strength of this approach lies in being rooted in processes at the expenses of very large computational costs moreover ryberg 2022 and barth et al 2022 discussed and applied the multiple working hypotheses method to attribute the detected trends and change points in annual peak streamflow data across the united states one element to consider is that attribution follows detection we attribute a change only if detected at a given significance level however what do we do if no change is detected what does it mean for the estimation of future design values should we assume that stationarity should be the default assumption as mentioned in villarini and wasko 2021 the lack of a detected change should not be interpreted as a lack of a signal but rather as a lack of evidence to conclude that a change is present here we take a different view from the standard detection attribution approach rather than attributing changes only when they exist we want to understand the drivers responsible for the inter annual variability in annual maximum discharge and this is the goal of this study the advantage of this approach over trying to explain trends or shifts is that it does not require an a priori detection of a change moreover it allows capturing patterns that are more complex than only slowly varying or abrupt ones including multi decadal variability and the lack of a statistically significant change because our effort covers thousands of locations across a large area like the conterminous united states we will follow an empirical approach and develop regression models that describe the inter annual variability in annual maximum peak discharge in light of climate related variables the paper is organized as follows section 2 summarizes the data and provides an overview of the regression models used to describe the annual maximum records section 3 presents the results followed by section 4 where we summarize the main findings and conclude the paper 2 data and methodology we consider united states geological survey usgs streamgages distributed across the conterminous united states for which the basin boundary information is available from usgs streamgage nhdplus version 1 basins 2011 we select 3 885 streamgages with at least 30 years of mean daily discharge observations during the 1980 2019 period we consider a year and each season as complete if they have at least 90 completeness in terms of daily observations fig 1 the 5th and 95th percentiles of their catchment sizes range from 44 km2 to 25 794 km2 with a median value of 886 km2 inset plot in fig 1 we focus on mean daily discharge because their time series are longer than the available instantaneous discharge records and allow the modeling of seasonal maxima which would not be possible by using the annual instantaneous peak maxima however one caveat to consider is that the peaks based on daily values are smaller than their instantaneous counterparts especially for small basins we further classify the streamgages into reference and non reference gages according to the geospatial attributes of gages for evaluating streamflow version ii gages ii dataset falcone 2011 to examine whether there are differences in the models performance between these two groups the reference status indicates that a given watershed has been minimally disturbed and subject to minimal hydrologic alterations while the non reference gages represent a group of basins that have been affected by human activities such as flow regulation and changes in land use for each year we can extract the largest daily value at a given basin and develop statistical models that capture the changes over time in the annual maximum mean daily discharge while this approach is straightforward it does not reflect the different physical processes that may have driven the individual extreme e g snowmelt tropical cyclones e g hirschboeck 1987 smith et al 2011 barth et al 2017 villarini and slater 2017 here we address this issue by developing statistical models for the seasonal maximum mean daily discharge using the meteorological season winter december to february spring march to may summer june to august and fall september to november as a proxy for different flood generating mechanisms because it is the most commonly used definition worldwide therefore our response variable at a given location is the seasonal maximum mean daily discharge in terms of predictors we consider precipitation the major driver of flooding through direct indirect runoff and temperature affecting the magnitude of floods by changing rainfall patterns e g wasko and sharma 2015 soil moisture e g wasko and sharma 2017 and the timing and the amount of snowmelt and evapotranspiration e g trenberth et al 2003 stewart 2009 as fundamental drivers of extreme discharge this approach is also consistent with neri et al 2019 who modeled the seasonal frequency of flooding across the central united states and found that these climate variables played the largest role in explaining the seasonal variability in flood counts we use the observed monthly total precipitation mm and monthly mean temperature c from the parameter elevation regression on independent slopes model prism dataset a gridded product with a resolution of 4 km daly et al 2002 2008 to employ these variables as predictors of the seasonal maximum mean daily discharge series i e predictand we calculate basin and season averaged precipitation and temperature time series for all 3 885 basins additionally we include the basin and season averaged precipitation and temperature prior to the season of interest lagged predictors e g winter precipitation is used to represent the antecedent wetness conditions for the spring as proxies for other processes such as antecedent wetness snow accumulation and evapotranspiration e g kam and sheffield 2016 slater and villarini 2017 in terms of statistical models we use the generalized additive model in location scale and shape gamlss rigby and stasinopoulos 2005 to model the inter annual variability in seasonal maximum mean daily discharge series gamlss is a flexible modeling framework that allows modeling the parameters of several different distributions as linear nonlinear or nonparametric smoothing functions of explanatory variables based on previous studies we use the gamma distribution for flood discharge modeling e g slater and villarini 2017 slater et al 2019 the probability density function pdf of the gamma distribution can be expressed using location μ and scale σ parameters as follows rigby et al 2019 1 f y μ σ y 1 σ 2 1 e y σ 2 μ σ 2 μ 1 σ 2 γ 1 σ 2 for y 0 μ 0 and σ 0 where μ is the mean and μ2σ2 is the variance of the distribution if discharge observations include zero values we use the zero adjusted gamma zaga distribution to account for the probability of zero values the pdf of the zaga distribution can be expressed as follows 2 f y μ σ ν ν if y 0 1 ν y 1 σ 2 1 e y σ 2 μ σ 2 μ 1 σ 2 γ 1 σ 2 if y 0 where ν is the probability of zero 1 ν μ is the mean and 1 ν μ2 ν σ2 is the variance of the distribution to consider the attribution of seasonal maximum discharge to precipitation and temperature i e major drivers of extreme flooding the distribution parameters are modeled using four basin and season averaged drivers i e predictors covariates eq 1 seasonal average of basin averaged monthly total precipitation in the concurrent season concurrent precipitation pcon eq 2 seasonal average of basin averaged monthly mean temperature in the concurrent season concurrent temperature tcon eq 3 seasonal average of basin averaged monthly total precipitation in the previous season lagged precipitation plag and eq 4 seasonal average of basin averaged monthly mean temperature in the previous season lagged temperature tlag the location and scale parameters of the full model are defined using a logarithmic link function to ensure positive values as follows 3 l o g μ μ 0 μ 1 p c o n μ 2 t c o n μ 3 p l a g μ 4 t l a g 4 l o g σ σ 0 σ 1 p c o n σ 2 t c o n σ 3 p l a g σ 4 t l a g when the zaga distribution is applied the ν parameter is additionally modeled as a function of concurrent covariates using a logit link function to ensure the range of 0 ν 1 as follows 5 l o g ν 1 ν ν 0 ν 1 p c o n ν 2 t c o n we consider all possible linear combinations of predictors in each parameter and we fit models from 1949 to 2019 start year depends on data availability and select the best one based on schwarz bayesian criterion sbc schwarz 1978 once we have selected the best model for each season we combine seasonal models and generate the annual maximum mean daily discharge series through a monte carlo approach here we consider the period between september of the previous year and august of the following year to obtain the annual maxima for a given year the simulation experiments are conducted as follows 1 generate the seasonal maximum mean daily discharge value for ith year q i s m s e a s o n from the fitted gamma or zaga distribution q i 1 s m s o n q i s m s o n q i 1 s m s o n q i s m d j f q i 1 s m d j f q i 2 s m d j f q i s m m a m q i 1 s m m a m q i 2 s m m a m q i s m j j a q i 1 s m j j a q i 2 s m j j a 2 select the annual maximum value in the ith year q i a m q i a m max q i 1 s m s o n q i s m d j f q i s m m a m q i s m j j a q i 1 a m max q i s m s o n q i 1 s m d j f q i 1 s m m a m q i 1 s m j j a q i 2 a m max q i 1 s m s o n q i 2 s m d j f q i 2 s m m a m q i 2 s m j j a 3 iterate steps eqs 1 2 1 000 times and obtain different percentiles e g 5th 25th 50th median 75th and 95th of the annual maximum mean daily discharge series this approach has the advantage of allowing for the mixture of different seasonal maxima in a way consistent with the observational records i e it does not a priori establish a fixed mixing ratio but rather allows for the sampling of the mixture of the four gamma distributions based on the seasonal models to evaluate how well the selected model describes the year to year changes in flood extremes we compute the spearman correlation coefficient between observations and the median of the modeled seasonal and annual maximum mean daily discharge series 3 results and discussion we fit the models and select the best one according to the sbc for every season at all 3 885 sites as an example fig 2 shows the model fits for the sacramento river above bend bridge near red bluff california usgs 11377100 despite the simplicity of these models they can capture well the year to year variability in the seasonal maxima fig 2 panels a d moreover fig 2e shows that the good performance at the seasonal level translates in good performance at the annual scale by using the monte carlo approach described in section 2 as we expand the perspective from one site to the scale of the contiguous united states the overall good performance translates to the 3 885 sites considered here fig 3 for the fall season the fitted models reproduce well the observations with the median correlation coefficients between the observations and the median of the fitted distribution of 0 79 our fitted models perform better in the western and eastern united states compared to the intermountain west encompassing the rocky mountains top left panel in fig 3 the winter season exhibits a similar pattern although generally showing slightly lower performance median correlation coefficient of 0 7 for the spring and summer seasons the fitted models show an overall good performance across the conterminous united states fig 3 bottom panels based on the boxplots in fig 3 75 of all streamgages have a correlation coefficient around 0 6 suggesting that these simple statistical models can describe well the inter annual variability in seasonal maximum mean daily discharge based on the results in fig 4 most of the annual maxima tend to occur in the winter and spring seasons with lower percentages in the summer and the smallest contributions in the fall in the winter the performance of our models increases as the seasonal contribution to the annual maxima increases in the spring the performance of the models is generally good regardless of how many peaks occur while it decreases slightly in the summer as the percentage contributions become larger in the fall the performance of the models is generally good when up to 30 of the annual maxima are recorded in the september november months and decreases for the few sites in which the percentage values are larger than 30 the results in fig 4 indicate that these statistical models perform well especially for those seasons that contribute the most to the flood peak seasonality the results so far only tell us that these models can describe the observational records but not what the physical processes responsible for these good performances are we summarize the covariates selected for each seasonal model in figs 5 7 in terms of the magnitude of seasonal peak discharge fig 5 concurrent and lagged precipitations are consistently selected and these predictors are positively related to discharge maxima across the united states regardless of the season first and second columns in fig 5 concurrent precipitation is selected in the fall almost everywhere while this is not the case in the winter particularly in the northern great plains and the upper midwest because of snow accumulations and frozen rivers in the spring these regions where much of the flood discharge is tied to snowmelt runoff show that lagged precipitation is more important than the concurrent one in the summer lagged rather than concurrent precipitation is more often selected in the mountainous regions in the west including the sierra nevada and the rockies because of snowmelt runoff e g mccabe and clark 2005 these results indicate that seasonal precipitation is the main driver to control the magnitude of seasonal peak discharge despite the regional and seasonal difference of its physical mechanism on the other hand temperature exhibits a more variable behavior third and last columns in fig 5 concurrent temperature e g winter temperature as predictor for the statistical model for winter maximum discharge is positively related to seasonal discharge in fall and winter particularly in the u s west coast and the upper midwest in winter spring and summer temperature negatively contributes to discharge maxima mainly in the central and eastern regions see also neri et al 2019 for similar results these findings suggest that temperature plays a more regional and season dependent role by different physical mechanisms compared to precipitation in fall and winter warmer temperatures can induce snowmelt runoff resulting in large and extreme floods when occurring in tandem with rainfalls this is particularly true in the western mountains the upper midwest and northeast where rain on snow events occurs frequently e g li et al 2019 on the contrary warmer temperatures decrease the magnitude of flood discharges by reducing snowpack which can vary regionally and seasonally depending on elevation and the timing of snowmelt e g stewart 2009 pradhanang et al 2013 warmer temperatures can also reduce flood discharge by causing higher evapotranspiration and drier soil moisture conditions e g berghuijs et al 2016 our results are generally consistent with the role of temperature through different physical processes depending on season and region in terms of the drivers controlling the variability of seasonal maximum discharge fig 6 the spatial coherence is smaller compared to what observed for the μ parameter for instance concurrent and lagged precipitation variables are selected at 13 5 27 6 of the stations and generally have a negative relationship first and second columns in fig 6 this is a much smaller percentage compared to 52 7 93 1 for the mean i e μ parameter the concurrent and lagged temperature variables are selected at 7 9 15 3 of the stations with coefficients that are both positive and negative third and last columns in fig 6 in the case of the stations where seasonal maximum discharge includes zeroes the concurrent precipitation is negatively related to the probability of zero discharge occurrence at 27 51 of the stations fig 7 not surprisingly precipitation has a negative coefficient indicating that the larger the basin averaged precipitation the smaller the probability of zero flow in summary these results provide supporting evidence that our statistical framework is suitable to attribute the observed changes in peak discharge to precipitation and temperature building on the good results in fig 3 we use a monte carlo approach to combine the four seasonal distributions as described in section 2 the first step is to ensure that the seasonality in the annual maximum peak records is captured by our sampling technique as shown in fig 8 our proposed approach can reproduce the seasonality of flooding very well lending confidence to its suitability for the modeling of the annual maxima not only is the seasonality captured but also the inter annual variability of the annual maximum daily discharge fig 9 top panel with the median correlation coefficients between the observations and the median of the simulated annual maxima of 0 68 with 95 75 of all simulated series having a correlation coefficient larger than 0 41 0 58 these results indicate that our statistical attribution framework allows modeling the inter annual variability in annual maximum discharge series well by capturing the different flood processes given the emphasis on the climate drivers we explore where there are differences in model performance between reference and non reference basins as shown in the boxplots in fig 9 the model performance for these two groups is almost identical with the median correlation coefficients between observations and statistical model of 0 65 and 0 68 for reference and non reference streamgages respectively moreover the overall distributions of the correlation coefficients are almost identical we also examined the role of reservoirs by stratifying the results for the non reference sites depending on the density of dams and major dams based on the gages ii metadata without finding any clear pattern fig 10 overall these findings indicate that climate system can explain much of the inter annual variability in annual maximum discharge across the conterminous united states this major role of the climate system for extreme flood variability is consistent with ficklin et al 2018 who showed that there are no significant differences between trends of reference and human modified streamflow characteristics we also examine whether there is a dependence of the performance of the statistical models on catchment size fig 11 when considering all 3 885 sites together there is no significant correlation between model performance and basin size when stratifying the sites into reference and non reference sites both groups show a very weak dependence on drainage area pearson correlation coefficients of 0 09 and 0 03 for reference and non reference sites respectively suggesting that the model performance is good across the range of basin sizes considered here 4 summary and conclusion we have developed a statistical framework to describe the inter annual variability in annual maximum mean daily discharge we first modeled seasonal maximum mean daily discharge as a proxy for different flood generating mechanisms and then combined the seasonal results via a monte carlo approach we applied our approach to 3 885 usgs streamgages across the conterminous united states the main findings of this study can be summarized as follows 1 we selected simple basin averaged predictors that we thought as playing a major role in driving the flood response across the conterminous united states more specifically we used concurrent and lagged basin and season averaged precipitation and temperature as predictors covariates we found that our seasonal models were able to describe well the seasonal maximum mean daily discharge with a median correlation coefficient between the observations and the median of the fitted distribution around 0 7 or higher 2 basin and season averaged precipitation plays an important role in the magnitude of seasonal peak discharge consistently across the united states regardless of seasons while the temperature shows regional and seasonal dependent behaviors 3 the mixture of seasonal models led to a good performance in reproducing the observed year to year variability in annual maximum mean daily discharge with the median correlation coefficient between observations and the median of the simulated distribution of 0 68 and with 95 of all streamgages having a correlation coefficient larger than 0 41 4 there is no significant difference of the overall distributions of the correlation coefficients between reference and non reference streamgages highlighting the role of the climate system in driving the observed inter annual variability in annual maximum discharge while the detection of trends or shifts in flood extremes is still a scientifically interesting issue the lack of an attribution of these changes to physical processes limits our capability of extending these changes into the future villarini and wasko 2021 the simple extrapolation of past trends into the future should be done with extreme care and avoided if at all possible because of the large uncertainties associated with this approach and its lack of physical understanding e g cooley 2013 serinaldi and kilsby 2015 here we found that much of the changes in annual maximum peak discharge can be attributed to changes in the climate system for both reference and non reference sites it is worth underscoring that we are not claiming that human modifications of the basins do not necessarily play a role but our results suggest that if important these alterations have a more muted impact compared to what exerted by the climate system moreover we use the seasons as proxies for different distinct flood generating mechanisms assuming that the daily maxima within a season are caused by the same flood agent while we believe that this assumption is appropriate at the scale of our analyses and supported by the good results obtained other approaches could be used to model the flood peaks according to different processes based on the results of our analyses we believe that despite its simplicity our approach can be used to provide basic information to assess future changes in flood frequency across the conterminous united states credit authorship contribution statement hanbeen kim methodology software formal analysis investigation data curation writing original draft writing review editing visualization gabriele villarini conceptualization methodology formal analysis investigation writing original draft writing review editing visualization supervision project administration funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was supported in part by the usace institute for water resources the comments by three anonymous reviewers are gratefully acknowledged 
76,real world flood simulators often use first order finite volume fv1 solvers of the shallow water equations with efficiency enhancements exploiting parallelisation on graphical processing units gpus and the use of static adaptivity on fixed grids a second order discontinuous galerkin dg2 solver greatly increases the accuracy in the predictions on uniform grids where it is comparatively costly to run but its practical utility as an alternative for flood simulations using static adaptivity is not yet assessed this is also the case for the dynamic adaptivity using the multiresolution analysis mra of the haar wavelet hw scaling fv1 piecewise constant solutions hwfv1 and of the smoother multiwavelets mws that scales dg2 piecewise planar solutions mwdg2 to adapt the resolution of their grids over time therefore dynamic mwdg2 and hwfv1 adaptivity is newly explored for practical real world simulations to find out when they yield better predictions than static dg2 and fv1 adaptivity a new gpu implementation is proposed to include dynamic mwdg2 adaptivity to also assess how far gpu parallelisation renders its runtime practically feasible dynamic and static adaptivity are assessed for three tests involving slow gradual to rapid flood flows with analyses of their predictive accuracy and computational costs with reference to uniform grid dg2 simulations at the finest resolution of the digital elevation model dem findings suggest favouring static fv1 adaptivity for long duration simulations of slowly to gradually propagating floods and dynamic mwdg2 adaptivity to simulate events driven by rapidly propagating flows on the gpu dynamic mwdg2 adaptivity is faster than uniform dg2 leading to a higher speedup ratio with higher reduction in the elements on its initial fixed grid keywords flood modelling fv1 and dg2 solvers multiresolution analysis gpu parallelisation static vs dynamic adaptivity practical recommendations data availability the data is already openly availabe on 10 5281 zenodo 5047565 or in sharifian and kesserwani 2021 1 introduction flood modelling is essential to understand flood flow dynamics and define mitigation strategies to support decision making in flood risk management spiekermann et al 2015 with the increasing availability of accurate raster based terrain datasets two dimensional 2d flood models have gained popularity for complex field scale flood inundation modelling hunter et al 2008 teng et al 2017 nkwunonwo et al 2020 raster based flood models use a numerical solver on a uniform resolution grid defined by a given raster formatted digital elevation model dem file flood models used to support real world flood simulations have often been based on solving the full shallow water equations in a first order finite volume fv1 godunov type numerical solver on exploiting parallelisation on graphical processing units gpus xia et al 2019 echeverribar et al 2019 zhao and liang 2022 and or deploying static adaptivity of the grid resolution bmt 2018 hou et al 2018 vacondio et al 2017 in order to reduce runtime costs bellos et al 2020 saksena et al 2020 guo et al 2020 on a uniform grid raster based flood models based on the second order discontinuous galerkin dg2 solver can be built by increasing the local formulation s complexity of the fv1 solver shaw et al 2021 leading to greater quality predictions than finite volume industrial models ayog et al 2021 the locality of the dg2 solver formulation should also make it a better candidate to increase the quality of the flood flow predictions within standard static adaptivity but this is yet to be investigated for real field simulations including the efficient generation of the resolution scales for the fixed grid from a thorough analysis of the topographical features within the dem alternatively modern multi wavelet based solvers with dynamic adaptivity were formulated based upon the multiresolution analysis mra of the haar wavelet hw or the smoother multiwavelets mws to adapt the grid resolution in time driven by scaled piecewise constant fv1 numerical representations of the flow solutions and the dem or smoother piecewise planar dg2 representations respectively kesserwani et al 2019 kesserwani and sharifian 2020 these combinations will be termed as the hwfv1 and mwdg2 respectively in essence dynamic mwdg2 respectively hwfv1 adaptivity involves the mra process to generate the grid every time step and while using high and low pass filter formulae to rigorously scale and reconstruct the numerical representations across disparate resolutions the multi wavelet based dynamic adaptivity of the mra process is practical as it needs only one user specified parameter an error threshold ε to select the scales of grid resolution moreover it uses the rigorous filter formulae to reconstruct intrinsically well balanced solution limits to integrate the fluxes across heterogeneously sized adjacent elements as robust as they are integrated in the uniform grid solver counterparts haleem et al 2015 gerhard et al 2015 kesserwani et al 2015 caviedes voullième and kesserwani 2015 caviedes voullième et al 2020 the serial implementation of dynamic mwdg2 respectively hwfv1 adaptivity for hydraulic modelling on the central processing unit cpu was already devised and extensively validated for a series of synthetic and laboratory scale test cases mostly dominated by wet areas kesserwani et al 2019 kesserwani and sharifian 2020 the findings identify an ε value in the magnitude of 10 3 with dynamic mwdg2 respectively hwfv1 adaptivity to preserve the predictive accuracy of the dg2 solver respectively fv1 run on the finest uniform grid at a competitively affordable runtime namely less or close to that of the fv1 solver run on the finest uniform grid kesserwani and sharifian 2020 in serial the efficiency gain of the dynamic mwdg2 adaptivity arises from its mra of mws operating on piecewise planar representations which causes more aggressive yet sensible grid coarsening than with the mra of hw that operates on piecewise planar representations within dynamic hwfv1 adaptivity however dynamic mwdg2 respectively hwfv1 adaptivity must apply the mra process every time step and this entails severe overhead costs in a serial implementation in particular for real world simulations where the flooding inundates large dry areas for such simulations dynamic mwdg2 and hwfv1adaptivity has yet to be evaluated when reworked to run in parallel on the gpu to assess the extent of their runtime affordability for practical flood modelling applications on the other hand the findings make a clear case for using the mra of mws instead of that of hw to efficiently generate a fixed grid with sensibly selected resolution scales kesserwani et al 2019 kesserwani and sharifian 2020 in this context the mra process is applied only once to analyse the features of the dem with such a static adaptivity the rigorous filter formulae of the multi wavelet based dynamic adaptivity are no longer applicable therefore only extrinsic well balanced solution limits can be reconstructed across the heterogeneously sized adjacent elements based on heuristic averaging on a graded grid as in conventional adaptive grid refinement methods kesserwani and liang 2012a liang et al 2015 previous works suggested that static adaptivity with a finite volume solver is suited to simulate slow to gradual fluvial flood flow propagation hou et al 2018 but have rarely assessed the ability of the multi wavelet based mra to generate the fixed grid within this scope the work of özgen xian et al 2020 only explored the mra of hw to generate unstructured triangular grids over which a zero inertia flow solver was adapted to simulate overland flow reporting moderate speedups also the authors concluded that pre processing the dem data into topographic slopes for use as input to the mra of hw significantly improve the sensibility of the predicted resolution scales for the fixed grid özgen xian et al 2020 this suggests that there is a benefit from using the mra of mws as a better alternative to generate the fixed grid this will be demonstrated in this work for static dg2 and fv1 adaptivity alongside with dynamic mwdg2 and hwfv1 adaptivity the rest of the paper is organised as follows section 2 overviews the dynamic mwdg2 and hwfv1 adaptivity that uses the mra process to analyse and scale their numerical solutions dg2 piecewise planar and fv1 piecewise constant and update the grid over time section 2 1 it follows with the description of the static dg2 and fv1 adaptivity section 2 2 and of the gpu implementation of the mra process to enable gpu resident dynamic mwdg2 and hwfv1 adaptivity section 2 3 in section 3 the multi wavelet based dynamic mwdg2 and hwfv1 adaptivity is assessed against the standard static dg2 and fv1 adaptivity for three field scale test cases featured by slow gradual and rapidly propagating flood flows with reference to finest uniform grid dg2 simulations the assessments include demonstrating the merit of the mra of mws to generate the fixed grid for static dg2 and fv1 adaptivity that is also the initial grid for dynamic mwdg2 and hwfv1 adaptivity section 4 provides an efficiency analysis in terms of runtime cost and percentage of reduction in the number of elements with respect to the finest uniform grid to identify when static or dynamic adaptivity can be used as an alternative to uniform grid flood simulators section 5 concludes on the extent of practical utility of static and dynamical adaptivity in relation to the properties of the flood simulation project 2 computational methods flow solvers with dynamic and static adaptivity are explored as alternatives to their established uniform grid dg2 and fv1 solvers shaw et al 2021 the solvers are formulated to provide numerical solutions of the depth averaged shallow water equations in a conservative form eq 1 1 t u x f u y g u s b u s f u represents a partial derivative operator u x y t h qx qy t is the vector of flow variables at time t and location x y which contains the water depth h m and the discharges per unit width qx hu m2s 1 and qy hv m2s 1 involving the depth averaged horizontal velocities u ms 1 and v ms 1 respectively f q x q x 2 h 1 0 5 g h 2 q x q y h 1 t and g q y q x q y h 1 q y 2 h 1 0 5 g h 2 t are the components of the physical flux and g ms 2 denotes the gravity acceleration constant s b 0 gh x z gh y z t is the topography source term vector including the bed slopes and the friction source term vector incorporating friction effects is denote by s f 0 c f u u 2 v 2 c f v u 2 v 2 t where c f g n m 2 h 1 3 is a friction function in which nm m1 6 refers to the manning s roughness parameter eq 1 is numerically solved on a 2d spatial domain of dimension lx ly the domain is meshed using a grid made of non overlapping heterogeneously sized square elements the finest resolution r on this grid will be taken to match the raster formatted digital elevation model dem a grid element at resolution r is shown in fig 1 indexed by i j and centred at points x i j y i j two categories of solvers are presented multi wavelet based dynamic mwdg2 and hwfv1 adaptivity scaling their numerical solutions and grid resolutions in time and standard static dg2 and fv1 adaptivity adapting their numerical solutions on a fixed grid dynamic mwdg2 adaptivity uses the mra of mws to decompose analyse and assemble piecewise planar dg2 solutions on a dynamically adaptive grid section 2 1 from dynamic mwdg2 adaptivity that of hwfv1 can be obtained by degrading its formulation to use the hw to decompose analyse and assemble piecewise constant fv1 solutions section 2 1 4 the cpu implementation of dynamic mwdg2 and hwfv1 adaptivity can be found in kesserwani et al 2019 and kesserwani and sharifian 2020 with an exhaustive analysis of their performance for academic and laboratory scale test cases as the aim is to assess the potential of dynamic mwdg2 and hwfv1 adaptivity for complex real world flood simulation only the multi wavelet based mra process is briefly overviewed next in section 2 1 multi wavelet based dynamic adaptivity will be compared with standard static adaptivity for three realistic test cases section 3 the initial grid for launching dynamic mwdg2 and hwfv1 adaptivity will be the same as the fixed grid used with static dg2 and fv1 adaptivity section 3 1 this fixed grid will be generated by first applying the mra of mws to the dem raster file section 2 1 2 and then ensuring that it is graded section 2 2 1 the descriptions of the dg2 and fv1 solvers formulation for a uniform resolution grid can be found in shaw et al 2021 therefore only their solution adaptation procedure on the fixed grid will be described for a portion with an interface shared by heterogeneously sized adjacent elements section 2 2 a new gpu implementation of dynamic mwdg2 and hwfv1 adaptivity is proposed to make them run in parallel on the gpu section 2 3 and boost speedups with respect to the cpu counterparts section 4 2 1 dynamic mwdg2 adaptivity for dynamic mwdg2 adaptivity the discrete vector of flow variables u h x y t and the discrete scalar topography zh x y are shaped as local piecewise planar solutions over each element starting from the finest uniform grid at resolution r fig 1 this is done within the framework of a simplified dg2 formulation which spans piecewise planar flow solutions and topography function on a 2d truncated tensor product of the scaled legendre basis ϕ to which mws bases are adapted kesserwani and sharifian 2020 with a truncated tensor product basis the simplified dg2 formulation is slope decoupled kesserwani et al 2018 and therefore operates on a similar stencil to that of godunov type finite volume flood models ayog et al 2021 on the slope decoupled stencil the simplified dg2 formulation evaluates the fluxes at the centres of the elements interfaces where it must ensure continuity of the topography function to avoid spurious momentum errors at wet dry fronts crossing steep bed slopes a desired property to achieve within dynamic mwdg2 adaptivity caviedes voullième et al 2020 the simplified dg2 formulation was demonstrated to deliver as second order accurate predictions as the classical dg2 formalism based on a full tensor product stencil leading to a speedup of 2 6 times moreover it achieves superior predictions than finite volume godunov type flood models for real field flood modelling without activating local slope limiting and this boosts the speedups to 5 times ayog et al 2021 maximising efficiency for flood modelling applications shaw et al 2021 as shown in eq 2 u h x y t contains an equation of a plane per physical component each defined by three coefficients of an average denoted by subscript 0 and of two slopes in the x and y directions denoted by subscripts 1x and 1y respectively 2 u h x y t u i j ϕ h i j 0 h i j 1 x h i j 1 y q x i j 0 q x i j 1 x q x i j 1 y q y i j 0 q y i j 1 x q y i j 1 y 1 2 3 x x i j r 2 3 y y i j r in eq 2 stands for scalar product and therefore u i j is a matrix containing the flow coefficients defining the piecewise planar solutions for the three components of the flow vector the piecewise planar representation for zh x y can be produced in a similar way 3 z h x y z i j ϕ z i j 0 z i j 1 x z i j 1 y 1 2 3 x x i j r 2 3 y y i j r in eq 3 z i j is the vector of the topography coefficients for defining a piecewise planar representation the topography coefficients do not vary in time and should be carefully initialised from a dem raster file section 2 1 1 the time dependant flow coefficients u i j can be initialised component wise in a similar way from the initial conditions for the flow variables converted into raster files 2 1 1 initialisation of coefficients on the finest uniform grid the initialisation procedure is based on ensuring that the piecewise planar topography representation zh x y remains continuous at the interface centres of an element denoted by n s e and w in fig 1 as demonstrated in kesserwani et al 2018 ensuring continuity at these interface centres is key to robustly evaluate the discrete fluxes and topography source terms which respects the well balanced property with the presence of wet dry fronts across steep bed slopes such a piecewise planar topography projection can be constructed from a dem by first taking the dem raster values to be located at the nw ne sw and se vertices fig 1 and then aggregating an average value z i j n 0 5 z i j nw z i j ne at n and similarly z i j e z i j s and z i j w values at s e and w from these values the desired average z i j 0 and slope coefficients z i j 1x and z i j 1y can be defined 4a z i j 0 1 2 z i j e z i j w 1 2 z i j n z i j s 1 4 z i j ne z i j nw z i j se z i j sw 4b z i j 1 x 1 2 3 z i j e z i j w 1 4 3 z i j ne z i j nw z i j se z i j sw 4c z i j 1 y 1 2 3 z i j n z i j s 1 4 3 z i j ne z i j se z i j nw z i j sw even when there are no initial flow conditions eq 4 is also applied to initialise zero valued vectors for h i j 0 h i j 1x h i j 1y qx i j 0 qx i j 1x qx i j 1y and qy i j 0 qy i j 1x qy i j 1y to initialise the matrix of flow coefficients u i j eq 2 in what follows for simplicity of presentation the mra process which is responsible for dynamic adaptivity will be described component wise using the scalar s h qx qy z to represent the physical components of the flow vector time variant and the topography time invariant 2 1 2 mra of mws to generate the 2d adaptive grid the mra of mws starts from the finest uniform grid at resolution r using the initial coefficients s fine s i j 0 s i j 1x s i j 1y attributed to a maximum resolution level l leading to the finest resolution of the dem now the finest uniform grid at resolution level l contains 2 l m 2 l n elements m lx 2 l r and n ly 2 l r below which there are uniform grids with subsequently lower resolution levels of l 1 1 0 that forms a hierarchy with the coarsest uniform grid at resolution level 0 made of m n elements i e a single element in this work with m n 1 the mra process first applies the encoding operation to extract and analyse the flow vector and topography coefficients at the grids with lower resolution levels l 1 1 0 to then apply the decoding operation to derive the relevant coefficients that will form the 2d adaptive grid from the coefficients on the grid at resolution level l s fine the encoding operation can be applied to produce the coefficients on the grid with twice coarser resolution at level l 1 s coarse and to also extract their vectors of the details d h coarse d v coarse and d d coarse living at resolution level l 1 these vectors of details belong to the basis of mws ψ and represent the encoded difference between the scaling basis ϕ at resolution level l and its parent basis at resolution level l 1 e g as shown in fig 1 in shaw et al 2020 therefore d h coarse d v coarse and d d coarse encapsulate the encoded differences in coefficients between the two resolution levels l and l 1 along the horizontal vertical and diagonal directions respectively namely s coarse d h coarse d v coarse and d d coarse on a parent element at resolution level l 1 can be encoded from its four coefficients of their child elements at resolution level l using the formulae described below in eq 5 5a s coarse h h 0 s 0 fine h h 1 s 2 fine h h 2 s 1 fine h h 3 s 3 fine 5b d h coarse g a 0 s 0 fine g a 1 s 2 fine g a 2 s 1 fine g a 3 s 3 fine 5c d v coarse g b 0 s 0 fine g b 1 s 2 fine g b 2 s 1 fine g b 3 s 3 fine 5d d d coarse g c 0 s 0 fine g c 1 s 2 fine g c 2 s 1 fine g c 3 s 3 fine the subscripts of the coefficients s fine refer to the indexing of the four child elements at level l with reference to their parent element at level l 1 hh 0 1 2 3 are 3 3 low pass filter matrices and ga 0 1 2 3 gb 0 1 2 3 and gc 0 1 2 3 are 3 3 high pass filter matrices these filters were derived from the relationship linking ψ to ϕ at resolution level l and its father basis at resolution level l 1 the explicit expressions of these filters are available in kesserwani and sharifian 2020 including the ones for hwfv1 the formulae in eq 5 are generalisable to any two subsequent resolution levels kesserwani and sharifian 2020 by recursive application of eq 5 s fine at resolution level l is now compressed into a series of details living on the hierarchy of uniform grids at subsequently lower resolution levels l 1 1 0 these details form a tree like structure and can be summed over the coefficients s coarse associated with the coarsest uniform grid resolution level 0 on this hierarchy the details extracted for all the physical components flow vector and topography are analysed all together these details become increasingly significant with increasing non smoothness in any of the physical features but remain small otherwise the time invariant details of the topography must be reconsidered with those extracted from the flow vector time variant to ensure that no coarsening in grid resolution is allowed beyond the resolution dictated by the dem the significance of all the details is measured by comparing their normalised magnitude to an error threshold parameter ε user specified for shallow flow modelling a value in the magnitude of ε 10 3 was identified appropriate with dynamic mwdg2 respectively hwfv1 adaptivity to preserve the predictive accuracy of the dg2 solver respectively fv1 run on the finest uniform grid resolution r at a competitively affordable runtime namely less or close to that of the fv1 solver run on the finest uniform grid resolution r kesserwani and sharifian 2020 for realistic simulations involving real dems with largely dry portions using stricter ε values lead to a marginal improvement in the accuracy kesserwani and sharifian 2020 but would introduce too much rise in the runtime cost up to making dynamic adaptivity impracticable a normalised details magnitude of any component s h qx qy z is computed as d d max 1 s 0 the term d denotes the maximum of the magnitude of the three details along the horizontal vertical and diagonal directions and s 0 is the maximum of all the average coefficients available on the finest uniform grid at resolution level l the normalised details are computed for all the elements on the hierarchy of uniform grids with resolution levels l 1 0 details at elements where d ε are classified as significant and should be retained and such elements are flagged to produce their coefficients via decoding kesserwani and sharifian 2020 these elements will be referred to as leaf elements and are such that their details on the tree of details either stopped being significant or otherwise belong to the finest grid a schematic view of leaf elements on the hierarchy of grids can be found below in fig 4 as part of the gpu parallelisation section 2 3 to produce the leaf elements coefficients the process of decoding is applied for the tree of details all over the hierarchy of grids decoding starts from applying eq 6 to the coefficients and their encoded details on the coarsest uniform grid at resolution level 0 s coarse d h coarse d v coarse and d d coarse to create the coefficients of their four child elements on the grid at resolution level 1 s 0 fine s 1 fine s 2 fine and s 3 fine 6a s 0 fine h h 0 t z coarse g a 0 t d h coarse g b 0 t d v coarse g c 0 t d d coarse 6b s 2 fine h h 1 t z coarse g a 1 t d h coarse g b 1 t d v coarse g c 1 t d d coarse 6c s 1 fine h h 2 t z coarse g a 2 t d h coarse g b 2 t d v coarse g c 2 t d d coarse 6d s 3 fine h h 3 t z coarse g a 3 t d h coarse g b 3 t d v coarse g c 3 t d d coarse decoding is recursively applied in ascending order while adding up the retained details to create the coefficients on child elements kesserwani and sharifian 2020 the derived coefficients and the indices of their elements can finally be sorted and assembled on the 2d adaptive grid made of non overlapping elements involving various resolutions between r and 2 l r 2 1 3 time update of coefficients and of the 2d adaptive grid on the 2d adaptive grid the flow coefficients u i j at time level n should be updated to time level n 1 by a two stage runge kutta scheme involving discrete spatial dg2 operators kesserwani et al 2018 as shown in eq 7 the flow coefficients are updated at the wet elements which are detected before each time stage 7a u i j n 1 2 u i j n δ t l u n 7b u i j n 1 1 2 u i j n u i j n 1 2 δ t l u n 1 2 the time step δt is calculated according to the cfl stability condition using the maximum stable courant number of 0 33 cockburn and shu 2001 and l is a 3 3 matrix including the discrete spatial operator vectors l 0 l 1x and l 1y these local operators contain robust evaluation of the spatial fluxes and topography gradient terms to ensure the well balanced property with wet dry front treatments kesserwani and sharifian 2020 these include riemann flux evaluation at the four interface centres in fig 1 from the reconstructed limits of the piecewise planar solutions at both sides of each interface centre using the hll riemann solver which is one recommend choice kesserwani et al 2008 the friction source term s f is not explicitly included in l and should instead be integrated elementwise at the start of each time step as described in shaw et al 2021 the updated coefficients u i j n 1 are now available on the 2d adaptive grid assembled at the previous time level n the information in u i j n 1 i e s s 0 s 1x s 1y with s h qx qy z should now be used to regenerate a new 2d adaptive grid this can be done by reapplying mra of mws for adaptive grid generation section 2 1 2 after initialising zero details for the flow vector s coefficients s h qx qy at the elements in the hierarchy of grids that did not belong to the 2d adaptive grid at time level n kesserwani and sharifian 2020 2 1 4 degradation to dynamic hwfv1 adaptivity for dynamic hwfv1 adaptivity the discrete vector of flow variables u h x y t and the discrete scalar topography zh x y are shaped as local piecewise constant solutions over each element and the basis ϕ is a scalar equal to 1 each physical component of u h x y t takes the form of a flat plane that is defined by one coefficient 8 u h x y t u i j ϕ h i j 0 q x i j 0 q y i j 0 1 h i j 0 q x i j 0 q y i j 0 here u i j is a vector of flow coefficients and zh x y is represented in the same way as 9 z h x y z i j ϕ z i j 0 1 z i j 0 the initialisation of coefficients on the finest uniform grid only uses eq 4a then mra of hw is applied for the 2d adaptive grid generation in a similar manner considering simplified scalar expression for the high pass and low pass filters kesserwani and sharifian 2020 on the 2d adaptive grid the update of the coefficients is performed using a forward euler time stepping scheme and l only includes the l 0 operator eq 10 this operator is based on the fv1 spatial discretisation where the hll solver s riemann flux evaluations consider piecewise constant solution limits at the two sides of each interface centre 10 u i j n 1 u i j n δ t l u n the time step δt is calculated according to the same cfl stability condition as the dg2 solver but with the maximum stable courant number of 0 5 kesserwani and liang 2012b once u i j n 1 are produced the regeneration of the 2d adaptive grid is performed as with dynamic mwdg2 adaptivity section 2 1 3 within the dynamic mwdg2 and hwfv1 adaptivity the filter formulae eqs 5 and 6 are applied every time step within the mra process to reconstruct intrinsic well balanced solution limits for any matching resolution required across the heterogeneously sized adjacent elements the reconstruction procedure is generally applicable without grading fig 2 a the 2d adaptive grid kesserwani and sharifian 2020 2 2 static dg2 and fv1 adaptivity on a fixed graded grid static dg2 and fv1 adaptivity operates on a fixed or static grid on which elementwise update of the flow coefficients is achieved as described previously respectively via eqs 7 and 10 the 2d adaptive grid is thus generated once after applying the mra of mws only once to analyse the time invariant topography coefficients section 2 1 2 compared to the grid generated from using the mra of hw that generated from using the mra of mws sensibly boosts the resolution coarsening kesserwani et al 2019 kesserwani and sharifian 2020 and will be preferred to run the dg2 and fv1 solvers on a graded grid shown later in section 3 1 which ensures that no element is more than one resolution level finer or coarser than its neighbouring elements fig 2b the grading of the fixed grid is necessary within the static adaptivity as the mra process is switched off over time which makes the rigorous filter formulae not applicable 1 1 applying the rigorous filter formulae eqs 5 and 6 would lead to spurious freezing the fluxes in time across the interface as the details of the flow vector do not get updated over time after grading conventional adaptive grid refinement treatments can be applied to reconstruct extrinsic well balanced solution limits at both side of the interface separating the heterogeneously sized adjacent elements detailed next in section 2 2 1 2 2 1 averaging of solution limits across adjacent elements of different sizes without grading the grid could include adjacent elements of different sizes where the numerical solutions are more than one resolution level apart from each side of the elements interface an example is shown in fig 2a where the red elements are two resolution levels finer than the neighbouring blue element at both sides of the finer element interface centres precisely well balanced solution limits can be unproblematically evaluated to integrate the fluxes within the update steps eqs 7 or 10 and thereby ultimately update the flow coefficients at the finer interface elements however the challenge arises when updating the flow coefficients at the coarse interface element from its right side fig 2a there is no rigorous way to aggregate the local solution limits along the finer element interface into a precisely well balanced local solution limit at the coarse element interface centre with grading this challenge can be reduced to estimating a coarse resolution limit by heuristic averaging from the limits available at the centres of the finer interface elements from the right side following the common reported procedure in conventional adaptive grid refinement techniques borthwick et al 2000 popinet 2003 kesserwani and liang 2012a donat et al 2014 bmt 2018 ghazizadeh et al 2020 dunning et al 2020 for example as shown in fig 2b the required solution limit at the right side is averaged from the solution limits at the interface centres of the two finer elements yellow points this averaging is exact for flat piecewise constant solution representations as with the fv1 solver taking the same value along each of the small element interfaces including at the centres with uneven piecewise planar solution representations as with the dg2 solver the averaging is heuristic as it only considers the values at the centres of each of the small element interfaces any of which may be different than the other values along a small element interface the heuristic nature of the averaging process within the dg2 solver may manifest in local inaccuracies in the predictions when there is high variability in a flow variable shown in section 3 2 3 gpu parallelisation with dynamic adaptivity to effectively parallelise multi wavelet based dynamic adaptivity on the gpu ensuring coalesced memory access and avoiding warp divergence are essential nvidia 2021 in cuda programming data of the coefficients and details should reside in gpu memory that is accessed by threads or workers threads should access contiguous memory locations for coalescing and batches of 32 threads or warps must avoid the execution of differing instructions to avoid divergence these requirements are not difficult to achieve when parallelising fv1 and dg2 on a uniform grid with equally sized elements shaw et al 2021 similar can be said to the updates eqs 7 and 10 within dynamic hwfv1 and mwdg2 adaptivity as matching resolution representations is a priori ensured from the filter formulae eqs 5 and 6 therefore it suffices to describe how these requirements can be met for the mra process that is responsible for achieving the dynamic adaptivity every time step section 2 1 2 to do so the recursive operations featured in the mra process must be reworked namely to ensure coalescing during the encoding of details and the decoding of leaf elements data and to avoid warp divergence when identifying the indices of the leaf elements these will be described for a hierarchy of grids up to l 3 without loss of generality the algorithmic implementation of the mra process on the gpu is presented in chowdhury et al 2022 which is newly extended to encompass dynamic mwdg2 adaptivity coalescing has been ensured by spanning the hierarchy of grids using z order curves to continuously index all the elements living within the hierarchy for each grid in the hierarchy a z order curve is created by following the so called morton code of each grid element by first interleaving the bits of the indices x and y of the element in binary representation fig 3 a and then converting of the resulting bit interleaved index to decimal form as shown in fig 3b sagan 1994 bader 2013 baert et al 2013 chowdhury et al 2022 z order curves are created for every grid in the hierarchy starting from the coarsest to the finest resolution grid to end up with a continuous span of the element indices all over the hierarchy fig 3c with this span the coefficients and details needed for encoding and decoding are now resident in adjacent memory locations zoomed in portion in fig 3c although the leaf elements coefficients and indices are available on the hierarchy the coefficients must be fetched to assemble the adaptive grid in parallel on the gpu and this can only be achieved by simultaneous traversal of the tree of details simultaneous tree traversal has been achieved based on the algorithm presented by karras 2012 initially designed for computer graphic applications the algorithm is applied to simultaneously climb the tree of details after continuous indexing of z order curves as shown in fig 4 a the starting point is to launch as many threads as the number of elements on the finest uniform grid namely 23 23 64 threads the threads are tasked to start simultaneous traversal from the single element on the coarsest grid each thread attempts to climb to the element on the finest grid indexed with the decimal converted from the morton code fig 4a during the simultaneous traversal by checking against the tree of details a thread stops as soon as it reaches a leaf element and records its index in memory an example can be seen in the hierarchy in fig 4a 4b where a thread will attempt to reach the element with index 45 climbing along the elements with indices 0 2 11 45 to stop at the leaf element with index 45 and record it in memory in doing so warp divergence is avoided because adjacent threads perform similar traversals due to the continuous indexing of the z curves spanning the hierarchy of grids and many of the threads climb to the same leaf elements without reaching any element on the finest grid for example as indicated in fig 4a 4b four threads climb up the elements with indices 0 2 and 11 one by one to finally settle for the elements with indices 45 46 47 48 located on the finest grid in contrast sixteen threads settle for the leaf element with index 1 which does not belong to the finest grid each of them recording the same index 1 in memory and this results in duplicates after the parallel tree traversal an array of indices is recorded in memory including the duplicate indices shown in fig 4b these duplicate indices are then scrutinised by the threads to also identify and record the indices of the four elements neighbouring the leaf elements from the east west north and south for example the thread that has already recorded the leaf element with index 1 at the bottom right of the array of 16 elements with index 1 will then be tasked to record the indices of the leaf element s direct neighbours namely the indices 1 47 1 and 14 shown in fig 4b the indices of the four neighbour elements are also stored in memory in turn resulting in duplicates the recorded duplicate indices of the leaf elements and their four neighbours are then removed from memory using stream compaction billeter et al 2009 after compaction the remaining indices that are unique to the leaf elements relevant to form the 2d adaptive grid are identified together with those of their four neighbouring elements the leaf elements coefficients and indices are then used to fetch the 2d adaptive as shown in fig 4c on which elementwise update of the coefficients is applied this completes the process for dynamic hwfv1 adaptivity however another step remains needed to complete the process with dynamic mwdg2 adaptivity namely after the first runge kutta stage eq 7a to ensure that the coefficients at the leaf elements neighbours are also up to date prior to applying the second runge kutta stage eq 7b this can be achieved by re encoding the coefficients obtained after the first runge kutta stage arguably running dynamic adaptivity on the gpu comes at a price of storing in memory at all times the entire data arrays spanning the hierarchy of grids which could entail enormous memory load with increase in size of the domain area and or in the fineness in the dem resolution 3 results and discussion dynamic mwdg2 and hwfv1 adaptivity is benchmarked against static dg2 and fv1 adaptivity on the same fixed grid that is also used to start dynamic adaptivity section 3 1 the benchmarking is aimed to evaluate how far their simulated results are close to a reference dg2 simulation performed on a uniform grid using the finest dem resolution r uniform dg2 three field scale test cases are selected with a uniform manning roughness parameter involving initially dry areas the simulations with dynamic adaptivity used an ε 10 3 to adapt grid resolution over time based on the details of both the flow variables and the topography section 2 1 in all the simulations the maximum resolution level l is selected to match the resolution r of the dem the cpu based solvers were run on a 3 2ghz intel i7 8700 using a single cpu core while the gpu based solvers were run on an nvidia quadro rtx 4000 for a total simulation time ts the selected test cases their flow characteristics and associated simulation parameters are summarised in table 1 the closeness of the results simulated from the four solvers to the reference uniform dg2 simulation or measured data is evaluated using the mean error and root mean square error rmse these error metrics are recommended for point data evaluations nguyen et al 2016 and are computed as follows 11 m e a n e r r o r i 1 n p p r e f n s r m s e i 1 n p p r e f 2 n s where p refers to the predicted flow variable water depth or level or velocity pref indicates the reference or measured variable and ns is the number of data points for quantitative comparison of flood inundation extent predictions the hit rate h false alarm f and critical success index c metrics are recommended wing et al 2017 hoch and trigg 2019 h measures how much the reference flood extent is covered by the simulated flood extent with h 1 indicating full coverage and h 0 otherwise f measures how much of the simulated flood extent is outside of the reference flood extent with f 0 indicating that there is no simulated portion outside of the reference flood extent and f 1 indicating that all the simulated flood extent is outside the reference flood extent the c metric combines h and f to weigh how much of the sum of the simulated and the reference flood extents is covered by the simulated flood extent c 1 indicates full coverage and c 0 otherwise 3 1 selection of the initial grid for the simulations to perform a fair comparison amongst dynamic mwdg2 and hwfv1 adaptivity and static dg2 and fv1 adaptivity simulations should start from the same fixed grid that refers to the grid predicted by mwdg2 with grading as justified in the following since all simulations started over dry areas the initial grids predicted by the mra of hw and mws within dynamic hwfv1 and mwdg2 adaptivity respectively were selected based on the details of the dems for each of the three test cases table 1 they are here analysed compared to the fixed grid predicted by the mra of mws after grading fig 5 shows the percentage of resolutions selected for grids predicted by the mra of mws with and without grading and that of hw covering the whole study areas the grids predicted by the mra of hw are more refined by selecting the highest resolution over most of the domain area in all the test cases black bars in fig 5 in contrast the grids predicted by the mra of mws without grading allow for coarser resolutions only using the finest resolution over 65 58 and only 20 over the domain area for the three test cases respectively red bars in fig 5 the grids predicted by the mra of mws with grading have finer portions covering 80 of the domain area with the finest resolution for the first two cases and 37 for the third test case green bars in fig 5 compared to the predicted grids by the mra of hw those predicted with the mra of mws with grading still allow coarser resolution providing better allocation of resolutions for the initial grids therefore all the initial grids predicted by dynamic hwfv1 adaptivity are not as efficient as a choice to start the simulations compared to the fixed grid predicted by the mra of mws with grading that will be used instead to start dynamic hwfv1 adaptivity the grids predicted by the mra of mws with and without grading are compared in fig 6 for the three test cases considering zoomed in portions framed in figs 7 11 and 14 appearing below both the non graded and graded grids are seen able to retain the finest resolutions along sharp topographic features while allowing coarsening in the areas with smooth topographies as expected the non graded grids have coarser resolutions than the graded grids which were used hereafter to run the simulations with static dg2 and fv1 adaptivity and to start the simulations with dynamic mwdg2 and hwfv1 adaptivity 3 2 carlisle 2005 flooding this test case is characterised by gradually propagating flood at city scale from multiple fluvial inflows because it has post event measurements for validation it is investigated first to validate the adaptive and non uniform grid solvers for real world flood simulation the study area is shown in fig 7 covering about 14 5 km2 of the city of carlisle the three day long flooding is initiated from three inflow hydrographs at the upstream points of rivers eden petteril and caldew with a maximum flow rate of 1200 m3 s 1 shown at the right panels of fig 7 surveyed maximum free surface elevations are available at 217 wrack marks and 46 water level points black dots and red crosses in fig 7 these will be compared against the maximum free surface elevations simulated by uniform dg2 and the four solvers i e with dynamic mwdg2 and hwfv1 adaptivity and with static dg2 and fv1 adaptivity in addition water depth time series will be recorded at 15 sampling points blue squares in fig 7 including at the three gauges of sheepmount botcherby bridge and denton holme for which in situ water depth measurements are available to further support the validation of the solvers the four solvers are first verified by comparing their maximum free surface elevation predictions against the measured data at the water level and wrack mark points fig 8 includes the histogram errors generated by the differences in free surface elevation between simulated and observed data at the measurement points x axis of fig 8 and the rmse and mean error for each solver simulation the uniform dg2 solver is the most accurate solver by having an rmse of 0 29 and a mean error of 0 05 also its histogram error peak is in the vicinity of 0 with the least skewness compared to the other solvers this indicates that the dg2 simulations on the uniform grid at the finest resolution r uniform dg2 can be reliably used as the reference solution in the next two test cases that lack validation data dynamic mwdg2 adaptivity exhibits the closest histograms to those of uniform dg2 with rmse of 0 37 and mean error of 0 09 which compare well with the errors reported in other studies neal et al 2009 horritt et al 2010 fewtrell et al 2011 static dg2 adaptivity leads to a slightly higher rmse error of 0 39 and a mean error of 0 12 and its histogram errors are centred at 0 1 implying an underprediction tendency for the free surface elevation dynamic hwfv1 adaptivity and static fv1 adaptivity resulted in rmses of 0 52 and 0 47 and mean errors of 0 43 and 0 32 respectively these together with the fact that their histogram errors are centred around 0 4 and 0 2 suggest that the fv1 based solvers on their grids involving non uniform resolutions tend to significantly overpredict the free surface elevation compared to the measurements for this test case the water level time series recorded at 15 sampling points are compared in fig 9 as shown earlier in fig 7 these samplings points are distributed over the whole study area three of which are in the river channels sheepmount botcherby bridge and denton holme six in the urban areas pallet yard substation brown bros bus depot water mark 1 and water mark 2 and six others in the rural areas building 1 and watermarks 3 to 7 the dg2 based solvers yield water level predictions that have the best agreement with the reference solution irrespective of the locations of the sampling points in contrast the fv1 based solvers significantly overpredict water depths at all the staging points this difference in the predictions is in line with the analysis of fig 8 and alternative studies liu and pender 2013 shaw et al 2021 it mainly arises from the differences in the accuracy order amongst the solvers in the representation of flow and terrain data the dg2 based solvers use piecewise planar representations for the flow variables the topography and the friction integration whereas the fv1 based solvers use piecewise constant representations therefore the predictions from the fv1 based solvers would be more impacted by the growth of numerical diffusion compared to those from the dg2 based solvers ayog et al 2021 shaw et al 2021 this impact is particularly magnified with the fv1 based solvers because they have coarse resolution portions on their grids at which larger numerical diffusion accumulate yet affecting the overall predictions i e for this long duration simulation over a large and rough area this observation can also be supported by looking at the predictions by uniform fv1 at the finest resolution r fig 9 which are closer to reference solution that those by fv1 based adaptivity as in zhao and liang 2022 uniform fv2 ayog et al 2021 at the finest resolution r does not improve the uniform fv1 predictions indicating that resolution coarsening of piecewise constant representations is the key factor that deteriorated the predictions fig 10 includes the maximum flood extent predictions by the solvers with dynamic and static adaptivity along with the reference predictions by uniform dg2 the flood extent predicted by the dynamic mwdg2 adaptivity is the closest to the reference extent with the lowest f of 0 005 and the highest c of 0 98 static dg2 adaptivity also shows a good agreement with the reference extent with a c of 0 95 with slight underpredictions in limited areas close to the urban banks of rivers caldew and petteril the fv1 based solvers lead to the widest flood extent compared to the reference extent most notably over the urban area in the west of river caldew this is reflected in their lowest c of 0 89 resulting from dynamic hwfv1 adaptivity and 0 90 resulting from static fv1 adaptivity when modelling water level and flood extent for gradually propagating floods across urban and rural areas over long periods static dg2 adaptivity seems to lead to accurate enough predictions these predictions marginally improve with dynamic mwdg2 adaptivity making it a compelling alternative amongst the fv1 based solver static fv1 adaptivity overpredicts the reference predictions with no major improvement seen by instead using hwfv1 s dynamic adaptivity the performance of these solvers is further compared next for test cases with smaller areas and shorter simulation times with a more elaborate analysis that includes velocity predictions over smoother topographies with lower manning parameters 3 3 hypothetical flood propagation and inundation in thamesmead the test case involves a slowly propagating flood from a hypothetical defence failure over complex terrain in the thamesmead district the flood is assumed to occur from a breach along a 150m long defence structure through which water breaches from river thames into a 9 km 4 km floodplain an aerial view of the floodplain is shown in fig 11 along with the location of the inflow breach and four sampling points g1 g2 g3 and g4 where water level and velocity time series are recorded the inflow discharge lasts for 10 hr with a peak of 200 m3 s 1 reached during the second to the fourth hour of flooding see fig 11 the flood wave is expected to pass a narrow channel that cuts through a railway embankment located across most of the domain from southwest to northeast fig 12 includes the water level and velocity time series recorded at g1 to g4 for the adaptive and non uniform grid solvers and from the reference solution the rmse values comparing the predicted time series against the reference time series are listed in table 2 the water levels predicted by both dg2 based solvers are reasonably close to the reference solution with rmses being less than 0 02 static fv1 adaptivity is also shown to closely predict the reference water level time series with small deviations leading to rmses limited to 0 08 dynamic hwfv1 adaptivity however shows more obvious deviations by overpredicting the water levels at points g4 and g3 which are closer to the inflow while at g2 and g1 where the flow is relatively slower it leads to delayed arrival times these deviations are also reflected in higher rmses up to 0 14 the different behaviour of dynamic hwfv1 adaptivity compared to with static fv1 adaptivity likely occurred from the accumulation of thresholding errors that becomes significant due to deeper traversal across resolution levels on a grid that has more refined portions as shown in kesserwani and sharifian 2020 excess in the refined portions on the grid within the dynamic hwfv1 adaptivity arise from the first order piecewise constant representations and using a stricter ε value will introduce further refinements without adding notable gain in the predictive accuracy in terms of the velocity dynamic mwdg2 adaptivity leads to almost identical predictions to those from the reference uniform dg2 solver with negligible rmses limited to 0 02 static dg2 adaptivity however shows small deviations at all four points these deviations are expected as static dg2 adaptivity could be affected by the errors from the heuristic nature in averaging the slope coefficients discussed in section 2 2 1 which are expected to be more present in the velocity predictions as the velocity has a more sensitive variability than the water level this can also be supported by the fact that the highest deviation is observed at g3 which recorded higher velocities resulting in a higher error an rmse of 0 078 static fv1 adaptivity predicts the reference velocities at g4 with an rsme of 0 022 but underpredicts the velocity at the other three points with rmses up to 0 109 compared to static fv1 adaptivity dynamic hwfv1 adaptivity performs equally well at points g4 and g3 but shows more pronounced underpredictions at the farther points g1 and g2 fig 13 contrasts the flood inundation maps predicted by the four solvers to the reference map after the 10 hour simulations dynamic mwdg2 adaptivity yields the closest predictions to the reference extent with the highest c of 0 93 static dg2 adaptivity leads to slight underpredictions at the southern areas of the domain leading to a close agreement with the reference extent with a c of 0 91 the fv1 based solvers predict the reference extent less accurately with a c of 0 89 achieved by static fv1 adaptivity and a lower c of 0 82 achieved by dynamic hwfv1 adaptivity suggesting the latter predicts a narrower extent i e in the south and westernmost regions also confirmed by its lowest h of 0 89 for this test case static dg2 adaptivity is able to provide accurate enough predictions for water level and flood extent but can fall short in predicting velocities leading to increasingly deviated predictions with higher velocities dynamic mwdg2 adaptivity however provides the best quality predictions to those of the reference uniform dg2 solver for the velocities as well as the water levels and flood extent the opposite is observed for the predictions made by the fv1 based solvers static fv1 adaptivity predicts flood extents water level and velocity time series that are closer to the reference predictions than those predicted by dynamic hwfv1 adaptivity the latter given its relatively more refined grid analysed next in fig 16 leads to accumulation of thresholding errors that can impact its predictions over time to make them less accurate than those of static fv1 adaptivity this suggests favouring static fv1 adaptivity over dynamic hwfv1 adaptivity for modelling slowly propagating floods over a real dem for a long duration simulation and dynamic mwdg2 adaptivity over static dg2 adaptivity to acquire the most accurate predictions the solvers are next compared for a test case involving rapid to gradual flood flow propagation 3 4 flood wave along a valley the performance of the dynamic mwdg2 and hwfv1 adaptivity versus static dg2 and fv1 adaptivity is finally compared for reproducing a scenario that involves a rapidly propagating flow turning to a gradually propagating flow the flood wave arises from an inflow that enters the upstream of a 17 0 km 0 8 km valley and propagates downstream fig 14 shows the terrain of the valley including 7 sampling points that are typically used to compare water level and velocity time series as shown in fig 14 the inflow hydrograph has a high peak discharge of 3000 m3 s 1 lasting for less than 2 hr during the first 3 5 hr the flood wave undergoes a rapidly propagating flow stage to then become in a stage of gradually rapidly propagating flow as the water flows downhill filling in the topographic depressions to reach the larger pond located downstream the latter stage begins at about 5 hr to last until 30 hr during which the flow slows down by the friction to approach a steady state fig 15 includes the water level and velocity time series recorded for the four solvers with dynamic and static adaptivity at the sampling points and those produced by the reference uniform dg2 solver following other studies cited in table 1 the time series are analysed for points 1 3 and 5 located at the upstream middle and downstream of the topographic depressions the rmse values from the predicted time series with respect to those of the reference solution are included in table 3 the velocity time series figs 15d 15f are recorded for up to 5 hr and are discussed first to analyse the performance of the solvers during the rapidly propagating flow stage dynamic mwdg2 adaptivity predicted the reference velocities perfectly leading to the smallest rmses limited to 0 06 this is notably observed at point 3 where the solver with dynamic mwdg2 adaptivity is the only one that perfectly trails the small transient variations appearing after 1 hr these velocity variations were detected with the uniform fv2 solver simulation in ayog et al 2021 on the finest dem resolution but dynamic mwdg2 adaptivity could capture them despite the presence of coarser resolution portions on its grid static dg2 adaptivity performs equally well at point 1 fig 15d where the earliest arrival time is recorded at point 5 fig 15e it is able to partly capture the small transient variations but overly predicts the reference velocity leading to an rmse of 0 104 at point 5 fig 15f where the flood is driven by the topography and friction effects static dg2 adaptivity predicts comparable velocities up to 3 5 hr but its predictions are affected by numerical disturbances afterwards in line with the past observations made for fig 12 these spurious disturbances can be attributed to the heuristic nature of averaging slope coefficients section 2 2 1 the fv1 based solvers lead to good predictions at points 1 and 5 in good agreement with the reference velocities both fail to capture the small scale velocity variations at point 3 leading to rmses up to 0 28 but dynamic hwfv1 adaptivity shows a better performance in capturing velocity peaks suggesting that it can still be a good choice for short duration simulations of highly dynamic flows water level time series are compared in figs 15a 15c to analyse the performance of the solvers during the gradually propagating flow stage again dynamic mwdg2 adaptivity leads to the best agreement with the reference water levels at all three points with rmses less than 0 08 static dg2 adaptivity only closely predicts the reference water level at point 1 but tends to underpredict it at point 3 leading to the highest rmse of 0 295 this underprediction is intensified at point 5 which is likely due to the impact of the spurious numerical disturbances arising in the velocity predictions the fv1 based solvers predict closely the reference water levels at point 1 but dynamic hwfv1 adaptivity shows an overprediction tendency at points 3 and 5 by 0 2m this tendency seems to only occur in the long run after the flow stagnates to steady state where the accumulation of thresholding errors from the deeper traversal across resolution levels becomes irrelevant when modelling flows with rapid to gradual transitions this test case suggests that static dg2 adaptivity is not the best choice as observed in section 3 3 its velocity predictions can be disturbed by averaging errors that tend to grow when the flow decelerates causing underpredicted water levels dynamic mwdg2 adaptivity comes in as a viable alternative to preserve the highest quality possible of the reference predictions no matter if the flow is gradual or rapid static fv1 adaptivity although not as good on velocity predictions is still a good option to get acceptable water level predictions during the gradually propagating flow stage dynamic hwfv1 adaptivity could only perform better over the short period of rapidly propagating flow in the long run it can be affected by the accumulation of thresholding errors inflicting less accurate water levels thus may not be a better alternative to static fv1 adaptivity for long duration simulation of decelerating floods 4 efficiency analysis the efficiency of the solvers is analysed in terms of reduction in the number of elements over that on the uniform grid at the finest resolution r speedups from the runtime achieved on a single cpu core to identify the difference between static and dynamic adaptivity costs and the extent of runtime cost reduction with dynamic adaptivity for the gpu implementation the percentages of reduction in the number of elements are evaluated using eq 12 12 reduction of elements elements no on the uniform grid elements no on the adaptive grid elements no on the uniform grid 100 the reductions are first evaluated for the fixed grid used with static dg2 and fv1 adaptivity and then for the 2d adaptive grids predicted by dynamic mwdg2 and hwfv1 adaptivity during the simulations these evaluations are shown in fig 16 for the three simulated scenarios carlisle 2005 flooding the hypothetical flood in thamesmead and the flood wave along a valley section 3 2 3 4 in the first two scenarios the dems are more complex including urban features than that of the third scenario because of this less reduction in the number of elements is achieved on the fixed grid in the first two scenarios 13 and 9 respectively compared to the third scenario where the reduction is around 47 this results in lower speedups with dg2 and fv1 static adaptivity with reference to the uniform dg2 solver informed by the analysis of cpu runtimes listed in table 4 namely for the scenario with 9 reduction speedup ratios of 5 4 and 1 7 were achieved respectively which increased to 7 5 and 2 8 for the scenario with 13 reduction and to 25 7 and 6 5 for the scenario with 47 reduction the enhancement in the speedups by moving from static dg2 and fv1 adaptivity to dynamic mwdg2 and hwfv1 adaptivity are found to be 0 9 and 2 6 for the scenario with 9 reduction 1 8 and 1 9 for the scenario with 13 reduction 2 7 and 5 7 for the scenario with 47 reduction respectively this speedup analysis indicates that the larger the reduction in elements the more the speedup gain with static adaptivity and more enhancement in speedup would be gained by moving to dynamic adaptivity as dynamic adaptivity started from the fixed grids used with static adaptivity this analysis implies that the key parameter to look at when weighing the expected or baseline speedup is the reduction in elements with respect to the finest uniform grid the higher the reduction the more the merit from deploying dynamic adaptivity to reduce the runtime cost therefore making the choice of when to use static or dynamic adaptivity depends on the properties of the test first in relation to the features of the dem and then to the nature of the flood flow this is discussed next in particular for dynamic mwdg2 adaptivity to identify when it would be a fast enough alternative to uniform dg2 in spite of running the gpu implementation over time the number of elements on the dynamic hwfv1 and mwdg2 adaptivity increases leading to an expected reduction in their efficiency dynamic hwfv1 adaptivity uses a much higher number of elements than dynamic mwdg2 adaptivity in all the scenarios in the first two it leads to grids that have less than 5 reduction in elements over the fine uniform grid confirming its impracticality for simulating slow to gradually propagating floods over a long duration in the third scenario hwfv1 s grid reaches 13 to 20 reduction in elements in all the scenarios dynamic mwdg2 adaptivity offers a greater reduction in elements while leading to more accurate predictions sections 2 3 and 2 4 while remaining faster to run than the uniform dg2 simulations table 4 dynamic mwdg2 adaptivity s speedup ratios for the cpu simulations are around 1 5 for the first two scenarios and higher around 2 3 for the third one that has more reduction in the number of elements on the initial grid nonetheless the costs for the mwdg2 runs on a single cpu core are unfeasibly large for practical simulations over largely dry areas hindered by its need to regenerate the 2d adaptive grid in serial every time step with the proposed gpu implementation for dynamic mwdg2 and hwfv1 adaptivity their runtimes are reduced significantly and remain smaller than the runtimes required by uniform dg2 simulation on the gpu table 4 however dynamic hwfv1 adaptivity leads to predictions that are somewhat less competitive than those made by static fv1 adaptivity sections 2 3 and 2 4 and is not as valid as an option compared to dynamic mwdg2 adaptivity compared to the single core cpu runs mwdg2 on the gpu achieved gains in speedup of around 41 30 and 53 5 times for the three scenarios respectively dynamic mwdg2 adaptivity also leads to runtimes that are much less than the clock time and the runtimes of uniform dg2 on the gpu namely achieving speedups of 1 05 1 75 and 3 67 respectively less speedups are expected for the first two scenarios given the relatively less reduction on their initial grids compared to the third scenario consequently using dynamic mwdg2 adaptivity on the gpu can still be more efficient than uniform dg2 on the gpu for flood simulations however the extent of its efficiency gain primarily depends on how much reduction in the number of elements is achieved on the initial grid with respect to the finest uniform grid of the dg2 solver and secondarily on the dynamic transients involved in the flood in question the more the reduction and the stronger the flow s dynamics the more the efficiency gain from using dynamic mwdg2 adaptivity 5 summary conclusions and recommendations real world flood simulators often use first order finite volume fv1 solvers of the shallow water equations with efficiency enhancements to include parallelisation on graphical processing units gpus and static adaptivity on a fixed grid a second order discontinuous galerkin dg2 solver greatly increases the accuracy in the predictions but is costly to run on uniform grids and its potential for use as an alternative to finite volume based solvers with static adaptivity was newly investigated alternative solvers with multi wavelet based dynamic adaptivity have been developed that adapt and scale local dg2 and fv1 numerical solutions while applying the multiresolution analysis mra to select the 2d adaptive grid over time the mra of multiwavelets mws with dg2 piecewise planar solutions leads to dynamic mwdg2 adaptivity and that of the haar wavelet hw with fv1 piecewise constant solutions to dynamic hwfv1 adaptivity the performance of dynamic adaptivity was also newly explored for practical real world simulations to find out when they yield more accuracy than static adaptivity and how far the runtimes of dynamic adaptivity become affordable when the mra of mws and hw is re worked to run on the gpu therefore the predictive capabilities of dynamic mwdg2 and hwfv1 adaptivity were compared to static dg2 and fv1 adaptivity for complex real world flooding scenarios the static dg2 and fv1 adaptivity used a fixed grid achieved by applying the mra of mws to the time invariant features of digital elevation model dem the fixed grid had to be graded to be able to adapt the dg2 and fv1 flow solutions across the interfaces with adjacent heterogeneously sized grid elements the graded fixed grid was also the initial grid used to run dynamic adaptivity for a fair assessment of performance dynamic mwdg2 and hwfv1 adaptivity and static dg2 and fv1 adaptivity were applied to reproduce three field scale flood simulation case studies involving real topographies and different flows from slow to rapidly propagating their predictive accuracy was evaluated by measuring the closeness of their predictions to the reference predictions made by uniform grid dg2 solver simulations using the finest dem resolution uniform dg2 the evaluations included qualitative and quantitative analysis of maximum water levels water levels velocities time series spatial flood maps and an efficiency analysis considering reduction in the number of elements during a simulation and runtime costs on a single cpu core to complete the simulation and the speedup gained with dynamic mwdg2 and hwfv1 adaptivity by using the gpu parallelised versions the evaluations show that static adaptivity is a better choice than dynamic adaptivity to simulate slow to gradually propagating flood flows for such flows the static adaptivity yields closer predictions to the reference uniform dg2 predictions and is faster to run than dynamic adaptivity that is hindered by the overhead costs of the mra amongst static dg2 and fv1 adaptivity that of dg2 seems to be the best choice to capture small scale time variations in the velocities and more accurate flood maps static fv1 adaptivity though not as accurate as static dg2 adaptivity is still a valid alternative to acquire similar water level predictions at reduced runtimes as for dynamic mwdg2 and hwfv1 adaptivity it remains less expensive to run than the reference uniform dg2 solver on a single cpu core but gain major speedups on the gpu where their simulation times become less than the clock times the piecewise constant representations within dynamic hwfv1 adaptivity yields to more refinement on the 2d adaptive grid causing accumulation of thresholding errors from the mra of hw across a deeper tree traversal in the long run this manifests in overly predicted water levels making dynamic hwfv1 adaptivity or even a second order finite volume variant that uses the mra of hw with piecewise constant representations not ideal for long duration simulations with slowly propagating flows dynamic mwdg2 adaptivity yields the best quality predictions for both water levels and velocities and its 2d adaptive grid involves more sensible resolution coarsening as the flow remains in a state of gradual to slow propagation for a rapidly propagating flow dynamic mwdg2 adaptivity seems to excel in closely reproducing the predictive accuracy of the reference uniform dg2 predictions where any other choice for the adaptivity underperform static dg2 adaptivity became affected by spurious disturbances whereas static fv1 adaptivity could not closely replicate the reference velocity predictions in terms of speedup over the reference uniform dg2 simulations on the gpu dynamic mwdg2 adaptivity always remained faster but the speedup rate of dynamic adaptivity is mainly dependant on the reduction in the number of elements on the fixed grid relative to the finest uniform grid this suggests that gpu parallelisation with dynamic mwdg2 adaptivity is useful to maximise accuracy and efficiency when simulating flood events driven by a fast flow propagation e g tsunamis or dam breaks for uniform resolution dems leading to at least 15 reduction in the number of elements on its initial fixed grids credit authorship contribution statement georges kesserwani conceptualization methodology formal analysis supervision project administration funding acquisition writing original draft writing review editing mohammad kazem sharifian conceptualization methodology software visualization investigation data curation writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements data and software accessibility we wish to thank paul bates university of bristol for sharing the validation data for the carlisle 2005 test case and mr alovya a chowdhury university of sheffield for the technical support to setup and run dynamic mwdg2 and hwfv1 adaptivity on the gpu this work was supported by the uk engineering and physical sciences research council epsrc grant ep r007349 1 it is part of the seamless wave project software infrastructure for multi purpose flood modelling at various scales based on wavelets https www seamlesswave com the simulation results reported in section 3 are available on zenodo sharifian and kesserwani 2021 and the dems can be accessed by contacting the uk environment agency the cpu codes for static dg2 and fv1 adaptivity can be shared upon request and those of dynamic mwdg2 and hwfv1 adaptivity are available on zenodo sharifian and kesserwani 2020 the gpu implementation of the fixed grid generator and of dynamic mwdg2 and hwfv1 adaptivity have been incorporated into the open source lisflood fp8 1 hydraulic modelling packages and will be available in the next version release 10 5281 zenodo 4073011 for the purpose of open access the author has applied a creative commons attribution cc by licence to any author accepted manuscript version arising 
76,real world flood simulators often use first order finite volume fv1 solvers of the shallow water equations with efficiency enhancements exploiting parallelisation on graphical processing units gpus and the use of static adaptivity on fixed grids a second order discontinuous galerkin dg2 solver greatly increases the accuracy in the predictions on uniform grids where it is comparatively costly to run but its practical utility as an alternative for flood simulations using static adaptivity is not yet assessed this is also the case for the dynamic adaptivity using the multiresolution analysis mra of the haar wavelet hw scaling fv1 piecewise constant solutions hwfv1 and of the smoother multiwavelets mws that scales dg2 piecewise planar solutions mwdg2 to adapt the resolution of their grids over time therefore dynamic mwdg2 and hwfv1 adaptivity is newly explored for practical real world simulations to find out when they yield better predictions than static dg2 and fv1 adaptivity a new gpu implementation is proposed to include dynamic mwdg2 adaptivity to also assess how far gpu parallelisation renders its runtime practically feasible dynamic and static adaptivity are assessed for three tests involving slow gradual to rapid flood flows with analyses of their predictive accuracy and computational costs with reference to uniform grid dg2 simulations at the finest resolution of the digital elevation model dem findings suggest favouring static fv1 adaptivity for long duration simulations of slowly to gradually propagating floods and dynamic mwdg2 adaptivity to simulate events driven by rapidly propagating flows on the gpu dynamic mwdg2 adaptivity is faster than uniform dg2 leading to a higher speedup ratio with higher reduction in the elements on its initial fixed grid keywords flood modelling fv1 and dg2 solvers multiresolution analysis gpu parallelisation static vs dynamic adaptivity practical recommendations data availability the data is already openly availabe on 10 5281 zenodo 5047565 or in sharifian and kesserwani 2021 1 introduction flood modelling is essential to understand flood flow dynamics and define mitigation strategies to support decision making in flood risk management spiekermann et al 2015 with the increasing availability of accurate raster based terrain datasets two dimensional 2d flood models have gained popularity for complex field scale flood inundation modelling hunter et al 2008 teng et al 2017 nkwunonwo et al 2020 raster based flood models use a numerical solver on a uniform resolution grid defined by a given raster formatted digital elevation model dem file flood models used to support real world flood simulations have often been based on solving the full shallow water equations in a first order finite volume fv1 godunov type numerical solver on exploiting parallelisation on graphical processing units gpus xia et al 2019 echeverribar et al 2019 zhao and liang 2022 and or deploying static adaptivity of the grid resolution bmt 2018 hou et al 2018 vacondio et al 2017 in order to reduce runtime costs bellos et al 2020 saksena et al 2020 guo et al 2020 on a uniform grid raster based flood models based on the second order discontinuous galerkin dg2 solver can be built by increasing the local formulation s complexity of the fv1 solver shaw et al 2021 leading to greater quality predictions than finite volume industrial models ayog et al 2021 the locality of the dg2 solver formulation should also make it a better candidate to increase the quality of the flood flow predictions within standard static adaptivity but this is yet to be investigated for real field simulations including the efficient generation of the resolution scales for the fixed grid from a thorough analysis of the topographical features within the dem alternatively modern multi wavelet based solvers with dynamic adaptivity were formulated based upon the multiresolution analysis mra of the haar wavelet hw or the smoother multiwavelets mws to adapt the grid resolution in time driven by scaled piecewise constant fv1 numerical representations of the flow solutions and the dem or smoother piecewise planar dg2 representations respectively kesserwani et al 2019 kesserwani and sharifian 2020 these combinations will be termed as the hwfv1 and mwdg2 respectively in essence dynamic mwdg2 respectively hwfv1 adaptivity involves the mra process to generate the grid every time step and while using high and low pass filter formulae to rigorously scale and reconstruct the numerical representations across disparate resolutions the multi wavelet based dynamic adaptivity of the mra process is practical as it needs only one user specified parameter an error threshold ε to select the scales of grid resolution moreover it uses the rigorous filter formulae to reconstruct intrinsically well balanced solution limits to integrate the fluxes across heterogeneously sized adjacent elements as robust as they are integrated in the uniform grid solver counterparts haleem et al 2015 gerhard et al 2015 kesserwani et al 2015 caviedes voullième and kesserwani 2015 caviedes voullième et al 2020 the serial implementation of dynamic mwdg2 respectively hwfv1 adaptivity for hydraulic modelling on the central processing unit cpu was already devised and extensively validated for a series of synthetic and laboratory scale test cases mostly dominated by wet areas kesserwani et al 2019 kesserwani and sharifian 2020 the findings identify an ε value in the magnitude of 10 3 with dynamic mwdg2 respectively hwfv1 adaptivity to preserve the predictive accuracy of the dg2 solver respectively fv1 run on the finest uniform grid at a competitively affordable runtime namely less or close to that of the fv1 solver run on the finest uniform grid kesserwani and sharifian 2020 in serial the efficiency gain of the dynamic mwdg2 adaptivity arises from its mra of mws operating on piecewise planar representations which causes more aggressive yet sensible grid coarsening than with the mra of hw that operates on piecewise planar representations within dynamic hwfv1 adaptivity however dynamic mwdg2 respectively hwfv1 adaptivity must apply the mra process every time step and this entails severe overhead costs in a serial implementation in particular for real world simulations where the flooding inundates large dry areas for such simulations dynamic mwdg2 and hwfv1adaptivity has yet to be evaluated when reworked to run in parallel on the gpu to assess the extent of their runtime affordability for practical flood modelling applications on the other hand the findings make a clear case for using the mra of mws instead of that of hw to efficiently generate a fixed grid with sensibly selected resolution scales kesserwani et al 2019 kesserwani and sharifian 2020 in this context the mra process is applied only once to analyse the features of the dem with such a static adaptivity the rigorous filter formulae of the multi wavelet based dynamic adaptivity are no longer applicable therefore only extrinsic well balanced solution limits can be reconstructed across the heterogeneously sized adjacent elements based on heuristic averaging on a graded grid as in conventional adaptive grid refinement methods kesserwani and liang 2012a liang et al 2015 previous works suggested that static adaptivity with a finite volume solver is suited to simulate slow to gradual fluvial flood flow propagation hou et al 2018 but have rarely assessed the ability of the multi wavelet based mra to generate the fixed grid within this scope the work of özgen xian et al 2020 only explored the mra of hw to generate unstructured triangular grids over which a zero inertia flow solver was adapted to simulate overland flow reporting moderate speedups also the authors concluded that pre processing the dem data into topographic slopes for use as input to the mra of hw significantly improve the sensibility of the predicted resolution scales for the fixed grid özgen xian et al 2020 this suggests that there is a benefit from using the mra of mws as a better alternative to generate the fixed grid this will be demonstrated in this work for static dg2 and fv1 adaptivity alongside with dynamic mwdg2 and hwfv1 adaptivity the rest of the paper is organised as follows section 2 overviews the dynamic mwdg2 and hwfv1 adaptivity that uses the mra process to analyse and scale their numerical solutions dg2 piecewise planar and fv1 piecewise constant and update the grid over time section 2 1 it follows with the description of the static dg2 and fv1 adaptivity section 2 2 and of the gpu implementation of the mra process to enable gpu resident dynamic mwdg2 and hwfv1 adaptivity section 2 3 in section 3 the multi wavelet based dynamic mwdg2 and hwfv1 adaptivity is assessed against the standard static dg2 and fv1 adaptivity for three field scale test cases featured by slow gradual and rapidly propagating flood flows with reference to finest uniform grid dg2 simulations the assessments include demonstrating the merit of the mra of mws to generate the fixed grid for static dg2 and fv1 adaptivity that is also the initial grid for dynamic mwdg2 and hwfv1 adaptivity section 4 provides an efficiency analysis in terms of runtime cost and percentage of reduction in the number of elements with respect to the finest uniform grid to identify when static or dynamic adaptivity can be used as an alternative to uniform grid flood simulators section 5 concludes on the extent of practical utility of static and dynamical adaptivity in relation to the properties of the flood simulation project 2 computational methods flow solvers with dynamic and static adaptivity are explored as alternatives to their established uniform grid dg2 and fv1 solvers shaw et al 2021 the solvers are formulated to provide numerical solutions of the depth averaged shallow water equations in a conservative form eq 1 1 t u x f u y g u s b u s f u represents a partial derivative operator u x y t h qx qy t is the vector of flow variables at time t and location x y which contains the water depth h m and the discharges per unit width qx hu m2s 1 and qy hv m2s 1 involving the depth averaged horizontal velocities u ms 1 and v ms 1 respectively f q x q x 2 h 1 0 5 g h 2 q x q y h 1 t and g q y q x q y h 1 q y 2 h 1 0 5 g h 2 t are the components of the physical flux and g ms 2 denotes the gravity acceleration constant s b 0 gh x z gh y z t is the topography source term vector including the bed slopes and the friction source term vector incorporating friction effects is denote by s f 0 c f u u 2 v 2 c f v u 2 v 2 t where c f g n m 2 h 1 3 is a friction function in which nm m1 6 refers to the manning s roughness parameter eq 1 is numerically solved on a 2d spatial domain of dimension lx ly the domain is meshed using a grid made of non overlapping heterogeneously sized square elements the finest resolution r on this grid will be taken to match the raster formatted digital elevation model dem a grid element at resolution r is shown in fig 1 indexed by i j and centred at points x i j y i j two categories of solvers are presented multi wavelet based dynamic mwdg2 and hwfv1 adaptivity scaling their numerical solutions and grid resolutions in time and standard static dg2 and fv1 adaptivity adapting their numerical solutions on a fixed grid dynamic mwdg2 adaptivity uses the mra of mws to decompose analyse and assemble piecewise planar dg2 solutions on a dynamically adaptive grid section 2 1 from dynamic mwdg2 adaptivity that of hwfv1 can be obtained by degrading its formulation to use the hw to decompose analyse and assemble piecewise constant fv1 solutions section 2 1 4 the cpu implementation of dynamic mwdg2 and hwfv1 adaptivity can be found in kesserwani et al 2019 and kesserwani and sharifian 2020 with an exhaustive analysis of their performance for academic and laboratory scale test cases as the aim is to assess the potential of dynamic mwdg2 and hwfv1 adaptivity for complex real world flood simulation only the multi wavelet based mra process is briefly overviewed next in section 2 1 multi wavelet based dynamic adaptivity will be compared with standard static adaptivity for three realistic test cases section 3 the initial grid for launching dynamic mwdg2 and hwfv1 adaptivity will be the same as the fixed grid used with static dg2 and fv1 adaptivity section 3 1 this fixed grid will be generated by first applying the mra of mws to the dem raster file section 2 1 2 and then ensuring that it is graded section 2 2 1 the descriptions of the dg2 and fv1 solvers formulation for a uniform resolution grid can be found in shaw et al 2021 therefore only their solution adaptation procedure on the fixed grid will be described for a portion with an interface shared by heterogeneously sized adjacent elements section 2 2 a new gpu implementation of dynamic mwdg2 and hwfv1 adaptivity is proposed to make them run in parallel on the gpu section 2 3 and boost speedups with respect to the cpu counterparts section 4 2 1 dynamic mwdg2 adaptivity for dynamic mwdg2 adaptivity the discrete vector of flow variables u h x y t and the discrete scalar topography zh x y are shaped as local piecewise planar solutions over each element starting from the finest uniform grid at resolution r fig 1 this is done within the framework of a simplified dg2 formulation which spans piecewise planar flow solutions and topography function on a 2d truncated tensor product of the scaled legendre basis ϕ to which mws bases are adapted kesserwani and sharifian 2020 with a truncated tensor product basis the simplified dg2 formulation is slope decoupled kesserwani et al 2018 and therefore operates on a similar stencil to that of godunov type finite volume flood models ayog et al 2021 on the slope decoupled stencil the simplified dg2 formulation evaluates the fluxes at the centres of the elements interfaces where it must ensure continuity of the topography function to avoid spurious momentum errors at wet dry fronts crossing steep bed slopes a desired property to achieve within dynamic mwdg2 adaptivity caviedes voullième et al 2020 the simplified dg2 formulation was demonstrated to deliver as second order accurate predictions as the classical dg2 formalism based on a full tensor product stencil leading to a speedup of 2 6 times moreover it achieves superior predictions than finite volume godunov type flood models for real field flood modelling without activating local slope limiting and this boosts the speedups to 5 times ayog et al 2021 maximising efficiency for flood modelling applications shaw et al 2021 as shown in eq 2 u h x y t contains an equation of a plane per physical component each defined by three coefficients of an average denoted by subscript 0 and of two slopes in the x and y directions denoted by subscripts 1x and 1y respectively 2 u h x y t u i j ϕ h i j 0 h i j 1 x h i j 1 y q x i j 0 q x i j 1 x q x i j 1 y q y i j 0 q y i j 1 x q y i j 1 y 1 2 3 x x i j r 2 3 y y i j r in eq 2 stands for scalar product and therefore u i j is a matrix containing the flow coefficients defining the piecewise planar solutions for the three components of the flow vector the piecewise planar representation for zh x y can be produced in a similar way 3 z h x y z i j ϕ z i j 0 z i j 1 x z i j 1 y 1 2 3 x x i j r 2 3 y y i j r in eq 3 z i j is the vector of the topography coefficients for defining a piecewise planar representation the topography coefficients do not vary in time and should be carefully initialised from a dem raster file section 2 1 1 the time dependant flow coefficients u i j can be initialised component wise in a similar way from the initial conditions for the flow variables converted into raster files 2 1 1 initialisation of coefficients on the finest uniform grid the initialisation procedure is based on ensuring that the piecewise planar topography representation zh x y remains continuous at the interface centres of an element denoted by n s e and w in fig 1 as demonstrated in kesserwani et al 2018 ensuring continuity at these interface centres is key to robustly evaluate the discrete fluxes and topography source terms which respects the well balanced property with the presence of wet dry fronts across steep bed slopes such a piecewise planar topography projection can be constructed from a dem by first taking the dem raster values to be located at the nw ne sw and se vertices fig 1 and then aggregating an average value z i j n 0 5 z i j nw z i j ne at n and similarly z i j e z i j s and z i j w values at s e and w from these values the desired average z i j 0 and slope coefficients z i j 1x and z i j 1y can be defined 4a z i j 0 1 2 z i j e z i j w 1 2 z i j n z i j s 1 4 z i j ne z i j nw z i j se z i j sw 4b z i j 1 x 1 2 3 z i j e z i j w 1 4 3 z i j ne z i j nw z i j se z i j sw 4c z i j 1 y 1 2 3 z i j n z i j s 1 4 3 z i j ne z i j se z i j nw z i j sw even when there are no initial flow conditions eq 4 is also applied to initialise zero valued vectors for h i j 0 h i j 1x h i j 1y qx i j 0 qx i j 1x qx i j 1y and qy i j 0 qy i j 1x qy i j 1y to initialise the matrix of flow coefficients u i j eq 2 in what follows for simplicity of presentation the mra process which is responsible for dynamic adaptivity will be described component wise using the scalar s h qx qy z to represent the physical components of the flow vector time variant and the topography time invariant 2 1 2 mra of mws to generate the 2d adaptive grid the mra of mws starts from the finest uniform grid at resolution r using the initial coefficients s fine s i j 0 s i j 1x s i j 1y attributed to a maximum resolution level l leading to the finest resolution of the dem now the finest uniform grid at resolution level l contains 2 l m 2 l n elements m lx 2 l r and n ly 2 l r below which there are uniform grids with subsequently lower resolution levels of l 1 1 0 that forms a hierarchy with the coarsest uniform grid at resolution level 0 made of m n elements i e a single element in this work with m n 1 the mra process first applies the encoding operation to extract and analyse the flow vector and topography coefficients at the grids with lower resolution levels l 1 1 0 to then apply the decoding operation to derive the relevant coefficients that will form the 2d adaptive grid from the coefficients on the grid at resolution level l s fine the encoding operation can be applied to produce the coefficients on the grid with twice coarser resolution at level l 1 s coarse and to also extract their vectors of the details d h coarse d v coarse and d d coarse living at resolution level l 1 these vectors of details belong to the basis of mws ψ and represent the encoded difference between the scaling basis ϕ at resolution level l and its parent basis at resolution level l 1 e g as shown in fig 1 in shaw et al 2020 therefore d h coarse d v coarse and d d coarse encapsulate the encoded differences in coefficients between the two resolution levels l and l 1 along the horizontal vertical and diagonal directions respectively namely s coarse d h coarse d v coarse and d d coarse on a parent element at resolution level l 1 can be encoded from its four coefficients of their child elements at resolution level l using the formulae described below in eq 5 5a s coarse h h 0 s 0 fine h h 1 s 2 fine h h 2 s 1 fine h h 3 s 3 fine 5b d h coarse g a 0 s 0 fine g a 1 s 2 fine g a 2 s 1 fine g a 3 s 3 fine 5c d v coarse g b 0 s 0 fine g b 1 s 2 fine g b 2 s 1 fine g b 3 s 3 fine 5d d d coarse g c 0 s 0 fine g c 1 s 2 fine g c 2 s 1 fine g c 3 s 3 fine the subscripts of the coefficients s fine refer to the indexing of the four child elements at level l with reference to their parent element at level l 1 hh 0 1 2 3 are 3 3 low pass filter matrices and ga 0 1 2 3 gb 0 1 2 3 and gc 0 1 2 3 are 3 3 high pass filter matrices these filters were derived from the relationship linking ψ to ϕ at resolution level l and its father basis at resolution level l 1 the explicit expressions of these filters are available in kesserwani and sharifian 2020 including the ones for hwfv1 the formulae in eq 5 are generalisable to any two subsequent resolution levels kesserwani and sharifian 2020 by recursive application of eq 5 s fine at resolution level l is now compressed into a series of details living on the hierarchy of uniform grids at subsequently lower resolution levels l 1 1 0 these details form a tree like structure and can be summed over the coefficients s coarse associated with the coarsest uniform grid resolution level 0 on this hierarchy the details extracted for all the physical components flow vector and topography are analysed all together these details become increasingly significant with increasing non smoothness in any of the physical features but remain small otherwise the time invariant details of the topography must be reconsidered with those extracted from the flow vector time variant to ensure that no coarsening in grid resolution is allowed beyond the resolution dictated by the dem the significance of all the details is measured by comparing their normalised magnitude to an error threshold parameter ε user specified for shallow flow modelling a value in the magnitude of ε 10 3 was identified appropriate with dynamic mwdg2 respectively hwfv1 adaptivity to preserve the predictive accuracy of the dg2 solver respectively fv1 run on the finest uniform grid resolution r at a competitively affordable runtime namely less or close to that of the fv1 solver run on the finest uniform grid resolution r kesserwani and sharifian 2020 for realistic simulations involving real dems with largely dry portions using stricter ε values lead to a marginal improvement in the accuracy kesserwani and sharifian 2020 but would introduce too much rise in the runtime cost up to making dynamic adaptivity impracticable a normalised details magnitude of any component s h qx qy z is computed as d d max 1 s 0 the term d denotes the maximum of the magnitude of the three details along the horizontal vertical and diagonal directions and s 0 is the maximum of all the average coefficients available on the finest uniform grid at resolution level l the normalised details are computed for all the elements on the hierarchy of uniform grids with resolution levels l 1 0 details at elements where d ε are classified as significant and should be retained and such elements are flagged to produce their coefficients via decoding kesserwani and sharifian 2020 these elements will be referred to as leaf elements and are such that their details on the tree of details either stopped being significant or otherwise belong to the finest grid a schematic view of leaf elements on the hierarchy of grids can be found below in fig 4 as part of the gpu parallelisation section 2 3 to produce the leaf elements coefficients the process of decoding is applied for the tree of details all over the hierarchy of grids decoding starts from applying eq 6 to the coefficients and their encoded details on the coarsest uniform grid at resolution level 0 s coarse d h coarse d v coarse and d d coarse to create the coefficients of their four child elements on the grid at resolution level 1 s 0 fine s 1 fine s 2 fine and s 3 fine 6a s 0 fine h h 0 t z coarse g a 0 t d h coarse g b 0 t d v coarse g c 0 t d d coarse 6b s 2 fine h h 1 t z coarse g a 1 t d h coarse g b 1 t d v coarse g c 1 t d d coarse 6c s 1 fine h h 2 t z coarse g a 2 t d h coarse g b 2 t d v coarse g c 2 t d d coarse 6d s 3 fine h h 3 t z coarse g a 3 t d h coarse g b 3 t d v coarse g c 3 t d d coarse decoding is recursively applied in ascending order while adding up the retained details to create the coefficients on child elements kesserwani and sharifian 2020 the derived coefficients and the indices of their elements can finally be sorted and assembled on the 2d adaptive grid made of non overlapping elements involving various resolutions between r and 2 l r 2 1 3 time update of coefficients and of the 2d adaptive grid on the 2d adaptive grid the flow coefficients u i j at time level n should be updated to time level n 1 by a two stage runge kutta scheme involving discrete spatial dg2 operators kesserwani et al 2018 as shown in eq 7 the flow coefficients are updated at the wet elements which are detected before each time stage 7a u i j n 1 2 u i j n δ t l u n 7b u i j n 1 1 2 u i j n u i j n 1 2 δ t l u n 1 2 the time step δt is calculated according to the cfl stability condition using the maximum stable courant number of 0 33 cockburn and shu 2001 and l is a 3 3 matrix including the discrete spatial operator vectors l 0 l 1x and l 1y these local operators contain robust evaluation of the spatial fluxes and topography gradient terms to ensure the well balanced property with wet dry front treatments kesserwani and sharifian 2020 these include riemann flux evaluation at the four interface centres in fig 1 from the reconstructed limits of the piecewise planar solutions at both sides of each interface centre using the hll riemann solver which is one recommend choice kesserwani et al 2008 the friction source term s f is not explicitly included in l and should instead be integrated elementwise at the start of each time step as described in shaw et al 2021 the updated coefficients u i j n 1 are now available on the 2d adaptive grid assembled at the previous time level n the information in u i j n 1 i e s s 0 s 1x s 1y with s h qx qy z should now be used to regenerate a new 2d adaptive grid this can be done by reapplying mra of mws for adaptive grid generation section 2 1 2 after initialising zero details for the flow vector s coefficients s h qx qy at the elements in the hierarchy of grids that did not belong to the 2d adaptive grid at time level n kesserwani and sharifian 2020 2 1 4 degradation to dynamic hwfv1 adaptivity for dynamic hwfv1 adaptivity the discrete vector of flow variables u h x y t and the discrete scalar topography zh x y are shaped as local piecewise constant solutions over each element and the basis ϕ is a scalar equal to 1 each physical component of u h x y t takes the form of a flat plane that is defined by one coefficient 8 u h x y t u i j ϕ h i j 0 q x i j 0 q y i j 0 1 h i j 0 q x i j 0 q y i j 0 here u i j is a vector of flow coefficients and zh x y is represented in the same way as 9 z h x y z i j ϕ z i j 0 1 z i j 0 the initialisation of coefficients on the finest uniform grid only uses eq 4a then mra of hw is applied for the 2d adaptive grid generation in a similar manner considering simplified scalar expression for the high pass and low pass filters kesserwani and sharifian 2020 on the 2d adaptive grid the update of the coefficients is performed using a forward euler time stepping scheme and l only includes the l 0 operator eq 10 this operator is based on the fv1 spatial discretisation where the hll solver s riemann flux evaluations consider piecewise constant solution limits at the two sides of each interface centre 10 u i j n 1 u i j n δ t l u n the time step δt is calculated according to the same cfl stability condition as the dg2 solver but with the maximum stable courant number of 0 5 kesserwani and liang 2012b once u i j n 1 are produced the regeneration of the 2d adaptive grid is performed as with dynamic mwdg2 adaptivity section 2 1 3 within the dynamic mwdg2 and hwfv1 adaptivity the filter formulae eqs 5 and 6 are applied every time step within the mra process to reconstruct intrinsic well balanced solution limits for any matching resolution required across the heterogeneously sized adjacent elements the reconstruction procedure is generally applicable without grading fig 2 a the 2d adaptive grid kesserwani and sharifian 2020 2 2 static dg2 and fv1 adaptivity on a fixed graded grid static dg2 and fv1 adaptivity operates on a fixed or static grid on which elementwise update of the flow coefficients is achieved as described previously respectively via eqs 7 and 10 the 2d adaptive grid is thus generated once after applying the mra of mws only once to analyse the time invariant topography coefficients section 2 1 2 compared to the grid generated from using the mra of hw that generated from using the mra of mws sensibly boosts the resolution coarsening kesserwani et al 2019 kesserwani and sharifian 2020 and will be preferred to run the dg2 and fv1 solvers on a graded grid shown later in section 3 1 which ensures that no element is more than one resolution level finer or coarser than its neighbouring elements fig 2b the grading of the fixed grid is necessary within the static adaptivity as the mra process is switched off over time which makes the rigorous filter formulae not applicable 1 1 applying the rigorous filter formulae eqs 5 and 6 would lead to spurious freezing the fluxes in time across the interface as the details of the flow vector do not get updated over time after grading conventional adaptive grid refinement treatments can be applied to reconstruct extrinsic well balanced solution limits at both side of the interface separating the heterogeneously sized adjacent elements detailed next in section 2 2 1 2 2 1 averaging of solution limits across adjacent elements of different sizes without grading the grid could include adjacent elements of different sizes where the numerical solutions are more than one resolution level apart from each side of the elements interface an example is shown in fig 2a where the red elements are two resolution levels finer than the neighbouring blue element at both sides of the finer element interface centres precisely well balanced solution limits can be unproblematically evaluated to integrate the fluxes within the update steps eqs 7 or 10 and thereby ultimately update the flow coefficients at the finer interface elements however the challenge arises when updating the flow coefficients at the coarse interface element from its right side fig 2a there is no rigorous way to aggregate the local solution limits along the finer element interface into a precisely well balanced local solution limit at the coarse element interface centre with grading this challenge can be reduced to estimating a coarse resolution limit by heuristic averaging from the limits available at the centres of the finer interface elements from the right side following the common reported procedure in conventional adaptive grid refinement techniques borthwick et al 2000 popinet 2003 kesserwani and liang 2012a donat et al 2014 bmt 2018 ghazizadeh et al 2020 dunning et al 2020 for example as shown in fig 2b the required solution limit at the right side is averaged from the solution limits at the interface centres of the two finer elements yellow points this averaging is exact for flat piecewise constant solution representations as with the fv1 solver taking the same value along each of the small element interfaces including at the centres with uneven piecewise planar solution representations as with the dg2 solver the averaging is heuristic as it only considers the values at the centres of each of the small element interfaces any of which may be different than the other values along a small element interface the heuristic nature of the averaging process within the dg2 solver may manifest in local inaccuracies in the predictions when there is high variability in a flow variable shown in section 3 2 3 gpu parallelisation with dynamic adaptivity to effectively parallelise multi wavelet based dynamic adaptivity on the gpu ensuring coalesced memory access and avoiding warp divergence are essential nvidia 2021 in cuda programming data of the coefficients and details should reside in gpu memory that is accessed by threads or workers threads should access contiguous memory locations for coalescing and batches of 32 threads or warps must avoid the execution of differing instructions to avoid divergence these requirements are not difficult to achieve when parallelising fv1 and dg2 on a uniform grid with equally sized elements shaw et al 2021 similar can be said to the updates eqs 7 and 10 within dynamic hwfv1 and mwdg2 adaptivity as matching resolution representations is a priori ensured from the filter formulae eqs 5 and 6 therefore it suffices to describe how these requirements can be met for the mra process that is responsible for achieving the dynamic adaptivity every time step section 2 1 2 to do so the recursive operations featured in the mra process must be reworked namely to ensure coalescing during the encoding of details and the decoding of leaf elements data and to avoid warp divergence when identifying the indices of the leaf elements these will be described for a hierarchy of grids up to l 3 without loss of generality the algorithmic implementation of the mra process on the gpu is presented in chowdhury et al 2022 which is newly extended to encompass dynamic mwdg2 adaptivity coalescing has been ensured by spanning the hierarchy of grids using z order curves to continuously index all the elements living within the hierarchy for each grid in the hierarchy a z order curve is created by following the so called morton code of each grid element by first interleaving the bits of the indices x and y of the element in binary representation fig 3 a and then converting of the resulting bit interleaved index to decimal form as shown in fig 3b sagan 1994 bader 2013 baert et al 2013 chowdhury et al 2022 z order curves are created for every grid in the hierarchy starting from the coarsest to the finest resolution grid to end up with a continuous span of the element indices all over the hierarchy fig 3c with this span the coefficients and details needed for encoding and decoding are now resident in adjacent memory locations zoomed in portion in fig 3c although the leaf elements coefficients and indices are available on the hierarchy the coefficients must be fetched to assemble the adaptive grid in parallel on the gpu and this can only be achieved by simultaneous traversal of the tree of details simultaneous tree traversal has been achieved based on the algorithm presented by karras 2012 initially designed for computer graphic applications the algorithm is applied to simultaneously climb the tree of details after continuous indexing of z order curves as shown in fig 4 a the starting point is to launch as many threads as the number of elements on the finest uniform grid namely 23 23 64 threads the threads are tasked to start simultaneous traversal from the single element on the coarsest grid each thread attempts to climb to the element on the finest grid indexed with the decimal converted from the morton code fig 4a during the simultaneous traversal by checking against the tree of details a thread stops as soon as it reaches a leaf element and records its index in memory an example can be seen in the hierarchy in fig 4a 4b where a thread will attempt to reach the element with index 45 climbing along the elements with indices 0 2 11 45 to stop at the leaf element with index 45 and record it in memory in doing so warp divergence is avoided because adjacent threads perform similar traversals due to the continuous indexing of the z curves spanning the hierarchy of grids and many of the threads climb to the same leaf elements without reaching any element on the finest grid for example as indicated in fig 4a 4b four threads climb up the elements with indices 0 2 and 11 one by one to finally settle for the elements with indices 45 46 47 48 located on the finest grid in contrast sixteen threads settle for the leaf element with index 1 which does not belong to the finest grid each of them recording the same index 1 in memory and this results in duplicates after the parallel tree traversal an array of indices is recorded in memory including the duplicate indices shown in fig 4b these duplicate indices are then scrutinised by the threads to also identify and record the indices of the four elements neighbouring the leaf elements from the east west north and south for example the thread that has already recorded the leaf element with index 1 at the bottom right of the array of 16 elements with index 1 will then be tasked to record the indices of the leaf element s direct neighbours namely the indices 1 47 1 and 14 shown in fig 4b the indices of the four neighbour elements are also stored in memory in turn resulting in duplicates the recorded duplicate indices of the leaf elements and their four neighbours are then removed from memory using stream compaction billeter et al 2009 after compaction the remaining indices that are unique to the leaf elements relevant to form the 2d adaptive grid are identified together with those of their four neighbouring elements the leaf elements coefficients and indices are then used to fetch the 2d adaptive as shown in fig 4c on which elementwise update of the coefficients is applied this completes the process for dynamic hwfv1 adaptivity however another step remains needed to complete the process with dynamic mwdg2 adaptivity namely after the first runge kutta stage eq 7a to ensure that the coefficients at the leaf elements neighbours are also up to date prior to applying the second runge kutta stage eq 7b this can be achieved by re encoding the coefficients obtained after the first runge kutta stage arguably running dynamic adaptivity on the gpu comes at a price of storing in memory at all times the entire data arrays spanning the hierarchy of grids which could entail enormous memory load with increase in size of the domain area and or in the fineness in the dem resolution 3 results and discussion dynamic mwdg2 and hwfv1 adaptivity is benchmarked against static dg2 and fv1 adaptivity on the same fixed grid that is also used to start dynamic adaptivity section 3 1 the benchmarking is aimed to evaluate how far their simulated results are close to a reference dg2 simulation performed on a uniform grid using the finest dem resolution r uniform dg2 three field scale test cases are selected with a uniform manning roughness parameter involving initially dry areas the simulations with dynamic adaptivity used an ε 10 3 to adapt grid resolution over time based on the details of both the flow variables and the topography section 2 1 in all the simulations the maximum resolution level l is selected to match the resolution r of the dem the cpu based solvers were run on a 3 2ghz intel i7 8700 using a single cpu core while the gpu based solvers were run on an nvidia quadro rtx 4000 for a total simulation time ts the selected test cases their flow characteristics and associated simulation parameters are summarised in table 1 the closeness of the results simulated from the four solvers to the reference uniform dg2 simulation or measured data is evaluated using the mean error and root mean square error rmse these error metrics are recommended for point data evaluations nguyen et al 2016 and are computed as follows 11 m e a n e r r o r i 1 n p p r e f n s r m s e i 1 n p p r e f 2 n s where p refers to the predicted flow variable water depth or level or velocity pref indicates the reference or measured variable and ns is the number of data points for quantitative comparison of flood inundation extent predictions the hit rate h false alarm f and critical success index c metrics are recommended wing et al 2017 hoch and trigg 2019 h measures how much the reference flood extent is covered by the simulated flood extent with h 1 indicating full coverage and h 0 otherwise f measures how much of the simulated flood extent is outside of the reference flood extent with f 0 indicating that there is no simulated portion outside of the reference flood extent and f 1 indicating that all the simulated flood extent is outside the reference flood extent the c metric combines h and f to weigh how much of the sum of the simulated and the reference flood extents is covered by the simulated flood extent c 1 indicates full coverage and c 0 otherwise 3 1 selection of the initial grid for the simulations to perform a fair comparison amongst dynamic mwdg2 and hwfv1 adaptivity and static dg2 and fv1 adaptivity simulations should start from the same fixed grid that refers to the grid predicted by mwdg2 with grading as justified in the following since all simulations started over dry areas the initial grids predicted by the mra of hw and mws within dynamic hwfv1 and mwdg2 adaptivity respectively were selected based on the details of the dems for each of the three test cases table 1 they are here analysed compared to the fixed grid predicted by the mra of mws after grading fig 5 shows the percentage of resolutions selected for grids predicted by the mra of mws with and without grading and that of hw covering the whole study areas the grids predicted by the mra of hw are more refined by selecting the highest resolution over most of the domain area in all the test cases black bars in fig 5 in contrast the grids predicted by the mra of mws without grading allow for coarser resolutions only using the finest resolution over 65 58 and only 20 over the domain area for the three test cases respectively red bars in fig 5 the grids predicted by the mra of mws with grading have finer portions covering 80 of the domain area with the finest resolution for the first two cases and 37 for the third test case green bars in fig 5 compared to the predicted grids by the mra of hw those predicted with the mra of mws with grading still allow coarser resolution providing better allocation of resolutions for the initial grids therefore all the initial grids predicted by dynamic hwfv1 adaptivity are not as efficient as a choice to start the simulations compared to the fixed grid predicted by the mra of mws with grading that will be used instead to start dynamic hwfv1 adaptivity the grids predicted by the mra of mws with and without grading are compared in fig 6 for the three test cases considering zoomed in portions framed in figs 7 11 and 14 appearing below both the non graded and graded grids are seen able to retain the finest resolutions along sharp topographic features while allowing coarsening in the areas with smooth topographies as expected the non graded grids have coarser resolutions than the graded grids which were used hereafter to run the simulations with static dg2 and fv1 adaptivity and to start the simulations with dynamic mwdg2 and hwfv1 adaptivity 3 2 carlisle 2005 flooding this test case is characterised by gradually propagating flood at city scale from multiple fluvial inflows because it has post event measurements for validation it is investigated first to validate the adaptive and non uniform grid solvers for real world flood simulation the study area is shown in fig 7 covering about 14 5 km2 of the city of carlisle the three day long flooding is initiated from three inflow hydrographs at the upstream points of rivers eden petteril and caldew with a maximum flow rate of 1200 m3 s 1 shown at the right panels of fig 7 surveyed maximum free surface elevations are available at 217 wrack marks and 46 water level points black dots and red crosses in fig 7 these will be compared against the maximum free surface elevations simulated by uniform dg2 and the four solvers i e with dynamic mwdg2 and hwfv1 adaptivity and with static dg2 and fv1 adaptivity in addition water depth time series will be recorded at 15 sampling points blue squares in fig 7 including at the three gauges of sheepmount botcherby bridge and denton holme for which in situ water depth measurements are available to further support the validation of the solvers the four solvers are first verified by comparing their maximum free surface elevation predictions against the measured data at the water level and wrack mark points fig 8 includes the histogram errors generated by the differences in free surface elevation between simulated and observed data at the measurement points x axis of fig 8 and the rmse and mean error for each solver simulation the uniform dg2 solver is the most accurate solver by having an rmse of 0 29 and a mean error of 0 05 also its histogram error peak is in the vicinity of 0 with the least skewness compared to the other solvers this indicates that the dg2 simulations on the uniform grid at the finest resolution r uniform dg2 can be reliably used as the reference solution in the next two test cases that lack validation data dynamic mwdg2 adaptivity exhibits the closest histograms to those of uniform dg2 with rmse of 0 37 and mean error of 0 09 which compare well with the errors reported in other studies neal et al 2009 horritt et al 2010 fewtrell et al 2011 static dg2 adaptivity leads to a slightly higher rmse error of 0 39 and a mean error of 0 12 and its histogram errors are centred at 0 1 implying an underprediction tendency for the free surface elevation dynamic hwfv1 adaptivity and static fv1 adaptivity resulted in rmses of 0 52 and 0 47 and mean errors of 0 43 and 0 32 respectively these together with the fact that their histogram errors are centred around 0 4 and 0 2 suggest that the fv1 based solvers on their grids involving non uniform resolutions tend to significantly overpredict the free surface elevation compared to the measurements for this test case the water level time series recorded at 15 sampling points are compared in fig 9 as shown earlier in fig 7 these samplings points are distributed over the whole study area three of which are in the river channels sheepmount botcherby bridge and denton holme six in the urban areas pallet yard substation brown bros bus depot water mark 1 and water mark 2 and six others in the rural areas building 1 and watermarks 3 to 7 the dg2 based solvers yield water level predictions that have the best agreement with the reference solution irrespective of the locations of the sampling points in contrast the fv1 based solvers significantly overpredict water depths at all the staging points this difference in the predictions is in line with the analysis of fig 8 and alternative studies liu and pender 2013 shaw et al 2021 it mainly arises from the differences in the accuracy order amongst the solvers in the representation of flow and terrain data the dg2 based solvers use piecewise planar representations for the flow variables the topography and the friction integration whereas the fv1 based solvers use piecewise constant representations therefore the predictions from the fv1 based solvers would be more impacted by the growth of numerical diffusion compared to those from the dg2 based solvers ayog et al 2021 shaw et al 2021 this impact is particularly magnified with the fv1 based solvers because they have coarse resolution portions on their grids at which larger numerical diffusion accumulate yet affecting the overall predictions i e for this long duration simulation over a large and rough area this observation can also be supported by looking at the predictions by uniform fv1 at the finest resolution r fig 9 which are closer to reference solution that those by fv1 based adaptivity as in zhao and liang 2022 uniform fv2 ayog et al 2021 at the finest resolution r does not improve the uniform fv1 predictions indicating that resolution coarsening of piecewise constant representations is the key factor that deteriorated the predictions fig 10 includes the maximum flood extent predictions by the solvers with dynamic and static adaptivity along with the reference predictions by uniform dg2 the flood extent predicted by the dynamic mwdg2 adaptivity is the closest to the reference extent with the lowest f of 0 005 and the highest c of 0 98 static dg2 adaptivity also shows a good agreement with the reference extent with a c of 0 95 with slight underpredictions in limited areas close to the urban banks of rivers caldew and petteril the fv1 based solvers lead to the widest flood extent compared to the reference extent most notably over the urban area in the west of river caldew this is reflected in their lowest c of 0 89 resulting from dynamic hwfv1 adaptivity and 0 90 resulting from static fv1 adaptivity when modelling water level and flood extent for gradually propagating floods across urban and rural areas over long periods static dg2 adaptivity seems to lead to accurate enough predictions these predictions marginally improve with dynamic mwdg2 adaptivity making it a compelling alternative amongst the fv1 based solver static fv1 adaptivity overpredicts the reference predictions with no major improvement seen by instead using hwfv1 s dynamic adaptivity the performance of these solvers is further compared next for test cases with smaller areas and shorter simulation times with a more elaborate analysis that includes velocity predictions over smoother topographies with lower manning parameters 3 3 hypothetical flood propagation and inundation in thamesmead the test case involves a slowly propagating flood from a hypothetical defence failure over complex terrain in the thamesmead district the flood is assumed to occur from a breach along a 150m long defence structure through which water breaches from river thames into a 9 km 4 km floodplain an aerial view of the floodplain is shown in fig 11 along with the location of the inflow breach and four sampling points g1 g2 g3 and g4 where water level and velocity time series are recorded the inflow discharge lasts for 10 hr with a peak of 200 m3 s 1 reached during the second to the fourth hour of flooding see fig 11 the flood wave is expected to pass a narrow channel that cuts through a railway embankment located across most of the domain from southwest to northeast fig 12 includes the water level and velocity time series recorded at g1 to g4 for the adaptive and non uniform grid solvers and from the reference solution the rmse values comparing the predicted time series against the reference time series are listed in table 2 the water levels predicted by both dg2 based solvers are reasonably close to the reference solution with rmses being less than 0 02 static fv1 adaptivity is also shown to closely predict the reference water level time series with small deviations leading to rmses limited to 0 08 dynamic hwfv1 adaptivity however shows more obvious deviations by overpredicting the water levels at points g4 and g3 which are closer to the inflow while at g2 and g1 where the flow is relatively slower it leads to delayed arrival times these deviations are also reflected in higher rmses up to 0 14 the different behaviour of dynamic hwfv1 adaptivity compared to with static fv1 adaptivity likely occurred from the accumulation of thresholding errors that becomes significant due to deeper traversal across resolution levels on a grid that has more refined portions as shown in kesserwani and sharifian 2020 excess in the refined portions on the grid within the dynamic hwfv1 adaptivity arise from the first order piecewise constant representations and using a stricter ε value will introduce further refinements without adding notable gain in the predictive accuracy in terms of the velocity dynamic mwdg2 adaptivity leads to almost identical predictions to those from the reference uniform dg2 solver with negligible rmses limited to 0 02 static dg2 adaptivity however shows small deviations at all four points these deviations are expected as static dg2 adaptivity could be affected by the errors from the heuristic nature in averaging the slope coefficients discussed in section 2 2 1 which are expected to be more present in the velocity predictions as the velocity has a more sensitive variability than the water level this can also be supported by the fact that the highest deviation is observed at g3 which recorded higher velocities resulting in a higher error an rmse of 0 078 static fv1 adaptivity predicts the reference velocities at g4 with an rsme of 0 022 but underpredicts the velocity at the other three points with rmses up to 0 109 compared to static fv1 adaptivity dynamic hwfv1 adaptivity performs equally well at points g4 and g3 but shows more pronounced underpredictions at the farther points g1 and g2 fig 13 contrasts the flood inundation maps predicted by the four solvers to the reference map after the 10 hour simulations dynamic mwdg2 adaptivity yields the closest predictions to the reference extent with the highest c of 0 93 static dg2 adaptivity leads to slight underpredictions at the southern areas of the domain leading to a close agreement with the reference extent with a c of 0 91 the fv1 based solvers predict the reference extent less accurately with a c of 0 89 achieved by static fv1 adaptivity and a lower c of 0 82 achieved by dynamic hwfv1 adaptivity suggesting the latter predicts a narrower extent i e in the south and westernmost regions also confirmed by its lowest h of 0 89 for this test case static dg2 adaptivity is able to provide accurate enough predictions for water level and flood extent but can fall short in predicting velocities leading to increasingly deviated predictions with higher velocities dynamic mwdg2 adaptivity however provides the best quality predictions to those of the reference uniform dg2 solver for the velocities as well as the water levels and flood extent the opposite is observed for the predictions made by the fv1 based solvers static fv1 adaptivity predicts flood extents water level and velocity time series that are closer to the reference predictions than those predicted by dynamic hwfv1 adaptivity the latter given its relatively more refined grid analysed next in fig 16 leads to accumulation of thresholding errors that can impact its predictions over time to make them less accurate than those of static fv1 adaptivity this suggests favouring static fv1 adaptivity over dynamic hwfv1 adaptivity for modelling slowly propagating floods over a real dem for a long duration simulation and dynamic mwdg2 adaptivity over static dg2 adaptivity to acquire the most accurate predictions the solvers are next compared for a test case involving rapid to gradual flood flow propagation 3 4 flood wave along a valley the performance of the dynamic mwdg2 and hwfv1 adaptivity versus static dg2 and fv1 adaptivity is finally compared for reproducing a scenario that involves a rapidly propagating flow turning to a gradually propagating flow the flood wave arises from an inflow that enters the upstream of a 17 0 km 0 8 km valley and propagates downstream fig 14 shows the terrain of the valley including 7 sampling points that are typically used to compare water level and velocity time series as shown in fig 14 the inflow hydrograph has a high peak discharge of 3000 m3 s 1 lasting for less than 2 hr during the first 3 5 hr the flood wave undergoes a rapidly propagating flow stage to then become in a stage of gradually rapidly propagating flow as the water flows downhill filling in the topographic depressions to reach the larger pond located downstream the latter stage begins at about 5 hr to last until 30 hr during which the flow slows down by the friction to approach a steady state fig 15 includes the water level and velocity time series recorded for the four solvers with dynamic and static adaptivity at the sampling points and those produced by the reference uniform dg2 solver following other studies cited in table 1 the time series are analysed for points 1 3 and 5 located at the upstream middle and downstream of the topographic depressions the rmse values from the predicted time series with respect to those of the reference solution are included in table 3 the velocity time series figs 15d 15f are recorded for up to 5 hr and are discussed first to analyse the performance of the solvers during the rapidly propagating flow stage dynamic mwdg2 adaptivity predicted the reference velocities perfectly leading to the smallest rmses limited to 0 06 this is notably observed at point 3 where the solver with dynamic mwdg2 adaptivity is the only one that perfectly trails the small transient variations appearing after 1 hr these velocity variations were detected with the uniform fv2 solver simulation in ayog et al 2021 on the finest dem resolution but dynamic mwdg2 adaptivity could capture them despite the presence of coarser resolution portions on its grid static dg2 adaptivity performs equally well at point 1 fig 15d where the earliest arrival time is recorded at point 5 fig 15e it is able to partly capture the small transient variations but overly predicts the reference velocity leading to an rmse of 0 104 at point 5 fig 15f where the flood is driven by the topography and friction effects static dg2 adaptivity predicts comparable velocities up to 3 5 hr but its predictions are affected by numerical disturbances afterwards in line with the past observations made for fig 12 these spurious disturbances can be attributed to the heuristic nature of averaging slope coefficients section 2 2 1 the fv1 based solvers lead to good predictions at points 1 and 5 in good agreement with the reference velocities both fail to capture the small scale velocity variations at point 3 leading to rmses up to 0 28 but dynamic hwfv1 adaptivity shows a better performance in capturing velocity peaks suggesting that it can still be a good choice for short duration simulations of highly dynamic flows water level time series are compared in figs 15a 15c to analyse the performance of the solvers during the gradually propagating flow stage again dynamic mwdg2 adaptivity leads to the best agreement with the reference water levels at all three points with rmses less than 0 08 static dg2 adaptivity only closely predicts the reference water level at point 1 but tends to underpredict it at point 3 leading to the highest rmse of 0 295 this underprediction is intensified at point 5 which is likely due to the impact of the spurious numerical disturbances arising in the velocity predictions the fv1 based solvers predict closely the reference water levels at point 1 but dynamic hwfv1 adaptivity shows an overprediction tendency at points 3 and 5 by 0 2m this tendency seems to only occur in the long run after the flow stagnates to steady state where the accumulation of thresholding errors from the deeper traversal across resolution levels becomes irrelevant when modelling flows with rapid to gradual transitions this test case suggests that static dg2 adaptivity is not the best choice as observed in section 3 3 its velocity predictions can be disturbed by averaging errors that tend to grow when the flow decelerates causing underpredicted water levels dynamic mwdg2 adaptivity comes in as a viable alternative to preserve the highest quality possible of the reference predictions no matter if the flow is gradual or rapid static fv1 adaptivity although not as good on velocity predictions is still a good option to get acceptable water level predictions during the gradually propagating flow stage dynamic hwfv1 adaptivity could only perform better over the short period of rapidly propagating flow in the long run it can be affected by the accumulation of thresholding errors inflicting less accurate water levels thus may not be a better alternative to static fv1 adaptivity for long duration simulation of decelerating floods 4 efficiency analysis the efficiency of the solvers is analysed in terms of reduction in the number of elements over that on the uniform grid at the finest resolution r speedups from the runtime achieved on a single cpu core to identify the difference between static and dynamic adaptivity costs and the extent of runtime cost reduction with dynamic adaptivity for the gpu implementation the percentages of reduction in the number of elements are evaluated using eq 12 12 reduction of elements elements no on the uniform grid elements no on the adaptive grid elements no on the uniform grid 100 the reductions are first evaluated for the fixed grid used with static dg2 and fv1 adaptivity and then for the 2d adaptive grids predicted by dynamic mwdg2 and hwfv1 adaptivity during the simulations these evaluations are shown in fig 16 for the three simulated scenarios carlisle 2005 flooding the hypothetical flood in thamesmead and the flood wave along a valley section 3 2 3 4 in the first two scenarios the dems are more complex including urban features than that of the third scenario because of this less reduction in the number of elements is achieved on the fixed grid in the first two scenarios 13 and 9 respectively compared to the third scenario where the reduction is around 47 this results in lower speedups with dg2 and fv1 static adaptivity with reference to the uniform dg2 solver informed by the analysis of cpu runtimes listed in table 4 namely for the scenario with 9 reduction speedup ratios of 5 4 and 1 7 were achieved respectively which increased to 7 5 and 2 8 for the scenario with 13 reduction and to 25 7 and 6 5 for the scenario with 47 reduction the enhancement in the speedups by moving from static dg2 and fv1 adaptivity to dynamic mwdg2 and hwfv1 adaptivity are found to be 0 9 and 2 6 for the scenario with 9 reduction 1 8 and 1 9 for the scenario with 13 reduction 2 7 and 5 7 for the scenario with 47 reduction respectively this speedup analysis indicates that the larger the reduction in elements the more the speedup gain with static adaptivity and more enhancement in speedup would be gained by moving to dynamic adaptivity as dynamic adaptivity started from the fixed grids used with static adaptivity this analysis implies that the key parameter to look at when weighing the expected or baseline speedup is the reduction in elements with respect to the finest uniform grid the higher the reduction the more the merit from deploying dynamic adaptivity to reduce the runtime cost therefore making the choice of when to use static or dynamic adaptivity depends on the properties of the test first in relation to the features of the dem and then to the nature of the flood flow this is discussed next in particular for dynamic mwdg2 adaptivity to identify when it would be a fast enough alternative to uniform dg2 in spite of running the gpu implementation over time the number of elements on the dynamic hwfv1 and mwdg2 adaptivity increases leading to an expected reduction in their efficiency dynamic hwfv1 adaptivity uses a much higher number of elements than dynamic mwdg2 adaptivity in all the scenarios in the first two it leads to grids that have less than 5 reduction in elements over the fine uniform grid confirming its impracticality for simulating slow to gradually propagating floods over a long duration in the third scenario hwfv1 s grid reaches 13 to 20 reduction in elements in all the scenarios dynamic mwdg2 adaptivity offers a greater reduction in elements while leading to more accurate predictions sections 2 3 and 2 4 while remaining faster to run than the uniform dg2 simulations table 4 dynamic mwdg2 adaptivity s speedup ratios for the cpu simulations are around 1 5 for the first two scenarios and higher around 2 3 for the third one that has more reduction in the number of elements on the initial grid nonetheless the costs for the mwdg2 runs on a single cpu core are unfeasibly large for practical simulations over largely dry areas hindered by its need to regenerate the 2d adaptive grid in serial every time step with the proposed gpu implementation for dynamic mwdg2 and hwfv1 adaptivity their runtimes are reduced significantly and remain smaller than the runtimes required by uniform dg2 simulation on the gpu table 4 however dynamic hwfv1 adaptivity leads to predictions that are somewhat less competitive than those made by static fv1 adaptivity sections 2 3 and 2 4 and is not as valid as an option compared to dynamic mwdg2 adaptivity compared to the single core cpu runs mwdg2 on the gpu achieved gains in speedup of around 41 30 and 53 5 times for the three scenarios respectively dynamic mwdg2 adaptivity also leads to runtimes that are much less than the clock time and the runtimes of uniform dg2 on the gpu namely achieving speedups of 1 05 1 75 and 3 67 respectively less speedups are expected for the first two scenarios given the relatively less reduction on their initial grids compared to the third scenario consequently using dynamic mwdg2 adaptivity on the gpu can still be more efficient than uniform dg2 on the gpu for flood simulations however the extent of its efficiency gain primarily depends on how much reduction in the number of elements is achieved on the initial grid with respect to the finest uniform grid of the dg2 solver and secondarily on the dynamic transients involved in the flood in question the more the reduction and the stronger the flow s dynamics the more the efficiency gain from using dynamic mwdg2 adaptivity 5 summary conclusions and recommendations real world flood simulators often use first order finite volume fv1 solvers of the shallow water equations with efficiency enhancements to include parallelisation on graphical processing units gpus and static adaptivity on a fixed grid a second order discontinuous galerkin dg2 solver greatly increases the accuracy in the predictions but is costly to run on uniform grids and its potential for use as an alternative to finite volume based solvers with static adaptivity was newly investigated alternative solvers with multi wavelet based dynamic adaptivity have been developed that adapt and scale local dg2 and fv1 numerical solutions while applying the multiresolution analysis mra to select the 2d adaptive grid over time the mra of multiwavelets mws with dg2 piecewise planar solutions leads to dynamic mwdg2 adaptivity and that of the haar wavelet hw with fv1 piecewise constant solutions to dynamic hwfv1 adaptivity the performance of dynamic adaptivity was also newly explored for practical real world simulations to find out when they yield more accuracy than static adaptivity and how far the runtimes of dynamic adaptivity become affordable when the mra of mws and hw is re worked to run on the gpu therefore the predictive capabilities of dynamic mwdg2 and hwfv1 adaptivity were compared to static dg2 and fv1 adaptivity for complex real world flooding scenarios the static dg2 and fv1 adaptivity used a fixed grid achieved by applying the mra of mws to the time invariant features of digital elevation model dem the fixed grid had to be graded to be able to adapt the dg2 and fv1 flow solutions across the interfaces with adjacent heterogeneously sized grid elements the graded fixed grid was also the initial grid used to run dynamic adaptivity for a fair assessment of performance dynamic mwdg2 and hwfv1 adaptivity and static dg2 and fv1 adaptivity were applied to reproduce three field scale flood simulation case studies involving real topographies and different flows from slow to rapidly propagating their predictive accuracy was evaluated by measuring the closeness of their predictions to the reference predictions made by uniform grid dg2 solver simulations using the finest dem resolution uniform dg2 the evaluations included qualitative and quantitative analysis of maximum water levels water levels velocities time series spatial flood maps and an efficiency analysis considering reduction in the number of elements during a simulation and runtime costs on a single cpu core to complete the simulation and the speedup gained with dynamic mwdg2 and hwfv1 adaptivity by using the gpu parallelised versions the evaluations show that static adaptivity is a better choice than dynamic adaptivity to simulate slow to gradually propagating flood flows for such flows the static adaptivity yields closer predictions to the reference uniform dg2 predictions and is faster to run than dynamic adaptivity that is hindered by the overhead costs of the mra amongst static dg2 and fv1 adaptivity that of dg2 seems to be the best choice to capture small scale time variations in the velocities and more accurate flood maps static fv1 adaptivity though not as accurate as static dg2 adaptivity is still a valid alternative to acquire similar water level predictions at reduced runtimes as for dynamic mwdg2 and hwfv1 adaptivity it remains less expensive to run than the reference uniform dg2 solver on a single cpu core but gain major speedups on the gpu where their simulation times become less than the clock times the piecewise constant representations within dynamic hwfv1 adaptivity yields to more refinement on the 2d adaptive grid causing accumulation of thresholding errors from the mra of hw across a deeper tree traversal in the long run this manifests in overly predicted water levels making dynamic hwfv1 adaptivity or even a second order finite volume variant that uses the mra of hw with piecewise constant representations not ideal for long duration simulations with slowly propagating flows dynamic mwdg2 adaptivity yields the best quality predictions for both water levels and velocities and its 2d adaptive grid involves more sensible resolution coarsening as the flow remains in a state of gradual to slow propagation for a rapidly propagating flow dynamic mwdg2 adaptivity seems to excel in closely reproducing the predictive accuracy of the reference uniform dg2 predictions where any other choice for the adaptivity underperform static dg2 adaptivity became affected by spurious disturbances whereas static fv1 adaptivity could not closely replicate the reference velocity predictions in terms of speedup over the reference uniform dg2 simulations on the gpu dynamic mwdg2 adaptivity always remained faster but the speedup rate of dynamic adaptivity is mainly dependant on the reduction in the number of elements on the fixed grid relative to the finest uniform grid this suggests that gpu parallelisation with dynamic mwdg2 adaptivity is useful to maximise accuracy and efficiency when simulating flood events driven by a fast flow propagation e g tsunamis or dam breaks for uniform resolution dems leading to at least 15 reduction in the number of elements on its initial fixed grids credit authorship contribution statement georges kesserwani conceptualization methodology formal analysis supervision project administration funding acquisition writing original draft writing review editing mohammad kazem sharifian conceptualization methodology software visualization investigation data curation writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements data and software accessibility we wish to thank paul bates university of bristol for sharing the validation data for the carlisle 2005 test case and mr alovya a chowdhury university of sheffield for the technical support to setup and run dynamic mwdg2 and hwfv1 adaptivity on the gpu this work was supported by the uk engineering and physical sciences research council epsrc grant ep r007349 1 it is part of the seamless wave project software infrastructure for multi purpose flood modelling at various scales based on wavelets https www seamlesswave com the simulation results reported in section 3 are available on zenodo sharifian and kesserwani 2021 and the dems can be accessed by contacting the uk environment agency the cpu codes for static dg2 and fv1 adaptivity can be shared upon request and those of dynamic mwdg2 and hwfv1 adaptivity are available on zenodo sharifian and kesserwani 2020 the gpu implementation of the fixed grid generator and of dynamic mwdg2 and hwfv1 adaptivity have been incorporated into the open source lisflood fp8 1 hydraulic modelling packages and will be available in the next version release 10 5281 zenodo 4073011 for the purpose of open access the author has applied a creative commons attribution cc by licence to any author accepted manuscript version arising 
77,flow events with low frequency often cause severe damage especially if their magnitudes are higher than suggested by historical observations the heavier right tail of streamflow distribution indicates the increasing probability of high flows in this paper we investigate the role played by spatially variable rainfall in enhancing the tail heaviness of streamflow distributions we synthetically generated a wide range of spatially variable rainfall inputs and fed them to a continuous probabilistic model of the catchment water transport to simulate streamflow in five german catchments with distinct properties in size and topography meanwhile we used a comparable approach to analyze rainfall and runoff records from 175 german catchments we identified the effects of spatially variable rainfall on the tails of streamflow distributions from both simulation scenarios and data analyses our results show that the tail of streamflow distribution becomes heavier with increasing spatial rainfall variability only beyond a certain threshold this finding indicates the capability of catchments to buffer growing heterogeneities of rainfall which we term catchment resilience to increasing spatial rainfall variability the analyses suggest that the runoff routing through the river network controls this property in fact both small and elongated catchments are less resilient to increasing spatial rainfall variability due to their intrinsic runoff routing characteristics we show the links between spatial rainfall characteristics and catchment geometry and the possible occurrence of high flows the data analyses we performed on a large set of case studies confirm the simulation results and provide confidence for the transferability of these findings keywords streamflow distributions spatial rainfall variability heavy tails response time distributions catchment resilience extreme flows data availability the authors do not have permission to share data 1 introduction extreme streamflow events can occur unexpectedly and can cause economic devastation and threaten human safety the extremeness of streamflow is referred to low frequency and high magnitude among the historical observations for certain regions which is commonly shown in the heavy tail of a streamflow distribution heavy tailed distributions are used to be defined as extreme values that are more likely to occur than would be predicted by distributions with exponential asymptotic behavior el adlouni et al 2008 this sizable probability of the occurrence of extreme streamflow is a marking of enhanced flood hazard in respect of flow frequency and magnitude heavy tailed streamflow occurs in many catchments around the world katz et al 2002 bowers et al 2012 it causes severe problems as humans tend to underestimate risk in heavy tailed distributions taleb 2007 hence it is of the utmost importance to understand the hydrological causes of heavy tails in streamflow distributions which is also important for catchments with observed streamflow records not long enough to derive heavy tail behavior from historical data wietzke et al 2020 and in ungauged catchments yokoo and sivapalan 2011 moreover investigating the role of emerging heavy tails in streamflow distributions is a valuable tool for linking modifications of extreme streamflow to changes in climate conditions basso et al 2015 potential variables controlling heavy tailed streamflow distributions have been suggested in previous studies e g drier climatic conditions sivapalan et al 2005 smaller catchment size villarini and smith 2010 non linear runoff response to precipitation gioia et al 2008 basso et al 2015 however the generation processes and exact causative factors of heavy tailed streamflow distributions are still poorly understood regarding causative factors of extreme streamflows rainfall is often considered an important issue e g bracken et al 2008 arnell and gosling 2016 wasko and sharma 2017 spatial rainfall variability has been proved as non negligible to accurate streamflow prediction e g singh 1997 zoccatelli et al 2011 zhao et al 2013 particularly it has been suggested as more important than the temporal rainfall structure peleg et al 2017 to evaluate the impacts of climate changes on extreme streamflow events fatichi et al 2016 the increasing trend in the occurrence of localized and extreme rainfall events has been found under global warming conditions donat et al 2016 pendergrass 2018 li et al 2019 myhre et al 2019 a considerable rise in spatial rainfall variability caused by the increasing intensity of extreme rainfall and decreasing spatial extent have been discussed in studies based on observations wasco et al 2016 peleg et al 2018 and modeling peleg et al 2022 furthermore the change of spatial rainfall variability itself has been shown to be more impactful on floods than the component of rainfall intensity peleg et al 2022 however traditionally the focus of the effects of spatially variable rainfall on streamflow has been on the variability of a single rainfall storm or the magnitude of the resulting peak discharge borga et al 2007 viglione et al 2010 paschalis et al 2014 lu et al 2017 few researchers have addressed the issue of the effects of continuous spatially variable rainfall on streamflow distributions even though studies of flood frequency analysis have provided some insights into flood hazards based on peak discharges e g menabde and sivapalan 2001 kay et al 2006 fiorentino et al 2007 kjeldsen et al 2014 flood hazards based on variations between low and high flows remain poorly understood furthermore long term streamflow response e g cumulative streamflow distributions to rainfall is linked with multiple hydrological processes and complex interactions between catchment units there is still some controversy surrounding the impacts of spatially heterogeneous rainfall on streamflow due to variable climate conditions viglione et al 2010 zhao et al 2013 catchment sizes merz and blöschl 2009 zhu et al 2018 or the heterogeneities in other catchment attributes struthers and sivapalan 2007 harman et al 2009 rogger et al 2012 hence it remains a great challenge for hydrologists to understand the linkages between the changing characteristics of rainfall and high flows sharma et al 2018 pointed out that one of the foremost issues which is still missing is the relationship between catchment size catchment geometry and storm characteristics e g extent duration intensity meanwhile providing a corresponding data validation to modeling results is challenging a general investigation of the effects of spatial rainfall variability from both simulation scenarios and data analyses is needed to fill the knowledge gap we address two research questions 1 what is the role of the spatial rainfall variability on heavier tailed streamflow distributions and 2 does this role be dependent on catchment sizes and shapes we aim to investigate the research questions using both simulation scenarios and data analyses this paper is organized as follows section 2 describes the study catchments and the hydrological data section 3 describes the generation of spatially variable rainfall the continuous probabilistic model of the hydrologic response the indices of tail heaviness and catchment characteristics and the approaches for data analyses in section 4 the results of the effects of spatial rainfall variability on streamflow distribution tail heaviness are described under different catchment sizes and shapes both from simulation scenarios and data analyses the physical interpretations of the results and remarks from the literature are discussed in section 5 the main conclusions are summarized in section 6 2 data the study is based on daily rainfall and streamflow observations for a set of 175 german catchments taken from tarasova et al 2018 the catchment areas vary from 36 to 23 700 km2 with a median value of 688 km2 catchments influenced by large reservoirs or control gates lehner et al 2011 and affected by visible anthropogenic streamflow disturbances are disregarded the length of daily streamflow and rainfall time series ranges between 37 and 63 years between 1951 and 2013 with a median value of 61 years we computed the specific i e per unit catchment area streamflow at each catchment outlet hereafter we use the simpler term streamflow instead of specific streamflow daily rainfall time series for each catchment was derived from the regionalisierung der niederschlaghöhen regnie dataset which is a 1 km2 resolution rainfall field interpolated from point observations through multiple regression provided by the german weather service rauthe et al 2013 this study referred to only summer periods to avoid bias from snow melting which is not considered in our modeling framework see sec 3 2 summer season was identified as june to august as suggested by beurton and thieken 2009 for german catchments daily temperature time series in the considered catchments were generated from the german weather service observations by means of external drift kriging using elevation as an explanatory variable zink et al 2017 we applied the temperature to estimate potential evapotranspiration using the thornthwaite 1948 equation five of the 175 catchments were selected for scenario simulations fig 1 and table 1 the delme river basin at holzkamp 98 km² to represent small size the ilm river basin at niedertrebra 887 km² to represent medium size and the amper river basin at inkofen 2841 km² to represent large size form the first group of basins used in the simulations for they have various catchment sizes while their drainage densities dd horton 1932 and elongation ratios re schumm 1956 are similar the ilm river basin at niedertrebra more elongated re 0 45 the innerste river basin at heinde less elongated re 0 78 and the unstrut river basin at erfurt moebisburg circular re 0 90 form the second group of basins used in simulations for they have various catchment shapes while their drainage densities and sizes are similar a 100 m resolution digital elevation model dem retrieved from the shuttle radar topography mission srtm was used to generate the river networks of the five select catchments river networks were determined by means of the arc hydro tools with the recommended threshold i e 1 for stream determination esri 2009 hydrologic response units hrus were defined as the drainage area between neighboring nodes of the river network or as the area draining to the uppermost nodes 3 methods we applied a stochastic approach to generate synthetic rainfall fields and fed the results as the input of a non gridded continuous hydrological model the spatial context is based on catchment units i e hrus the output of the long term hydrological response was used for evaluating the tail heaviness of the streamflow distribution data analysis was presented in a comparable approach to the synthetic framework 3 1 generation of spatially variable rainfall we first summarized the observed rainfall fields from the regnie dataset and identified the gamma distribution as the fairest distribution to represent the spatial variabilities of rainfall over the entire catchment within five select catchments see supporting information text s1 and fig s1 then we generated random variables from a pre assigned gamma distribution as the rainfall depths of each day which were then allocated to each hru to form the synthetic rainfall field we systematically considered three critical components the spatial rainfall variability the varying degree of spatial rainfall variability in time and the rainfall autocorrelation in space in our framework fig 2 exemplary illustrates the synthetic framework and the distinctions between components fig 2a shows the uniform case where the synthetic rainfall field is uniformly distributed in space with the average rainfall depth of observations based on the regnie dataset for the entire catchment and follows the observed time series the hydrological response generated from this case is considered the reference point in this work fig 2b shows the first scenario which encompasses the spatially variable rainfall field with a fixed spatial variability measured as coefficient of variation of rainfall for all days while every day exhibits randomly spatial rainfall patterns alike ayalew et al 2014 again for each day the catchment s average synthetic rainfall depth equals the observed value we implemented one more process the varying variability in time as the second scenario fig 2c the spatial variability changes day by day in this case with the catchment s average synthetic rainfall depth each time equal to the catchment average calculated from regnie and the spatial pattern of each day is random in addition we implemented another process the rainfall autocorrelation in space as the third scenario fig 2d the rainfall field of each day is constructed by a stochastic spatial autocorrelation function while the spatial rainfall variability is fixed in time and the mean depth follows the observations the framework starts from the most simplified case and adds different sophisticated components step by step to distinguish between effects on the tail of the streamflow probability distribution caused by different components the parameters of the gamma distribution were assigned based on the requests of different scenarios the shape parameter k of the gamma distribution was either fixed for all days scenarios 1 and 3 or allowed to vary randomly within a specified range scenario 2 the scale parameter was then computed by setting the mean of the gamma distribution equal to the average observed daily rainfall each realization applied one setting of the parameters of a gamma distribution for the entire time series for the rainfall fields with fixed variability we imposed fifty two different values of k between 103 and 10 4 see supporting information table s1 which resulted in a wide range of variabilities from extremely low near to homogeneous with the largest k to extremely high when the smallest k are utilized for the rainfall fields with varying variability the shape parameter k of the gamma distribution was changed day by day in particular we allowed it to fluctuate randomly around a central value k0 within a specified range b b we generated rainfall fields characterized by low to high degrees of varying variability by changing the width of this range and assigning to b twenty different values between 0 05k 0 and k 0 we set k 0 10 1 i e an intermediate value among those analyzed for k in the fixed variability scenario see supporting information table s2 with this approach we generated variations of the spatial variability across events while controlling the average spatial variability within events to highlight effects due to the changing of spatial rainfall variability only a hundred stochastic realizations for each specified shape parameter were generated to assess the uncertainty of the results we adopted three distinct indices eqs 1 to 3 to evaluate the degree of variability of the synthetically generated spatial rainfall fields the first index is the coefficient of variation in space cvspace of the rainfall depth assigned to all catchment units in each day which we termed cvspace t for day t 1 c v s p a c e t 1 u u 1 u d u t d t 2 d t where du t mm is rainfall depth at catchment unit u on day t d t is the spatial mean of rainfall on day t and u is the total number of catchment units the second index is the temporal mean of the first index which characterizes the average spatial variability of rainfall across all wet days i e days with rainfall 0 of the time series it is computed as 2 c v i n 1 t t 1 t c v s p a c e t where t is the total number of wet days in the rainfall time series of a catchment the third index is the temporal coefficient of variation of the first index which represents the fluctuation of the spatial rainfall variability from one day to the other it is calculated as the coefficient of variation of cvspace across all wet days i e days with rainfall 0 in the time series 3 c v c r o s s 1 t t 1 t c v s p a c e c v i n 2 c v i n note that for the case of uniform rainfall both cvin and cvcross are equal to zero in the fixed variability scenario cvcross is always equal to zero and different values of cvin are investigated whereas cvcross is different from zero in the varying variability scenario meanwhile fig 3 shows the range of the event based spatial rainfall variability panel a and the coefficient of variation of the spatial rainfall variability in time panel b from observations the blue lines indicate the synthetic indices generated in this framework that match the majority of the cases and thus are representative of the real world rainfall variabilities in addition examples of observed rainfall fields with different spatial rainfall variabilities within the considered range are displayed in the supporting information fig s2 rainfall fields with a stochastic spatial autocorrelation were generated by a rearrangement matrix peleg and morin 2014 we first derived the spatial rainfall autocorrelation function of the observations from the average of the integrated rainfall field of all the wet days for each catchment bacchi and kottegoda 1995 the pearson correlation coefficient of rainfall depths between each hru and the n th nearest hru was computed as a function of the spatial lag i e n th nearest hru grillenzoni 2022 the correlogram curve between 0 th to nmax th nearest hru was used as the spatial rainfall autocorrelation function in which nmax was determined by the corresponding correlation coefficient equal to or below zero the rearrangement matrix can then be derived based on the spatial rainfall autocorrelation function and two calibrated parameters peleg and morin 2014 the synthetic rainfall depths generated by an assigned gamma distribution can finally be reallocated in hrus based on this rearrangement matrix and thus were distributed in the entire catchment stochastically while preserving the observational spatial autocorrelation fig 4 uses the ilm river at the gauging station of niedertrebra as an example of this stochastic simulation process for each catchment among five select catchments we randomly generated five hundred realizations within the same range of spatial rainfall variability of scenario 1 and compared their effects on the tail heaviness more details and parameters used for the five select catchments are stated in the supporting information text s2 and table s3 in summary we used data based synthetic rainfall fields to investigate a wider range of variability than the one that has been observed the framework allows for isolating and analyzing separately the roles played by spatial rainfall variability occurring within the same rainfall event or by changes of spatial variability across events and the potential effects of spatial rainfall autocorrelation thus enabling an understanding of the effect of each of these components 3 2 continuous probabilistic model of the hydrologic response we used a well established probabilistic model of water transport at the catchment scale rodriguez iturbe and valdes 1979 rinaldo and rodriguez iturbe 1996 d odorico and rigon 2003 rinaldo et al 2006 nicὀtina et al 2008 rigon et al 2016 to simulate streamflow at the outlet of catchments forced by spatially variable rainfall fields the model accounts for three key components see supporting information fig s4 1 the soil water balance in hillslopes 2 the probability distributions of transit times in the hillslopes of catchment units here assumed to be stationary in time and 3 the response time distribution in channels derived from a geomorphological analysis of the river network the first component represents the water balance among rainfall inputs evapotranspiration and leaching to subsurface flow in each catchment unit 4 d v t d t i t e t t l t a where v is the water storage in the root zone mm3 i is the infiltrated rainfall depth mm et is the evapotranspiration mm l is the leaching from the storage to subsurface flow mm a is the area of the catchment unit mm2 and t is the daily time interval day the water storage v is then used to calculate soil moisture sm as 5 s m t v t m z a where m is the soil porosity and z is the depth of the root zone mm in each catchment unit at time t hydrological processes were further distinguished as the responses in unsaturated aus t and saturated areas as t we estimated the fraction of saturated area to total area as a power law function of soil moisture kirkby 1975 in unsaturated areas all the rainfall infiltrates i e i t p t aus t a where p is the rainfall depth mm whereas in saturated areas no infiltration occurs and rainfall becomes surface runoff and evapotranspiration equals its potential value estimated according to thornthwaite 1948 evapotranspiration in unsaturated areas is instead considered as a linear function of the soil moisture between the wilting point set equal to 0 05 ács et al 2010 and a critical point when the water available for this process is non limiting leaching of water to subsurface flow paths takes place in both unsaturated and saturated areas and is computed as a power law function of soil moisture multiplied by a coefficient that is equal to the hydraulic conductivity clapp and hornberger 1978 transit times in the hillslopes of catchment units i e the second key component of the model were assumed to be exponentially distributed distinct distributions were considered for the surface fsup h and subsurface fsub h flow paths their respective parameters were determined through a power law relationship with the size of the catchment unit boyd 1978 d odorico and rigon 2003 nicὀtina et al 2008 all water particles in the source hillslopes were assumed to flow towards the lower node of each catchment unit the third component namely the response time distributions in river networks fn was instead derived from the width function of the catchment unit which explicitly considered the length of the pathway from the lower node of the catchment unit to the catchment outlet and the integration of the simplified parabolic model of de saint venant equation with suitable boundary conditions rinaldo et al 1991 rinaldo and rodriguez iturbe 1996 the response time distribution of a catchment unit was finally obtained by convoluting fn with either fsup h or fsub h for surface and subsurface flow respectively streamflow generated from a catchment unit was finally simulated as the convolution of the runoff i e the outcome of the first component and the response time distribution i e the outcome of the second and third components both superficial flow and subsurface flow were simulated at the outlet from each catchment unit and the integral of surface and subsurface contributions from all catchment units formed the total streamflow at the catchment outlet the model was calibrated on the observed streamflow series at the catchment outlet by using spatially uniform rainfall inputs we used the shuffled complex evolution algorithm by applying a statistical parameter optimization tool of python spotpy houska et al 2015 to optimize parameters 3 3 indices of tail heaviness we applied two distinct approaches to evaluate the relative and absolute heaviness of the tails of streamflow probability distributions first we quantified the relative heaviness of the upper tail of streamflow distributions resulting from spatially variable rainfall inputs with respect to the heaviness of the distribution obtained with uniform rainfall see section 3 3 1 second we further inspected if the tails of the former distributions are heavy in absolute terms by evaluating the plausibility of a power law distribution to represent them see section 3 3 2 3 3 1 relative tail heaviness of upper tailed slope we used the slope s of the upper tail of the exceedance probability distribution of re scaled daily streamflow i e streamflow divided by its long term mean value represented in a double logarithmic plot see supporting information fig s5 as an index of tail behavior similarly to nerantzaki and papalexiou 2019 and mushtaq et al 2022 this is defined as 6 s log 0 01 l o g 0 1 log x 0 01 l o g x 0 1 where x0 01 and x0 1 are the values of the normalized streamflow corresponding to the exceedance probabilities of 0 01 and 0 1 we normalized s with the slope of the reference case s0 here represented by the streamflow distribution obtained from the uniform rainfall case since the tail heaviness is proportional to the inverse of the tail slope the index of relative tail heaviness h is 7 h s 0 s accordingly h 1 indicates a streamflow distribution with a tail that is heavier than the tail of the distribution obtained with uniform rainfall whereas h 1 labels a distribution with a lighter tail than the distribution obtained with uniform rainfall see supporting information fig s5 3 3 2 suitability of best fit power law distribution power law distributions are a type of heavy tailed distributions i e distributions with tails heavier than exponential ones with special relevance as they occur in a wide range of natural and man made phenomena newman 2005 in particular power law distributed variables can assume values very far from their mean for the case of streamflow this translates into an unneglectable chance of the occurrence of very large flows and therefore the possible occurrence of extreme floods for this reason we investigated the possible emergence of power law distribution i e distributions which are heavy tailed in an absolute sense as a result of spatially variable rainfall inputs to this purpose we applied a robust statistical framework clauset et al 2009 to identify power law distributions in empirical data the range of the tail was determined as the streamflow above a lower boundary value which made the probability distribution of the streamflow above the boundary and the best fit power law model as similar as possible kolmogorov smirnov statistic was applied to quantify the distance between two probability distributions i e the cumulative distribution function of data and the fitted power law model the associated p value was used to evaluate whether the power law is a plausible fit for the data 3 4 approaches for data analyses the relationship between spatial rainfall variability and tail heaviness of the streamflow distribution was also investigated based on observed rainfall runoff events from 175 catchments across germany in this case we applied the same index of average spatial rainfall variability i e cvin index of relative tail heaviness i e h and suitability of power law distributions for the data an interpolated gridded rainfall dataset see section 2 was used to identify the rainfall fields rainfall runoff events were separated from the continuous recorded series using the approach proposed by tarasova et al 2018 the spatial variability of rainfall for each runoff event i e cvspace was computed based on the spatial rainfall pattern of the total event rainfall tarasova et al 2020 to highlight the streamflow responses from different spatial rainfall variability we sorted the rainfall runoff events based on their cvspace value events were then binned into groups of 100 members from low to high spatial rainfall variability which formed a bin with a certain value of spatial rainfall variability equal to the mean cvspace of the 100 events i e cvin events with the largest spatial rainfall variability were considered as a separate category if their number was equal to or above 50 otherwise they were included in the prior category the streamflow distribution and its tail heaviness were calculated by using the peak values of the 100 runoff events included in each bin due to different numbers of events for catchments in our data set 5 to 17 bins median 12 bins were determined in one catchment for analyzing the relationship between spatial rainfall variability and tail heaviness of streamflow the number of events per bin was decided as a tradeoff between the need of obtaining reliable estimates of tail heaviness which improve with the number of events per bin and a suitable representation of the relationship between spatial rainfall variability and tail heaviness which instead requires a certain number of bins linear regression between the tail heaviness of streamflow distributions and the corresponding spatial rainfall variability was performed and the pearson correlation coefficient and the wald test with t distribution were computed by means of the scipy stats linregress tool of scipy v1 7 1 4 results 4 1 effects of spatial rainfall variability on the tail heaviness of streamflow distributions an illustration of the effects of increasing spatial rainfall variability cvin i e in a fixed variability scenario is shown in fig 5 for the ilm river at the gauging station of niedertrebra the red shaded area identifies cases with heavier tails than in the case of uniform rainfall the black dots and tendency line express the mean tail heaviness among hundred realizations performed for each degree of spatial rainfall variability they indicate that the tail heaviness of the streamflow distribution increases only beyond a certain threshold of spatial rainfall variability which in this case is equal to cvin 4 7 to quantify this threshold we developed and applied an approach that considers the statistical significance of the linear regression slope by the wald test with t distribution of the test statistic and the pearson correlation coefficient between the two variables i e cvin and h it is detailed in the supporting information text s3 red dots in fig 5 indicate realizations for which the streamflow distributions are plausibly represented by means of power laws large amounts of red dots are visible for high spatial rainfall variability this indicates that besides increasing the tail heaviness of streamflow distributions highly heterogeneous rainfall also gives rise to distributions that are heavy in an absolute sense which have a non neglectable probability of the occurrence of extreme flow events 4 2 effects of catchment size and shape we analyzed the effects of a wide range of spatial rainfall variability in five catchments with various sizes and shapes to investigate whether these catchment characteristics affect their resilience to increasing spatial rainfall variability fig 6 a shows the effects of increasing spatial rainfall variability on the tail heaviness of streamflow distributions in the delme river basin at holzkamp 82 km2 ilm river basin at niedertrebra 887 km2 and amper river basin at inkofen 2814 km2 results are plotted together to compare the responses in catchments with different sizes to highlight the effects of catchment size these catchments have similar characteristics to other potentially influencing factors such as catchment shapes moussa 2003 sassolas serrayet et al 2018 saharia et al 2021 all of them are elongated catchments with elongation ratio re 0 5 and have small drainage density i e dd 1 all three catchments show increasing tail heaviness of streamflow distributions as a result of increasing spatial rainfall variability however the minimum value of spatial rainfall variability for which an effect arises varies indicating different degrees of resilience in small and large catchments the effect becomes visible at a lower rainfall variability in the smallest catchment 82 km2 the tail heaviness is higher in this case than for the other two catchments for all values of rainfall variability this suggests the least resilience to spatial rainfall variability in the small catchment the effect instead arises for similar values of spatial rainfall variability for medium and large catchments however the tail heaviness increases quicker in the former thus suggesting higher resilience of large catchments to increasing spatial variability of rainfall fig 6b shows the cumulative distribution functions cdf of the runoff routing distance of the three catchments the small catchment has the narrowest spread of the distribution i e all catchment units are near the outlet compared to the other two larger catchments fig 6c shows the cdfs of the runoff routing distance normalized with respect to the longest distance in each river network which allows for a better evaluation of the relative distributions of the distance in the catchments the black dashed line is the 1 1 line both small and medium catchments cdfs are closed to uniform distributions i e the s curves are closed to straight lines whereas the large catchment s cdf is asymmetrical i e the area below the 1 1 line is different from the area above when the runoff routing distance distribution is uniform the routing effects from the fast and delayed response are equal and balance each other whereas this is not happening for asymmetrical distributions in fig 7 we investigate the effects of increasing spatial rainfall variability on the tail heaviness of streamflow distributions in catchments with different shapes the ilm river basin at niedertrebra is more elongated re 0 45 the innerste river basin at heinde is less elongated re 0 78 and the unstrut river basin at erfurt moebisburg is circular re 0 90 fig 7c displays their shapes these catchments were selected because they have similar sizes i e niedertrebra 887 km2 heinde 898 km2 and erfurt moebisburg 847 km2 and drainage densities i e dd 1 to highlight the effect of catchment shape fig 7a displays the effect of increasing spatial rainfall variability on the tail heaviness of streamflow distributions in these three catchments for the more elongated catchment the tail heaviness increases for spatial rainfall variability growing above a certain threshold for the less elongated and circular catchments the tail heaviness of streamflow distributions is nearly unaffected over a wide range of increasing spatial rainfall variability although the elongated catchments generally have longer lengths of the main streams than circular catchments under the same area sassolas serrayet et al 2018 fig 7b shows that both the less elongated and circular catchments have clearly asymmetric runoff routing distance distributions with more catchment units located far upstream the outlet compared to the most elongated one 4 3 effects of varying rainfall variability recent studies point out the increasing trends of extreme events and rainfall heterogeneity due to worldwide climate change myhre et al 2019 li et al 2020 few researchers have addressed the issue of changing spatial rainfall variability in a catchment and its effects fig 8 shows the response of the tail heaviness of streamflow distributions to the increasing coefficient of variation of the spatial variability of rainfall across events cvcross the red shaded area identifies cases with heavier tails than in the case of uniform rainfall results for catchments with different sizes and shapes are displayed in fig 8a and b respectively in fig 8a all three tendency lines show positive slopes δ which are significantly different from zero wald test with t distribution p 0 05 this indicates that the varying degree of spatial rainfall promotes an increase in the tail heaviness of streamflow distributions the slope δ is significant p 0 05 higher for the small δ 0 71 than the medium δ 0 20 and large δ 0 09 catchments however the consistent change of δ is not found in fig 8b in fact the positive slope of the tendency line is significant only for the most elongated catchment p 0 05 this means that the varying degree has no effect on the streamflow distributions in both less elongated and circular catchments we recall that these results are consistent with the previous one which suggested that smaller elongated catchments are less resilient to increasing spatial heterogeneity in rainfall we also suggest that the impact of changing spatial variability of rainfall across events seems to be much less than the impact due to increasing spatial rainfall variability within the events 4 4 effects of spatial autocorrelation of rainfall fig 9 shows the effects of spatial autocorrelation of rainfall on streamflow distribution tail heaviness by comparing the results with the cases without spatial autocorrelation i e random structures in space blue dots indicate the cases encompassing data based stochastic spatial autocorrelation whereas gray dots indicate those without for all five select catchments cases with autocorrelation respond similarly to those without with respect to the rising threshold and rising rate however more profound heavier tails emerge in the autocorrelation cases for high spatial rainfall variability beyond the threshold in particular tail heaviness seems to congregate in the variations of heavier tails in comparison with the cases with random structures while the extreme cases do not exceed the expected range inferred by the cases with random structures these findings show that the spatial autocorrelation of rainfall does not change the general catchment response but indeed increases the probability of heavy tails for the higher variability cases it should be noted that the small catchment 82 km2 panel a shows fewer differences between the cases with and without spatial autocorrelation in line with zoccatelli et al 2011 who concluded that rainfall spatial organization had a limited impact on floods in smaller catchments in addition the circular catchment re 0 9 panel e shows a significant congregation of the variations of heavier tails 4 5 data analyses we analyzed 1 the relation between spatial variability of rainfall and tail heaviness of streamflow distributions 2 the effects of the catchment size and 3 catchment shape on this relation in real data to corroborate the simulation results obtained for the five select catchments and prove their transferability the results in this section are based on the analysis of data for 175 catchments across germany the increase of tail heaviness with increasing rainfall variability is seen in the data and the catchment resilience is evaluated fig 10 a shows the slope and the correlation coefficient of the regression between the streamflow distribution tail heaviness h and the spatial rainfall variability cvin for every single catchment the slope value indicates the tendency of this empirical relation whereas the correlation coefficient evaluates its reliability red circles show catchments with slopes significantly p 0 05 different from zero while gray crosses show those that are not significantly different to evaluate the catchment resilience we use the approach outlined in supporting information text s3 for identifying the effective threshold i e the threshold of cvin beyond which an effect of spatial rainfall variability begins to be visible and mark these catchments in purple color if their identified thresholds are beyond zero in general the majority of catchments 102 out of 175 display positive relations between spatial rainfall variability and tail heaviness although there are some 73 out of 175 display negative relations all of these cases display weak tendencies i e closed to zero slopes moreover the percentage of significant cases is much higher in positive cases 37 out of 102 i e 36 than in negative 9 out of 73 i e 12 these results confirm what we found in simulations i e the increasing spatial variability of rainfall determines heavier streamflow distribution tails in most cases concerning the analysis of the effective threshold there is a certain number of catchments 39 catchments shown in purple are identified this indicates that the catchment s resilience to spatial variability of rainfall is also revealed in the data in total there are 48 catchments for which we identified either significant positive slopes for the entire range of spatial rainfall variability shown in red or for the spatial rainfall variability above an effective threshold shown in purple the results of data analysis also show that large catchments tend to be more resilient to spatial variability of rainfall regarding the emergence of streamflow tail heaviness fig 10b shows the impact of catchment size on the positive tendency shown by the value of the regression slope for those 39 catchments shown in purple in fig 10a which displayed the catchment resilience i e an effective threshold is identified in general the lower the slope is i e weaker tendency the more resilient the catchment is and vice versa the dependence of the regression slope on catchment size shown in fig 10b displays a significantly p 0 05 negative relationship with the shaded area representing the 95 confidence interval of the tendency line besides we select two extreme groups among these 39 catchments smallest and largest area groups characterized by areas below 25 approx 350 km2 and beyond 75 approx 3800 km2 percentiles of these 39 catchments by computing the regression slopes of these two groups we indeed find a statistically significant difference p 0 05 using the mann whitney u test via the scipy stats mannwhitneyu tool of scipy v1 8 0 catchments in the smallest area group display a higher mean of regression slopes approx 3 96 than in the largest area group approx 1 37 these findings confirm that large catchments tend to be more resilient i e smaller regression slopes to spatial variability of rainfall the circle size in fig 10b indicates the elongation ratio of each catchment similarly the results of data analysis also show that circular catchments tend to be more resilient to spatial variability of rainfall regarding the emergence of streamflow tail heaviness than elongated catchments we analyzed the impact of catchment shape on the relation between spatial variability of rainfall and tail heaviness for those 39 catchments shown in purple in fig 10a which displayed the catchment resilience i e an effective threshold is identified fig 10c shows the dependence of the regression slope on the elongation ratio of catchments it displays a significant p 0 05 negative relationship whereas the shaded area represents the 95 confidence interval of the tendency line as previously we compute the regression slopes of two extreme groups elongated and oval circular groups characterized by re below 0 7 and beyond 0 8 strahler 1964 withanage et al 2014 we indeed find a statistically significant difference p 0 05 using the mann whitney u test via the scipy stats mannwhitneyu tool of scipy v1 8 0 in their regression slopes catchments in the elongated group display a higher mean of regression slopes approx 3 72 as compared to the oval circular group approx 1 33 these findings confirm that circular catchments tend to be more resilient i e smaller regression slopes to spatial variability of rainfall the circle size in fig 10c indicates the area of each catchment 5 discussion we found that for the smaller spatial rainfall variability the left hand side of the threshold in fig 5 both heavier and lighter tails than in the case of uniform rainfall are produced this is an outcome of more intensive rainfall occurring either in downstream or upstream parts of the catchment for a single considered stochastic realization the range spanned by values of the tail heaviness increases along with the increase of spatial rainfall variability suggesting that the specific rainfall patterns have an increasing influence on the observed tail heaviness in fact the effect of heterogeneous rainfall patterns can be modulated by soil moisture dynamics in each catchment unit kling and gupta 2009 viglione et al 2010 suggested that the spatial heterogeneity of rainfall was more impactful in regions affected by saturation excess than infiltration excess phenomena in addition zhao et al 2013 found that the spatial variability of soil moisture was linked to the spatial rainfall variability in both wet and dry conditions in general spatially variable rainfall produces heterogeneity in the soil moisture and thus generates more opportunities for partial saturation excess i e when rainfall fall on saturated catchment units than in the uniform rainfall case this may increase the contribution from fast flows and cause streamflow distributions with heavier tails as suggested by merz and blöschl 2003 and bates and aryal 2014 however other attenuating effects such as runoff routing through the river network may average out the effects of these heterogeneities on the hydrograph merz and blöschl 2009 pokhrel and gupta 2011 smith et al 2004 studied the effects of spatial rainfall variability on the hydrograph from observed data and suggested that catchments dampen the impacts of rainfall due to the filtering effect for the larger spatial rainfall variability the right hand side of the threshold in fig 5 heavier tails than in the case of uniform rainfall and heavy tails which are reliably fitted as power laws emerge saharia et al 2021 confirmed the dampening effects under lower rainfall intensities and further suggested that higher rainfall eventually subdues other geographical factors from catchments and generates flashy floods by breaking the dampening effects which indicates a higher probability of occurrence of high magnitude flow in a short period saharia et al 2017 on average we evaluated a certain degree of resilience of catchments to increasingly variable spatial rainfall by identifying distinct responses of tail heaviness to the increase of spatial rainfall variability below and beyond a certain threshold this is likely due to the increasing dominant effect of surface flow generated from partially saturated areas in the condition of high spatial heterogeneity we used here the term catchment resilience to indicate the capability of a catchment to buffer increasingly variable spatial rainfall patterns with limited changes in the tail heaviness of its streamflow distribution which is an indicator of the probability of occurrence of extreme flow events this property may have important implications for the assessment of the peril of floods under climate change which is predicted to increase the spatial heterogeneity of rainfall both locally and globally donat et al 2016 pendergrass 2018 donat et al 2019 li et al 2019 myhre et al 2019 papalexiou and montanari 2019 it was found that the size of a catchment affects its resilience smaller catchments tend to exhibit greater hydrological responses due to higher runoff coefficients joel et al 2002 cerdan et al 2004 meanwhile the observed hydrographs at small catchments often resemble the rainfall intensity variation dunne and black 1970 dingman 2002 while larger catchments tend to more strongly smooth the spatial rainfall patterns obled et al 1994 sivapalan et al 2003 some studies argued that small catchments are subject to higher flood risk than large catchments due to the possible occurrence of larger extension of saturated areas e g darras et al 2015 rogger et al 2012 zhu et al 2018 rainfall is generally more spatially uniform in small than in large catchments though intense convective rain cells with very high spatial variability exist and are the main cause of flooding in small catchments morin and yakir 2014 the analysis of the hydrological responses to a given spatial rainfall variability between small and large catchments remains challenging gupta and waymire 1998 proposed a power law scaling of peak discharge resulting from a single rainfall event which is one of the main contributors to the heavy tail of a streamflow distribution with a drainage area they showed that the dominant factor of the scaling was the rainfall variability at smaller catchments and the river network structure with its flow dynamics at larger catchments as we discussed in the previous section the runoff routing may balance the impacts of partial saturation excess from catchment units caused by the spatially heterogeneous rainfall although partial saturation excess may increase fast flow viglione et al 2010 the increase would be contrasted by a delayed response if it occurs at upstream catchment units i e more remote regions from the outlet this capability of a catchment is linked to the runoff routing distance distribution of its river network in general the longer the distance the more significant the delay would be previous studies also suggested that the impacts of channel processes on the hydrological responses increase while the catchment scales increase botter and rinaldo 2003 li and sivapalan 2011 which may therefore decrease the importance of spatial and temporal rainfall variability woltemade and potter 1994 menabde and sivapalan 2001 marchi et al 2010 for our case fig 6b clearly shows that the large catchment has a longer routing distance so it responds more slowly moreover the normalized cdf fig 6c of the runoff routing distance of the large catchment displays an s curve shape which indicates less probability when the distance is shorter and more probability when it is longer compared to the catchments with uniform distribution of routing distance this shows a stronger overall routing effect contributing from the distanced pathways to partial saturation excess which may be an additional reason for the large catchment responses being slower than the medium catchment in fig 4a in agreement with previous studies we show stronger attenuation of spatially heterogeneous rainfall from river networks of larger than smaller catchments it is unavoidable to have a different number of modeling units for small and large catchments or the same number of units across catchments while the unit sizes are different in the practice of a distributed e g hru based or grid based modeling approach we recognize that for the former case the number of the units may limit the extreme value of the generated spatial variability and affect its accuracy which influences the representative of the results especially for the smaller catchments whereas for the latter case the large differences in the unit sizes across catchments will also strongly bias the estimation of spatial variability in this study we used the same topological approach to determine the hru see section 2 for catchments with different sizes to control the unit sizes on the same scale see table 1 while allowing the numbers to be different our results suggest that the generated variability is great enough to observe its impacts on tail heaviness across catchments with different sizes e g fig 6 and the synthetic results are confirmed by an analysis of observations on a large set of catchments however we are aware that the smallest catchment we used in the synthetic analysis is 98 km2 and a fair number of modeling units should be confirmed for the smaller catchments in future studies we found that another geomorphological factor of a catchment that may affect the catchment resilience is its shape our findings show that the most elongated catchment which has the longest routing distance of the mainstream displays the least resilience to spatial rainfall variability fig 7a elongated catchments are frequently found to display approximately symmetric runoff routing distance distributions collischonn et al 2017 roy et al 2022 fig 7b shows that the elongated catchment has an apparent symmetric runoff routing distance distribution while the other two have asymmetric distributions this finding confirms the previous discussion and suggests more catchment resilience to spatial rainfall variability may exist in circular catchments than elongated ones due to markedly asymmetric runoff routing distance distributions moreover post and jakeman 1996 found that the draining of subsurface flow is easier in circular catchments this may lead to lower storage and less occurrence of saturated excess moussa 2003 showed that more elongated catchments have higher peaks and shorter recession times in their hydrographs than circular catchments roy et al 2022 found that elongated catchments tend to have shorter response times for partial contributions in catchments due to topological characteristics in line with these studies our findings extend the knowledge of the effects of catchment shape on hydrological response and further show that elongated catchments tend to have less catchment resilience to spatially variable rainfall when we further implemented the variations of the spatial rainfall variability in time we found it affects the emergence of heavier tails lightly from the numerical point of view this may be attributed to the averaging between high and low spatial variabilities based on the randomness of the change which does not result in a significant enhancement of rainfall through this process we acknowledge that this work presents a preliminary step toward the effects of the dynamics of spatial rainfall variability on floods and further investigations of the changing rate temporal correlation of the changing magnitude and the linkages to soil moisture dynamics are preferable another process we implemented in this work is spatial rainfall autocorrelation this process enhances the emergence of heavier tails which is likely due to the reduction of the attenuating effect of river networks because of the aggregation of the extreme rainfall cells as a result the effects of saturated excess on the hydrological responses overlay each other for they occurred in the closer regions rather than offsetting each other through the opposite routing distances in fact zoccatelli et al 2011 showed that the bimodal spatial distribution of rainfall is rare in the real case in particular the degree of the spatial rainfall concentration has a significant impact on the flood peak while the location of the rainfall centroid mainly affects the hydrological response time for cases with extremely heavy rainfall along the same line we found that the effects of spatial autocorrelation are more profound under conditions of high spatial rainfall variability which generate extreme heavy rainfall locally in addition we have suggested that the attenuating effects of river networks are more significant in larger circular catchments in agreement with this the reduction of the attenuating effect arising from spatial rainfall autocorrelation is also more evident in these catchments which is shown by the results we included analyses of observations on a large set of real catchments and indeed validated our findings from the synthetic work the results of data analyses show that the tail heaviness increases significantly when rainfall spatial variability increases in the majority of catchments meanwhile most larger or more circular catchments show stronger resilience in this process it is worthwhile to mention that the findings based on the synthetic works in which we disentangled the climate processes i e spatially variable rainfall varying variability in time and autocorrelation in space are confirmed by observations in which all of these processes are involved however we acknowledge that there may still be several physical processes that are effective and further studies are needed to clarify the issues for example we have shown that the smaller catchments have less resilience to spatial rainfall variability in agreement with our findings the hydrological responses in urban or small rural catchments are found to be very sensitive to spatial rainfall variability peleg et al 2017 yet a sub daily hourly temporal scale may be more appropriate for cases of these very small catchments due to the quick response time of their hydrological processes we recall here the ongoing debate surrounding the impacts of spatially heterogeneous rainfall on runoff generation previous studies often indicated a significant effect of spatial rainfall variability on hydrological responses kim et al 2008 zoccatelli et al 2010 looper and vieux 2012 mei et al 2014 whereas others claimed relatively little impact brath et al 2004 nicótina et al 2008 adams et al 2012 our findings highlight the existence of a threshold that distinguishes between ranges of spatial rainfall variability which may modulate or not affect the tail behavior of streamflow distributions the identified threshold also indicates the attenuating effects in catchments smith et al 2004 merz and blöschl 2009 pokhrel and gupta 2011 saharia et al 2021 in agreement with previous studies which are however mostly analyzing single events dunne and black 1970 obled et al 1994 sivapalan et al 2003 darras et al 2015 we show that larger or more circular catchments tend to be more resilient to spatial rainfall variability based on the data analysis of observed rainfall and discharge in a large set of catchments in germany and corroborate the simulation results 6 summary and conclusion in this study we evaluated the impacts of spatial rainfall variability on the increasing hazard of high flows we synthetically generated spatially variable rainfall in one fundamental scenario and two sub scenarios scenario 1 rainfall with fixed spatial variability i e constant spatial rainfall variability across events and random spatial structures scenario 2 spatially variable rainfall with varying variability in time while the spatial structure is random scenario 3 spatially variable rainfall with autocorrelation in space while the spatial rainfall variability is fixed a continuous probabilistic model of water transport at the catchment scale was used to simulate the hydrological response the effects of spatial rainfall variability in all scenarios on the tail heaviness of streamflow distributions were investigated in five select catchments under different catchment sizes i e small medium large and catchment shapes i e more elongated less elongated circular furthermore we analyzed the relation between spatial rainfall variability and tail heaviness of streamflow distributions by using recorded data from 175 river catchments to validate the simulation results and test their transferability the key conclusions of the study are 1 increasing spatial variability of rainfall determines enhanced hazard of high flows i e heavier tails of flow distributions only beyond a certain increase threshold both the value of this threshold and the growth rate of tail heaviness beyond the threshold indicate the resilience of catchments to spatially variable rainfall 2 small or elongated catchments show less resilience to increasing spatial variability of rainfall compared to large or circular catchments high asymmetry of the distribution of runoff routing distances along river networks identified for large and circular catchments with more contributions from upstream than downstream catchment units is likely to provide more resilience to increasing spatial variability of rainfall 3 in line with the previous results smaller or more elongated catchments are more influenced by the increasing variations of the spatial rainfall variability across events however this process seems to influence less the tail of streamflow distributions than the spatial variability of rainfall during the event 4 spatial rainfall autocorrelation does not change the overall response of the tail heaviness to spatial rainfall variability however it indeed enhances the emergence of heavy tails under the high spatial rainfall variabilities which is especially evident in larger circular catchments 5 analyses of daily rainfall runoff records for a large set of catchments in germany agree with the simulation results showing positive correlations between spatial rainfall variability and streamflow distribution tail heaviness in the majority of the case studies data analyses also confirm that small elongated catchments are less resilient to increasing spatial rainfall variability as previously found by means of synthetic simulations this work pinpoints the role played by the spatial heterogeneity of rainfall in controlling the emergence of heavy tailed distributions of streamflow it thus establishes a link between expected alterations of rainfall caused by the ongoing climate change such as more localized rain and the resulting modifications in the frequency of large event magnitudes with implications for the hazard of high flows in different river basins based on the findings of this work we show the catchment geomorphological characteristics may dampen or enhance the climate impacts on the emergence of floods and a better understanding of these processes is much more valuable for catchment flood management in climate change in addition more sophisticated processes and approaches e g spatiotemporal autocorrelation of rainfall sub daily studies for urban or small catchments effects of rainfall storm pathways and their linkages to the rainfall runoff dynamics are helpful for accurately evaluating the impacts of climate variability on flood hazards data availability statement for providing the discharge data for germany we are grateful to the bavarian state office of environment lfu https www gkd bayern de de fluesse abfluss and the global runoff data centre grdc prepared by the federal institute for hydrology bfg http www bafg de grdc climatic data can be obtained from the german weather service dwd ftp ftp cdc dwd de pub cdc the digital elevation model can be retrieved from shuttle radar topography mission srtm http www cgiar csi org data srtm 90m digital elevation database v4 1 land use data are available from the copernicus monitoring system http land copernicus eu pan european corine landcover characteristics of separated rainfall runoff events for every streamflow gauge used in the analysis can be found in data set s1 of tarasova et al 2018 https doi org 10 1029 2018wr022588 declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work is funded by the deutsche forschungsgemeinschaft dfg german research foundation project number 421396820 propensity of rivers to extreme floods climate landscape controls and early detection predicted and research group for 2416 space time dynamics of extreme floods spate the financial support of the helmholtz centre for environmental research ufz is as well acknowledged hw the 1st author is thankful to the ministry of education of the republic of china taiwan moe for providing financial support to this study gssa 2020sg12 sy the 3rd author acknowledges the support of the helmholtz climate initiative project funded by the helmholtz association the manuscript and supporting information provide all the information needed to replicate the results supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2022 104359 appendix supplementary materials image application 1 
77,flow events with low frequency often cause severe damage especially if their magnitudes are higher than suggested by historical observations the heavier right tail of streamflow distribution indicates the increasing probability of high flows in this paper we investigate the role played by spatially variable rainfall in enhancing the tail heaviness of streamflow distributions we synthetically generated a wide range of spatially variable rainfall inputs and fed them to a continuous probabilistic model of the catchment water transport to simulate streamflow in five german catchments with distinct properties in size and topography meanwhile we used a comparable approach to analyze rainfall and runoff records from 175 german catchments we identified the effects of spatially variable rainfall on the tails of streamflow distributions from both simulation scenarios and data analyses our results show that the tail of streamflow distribution becomes heavier with increasing spatial rainfall variability only beyond a certain threshold this finding indicates the capability of catchments to buffer growing heterogeneities of rainfall which we term catchment resilience to increasing spatial rainfall variability the analyses suggest that the runoff routing through the river network controls this property in fact both small and elongated catchments are less resilient to increasing spatial rainfall variability due to their intrinsic runoff routing characteristics we show the links between spatial rainfall characteristics and catchment geometry and the possible occurrence of high flows the data analyses we performed on a large set of case studies confirm the simulation results and provide confidence for the transferability of these findings keywords streamflow distributions spatial rainfall variability heavy tails response time distributions catchment resilience extreme flows data availability the authors do not have permission to share data 1 introduction extreme streamflow events can occur unexpectedly and can cause economic devastation and threaten human safety the extremeness of streamflow is referred to low frequency and high magnitude among the historical observations for certain regions which is commonly shown in the heavy tail of a streamflow distribution heavy tailed distributions are used to be defined as extreme values that are more likely to occur than would be predicted by distributions with exponential asymptotic behavior el adlouni et al 2008 this sizable probability of the occurrence of extreme streamflow is a marking of enhanced flood hazard in respect of flow frequency and magnitude heavy tailed streamflow occurs in many catchments around the world katz et al 2002 bowers et al 2012 it causes severe problems as humans tend to underestimate risk in heavy tailed distributions taleb 2007 hence it is of the utmost importance to understand the hydrological causes of heavy tails in streamflow distributions which is also important for catchments with observed streamflow records not long enough to derive heavy tail behavior from historical data wietzke et al 2020 and in ungauged catchments yokoo and sivapalan 2011 moreover investigating the role of emerging heavy tails in streamflow distributions is a valuable tool for linking modifications of extreme streamflow to changes in climate conditions basso et al 2015 potential variables controlling heavy tailed streamflow distributions have been suggested in previous studies e g drier climatic conditions sivapalan et al 2005 smaller catchment size villarini and smith 2010 non linear runoff response to precipitation gioia et al 2008 basso et al 2015 however the generation processes and exact causative factors of heavy tailed streamflow distributions are still poorly understood regarding causative factors of extreme streamflows rainfall is often considered an important issue e g bracken et al 2008 arnell and gosling 2016 wasko and sharma 2017 spatial rainfall variability has been proved as non negligible to accurate streamflow prediction e g singh 1997 zoccatelli et al 2011 zhao et al 2013 particularly it has been suggested as more important than the temporal rainfall structure peleg et al 2017 to evaluate the impacts of climate changes on extreme streamflow events fatichi et al 2016 the increasing trend in the occurrence of localized and extreme rainfall events has been found under global warming conditions donat et al 2016 pendergrass 2018 li et al 2019 myhre et al 2019 a considerable rise in spatial rainfall variability caused by the increasing intensity of extreme rainfall and decreasing spatial extent have been discussed in studies based on observations wasco et al 2016 peleg et al 2018 and modeling peleg et al 2022 furthermore the change of spatial rainfall variability itself has been shown to be more impactful on floods than the component of rainfall intensity peleg et al 2022 however traditionally the focus of the effects of spatially variable rainfall on streamflow has been on the variability of a single rainfall storm or the magnitude of the resulting peak discharge borga et al 2007 viglione et al 2010 paschalis et al 2014 lu et al 2017 few researchers have addressed the issue of the effects of continuous spatially variable rainfall on streamflow distributions even though studies of flood frequency analysis have provided some insights into flood hazards based on peak discharges e g menabde and sivapalan 2001 kay et al 2006 fiorentino et al 2007 kjeldsen et al 2014 flood hazards based on variations between low and high flows remain poorly understood furthermore long term streamflow response e g cumulative streamflow distributions to rainfall is linked with multiple hydrological processes and complex interactions between catchment units there is still some controversy surrounding the impacts of spatially heterogeneous rainfall on streamflow due to variable climate conditions viglione et al 2010 zhao et al 2013 catchment sizes merz and blöschl 2009 zhu et al 2018 or the heterogeneities in other catchment attributes struthers and sivapalan 2007 harman et al 2009 rogger et al 2012 hence it remains a great challenge for hydrologists to understand the linkages between the changing characteristics of rainfall and high flows sharma et al 2018 pointed out that one of the foremost issues which is still missing is the relationship between catchment size catchment geometry and storm characteristics e g extent duration intensity meanwhile providing a corresponding data validation to modeling results is challenging a general investigation of the effects of spatial rainfall variability from both simulation scenarios and data analyses is needed to fill the knowledge gap we address two research questions 1 what is the role of the spatial rainfall variability on heavier tailed streamflow distributions and 2 does this role be dependent on catchment sizes and shapes we aim to investigate the research questions using both simulation scenarios and data analyses this paper is organized as follows section 2 describes the study catchments and the hydrological data section 3 describes the generation of spatially variable rainfall the continuous probabilistic model of the hydrologic response the indices of tail heaviness and catchment characteristics and the approaches for data analyses in section 4 the results of the effects of spatial rainfall variability on streamflow distribution tail heaviness are described under different catchment sizes and shapes both from simulation scenarios and data analyses the physical interpretations of the results and remarks from the literature are discussed in section 5 the main conclusions are summarized in section 6 2 data the study is based on daily rainfall and streamflow observations for a set of 175 german catchments taken from tarasova et al 2018 the catchment areas vary from 36 to 23 700 km2 with a median value of 688 km2 catchments influenced by large reservoirs or control gates lehner et al 2011 and affected by visible anthropogenic streamflow disturbances are disregarded the length of daily streamflow and rainfall time series ranges between 37 and 63 years between 1951 and 2013 with a median value of 61 years we computed the specific i e per unit catchment area streamflow at each catchment outlet hereafter we use the simpler term streamflow instead of specific streamflow daily rainfall time series for each catchment was derived from the regionalisierung der niederschlaghöhen regnie dataset which is a 1 km2 resolution rainfall field interpolated from point observations through multiple regression provided by the german weather service rauthe et al 2013 this study referred to only summer periods to avoid bias from snow melting which is not considered in our modeling framework see sec 3 2 summer season was identified as june to august as suggested by beurton and thieken 2009 for german catchments daily temperature time series in the considered catchments were generated from the german weather service observations by means of external drift kriging using elevation as an explanatory variable zink et al 2017 we applied the temperature to estimate potential evapotranspiration using the thornthwaite 1948 equation five of the 175 catchments were selected for scenario simulations fig 1 and table 1 the delme river basin at holzkamp 98 km² to represent small size the ilm river basin at niedertrebra 887 km² to represent medium size and the amper river basin at inkofen 2841 km² to represent large size form the first group of basins used in the simulations for they have various catchment sizes while their drainage densities dd horton 1932 and elongation ratios re schumm 1956 are similar the ilm river basin at niedertrebra more elongated re 0 45 the innerste river basin at heinde less elongated re 0 78 and the unstrut river basin at erfurt moebisburg circular re 0 90 form the second group of basins used in simulations for they have various catchment shapes while their drainage densities and sizes are similar a 100 m resolution digital elevation model dem retrieved from the shuttle radar topography mission srtm was used to generate the river networks of the five select catchments river networks were determined by means of the arc hydro tools with the recommended threshold i e 1 for stream determination esri 2009 hydrologic response units hrus were defined as the drainage area between neighboring nodes of the river network or as the area draining to the uppermost nodes 3 methods we applied a stochastic approach to generate synthetic rainfall fields and fed the results as the input of a non gridded continuous hydrological model the spatial context is based on catchment units i e hrus the output of the long term hydrological response was used for evaluating the tail heaviness of the streamflow distribution data analysis was presented in a comparable approach to the synthetic framework 3 1 generation of spatially variable rainfall we first summarized the observed rainfall fields from the regnie dataset and identified the gamma distribution as the fairest distribution to represent the spatial variabilities of rainfall over the entire catchment within five select catchments see supporting information text s1 and fig s1 then we generated random variables from a pre assigned gamma distribution as the rainfall depths of each day which were then allocated to each hru to form the synthetic rainfall field we systematically considered three critical components the spatial rainfall variability the varying degree of spatial rainfall variability in time and the rainfall autocorrelation in space in our framework fig 2 exemplary illustrates the synthetic framework and the distinctions between components fig 2a shows the uniform case where the synthetic rainfall field is uniformly distributed in space with the average rainfall depth of observations based on the regnie dataset for the entire catchment and follows the observed time series the hydrological response generated from this case is considered the reference point in this work fig 2b shows the first scenario which encompasses the spatially variable rainfall field with a fixed spatial variability measured as coefficient of variation of rainfall for all days while every day exhibits randomly spatial rainfall patterns alike ayalew et al 2014 again for each day the catchment s average synthetic rainfall depth equals the observed value we implemented one more process the varying variability in time as the second scenario fig 2c the spatial variability changes day by day in this case with the catchment s average synthetic rainfall depth each time equal to the catchment average calculated from regnie and the spatial pattern of each day is random in addition we implemented another process the rainfall autocorrelation in space as the third scenario fig 2d the rainfall field of each day is constructed by a stochastic spatial autocorrelation function while the spatial rainfall variability is fixed in time and the mean depth follows the observations the framework starts from the most simplified case and adds different sophisticated components step by step to distinguish between effects on the tail of the streamflow probability distribution caused by different components the parameters of the gamma distribution were assigned based on the requests of different scenarios the shape parameter k of the gamma distribution was either fixed for all days scenarios 1 and 3 or allowed to vary randomly within a specified range scenario 2 the scale parameter was then computed by setting the mean of the gamma distribution equal to the average observed daily rainfall each realization applied one setting of the parameters of a gamma distribution for the entire time series for the rainfall fields with fixed variability we imposed fifty two different values of k between 103 and 10 4 see supporting information table s1 which resulted in a wide range of variabilities from extremely low near to homogeneous with the largest k to extremely high when the smallest k are utilized for the rainfall fields with varying variability the shape parameter k of the gamma distribution was changed day by day in particular we allowed it to fluctuate randomly around a central value k0 within a specified range b b we generated rainfall fields characterized by low to high degrees of varying variability by changing the width of this range and assigning to b twenty different values between 0 05k 0 and k 0 we set k 0 10 1 i e an intermediate value among those analyzed for k in the fixed variability scenario see supporting information table s2 with this approach we generated variations of the spatial variability across events while controlling the average spatial variability within events to highlight effects due to the changing of spatial rainfall variability only a hundred stochastic realizations for each specified shape parameter were generated to assess the uncertainty of the results we adopted three distinct indices eqs 1 to 3 to evaluate the degree of variability of the synthetically generated spatial rainfall fields the first index is the coefficient of variation in space cvspace of the rainfall depth assigned to all catchment units in each day which we termed cvspace t for day t 1 c v s p a c e t 1 u u 1 u d u t d t 2 d t where du t mm is rainfall depth at catchment unit u on day t d t is the spatial mean of rainfall on day t and u is the total number of catchment units the second index is the temporal mean of the first index which characterizes the average spatial variability of rainfall across all wet days i e days with rainfall 0 of the time series it is computed as 2 c v i n 1 t t 1 t c v s p a c e t where t is the total number of wet days in the rainfall time series of a catchment the third index is the temporal coefficient of variation of the first index which represents the fluctuation of the spatial rainfall variability from one day to the other it is calculated as the coefficient of variation of cvspace across all wet days i e days with rainfall 0 in the time series 3 c v c r o s s 1 t t 1 t c v s p a c e c v i n 2 c v i n note that for the case of uniform rainfall both cvin and cvcross are equal to zero in the fixed variability scenario cvcross is always equal to zero and different values of cvin are investigated whereas cvcross is different from zero in the varying variability scenario meanwhile fig 3 shows the range of the event based spatial rainfall variability panel a and the coefficient of variation of the spatial rainfall variability in time panel b from observations the blue lines indicate the synthetic indices generated in this framework that match the majority of the cases and thus are representative of the real world rainfall variabilities in addition examples of observed rainfall fields with different spatial rainfall variabilities within the considered range are displayed in the supporting information fig s2 rainfall fields with a stochastic spatial autocorrelation were generated by a rearrangement matrix peleg and morin 2014 we first derived the spatial rainfall autocorrelation function of the observations from the average of the integrated rainfall field of all the wet days for each catchment bacchi and kottegoda 1995 the pearson correlation coefficient of rainfall depths between each hru and the n th nearest hru was computed as a function of the spatial lag i e n th nearest hru grillenzoni 2022 the correlogram curve between 0 th to nmax th nearest hru was used as the spatial rainfall autocorrelation function in which nmax was determined by the corresponding correlation coefficient equal to or below zero the rearrangement matrix can then be derived based on the spatial rainfall autocorrelation function and two calibrated parameters peleg and morin 2014 the synthetic rainfall depths generated by an assigned gamma distribution can finally be reallocated in hrus based on this rearrangement matrix and thus were distributed in the entire catchment stochastically while preserving the observational spatial autocorrelation fig 4 uses the ilm river at the gauging station of niedertrebra as an example of this stochastic simulation process for each catchment among five select catchments we randomly generated five hundred realizations within the same range of spatial rainfall variability of scenario 1 and compared their effects on the tail heaviness more details and parameters used for the five select catchments are stated in the supporting information text s2 and table s3 in summary we used data based synthetic rainfall fields to investigate a wider range of variability than the one that has been observed the framework allows for isolating and analyzing separately the roles played by spatial rainfall variability occurring within the same rainfall event or by changes of spatial variability across events and the potential effects of spatial rainfall autocorrelation thus enabling an understanding of the effect of each of these components 3 2 continuous probabilistic model of the hydrologic response we used a well established probabilistic model of water transport at the catchment scale rodriguez iturbe and valdes 1979 rinaldo and rodriguez iturbe 1996 d odorico and rigon 2003 rinaldo et al 2006 nicὀtina et al 2008 rigon et al 2016 to simulate streamflow at the outlet of catchments forced by spatially variable rainfall fields the model accounts for three key components see supporting information fig s4 1 the soil water balance in hillslopes 2 the probability distributions of transit times in the hillslopes of catchment units here assumed to be stationary in time and 3 the response time distribution in channels derived from a geomorphological analysis of the river network the first component represents the water balance among rainfall inputs evapotranspiration and leaching to subsurface flow in each catchment unit 4 d v t d t i t e t t l t a where v is the water storage in the root zone mm3 i is the infiltrated rainfall depth mm et is the evapotranspiration mm l is the leaching from the storage to subsurface flow mm a is the area of the catchment unit mm2 and t is the daily time interval day the water storage v is then used to calculate soil moisture sm as 5 s m t v t m z a where m is the soil porosity and z is the depth of the root zone mm in each catchment unit at time t hydrological processes were further distinguished as the responses in unsaturated aus t and saturated areas as t we estimated the fraction of saturated area to total area as a power law function of soil moisture kirkby 1975 in unsaturated areas all the rainfall infiltrates i e i t p t aus t a where p is the rainfall depth mm whereas in saturated areas no infiltration occurs and rainfall becomes surface runoff and evapotranspiration equals its potential value estimated according to thornthwaite 1948 evapotranspiration in unsaturated areas is instead considered as a linear function of the soil moisture between the wilting point set equal to 0 05 ács et al 2010 and a critical point when the water available for this process is non limiting leaching of water to subsurface flow paths takes place in both unsaturated and saturated areas and is computed as a power law function of soil moisture multiplied by a coefficient that is equal to the hydraulic conductivity clapp and hornberger 1978 transit times in the hillslopes of catchment units i e the second key component of the model were assumed to be exponentially distributed distinct distributions were considered for the surface fsup h and subsurface fsub h flow paths their respective parameters were determined through a power law relationship with the size of the catchment unit boyd 1978 d odorico and rigon 2003 nicὀtina et al 2008 all water particles in the source hillslopes were assumed to flow towards the lower node of each catchment unit the third component namely the response time distributions in river networks fn was instead derived from the width function of the catchment unit which explicitly considered the length of the pathway from the lower node of the catchment unit to the catchment outlet and the integration of the simplified parabolic model of de saint venant equation with suitable boundary conditions rinaldo et al 1991 rinaldo and rodriguez iturbe 1996 the response time distribution of a catchment unit was finally obtained by convoluting fn with either fsup h or fsub h for surface and subsurface flow respectively streamflow generated from a catchment unit was finally simulated as the convolution of the runoff i e the outcome of the first component and the response time distribution i e the outcome of the second and third components both superficial flow and subsurface flow were simulated at the outlet from each catchment unit and the integral of surface and subsurface contributions from all catchment units formed the total streamflow at the catchment outlet the model was calibrated on the observed streamflow series at the catchment outlet by using spatially uniform rainfall inputs we used the shuffled complex evolution algorithm by applying a statistical parameter optimization tool of python spotpy houska et al 2015 to optimize parameters 3 3 indices of tail heaviness we applied two distinct approaches to evaluate the relative and absolute heaviness of the tails of streamflow probability distributions first we quantified the relative heaviness of the upper tail of streamflow distributions resulting from spatially variable rainfall inputs with respect to the heaviness of the distribution obtained with uniform rainfall see section 3 3 1 second we further inspected if the tails of the former distributions are heavy in absolute terms by evaluating the plausibility of a power law distribution to represent them see section 3 3 2 3 3 1 relative tail heaviness of upper tailed slope we used the slope s of the upper tail of the exceedance probability distribution of re scaled daily streamflow i e streamflow divided by its long term mean value represented in a double logarithmic plot see supporting information fig s5 as an index of tail behavior similarly to nerantzaki and papalexiou 2019 and mushtaq et al 2022 this is defined as 6 s log 0 01 l o g 0 1 log x 0 01 l o g x 0 1 where x0 01 and x0 1 are the values of the normalized streamflow corresponding to the exceedance probabilities of 0 01 and 0 1 we normalized s with the slope of the reference case s0 here represented by the streamflow distribution obtained from the uniform rainfall case since the tail heaviness is proportional to the inverse of the tail slope the index of relative tail heaviness h is 7 h s 0 s accordingly h 1 indicates a streamflow distribution with a tail that is heavier than the tail of the distribution obtained with uniform rainfall whereas h 1 labels a distribution with a lighter tail than the distribution obtained with uniform rainfall see supporting information fig s5 3 3 2 suitability of best fit power law distribution power law distributions are a type of heavy tailed distributions i e distributions with tails heavier than exponential ones with special relevance as they occur in a wide range of natural and man made phenomena newman 2005 in particular power law distributed variables can assume values very far from their mean for the case of streamflow this translates into an unneglectable chance of the occurrence of very large flows and therefore the possible occurrence of extreme floods for this reason we investigated the possible emergence of power law distribution i e distributions which are heavy tailed in an absolute sense as a result of spatially variable rainfall inputs to this purpose we applied a robust statistical framework clauset et al 2009 to identify power law distributions in empirical data the range of the tail was determined as the streamflow above a lower boundary value which made the probability distribution of the streamflow above the boundary and the best fit power law model as similar as possible kolmogorov smirnov statistic was applied to quantify the distance between two probability distributions i e the cumulative distribution function of data and the fitted power law model the associated p value was used to evaluate whether the power law is a plausible fit for the data 3 4 approaches for data analyses the relationship between spatial rainfall variability and tail heaviness of the streamflow distribution was also investigated based on observed rainfall runoff events from 175 catchments across germany in this case we applied the same index of average spatial rainfall variability i e cvin index of relative tail heaviness i e h and suitability of power law distributions for the data an interpolated gridded rainfall dataset see section 2 was used to identify the rainfall fields rainfall runoff events were separated from the continuous recorded series using the approach proposed by tarasova et al 2018 the spatial variability of rainfall for each runoff event i e cvspace was computed based on the spatial rainfall pattern of the total event rainfall tarasova et al 2020 to highlight the streamflow responses from different spatial rainfall variability we sorted the rainfall runoff events based on their cvspace value events were then binned into groups of 100 members from low to high spatial rainfall variability which formed a bin with a certain value of spatial rainfall variability equal to the mean cvspace of the 100 events i e cvin events with the largest spatial rainfall variability were considered as a separate category if their number was equal to or above 50 otherwise they were included in the prior category the streamflow distribution and its tail heaviness were calculated by using the peak values of the 100 runoff events included in each bin due to different numbers of events for catchments in our data set 5 to 17 bins median 12 bins were determined in one catchment for analyzing the relationship between spatial rainfall variability and tail heaviness of streamflow the number of events per bin was decided as a tradeoff between the need of obtaining reliable estimates of tail heaviness which improve with the number of events per bin and a suitable representation of the relationship between spatial rainfall variability and tail heaviness which instead requires a certain number of bins linear regression between the tail heaviness of streamflow distributions and the corresponding spatial rainfall variability was performed and the pearson correlation coefficient and the wald test with t distribution were computed by means of the scipy stats linregress tool of scipy v1 7 1 4 results 4 1 effects of spatial rainfall variability on the tail heaviness of streamflow distributions an illustration of the effects of increasing spatial rainfall variability cvin i e in a fixed variability scenario is shown in fig 5 for the ilm river at the gauging station of niedertrebra the red shaded area identifies cases with heavier tails than in the case of uniform rainfall the black dots and tendency line express the mean tail heaviness among hundred realizations performed for each degree of spatial rainfall variability they indicate that the tail heaviness of the streamflow distribution increases only beyond a certain threshold of spatial rainfall variability which in this case is equal to cvin 4 7 to quantify this threshold we developed and applied an approach that considers the statistical significance of the linear regression slope by the wald test with t distribution of the test statistic and the pearson correlation coefficient between the two variables i e cvin and h it is detailed in the supporting information text s3 red dots in fig 5 indicate realizations for which the streamflow distributions are plausibly represented by means of power laws large amounts of red dots are visible for high spatial rainfall variability this indicates that besides increasing the tail heaviness of streamflow distributions highly heterogeneous rainfall also gives rise to distributions that are heavy in an absolute sense which have a non neglectable probability of the occurrence of extreme flow events 4 2 effects of catchment size and shape we analyzed the effects of a wide range of spatial rainfall variability in five catchments with various sizes and shapes to investigate whether these catchment characteristics affect their resilience to increasing spatial rainfall variability fig 6 a shows the effects of increasing spatial rainfall variability on the tail heaviness of streamflow distributions in the delme river basin at holzkamp 82 km2 ilm river basin at niedertrebra 887 km2 and amper river basin at inkofen 2814 km2 results are plotted together to compare the responses in catchments with different sizes to highlight the effects of catchment size these catchments have similar characteristics to other potentially influencing factors such as catchment shapes moussa 2003 sassolas serrayet et al 2018 saharia et al 2021 all of them are elongated catchments with elongation ratio re 0 5 and have small drainage density i e dd 1 all three catchments show increasing tail heaviness of streamflow distributions as a result of increasing spatial rainfall variability however the minimum value of spatial rainfall variability for which an effect arises varies indicating different degrees of resilience in small and large catchments the effect becomes visible at a lower rainfall variability in the smallest catchment 82 km2 the tail heaviness is higher in this case than for the other two catchments for all values of rainfall variability this suggests the least resilience to spatial rainfall variability in the small catchment the effect instead arises for similar values of spatial rainfall variability for medium and large catchments however the tail heaviness increases quicker in the former thus suggesting higher resilience of large catchments to increasing spatial variability of rainfall fig 6b shows the cumulative distribution functions cdf of the runoff routing distance of the three catchments the small catchment has the narrowest spread of the distribution i e all catchment units are near the outlet compared to the other two larger catchments fig 6c shows the cdfs of the runoff routing distance normalized with respect to the longest distance in each river network which allows for a better evaluation of the relative distributions of the distance in the catchments the black dashed line is the 1 1 line both small and medium catchments cdfs are closed to uniform distributions i e the s curves are closed to straight lines whereas the large catchment s cdf is asymmetrical i e the area below the 1 1 line is different from the area above when the runoff routing distance distribution is uniform the routing effects from the fast and delayed response are equal and balance each other whereas this is not happening for asymmetrical distributions in fig 7 we investigate the effects of increasing spatial rainfall variability on the tail heaviness of streamflow distributions in catchments with different shapes the ilm river basin at niedertrebra is more elongated re 0 45 the innerste river basin at heinde is less elongated re 0 78 and the unstrut river basin at erfurt moebisburg is circular re 0 90 fig 7c displays their shapes these catchments were selected because they have similar sizes i e niedertrebra 887 km2 heinde 898 km2 and erfurt moebisburg 847 km2 and drainage densities i e dd 1 to highlight the effect of catchment shape fig 7a displays the effect of increasing spatial rainfall variability on the tail heaviness of streamflow distributions in these three catchments for the more elongated catchment the tail heaviness increases for spatial rainfall variability growing above a certain threshold for the less elongated and circular catchments the tail heaviness of streamflow distributions is nearly unaffected over a wide range of increasing spatial rainfall variability although the elongated catchments generally have longer lengths of the main streams than circular catchments under the same area sassolas serrayet et al 2018 fig 7b shows that both the less elongated and circular catchments have clearly asymmetric runoff routing distance distributions with more catchment units located far upstream the outlet compared to the most elongated one 4 3 effects of varying rainfall variability recent studies point out the increasing trends of extreme events and rainfall heterogeneity due to worldwide climate change myhre et al 2019 li et al 2020 few researchers have addressed the issue of changing spatial rainfall variability in a catchment and its effects fig 8 shows the response of the tail heaviness of streamflow distributions to the increasing coefficient of variation of the spatial variability of rainfall across events cvcross the red shaded area identifies cases with heavier tails than in the case of uniform rainfall results for catchments with different sizes and shapes are displayed in fig 8a and b respectively in fig 8a all three tendency lines show positive slopes δ which are significantly different from zero wald test with t distribution p 0 05 this indicates that the varying degree of spatial rainfall promotes an increase in the tail heaviness of streamflow distributions the slope δ is significant p 0 05 higher for the small δ 0 71 than the medium δ 0 20 and large δ 0 09 catchments however the consistent change of δ is not found in fig 8b in fact the positive slope of the tendency line is significant only for the most elongated catchment p 0 05 this means that the varying degree has no effect on the streamflow distributions in both less elongated and circular catchments we recall that these results are consistent with the previous one which suggested that smaller elongated catchments are less resilient to increasing spatial heterogeneity in rainfall we also suggest that the impact of changing spatial variability of rainfall across events seems to be much less than the impact due to increasing spatial rainfall variability within the events 4 4 effects of spatial autocorrelation of rainfall fig 9 shows the effects of spatial autocorrelation of rainfall on streamflow distribution tail heaviness by comparing the results with the cases without spatial autocorrelation i e random structures in space blue dots indicate the cases encompassing data based stochastic spatial autocorrelation whereas gray dots indicate those without for all five select catchments cases with autocorrelation respond similarly to those without with respect to the rising threshold and rising rate however more profound heavier tails emerge in the autocorrelation cases for high spatial rainfall variability beyond the threshold in particular tail heaviness seems to congregate in the variations of heavier tails in comparison with the cases with random structures while the extreme cases do not exceed the expected range inferred by the cases with random structures these findings show that the spatial autocorrelation of rainfall does not change the general catchment response but indeed increases the probability of heavy tails for the higher variability cases it should be noted that the small catchment 82 km2 panel a shows fewer differences between the cases with and without spatial autocorrelation in line with zoccatelli et al 2011 who concluded that rainfall spatial organization had a limited impact on floods in smaller catchments in addition the circular catchment re 0 9 panel e shows a significant congregation of the variations of heavier tails 4 5 data analyses we analyzed 1 the relation between spatial variability of rainfall and tail heaviness of streamflow distributions 2 the effects of the catchment size and 3 catchment shape on this relation in real data to corroborate the simulation results obtained for the five select catchments and prove their transferability the results in this section are based on the analysis of data for 175 catchments across germany the increase of tail heaviness with increasing rainfall variability is seen in the data and the catchment resilience is evaluated fig 10 a shows the slope and the correlation coefficient of the regression between the streamflow distribution tail heaviness h and the spatial rainfall variability cvin for every single catchment the slope value indicates the tendency of this empirical relation whereas the correlation coefficient evaluates its reliability red circles show catchments with slopes significantly p 0 05 different from zero while gray crosses show those that are not significantly different to evaluate the catchment resilience we use the approach outlined in supporting information text s3 for identifying the effective threshold i e the threshold of cvin beyond which an effect of spatial rainfall variability begins to be visible and mark these catchments in purple color if their identified thresholds are beyond zero in general the majority of catchments 102 out of 175 display positive relations between spatial rainfall variability and tail heaviness although there are some 73 out of 175 display negative relations all of these cases display weak tendencies i e closed to zero slopes moreover the percentage of significant cases is much higher in positive cases 37 out of 102 i e 36 than in negative 9 out of 73 i e 12 these results confirm what we found in simulations i e the increasing spatial variability of rainfall determines heavier streamflow distribution tails in most cases concerning the analysis of the effective threshold there is a certain number of catchments 39 catchments shown in purple are identified this indicates that the catchment s resilience to spatial variability of rainfall is also revealed in the data in total there are 48 catchments for which we identified either significant positive slopes for the entire range of spatial rainfall variability shown in red or for the spatial rainfall variability above an effective threshold shown in purple the results of data analysis also show that large catchments tend to be more resilient to spatial variability of rainfall regarding the emergence of streamflow tail heaviness fig 10b shows the impact of catchment size on the positive tendency shown by the value of the regression slope for those 39 catchments shown in purple in fig 10a which displayed the catchment resilience i e an effective threshold is identified in general the lower the slope is i e weaker tendency the more resilient the catchment is and vice versa the dependence of the regression slope on catchment size shown in fig 10b displays a significantly p 0 05 negative relationship with the shaded area representing the 95 confidence interval of the tendency line besides we select two extreme groups among these 39 catchments smallest and largest area groups characterized by areas below 25 approx 350 km2 and beyond 75 approx 3800 km2 percentiles of these 39 catchments by computing the regression slopes of these two groups we indeed find a statistically significant difference p 0 05 using the mann whitney u test via the scipy stats mannwhitneyu tool of scipy v1 8 0 catchments in the smallest area group display a higher mean of regression slopes approx 3 96 than in the largest area group approx 1 37 these findings confirm that large catchments tend to be more resilient i e smaller regression slopes to spatial variability of rainfall the circle size in fig 10b indicates the elongation ratio of each catchment similarly the results of data analysis also show that circular catchments tend to be more resilient to spatial variability of rainfall regarding the emergence of streamflow tail heaviness than elongated catchments we analyzed the impact of catchment shape on the relation between spatial variability of rainfall and tail heaviness for those 39 catchments shown in purple in fig 10a which displayed the catchment resilience i e an effective threshold is identified fig 10c shows the dependence of the regression slope on the elongation ratio of catchments it displays a significant p 0 05 negative relationship whereas the shaded area represents the 95 confidence interval of the tendency line as previously we compute the regression slopes of two extreme groups elongated and oval circular groups characterized by re below 0 7 and beyond 0 8 strahler 1964 withanage et al 2014 we indeed find a statistically significant difference p 0 05 using the mann whitney u test via the scipy stats mannwhitneyu tool of scipy v1 8 0 in their regression slopes catchments in the elongated group display a higher mean of regression slopes approx 3 72 as compared to the oval circular group approx 1 33 these findings confirm that circular catchments tend to be more resilient i e smaller regression slopes to spatial variability of rainfall the circle size in fig 10c indicates the area of each catchment 5 discussion we found that for the smaller spatial rainfall variability the left hand side of the threshold in fig 5 both heavier and lighter tails than in the case of uniform rainfall are produced this is an outcome of more intensive rainfall occurring either in downstream or upstream parts of the catchment for a single considered stochastic realization the range spanned by values of the tail heaviness increases along with the increase of spatial rainfall variability suggesting that the specific rainfall patterns have an increasing influence on the observed tail heaviness in fact the effect of heterogeneous rainfall patterns can be modulated by soil moisture dynamics in each catchment unit kling and gupta 2009 viglione et al 2010 suggested that the spatial heterogeneity of rainfall was more impactful in regions affected by saturation excess than infiltration excess phenomena in addition zhao et al 2013 found that the spatial variability of soil moisture was linked to the spatial rainfall variability in both wet and dry conditions in general spatially variable rainfall produces heterogeneity in the soil moisture and thus generates more opportunities for partial saturation excess i e when rainfall fall on saturated catchment units than in the uniform rainfall case this may increase the contribution from fast flows and cause streamflow distributions with heavier tails as suggested by merz and blöschl 2003 and bates and aryal 2014 however other attenuating effects such as runoff routing through the river network may average out the effects of these heterogeneities on the hydrograph merz and blöschl 2009 pokhrel and gupta 2011 smith et al 2004 studied the effects of spatial rainfall variability on the hydrograph from observed data and suggested that catchments dampen the impacts of rainfall due to the filtering effect for the larger spatial rainfall variability the right hand side of the threshold in fig 5 heavier tails than in the case of uniform rainfall and heavy tails which are reliably fitted as power laws emerge saharia et al 2021 confirmed the dampening effects under lower rainfall intensities and further suggested that higher rainfall eventually subdues other geographical factors from catchments and generates flashy floods by breaking the dampening effects which indicates a higher probability of occurrence of high magnitude flow in a short period saharia et al 2017 on average we evaluated a certain degree of resilience of catchments to increasingly variable spatial rainfall by identifying distinct responses of tail heaviness to the increase of spatial rainfall variability below and beyond a certain threshold this is likely due to the increasing dominant effect of surface flow generated from partially saturated areas in the condition of high spatial heterogeneity we used here the term catchment resilience to indicate the capability of a catchment to buffer increasingly variable spatial rainfall patterns with limited changes in the tail heaviness of its streamflow distribution which is an indicator of the probability of occurrence of extreme flow events this property may have important implications for the assessment of the peril of floods under climate change which is predicted to increase the spatial heterogeneity of rainfall both locally and globally donat et al 2016 pendergrass 2018 donat et al 2019 li et al 2019 myhre et al 2019 papalexiou and montanari 2019 it was found that the size of a catchment affects its resilience smaller catchments tend to exhibit greater hydrological responses due to higher runoff coefficients joel et al 2002 cerdan et al 2004 meanwhile the observed hydrographs at small catchments often resemble the rainfall intensity variation dunne and black 1970 dingman 2002 while larger catchments tend to more strongly smooth the spatial rainfall patterns obled et al 1994 sivapalan et al 2003 some studies argued that small catchments are subject to higher flood risk than large catchments due to the possible occurrence of larger extension of saturated areas e g darras et al 2015 rogger et al 2012 zhu et al 2018 rainfall is generally more spatially uniform in small than in large catchments though intense convective rain cells with very high spatial variability exist and are the main cause of flooding in small catchments morin and yakir 2014 the analysis of the hydrological responses to a given spatial rainfall variability between small and large catchments remains challenging gupta and waymire 1998 proposed a power law scaling of peak discharge resulting from a single rainfall event which is one of the main contributors to the heavy tail of a streamflow distribution with a drainage area they showed that the dominant factor of the scaling was the rainfall variability at smaller catchments and the river network structure with its flow dynamics at larger catchments as we discussed in the previous section the runoff routing may balance the impacts of partial saturation excess from catchment units caused by the spatially heterogeneous rainfall although partial saturation excess may increase fast flow viglione et al 2010 the increase would be contrasted by a delayed response if it occurs at upstream catchment units i e more remote regions from the outlet this capability of a catchment is linked to the runoff routing distance distribution of its river network in general the longer the distance the more significant the delay would be previous studies also suggested that the impacts of channel processes on the hydrological responses increase while the catchment scales increase botter and rinaldo 2003 li and sivapalan 2011 which may therefore decrease the importance of spatial and temporal rainfall variability woltemade and potter 1994 menabde and sivapalan 2001 marchi et al 2010 for our case fig 6b clearly shows that the large catchment has a longer routing distance so it responds more slowly moreover the normalized cdf fig 6c of the runoff routing distance of the large catchment displays an s curve shape which indicates less probability when the distance is shorter and more probability when it is longer compared to the catchments with uniform distribution of routing distance this shows a stronger overall routing effect contributing from the distanced pathways to partial saturation excess which may be an additional reason for the large catchment responses being slower than the medium catchment in fig 4a in agreement with previous studies we show stronger attenuation of spatially heterogeneous rainfall from river networks of larger than smaller catchments it is unavoidable to have a different number of modeling units for small and large catchments or the same number of units across catchments while the unit sizes are different in the practice of a distributed e g hru based or grid based modeling approach we recognize that for the former case the number of the units may limit the extreme value of the generated spatial variability and affect its accuracy which influences the representative of the results especially for the smaller catchments whereas for the latter case the large differences in the unit sizes across catchments will also strongly bias the estimation of spatial variability in this study we used the same topological approach to determine the hru see section 2 for catchments with different sizes to control the unit sizes on the same scale see table 1 while allowing the numbers to be different our results suggest that the generated variability is great enough to observe its impacts on tail heaviness across catchments with different sizes e g fig 6 and the synthetic results are confirmed by an analysis of observations on a large set of catchments however we are aware that the smallest catchment we used in the synthetic analysis is 98 km2 and a fair number of modeling units should be confirmed for the smaller catchments in future studies we found that another geomorphological factor of a catchment that may affect the catchment resilience is its shape our findings show that the most elongated catchment which has the longest routing distance of the mainstream displays the least resilience to spatial rainfall variability fig 7a elongated catchments are frequently found to display approximately symmetric runoff routing distance distributions collischonn et al 2017 roy et al 2022 fig 7b shows that the elongated catchment has an apparent symmetric runoff routing distance distribution while the other two have asymmetric distributions this finding confirms the previous discussion and suggests more catchment resilience to spatial rainfall variability may exist in circular catchments than elongated ones due to markedly asymmetric runoff routing distance distributions moreover post and jakeman 1996 found that the draining of subsurface flow is easier in circular catchments this may lead to lower storage and less occurrence of saturated excess moussa 2003 showed that more elongated catchments have higher peaks and shorter recession times in their hydrographs than circular catchments roy et al 2022 found that elongated catchments tend to have shorter response times for partial contributions in catchments due to topological characteristics in line with these studies our findings extend the knowledge of the effects of catchment shape on hydrological response and further show that elongated catchments tend to have less catchment resilience to spatially variable rainfall when we further implemented the variations of the spatial rainfall variability in time we found it affects the emergence of heavier tails lightly from the numerical point of view this may be attributed to the averaging between high and low spatial variabilities based on the randomness of the change which does not result in a significant enhancement of rainfall through this process we acknowledge that this work presents a preliminary step toward the effects of the dynamics of spatial rainfall variability on floods and further investigations of the changing rate temporal correlation of the changing magnitude and the linkages to soil moisture dynamics are preferable another process we implemented in this work is spatial rainfall autocorrelation this process enhances the emergence of heavier tails which is likely due to the reduction of the attenuating effect of river networks because of the aggregation of the extreme rainfall cells as a result the effects of saturated excess on the hydrological responses overlay each other for they occurred in the closer regions rather than offsetting each other through the opposite routing distances in fact zoccatelli et al 2011 showed that the bimodal spatial distribution of rainfall is rare in the real case in particular the degree of the spatial rainfall concentration has a significant impact on the flood peak while the location of the rainfall centroid mainly affects the hydrological response time for cases with extremely heavy rainfall along the same line we found that the effects of spatial autocorrelation are more profound under conditions of high spatial rainfall variability which generate extreme heavy rainfall locally in addition we have suggested that the attenuating effects of river networks are more significant in larger circular catchments in agreement with this the reduction of the attenuating effect arising from spatial rainfall autocorrelation is also more evident in these catchments which is shown by the results we included analyses of observations on a large set of real catchments and indeed validated our findings from the synthetic work the results of data analyses show that the tail heaviness increases significantly when rainfall spatial variability increases in the majority of catchments meanwhile most larger or more circular catchments show stronger resilience in this process it is worthwhile to mention that the findings based on the synthetic works in which we disentangled the climate processes i e spatially variable rainfall varying variability in time and autocorrelation in space are confirmed by observations in which all of these processes are involved however we acknowledge that there may still be several physical processes that are effective and further studies are needed to clarify the issues for example we have shown that the smaller catchments have less resilience to spatial rainfall variability in agreement with our findings the hydrological responses in urban or small rural catchments are found to be very sensitive to spatial rainfall variability peleg et al 2017 yet a sub daily hourly temporal scale may be more appropriate for cases of these very small catchments due to the quick response time of their hydrological processes we recall here the ongoing debate surrounding the impacts of spatially heterogeneous rainfall on runoff generation previous studies often indicated a significant effect of spatial rainfall variability on hydrological responses kim et al 2008 zoccatelli et al 2010 looper and vieux 2012 mei et al 2014 whereas others claimed relatively little impact brath et al 2004 nicótina et al 2008 adams et al 2012 our findings highlight the existence of a threshold that distinguishes between ranges of spatial rainfall variability which may modulate or not affect the tail behavior of streamflow distributions the identified threshold also indicates the attenuating effects in catchments smith et al 2004 merz and blöschl 2009 pokhrel and gupta 2011 saharia et al 2021 in agreement with previous studies which are however mostly analyzing single events dunne and black 1970 obled et al 1994 sivapalan et al 2003 darras et al 2015 we show that larger or more circular catchments tend to be more resilient to spatial rainfall variability based on the data analysis of observed rainfall and discharge in a large set of catchments in germany and corroborate the simulation results 6 summary and conclusion in this study we evaluated the impacts of spatial rainfall variability on the increasing hazard of high flows we synthetically generated spatially variable rainfall in one fundamental scenario and two sub scenarios scenario 1 rainfall with fixed spatial variability i e constant spatial rainfall variability across events and random spatial structures scenario 2 spatially variable rainfall with varying variability in time while the spatial structure is random scenario 3 spatially variable rainfall with autocorrelation in space while the spatial rainfall variability is fixed a continuous probabilistic model of water transport at the catchment scale was used to simulate the hydrological response the effects of spatial rainfall variability in all scenarios on the tail heaviness of streamflow distributions were investigated in five select catchments under different catchment sizes i e small medium large and catchment shapes i e more elongated less elongated circular furthermore we analyzed the relation between spatial rainfall variability and tail heaviness of streamflow distributions by using recorded data from 175 river catchments to validate the simulation results and test their transferability the key conclusions of the study are 1 increasing spatial variability of rainfall determines enhanced hazard of high flows i e heavier tails of flow distributions only beyond a certain increase threshold both the value of this threshold and the growth rate of tail heaviness beyond the threshold indicate the resilience of catchments to spatially variable rainfall 2 small or elongated catchments show less resilience to increasing spatial variability of rainfall compared to large or circular catchments high asymmetry of the distribution of runoff routing distances along river networks identified for large and circular catchments with more contributions from upstream than downstream catchment units is likely to provide more resilience to increasing spatial variability of rainfall 3 in line with the previous results smaller or more elongated catchments are more influenced by the increasing variations of the spatial rainfall variability across events however this process seems to influence less the tail of streamflow distributions than the spatial variability of rainfall during the event 4 spatial rainfall autocorrelation does not change the overall response of the tail heaviness to spatial rainfall variability however it indeed enhances the emergence of heavy tails under the high spatial rainfall variabilities which is especially evident in larger circular catchments 5 analyses of daily rainfall runoff records for a large set of catchments in germany agree with the simulation results showing positive correlations between spatial rainfall variability and streamflow distribution tail heaviness in the majority of the case studies data analyses also confirm that small elongated catchments are less resilient to increasing spatial rainfall variability as previously found by means of synthetic simulations this work pinpoints the role played by the spatial heterogeneity of rainfall in controlling the emergence of heavy tailed distributions of streamflow it thus establishes a link between expected alterations of rainfall caused by the ongoing climate change such as more localized rain and the resulting modifications in the frequency of large event magnitudes with implications for the hazard of high flows in different river basins based on the findings of this work we show the catchment geomorphological characteristics may dampen or enhance the climate impacts on the emergence of floods and a better understanding of these processes is much more valuable for catchment flood management in climate change in addition more sophisticated processes and approaches e g spatiotemporal autocorrelation of rainfall sub daily studies for urban or small catchments effects of rainfall storm pathways and their linkages to the rainfall runoff dynamics are helpful for accurately evaluating the impacts of climate variability on flood hazards data availability statement for providing the discharge data for germany we are grateful to the bavarian state office of environment lfu https www gkd bayern de de fluesse abfluss and the global runoff data centre grdc prepared by the federal institute for hydrology bfg http www bafg de grdc climatic data can be obtained from the german weather service dwd ftp ftp cdc dwd de pub cdc the digital elevation model can be retrieved from shuttle radar topography mission srtm http www cgiar csi org data srtm 90m digital elevation database v4 1 land use data are available from the copernicus monitoring system http land copernicus eu pan european corine landcover characteristics of separated rainfall runoff events for every streamflow gauge used in the analysis can be found in data set s1 of tarasova et al 2018 https doi org 10 1029 2018wr022588 declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work is funded by the deutsche forschungsgemeinschaft dfg german research foundation project number 421396820 propensity of rivers to extreme floods climate landscape controls and early detection predicted and research group for 2416 space time dynamics of extreme floods spate the financial support of the helmholtz centre for environmental research ufz is as well acknowledged hw the 1st author is thankful to the ministry of education of the republic of china taiwan moe for providing financial support to this study gssa 2020sg12 sy the 3rd author acknowledges the support of the helmholtz climate initiative project funded by the helmholtz association the manuscript and supporting information provide all the information needed to replicate the results supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2022 104359 appendix supplementary materials image application 1 
78,immiscible two phase flow through porous media is composed of a series of pore invasions however the consequences of pore scale processes on macroscopic fluid front behavior remain to be clarified in this work we perform an analytical and experimental investigation of front behavior and pore invasions dynamics during drainage for various viscosity ratios and capillary numbers we use a microfluidic setup that includes a fully controlled pore doublet geometry to isolate and explore pore invasion mechanisms we apply a model based on volume averaged navier stokes equations to capture interface dynamics different invasion mechanisms are characterized and correlated with front behavior for various flow conditions for the viscous flow regime a succession of continuous pore invasions is observed leaving a thick layer of wetting phase behind at pore curvatures abrupt interfacial jumps followed by an apparent stagnant condition are observed for the capillary flow regime we identified a new regime called crossover flow regime for which pore invasion shows a mixed behavior between capillary and viscous dominated regimes the global front behavior is predicted based on the numerical simulation and experimental results for all flow regimes graphical abstract keywords two phase flow porous media pore invasion pore doublet front instability microfluidics pore scale investigation data availability data will be made available on request nomenclature p a section averaged fluid pressure pa v i x section averaged fluid velocity m s 1 δ p i 1 h i pressure drop in the invading fluid from the inlet of channel i to the meniscus pa δ p i 2 h i pressure drop in the displaced fluid from the meniscus to the outlet of channel i pa δ p o v e r a l l overall pressure drop in both channels pa h i velocity of the meniscus in channel i m s 1 γ density ratio κ h curvature of the meniscus at each position m 1 κ dimensionless curvature of the meniscus μ 1 viscosity of the invading phase pa s μ 2 viscosity of the displaced phase pa s ρ fluid density kg m 3 σ interfacial tension n m 1 τ invasion time of one pore s τ dimensionless invasion time of one pore θ static contact angle ϑ velocity of the fluid fluid front m s 1 a h channel cross section at position h m 2 a dimensionless channel cross section c a capillary number d 0 micromodel etching depth m d p pore body width m d t pore throat width m h pore length m h i position of the interface in channel i m h i dimensionless position of the interface in channel i k permeability m 2 k dimensionless permeability l porous media length m m viscosity ratio p fluid pressure pa p dimensionless fluid pressure q flow rate m 3 s 1 r h radius of the channel at position h m r dimensionless radius of the channel r p half pore body width m r t half pore throat width m r e reynolds number t time s t dimensionless time μ fluid viscosity pa s 1 introduction immiscible two phase flow in porous media is ubiquitous and of utmost importance in many environmental and industrial phenomena e g co2 sequestration in geological reservoirs riazi et al 2011 bakhshian et al 2019 soil remediation philippe et al 2020 as well as enhanced oil recovery amirian et al 2017 in industrial applications the two phase darcy model that considers a direct correlation between mobility of each phase and its saturation is frequently used to predict the displacement process nevertheless various structural and interfacial porous media properties affinity of porous surface to one fluid i e wettability pore and throat size pore connectivity etc fluid properties viscosity density interfacial tension etc and flow conditions result in different displacement behavior peters and flock 1981 in particular when the displacing phase has a lower viscosity than the displaced phase a ramified displacement front tends to be developed which is a central factor in displacement efficiency this is the case in the context of co2 sequestration in deep saline aquifers where the injected supercritical co2 into a deep geological reservoir of porous rock has a lower viscosity than the displaced native fluid in the pore space usually brine today the different mechanisms leading to the immobilization of co2 in subsurface formations are well identified however the effective co2 storage capacity worldwide is uncertain because the influence of complex coupled processes occurring during and after injection is often neglected or unknown therefore the success of a secure and permanent storage of co2 in subsurface formations depends largely on our understanding of two phase fluid displacements leading to residual co2 saturation in particular the development of fluid front instabilities questions the validity of the multiphase extension of darcy s equation to predict immiscible displacement using relative permeabilities gupta and greenkorn 1974 peters and flock 1981 although the two phase darcy model is largely used a number of studies have emphasized its limit rose 2000 hassanizadeh and gray 1993 a key assumption in the derivation of the model by averaging stokes equations consider that the fluid fluid interfaces are stable whitaker 1986 however recent observations report intermittent pore invasion patterns that question this hypothesis moebius and or 2014b spurin et al 2019a moreover experimental and numerical investigations have shown that inertial forces are not always negligible moebius and or 2012 armstrong and berg 2013 besides novel experimental techniques such as micro piv particle image velocimetry revealed viscous dissipation mechanisms that are not included in darcy two phase model roman et al 2016 2020 in one of the pioneer studies of front instabilities in unsaturated porous media lenormand et al 1988 fluid invasions were categorized as stable viscous and capillary flow regimes these regimes are based on two dimensionless numbers describing active forces the viscosity ratio m μ 1 μ 2 and the capillary number c a μ 2 ϑ σ cos θ where μ ϑ σ and θ represent viscosity of the displacing 1 and displaced 2 phase velocity interfacial tension and contact angle for m 1 and low c a the displacement of a wetting fluid by a non wetting fluid is governed by capillary forces the non wetting fluid is able to enter a pore throat of radius r when the capillary pressure exceeds the entry value p e 2 σ r for this capillary flow regime the pore size distribution controls the displacement the fluid fluid interface front advances by invading the largest pore available that have the lowest capillary resistance this results in the onset of capillary fingering for greater c a viscous force become important the pressure differences may force the non wetting fluid into smaller throats and the displacement front is stable when m 1 and low c a the capillary flow regime is observed by increasing c a viscous fingering dominates because of the lower viscosity of the invading non wetting fluid zhang et al 2011 front instabilities were observed and studied thoroughly in studies both in 3d core flood studies aryana and kovscek 2012 and microfluidics experiments zhang et al 2011 however the large number of factors that influences two phase immiscible flow in porous systems makes the prediction of fluid behavior difficult thus pore scale studies are needed to identify the processes at stakes and their consequences on the macroscopic front behavior despite recent advancements in pore scale simulation tools they still lack in thoroughly predicting the displacement process in pore network models pnm geometry of pores and throats are replaced by regular shapes which reduces the complexity of pore space in addition in both quasi static pnm considering single network element invasion each time and most dynamic pnm allowing gradual and simultaneous displacements in several network elements capillarity is considered a local phenomenon and specific to each meniscus however the experiments of armstrong and berg 2013 showed non locality of the event and that acting forces are distributed in an interconnected pore network although computational barrier for computational fluid dynamics cfd has been almost overcome and performing high resolution simulations has become cost efficient cfd methods fail to resolve physics of interfacial phenomena and describe invasions for flows dominated by capillary effects soulaine et al 2021 meakin and tartakovsky 2009 so far almost none of the existing models can resolve and predict accurately displacement processes at the pore scale in porous media soulaine et al 2021 to predict interface behavior and have a model that incorporates interfacial phenomena we need an in depth understanding accurate observation and relevant measurement at the scale of single pores although x ray computational tomography ct has improved in terms of resolution and real time characterization in recent years it still lacks capturing the dynamics of small scale fast mechanisms of invasions coupled with a high resolution monitoring system microfluidics has shown a great potential to capture key mechanisms involved in displacement processes especially when the displacement concerns very fast dynamics armstrong and berg 2013 moebius and or 2012 microfluidics devices also called micromodels allow direct visualization of the flow processes in rock microstructure replica confined between two parallel plates separated by a small distance morais et al 2020 using microfluidics devices provide the ability of designing the geometry and having precise control of pore and throat shape and ratio in addition it brings new insight in pore scale dynamics by using techniques such as micro piv particle image velocimetry pore scale experimental studies of invasion dynamics for slow displacements show that interface moves through the porous media by pinning at constrictions followed by an abrupt movement of the interface associated with pressure bursts named after the work of haines 1930 as haines jumps moebius and or 2012 these jumps are associated with inertial effects and are suspected to rule the invasion mechanisms and change invasion patterns ferrari and lunati 2014 velocimetry of these jumps showed that the interface velocity can reach up to 50 times the mean interface velocity moebius and or 2012 roman et al 2016 sudden pressure and velocity fluctuation and associated inertial movement of the interface are accompanied by relaxation and retraction of the interface inside pores showing non locality of capillary effects armstrong and berg 2013 these small scale phenomena add to the complexity of displacement prediction and rise the question of whether it affects the global fluid displacement singh et al 2017 reported a direct relation between ramification of the front and frequency of haines jumps moebius and or 2014a reported the alteration of displacement pattern and the change in invaded pore size distributions as a result of the inertial effect of haines jumps in their simulations roman et al 2016 and blois et al 2015 reported downstream perturbations and flow fluctuations during two phase displacement process showing local pressure gradients instabilities despite significant contributions in studying displacement behavior the majority of the experimental works have focused on the overall macroscopic behavior of the interface and there is no conclusive understanding of the pore scale invasion for precisely defined pore geometry besides most of the previous works were performed for highly connected pore network systems making it almost impossible to associate observed front disturbance to a specific invasion using microfluidics we are able to design simplified porous media to study invasions at a single pore scale and neighboring pore effects in details a pore doublet is a simplified consideration of a porous media consisting of two connected channels it was originally designed to explain the entrapment of oil in water flooding fluid distribution and preferential flow paths during immiscible displacement in porous networks benner et al 1938 moore et al 1955 rose et al 1956 despite its simplified and minimal replication of the porous media it still captures the essence of the transport and interface displacement in the porous media and results can be extended to larger scales moore et al 1955 theoretical consideration of the dynamics of front behavior in pore doublet geometries has been investigated accounting for viscous and capillary forces moore et al 1955 rose et al 1956 chatzis and dullien 1983 washburn 1921 moebius and or 2012 considered effects of inertial forces on interface behavior in their model and al housseiny et al 2014 modeled the preferential flow paths in smoothly varying rectangular cross section channels millimeter scale experimental investigations of meniscus dynamics were carried out by chatzis and dullien 1983 using pore doublets etched in glass and by moebius and or 2012 using glass bead micromodels nevertheless direct comparison and the link between a systematic and dynamic theoretical pore scale interface behavior and micro scale experiments is missing in this work we designed a pore doublet geometry made of sinusoidal channels to improve our understanding of pore invasion mechanisms this work aims to investigate experimentally and numerically pore scale dynamics key pore invasion mechanisms and their contribution in defining global front behavior for different flow regimes in this regard we conduct experiments under drainage conditions when the non wetting phase displaces the wetting phase for various fluid pairs for unfavorable viscosity ratio at meticulously controlled flow conditions in a well defined pore doublet geometry we develop a theoretical model based on navier stokes volume averaging at representative elementary volume rev that takes inertial viscous and capillary forces into account and we evaluate invasion processes predicted for a pore doublet model the concept of pore doublet models is introduced in section 2 then details on theoretical method and experimental setup are elaborated in sections 3 and 4 respectively then experimental and numerical modeling results are presented and discussed in section 5 we close with conclusions and perspectives 2 pore doublet models concept and geometry 2 1 the concept of pore doublet models pore doublet models are theoretical tools to investigate the fundamental mechanisms of two phase flow in porous media benner et al 1938 moore et al 1955 rose et al 1956 they conceptualize a porous medium as a pore that splits into two parallel pores a pore doublet rejoining each other after a distance as illustrated in fig 1 the two channels are labeled i and i i respectively the volume in between the pore doublet represents a solid obstacle e g a mineral grain in theory each pore can have different lengths and different cross sections in our study however we consider that the pore doublet is made of two pores of identical length l the channel cross section a is not necessarily constant therefore it varies with the location and we note a x where x is the distance along the channel center line from the channel inlet the position of the interface between displacing and displaced fluids in channels i and i i are denoted h i and h i i respectively therefore the velocity of the meniscus in each channel is h i d h i d t and h i i d h i i d t in the pore doublet the flow rate q injected at the inlet is conserved throughout the system and the overall pressure drops δ p o v e r a l l along channel i and i i are equal these two principles are used in section 3 to derive the governing equations of dynamic pore doublet models i e equations ruling the evolution of h i h i h i i and h i i this kind of model was originally proposed to investigate the fluid invasion behavior at the bifurcation between two pathways and to explain entrapment of oil in water flooding in porous media chatzis and dullien 1983 rose et al 1956 despite its simplified and minimal replication of the pore structure it still captures the essence of the transport and interface displacement mechanisms in porous media and the insights obtained with pore doublet model are used to predict field scale results moore et al 1955 2 2 pore doublet model for microfluidic devices to characterize fluid front displacements and improve our understanding of the interface dynamics at the pore scale we used pore doublet microfluidic devices made of a succession of pores and throats see fig 2 defined by a sinusoidal function that varies with the distance from the inlet h 1 r h r p r t h 2 r p r t h 2 cos 2 π h h where r p d p 2 and r t h d t h 2 are the pore and throat width and h is the pore length the pore profile is rectangular because of the etching process therefore if d 0 is the micromodel depth then the cross section area is 2 a h 2 r h d 0 the curvature of the meniscus at each position is 3 κ h 2 d 0 1 r h cos θ where θ is the contact angle and the permeability of the system is approximated by 4 k h d 0 2 12 1 3 2 π 5 d 0 r h note that this expression corresponds to the permeability of a rectangular channel and is only valid for d 0 2 r h 1 it is obtained from the first term of the fourier series solution for the velocity profile of a viscous flow in a rectangular channel al housseiny et al 2014 3 theoretical framework dynamic pore doublet models in this section we develop a dynamic pore doublet model to investigate two phase flow mechanisms in porous media the model is used in the following sections and confronted with microfluidic experiments 3 1 mass and momentum balance equations assuming that both phases are incompressible the sum of the mass flow rates q a with a i i i in each channel is equal to the mass flow rate q at the pore doublet inlet also called the total mass flow rate we have 5 q i q i i q in each pore at any location x along the pore channel the flow rate is q a x v a x a x with a i i i where v a x is the section averaged fluid velocity within a pore the fluid velocity is equal to the velocity of the interface v a d h a d t h a therefore the mass balance writes 6 a h i ḣ i a h i i ḣ i i q which is the first of the two equations that made the dynamic pore doublet model the second equation is obtained by determining the overall pressure drop in both channels because of laplace law we have 7 δ p o v e r a l l δ p a 1 h a δ p a 2 h a σ κ h a θ with a i i i where δ p a 1 h a is the pressure drop in the invading fluid from the inlet of channel a i i i to the meniscus and δ p a 2 h a is the pressure drop in the displaced fluid from the meniscus to the channel outlet the last term in the equation defines the capillary pressure at the interface position where κ h a σ and θ represent respectively the interface curvature in each position the interfacial tension and the contact angle formed between the solid wall and the fluid fluid interface the interface curvature depends on the cross section geometry therefore if the cross section varies along the channel length so does the interface curvature the pressure drops δ p a 1 h a and δ p a 2 h a are determined by averaging the navier stokes equation over a pore cross section to form a section averaged momentum equation that govern the evolution of the mean flow along the channel center line for a newtonian fluid with no slip conditions at the fluid solid interface and assuming that the flow is laminar and unidirectional along the pore center line the integration of navier stokes momentum equations following the work of gray 1975 whitaker 1986 and civan 2011 over a pore cross section reads as 8 ρ v a x t p a x μ v a x k x with a i i i where ρ and μ are the fluid density and viscosity v a x is the section averaged flow velocity p a is the section averaged fluid pressure and k x is the channel permeability that described the mutual friction between the wall and the fluid the pressure drop δ p a 1 within the invading fluid between the channel inlet and the meniscus is therefore 9 δ p a 1 0 h a p a 1 x d x ρ 1 0 h a v a x d x t μ 1 0 h a v a x k x d x notes that the flow rate q a is constant within the invading fluid from 0 to h a therefore as v a x q a a x and q a v a h a a h a h a a h a the pressure drop within the displacing fluid becomes 10 δ p a 1 ρ 1 h a a h a 0 h a 1 a x d x t μ 1 h a a h a 0 h a 1 a x k x d x similarly one can derive the formula for the pressure drop δ p a 2 in the displaced phase 11 δ p a 2 ρ 2 h a a h a h a l 1 a x d x t μ 2 h a a h a h a l 1 a x k x d x combining eq 7 with eqs 10 11 the overall pressure drop is 12 δ p o v e r a l l ρ 2 d d t a h a ḣ a θ h a μ 2 a h a ḣ a φ h a σ κ h a θ where 13 θ h γ 0 h 1 a x d x h l 1 a x d x and 14 φ h m 0 h 1 a x k x d x h l 1 a x k x d x in which m μ 1 μ 2 γ ρ 1 ρ 2 are respectively the viscosity and density ratios between the displacing and displaced phases finally because the pressure drops over the two connected channels in a pore doublet are equal we have 15 ρ 2 d d t a h i h i θ h i μ 2 a h i h i φ h i σ κ h i θ ρ 2 d d t a h i i h i i θ h i i μ 2 a h i i h i i φ h i i σ κ h i i θ eqs 6 and 15 form a system of ordinary differential equations ode whose unknown variables are the meniscus positions h i and h i i in each pore and their displacement velocity h i and h i i they constitute the dynamic pore doublet model used in this paper the parameters k x a x and κ x depends on the pore doublet geometry 3 2 dimensionless equations to generalize the problem and investigate numerical results based on a set of common dimensionless parameters c a r e m γ the mass and momentum balance equations eq 6 and eq 15 are nondimensionalized using dimensionless variables denoted with superscript and characteristic values denoted by subscript c t t t c p p π c k k k c h h h c κ κ κ c a a a c and r r r c for a microfluidic device with rectangular cross sections as defined in section 2 2 the characteristic permeability is k c d 0 2 12 1 3 2 π 5 d 0 r t h the characteristic length h c is l the total length of the channels and for the curvature we consider κ c 2 d 0 1 r t h a c is the average of the cross section a c d 0 r p r t h and r c r t h the characteristic time scale is t c a c h c q from eq 6 and the characteristic pressure is π c μ 2 h c q a c k c from eq 12 then the dimensionless mass balance equation writes 16 a h i h i a h i i h i i 1 and the dimensionless pressure drop is 17 δ p o v e r a l l r e d d t a h a h a θ h a a h a h a φ h a c a 1 κ h a θ where a i i i and 18 θ h a γ 0 h a 1 a x d x h a 1 1 a x d x and 19 φ h a m 0 h a 1 a x k x d x h a 1 1 a x k x d x the momentum equation eq 17 involves four dimensionless numbers namely the viscosity ratio m μ 1 μ 2 the density ratio γ ρ 1 ρ 2 the reynolds number r e ρ 2 q k c μ 2 h c a c and the capillary number c a μ 2 h c q σ κ c k c a c note that the two first dimensionless numbers depend on the fluid properties only and that the reynolds and capillary numbers depends on the pore geometry and flow conditions finally the dimensionless momentum equation for a pore doublet system writes 20 r e d d t a h i h i θ h i a h i i h i i θ h i i a h i h i φ h i a h i i h i i φ h i i c a 1 κ h i θ κ h i i θ the analytical solution of θ h φ h and d d t a h h θ h can be found in supplementary material 3 3 numerical solution the dimensionless equations eq 16 and eq 20 form a system of second order nonlinear ordinary differential equations ode the formula for θ h φ h and d d t a h h θ h associated with the pore geometries used in this paper are presented in section 8 the pore doublet equations are solved numerically using an in house matlab code in which the ode system is transformed in to a first order ode set with mass matrix whose unknown variables are the meniscus positions and their displacement velocity the developed model is applied to a pore doublet with sinusoidal channels and rectangular cross section mimicking our experimental porous system and flow conditions porous media dimensions are given in table 1 a small surface area difference is imposed between channels to ensure that one of the menisci breaks through first channel 2 is 1 wider than the other moebius and or 2012 4 experimental methodology in this section we present our experimental method setup and measurement techniques along with investigated fluid pairs and implemented model properties 4 1 microchip geometry and fabrication a modified pore doublet geometry composed of two sinusoidal channels representing successions of pores and throats in subsurface formations is considered as a simplified representation of geological porous media a schematic representation of the porous media geometry is presented in fig 2 details of the designed geometry are given in table 1 each pore has a length of h pore width of d p throat width of d t h and depth of d 0 a plasma cryogenic etching method dussart et al 2014 is adopted to prepare silicon molds and pdms polydimethylsiloxane soft lithography is used for micro chip fabrication roman et al 2012 as pdms has a heterogeneous hydrophobic nature karadimitriou et al 2013 plasma treatment pva polyvinyl alcohol trantidou et al 2017 and silane deposition karadimitriou et al 2013 are used to obtain a homogeneous hydrophilic or hydrophobic wettability the static contact angle and interfacial tension of the fluid pairs with pdms have been measured using a krüss advance drop shape analyzer see table 2 the contact angle reported are between the wetting phase and pdms in presence of the non wetting phase 4 2 fluids different fluid pairs are considered to obtain a range of viscosity ratios 2 l o g m 1 representative of unfavorable displacement condition for co2 sequestration in subsurface environments nordbotten et al 2005 see table 2 to distinguish between different phases the aqueous phase is dyed pme royal blue dye the aqueous phase is seeded with micro particles polybead carboxylate microsphere 1 μ m diameter polysciences at approximately 0 06 volume concentration for micro piv measurements roman et al 2016 4 3 fluidic setup the experimental setup is presented in fig 2 a high resolution camera andor neo scmos 5 50 megapixel up to 500 fps is coupled with an upright nikon eclipse ni microscope to capture image sequences of the displacement process the flow is regulated using a pressure controller ob1 mk3 elveflow for each experiment first the wettability of the micromodel is uniformly modified to the desired contact angle then the micro chip is saturated with the wetting phase finally the wetting phase is withdrawn from the micromodel by adjusting the pressure gradient over the micro chip ranging from 30 mbar to 110 mbar the mean flow rate varies from 2 8 1 0 14 to 1 3 1 0 11 m 3 s 1 all experiments are conducted at room pressure and temperature 4 4 image processing image processing techniques are applied using a self developed matlab code to separate phases and monitor the fluid fluid interface behavior during the displacement process interface velocities are measured by tracking the interface we also benefit from the micro piv technique to measure the velocity field of the wetting fluid roman et al 2016 using the pivlab toolkit thielicke and sonntag 2021 5 results and discussion in this section we present modeling and experimental results of drainage in a pore doublet system first we identify and discuss different flow regimes then we discuss the pore invasion mechanisms governing the front instability and interface behavior during the two phase displacement 5 1 flow regimes based on the front behavior and interface movement in our model porous medium we identified three different flow regimes that depend on c a and m fig 3 namely viscous capillary and cross over flow regime they are observed both experimentally and numerically to illustrate the different regimes a spatio temporal graph representing pore invasion where time is correlated with a color bar is plotted in fig 4 in the following we provide details on the properties of these regimes the viscous flow regime corresponds to greater flow rates log c a 0 5 the invading phase displaces the wetting phase in both channels simultaneously see movie in supplementary materials the interface tends to maintain the same speed in both channels with no pinning behavior of the interface at throats as shown by the parallel superimposed displacement lines in fig 3 b this is in agreement with previous observations of viscous dominated flows in glass beads packs moebius and or 2012 for this flow condition although the absolute capillary forces increase at constrictions they are still negligible compared to viscous forces lenormand et al 1988 the acceleration and deceleration of the interface when it reaches and passes pore throats is observed clearly in simulations but is less pronounced in experiments fig 3 b in fact the model assumes that while the interface moves through the channel it drains all the fluid behind it in experiments however at high flow rates the interface does not displace all the fluid inside a pore and a portion of the wetting fluid remains at pore curvatures around the region where r r p corners and walls as wetting films as shown in fig 5 as a result in experiments the meniscus experiences lower extent of curvature changes hence lower capillary pressure variations resulting in less pronounced acceleration and deceleration of the meniscus the viscous flow regime in fig 4 a is characterized by smooth color transitions due to no abrupt change of velocity during pore invasion this regime is captured experimentally by moebius and or 2014b as simultaneous invasion events of the menisci with partial pore invasion due to the rapidly moving drainage front that limits the time for pore evacuation the residual wetting phase might increase the viscous dissipation at the fluid fluid interface the shear stress along the trapped wetting phase interface while the non wetting phase is flowing in the center of the channel induces a momentum transfer at the fluid fluid interface leading to particles recirculation in the trapped phase in the work of roman et al 2020 the momentum transfer is experimentally highlighted at the steady state condition using micro piv after the non wetting phase percolated the system wetting films and layers seem to play a determining role in existence of these internal circulations in addition we observed particles escaping the internal recirculation and moving from one pore to another through corner films these observations are in contrast with multiphase darcy assumptions that do not consider energy dissipation at the interface between two fluids the capillary flow regime occurs for the lower values of c a log c a 2 5 see movie in supplementary materials in this regime the invading phase only enters one of the channels the pore invasion mechanism in this flow condition is by sudden interfacial instability and burst to the drained pore by an abrupt decrease in local capillary pressure i e haines jumps see fig 3 c it is usually assumed that a displacement of the interface in the direction opposite of the imposed flow can never arise in pore doublets chatzis and dullien 1983 al housseiny et al 2014 nevertheless backward displacements have been observed during drainage experiments in micromodels armstrong and berg 2013 roman et al 2016 see section 5 3 in our experiments in the inlet channel the interface moves backward until the capillary pressure is balanced with the leading meniscus this retraction of the interface is not captured in the graphs fig 3 c because the retraction happens out of the camera field of view however the retraction of the interface in the channel that is not invaded appears well in the simulations fig 3 c retractions in channel 1 in this flow regime the interface is pinned at each pore throat before it reaches the entry pressure of the pore capillary forces dominate the invasion patterns and interface invades pores that have lower entry pressure threshold these observations are in agreement with the drainage experiments of moebius and or 2012 where they observed a transition from avalanche like invasions viscous regime into individual pore invasions haines jumps by decreasing the flow rate for this flow regime most of the wetting phase is displaced from each pore that is invaded as seen in fig 5 the pinning jumping behavior of the interface and the preferential flow path is shown by the sharp color transitions between pores in fig 4 b the cross over flow regime is observed for intermediate capillary numbers 2 5 log c a 0 5 see movie in supplementary materials while in previous studies cross over refers to the transition from viscous to capillary fingering zhang et al 2011 wang et al 2013 in this work it characterizes a new flow regime in terms of pore invasion mechanisms for this regime the interface is able to enter both channels but not at the same time each channel is drained at a different rate see fig 3 d we observed a mixed behavior between pinning jumping i e haines s jumps and invasion i e viscous behavior with no pinning at throats in both channels experimentally and numerically fig 3 d in experiments however both channels can participate in the pinning jumping invasion whereas in simulations the invasion starts by a viscous behavior both channels are invaded then only one channel the larger is invaded by a pinning jumping behavior as seen on fig 3 d we believe that for the microfluidic device there are small differences in capillary entry pressure from one pore to the other due to the microfabrication process whereas for the simulation one of the channels is slightly larger on purpose following each jump we observed a retraction of the interface in the channel that is not invaded at this time as shown by small peaks on the interface position curve in fig 3 d g further discussion on the influence of haines jumps on the flow dynamics is provided in section 5 3 the cross over flow regime is characterized by sharp color transitions between pores and the invasion of both channels in fig 4 a experimental results and simulation predictions of the front behavior are presented in a log c a log m plot known as lenormand s phase diagram lenormand et al 1988 see fig 6 the transition from different flow regimes are in line with previous studies lenormand et al 1988 zhang et al 2011 however there is a difference in transition onsets of the different flow regimes between experiments and simulations overall numerical predictions of the transitions are higher in terms of c a the difference might be explained by the model assumptions that the meniscus always fills the whole pore cross section in contrary to experimental observations where a layer of wetting phase remains at walls and corners fig 5 and that consider that momentum transfer at the fluid fluid interface is negligible recently it has been shown that viscous dissipation may develop at such a fluid fluid interface roman et al 2020 resulting in an increase of the mobility of the wetting phase during drainage roman et al 2020 suggested that viscous coupling is more significant when many small globules of the wetting fluid are immobilized in a porous medium and will impact on larger scales thus this work provide new evidence that the darcy s extended law for two phase flows should not neglect the mutual interactions between the fluids in some cases typically low c a and m close to 1 5 2 invasion dynamics at pore throats in this section our aim is to identify the pore invasion dynamics characteristic of each flow regime for that purpose we measured the invasion time of one pore τ i e time from one pore throat to the next one for various flow conditions see fig 7 this invasion time τ is the sum of the pinning time at the pore throat t p i n and the time for the interface to move from the pore throat to the next pore throat t j u m p with τ t p i n t j u m p the pinning time during which capillary pressure increases is indicative of the dominance of capillary forces whereas a quick succession of jumps with t p i n 0 is indicative of the dominance of viscous forces the measured invasion times are normalized by the average invasion time of one pore based on the mean flow rate in the invaded channel τ τ τ c with τ c h q i a c with q i being the average flow rate in one channel thus τ 1 when each pore is invaded at the same rate we plotted τ for successive pore invasions we present also the histograms for the values of τ for the three flow regimes in fig 7 we obtain a mean value for τ of 1 00 and a standard deviation δ of 0 16 for the viscous flow regime the mean value of τ is equal to 0 982 with δ 0 18 for the capillary flow regime whereas the mean value for τ is 0 95 and the δ 0 52 for the cross over flow regime 1 1 the first pore invasions before the vertical line are under the inlet effect as seen by first pinning times that are lower than the mean values these first pores are not taken into account for the averaged values for the viscous flow regime there is no pinning at pore throats thus τ t j u m p and the invasion times are very regular from one pore to the other in this case the viscous forces are dominant and the jump velocities are dependent on bulk flow rate as previously described by armstrong and berg 2013 for capillary and cross over flow regimes the interface is pinned at each pore throat before it invades the pore by haines s jump for the capillary flow regime the duration of each jump is negligible compared with the pinning time i e τ t p i n moreover the standard deviation of τ from the mean invasion time is low this is characteristic here of regular pinning times for all pores these characteristics of invasion times were reported by moebius and or 2012 indeed they observed clear waiting times between two interfacial jumps for low withdrawal rates for the capillary flow regime the invasion time depends on the timescale of capillary forces i e on the time during which the capillary pressure rise at a pore throat here the invasion times are regular because the pore throat size is homogeneous through the porous media in this work we newly characterized the intermediate crossover regime for which invasion times are not constant through the pore invasion process this is reflected by a wider range of τ and higher deviation from the mean value see fig 7 for this flow regime τ t p i n t j u m p where t p i n or t j u m p can be dominant or equally important consequently the invasion time for some pores is very short τ 1 while a longer invasion time τ 1 is observed for other pores this is attributed to the interaction between the different active forces in the invasion process for this flow regime the velocity of the interface reached during a pore invasion may initiate a quick invasion of the next pore τ 1 as observed for the viscous flow regime on the contrary as the two menisci advance one event i e one jump in one channel dominates and can inhibit invasion in the other channel as observed for the capillary flow regime and by armstrong and berg 2013 thus this flow regime is characterized by cooperative pore filling events that will be further discussed in the next section using micro piv measurements the pinning behavior i e when the interface stops at a pore throat was observed experimentally however in our simulations the interface is always moving with no actual pinning time we can see in fig 3 c that for the capillary flow regime at pore throats the interface creeps slowly toward the tightest part of the channels we believe that this is due to the imposed flow rate in the model and the effect of dynamics of corner and film flow during experiments not permitted in the model for this flow regime indeed when the interface is pinned at a pore throat we observed a flow of wetting phase through corners of the channels in the direction of the imposed flow rate the dynamics of corner flows and their consequences on pore invasion mechanisms will be part of a future work in this section we demonstrate the role of interfacial dynamics on defining pore invasion mechanisms these interfacial effects are further discussed in the next section 5 3 influence of haines jumps on flow dynamics in neighboring pores in this section our aim is to determine what are the consequences of haines jumps on the macroscopic transport properties of multiphase flow in porous media e g fluid entrapment energy dissipation for that we focus on the interface and fluid dynamics for slow drainage conditions i e capillary and cross over flow regime when haines jumps is the dominant pore invasion mechanism first we discuss the dynamics of the fluid fluid interfaces during invasion then we present results on the dynamics of the fluids using micro piv particle image velocimetry measurements 5 3 1 fluid fluid interface dynamics during haines jumps the dynamics of the interface for the cross over flow regime is shown on fig 8 in this case channel 1 is invaded by haines jumps while the interface is pinned at the pore throat in channel 2 on fig 8 b we show measurements of the position of the interface as a function of time in channel 2 in the channel that is not invaded at that time channel 2 the interface shows a back and forth movement that is synced with haines jumps happening in the adjacent channel channel 1 the sequence of events in channel 1 and 2 is as follows 1 the fluid fluid interfaces are pinned at a pore throat in both channels while the capillary pressure increases 2 the pore entry pressure is reached for channel 1 leading to the invasion of the pore by a haines jump the capillary pressure drops and the interface in channel 2 retreats toward the widest part of the constriction 3 the interface advance until the narrowest part of the pore throat in both channels and the capillary pressure increases again until a new invasion either in channel 1 or 2 the oscillations of the interface after abrupt invasions have been observed previously in microfluidic and glass beads experiments moebius and or 2012 armstrong and berg 2013 roman et al 2016 in this work we are able to link each fast event haines jump to its associated backward movement in the adjacent channel due to pressure release in the micromodel experiments of armstrong and berg 2013 the interface is retracting to the nearest pore body i e nearest larger cross section after an invasion by haines jump in our observations the interface is also retracting to larger sections of the channel but the retraction is limited to the pore throat vicinity see fig 8 armstrong and berg 2013 observed meniscus retractions over a distance of up to 4 pores from the pore drainage events in this work we observe that the oscillations of the interface can arise very far from the invaded pore up to the full channel length that contains multiple pores thus the capillary pressure difference during drainage in porous media has probably effects over many pores around the invasion events this should be kept in mind when defining a two phase representative elementary volume armstrong and berg 2013 for upscaling purpose it is also worth mentioning that the interfacial oscillations show a size dependent property the larger the pore sizes are the more dominant the inertial oscillations will be that is why in experiments of moebius and or 2012 mm scale the repetitive inertial oscillation is clearly distinguishable however in our geometry and work of armstrong and berg 2013 μ m scale the oscillations are rapidly damped this size dependency of interfacial dynamics is also observed in the model when larger systems show the full oscillation wave while in small systems the interface rapidly finds its equilibrium state several studies have also observed that for capillary dominated regimes two phase flow occurs along pathways that periodically disconnect and reconnect in a series of snap off and reconnection events called intermittent pathway flows spurin et al 2019b we believe that oscillations of the interface due to haines jumps are one mechanisms responsible for intermittent pathway flows as mentioned previously a backward movement of the interface is usually not permitted in pore doublet models chatzis and dullien 1983 al housseiny et al 2014 our observations clearly indicate the need to allow such displacements in the models 5 3 2 fluid dynamics at slow drainage conditions in this section our aim is to identify the consequences of interface dynamics i e haines jumps on fluid flow through the porous media we performed micro piv measurements in the aqueous phase to relate interface dynamics to fluid flow in our system in fig 9 we report measurements of fluid velocities using micro piv at different locations in the channels as well as the velocity of the interfaces for the capillary and crossover flow regime respectively 2 2 note that piv measurements are reported with an eulerian representation i e velocity of the fluid viewed from a fixed point in space whereas interface velocity is reported in a lagrangian way i e by following the interface in fig 9 we show that front velocity during haines jumps reaches velocities much higher than the average front velocity up to 34 times greater for the capillary flow regime and 15 times greater for the crossover flow regime here blue for both flow regimes the fluid velocity is disturbed and shows an oscillating movement linked with each jump of the interface see zooms in fig 9b and c this back and forth movement is observed close to the invading interface as well as far from it more than 15 pores away this back and forth movement of the wetting fluid has been previously observed during drainage in micromodels by roman et al 2016 and blois et al 2015 it has been mentioned that it is probably a consequences of haines jumps however due to the complex pore structure used in these studies it was not possible to relate interface dynamics events to fluid flow behavior here we provide the confirmation that the back and forth movements of the fluid are a result of pressure instabilities caused by haines jumps we also show that these pressure instabilities can propagate through the system more than ten pores apart from the drainage events we identified a major difference between the capillary and crossover flow regime for the capillary flow regime the flow is disturbed by each haines jumps with no effect on the interface dynamics indeed the jump dynamics is dominated by capillary forces this results in jumps regularly spaced in time and invading only one capillary for the crossover flow regime the flow is more disturbed after each jump with consequences on the interface dynamics a jump of the interface comes with a backward movement of the fluid this backward flow has the same intensity for the capillary and the crossover flow regime around 1 times the mean velocity see fig 9 b c the backward movement is followed by an acceleration of the forward flow that reaches velocity around 1 times the mean velocity for the capillary flow regime and up to 4 times greater than the mean velocity for the crossover flow regime this sudden acceleration of the flow is sometimes linked with avalanche like pore invasion for the crossover flow regime thus by increasing the flow rate and moving from the capillary to the crossover flow regime it causes interference between the dynamics of pore invasions in both channels and cooperative pore filling is observed indeed invasion in one channel might provoke or delay invasion in the adjacent channel and cause different pore invasion dynamics from pore to pore thus it seems that flow perturbations throughout the whole porous medium are driven by local pressure gradients that can change in intensity and direction in this work we provide a clear link between each interface dynamics and flow instabilities flow perturbations have consequences on the interface dynamics as we increase the flow rate and move from the capillary to the crossover flow regime these phenomena emphasize the importance of taking into account pore scale mechanisms related to the drainage pressure lenormand et al 1983 for the crossover flow regime 6 conclusion in this work the multiphase displacement front instability in porous media for unfavorable viscosity ratio m 1 at drainage conditions in a pore doublet was revisited a microfluidic system was used to study fluids and meniscus displacement in pdms microchips with controlled pore and throat shape and size a theoretical model based on the volume averaged navier stokes equation was proposed to study the interface behavior during the displacement process a micron scale pore doublet porous system composed of a succession of pores and throats in form of sinusoidal channels was used to investigate the front behavior for various fluid pairs and flow conditions with this setting having a meticulous observation and measurement of displacement properties and pore invasions was done and compared directly with the model we have captured and modeled fundamental pore invasion mechanisms associated with each flow regime and we have highlighted the role of viscous and capillary forces on the dynamics of interface and pore invasion major differences were observed between viscous and capillary dominated flow regimes in terms of front behavior interface dynamics and pore invasion mechanisms for the viscous flow regime viscous forces are dominant and control the front and displacement displacement occurs in both channels with a stable front with continuous interface displacement and it does not stop at throats due to its velocity and momentum forces meanwhile the interface does not find enough time to expand over the whole pore surface area and a body of residual wetting fluid remains at curvatures of pore space normal to the invasion direction the retention of wetting layer in corners and curvatures of the geometry for viscous flow regime results in a greater residual saturation hoogland et al 2016 naghavi and kibbey 2014 haines jumps are the dominant pore invasion mechanism at the capillary flow regime for the capillary flow regime capillary forces are dominant and the pore in which the interface reaches the invasion threshold pressure will be invaded this leads to suppression of the invasion in one of the channels for this pore invasion mechanism the interface expands laterally and displaces all the wetting phase except for corner wetting fluid the crossover flow regime newly identified presents a mixed behavior of capillary and viscous flow regime both channels are invaded however they will not participate similarly in the displacement pore by pore invasion mechanism is the main invasion process by focusing on pore scale dynamics we showed that the flow is highly disturbed by each haines jump for the cross over flow regime it results in pore invasions that can be provoked or prevented and variable duration between each jumps the presented model is able to capture main pore invasion mechanisms and show similar displacement behaviors for all flow regimes results of the model are used to predict flow regime transitions in terms of log c a l o g m phase diagram there is still room for improvement of the model by taking into account viscous coupling between displacing and displaced phase and including corner flows that will be a part of the following work credit authorship contribution statement mahdi mansouri boroujeni conceptualization software methodology investigation visualization writing original draft cyprien soulaine conceptualization software writing review editing mohamed azaroual supervision writing review editing funding acquisition sophie roman conceptualization supervision methodology writing review editing funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments experiments have been performed at nano μ lab a nano microfluidic laboratory in orléans france that is part of the eccsel consortium and of the project stories storage research insfrastructure eco system european research infrastructures capacities and services to address european green deal challenges mmb acknowledges the support from french geological survey bureau de recherches géologiques et minières brgm for phd grant the research leading to these results has received support from the french agency for research agence nationale de la recherche anr through the grant planex anr 11 eqpx 36 the labex voltaire anr 10 labx 100 01 and through the framati project under contract anr 19 ce05 0002 authors show their sincere gratitude toward dr arnaud stolz dr rémi dussart and jack nos for giving us the opportunity to prepare microfluidics master molds in the cleanroom of gremi umr7344 this work was also supported by laas cnrs micro and nanotechnologies platform a member of the renatech french national network this project has received financial support from the cnrs through the miti interdisciplinary programs and cellule energie of cnrs through the project escapades mmb thanks dr pierre yves passaggia for lending a phantom v341 fast camera for image sequence acquisitions appendix a supplementary data supplementary material related to this article can be found online at https doi org 10 1016 j advwatres 2022 104353 appendix a supplementary data the following is the supplementary material related to this article video s1 video s2 video s3 mmc s4 
78,immiscible two phase flow through porous media is composed of a series of pore invasions however the consequences of pore scale processes on macroscopic fluid front behavior remain to be clarified in this work we perform an analytical and experimental investigation of front behavior and pore invasions dynamics during drainage for various viscosity ratios and capillary numbers we use a microfluidic setup that includes a fully controlled pore doublet geometry to isolate and explore pore invasion mechanisms we apply a model based on volume averaged navier stokes equations to capture interface dynamics different invasion mechanisms are characterized and correlated with front behavior for various flow conditions for the viscous flow regime a succession of continuous pore invasions is observed leaving a thick layer of wetting phase behind at pore curvatures abrupt interfacial jumps followed by an apparent stagnant condition are observed for the capillary flow regime we identified a new regime called crossover flow regime for which pore invasion shows a mixed behavior between capillary and viscous dominated regimes the global front behavior is predicted based on the numerical simulation and experimental results for all flow regimes graphical abstract keywords two phase flow porous media pore invasion pore doublet front instability microfluidics pore scale investigation data availability data will be made available on request nomenclature p a section averaged fluid pressure pa v i x section averaged fluid velocity m s 1 δ p i 1 h i pressure drop in the invading fluid from the inlet of channel i to the meniscus pa δ p i 2 h i pressure drop in the displaced fluid from the meniscus to the outlet of channel i pa δ p o v e r a l l overall pressure drop in both channels pa h i velocity of the meniscus in channel i m s 1 γ density ratio κ h curvature of the meniscus at each position m 1 κ dimensionless curvature of the meniscus μ 1 viscosity of the invading phase pa s μ 2 viscosity of the displaced phase pa s ρ fluid density kg m 3 σ interfacial tension n m 1 τ invasion time of one pore s τ dimensionless invasion time of one pore θ static contact angle ϑ velocity of the fluid fluid front m s 1 a h channel cross section at position h m 2 a dimensionless channel cross section c a capillary number d 0 micromodel etching depth m d p pore body width m d t pore throat width m h pore length m h i position of the interface in channel i m h i dimensionless position of the interface in channel i k permeability m 2 k dimensionless permeability l porous media length m m viscosity ratio p fluid pressure pa p dimensionless fluid pressure q flow rate m 3 s 1 r h radius of the channel at position h m r dimensionless radius of the channel r p half pore body width m r t half pore throat width m r e reynolds number t time s t dimensionless time μ fluid viscosity pa s 1 introduction immiscible two phase flow in porous media is ubiquitous and of utmost importance in many environmental and industrial phenomena e g co2 sequestration in geological reservoirs riazi et al 2011 bakhshian et al 2019 soil remediation philippe et al 2020 as well as enhanced oil recovery amirian et al 2017 in industrial applications the two phase darcy model that considers a direct correlation between mobility of each phase and its saturation is frequently used to predict the displacement process nevertheless various structural and interfacial porous media properties affinity of porous surface to one fluid i e wettability pore and throat size pore connectivity etc fluid properties viscosity density interfacial tension etc and flow conditions result in different displacement behavior peters and flock 1981 in particular when the displacing phase has a lower viscosity than the displaced phase a ramified displacement front tends to be developed which is a central factor in displacement efficiency this is the case in the context of co2 sequestration in deep saline aquifers where the injected supercritical co2 into a deep geological reservoir of porous rock has a lower viscosity than the displaced native fluid in the pore space usually brine today the different mechanisms leading to the immobilization of co2 in subsurface formations are well identified however the effective co2 storage capacity worldwide is uncertain because the influence of complex coupled processes occurring during and after injection is often neglected or unknown therefore the success of a secure and permanent storage of co2 in subsurface formations depends largely on our understanding of two phase fluid displacements leading to residual co2 saturation in particular the development of fluid front instabilities questions the validity of the multiphase extension of darcy s equation to predict immiscible displacement using relative permeabilities gupta and greenkorn 1974 peters and flock 1981 although the two phase darcy model is largely used a number of studies have emphasized its limit rose 2000 hassanizadeh and gray 1993 a key assumption in the derivation of the model by averaging stokes equations consider that the fluid fluid interfaces are stable whitaker 1986 however recent observations report intermittent pore invasion patterns that question this hypothesis moebius and or 2014b spurin et al 2019a moreover experimental and numerical investigations have shown that inertial forces are not always negligible moebius and or 2012 armstrong and berg 2013 besides novel experimental techniques such as micro piv particle image velocimetry revealed viscous dissipation mechanisms that are not included in darcy two phase model roman et al 2016 2020 in one of the pioneer studies of front instabilities in unsaturated porous media lenormand et al 1988 fluid invasions were categorized as stable viscous and capillary flow regimes these regimes are based on two dimensionless numbers describing active forces the viscosity ratio m μ 1 μ 2 and the capillary number c a μ 2 ϑ σ cos θ where μ ϑ σ and θ represent viscosity of the displacing 1 and displaced 2 phase velocity interfacial tension and contact angle for m 1 and low c a the displacement of a wetting fluid by a non wetting fluid is governed by capillary forces the non wetting fluid is able to enter a pore throat of radius r when the capillary pressure exceeds the entry value p e 2 σ r for this capillary flow regime the pore size distribution controls the displacement the fluid fluid interface front advances by invading the largest pore available that have the lowest capillary resistance this results in the onset of capillary fingering for greater c a viscous force become important the pressure differences may force the non wetting fluid into smaller throats and the displacement front is stable when m 1 and low c a the capillary flow regime is observed by increasing c a viscous fingering dominates because of the lower viscosity of the invading non wetting fluid zhang et al 2011 front instabilities were observed and studied thoroughly in studies both in 3d core flood studies aryana and kovscek 2012 and microfluidics experiments zhang et al 2011 however the large number of factors that influences two phase immiscible flow in porous systems makes the prediction of fluid behavior difficult thus pore scale studies are needed to identify the processes at stakes and their consequences on the macroscopic front behavior despite recent advancements in pore scale simulation tools they still lack in thoroughly predicting the displacement process in pore network models pnm geometry of pores and throats are replaced by regular shapes which reduces the complexity of pore space in addition in both quasi static pnm considering single network element invasion each time and most dynamic pnm allowing gradual and simultaneous displacements in several network elements capillarity is considered a local phenomenon and specific to each meniscus however the experiments of armstrong and berg 2013 showed non locality of the event and that acting forces are distributed in an interconnected pore network although computational barrier for computational fluid dynamics cfd has been almost overcome and performing high resolution simulations has become cost efficient cfd methods fail to resolve physics of interfacial phenomena and describe invasions for flows dominated by capillary effects soulaine et al 2021 meakin and tartakovsky 2009 so far almost none of the existing models can resolve and predict accurately displacement processes at the pore scale in porous media soulaine et al 2021 to predict interface behavior and have a model that incorporates interfacial phenomena we need an in depth understanding accurate observation and relevant measurement at the scale of single pores although x ray computational tomography ct has improved in terms of resolution and real time characterization in recent years it still lacks capturing the dynamics of small scale fast mechanisms of invasions coupled with a high resolution monitoring system microfluidics has shown a great potential to capture key mechanisms involved in displacement processes especially when the displacement concerns very fast dynamics armstrong and berg 2013 moebius and or 2012 microfluidics devices also called micromodels allow direct visualization of the flow processes in rock microstructure replica confined between two parallel plates separated by a small distance morais et al 2020 using microfluidics devices provide the ability of designing the geometry and having precise control of pore and throat shape and ratio in addition it brings new insight in pore scale dynamics by using techniques such as micro piv particle image velocimetry pore scale experimental studies of invasion dynamics for slow displacements show that interface moves through the porous media by pinning at constrictions followed by an abrupt movement of the interface associated with pressure bursts named after the work of haines 1930 as haines jumps moebius and or 2012 these jumps are associated with inertial effects and are suspected to rule the invasion mechanisms and change invasion patterns ferrari and lunati 2014 velocimetry of these jumps showed that the interface velocity can reach up to 50 times the mean interface velocity moebius and or 2012 roman et al 2016 sudden pressure and velocity fluctuation and associated inertial movement of the interface are accompanied by relaxation and retraction of the interface inside pores showing non locality of capillary effects armstrong and berg 2013 these small scale phenomena add to the complexity of displacement prediction and rise the question of whether it affects the global fluid displacement singh et al 2017 reported a direct relation between ramification of the front and frequency of haines jumps moebius and or 2014a reported the alteration of displacement pattern and the change in invaded pore size distributions as a result of the inertial effect of haines jumps in their simulations roman et al 2016 and blois et al 2015 reported downstream perturbations and flow fluctuations during two phase displacement process showing local pressure gradients instabilities despite significant contributions in studying displacement behavior the majority of the experimental works have focused on the overall macroscopic behavior of the interface and there is no conclusive understanding of the pore scale invasion for precisely defined pore geometry besides most of the previous works were performed for highly connected pore network systems making it almost impossible to associate observed front disturbance to a specific invasion using microfluidics we are able to design simplified porous media to study invasions at a single pore scale and neighboring pore effects in details a pore doublet is a simplified consideration of a porous media consisting of two connected channels it was originally designed to explain the entrapment of oil in water flooding fluid distribution and preferential flow paths during immiscible displacement in porous networks benner et al 1938 moore et al 1955 rose et al 1956 despite its simplified and minimal replication of the porous media it still captures the essence of the transport and interface displacement in the porous media and results can be extended to larger scales moore et al 1955 theoretical consideration of the dynamics of front behavior in pore doublet geometries has been investigated accounting for viscous and capillary forces moore et al 1955 rose et al 1956 chatzis and dullien 1983 washburn 1921 moebius and or 2012 considered effects of inertial forces on interface behavior in their model and al housseiny et al 2014 modeled the preferential flow paths in smoothly varying rectangular cross section channels millimeter scale experimental investigations of meniscus dynamics were carried out by chatzis and dullien 1983 using pore doublets etched in glass and by moebius and or 2012 using glass bead micromodels nevertheless direct comparison and the link between a systematic and dynamic theoretical pore scale interface behavior and micro scale experiments is missing in this work we designed a pore doublet geometry made of sinusoidal channels to improve our understanding of pore invasion mechanisms this work aims to investigate experimentally and numerically pore scale dynamics key pore invasion mechanisms and their contribution in defining global front behavior for different flow regimes in this regard we conduct experiments under drainage conditions when the non wetting phase displaces the wetting phase for various fluid pairs for unfavorable viscosity ratio at meticulously controlled flow conditions in a well defined pore doublet geometry we develop a theoretical model based on navier stokes volume averaging at representative elementary volume rev that takes inertial viscous and capillary forces into account and we evaluate invasion processes predicted for a pore doublet model the concept of pore doublet models is introduced in section 2 then details on theoretical method and experimental setup are elaborated in sections 3 and 4 respectively then experimental and numerical modeling results are presented and discussed in section 5 we close with conclusions and perspectives 2 pore doublet models concept and geometry 2 1 the concept of pore doublet models pore doublet models are theoretical tools to investigate the fundamental mechanisms of two phase flow in porous media benner et al 1938 moore et al 1955 rose et al 1956 they conceptualize a porous medium as a pore that splits into two parallel pores a pore doublet rejoining each other after a distance as illustrated in fig 1 the two channels are labeled i and i i respectively the volume in between the pore doublet represents a solid obstacle e g a mineral grain in theory each pore can have different lengths and different cross sections in our study however we consider that the pore doublet is made of two pores of identical length l the channel cross section a is not necessarily constant therefore it varies with the location and we note a x where x is the distance along the channel center line from the channel inlet the position of the interface between displacing and displaced fluids in channels i and i i are denoted h i and h i i respectively therefore the velocity of the meniscus in each channel is h i d h i d t and h i i d h i i d t in the pore doublet the flow rate q injected at the inlet is conserved throughout the system and the overall pressure drops δ p o v e r a l l along channel i and i i are equal these two principles are used in section 3 to derive the governing equations of dynamic pore doublet models i e equations ruling the evolution of h i h i h i i and h i i this kind of model was originally proposed to investigate the fluid invasion behavior at the bifurcation between two pathways and to explain entrapment of oil in water flooding in porous media chatzis and dullien 1983 rose et al 1956 despite its simplified and minimal replication of the pore structure it still captures the essence of the transport and interface displacement mechanisms in porous media and the insights obtained with pore doublet model are used to predict field scale results moore et al 1955 2 2 pore doublet model for microfluidic devices to characterize fluid front displacements and improve our understanding of the interface dynamics at the pore scale we used pore doublet microfluidic devices made of a succession of pores and throats see fig 2 defined by a sinusoidal function that varies with the distance from the inlet h 1 r h r p r t h 2 r p r t h 2 cos 2 π h h where r p d p 2 and r t h d t h 2 are the pore and throat width and h is the pore length the pore profile is rectangular because of the etching process therefore if d 0 is the micromodel depth then the cross section area is 2 a h 2 r h d 0 the curvature of the meniscus at each position is 3 κ h 2 d 0 1 r h cos θ where θ is the contact angle and the permeability of the system is approximated by 4 k h d 0 2 12 1 3 2 π 5 d 0 r h note that this expression corresponds to the permeability of a rectangular channel and is only valid for d 0 2 r h 1 it is obtained from the first term of the fourier series solution for the velocity profile of a viscous flow in a rectangular channel al housseiny et al 2014 3 theoretical framework dynamic pore doublet models in this section we develop a dynamic pore doublet model to investigate two phase flow mechanisms in porous media the model is used in the following sections and confronted with microfluidic experiments 3 1 mass and momentum balance equations assuming that both phases are incompressible the sum of the mass flow rates q a with a i i i in each channel is equal to the mass flow rate q at the pore doublet inlet also called the total mass flow rate we have 5 q i q i i q in each pore at any location x along the pore channel the flow rate is q a x v a x a x with a i i i where v a x is the section averaged fluid velocity within a pore the fluid velocity is equal to the velocity of the interface v a d h a d t h a therefore the mass balance writes 6 a h i ḣ i a h i i ḣ i i q which is the first of the two equations that made the dynamic pore doublet model the second equation is obtained by determining the overall pressure drop in both channels because of laplace law we have 7 δ p o v e r a l l δ p a 1 h a δ p a 2 h a σ κ h a θ with a i i i where δ p a 1 h a is the pressure drop in the invading fluid from the inlet of channel a i i i to the meniscus and δ p a 2 h a is the pressure drop in the displaced fluid from the meniscus to the channel outlet the last term in the equation defines the capillary pressure at the interface position where κ h a σ and θ represent respectively the interface curvature in each position the interfacial tension and the contact angle formed between the solid wall and the fluid fluid interface the interface curvature depends on the cross section geometry therefore if the cross section varies along the channel length so does the interface curvature the pressure drops δ p a 1 h a and δ p a 2 h a are determined by averaging the navier stokes equation over a pore cross section to form a section averaged momentum equation that govern the evolution of the mean flow along the channel center line for a newtonian fluid with no slip conditions at the fluid solid interface and assuming that the flow is laminar and unidirectional along the pore center line the integration of navier stokes momentum equations following the work of gray 1975 whitaker 1986 and civan 2011 over a pore cross section reads as 8 ρ v a x t p a x μ v a x k x with a i i i where ρ and μ are the fluid density and viscosity v a x is the section averaged flow velocity p a is the section averaged fluid pressure and k x is the channel permeability that described the mutual friction between the wall and the fluid the pressure drop δ p a 1 within the invading fluid between the channel inlet and the meniscus is therefore 9 δ p a 1 0 h a p a 1 x d x ρ 1 0 h a v a x d x t μ 1 0 h a v a x k x d x notes that the flow rate q a is constant within the invading fluid from 0 to h a therefore as v a x q a a x and q a v a h a a h a h a a h a the pressure drop within the displacing fluid becomes 10 δ p a 1 ρ 1 h a a h a 0 h a 1 a x d x t μ 1 h a a h a 0 h a 1 a x k x d x similarly one can derive the formula for the pressure drop δ p a 2 in the displaced phase 11 δ p a 2 ρ 2 h a a h a h a l 1 a x d x t μ 2 h a a h a h a l 1 a x k x d x combining eq 7 with eqs 10 11 the overall pressure drop is 12 δ p o v e r a l l ρ 2 d d t a h a ḣ a θ h a μ 2 a h a ḣ a φ h a σ κ h a θ where 13 θ h γ 0 h 1 a x d x h l 1 a x d x and 14 φ h m 0 h 1 a x k x d x h l 1 a x k x d x in which m μ 1 μ 2 γ ρ 1 ρ 2 are respectively the viscosity and density ratios between the displacing and displaced phases finally because the pressure drops over the two connected channels in a pore doublet are equal we have 15 ρ 2 d d t a h i h i θ h i μ 2 a h i h i φ h i σ κ h i θ ρ 2 d d t a h i i h i i θ h i i μ 2 a h i i h i i φ h i i σ κ h i i θ eqs 6 and 15 form a system of ordinary differential equations ode whose unknown variables are the meniscus positions h i and h i i in each pore and their displacement velocity h i and h i i they constitute the dynamic pore doublet model used in this paper the parameters k x a x and κ x depends on the pore doublet geometry 3 2 dimensionless equations to generalize the problem and investigate numerical results based on a set of common dimensionless parameters c a r e m γ the mass and momentum balance equations eq 6 and eq 15 are nondimensionalized using dimensionless variables denoted with superscript and characteristic values denoted by subscript c t t t c p p π c k k k c h h h c κ κ κ c a a a c and r r r c for a microfluidic device with rectangular cross sections as defined in section 2 2 the characteristic permeability is k c d 0 2 12 1 3 2 π 5 d 0 r t h the characteristic length h c is l the total length of the channels and for the curvature we consider κ c 2 d 0 1 r t h a c is the average of the cross section a c d 0 r p r t h and r c r t h the characteristic time scale is t c a c h c q from eq 6 and the characteristic pressure is π c μ 2 h c q a c k c from eq 12 then the dimensionless mass balance equation writes 16 a h i h i a h i i h i i 1 and the dimensionless pressure drop is 17 δ p o v e r a l l r e d d t a h a h a θ h a a h a h a φ h a c a 1 κ h a θ where a i i i and 18 θ h a γ 0 h a 1 a x d x h a 1 1 a x d x and 19 φ h a m 0 h a 1 a x k x d x h a 1 1 a x k x d x the momentum equation eq 17 involves four dimensionless numbers namely the viscosity ratio m μ 1 μ 2 the density ratio γ ρ 1 ρ 2 the reynolds number r e ρ 2 q k c μ 2 h c a c and the capillary number c a μ 2 h c q σ κ c k c a c note that the two first dimensionless numbers depend on the fluid properties only and that the reynolds and capillary numbers depends on the pore geometry and flow conditions finally the dimensionless momentum equation for a pore doublet system writes 20 r e d d t a h i h i θ h i a h i i h i i θ h i i a h i h i φ h i a h i i h i i φ h i i c a 1 κ h i θ κ h i i θ the analytical solution of θ h φ h and d d t a h h θ h can be found in supplementary material 3 3 numerical solution the dimensionless equations eq 16 and eq 20 form a system of second order nonlinear ordinary differential equations ode the formula for θ h φ h and d d t a h h θ h associated with the pore geometries used in this paper are presented in section 8 the pore doublet equations are solved numerically using an in house matlab code in which the ode system is transformed in to a first order ode set with mass matrix whose unknown variables are the meniscus positions and their displacement velocity the developed model is applied to a pore doublet with sinusoidal channels and rectangular cross section mimicking our experimental porous system and flow conditions porous media dimensions are given in table 1 a small surface area difference is imposed between channels to ensure that one of the menisci breaks through first channel 2 is 1 wider than the other moebius and or 2012 4 experimental methodology in this section we present our experimental method setup and measurement techniques along with investigated fluid pairs and implemented model properties 4 1 microchip geometry and fabrication a modified pore doublet geometry composed of two sinusoidal channels representing successions of pores and throats in subsurface formations is considered as a simplified representation of geological porous media a schematic representation of the porous media geometry is presented in fig 2 details of the designed geometry are given in table 1 each pore has a length of h pore width of d p throat width of d t h and depth of d 0 a plasma cryogenic etching method dussart et al 2014 is adopted to prepare silicon molds and pdms polydimethylsiloxane soft lithography is used for micro chip fabrication roman et al 2012 as pdms has a heterogeneous hydrophobic nature karadimitriou et al 2013 plasma treatment pva polyvinyl alcohol trantidou et al 2017 and silane deposition karadimitriou et al 2013 are used to obtain a homogeneous hydrophilic or hydrophobic wettability the static contact angle and interfacial tension of the fluid pairs with pdms have been measured using a krüss advance drop shape analyzer see table 2 the contact angle reported are between the wetting phase and pdms in presence of the non wetting phase 4 2 fluids different fluid pairs are considered to obtain a range of viscosity ratios 2 l o g m 1 representative of unfavorable displacement condition for co2 sequestration in subsurface environments nordbotten et al 2005 see table 2 to distinguish between different phases the aqueous phase is dyed pme royal blue dye the aqueous phase is seeded with micro particles polybead carboxylate microsphere 1 μ m diameter polysciences at approximately 0 06 volume concentration for micro piv measurements roman et al 2016 4 3 fluidic setup the experimental setup is presented in fig 2 a high resolution camera andor neo scmos 5 50 megapixel up to 500 fps is coupled with an upright nikon eclipse ni microscope to capture image sequences of the displacement process the flow is regulated using a pressure controller ob1 mk3 elveflow for each experiment first the wettability of the micromodel is uniformly modified to the desired contact angle then the micro chip is saturated with the wetting phase finally the wetting phase is withdrawn from the micromodel by adjusting the pressure gradient over the micro chip ranging from 30 mbar to 110 mbar the mean flow rate varies from 2 8 1 0 14 to 1 3 1 0 11 m 3 s 1 all experiments are conducted at room pressure and temperature 4 4 image processing image processing techniques are applied using a self developed matlab code to separate phases and monitor the fluid fluid interface behavior during the displacement process interface velocities are measured by tracking the interface we also benefit from the micro piv technique to measure the velocity field of the wetting fluid roman et al 2016 using the pivlab toolkit thielicke and sonntag 2021 5 results and discussion in this section we present modeling and experimental results of drainage in a pore doublet system first we identify and discuss different flow regimes then we discuss the pore invasion mechanisms governing the front instability and interface behavior during the two phase displacement 5 1 flow regimes based on the front behavior and interface movement in our model porous medium we identified three different flow regimes that depend on c a and m fig 3 namely viscous capillary and cross over flow regime they are observed both experimentally and numerically to illustrate the different regimes a spatio temporal graph representing pore invasion where time is correlated with a color bar is plotted in fig 4 in the following we provide details on the properties of these regimes the viscous flow regime corresponds to greater flow rates log c a 0 5 the invading phase displaces the wetting phase in both channels simultaneously see movie in supplementary materials the interface tends to maintain the same speed in both channels with no pinning behavior of the interface at throats as shown by the parallel superimposed displacement lines in fig 3 b this is in agreement with previous observations of viscous dominated flows in glass beads packs moebius and or 2012 for this flow condition although the absolute capillary forces increase at constrictions they are still negligible compared to viscous forces lenormand et al 1988 the acceleration and deceleration of the interface when it reaches and passes pore throats is observed clearly in simulations but is less pronounced in experiments fig 3 b in fact the model assumes that while the interface moves through the channel it drains all the fluid behind it in experiments however at high flow rates the interface does not displace all the fluid inside a pore and a portion of the wetting fluid remains at pore curvatures around the region where r r p corners and walls as wetting films as shown in fig 5 as a result in experiments the meniscus experiences lower extent of curvature changes hence lower capillary pressure variations resulting in less pronounced acceleration and deceleration of the meniscus the viscous flow regime in fig 4 a is characterized by smooth color transitions due to no abrupt change of velocity during pore invasion this regime is captured experimentally by moebius and or 2014b as simultaneous invasion events of the menisci with partial pore invasion due to the rapidly moving drainage front that limits the time for pore evacuation the residual wetting phase might increase the viscous dissipation at the fluid fluid interface the shear stress along the trapped wetting phase interface while the non wetting phase is flowing in the center of the channel induces a momentum transfer at the fluid fluid interface leading to particles recirculation in the trapped phase in the work of roman et al 2020 the momentum transfer is experimentally highlighted at the steady state condition using micro piv after the non wetting phase percolated the system wetting films and layers seem to play a determining role in existence of these internal circulations in addition we observed particles escaping the internal recirculation and moving from one pore to another through corner films these observations are in contrast with multiphase darcy assumptions that do not consider energy dissipation at the interface between two fluids the capillary flow regime occurs for the lower values of c a log c a 2 5 see movie in supplementary materials in this regime the invading phase only enters one of the channels the pore invasion mechanism in this flow condition is by sudden interfacial instability and burst to the drained pore by an abrupt decrease in local capillary pressure i e haines jumps see fig 3 c it is usually assumed that a displacement of the interface in the direction opposite of the imposed flow can never arise in pore doublets chatzis and dullien 1983 al housseiny et al 2014 nevertheless backward displacements have been observed during drainage experiments in micromodels armstrong and berg 2013 roman et al 2016 see section 5 3 in our experiments in the inlet channel the interface moves backward until the capillary pressure is balanced with the leading meniscus this retraction of the interface is not captured in the graphs fig 3 c because the retraction happens out of the camera field of view however the retraction of the interface in the channel that is not invaded appears well in the simulations fig 3 c retractions in channel 1 in this flow regime the interface is pinned at each pore throat before it reaches the entry pressure of the pore capillary forces dominate the invasion patterns and interface invades pores that have lower entry pressure threshold these observations are in agreement with the drainage experiments of moebius and or 2012 where they observed a transition from avalanche like invasions viscous regime into individual pore invasions haines jumps by decreasing the flow rate for this flow regime most of the wetting phase is displaced from each pore that is invaded as seen in fig 5 the pinning jumping behavior of the interface and the preferential flow path is shown by the sharp color transitions between pores in fig 4 b the cross over flow regime is observed for intermediate capillary numbers 2 5 log c a 0 5 see movie in supplementary materials while in previous studies cross over refers to the transition from viscous to capillary fingering zhang et al 2011 wang et al 2013 in this work it characterizes a new flow regime in terms of pore invasion mechanisms for this regime the interface is able to enter both channels but not at the same time each channel is drained at a different rate see fig 3 d we observed a mixed behavior between pinning jumping i e haines s jumps and invasion i e viscous behavior with no pinning at throats in both channels experimentally and numerically fig 3 d in experiments however both channels can participate in the pinning jumping invasion whereas in simulations the invasion starts by a viscous behavior both channels are invaded then only one channel the larger is invaded by a pinning jumping behavior as seen on fig 3 d we believe that for the microfluidic device there are small differences in capillary entry pressure from one pore to the other due to the microfabrication process whereas for the simulation one of the channels is slightly larger on purpose following each jump we observed a retraction of the interface in the channel that is not invaded at this time as shown by small peaks on the interface position curve in fig 3 d g further discussion on the influence of haines jumps on the flow dynamics is provided in section 5 3 the cross over flow regime is characterized by sharp color transitions between pores and the invasion of both channels in fig 4 a experimental results and simulation predictions of the front behavior are presented in a log c a log m plot known as lenormand s phase diagram lenormand et al 1988 see fig 6 the transition from different flow regimes are in line with previous studies lenormand et al 1988 zhang et al 2011 however there is a difference in transition onsets of the different flow regimes between experiments and simulations overall numerical predictions of the transitions are higher in terms of c a the difference might be explained by the model assumptions that the meniscus always fills the whole pore cross section in contrary to experimental observations where a layer of wetting phase remains at walls and corners fig 5 and that consider that momentum transfer at the fluid fluid interface is negligible recently it has been shown that viscous dissipation may develop at such a fluid fluid interface roman et al 2020 resulting in an increase of the mobility of the wetting phase during drainage roman et al 2020 suggested that viscous coupling is more significant when many small globules of the wetting fluid are immobilized in a porous medium and will impact on larger scales thus this work provide new evidence that the darcy s extended law for two phase flows should not neglect the mutual interactions between the fluids in some cases typically low c a and m close to 1 5 2 invasion dynamics at pore throats in this section our aim is to identify the pore invasion dynamics characteristic of each flow regime for that purpose we measured the invasion time of one pore τ i e time from one pore throat to the next one for various flow conditions see fig 7 this invasion time τ is the sum of the pinning time at the pore throat t p i n and the time for the interface to move from the pore throat to the next pore throat t j u m p with τ t p i n t j u m p the pinning time during which capillary pressure increases is indicative of the dominance of capillary forces whereas a quick succession of jumps with t p i n 0 is indicative of the dominance of viscous forces the measured invasion times are normalized by the average invasion time of one pore based on the mean flow rate in the invaded channel τ τ τ c with τ c h q i a c with q i being the average flow rate in one channel thus τ 1 when each pore is invaded at the same rate we plotted τ for successive pore invasions we present also the histograms for the values of τ for the three flow regimes in fig 7 we obtain a mean value for τ of 1 00 and a standard deviation δ of 0 16 for the viscous flow regime the mean value of τ is equal to 0 982 with δ 0 18 for the capillary flow regime whereas the mean value for τ is 0 95 and the δ 0 52 for the cross over flow regime 1 1 the first pore invasions before the vertical line are under the inlet effect as seen by first pinning times that are lower than the mean values these first pores are not taken into account for the averaged values for the viscous flow regime there is no pinning at pore throats thus τ t j u m p and the invasion times are very regular from one pore to the other in this case the viscous forces are dominant and the jump velocities are dependent on bulk flow rate as previously described by armstrong and berg 2013 for capillary and cross over flow regimes the interface is pinned at each pore throat before it invades the pore by haines s jump for the capillary flow regime the duration of each jump is negligible compared with the pinning time i e τ t p i n moreover the standard deviation of τ from the mean invasion time is low this is characteristic here of regular pinning times for all pores these characteristics of invasion times were reported by moebius and or 2012 indeed they observed clear waiting times between two interfacial jumps for low withdrawal rates for the capillary flow regime the invasion time depends on the timescale of capillary forces i e on the time during which the capillary pressure rise at a pore throat here the invasion times are regular because the pore throat size is homogeneous through the porous media in this work we newly characterized the intermediate crossover regime for which invasion times are not constant through the pore invasion process this is reflected by a wider range of τ and higher deviation from the mean value see fig 7 for this flow regime τ t p i n t j u m p where t p i n or t j u m p can be dominant or equally important consequently the invasion time for some pores is very short τ 1 while a longer invasion time τ 1 is observed for other pores this is attributed to the interaction between the different active forces in the invasion process for this flow regime the velocity of the interface reached during a pore invasion may initiate a quick invasion of the next pore τ 1 as observed for the viscous flow regime on the contrary as the two menisci advance one event i e one jump in one channel dominates and can inhibit invasion in the other channel as observed for the capillary flow regime and by armstrong and berg 2013 thus this flow regime is characterized by cooperative pore filling events that will be further discussed in the next section using micro piv measurements the pinning behavior i e when the interface stops at a pore throat was observed experimentally however in our simulations the interface is always moving with no actual pinning time we can see in fig 3 c that for the capillary flow regime at pore throats the interface creeps slowly toward the tightest part of the channels we believe that this is due to the imposed flow rate in the model and the effect of dynamics of corner and film flow during experiments not permitted in the model for this flow regime indeed when the interface is pinned at a pore throat we observed a flow of wetting phase through corners of the channels in the direction of the imposed flow rate the dynamics of corner flows and their consequences on pore invasion mechanisms will be part of a future work in this section we demonstrate the role of interfacial dynamics on defining pore invasion mechanisms these interfacial effects are further discussed in the next section 5 3 influence of haines jumps on flow dynamics in neighboring pores in this section our aim is to determine what are the consequences of haines jumps on the macroscopic transport properties of multiphase flow in porous media e g fluid entrapment energy dissipation for that we focus on the interface and fluid dynamics for slow drainage conditions i e capillary and cross over flow regime when haines jumps is the dominant pore invasion mechanism first we discuss the dynamics of the fluid fluid interfaces during invasion then we present results on the dynamics of the fluids using micro piv particle image velocimetry measurements 5 3 1 fluid fluid interface dynamics during haines jumps the dynamics of the interface for the cross over flow regime is shown on fig 8 in this case channel 1 is invaded by haines jumps while the interface is pinned at the pore throat in channel 2 on fig 8 b we show measurements of the position of the interface as a function of time in channel 2 in the channel that is not invaded at that time channel 2 the interface shows a back and forth movement that is synced with haines jumps happening in the adjacent channel channel 1 the sequence of events in channel 1 and 2 is as follows 1 the fluid fluid interfaces are pinned at a pore throat in both channels while the capillary pressure increases 2 the pore entry pressure is reached for channel 1 leading to the invasion of the pore by a haines jump the capillary pressure drops and the interface in channel 2 retreats toward the widest part of the constriction 3 the interface advance until the narrowest part of the pore throat in both channels and the capillary pressure increases again until a new invasion either in channel 1 or 2 the oscillations of the interface after abrupt invasions have been observed previously in microfluidic and glass beads experiments moebius and or 2012 armstrong and berg 2013 roman et al 2016 in this work we are able to link each fast event haines jump to its associated backward movement in the adjacent channel due to pressure release in the micromodel experiments of armstrong and berg 2013 the interface is retracting to the nearest pore body i e nearest larger cross section after an invasion by haines jump in our observations the interface is also retracting to larger sections of the channel but the retraction is limited to the pore throat vicinity see fig 8 armstrong and berg 2013 observed meniscus retractions over a distance of up to 4 pores from the pore drainage events in this work we observe that the oscillations of the interface can arise very far from the invaded pore up to the full channel length that contains multiple pores thus the capillary pressure difference during drainage in porous media has probably effects over many pores around the invasion events this should be kept in mind when defining a two phase representative elementary volume armstrong and berg 2013 for upscaling purpose it is also worth mentioning that the interfacial oscillations show a size dependent property the larger the pore sizes are the more dominant the inertial oscillations will be that is why in experiments of moebius and or 2012 mm scale the repetitive inertial oscillation is clearly distinguishable however in our geometry and work of armstrong and berg 2013 μ m scale the oscillations are rapidly damped this size dependency of interfacial dynamics is also observed in the model when larger systems show the full oscillation wave while in small systems the interface rapidly finds its equilibrium state several studies have also observed that for capillary dominated regimes two phase flow occurs along pathways that periodically disconnect and reconnect in a series of snap off and reconnection events called intermittent pathway flows spurin et al 2019b we believe that oscillations of the interface due to haines jumps are one mechanisms responsible for intermittent pathway flows as mentioned previously a backward movement of the interface is usually not permitted in pore doublet models chatzis and dullien 1983 al housseiny et al 2014 our observations clearly indicate the need to allow such displacements in the models 5 3 2 fluid dynamics at slow drainage conditions in this section our aim is to identify the consequences of interface dynamics i e haines jumps on fluid flow through the porous media we performed micro piv measurements in the aqueous phase to relate interface dynamics to fluid flow in our system in fig 9 we report measurements of fluid velocities using micro piv at different locations in the channels as well as the velocity of the interfaces for the capillary and crossover flow regime respectively 2 2 note that piv measurements are reported with an eulerian representation i e velocity of the fluid viewed from a fixed point in space whereas interface velocity is reported in a lagrangian way i e by following the interface in fig 9 we show that front velocity during haines jumps reaches velocities much higher than the average front velocity up to 34 times greater for the capillary flow regime and 15 times greater for the crossover flow regime here blue for both flow regimes the fluid velocity is disturbed and shows an oscillating movement linked with each jump of the interface see zooms in fig 9b and c this back and forth movement is observed close to the invading interface as well as far from it more than 15 pores away this back and forth movement of the wetting fluid has been previously observed during drainage in micromodels by roman et al 2016 and blois et al 2015 it has been mentioned that it is probably a consequences of haines jumps however due to the complex pore structure used in these studies it was not possible to relate interface dynamics events to fluid flow behavior here we provide the confirmation that the back and forth movements of the fluid are a result of pressure instabilities caused by haines jumps we also show that these pressure instabilities can propagate through the system more than ten pores apart from the drainage events we identified a major difference between the capillary and crossover flow regime for the capillary flow regime the flow is disturbed by each haines jumps with no effect on the interface dynamics indeed the jump dynamics is dominated by capillary forces this results in jumps regularly spaced in time and invading only one capillary for the crossover flow regime the flow is more disturbed after each jump with consequences on the interface dynamics a jump of the interface comes with a backward movement of the fluid this backward flow has the same intensity for the capillary and the crossover flow regime around 1 times the mean velocity see fig 9 b c the backward movement is followed by an acceleration of the forward flow that reaches velocity around 1 times the mean velocity for the capillary flow regime and up to 4 times greater than the mean velocity for the crossover flow regime this sudden acceleration of the flow is sometimes linked with avalanche like pore invasion for the crossover flow regime thus by increasing the flow rate and moving from the capillary to the crossover flow regime it causes interference between the dynamics of pore invasions in both channels and cooperative pore filling is observed indeed invasion in one channel might provoke or delay invasion in the adjacent channel and cause different pore invasion dynamics from pore to pore thus it seems that flow perturbations throughout the whole porous medium are driven by local pressure gradients that can change in intensity and direction in this work we provide a clear link between each interface dynamics and flow instabilities flow perturbations have consequences on the interface dynamics as we increase the flow rate and move from the capillary to the crossover flow regime these phenomena emphasize the importance of taking into account pore scale mechanisms related to the drainage pressure lenormand et al 1983 for the crossover flow regime 6 conclusion in this work the multiphase displacement front instability in porous media for unfavorable viscosity ratio m 1 at drainage conditions in a pore doublet was revisited a microfluidic system was used to study fluids and meniscus displacement in pdms microchips with controlled pore and throat shape and size a theoretical model based on the volume averaged navier stokes equation was proposed to study the interface behavior during the displacement process a micron scale pore doublet porous system composed of a succession of pores and throats in form of sinusoidal channels was used to investigate the front behavior for various fluid pairs and flow conditions with this setting having a meticulous observation and measurement of displacement properties and pore invasions was done and compared directly with the model we have captured and modeled fundamental pore invasion mechanisms associated with each flow regime and we have highlighted the role of viscous and capillary forces on the dynamics of interface and pore invasion major differences were observed between viscous and capillary dominated flow regimes in terms of front behavior interface dynamics and pore invasion mechanisms for the viscous flow regime viscous forces are dominant and control the front and displacement displacement occurs in both channels with a stable front with continuous interface displacement and it does not stop at throats due to its velocity and momentum forces meanwhile the interface does not find enough time to expand over the whole pore surface area and a body of residual wetting fluid remains at curvatures of pore space normal to the invasion direction the retention of wetting layer in corners and curvatures of the geometry for viscous flow regime results in a greater residual saturation hoogland et al 2016 naghavi and kibbey 2014 haines jumps are the dominant pore invasion mechanism at the capillary flow regime for the capillary flow regime capillary forces are dominant and the pore in which the interface reaches the invasion threshold pressure will be invaded this leads to suppression of the invasion in one of the channels for this pore invasion mechanism the interface expands laterally and displaces all the wetting phase except for corner wetting fluid the crossover flow regime newly identified presents a mixed behavior of capillary and viscous flow regime both channels are invaded however they will not participate similarly in the displacement pore by pore invasion mechanism is the main invasion process by focusing on pore scale dynamics we showed that the flow is highly disturbed by each haines jump for the cross over flow regime it results in pore invasions that can be provoked or prevented and variable duration between each jumps the presented model is able to capture main pore invasion mechanisms and show similar displacement behaviors for all flow regimes results of the model are used to predict flow regime transitions in terms of log c a l o g m phase diagram there is still room for improvement of the model by taking into account viscous coupling between displacing and displaced phase and including corner flows that will be a part of the following work credit authorship contribution statement mahdi mansouri boroujeni conceptualization software methodology investigation visualization writing original draft cyprien soulaine conceptualization software writing review editing mohamed azaroual supervision writing review editing funding acquisition sophie roman conceptualization supervision methodology writing review editing funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments experiments have been performed at nano μ lab a nano microfluidic laboratory in orléans france that is part of the eccsel consortium and of the project stories storage research insfrastructure eco system european research infrastructures capacities and services to address european green deal challenges mmb acknowledges the support from french geological survey bureau de recherches géologiques et minières brgm for phd grant the research leading to these results has received support from the french agency for research agence nationale de la recherche anr through the grant planex anr 11 eqpx 36 the labex voltaire anr 10 labx 100 01 and through the framati project under contract anr 19 ce05 0002 authors show their sincere gratitude toward dr arnaud stolz dr rémi dussart and jack nos for giving us the opportunity to prepare microfluidics master molds in the cleanroom of gremi umr7344 this work was also supported by laas cnrs micro and nanotechnologies platform a member of the renatech french national network this project has received financial support from the cnrs through the miti interdisciplinary programs and cellule energie of cnrs through the project escapades mmb thanks dr pierre yves passaggia for lending a phantom v341 fast camera for image sequence acquisitions appendix a supplementary data supplementary material related to this article can be found online at https doi org 10 1016 j advwatres 2022 104353 appendix a supplementary data the following is the supplementary material related to this article video s1 video s2 video s3 mmc s4 
79,gases may be released into shallow groundwater systems during energy development and geological carbon storage commonly referred to as gas migration gm and can result in greenhouse gas emissions safety concerns and the reduction of groundwater quality the physiochemical processes occurring during gm including gas release movement partitioning and dissolved phase transport in the saturated groundwater zone are difficult to characterize and model however modeling is important to develop strategies for detecting and monitoring gm and formulate conceptual models to describe gm at impacted sites in this study a previously developed numerical model which coupled macroscopic invasion percolation macro ip and multicomponent mass transfer was enhanced to simulate gas releases in the shallow subsurface evaluation of the effects of the coupled physiochemical processes was performed by comparing model simulations to previously conducted bench scale gas injection experiments results show that gas flow is highly sensitive to the entry pressures assigned within the model domain and the critical gas saturation s g crit used to model gas water flow based on macro ip however mass transfer and the resulting domain scale dissolved gas transport were relatively insensitive to these parameters multicomponent mass transfer considering not only the partitioning of the released gas but also the dissolved background gases ubiquitous in shallow groundwater was vitally important to simulate dissolution and the resulting free phase gas distribution within the experimental systems the use of the local equilibrium assumption for gas water mass transfer could not consistently describe the experimental observations overall the modeling evaluation performed in this study provides improved understanding of the key processes controlling gm in the shallow subsurface and will advance efforts including up scaling and scenario testing to accurately quantify the environmental impacts of gm keywords gas migration multiphase flow mass transfer gases multicomponent invasion percolation data availability data will be made available on request 1 introduction at sites with petroleum resource development there is the potential for the release of gases including methane ch4 ethane c2h6 and propane c3h8 into shallow groundwater systems gas release can occur due to energy wells suffering integrity issues which allows gas to migrate outside of the well casings through the geological formation toward the surface cahill et al 2017 dusseault and jackson 2014 jackson et al 2013 this unintended release is termed gas migration gm which can intersect groundwater aquifers and lead to emissions to the atmosphere in addition to leaking oil and gas wells methane releases into shallow aquifers can also occur from other subsurface sources including coalbed methane seams and methane hydrate reservoirs it is also possible that gm may occur because of decarbonization efforts specifically geological carbon storage where carbon dioxide co2 is injected deep below the earth s surface for free phase gas to be trapped there is concern that injected co2 may be released via legacy oil and gas wells or due to integrity issues associated with the confining cap rock celia 2017 celia et al 2011 nogues et al 2012 similar to gm observed for natural gas co2 may be released to shallow groundwater and the atmosphere regardless of the source of gas release once in an aquifer released gas e g ch4 co2 can migrate as free phase gas moving vertically and or laterally depending on the aquifer characteristics cahill et al 2018 klazinga et al 2019 molofsky et al 2021 van de ven and mumford 2020a released free phase gas may pass through an aquifer then intersect the unsaturated zone and be emitted at the surface termed surface expression emitted gas that enters a confined space may result in the possible development of explosive conditions in surrounding infrastructure forde et al 2018 free phase gas will also dissolve into flowing groundwater within the saturated zone forming dissolved gas plumes dissolved phase gas may affect groundwater quality due to changes in redox conditions liberation of metals and alteration of aesthetic characteristics cahill et al 2013 forde et al 2019 kelly et al 1985 roy et al 2016 schout et al 2017 sources of gas released below the water table such as those resulting from gm lead to gravity destabilized gas flow because of the upward invasion of less dense fluid gas within the saturated system gurevich et al 1993 saffman and taylor 1958 van de ven and mumford 2019 although gravity destabilized gas flow leads to preferential vertical growth of gas due to buoyancy gravity forces destabilized gas flow is also governed by capillary and viscous forces which can lead to lateral gas movement frette et al 1992 gurevich et al 1993 the balance of these forces causes different gas flow regimes which include migration through continuous connected channels or via discontinuous clusters brooks et al 1999 ji et al 1993 selker et al 2007 continuous flow is comprised of a single migrating connected gas phase along the length of the channel whereas discontinuous flow is made up of disconnected gas clusters that migrate independently the resulting regime depends on the physical conditions of the gas entering the aquifer e g pressure leak rate aquifer properties e g pore size distribution permeability heterogeneity anisotropy and fluid properties e g density viscosity geistlinger et al 2006 ji et al 1993 selker et al 2007 van de ven and mumford 2019 for continuous gas flow gas channels are vertically connected due to drainage of saturated pore space as the channel progresses upwards in contrast discontinuous flow results in discrete disconnected gas clusters along the height of the channel because of drainage of saturated pore space but also simultaneous imbibition of gas filled pore space due to hysteresis the different flow regimes result in significantly different flow patterns geistlinger et al 2006 selker et al 2007 it has been shown that based on the expected rate of gas leaks into aquifer systems from gm both flow regimes can be expected depending on the porous media characteristics and the distance gas has migrated from the source selker et al 2007 van de ven et al 2020 the resulting flow pattern will affect the subsequent mass transfer from trapped gas within the pore space sale and mcwhorter 2001 because continuous channels are connected along their entire height interfacial area for mass transfer is lower than for discontinuous flow resulting in a lower effective rate of dissolution in contrast if gas is present in the form of discrete clusters resulting from discontinuous flow interfacial area between the free phase gas and the aqueous phase tends to be relatively high thus allowing more rapid dissolution of trapped gas van de ven and mumford 2020a mass transfer occurring in the saturated zone when gaseous components are present is complicated by the multicomponent nature of gas mixtures cirpka and kitanidis 2001 gupta et al 1994 in the case of gm free phase gas is often comprised of multiple components including ch4 c2h6 and c3h8 and other non hydrocarbon components e g co2 and noble gases most notably helium jackson et al 2013 in addition shallow groundwater contains several dissolved gas components including atmospheric gases such as nitrogen n2 and oxygen o2 as well as gases of biogenic origin such as co2 and ch4 as a result partitioning between the gas and aqueous phase depends on the concentration differences that exist between the phases for all components cirpka and kitanidis 2001 miller et al 1990 for example ch4 present in free phase gas emplaced during gm will dissolve into the flowing groundwater while simultaneously dissolved gases present in the groundwater e g n2 and o2 will exsolve into the gas phase balcke et al 2011 forde et al 2019 van de ven and mumford 2020b multicomponent mass transfer is therefore important to consider for problems involving gm and in other situations where free phase gas is present most existing multiphase and reactive transport codes are based on the continuum approach which solves a system of darcy scale multiphase flow equations that can be coupled with reactive transport however these continuum models are generally not capable of simulating discontinuous gas flow behavior which can occur during free phase gm below the water table geistlinger et al 2009 mumford et al 2015 as an alternative approach multiphase flow has been simulated based on invasion percolation ip theory wilkinson and willemsen 1983 with additional modifications often referred to as modified invasion percolation mip to account for gravity forces and to capture discontinuous flow by including imbibition thresholds e g terminal pressure meakin et al 1992 wagner et al 1997 using an ip approach a discrete gas phase is modeled within a saturated domain and a set of physical rules are defined based on the threshold for gas drainage from a single pore to allow gas movement an ip model therefore moves gas phase through a domain by searching for neighboring sites with the lowest threshold for gas to invade and displace water which is determined by the hydrostatic and capillary pressure requirements or by searching for sites where imbibition is favorable i e where water can re invade a site and displace gas the model continuously iterates through the domain searching for the next most favorable condition gas invasion or imbibition a detailed description can be found in the proceeding methods section because of difficulty measuring pore scale characteristics within larger systems a macroscopic ip macro ip approach has been developed where each subregion of a domain single grid block denoting a representative elementary volume rev of individual pores is assigned a macroscopic fluid invasion threshold entry pressure glass et al 2001 krol et al 2011 kueper and mcwhorter 1992 molnar et al 2019 mumford et al 2010 using macro ip and modified approaches for destabilized flow has been shown to capture the essential physics of discontinuous flow at lower computational costs than pore scale models banerjee et al 2021 to simultaneously describe mass transfer to surrounding groundwater mumford et al 2010 combined the macro ip approach with the multicomponent mass transfer model of cirpka and kitanidis 2001 to simulate the volatilization of dense non aqueous phase liquid pools dnapls in the presence of a gas phase the cirpka and kitanidis model uses a defined system of equations based on the local equilibrium assumption lea combining henry s law for the individual gas components and dalton s law to calculate the gas saturation within a rev as partitioning occurs see below for a detailed description mumford et al 2010 successfully coupled the models and compared model results with observations from volatilization experiments in addition this model has been used to simulate processes during thermal remediation krol et al 2011 the combined model offers a computationally expedient approach to simulate gas flow and mass transfer in saturated porous media which may be applicable to modeling gm however the coupled model is not able to simulate gas injection and has not been validated for use in systems where gas is being injected or leaked numerical models are needed to better understand and quantify the risk of gm in groundwater systems such models will enable the formulation of a more accurate conceptual model for gm and the development of monitoring and mitigation strategies to combat adverse environmental impacts to shallow groundwater these numerical models must include key physiochemical processes including gas release migration and partitioning to surrounding groundwater which are expected to occur in the subsurface during gm in this study the key processes to model gm in saturated groundwater systems were evaluated by enhancing a coupled numerical model such that gas release flow and subsequent dissolution of gases to surrounding pore water in the saturated zone could be simulated the specific objectives of this study were to i implement a model to simulate gas release and mass transfer in saturated groundwater systems ii qualitatively compare simulations and experimental results to delineate multiphase flow and mass transfer processes during release of free phase gas in the saturated zone and iii systematically investigate the effects of various system parameters to understand their impact on processes involved in gm to do so the model developed by mumford et al 2010 macro ip coupled with mass transfer referred to herein as macro ip mt was enhanced by implementing the release of free phase gas below the water table then simulations were compared to bench scale 10s of cm laboratory gas injection experiments conducted by van de ven and mumford 2018 2020b 2 methods 2 1 model description 2 1 1 original macro ip mt model the macro ip mt model developed by mumford et al 2010 simulates the flow and dissolution of gases in saturated subsurface systems using established macro ip approaches for gas movement coupled with the gas partitioning model by cirpka and kitanidis 2001 the macro ip model describes gas flow as a vertical series of disconnected gas clusters that can coalesce mobilize fragment or contract mumford et al 2010 wagner et al 1997 these clusters are represented as connected gas filled grid blocks within a discretized domain because a macroscopic scale is used the amount of gas within each grid block is defined by the gas saturation sg m3 gas m 3 void for a discontinuous gas phase represented by a single gas filled grid block or a series of connected gas filled grid blocks sg 0 the macro ip algorithm follows a stepwise approach by first identifying all connected gas clusters a cluster is identified by searching out all grid blocks with sg 0 and determining if they are connected additionally for the next steps within the macro ip algorithm the gas saturation within a cluster must be equal or greater than a critical gas saturation s g crit s g crit represents the minimum gas saturation within a grid block that must be achieved before expansion to neighboring blocks can occur based on previous studies e g krol et al 2011 molnar et al 2019 mumford et al 2010 a single consistent value for s g crit is assumed for all grid blocks within the domain if a cluster or multiple clusters exist that meet the defined s g crit criteria the macro ip algorithm progresses and the invasion pressure threshold of each neighboring block is calculated the invasion threshold is defined as 1 p t e p e p w where p t e is the threshold pressure for gas invasion entry pa pe represents entry pressure pa associated with the grid block i e the capillary pressure at which gas occupies and spans the grid block gerhard and kueper 2003 the local value for the absolute pore water pressure pw pa can be calculated as follows 2 p w ρ w g h p a t m where ρ w is water density kg m 3 g is acceleration due to gravity m s 2 h is the pressure head m and patm is atmospheric pressure pa once the p t e of all neighboring grid blocks is defined the block with the lowest invasion threshold is selected to be the next invadable site the neighboring grid blocks might vary depending on the chosen lattice geometry and connectivity which is defined as the coordination number for a 2d system this can be four where orthogonal sites are connected and considered a neighboring site for invasion or it can be eight where both orthogonal and diagonal sites are connected within the simulated porous medium in addition to a gas invasion threshold a withdrawal threshold is defined to account for mobilization and fragmentation of the gas clusters by imbibition of water at a gas occupied site this threshold can be defined as 3 p t t p t p w where p t t is the gas withdrawal threshold pa and pt is the terminal pressure pa which is the minimum capillary pressure that can exist in a connected gas cluster before imbibition occurs gerhard and kueper 2003 once the invasion and withdrawal threshold pressures are identified for a cluster gas movement can occur by expansion mobilization fragmentation or contraction based on total gas pressure pg pa within a cluster detailed conceptual descriptions can be found in molnar et al 2019 the total gas pressure can be expressed according to dalton s law as 4 p g i p i firstly for gas to expand from one grid block to another the total gas pressure needs to be greater than p e t of a neighboring site 5 p g p t e when the gas pressure is greater or equal p t e the invaded site is assigned sg s g crit the gas phase mass is then distributed within the expanded cluster assuming the gas behaves according to the ideal gas law based on the model being applied in low temperature and low pressure conditions after redistribution the new gas pressure is assigned to each grid block within the cluster for the cluster to either mobilize or fragment the withdrawal threshold in any gas occupied site needs to be greater than the entry threshold of any neighboring water saturated site 6 p t t p t e whether mobilization or fragmentation occurs depends on the location of the grid block where re invasion occurs mobilization occurs if the re invasion is at the periphery of a cluster and fragmentation occurs if re invasion results in the disconnection of a gas cluster mumford et al 2009 when this occurs the neighboring site is invaded the gas phase mass from the imbibed grid block is added to the disconnected cluster and the pressure within the cluster is recalculated assuming ideal conditions the sg in the reinvaded grid block is then set to 0 the macro ip algorithm iterates through all gas clusters until no further redistribution is possible based on the defined macro ip rules eqs 1 6 the gas distribution is then passed to the multicomponent partitioning model of cirpka and kitanidis 2001 based on the resulting gas saturation and gas pressure within a grid block from the macro ip algorithm multicomponent partitioning of volatile compounds between the aqueous phase and the gas phase cirpka and kitanidis 2001 considers an rev and assumes local equilibrium defined according to henry s law 7 p i c i a h i where pi is the partial pressure of gas i pa c i a is its dissolved concentration mol m 3 water and hi is the henry s constant pa m3 water mol 1 specific to gas i assuming that the gases behave in an ideal manner the gas phase concentration c i g mol m 3 gas can then be defined as 8 c i g p i r t where r is the gas constant pa m3 mol 1 k 1 and t is the temperature k thus the total gas concentration c i t mol m 3 void in the saturated groundwater zone accounting for gas present in the free phase and dissolved in the aqueous phase can be defined as 9 c i t s w c i a s g c i g aqueous and gas phase saturations are related by 10 s w s g 1 using eqs 7 10 the following expression can be derived for the total concentration c i t for gas i 11 c i t 1 h i r t 1 s g c i a the partial pressure for gas i can then be defined as a function of c i t 12 p i c i t h i 1 h i r t 1 s g if a gas phase is present pg must be equal to the sum of pw and the capillary pressure pc thus the following system of equations can be solved for the gas saturation and gas concentrations aqueous and gas phase within the rev cirpka and kitanidis 2001 13 p g p w p c i c i t h i 1 h i r t 1 s g where pc can be defined using capillary pressure saturation relationships such as brooks and corey 1964 and van genuchten 1980 using the van genuchten model pc can be written as 14 p c 1 α s w s r 1 s r 1 m 1 1 n where α m 1 m and n are soil hydraulic function parameters sw m3 water m 3 void is aqueous phase saturation and sr m3 water m 3 void is residual water saturation it should be noted that if the sum of the partial pressures based on henry s law within an rev is less than pw no gas phase exists and sg 0 assuming that solute transport is purely horizontal and that longitudinal and transverse dispersion are negligible the mass transfer described by eq 13 can then be integrated within the 1d advection equation cirpka and kitanidis 2001 15 ϕ c i t t q c i t 1 h i r t 1 s g 0 where ϕ is porosity m3 void m 3 bulk q is the darcy flux m s 1 and t is time s 2 1 2 gas injection term to advance the macro ip mt model to evaluate key processes when simulating gas releases in fully saturated groundwater systems a gas injection routine was added to the model gas injection was accomplished by defining an injection grid block within the domain in this grid block it is assumed that injected gas can displace all water with the exception of residual water because gas is continuously being released within this area of the domain yielding a maximum gas saturation s g m a x of 16 s g m a x 1 s r then based on the injection flow rate and the gas volume within the injection block the moles of each gas component within the injection grid block are calculated by 17 n i s g t 1 v g b ϕ c i g n i δ t where ni is the moles of gas i in the gas phase mol within the injection block s g t 1 is the gas saturation in the injection block at the end of the previous time step m3 gas m 3 void vgb is the volume of the grid block m3 bulk n i is the injection rate of gas i mol s 1 and δt is the time step s the partial pressure of each gas can then be calculated assuming ideal behavior 18 p i n i r t s g m a x v g b ϕ the total gas pressure within the injection grid block can then be computed based on eq 4 the defined gas injection term was integrated within the existing macro ip mt model as described in the proceeding section using this approach the mass injected is preserved and the rate of injection can be controlled it should be noted that because macro ip only considers gravity and capillary forces to govern gas flow the mass flow rate defined should be constrained to a rate which produces discontinuous flow in this context identifying the upper limits of defined injection rates goes beyond the scope of this work however consideration of the media characteristics and injection conditions is required to identify this threshold geistlinger et al 2006 selker et al 2007 van de ven and mumford 2019 2 1 3 coupling to couple the processes described above gas injection gas movement and multicomponent mass transfer within the model a split operator approach is used starting from the initial conditions defined for a simulation the model sequentially progresses through the algorithm during a single user defined time step fig 1 each step commences by releasing gas into the defined injection grid block using eqs 16 18 once the new mass of injection gas is emplaced and new total gas pressure is calculated the new pressure is inputted to the macro ip algorithm eqs 1 6 and the gas is redistributed it should be noted that macro ip does not redistribute water as it is displaced from or imbibed to a grid block however the dissolved phase mass is accounted for in the overall system mass balance by summing the total mass loss and adjusting the final mass balance accordingly the change in mass of all dissolved gases was found to be negligible however it was included for completeness with updated gas phase mass distribution following gas transport partitioning between the gas and aqueous phase takes place in each grid block and advective transport of all aqueous components occurs based on eq 15 this represents the end of that time step and the algorithm recommences by injecting more gas into the system the looped algorithm continues until some stopping criteria is met for the current implementation the stopping criteria is a defined total simulation time aligned with the duration of the experiments simulated see below it should also be mentioned that the time step is selected to ensure physically realistic system conditions are met based on a check implemented prior to the transport routine ensuring that sg 1 sr and sg and pc 0 if any of these conditions are violated the system is reset to conditions prior to the previous timestep and the timestep is reduced by a user defined factor and repeated a flow chart summarizing the algorithm is shown in fig 1 2 2 laboratory experiments two previously conducted experiments by van de ven and mumford 2018 experiment 1 and van de ven and mumford 2020b experiment 2 were selected for simulation using the enhanced model to assess key processes these experiments were chosen specifically to demonstrate how the ratio between the gas injection rate and the water flow rate will affect gm in the subsurface the experiments are briefly described in the proceeding subsections for detailed descriptions please refer to van de ven and mumford 2018 experiment 1 and van de ven and mumford 2020b experiment 2 both experiments utilized thin 1 cm thick flow cells that can be considered quasi 2d and the experiments were therefore modeled using 2d domains it is also noted that both experiments used co2 as the injected gas as a surrogate for ch4 enabling a high resolution visual quantification technique to be used the details of which are described below 2 2 1 experiment 1 decoupled co2 gas injection and subsequent dissolution van de ven and mumford 2018 performed gas injections using co2 gas into a water saturated quasi two dimensional flow cell with dimensions of 25 25 1 cm3 packed using 20 30 accusil sand fig 2 soil parameters for the sediments used in the experiments obtained from measured values and reported values in the literature e g schroth et al 1996 hegele 2014 are summarized in table 1 the flow cell was sealed along the top boundary to limit any rearrangement of grains during injection and to ensure no gas was lost from the system co2 gas was chosen in this study because it allowed for a visual technique to be used for quantification of dissolved co2 concentrations created by dissolution to achieve this the pore water was dyed using a ph indicator resazurin which changes from a purple color at a ph of 5 6 atmospheric conditions in deionized water to an orange color at a ph of 3 8 approximate solubility limit of co2 at 1 atm and 25 c based on the change in hue as co2 dissolution changes the ph of the pore water this technique enables dissolution to be measured at high spatial and temporal resolutions during the experiment co2 gas was injected through a port at the bottom left edge of the flow cell initially the gas was injected at 15 ml min 1 over a 10 s time period in the absence of water flow through the system fig 2a once the gas was emplaced water flow was initiated from left to right through the system at a darcy flux of 0 0073 cm s 1 or average linear groundwater velocity of 0 02 cm s 1 based on the measured porosity of 0 38 as shown in fig 2b until complete co2 dissolution occurred the experiment was conducted in triplicate however for this study only two replicate experiments were simulated r1 and r2 as defined in van de ven and mumford 2018 these experiments were selected to validate the macro ip mt model as the gas invasion occurred during the first 10 s effectively independent of mass transfer to the aqueous phase allowing the model to be evaluated with mass transfer decoupled from gas invasion 2 2 2 experiment 2 co2 injection with simultaneous gas dissolution in the same quasi two dimensional flow cell and porous media described above table 1 van de ven and mumford 2020b performed a continuous co2 gas injection into flowing water in the top 4 cm of the flow cell above a 21 cm sand layer a high permeability air flow layer was created using unsaturated glass beads to collect the gas escaping from the top boundary in this set of experiments co2 gas was injected in the center of the cell 2 cm from the bottom using a combination of various injection rates and aqueous flow velocities for the laboratory experiments the gas injection rate was varied between 0 1 and 1 ml min 1 to achieve discontinuous gas flow and the left to right water flow velocity varied between 0 045 and 0 343 cm s 1 these relatively fast water flow velocities were used in the experiments to understand the effects of mass transfer over the height of the small flow cell compared to an aquifer with relatively lower velocities but larger vertical length scale for this study only one of the conducted experiments was simulated with a co2 gas injection rate of 0 5 ml min 1 and water flow velocity of 0 045 cm s 1 as shown in fig 3 experiment 0 5 b from van de ven and mumford 2020b this experiment was chosen because the relatively low water flow velocity was expected to result in conditions appropriate for the application of the lea in the model experiment 2 was selected to evaluate the enhanced macro ip mt model during simultaneous gas and water flow within a system allowing the key processes and their coupling to be assessed 2 3 model implementation the domain and porous media characteristics were similar between the two experiments table 1 however the gas injection configuration rates and water flow parameters were different simulations for experiment 1 were conducted on a 25 cm by 25 cm two dimensional domain discretized into 2 5 mm grid blocks and for experiment 2 a 25 cm by 20 cm two dimensional domain was used discretized into 2 5 mm grid blocks the porous media characteristics were assumed to be homogeneous based on the values in table 1 and each grid block was assigned the same porosity and van genuchten parameters to assign pe values to the domain inverse transform sampling was used to generate a random distribution of entry pressure values assuming a cumulative distribution function equal to the measured capillary pressure saturation relationship of the simulated sand fitted using the van genuchten model glass et al 2001 mumford et al 2010 wisheart 2019 because the pe distribution was randomly generated and it is expected that this distribution could affect the simulated gas flow experiment 1 was statistically parameterized by generating 30 unique distributions of pe values gas injection simulations were performed for each realization to understand the expected variability in the simulation results experiment 2 was statistically parameterized by selecting 3 unique distributions of pe values values for pt were assigned to the domain using the random distribution of pe values generated and assuming that pt scaled proportionally by a factor of 0 64 based on gerhard and kueper 2003 because the simulations were conducted within a 2d domain the selected coordination number was four each experiment was simulated assuming a three component system co2 n2 and o2 the henry s constants for co2 n2 and o2 were 2 94 103 1 53 105 and 8 04 104 pa m3 mol 1 respectively sander 2015 the influent and initial aqueous concentrations in the domain were assumed to be at equilibrium with the atmosphere 400 ppmv co2 79 v v n2 and 21 v v o2 with concentrations of 0 014 0 523 0 265 mmol l 1 for co2 n2 and o2 respectively injected gas was pure co2 water flow was modeled using a constant flux boundary condition on both the influent and effluent edges for both experiments for experiment 1 the enhanced algorithm was decoupled such that the macro ip was solved independently of mass transfer for the initial 10 s of the simulation then mass transfer from the resulting gas distribution occurred for the remaining duration of the simulation gas and water flow rates were set to match the experiment as described above the simulation was run for 33 3 min for experiment 2 the simulations were performed with the coupled algorithm such that simultaneous gas flow and mass transfer occurred similarly gas and water flow rates were set to match the experiment as described above the simulation was run for 170 min the algorithm was implemented in matlab r2020a as a result of flow within the experimental domain being horizontal the system was modeled as a stacked in the z direction set of horizontal 1d flow paths in the x direction using the 1d advection equation eq 15 the presence of free phase gas could induce a vertical flow component but as a simplification this was assumed to be negligible based on the design of the experiment eq 15 was solved using an explicit downstream finite difference approach for multicomponent mass transfer eq 13 was solved numerically using the predefined function fsolve within matlab to solve the system of equations the total concentrations were quantified based on the aqueous concentrations after transport in the previous timestep and the new gas concentrations based on the macro ip routine in the current timestep it was assumed that lateral and transverse dispersion in the aqueous phase were negligible justified by the homogeneous nature of the sand and its uniform grain size dispersion was therefore not included in the solute transport model implementation it should also be noted that relative permeability was not included and therefore changes in gas saturation did not affect the aqueous flow field which was assumed to be perfectly horizontal 3 results and discussion 3 1 experiment 1 simulations 3 1 1 gas flow using macro ip generally all pe fields resulted in similar injection patterns with a narrow on average 1 25 cm wide gas channel traveling along the left edge of the domain in all simulations the gas channel deviated away from the left edge toward the center of the domain similar to the observed gas flow pattern in the experiments the maximum deviation from the edge was 6 cm in the simulations see figs s1 to s3 in the supporting information compared to the experimental observations with a maximum deviation of 5 cm fig 4 depicts the simulated gas channels for three representative pe fields selected to exhibit average characteristics of the gas channels including deviation from the left edge channel width vertical distance migrated and overall shape the simulated gas channels stylistically resemble the gas channels observed within the experiments all other pe fields simulated can be found in the supporting information as expected resulting patterns for each pe distribution show the strong sensitivity of the macro ip model to the random distribution used this observation suggests that because of the random distribution of pe it might not be possible to generate an identical gas injection pattern using macro ip and it is better to run multiple simulations with unique pe fields and observe the average behavior within the system the initial simulations for the 30 pe distributions were conducted with a defined s g crit of 0 3 based on mumford et al 2010 it was observed fig 4 that although the pe distribution influenced the vertical rise of the gas most of the simulations showed gas reaching the top of the domain and then spreading underneath it forming a gas pool this phenomenon was not observed in the replicated experiments r1 and r2 and suggests that vertical rise is not solely controlled by the defined pe distribution since there was no mass transfer during the co2 injection initial 10 s in the simulations vertical gas transport must also be controlled by another parameter as stated above s g crit is the threshold gas saturation above which gas can span the entire grid block and move from one grid block to another thus the effect of the selected s g crit on the vertical gas rise was tested by varying s g crit to values of 0 4 and 0 5 and performing the gas injection in each of the 30 pe distributions as can be seen in fig 4 a lower value for s g crit causes a gas pool to form lateral migration of gas along the upper boundary of the domain which suggests that if not for the upper boundary the gas would have migrated to a greater height whereas higher values for s g crit lead to a lower gas height with no formation of gas pools this can be attributed to increased internal storage capacity within a grid block for higher s g crit values of course this also causes a higher average gas saturation of the gas filled grid blocks as seen in fig 4 the saturation of gas filled grid blocks is equal to the defined s g crit in the absence of mass transfer based on the sensitivity analysis performed an s g crit 0 5 constrained the gas flow in each of the 30 pe distributions below the top of the domain reproducing the results observed in the replicate experiments as such s g crit 0 5 was selected as the calibrated value for the subsequent simulations which include mass transfer from the emplaced gas channel a value of 0 5 is greater than previously reported values 0 23 0 3 in the literature krol et al 2011 molnar et al 2019 mumford et al 2010 mumford et al 2015 noted that s g crit can be affected by the selected discretization of the system with a higher saturation needed for smaller grid blocks however this may also be explained by the rate of gas injection within the experiment being within the transitional flow regime van de ven and mumford 2019 and having characteristics of both continuous and discontinuous flow as a result it is expected that a higher gas saturation would develop within each grid block because of elevated pressures required for water to be pushed out rapidly of the grid block during injection and vertical growth as a result of gas saturation not being measured for the replicate experiments the simulated gas saturation values could not be validated however because of the inclusion of the gas injection component of the model the amount of mass injected in the simulations was controlled and was equal to the mass injected in the experiments thus because the gas channel geometry width and general shape was similar between the experiments and the simulations it can be reasoned that the simulated gas saturations comprising the gas channels must be similar to the gas saturations within the experiments the gas channel geometry and characteristics validate the approach taken to simulate a gas injection using macro ip and accurately constrains the gaseous phase mass within the system 3 1 2 multicomponent mass transfer following the initial 10 s of the simulation the remainder of the simulation was run with immobile gas and horizontal water flow leading to mass transfer between the gas and water the results of a single simulation pe field 2 can be seen in fig 5 showing the initial gas injection pattern fig 5a the development of the dissolved co2 plume fig 5b and c and the eventual complete dissolution of the injected co2 fig 5d although free phase gas continues to exist along the height of the gas channel the resulting dissolved gas plume concentration is variable because of the distribution of the gas saturation along the height of the channel this behavior closely resembles the observations from the experiments see van de ven and mumford 2018 to better compare the aqueous concentrations measured in the replicate experiments with the simulation results dissolved co2 breakthrough curves btcs for the replicate experiments and simulations were generated fig 6 a to do so the average concentration along the height of the domain was measured at a position 6 7 cm from the left edge of the domain over the duration of the experiments based on data presented in van de ven and mumford 2018 the btcs were normalized to the total mass of co2 injected to account for the mass balance discrepancy as a result of the visualization technique used to measure concentration within the flow cell see van de ven and mumford 2018 the btcs for r1 and r2 showed initial breakthrough at approximately 2 2 and 3 5 min peak concentrations at 4 5 and 6 0 min 1 8 mmol l 1 and 2 1 mmol l 1 respectively and extinction at 22 0 min respectively breakthrough curves were also generated for all 30 pe distributions simulated to look at the trends in the btcs rather than any one specific curve corresponding to a certain injected gas pattern the simulated btcs exhibit initial breakthrough earlier on average 2 min than the experimental replicates the simulated btcs are narrower compared to the experimental btcs with much higher peak concentrations 3 0 to 5 2 mmol l 1 additionally the peak arrival times in the simulations occur generally earlier 3 5 to 5 1 min than in the experiments but exhibit some similarity to replicate 1 a likely explanation for the discrepancies between the experimental and simulated btcs is the use of the lea to model mass transfer between water and the gas phase although the lea is a reasonable assumption based on the average water flow velocity in the system geistlinger et al 2005 the conditions regarding the morphology and distribution of the gas clusters in the experiment may not result in instantaneous equilibrium between free phase gas and the flowing water in all regions of the domain leading to tailing of the experimental btcs it can be expected that the presence of gas will affect relative permeability locally enabling water flow to bypass areas of higher gas saturation while preferentially passing through regions with low gas saturations therefore limiting and delaying the overall mass transfer this could explain differences in the peak concentrations between observation and simulations which did not include changes in relative permeability and the tailing effect observed in the experimental results in addition neglecting dispersion and other non fickian mixing processes in the model equations may also have contributed to the mismatch between observational data and the simulations related to the tailing however the effect of dispersion and mixing is expected to be relatively small in comparison to mass transfer limitations and dissolution from gas clusters of varying size and volume considering the homogenous nature of the sand a more in depth validation of the applicability of the lea in the presence of discrete gas clusters consideration of relative permeability changes as a function of gas saturation as well as an evaluation of the effect of dispersion and non fickian mixing processes is beyond the scope of the present study this finding highlights the need for further work to investigate the appropriateness of the lea for gas water systems by quantifying the interplay between water and gas flow rates and the resulting gas cluster geometry on the validity of the lea although co2 breakthrough curves could not be reproduced accurately the model was successful in capturing the continued presence of free phase gas even after co2 was completely flushed from the domain similar to observations and gas saturation measurements during the experiments van de ven and mumford 2018 following the complete dissolution of co2 from the domain gas remained present where the initial co2 gas channel existed as seen in fig 6b the simulated saturations remained as high as 0 1 as hypothesized by van de ven and mumford 2018 the numerical simulations confirm that the gas remaining was due to the presence of dissolved n2 and o2 in the influent water because of multicomponent mass transfer dissolved n2 and o2 exsolved from the aqueous phase into the entrapped gas phase originally composed solely of co2 as co2 dissolved simultaneously into the aqueous phase components in the injected gas phase are replaced by dissolved gases in the influent sustaining the presence of free phase gas beyond the dissolution of co2 3 2 experiment 2 simulations 3 2 1 model sensitivity to assess the capabilities of the enhanced macro ip mt model for simultaneous gas injection and mass transfer experiment 2 was simulated during experiment 2 gas and dissolved plume height measurements were recorded during the 0 5 ml min 1 co2 gas injection into the flow cell with a water flow velocity of 0 045 cm s 1 and are compared with model results fig 7 during the experiment despite gas injection being initiated no gas was released into the system for the first 10 min as pressurization of the gas was required to exceed the entry and water pressure at the injection point because the experiments were conducted using a constant mass flow injection condition once a sufficient gas pressure was achieved gas quickly migrated as a single channel to a height of 6 cm over the next 10 min and started dissolving into the surrounding bypassing water despite continuous gas injection the dissolved plume eventually reached a steady state height of 8 cm with some fluctuations 4 cm these fluctuations are the result of pore scale heterogeneity within the sand pack when the gas channel meets a pore with a relatively high entry pressure gas pressure builds up within the channel until the gas pressure exceeds the entry threshold of that pore this causes sudden vertical growth of the gas channel which simultaneously fragments in the lower portion of the channel due to imbibition forming a disconnected gas cluster from the main channel thus the greater plume height quickly decreases again as the co2 dissolves from the disconnected cluster despite a steady state co2 plume height of 8 cm the free gas phase continued to rise in the flow cell to a final height of 15 cm at the end of the experiment but at a lower rate than during the initial 20 min of the injection based on this observation van de ven and mumford 2020 hypothesized that all co2 had been dissolved from the gas phase above the steady state plume height and the sustained vertical rise of gas was driven by n2 and o2 which partitioned from the influent water into the gas clusters experiment 2 therefore shows a complex multicomponent dissolution process an initial simulation using the enhanced macro ip mt model was conducted on a single random pe distribution and using s g crit 0 4 based on estimated saturation values from van de ven and mumford for a low injection rate and the sensitivity analysis conducted for experiment 1 overall the simulation fig 7 reproduces observed changes in the plume height due to repeated fragmentation of the gas channel and a gas height that is greater than the plume height at later time the agreement of simulations with observations is further supported by matching the average experimental steady state plume height however discrepancies between the simulated and measured plume and gas heights are observed at early times 0 60 min the discrepancies at early time are a result of the gas pressurization delay described above the macro ip algorithm is not designed to account for this pressurization the model is derived in such a way that the injected gas is assumed to initially exist at the required pressure for gas to enter the pore space because this effect is specific to the experiment simulated and likely not to be a concern for other applications of the model no attempts were made to resolve the discrepancies at early time however to validate the hypothesis that gas pressurization led to rapid vertical migration of the injected gas simulations were conducted where the equivalent mass of co2 for the first 10 min of the injection was stored and then mass was released using the macro ip algorithm at a higher injection rate 0 745 0 83 1 0 1 5 and 1 75 ml min 1 until the stored mass was depleted 20 15 10 5 and 4 min respectively then injection was re established at the pre defined rate of 0 5 ml min 1 fig 8 when accounting for the delay due to pressurization the dissolved co2 plume heights remain consistent with the measured height in the experiment in terms of the gas height slightly better agreement with the observed data can be seen at early time however long term behavior of gas height evolution is not substantially affected by incorporating the pressurization delay into the model this is expected of the macro ip mt model as the macro ip approach is developed for slow gas injections discontinuous flow and not for the high rate needed to recreate the rapid vertical growth observed also these differences might be due to small scale heterogeneities in the experimental setup affecting the distribution of entry pressures pe in the experiment but may also be related to the critical gas saturation s g crit as a next step a sensitivity analysis varying the random pe distribution and s g crit was conducted for experiment 2 to evaluate the impact of these parameters on the gas and steady state plume height three representative pe distributions were selected in this context fig 9 as expected the pe distribution caused variability in the gas height as seen in fig 9 relative to distribution 1 fig 9a the gas height in distribution 2 fig 9b was lower growing vertically at a lower rate in contrast distribution 3 fig 9c showed a gas height that was greater with a higher vertical growth rate expectedly this demonstrates that the pe distribution controls the amount of vertical migration within the simulations even in the presence of simultaneous mass transfer interestingly the average steady state dissolved phase plume for all distributions was not substantially affected on average 8 8 to 9 1 cm under the conditions simulated showing a low sensitivity to the pe distribution however the magnitude of the fluctuations varied between the pe distributions e g 3 4 cm in distribution 1 4 0 cm for distribution 2 and 6 1 cm for distribution 3 this comparison indicates that the model can generally resolve the average domain scale dissolved gas properties but the local scale variation depends on the pe distribution s g crit was varied from 0 3 to 0 5 to assess its impact on the gas and plume height similar to experiment 1 a lower s g crit was found to cause the vertical migration of gas to be faster fig 10 at a value of 0 3 and 0 4 the gas height reached the surface of the domain 21 cm at 110 min and 160 min respectively this was not observed in the experimental results and suggests that like experiment 1 an s g crit 0 5 is more suitable for these simulations despite the lower injection rate that is expected to result in discontinuous gas flow van de ven and mumford 2019 however it is clear from fig 10 that the gas height cannot be simulated exactly even at the defined value for s g crit owing to variability in the pore structure making it very difficult to simulate the exact gas heights without knowledge of the exact pore size distribution at the grid block scale again the average steady state plume height resulting from the simulations at any s g crit is consistent with the experimental results however the variability in the plume height fluctuations at steady state conditions show higher variability at higher values of s g crit e g 0 5 cm at s g crit 0 3 and 4 8 cm at s g crit 0 5 this increasing trend is the result of more gas being needed in a grid block before progressing to the next grid block such as when the gas becomes impeded at a grid block and the next step requires a relatively high gas pressure once the gas pressure increases enough that the entry threshold is met significantly more gas is stored within the gas channel at higher s g crit values allowing gas to expand into multiple overlying grid blocks in a single step this is highly dependent on the specific pe distribution once again highlighting that the macro ip mt model can resolve domain scale observations but local scale observations are more challenging to capture due to the sensitivity of macro ip to near pore scale variability notably only pe was distributed randomly in these simulations also noted by molnar et al 2019 it can be expected that other parameters such as s g crit and pt are also randomly distributed around mean values in addition and as discussed above effects of the presence of free phase gas will also affect the flow field by impacting relative permeability and mass transfer between water and the gas clusters furthermore small scale heterogeneities of the emplaced material are expected to impact water flow as well as free phase gas migration through spatial variations in porosity and permeability these considerations highlight the complexity of gas migration processes in the subsurface since the exact distribution of material parameters at the grid scale is not known and heterogeneities might extend to the sub grid scale it cannot be expected that an exact match to experimental observations can be achieved with the model however the overall good agreement with observational data in particular in terms of co2 plume height indicates that the controlling processes have been adequately captured by the modeling concept presented here in addition it should be noted that based on the consistency between the measured experimental plume height and the simulations the lea appears valid for the conditions within experiment 2 this contrasts the results of experiment 1 where mass transfer in the experiments occurred slower than seen in the simulation results despite the water flow velocity in experiment 1 being lower 0 02 cm s 1 relative to experiment 2 0 045 cm s 1 which at first sight would indicate that the lea should be less appropriate for experiment 2 however this might suggest that the difference in mass transfer kinetics is also dictated by the gas flow rate and the resulting gas flow pattern the gas injection rate in experiment 2 0 5 ml min 1 was much slower than in experiment 1 where gas was emplaced quickly within the first 10 s of the experiment there are two possible reasons as to why the gas flow impacts the applicability of lea the first is that a higher interfacial area for mass transfer is likely present in experiment 2 as a result of the lower injection rate resulting in discontinuous flow therefore creating conditions suitable for application of the lea the second is that at a lower gas injection rate there is more time for gas and water to equilibrate as the gas channel develops whereas at higher injection rates gas movement may be more rapid than the time scale needed for equilibration to occur e g a time scale of minutes for equilibration opposed to seconds for gas flow migrating gas could continue vertical migration prior to reaching equilibrium with surrounding pore water thus altering the gas composition and proceeding mass transfer thus the simulations provide valuable insight that the gas injection rate plays a role on the validity of the application of lea and that this process needs to be considered when modeling gas injection and leakage in saturated systems 3 2 2 multicomponent effects van de ven and mumford 2020b hypothesized that the sustained vertical growth of gas observed was the result of exsolution of dissolved n2 and o2 into the gas clusters however experimental data to support this hypothesis was not available the enhanced macro ip mt model can verify this phenomenon since it accounts for multicomponent effects because the model can simulate multicomponent mass transfer and includes dissolved background gases n2 and o2 in the inflowing water the model results can help understand the gas migration patterns and interplay between different gas compositions during this entire experiment to verify the explanation of van de ven and mumford 2020b the gas saturation and gaseous composition of each component co2 o2 and n2 simulated using the model are depicted at 90 and 170 min fig 11 based on the gas saturation during these times fig 11 a and e it is clear that free phase gas continues to rise even after the dissolved co2 plume has reached a steady state height i e after the average height of the dissolved gas plume showed no further vertical growth fig 11 d and h looking at the composition of the dissolved phase gases above the co2 plume n2 and o2 concentrations exhibit a slight enhancement above background levels below the steady state co2 height the n2 and o2 concentrations are depleted relative to background based on these observations it is clear that below the steady state height co2 is dissolving from the gas phase into the water phase while n2 and o2 is exsolving from the water phase into the gas phase above the steady state height the exsolved n2 and o2 then re dissolve into the aqueous phase these model results show that the gas components sustaining the vertical rise of the gas clusters are n2 and o2 this also supports that despite complete dissolution of the injected gas in this case co2 gas can continue to rise vertically because of partitioning of dissolved volatile components from the influent water to the vertically migrating free phase gas 3 3 relevance to gas migration the observations of van de ven and mumford 2020b and the results of the macro ip mt simulations are the first description of coupled gas flow and multicomponent mass transfer which can have significant relevance in aquifer systems where migration of free phase gas is occurring the specific gases present in these systems will affect the partitioning and the resulting sustained vertical migration of background gases and dissolution of source gases into the pore water in the experiments simulated here the released gas was co2 which is more soluble relative to the background o2 and n2 this led to the rapid dissolution of the released co2 into the flowing water and subsequent replacement by the less soluble background gases because of this and the relatively fast water flow velocity the co2 plume was removed quickly from the domain in experiment 1 and was arrested at a relatively low height above the injection point in experiment 2 in contrast if ch4 was the released gas e g in the context of gm from oil and gas wells it is expected that the complete dissolution of ch4 would be less rapid because it is less soluble relative to co2 henry s constant for ch4 of 7 1 104 pa m3 mol 1 as a result for experiment 1 it would be expected that the size and longevity of the dissolved ch4 plume would exceed what is observed for co2 in the experiment for experiment 2 the gas composition along the height of the migrating gas channel is expected to be a mixture of the released gas and the dissolved background gases and may not result in complete dissolution within the height of the experimental domain also because o2 is more soluble than methane it is expected that the gas continuing to rise vertically would be more enriched in n2 than what was observed in these simulations and particularly under anoxic conditions which are common in the field now considering a co2 gas release into a real aquifer system at substantial depth gas reaching the unsaturated zone may no longer contain the source gas at source concentrations or instead may even be dominated by the background gases however if ch4 was released in the same system it is expected that more sustained vertical migration would occur it is more likely that gas reaching the unsaturated zone would still contain ch4 albeit dilute relative to the released gas these findings ultimately highlight the importance of the inclusion of multicomponent mass transfer for simulating the movement and fate of gas in saturated groundwater systems as a result of differences between gas composition present both in the injected gas phase and in the background water mass transfer will be affected by sustaining the presence of the free phase gas following the complete dissolution of injected gas and the continued vertical migration of gas without the inclusion of this process the results of numerical models may not accurately capture the rate of dissolution the potential for the sustained presence of free phase gas that may act as a sink for other volatile components in the system and the potential mobilization of previously dissolved gases because of exsolution to the injected gas phase this finding goes beyond gm from energy wells or carbon sequestration sites quantifying the movement and dissolution of gas in the saturated groundwater zone is of interest for a variety of other applications for example the volatilization of non aqueous phase liquids gas generation during groundwater remediation biodegradation of contaminants and methanogenesis in sediments and peatlands which may lead to production or consumption of gases in the saturated groundwater zone e g amos and mayer 2006 ji et al 1993 mumford et al 2009 ramirez et al 2015 in these systems volatile gases originating from bio chemical reactions may be trapped in the gas phase due to exsolution leading to an extended potential source for groundwater contamination in the long term for certain volatile compounds at high concentrations this phenomenon may also result in increases in gas saturations within the system allowing sustained vertical migration of the gas phase and further spreading of contaminants within an aquifer chong and mayer 2017 it should also be mentioned that the resulting partitioning and gas composition following migration through a real aquifer will be dependent on the rate of gas flow groundwater flow and the overall depth of the aquifer all of which affect the contact time between gas and water as noted by van de ven and mumford 2020b this can create challenges for field monitoring approaches for gm such as detection of gas bubbles in effervescing wells if bubbling gas is detected in a well and then sampled the composition might not be reflective of the source composition of natural gas due to gas dissolution and replacement by background gases however because of multicomponent mass transfer the bubbling gas may still be indicative of a gm event these results emphasize the need to account for the interplay between different gas compositions in free phase gas and groundwater and gas migration patterns 4 conclusions an enhanced numerical model macro ip mt was used to simulate gas movement flow and simultaneous mass transfer to flowing groundwater resulting from a gas release below the water table the model implemented a simple gas release routine using conservation of mass and assuming an ideal gas and was coupled with the macro ip modeling approach of mumford et al 2010 including the multicomponent mass transfer algorithm of cirpka and kitanidis 2001 comparison of the coupled model with two gas injection and dissolution experiments showed reasonable agreement with observations and revealed complexities associated with gas migration processes in porous media this enabled the evaluation of key processes for modeling gas releases in shallow groundwater systems important for future modeling efforts overall it was found that gas flow within the model was sensitive to the distribution of entry threshold values defined within the domain pe as expected the distribution caused the vertical and lateral movement of gas to vary between realizations with the same gas release conditions this finding suggests that it is difficult to model the gas flow pattern exactly using a macro ip approach as variation of single entry or withdrawal thresholds along the flow path of the gas can cause differences from the experimental observations gas flow was also found to be sensitive to the selected empirical parameter s g crit which has not been an emphasis of previous studies utilizing macro ip based on the results of this study an s g crit of 0 5 was more appropriate than the lower values 0 2 0 3 used previously in the literature further work is required to enumerate the appropriate s g crit for future applications as it was shown to significantly impact the resulting gas flow and domain scale observations including the rate of vertical migration within the system in this context random distributions of s g crit could also be investigated analogous to our approach with varying pe distributions to evaluate the sensitivity of the modeling results towards spatial heterogeneity of this parameter unlike the gas flow mass transfer was relatively insensitive to the pe distribution and selected value of s g crit these parameters led to local scale differences however had negligible impact on domain scale observations e g dissolved plume height dissolution times it is common that the lea is used to model gas water partitioning e g cirpka and kitanidis 2001 geistlinger et al 2005 and often this is justified based on relatively low groundwater flow rates however the comparison between simulations using the lea and the experimental gas injections provided strong evidence that the rate of gas release can also cause the lea to not accurately capture mass transfer higher release rates likely cause lower interfacial area between gas and water leading to deviation from equilibrium also at a higher gas release rate it is suspected that gas moves much faster than the rate at which dissolution occurs therefore not allowing equilibrium between gas and water within a grid block before gas can continue to rise with the understanding gained from this study specifically on the key processes needed to simulate simultaneous gas flow and mass transfer and controlling parameters necessary steps towards up scaling and application of numerical models at larger scales e g 10 s to 100 s of m have been made a challenge facing modeling efforts for gas migration is the sensitivity of gas migration to porous media characteristics which has long been known this was reflected in the modeling results of this study not exactly matching the experimental results which is likely difficult to resolve and expected for other modeling approaches however the implemented modeling approach was found to be computationally efficient allowing multiple simulations with varying pe distributions to be run in a relatively short period of time thus this approach can be adopted to generate multiple simulation runs to develop an understanding of the average domain scale behavior for the modeled system e g time for gas to reach the surface of the system vertical extent of the gas channels thus because it is difficult to resolve pore scale variability future modeling for gm should look to utilize stochastic approaches such that average domain scale observations are accurate and provide valuable information for understanding the impacts of gm in shallow groundwater in addition to advancing stochastic approaches to capture gas flow the results also advance the possibility of the incorporation of the macro ip approach into more comprehensive reactive transport models by providing a better understanding of the key physiochemical processes coupling macro ip with robust reactive transport models will also enable the use of stochastic approaches for investigation such that average domain scale observations from a biogeochemical and solute transport perspective can be made which is difficult with current continuum models due relatively lower computational efficiency the enhancement of the macro ip mt model and comparison of simulations against bench scale experiments is a vital initial step to attaining a robust numerical model to simulate gas releases and leaks at the field scale for a variety of applications credit authorship contribution statement kartik jain formal analysis investigation methodology validation visualization writing original draft cole j c van de ven conceptualization formal analysis investigation methodology resources supervision validation writing review editing kevin g mumford conceptualization funding acquisition investigation resources software writing review editing k ulrich mayer conceptualization formal analysis funding acquisition investigation methodology project administration resources supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments support for this research was provided by the natural sciences and engineering research council nserc of canada through a strategic partnerships grant for projects spg 506784 2017 supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2022 104362 appendix supplementary materials image application 1 
79,gases may be released into shallow groundwater systems during energy development and geological carbon storage commonly referred to as gas migration gm and can result in greenhouse gas emissions safety concerns and the reduction of groundwater quality the physiochemical processes occurring during gm including gas release movement partitioning and dissolved phase transport in the saturated groundwater zone are difficult to characterize and model however modeling is important to develop strategies for detecting and monitoring gm and formulate conceptual models to describe gm at impacted sites in this study a previously developed numerical model which coupled macroscopic invasion percolation macro ip and multicomponent mass transfer was enhanced to simulate gas releases in the shallow subsurface evaluation of the effects of the coupled physiochemical processes was performed by comparing model simulations to previously conducted bench scale gas injection experiments results show that gas flow is highly sensitive to the entry pressures assigned within the model domain and the critical gas saturation s g crit used to model gas water flow based on macro ip however mass transfer and the resulting domain scale dissolved gas transport were relatively insensitive to these parameters multicomponent mass transfer considering not only the partitioning of the released gas but also the dissolved background gases ubiquitous in shallow groundwater was vitally important to simulate dissolution and the resulting free phase gas distribution within the experimental systems the use of the local equilibrium assumption for gas water mass transfer could not consistently describe the experimental observations overall the modeling evaluation performed in this study provides improved understanding of the key processes controlling gm in the shallow subsurface and will advance efforts including up scaling and scenario testing to accurately quantify the environmental impacts of gm keywords gas migration multiphase flow mass transfer gases multicomponent invasion percolation data availability data will be made available on request 1 introduction at sites with petroleum resource development there is the potential for the release of gases including methane ch4 ethane c2h6 and propane c3h8 into shallow groundwater systems gas release can occur due to energy wells suffering integrity issues which allows gas to migrate outside of the well casings through the geological formation toward the surface cahill et al 2017 dusseault and jackson 2014 jackson et al 2013 this unintended release is termed gas migration gm which can intersect groundwater aquifers and lead to emissions to the atmosphere in addition to leaking oil and gas wells methane releases into shallow aquifers can also occur from other subsurface sources including coalbed methane seams and methane hydrate reservoirs it is also possible that gm may occur because of decarbonization efforts specifically geological carbon storage where carbon dioxide co2 is injected deep below the earth s surface for free phase gas to be trapped there is concern that injected co2 may be released via legacy oil and gas wells or due to integrity issues associated with the confining cap rock celia 2017 celia et al 2011 nogues et al 2012 similar to gm observed for natural gas co2 may be released to shallow groundwater and the atmosphere regardless of the source of gas release once in an aquifer released gas e g ch4 co2 can migrate as free phase gas moving vertically and or laterally depending on the aquifer characteristics cahill et al 2018 klazinga et al 2019 molofsky et al 2021 van de ven and mumford 2020a released free phase gas may pass through an aquifer then intersect the unsaturated zone and be emitted at the surface termed surface expression emitted gas that enters a confined space may result in the possible development of explosive conditions in surrounding infrastructure forde et al 2018 free phase gas will also dissolve into flowing groundwater within the saturated zone forming dissolved gas plumes dissolved phase gas may affect groundwater quality due to changes in redox conditions liberation of metals and alteration of aesthetic characteristics cahill et al 2013 forde et al 2019 kelly et al 1985 roy et al 2016 schout et al 2017 sources of gas released below the water table such as those resulting from gm lead to gravity destabilized gas flow because of the upward invasion of less dense fluid gas within the saturated system gurevich et al 1993 saffman and taylor 1958 van de ven and mumford 2019 although gravity destabilized gas flow leads to preferential vertical growth of gas due to buoyancy gravity forces destabilized gas flow is also governed by capillary and viscous forces which can lead to lateral gas movement frette et al 1992 gurevich et al 1993 the balance of these forces causes different gas flow regimes which include migration through continuous connected channels or via discontinuous clusters brooks et al 1999 ji et al 1993 selker et al 2007 continuous flow is comprised of a single migrating connected gas phase along the length of the channel whereas discontinuous flow is made up of disconnected gas clusters that migrate independently the resulting regime depends on the physical conditions of the gas entering the aquifer e g pressure leak rate aquifer properties e g pore size distribution permeability heterogeneity anisotropy and fluid properties e g density viscosity geistlinger et al 2006 ji et al 1993 selker et al 2007 van de ven and mumford 2019 for continuous gas flow gas channels are vertically connected due to drainage of saturated pore space as the channel progresses upwards in contrast discontinuous flow results in discrete disconnected gas clusters along the height of the channel because of drainage of saturated pore space but also simultaneous imbibition of gas filled pore space due to hysteresis the different flow regimes result in significantly different flow patterns geistlinger et al 2006 selker et al 2007 it has been shown that based on the expected rate of gas leaks into aquifer systems from gm both flow regimes can be expected depending on the porous media characteristics and the distance gas has migrated from the source selker et al 2007 van de ven et al 2020 the resulting flow pattern will affect the subsequent mass transfer from trapped gas within the pore space sale and mcwhorter 2001 because continuous channels are connected along their entire height interfacial area for mass transfer is lower than for discontinuous flow resulting in a lower effective rate of dissolution in contrast if gas is present in the form of discrete clusters resulting from discontinuous flow interfacial area between the free phase gas and the aqueous phase tends to be relatively high thus allowing more rapid dissolution of trapped gas van de ven and mumford 2020a mass transfer occurring in the saturated zone when gaseous components are present is complicated by the multicomponent nature of gas mixtures cirpka and kitanidis 2001 gupta et al 1994 in the case of gm free phase gas is often comprised of multiple components including ch4 c2h6 and c3h8 and other non hydrocarbon components e g co2 and noble gases most notably helium jackson et al 2013 in addition shallow groundwater contains several dissolved gas components including atmospheric gases such as nitrogen n2 and oxygen o2 as well as gases of biogenic origin such as co2 and ch4 as a result partitioning between the gas and aqueous phase depends on the concentration differences that exist between the phases for all components cirpka and kitanidis 2001 miller et al 1990 for example ch4 present in free phase gas emplaced during gm will dissolve into the flowing groundwater while simultaneously dissolved gases present in the groundwater e g n2 and o2 will exsolve into the gas phase balcke et al 2011 forde et al 2019 van de ven and mumford 2020b multicomponent mass transfer is therefore important to consider for problems involving gm and in other situations where free phase gas is present most existing multiphase and reactive transport codes are based on the continuum approach which solves a system of darcy scale multiphase flow equations that can be coupled with reactive transport however these continuum models are generally not capable of simulating discontinuous gas flow behavior which can occur during free phase gm below the water table geistlinger et al 2009 mumford et al 2015 as an alternative approach multiphase flow has been simulated based on invasion percolation ip theory wilkinson and willemsen 1983 with additional modifications often referred to as modified invasion percolation mip to account for gravity forces and to capture discontinuous flow by including imbibition thresholds e g terminal pressure meakin et al 1992 wagner et al 1997 using an ip approach a discrete gas phase is modeled within a saturated domain and a set of physical rules are defined based on the threshold for gas drainage from a single pore to allow gas movement an ip model therefore moves gas phase through a domain by searching for neighboring sites with the lowest threshold for gas to invade and displace water which is determined by the hydrostatic and capillary pressure requirements or by searching for sites where imbibition is favorable i e where water can re invade a site and displace gas the model continuously iterates through the domain searching for the next most favorable condition gas invasion or imbibition a detailed description can be found in the proceeding methods section because of difficulty measuring pore scale characteristics within larger systems a macroscopic ip macro ip approach has been developed where each subregion of a domain single grid block denoting a representative elementary volume rev of individual pores is assigned a macroscopic fluid invasion threshold entry pressure glass et al 2001 krol et al 2011 kueper and mcwhorter 1992 molnar et al 2019 mumford et al 2010 using macro ip and modified approaches for destabilized flow has been shown to capture the essential physics of discontinuous flow at lower computational costs than pore scale models banerjee et al 2021 to simultaneously describe mass transfer to surrounding groundwater mumford et al 2010 combined the macro ip approach with the multicomponent mass transfer model of cirpka and kitanidis 2001 to simulate the volatilization of dense non aqueous phase liquid pools dnapls in the presence of a gas phase the cirpka and kitanidis model uses a defined system of equations based on the local equilibrium assumption lea combining henry s law for the individual gas components and dalton s law to calculate the gas saturation within a rev as partitioning occurs see below for a detailed description mumford et al 2010 successfully coupled the models and compared model results with observations from volatilization experiments in addition this model has been used to simulate processes during thermal remediation krol et al 2011 the combined model offers a computationally expedient approach to simulate gas flow and mass transfer in saturated porous media which may be applicable to modeling gm however the coupled model is not able to simulate gas injection and has not been validated for use in systems where gas is being injected or leaked numerical models are needed to better understand and quantify the risk of gm in groundwater systems such models will enable the formulation of a more accurate conceptual model for gm and the development of monitoring and mitigation strategies to combat adverse environmental impacts to shallow groundwater these numerical models must include key physiochemical processes including gas release migration and partitioning to surrounding groundwater which are expected to occur in the subsurface during gm in this study the key processes to model gm in saturated groundwater systems were evaluated by enhancing a coupled numerical model such that gas release flow and subsequent dissolution of gases to surrounding pore water in the saturated zone could be simulated the specific objectives of this study were to i implement a model to simulate gas release and mass transfer in saturated groundwater systems ii qualitatively compare simulations and experimental results to delineate multiphase flow and mass transfer processes during release of free phase gas in the saturated zone and iii systematically investigate the effects of various system parameters to understand their impact on processes involved in gm to do so the model developed by mumford et al 2010 macro ip coupled with mass transfer referred to herein as macro ip mt was enhanced by implementing the release of free phase gas below the water table then simulations were compared to bench scale 10s of cm laboratory gas injection experiments conducted by van de ven and mumford 2018 2020b 2 methods 2 1 model description 2 1 1 original macro ip mt model the macro ip mt model developed by mumford et al 2010 simulates the flow and dissolution of gases in saturated subsurface systems using established macro ip approaches for gas movement coupled with the gas partitioning model by cirpka and kitanidis 2001 the macro ip model describes gas flow as a vertical series of disconnected gas clusters that can coalesce mobilize fragment or contract mumford et al 2010 wagner et al 1997 these clusters are represented as connected gas filled grid blocks within a discretized domain because a macroscopic scale is used the amount of gas within each grid block is defined by the gas saturation sg m3 gas m 3 void for a discontinuous gas phase represented by a single gas filled grid block or a series of connected gas filled grid blocks sg 0 the macro ip algorithm follows a stepwise approach by first identifying all connected gas clusters a cluster is identified by searching out all grid blocks with sg 0 and determining if they are connected additionally for the next steps within the macro ip algorithm the gas saturation within a cluster must be equal or greater than a critical gas saturation s g crit s g crit represents the minimum gas saturation within a grid block that must be achieved before expansion to neighboring blocks can occur based on previous studies e g krol et al 2011 molnar et al 2019 mumford et al 2010 a single consistent value for s g crit is assumed for all grid blocks within the domain if a cluster or multiple clusters exist that meet the defined s g crit criteria the macro ip algorithm progresses and the invasion pressure threshold of each neighboring block is calculated the invasion threshold is defined as 1 p t e p e p w where p t e is the threshold pressure for gas invasion entry pa pe represents entry pressure pa associated with the grid block i e the capillary pressure at which gas occupies and spans the grid block gerhard and kueper 2003 the local value for the absolute pore water pressure pw pa can be calculated as follows 2 p w ρ w g h p a t m where ρ w is water density kg m 3 g is acceleration due to gravity m s 2 h is the pressure head m and patm is atmospheric pressure pa once the p t e of all neighboring grid blocks is defined the block with the lowest invasion threshold is selected to be the next invadable site the neighboring grid blocks might vary depending on the chosen lattice geometry and connectivity which is defined as the coordination number for a 2d system this can be four where orthogonal sites are connected and considered a neighboring site for invasion or it can be eight where both orthogonal and diagonal sites are connected within the simulated porous medium in addition to a gas invasion threshold a withdrawal threshold is defined to account for mobilization and fragmentation of the gas clusters by imbibition of water at a gas occupied site this threshold can be defined as 3 p t t p t p w where p t t is the gas withdrawal threshold pa and pt is the terminal pressure pa which is the minimum capillary pressure that can exist in a connected gas cluster before imbibition occurs gerhard and kueper 2003 once the invasion and withdrawal threshold pressures are identified for a cluster gas movement can occur by expansion mobilization fragmentation or contraction based on total gas pressure pg pa within a cluster detailed conceptual descriptions can be found in molnar et al 2019 the total gas pressure can be expressed according to dalton s law as 4 p g i p i firstly for gas to expand from one grid block to another the total gas pressure needs to be greater than p e t of a neighboring site 5 p g p t e when the gas pressure is greater or equal p t e the invaded site is assigned sg s g crit the gas phase mass is then distributed within the expanded cluster assuming the gas behaves according to the ideal gas law based on the model being applied in low temperature and low pressure conditions after redistribution the new gas pressure is assigned to each grid block within the cluster for the cluster to either mobilize or fragment the withdrawal threshold in any gas occupied site needs to be greater than the entry threshold of any neighboring water saturated site 6 p t t p t e whether mobilization or fragmentation occurs depends on the location of the grid block where re invasion occurs mobilization occurs if the re invasion is at the periphery of a cluster and fragmentation occurs if re invasion results in the disconnection of a gas cluster mumford et al 2009 when this occurs the neighboring site is invaded the gas phase mass from the imbibed grid block is added to the disconnected cluster and the pressure within the cluster is recalculated assuming ideal conditions the sg in the reinvaded grid block is then set to 0 the macro ip algorithm iterates through all gas clusters until no further redistribution is possible based on the defined macro ip rules eqs 1 6 the gas distribution is then passed to the multicomponent partitioning model of cirpka and kitanidis 2001 based on the resulting gas saturation and gas pressure within a grid block from the macro ip algorithm multicomponent partitioning of volatile compounds between the aqueous phase and the gas phase cirpka and kitanidis 2001 considers an rev and assumes local equilibrium defined according to henry s law 7 p i c i a h i where pi is the partial pressure of gas i pa c i a is its dissolved concentration mol m 3 water and hi is the henry s constant pa m3 water mol 1 specific to gas i assuming that the gases behave in an ideal manner the gas phase concentration c i g mol m 3 gas can then be defined as 8 c i g p i r t where r is the gas constant pa m3 mol 1 k 1 and t is the temperature k thus the total gas concentration c i t mol m 3 void in the saturated groundwater zone accounting for gas present in the free phase and dissolved in the aqueous phase can be defined as 9 c i t s w c i a s g c i g aqueous and gas phase saturations are related by 10 s w s g 1 using eqs 7 10 the following expression can be derived for the total concentration c i t for gas i 11 c i t 1 h i r t 1 s g c i a the partial pressure for gas i can then be defined as a function of c i t 12 p i c i t h i 1 h i r t 1 s g if a gas phase is present pg must be equal to the sum of pw and the capillary pressure pc thus the following system of equations can be solved for the gas saturation and gas concentrations aqueous and gas phase within the rev cirpka and kitanidis 2001 13 p g p w p c i c i t h i 1 h i r t 1 s g where pc can be defined using capillary pressure saturation relationships such as brooks and corey 1964 and van genuchten 1980 using the van genuchten model pc can be written as 14 p c 1 α s w s r 1 s r 1 m 1 1 n where α m 1 m and n are soil hydraulic function parameters sw m3 water m 3 void is aqueous phase saturation and sr m3 water m 3 void is residual water saturation it should be noted that if the sum of the partial pressures based on henry s law within an rev is less than pw no gas phase exists and sg 0 assuming that solute transport is purely horizontal and that longitudinal and transverse dispersion are negligible the mass transfer described by eq 13 can then be integrated within the 1d advection equation cirpka and kitanidis 2001 15 ϕ c i t t q c i t 1 h i r t 1 s g 0 where ϕ is porosity m3 void m 3 bulk q is the darcy flux m s 1 and t is time s 2 1 2 gas injection term to advance the macro ip mt model to evaluate key processes when simulating gas releases in fully saturated groundwater systems a gas injection routine was added to the model gas injection was accomplished by defining an injection grid block within the domain in this grid block it is assumed that injected gas can displace all water with the exception of residual water because gas is continuously being released within this area of the domain yielding a maximum gas saturation s g m a x of 16 s g m a x 1 s r then based on the injection flow rate and the gas volume within the injection block the moles of each gas component within the injection grid block are calculated by 17 n i s g t 1 v g b ϕ c i g n i δ t where ni is the moles of gas i in the gas phase mol within the injection block s g t 1 is the gas saturation in the injection block at the end of the previous time step m3 gas m 3 void vgb is the volume of the grid block m3 bulk n i is the injection rate of gas i mol s 1 and δt is the time step s the partial pressure of each gas can then be calculated assuming ideal behavior 18 p i n i r t s g m a x v g b ϕ the total gas pressure within the injection grid block can then be computed based on eq 4 the defined gas injection term was integrated within the existing macro ip mt model as described in the proceeding section using this approach the mass injected is preserved and the rate of injection can be controlled it should be noted that because macro ip only considers gravity and capillary forces to govern gas flow the mass flow rate defined should be constrained to a rate which produces discontinuous flow in this context identifying the upper limits of defined injection rates goes beyond the scope of this work however consideration of the media characteristics and injection conditions is required to identify this threshold geistlinger et al 2006 selker et al 2007 van de ven and mumford 2019 2 1 3 coupling to couple the processes described above gas injection gas movement and multicomponent mass transfer within the model a split operator approach is used starting from the initial conditions defined for a simulation the model sequentially progresses through the algorithm during a single user defined time step fig 1 each step commences by releasing gas into the defined injection grid block using eqs 16 18 once the new mass of injection gas is emplaced and new total gas pressure is calculated the new pressure is inputted to the macro ip algorithm eqs 1 6 and the gas is redistributed it should be noted that macro ip does not redistribute water as it is displaced from or imbibed to a grid block however the dissolved phase mass is accounted for in the overall system mass balance by summing the total mass loss and adjusting the final mass balance accordingly the change in mass of all dissolved gases was found to be negligible however it was included for completeness with updated gas phase mass distribution following gas transport partitioning between the gas and aqueous phase takes place in each grid block and advective transport of all aqueous components occurs based on eq 15 this represents the end of that time step and the algorithm recommences by injecting more gas into the system the looped algorithm continues until some stopping criteria is met for the current implementation the stopping criteria is a defined total simulation time aligned with the duration of the experiments simulated see below it should also be mentioned that the time step is selected to ensure physically realistic system conditions are met based on a check implemented prior to the transport routine ensuring that sg 1 sr and sg and pc 0 if any of these conditions are violated the system is reset to conditions prior to the previous timestep and the timestep is reduced by a user defined factor and repeated a flow chart summarizing the algorithm is shown in fig 1 2 2 laboratory experiments two previously conducted experiments by van de ven and mumford 2018 experiment 1 and van de ven and mumford 2020b experiment 2 were selected for simulation using the enhanced model to assess key processes these experiments were chosen specifically to demonstrate how the ratio between the gas injection rate and the water flow rate will affect gm in the subsurface the experiments are briefly described in the proceeding subsections for detailed descriptions please refer to van de ven and mumford 2018 experiment 1 and van de ven and mumford 2020b experiment 2 both experiments utilized thin 1 cm thick flow cells that can be considered quasi 2d and the experiments were therefore modeled using 2d domains it is also noted that both experiments used co2 as the injected gas as a surrogate for ch4 enabling a high resolution visual quantification technique to be used the details of which are described below 2 2 1 experiment 1 decoupled co2 gas injection and subsequent dissolution van de ven and mumford 2018 performed gas injections using co2 gas into a water saturated quasi two dimensional flow cell with dimensions of 25 25 1 cm3 packed using 20 30 accusil sand fig 2 soil parameters for the sediments used in the experiments obtained from measured values and reported values in the literature e g schroth et al 1996 hegele 2014 are summarized in table 1 the flow cell was sealed along the top boundary to limit any rearrangement of grains during injection and to ensure no gas was lost from the system co2 gas was chosen in this study because it allowed for a visual technique to be used for quantification of dissolved co2 concentrations created by dissolution to achieve this the pore water was dyed using a ph indicator resazurin which changes from a purple color at a ph of 5 6 atmospheric conditions in deionized water to an orange color at a ph of 3 8 approximate solubility limit of co2 at 1 atm and 25 c based on the change in hue as co2 dissolution changes the ph of the pore water this technique enables dissolution to be measured at high spatial and temporal resolutions during the experiment co2 gas was injected through a port at the bottom left edge of the flow cell initially the gas was injected at 15 ml min 1 over a 10 s time period in the absence of water flow through the system fig 2a once the gas was emplaced water flow was initiated from left to right through the system at a darcy flux of 0 0073 cm s 1 or average linear groundwater velocity of 0 02 cm s 1 based on the measured porosity of 0 38 as shown in fig 2b until complete co2 dissolution occurred the experiment was conducted in triplicate however for this study only two replicate experiments were simulated r1 and r2 as defined in van de ven and mumford 2018 these experiments were selected to validate the macro ip mt model as the gas invasion occurred during the first 10 s effectively independent of mass transfer to the aqueous phase allowing the model to be evaluated with mass transfer decoupled from gas invasion 2 2 2 experiment 2 co2 injection with simultaneous gas dissolution in the same quasi two dimensional flow cell and porous media described above table 1 van de ven and mumford 2020b performed a continuous co2 gas injection into flowing water in the top 4 cm of the flow cell above a 21 cm sand layer a high permeability air flow layer was created using unsaturated glass beads to collect the gas escaping from the top boundary in this set of experiments co2 gas was injected in the center of the cell 2 cm from the bottom using a combination of various injection rates and aqueous flow velocities for the laboratory experiments the gas injection rate was varied between 0 1 and 1 ml min 1 to achieve discontinuous gas flow and the left to right water flow velocity varied between 0 045 and 0 343 cm s 1 these relatively fast water flow velocities were used in the experiments to understand the effects of mass transfer over the height of the small flow cell compared to an aquifer with relatively lower velocities but larger vertical length scale for this study only one of the conducted experiments was simulated with a co2 gas injection rate of 0 5 ml min 1 and water flow velocity of 0 045 cm s 1 as shown in fig 3 experiment 0 5 b from van de ven and mumford 2020b this experiment was chosen because the relatively low water flow velocity was expected to result in conditions appropriate for the application of the lea in the model experiment 2 was selected to evaluate the enhanced macro ip mt model during simultaneous gas and water flow within a system allowing the key processes and their coupling to be assessed 2 3 model implementation the domain and porous media characteristics were similar between the two experiments table 1 however the gas injection configuration rates and water flow parameters were different simulations for experiment 1 were conducted on a 25 cm by 25 cm two dimensional domain discretized into 2 5 mm grid blocks and for experiment 2 a 25 cm by 20 cm two dimensional domain was used discretized into 2 5 mm grid blocks the porous media characteristics were assumed to be homogeneous based on the values in table 1 and each grid block was assigned the same porosity and van genuchten parameters to assign pe values to the domain inverse transform sampling was used to generate a random distribution of entry pressure values assuming a cumulative distribution function equal to the measured capillary pressure saturation relationship of the simulated sand fitted using the van genuchten model glass et al 2001 mumford et al 2010 wisheart 2019 because the pe distribution was randomly generated and it is expected that this distribution could affect the simulated gas flow experiment 1 was statistically parameterized by generating 30 unique distributions of pe values gas injection simulations were performed for each realization to understand the expected variability in the simulation results experiment 2 was statistically parameterized by selecting 3 unique distributions of pe values values for pt were assigned to the domain using the random distribution of pe values generated and assuming that pt scaled proportionally by a factor of 0 64 based on gerhard and kueper 2003 because the simulations were conducted within a 2d domain the selected coordination number was four each experiment was simulated assuming a three component system co2 n2 and o2 the henry s constants for co2 n2 and o2 were 2 94 103 1 53 105 and 8 04 104 pa m3 mol 1 respectively sander 2015 the influent and initial aqueous concentrations in the domain were assumed to be at equilibrium with the atmosphere 400 ppmv co2 79 v v n2 and 21 v v o2 with concentrations of 0 014 0 523 0 265 mmol l 1 for co2 n2 and o2 respectively injected gas was pure co2 water flow was modeled using a constant flux boundary condition on both the influent and effluent edges for both experiments for experiment 1 the enhanced algorithm was decoupled such that the macro ip was solved independently of mass transfer for the initial 10 s of the simulation then mass transfer from the resulting gas distribution occurred for the remaining duration of the simulation gas and water flow rates were set to match the experiment as described above the simulation was run for 33 3 min for experiment 2 the simulations were performed with the coupled algorithm such that simultaneous gas flow and mass transfer occurred similarly gas and water flow rates were set to match the experiment as described above the simulation was run for 170 min the algorithm was implemented in matlab r2020a as a result of flow within the experimental domain being horizontal the system was modeled as a stacked in the z direction set of horizontal 1d flow paths in the x direction using the 1d advection equation eq 15 the presence of free phase gas could induce a vertical flow component but as a simplification this was assumed to be negligible based on the design of the experiment eq 15 was solved using an explicit downstream finite difference approach for multicomponent mass transfer eq 13 was solved numerically using the predefined function fsolve within matlab to solve the system of equations the total concentrations were quantified based on the aqueous concentrations after transport in the previous timestep and the new gas concentrations based on the macro ip routine in the current timestep it was assumed that lateral and transverse dispersion in the aqueous phase were negligible justified by the homogeneous nature of the sand and its uniform grain size dispersion was therefore not included in the solute transport model implementation it should also be noted that relative permeability was not included and therefore changes in gas saturation did not affect the aqueous flow field which was assumed to be perfectly horizontal 3 results and discussion 3 1 experiment 1 simulations 3 1 1 gas flow using macro ip generally all pe fields resulted in similar injection patterns with a narrow on average 1 25 cm wide gas channel traveling along the left edge of the domain in all simulations the gas channel deviated away from the left edge toward the center of the domain similar to the observed gas flow pattern in the experiments the maximum deviation from the edge was 6 cm in the simulations see figs s1 to s3 in the supporting information compared to the experimental observations with a maximum deviation of 5 cm fig 4 depicts the simulated gas channels for three representative pe fields selected to exhibit average characteristics of the gas channels including deviation from the left edge channel width vertical distance migrated and overall shape the simulated gas channels stylistically resemble the gas channels observed within the experiments all other pe fields simulated can be found in the supporting information as expected resulting patterns for each pe distribution show the strong sensitivity of the macro ip model to the random distribution used this observation suggests that because of the random distribution of pe it might not be possible to generate an identical gas injection pattern using macro ip and it is better to run multiple simulations with unique pe fields and observe the average behavior within the system the initial simulations for the 30 pe distributions were conducted with a defined s g crit of 0 3 based on mumford et al 2010 it was observed fig 4 that although the pe distribution influenced the vertical rise of the gas most of the simulations showed gas reaching the top of the domain and then spreading underneath it forming a gas pool this phenomenon was not observed in the replicated experiments r1 and r2 and suggests that vertical rise is not solely controlled by the defined pe distribution since there was no mass transfer during the co2 injection initial 10 s in the simulations vertical gas transport must also be controlled by another parameter as stated above s g crit is the threshold gas saturation above which gas can span the entire grid block and move from one grid block to another thus the effect of the selected s g crit on the vertical gas rise was tested by varying s g crit to values of 0 4 and 0 5 and performing the gas injection in each of the 30 pe distributions as can be seen in fig 4 a lower value for s g crit causes a gas pool to form lateral migration of gas along the upper boundary of the domain which suggests that if not for the upper boundary the gas would have migrated to a greater height whereas higher values for s g crit lead to a lower gas height with no formation of gas pools this can be attributed to increased internal storage capacity within a grid block for higher s g crit values of course this also causes a higher average gas saturation of the gas filled grid blocks as seen in fig 4 the saturation of gas filled grid blocks is equal to the defined s g crit in the absence of mass transfer based on the sensitivity analysis performed an s g crit 0 5 constrained the gas flow in each of the 30 pe distributions below the top of the domain reproducing the results observed in the replicate experiments as such s g crit 0 5 was selected as the calibrated value for the subsequent simulations which include mass transfer from the emplaced gas channel a value of 0 5 is greater than previously reported values 0 23 0 3 in the literature krol et al 2011 molnar et al 2019 mumford et al 2010 mumford et al 2015 noted that s g crit can be affected by the selected discretization of the system with a higher saturation needed for smaller grid blocks however this may also be explained by the rate of gas injection within the experiment being within the transitional flow regime van de ven and mumford 2019 and having characteristics of both continuous and discontinuous flow as a result it is expected that a higher gas saturation would develop within each grid block because of elevated pressures required for water to be pushed out rapidly of the grid block during injection and vertical growth as a result of gas saturation not being measured for the replicate experiments the simulated gas saturation values could not be validated however because of the inclusion of the gas injection component of the model the amount of mass injected in the simulations was controlled and was equal to the mass injected in the experiments thus because the gas channel geometry width and general shape was similar between the experiments and the simulations it can be reasoned that the simulated gas saturations comprising the gas channels must be similar to the gas saturations within the experiments the gas channel geometry and characteristics validate the approach taken to simulate a gas injection using macro ip and accurately constrains the gaseous phase mass within the system 3 1 2 multicomponent mass transfer following the initial 10 s of the simulation the remainder of the simulation was run with immobile gas and horizontal water flow leading to mass transfer between the gas and water the results of a single simulation pe field 2 can be seen in fig 5 showing the initial gas injection pattern fig 5a the development of the dissolved co2 plume fig 5b and c and the eventual complete dissolution of the injected co2 fig 5d although free phase gas continues to exist along the height of the gas channel the resulting dissolved gas plume concentration is variable because of the distribution of the gas saturation along the height of the channel this behavior closely resembles the observations from the experiments see van de ven and mumford 2018 to better compare the aqueous concentrations measured in the replicate experiments with the simulation results dissolved co2 breakthrough curves btcs for the replicate experiments and simulations were generated fig 6 a to do so the average concentration along the height of the domain was measured at a position 6 7 cm from the left edge of the domain over the duration of the experiments based on data presented in van de ven and mumford 2018 the btcs were normalized to the total mass of co2 injected to account for the mass balance discrepancy as a result of the visualization technique used to measure concentration within the flow cell see van de ven and mumford 2018 the btcs for r1 and r2 showed initial breakthrough at approximately 2 2 and 3 5 min peak concentrations at 4 5 and 6 0 min 1 8 mmol l 1 and 2 1 mmol l 1 respectively and extinction at 22 0 min respectively breakthrough curves were also generated for all 30 pe distributions simulated to look at the trends in the btcs rather than any one specific curve corresponding to a certain injected gas pattern the simulated btcs exhibit initial breakthrough earlier on average 2 min than the experimental replicates the simulated btcs are narrower compared to the experimental btcs with much higher peak concentrations 3 0 to 5 2 mmol l 1 additionally the peak arrival times in the simulations occur generally earlier 3 5 to 5 1 min than in the experiments but exhibit some similarity to replicate 1 a likely explanation for the discrepancies between the experimental and simulated btcs is the use of the lea to model mass transfer between water and the gas phase although the lea is a reasonable assumption based on the average water flow velocity in the system geistlinger et al 2005 the conditions regarding the morphology and distribution of the gas clusters in the experiment may not result in instantaneous equilibrium between free phase gas and the flowing water in all regions of the domain leading to tailing of the experimental btcs it can be expected that the presence of gas will affect relative permeability locally enabling water flow to bypass areas of higher gas saturation while preferentially passing through regions with low gas saturations therefore limiting and delaying the overall mass transfer this could explain differences in the peak concentrations between observation and simulations which did not include changes in relative permeability and the tailing effect observed in the experimental results in addition neglecting dispersion and other non fickian mixing processes in the model equations may also have contributed to the mismatch between observational data and the simulations related to the tailing however the effect of dispersion and mixing is expected to be relatively small in comparison to mass transfer limitations and dissolution from gas clusters of varying size and volume considering the homogenous nature of the sand a more in depth validation of the applicability of the lea in the presence of discrete gas clusters consideration of relative permeability changes as a function of gas saturation as well as an evaluation of the effect of dispersion and non fickian mixing processes is beyond the scope of the present study this finding highlights the need for further work to investigate the appropriateness of the lea for gas water systems by quantifying the interplay between water and gas flow rates and the resulting gas cluster geometry on the validity of the lea although co2 breakthrough curves could not be reproduced accurately the model was successful in capturing the continued presence of free phase gas even after co2 was completely flushed from the domain similar to observations and gas saturation measurements during the experiments van de ven and mumford 2018 following the complete dissolution of co2 from the domain gas remained present where the initial co2 gas channel existed as seen in fig 6b the simulated saturations remained as high as 0 1 as hypothesized by van de ven and mumford 2018 the numerical simulations confirm that the gas remaining was due to the presence of dissolved n2 and o2 in the influent water because of multicomponent mass transfer dissolved n2 and o2 exsolved from the aqueous phase into the entrapped gas phase originally composed solely of co2 as co2 dissolved simultaneously into the aqueous phase components in the injected gas phase are replaced by dissolved gases in the influent sustaining the presence of free phase gas beyond the dissolution of co2 3 2 experiment 2 simulations 3 2 1 model sensitivity to assess the capabilities of the enhanced macro ip mt model for simultaneous gas injection and mass transfer experiment 2 was simulated during experiment 2 gas and dissolved plume height measurements were recorded during the 0 5 ml min 1 co2 gas injection into the flow cell with a water flow velocity of 0 045 cm s 1 and are compared with model results fig 7 during the experiment despite gas injection being initiated no gas was released into the system for the first 10 min as pressurization of the gas was required to exceed the entry and water pressure at the injection point because the experiments were conducted using a constant mass flow injection condition once a sufficient gas pressure was achieved gas quickly migrated as a single channel to a height of 6 cm over the next 10 min and started dissolving into the surrounding bypassing water despite continuous gas injection the dissolved plume eventually reached a steady state height of 8 cm with some fluctuations 4 cm these fluctuations are the result of pore scale heterogeneity within the sand pack when the gas channel meets a pore with a relatively high entry pressure gas pressure builds up within the channel until the gas pressure exceeds the entry threshold of that pore this causes sudden vertical growth of the gas channel which simultaneously fragments in the lower portion of the channel due to imbibition forming a disconnected gas cluster from the main channel thus the greater plume height quickly decreases again as the co2 dissolves from the disconnected cluster despite a steady state co2 plume height of 8 cm the free gas phase continued to rise in the flow cell to a final height of 15 cm at the end of the experiment but at a lower rate than during the initial 20 min of the injection based on this observation van de ven and mumford 2020 hypothesized that all co2 had been dissolved from the gas phase above the steady state plume height and the sustained vertical rise of gas was driven by n2 and o2 which partitioned from the influent water into the gas clusters experiment 2 therefore shows a complex multicomponent dissolution process an initial simulation using the enhanced macro ip mt model was conducted on a single random pe distribution and using s g crit 0 4 based on estimated saturation values from van de ven and mumford for a low injection rate and the sensitivity analysis conducted for experiment 1 overall the simulation fig 7 reproduces observed changes in the plume height due to repeated fragmentation of the gas channel and a gas height that is greater than the plume height at later time the agreement of simulations with observations is further supported by matching the average experimental steady state plume height however discrepancies between the simulated and measured plume and gas heights are observed at early times 0 60 min the discrepancies at early time are a result of the gas pressurization delay described above the macro ip algorithm is not designed to account for this pressurization the model is derived in such a way that the injected gas is assumed to initially exist at the required pressure for gas to enter the pore space because this effect is specific to the experiment simulated and likely not to be a concern for other applications of the model no attempts were made to resolve the discrepancies at early time however to validate the hypothesis that gas pressurization led to rapid vertical migration of the injected gas simulations were conducted where the equivalent mass of co2 for the first 10 min of the injection was stored and then mass was released using the macro ip algorithm at a higher injection rate 0 745 0 83 1 0 1 5 and 1 75 ml min 1 until the stored mass was depleted 20 15 10 5 and 4 min respectively then injection was re established at the pre defined rate of 0 5 ml min 1 fig 8 when accounting for the delay due to pressurization the dissolved co2 plume heights remain consistent with the measured height in the experiment in terms of the gas height slightly better agreement with the observed data can be seen at early time however long term behavior of gas height evolution is not substantially affected by incorporating the pressurization delay into the model this is expected of the macro ip mt model as the macro ip approach is developed for slow gas injections discontinuous flow and not for the high rate needed to recreate the rapid vertical growth observed also these differences might be due to small scale heterogeneities in the experimental setup affecting the distribution of entry pressures pe in the experiment but may also be related to the critical gas saturation s g crit as a next step a sensitivity analysis varying the random pe distribution and s g crit was conducted for experiment 2 to evaluate the impact of these parameters on the gas and steady state plume height three representative pe distributions were selected in this context fig 9 as expected the pe distribution caused variability in the gas height as seen in fig 9 relative to distribution 1 fig 9a the gas height in distribution 2 fig 9b was lower growing vertically at a lower rate in contrast distribution 3 fig 9c showed a gas height that was greater with a higher vertical growth rate expectedly this demonstrates that the pe distribution controls the amount of vertical migration within the simulations even in the presence of simultaneous mass transfer interestingly the average steady state dissolved phase plume for all distributions was not substantially affected on average 8 8 to 9 1 cm under the conditions simulated showing a low sensitivity to the pe distribution however the magnitude of the fluctuations varied between the pe distributions e g 3 4 cm in distribution 1 4 0 cm for distribution 2 and 6 1 cm for distribution 3 this comparison indicates that the model can generally resolve the average domain scale dissolved gas properties but the local scale variation depends on the pe distribution s g crit was varied from 0 3 to 0 5 to assess its impact on the gas and plume height similar to experiment 1 a lower s g crit was found to cause the vertical migration of gas to be faster fig 10 at a value of 0 3 and 0 4 the gas height reached the surface of the domain 21 cm at 110 min and 160 min respectively this was not observed in the experimental results and suggests that like experiment 1 an s g crit 0 5 is more suitable for these simulations despite the lower injection rate that is expected to result in discontinuous gas flow van de ven and mumford 2019 however it is clear from fig 10 that the gas height cannot be simulated exactly even at the defined value for s g crit owing to variability in the pore structure making it very difficult to simulate the exact gas heights without knowledge of the exact pore size distribution at the grid block scale again the average steady state plume height resulting from the simulations at any s g crit is consistent with the experimental results however the variability in the plume height fluctuations at steady state conditions show higher variability at higher values of s g crit e g 0 5 cm at s g crit 0 3 and 4 8 cm at s g crit 0 5 this increasing trend is the result of more gas being needed in a grid block before progressing to the next grid block such as when the gas becomes impeded at a grid block and the next step requires a relatively high gas pressure once the gas pressure increases enough that the entry threshold is met significantly more gas is stored within the gas channel at higher s g crit values allowing gas to expand into multiple overlying grid blocks in a single step this is highly dependent on the specific pe distribution once again highlighting that the macro ip mt model can resolve domain scale observations but local scale observations are more challenging to capture due to the sensitivity of macro ip to near pore scale variability notably only pe was distributed randomly in these simulations also noted by molnar et al 2019 it can be expected that other parameters such as s g crit and pt are also randomly distributed around mean values in addition and as discussed above effects of the presence of free phase gas will also affect the flow field by impacting relative permeability and mass transfer between water and the gas clusters furthermore small scale heterogeneities of the emplaced material are expected to impact water flow as well as free phase gas migration through spatial variations in porosity and permeability these considerations highlight the complexity of gas migration processes in the subsurface since the exact distribution of material parameters at the grid scale is not known and heterogeneities might extend to the sub grid scale it cannot be expected that an exact match to experimental observations can be achieved with the model however the overall good agreement with observational data in particular in terms of co2 plume height indicates that the controlling processes have been adequately captured by the modeling concept presented here in addition it should be noted that based on the consistency between the measured experimental plume height and the simulations the lea appears valid for the conditions within experiment 2 this contrasts the results of experiment 1 where mass transfer in the experiments occurred slower than seen in the simulation results despite the water flow velocity in experiment 1 being lower 0 02 cm s 1 relative to experiment 2 0 045 cm s 1 which at first sight would indicate that the lea should be less appropriate for experiment 2 however this might suggest that the difference in mass transfer kinetics is also dictated by the gas flow rate and the resulting gas flow pattern the gas injection rate in experiment 2 0 5 ml min 1 was much slower than in experiment 1 where gas was emplaced quickly within the first 10 s of the experiment there are two possible reasons as to why the gas flow impacts the applicability of lea the first is that a higher interfacial area for mass transfer is likely present in experiment 2 as a result of the lower injection rate resulting in discontinuous flow therefore creating conditions suitable for application of the lea the second is that at a lower gas injection rate there is more time for gas and water to equilibrate as the gas channel develops whereas at higher injection rates gas movement may be more rapid than the time scale needed for equilibration to occur e g a time scale of minutes for equilibration opposed to seconds for gas flow migrating gas could continue vertical migration prior to reaching equilibrium with surrounding pore water thus altering the gas composition and proceeding mass transfer thus the simulations provide valuable insight that the gas injection rate plays a role on the validity of the application of lea and that this process needs to be considered when modeling gas injection and leakage in saturated systems 3 2 2 multicomponent effects van de ven and mumford 2020b hypothesized that the sustained vertical growth of gas observed was the result of exsolution of dissolved n2 and o2 into the gas clusters however experimental data to support this hypothesis was not available the enhanced macro ip mt model can verify this phenomenon since it accounts for multicomponent effects because the model can simulate multicomponent mass transfer and includes dissolved background gases n2 and o2 in the inflowing water the model results can help understand the gas migration patterns and interplay between different gas compositions during this entire experiment to verify the explanation of van de ven and mumford 2020b the gas saturation and gaseous composition of each component co2 o2 and n2 simulated using the model are depicted at 90 and 170 min fig 11 based on the gas saturation during these times fig 11 a and e it is clear that free phase gas continues to rise even after the dissolved co2 plume has reached a steady state height i e after the average height of the dissolved gas plume showed no further vertical growth fig 11 d and h looking at the composition of the dissolved phase gases above the co2 plume n2 and o2 concentrations exhibit a slight enhancement above background levels below the steady state co2 height the n2 and o2 concentrations are depleted relative to background based on these observations it is clear that below the steady state height co2 is dissolving from the gas phase into the water phase while n2 and o2 is exsolving from the water phase into the gas phase above the steady state height the exsolved n2 and o2 then re dissolve into the aqueous phase these model results show that the gas components sustaining the vertical rise of the gas clusters are n2 and o2 this also supports that despite complete dissolution of the injected gas in this case co2 gas can continue to rise vertically because of partitioning of dissolved volatile components from the influent water to the vertically migrating free phase gas 3 3 relevance to gas migration the observations of van de ven and mumford 2020b and the results of the macro ip mt simulations are the first description of coupled gas flow and multicomponent mass transfer which can have significant relevance in aquifer systems where migration of free phase gas is occurring the specific gases present in these systems will affect the partitioning and the resulting sustained vertical migration of background gases and dissolution of source gases into the pore water in the experiments simulated here the released gas was co2 which is more soluble relative to the background o2 and n2 this led to the rapid dissolution of the released co2 into the flowing water and subsequent replacement by the less soluble background gases because of this and the relatively fast water flow velocity the co2 plume was removed quickly from the domain in experiment 1 and was arrested at a relatively low height above the injection point in experiment 2 in contrast if ch4 was the released gas e g in the context of gm from oil and gas wells it is expected that the complete dissolution of ch4 would be less rapid because it is less soluble relative to co2 henry s constant for ch4 of 7 1 104 pa m3 mol 1 as a result for experiment 1 it would be expected that the size and longevity of the dissolved ch4 plume would exceed what is observed for co2 in the experiment for experiment 2 the gas composition along the height of the migrating gas channel is expected to be a mixture of the released gas and the dissolved background gases and may not result in complete dissolution within the height of the experimental domain also because o2 is more soluble than methane it is expected that the gas continuing to rise vertically would be more enriched in n2 than what was observed in these simulations and particularly under anoxic conditions which are common in the field now considering a co2 gas release into a real aquifer system at substantial depth gas reaching the unsaturated zone may no longer contain the source gas at source concentrations or instead may even be dominated by the background gases however if ch4 was released in the same system it is expected that more sustained vertical migration would occur it is more likely that gas reaching the unsaturated zone would still contain ch4 albeit dilute relative to the released gas these findings ultimately highlight the importance of the inclusion of multicomponent mass transfer for simulating the movement and fate of gas in saturated groundwater systems as a result of differences between gas composition present both in the injected gas phase and in the background water mass transfer will be affected by sustaining the presence of the free phase gas following the complete dissolution of injected gas and the continued vertical migration of gas without the inclusion of this process the results of numerical models may not accurately capture the rate of dissolution the potential for the sustained presence of free phase gas that may act as a sink for other volatile components in the system and the potential mobilization of previously dissolved gases because of exsolution to the injected gas phase this finding goes beyond gm from energy wells or carbon sequestration sites quantifying the movement and dissolution of gas in the saturated groundwater zone is of interest for a variety of other applications for example the volatilization of non aqueous phase liquids gas generation during groundwater remediation biodegradation of contaminants and methanogenesis in sediments and peatlands which may lead to production or consumption of gases in the saturated groundwater zone e g amos and mayer 2006 ji et al 1993 mumford et al 2009 ramirez et al 2015 in these systems volatile gases originating from bio chemical reactions may be trapped in the gas phase due to exsolution leading to an extended potential source for groundwater contamination in the long term for certain volatile compounds at high concentrations this phenomenon may also result in increases in gas saturations within the system allowing sustained vertical migration of the gas phase and further spreading of contaminants within an aquifer chong and mayer 2017 it should also be mentioned that the resulting partitioning and gas composition following migration through a real aquifer will be dependent on the rate of gas flow groundwater flow and the overall depth of the aquifer all of which affect the contact time between gas and water as noted by van de ven and mumford 2020b this can create challenges for field monitoring approaches for gm such as detection of gas bubbles in effervescing wells if bubbling gas is detected in a well and then sampled the composition might not be reflective of the source composition of natural gas due to gas dissolution and replacement by background gases however because of multicomponent mass transfer the bubbling gas may still be indicative of a gm event these results emphasize the need to account for the interplay between different gas compositions in free phase gas and groundwater and gas migration patterns 4 conclusions an enhanced numerical model macro ip mt was used to simulate gas movement flow and simultaneous mass transfer to flowing groundwater resulting from a gas release below the water table the model implemented a simple gas release routine using conservation of mass and assuming an ideal gas and was coupled with the macro ip modeling approach of mumford et al 2010 including the multicomponent mass transfer algorithm of cirpka and kitanidis 2001 comparison of the coupled model with two gas injection and dissolution experiments showed reasonable agreement with observations and revealed complexities associated with gas migration processes in porous media this enabled the evaluation of key processes for modeling gas releases in shallow groundwater systems important for future modeling efforts overall it was found that gas flow within the model was sensitive to the distribution of entry threshold values defined within the domain pe as expected the distribution caused the vertical and lateral movement of gas to vary between realizations with the same gas release conditions this finding suggests that it is difficult to model the gas flow pattern exactly using a macro ip approach as variation of single entry or withdrawal thresholds along the flow path of the gas can cause differences from the experimental observations gas flow was also found to be sensitive to the selected empirical parameter s g crit which has not been an emphasis of previous studies utilizing macro ip based on the results of this study an s g crit of 0 5 was more appropriate than the lower values 0 2 0 3 used previously in the literature further work is required to enumerate the appropriate s g crit for future applications as it was shown to significantly impact the resulting gas flow and domain scale observations including the rate of vertical migration within the system in this context random distributions of s g crit could also be investigated analogous to our approach with varying pe distributions to evaluate the sensitivity of the modeling results towards spatial heterogeneity of this parameter unlike the gas flow mass transfer was relatively insensitive to the pe distribution and selected value of s g crit these parameters led to local scale differences however had negligible impact on domain scale observations e g dissolved plume height dissolution times it is common that the lea is used to model gas water partitioning e g cirpka and kitanidis 2001 geistlinger et al 2005 and often this is justified based on relatively low groundwater flow rates however the comparison between simulations using the lea and the experimental gas injections provided strong evidence that the rate of gas release can also cause the lea to not accurately capture mass transfer higher release rates likely cause lower interfacial area between gas and water leading to deviation from equilibrium also at a higher gas release rate it is suspected that gas moves much faster than the rate at which dissolution occurs therefore not allowing equilibrium between gas and water within a grid block before gas can continue to rise with the understanding gained from this study specifically on the key processes needed to simulate simultaneous gas flow and mass transfer and controlling parameters necessary steps towards up scaling and application of numerical models at larger scales e g 10 s to 100 s of m have been made a challenge facing modeling efforts for gas migration is the sensitivity of gas migration to porous media characteristics which has long been known this was reflected in the modeling results of this study not exactly matching the experimental results which is likely difficult to resolve and expected for other modeling approaches however the implemented modeling approach was found to be computationally efficient allowing multiple simulations with varying pe distributions to be run in a relatively short period of time thus this approach can be adopted to generate multiple simulation runs to develop an understanding of the average domain scale behavior for the modeled system e g time for gas to reach the surface of the system vertical extent of the gas channels thus because it is difficult to resolve pore scale variability future modeling for gm should look to utilize stochastic approaches such that average domain scale observations are accurate and provide valuable information for understanding the impacts of gm in shallow groundwater in addition to advancing stochastic approaches to capture gas flow the results also advance the possibility of the incorporation of the macro ip approach into more comprehensive reactive transport models by providing a better understanding of the key physiochemical processes coupling macro ip with robust reactive transport models will also enable the use of stochastic approaches for investigation such that average domain scale observations from a biogeochemical and solute transport perspective can be made which is difficult with current continuum models due relatively lower computational efficiency the enhancement of the macro ip mt model and comparison of simulations against bench scale experiments is a vital initial step to attaining a robust numerical model to simulate gas releases and leaks at the field scale for a variety of applications credit authorship contribution statement kartik jain formal analysis investigation methodology validation visualization writing original draft cole j c van de ven conceptualization formal analysis investigation methodology resources supervision validation writing review editing kevin g mumford conceptualization funding acquisition investigation resources software writing review editing k ulrich mayer conceptualization formal analysis funding acquisition investigation methodology project administration resources supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments support for this research was provided by the natural sciences and engineering research council nserc of canada through a strategic partnerships grant for projects spg 506784 2017 supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2022 104362 appendix supplementary materials image application 1 
