index,text
26010,hydrological gis preprocessing tools are used to spatially relate different datasets for producing topologically connected watersheds and deriving attributes for model parameterization obtaining such information requires disparate data sources from various websites with lengthy processing requirements this research describes the development of hms prepro an open source gis preprocessing tool that was developed for the u s army corps of engineers usace hydrologic engineering center s hydraulic modeling system hec hms software hms prepro provides data as a service by connecting to esri s living atlas web service and extracting authoritative hydrological datasets for any watershed of interest in the contiguous united states the datasets are saved to a local geodatabase and spatial operations are executed to automatically delineate the watershed derive topological connections and estimate several common hydrologic parameters an output basin text file is produced in hec hms format for rapid model initialization 1 introduction hydrologic models describing the transformation of rainfall over a watershed to runoff at its outlet depend on the physical description of the watershed traditionally this has been achieved by using gis preprocessors for hydrologic models beginning with the delineation of the watershed boundaries and stream network from a digital terrain model then adding soil land cover and channel properties using additional data these datasets are assembled from a variety of sources and then transformed into the required format a tedious and time consuming task once the pertinent datasets have been assembled lengthy gis spatial operations are required to derive attributes important for model parameterization due to the level of detail associated with a thorough drainage study updated models are prolonged often resulting in expired data for decision making purposes regularly maintained drainage analyses will not be possible until hydrologic data acquisition and processing is streamlined this paper describes the development of a gis preprocessing tool called hms prepro that connects to a web based data service and automatically extracts authoritative datasets derives a topologically consistent watershed network estimates hydrological parameters and converts the results into a format accessible by the u s army corps of engineers usace hydrologic engineering center s hydraulic modeling system hec hms software hec hms is one of the most widely used modeling tools for simulating flood hydrology within the engineering community usace 2018 hms prepro allows modelers to continue working with familiar software while providing an operational linkage between watershed data and the end user the hydrological community has been trending toward the improved collection and management of geospatial information from web based data services where providers host large datasets on remote servers with standardized methods for searching and downloading specific sets of interest ames et al 2012 brendel et al 2019 gichamo et al 2020 goodall et al 2008 2011 horsburgh et al 2008 jeong et al 2006 leonard and duffy 2014 tarboton et al 2011 data services allow users to drive decision making by improving the accessibility of data within a larger workflow hms prepro expands such early efforts by incorporating esri s living atlas and its associated web data services into hec hms modeling the living atlas further described in section 3 0 provides curated access to authoritative datasets in a ready to use format instead of requiring the user to obtain process and spatially relate disparate datasets hms prepro connects to the living atlas and seamlessly extracts the geospatial data necessary to build a hec hms model as others have shown the use of such data services is an effective tool for improving hydrological modeling and the speed of watershed development additional progressions in hydrological modeling include the automation of geospatial processes to rapidly derive catchment parameters prior work regarding gis automation typically required the user to obtain and preprocess the input datasets lacroix et al 2002 lin et al 2008 miller et al 2007 rahmati et al 2018 ryan and boyd 2002 other works combined data services with parameter automation but were limited to certain large scale catchment boundaries leonard and duffy 2014 lewis et al 2018 which may not be useful for site specific applications hms prepro links the use of hydrological data services with automated parameterization using minimal user input for any watershed of interest in the contiguous united states hms prepro includes parameterization capabilities for common subbasin loss and transform methods such as the curve number cn green and ampt and the clark snyder and scs unit hydrographs as well as popular reach routing methods such as muskingum cunge and the tr 55 lag time usace 2018 hms prepro was designed to meet a need within the hydrological modeling community after the original gis preprocessor for hec hms was decommissioned beginning in 2003 hec geohms was developed by the usace in collaboration with the environmental systems research institute esri to spatially relate watershed information for hec hms modeling usace 2003 usace 2010 ten years later hec geohms was decommissioned after arcgis version 10 2 1 to incorporate gis capabilities directly within hec hms usace 2013 the most recent release of hec hms version 4 4 includes an inherent gis toolkit for watershed delineation from a digital terrain model usace 2020 the input datasets must still be manually retrieved and pre processed prior to execution of the geospatial capabilities within hec hms the advent of web gis and codesharing provides an opportunity to have an open source community based preprocessor for hec hms that can directly connect the modeler with authoritative datasets in a seamless manner for streamlined modeling capabilities within a gis environment this paper describes the development of such a preprocessor whose code and supporting documentation are accessible at https github com cvcastro hms prepro 2 background 2 1 hec hms hec hms was created by the usace to route a runoff hydrograph through a stream network and estimate watershed discharge over time hec hms produces event based storm hydrographs used in urban drainage design floodplain mapping reservoir design land use impact studies water management and flood forecasting usace 2018 a standard hec hms project is comprised of a control specification a meteorological model and a basin model the control specification defines the time constraints of the model the meteorological model is used to simulate precipitation within the basin the basin model represents the physical watershed through elements such as stream reaches subbasins and junctions that are connected hydrologically the basin model also contains information about the mathematical processes to be simulated by hec hms usace 2018 hms prepro was designed to initialize the basin model component of a hec hms project by extracting physical datasets from the web service and estimating parameters for various hydrological processes once the basin component has been initialized through gis the user may start the process of applying rainfall conditions and calibrating the model within hec hms usace 2018 in hec hms the basin model is usually created through an interconnected graphical user interface gui as shown in fig 1 each watershed element is drawn as an icon and the user must specify individual hydrological methods and calculate parameter values for every component as the complexity of the model increases so does the time associated with interface management when a basin model is saved in hec hms a description of each hydrologic element is created and summarized in an output ascii text file the output file is saved with a basin extension and contains information about each element name spatial location connectivity and hydrological association the user may edit the text file and changes will be reflected in the hec hms interface usace 2018 instead of manually creating the basin model through a gui hms prepro automatically populates a basin file with gis derived watershed data in a format that may be directly read by hec hms 2 2 hec geohms hec geohms was a preprocessing tool developed to use geospatial information provided by the user to initialize a hec hms model more expediently than manual methods usace 2010 hec geohms built on early efforts of incorporating gis capabilities into standard hydrologic modeling agrawal 2005 hellweger and maidment 1999 maidment ed 2002 olivera et al 2003 usace 1980 for example crwr prepro linked gis and hydrologic modeling by delineating the stream network and building the basic structure of a watershed model from digital terrain data hellweger and maidment 1999 archydro was then created to store and process the geographic data such that hydrologic characteristics may be derived and related to one another according to a stream threshold and geodatabases maidment ed 2002 these concepts were combined by esri and the usace into hec geohms to aid hydrological modelers with semi automated spatial analysis usace 2003 basic execution of the toolkit requires numerous geospatial operations thus motivating a transition of gis capabilities directly within the primary hec hms modeling platform usace 2020 table 1 lists the minimum geospatial operations initiated by the authors to produce a successful hec hms basin model using the traditional hec geohms toolbar the processing steps in table 1 were conducted after comprehensive geospatial datasets were downloaded merged and prepared by the user in an acceptable format usace 2010 moreover many of the parameters included in hec geohms were populated separately as a grid layer or feature attribute before using the toolkit thus extending the time required by the user to develop an initial basin model chapter 10 usace 2010 the amount of data management and geospatial processing involved prior to watershed delineation and parameterization is substantial and may pose user difficulties 2 3 streamlined preprocessing gis systems have integrated with hydrological modeling due to the inherent spatial nature of watershed phenomena singh and fiorentino eds 2013 the development of gis based preprocessors enabled the creation of watershed and stream networks and the computation of their physical properties using geospatial layers early hydrological gis frameworks included archydro which established the use of geodatabases for relating watershed data olivera et al 2003 and crwr prepro which highlighted the strengths of grid based terrain analysis hellweger and maidment 1999 by using gis spatial sciences to assign location as a key variable these tools streamlined watershed delineation and alleviated the need to average parameters over an entire watershed which has now become commonplace in water resources olivera et al 2006 building on the work of others hms prepro emphasizes a next major trajectory in hydrological preprocessing by demonstrating how gis technology has evolved beyond the use of standard databases assembled from various sources instead geospatial data may be embedded directly into the framework of hydrologic modeling for synchronized and automated workflows similar to the use of geodatabases in archydro web based data services combine location into a common denominator and connect distinct sets of information for improved geospatial analysis the use of gis in watershed modeling may be described by the progression of key steps outlined in table 2 steps 1 and 2 include the necessary data gathering management and processing required for all hydrological modeling applications such steps are just beginning to be modernized by coupling comprehensive data services with gis operations terrain analysis is then performed to describe the drainage patterns over a basin according to a digital representation of the land surface usace 2010 watershed delineation and topological connectivity define the basic hydrologic structure of the model once the watershed network has been defined physical properties may be extracted from the data to estimate hydrological parameters the watershed structure and basin properties are summarized in a unique format for use in a specific hydrologic modeling software steps 1 through 5 are generic in nature and are common in gis based hydrological modeling workflows step 6 converts the geospatial results into a model specific format for hydrological modeling outside the gis platform for example hec geohms converts geospatial data into hec hms format usace 2003 agwa preprocesses data for swat modeling miller et al 2007 and basins integrates watershed data for use in environmental applications epa 2001 each of these preprocessors performs the general gis based steps involved in hydrological modeling steps 1 5 and then converts outputs into a software specific application step 6 traditionally the key steps described in table 2 are executed as distinct workflows while building on the preceding functions hms prepro synchronizes these interrelated stages to increase model reproducibility and to minimize potential user errors from manual geoprocessing procedures while hms prepro produces an output file specific to hec hms software the tool may be used to aid modelers that work with alternative programs by streamlining the typical operations involved in hydrological preprocessing specifically modelers may use hms prepro to extract datasets describing the physical conditions of a watershed delineate a stream network and estimate common hydrological parameters that will be appended to gis feature class attributes on the user s computer such information will aid hydrological preprocessing for purposes of gathering an initial watershed network and setting up a basin model prior to detailed calibration efforts irrespective of the final simulation software employed by the user hms prepro streamlines steps 1 and 2 by connecting to the esri living atlas and extracting pertinent datasets from the server according to a user defined watershed boundary extent the data on the living atlas is provided in a ready to use and seamless gis format which is then automatically organized into a single geodatabase on the user s local computer in steps 3 and 4 gis operations are automated in rapid succession to process the terrain and estimate drainage patterns for watershed delineation hms prepro assigns topological connections to the watershed network through a hydrologic identifier similar to the methodology used in archydro olivera et al 2003 in step 5 hms prepro estimates hydrological parameters for the watershed network according to the methodologies chosen by the user in step 6 hms prepro processes the data from the preceding operations and produces an output text file containing basin model information for consumption by the hec hms modeling software section 4 0 includes further details describing how hms prepro streamlines the gis phases that are common in hydrological modeling 3 the living atlas the living atlas of the world is a centralized data service curated by esri that provides users with a plethora of seamless datasets directly within arcgis from authoritative agencies and community organizations esria 2018 a sampling of data types available in the living atlas include earth observations demographics multispectral imagery infrastructure environmental impacts natural hazards urban systems ecology and much more https livingatlas arcgis com essentially anything that can be mapped within gis could be submitted to esri curators for inclusion in the living atlas provided the content is reliable and useful to the greater gis community esri 2015 when data is updated by the contributing organization esri updates the living atlas thus providing the geospatial community with on the fly and reliable datasets the living atlas may be accessed online or through the arcgis suite of products where users may explore content on the server and then extract pertinent datasets for immediate local use in gis arcgis is one of the most widely used geographical systems in hydrology however common use of this data service for hydrological modeling has not reached full potential in the hydrological sciences overland flow is dependent on the terrain land use impervious cover and soils type to quantity flow over time and to determine the direction of rainfall runoff national datasets are included in the living atlas from authoritative agencies that have been reliably used in hydrological practice for many years hms prepro connects to arcgis rest servers from the living atlas and extracts pertinent datasets according to an input watershed boundary the extracted data is placed into a local geodatabase for further analysis the minimum data types required for gis based hydrological modeling are included in table 3 usace 2010 along with the rest server urls and the hosting agencies terrain elevation is provided in the living atlas as a seamless digital model with a minimum 30 m resolution esri 2020a digital elevation data is used to estimate the average watershed slope and to calculate the time series associated with dynamic flow land use and impervious coverage is available in the living atlas from the national land cover database nlcd for 2006 2011 and 2016 esri 2020a nlcd classifications are based on 30 m landsat data and may be used to calculate various infiltration and runoff parameters usgs 2018 hydrological soils information is used to calculate subbasin losses hydrological soils groups are available from the natural resources conservation service nrcs soil survey geographic database ssurgo the living atlas hosts the hydrological soils groups ranging from sandy to clayey classifications reducing the need for manual parameterization of raw soils data from reference tables usda 2009 esri 2020a a key benefit of gathering data from the living atlas instead of directly from the applicable websites is that hosted data is provided as a seamless grid when data is provided seamlessly the user is no longer required to download information for specific cells and then mosaic and clip data to the intended extents i e manually downloading lidar elevation data for dozens of grids and merging to the watershed boundary using location as a common factor various datasets pertinent to watershed modeling may be extracted from the web and immediately used in gis applications common tasks associated with downloading spatial subsetting and processing are eliminated when users obtain operational data directly through the gis platform the use of the living atlas landscape layers in hms prepro requires an arcgis online organizational account this is different than an arcgis personal or global account and is provided through many educational institutions or companies if a user does not have an organizational account steps for creating one are included in the hms prepro user s manual the living atlas content used in hms prepro is free and does not consume any organizational credits while the goal is not to advocate for a specific commercial product the authors hope that the concept of data services embedded directly within gis programs will become commonplace in hydrological modeling with regards to widespread hydrological applications web based gis data services are still in their infancy the authors present the living atlas as a potential tool for hydrologists and a general proof of concept for how standardized map services may be used to relate datasets by location instead of compiling from various sources for enhanced workflows 4 hms prepro methodology the hms prepro toolbox contains two primary scripts namely get data and preprocess basin a third optional script is included for when the tr 55 method is selected to estimate the time of concentration the get data tool extracts terrain soils land use and impervious coverage data from the living atlas sms according to a user specified watershed boundary in the get data tool the user is required to input an arcgis organizational username and password for connection to the living atlas servers as shown in fig 2 a local output geodatabase is specified and the watershed of interest is input to spatially connect the project location with the datasets that will be extracted from the web based sms a common coordinate system is specified to integrate the datasets and perform local processing fig 3 describes the general workflow for the get data script in hms prepro the user is connected to the living atlas server and a temporary image layer is created using the arcgis make image server layer tool the make image server layer creates a layer of hosted data on the local machine for geoprocessing but the data still resides on the living atlas server the arcgis extract by mask tool is executed to clip the server based data and save the information locally therefore all operations in hms prepro are executed on the local computer aside from the initial connection to the living atlas rest server and the dataset extraction the datasets are clipped to a buffer region slightly larger than the user defined watershed boundary in order to preserve all digital pixels within the catchment area the hydrological datasets are organized in a local geodatabase on the user s computer the preprocess basin script then uses the geodatabase created by the get data tool to perform spatial analysis and initialize a hec hms basin model as shown in the fig 4 workflow schematic preprocess basin provides several user options for defining hydrologic processes and estimating watershed parameters according to methodologies outlined in this section the derived attributes are appended to feature classes within the local geodatabase an output text file is created that contains information about each watershed element in a format that may be opened by the usace hec hms software additional instruction is provided in the hms prepro user guide and technical appendix 4 1 watershed topology in gis based hydrologic modeling the landscape is represented by data that is geographically connected topology describes the spatial relationships between neighboring features such as how an upstream catchment is connected to a downstream catchment through a junction node and routing reach hydrological modeling requires topological connections as input to determine flow connectivity in hec hms each element references a unique identifier of the connecting elements and the sequence of these connections signal the continuity of flow within the model hellweger and maidment 1999 hydrologically consistent topology means that each catchment contains only one unique reach with the same identifier each element is distinguished by a unique identifier that provides connectivity information in archydro the element identifier is called the hydroid hms prepro uses relationships between subbasin and reach identifiers to determine downstream connectivity for the basin model file each subbasin is connected to the upstream node of its downstream reach which is a junction defined by the reach coordinates reaches convey flow and are therefore not included in the most upstream basin elements lists containing all subbasins and reaches are created and then hms prepro determines the subbasins that do not have a corresponding reach identified i e upstream subbasins fromnode and tonode identifying attributes derived by archydro describe the inherent junction properties and connectivity of the reach layers the node attributes are used in hms prepro to populate a field describing each downstream reach identifier 4 2 loss methods in hec hms basin models are used to represent the physical characteristics of a watershed such as infiltration runoff and flow routing rainfall runoff is simulated by applying hydrological methods and connecting basin elements in a downstream direction of the event based methods used to simulate infiltration losses hms prepro incorporates the scs curve number scs cn method and the green and ampt method the cn is used in hydrology for predicting the amount of runoff potential for a set of watershed conditions the green and ampt loss method is a simplification of the richard s equation for describing water flow and infiltration through the soil usace 2018 in hms prepro the green and ampt parameters may be provided by the user or estimated from the ssurgo soils data and an embedded lookup table a detailed workflow for the scs cn method is described in table 4 demonstrating a general proof of toolbox capabilities additional hydrological methodologies in hms prepro are mentioned briefly while the scientific details may be referenced in the technical appendix hms prepro uses sms datasets and gis operations to rapidly create a cn grid while minimizing intermediate user steps as shown in the fig 5 workflow hms prepro executes the cn steps internally while requiring only a watershed input boundary from the user a cn lookup table is embedded within hms prepro and populated according to the urban hydrology for small watersheds tr 55 usda guidelines usda 1986 as shown in table 5 hms prepro automatically executes gis operations to connect the cn lookup table with the merged soils land use data and the watershed catchments an example of automated cn output layers derived by hms prepro is shown in fig 6 the nlcd land use values are extracted from the living atlas service and reclassified into ten categories that correspond with the scs cn lookup table table 5 the ssurgo hydrological soils group data is also downloaded from the living atlas server and automatically appended with the reclassified land use data the merged soils and land use layers are referenced to a lookup table to estimate the individual cn in each raster pixel the individual curve numbers are converted to a composite curve number according to a weighted spatial average for each subbasin boundary the amount of impervious cover in each subbasin is extracted from the nlcd datasets for values of 1 100 and appended to the subbasin layer when impervious coverage is used in hec hms the impervious percentage of land is assumed to have no losses and the cn is only applied to the remaining portion of each catchment drainage area usace 2018 4 3 transformation methods in hydrologic modeling the amount of precipitation excess is transformed into surface runoff hec hms has several transform methods available including basic unit hydrograph methods and quasi distributed methods that require the use of gridded meteorological data usace 2018 hms prepro provides options for using the three non gridded transform methods in hec hms scs unit hydrograph clark unit hydrograph and the snyder unit hydrograph the scs unit hydrograph method also known as the nrcs dimensionless unit hydrograph method is based on average unit hydrographs from geographic rainfall distributions in hec hms the scs unit hydrograph may be approximated for each lumped subbasin according to the lag time the lag time represents the interval between the moment rainfall runoff begins until the peak of the hydrograph is reached usda 2010 hms prepro may be used to calculate the lag time according to the cn lag method or the tr 55 lag method as described in the scs national engineering handbook usda 2010 the cn lag time is a simple calculation based on the curve number and slope of each subbasin the tr 55 method is more complicated and involves splitting the longest flowpath of each basin into regions of shallow concentrated flow overland flow and channelized flow values for the longest flowpath land cover soils type and catchment slope are spatially derived from the hydrological data extracted by hms prepro in the tr 55 method user defined input values are required for proper tool execution according to local channel properties i e manning s roughness coefficient channel shape wetted perimeter transition location from overland flow to shallow concentrated flow reference the user guide for further instruction regarding the tr 55 script tool the clark loss model derives a unit hydrograph by combining a translation hydrograph and a linear reservoir in hec hms the translation hydrograph is represented by a synthetic time area curve and the time of concentration tc for each subbasin the linear reservoir is represented by the storage coefficient r to describe the storage effects in the subbasin scharffenberg et al 2003 in hms prepro the nlcd land cover raster is used to estimate the percent land developed dlu for each subbasin through a zonal statistics analysis the land cover data is reclassified according to the estimated development within each nlcd classification the dlu is then used to estimate the on site detention percentage of channel improvements and percentage of channel conveyance values according to the assumption that development causes an increase in channel improvements and a decrease in local detention and channel conveyance additional values required for deriving clark parameters include the watershed slope longest flowpath length to basin centroid and channel slope such values are automatically calculated in hms prepro using arcgis geoprocessing operations described further in the hms prepro technical appendix tc and r may be rapidly estimated for initial model set up and then carefully calibrated by the user according to historical events and available data the snyder method estimates stormwater hydrographs in ungauged watersheds chow et al 1988 hec hms uses an iterative procedure to derive hydrograph parameters based on the subbasin area lag time and peaking coefficient in hms prepro the snyder peaking coefficients and steepness coefficients are provided by the user and additional parameters i e drainage area lag time are calculated using spatial analysis detailed background information regarding the unit hydrograph methodologies and user instructions are provided as a technical appendix at https github com cvcastro hms prepro 5 tool application and results a case study was conducted to analyze the capabilities of hms prepro in initializing hydrological basin models from data services in comparison to the standard hec geohms toolbar three watersheds of varying sizes were used to showcase the different hydrological methodologies available in hms prepro as noted in table 6 by comparing results to the established hec geohms tool this analysis confirms the capability of hms prepro in deriving basin topology and estimating hydrologic parameters directly from web based data services the watersheds used in this analysis are located in texas usa and range in size from approximately 15 to 50 square miles the hms prepro get data script tool was used to obtain hydrological and landscape datasets for the watersheds the watershed boundaries were used to relate spatial datasets in hms prepro once the data was automatically downloaded and processed on a central geodatabase the preprocess basin tool was executed to estimate catchment parameters and create a basin output file for hec hms modeling the hec geohms steps in table 2 were then executed in succession to initialize a basin file for comparison datasets for hec geohms were manually downloaded merged processed and projected from a variety of authoritative websites as referenced in table 3 the basin files produced by hms prepro and hec geohms were opened in hec hms version 4 3 and simulated with a hypothetical storm event to analyze similarities in the output hydrographs the computational time differences between the two tools are shown in table 7 the manual time associated with gathering data from authoritative sources and pre processing the datasets ranged from approximately 3 5 hours for each watershed the time spent gathering data can vary tremendously depending on internet speed computer resources location specific data providers formatting and gis expertise i e mosaicing tiled layers data management best practices as shown in table 7 the time differences associated with gathering data and executing gis functions to preprocess a basin file were substantial hms prepro was able to process the input datasets to derive a watershed network and estimate hydrological parameters in approximately 20 seconds while sequential execution of the numerous operations in hec geohms required over 40 minutes all computations were performed with arcgis 10 7 1 on a desktop computer with 10 gb ram memory 64 bit operating system and 3 4 ghz 4 core central processing unit which are average system requirements for running arcgis esri 2020b local internet connectivity was approximately 90 mbps download speed as shown in fig 7 both hms prepro and hec geohms derived identical watershed networks from the terrain while hms prepro required less user interaction and preliminary data gathering a stream threshold of 1000 grid cells was applied to a 30 m dem for the model derivations in both hms prepro and hec geohms the longest flowpath operation was the most time consuming component geometry attributes topology connections and coordinates were derived by both gis tools and appended to the basin files since hec geohms does not contain automated functions for deriving the percent impervious area green ampt parameters or the cn grid datasets derived from hms prepro were used as inputs for the subbasin parameters from raster feature and generate cn grid tools in hec geohms in a standard hec geohms project the user would be expected to derive such layers manually prior to running the tool thus increasing the total execution time similarly hec geohms does not contain functions for deriving or appending the snyder or clark unit hydrograph parameters at all these parameter estimations were added to hec hms manually for the hec geohms basins the user would need to derive the unit hydrograph parameters in arcgis outside of hec geohms in a standard watershed project hms prepro provides various added benefits compared with hec geohms including linking the user with seamless data faster execution times less user interaction and the ability to estimate several common parameters the resulting basin files for hms prepro and hec geohms were simulated in hec hms for a hypothetical control period from january 1 2020 to january 3 2020 using a uniform scs type 3 rainfall distribution of 5 inches the model schematics and output hydrographs are shown in fig 8 both hms prepro and hec geohms produced identical output hydrographs thus strengthening the reliability of the hms prepro results compared with the standard preprocessor for hec hms 6 limitations future work the basin file created by hms prepro may be used to initialize a hydrologic model however the user is expected to optimize and calibrate the watershed network and parameters according to expert knowledge the importance of understanding that this tool is not a complete hydrologic model itself but is a method of initializing the basin component of a hec hms project cannot be understated hms prepro is intended to expedite the development of the basin model by connecting the user with authoritative datasets and synchronizing common geospatial operations performed in hydrological modeling as mentioned in section 2 1 the user must provide the hec hms software with site specific meteorological data and control specifications for a complete hydrological model after initializing the basin using gis usace 2018 moreover the watershed parameters calculated with hms prepro are merely an estimate from input datasets and will need to be calibrated validated and updated according to local knowledge the watershed network derived by hms prepro may not result in a hydrological element at the desired spatial location if the user intends to analyze flow at a specific location for site development the terrain based delineation methods in hms prepro may automatically place a junction node upstream or downstream of the site user modification to the initial basin network is likely according to specific project conditions hms prepro was designed for compatibility with hec hms due to the widespread nature of the modeling program however a plethora of hydrological modeling software exists with each requiring a unique format for inputting geospatial data collective efforts will be required to extend the preprocessing capabilities presented in hms prepro for use in other hydrological applications maintenance of the hms prepro in its current form will also require ongoing efforts as new versions of arcgis are produced and data services are updated it is our hope that this software tool will be useful for direct applications to hec hms but will also broaden the use of data services in watershed preprocessing creating the potential for collective applications that adapt to changes in technology and needs within the hydrologic community public interchangeable and generalized standards are needed to meet the full potential of using data services in gis based hydrological modeling which is an expected direction of future research 7 conclusion as others have demonstrated we found that standardized data services provide a faster alternative to traditional hydrological modeling by bridging the gap between the end user and hydrological data standardized map data services such as the esri living atlas may be used to provide seamless data for rapid gis analyses hms prepro uses the watershed boundary as a geographic relationship for connecting distinct datasets into a hydrological catalog therefore many of the data management requirements for watershed tools are eliminated hms prepro also improves the time associated with standard hydrological preprocessing by synchronizing common gis steps and streamlining the user interface by combining gis operations into a uniform tool interface model reproducibility is improved while potential errors from manual executions are minimized a case study of three watersheds with varying sizes demonstrates the computational efficiency and accuracy of hms prepro when compared with the standard hec geohms toolbar the process of automatically and seamlessly gathering data with the hms prepro get data script ranged in time from approximately 2 5 min 15 5 min the manual time spent gathering data from various websites and mosaicing them on a local computer ranged from approximately 3 to 5 h excluding time associated with searching for and discovering pertinent sources the execution times reported in table 7 were for an expert gis user with prior knowledge of data requirements and sources of retrieval preprocessed parameters and seamless execution of the toolbar steps a novice gis user would likely require significantly more time to find extract and preprocess the data prepare the parameterization feature classes and run the geospatial operations in our experience traditional gis based hydrological preprocessing often produces numerous errors and issues with data setup resulting in a minimum of several days or even weeks for the first initialization of a successful hec hms basin model while proper calibration and validation associated with a reliable hec hms model will require advanced hydrological expertise a tool such as hms prepro may substantially improve the time associated with initial setup of the basin model file without requiring advanced and potentially cumbersome gis skills both the standard hec geohms toolbar and the hms prepro toolbox resulted in identical watershed networks and hydrological estimates thus confirming the ability of hms prepro in deriving topological connections and estimating hydrological parameters from living atlas datasets this research confirms the ability of data hosted on the living atlas to be used reliably in hydrological modeling by creating a preprocessing tool for the widely used hec hms hydrological program using a service that is already integrated within the arcgis platform the authors hope that such data services will become more accessible to end users from a variety of backgrounds moreover all data services including the living atlas have and will evolve over time content may be submitted to esri curators for inclusion in the living atlas and accessed by the greater geospatial community but widespread use of such concepts will require a collective effort by becoming more familiar with data services it is anticipated that standardized map services will become commonplace for enhancing workflows in gis based hydrological applications software availability hms prepro was developed and tested for compatibility with arcgis version 10 7 the hms prepro toolbox user s manual and technical appendix is available at https github com cvcastro hmsprepro this product requires esri arcmap 3d analyst spatial analyst archydro tools and arcgis organizational account credentials arcgis desktop background processing 64 bit is also encouraged users are encouraged to adopt and modify the hms prepro scripts for use in other hydrological software and additional versions of gis as applicable the open source python code may be edited and reproduced for personal use per the gnu general public license modified versions i e software improvements or additional versions of gis should be released back to the hydrological community for collective use it is not permissible to use this software for commercial purposes i e selling any portions of the code without first contacting the author this program is free software you can redistribute it and or modify it as long as modifications are redistributed to the general public this program is distributed in the hopes that it will be useful but without any warranty or the implied warranty of fitness for a particular purpose acknowledgements the authors would like to thank the anonymous reviewers of this manuscript for providing valuable suggestions and comments this material is based upon work supported by the national science foundation graduate research fellowship program under grant no 2013162199 any opinions findings and conclusions or recommendations expressed in this material are those of the author s and do not necessarily reflect the views of the national science foundation appendix a supplementary data the following are the supplementary data to this article multimedia component 1 multimedia component 1 multimedia component 2 multimedia component 2 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2020 104732 
26010,hydrological gis preprocessing tools are used to spatially relate different datasets for producing topologically connected watersheds and deriving attributes for model parameterization obtaining such information requires disparate data sources from various websites with lengthy processing requirements this research describes the development of hms prepro an open source gis preprocessing tool that was developed for the u s army corps of engineers usace hydrologic engineering center s hydraulic modeling system hec hms software hms prepro provides data as a service by connecting to esri s living atlas web service and extracting authoritative hydrological datasets for any watershed of interest in the contiguous united states the datasets are saved to a local geodatabase and spatial operations are executed to automatically delineate the watershed derive topological connections and estimate several common hydrologic parameters an output basin text file is produced in hec hms format for rapid model initialization 1 introduction hydrologic models describing the transformation of rainfall over a watershed to runoff at its outlet depend on the physical description of the watershed traditionally this has been achieved by using gis preprocessors for hydrologic models beginning with the delineation of the watershed boundaries and stream network from a digital terrain model then adding soil land cover and channel properties using additional data these datasets are assembled from a variety of sources and then transformed into the required format a tedious and time consuming task once the pertinent datasets have been assembled lengthy gis spatial operations are required to derive attributes important for model parameterization due to the level of detail associated with a thorough drainage study updated models are prolonged often resulting in expired data for decision making purposes regularly maintained drainage analyses will not be possible until hydrologic data acquisition and processing is streamlined this paper describes the development of a gis preprocessing tool called hms prepro that connects to a web based data service and automatically extracts authoritative datasets derives a topologically consistent watershed network estimates hydrological parameters and converts the results into a format accessible by the u s army corps of engineers usace hydrologic engineering center s hydraulic modeling system hec hms software hec hms is one of the most widely used modeling tools for simulating flood hydrology within the engineering community usace 2018 hms prepro allows modelers to continue working with familiar software while providing an operational linkage between watershed data and the end user the hydrological community has been trending toward the improved collection and management of geospatial information from web based data services where providers host large datasets on remote servers with standardized methods for searching and downloading specific sets of interest ames et al 2012 brendel et al 2019 gichamo et al 2020 goodall et al 2008 2011 horsburgh et al 2008 jeong et al 2006 leonard and duffy 2014 tarboton et al 2011 data services allow users to drive decision making by improving the accessibility of data within a larger workflow hms prepro expands such early efforts by incorporating esri s living atlas and its associated web data services into hec hms modeling the living atlas further described in section 3 0 provides curated access to authoritative datasets in a ready to use format instead of requiring the user to obtain process and spatially relate disparate datasets hms prepro connects to the living atlas and seamlessly extracts the geospatial data necessary to build a hec hms model as others have shown the use of such data services is an effective tool for improving hydrological modeling and the speed of watershed development additional progressions in hydrological modeling include the automation of geospatial processes to rapidly derive catchment parameters prior work regarding gis automation typically required the user to obtain and preprocess the input datasets lacroix et al 2002 lin et al 2008 miller et al 2007 rahmati et al 2018 ryan and boyd 2002 other works combined data services with parameter automation but were limited to certain large scale catchment boundaries leonard and duffy 2014 lewis et al 2018 which may not be useful for site specific applications hms prepro links the use of hydrological data services with automated parameterization using minimal user input for any watershed of interest in the contiguous united states hms prepro includes parameterization capabilities for common subbasin loss and transform methods such as the curve number cn green and ampt and the clark snyder and scs unit hydrographs as well as popular reach routing methods such as muskingum cunge and the tr 55 lag time usace 2018 hms prepro was designed to meet a need within the hydrological modeling community after the original gis preprocessor for hec hms was decommissioned beginning in 2003 hec geohms was developed by the usace in collaboration with the environmental systems research institute esri to spatially relate watershed information for hec hms modeling usace 2003 usace 2010 ten years later hec geohms was decommissioned after arcgis version 10 2 1 to incorporate gis capabilities directly within hec hms usace 2013 the most recent release of hec hms version 4 4 includes an inherent gis toolkit for watershed delineation from a digital terrain model usace 2020 the input datasets must still be manually retrieved and pre processed prior to execution of the geospatial capabilities within hec hms the advent of web gis and codesharing provides an opportunity to have an open source community based preprocessor for hec hms that can directly connect the modeler with authoritative datasets in a seamless manner for streamlined modeling capabilities within a gis environment this paper describes the development of such a preprocessor whose code and supporting documentation are accessible at https github com cvcastro hms prepro 2 background 2 1 hec hms hec hms was created by the usace to route a runoff hydrograph through a stream network and estimate watershed discharge over time hec hms produces event based storm hydrographs used in urban drainage design floodplain mapping reservoir design land use impact studies water management and flood forecasting usace 2018 a standard hec hms project is comprised of a control specification a meteorological model and a basin model the control specification defines the time constraints of the model the meteorological model is used to simulate precipitation within the basin the basin model represents the physical watershed through elements such as stream reaches subbasins and junctions that are connected hydrologically the basin model also contains information about the mathematical processes to be simulated by hec hms usace 2018 hms prepro was designed to initialize the basin model component of a hec hms project by extracting physical datasets from the web service and estimating parameters for various hydrological processes once the basin component has been initialized through gis the user may start the process of applying rainfall conditions and calibrating the model within hec hms usace 2018 in hec hms the basin model is usually created through an interconnected graphical user interface gui as shown in fig 1 each watershed element is drawn as an icon and the user must specify individual hydrological methods and calculate parameter values for every component as the complexity of the model increases so does the time associated with interface management when a basin model is saved in hec hms a description of each hydrologic element is created and summarized in an output ascii text file the output file is saved with a basin extension and contains information about each element name spatial location connectivity and hydrological association the user may edit the text file and changes will be reflected in the hec hms interface usace 2018 instead of manually creating the basin model through a gui hms prepro automatically populates a basin file with gis derived watershed data in a format that may be directly read by hec hms 2 2 hec geohms hec geohms was a preprocessing tool developed to use geospatial information provided by the user to initialize a hec hms model more expediently than manual methods usace 2010 hec geohms built on early efforts of incorporating gis capabilities into standard hydrologic modeling agrawal 2005 hellweger and maidment 1999 maidment ed 2002 olivera et al 2003 usace 1980 for example crwr prepro linked gis and hydrologic modeling by delineating the stream network and building the basic structure of a watershed model from digital terrain data hellweger and maidment 1999 archydro was then created to store and process the geographic data such that hydrologic characteristics may be derived and related to one another according to a stream threshold and geodatabases maidment ed 2002 these concepts were combined by esri and the usace into hec geohms to aid hydrological modelers with semi automated spatial analysis usace 2003 basic execution of the toolkit requires numerous geospatial operations thus motivating a transition of gis capabilities directly within the primary hec hms modeling platform usace 2020 table 1 lists the minimum geospatial operations initiated by the authors to produce a successful hec hms basin model using the traditional hec geohms toolbar the processing steps in table 1 were conducted after comprehensive geospatial datasets were downloaded merged and prepared by the user in an acceptable format usace 2010 moreover many of the parameters included in hec geohms were populated separately as a grid layer or feature attribute before using the toolkit thus extending the time required by the user to develop an initial basin model chapter 10 usace 2010 the amount of data management and geospatial processing involved prior to watershed delineation and parameterization is substantial and may pose user difficulties 2 3 streamlined preprocessing gis systems have integrated with hydrological modeling due to the inherent spatial nature of watershed phenomena singh and fiorentino eds 2013 the development of gis based preprocessors enabled the creation of watershed and stream networks and the computation of their physical properties using geospatial layers early hydrological gis frameworks included archydro which established the use of geodatabases for relating watershed data olivera et al 2003 and crwr prepro which highlighted the strengths of grid based terrain analysis hellweger and maidment 1999 by using gis spatial sciences to assign location as a key variable these tools streamlined watershed delineation and alleviated the need to average parameters over an entire watershed which has now become commonplace in water resources olivera et al 2006 building on the work of others hms prepro emphasizes a next major trajectory in hydrological preprocessing by demonstrating how gis technology has evolved beyond the use of standard databases assembled from various sources instead geospatial data may be embedded directly into the framework of hydrologic modeling for synchronized and automated workflows similar to the use of geodatabases in archydro web based data services combine location into a common denominator and connect distinct sets of information for improved geospatial analysis the use of gis in watershed modeling may be described by the progression of key steps outlined in table 2 steps 1 and 2 include the necessary data gathering management and processing required for all hydrological modeling applications such steps are just beginning to be modernized by coupling comprehensive data services with gis operations terrain analysis is then performed to describe the drainage patterns over a basin according to a digital representation of the land surface usace 2010 watershed delineation and topological connectivity define the basic hydrologic structure of the model once the watershed network has been defined physical properties may be extracted from the data to estimate hydrological parameters the watershed structure and basin properties are summarized in a unique format for use in a specific hydrologic modeling software steps 1 through 5 are generic in nature and are common in gis based hydrological modeling workflows step 6 converts the geospatial results into a model specific format for hydrological modeling outside the gis platform for example hec geohms converts geospatial data into hec hms format usace 2003 agwa preprocesses data for swat modeling miller et al 2007 and basins integrates watershed data for use in environmental applications epa 2001 each of these preprocessors performs the general gis based steps involved in hydrological modeling steps 1 5 and then converts outputs into a software specific application step 6 traditionally the key steps described in table 2 are executed as distinct workflows while building on the preceding functions hms prepro synchronizes these interrelated stages to increase model reproducibility and to minimize potential user errors from manual geoprocessing procedures while hms prepro produces an output file specific to hec hms software the tool may be used to aid modelers that work with alternative programs by streamlining the typical operations involved in hydrological preprocessing specifically modelers may use hms prepro to extract datasets describing the physical conditions of a watershed delineate a stream network and estimate common hydrological parameters that will be appended to gis feature class attributes on the user s computer such information will aid hydrological preprocessing for purposes of gathering an initial watershed network and setting up a basin model prior to detailed calibration efforts irrespective of the final simulation software employed by the user hms prepro streamlines steps 1 and 2 by connecting to the esri living atlas and extracting pertinent datasets from the server according to a user defined watershed boundary extent the data on the living atlas is provided in a ready to use and seamless gis format which is then automatically organized into a single geodatabase on the user s local computer in steps 3 and 4 gis operations are automated in rapid succession to process the terrain and estimate drainage patterns for watershed delineation hms prepro assigns topological connections to the watershed network through a hydrologic identifier similar to the methodology used in archydro olivera et al 2003 in step 5 hms prepro estimates hydrological parameters for the watershed network according to the methodologies chosen by the user in step 6 hms prepro processes the data from the preceding operations and produces an output text file containing basin model information for consumption by the hec hms modeling software section 4 0 includes further details describing how hms prepro streamlines the gis phases that are common in hydrological modeling 3 the living atlas the living atlas of the world is a centralized data service curated by esri that provides users with a plethora of seamless datasets directly within arcgis from authoritative agencies and community organizations esria 2018 a sampling of data types available in the living atlas include earth observations demographics multispectral imagery infrastructure environmental impacts natural hazards urban systems ecology and much more https livingatlas arcgis com essentially anything that can be mapped within gis could be submitted to esri curators for inclusion in the living atlas provided the content is reliable and useful to the greater gis community esri 2015 when data is updated by the contributing organization esri updates the living atlas thus providing the geospatial community with on the fly and reliable datasets the living atlas may be accessed online or through the arcgis suite of products where users may explore content on the server and then extract pertinent datasets for immediate local use in gis arcgis is one of the most widely used geographical systems in hydrology however common use of this data service for hydrological modeling has not reached full potential in the hydrological sciences overland flow is dependent on the terrain land use impervious cover and soils type to quantity flow over time and to determine the direction of rainfall runoff national datasets are included in the living atlas from authoritative agencies that have been reliably used in hydrological practice for many years hms prepro connects to arcgis rest servers from the living atlas and extracts pertinent datasets according to an input watershed boundary the extracted data is placed into a local geodatabase for further analysis the minimum data types required for gis based hydrological modeling are included in table 3 usace 2010 along with the rest server urls and the hosting agencies terrain elevation is provided in the living atlas as a seamless digital model with a minimum 30 m resolution esri 2020a digital elevation data is used to estimate the average watershed slope and to calculate the time series associated with dynamic flow land use and impervious coverage is available in the living atlas from the national land cover database nlcd for 2006 2011 and 2016 esri 2020a nlcd classifications are based on 30 m landsat data and may be used to calculate various infiltration and runoff parameters usgs 2018 hydrological soils information is used to calculate subbasin losses hydrological soils groups are available from the natural resources conservation service nrcs soil survey geographic database ssurgo the living atlas hosts the hydrological soils groups ranging from sandy to clayey classifications reducing the need for manual parameterization of raw soils data from reference tables usda 2009 esri 2020a a key benefit of gathering data from the living atlas instead of directly from the applicable websites is that hosted data is provided as a seamless grid when data is provided seamlessly the user is no longer required to download information for specific cells and then mosaic and clip data to the intended extents i e manually downloading lidar elevation data for dozens of grids and merging to the watershed boundary using location as a common factor various datasets pertinent to watershed modeling may be extracted from the web and immediately used in gis applications common tasks associated with downloading spatial subsetting and processing are eliminated when users obtain operational data directly through the gis platform the use of the living atlas landscape layers in hms prepro requires an arcgis online organizational account this is different than an arcgis personal or global account and is provided through many educational institutions or companies if a user does not have an organizational account steps for creating one are included in the hms prepro user s manual the living atlas content used in hms prepro is free and does not consume any organizational credits while the goal is not to advocate for a specific commercial product the authors hope that the concept of data services embedded directly within gis programs will become commonplace in hydrological modeling with regards to widespread hydrological applications web based gis data services are still in their infancy the authors present the living atlas as a potential tool for hydrologists and a general proof of concept for how standardized map services may be used to relate datasets by location instead of compiling from various sources for enhanced workflows 4 hms prepro methodology the hms prepro toolbox contains two primary scripts namely get data and preprocess basin a third optional script is included for when the tr 55 method is selected to estimate the time of concentration the get data tool extracts terrain soils land use and impervious coverage data from the living atlas sms according to a user specified watershed boundary in the get data tool the user is required to input an arcgis organizational username and password for connection to the living atlas servers as shown in fig 2 a local output geodatabase is specified and the watershed of interest is input to spatially connect the project location with the datasets that will be extracted from the web based sms a common coordinate system is specified to integrate the datasets and perform local processing fig 3 describes the general workflow for the get data script in hms prepro the user is connected to the living atlas server and a temporary image layer is created using the arcgis make image server layer tool the make image server layer creates a layer of hosted data on the local machine for geoprocessing but the data still resides on the living atlas server the arcgis extract by mask tool is executed to clip the server based data and save the information locally therefore all operations in hms prepro are executed on the local computer aside from the initial connection to the living atlas rest server and the dataset extraction the datasets are clipped to a buffer region slightly larger than the user defined watershed boundary in order to preserve all digital pixels within the catchment area the hydrological datasets are organized in a local geodatabase on the user s computer the preprocess basin script then uses the geodatabase created by the get data tool to perform spatial analysis and initialize a hec hms basin model as shown in the fig 4 workflow schematic preprocess basin provides several user options for defining hydrologic processes and estimating watershed parameters according to methodologies outlined in this section the derived attributes are appended to feature classes within the local geodatabase an output text file is created that contains information about each watershed element in a format that may be opened by the usace hec hms software additional instruction is provided in the hms prepro user guide and technical appendix 4 1 watershed topology in gis based hydrologic modeling the landscape is represented by data that is geographically connected topology describes the spatial relationships between neighboring features such as how an upstream catchment is connected to a downstream catchment through a junction node and routing reach hydrological modeling requires topological connections as input to determine flow connectivity in hec hms each element references a unique identifier of the connecting elements and the sequence of these connections signal the continuity of flow within the model hellweger and maidment 1999 hydrologically consistent topology means that each catchment contains only one unique reach with the same identifier each element is distinguished by a unique identifier that provides connectivity information in archydro the element identifier is called the hydroid hms prepro uses relationships between subbasin and reach identifiers to determine downstream connectivity for the basin model file each subbasin is connected to the upstream node of its downstream reach which is a junction defined by the reach coordinates reaches convey flow and are therefore not included in the most upstream basin elements lists containing all subbasins and reaches are created and then hms prepro determines the subbasins that do not have a corresponding reach identified i e upstream subbasins fromnode and tonode identifying attributes derived by archydro describe the inherent junction properties and connectivity of the reach layers the node attributes are used in hms prepro to populate a field describing each downstream reach identifier 4 2 loss methods in hec hms basin models are used to represent the physical characteristics of a watershed such as infiltration runoff and flow routing rainfall runoff is simulated by applying hydrological methods and connecting basin elements in a downstream direction of the event based methods used to simulate infiltration losses hms prepro incorporates the scs curve number scs cn method and the green and ampt method the cn is used in hydrology for predicting the amount of runoff potential for a set of watershed conditions the green and ampt loss method is a simplification of the richard s equation for describing water flow and infiltration through the soil usace 2018 in hms prepro the green and ampt parameters may be provided by the user or estimated from the ssurgo soils data and an embedded lookup table a detailed workflow for the scs cn method is described in table 4 demonstrating a general proof of toolbox capabilities additional hydrological methodologies in hms prepro are mentioned briefly while the scientific details may be referenced in the technical appendix hms prepro uses sms datasets and gis operations to rapidly create a cn grid while minimizing intermediate user steps as shown in the fig 5 workflow hms prepro executes the cn steps internally while requiring only a watershed input boundary from the user a cn lookup table is embedded within hms prepro and populated according to the urban hydrology for small watersheds tr 55 usda guidelines usda 1986 as shown in table 5 hms prepro automatically executes gis operations to connect the cn lookup table with the merged soils land use data and the watershed catchments an example of automated cn output layers derived by hms prepro is shown in fig 6 the nlcd land use values are extracted from the living atlas service and reclassified into ten categories that correspond with the scs cn lookup table table 5 the ssurgo hydrological soils group data is also downloaded from the living atlas server and automatically appended with the reclassified land use data the merged soils and land use layers are referenced to a lookup table to estimate the individual cn in each raster pixel the individual curve numbers are converted to a composite curve number according to a weighted spatial average for each subbasin boundary the amount of impervious cover in each subbasin is extracted from the nlcd datasets for values of 1 100 and appended to the subbasin layer when impervious coverage is used in hec hms the impervious percentage of land is assumed to have no losses and the cn is only applied to the remaining portion of each catchment drainage area usace 2018 4 3 transformation methods in hydrologic modeling the amount of precipitation excess is transformed into surface runoff hec hms has several transform methods available including basic unit hydrograph methods and quasi distributed methods that require the use of gridded meteorological data usace 2018 hms prepro provides options for using the three non gridded transform methods in hec hms scs unit hydrograph clark unit hydrograph and the snyder unit hydrograph the scs unit hydrograph method also known as the nrcs dimensionless unit hydrograph method is based on average unit hydrographs from geographic rainfall distributions in hec hms the scs unit hydrograph may be approximated for each lumped subbasin according to the lag time the lag time represents the interval between the moment rainfall runoff begins until the peak of the hydrograph is reached usda 2010 hms prepro may be used to calculate the lag time according to the cn lag method or the tr 55 lag method as described in the scs national engineering handbook usda 2010 the cn lag time is a simple calculation based on the curve number and slope of each subbasin the tr 55 method is more complicated and involves splitting the longest flowpath of each basin into regions of shallow concentrated flow overland flow and channelized flow values for the longest flowpath land cover soils type and catchment slope are spatially derived from the hydrological data extracted by hms prepro in the tr 55 method user defined input values are required for proper tool execution according to local channel properties i e manning s roughness coefficient channel shape wetted perimeter transition location from overland flow to shallow concentrated flow reference the user guide for further instruction regarding the tr 55 script tool the clark loss model derives a unit hydrograph by combining a translation hydrograph and a linear reservoir in hec hms the translation hydrograph is represented by a synthetic time area curve and the time of concentration tc for each subbasin the linear reservoir is represented by the storage coefficient r to describe the storage effects in the subbasin scharffenberg et al 2003 in hms prepro the nlcd land cover raster is used to estimate the percent land developed dlu for each subbasin through a zonal statistics analysis the land cover data is reclassified according to the estimated development within each nlcd classification the dlu is then used to estimate the on site detention percentage of channel improvements and percentage of channel conveyance values according to the assumption that development causes an increase in channel improvements and a decrease in local detention and channel conveyance additional values required for deriving clark parameters include the watershed slope longest flowpath length to basin centroid and channel slope such values are automatically calculated in hms prepro using arcgis geoprocessing operations described further in the hms prepro technical appendix tc and r may be rapidly estimated for initial model set up and then carefully calibrated by the user according to historical events and available data the snyder method estimates stormwater hydrographs in ungauged watersheds chow et al 1988 hec hms uses an iterative procedure to derive hydrograph parameters based on the subbasin area lag time and peaking coefficient in hms prepro the snyder peaking coefficients and steepness coefficients are provided by the user and additional parameters i e drainage area lag time are calculated using spatial analysis detailed background information regarding the unit hydrograph methodologies and user instructions are provided as a technical appendix at https github com cvcastro hms prepro 5 tool application and results a case study was conducted to analyze the capabilities of hms prepro in initializing hydrological basin models from data services in comparison to the standard hec geohms toolbar three watersheds of varying sizes were used to showcase the different hydrological methodologies available in hms prepro as noted in table 6 by comparing results to the established hec geohms tool this analysis confirms the capability of hms prepro in deriving basin topology and estimating hydrologic parameters directly from web based data services the watersheds used in this analysis are located in texas usa and range in size from approximately 15 to 50 square miles the hms prepro get data script tool was used to obtain hydrological and landscape datasets for the watersheds the watershed boundaries were used to relate spatial datasets in hms prepro once the data was automatically downloaded and processed on a central geodatabase the preprocess basin tool was executed to estimate catchment parameters and create a basin output file for hec hms modeling the hec geohms steps in table 2 were then executed in succession to initialize a basin file for comparison datasets for hec geohms were manually downloaded merged processed and projected from a variety of authoritative websites as referenced in table 3 the basin files produced by hms prepro and hec geohms were opened in hec hms version 4 3 and simulated with a hypothetical storm event to analyze similarities in the output hydrographs the computational time differences between the two tools are shown in table 7 the manual time associated with gathering data from authoritative sources and pre processing the datasets ranged from approximately 3 5 hours for each watershed the time spent gathering data can vary tremendously depending on internet speed computer resources location specific data providers formatting and gis expertise i e mosaicing tiled layers data management best practices as shown in table 7 the time differences associated with gathering data and executing gis functions to preprocess a basin file were substantial hms prepro was able to process the input datasets to derive a watershed network and estimate hydrological parameters in approximately 20 seconds while sequential execution of the numerous operations in hec geohms required over 40 minutes all computations were performed with arcgis 10 7 1 on a desktop computer with 10 gb ram memory 64 bit operating system and 3 4 ghz 4 core central processing unit which are average system requirements for running arcgis esri 2020b local internet connectivity was approximately 90 mbps download speed as shown in fig 7 both hms prepro and hec geohms derived identical watershed networks from the terrain while hms prepro required less user interaction and preliminary data gathering a stream threshold of 1000 grid cells was applied to a 30 m dem for the model derivations in both hms prepro and hec geohms the longest flowpath operation was the most time consuming component geometry attributes topology connections and coordinates were derived by both gis tools and appended to the basin files since hec geohms does not contain automated functions for deriving the percent impervious area green ampt parameters or the cn grid datasets derived from hms prepro were used as inputs for the subbasin parameters from raster feature and generate cn grid tools in hec geohms in a standard hec geohms project the user would be expected to derive such layers manually prior to running the tool thus increasing the total execution time similarly hec geohms does not contain functions for deriving or appending the snyder or clark unit hydrograph parameters at all these parameter estimations were added to hec hms manually for the hec geohms basins the user would need to derive the unit hydrograph parameters in arcgis outside of hec geohms in a standard watershed project hms prepro provides various added benefits compared with hec geohms including linking the user with seamless data faster execution times less user interaction and the ability to estimate several common parameters the resulting basin files for hms prepro and hec geohms were simulated in hec hms for a hypothetical control period from january 1 2020 to january 3 2020 using a uniform scs type 3 rainfall distribution of 5 inches the model schematics and output hydrographs are shown in fig 8 both hms prepro and hec geohms produced identical output hydrographs thus strengthening the reliability of the hms prepro results compared with the standard preprocessor for hec hms 6 limitations future work the basin file created by hms prepro may be used to initialize a hydrologic model however the user is expected to optimize and calibrate the watershed network and parameters according to expert knowledge the importance of understanding that this tool is not a complete hydrologic model itself but is a method of initializing the basin component of a hec hms project cannot be understated hms prepro is intended to expedite the development of the basin model by connecting the user with authoritative datasets and synchronizing common geospatial operations performed in hydrological modeling as mentioned in section 2 1 the user must provide the hec hms software with site specific meteorological data and control specifications for a complete hydrological model after initializing the basin using gis usace 2018 moreover the watershed parameters calculated with hms prepro are merely an estimate from input datasets and will need to be calibrated validated and updated according to local knowledge the watershed network derived by hms prepro may not result in a hydrological element at the desired spatial location if the user intends to analyze flow at a specific location for site development the terrain based delineation methods in hms prepro may automatically place a junction node upstream or downstream of the site user modification to the initial basin network is likely according to specific project conditions hms prepro was designed for compatibility with hec hms due to the widespread nature of the modeling program however a plethora of hydrological modeling software exists with each requiring a unique format for inputting geospatial data collective efforts will be required to extend the preprocessing capabilities presented in hms prepro for use in other hydrological applications maintenance of the hms prepro in its current form will also require ongoing efforts as new versions of arcgis are produced and data services are updated it is our hope that this software tool will be useful for direct applications to hec hms but will also broaden the use of data services in watershed preprocessing creating the potential for collective applications that adapt to changes in technology and needs within the hydrologic community public interchangeable and generalized standards are needed to meet the full potential of using data services in gis based hydrological modeling which is an expected direction of future research 7 conclusion as others have demonstrated we found that standardized data services provide a faster alternative to traditional hydrological modeling by bridging the gap between the end user and hydrological data standardized map data services such as the esri living atlas may be used to provide seamless data for rapid gis analyses hms prepro uses the watershed boundary as a geographic relationship for connecting distinct datasets into a hydrological catalog therefore many of the data management requirements for watershed tools are eliminated hms prepro also improves the time associated with standard hydrological preprocessing by synchronizing common gis steps and streamlining the user interface by combining gis operations into a uniform tool interface model reproducibility is improved while potential errors from manual executions are minimized a case study of three watersheds with varying sizes demonstrates the computational efficiency and accuracy of hms prepro when compared with the standard hec geohms toolbar the process of automatically and seamlessly gathering data with the hms prepro get data script ranged in time from approximately 2 5 min 15 5 min the manual time spent gathering data from various websites and mosaicing them on a local computer ranged from approximately 3 to 5 h excluding time associated with searching for and discovering pertinent sources the execution times reported in table 7 were for an expert gis user with prior knowledge of data requirements and sources of retrieval preprocessed parameters and seamless execution of the toolbar steps a novice gis user would likely require significantly more time to find extract and preprocess the data prepare the parameterization feature classes and run the geospatial operations in our experience traditional gis based hydrological preprocessing often produces numerous errors and issues with data setup resulting in a minimum of several days or even weeks for the first initialization of a successful hec hms basin model while proper calibration and validation associated with a reliable hec hms model will require advanced hydrological expertise a tool such as hms prepro may substantially improve the time associated with initial setup of the basin model file without requiring advanced and potentially cumbersome gis skills both the standard hec geohms toolbar and the hms prepro toolbox resulted in identical watershed networks and hydrological estimates thus confirming the ability of hms prepro in deriving topological connections and estimating hydrological parameters from living atlas datasets this research confirms the ability of data hosted on the living atlas to be used reliably in hydrological modeling by creating a preprocessing tool for the widely used hec hms hydrological program using a service that is already integrated within the arcgis platform the authors hope that such data services will become more accessible to end users from a variety of backgrounds moreover all data services including the living atlas have and will evolve over time content may be submitted to esri curators for inclusion in the living atlas and accessed by the greater geospatial community but widespread use of such concepts will require a collective effort by becoming more familiar with data services it is anticipated that standardized map services will become commonplace for enhancing workflows in gis based hydrological applications software availability hms prepro was developed and tested for compatibility with arcgis version 10 7 the hms prepro toolbox user s manual and technical appendix is available at https github com cvcastro hmsprepro this product requires esri arcmap 3d analyst spatial analyst archydro tools and arcgis organizational account credentials arcgis desktop background processing 64 bit is also encouraged users are encouraged to adopt and modify the hms prepro scripts for use in other hydrological software and additional versions of gis as applicable the open source python code may be edited and reproduced for personal use per the gnu general public license modified versions i e software improvements or additional versions of gis should be released back to the hydrological community for collective use it is not permissible to use this software for commercial purposes i e selling any portions of the code without first contacting the author this program is free software you can redistribute it and or modify it as long as modifications are redistributed to the general public this program is distributed in the hopes that it will be useful but without any warranty or the implied warranty of fitness for a particular purpose acknowledgements the authors would like to thank the anonymous reviewers of this manuscript for providing valuable suggestions and comments this material is based upon work supported by the national science foundation graduate research fellowship program under grant no 2013162199 any opinions findings and conclusions or recommendations expressed in this material are those of the author s and do not necessarily reflect the views of the national science foundation appendix a supplementary data the following are the supplementary data to this article multimedia component 1 multimedia component 1 multimedia component 2 multimedia component 2 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2020 104732 
26011,web based applications web services and online data and model sharing technology are becoming increasingly available to support hydrologic research this promises benefits in terms of collaboration computer platform independence and reproducibility of modeling workflows and results in this research we designed an approach that integrates hydrologic modeling web services with an online data sharing system to support web based simulation for hydrologic models we used this approach to integrate example systems as a case study to support reproducible snowmelt modeling for a test watershed in the colorado river basin usa we demonstrated that this approach enabled users to work within an online environment to create describe share discover repeat modify and analyze the modeling work this approach encourages collaboration and improves research reproducibility it can also be adopted or adapted to integrate other hydrologic modeling web services with data sharing systems for different hydrologic models keywords hydrologic modeling data sharing reproducibility web services hydroshare 1 introduction hydrologic modeling is essential as a guide to formulating strategies for water resources management or as a tool of scientific inquiry dingman 2008 however hydrologic modeling research presents a number of challenges modelers need to discover and collect data from various sources archfield et al 2015 and use it to prepare model inputs model input preparation can be time consuming and may require a substantial learning curve especially where programming is needed miles 2014 furthermore modelers may need to access high performance computing hpc resources to effectively handle large scale or complicated hydrologic model simulations kumar et al 2008 laloy and vrugt 2012 curating and sharing modeling datasets and metadata publicly is also important to improving reproducibility demir and krajewski 2013 archfield et al 2015 hutton et al 2016 essawy et al 2018 chuah et al 2020 collaboration among people from various disciplines and areas is one of the key factors in catalyzing new research findings silliman et al 2008 computer systems as infrastructure cyberinfrastructure that enable collaboration have the potential to significantly advance environmental modeling research with the development of web technologies and standards one promising direction is to provide web services or web applications to help people overcome these hydrologic modeling challenges and improve the efficiency of hydrologic modeling work there are a number of systems that help acquire or preprocess datasets as model input files for hydrologic models leonard and duffy 2013 billah et al 2016 gichamo et al 2020 for instance billah et al 2016 developed web services that help to automate the grid data pre processing workflow for preparation of model inputs for the variable infiltration capacity vic model liang et al 1996 the workflow includes the information that allows others to independently reproduce the model results and acts as a means for documenting the steps used to create model input files some systems focus on simulation using a specific hydrologic model while others couple different hydrologic models to simulate integrated hydrologic processes for example swatshare rajib et al 2016 established a collaborative environment to publish share discover and download soil and water assessment tool swat models this cyberinfrastructure also supports swat model calibration running on hpc resources and visualization of model outputs souffront alcantara et al 2019 developed a large scale streamflow prediction system and made the results available using a hydrologic modeling as a service approach hmaas this approach improves accessibility to modeling results to support decision making for developing countries that may have limited hydrologic modeling capabilities the community surface dynamics modeling system csdms peckham et al 2013 created an environment that promotes the sharing reuse and integration of open source modeling software many models in csdms are installed and maintained on its high performance cluster csdms members can access these resources and integrate them for complex model simulation in addition some systems support both model input preparation and simulation to facilitate modeling work the aware framework which is described as a tool for monitoring and forecasting available water resource in mountain environments was developed to offer online geospatial processing services and other tools to help users monitor and forecast water resources in alpine regions granell et al 2010 sun 2013 migrated an environmental decision support system from the traditional server client model to google cloud computing services with google drive holding some of the data to enable collaborative participatory modeling later recognizing the computational demands of physically based hydrologic models in a web based environment sun et al 2015 explored the use of meta models to support water quality management and decision making a similar approach was also applied to metamodeling of geological carbon sequestration sun et al 2018 these prior approaches highlight the importance of easy to use server or web based methods for collaborative and reproducible hydrologic modeling similar to those that are addressed in this paper although these web services or web applications improve the efficiency of hydrologic modeling work they do have limitations one limitation is that they may require programming to use the web services and thus be difficult to use for those without the required programming skills or knowledge another limitation is related to the reproducibility of the modeling work an essential principle in scientific research hutton et al 2016 the model input output files and the programming code for data processing and analysis are often not well curated and shared with the public stagge et al 2019 this hinders the ability for the modeling community to reproduce and verify the modeling work and reuse the results in this research our goal was to integrate hydrologic modeling web services with a data sharing system to provide web based simulation that improves the reproducibility of the modeling work and the usability of these web services we define web based simulation as the use of web technologies to develop execute and analyze simulation models with the web browser playing an active role in the modeling process either as a graphical user interface or as a container for the simulation engine byrne et al 2010 walker and chapra 2014 we sought to provide an online environment within which users can prepare model input execute the model share and analyze the results and repeat or modify the modeling work for collaboration to achieve this goal we designed an approach for system integration the general idea was to add a browser based graphical user interface gui for the modeling web services to make them easy to use without programing knowledge and to take advantage of a data sharing system that provides advanced data curation and management capability beyond existing modeling web services as a case study we used this approach to integrate two example systems hydrods and hydroshare to support web based simulation for a snowmelt model the functionality implemented was evaluated using snowmelt modeling use cases in the animas watershed within the colorado river basin usa hydrods gichamo et al 2020 is a set of web based hydrological data services that provides access to input datasets and server side data processing tools for distributed hydrologic models such as the utah energy balance ueb snow model tarboton and luce 1996 hydrods includes a python client library that makes it easy to use the hydrological data services in a python programing environment to automate data processing workflows model input and output files can be temporarily saved in the hydrods system and are then downloadable for further analysis hydroshare is a hydrologic information system and repository for sharing hydrologic data models and analysis tools tarboton et al 2014 in hydroshare the hydrologic datasets or models can be shared as resources that can be published collaborated around annotated discovered and accessed horsburgh et al 2015 aside from the data sharing functions hydroshare also provides a representational state transfer rest application programming interface api and corresponding python client library that enables other systems including web applications or apps to interact with hydroshare the primary contribution of this work is that it demonstrates how the bar for collaborative and reproducible hydrologic modeling can be lowered through facilitating and better enabling the use of web based hydrologic modeling this is achieved through gui and python notebook based web apps that serve as interfaces to web services and are underpinned by a data repository that enables users to collaborate and share their results in a reproducible way we demonstrate how the capability of data and modeling services can be extended by providing a web browser based gui that reduces the programming required for input data preparation and model simulation this can make the modeling web services available to a broader user community for those who have limited programming skills we also demonstrate how integration of modeling web services with a data sharing system can improve the accessibility of modeling work by enabling the research community to more easily discover and access modeling workflows for reuse and collaboration with these new capabilities this approach can facilitate research validation and experimentation in an online environment without using modelers local computing or data storage resources additionally this approach can be adopted or adapted to integrate other hydrologic modeling web services with data sharing systems for various hydrologic models to support reproducible modeling research in section 2 we introduce the general architecture design and the case study that uses this approach to integrate the two example systems hydrods and hydroshare in section 3 we present the case study results which describes the integration of the functionality implemented and tested for snow modeling use cases section 4 presents discussion and section 5 summary and conclusions 2 methods 2 1 general approach the purpose of the system integration presented here is to support web based simulation that 1 provides easy access through a web browser to the modeling web services 2 provides online data curation and sharing to support management and reuse of the modeling work and 3 avoids the complexity of changing existing systems to achieve system integration based on these criteria we designed a three layer web service based architecture to integrate hydrologic modeling web services with a data sharing system this architecture includes a user interface layer a data service layer and a data storage layer fig 1 the user interface layer can be a web app that provides a web browser based user interface for modelers to use the hydrologic modeling web services without programming this user interface layer web app can be hosted on web servers separate from the data service or the data storage layers and interact with them through rest apis this design decouples the user interface web app from the other two layers and avoids significant changes in the existing systems the data service layer is a system that hosts hydrologic data and modeling web services this layer can receive web requests from the user interface layer to prepare model input datasets or execute hydrologic models the hydrologic data is the general use large data and in our implementation contiguous us wide data used for model input preparation e g climate land cover and terrain input data the data is staged in this layer to enable high availability and performant data access in responding to web service requests the data storage layer is a data sharing system for storing and sharing the data specific to users modeling work this design uses the emerging functionality of data sharing systems to avoid additional software development work and provide the storage and data curation needs for systems that host hydrologic modeling web services 2 2 case study design our case study was designed to use this general approach and integrate example systems to test if the system integration can support web based simulation to improve research reproducibility and reduce the need for coding to use the modeling web services we used the three layer architecture to integrate hydroshare and hydrods and designed use cases to evaluate the application of implemented functionality for snowmelt modeling in a test watershed we chose these systems because 1 they represent the general functionality of hydrologic data and modeling web services hydrods and data sharing systems hydroshare and 2 the authors have access to both systems and are thus able to work on them for integration in the following we first provide background on these systems and then present the case study design hydrods is a system that provides web based data services to simplify model input preparation for distributed hydrologic models gichamo et al 2020 modelers can use these web services to create model input files and save the time and energy often spent collecting datasets from multiple sources and developing code to preprocess the data into required file formats for example table 1 shows the ueb model input variables and the major hydrods python client functions used to call the respective web services to prepare them the ueb model requires climate terrain and canopy datasets as model input and uses network common data form netcdf http www unidata ucar edu software netcdf as its input output file format modelers can use hydrods functions to write data processing code for input preparation hydrods datasets are processed and stored in geotiff shapefile and netcdf formats based on the functions that generate the datasets additionally hydrods data conversion functions help process ueb inputs in netcdf format the hydrods system was built using django an open source python web framework for web development https www djangoproject com fig 2 several open source libraries and software programs for processing netcdf shapefile and raster datasets were installed in hydrods such as netcdf4 python module nco zender 2008 gdal http www gdal org and taudem tarboton 1997 they were used to provide the required data management and processing capabilities additionally datasets from multiple sources for input preparation were also stored in this system including the national elevation dataset ned https www usgs gov national land cover datasets homer et al 2015 and daymet climate data thornton et al 2016 hydroshare s system architecture fig 3 is centered on several open source components heard et al 2014 the major components include django and irods http irods org django provides the functionality that was used to build the web user interface to help users manage their shared datasets or models irods is open source data management software that is used for data storage and access control aside from data sharing functionality web apps hosted on other web servers can also connect to hydroshare for example the consortium of universities for the advancement of hydrologic science inc cuahsi jupyterhub web app http jupyter cuahsi org was developed by others castronova 2016 and connected to hydroshare this web app was built with the jupyterhub software stack https jupyter org hub and configured with many scientific python libraries and tools it provides an online programming environment where researchers can load data from hydroshare and develop python code for data analysis and visualization another example platform for web apps is the hydroshare tethys apps portal https apps hydroshare org apps a system established by the hydroshare team to host multiple web apps and interact with hydroshare resources fig 3 this web portal was built using the tethys platform swain et al 2016 that includes software and development kits to simplify and reduce the programming skills needed to develop web apps for environmental data visualization analysis and modeling applications in order to enable information exchange between hydroshare and the hydroshare tethys apps portal oauth https oauth net is used to support user authentication and authorization and the hydroshare rest api python client hs restclient https github com hydroshare hs restclient is used to transfer the datasets between the two systems in our case study design we applied the three layer architecture based on the features of hydrods and hydroshare to support ueb modeling work fig 1 a tethys web app the ueb web app was developed and hosted in the hydroshare tethys apps portal and serves as the user interface layer to provide easy access to the hydrods web services hydrods is the data service layer used to prepare the model input files and execute the model hydroshare acts as the data storage layer to store and share the results created from hydrods the main activity between the ueb web app and hydrods is the transfer of user input information to hydrods for model input preparation or model simulation between hydrods and hydroshare the activity is mainly the transfer of model input output files and associated metadata for modeling work the ueb web app also interacts with hydroshare to retrieve the metadata of shared model input files to facilitate model simulation we also chose python for our case study implementation because 1 there is significant momentum and a growing community of python development within the scientific computing community 2 both hydrods and hydroshare have available python client libraries that facilitated more rapid development and 3 the availability of open source python libraries and development tools facilitated our work we evaluated the system integration for two snowmelt modeling use cases these use cases were designed to use the web based simulation functionality to test the sensitivity of the ueb model outputs to different grid cell resolutions of the model input files the results can help modelers evaluate the tradeoffs between model performance and computational as well as data storage requirements in the first use case a user prepares model input executes the model and curates the results in hydroshare in the second use case another user discovers the shared modeling work in hydroshare and modifies the work to derive new results with different grid cell resolution and compares the snowmelt model outputs from the two use cases 3 results 3 1 system integration 3 1 1 user interface layer the ueb web app was developed as a tethys web app and hosted in the hydroshare tethys apps portal to provide a graphical user interface for the hydrods web services the hydroshare tethys apps portal hosts various web applications to support data visualization analysis and model simulation this platform was designed to lower the barrier for the development of environmental web apps and is targeted at scientists and engineers who have some scientific programming experience but not necessarily web development experience swain et al 2016 swain et al showed that compared to creating a website project from scratch using the tethys platform can reduce the need to learn multiple languages for web app development and the total number of lines of code for each web app we chose hydroshare tethys apps portal to host the ueb web app for several reasons first and in general using a web app portal decouples the user interface application from the systems that host data and hydrologic modeling web services loosely coupled systems allow changes in one system component without big changes in the other system components making them easier to maintain second tethys platform provides software development kits to simplify and reduce the coding and learning of web programming languages required for web app development the ueb web app was designed to provide three functions model input preparation model execution and job status checking users can interact with this web app to perform modeling work without writing program code to simplify access to hydrods fig 4 a shows the user interface for model input preparation this has two main sections the user input form section on the left and the map view section in the center the user input form section allows the user to enter settings to create a complete model input package for model simulation the map view section helps the user draw a bounding box and optionally an outlet point to specify the modeling domain if just a bounding box is provided the entire bounding box is used as the model domain if an outlet point is provided the watershed draining to the outlet is computed within the bounding box and used as the domain the user needs to ensure that the bounding box is sufficient to contain the entire watershed draining to the outlet point after the user fills out the form and clicks on the input data preparation button the web request is sent to hydrods and a corresponding job id is returned so that the ueb web app can monitor the status of the submitted job fig 4 b shows the user interface for model execution it also has two main sections the model input information section on the left and the map view section the model input information section allows the user to select a model input package stored in hydroshare when the user selects a model input package its corresponding metadata is retrieved from hydroshare and shown in this section furthermore if the metadata includes the bounding box and outlet point information for the modeled domain it will be automatically shown on the map to orient the user geographically after the user clicks on the submit model execution button the web request is sent to hydrods and the corresponding job id is returned so that the ueb web app can monitor the job status fig 5 shows the job status checking user interface where the status of submitted model input preparation or model simulation jobs is shown when the job is completed successfully the user is provided with a link to the resource in hydroshare that stores the model input package in the green frame or model output files in the red frame if the job fails the user will be provided with detailed error information in the yellow frame the ueb web app was built based on tethys which by default includes a narrow left panel and a wide right panel in the main app section we designed the app to display a map in the main app section and parameter entry form with control buttons on the left menu bars at the top were used to switch between steps in the designed use of the app which can provide the user with guidance on the functionality of each page implementing this design required customizing the default hypertext markup language html and cascading style sheets css script provided by tethys the user input forms in the left panel were implemented using bootstrap an open source front end web framework http getbootstrap com and the template gizmos api http docs tethysplatform org en latest tethys sdk gizmos html from the tethys software development kit the map view in the right panel was implemented using the google maps javascript api https developers google com maps additionally the hydroshare rest api python client was used to manage all the interactions between the user interface layer and the data storage layer for example the metadata for existing model input packages from hydroshare can be retrieved using the python client and displayed on the model execution interface we also created a resource for the ueb web app in hydroshare gan et al 2020 this resource stores the metadata information of the ueb web app and helps users to discover and launch the web app through hydroshare for hydrologic modeling research 3 1 2 data service layer to support the work described in this paper we implemented new web services and job submission capability in the hydrods system which were used by the ueb web app for model input preparation model simulation and job status checking this was an extension of the original design for the hydrods web services gichamo et al 2020 which required users to make multiple web requests to process various datasets for input preparation table 1 it is inefficient for the ueb web app to send multiple web requests to hydrods and periodically check for completion thus we used the existing data processing functionality in hydrods and implemented a new web service for model input preparation which enables the user to click on the input data preparation button in the ueb web app to submit a single web request to hydrods to accomplish the work fig 6 a shows the detailed tasks done by this new web service it first creates a complete ueb model input package that includes both the input data files and the model parameter files then it generates a python file to document the details of how the model input package can be created using the hydrods python client finally it transfers all of the files and associated metadata to hydroshare in this web service the python script created was designed to provide input preparation details instead of hiding the processing work behind the scenes as a black box to users this design ensures that novices can view and learn from the syntax of the python script using it as an example to learn how to use hydrods web services and create input preparation workflows for other hydrologic models it also focuses on another major target user group for this system i e modelers who want better tools to make their work easier but who still want to know the coding details of the research for both types of users this python script can be reused to reproduce or derive new model input for the ueb model we also implemented a new web service that is called when the user clicks on the submit model execution button in the ueb web app to make a single web request to hydrods for model simulation fig 6 b presents the specific tasks accomplished by this web service it first downloads the model input package from hydroshare into hydrods then it validates the model input package to check if there are missing files required for executing the model if the validation is successful hydrods executes the ueb model and then transfers the model output files and stores them with the model input package in hydroshare to support data transfer between the data service and data storage layers the hydroshare rest api python client hs restclient was used for reading and writing files and metadata to and from hydroshare in order to improve the user experience by supporting job status checking and display in the ueb web app we also added job submission capability for the two new web services when users make web requests to hydrods via the ueb web app the web service responds with a job id and the model input preparation or model execution process can be accomplished asynchronously so that users are able to check the job status any time after the job submission fig 7 in hydrods a database was created to store information for the submitted jobs when a job is initiated the job id and associated metadata are stored in the database e g job creation date job creator and job status after the job is launched and completed the job status is updated web services for querying the job status from hydrods were also implemented and were used by the ueb web app to get the job details and present them on the user interface 3 1 3 data storage layer in hydroshare we chose the model instance resource type morsy et al 2017 to support curation and sharing of the data files and metadata generated by hydrods this resource type was specifically designed to support the collaborative sharing of model input output files and their associated metadata which best suits our requirement to improve reproducibility of hydrologic modeling research fig 8 for example users can store model input output files in a hydroshare model instance resource and describe them with predefined resource level metadata as well as user defined key value pair metadata this can help others discover and access the model instance with enough information for reuse users can also manage the resource access control so that it can be kept as private and accessed only by trusted users to prepare and edit the contents or it can be shared to the public so that anyone can discover and reuse it for validation or deriving new results in addition users can formally publish their modeling work in hydroshare to get a digital object identifier doi and formal citation information this encourages proper citation of the shared work when the ueb web app is used for model input preparation a new model instance resource is created in hydroshare to store the model input package the information entered in the user input form of the ueb web app is stored as user defined resource metadata in hydroshare which saves users from manual metadata editing work to provide detailed information about the input package when the ueb web app is used for model simulation the model instance resource is downloaded from hydroshare into hydrods for execution and the resulting model output files are sent back to the corresponding model instance resource in hydroshare in the case where a user submits a model simulation job but deletes the model instance resource before the job completes a new model instance resource is created that includes model input package and output files after the model simulation the user can run the simulation to generate model output multiple times with all the results stored in the same resource additionally other users can use the resource copy function in hydroshare to duplicate the model instance resource as their own new resource to repeat or build on the modeling work in addition to using the model instance resource for data curation and sharing we also used the cuahsi jupyterhub web app for post modeling analysis and to demonstrate reuse of a shared model instance this web app provides an online programming environment that supports the development and execution of program code from a jupyter notebook file the benefit of using this web app is that users do not need to download the modeling work and install software on their local computers instead the model instance resource can be directly retrieved from hydroshare into this web app for reuse working in cuahsi jupyterhub web app does require use of the python programming language for post modeling analysis however python is widely used in scientific research and is in our experience relatively easy for modelers to understand especially in a jupyter notebook context where code snippets are short can be explained by accompanying text information and can serve as a gentle programming and scripting entry point for users who have background with other programming languages or who are new to these concepts users can develop and execute python code in a jupyter notebook file to visualize or analyze the model input output datasets fig 9 other users can also use this web app and the python script from the model instance resource to repeat or modify the model input preparation workflow to validate the existing model input package or generate a new model input package fig 10 this provides another option for model input preparation which is more scripted but less graphical user interface friendly than the ueb web app 3 2 snowmelt modeling we used the animas watershed in the colorado river basin fig 11 as the study area to implement our two use cases for model input preparation then simulation of snowmelt for water year 2010 this served to validate the implemented functionality and test if the system integration can provide web based simulation to support hydrologic modeling in the first use case the ueb web app was used to prepare the model input package execute the model and then have all the results automatically copied into a hydroshare resource fig 4 and table 2 show the interfaces and detailed settings information that were used in the ueb web app for model input preparation and model simulation for the animas watershed fig 5 shows the job status of the corresponding results the green frame is the status for model input preparation and the red frame for model simulation fig 8 is the resource landing page for the model instance resource gan 2019 which was created to store the model input output files the associated metadata and the python script of the input preparation workflow for the first use case the second use case demonstrated collaboration and showed how the modeling work created in the first use case could be discovered modified and reused to derive new findings assume that the user who prepared the model in the first use case was user 1 and the user who collaborated and reused the model was user 2 the first author of this paper actually acted as both users with separate hydroshare accounts to prepare this illustration the second use case included the following steps first user 2 discovered and got access to the model instance resource created by user 1 second user 2 retrieved the resource into the cuahsi jupyterhub web app which was used by user 2 to modify the python script from the model input package of the first use case to create a new model input package and store it in a new model instance resource in hydroshare third the ueb web app was used by user 2 to execute the model with the new model instance resource finally the cuahsi jupyterhub web app was used by user 2 to develop python code in a jupyter notebook to compare the model outputs from the two use cases fig 12 shows the discovery page in hydroshare where the model instance resource created in the first use case can be discovered in hydroshare users can search for resources with text or geolocation information and filter the listed results with different facets e g authors or keywords to find the needed content the python script loaded into a cell in a jupyter notebook within the cuahsi jupyterhub web app is shown in fig 10 this python script is from the model instance resource of the first use case created by user 1 and documents the workflow of model input preparation for creating the climate forcing datasets and parameter files fig 10 highlights where user 2 modified the python script and changed the model resolution from 1200 m to 600 m a model configuration change being tested by user 2 in the second use case reuse of a model previously established this modification was designed to test the sensitivity of the model to grid cell resolution and determine whether different resolutions lead to different snow outputs after the modification the jupyter notebook file was used by user 2 to execute the script and to create a new model instance resource in hydroshare to store the results which includes the modified python script and the new model input package gan 2019 after the new model instance resource was created the ueb web app was used by user 2 to execute the model to create the model output files which were automatically stored in the same resource finally the cuahsi jupyterhub web app was used by user 2 to retrieve the two resources from hydroshare and to develop data visualization code fig 9 to compare the snow output from the two use cases it was found that in the animas watershed the comparison of 600 m versus 1200 m grid cell resolutions resulted in only very small differences in the model output for snow water equivalent and total surface water input fig 13 and fig 14 this is mainly because the spatial variability of the terrain and canopy input for the ueb model at the two grid cell resolutions only has small differences which leads to similar performance for the snowmelt results any user can also test with higher grid cell resolutions e g 100m or 300m and compare the model outputs this sensitivity test is useful because ueb modelers may choose a coarser cell resolution for model simulation to decrease the simulation time and the size of input and output datasets if there is no significant difference for the snowmelt output in addition users may also reuse the first use case to conduct model experiments for parameter sensitivity analysis and find out the relationship between different parameter settings and model performance the modeling and analysis process can be conducted using the web based simulation without using the local computing and storage resources the corresponding results for model experiments can be directly curated and shared with others for validation or reuse 4 discussion this case study demonstrated that after using the three layer web service based architecture to integrate example systems users were able to develop share and reuse modeling work in an online environment by interacting with hydroshare and hydroshare apps fig 15 the ueb web app helped to prepare the model input and execute the model through a graphical web user interface the model instance resource in hydroshare was used to curate and share the modeling results as well as the associated metadata which enabled others to discover and access them the cuahsi jupyterhub web app also provided a web based tool with which users can modify the work and analyze the results without using data storage or computing resources on their own local computers we also compared three ways to accomplish the same tasks involved in the snow modeling use cases 1 conducting research without hydrods web services 2 conducting research with hydrods before system integration and 3 conducting research with hydrods after system integration table 3 the first option represents how modelers are doing modeling research now the second option represents the use of modeling web services to simplify the work involved in the first option which might still be difficult in a real application because of the requirement for learning and writing program code the third option represents a new way of using the modeling web services which provides a graphical user interface to lower the requirement of programming and the functionality to support data curation and sharing this comparison allowed us to evaluate whether the system integration could accomplish the modeling work with less need for coding and fewer manual operations or data transitions among different environments we found that the system integration provided benefits in several aspects first the system integration lowered the requirement for writing python script to interact with hydrods web services the ueb web app only requires knowledge of the ueb model which allows users to overcome the programming barrier saving the time required to write python code additionally the python script created by hydrods to document the input preparation workflow also helps users learn and use the web services from example code second the system integration simplifies data curation and management efforts the data files metadata and python script are automatically curated in the data sharing system hydroshare without manually moving the files among different environments hydrods local computer and hydroshare a process that can be error prone with potential for information loss this automatic data transfer capability can encourage the preparation and sharing of modeling work rather that retaining it only on local computers this also supports collaboration and makes it easier to comply with open data mandates and document reproducibility third the system integration can simplify the way for others to validate reproducibility of the modeling work and reuse or extend it for their own work users can use the ueb web app and the cuahsi jupyterhub web app to repeat or modify the modeling work without downloading the files to their local computers or configuring their local environments for model execution or data analysis while this work has shown that the framework of a user interface layer data service layer and data storage layer can facilitate web based collaborative and reproducible hydrologic modeling there are opportunities for further work to address limitations and improve the current functionality for example the post modeling analysis still requires coding for data visualization and analysis thus new capabilities could be added in the ueb web app to support visualization and analysis of the model input output datasets through a gui e g visualization of the watershed delineation result additionally new capabilities for scenario generation and management could be implemented in the ueb web app to for example better support scenario analysis for hydrologic modeling research such as has been implemented for other models sun 2013 as for new app capability it is important to consider the balance between what is coded in a specific gui application such as the ueb web app and provides specific functionality for users that the app developers anticipate are needed versus general purpose capability in an app such as the jupyter notebook platform that can empower users more but requires programming user driven design and active monitoring of how systems are used can provide information to help with this balance 5 conclusions in hydrologic modeling research we are starting to see the availability of more and more hydrologic modeling web services that enable users to write code and make their work more efficient however limitations still exist in real application of such services in terms of their usability and the reproducibility of the modeling work users need to learn and write code to utilize these web services which may be a barrier for those with limited programming skills in addition a good mechanism is needed for curation and sharing of not only the data and metadata but also the script of the modeling work which can improve the research reproducibility and encourage collaborations around them in this paper we presented an approach that uses a three layer restful web service based architecture to integrate open source software to enable web based simulation to support hydrologic modeling research as an example we integrated the hydrods hydrologic data and modeling web services with a data sharing system hydroshare and tested the implemented functionality with use cases of snowmelt modeling for the animas watershed in the colorado river basin the results demonstrated that the system integration enabled users to work within an online environment to create describe share discover modify and analyze the modeling work which encourages collaboration around the hydrologic modeling research and significantly reduces the need for coding and manual operation for data transfer and model configuration this approach has the advantage of reusing open source software to support hydrologic modeling research in terms of collaboration computer platform independence and reproducibility of modeling workflows and results in addition the general design of the three layer web service based architecture can be adopted or adapted to other open source data sharing and modeling software furthermore other modeling web services can be integrated with a data sharing system such as hydroshare using the methods we described to support automated data curation and post modeling analysis without repeating development of similar functionality while we used hydroshare for our work other data sharing systems could also be used we found that the following data sharing system features were needed to ease integration with other cyberinfrastructure and add value to them first the system should have well developed data sharing functionality and a corresponding web service api for interoperating with other systems over the internet for example hydroshare has a rest api interface and a python client for that api which helped us to develop new rest api based web services in hydrods that enable automatic data transfer between the two systems to support data curation and sharing secondly the data sharing system needs to be a platform where new functionality for interacting with the shared datasets can be added as loosely coupled components e g as web apps without requiring significant changes to the existing system for instance the hydroshare tethys apps portal established by the hydroshare team was used to host the ueb web app which provided a user interface layer to interact with hydrods and hydroshare with minimal changes in both systems in the future possible development could include a new web app that provides a graphical user interface for multiple data processing web services from hydrods this would benefit researchers by making it easier for them to reuse and combine different web services based on their needs and to prepare inputs for other hydrologic models without writing code while having the results directly curated in hydroshare given that this work is python based future work could also involve integration with wider and domain agnostic open source scientific python environments e g the pangeo software ecosystem https pangeo io finally while the work reported in this paper extended the existing hydrods services future work should examine how these types of services can be more standardized such that they become more generally usable in modeling workflows e g castronova et al 2013 qiao et al 2019 software availability the software created in this research is free and open source as part of the larger hydroshare software repository the hydroshare software repository is managed through github and is available at https github com hydroshare hydroshare the hydroshare rest api python client repository is available at https github com hydroshare hs restclient the utah energy balance ueb web app software is available in github at https github com gantian127 tethysapp ueb app a snapshot of the code for the app at the time of this writing was also published in zenodo gan et al 2020 code for the hydrods modeling web services is available at https github com ci water hydro ds funding this work was supported by the national science foundation oci 1148453 icer 1639655 declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work was supported by the national science foundation under collaborative grants oci 1148453 and icer 1639655 any opinions findings and conclusions or recommendations expressed in this material are those of the authors and do not necessarily reflect the views of the national science foundation 
26011,web based applications web services and online data and model sharing technology are becoming increasingly available to support hydrologic research this promises benefits in terms of collaboration computer platform independence and reproducibility of modeling workflows and results in this research we designed an approach that integrates hydrologic modeling web services with an online data sharing system to support web based simulation for hydrologic models we used this approach to integrate example systems as a case study to support reproducible snowmelt modeling for a test watershed in the colorado river basin usa we demonstrated that this approach enabled users to work within an online environment to create describe share discover repeat modify and analyze the modeling work this approach encourages collaboration and improves research reproducibility it can also be adopted or adapted to integrate other hydrologic modeling web services with data sharing systems for different hydrologic models keywords hydrologic modeling data sharing reproducibility web services hydroshare 1 introduction hydrologic modeling is essential as a guide to formulating strategies for water resources management or as a tool of scientific inquiry dingman 2008 however hydrologic modeling research presents a number of challenges modelers need to discover and collect data from various sources archfield et al 2015 and use it to prepare model inputs model input preparation can be time consuming and may require a substantial learning curve especially where programming is needed miles 2014 furthermore modelers may need to access high performance computing hpc resources to effectively handle large scale or complicated hydrologic model simulations kumar et al 2008 laloy and vrugt 2012 curating and sharing modeling datasets and metadata publicly is also important to improving reproducibility demir and krajewski 2013 archfield et al 2015 hutton et al 2016 essawy et al 2018 chuah et al 2020 collaboration among people from various disciplines and areas is one of the key factors in catalyzing new research findings silliman et al 2008 computer systems as infrastructure cyberinfrastructure that enable collaboration have the potential to significantly advance environmental modeling research with the development of web technologies and standards one promising direction is to provide web services or web applications to help people overcome these hydrologic modeling challenges and improve the efficiency of hydrologic modeling work there are a number of systems that help acquire or preprocess datasets as model input files for hydrologic models leonard and duffy 2013 billah et al 2016 gichamo et al 2020 for instance billah et al 2016 developed web services that help to automate the grid data pre processing workflow for preparation of model inputs for the variable infiltration capacity vic model liang et al 1996 the workflow includes the information that allows others to independently reproduce the model results and acts as a means for documenting the steps used to create model input files some systems focus on simulation using a specific hydrologic model while others couple different hydrologic models to simulate integrated hydrologic processes for example swatshare rajib et al 2016 established a collaborative environment to publish share discover and download soil and water assessment tool swat models this cyberinfrastructure also supports swat model calibration running on hpc resources and visualization of model outputs souffront alcantara et al 2019 developed a large scale streamflow prediction system and made the results available using a hydrologic modeling as a service approach hmaas this approach improves accessibility to modeling results to support decision making for developing countries that may have limited hydrologic modeling capabilities the community surface dynamics modeling system csdms peckham et al 2013 created an environment that promotes the sharing reuse and integration of open source modeling software many models in csdms are installed and maintained on its high performance cluster csdms members can access these resources and integrate them for complex model simulation in addition some systems support both model input preparation and simulation to facilitate modeling work the aware framework which is described as a tool for monitoring and forecasting available water resource in mountain environments was developed to offer online geospatial processing services and other tools to help users monitor and forecast water resources in alpine regions granell et al 2010 sun 2013 migrated an environmental decision support system from the traditional server client model to google cloud computing services with google drive holding some of the data to enable collaborative participatory modeling later recognizing the computational demands of physically based hydrologic models in a web based environment sun et al 2015 explored the use of meta models to support water quality management and decision making a similar approach was also applied to metamodeling of geological carbon sequestration sun et al 2018 these prior approaches highlight the importance of easy to use server or web based methods for collaborative and reproducible hydrologic modeling similar to those that are addressed in this paper although these web services or web applications improve the efficiency of hydrologic modeling work they do have limitations one limitation is that they may require programming to use the web services and thus be difficult to use for those without the required programming skills or knowledge another limitation is related to the reproducibility of the modeling work an essential principle in scientific research hutton et al 2016 the model input output files and the programming code for data processing and analysis are often not well curated and shared with the public stagge et al 2019 this hinders the ability for the modeling community to reproduce and verify the modeling work and reuse the results in this research our goal was to integrate hydrologic modeling web services with a data sharing system to provide web based simulation that improves the reproducibility of the modeling work and the usability of these web services we define web based simulation as the use of web technologies to develop execute and analyze simulation models with the web browser playing an active role in the modeling process either as a graphical user interface or as a container for the simulation engine byrne et al 2010 walker and chapra 2014 we sought to provide an online environment within which users can prepare model input execute the model share and analyze the results and repeat or modify the modeling work for collaboration to achieve this goal we designed an approach for system integration the general idea was to add a browser based graphical user interface gui for the modeling web services to make them easy to use without programing knowledge and to take advantage of a data sharing system that provides advanced data curation and management capability beyond existing modeling web services as a case study we used this approach to integrate two example systems hydrods and hydroshare to support web based simulation for a snowmelt model the functionality implemented was evaluated using snowmelt modeling use cases in the animas watershed within the colorado river basin usa hydrods gichamo et al 2020 is a set of web based hydrological data services that provides access to input datasets and server side data processing tools for distributed hydrologic models such as the utah energy balance ueb snow model tarboton and luce 1996 hydrods includes a python client library that makes it easy to use the hydrological data services in a python programing environment to automate data processing workflows model input and output files can be temporarily saved in the hydrods system and are then downloadable for further analysis hydroshare is a hydrologic information system and repository for sharing hydrologic data models and analysis tools tarboton et al 2014 in hydroshare the hydrologic datasets or models can be shared as resources that can be published collaborated around annotated discovered and accessed horsburgh et al 2015 aside from the data sharing functions hydroshare also provides a representational state transfer rest application programming interface api and corresponding python client library that enables other systems including web applications or apps to interact with hydroshare the primary contribution of this work is that it demonstrates how the bar for collaborative and reproducible hydrologic modeling can be lowered through facilitating and better enabling the use of web based hydrologic modeling this is achieved through gui and python notebook based web apps that serve as interfaces to web services and are underpinned by a data repository that enables users to collaborate and share their results in a reproducible way we demonstrate how the capability of data and modeling services can be extended by providing a web browser based gui that reduces the programming required for input data preparation and model simulation this can make the modeling web services available to a broader user community for those who have limited programming skills we also demonstrate how integration of modeling web services with a data sharing system can improve the accessibility of modeling work by enabling the research community to more easily discover and access modeling workflows for reuse and collaboration with these new capabilities this approach can facilitate research validation and experimentation in an online environment without using modelers local computing or data storage resources additionally this approach can be adopted or adapted to integrate other hydrologic modeling web services with data sharing systems for various hydrologic models to support reproducible modeling research in section 2 we introduce the general architecture design and the case study that uses this approach to integrate the two example systems hydrods and hydroshare in section 3 we present the case study results which describes the integration of the functionality implemented and tested for snow modeling use cases section 4 presents discussion and section 5 summary and conclusions 2 methods 2 1 general approach the purpose of the system integration presented here is to support web based simulation that 1 provides easy access through a web browser to the modeling web services 2 provides online data curation and sharing to support management and reuse of the modeling work and 3 avoids the complexity of changing existing systems to achieve system integration based on these criteria we designed a three layer web service based architecture to integrate hydrologic modeling web services with a data sharing system this architecture includes a user interface layer a data service layer and a data storage layer fig 1 the user interface layer can be a web app that provides a web browser based user interface for modelers to use the hydrologic modeling web services without programming this user interface layer web app can be hosted on web servers separate from the data service or the data storage layers and interact with them through rest apis this design decouples the user interface web app from the other two layers and avoids significant changes in the existing systems the data service layer is a system that hosts hydrologic data and modeling web services this layer can receive web requests from the user interface layer to prepare model input datasets or execute hydrologic models the hydrologic data is the general use large data and in our implementation contiguous us wide data used for model input preparation e g climate land cover and terrain input data the data is staged in this layer to enable high availability and performant data access in responding to web service requests the data storage layer is a data sharing system for storing and sharing the data specific to users modeling work this design uses the emerging functionality of data sharing systems to avoid additional software development work and provide the storage and data curation needs for systems that host hydrologic modeling web services 2 2 case study design our case study was designed to use this general approach and integrate example systems to test if the system integration can support web based simulation to improve research reproducibility and reduce the need for coding to use the modeling web services we used the three layer architecture to integrate hydroshare and hydrods and designed use cases to evaluate the application of implemented functionality for snowmelt modeling in a test watershed we chose these systems because 1 they represent the general functionality of hydrologic data and modeling web services hydrods and data sharing systems hydroshare and 2 the authors have access to both systems and are thus able to work on them for integration in the following we first provide background on these systems and then present the case study design hydrods is a system that provides web based data services to simplify model input preparation for distributed hydrologic models gichamo et al 2020 modelers can use these web services to create model input files and save the time and energy often spent collecting datasets from multiple sources and developing code to preprocess the data into required file formats for example table 1 shows the ueb model input variables and the major hydrods python client functions used to call the respective web services to prepare them the ueb model requires climate terrain and canopy datasets as model input and uses network common data form netcdf http www unidata ucar edu software netcdf as its input output file format modelers can use hydrods functions to write data processing code for input preparation hydrods datasets are processed and stored in geotiff shapefile and netcdf formats based on the functions that generate the datasets additionally hydrods data conversion functions help process ueb inputs in netcdf format the hydrods system was built using django an open source python web framework for web development https www djangoproject com fig 2 several open source libraries and software programs for processing netcdf shapefile and raster datasets were installed in hydrods such as netcdf4 python module nco zender 2008 gdal http www gdal org and taudem tarboton 1997 they were used to provide the required data management and processing capabilities additionally datasets from multiple sources for input preparation were also stored in this system including the national elevation dataset ned https www usgs gov national land cover datasets homer et al 2015 and daymet climate data thornton et al 2016 hydroshare s system architecture fig 3 is centered on several open source components heard et al 2014 the major components include django and irods http irods org django provides the functionality that was used to build the web user interface to help users manage their shared datasets or models irods is open source data management software that is used for data storage and access control aside from data sharing functionality web apps hosted on other web servers can also connect to hydroshare for example the consortium of universities for the advancement of hydrologic science inc cuahsi jupyterhub web app http jupyter cuahsi org was developed by others castronova 2016 and connected to hydroshare this web app was built with the jupyterhub software stack https jupyter org hub and configured with many scientific python libraries and tools it provides an online programming environment where researchers can load data from hydroshare and develop python code for data analysis and visualization another example platform for web apps is the hydroshare tethys apps portal https apps hydroshare org apps a system established by the hydroshare team to host multiple web apps and interact with hydroshare resources fig 3 this web portal was built using the tethys platform swain et al 2016 that includes software and development kits to simplify and reduce the programming skills needed to develop web apps for environmental data visualization analysis and modeling applications in order to enable information exchange between hydroshare and the hydroshare tethys apps portal oauth https oauth net is used to support user authentication and authorization and the hydroshare rest api python client hs restclient https github com hydroshare hs restclient is used to transfer the datasets between the two systems in our case study design we applied the three layer architecture based on the features of hydrods and hydroshare to support ueb modeling work fig 1 a tethys web app the ueb web app was developed and hosted in the hydroshare tethys apps portal and serves as the user interface layer to provide easy access to the hydrods web services hydrods is the data service layer used to prepare the model input files and execute the model hydroshare acts as the data storage layer to store and share the results created from hydrods the main activity between the ueb web app and hydrods is the transfer of user input information to hydrods for model input preparation or model simulation between hydrods and hydroshare the activity is mainly the transfer of model input output files and associated metadata for modeling work the ueb web app also interacts with hydroshare to retrieve the metadata of shared model input files to facilitate model simulation we also chose python for our case study implementation because 1 there is significant momentum and a growing community of python development within the scientific computing community 2 both hydrods and hydroshare have available python client libraries that facilitated more rapid development and 3 the availability of open source python libraries and development tools facilitated our work we evaluated the system integration for two snowmelt modeling use cases these use cases were designed to use the web based simulation functionality to test the sensitivity of the ueb model outputs to different grid cell resolutions of the model input files the results can help modelers evaluate the tradeoffs between model performance and computational as well as data storage requirements in the first use case a user prepares model input executes the model and curates the results in hydroshare in the second use case another user discovers the shared modeling work in hydroshare and modifies the work to derive new results with different grid cell resolution and compares the snowmelt model outputs from the two use cases 3 results 3 1 system integration 3 1 1 user interface layer the ueb web app was developed as a tethys web app and hosted in the hydroshare tethys apps portal to provide a graphical user interface for the hydrods web services the hydroshare tethys apps portal hosts various web applications to support data visualization analysis and model simulation this platform was designed to lower the barrier for the development of environmental web apps and is targeted at scientists and engineers who have some scientific programming experience but not necessarily web development experience swain et al 2016 swain et al showed that compared to creating a website project from scratch using the tethys platform can reduce the need to learn multiple languages for web app development and the total number of lines of code for each web app we chose hydroshare tethys apps portal to host the ueb web app for several reasons first and in general using a web app portal decouples the user interface application from the systems that host data and hydrologic modeling web services loosely coupled systems allow changes in one system component without big changes in the other system components making them easier to maintain second tethys platform provides software development kits to simplify and reduce the coding and learning of web programming languages required for web app development the ueb web app was designed to provide three functions model input preparation model execution and job status checking users can interact with this web app to perform modeling work without writing program code to simplify access to hydrods fig 4 a shows the user interface for model input preparation this has two main sections the user input form section on the left and the map view section in the center the user input form section allows the user to enter settings to create a complete model input package for model simulation the map view section helps the user draw a bounding box and optionally an outlet point to specify the modeling domain if just a bounding box is provided the entire bounding box is used as the model domain if an outlet point is provided the watershed draining to the outlet is computed within the bounding box and used as the domain the user needs to ensure that the bounding box is sufficient to contain the entire watershed draining to the outlet point after the user fills out the form and clicks on the input data preparation button the web request is sent to hydrods and a corresponding job id is returned so that the ueb web app can monitor the status of the submitted job fig 4 b shows the user interface for model execution it also has two main sections the model input information section on the left and the map view section the model input information section allows the user to select a model input package stored in hydroshare when the user selects a model input package its corresponding metadata is retrieved from hydroshare and shown in this section furthermore if the metadata includes the bounding box and outlet point information for the modeled domain it will be automatically shown on the map to orient the user geographically after the user clicks on the submit model execution button the web request is sent to hydrods and the corresponding job id is returned so that the ueb web app can monitor the job status fig 5 shows the job status checking user interface where the status of submitted model input preparation or model simulation jobs is shown when the job is completed successfully the user is provided with a link to the resource in hydroshare that stores the model input package in the green frame or model output files in the red frame if the job fails the user will be provided with detailed error information in the yellow frame the ueb web app was built based on tethys which by default includes a narrow left panel and a wide right panel in the main app section we designed the app to display a map in the main app section and parameter entry form with control buttons on the left menu bars at the top were used to switch between steps in the designed use of the app which can provide the user with guidance on the functionality of each page implementing this design required customizing the default hypertext markup language html and cascading style sheets css script provided by tethys the user input forms in the left panel were implemented using bootstrap an open source front end web framework http getbootstrap com and the template gizmos api http docs tethysplatform org en latest tethys sdk gizmos html from the tethys software development kit the map view in the right panel was implemented using the google maps javascript api https developers google com maps additionally the hydroshare rest api python client was used to manage all the interactions between the user interface layer and the data storage layer for example the metadata for existing model input packages from hydroshare can be retrieved using the python client and displayed on the model execution interface we also created a resource for the ueb web app in hydroshare gan et al 2020 this resource stores the metadata information of the ueb web app and helps users to discover and launch the web app through hydroshare for hydrologic modeling research 3 1 2 data service layer to support the work described in this paper we implemented new web services and job submission capability in the hydrods system which were used by the ueb web app for model input preparation model simulation and job status checking this was an extension of the original design for the hydrods web services gichamo et al 2020 which required users to make multiple web requests to process various datasets for input preparation table 1 it is inefficient for the ueb web app to send multiple web requests to hydrods and periodically check for completion thus we used the existing data processing functionality in hydrods and implemented a new web service for model input preparation which enables the user to click on the input data preparation button in the ueb web app to submit a single web request to hydrods to accomplish the work fig 6 a shows the detailed tasks done by this new web service it first creates a complete ueb model input package that includes both the input data files and the model parameter files then it generates a python file to document the details of how the model input package can be created using the hydrods python client finally it transfers all of the files and associated metadata to hydroshare in this web service the python script created was designed to provide input preparation details instead of hiding the processing work behind the scenes as a black box to users this design ensures that novices can view and learn from the syntax of the python script using it as an example to learn how to use hydrods web services and create input preparation workflows for other hydrologic models it also focuses on another major target user group for this system i e modelers who want better tools to make their work easier but who still want to know the coding details of the research for both types of users this python script can be reused to reproduce or derive new model input for the ueb model we also implemented a new web service that is called when the user clicks on the submit model execution button in the ueb web app to make a single web request to hydrods for model simulation fig 6 b presents the specific tasks accomplished by this web service it first downloads the model input package from hydroshare into hydrods then it validates the model input package to check if there are missing files required for executing the model if the validation is successful hydrods executes the ueb model and then transfers the model output files and stores them with the model input package in hydroshare to support data transfer between the data service and data storage layers the hydroshare rest api python client hs restclient was used for reading and writing files and metadata to and from hydroshare in order to improve the user experience by supporting job status checking and display in the ueb web app we also added job submission capability for the two new web services when users make web requests to hydrods via the ueb web app the web service responds with a job id and the model input preparation or model execution process can be accomplished asynchronously so that users are able to check the job status any time after the job submission fig 7 in hydrods a database was created to store information for the submitted jobs when a job is initiated the job id and associated metadata are stored in the database e g job creation date job creator and job status after the job is launched and completed the job status is updated web services for querying the job status from hydrods were also implemented and were used by the ueb web app to get the job details and present them on the user interface 3 1 3 data storage layer in hydroshare we chose the model instance resource type morsy et al 2017 to support curation and sharing of the data files and metadata generated by hydrods this resource type was specifically designed to support the collaborative sharing of model input output files and their associated metadata which best suits our requirement to improve reproducibility of hydrologic modeling research fig 8 for example users can store model input output files in a hydroshare model instance resource and describe them with predefined resource level metadata as well as user defined key value pair metadata this can help others discover and access the model instance with enough information for reuse users can also manage the resource access control so that it can be kept as private and accessed only by trusted users to prepare and edit the contents or it can be shared to the public so that anyone can discover and reuse it for validation or deriving new results in addition users can formally publish their modeling work in hydroshare to get a digital object identifier doi and formal citation information this encourages proper citation of the shared work when the ueb web app is used for model input preparation a new model instance resource is created in hydroshare to store the model input package the information entered in the user input form of the ueb web app is stored as user defined resource metadata in hydroshare which saves users from manual metadata editing work to provide detailed information about the input package when the ueb web app is used for model simulation the model instance resource is downloaded from hydroshare into hydrods for execution and the resulting model output files are sent back to the corresponding model instance resource in hydroshare in the case where a user submits a model simulation job but deletes the model instance resource before the job completes a new model instance resource is created that includes model input package and output files after the model simulation the user can run the simulation to generate model output multiple times with all the results stored in the same resource additionally other users can use the resource copy function in hydroshare to duplicate the model instance resource as their own new resource to repeat or build on the modeling work in addition to using the model instance resource for data curation and sharing we also used the cuahsi jupyterhub web app for post modeling analysis and to demonstrate reuse of a shared model instance this web app provides an online programming environment that supports the development and execution of program code from a jupyter notebook file the benefit of using this web app is that users do not need to download the modeling work and install software on their local computers instead the model instance resource can be directly retrieved from hydroshare into this web app for reuse working in cuahsi jupyterhub web app does require use of the python programming language for post modeling analysis however python is widely used in scientific research and is in our experience relatively easy for modelers to understand especially in a jupyter notebook context where code snippets are short can be explained by accompanying text information and can serve as a gentle programming and scripting entry point for users who have background with other programming languages or who are new to these concepts users can develop and execute python code in a jupyter notebook file to visualize or analyze the model input output datasets fig 9 other users can also use this web app and the python script from the model instance resource to repeat or modify the model input preparation workflow to validate the existing model input package or generate a new model input package fig 10 this provides another option for model input preparation which is more scripted but less graphical user interface friendly than the ueb web app 3 2 snowmelt modeling we used the animas watershed in the colorado river basin fig 11 as the study area to implement our two use cases for model input preparation then simulation of snowmelt for water year 2010 this served to validate the implemented functionality and test if the system integration can provide web based simulation to support hydrologic modeling in the first use case the ueb web app was used to prepare the model input package execute the model and then have all the results automatically copied into a hydroshare resource fig 4 and table 2 show the interfaces and detailed settings information that were used in the ueb web app for model input preparation and model simulation for the animas watershed fig 5 shows the job status of the corresponding results the green frame is the status for model input preparation and the red frame for model simulation fig 8 is the resource landing page for the model instance resource gan 2019 which was created to store the model input output files the associated metadata and the python script of the input preparation workflow for the first use case the second use case demonstrated collaboration and showed how the modeling work created in the first use case could be discovered modified and reused to derive new findings assume that the user who prepared the model in the first use case was user 1 and the user who collaborated and reused the model was user 2 the first author of this paper actually acted as both users with separate hydroshare accounts to prepare this illustration the second use case included the following steps first user 2 discovered and got access to the model instance resource created by user 1 second user 2 retrieved the resource into the cuahsi jupyterhub web app which was used by user 2 to modify the python script from the model input package of the first use case to create a new model input package and store it in a new model instance resource in hydroshare third the ueb web app was used by user 2 to execute the model with the new model instance resource finally the cuahsi jupyterhub web app was used by user 2 to develop python code in a jupyter notebook to compare the model outputs from the two use cases fig 12 shows the discovery page in hydroshare where the model instance resource created in the first use case can be discovered in hydroshare users can search for resources with text or geolocation information and filter the listed results with different facets e g authors or keywords to find the needed content the python script loaded into a cell in a jupyter notebook within the cuahsi jupyterhub web app is shown in fig 10 this python script is from the model instance resource of the first use case created by user 1 and documents the workflow of model input preparation for creating the climate forcing datasets and parameter files fig 10 highlights where user 2 modified the python script and changed the model resolution from 1200 m to 600 m a model configuration change being tested by user 2 in the second use case reuse of a model previously established this modification was designed to test the sensitivity of the model to grid cell resolution and determine whether different resolutions lead to different snow outputs after the modification the jupyter notebook file was used by user 2 to execute the script and to create a new model instance resource in hydroshare to store the results which includes the modified python script and the new model input package gan 2019 after the new model instance resource was created the ueb web app was used by user 2 to execute the model to create the model output files which were automatically stored in the same resource finally the cuahsi jupyterhub web app was used by user 2 to retrieve the two resources from hydroshare and to develop data visualization code fig 9 to compare the snow output from the two use cases it was found that in the animas watershed the comparison of 600 m versus 1200 m grid cell resolutions resulted in only very small differences in the model output for snow water equivalent and total surface water input fig 13 and fig 14 this is mainly because the spatial variability of the terrain and canopy input for the ueb model at the two grid cell resolutions only has small differences which leads to similar performance for the snowmelt results any user can also test with higher grid cell resolutions e g 100m or 300m and compare the model outputs this sensitivity test is useful because ueb modelers may choose a coarser cell resolution for model simulation to decrease the simulation time and the size of input and output datasets if there is no significant difference for the snowmelt output in addition users may also reuse the first use case to conduct model experiments for parameter sensitivity analysis and find out the relationship between different parameter settings and model performance the modeling and analysis process can be conducted using the web based simulation without using the local computing and storage resources the corresponding results for model experiments can be directly curated and shared with others for validation or reuse 4 discussion this case study demonstrated that after using the three layer web service based architecture to integrate example systems users were able to develop share and reuse modeling work in an online environment by interacting with hydroshare and hydroshare apps fig 15 the ueb web app helped to prepare the model input and execute the model through a graphical web user interface the model instance resource in hydroshare was used to curate and share the modeling results as well as the associated metadata which enabled others to discover and access them the cuahsi jupyterhub web app also provided a web based tool with which users can modify the work and analyze the results without using data storage or computing resources on their own local computers we also compared three ways to accomplish the same tasks involved in the snow modeling use cases 1 conducting research without hydrods web services 2 conducting research with hydrods before system integration and 3 conducting research with hydrods after system integration table 3 the first option represents how modelers are doing modeling research now the second option represents the use of modeling web services to simplify the work involved in the first option which might still be difficult in a real application because of the requirement for learning and writing program code the third option represents a new way of using the modeling web services which provides a graphical user interface to lower the requirement of programming and the functionality to support data curation and sharing this comparison allowed us to evaluate whether the system integration could accomplish the modeling work with less need for coding and fewer manual operations or data transitions among different environments we found that the system integration provided benefits in several aspects first the system integration lowered the requirement for writing python script to interact with hydrods web services the ueb web app only requires knowledge of the ueb model which allows users to overcome the programming barrier saving the time required to write python code additionally the python script created by hydrods to document the input preparation workflow also helps users learn and use the web services from example code second the system integration simplifies data curation and management efforts the data files metadata and python script are automatically curated in the data sharing system hydroshare without manually moving the files among different environments hydrods local computer and hydroshare a process that can be error prone with potential for information loss this automatic data transfer capability can encourage the preparation and sharing of modeling work rather that retaining it only on local computers this also supports collaboration and makes it easier to comply with open data mandates and document reproducibility third the system integration can simplify the way for others to validate reproducibility of the modeling work and reuse or extend it for their own work users can use the ueb web app and the cuahsi jupyterhub web app to repeat or modify the modeling work without downloading the files to their local computers or configuring their local environments for model execution or data analysis while this work has shown that the framework of a user interface layer data service layer and data storage layer can facilitate web based collaborative and reproducible hydrologic modeling there are opportunities for further work to address limitations and improve the current functionality for example the post modeling analysis still requires coding for data visualization and analysis thus new capabilities could be added in the ueb web app to support visualization and analysis of the model input output datasets through a gui e g visualization of the watershed delineation result additionally new capabilities for scenario generation and management could be implemented in the ueb web app to for example better support scenario analysis for hydrologic modeling research such as has been implemented for other models sun 2013 as for new app capability it is important to consider the balance between what is coded in a specific gui application such as the ueb web app and provides specific functionality for users that the app developers anticipate are needed versus general purpose capability in an app such as the jupyter notebook platform that can empower users more but requires programming user driven design and active monitoring of how systems are used can provide information to help with this balance 5 conclusions in hydrologic modeling research we are starting to see the availability of more and more hydrologic modeling web services that enable users to write code and make their work more efficient however limitations still exist in real application of such services in terms of their usability and the reproducibility of the modeling work users need to learn and write code to utilize these web services which may be a barrier for those with limited programming skills in addition a good mechanism is needed for curation and sharing of not only the data and metadata but also the script of the modeling work which can improve the research reproducibility and encourage collaborations around them in this paper we presented an approach that uses a three layer restful web service based architecture to integrate open source software to enable web based simulation to support hydrologic modeling research as an example we integrated the hydrods hydrologic data and modeling web services with a data sharing system hydroshare and tested the implemented functionality with use cases of snowmelt modeling for the animas watershed in the colorado river basin the results demonstrated that the system integration enabled users to work within an online environment to create describe share discover modify and analyze the modeling work which encourages collaboration around the hydrologic modeling research and significantly reduces the need for coding and manual operation for data transfer and model configuration this approach has the advantage of reusing open source software to support hydrologic modeling research in terms of collaboration computer platform independence and reproducibility of modeling workflows and results in addition the general design of the three layer web service based architecture can be adopted or adapted to other open source data sharing and modeling software furthermore other modeling web services can be integrated with a data sharing system such as hydroshare using the methods we described to support automated data curation and post modeling analysis without repeating development of similar functionality while we used hydroshare for our work other data sharing systems could also be used we found that the following data sharing system features were needed to ease integration with other cyberinfrastructure and add value to them first the system should have well developed data sharing functionality and a corresponding web service api for interoperating with other systems over the internet for example hydroshare has a rest api interface and a python client for that api which helped us to develop new rest api based web services in hydrods that enable automatic data transfer between the two systems to support data curation and sharing secondly the data sharing system needs to be a platform where new functionality for interacting with the shared datasets can be added as loosely coupled components e g as web apps without requiring significant changes to the existing system for instance the hydroshare tethys apps portal established by the hydroshare team was used to host the ueb web app which provided a user interface layer to interact with hydrods and hydroshare with minimal changes in both systems in the future possible development could include a new web app that provides a graphical user interface for multiple data processing web services from hydrods this would benefit researchers by making it easier for them to reuse and combine different web services based on their needs and to prepare inputs for other hydrologic models without writing code while having the results directly curated in hydroshare given that this work is python based future work could also involve integration with wider and domain agnostic open source scientific python environments e g the pangeo software ecosystem https pangeo io finally while the work reported in this paper extended the existing hydrods services future work should examine how these types of services can be more standardized such that they become more generally usable in modeling workflows e g castronova et al 2013 qiao et al 2019 software availability the software created in this research is free and open source as part of the larger hydroshare software repository the hydroshare software repository is managed through github and is available at https github com hydroshare hydroshare the hydroshare rest api python client repository is available at https github com hydroshare hs restclient the utah energy balance ueb web app software is available in github at https github com gantian127 tethysapp ueb app a snapshot of the code for the app at the time of this writing was also published in zenodo gan et al 2020 code for the hydrods modeling web services is available at https github com ci water hydro ds funding this work was supported by the national science foundation oci 1148453 icer 1639655 declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work was supported by the national science foundation under collaborative grants oci 1148453 and icer 1639655 any opinions findings and conclusions or recommendations expressed in this material are those of the authors and do not necessarily reflect the views of the national science foundation 
26012,the soil and water assessment tool swat simplified the hydrological processes in large patches of paddy fields based on the original swat code the main equations are modified and validated with the long term field observations in freezing thawing watershed the original swat and swat with paddy module swat p both perform well in the simulation of stream flow at the basin scale nse 0 7 swat p performs better in the soil water simulation rmse 24 22 mm smaller than 104 63 mm of swat the monthly diffuse nitrogen loadings simulated by swat p are within a reasonable range and close to the monitored nitrate loads in 2011 and 2012 swat p represents the ponding water depth dynamics during the rice growing period the original swat overestimates the diffuse pollution loads in the freeze thaw period swat p has better performance for water cycles and diffuse pollution load simulations in watersheds with large rice paddy fields keywords paddy field swat soil and water assessment tool diffuse pollution nitrogen phosphorus model modification software and or data availability the paddy model was developed from swat version 635 compiled by fortran 77 the arcgis platform version 10 2 2 is highly recommended is required to run the paddy model the model is 4024 kb the paddy model is an open access software program and scholars who are interested in the model should communicate with professor wei ouyang wei itc nl dr peng wei weipeng hebeu edu cn or dr xiang gao gaoxiang123 bnu edu cn 1 introduction paddy fields are artificially designed ponding systems whose hydrological processes are significantly impacted by water management practices haefele et al 2016 zhang et al 2016 soil erosion and nutrient loss caused by changing hydrological conditions such as erosion from paddy fields under diverse drainage operations are detrimental to fragile aquatic environments liang et al 2016 yang et al 2016 in recent years rice planting areas have expanded due to increasing economic growth and global climate change wei et al 2017 choi et al 2017 which have been reported in northeast china ouyang et al 2017a and europe olesen and bindi 2002 tchebakova et al 2011 intensive tillage of paddy rice in asia is characterized by diverse paddy patch sizes which generally comprise numerous small paddy units exposed ridges that connect discrete paddy units occupy large surface areas and are easily eroded which leads to significant soil erosion and diffuse pollution ouyang et al 2018 the rapid expansion of paddy fields and the associated environmental risks have increased the diffuse pollution load from paddy fields schaffner et al 2011 tsuchiya et al 2018 therefore several models have been developed to understand the hydrological processes in paddy fields to meet rigorous water management standards and analyze the nutrient losses from rice growing areas in recent decades several models such as swap soil water atmosphere and plant mike she mike system hydrological european ceres rice crop estimation through resource and environment synthesis rice oryza rice and dndc rice denitrification decomposition rice have been proposed to simulate the water nutrient production cycles of small scale paddy fields ghosh et al 2015 katayanagi et al 2017 nguyen et al 2018 zhang 2018 however most of these models focus on certain cycles such as hydrological dynamic processes nutrient uptake or crop yields of the paddy system and the pathway of generation of excess nutrients has not been considered tang et al 2008 hama et al 2011 zhao et al 2014 claimed that the modified dndc model can simulated diffuse nitrogen load from a paddy field in shanghai however hydraulic properties of paddy soils nitrogen transformation rate constants were not readily available do and nishida 2014 the applicability of existing models is greatly reduced at the basin scale due to significant spatiotemporal heterogeneity wei et al 2016 therefore several distributed hydrological models such as swat soil and water assessment tool hspf hydrological simulation program fortran and annagnps annualized agricultural non point source have been widely adopted for irrigated regions to address the abovementioned limitations lampert and wu 2015 ouyang et al 2017b yalew et al 2013 however paddy fields have been treated similarly to upland areas and nutrient loss patterns due to ponding have not been sufficiently researched therefore the aggregate diffuse pollution loads can be determined by calibration and validation jeon et al 2005 more accurate simulations for paddy fields need further research thus a few modifications are essential not only to offset the biases and uncertainties of these model structures but also to improve the understanding of nutrient loss patterns in paddy fields previous studies have utilized and verified swat due to the availability of sophisticated modules for several watershed management practices e g irrigation fertilization tillage planting impoundment and drainage marekn et al 2016 nossent et al 2017 in particular the pothole module indicates a water storage unit and can be representative of paddy fields with modifications based on the original swat model the hydrological dynamics of the pothole module have been applied to paddy watersheds with patch sizes smaller than 1500 m2 xie and cui 2011 sakaguchi et al 2014 the general surface hydrological process can be verified but the accuracy of soil water routines in paddy fields with larger patch sizes remains unclear in addition to the vertical seepage in the pothole the horizontal transport of irrigated water as a consequence of ponding in paddy fields with large sizes is still not clear the general driving forces of diffuse pollution loading are the hydrological processes under irrigation or rainfall but temperature is also a key trigger in cold watersheds meyer et al 2019 wu et al 2018 this influence is more obvious in the spring thawing period and the impact on the hydrological pattern and soil erosion must also be highlighted in swat ouyang et al 2018 these are the direct factors for diffuse pollution formation and transport also water saving irrigation is a promising management practice for sustainable paddy rice production in asia and different irrigation modes shallow wet irrigation controlled irrigation and intermittent irrigation should be considered in the paddy field module zhuang et al 2019 wu et al 2019 gao et al 2019 therefore specific modifications are necessary to calculate diffuse pollution loads in paddy fields with larger patch sizes especially regarding the complex nutrient loss characteristics in cold areas chung et al 2003 wei et al 2017 swat has wide applications in the modeling of agricultural watersheds and its enhancement and modification are essential for further model development zhang et al 2013 guzman et al 2015 leon and kohyama 2017 the present swat model exhibits a few limitations regarding hydrological processes and diffuse pollution load modeling in paddy fields wu et al 2019 especially large paddy patches therefore the aim of this study was to test the performance of the modified swat model with the paddy module in a mid high latitude basin the specific objectives were to 1 modify swat to assess the hydrological and diffuse pollution principles of large patch paddy fields 2 assess the performance of the modified swat model swat p for a mid high latitude area and 3 compare the original swat model and the swat p model by assessing discrepancies in diffuse pollution loads 2 materials and methods 2 1 model modification process the swat model is a semi distributed physically based hydrology and water quality model designed to simulate the hydrological cycle nutrient cycle carbon cycle and plant growth on a daily time step ouyang et al 2017a swat version 635 was modified to develop swat p and a diagrammatic sketch of the flowchart is presented in fig 1 four aspects of the original swat were modified to represent the characteristics of large patches of paddy fields i e structure of potholes infiltration and evaporation of potholes irrigation and drainage of potholes and erosion of potholes the hydrological cycle and soil erosion processes were considered with regard to nutrient loss the key assumptions in this regard were as follows 1 if potholes were in the released state pothole vol   refers to infinitesimal then the surface runoff generation was calculated using the scs curve or the green ampt equation li et al 2015 and the calculation of soil evaporation was similar to that of the upland field 2 if potholes were in the impounded state pothole vol  then evapotranspiration infiltration irrigation overflow and drainage processes were computed 3 the erosion of paddy fields occurred only during the released state or drying stage and the discharge of soluble pollutants could occur during both released and impounded states 4 if paddy fields were partially defined as potholes pothole fr 1 then the residual parts were regarded as ridge areas which could be eroded by overflow and drainage water 2 2 summary of the original pothole module in swat the potholes were primarily assumed to be cone shaped pits that could temporarily store precipitation neitsch et al 2011 five types of water sources contributed to the ponding conditions rivers reservoirs shallow aquifers deep aquifers and outside water sources water balance eq 1 although the potholes could simulate the impounded conditions the assumed cone shaped structure and the varying evaporation area did not adequately represent the actual paddy system fig 2 and such discrepancies could influence model performance sakaguchi et al 2014 a moreover the influence of other factors of the same hru hydrological response unit has not been considered thus the overflow may be underestimated considering the close relationship between hydrological cycles and diffuse pollution biemelt et al 2005 the original pothole module could be modified as follows 1 v i v i 1 v f l o w i n v p c p v f l o w o u t v e v a v inf where v i is the water stored in the pothole on day i m3 v i 1 is the water stored in the pothole on day i 1 m3 v pcp is the volume of precipitation m3 v flowin is the volume of irrigation flow m3 v flowout is the volume of overflow or drainage flow m3 v eva is the water loss via evaporation m3 and v inf is the water infiltrated into the soil m3 2 3 modification of the swat pothole module 2 3 1 modification of the pothole structure equations assuming the pothole to be conical as indicated in the original swat model the surface area of the pothole increases with increasing water volume the varying water volume can be calculated using eq 2 neitsch et al 2011 in the actual scenario large paddy patches are divided into small polygonal units by blocks of small ridges assuming that the ridges could cumulatively account for 1 3 of the paddy field area the calculation of their surface areas should be considered eq 3 the entire paddy field except the ridges was treated as a water storage unit with a constant cross sectional area eq 4 2 s a  10 4 3 v  s l 2 3 3 s r s h d f r 4 s a s h d 1 f r where v is the volume of water stored in the paddy m3 s a is the surface area of water in the pothole ha s l is the slope of the hru m m s r is the total ridge area s hd is the area of the hru ha and f r is the ratio of the total ridge area and the total area of the hru a range from 0 01 to 0 03 is highly recommended based on field investigations 2 3 2 modification of the evaporation process in the original swat model the evaporation capacity of potholes was calculated using eq 5a and eq 5b which are based on the relationship between leaf area index l and potential evapotranspiration pet e 0 however this method often leads to low evapotranspiration values because it neglects the surface water in the paddy field with large patch sizes marekn et al 2016 thus necessitating more detailed computing methods 5a v e v a 5 1 l l 0 e 0 s a l l 0 5b v e v a 0 l l 0 where v eva is the evaporation of potholes m3 e 0 is the potential evapotranspiration mm s a is the surface area of water in the pothole ha l is the leaf area index and l 0 is the leaf area index when no evaporation occurs on the surface of water depending on the water management schedule and evaporation volume the evaporation patterns of paddy fields were divided into 4 scenarios using eq 6a to eq 6d respectively if the free water of the canopy can on certain days was higher than the pet then only intercepting evaporation occurred until the free canopy water was totally consumed eq 6a the difference between the pet and intercepting evaporation for both the impounded and the drying stages was further compensated by transpiration of rice eq 6b if rice transpiration could still not meet the pet requirements then the evaporation of ponding water and soil water was calculated for the impounded states and the drying periods respectively eq 6c and eq 6d the transpiration of rice was calculated using eq 7a and eq 7b which depended on variations in the leaf area index l the methods for computing soil evaporation coincided with those utilized for upland fields due to their similarities 6a e a e c a n p e t c a n p e t 6b e a e p e c a n e c a n p e t e c a n e p 6c e a e p e c a n e w e c a n e p p e t e c a n e p e w 6d e a e p e c a n e w e s e c a n e p e w p e t e c a n e p e w e s 7a e p pet e can l 3 0 l 3 7b e p pet e can l 3 where can is the free canopy storage on a certain day mm pet is the potential evapotranspiration mm e a is the actual amount of water evaporated from the paddy field mm e can is the evaporation from the free water of the canopy mm e p is the amount of rice transpiration on a given day mm e w is the evaporation from the surface of paddy water mm e s is the evaporation from the paddy soil mm and l is the leaf area index 2 3 3 modification of the infiltration process infiltration v inf in potholes has been calculated based on the relationship between soil water content sw and field capacity f wc eq 8a to eq 8c neitsch et al 2011 8a v inf 240 k s a s w 0 5 f w c 8b v inf 240 1 s w f wc k s a 0 5 f w c s w f w c 8c v inf 0 s w f w c where v inf is the soil infiltration m3 k is the saturated hydraulic conductivity of the first soil layer mm h s a is the area of the water surface ha sw is the soil water content of the specific soil profile mm and f wc is the field capacity mm the alteration between dry and wet conditions was not sufficiently accounted for in these equations moreover the original pothole module assumed there was no infiltration when the sw was saturated this assumption does not coincide with the actual scenario the infiltration rates and soil water content of actual paddy fields are quite stable in the impounded state the calculation of infiltration in paddy fields was similar to the method utilized by the original swat model for upland areas in a drying or released state the paddy field was assumed to exhibit steady infiltration in the impounded state sakaguchi et al 2014 the infiltration rate of each soil layer k s was set as a constant throughout the impounded period when the water stored in the paddy field was able to sustain the daily infiltration process the v inf was calculated according to the maximum daily infiltration volume eq 9a when the water stored in the paddy field was unable to sustain the stable daily infiltration process all the ponding water was converted into the infiltration volume eq 9b 9a v inf 100 k s s a v s v max 9b v inf v s v s v max where k s is the steady infiltration rate of the specific soil layer cm d v s is the volume of water stored in the paddy field m3 and v max is the maximum daily infiltration volume m3 2 3 4 irrigation and drainage description the daily water balance equation in swat p can be updated as follows 10 s t i s t i 1 p i i r i d r i e t i s p i where st is the water depth in the field mm dr is the drainage depth mm et is the evapotranspiration mm p is the daily precipitation mm ir is the irrigation depth mm h2o sp is the water lost by seepage through the bottom of paddy fields on a given day mm which is calculated as a function of the water content of the soil profile beneath the pothole xie and cui 2011 and subscript i denotes day i a delicate water management schedule promotes irrigation efficiency and influences the export of diffuse pollution in paddy rice with large patch sizes which present some unique characteristics during the east asian rainy season thanawong et al 2014 wang et al 2014 therefore three crucial ponding depths h min h and h max were introduced to simulate the integrated impounded period to further optimize the water management practices at different rice growth stages xie and cui 2011 as shown in fig 2 h min is the minimum ponding depth that could cause water stress and trigger the irrigation operations eq 11a h is the optimal ponding depth at which irrigation operations would terminate to guarantee reasonable irrigation efficiency h max is the maximum ponding depth at which drainage operations would be triggered to prevent damage to the grain yield eq 11b 11a v f l o w i n i h s t i s a 0 01 s t i h min 11b v f l o w o u t i s t i h max s a 0 01 s t i h max where v flowin is the volume of irrigation flow m3 and v flowout is the volume of drainage flow m3 2 3 5 modeling of diffuse pollution loads for consistency the musle modified universal soil loss equation was applied to assess soil erosion and the related nutrient losses in paddy fields eq 12 and its effectiveness was validated using other modified models song et al 2017 the module was adjusted accordingly to fit actual impounded states and requirements of a cold area field observations indicated that the ridges could be eroded by both the raindrop splash and the sheer strength of the overflow small soil particles from the ridges were assumed to be suspended solids that were transported out of the paddy fields with ponding water the soil surface of the paddy field was protected by the ponding water surface and could largely endure the strength of the flowing water thus ensuring that the soil surface was less susceptible to rainfall erosion hao et al 2013 the erosion process during the drying stage was assumed to be similar to that of upland fields h max 0 and it was assumed that no erosion occurred in the ponding area in frozen winters h max was assigned a higher value to simulate the accumulation of snowfall and the subsequent melting process 12 s e d 11 8 q q s a 0 56 k c p l s c f r g where s ed is the sediment load t q is the volume of surface runoff mm ha q is the peak volume of surface runoff m3 s k is the soil erodibility factor 0 013 t m2 h m3 t cm c is the land cover and management factor p is the support practice factor ls is the topographic factor and c frg is the coarse fragment factor eq 13 which was proposed by mcelroy et al 1975 and further modified by williams and hann leta et al 2015 utilized the musle results to calculate the export of sediment bound nutrients organic nitrogen organic phosphorus and partial inorganic phosphorus the calculation of soluble pollutants such as soluble nitrogen and phosphorus in the overflow drainage water lateral flow and groundwater coincided with the methods proposed in the original swat model 13 s b p 0 001 c o n s ed s a  where s bp is the load of sediment bound nutrients kg ha c on is the quantity of nutrients bound to the top 10 mm soil layer g t and  is the ratio of the quantity of easily eroded nutrients and nutrients bound to soil particles in the top 10 mm soil layer 2 4 study site and field monitoring the abujiao watershed with an area of 142 9 km2 is located in heilongjiang province northeastern china and is characterized by expanding paddy rice areas with large patches it terminates in the western wetland area and finally drains into the wusuli river as the sino russian boundary the spacious plains and fertile black soils mollisol provide suitable conditions for mechanized farming the regional soil was divided into seven subtypes according to the us soil taxonomy wei et al 2016 a large proportion of the upland has been converted from soybean farming to paddy cultivation huang et al 2017 the planting area of rice increased to 45 3 km2 by 2010 and slightly exceeded that of soybean agriculture 45 0 km2 agricultural development has constrained the construction of diversion canals moreover straw incorporation is widely employed to promote paddy yields and annually 101 0 and 50 5 kg ha of nitrogen n and phosphorus p fertilizers are applied to the paddy fields respectively two zeno meteorological stations coastal usa were established in the dryland and paddy fields for soil water and weather monitoring the automated water content sensors with data loggers were inserted flatly into the undisturbed soil surface to measure the soil volumetric water content at 15 30 60 and 90 cm three sensors were set at each depth four vertical collectors prenart danmark with pvc pipe were installed at a 45 angle at the same depths the porous clay cup was surrounded with fine quartz sand which collected the soil water sample for the n p measurements during rice growth the crop height ch leaf area index lai and rooting depth were measured at 30 day intervals s k chen et al 2013 the river water from 15 reaches in the naoli river watershed was collected fig s1 in september 2016 and the nitrate concentration was measured as model validation referred to the historical regular monitoring in this watershed the field observations were used to compare the performance of model modification specifically with the total nitrogen load tn from the paddy field observations during the growing season april to august in 2011 and 2012 fig 3 the corresponding simulated monthly average values of the original swat and swat p were compared at the hru scale shown in section 3 2 2 5 climate and hydrological management daily meteorological data for the simulation from 2001 to 2014 were obtained to subsequently compare the performances of the original swat and swat p the study area is influenced by the temperate continental monsoon climate is relatively cold and has an annual average temperature of 1 9 c the frozen months fallowing stage cumulatively account for half of the year fig 4 and approximately 135 3 mm of snowfall occurs during this period thus contributing to 23 2 of the annual precipitation the growing stage of rice spans from late april to september and approximately 447 1 mm of rainfall is received during this period intensive precipitation mainly occurs in july and august and contributes to the majority of the paddy overflow the annual accumulated temperature could sustain only single crop rice cultivation in this area and a unique rice tillage practice has been developed in this cold temperature watershed the paddy growth stages were divided into 12 detailed management phases table 1 the ponding depths and application of fertilizers were scheduled based on the growth stage and nutritional requirement the h max was set as high at the top of the ridges in the fallowing stage to simulate the accumulation of snowfall snowmelt was used to supply water in the steeping stage and no drainage occurred except for the potential overflow the numbers within and outside the brackets refer to the initial and final ponding depths of paddy fields at specific growth stages respectively these boundary data were based on field monitoring ouyang et al 2015 and the daily ponding depth in the model was calculated with eq 10 h max is the water level that triggers the drainage operation overflow h is the water level where irrigation ceases and h min is the water level that triggers the irrigation operation 2 6 model setup calibration and validation considering the uncertainty of climatic conditions over a short period long term daily meteorological data from 2001 to 2014 were adopted to simulate the average diffuse pollution loads in this watershed precipitation temperature and other relevant weather data were obtained from the local meteorological station 47 40 n 134 03 e the original swat and swat p were run from 2001 to 2014 2001 2002 was the warm up period for the models to provide the temporal patterns of the average diffuse nitrogen n and phosphorus p loads landsat images with a resolution of 30 m 30 m were utilized to determine land use distributions from 2010 data on management practices planting harvesting and irrigation were provided by the technical staff and local farmers the parameters related to nutrient pollution monitoring were obtained from a nearby similar watershed naoli watershed because long term monitoring data in this study area were unavailable the naoli watershed is also an intensive tillage area located near the study site and is characterized by the same soil type agricultural management practices and climatic patterns thus ensuring reliable simulations a modified swat cup version with built in swat p was adapted to calibrate and validate the river flow for the original swat model 16 sensitive parameters table 2 were selected from a previous study to calibrate 2003 2005 and validate 2006 2008 the flow volume and sediment load ouyang et al 2010 the calibration of flow volume for swat p was conducted for the same period the parameters influencing the transport of sediments were adjusted by referring to the results of previous studies which allowed for the validation of parameters related to soil erosion in different land use types bu et al 2008 the 12 related parameters were referenced from an analogous research to build holonomic nutrient cycles using both the original swat model and the swat p tolson and shoemaker 2007 compared to the results of local studies the diffuse pollution loads were within reasonable ranges liu et al 2014 yu et al 2015 furthermore discrepancies between the simulation results and the monitored values were assessed to verify the estimation of the soil water routine by the paddy module 3 results 3 1 calibration and validation of swat p both the original swat model and swat p performed well in the assessment of flow volume the r2 coefficient of determination values of swat and swat p for the calibration period were 0 77 and 0 76 respectively and both values exceeded the normally accepted threshold of 0 6 fig 5 the nse nash sutcliffe efficiency coefficient values of swat and swat p during the calibration period were 0 78 and 0 77 respectively both exceeding the recommend threshold of 0 5 moriasi et al 2007 the r2 and nse values of swat and swat p during the validation period were 0 68 and 0 72 and 0 70 and 0 74 respectively similar evaluation results suggest that both the original swat and the swat p models performed well with regard to assessing stream flow at the basin scale in cold areas parameters that include available water capacity of paddy moist bulk density for paddy and soil evaporation compensation factor have been calibrated and validated for simulating and presenting impacts of the actual evaporation process and infiltration process on water depth and soil water in paddy field the comparisons of the monitoring and simulated et data proved the model was validated and ready for water cycle simulation ouyang et al 2015 swat p performed better than the original swat model in the simulation of soil water based on the zeno monitoring data in the non frozen period fig 6 the rmse root mean square error of swat p for the 0 15 cm soil layer was 13 90 mm which was significantly lower than that of the original swat model 48 10 mm in contrast to the fluctuating soil water simulated by the original swat model swat p provided a smoother result for the entire ponding stage and better represented the actual saturated submerged soil scenario swat p provided more accurate simulations of soil water in deeper soil 0 30 cm the difference in rmse values between the two models increased to 80 41 mm which was significant when assessing soil water migration the values simulated by swat p were closer to the monitored values therefore swat p provided more reliable estimates of soil water cycles than did the original swat model in paddy fields with large patch sizes which could aid in understanding nutrient transport processes 3 2 simulation of diffuse n loads in freezing thawing watershed the diffuse n loads simulated by the two models demonstrated different patterns both in terms of nitrogen forms and in terms of critical n loss periods fig 7 the average annual diffuse n load estimated by the original swat model was 23 50 kg ha and the temporal patterns were explicitly observed as twin peaks the first peak with a value of 8 92 kg ha appeared at the intersection of the fallowing and growing stages the organic n accumulatively contributed to 85 28 of the diffuse total n load during the freeze thaw period march april in comparison the second peak indicated by a value of 4 22 kg ha appeared in june during the flood season inorganic n accounted for 90 75 of the total diffuse n load between july and august the single peak emerged in the simulation results of swat p and negligible diffuse n loads were estimated for the freeze thaw season the average annual diffuse n load simulated by swat p was 7 57 kg ha and the peak value of 4 16 kg ha appeared in august when the overflow occurred frequently due to low ponding depth and high intensity rainfall organic n played an important role in the transport of diffuse n in july and august when the prime n loss months contributed to approximately 72 48 of the total diffuse n loads the diffuse n loads from may to august accounted for 92 32 of the total diffuse n loads with the total nitrogen tn load from the paddy field observations during the growing seasons in 2011 and 2012 the corresponding simulated monthly average values of the two models were compared fig 7 the higher correlation with swat p indicated that it had better performance regarding the monthly diffuse tn load than did the original swat especially during the freeze thaw period 3 3 simulation of diffuse p loads in freezing thawing watershed the simulation results of the original swat model indicated that most diffuse p loss occurred during the freeze thaw stage fig 8 the diffuse p loads generated in march and april accounted for 85 21 of the average annual diffuse p load the peak diffuse p load value was 4 50 kg ha during the critical p loss period sedp particulate inorganic p and orgp organic p accounted for 20 76 and 77 00 of the total diffuse p load respectively the fraction of sedp fluctuated between 58 06 and 78 60 in the remaining months while that of orgp varied from approximately 14 60 20 44 in comparison the swat p simulations indicated that p losses mainly occurred during the growing season the p export was predominantly concentrated in july and august which cumulatively accounted for 96 72 of the average annual diffuse p load the peak diffuse p load value was 3 93 kg ha moreover the solp soluble p orgp and sedp accounted for 49 52 10 01 and 40 47 of the diffuse p load during the critical p loss stage respectively 4 discussion 4 1 diffuse n loads modeling performance assessment of swat p swat p provided more accurate diffuse n load outcomes than the original swat model especially in the identification of the critical n loss stages compared to previous swat studies fig 9 the estimated diffuse n loads by both swat p and the original swat model were within reasonable ranges the first diffuse n load peak that appeared in the freeze thaw season contradicts the actual agricultural practices fumikazu et al 2013 melted snow is stored for steeping the paddy fields and not drained away thus reducing substantial erosion effects unlike those in upland environments ollesch et al 2005 the diffuse n loads generated in the freeze thaw period were overestimated by the original swat model because of the overestimation of the runoff volume therefore internal structural deficiencies of paddy fields of large patch sizes result in inaccurate distributions of diffuse n loads at the basin scale in different land use types thus the single peak characteristic of the swat p results was in agreement with the actual scenario and are more representative of the monitoring results the original swat model indicated that the diffuse n load peaked in july which was attributed to higher fertilizer losses resulting from surface runoff swat p performs better in the identification of critical n loss stages the n loss process in actual paddy fields is impacted by hydrological retention times and stable leaching effects wang et al 2014 except for n uptake by rice most of the soluble n leaches into the deep soil profiles which diminishes n loss via surface runoff tan et al 2015 moreover the flushing effect caused by overflow attributed to abundant rainfall in august and drainage operation were not incorporated in the original swat simulations lapong et al 2012 the modified swat p demonstrated flushing effects through increased organic n loads which are characteristic of mollisol erosion this conclusion was further corroborated by sampling ponding water at the study site in 2011 fig 10 a the results of the field investigation indicated that organic n was the dominant form in most stages and peaked in august approximately 80 95 due to erosion caused by heavy rainfall swat p also improved the assessment of diffuse n loads in the growing season with the nitrate concentration from the field observations of 15 reaches gao et al 2019 the corresponding simulated monthly average values of two models were compared fig 10b swat p still underestimated the diffuse n load compared to the field monitoring data from paddy fields but were better than the original swat during the freeze thaw period april fig 7 considering the higher frequency of low n loads events swat p could provide better simulation results than original swat model swat p still underestimated the diffuse n load compared to the field monitoring data from paddy fields but were better than the original swat during the freeze thaw period april fig 7 moreover swat p model shows better linear relation between observed value and modeled value r2 0 63 which demonstrated stable simulation capacity the above mentioned results of swat p indicated that it had better performance than the original swat model 4 2 diffuse p loads modeling performance assessment of swat p the original swat and swat p models provided reasonable estimations of the annual diffuse p loads from paddy fields as corroborated by the results of previous studies fig 11 the simulated results of swat p were in better agreement with the studies that had similar amounts of fertilizer application a previous study in the yangtze river basin also demonstrated that the results of swat p were similar to the data from field monitoring furthermore swat p was more accurate in assessing the critical stages of p loss intensive p loss commonly occurs in the rainy season july and august due to frequent drainage operations peng et al 2011 the original swat model attributed p loss to snowmelt erosion processes similar to those observed in upland fields yakutina et al 2015 and failed to establish the relationship between diffuse p loads and water management practices in comparison swat p explicitly reflected that diffuse p loads were influenced by water management schedules and precipitation induced overflow zhang et al 2004 moreover the sedp dominated p loss pattern was also well reflected 4 3 advantages of swat p in paddy fields with large patch sizes the hydrological process and diffuse pollution loading from paddy rice fields have been improved by researchers in eastern asia sakaguchi et al 2014 the original swat model treated paddy fields as upland areas and ponding conditions were not considered therefore the swat model cannot express the actual scenarios in irrigation areas or the hydrological process in fields with large patch sizes leon and kohyama 2017 irrigation and precipitation were immediately converted to surface runoff in swat thus forming dry wet cycles and resulting in the underestimation of stable infiltration processes in paddy fields qiu et al 2017 the deficiency was reflected in simulation results of soil water content fig 6a even auto irrigation was functioned in original swat model the rmse between simulated value and observed value could reach up to 48 1 mm which contradicted with the saturated conditions of paddy soil in comparison swat p provided more insights into the hydrological cycles especially the soil water routines dynamics in paddy fields during paddy rice growth the discrepancy between observed value and simulation value was effectively narrowed and the smoother result also reflected the lasting submerged status of whole growing stage although the calibration and validation results of swat are generally acceptable swat p improves the confidence levels with regard to the soil water routines and diffuse n and p at the hru scale moreover the discrepancy between the monitored soil water content and the swat simulations was further increased for deeper soil profiles which could diminish the impacts of soil leaching due to the underestimation of potential infiltration zhou et al 2011 however swat p still underestimated the soil water content compared to the field monitoring data and the soil was unsaturated during the ponding days fig 6 the probable reasons for this underestimation were the lower estimation of seepage and the drainage flow load during the irrigation period additionally swat p still underestimated the diffuse n load compared to the field monitoring data from paddy fields but were better than the original swat during the freeze thaw period april fig 7 swat p also provided a flexible water management schedule for paddy fields and the computing methods for hydrological cycles and export of diffuse loads were more delicate i e soil water cycle than those provided by the hspf paddy hydrological simulation program fortran and swat apex agricultural policy and environmental extender models jung et al 2014 a detailed description of the ponding level leads to the inaccurate estimation of diffuse pollution loads however soil erosion and diffuse pollution modeling still require further observations and improvements the farmland vertical transport pattern of soil water in typical farmlands during the freeze thaw period has been carefully analyzed s chen et al 2013 and the role of temperature on the soil hydrological process is considered in swat p however the accumulated impact of temperature on the soil water and coming tillage practice is not completely evaluated the scale effect of the patch size and the ridge on the hydrological pattern and diffuse pollution loading is still unclear and requires more field observations 5 conclusions in this study the modified swat model swat p was validated and demonstrated improved performance in the assessment of both stream flow and diffuse pollution loads in watersheds with large paddy patches the original swat model was not efficient in the simulation of soil water due to the simplification of hydrological processes in paddy fields with large patch sizes which subsequently affected the accuracy of infiltration related processes the annual diffuse n and p loads simulated by swat p in paddy fields were within reasonable ranges however the original swat model overestimated the diffuse pollution loads in the freeze thaw period which led to the misidentification of the critical loss stage in comparison swat p was more accurate in identifying the critical stages of n and p losses which helped elucidate the relationship between diffuse pollution loads and water management practices swat p performed better in evaluating diffuse pollution loads and provided an alternative for simulating pollution loads in watersheds with large paddy patches declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the study received financial support from the national key research and development program of china 2016yfd0800500 the national natural science foundation of china grant no 41830643 the land use data were interpreted from landsat images which was downloaded from united states geological survey http glovis usgs gov the weather data was provided by bawujiu farm the soil data were the product of chinese academy of sciences http www soil csdb cn the dem was supported by geospatial data cloud http www gscloud cn appendix a supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2020 104736 
26012,the soil and water assessment tool swat simplified the hydrological processes in large patches of paddy fields based on the original swat code the main equations are modified and validated with the long term field observations in freezing thawing watershed the original swat and swat with paddy module swat p both perform well in the simulation of stream flow at the basin scale nse 0 7 swat p performs better in the soil water simulation rmse 24 22 mm smaller than 104 63 mm of swat the monthly diffuse nitrogen loadings simulated by swat p are within a reasonable range and close to the monitored nitrate loads in 2011 and 2012 swat p represents the ponding water depth dynamics during the rice growing period the original swat overestimates the diffuse pollution loads in the freeze thaw period swat p has better performance for water cycles and diffuse pollution load simulations in watersheds with large rice paddy fields keywords paddy field swat soil and water assessment tool diffuse pollution nitrogen phosphorus model modification software and or data availability the paddy model was developed from swat version 635 compiled by fortran 77 the arcgis platform version 10 2 2 is highly recommended is required to run the paddy model the model is 4024 kb the paddy model is an open access software program and scholars who are interested in the model should communicate with professor wei ouyang wei itc nl dr peng wei weipeng hebeu edu cn or dr xiang gao gaoxiang123 bnu edu cn 1 introduction paddy fields are artificially designed ponding systems whose hydrological processes are significantly impacted by water management practices haefele et al 2016 zhang et al 2016 soil erosion and nutrient loss caused by changing hydrological conditions such as erosion from paddy fields under diverse drainage operations are detrimental to fragile aquatic environments liang et al 2016 yang et al 2016 in recent years rice planting areas have expanded due to increasing economic growth and global climate change wei et al 2017 choi et al 2017 which have been reported in northeast china ouyang et al 2017a and europe olesen and bindi 2002 tchebakova et al 2011 intensive tillage of paddy rice in asia is characterized by diverse paddy patch sizes which generally comprise numerous small paddy units exposed ridges that connect discrete paddy units occupy large surface areas and are easily eroded which leads to significant soil erosion and diffuse pollution ouyang et al 2018 the rapid expansion of paddy fields and the associated environmental risks have increased the diffuse pollution load from paddy fields schaffner et al 2011 tsuchiya et al 2018 therefore several models have been developed to understand the hydrological processes in paddy fields to meet rigorous water management standards and analyze the nutrient losses from rice growing areas in recent decades several models such as swap soil water atmosphere and plant mike she mike system hydrological european ceres rice crop estimation through resource and environment synthesis rice oryza rice and dndc rice denitrification decomposition rice have been proposed to simulate the water nutrient production cycles of small scale paddy fields ghosh et al 2015 katayanagi et al 2017 nguyen et al 2018 zhang 2018 however most of these models focus on certain cycles such as hydrological dynamic processes nutrient uptake or crop yields of the paddy system and the pathway of generation of excess nutrients has not been considered tang et al 2008 hama et al 2011 zhao et al 2014 claimed that the modified dndc model can simulated diffuse nitrogen load from a paddy field in shanghai however hydraulic properties of paddy soils nitrogen transformation rate constants were not readily available do and nishida 2014 the applicability of existing models is greatly reduced at the basin scale due to significant spatiotemporal heterogeneity wei et al 2016 therefore several distributed hydrological models such as swat soil and water assessment tool hspf hydrological simulation program fortran and annagnps annualized agricultural non point source have been widely adopted for irrigated regions to address the abovementioned limitations lampert and wu 2015 ouyang et al 2017b yalew et al 2013 however paddy fields have been treated similarly to upland areas and nutrient loss patterns due to ponding have not been sufficiently researched therefore the aggregate diffuse pollution loads can be determined by calibration and validation jeon et al 2005 more accurate simulations for paddy fields need further research thus a few modifications are essential not only to offset the biases and uncertainties of these model structures but also to improve the understanding of nutrient loss patterns in paddy fields previous studies have utilized and verified swat due to the availability of sophisticated modules for several watershed management practices e g irrigation fertilization tillage planting impoundment and drainage marekn et al 2016 nossent et al 2017 in particular the pothole module indicates a water storage unit and can be representative of paddy fields with modifications based on the original swat model the hydrological dynamics of the pothole module have been applied to paddy watersheds with patch sizes smaller than 1500 m2 xie and cui 2011 sakaguchi et al 2014 the general surface hydrological process can be verified but the accuracy of soil water routines in paddy fields with larger patch sizes remains unclear in addition to the vertical seepage in the pothole the horizontal transport of irrigated water as a consequence of ponding in paddy fields with large sizes is still not clear the general driving forces of diffuse pollution loading are the hydrological processes under irrigation or rainfall but temperature is also a key trigger in cold watersheds meyer et al 2019 wu et al 2018 this influence is more obvious in the spring thawing period and the impact on the hydrological pattern and soil erosion must also be highlighted in swat ouyang et al 2018 these are the direct factors for diffuse pollution formation and transport also water saving irrigation is a promising management practice for sustainable paddy rice production in asia and different irrigation modes shallow wet irrigation controlled irrigation and intermittent irrigation should be considered in the paddy field module zhuang et al 2019 wu et al 2019 gao et al 2019 therefore specific modifications are necessary to calculate diffuse pollution loads in paddy fields with larger patch sizes especially regarding the complex nutrient loss characteristics in cold areas chung et al 2003 wei et al 2017 swat has wide applications in the modeling of agricultural watersheds and its enhancement and modification are essential for further model development zhang et al 2013 guzman et al 2015 leon and kohyama 2017 the present swat model exhibits a few limitations regarding hydrological processes and diffuse pollution load modeling in paddy fields wu et al 2019 especially large paddy patches therefore the aim of this study was to test the performance of the modified swat model with the paddy module in a mid high latitude basin the specific objectives were to 1 modify swat to assess the hydrological and diffuse pollution principles of large patch paddy fields 2 assess the performance of the modified swat model swat p for a mid high latitude area and 3 compare the original swat model and the swat p model by assessing discrepancies in diffuse pollution loads 2 materials and methods 2 1 model modification process the swat model is a semi distributed physically based hydrology and water quality model designed to simulate the hydrological cycle nutrient cycle carbon cycle and plant growth on a daily time step ouyang et al 2017a swat version 635 was modified to develop swat p and a diagrammatic sketch of the flowchart is presented in fig 1 four aspects of the original swat were modified to represent the characteristics of large patches of paddy fields i e structure of potholes infiltration and evaporation of potholes irrigation and drainage of potholes and erosion of potholes the hydrological cycle and soil erosion processes were considered with regard to nutrient loss the key assumptions in this regard were as follows 1 if potholes were in the released state pothole vol   refers to infinitesimal then the surface runoff generation was calculated using the scs curve or the green ampt equation li et al 2015 and the calculation of soil evaporation was similar to that of the upland field 2 if potholes were in the impounded state pothole vol  then evapotranspiration infiltration irrigation overflow and drainage processes were computed 3 the erosion of paddy fields occurred only during the released state or drying stage and the discharge of soluble pollutants could occur during both released and impounded states 4 if paddy fields were partially defined as potholes pothole fr 1 then the residual parts were regarded as ridge areas which could be eroded by overflow and drainage water 2 2 summary of the original pothole module in swat the potholes were primarily assumed to be cone shaped pits that could temporarily store precipitation neitsch et al 2011 five types of water sources contributed to the ponding conditions rivers reservoirs shallow aquifers deep aquifers and outside water sources water balance eq 1 although the potholes could simulate the impounded conditions the assumed cone shaped structure and the varying evaporation area did not adequately represent the actual paddy system fig 2 and such discrepancies could influence model performance sakaguchi et al 2014 a moreover the influence of other factors of the same hru hydrological response unit has not been considered thus the overflow may be underestimated considering the close relationship between hydrological cycles and diffuse pollution biemelt et al 2005 the original pothole module could be modified as follows 1 v i v i 1 v f l o w i n v p c p v f l o w o u t v e v a v inf where v i is the water stored in the pothole on day i m3 v i 1 is the water stored in the pothole on day i 1 m3 v pcp is the volume of precipitation m3 v flowin is the volume of irrigation flow m3 v flowout is the volume of overflow or drainage flow m3 v eva is the water loss via evaporation m3 and v inf is the water infiltrated into the soil m3 2 3 modification of the swat pothole module 2 3 1 modification of the pothole structure equations assuming the pothole to be conical as indicated in the original swat model the surface area of the pothole increases with increasing water volume the varying water volume can be calculated using eq 2 neitsch et al 2011 in the actual scenario large paddy patches are divided into small polygonal units by blocks of small ridges assuming that the ridges could cumulatively account for 1 3 of the paddy field area the calculation of their surface areas should be considered eq 3 the entire paddy field except the ridges was treated as a water storage unit with a constant cross sectional area eq 4 2 s a  10 4 3 v  s l 2 3 3 s r s h d f r 4 s a s h d 1 f r where v is the volume of water stored in the paddy m3 s a is the surface area of water in the pothole ha s l is the slope of the hru m m s r is the total ridge area s hd is the area of the hru ha and f r is the ratio of the total ridge area and the total area of the hru a range from 0 01 to 0 03 is highly recommended based on field investigations 2 3 2 modification of the evaporation process in the original swat model the evaporation capacity of potholes was calculated using eq 5a and eq 5b which are based on the relationship between leaf area index l and potential evapotranspiration pet e 0 however this method often leads to low evapotranspiration values because it neglects the surface water in the paddy field with large patch sizes marekn et al 2016 thus necessitating more detailed computing methods 5a v e v a 5 1 l l 0 e 0 s a l l 0 5b v e v a 0 l l 0 where v eva is the evaporation of potholes m3 e 0 is the potential evapotranspiration mm s a is the surface area of water in the pothole ha l is the leaf area index and l 0 is the leaf area index when no evaporation occurs on the surface of water depending on the water management schedule and evaporation volume the evaporation patterns of paddy fields were divided into 4 scenarios using eq 6a to eq 6d respectively if the free water of the canopy can on certain days was higher than the pet then only intercepting evaporation occurred until the free canopy water was totally consumed eq 6a the difference between the pet and intercepting evaporation for both the impounded and the drying stages was further compensated by transpiration of rice eq 6b if rice transpiration could still not meet the pet requirements then the evaporation of ponding water and soil water was calculated for the impounded states and the drying periods respectively eq 6c and eq 6d the transpiration of rice was calculated using eq 7a and eq 7b which depended on variations in the leaf area index l the methods for computing soil evaporation coincided with those utilized for upland fields due to their similarities 6a e a e c a n p e t c a n p e t 6b e a e p e c a n e c a n p e t e c a n e p 6c e a e p e c a n e w e c a n e p p e t e c a n e p e w 6d e a e p e c a n e w e s e c a n e p e w p e t e c a n e p e w e s 7a e p pet e can l 3 0 l 3 7b e p pet e can l 3 where can is the free canopy storage on a certain day mm pet is the potential evapotranspiration mm e a is the actual amount of water evaporated from the paddy field mm e can is the evaporation from the free water of the canopy mm e p is the amount of rice transpiration on a given day mm e w is the evaporation from the surface of paddy water mm e s is the evaporation from the paddy soil mm and l is the leaf area index 2 3 3 modification of the infiltration process infiltration v inf in potholes has been calculated based on the relationship between soil water content sw and field capacity f wc eq 8a to eq 8c neitsch et al 2011 8a v inf 240 k s a s w 0 5 f w c 8b v inf 240 1 s w f wc k s a 0 5 f w c s w f w c 8c v inf 0 s w f w c where v inf is the soil infiltration m3 k is the saturated hydraulic conductivity of the first soil layer mm h s a is the area of the water surface ha sw is the soil water content of the specific soil profile mm and f wc is the field capacity mm the alteration between dry and wet conditions was not sufficiently accounted for in these equations moreover the original pothole module assumed there was no infiltration when the sw was saturated this assumption does not coincide with the actual scenario the infiltration rates and soil water content of actual paddy fields are quite stable in the impounded state the calculation of infiltration in paddy fields was similar to the method utilized by the original swat model for upland areas in a drying or released state the paddy field was assumed to exhibit steady infiltration in the impounded state sakaguchi et al 2014 the infiltration rate of each soil layer k s was set as a constant throughout the impounded period when the water stored in the paddy field was able to sustain the daily infiltration process the v inf was calculated according to the maximum daily infiltration volume eq 9a when the water stored in the paddy field was unable to sustain the stable daily infiltration process all the ponding water was converted into the infiltration volume eq 9b 9a v inf 100 k s s a v s v max 9b v inf v s v s v max where k s is the steady infiltration rate of the specific soil layer cm d v s is the volume of water stored in the paddy field m3 and v max is the maximum daily infiltration volume m3 2 3 4 irrigation and drainage description the daily water balance equation in swat p can be updated as follows 10 s t i s t i 1 p i i r i d r i e t i s p i where st is the water depth in the field mm dr is the drainage depth mm et is the evapotranspiration mm p is the daily precipitation mm ir is the irrigation depth mm h2o sp is the water lost by seepage through the bottom of paddy fields on a given day mm which is calculated as a function of the water content of the soil profile beneath the pothole xie and cui 2011 and subscript i denotes day i a delicate water management schedule promotes irrigation efficiency and influences the export of diffuse pollution in paddy rice with large patch sizes which present some unique characteristics during the east asian rainy season thanawong et al 2014 wang et al 2014 therefore three crucial ponding depths h min h and h max were introduced to simulate the integrated impounded period to further optimize the water management practices at different rice growth stages xie and cui 2011 as shown in fig 2 h min is the minimum ponding depth that could cause water stress and trigger the irrigation operations eq 11a h is the optimal ponding depth at which irrigation operations would terminate to guarantee reasonable irrigation efficiency h max is the maximum ponding depth at which drainage operations would be triggered to prevent damage to the grain yield eq 11b 11a v f l o w i n i h s t i s a 0 01 s t i h min 11b v f l o w o u t i s t i h max s a 0 01 s t i h max where v flowin is the volume of irrigation flow m3 and v flowout is the volume of drainage flow m3 2 3 5 modeling of diffuse pollution loads for consistency the musle modified universal soil loss equation was applied to assess soil erosion and the related nutrient losses in paddy fields eq 12 and its effectiveness was validated using other modified models song et al 2017 the module was adjusted accordingly to fit actual impounded states and requirements of a cold area field observations indicated that the ridges could be eroded by both the raindrop splash and the sheer strength of the overflow small soil particles from the ridges were assumed to be suspended solids that were transported out of the paddy fields with ponding water the soil surface of the paddy field was protected by the ponding water surface and could largely endure the strength of the flowing water thus ensuring that the soil surface was less susceptible to rainfall erosion hao et al 2013 the erosion process during the drying stage was assumed to be similar to that of upland fields h max 0 and it was assumed that no erosion occurred in the ponding area in frozen winters h max was assigned a higher value to simulate the accumulation of snowfall and the subsequent melting process 12 s e d 11 8 q q s a 0 56 k c p l s c f r g where s ed is the sediment load t q is the volume of surface runoff mm ha q is the peak volume of surface runoff m3 s k is the soil erodibility factor 0 013 t m2 h m3 t cm c is the land cover and management factor p is the support practice factor ls is the topographic factor and c frg is the coarse fragment factor eq 13 which was proposed by mcelroy et al 1975 and further modified by williams and hann leta et al 2015 utilized the musle results to calculate the export of sediment bound nutrients organic nitrogen organic phosphorus and partial inorganic phosphorus the calculation of soluble pollutants such as soluble nitrogen and phosphorus in the overflow drainage water lateral flow and groundwater coincided with the methods proposed in the original swat model 13 s b p 0 001 c o n s ed s a  where s bp is the load of sediment bound nutrients kg ha c on is the quantity of nutrients bound to the top 10 mm soil layer g t and  is the ratio of the quantity of easily eroded nutrients and nutrients bound to soil particles in the top 10 mm soil layer 2 4 study site and field monitoring the abujiao watershed with an area of 142 9 km2 is located in heilongjiang province northeastern china and is characterized by expanding paddy rice areas with large patches it terminates in the western wetland area and finally drains into the wusuli river as the sino russian boundary the spacious plains and fertile black soils mollisol provide suitable conditions for mechanized farming the regional soil was divided into seven subtypes according to the us soil taxonomy wei et al 2016 a large proportion of the upland has been converted from soybean farming to paddy cultivation huang et al 2017 the planting area of rice increased to 45 3 km2 by 2010 and slightly exceeded that of soybean agriculture 45 0 km2 agricultural development has constrained the construction of diversion canals moreover straw incorporation is widely employed to promote paddy yields and annually 101 0 and 50 5 kg ha of nitrogen n and phosphorus p fertilizers are applied to the paddy fields respectively two zeno meteorological stations coastal usa were established in the dryland and paddy fields for soil water and weather monitoring the automated water content sensors with data loggers were inserted flatly into the undisturbed soil surface to measure the soil volumetric water content at 15 30 60 and 90 cm three sensors were set at each depth four vertical collectors prenart danmark with pvc pipe were installed at a 45 angle at the same depths the porous clay cup was surrounded with fine quartz sand which collected the soil water sample for the n p measurements during rice growth the crop height ch leaf area index lai and rooting depth were measured at 30 day intervals s k chen et al 2013 the river water from 15 reaches in the naoli river watershed was collected fig s1 in september 2016 and the nitrate concentration was measured as model validation referred to the historical regular monitoring in this watershed the field observations were used to compare the performance of model modification specifically with the total nitrogen load tn from the paddy field observations during the growing season april to august in 2011 and 2012 fig 3 the corresponding simulated monthly average values of the original swat and swat p were compared at the hru scale shown in section 3 2 2 5 climate and hydrological management daily meteorological data for the simulation from 2001 to 2014 were obtained to subsequently compare the performances of the original swat and swat p the study area is influenced by the temperate continental monsoon climate is relatively cold and has an annual average temperature of 1 9 c the frozen months fallowing stage cumulatively account for half of the year fig 4 and approximately 135 3 mm of snowfall occurs during this period thus contributing to 23 2 of the annual precipitation the growing stage of rice spans from late april to september and approximately 447 1 mm of rainfall is received during this period intensive precipitation mainly occurs in july and august and contributes to the majority of the paddy overflow the annual accumulated temperature could sustain only single crop rice cultivation in this area and a unique rice tillage practice has been developed in this cold temperature watershed the paddy growth stages were divided into 12 detailed management phases table 1 the ponding depths and application of fertilizers were scheduled based on the growth stage and nutritional requirement the h max was set as high at the top of the ridges in the fallowing stage to simulate the accumulation of snowfall snowmelt was used to supply water in the steeping stage and no drainage occurred except for the potential overflow the numbers within and outside the brackets refer to the initial and final ponding depths of paddy fields at specific growth stages respectively these boundary data were based on field monitoring ouyang et al 2015 and the daily ponding depth in the model was calculated with eq 10 h max is the water level that triggers the drainage operation overflow h is the water level where irrigation ceases and h min is the water level that triggers the irrigation operation 2 6 model setup calibration and validation considering the uncertainty of climatic conditions over a short period long term daily meteorological data from 2001 to 2014 were adopted to simulate the average diffuse pollution loads in this watershed precipitation temperature and other relevant weather data were obtained from the local meteorological station 47 40 n 134 03 e the original swat and swat p were run from 2001 to 2014 2001 2002 was the warm up period for the models to provide the temporal patterns of the average diffuse nitrogen n and phosphorus p loads landsat images with a resolution of 30 m 30 m were utilized to determine land use distributions from 2010 data on management practices planting harvesting and irrigation were provided by the technical staff and local farmers the parameters related to nutrient pollution monitoring were obtained from a nearby similar watershed naoli watershed because long term monitoring data in this study area were unavailable the naoli watershed is also an intensive tillage area located near the study site and is characterized by the same soil type agricultural management practices and climatic patterns thus ensuring reliable simulations a modified swat cup version with built in swat p was adapted to calibrate and validate the river flow for the original swat model 16 sensitive parameters table 2 were selected from a previous study to calibrate 2003 2005 and validate 2006 2008 the flow volume and sediment load ouyang et al 2010 the calibration of flow volume for swat p was conducted for the same period the parameters influencing the transport of sediments were adjusted by referring to the results of previous studies which allowed for the validation of parameters related to soil erosion in different land use types bu et al 2008 the 12 related parameters were referenced from an analogous research to build holonomic nutrient cycles using both the original swat model and the swat p tolson and shoemaker 2007 compared to the results of local studies the diffuse pollution loads were within reasonable ranges liu et al 2014 yu et al 2015 furthermore discrepancies between the simulation results and the monitored values were assessed to verify the estimation of the soil water routine by the paddy module 3 results 3 1 calibration and validation of swat p both the original swat model and swat p performed well in the assessment of flow volume the r2 coefficient of determination values of swat and swat p for the calibration period were 0 77 and 0 76 respectively and both values exceeded the normally accepted threshold of 0 6 fig 5 the nse nash sutcliffe efficiency coefficient values of swat and swat p during the calibration period were 0 78 and 0 77 respectively both exceeding the recommend threshold of 0 5 moriasi et al 2007 the r2 and nse values of swat and swat p during the validation period were 0 68 and 0 72 and 0 70 and 0 74 respectively similar evaluation results suggest that both the original swat and the swat p models performed well with regard to assessing stream flow at the basin scale in cold areas parameters that include available water capacity of paddy moist bulk density for paddy and soil evaporation compensation factor have been calibrated and validated for simulating and presenting impacts of the actual evaporation process and infiltration process on water depth and soil water in paddy field the comparisons of the monitoring and simulated et data proved the model was validated and ready for water cycle simulation ouyang et al 2015 swat p performed better than the original swat model in the simulation of soil water based on the zeno monitoring data in the non frozen period fig 6 the rmse root mean square error of swat p for the 0 15 cm soil layer was 13 90 mm which was significantly lower than that of the original swat model 48 10 mm in contrast to the fluctuating soil water simulated by the original swat model swat p provided a smoother result for the entire ponding stage and better represented the actual saturated submerged soil scenario swat p provided more accurate simulations of soil water in deeper soil 0 30 cm the difference in rmse values between the two models increased to 80 41 mm which was significant when assessing soil water migration the values simulated by swat p were closer to the monitored values therefore swat p provided more reliable estimates of soil water cycles than did the original swat model in paddy fields with large patch sizes which could aid in understanding nutrient transport processes 3 2 simulation of diffuse n loads in freezing thawing watershed the diffuse n loads simulated by the two models demonstrated different patterns both in terms of nitrogen forms and in terms of critical n loss periods fig 7 the average annual diffuse n load estimated by the original swat model was 23 50 kg ha and the temporal patterns were explicitly observed as twin peaks the first peak with a value of 8 92 kg ha appeared at the intersection of the fallowing and growing stages the organic n accumulatively contributed to 85 28 of the diffuse total n load during the freeze thaw period march april in comparison the second peak indicated by a value of 4 22 kg ha appeared in june during the flood season inorganic n accounted for 90 75 of the total diffuse n load between july and august the single peak emerged in the simulation results of swat p and negligible diffuse n loads were estimated for the freeze thaw season the average annual diffuse n load simulated by swat p was 7 57 kg ha and the peak value of 4 16 kg ha appeared in august when the overflow occurred frequently due to low ponding depth and high intensity rainfall organic n played an important role in the transport of diffuse n in july and august when the prime n loss months contributed to approximately 72 48 of the total diffuse n loads the diffuse n loads from may to august accounted for 92 32 of the total diffuse n loads with the total nitrogen tn load from the paddy field observations during the growing seasons in 2011 and 2012 the corresponding simulated monthly average values of the two models were compared fig 7 the higher correlation with swat p indicated that it had better performance regarding the monthly diffuse tn load than did the original swat especially during the freeze thaw period 3 3 simulation of diffuse p loads in freezing thawing watershed the simulation results of the original swat model indicated that most diffuse p loss occurred during the freeze thaw stage fig 8 the diffuse p loads generated in march and april accounted for 85 21 of the average annual diffuse p load the peak diffuse p load value was 4 50 kg ha during the critical p loss period sedp particulate inorganic p and orgp organic p accounted for 20 76 and 77 00 of the total diffuse p load respectively the fraction of sedp fluctuated between 58 06 and 78 60 in the remaining months while that of orgp varied from approximately 14 60 20 44 in comparison the swat p simulations indicated that p losses mainly occurred during the growing season the p export was predominantly concentrated in july and august which cumulatively accounted for 96 72 of the average annual diffuse p load the peak diffuse p load value was 3 93 kg ha moreover the solp soluble p orgp and sedp accounted for 49 52 10 01 and 40 47 of the diffuse p load during the critical p loss stage respectively 4 discussion 4 1 diffuse n loads modeling performance assessment of swat p swat p provided more accurate diffuse n load outcomes than the original swat model especially in the identification of the critical n loss stages compared to previous swat studies fig 9 the estimated diffuse n loads by both swat p and the original swat model were within reasonable ranges the first diffuse n load peak that appeared in the freeze thaw season contradicts the actual agricultural practices fumikazu et al 2013 melted snow is stored for steeping the paddy fields and not drained away thus reducing substantial erosion effects unlike those in upland environments ollesch et al 2005 the diffuse n loads generated in the freeze thaw period were overestimated by the original swat model because of the overestimation of the runoff volume therefore internal structural deficiencies of paddy fields of large patch sizes result in inaccurate distributions of diffuse n loads at the basin scale in different land use types thus the single peak characteristic of the swat p results was in agreement with the actual scenario and are more representative of the monitoring results the original swat model indicated that the diffuse n load peaked in july which was attributed to higher fertilizer losses resulting from surface runoff swat p performs better in the identification of critical n loss stages the n loss process in actual paddy fields is impacted by hydrological retention times and stable leaching effects wang et al 2014 except for n uptake by rice most of the soluble n leaches into the deep soil profiles which diminishes n loss via surface runoff tan et al 2015 moreover the flushing effect caused by overflow attributed to abundant rainfall in august and drainage operation were not incorporated in the original swat simulations lapong et al 2012 the modified swat p demonstrated flushing effects through increased organic n loads which are characteristic of mollisol erosion this conclusion was further corroborated by sampling ponding water at the study site in 2011 fig 10 a the results of the field investigation indicated that organic n was the dominant form in most stages and peaked in august approximately 80 95 due to erosion caused by heavy rainfall swat p also improved the assessment of diffuse n loads in the growing season with the nitrate concentration from the field observations of 15 reaches gao et al 2019 the corresponding simulated monthly average values of two models were compared fig 10b swat p still underestimated the diffuse n load compared to the field monitoring data from paddy fields but were better than the original swat during the freeze thaw period april fig 7 considering the higher frequency of low n loads events swat p could provide better simulation results than original swat model swat p still underestimated the diffuse n load compared to the field monitoring data from paddy fields but were better than the original swat during the freeze thaw period april fig 7 moreover swat p model shows better linear relation between observed value and modeled value r2 0 63 which demonstrated stable simulation capacity the above mentioned results of swat p indicated that it had better performance than the original swat model 4 2 diffuse p loads modeling performance assessment of swat p the original swat and swat p models provided reasonable estimations of the annual diffuse p loads from paddy fields as corroborated by the results of previous studies fig 11 the simulated results of swat p were in better agreement with the studies that had similar amounts of fertilizer application a previous study in the yangtze river basin also demonstrated that the results of swat p were similar to the data from field monitoring furthermore swat p was more accurate in assessing the critical stages of p loss intensive p loss commonly occurs in the rainy season july and august due to frequent drainage operations peng et al 2011 the original swat model attributed p loss to snowmelt erosion processes similar to those observed in upland fields yakutina et al 2015 and failed to establish the relationship between diffuse p loads and water management practices in comparison swat p explicitly reflected that diffuse p loads were influenced by water management schedules and precipitation induced overflow zhang et al 2004 moreover the sedp dominated p loss pattern was also well reflected 4 3 advantages of swat p in paddy fields with large patch sizes the hydrological process and diffuse pollution loading from paddy rice fields have been improved by researchers in eastern asia sakaguchi et al 2014 the original swat model treated paddy fields as upland areas and ponding conditions were not considered therefore the swat model cannot express the actual scenarios in irrigation areas or the hydrological process in fields with large patch sizes leon and kohyama 2017 irrigation and precipitation were immediately converted to surface runoff in swat thus forming dry wet cycles and resulting in the underestimation of stable infiltration processes in paddy fields qiu et al 2017 the deficiency was reflected in simulation results of soil water content fig 6a even auto irrigation was functioned in original swat model the rmse between simulated value and observed value could reach up to 48 1 mm which contradicted with the saturated conditions of paddy soil in comparison swat p provided more insights into the hydrological cycles especially the soil water routines dynamics in paddy fields during paddy rice growth the discrepancy between observed value and simulation value was effectively narrowed and the smoother result also reflected the lasting submerged status of whole growing stage although the calibration and validation results of swat are generally acceptable swat p improves the confidence levels with regard to the soil water routines and diffuse n and p at the hru scale moreover the discrepancy between the monitored soil water content and the swat simulations was further increased for deeper soil profiles which could diminish the impacts of soil leaching due to the underestimation of potential infiltration zhou et al 2011 however swat p still underestimated the soil water content compared to the field monitoring data and the soil was unsaturated during the ponding days fig 6 the probable reasons for this underestimation were the lower estimation of seepage and the drainage flow load during the irrigation period additionally swat p still underestimated the diffuse n load compared to the field monitoring data from paddy fields but were better than the original swat during the freeze thaw period april fig 7 swat p also provided a flexible water management schedule for paddy fields and the computing methods for hydrological cycles and export of diffuse loads were more delicate i e soil water cycle than those provided by the hspf paddy hydrological simulation program fortran and swat apex agricultural policy and environmental extender models jung et al 2014 a detailed description of the ponding level leads to the inaccurate estimation of diffuse pollution loads however soil erosion and diffuse pollution modeling still require further observations and improvements the farmland vertical transport pattern of soil water in typical farmlands during the freeze thaw period has been carefully analyzed s chen et al 2013 and the role of temperature on the soil hydrological process is considered in swat p however the accumulated impact of temperature on the soil water and coming tillage practice is not completely evaluated the scale effect of the patch size and the ridge on the hydrological pattern and diffuse pollution loading is still unclear and requires more field observations 5 conclusions in this study the modified swat model swat p was validated and demonstrated improved performance in the assessment of both stream flow and diffuse pollution loads in watersheds with large paddy patches the original swat model was not efficient in the simulation of soil water due to the simplification of hydrological processes in paddy fields with large patch sizes which subsequently affected the accuracy of infiltration related processes the annual diffuse n and p loads simulated by swat p in paddy fields were within reasonable ranges however the original swat model overestimated the diffuse pollution loads in the freeze thaw period which led to the misidentification of the critical loss stage in comparison swat p was more accurate in identifying the critical stages of n and p losses which helped elucidate the relationship between diffuse pollution loads and water management practices swat p performed better in evaluating diffuse pollution loads and provided an alternative for simulating pollution loads in watersheds with large paddy patches declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the study received financial support from the national key research and development program of china 2016yfd0800500 the national natural science foundation of china grant no 41830643 the land use data were interpreted from landsat images which was downloaded from united states geological survey http glovis usgs gov the weather data was provided by bawujiu farm the soil data were the product of chinese academy of sciences http www soil csdb cn the dem was supported by geospatial data cloud http www gscloud cn appendix a supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2020 104736 
26013,practitioners often employ diverse though not always thoroughly validated numerical models to directly or indirectly estimate wave overtopping q at sloping structures these models broadly classified as either phase resolving or phase averaged each have strengths and limitations owing to the physical schematization of processes within them models which resolve the vertical flow structure or the full wave spectrum i e sea swell ss and infragravity ig waves are considered more accurate but more computationally demanding than those with approximations here we assess the speed accuracy trade off of six well known models for estimating q under shallow foreshore conditions the results demonstrate that i q is underestimated by an order of magnitude when ig waves are neglected ii using more computationally demanding models does not guarantee improved accuracy and iii with empirical corrections to incorporate ig waves phase averaged models like swan can perform on par if not better than phase resolving models but with far less computational effort keywords infragravity wave openfoam bosz xbeach swash swan 1 introduction 1 1 background coastal engineers often employ numerical modelling in the design assessment and rehabilitation of coastal structures to accurately forecast nearshore waves and currents sometimes including the consequences akbar and aliabadi 2013 sierra et al 2010 smith et al 2012 suzuki et al 2017 of particular interest is the extent to which waves reach and pass over the crest of a structure referred to as wave overtopping extreme overtopping events are characterized by considerable flow velocities which impose serious hazards to both people and infrastructure with flooding or coastal inundation as the most critical consequence the integration of numerical modelling in estimating wave overtopping and the design of coastal structures is becoming increasingly more attractive given the progress in available computing power and the ability of numerical models to incorporate both unconventional structure configurations and extreme environmental conditions furthermore as many of the empirical overtopping models e g eurotop 2018 require the incident significant wave height h m 0 t t o e i n and spectral wave period t m 1 0 t o e i n at the toe of the structure as input numerical models are often needed to accurately capture the nonlinear effects associated with the shoaling and breaking of high frequency sea swell ss waves in shallow water altomare et al 2016 mase et al 2013 such effects include a rise in mean water level known as wave induced setup and the growth of low frequency infragravity ig waves fig 1 which not only contribute to h m 0 t t o e i n but also result in higher values of t m 1 0 t o e i n hofland et al 2017 a variety of numerical models which may be broadly classified as phase resolving or phase averaged have been developed for such applications each with strengths and limitations owing to the physical parameterization of processes and the numerical schemes incorporated within them cavaleri et al 2007 vyzikas and greaves 2018 models which attempt to resolve the vertical flow structure and those that consider the full frequency range of nearshore waves i e both ss and ig waves are considered not only more accurate but also more computationally demanding than those which make use of approximations within the phase resolving class of wave models those that resolve the vertical flow structure and solve the fully nonlinear time averaged navier stokes ns equations often referred to as computational fluid dynamics cfd or depth resolving models have the least theoretical limitations and are generally considered the most accurate cfd models such as the mesh based eulerian approach openfoam jasak et al 2007 or mesh less lagrangian approach dualsphysics crespo et al 2015 are able to simulate complex wave problems such as nonbreaking and breaking waves wave current interaction and wave structure interaction from deep to shallow water conditions including the overturning lowe et al 2019 and roller formation of breaking waves higuera et al 2013 however these models require a significant amount of computational effort unless a coupling method is applied altomare et al 2015 altomare et al 2018 verbrugghe et al 2018 thus limiting their application so far to very local phenomena for example wave overtopping as depth resolved fully 3d or 2dv models are generally considered too computationally expensive for operational use the problem may be further simplified by depth averaging these models in which the vertical structure is not directly resolved but only modelled parametrically are referred to as two dimensional in the horizontal 2dh or 1dh where only a cross shore transect is simulated brocchini and dodd 2008 as a result of depth averaging processes such as wave overturning air entrainment and wave generated turbulence are not directly solved those that simulate the amplitude and phase variation of ss waves are often referred to as phase resolving within this type of model there are generally two main sets of governing equations i the non linear shallow water nlsw equations and ii the boussinesq type while the boussinesq type models e g funwave kirby et al 1998 mike21 bouss warren and bach 1992 and bosz roeber and cheung 2012 directly account for the dispersive properties of waves in deeper water the nlsw models assume that waves are non dispersive and are therefore limited to shallow water applications brocchini and dodd 2008 zijlema and stelling 2008 this limitation can be removed by taking a ss wave averaged approach however at the cost of decreased accuracy due to exclusion of ss wave motions the high frequency waves are averaged resulting in only motions at the scale of the wave group thus reducing the computational demand e g xbeach surfbeat xb sb model roelvink and costas 2019 roelvink et al 2009 in order to use the nslw equations for phase resolving simulation of ss wave motions stelling and zijlema 2003 proposed another method to account for dispersion a result of non hydrostatic pressure whereby the pressure is decomposed into non hydrostatic and hydrostatic pressure components e g swash zijlema et al 2011 nhwave ma et al 2012 and xbeach non hydrostatic xb nh smit et al 2010 numerical models this approach improves the dispersive properties without neglecting the higher frequency motions however at the expense of more computational demand the accuracy and range of applicability of the non hydrostatic models may be further enhanced by coarsely dividing the model domain into a fixed number of vertical layers k 3 thereby improving the frequency dispersion e g swash nhwave or xb nh in multi layered mode de ridder 2018 by further increasing the number of vertical layers k 10 models like swash may be extended to the depth resolving class this approach increases the computational demand but allows processes such as undertow and the shoreward flow near the surface to be resolved given that phase resolving models require a grid resolution high enough to resolve the individual ss wave components they are generally computationally feasible only for areas of limited size for large scale modelling of wave motion a phase averaged approach is most commonly used this type of model is constructed on the assumption that a random sea state is composed of a superposition of linear waves whose height is a function of their frequency and direction of propagation for an individual wave train the rate of change of wave energy or action flux is balanced by the wave energy transfer among different wave components in different directions and different frequencies as well as energy input and dissipation with the phase information filtered out these models can use much courser computational grids and therefore be applied to large areas however as individual waves are not resolved these models must be combined with empirical formulae to estimate wave run up and overtopping oosterlo et al 2018 sierra et al 2010 commonly used spectral models in nearshore applications include swan booij et al 1999 and stwave smith et al 2001 these models are generally able to accurately reproduce higher harmonics ss waves however they do not account for the interactions that force ig wave motions cavaleri et al 2007 which tend to dominate in shallow water with respect to previous model comparisons in shallow coastal environments buckley et al 2014 assessed the performance of swash swan and xb sb in predicting ss wave heights h m 0 ss ig wave heights h m 0 ig and setup  across a steep laboratory fringing reef profile varying from 1 5 to 1 18 8 results showed that each model was capable of accurately predicting h m 0 ss however swan failed to simulate the transformation of energy to lower frequencies and thus failed to predict h m 0 ig likewise swan showed considerably more error in its prediction of  compared to swash and xb sb on the other hand xb sb performed comparably well to its phase resolving counterparts in the prediction of nearshore wave heights and surprisingly the extent of wave run up particularly when ig waves dominated at the shoreline lashley et al 2018 from these previous studies the points of discussion that naturally arise are i can phase averaged models like swan be accurately applied under very shallow conditions where ig waves dominate and  is significant ii given that ig waves dominate are models of increasing complexity needed or is a short wave averaged but ig wave resolving approach all that is required and iii while attempts at model comparisons for wave overtopping have been made st germain et al 2014 vanneste et al 2014 no study to date has the full range of model complexity from depth resolving to phase averaged or successfully quantified the accuracy versus speed of these models under irregular wave forcing 1 2 objective in the present study it is our primary aim to quantify the accuracy versus speed of computation of six commonly used nearshore wave models table 1 in their prediction of irregular wave overtopping at sea dikes with very shallow mildly sloping foreshores where ig waves and setup contribute significantly 1 3 outline this paper is organized as follows section 2 provides overviews of the physical and numerical models applied followed by descriptions of key parameters and empirical formulae used in the analysis it ends with a description of the metrics used to quantify model accuracy in section 3 the results of the model data comparisons and the overall influence of ig waves on overtopping are presented and discussed section 4 concludes the paper by summarising the findings acknowledging the present study s limitations and identifying areas for future work 2 methods this section begins with a description of the physical model tests under consideration after which it describes the six numerical models under evaluation including their governing equations and setup details a description on the parameters and metrics used to assess model accuracy and computation speed is then provided finally the additional numerical simulations for comparative analysis are described 2 1 description of the physical models in the present study we consider two specific test cases that were both performed at flanders hydraulics research in a smooth 1 m wide section of their 70 m long and 1 45 m deep wave flume altomare et al 2016 with different deep water wave heights h m 0 t d e e p peak periods t p foreshore slopes m initial water depths at the toe h t o e dike slopes  and dike freeboards r c table 2 these cases were selected to cover a wide range of deep water wave steepness s 0 from very mild s 0 0 007 typical of swell conditions to very steep s 0 0 047 typical of wind sea conditions with relative water depths h t o e h m 0 t d e e p 1 these conditions are considered very shallow hofland et al 2017 both experiments simulated irregular spilling waves with breaker parameter based on m  0 f o r e 0 5 with a duration approximately equal to 500 waves to obtain accurate and comparable estimates of the mean overtopping discharge q romano et al 2015 for the mild swell wave case the variations of water surface elevations were measured using 10 resistance type gauges all synchronously sampling at 50 hz fig 2 a while 6 gauges with a sample frequency of 20 hz were used in the steep wave case fig 2b in the analysis to follow the term offshore is used to refer to gauges 1 to 7 and 1 to 3 of the mild swell and steep wind wave cases respectively and the term nearshore to refer to gauges 8 to 10 and 4 to 6 respectively in either case the term toe refers to the last wave gauge gauge 10 and gauge 6 of the mild swell and steep wind wave cases respectively in both cases the instantaneous overtopping was measured using two balluff micropulse water sensors situated inside the overtopping box and q was then obtained by dividing the total volume of water collected at the end during the test by the total test duration 2 2 description of numerical models in this study six widely used open source numerical wave models are considered for comparative analysis each model is forced at its boundary with still water levels and parametric spectra jonswap to match those observed at the most offshore wave gauge during each physical experiment likewise the smooth flume bottom was represented as either a manning coefficient n of 0 01 s m1 3 or a nikuradse geometrical roughness k s of 0 3 10 3 m in the case of swan a general description of each model is provided in the sections that follow as we investigate two extremes very mild swell and very steep wind waves it is reasonable that some calibration was required for the depth averaged models bosz xb nh and xb sb therefore a description of the main calibration parameters their optimum values and impact on model results is also provided in general calibration was aimed at reducing the error in  and h m 0 t 2 2 1 openfoam the software openfoam is an open source object oriented library composed by solvers and utilities jasak et al 2007 the formers are designed to numerically solve continuum mechanics problems while the latter perform tasks involving data manipulation for the present study the library waves2foam a toolbox capable of generating and absorbing free surface water waves has been adopted currently the method applies the relaxation zone technique active sponge layers and supports a large range of wave theories jacobsen et al 2012 the governing equations for the combined flow of air and water are given by the reynolds averaged navier stokes equations equations 1 and 2 1  u t  u u t p g x   u    t    coupled with the continuity equation 2 for incompressible flow 2 u 0 where u is the velocity field p is the dynamic pressure component  is the density g is the acceleration due to gravity and  is the dynamic molecular viscosity the reynolds stress tensor  is defined as 3  2   t s 2 3 k i where  t is the dynamic eddy viscosity s is the strain rate tensor k is the turbulent kinetic energy per unit mass and i is the identity matrix the last term in equation 1 is the effect of surface tension where  t is the surface tension coefficient and   is the surface curvature jacobsen et al 2012 the track of the free surface is performed by using the vof method hirt and nichols 1981 where the scalar field  is 0 for air 1 for water and any intermediate value is a mixture of the two fluids for the mild and the steep cases two regular slightly different meshes have been generated to account for the differences between the two wave conditions the numerical domains of the mild and steep cases are respectively composed by 49021 and by 70316 cells with a graded mesh both in the x 0 3 0 005 m for the mild 0 1 0 01 m for the steep and in the y 0 05 0 005 m for the mild 0 1 0 01 m for the steep directions in both cases the selected regular and constant mesh allowed for a fair compromise between the computational effort and the accuracy of the results 2 2 2 swash swash is a time domain model for simulating non hydrostatic free surface and rotational flow it solves the nlsw equations with an added non hydrostatic pressure correction term smit et al 2013 4  t u h x 0 5 u t u u x w u z 1  p h p n h x  x x x  x z z 6 w t u w x w w z 1  p n h z  z z z  z x x 7 u x w z 0 where  is the free surface elevation u x z t and w x z t are the horizontal and vertical velocities respectively h is the water depth  is the density of water p h and p n h are the hydrostatic and non hydrostatic pressures respectively and  x x  x z  z z and  z x are the turbulent stresses the model exhibits good linear dispersion up to k h 8 and k h 16 with two and three equidistant sigma vertical layers k respectively its frequency dispersion is further improved by increasing k here the model was applied with k 20 which is sufficient for the phase velocity at the breaking wave front to be computed accurately as such no additional control is required to initiate or terminate wave breaking the vertical pressure gradient was discretized by the standard central differencing scheme with the ilu pre conditioner the standard k  turbulence model is applied to take into account vertical mixing a cross shore grid spacing  x of 0 025 m was specified for the mild swell cases while a coarser resolution  x 0 04 m was needed for the steep wind wave case to maintain model stability this resulted in approximately 330 and 110 grid cells per deep water wavelength l 0  x for the mild swell and steep wind wave cases respectively for phase resolving models l 0  x is typically kept between 50 and 100 by rule of thumb to ensure that the wave components are accurately resolved however as waves propagate in very shallow water the local wavelength becomes much shorter than l 0 thus in order to maintain a reasonable number of grid cells per local wave length these higher than typical grid resolutions l 0  x 330 and 110 were specified it should also be noted that while h m 0 t in the mild swell case showed convergence 3 change compared to higher resolutions at  x 0 04 m the resulting q increased by a factor of 6 with  x 0 025 m this suggests that wave run up and overtopping at the dike were particularly sensitive to the grid resolution rijnsdorp et al 2017 proposed a sub grid approach to improve model efficiency where vertical accelerations and non hydrostatic pressures are resolved on a relative course grid while the horizontal velocities and turbulent stresses are resolved on a much finer sub grid this approach was attempted here however the simulations failed due to instabilities 2 2 3 bosz the bosz wave model which is freely available upon request from the developers computes hazardous free surface flow problems ranging from near field tsunamis to extreme swell ranges generated by hurricanes it solves the following re formulated depth integrated boussinesq equations of nwogu 1993 in conservative form 8 h t h u x z  2 2 h 2 6 h u x x z  h 2 h h u x x x 0 9 h u t h u 2 1 2 g h 2 x g h h x u z  2 2 h 2 6 h u x x z  h 2 h h u x x x h z  z  2 u t x x h u t x x  0 where h h  is the flow depth u is the horizontal flow velocity defined at a reference depth z  0 55502 h simarro et al 2013 and  the bottom shear in terms of the manning coefficient the governing equations exhibit good dispersion accuracy up to k h  given the difficulty of boussinesq equations in handling flow discontinuities such as with breaking waves the model deactivates the dispersion terms during wave breaking and makes use of the underlying nlsw equations where the breaking wave is then approximated as a bore or hydraulic jump wave breaking and the deactivation of the dispersion terms occurs in the model based on the momentum gradient 10 h  u x b g h  where b is a calibration coefficient by default 0 5 here b 0 8 produced the best agreement between model and observations for both cases this suggests that under these particularly shallow conditions the wave face becomes very steep prior to breaking for a detailed overview of the model s sensitivity to this parameter the reader is pointed to roeber et al 2010 all other model parameters were kept at their default values the grid resolution l 0 d x was set as 200 for the mild swell wave case but was reduced to 60 for the steep wind wave case to ensure model stability for the steep wave case higher grid resolutions and lower b values led to instabilities in the form of strong oscillations in surface elevation in the breaking region this phenomenon explored extensively by kazolea and ricchiuto 2018 is due to the model s hybrid approach to handling wave breaking that is where the boussinesq equations are reduced to the nlsw equations during wave breaking it should be noted that boussinesq wave models which take a different eddy viscosity approach to wave breaking reportedly show less sensitivity to the grid size kazolea and ricchiuto 2018 however this was not evaluated here 2 2 4 xbeach non hydrostatic like swash xb nh solves the nlsw equations with a non hydrostatic pressure correction term equations 4 7 here xbeach version 1 235527 also known as the xbeachx release is applied in reduced simplified two layer mode where the non hydrostatic pressure is assumed constant in the lower first layer de ridder 2018 the water depth is divided into two layers with heights z 1  h and z 2 1  h where  is the layer distribution the resulting layer averaged velocities u 1 and u 2 are transformed to a depth averaged velocity u and a velocity difference u due to the simplified non hydrostatic pressure in the lower layer the vertical velocity between layers is neglected therefore only the continuity relation for the upper second layer is required 11 x 1  h u 1  h  u 2 w 2 u 2  x u 1 z 1 x 0 where w 2 is the vertical velocity in the upper second layer to determine the water elevation the global continuity equation is applied 12  t h u x 0 in order to control the computed location and magnitude of depth limited wave breaking a hydrostatic front approximation is applied with this the pressure distribution under breaking waves is considered hydrostatic when the local surface steepness exceeds a maximum prescribed value  0 4 by default 13  t  here  0 9 and 0 7 produced the best agreement between the model and observations for the mild and steep wave cases respectively this further supports the statement that for very shallow foreshores the waves become particularly steep before breaking all other model parameters were kept at their default values additionally the grid resolution l 0  x was set to 200 and 180 for the two respective cases 2 2 5 xbeach surfbeat xb sb solves ss wave motions using the wave action equation with time dependent forcing similar to that of the hiswa model holthuijsen et al 1989 the model represents the ss wave frequency spectrum by a single frequency f r e p and the wave action equation is applied at the timescale of the wave group 14 a t c g x a x d w  15 a x t s w x t  x t 16  g k tanh k h where a is the wave action s w is the wave energy density  is the intrinsic wave frequency k is the wave number d w is a dissipation term to account for wave breaking and c g x is the wave action propagation speed in the cross shore direction to simulate wave breaking xb sb applies a dissipation model roelvink 1993 by default for use with ss wave groups and a roller model nairn et al 1990 svendsen 1984 to represent momentum stored in surface rollers which results in a shoreward delay in wave forcing the radiation stress gradients that result from these variations in wave action exert forces on the water column and drive ig waves and unsteady currents which are solved by the nlsw equations equations 4 7 therefore the model directly simulates wave driven currents and the run up and overtopping of ig waves 17 d w 2  t r e p q b e w h r m s h 18 q b 1 exp h r m s h m a x 10 where d w is the total directionally integrated wave energy dissipation due to breaking t r e p 1 f r e p is the representative wave period and q b is the fraction of breaking waves the root mean square ss wave height h r m s 8 e w  g the maximum wave height h m a x  r h e w is the wave group varying ss wave energy  is a dissipation by default 1 and  r is the ratio of breaking waves to local water depth by default 0 55 but typically used for calibration here  r 0 45 and 0 65 provided the best agreement between the model and observations for the mild swell and steep wind wave cases respectively xb sb does not directly produce the ss wave component of the energy density spectrum instead it computes the change in ss wave energy as a change in the bulk h r m s parameter as described above in order to produce a complete energy density c   spectrum at each gauge location a jonswap distribution was assumed around the peak frequency f p where 8 f p 2 2 c   d f h r m s this ss wave spectrum fig 3 b was then combined with the ig wave spectrum fig 3a obtained directly from the computed surface elevation to produce the complete spectrum fig 3c for the mild swell wave case the grid resolution was varied such that it increased shoreward this reduced computation time while ensuring that the steep dike slope was accurately captured as such l 0  x varied from 25 offshore to 160 at the dike in the mild wave case and from 45 to 90 in the steep wave case 2 2 6 swan swan is a third generation phase averaged wave model used to estimate the generation by wind propagation and dissipation by depth induced breaking and bottom friction of waves from deep water to the surf zone this includes wave wave interactions in both deep and shallow water and wave induced setup but neglects wave induced currents and the generation or propagation of ig waves like xb sb swan computes the spectral evolution of a in space and time this is done in a manner similar to equation 14 however unlike xb sb which makes use of a single representative frequency swan takes the frequency distribution of action density into account to simulate depth limited wave breaking swan uses the following parametric dissipation model by default battjes and janssen 1978 battjes and janssen 19 d w  4  g f m e a n q b h m a x 2 and q b is estimated as 20 1 q b ln q b 8 e t o t h m a x 2 where f m e a n is the mean wave frequency h m a x  b j h and e t o t is the total wave energy variance here  b j 0 73 default value provided good agreement between the model and observations for both the mild swell and steep wind wave cases for both wave cases a constant grid spacing of 0 25 m was applied this corresponded to l 0  x 30 for the mild wave case and l 0  x 20 for the steep wave case 2 3 data processing and analysis 2 3 1 mean water level the mean water level  was calculated by taking the average of the surface elevation  t at each gauge location relative to the elevation of the dike toe the wave induced setup  was then obtained as the difference between  at each gauge location and  at the most offshore gauge 2 3 2 separation of infragravity and sea swell waves the time series of  t were further analysed using the welch s average periodogram method and a hann filter with a 50 maximum overlap the resulting one dimensional spectra of wave energy density c   f with 30o of freedom percival and walden 1993 were then used to determine h m 0 t h m 0 s s and h m 0 i g as follows 21 h m 0 t 4 0 005 2 c   d f 22 h m 0 s s 4 f p 2 2 c   d f and 23 h m 0 i g 4 0 005 f p 2 c   d f where half the peak frequency f p 2 1 2 t p is taken as the cut off to separate ss and ig motions roelvink and stive 1989 this choice of cut off frequency is based on the tendency that in deep water the majority of ss wave energy is found at frequencies f p 2 while the majority of ig wave energy lies at frequencies f p 2 2 3 3 spectral wave period in addition to wave heights the spectral wave period t m 1 0 at each gauge location was calculated as follows 24 t m 1 0 m 1 m 0 where 25 m n 0 005 2 c   f n d f 2 3 4 empirical estimate of the incident infragravity waves as swan neglects the contribution of ig waves to the total wave incident height at the dike toe h m 0 t t o e i n we apply an empirical correction proposed by lashley et al forthcoming using a dataset of 672 xbeach simulations an empirical formula for the relative magnitude of the ig waves h i g was derived with influence factors to account for variations in offshore wave directional spreading   h t o e  h cot m  f vegetation  v and cot   d 26 h i g 0 36 h m 0 t d e e p 0 5    h  f  v  d for an incident waves analysis i e without the influence of the dike slope with no directional spreading 1d flume conditions or vegetation    v and  d 1 while 27  h 1 04 exp 1 4 h t o e 0 9 exp 0 19 h t o e and 28  f 1 56 3 09 cot m 0 44 as h i g represents the ratio of ig to ss waves h m 0 i g t o e i n can be obtained from a swan estimate of h m 0 s s t o e i n 29 h m 0 i g t o e i n h i g h m 0 s s t o e i n finally a corrected estimate of h m 0 t t o e i n was obtained as follows 30 h m 0 t t o e i n h m 0 s s t o e i n 2 h m 0 i g t o e i n 2 2 3 5 empirical wave overtopping while the fully phase averaged models like swan are to some extent able to estimate nearshore wave conditions they cannot directly simulate wave overtopping as this requires that the individual waves be resolved in order to estimate wave overtopping these models can be and are often combined with well established empirical models that require wave parameters at the dike toe as input in the present study the eurotop 2018 formulae based on the work of van gent 1999 and altomare et al 2016 for very shallow foreshores are applied in combination with swan for smooth dikes under perpendicular wave attack with h t o e h m 0 t d e e p 1 5 31 q g h m 0 t t o e i n 3 10 0 79 exp r c h m 0 t t o e i n 0 33 0 022  m 1 0 with 32  m 1 0 tan  s f h m 0 t t o e i n l m 1 0 33 l m 1 0 g t m 1 0 t o e i n 2 2  34 tan  s f 1 5 h m 0 t t o e i n r u 2 1 5 h m 0 t t o e i n h t o e m h t o e r u 2 cot  35 r u 2 h m 0 t t o e i n 4 1 5  m 1 0 where g is the gravitational constant of acceleration  is the dike slope  s f is an equivalent slope to account for waves breaking on the foreshore and t m 1 0 t o e i n is the spectral wave period at the dike toe based on the incident waves i e without the influence of waves reflected at the dike it should be noted that  m 1 0 and r u 2 are obtained iteratively until r u 2 converges with a first estimate of r u 2 1 5 h m 0 t t o e i n additionally as swan excludes the contribution of ig waves corrected estimates of t m 1 0 t o e are typically obtained using equations 36 and 37 hofland et al 2017 as outlined in the eurotop 2018 manual 36 t m 1 0 t o e i n t m 1 0 d e e p 1 6 exp 4 h exp h where 37 h h t o e h m 0 t d e e p cot m 100 0 2 2 3 6 error metrics in order to compare the performance of the numerical models we assess the mean relative accuracy in an approach similar to that of lynett et al 2017 38 m e a n r a t i o  1 n i 1 n  m o d i  o b s i where  is a stand in for the parameter under consideration  h m 0 t h m 0 s s h m 0 i g and t m 1 0 for the n wave gauge locations and subscripts m o d and o b s refer to model predictions and observations made during the physical experiment respectively here we make a distinction between gauges offshore and nearshore fig 2 a mean ratio of 1 suggests perfect agreement between the model and observations while values higher or lower than one indicate over or under predictions respectively it should be noted that all wave gauges offshore and at the dike toe see fig 2 are considered in equation 38 while the focus of this study is primarily at the dike toe it is important to assess the model performance offshore to ensure that i the boundary conditions are correctly modelled and ii that no significant numerical dissipation occurs in deep water as a result of a coarse grid resolution for example finally the performance of each model for wave overtopping was assessed by comparing the simple ratio of modelled to observed q and the absolute relative error in the prediction of q 39 a b s o l u t e r e l a t i v e e r r o r q 1 q m o d q o b s 2 3 7 computation speed two work stations ws were used to carry out this research table 3 given the required computational effort the openfoam simulations were performed on ws a while the other models were run on ws b to assess computation speed the duration of each simulation in wall clock time was recorded 3 results and discussions in this section the results of the model data comparisons are presented and discussed as wave overtopping is the end result of wave propagation the performance of each model for the prediction of mean water levels wave heights and periods is first assessed for the models where calibration was carried out bosz xb nh and xb sb both default and calibrated results are presented note that no parameter tuning was done for the depth resolving models openfoam and swash as wave breaking is intrinsically resolved likewise swan with default settings showed reasonable agreement and was therefore not calibrated lastly it should be noted that the bosz simulation of the steep wind wave case with default settings resulted in instabilities see section 2 2 3 and is therefore not included in the analysis 3 1 mean water level each model excluding openfoam is able to accurately within 15 error and consistently reproduce  for both the mild swell fig 4 a and steep wind wave fig 4b cases this includes the increase in  nearshore referred to as wave induced setup  highlighted in fig 5 with the xb nh results representing the general behaviour of the numerical models note that the vertical axes limits of fig 4 are set for an easy comparison with the other modelled versus observed plots that follow while openfoam agrees well with the observations for the mild swell case it overestimates  offshore gauges 2 and 3 and underestimates  nearshore gauges 4 to 6 for the steep wind wave case fig 5 this may be indicative of premature wave breaking in openfoam the satisfactory performance of bosz and xb nh observed here fig 4 is in contrast with previous studies lashley et al 2018 zhang et al 2019 which found that depth averaged models were unable to accurately estimate  due to their lack of vertical resolution and exclusion of wave roller dynamics however the difference in model performance here is likely due to the spilling nature of the waves  0 f o r e 0 23 and 0 13 for the mild swell and steep wind wave cases respectively compared to the plunging waves and steep fore reef slopes assessed by lashley et al 2018  0 f o r e 1 1 and zhang et al 2019  0 f o r e 1 29 that is while resolving the vertical structure of flow may be critical for plunging breakers depth averaged models are able to perform well under spilling waves there is also a notable difference in the observed maximum  between the mild swell  0 004 m and steep wind wave  0 015 m cases fig 5 this substantial increase in  as h t o e h m 0 t d e e p decreases agrees with the findings of gourlay 1996 on shallow reefs and suggests that  which contributes to wave run up stockdon et al 2006 and by extension overtopping increases proportionally as foreshores become more shallow or as deep water wave conditions become more energetic 3 2 significant wave height swash bosz xb nh and xb sb are able to reproduce h m 0 t both offshore and nearshore within 15 error for two cases fig 6 on the other hand openfoam and swan both show notable differences with swan consistently and considerably underestimating h m 0 t nearshore while swan is able to accurately simulate the propagation of high frequency waves h m 0 s s fig 7 it does not compute the low frequency waves h m 0 i g fig 8 and therefore underestimates h m 0 t nearshore where the contribution of ig waves is significant fig 6 the relatively high standard deviation associated with swan s nearshore h m 0 s s estimates is due to its exclusion of wave reflection in the physical model the superposition of the incident and reflected waves results in a nodal anti nodal pattern with a maximum at the dike outsets in fig 9 a and fig 10 a as swan excludes the reflected component the model underestimates h m 0 s s immediately in front of the dike where the incident and reflected waves add up on the other hand this shortcoming makes swan especially suitable for use with the empirical overtopping models that require incident wave conditions as input swan also predicts a higher and lower maxima in h m 0 s s just before breaking than xb nh for the mild swell fig 9a and steep wind wave fig 10a cases respectively this is likely due to the dissipation model employed by swan equation 19 tuning  b j the parameter which controls the maximum wave height to water depth ratio in swan would yield better agreement between the two models however as there were no wave gauges in this region it is difficult to ascertain which model is correct here with respect to openfoam the model shows inconsistent results between the two cases under the mild swell conditions openfoam underestimates h m 0 t nearshore fig 6a however for the steep wind wave case the model overestimates h m 0 t nearshore fig 6b in both cases the model appears to be too dissipative resulting in a reduction in h m 0 s s offshore for the mild swell case this dissipation is minor resulting in a consistent under prediction of h m 0 s s figs 7a and 9a and h m 0 i g figs 8a and 9b under the steep wind wave conditions however the dissipation is significant this observation combined with the overestimation of  offshore fig 5 indicates premature wave breaking in openfoam this reduction in h m 0 s s offshore results in unbroken ss waves reaching the dike and the overestimation of h m 0 s s nearshore figs 7b and 10a xb nh also shows some numerical dissipation offshore but this is negligible compared to that of openfoam fig 10a the wave damping along the flume by openfoam was already found by other authors conde 2019 and is popular among the user community previous works larsen et al 2019 and this contribution suggest that a more refined mesh by increasing the number of cells per wave height may improve the wave form modelling during the wave propagation however a reduction in grid size for the steep wind wave case here did not significantly improve the openfoam model results though swash is able to accurately predict h m 0 i g it underestimated h m 0 s s nearshore in both cases this is possibly due to the standard k  turbulence model applied in multi layered mode which may overestimate the turbulent vertical viscosity similar to openfoam a reduction in grid size from 0 04 m to 0 025 m did not significantly improve the estimates 3 change in h m 0 s s while calibration generally improved model performance for  fig 4 h m 0 t fig 6 and h m 0 i g fig 8 it resulted in the overestimation of h m 0 s s nearshore by xb sb fig 7 this is as a result of tuning  r equation 18 which affects both the maximum h m 0 s s and h m 0 i g perhaps a different approach where  equation 17 the parameter that controls the magnitude of dissipation is calibrated lashley et al 2018 would yield better results however as xb sb predicts ig wave overtopping only the loss in accuracy for h m 0 s s to improve h m 0 i g predictions was considered acceptable 3 3 spectral wave period swash xb nh and xb sb show good agreement between modelled and observed t m 1 0 predictions while swan openfoam and bosz show notable deviations as the accurate prediction of t m 1 0 requires the models to correctly represent the distribution of wave energy by frequency equation 25 we assess the modelled versus observed wave spectra fig 12 and fig 13 swash bosz xb nh and xb sb correctly capture the shift in peak energy density c   from the ss wave figs 12a and 13a to the ig wave band figs 12b and 13b however bosz overestimates the magnitude of the ig peak and shows it at slightly lower frequencies than observed this coupled with a minor underestimation of the ss wave energy most evident for the mild swell case fig 12b results in an overestimation of t m 1 0 the consistent underestimation of t m 1 0 by swan is expected due to its exclusion of c   at ig frequencies figs 12b and 13b openfoam on the other hand does show a shift in energy from offshore to the dike toe however it shows two distinct ig peaks figs 12b and 13b not present in the observations in the mild swell case this misrepresentation of c   at ig frequencies couple with the underestimation of c   in the ss wave band resulted in the significant overestimation of t m 1 0 nearshore fig 11a under the steep wind wave conditions openfoam also shows considerable c   in the ss wave band nearshore while the observed spectra shows very little fig 13b this further supports the argument that due to premature wave decay in the model some unbroken ss waves are able to reach the dike 3 4 wave overtopping 3 4 1 general an important remark is the difference in the observed q between the mild swell 0 094 l s per m and steep wind wave 0 205 l s per m cases despite having similar h m 0 s s t o e values 0 039 m figs 9 and 0 038 m fig 10a for the mild swell and steep wind wave cases respectively the steep wave case with a higher r c and lower h t o e table 2 produces double the q this observation suggests that the nonlinear effects of wave breaking that is the generation of ig waves and wave induced setup contribute significantly to the resulting overtopping discharge while the effects of vegetation are not considered here this observation highlights a potential limitation in studies that assess the effectiveness of shallow foreshores but focus only on the attenuation of h m 0 s s and neglect the contribution of h m 0 i g vuik et al 2016 yang et al 2012 to further investigate the influence of the ig waves we compare the overtopping estimated using swan and eurotop 2018 with and without the corrections to h m 0 i g t o e i n and t m 1 0 t o e i n obtained through equations 29 and 36 respectively under the mild swell wave conditions the ratio h i g 0 5 equation 29 and the contribution of h m 0 i g t o e i n to h m 0 t t o e i n is minor table 4 on the other hand including the ig waves resulted in a 2 5 fold increase in t m 1 0 t o e i n and magnitude 4 fold increase in the predicted q compared to the original swan estimates the difference is more striking for the steep wave case where the ig waves dominate at the dike toe h i g 0 92 the inclusion of the ig waves resulted in 36 increase in h m 0 t t o e i n a 5 fold increase in t m 1 0 t o e i n and an order of magnitude increase in the predicted q furthermore the original swan estimates without any corrections to t m 1 0 t o e i n and h m 0 t t o e i n erroneously show a decrease in q between the mild swell and steep wind wave cases while the observations show a notable increase these results further emphasize the danger of neglecting the ig wave contribution demonstrated here by the correction of input to the empirical formulae in the design and assessment of coastal structures with very shallow foreshores considering the wider model comparison each model with the exception of bosz fails to reproduce the overtopping for the mild swell case fig 14 this is particularly evident for xb sb which significantly underestimates q for both wave cases this suggests that while xb sb may estimate wave run up accurately in ig wave dominant environments lashley et al 2018 it s exclusion of the ss wave component considerably limits its performance for wave overtopping compared to the depth resolving models xb nh and bosz both swash and openfoam show larger errors in wave overtopping predictions fig 14 while the performance of openfoam may be attributed to its misrepresentation of nearshore waves and periods sections 3 2 and 3 3 the performance of swash particularly under mild swell conditions is somewhat surprising since it performed reasonably well in the prediction of  h m 0 and t m 1 0 in both cases here and has been previously successful in one layered mode suzuki et al 2017 however suzuki et al 2017 focused on obtaining good agreement at the toe the last wave gauge only and the resulting q in their tuning of swash therefore q was not assessed unless wave heights and periods at the toe were within a certain accuracy range regardless of the input offshore conditions whereas here we assess the model s general performance for wave propagation both offshore and nearshore in addition to q the models do however perform considerably better for the steep wave case this is consistent with the findings of roelvink et al 2018 and suzuki et al 2017 who showed that xb nh and swash respectively were more accurate for higher overtopping rates but suffered for rates below 0 08 0 16 l s per m in model scale the improvement in swan with the corrections is most evident for the steep wave case with the estimated q now on par with that of bosz and outperforming the other more physically complex models fig 15 shows the modelled relative overtopping discharge q g h m 0 t t o e i n 3 versus the relative freeboard r c h m 0 t t o e i n 0 33 0 022  m 1 0 s f where h m 0 t t o e i n and t m 1 0 to compute  m 1 0 s f are taken from table 4 if we take the 5 exceedance lines of the eurotop 2018 formula equation 31 fig 15 as the general range of acceptable overtopping predictions openfoam mild swell case swash steep wind wave case bosz xb nh and swan with corrections are all reasonable as most of the models performed reasonably well for wave propagation the excellent agreement between bosz and the observed q is likely not dependent on underlying governing equations boussinesq versus nlsw but more to do with how the shoreline and wave run up are treated numerically however an in depth analysis of the various numerical schemes implemented in each numerical model was beyond the scope of this study 3 4 2 accuracy versus speed in contrast with the general assumption that models of increasing physical complexity produce more accurate results fig 16 shows no clear relationship between computational demand simulation time and the absolute relative error in overtopping furthermore the depth resolving models swash and openfoam which have significantly higher simulation times show larger errors than the depth averaged models xb nh and bosz the phase averaged models xb sb and swan original despite their considerable speed advantage significantly underestimated the overtopping discharge due to their exclusion of higher and lower frequency wave components respectively however by including the ig waves empirically swan s performance improved significantly now within acceptable limits and on par with those of xb nh and bosz but at little to no computational cost fig 16 it should be noted that the use of swan with equation 36 is already the recommended approach in eurotop 2018 the novelty here is the further improvement in results offered by equation 29 4 conclusion in the present study we assess the ability of 6 widely used numerical models to simulate waves overtopping steep dikes with mildly sloping shallow foreshores however with the exception of openfoam and to some extent swash k 10 the above phase resolving models were originally developed to simulate wave evolution over mildly sloping foreshores and not specifically for wave run up and overtopping of steep structure slopes since their development the phase resolving models have each been successfully applied to simulate wave propagation over steep reefs and run up of relatively steep beaches likewise depth resolving models like openfoam and swash k 10 were originally developed to simulate wave structure interaction and not specifically for wave propagation in the present study we tested the ability of these models in both applications i wave evolution over a shallow mildly sloping foreshore and ii the resulting overtopping discharge overall bosz and xb nh under steep wind waves showed high skill in both applications with a reasonable computational demand while openfoam with a much higher computational demand showed difficulty in performing both functions the broad implication of the present work is that higher resolution more computationally demanding wave models may simply not be needed specifically where the analysis is focused on bulk time averaged physical quantities h m 0 t m 1 0 and q as shown here should more detail be required for example estimates of the vertical velocity profile or turbulence then a depth resolving model such as swash k 10 or openfoam should be applied moreover swash k 10 and openfoam are likely to perform well if the computational domain begins at the dike toe and ends at the overtopping box i e where simulating wave propagation over a large distance is not required in addition our results showed that with simple empirical corrections phase averaged models like swan can perform on par if not better than phase resolving models with much less computational effort importantly our work emphasizes the importance of including ig waves in the design and assessment of coastal dikes as neglecting their contribution to h m 0 t t o e and t m 1 0 t o e can lead to under predictions in q of up to two orders of magnitude given the scope of the model comparison including both phase resolving and phase averaged a detailed wave by wave comparison of the higher resolution models was not carried out future work should address this and investigate the influence of the various numerical schemes implemented in the respective numerical models as this was not within the scope of the present work additionally equations 31 and 36 were developed in part using the wider dataset from which these cases were taken therefore their performance under different conditions is still to be confirmed despite these limitations the findings here can aid practitioners in their decision making specifically in deciding which numerical model should be applied based on the level of accuracy required software availability openfoam developed by opencfd ltd the software package is freely available from https www openfoam com swash developed at delft university of technology the model is available freely from http swash sourceforge net download download htm bosz developed at the universit de pau et des pays de l adour the model is freely available under request from volker roeber univ pau fr xbeach non hydrostatic and xbeach surfbeat developed by ihe delft deltares delft university of technology and the university of miami both models are freely available from https oss deltares nl web xbeach download swan developed at delft university of technology the third generation wave model is freely available from http swanmodel sourceforge net download download htm declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work is part of the perspectief research programme all risk with project number p15 21 which is partly financed by nwo domain applied and engineering sciences in collaboration with the following private and public partners the dutch ministry of infrastructure and water management rws deltares stowa the regional water authority noorderzijlvest the regional water authority vechtstromen it fryske gea hkv consultants natuurmonumenten and waterboard hhnk dr corrado altomare acknowledges funding from the european union s horizon 2020 research and innovation programme under the marie sklodowska curie grant agreement no 792370 volker roeber acknowledges financial support from the isite program energy environment solutions e2s the communaut d agglomration pays basque capb and the communaut rgion nouvelle aquitaine crna for the chair position hpc waves and the european union s horizon 2020 research and innovation programme the authors also acknowledge akshay patil for his incite and efforts towards the success of the research appendix a supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2020 104740 
26013,practitioners often employ diverse though not always thoroughly validated numerical models to directly or indirectly estimate wave overtopping q at sloping structures these models broadly classified as either phase resolving or phase averaged each have strengths and limitations owing to the physical schematization of processes within them models which resolve the vertical flow structure or the full wave spectrum i e sea swell ss and infragravity ig waves are considered more accurate but more computationally demanding than those with approximations here we assess the speed accuracy trade off of six well known models for estimating q under shallow foreshore conditions the results demonstrate that i q is underestimated by an order of magnitude when ig waves are neglected ii using more computationally demanding models does not guarantee improved accuracy and iii with empirical corrections to incorporate ig waves phase averaged models like swan can perform on par if not better than phase resolving models but with far less computational effort keywords infragravity wave openfoam bosz xbeach swash swan 1 introduction 1 1 background coastal engineers often employ numerical modelling in the design assessment and rehabilitation of coastal structures to accurately forecast nearshore waves and currents sometimes including the consequences akbar and aliabadi 2013 sierra et al 2010 smith et al 2012 suzuki et al 2017 of particular interest is the extent to which waves reach and pass over the crest of a structure referred to as wave overtopping extreme overtopping events are characterized by considerable flow velocities which impose serious hazards to both people and infrastructure with flooding or coastal inundation as the most critical consequence the integration of numerical modelling in estimating wave overtopping and the design of coastal structures is becoming increasingly more attractive given the progress in available computing power and the ability of numerical models to incorporate both unconventional structure configurations and extreme environmental conditions furthermore as many of the empirical overtopping models e g eurotop 2018 require the incident significant wave height h m 0 t t o e i n and spectral wave period t m 1 0 t o e i n at the toe of the structure as input numerical models are often needed to accurately capture the nonlinear effects associated with the shoaling and breaking of high frequency sea swell ss waves in shallow water altomare et al 2016 mase et al 2013 such effects include a rise in mean water level known as wave induced setup and the growth of low frequency infragravity ig waves fig 1 which not only contribute to h m 0 t t o e i n but also result in higher values of t m 1 0 t o e i n hofland et al 2017 a variety of numerical models which may be broadly classified as phase resolving or phase averaged have been developed for such applications each with strengths and limitations owing to the physical parameterization of processes and the numerical schemes incorporated within them cavaleri et al 2007 vyzikas and greaves 2018 models which attempt to resolve the vertical flow structure and those that consider the full frequency range of nearshore waves i e both ss and ig waves are considered not only more accurate but also more computationally demanding than those which make use of approximations within the phase resolving class of wave models those that resolve the vertical flow structure and solve the fully nonlinear time averaged navier stokes ns equations often referred to as computational fluid dynamics cfd or depth resolving models have the least theoretical limitations and are generally considered the most accurate cfd models such as the mesh based eulerian approach openfoam jasak et al 2007 or mesh less lagrangian approach dualsphysics crespo et al 2015 are able to simulate complex wave problems such as nonbreaking and breaking waves wave current interaction and wave structure interaction from deep to shallow water conditions including the overturning lowe et al 2019 and roller formation of breaking waves higuera et al 2013 however these models require a significant amount of computational effort unless a coupling method is applied altomare et al 2015 altomare et al 2018 verbrugghe et al 2018 thus limiting their application so far to very local phenomena for example wave overtopping as depth resolved fully 3d or 2dv models are generally considered too computationally expensive for operational use the problem may be further simplified by depth averaging these models in which the vertical structure is not directly resolved but only modelled parametrically are referred to as two dimensional in the horizontal 2dh or 1dh where only a cross shore transect is simulated brocchini and dodd 2008 as a result of depth averaging processes such as wave overturning air entrainment and wave generated turbulence are not directly solved those that simulate the amplitude and phase variation of ss waves are often referred to as phase resolving within this type of model there are generally two main sets of governing equations i the non linear shallow water nlsw equations and ii the boussinesq type while the boussinesq type models e g funwave kirby et al 1998 mike21 bouss warren and bach 1992 and bosz roeber and cheung 2012 directly account for the dispersive properties of waves in deeper water the nlsw models assume that waves are non dispersive and are therefore limited to shallow water applications brocchini and dodd 2008 zijlema and stelling 2008 this limitation can be removed by taking a ss wave averaged approach however at the cost of decreased accuracy due to exclusion of ss wave motions the high frequency waves are averaged resulting in only motions at the scale of the wave group thus reducing the computational demand e g xbeach surfbeat xb sb model roelvink and costas 2019 roelvink et al 2009 in order to use the nslw equations for phase resolving simulation of ss wave motions stelling and zijlema 2003 proposed another method to account for dispersion a result of non hydrostatic pressure whereby the pressure is decomposed into non hydrostatic and hydrostatic pressure components e g swash zijlema et al 2011 nhwave ma et al 2012 and xbeach non hydrostatic xb nh smit et al 2010 numerical models this approach improves the dispersive properties without neglecting the higher frequency motions however at the expense of more computational demand the accuracy and range of applicability of the non hydrostatic models may be further enhanced by coarsely dividing the model domain into a fixed number of vertical layers k 3 thereby improving the frequency dispersion e g swash nhwave or xb nh in multi layered mode de ridder 2018 by further increasing the number of vertical layers k 10 models like swash may be extended to the depth resolving class this approach increases the computational demand but allows processes such as undertow and the shoreward flow near the surface to be resolved given that phase resolving models require a grid resolution high enough to resolve the individual ss wave components they are generally computationally feasible only for areas of limited size for large scale modelling of wave motion a phase averaged approach is most commonly used this type of model is constructed on the assumption that a random sea state is composed of a superposition of linear waves whose height is a function of their frequency and direction of propagation for an individual wave train the rate of change of wave energy or action flux is balanced by the wave energy transfer among different wave components in different directions and different frequencies as well as energy input and dissipation with the phase information filtered out these models can use much courser computational grids and therefore be applied to large areas however as individual waves are not resolved these models must be combined with empirical formulae to estimate wave run up and overtopping oosterlo et al 2018 sierra et al 2010 commonly used spectral models in nearshore applications include swan booij et al 1999 and stwave smith et al 2001 these models are generally able to accurately reproduce higher harmonics ss waves however they do not account for the interactions that force ig wave motions cavaleri et al 2007 which tend to dominate in shallow water with respect to previous model comparisons in shallow coastal environments buckley et al 2014 assessed the performance of swash swan and xb sb in predicting ss wave heights h m 0 ss ig wave heights h m 0 ig and setup  across a steep laboratory fringing reef profile varying from 1 5 to 1 18 8 results showed that each model was capable of accurately predicting h m 0 ss however swan failed to simulate the transformation of energy to lower frequencies and thus failed to predict h m 0 ig likewise swan showed considerably more error in its prediction of  compared to swash and xb sb on the other hand xb sb performed comparably well to its phase resolving counterparts in the prediction of nearshore wave heights and surprisingly the extent of wave run up particularly when ig waves dominated at the shoreline lashley et al 2018 from these previous studies the points of discussion that naturally arise are i can phase averaged models like swan be accurately applied under very shallow conditions where ig waves dominate and  is significant ii given that ig waves dominate are models of increasing complexity needed or is a short wave averaged but ig wave resolving approach all that is required and iii while attempts at model comparisons for wave overtopping have been made st germain et al 2014 vanneste et al 2014 no study to date has the full range of model complexity from depth resolving to phase averaged or successfully quantified the accuracy versus speed of these models under irregular wave forcing 1 2 objective in the present study it is our primary aim to quantify the accuracy versus speed of computation of six commonly used nearshore wave models table 1 in their prediction of irregular wave overtopping at sea dikes with very shallow mildly sloping foreshores where ig waves and setup contribute significantly 1 3 outline this paper is organized as follows section 2 provides overviews of the physical and numerical models applied followed by descriptions of key parameters and empirical formulae used in the analysis it ends with a description of the metrics used to quantify model accuracy in section 3 the results of the model data comparisons and the overall influence of ig waves on overtopping are presented and discussed section 4 concludes the paper by summarising the findings acknowledging the present study s limitations and identifying areas for future work 2 methods this section begins with a description of the physical model tests under consideration after which it describes the six numerical models under evaluation including their governing equations and setup details a description on the parameters and metrics used to assess model accuracy and computation speed is then provided finally the additional numerical simulations for comparative analysis are described 2 1 description of the physical models in the present study we consider two specific test cases that were both performed at flanders hydraulics research in a smooth 1 m wide section of their 70 m long and 1 45 m deep wave flume altomare et al 2016 with different deep water wave heights h m 0 t d e e p peak periods t p foreshore slopes m initial water depths at the toe h t o e dike slopes  and dike freeboards r c table 2 these cases were selected to cover a wide range of deep water wave steepness s 0 from very mild s 0 0 007 typical of swell conditions to very steep s 0 0 047 typical of wind sea conditions with relative water depths h t o e h m 0 t d e e p 1 these conditions are considered very shallow hofland et al 2017 both experiments simulated irregular spilling waves with breaker parameter based on m  0 f o r e 0 5 with a duration approximately equal to 500 waves to obtain accurate and comparable estimates of the mean overtopping discharge q romano et al 2015 for the mild swell wave case the variations of water surface elevations were measured using 10 resistance type gauges all synchronously sampling at 50 hz fig 2 a while 6 gauges with a sample frequency of 20 hz were used in the steep wave case fig 2b in the analysis to follow the term offshore is used to refer to gauges 1 to 7 and 1 to 3 of the mild swell and steep wind wave cases respectively and the term nearshore to refer to gauges 8 to 10 and 4 to 6 respectively in either case the term toe refers to the last wave gauge gauge 10 and gauge 6 of the mild swell and steep wind wave cases respectively in both cases the instantaneous overtopping was measured using two balluff micropulse water sensors situated inside the overtopping box and q was then obtained by dividing the total volume of water collected at the end during the test by the total test duration 2 2 description of numerical models in this study six widely used open source numerical wave models are considered for comparative analysis each model is forced at its boundary with still water levels and parametric spectra jonswap to match those observed at the most offshore wave gauge during each physical experiment likewise the smooth flume bottom was represented as either a manning coefficient n of 0 01 s m1 3 or a nikuradse geometrical roughness k s of 0 3 10 3 m in the case of swan a general description of each model is provided in the sections that follow as we investigate two extremes very mild swell and very steep wind waves it is reasonable that some calibration was required for the depth averaged models bosz xb nh and xb sb therefore a description of the main calibration parameters their optimum values and impact on model results is also provided in general calibration was aimed at reducing the error in  and h m 0 t 2 2 1 openfoam the software openfoam is an open source object oriented library composed by solvers and utilities jasak et al 2007 the formers are designed to numerically solve continuum mechanics problems while the latter perform tasks involving data manipulation for the present study the library waves2foam a toolbox capable of generating and absorbing free surface water waves has been adopted currently the method applies the relaxation zone technique active sponge layers and supports a large range of wave theories jacobsen et al 2012 the governing equations for the combined flow of air and water are given by the reynolds averaged navier stokes equations equations 1 and 2 1  u t  u u t p g x   u    t    coupled with the continuity equation 2 for incompressible flow 2 u 0 where u is the velocity field p is the dynamic pressure component  is the density g is the acceleration due to gravity and  is the dynamic molecular viscosity the reynolds stress tensor  is defined as 3  2   t s 2 3 k i where  t is the dynamic eddy viscosity s is the strain rate tensor k is the turbulent kinetic energy per unit mass and i is the identity matrix the last term in equation 1 is the effect of surface tension where  t is the surface tension coefficient and   is the surface curvature jacobsen et al 2012 the track of the free surface is performed by using the vof method hirt and nichols 1981 where the scalar field  is 0 for air 1 for water and any intermediate value is a mixture of the two fluids for the mild and the steep cases two regular slightly different meshes have been generated to account for the differences between the two wave conditions the numerical domains of the mild and steep cases are respectively composed by 49021 and by 70316 cells with a graded mesh both in the x 0 3 0 005 m for the mild 0 1 0 01 m for the steep and in the y 0 05 0 005 m for the mild 0 1 0 01 m for the steep directions in both cases the selected regular and constant mesh allowed for a fair compromise between the computational effort and the accuracy of the results 2 2 2 swash swash is a time domain model for simulating non hydrostatic free surface and rotational flow it solves the nlsw equations with an added non hydrostatic pressure correction term smit et al 2013 4  t u h x 0 5 u t u u x w u z 1  p h p n h x  x x x  x z z 6 w t u w x w w z 1  p n h z  z z z  z x x 7 u x w z 0 where  is the free surface elevation u x z t and w x z t are the horizontal and vertical velocities respectively h is the water depth  is the density of water p h and p n h are the hydrostatic and non hydrostatic pressures respectively and  x x  x z  z z and  z x are the turbulent stresses the model exhibits good linear dispersion up to k h 8 and k h 16 with two and three equidistant sigma vertical layers k respectively its frequency dispersion is further improved by increasing k here the model was applied with k 20 which is sufficient for the phase velocity at the breaking wave front to be computed accurately as such no additional control is required to initiate or terminate wave breaking the vertical pressure gradient was discretized by the standard central differencing scheme with the ilu pre conditioner the standard k  turbulence model is applied to take into account vertical mixing a cross shore grid spacing  x of 0 025 m was specified for the mild swell cases while a coarser resolution  x 0 04 m was needed for the steep wind wave case to maintain model stability this resulted in approximately 330 and 110 grid cells per deep water wavelength l 0  x for the mild swell and steep wind wave cases respectively for phase resolving models l 0  x is typically kept between 50 and 100 by rule of thumb to ensure that the wave components are accurately resolved however as waves propagate in very shallow water the local wavelength becomes much shorter than l 0 thus in order to maintain a reasonable number of grid cells per local wave length these higher than typical grid resolutions l 0  x 330 and 110 were specified it should also be noted that while h m 0 t in the mild swell case showed convergence 3 change compared to higher resolutions at  x 0 04 m the resulting q increased by a factor of 6 with  x 0 025 m this suggests that wave run up and overtopping at the dike were particularly sensitive to the grid resolution rijnsdorp et al 2017 proposed a sub grid approach to improve model efficiency where vertical accelerations and non hydrostatic pressures are resolved on a relative course grid while the horizontal velocities and turbulent stresses are resolved on a much finer sub grid this approach was attempted here however the simulations failed due to instabilities 2 2 3 bosz the bosz wave model which is freely available upon request from the developers computes hazardous free surface flow problems ranging from near field tsunamis to extreme swell ranges generated by hurricanes it solves the following re formulated depth integrated boussinesq equations of nwogu 1993 in conservative form 8 h t h u x z  2 2 h 2 6 h u x x z  h 2 h h u x x x 0 9 h u t h u 2 1 2 g h 2 x g h h x u z  2 2 h 2 6 h u x x z  h 2 h h u x x x h z  z  2 u t x x h u t x x  0 where h h  is the flow depth u is the horizontal flow velocity defined at a reference depth z  0 55502 h simarro et al 2013 and  the bottom shear in terms of the manning coefficient the governing equations exhibit good dispersion accuracy up to k h  given the difficulty of boussinesq equations in handling flow discontinuities such as with breaking waves the model deactivates the dispersion terms during wave breaking and makes use of the underlying nlsw equations where the breaking wave is then approximated as a bore or hydraulic jump wave breaking and the deactivation of the dispersion terms occurs in the model based on the momentum gradient 10 h  u x b g h  where b is a calibration coefficient by default 0 5 here b 0 8 produced the best agreement between model and observations for both cases this suggests that under these particularly shallow conditions the wave face becomes very steep prior to breaking for a detailed overview of the model s sensitivity to this parameter the reader is pointed to roeber et al 2010 all other model parameters were kept at their default values the grid resolution l 0 d x was set as 200 for the mild swell wave case but was reduced to 60 for the steep wind wave case to ensure model stability for the steep wave case higher grid resolutions and lower b values led to instabilities in the form of strong oscillations in surface elevation in the breaking region this phenomenon explored extensively by kazolea and ricchiuto 2018 is due to the model s hybrid approach to handling wave breaking that is where the boussinesq equations are reduced to the nlsw equations during wave breaking it should be noted that boussinesq wave models which take a different eddy viscosity approach to wave breaking reportedly show less sensitivity to the grid size kazolea and ricchiuto 2018 however this was not evaluated here 2 2 4 xbeach non hydrostatic like swash xb nh solves the nlsw equations with a non hydrostatic pressure correction term equations 4 7 here xbeach version 1 235527 also known as the xbeachx release is applied in reduced simplified two layer mode where the non hydrostatic pressure is assumed constant in the lower first layer de ridder 2018 the water depth is divided into two layers with heights z 1  h and z 2 1  h where  is the layer distribution the resulting layer averaged velocities u 1 and u 2 are transformed to a depth averaged velocity u and a velocity difference u due to the simplified non hydrostatic pressure in the lower layer the vertical velocity between layers is neglected therefore only the continuity relation for the upper second layer is required 11 x 1  h u 1  h  u 2 w 2 u 2  x u 1 z 1 x 0 where w 2 is the vertical velocity in the upper second layer to determine the water elevation the global continuity equation is applied 12  t h u x 0 in order to control the computed location and magnitude of depth limited wave breaking a hydrostatic front approximation is applied with this the pressure distribution under breaking waves is considered hydrostatic when the local surface steepness exceeds a maximum prescribed value  0 4 by default 13  t  here  0 9 and 0 7 produced the best agreement between the model and observations for the mild and steep wave cases respectively this further supports the statement that for very shallow foreshores the waves become particularly steep before breaking all other model parameters were kept at their default values additionally the grid resolution l 0  x was set to 200 and 180 for the two respective cases 2 2 5 xbeach surfbeat xb sb solves ss wave motions using the wave action equation with time dependent forcing similar to that of the hiswa model holthuijsen et al 1989 the model represents the ss wave frequency spectrum by a single frequency f r e p and the wave action equation is applied at the timescale of the wave group 14 a t c g x a x d w  15 a x t s w x t  x t 16  g k tanh k h where a is the wave action s w is the wave energy density  is the intrinsic wave frequency k is the wave number d w is a dissipation term to account for wave breaking and c g x is the wave action propagation speed in the cross shore direction to simulate wave breaking xb sb applies a dissipation model roelvink 1993 by default for use with ss wave groups and a roller model nairn et al 1990 svendsen 1984 to represent momentum stored in surface rollers which results in a shoreward delay in wave forcing the radiation stress gradients that result from these variations in wave action exert forces on the water column and drive ig waves and unsteady currents which are solved by the nlsw equations equations 4 7 therefore the model directly simulates wave driven currents and the run up and overtopping of ig waves 17 d w 2  t r e p q b e w h r m s h 18 q b 1 exp h r m s h m a x 10 where d w is the total directionally integrated wave energy dissipation due to breaking t r e p 1 f r e p is the representative wave period and q b is the fraction of breaking waves the root mean square ss wave height h r m s 8 e w  g the maximum wave height h m a x  r h e w is the wave group varying ss wave energy  is a dissipation by default 1 and  r is the ratio of breaking waves to local water depth by default 0 55 but typically used for calibration here  r 0 45 and 0 65 provided the best agreement between the model and observations for the mild swell and steep wind wave cases respectively xb sb does not directly produce the ss wave component of the energy density spectrum instead it computes the change in ss wave energy as a change in the bulk h r m s parameter as described above in order to produce a complete energy density c   spectrum at each gauge location a jonswap distribution was assumed around the peak frequency f p where 8 f p 2 2 c   d f h r m s this ss wave spectrum fig 3 b was then combined with the ig wave spectrum fig 3a obtained directly from the computed surface elevation to produce the complete spectrum fig 3c for the mild swell wave case the grid resolution was varied such that it increased shoreward this reduced computation time while ensuring that the steep dike slope was accurately captured as such l 0  x varied from 25 offshore to 160 at the dike in the mild wave case and from 45 to 90 in the steep wave case 2 2 6 swan swan is a third generation phase averaged wave model used to estimate the generation by wind propagation and dissipation by depth induced breaking and bottom friction of waves from deep water to the surf zone this includes wave wave interactions in both deep and shallow water and wave induced setup but neglects wave induced currents and the generation or propagation of ig waves like xb sb swan computes the spectral evolution of a in space and time this is done in a manner similar to equation 14 however unlike xb sb which makes use of a single representative frequency swan takes the frequency distribution of action density into account to simulate depth limited wave breaking swan uses the following parametric dissipation model by default battjes and janssen 1978 battjes and janssen 19 d w  4  g f m e a n q b h m a x 2 and q b is estimated as 20 1 q b ln q b 8 e t o t h m a x 2 where f m e a n is the mean wave frequency h m a x  b j h and e t o t is the total wave energy variance here  b j 0 73 default value provided good agreement between the model and observations for both the mild swell and steep wind wave cases for both wave cases a constant grid spacing of 0 25 m was applied this corresponded to l 0  x 30 for the mild wave case and l 0  x 20 for the steep wave case 2 3 data processing and analysis 2 3 1 mean water level the mean water level  was calculated by taking the average of the surface elevation  t at each gauge location relative to the elevation of the dike toe the wave induced setup  was then obtained as the difference between  at each gauge location and  at the most offshore gauge 2 3 2 separation of infragravity and sea swell waves the time series of  t were further analysed using the welch s average periodogram method and a hann filter with a 50 maximum overlap the resulting one dimensional spectra of wave energy density c   f with 30o of freedom percival and walden 1993 were then used to determine h m 0 t h m 0 s s and h m 0 i g as follows 21 h m 0 t 4 0 005 2 c   d f 22 h m 0 s s 4 f p 2 2 c   d f and 23 h m 0 i g 4 0 005 f p 2 c   d f where half the peak frequency f p 2 1 2 t p is taken as the cut off to separate ss and ig motions roelvink and stive 1989 this choice of cut off frequency is based on the tendency that in deep water the majority of ss wave energy is found at frequencies f p 2 while the majority of ig wave energy lies at frequencies f p 2 2 3 3 spectral wave period in addition to wave heights the spectral wave period t m 1 0 at each gauge location was calculated as follows 24 t m 1 0 m 1 m 0 where 25 m n 0 005 2 c   f n d f 2 3 4 empirical estimate of the incident infragravity waves as swan neglects the contribution of ig waves to the total wave incident height at the dike toe h m 0 t t o e i n we apply an empirical correction proposed by lashley et al forthcoming using a dataset of 672 xbeach simulations an empirical formula for the relative magnitude of the ig waves h i g was derived with influence factors to account for variations in offshore wave directional spreading   h t o e  h cot m  f vegetation  v and cot   d 26 h i g 0 36 h m 0 t d e e p 0 5    h  f  v  d for an incident waves analysis i e without the influence of the dike slope with no directional spreading 1d flume conditions or vegetation    v and  d 1 while 27  h 1 04 exp 1 4 h t o e 0 9 exp 0 19 h t o e and 28  f 1 56 3 09 cot m 0 44 as h i g represents the ratio of ig to ss waves h m 0 i g t o e i n can be obtained from a swan estimate of h m 0 s s t o e i n 29 h m 0 i g t o e i n h i g h m 0 s s t o e i n finally a corrected estimate of h m 0 t t o e i n was obtained as follows 30 h m 0 t t o e i n h m 0 s s t o e i n 2 h m 0 i g t o e i n 2 2 3 5 empirical wave overtopping while the fully phase averaged models like swan are to some extent able to estimate nearshore wave conditions they cannot directly simulate wave overtopping as this requires that the individual waves be resolved in order to estimate wave overtopping these models can be and are often combined with well established empirical models that require wave parameters at the dike toe as input in the present study the eurotop 2018 formulae based on the work of van gent 1999 and altomare et al 2016 for very shallow foreshores are applied in combination with swan for smooth dikes under perpendicular wave attack with h t o e h m 0 t d e e p 1 5 31 q g h m 0 t t o e i n 3 10 0 79 exp r c h m 0 t t o e i n 0 33 0 022  m 1 0 with 32  m 1 0 tan  s f h m 0 t t o e i n l m 1 0 33 l m 1 0 g t m 1 0 t o e i n 2 2  34 tan  s f 1 5 h m 0 t t o e i n r u 2 1 5 h m 0 t t o e i n h t o e m h t o e r u 2 cot  35 r u 2 h m 0 t t o e i n 4 1 5  m 1 0 where g is the gravitational constant of acceleration  is the dike slope  s f is an equivalent slope to account for waves breaking on the foreshore and t m 1 0 t o e i n is the spectral wave period at the dike toe based on the incident waves i e without the influence of waves reflected at the dike it should be noted that  m 1 0 and r u 2 are obtained iteratively until r u 2 converges with a first estimate of r u 2 1 5 h m 0 t t o e i n additionally as swan excludes the contribution of ig waves corrected estimates of t m 1 0 t o e are typically obtained using equations 36 and 37 hofland et al 2017 as outlined in the eurotop 2018 manual 36 t m 1 0 t o e i n t m 1 0 d e e p 1 6 exp 4 h exp h where 37 h h t o e h m 0 t d e e p cot m 100 0 2 2 3 6 error metrics in order to compare the performance of the numerical models we assess the mean relative accuracy in an approach similar to that of lynett et al 2017 38 m e a n r a t i o  1 n i 1 n  m o d i  o b s i where  is a stand in for the parameter under consideration  h m 0 t h m 0 s s h m 0 i g and t m 1 0 for the n wave gauge locations and subscripts m o d and o b s refer to model predictions and observations made during the physical experiment respectively here we make a distinction between gauges offshore and nearshore fig 2 a mean ratio of 1 suggests perfect agreement between the model and observations while values higher or lower than one indicate over or under predictions respectively it should be noted that all wave gauges offshore and at the dike toe see fig 2 are considered in equation 38 while the focus of this study is primarily at the dike toe it is important to assess the model performance offshore to ensure that i the boundary conditions are correctly modelled and ii that no significant numerical dissipation occurs in deep water as a result of a coarse grid resolution for example finally the performance of each model for wave overtopping was assessed by comparing the simple ratio of modelled to observed q and the absolute relative error in the prediction of q 39 a b s o l u t e r e l a t i v e e r r o r q 1 q m o d q o b s 2 3 7 computation speed two work stations ws were used to carry out this research table 3 given the required computational effort the openfoam simulations were performed on ws a while the other models were run on ws b to assess computation speed the duration of each simulation in wall clock time was recorded 3 results and discussions in this section the results of the model data comparisons are presented and discussed as wave overtopping is the end result of wave propagation the performance of each model for the prediction of mean water levels wave heights and periods is first assessed for the models where calibration was carried out bosz xb nh and xb sb both default and calibrated results are presented note that no parameter tuning was done for the depth resolving models openfoam and swash as wave breaking is intrinsically resolved likewise swan with default settings showed reasonable agreement and was therefore not calibrated lastly it should be noted that the bosz simulation of the steep wind wave case with default settings resulted in instabilities see section 2 2 3 and is therefore not included in the analysis 3 1 mean water level each model excluding openfoam is able to accurately within 15 error and consistently reproduce  for both the mild swell fig 4 a and steep wind wave fig 4b cases this includes the increase in  nearshore referred to as wave induced setup  highlighted in fig 5 with the xb nh results representing the general behaviour of the numerical models note that the vertical axes limits of fig 4 are set for an easy comparison with the other modelled versus observed plots that follow while openfoam agrees well with the observations for the mild swell case it overestimates  offshore gauges 2 and 3 and underestimates  nearshore gauges 4 to 6 for the steep wind wave case fig 5 this may be indicative of premature wave breaking in openfoam the satisfactory performance of bosz and xb nh observed here fig 4 is in contrast with previous studies lashley et al 2018 zhang et al 2019 which found that depth averaged models were unable to accurately estimate  due to their lack of vertical resolution and exclusion of wave roller dynamics however the difference in model performance here is likely due to the spilling nature of the waves  0 f o r e 0 23 and 0 13 for the mild swell and steep wind wave cases respectively compared to the plunging waves and steep fore reef slopes assessed by lashley et al 2018  0 f o r e 1 1 and zhang et al 2019  0 f o r e 1 29 that is while resolving the vertical structure of flow may be critical for plunging breakers depth averaged models are able to perform well under spilling waves there is also a notable difference in the observed maximum  between the mild swell  0 004 m and steep wind wave  0 015 m cases fig 5 this substantial increase in  as h t o e h m 0 t d e e p decreases agrees with the findings of gourlay 1996 on shallow reefs and suggests that  which contributes to wave run up stockdon et al 2006 and by extension overtopping increases proportionally as foreshores become more shallow or as deep water wave conditions become more energetic 3 2 significant wave height swash bosz xb nh and xb sb are able to reproduce h m 0 t both offshore and nearshore within 15 error for two cases fig 6 on the other hand openfoam and swan both show notable differences with swan consistently and considerably underestimating h m 0 t nearshore while swan is able to accurately simulate the propagation of high frequency waves h m 0 s s fig 7 it does not compute the low frequency waves h m 0 i g fig 8 and therefore underestimates h m 0 t nearshore where the contribution of ig waves is significant fig 6 the relatively high standard deviation associated with swan s nearshore h m 0 s s estimates is due to its exclusion of wave reflection in the physical model the superposition of the incident and reflected waves results in a nodal anti nodal pattern with a maximum at the dike outsets in fig 9 a and fig 10 a as swan excludes the reflected component the model underestimates h m 0 s s immediately in front of the dike where the incident and reflected waves add up on the other hand this shortcoming makes swan especially suitable for use with the empirical overtopping models that require incident wave conditions as input swan also predicts a higher and lower maxima in h m 0 s s just before breaking than xb nh for the mild swell fig 9a and steep wind wave fig 10a cases respectively this is likely due to the dissipation model employed by swan equation 19 tuning  b j the parameter which controls the maximum wave height to water depth ratio in swan would yield better agreement between the two models however as there were no wave gauges in this region it is difficult to ascertain which model is correct here with respect to openfoam the model shows inconsistent results between the two cases under the mild swell conditions openfoam underestimates h m 0 t nearshore fig 6a however for the steep wind wave case the model overestimates h m 0 t nearshore fig 6b in both cases the model appears to be too dissipative resulting in a reduction in h m 0 s s offshore for the mild swell case this dissipation is minor resulting in a consistent under prediction of h m 0 s s figs 7a and 9a and h m 0 i g figs 8a and 9b under the steep wind wave conditions however the dissipation is significant this observation combined with the overestimation of  offshore fig 5 indicates premature wave breaking in openfoam this reduction in h m 0 s s offshore results in unbroken ss waves reaching the dike and the overestimation of h m 0 s s nearshore figs 7b and 10a xb nh also shows some numerical dissipation offshore but this is negligible compared to that of openfoam fig 10a the wave damping along the flume by openfoam was already found by other authors conde 2019 and is popular among the user community previous works larsen et al 2019 and this contribution suggest that a more refined mesh by increasing the number of cells per wave height may improve the wave form modelling during the wave propagation however a reduction in grid size for the steep wind wave case here did not significantly improve the openfoam model results though swash is able to accurately predict h m 0 i g it underestimated h m 0 s s nearshore in both cases this is possibly due to the standard k  turbulence model applied in multi layered mode which may overestimate the turbulent vertical viscosity similar to openfoam a reduction in grid size from 0 04 m to 0 025 m did not significantly improve the estimates 3 change in h m 0 s s while calibration generally improved model performance for  fig 4 h m 0 t fig 6 and h m 0 i g fig 8 it resulted in the overestimation of h m 0 s s nearshore by xb sb fig 7 this is as a result of tuning  r equation 18 which affects both the maximum h m 0 s s and h m 0 i g perhaps a different approach where  equation 17 the parameter that controls the magnitude of dissipation is calibrated lashley et al 2018 would yield better results however as xb sb predicts ig wave overtopping only the loss in accuracy for h m 0 s s to improve h m 0 i g predictions was considered acceptable 3 3 spectral wave period swash xb nh and xb sb show good agreement between modelled and observed t m 1 0 predictions while swan openfoam and bosz show notable deviations as the accurate prediction of t m 1 0 requires the models to correctly represent the distribution of wave energy by frequency equation 25 we assess the modelled versus observed wave spectra fig 12 and fig 13 swash bosz xb nh and xb sb correctly capture the shift in peak energy density c   from the ss wave figs 12a and 13a to the ig wave band figs 12b and 13b however bosz overestimates the magnitude of the ig peak and shows it at slightly lower frequencies than observed this coupled with a minor underestimation of the ss wave energy most evident for the mild swell case fig 12b results in an overestimation of t m 1 0 the consistent underestimation of t m 1 0 by swan is expected due to its exclusion of c   at ig frequencies figs 12b and 13b openfoam on the other hand does show a shift in energy from offshore to the dike toe however it shows two distinct ig peaks figs 12b and 13b not present in the observations in the mild swell case this misrepresentation of c   at ig frequencies couple with the underestimation of c   in the ss wave band resulted in the significant overestimation of t m 1 0 nearshore fig 11a under the steep wind wave conditions openfoam also shows considerable c   in the ss wave band nearshore while the observed spectra shows very little fig 13b this further supports the argument that due to premature wave decay in the model some unbroken ss waves are able to reach the dike 3 4 wave overtopping 3 4 1 general an important remark is the difference in the observed q between the mild swell 0 094 l s per m and steep wind wave 0 205 l s per m cases despite having similar h m 0 s s t o e values 0 039 m figs 9 and 0 038 m fig 10a for the mild swell and steep wind wave cases respectively the steep wave case with a higher r c and lower h t o e table 2 produces double the q this observation suggests that the nonlinear effects of wave breaking that is the generation of ig waves and wave induced setup contribute significantly to the resulting overtopping discharge while the effects of vegetation are not considered here this observation highlights a potential limitation in studies that assess the effectiveness of shallow foreshores but focus only on the attenuation of h m 0 s s and neglect the contribution of h m 0 i g vuik et al 2016 yang et al 2012 to further investigate the influence of the ig waves we compare the overtopping estimated using swan and eurotop 2018 with and without the corrections to h m 0 i g t o e i n and t m 1 0 t o e i n obtained through equations 29 and 36 respectively under the mild swell wave conditions the ratio h i g 0 5 equation 29 and the contribution of h m 0 i g t o e i n to h m 0 t t o e i n is minor table 4 on the other hand including the ig waves resulted in a 2 5 fold increase in t m 1 0 t o e i n and magnitude 4 fold increase in the predicted q compared to the original swan estimates the difference is more striking for the steep wave case where the ig waves dominate at the dike toe h i g 0 92 the inclusion of the ig waves resulted in 36 increase in h m 0 t t o e i n a 5 fold increase in t m 1 0 t o e i n and an order of magnitude increase in the predicted q furthermore the original swan estimates without any corrections to t m 1 0 t o e i n and h m 0 t t o e i n erroneously show a decrease in q between the mild swell and steep wind wave cases while the observations show a notable increase these results further emphasize the danger of neglecting the ig wave contribution demonstrated here by the correction of input to the empirical formulae in the design and assessment of coastal structures with very shallow foreshores considering the wider model comparison each model with the exception of bosz fails to reproduce the overtopping for the mild swell case fig 14 this is particularly evident for xb sb which significantly underestimates q for both wave cases this suggests that while xb sb may estimate wave run up accurately in ig wave dominant environments lashley et al 2018 it s exclusion of the ss wave component considerably limits its performance for wave overtopping compared to the depth resolving models xb nh and bosz both swash and openfoam show larger errors in wave overtopping predictions fig 14 while the performance of openfoam may be attributed to its misrepresentation of nearshore waves and periods sections 3 2 and 3 3 the performance of swash particularly under mild swell conditions is somewhat surprising since it performed reasonably well in the prediction of  h m 0 and t m 1 0 in both cases here and has been previously successful in one layered mode suzuki et al 2017 however suzuki et al 2017 focused on obtaining good agreement at the toe the last wave gauge only and the resulting q in their tuning of swash therefore q was not assessed unless wave heights and periods at the toe were within a certain accuracy range regardless of the input offshore conditions whereas here we assess the model s general performance for wave propagation both offshore and nearshore in addition to q the models do however perform considerably better for the steep wave case this is consistent with the findings of roelvink et al 2018 and suzuki et al 2017 who showed that xb nh and swash respectively were more accurate for higher overtopping rates but suffered for rates below 0 08 0 16 l s per m in model scale the improvement in swan with the corrections is most evident for the steep wave case with the estimated q now on par with that of bosz and outperforming the other more physically complex models fig 15 shows the modelled relative overtopping discharge q g h m 0 t t o e i n 3 versus the relative freeboard r c h m 0 t t o e i n 0 33 0 022  m 1 0 s f where h m 0 t t o e i n and t m 1 0 to compute  m 1 0 s f are taken from table 4 if we take the 5 exceedance lines of the eurotop 2018 formula equation 31 fig 15 as the general range of acceptable overtopping predictions openfoam mild swell case swash steep wind wave case bosz xb nh and swan with corrections are all reasonable as most of the models performed reasonably well for wave propagation the excellent agreement between bosz and the observed q is likely not dependent on underlying governing equations boussinesq versus nlsw but more to do with how the shoreline and wave run up are treated numerically however an in depth analysis of the various numerical schemes implemented in each numerical model was beyond the scope of this study 3 4 2 accuracy versus speed in contrast with the general assumption that models of increasing physical complexity produce more accurate results fig 16 shows no clear relationship between computational demand simulation time and the absolute relative error in overtopping furthermore the depth resolving models swash and openfoam which have significantly higher simulation times show larger errors than the depth averaged models xb nh and bosz the phase averaged models xb sb and swan original despite their considerable speed advantage significantly underestimated the overtopping discharge due to their exclusion of higher and lower frequency wave components respectively however by including the ig waves empirically swan s performance improved significantly now within acceptable limits and on par with those of xb nh and bosz but at little to no computational cost fig 16 it should be noted that the use of swan with equation 36 is already the recommended approach in eurotop 2018 the novelty here is the further improvement in results offered by equation 29 4 conclusion in the present study we assess the ability of 6 widely used numerical models to simulate waves overtopping steep dikes with mildly sloping shallow foreshores however with the exception of openfoam and to some extent swash k 10 the above phase resolving models were originally developed to simulate wave evolution over mildly sloping foreshores and not specifically for wave run up and overtopping of steep structure slopes since their development the phase resolving models have each been successfully applied to simulate wave propagation over steep reefs and run up of relatively steep beaches likewise depth resolving models like openfoam and swash k 10 were originally developed to simulate wave structure interaction and not specifically for wave propagation in the present study we tested the ability of these models in both applications i wave evolution over a shallow mildly sloping foreshore and ii the resulting overtopping discharge overall bosz and xb nh under steep wind waves showed high skill in both applications with a reasonable computational demand while openfoam with a much higher computational demand showed difficulty in performing both functions the broad implication of the present work is that higher resolution more computationally demanding wave models may simply not be needed specifically where the analysis is focused on bulk time averaged physical quantities h m 0 t m 1 0 and q as shown here should more detail be required for example estimates of the vertical velocity profile or turbulence then a depth resolving model such as swash k 10 or openfoam should be applied moreover swash k 10 and openfoam are likely to perform well if the computational domain begins at the dike toe and ends at the overtopping box i e where simulating wave propagation over a large distance is not required in addition our results showed that with simple empirical corrections phase averaged models like swan can perform on par if not better than phase resolving models with much less computational effort importantly our work emphasizes the importance of including ig waves in the design and assessment of coastal dikes as neglecting their contribution to h m 0 t t o e and t m 1 0 t o e can lead to under predictions in q of up to two orders of magnitude given the scope of the model comparison including both phase resolving and phase averaged a detailed wave by wave comparison of the higher resolution models was not carried out future work should address this and investigate the influence of the various numerical schemes implemented in the respective numerical models as this was not within the scope of the present work additionally equations 31 and 36 were developed in part using the wider dataset from which these cases were taken therefore their performance under different conditions is still to be confirmed despite these limitations the findings here can aid practitioners in their decision making specifically in deciding which numerical model should be applied based on the level of accuracy required software availability openfoam developed by opencfd ltd the software package is freely available from https www openfoam com swash developed at delft university of technology the model is available freely from http swash sourceforge net download download htm bosz developed at the universit de pau et des pays de l adour the model is freely available under request from volker roeber univ pau fr xbeach non hydrostatic and xbeach surfbeat developed by ihe delft deltares delft university of technology and the university of miami both models are freely available from https oss deltares nl web xbeach download swan developed at delft university of technology the third generation wave model is freely available from http swanmodel sourceforge net download download htm declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work is part of the perspectief research programme all risk with project number p15 21 which is partly financed by nwo domain applied and engineering sciences in collaboration with the following private and public partners the dutch ministry of infrastructure and water management rws deltares stowa the regional water authority noorderzijlvest the regional water authority vechtstromen it fryske gea hkv consultants natuurmonumenten and waterboard hhnk dr corrado altomare acknowledges funding from the european union s horizon 2020 research and innovation programme under the marie sklodowska curie grant agreement no 792370 volker roeber acknowledges financial support from the isite program energy environment solutions e2s the communaut d agglomration pays basque capb and the communaut rgion nouvelle aquitaine crna for the chair position hpc waves and the european union s horizon 2020 research and innovation programme the authors also acknowledge akshay patil for his incite and efforts towards the success of the research appendix a supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2020 104740 
26014,evapotranspiration et is a central flux in the hydrological cycle various approaches to compute et via energy balance models exist but their handling is often complex and challenging we developed qwatermodel as an easy to use tool to make et predictions available to broader audiences qwatermodel is based on the dattutdut energy balance model and uses land surface temperature maps as an input such maps can e g be obtained from satellite drone or handheld camera imagery in the present study we successfully tested qwatermodel for predicting et in a tropical oil palm plantation against the well established eddy covariance method qwatermodel is compatible with all versions of qgis3 and is available from the official qgis plugin repository keywords evaporation transpiration water cycle dattutdut energy balance open source hydrological modeling thermography thermal images drone uav 1 introduction evapotranspiration et is the combined water flux of evaporation from soil plant and water surfaces as well as transpiration from plants allen et al 1998 terrestrial et is a major flux in the hydrological cycle consuming about 60 of terrestrial precipitation oki and kanae 2006 associated with climate and land use change major transformations in the global hydrological cycle are projected therefore a broad understanding and knowledge of et and its patterns are of paramount importance kaushal et al 2017 ziegler et al 2003 the current understanding of how ecosystems respond to such changes is limited by insufficient monitoring capabilities fisher et al 2017 the development of effective adaption strategies for agriculture ecosystems and water management will depend on the availability of et assessment schemes that can be readily applied from local to global scales fisher et al 2017 et can be measured locally using e g the eddy covariance method or estimated at larger spatial scales by applying energy balance models for many energy balance models remotely sensed land surface temperatures lst are used as principal input therein assuming that hot pixels are the result of low et and cold pixels indicate high et timmermans et al 2015 current developments such as increasing computation power extensive availability of free satellite imagery e g from landsat 7 and 8 and a large variety of portable thermal cameras that can be attached to drones or used as handheld devices foster the use of energy balance modeling for et estimation hoffmann et al 2016 maes and steppe 2012 timmermans et al 2015 xia et al 2016 however most energy balance models are complex and their implementation requires advanced programming skills and technical expertise which constitutes a barrier for the application of energy balance models for et estimation to overcome this barrier we developed the qgis plugin qwatermodel which addresses the following objectives to facilitate the use of energy balance and evapotranspiration modeling to take lst images and maps from a wide range of sources including satellites planes drones and handheld thermal cameras as input to reduce the use of complementary data to a feasible level and to use a documented open source structure to encourage further development in the present study we explain and test key features of qwatermodel in a scientific context using exemplary lst data from different sources recorded in an oil palm plantation in indonesia to compute et estimates we then compare the et predictions from the plugin with simultaneous et reference measurements with the well established eddy covariance method 2 methods 2 1 software design to facilitate the use of energy balance modeling for et estimation for a broad audience we chose qgis3 qgis development team 2020 as a platform qgis is a free and open source geographic information system that provides a versatile environment for work flows with spatial data such as lst maps it offers subsystems for data input and management analysis easy visualization of spatial data has a large community of developers and is supported by most operating systems bhatt et al 2014 criollo et al 2019 the use of qgis is frequently taught in scientific institutions and its functionality can be extended with a large variety of available plugins for example the wet water ecosystems tool plugin nielsen et al 2017 provides easy access to complex watershed modeling to our knowledge no such easy to use plugins exist in the qgis environment for instantaneous flux modeling or et prediction the presented plugin qwatermodel was developed to fill this gap it is based on the energy balance model dattutdut deriving atmosphere turbulent transport useful to dummies using temperature timmermans et al 2015 which uses lst maps as main input and except for time and location of the lst recording requires no further input of ancillary data in the original dattutdut model the radiation budget is simply modelled from a set of parameters and sun earth geometrics timmermans et al 2015 this approach works well for cloud free conditions for a broader usability under conditions of cloudy skies and high relative air humidity we extended this original model concept giving the user the possibility to configure model parameters according to in situ field measurements the radiation budget can be complemented by measurements of short wave irradiance or net radiation at the study sites via manual input the dattutdut model has successfully been tested for a broad range of lst input types from satellite recorded images timmermans et al 2015 to plane and drone recorded images brenner et al 2018 xia et al 2016 the plugin was built using plugin builder 3 2 1 geoapt 2019 and plugin reloader 0 7 9 juriel 2020 we used qt creator 4 11 0 the qt company 2020 to develop the graphical user interface gui and python 3 8 with the qgis3 python standard libraries gdal math numpy datetime and os for the associated functionality detailed installation instructions and the source code can be found on github com floell qwatermodel blob master readme md 2 2 application and testing to test the plugin we used data recorded in a mature monoculture oil palm elaeis guineensis jacq plantation located in the lowlands of sumatra jambi province indonesia 103 3914411 e 1 6929879 n 76 m a s l see meijide et al 2017 for further details we exemplarily use lst recordings from two independent sources drone and handheld camera to test the qwatermodel plugin against eddy covariance reference measurements 1 images recorded with an octocopter drone mk easy okto v3 hisystems germany equipped with a radiometric thermal camera flir tau 2 640 flir systems usa attached to a teax thermo capture module teax technology germany the data have a spatial resolution of 0 2 m and cover a footprint of 0 8 ha and are thus suitable for tree scale to stand scale assessments of et 13 images from 09 00 to 15 00 h local time on 7th of august 2017 were recorded in 30 min intervals 2 images taken from a tower at 10 m above the canopy with a handheld fluke ti100 thermal camera fluke systems usa the data have an approx spatial resolution of 0 06 m and a footprint of 0 006 ha and are thus suitable for leaf to canopy assessments of et 5 images from 11 00 to 15 00 h on 7th of august 2017 were taken in 60 min intervals data are provided for download at github com floell qwatermodel tree master data examples we did not include satellite images into this study since this was already included in the original dattutdut model study timmermans et al 2015 in addition satellite landsat 7 and 8 recorded lst maps for our study region contain a very high cloud cover fraction for 2017 min 23 mean 72 max 100 our study thus focuses on drone and handheld thermal camera acquired images a widely accepted ground based reference method for et assessments is the eddy covariance method which provides measurements of et at the stand scale eddy covariance data at the oil palm site was recorded filtered and processed according to the methodology described in meijide et al 2017 because the energy balance model used in the plugin assumes full energy balance closure eddy covariance data was processed using the bowen ratio closure method pan et al 2017 twine et al 2000 horizontal energy flows or incomplete energy balance closure might introduce certain errors to this reference method loescher et al 2006 to derive et from latent heat fluxes latent heat of vaporization was calculated using in situ air temperature measurements for eddy covariance measurements and the lowest pixel temperatures from the lst maps for the plugin estimates following the methodology described in timmermans et al 2015 3 results 3 1 software implementation results the qwatermodel plugin can be installed from the official qgis3 python plugin repository the plugin gui consists of a main window with four different input sections a b c d fig 1 and an information window which are both organized using tabs in the main window section a contains the inputs that are essential for the plugin to work with in a minimal data approach a thermal image with temperatures in kelvin e g from satellite drone or handheld camera the definition of an output raster and an output file where key statistics will be summarized and the coordinated universal time utc when the picture was taken providing information in boxes b c and d is optional but may improve the quality of the et estimates the default values that are visible in the input fields of box b are taken from timmermans et al 2015 and can be adjusted if more local data are available from field measurements or previous studies the info tab offers detailed information on input output and usage of the plugin the plugin outputs a raster with 6 bands net radiation rn w m 2 latent heat flux le w m 2 sensible heat flux h w m 2 ground heat flux g w m 2 evaporative fraction ef in and evapotranspiration et mm time period input raster details and output statistics are stored in a csv file fig 2 shows a workflow example with lst data from different sources i e recorded from drone and handheld thermal camera and the corresponding output 3 2 software experimental testing results land surface temperatures differed with the time of recording thermal variability was high in both drone and handheld camera obtained maps table 1 to compare the et estimates from drone and handheld thermal camera maps with a measured reference we plotted them against the daily course of eddy covariance derived et values fig 3 and into a scatterplot comparing measurements and predictions of et fig 4 applying the energy balance model in its original version with minimal data input resulted in overestimations of et during the morning and afternoon hours but in acceptable estimates around noon fig 3a errors were smaller for the estimates based on handheld camera pictures than on drone recordings table 2 more precise results were achieved by adding measured short wave irradiance fig 3b or net radiation measurements fig 3c to the model inputs i e et estimates closely follow the reference method if additional radiation data is supplied the handheld thermal camera maps generally produce slightly more congruent results with the eddy covariance measurements than drone maps therein around noon et estimates from drone maps are slightly higher than eddy covariance et measurements in the minimal data approach et predictions are most congruent with eddy covariance measurements when et is high fig 4a while in contrast predictions are most congruent at low et when measurements of short wave irradiance or net radiation are used in the model fig 4b and c congruence generally increases with increasing measurement based input errors are thus smallest for models computed with directly measured net radiation table 2 4 discussion and conclusions the qwatermodel plugin is an easy to use open source tool for predicting evapotranspiration from land surface temperatures it is aimed at applications in ecology bioclimatology and land use science but is also useful for a broader utilization including hydrological and ecosystem management it offers a link between science and practical application of energy balance modelling for et prediction meeting our objectives a variety of lst data from very different sources and spatial extends can be used as input and complementary data input requirements were kept at a minimum level the case study showed that images taken at the same time but with different camera setups drone and handheld result in comparable results for et estimates and show high congruence with reference eddy covariance measurements because in the minimal data approach the radiation budget is calculated from sun earth geometry clouds and relative humidity or haze are not considered this explains the overestimation of et in the morning and afternoon hours fig 3a in situ measurements of short wave irradiance or net radiation significantly improved the et estimates fig 3b and c similar observations were made in other studies e g on european grasslands where additional short wave irradiance measurements improved the overall accuracy of the dattutdut model brenner et al 2018 a method comparison of the dattutdut model with the eddy covariance method over varying weather conditions and day times showed the general applicability of this approach in the tropics and suggested no difference between drone based and eddy covariance method for certain configurations ellser et al submitted however even when using measured short wave or net radiation et estimates based on drone recorded lst data showed overestimations around noon which did not occur in the estimates based on handheld images a possible reason is the presence of artefacts e g roofs cars rocks in the drone images which have a much larger footprint than the handheld images temperatures on such non canopy components can differ greatly from surface temperatures of vegetation and these temperature outliers have a strong effect on the quality of predictions this was also observed in a study with big temperature differences conducted in vineyards xia et al 2016 a potential solution would be to manually exclude known artefacts from the images before analysis or to manually define minimal and maximal temperatures in the gui of the plugin unfortunately no matching satellite images were available for the time and date when drone and handheld camera maps were recorded therefore further analyses are not performed in this study this should be followed up upon in future studies even though a major restriction in our study region is that satellite images are generally hard to acquire since a considerable cloud cover is present on most days of the year a further challenge is the fixed overpass time of satellites which is often not around noon and therefore not ideal for et derivation delogu et al 2012 to overcome these limitations complementary et methods from planes drones and handheld or fixed thermal cameras can potentially be calibrated against simultaneously acquired satellite images e g using qwatermodel and then be applied to increase temporal and spatial coverage the scatterplots reveal a gap between lower and higher et estimates fig 4b and c this gap and its absence in the et estimates based on modelled rn in fig 4a demonstrates the effects of clouds on prediction accuracy if clouds are present and measurements of short wave irradiance or net radiation can represent this adequately in the model et estimates are clearly lower than with the rn modelling approach future improvements of the software could include a referencing tool that links ground measurements of hot and cold surfaces with lst data this would allow for a simple radiometric correction of lst images and maps to make the plugin applicable to the needs of a broader range of users upcoming versions could further include other lst map based indices such as the cwsi crop water stress index bian et al 2019 idso et al 1981 jones 2014 we appreciate all user input and ideas to further develop the plugin and encourage to modify the plugin for other et related applications or to report bugs via our bug tracker in the present study the software was only tested at one site a commercial monoculture oil palm plantation in lowland sumatra we strongly encourage the testing and use of the software in other climatic regions and on other crop and ecosystem types for further validation we provide the source code for the plugin and plan to consistently add more functionality to the qwatermodel 5 software availability name of software qwatermodel software version 1 0 developers florian ellser software license gnu general public license contact address tropical silviculture and forest ecology university of gttingen bsgenweg 1 37077 gttingen germany email fellsae gwdg de availability plugins qgis org plugins qwatermodel github com floell qwatermodel declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this study was funded by the deutsche forschungsgemeinschaft dfg german research foundation project number 192626868 sfb 990 subprojects a02 and a03 and the ministry of research technology and higher education ristekdikti indonesia we thank ristekdikti for providing the research permit for field work no 28 ext sip frp e5 dit ki vii 2017 we thank our field assistant zulfi kamal for his support and technician edgar tunsch for taking canopy pictures we also thank perseroan terbatas perkebunan nusantara vi batang hari unit ptpn6 for giving us permission to conduct our research at the oil palm plantation thanks to all efforts colleagues and friends in indonesia germany and around the world appendix a supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2020 104739 
26014,evapotranspiration et is a central flux in the hydrological cycle various approaches to compute et via energy balance models exist but their handling is often complex and challenging we developed qwatermodel as an easy to use tool to make et predictions available to broader audiences qwatermodel is based on the dattutdut energy balance model and uses land surface temperature maps as an input such maps can e g be obtained from satellite drone or handheld camera imagery in the present study we successfully tested qwatermodel for predicting et in a tropical oil palm plantation against the well established eddy covariance method qwatermodel is compatible with all versions of qgis3 and is available from the official qgis plugin repository keywords evaporation transpiration water cycle dattutdut energy balance open source hydrological modeling thermography thermal images drone uav 1 introduction evapotranspiration et is the combined water flux of evaporation from soil plant and water surfaces as well as transpiration from plants allen et al 1998 terrestrial et is a major flux in the hydrological cycle consuming about 60 of terrestrial precipitation oki and kanae 2006 associated with climate and land use change major transformations in the global hydrological cycle are projected therefore a broad understanding and knowledge of et and its patterns are of paramount importance kaushal et al 2017 ziegler et al 2003 the current understanding of how ecosystems respond to such changes is limited by insufficient monitoring capabilities fisher et al 2017 the development of effective adaption strategies for agriculture ecosystems and water management will depend on the availability of et assessment schemes that can be readily applied from local to global scales fisher et al 2017 et can be measured locally using e g the eddy covariance method or estimated at larger spatial scales by applying energy balance models for many energy balance models remotely sensed land surface temperatures lst are used as principal input therein assuming that hot pixels are the result of low et and cold pixels indicate high et timmermans et al 2015 current developments such as increasing computation power extensive availability of free satellite imagery e g from landsat 7 and 8 and a large variety of portable thermal cameras that can be attached to drones or used as handheld devices foster the use of energy balance modeling for et estimation hoffmann et al 2016 maes and steppe 2012 timmermans et al 2015 xia et al 2016 however most energy balance models are complex and their implementation requires advanced programming skills and technical expertise which constitutes a barrier for the application of energy balance models for et estimation to overcome this barrier we developed the qgis plugin qwatermodel which addresses the following objectives to facilitate the use of energy balance and evapotranspiration modeling to take lst images and maps from a wide range of sources including satellites planes drones and handheld thermal cameras as input to reduce the use of complementary data to a feasible level and to use a documented open source structure to encourage further development in the present study we explain and test key features of qwatermodel in a scientific context using exemplary lst data from different sources recorded in an oil palm plantation in indonesia to compute et estimates we then compare the et predictions from the plugin with simultaneous et reference measurements with the well established eddy covariance method 2 methods 2 1 software design to facilitate the use of energy balance modeling for et estimation for a broad audience we chose qgis3 qgis development team 2020 as a platform qgis is a free and open source geographic information system that provides a versatile environment for work flows with spatial data such as lst maps it offers subsystems for data input and management analysis easy visualization of spatial data has a large community of developers and is supported by most operating systems bhatt et al 2014 criollo et al 2019 the use of qgis is frequently taught in scientific institutions and its functionality can be extended with a large variety of available plugins for example the wet water ecosystems tool plugin nielsen et al 2017 provides easy access to complex watershed modeling to our knowledge no such easy to use plugins exist in the qgis environment for instantaneous flux modeling or et prediction the presented plugin qwatermodel was developed to fill this gap it is based on the energy balance model dattutdut deriving atmosphere turbulent transport useful to dummies using temperature timmermans et al 2015 which uses lst maps as main input and except for time and location of the lst recording requires no further input of ancillary data in the original dattutdut model the radiation budget is simply modelled from a set of parameters and sun earth geometrics timmermans et al 2015 this approach works well for cloud free conditions for a broader usability under conditions of cloudy skies and high relative air humidity we extended this original model concept giving the user the possibility to configure model parameters according to in situ field measurements the radiation budget can be complemented by measurements of short wave irradiance or net radiation at the study sites via manual input the dattutdut model has successfully been tested for a broad range of lst input types from satellite recorded images timmermans et al 2015 to plane and drone recorded images brenner et al 2018 xia et al 2016 the plugin was built using plugin builder 3 2 1 geoapt 2019 and plugin reloader 0 7 9 juriel 2020 we used qt creator 4 11 0 the qt company 2020 to develop the graphical user interface gui and python 3 8 with the qgis3 python standard libraries gdal math numpy datetime and os for the associated functionality detailed installation instructions and the source code can be found on github com floell qwatermodel blob master readme md 2 2 application and testing to test the plugin we used data recorded in a mature monoculture oil palm elaeis guineensis jacq plantation located in the lowlands of sumatra jambi province indonesia 103 3914411 e 1 6929879 n 76 m a s l see meijide et al 2017 for further details we exemplarily use lst recordings from two independent sources drone and handheld camera to test the qwatermodel plugin against eddy covariance reference measurements 1 images recorded with an octocopter drone mk easy okto v3 hisystems germany equipped with a radiometric thermal camera flir tau 2 640 flir systems usa attached to a teax thermo capture module teax technology germany the data have a spatial resolution of 0 2 m and cover a footprint of 0 8 ha and are thus suitable for tree scale to stand scale assessments of et 13 images from 09 00 to 15 00 h local time on 7th of august 2017 were recorded in 30 min intervals 2 images taken from a tower at 10 m above the canopy with a handheld fluke ti100 thermal camera fluke systems usa the data have an approx spatial resolution of 0 06 m and a footprint of 0 006 ha and are thus suitable for leaf to canopy assessments of et 5 images from 11 00 to 15 00 h on 7th of august 2017 were taken in 60 min intervals data are provided for download at github com floell qwatermodel tree master data examples we did not include satellite images into this study since this was already included in the original dattutdut model study timmermans et al 2015 in addition satellite landsat 7 and 8 recorded lst maps for our study region contain a very high cloud cover fraction for 2017 min 23 mean 72 max 100 our study thus focuses on drone and handheld thermal camera acquired images a widely accepted ground based reference method for et assessments is the eddy covariance method which provides measurements of et at the stand scale eddy covariance data at the oil palm site was recorded filtered and processed according to the methodology described in meijide et al 2017 because the energy balance model used in the plugin assumes full energy balance closure eddy covariance data was processed using the bowen ratio closure method pan et al 2017 twine et al 2000 horizontal energy flows or incomplete energy balance closure might introduce certain errors to this reference method loescher et al 2006 to derive et from latent heat fluxes latent heat of vaporization was calculated using in situ air temperature measurements for eddy covariance measurements and the lowest pixel temperatures from the lst maps for the plugin estimates following the methodology described in timmermans et al 2015 3 results 3 1 software implementation results the qwatermodel plugin can be installed from the official qgis3 python plugin repository the plugin gui consists of a main window with four different input sections a b c d fig 1 and an information window which are both organized using tabs in the main window section a contains the inputs that are essential for the plugin to work with in a minimal data approach a thermal image with temperatures in kelvin e g from satellite drone or handheld camera the definition of an output raster and an output file where key statistics will be summarized and the coordinated universal time utc when the picture was taken providing information in boxes b c and d is optional but may improve the quality of the et estimates the default values that are visible in the input fields of box b are taken from timmermans et al 2015 and can be adjusted if more local data are available from field measurements or previous studies the info tab offers detailed information on input output and usage of the plugin the plugin outputs a raster with 6 bands net radiation rn w m 2 latent heat flux le w m 2 sensible heat flux h w m 2 ground heat flux g w m 2 evaporative fraction ef in and evapotranspiration et mm time period input raster details and output statistics are stored in a csv file fig 2 shows a workflow example with lst data from different sources i e recorded from drone and handheld thermal camera and the corresponding output 3 2 software experimental testing results land surface temperatures differed with the time of recording thermal variability was high in both drone and handheld camera obtained maps table 1 to compare the et estimates from drone and handheld thermal camera maps with a measured reference we plotted them against the daily course of eddy covariance derived et values fig 3 and into a scatterplot comparing measurements and predictions of et fig 4 applying the energy balance model in its original version with minimal data input resulted in overestimations of et during the morning and afternoon hours but in acceptable estimates around noon fig 3a errors were smaller for the estimates based on handheld camera pictures than on drone recordings table 2 more precise results were achieved by adding measured short wave irradiance fig 3b or net radiation measurements fig 3c to the model inputs i e et estimates closely follow the reference method if additional radiation data is supplied the handheld thermal camera maps generally produce slightly more congruent results with the eddy covariance measurements than drone maps therein around noon et estimates from drone maps are slightly higher than eddy covariance et measurements in the minimal data approach et predictions are most congruent with eddy covariance measurements when et is high fig 4a while in contrast predictions are most congruent at low et when measurements of short wave irradiance or net radiation are used in the model fig 4b and c congruence generally increases with increasing measurement based input errors are thus smallest for models computed with directly measured net radiation table 2 4 discussion and conclusions the qwatermodel plugin is an easy to use open source tool for predicting evapotranspiration from land surface temperatures it is aimed at applications in ecology bioclimatology and land use science but is also useful for a broader utilization including hydrological and ecosystem management it offers a link between science and practical application of energy balance modelling for et prediction meeting our objectives a variety of lst data from very different sources and spatial extends can be used as input and complementary data input requirements were kept at a minimum level the case study showed that images taken at the same time but with different camera setups drone and handheld result in comparable results for et estimates and show high congruence with reference eddy covariance measurements because in the minimal data approach the radiation budget is calculated from sun earth geometry clouds and relative humidity or haze are not considered this explains the overestimation of et in the morning and afternoon hours fig 3a in situ measurements of short wave irradiance or net radiation significantly improved the et estimates fig 3b and c similar observations were made in other studies e g on european grasslands where additional short wave irradiance measurements improved the overall accuracy of the dattutdut model brenner et al 2018 a method comparison of the dattutdut model with the eddy covariance method over varying weather conditions and day times showed the general applicability of this approach in the tropics and suggested no difference between drone based and eddy covariance method for certain configurations ellser et al submitted however even when using measured short wave or net radiation et estimates based on drone recorded lst data showed overestimations around noon which did not occur in the estimates based on handheld images a possible reason is the presence of artefacts e g roofs cars rocks in the drone images which have a much larger footprint than the handheld images temperatures on such non canopy components can differ greatly from surface temperatures of vegetation and these temperature outliers have a strong effect on the quality of predictions this was also observed in a study with big temperature differences conducted in vineyards xia et al 2016 a potential solution would be to manually exclude known artefacts from the images before analysis or to manually define minimal and maximal temperatures in the gui of the plugin unfortunately no matching satellite images were available for the time and date when drone and handheld camera maps were recorded therefore further analyses are not performed in this study this should be followed up upon in future studies even though a major restriction in our study region is that satellite images are generally hard to acquire since a considerable cloud cover is present on most days of the year a further challenge is the fixed overpass time of satellites which is often not around noon and therefore not ideal for et derivation delogu et al 2012 to overcome these limitations complementary et methods from planes drones and handheld or fixed thermal cameras can potentially be calibrated against simultaneously acquired satellite images e g using qwatermodel and then be applied to increase temporal and spatial coverage the scatterplots reveal a gap between lower and higher et estimates fig 4b and c this gap and its absence in the et estimates based on modelled rn in fig 4a demonstrates the effects of clouds on prediction accuracy if clouds are present and measurements of short wave irradiance or net radiation can represent this adequately in the model et estimates are clearly lower than with the rn modelling approach future improvements of the software could include a referencing tool that links ground measurements of hot and cold surfaces with lst data this would allow for a simple radiometric correction of lst images and maps to make the plugin applicable to the needs of a broader range of users upcoming versions could further include other lst map based indices such as the cwsi crop water stress index bian et al 2019 idso et al 1981 jones 2014 we appreciate all user input and ideas to further develop the plugin and encourage to modify the plugin for other et related applications or to report bugs via our bug tracker in the present study the software was only tested at one site a commercial monoculture oil palm plantation in lowland sumatra we strongly encourage the testing and use of the software in other climatic regions and on other crop and ecosystem types for further validation we provide the source code for the plugin and plan to consistently add more functionality to the qwatermodel 5 software availability name of software qwatermodel software version 1 0 developers florian ellser software license gnu general public license contact address tropical silviculture and forest ecology university of gttingen bsgenweg 1 37077 gttingen germany email fellsae gwdg de availability plugins qgis org plugins qwatermodel github com floell qwatermodel declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this study was funded by the deutsche forschungsgemeinschaft dfg german research foundation project number 192626868 sfb 990 subprojects a02 and a03 and the ministry of research technology and higher education ristekdikti indonesia we thank ristekdikti for providing the research permit for field work no 28 ext sip frp e5 dit ki vii 2017 we thank our field assistant zulfi kamal for his support and technician edgar tunsch for taking canopy pictures we also thank perseroan terbatas perkebunan nusantara vi batang hari unit ptpn6 for giving us permission to conduct our research at the oil palm plantation thanks to all efforts colleagues and friends in indonesia germany and around the world appendix a supplementary data the following is the supplementary data to this article multimedia component 1 multimedia component 1 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j envsoft 2020 104739 
