index,text
3900,recently dendrogeomorphic methods have been increasingly used for the dating past flood events and tree ring based approaches are generally considered valuable tools in palaeohydrology several limitations of the approach are known but their effects on the resulting chronologies have not been assessed or quantified thus this study attempts to critically evaluate and quantify the effectiveness of dendrogeomorphology in past flood analysis the tree ring based methods were tested on two long term monitored contrasting catchments in a region in the outer western carpathians in total 101 sampled trees provided evidence of 126 growth disturbances enabling the reconstruction of seven flood events approximately during the last 30 years in each catchment after the comparison of monitored discharges with tree ring records standard dendrogeomorphic indices enabled the detection of approximately half of the flood events with discharges larger than the maximal sensitivity of the approach used minimal detected discharge corresponding to ca q2 nevertheless significant differences were identified between the two catchments values of dendrogeomorphic indices corresponded well to values of maximal discharges and increasing the indices thresholds increased the proportion of detected floods in narrow mountainous catchment in contrast no effect on the proportion of detected flood events after indices threshold increase was detected in the case of a wide braided channel in the second catchment however the indices values corresponded well to the flood volume the differences were probably caused by the water level behaviour in narrow and wide channels thus it seems that the characteristics of channel reaches must be very carefully considered in regard to the interpretation of dendrogeomorphic results of past flood events keywords dendrogeomophology flood discharge effectiveness evaluation 1 introduction botanical evidences of past hydrological extremes are supposed to be a valuable data source in helping with their identification and dating sigafoos 1964 bodoque et al 2020 the use of dendrogeomorphic methods alestalo 1971 when working with this type of information is generally acceptable as a useful tool providing data based on tree ring dating for filling in incomplete flood records stoffel et al 2013 ballesteros et al 2015d knowledge regarding past flood events is crucial for the determination of the development and behaviour of river systems as well as for the assessment of flood hazards and risks gill and malamud 2017 musolino et al 2020 the basic principle of dendrogeomorphic detection of past flood events follows the standard scheme presented by shroder 1978 floods can have very destructive effects on riparian vegetation due to the dynamics of flowing material impacting tree stems and branches or due to extreme changes in soil aeration directly affecting the tree rhizosphere trees respond to these effects by specific growth responses that are detectable and dendrochronologically datable sigafoos 1964 stoffel and corona 2014 wilhelm et al 2019 trees can produce callus tissue or tangential rows of traumatic resin ducts trds in some coniferous species stoffel 2008 as a response to their surface wounding by flowing woody material or rock clasts zielonka et al 2008 abrupt growth suppression can be observable in trees with buried stem bases by flood sediments friedman et al 2005 dynamic flood events can even cause stem tilting due to the pressure of the water mass ballesteros et al 2015b in these cases trees respond by creating reaction wood or eccentric growth the effect of floods on tree growth can even be indirect when surviving individuals can profit and release their growth after the killing of their neighbours stoffel and bollschweiler 2008 these growth responses are macroscopically identifiable but some responses have clearly microscopic anatomical characteristics for example ballesteros et al 2010a b detected a decrease in cell lumen area as a response to flood scarring and yanosky 1984 and lópez et al 2014 detected changes in the vessel lumen area of inundated trees due to an interrupted supply of oxygen to tree roots during floods generally the effects of flood events are supposed to be different in the cases of high gradient streams and low gradient meandering rivers the structure of external disturbances on the tree surface and the corresponding growth responses differ stem wounding dominates along high gradient streams whereas anatomical responses to long lasting stem inundation dominate along low gradient rivers moreover even the height of scars on tree stems expresses greater variability and deviation from the real water level during floods in high gradient streams yanosky and jarrett 2002 next data from high gradient streams regarding past flood events are often missing due to their remoteness or absence of gauging stations nevertheless the discharge regime in these catchments plays an important role in the formation of floods in their low gradient fronts generally knowledge of past flood events is underestimated and tree ring based methods can help fill in missing events ballesteros et al 2015d however the remaining question to solve is the character of added events flood scars on tree stems are frequently used for the reconstruction of past flood discharges as palaeo stage indicators psis ballesteros et al 2011 quesada román et al 2020 ruman et al 2021 nevertheless this reconstruction is usually performed only for a limited number of events to date no critical evaluation of tree ring based dated flood characteristics has been realized in localities where discharge modelling is absent crucial questions regarding the minimal flood discharge recordable by trees in a specific catchment the proportion of undetected flood events with discharges at approximately a minimal level or the characteristics of recorded flood events duration peak discharge remain unanswered obtaining adequate data for solving these questions is possible by comparing dendrogeomorphic records of flood events with real measured historical discharge data this comparison enabled the definition of the sensitivity of dendrogeomorphic approaches for landslide dating šilhán et al 2019 the results of dendrogeomorphic analysis are generally supposed to be minimal stoffel and bollschweiler 2008 but only in the case of rockfalls was the proportion of missing events estimated trappmann et al 2013 similar estimation for flood events is missing defining the effectiveness of the tree ring based reconstruction of flood events could help overcome some problems associated with the incorporation of dated floods into long term historical records caused e g by different characteristics of floods among catchments with various environmental conditions this step could be of particular interest especially at present when the number of regional tree ring based reconstructions of floods from various regions of the world is increasing ballesteros et al 2015a 2017 šilhán 2015 rodriguez morata et al 2016 tichavský et al 2020 based on the abovementioned gaps and challenges in understanding the dendrogeomorphic dating of flood events and in agreement with the recent challenges mentioned by ballesteros et al 2020 the aims of this paper are i to define the effectiveness of dendrogeomorphic methods for flood dating how large floods are recorded what is the proportion of unrecorded floods ii to define the effects of flood characteristics on their ability to be recorded and iii to assess the effects of catchment properties on the effectiveness of dendrogeomorphic dating these aims are addressed in two contrasting catchments in the moravskoslezské beskydy mountains outer western carpathians 2 study area the studied reaches are located in two catchments draining the moravskoslezké beskydy mountains which are the highest mountain range in the czech part of the outer western carpathians table 1 fig 1 the čeladenka reach contains a gravel bed single thread stream in a confined valley whereas the morávka reach contains a multi thread river pattern in an unconfined valley fig 1 this implies contrasting characteristics between a fluvial corridor and riparian zone the čeladenka reach has very limited floodplain segments and rare gravel bars and trees with visible external disturbances were located directly on stream banks and on adjacent hillslopes above bank level the morávka reach contains extensive gravel bars and a pair of low mostly flooded annually and high terraces flooded during high magnitude events in an active floodplain where the sampled trees were distributed on all these fluvial forms except for valley confinement the altitude of the reaches predisposed the occurrence of different tree species in the riparian corridors norway spruce picea abies l karst with accessory european alder alnus glutinosa l gaertn and european beech fagus sylvatica l dominate the čeladenka reach whereas a mosaic of willow species european alder sycamore acer pseudoplatanus l european ash fraxinus excelsior l and european oak quercus robur l prevail in the morávka reach both catchments are gauged 0 5 km downstream čeladenka reach and 3 km upstream morávka reach of the study area annual precipitation in the studied catchments varies between 1000 and 1800 mm mostly falling as cyclonic or storm rainfall during warm year periods in the local temperate climate data source czech hydrometeorological institute floods triggered by melting snow are very rare šilhán 2015 the last high magnitude floods up to 50 100 year recurrence interval in the moravskoslezké beskydy mountains occurring in june 1997 and may 2010 were related to long term intensive rainfall of low pressure systems and both events were accompanied by large morphological changes in the mountain streams and foothill rivers šilhán et al 2016 škarpich et al 2020 however even bankfull flows are connected with intensive bedload transport as a consequence of local flysch lithology and the dominant supply of relatively fine sediment fractions galia and škarpich 2016 there are no significant human alterations dams weirs in the čeladenka catchment which would affect the hydrological regime of this stream however the hydrological regime in the morávka catchment is strongly influenced by the presence of the morávka dam and the vyšní lhoty weir with the morávka žermanice diversion canal since the 1960s both located upstream 8 km and 3 5 km respectively of the studied reach these interventions have decreased the frequency and magnitude of high flow events since the 1960s which has resulted in reduced channel morphodynamics and succession of riparian vegetation and has decreased the intensity of bedload transport in the multi thread reach škarpich et al 2020 despite this fact the present lateral channel migration is still able to supply the river with large wood during floods máčka and krejčí 2011 3 methods 3 1 dendrogeomorphic procedure to obtain maximally representative results the field sampling design and laboratory sample processing followed the standard procedure used in the dendrogeomorphic analysis of floods ballesteros et al 2015d trees for sampling were selected based on the presence of visible external disturbances fig 1c sigafoos 1964 ruiz villanueva et al 2010 to overcome the sampling of trees affected by nonflood impacts trees with the presence of very long scars or scars oriented on the opposite side of the stem with respect to stream flow were not sampled the position of each sampled tree was recorded by a gnss device moreover the positions of trees growing in the morávka catchment were associated with the morphological form of the flood plain with respect to a suggestion by ruiz villanueva et al 2010 upper terrace lower terrace avulsion channel and main active channel each visible scar was very precisely sampled via a pressler increment borer maximal length 40 cm diameter 0 5 cm at the position of the callus tissue transition to normal undisturbed wood to enable dating with seasonal precision if possible a wedge cut was extracted using a hand saw in the position of the callus pad moreover another increment core was extracted from the opposite side of the stem in relation to the stream flow next at least 20 undisturbed trees growing out of the flood reach were sampled for reference chronological construction all samples were processed in the standard way stoffel and bollschweiler 2008 increment cores were air dried glued into wood supports and sanded so that all tree rings were clearly visible next individual tree rings were counted and their width was measured under a stereoscope using dendrochronological timetable and past4 software v i a s 2005 a reference chronology was created in arstan software holmes 1994 subsequently tree ring series of disturbed trees were cross dated against the reference chronology to identify and correct possible false missing rings and to distinguish the climate induced abrupt growth changes from the flood induced changes some tree ring series of disturbed trees were too short for statistical verification of cross dating accuracy using cofecha holmes 1994 thus visual cross dating based on the increment curve comparison was supported by skeleton plot realization after all tree ring series were checked growth disturbances gd scars trd and abrupt growth suppression induced by past flood events were identified from the increment curves and by visual observation of sample surfaces and dendrochronologically dated samples the position of the scar signalized by callus tissue presence and trd only in tree ring series of coniferous tree species p abies in this case within the tree ring width was used for dating of an event with seasonal precision following the strategy of stoffel et al 2005 and schneuwly and stoffel 2008 events were divided into three seasonal groups according to whether gd occurred in the dormancy early wood or late wood zone of the tree ring moreover the intensity of each gd strong or moderate was defined according to stoffel and corona 2014 e g strong trd has to have a form of extremely compact and continuous rows all gds were summarized in individual years and their chronology was expressed in two ways first the standard event response it index was calculated following the formula of shroder 1978 1 it r t a t 100 where r is the number of disturbed trees in year t and a is the total number of sampled trees alive in year t the second way was the calculation of the weighted version of the event response index wit that was originally developed for debris flow analysis kogelnig mayer et al 2011 but recently it has been commonly used in flood reconstructions ballesteros et al 2015a c zaginaev et al 2016 šilhán et al 2018 2 w it s t i 7 s t s 5 s t m 3 s r t s a t where ti is the number of trees with scars or callus tissue ts is the number of trees with a strong gd and tm is the number of trees with a moderate gd the threshold of both indices used for flood definition followed the recommendations of stoffel et al 2013 considering the total number of sampled trees the threshold for it was 5 and 1 for wit and at least two trees had to contain gd simultaneously the calculation of both indices was performed to test the sensitivity of each for flood detection moreover the effect of indices threshold changes on the number of detected flood events was tested for two scenarios i it 7 5 and wit 2 and ii it 10 and wit 2 5 3 2 hydrological data processing daily discharge data series both 38 years long series 1981 2019 from the čeladenka gauging station and morávka gauging station were used for the calculation of recurrence intervals of maximal annual daily discharges by using the log pearson type iii distribution in the studied reaches this method is standardized for the calculation of recurrence intervals of maximal discharges in czechia this data series includes years with significant droughts e g 2015 and 2016 as well as major flood events 1997 and 2010 both with up to up to 50 100 year recurrence interval and therefore the calculated recurrence intervals can be perceived as quite representative for the local hydrological regime the catchment area related to the gauging station is similar to the contributing catchment area of the study reach of morávka less than 10 increase table 1 and there are no significant tributaries between them however there was up to a threefold increase in the catchment area between the upstream part of the study reach in čeladenka and the contributing catchment area of the gauging station owing to the relatively small size of the catchment and the total length of the investigated reach table 1 however based on our field observations and the extensive dendrogeomorphic dating of fluvial activity in the čeladenka catchment šilhán 2014 we assume that individual high flow events and their specific recurrence intervals occur simultaneously in the entire catchment area although the discharge values will increase with increasing catchment area along the studied reach however this may affect the transport intensity of the material bedload floated wood which has the potential to damage riparian vegetation when the upper reaches may indicate lower transport intensity and thus a lower probability to disturb living trees the maximal annual daily discharges and related high flow events within the period of 1997 2018 were analysed in which this period covered the years with the events detected by dendrogeomorphic procedures for flows exceeding the two year recurrence interval of maximal daily discharge the volumes of the high flow events at the gauging stations were calculated from related hydrographs because these hydrographs were based on the daily discharge data series the calculated volumes should be considered only as rough estimations primarily to compare the efficiency of individual high flow events nevertheless even the shortest events in the studied catchments had a longer duration than five days based on the inflexion points in the related hydrographs in addition this high flow volume was calculated for the lower 2017 event in morávka q1 5 q2 recurrence interval due to the dating of the significant number of tree scars in that year maximum daily discharges and volume of selected flood events were compared with the values of tree ring based it and wit indices 4 results 4 1 sampled trees growth disturbances and flood chronologies the total number of sampled trees in both channel segments was relatively balanced morávka 55 trees and čeladenka 46 trees individuals of p abies dominated 60 1 above a glutinosa individuals 39 9 in the case of čeladenka in contrast exclusively broad leaved trees were sampled in morávka a glutinosa 63 6 a pseudoplatanus 16 4 f excelsior 12 7 and q robur 7 3 alnus glutinosa was the only species sampled along the main active channel and avulsion channel whereas it was a minor species 8 3 in the upper terrace where a pseudoplatanus f excelsior and q robur dominated trees in čeladenka were slightly older mean age 31 6 years stdev 17 5 years than trees in morávka mean age 25 8 years stdev 16 6 years generally the oldest trees were individuals of p abies in čeladenka mean age 39 8 years stdev 17 6 years whereas the youngest trees were individuals of a glutinosa mean age 13 1 years stdev 6 4 years in morávka the number of trees has gradually increased since 1991 when the sample size reached five trees the minimal number for chronology construction in morávka in contrast a sample size of five trees was reached in 1970 in čeladenka the number of trees gradually increased up to the end of the 1990s when the sample size accelerated distinctly in general 126 gds were identified in trees from both catchments morávka 65 gd and čeladenka 61 gd only three types of gd were identified scars strong trd and strong abrupt growth suppression scars fully dominated in both catchments morávka 92 3 and čeladenka 90 2 generally younger gds were detected along the main active channel and avulsion channel whereas the oldest gds were detected on the upper terrace fig 2 in the case of morávka more details regarding the tree age and the structure of gds are presented in table 2 thresholds of both indices and the minimal number of trees with gd were reached in seven cases in morávka 1997 1999 2000 2010 2014 2017 and 2018 fig 3 a the highest indices values were reached in 2010 and 2014 it 28 6 and 29 1 respectively wit 24 0 and 30 3 respectively both indices detected the same number in the same events the total relevant chronology length was 28 years and the reconstructed mean flood recurrence was 4 0 years the same reconstruction results were obtained when the indices threshold increased to 7 5 and 2 respectively the same results were even obtained when the it threshold increased to 10 but only six events were detected when the wit threshold was increased to 2 5 fig 4 a both indices thresholds enabled the detection of seven events even for čeladenka 1972 1997 2001 2007 2010 2014 and 2017 fig 3b all events were detected by both indices simultaneously the highest indices values were reached in 1997 45 7 and 66 2 respectively the total relevant length of chronology was 49 years thus the mean reconstructed recurrence interval of flood events was 7 0 years nevertheless if the chronology length is limited since the largest detected flood in 1997 followed by an abrupt increase in sample size the recurrence interval decreases to 3 7 years if the indices thresholds increase to 7 5 and 2 respectively the number of detected flood events decreases to six the number of detected events decreases to five if the indices thresholds increase to 10 and 2 5 respectively fig 4b however both indices still detect the same events 4 2 the character of detected flood events the lowest maximal annual discharge detected by dendrogeomorphic methods in the case of morávka was in 2014 28 4 m3 s 1 this discharge was larger than q2 q2 24 8 m3 s 1 during the reconstructed period this discharge was reached in 14 years and seven of them were detected by dendrogeomorphic methods 50 fig 5 a the increase in indices thresholds up to 10 and 2 5 respectively did not bring different results the values of indices during the detected events do not provide any correspondence with culmination discharges r 0 16 and 0 13 respectively in contrast the lowest detected maximal annual discharge in the case of čeladenka was in 2017 7 9 m3 s 1 this discharge generally corresponds to q2 q2 8 5 m3 s 1 and since the 1997 flood it was reached in 13 years dendrogeomorphic methods detected six of these years 53 8 in contrast to morávka the values of both indices significantly correlate with discharge values r 0 74 and 0 49 respectively in the case of čeladenka if the indices thresholds increase to 10 and 2 5 simultaneously respectively the number of detected high flow events since 1997 decreases and the minimal detected discharge increases to 10 6 m3 s 1 q5 14 4 m3 s 1 fig 5b since the 1997 flood this discharge was reached in six years and dendrogeomorphic methods detected four of them 66 7 the dates of maximal annual discharge during dated high flow events in morávka ranged between may 17 2014 and september 24 2017 similar results were observed in the case of čeladenka where the dates ranged between april 28 2017 and september 7 2007 these dates correspond well with the seasonal dating of scars based on intra annual position of callus tissue in the total tree ring width fig 6 if the volume of a high flow event is considered the minimal volume was recorded in 2014 10 2 mil m3 for morávka this volume was reached in 10 years after 1997 and dendrogeomorphic methods recorded 70 of them in contrast the minimal recorded volume of the high flow event was 3 23 mil m3 2014 in the case of čeladenka this volume was reached in nine years after 1997 and dendrogeomorphic methods were able to detect 66 7 of them the same results as in the maximal discharge analysis fig 7 5 discussion the effectiveness of dendrogeomorphic methods for past flood event detection was tested on two rivers with different physical geographic channel parameters in total 55 trees were analysed in the morávka river in the multi thread channel reach and unconfined valley settings and 46 trees were analysed in the čeladenka river in the single thread reach and confined valley settings seven past high flow events were dated in both catchments and the dating results were compared with the long term series of monitored discharges and calculated volumes of the events the structure of detected tree species in both catchments corresponds to the general biogeographical assumptions douda et al 2016 when the broadleaf trees were the exclusive species in the fluvial corridor of morávka in contrast a greater proportion of coniferous trees was typical of the more mountainous character of čeladenka zielonka et al 2008 this tree species distribution has a direct impact on the number and types of identified gd left by past flood events trd as a response to stem wounding was exclusively detected in the case of čeladenka due to the presence of p abies stoffel 2008 generally scars fully dominated among the gd types this fact was expected due to the very selective method of sampling nevertheless this proportion is distinctly larger than e g that measured by ballesteros et al 2015a who used the same sampling strategy the difference in this study could have been caused by the much younger age of the scars in which it was much easier to extract the sample from an accurate position next the thin bark of dominating broad leaved trees could also affected on more precise sampling moreover the variable bark thickness or wood density of different tree species can have even the direct impact on the ability of a tree to be damaged during a flood and to record the events in their tree ring series the ability of trees in the čeladenka river to form trd compared to the morávka river could positively affect the number of recorded flood events in this locality however the higher bark thickness in coniferous trees with trd production ability could reduce the sensitivity of trees to floods considering both mentioned aspects trd formation vs high bark thickness it does not seem that the different ratio of coniferous and deciduous trees in both studied localities would have a significant effect on the reconstructed chronology however this could be verified in future research the high proportion of dated scars has a direct impact on the values of the wit index because they have the highest weight of all gd types and intensities in the same line of thought the high presence of scars within the structure of dated gd ensures the high dating precision compared to abrupt growth changes that can suffer from inaccuracies stoffel and bollschweiler 2008 despite the limited possibilities for statistical verification of the cross dating accuracy of young broad leaved trees it seems that they provide more valuable data regarding recent floods than old coniferous trees this species dependent sensitivity of trees can suggest the direct impact of tree species and tree age on the resulting tree ring based chronologies of past flood events the mentioned aspects can be even considered when working following the recent general methodical approach presented by bodoque et al 2020 the spatial distribution of tree ages corresponded to the floodplain morphological zone in morávka the higher surface position corresponding to the upper terrace was reached only during the largest and less frequent floods see extensive inundation area for 20 year recurrence interval in fig 1d thus trees in these positions were not frequently damaged and logically express a greater mean age victoriano et al 2018 this spatially dependent age structure has a subsequent impact on the dated flood chronology when the oldest events are recorded exclusively by trees occupying the upper terrace which confirms the assumption of ruiz villanueva et al 2010 in contrast a similar state was not detected in the case of čeladenka whose channel is strictly confined by adjacent hillslopes with an absence of distinct floodplain segments generally culmination flood discharge is assessed via hydraulic modelling using the psi as height water mark hwm ballesteros et al 2011 in this study the possibility of various dendrogeomorphic indices for the relative assessment of the maximal annual daily discharge was tested generally a good correspondence between it and wit with maximal discharge was found in the case of čeladenka most likely the water level during a high flow event rapidly rises with increasing discharge owing to the strict valley confinement and thus the number of affected inundated trees located above the channel gradually increases in contrast no relationship between dendrogeomorphic indices and flood discharge was found in the case of morávka the water level after inundation in the active floodplain rises only slightly owing to the unconfined character of the valley floor which results in low differences in the number of inundated and wounded trees during flow events of various magnitudes dendrogeomorphic reconstruction in both catchments generally detected a relatively low number of high flow events 50 0 and 53 8 respectively in both contrasting catchments using standard indices thresholds these results are the first regarding the effectiveness of tree ring based methods in palaeohydrology and suggest a relatively high number of undetected events that agrees with the general assumption of the minimal frequency of dated events using dendrogeomorphic methods stoffel and bollschweiler 2008 better results are obtained when comparing the tree ring based data with the real volume of high flow events 70 0 and 66 7 respectively a more realistic chronology with a 30 0 gap was reconstructed in morávka this suggests that the total volume of a flood plays a more important role than the maximal discharge in wide braided reaches regarding the ability of floods to leave botanical evidence most likely in the river system with a relatively limited ability to raise the water level during floods due to the large width of the active floodplain the prolonged period of overbank flow increases the chance of riparian vegetation being damaged rather than the maximal discharge value with limited temporal duration moreover bank erosion as a local important process may be responsible for more intensive recruitment of large wood and therefore a higher potential to damage living trees by floating wood when compared to the confined reaches of čeladenka with no identified zones of massive tree recruitment the effect of the limited increase in water level during floods in morávka compared with čeladenka is observable even in the results obtained from the increased indices thresholds it seems that a very similar number of trees was inundated during high flows of various magnitudes in the case of morávka and the values of the dendrogeomorphic indices do not depend on their magnitude thus even very strict high indices thresholds are not able to effectively filter the largest floods this finding contrasts with čeladenka where the number of inundated and possibly damageable trees increased with increasing discharge in this case the shift of indices threshold is able to reduce the gaps in the reconstructed flood chronology focused on the largest floods all in all it is necessary to mention here that the above mentioned findings were obtained only from two catchments although contrasting and thus the conclusions cannot be taken as general to distinguish if the missing flood events in the tree ring based chronology are the results of trees that are not able to detect them or due to sampling approach controlled experiments should be performed in the future garrote et al 2018 a possible uncertainty in the approach used in this study is in the identification of the recorded flood from the discharge time series in some years several floods could have occurred škarpich et al 2013 in the studied catchments in these cases the dendrogeomorphic dating of floods with seasonal precision brought more light based on the intra annual position of the callus within the entire tree ring width tichavský et al 2021 the correct flood event during each year was selected next this analysis provided evidence that the largest flood during a year was always recorded in the tree ring series the results obtained clearly demonstrate the relative incompleteness of dendrogeomorphic records of past flood events primarily for the high flow events with 2 5 year recurrence intervals however these low magnitude events can be responsible for significant geomorphic changes in some dynamic fluvial environments e g braided rivers or ephemeral channels zen et al 2017 lotsari et al 2018 the reasons for this inconsistency can be caused by several factors generally the number of sampled trees can cause limited tree ring records nevertheless ballesteros et al 2015a and rodriguez morata et al 2016 used an even smaller number of sampled trees to obtain acceptable results and mentioned the limitations associated with the low number of trees another factor can be found in the limited number of damaged trees from all inundated trees during the flood this can be affected by the volume of flowing material during floods or by the sheltering effect of trees in groups next in line with the thoughts presented above the duration of floods can have an important effect on their ability to damage trees longer floods even with lower maximal discharges can damage more trees than short duration high magnitude flood events the volume of flowing material is the next important factor next the different tree species expresses the different sensitivity to geomorphic processes this sensitivity is often strongly age dependent šilhán et al 2015 šilhán 2021 thus the variety of tree species and their ages can impact the results of this study as well finally the absence of some earlier large floods in the tree ring based chronology can be caused by the destructive effect of later floods that destroy trees possibly containing signs of past flood events this was probably the case for the 1997 flood in čeladenka the destructive effect of this flood is supported by the increased colonization during the following years as recorded from sample size development in this sense the recovery potential of vegetation should also be taken into account when some broadleaf species e g willows or poplars are able to resprout immediately after floods zen et al 2017 6 conclusions this study attempts to critically evaluate and quantify the effectiveness of dendrogeomorphic methods for the detection of past flood events the tree ring based approach was tested on two contrasting catchments in a region in the outer western carpathians in total the analysis of 101 disturbed trees provided evidence of 126 growth disturbances revealing seven past flood events in both catchments the environmental character of each catchment determined the tree species structure which had a direct impact on the type and intensity of flood induced growth disturbances subsequently the character of the disturbances directly affected the values of the reconstructed dendrogeomorphic indices the physical geographical parameters of the catchments seem to be crucial even for the entire tree ring based analysis due to contrasting water level behaviour during flood events water inundation is limited in the confined mountainous valley the water level increases very distinctly and the values of the dendrogeomorphic indices directly correspond to the values of maximal discharge this contrasts with the wide active channel in the unconfined valley floor with a practically unlimited possibility of water inundation where the water level increase is not so distinct and a very similar number of trees is affected during floods of various magnitudes however the results are obtained only from two catchments so their generalization is limited generally the use of standard dendrogeomorphic indices was able to record approximately half of the flood events above the minimal sensitivity of the tree ring approach increasing indices thresholds generally detect larger floods with lower gaps nevertheless this effect was observed only in the case of single thread confined channels in contrast tree ring based data from a wide channel with unconfined valley settings correspond well with flood volumes suggesting a larger effect of the length of tree exposition to increased water level than the value of the maximal water level thus the main conclusion and recommendation of this study is to carefully consider the characteristics of the studied catchment and channel reach confined vs unconfined during dendrogeomorphic dating of floods because this factor directly affects the effectiveness of this approach the next possibly important factor affecting the tree ring based flood chronology is the species and age structure of the analysed trees the main findings of this study should be verified in the next catchments in the future credit authorship contribution statement karel šilhán conceptualization methodology investigation writing original draft writing review editing tomáš galia methodology investigation formal analysis writing original draft writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement this research was funded by university of ostrava project no sgs12 přf 2021 
3900,recently dendrogeomorphic methods have been increasingly used for the dating past flood events and tree ring based approaches are generally considered valuable tools in palaeohydrology several limitations of the approach are known but their effects on the resulting chronologies have not been assessed or quantified thus this study attempts to critically evaluate and quantify the effectiveness of dendrogeomorphology in past flood analysis the tree ring based methods were tested on two long term monitored contrasting catchments in a region in the outer western carpathians in total 101 sampled trees provided evidence of 126 growth disturbances enabling the reconstruction of seven flood events approximately during the last 30 years in each catchment after the comparison of monitored discharges with tree ring records standard dendrogeomorphic indices enabled the detection of approximately half of the flood events with discharges larger than the maximal sensitivity of the approach used minimal detected discharge corresponding to ca q2 nevertheless significant differences were identified between the two catchments values of dendrogeomorphic indices corresponded well to values of maximal discharges and increasing the indices thresholds increased the proportion of detected floods in narrow mountainous catchment in contrast no effect on the proportion of detected flood events after indices threshold increase was detected in the case of a wide braided channel in the second catchment however the indices values corresponded well to the flood volume the differences were probably caused by the water level behaviour in narrow and wide channels thus it seems that the characteristics of channel reaches must be very carefully considered in regard to the interpretation of dendrogeomorphic results of past flood events keywords dendrogeomophology flood discharge effectiveness evaluation 1 introduction botanical evidences of past hydrological extremes are supposed to be a valuable data source in helping with their identification and dating sigafoos 1964 bodoque et al 2020 the use of dendrogeomorphic methods alestalo 1971 when working with this type of information is generally acceptable as a useful tool providing data based on tree ring dating for filling in incomplete flood records stoffel et al 2013 ballesteros et al 2015d knowledge regarding past flood events is crucial for the determination of the development and behaviour of river systems as well as for the assessment of flood hazards and risks gill and malamud 2017 musolino et al 2020 the basic principle of dendrogeomorphic detection of past flood events follows the standard scheme presented by shroder 1978 floods can have very destructive effects on riparian vegetation due to the dynamics of flowing material impacting tree stems and branches or due to extreme changes in soil aeration directly affecting the tree rhizosphere trees respond to these effects by specific growth responses that are detectable and dendrochronologically datable sigafoos 1964 stoffel and corona 2014 wilhelm et al 2019 trees can produce callus tissue or tangential rows of traumatic resin ducts trds in some coniferous species stoffel 2008 as a response to their surface wounding by flowing woody material or rock clasts zielonka et al 2008 abrupt growth suppression can be observable in trees with buried stem bases by flood sediments friedman et al 2005 dynamic flood events can even cause stem tilting due to the pressure of the water mass ballesteros et al 2015b in these cases trees respond by creating reaction wood or eccentric growth the effect of floods on tree growth can even be indirect when surviving individuals can profit and release their growth after the killing of their neighbours stoffel and bollschweiler 2008 these growth responses are macroscopically identifiable but some responses have clearly microscopic anatomical characteristics for example ballesteros et al 2010a b detected a decrease in cell lumen area as a response to flood scarring and yanosky 1984 and lópez et al 2014 detected changes in the vessel lumen area of inundated trees due to an interrupted supply of oxygen to tree roots during floods generally the effects of flood events are supposed to be different in the cases of high gradient streams and low gradient meandering rivers the structure of external disturbances on the tree surface and the corresponding growth responses differ stem wounding dominates along high gradient streams whereas anatomical responses to long lasting stem inundation dominate along low gradient rivers moreover even the height of scars on tree stems expresses greater variability and deviation from the real water level during floods in high gradient streams yanosky and jarrett 2002 next data from high gradient streams regarding past flood events are often missing due to their remoteness or absence of gauging stations nevertheless the discharge regime in these catchments plays an important role in the formation of floods in their low gradient fronts generally knowledge of past flood events is underestimated and tree ring based methods can help fill in missing events ballesteros et al 2015d however the remaining question to solve is the character of added events flood scars on tree stems are frequently used for the reconstruction of past flood discharges as palaeo stage indicators psis ballesteros et al 2011 quesada román et al 2020 ruman et al 2021 nevertheless this reconstruction is usually performed only for a limited number of events to date no critical evaluation of tree ring based dated flood characteristics has been realized in localities where discharge modelling is absent crucial questions regarding the minimal flood discharge recordable by trees in a specific catchment the proportion of undetected flood events with discharges at approximately a minimal level or the characteristics of recorded flood events duration peak discharge remain unanswered obtaining adequate data for solving these questions is possible by comparing dendrogeomorphic records of flood events with real measured historical discharge data this comparison enabled the definition of the sensitivity of dendrogeomorphic approaches for landslide dating šilhán et al 2019 the results of dendrogeomorphic analysis are generally supposed to be minimal stoffel and bollschweiler 2008 but only in the case of rockfalls was the proportion of missing events estimated trappmann et al 2013 similar estimation for flood events is missing defining the effectiveness of the tree ring based reconstruction of flood events could help overcome some problems associated with the incorporation of dated floods into long term historical records caused e g by different characteristics of floods among catchments with various environmental conditions this step could be of particular interest especially at present when the number of regional tree ring based reconstructions of floods from various regions of the world is increasing ballesteros et al 2015a 2017 šilhán 2015 rodriguez morata et al 2016 tichavský et al 2020 based on the abovementioned gaps and challenges in understanding the dendrogeomorphic dating of flood events and in agreement with the recent challenges mentioned by ballesteros et al 2020 the aims of this paper are i to define the effectiveness of dendrogeomorphic methods for flood dating how large floods are recorded what is the proportion of unrecorded floods ii to define the effects of flood characteristics on their ability to be recorded and iii to assess the effects of catchment properties on the effectiveness of dendrogeomorphic dating these aims are addressed in two contrasting catchments in the moravskoslezské beskydy mountains outer western carpathians 2 study area the studied reaches are located in two catchments draining the moravskoslezké beskydy mountains which are the highest mountain range in the czech part of the outer western carpathians table 1 fig 1 the čeladenka reach contains a gravel bed single thread stream in a confined valley whereas the morávka reach contains a multi thread river pattern in an unconfined valley fig 1 this implies contrasting characteristics between a fluvial corridor and riparian zone the čeladenka reach has very limited floodplain segments and rare gravel bars and trees with visible external disturbances were located directly on stream banks and on adjacent hillslopes above bank level the morávka reach contains extensive gravel bars and a pair of low mostly flooded annually and high terraces flooded during high magnitude events in an active floodplain where the sampled trees were distributed on all these fluvial forms except for valley confinement the altitude of the reaches predisposed the occurrence of different tree species in the riparian corridors norway spruce picea abies l karst with accessory european alder alnus glutinosa l gaertn and european beech fagus sylvatica l dominate the čeladenka reach whereas a mosaic of willow species european alder sycamore acer pseudoplatanus l european ash fraxinus excelsior l and european oak quercus robur l prevail in the morávka reach both catchments are gauged 0 5 km downstream čeladenka reach and 3 km upstream morávka reach of the study area annual precipitation in the studied catchments varies between 1000 and 1800 mm mostly falling as cyclonic or storm rainfall during warm year periods in the local temperate climate data source czech hydrometeorological institute floods triggered by melting snow are very rare šilhán 2015 the last high magnitude floods up to 50 100 year recurrence interval in the moravskoslezké beskydy mountains occurring in june 1997 and may 2010 were related to long term intensive rainfall of low pressure systems and both events were accompanied by large morphological changes in the mountain streams and foothill rivers šilhán et al 2016 škarpich et al 2020 however even bankfull flows are connected with intensive bedload transport as a consequence of local flysch lithology and the dominant supply of relatively fine sediment fractions galia and škarpich 2016 there are no significant human alterations dams weirs in the čeladenka catchment which would affect the hydrological regime of this stream however the hydrological regime in the morávka catchment is strongly influenced by the presence of the morávka dam and the vyšní lhoty weir with the morávka žermanice diversion canal since the 1960s both located upstream 8 km and 3 5 km respectively of the studied reach these interventions have decreased the frequency and magnitude of high flow events since the 1960s which has resulted in reduced channel morphodynamics and succession of riparian vegetation and has decreased the intensity of bedload transport in the multi thread reach škarpich et al 2020 despite this fact the present lateral channel migration is still able to supply the river with large wood during floods máčka and krejčí 2011 3 methods 3 1 dendrogeomorphic procedure to obtain maximally representative results the field sampling design and laboratory sample processing followed the standard procedure used in the dendrogeomorphic analysis of floods ballesteros et al 2015d trees for sampling were selected based on the presence of visible external disturbances fig 1c sigafoos 1964 ruiz villanueva et al 2010 to overcome the sampling of trees affected by nonflood impacts trees with the presence of very long scars or scars oriented on the opposite side of the stem with respect to stream flow were not sampled the position of each sampled tree was recorded by a gnss device moreover the positions of trees growing in the morávka catchment were associated with the morphological form of the flood plain with respect to a suggestion by ruiz villanueva et al 2010 upper terrace lower terrace avulsion channel and main active channel each visible scar was very precisely sampled via a pressler increment borer maximal length 40 cm diameter 0 5 cm at the position of the callus tissue transition to normal undisturbed wood to enable dating with seasonal precision if possible a wedge cut was extracted using a hand saw in the position of the callus pad moreover another increment core was extracted from the opposite side of the stem in relation to the stream flow next at least 20 undisturbed trees growing out of the flood reach were sampled for reference chronological construction all samples were processed in the standard way stoffel and bollschweiler 2008 increment cores were air dried glued into wood supports and sanded so that all tree rings were clearly visible next individual tree rings were counted and their width was measured under a stereoscope using dendrochronological timetable and past4 software v i a s 2005 a reference chronology was created in arstan software holmes 1994 subsequently tree ring series of disturbed trees were cross dated against the reference chronology to identify and correct possible false missing rings and to distinguish the climate induced abrupt growth changes from the flood induced changes some tree ring series of disturbed trees were too short for statistical verification of cross dating accuracy using cofecha holmes 1994 thus visual cross dating based on the increment curve comparison was supported by skeleton plot realization after all tree ring series were checked growth disturbances gd scars trd and abrupt growth suppression induced by past flood events were identified from the increment curves and by visual observation of sample surfaces and dendrochronologically dated samples the position of the scar signalized by callus tissue presence and trd only in tree ring series of coniferous tree species p abies in this case within the tree ring width was used for dating of an event with seasonal precision following the strategy of stoffel et al 2005 and schneuwly and stoffel 2008 events were divided into three seasonal groups according to whether gd occurred in the dormancy early wood or late wood zone of the tree ring moreover the intensity of each gd strong or moderate was defined according to stoffel and corona 2014 e g strong trd has to have a form of extremely compact and continuous rows all gds were summarized in individual years and their chronology was expressed in two ways first the standard event response it index was calculated following the formula of shroder 1978 1 it r t a t 100 where r is the number of disturbed trees in year t and a is the total number of sampled trees alive in year t the second way was the calculation of the weighted version of the event response index wit that was originally developed for debris flow analysis kogelnig mayer et al 2011 but recently it has been commonly used in flood reconstructions ballesteros et al 2015a c zaginaev et al 2016 šilhán et al 2018 2 w it s t i 7 s t s 5 s t m 3 s r t s a t where ti is the number of trees with scars or callus tissue ts is the number of trees with a strong gd and tm is the number of trees with a moderate gd the threshold of both indices used for flood definition followed the recommendations of stoffel et al 2013 considering the total number of sampled trees the threshold for it was 5 and 1 for wit and at least two trees had to contain gd simultaneously the calculation of both indices was performed to test the sensitivity of each for flood detection moreover the effect of indices threshold changes on the number of detected flood events was tested for two scenarios i it 7 5 and wit 2 and ii it 10 and wit 2 5 3 2 hydrological data processing daily discharge data series both 38 years long series 1981 2019 from the čeladenka gauging station and morávka gauging station were used for the calculation of recurrence intervals of maximal annual daily discharges by using the log pearson type iii distribution in the studied reaches this method is standardized for the calculation of recurrence intervals of maximal discharges in czechia this data series includes years with significant droughts e g 2015 and 2016 as well as major flood events 1997 and 2010 both with up to up to 50 100 year recurrence interval and therefore the calculated recurrence intervals can be perceived as quite representative for the local hydrological regime the catchment area related to the gauging station is similar to the contributing catchment area of the study reach of morávka less than 10 increase table 1 and there are no significant tributaries between them however there was up to a threefold increase in the catchment area between the upstream part of the study reach in čeladenka and the contributing catchment area of the gauging station owing to the relatively small size of the catchment and the total length of the investigated reach table 1 however based on our field observations and the extensive dendrogeomorphic dating of fluvial activity in the čeladenka catchment šilhán 2014 we assume that individual high flow events and their specific recurrence intervals occur simultaneously in the entire catchment area although the discharge values will increase with increasing catchment area along the studied reach however this may affect the transport intensity of the material bedload floated wood which has the potential to damage riparian vegetation when the upper reaches may indicate lower transport intensity and thus a lower probability to disturb living trees the maximal annual daily discharges and related high flow events within the period of 1997 2018 were analysed in which this period covered the years with the events detected by dendrogeomorphic procedures for flows exceeding the two year recurrence interval of maximal daily discharge the volumes of the high flow events at the gauging stations were calculated from related hydrographs because these hydrographs were based on the daily discharge data series the calculated volumes should be considered only as rough estimations primarily to compare the efficiency of individual high flow events nevertheless even the shortest events in the studied catchments had a longer duration than five days based on the inflexion points in the related hydrographs in addition this high flow volume was calculated for the lower 2017 event in morávka q1 5 q2 recurrence interval due to the dating of the significant number of tree scars in that year maximum daily discharges and volume of selected flood events were compared with the values of tree ring based it and wit indices 4 results 4 1 sampled trees growth disturbances and flood chronologies the total number of sampled trees in both channel segments was relatively balanced morávka 55 trees and čeladenka 46 trees individuals of p abies dominated 60 1 above a glutinosa individuals 39 9 in the case of čeladenka in contrast exclusively broad leaved trees were sampled in morávka a glutinosa 63 6 a pseudoplatanus 16 4 f excelsior 12 7 and q robur 7 3 alnus glutinosa was the only species sampled along the main active channel and avulsion channel whereas it was a minor species 8 3 in the upper terrace where a pseudoplatanus f excelsior and q robur dominated trees in čeladenka were slightly older mean age 31 6 years stdev 17 5 years than trees in morávka mean age 25 8 years stdev 16 6 years generally the oldest trees were individuals of p abies in čeladenka mean age 39 8 years stdev 17 6 years whereas the youngest trees were individuals of a glutinosa mean age 13 1 years stdev 6 4 years in morávka the number of trees has gradually increased since 1991 when the sample size reached five trees the minimal number for chronology construction in morávka in contrast a sample size of five trees was reached in 1970 in čeladenka the number of trees gradually increased up to the end of the 1990s when the sample size accelerated distinctly in general 126 gds were identified in trees from both catchments morávka 65 gd and čeladenka 61 gd only three types of gd were identified scars strong trd and strong abrupt growth suppression scars fully dominated in both catchments morávka 92 3 and čeladenka 90 2 generally younger gds were detected along the main active channel and avulsion channel whereas the oldest gds were detected on the upper terrace fig 2 in the case of morávka more details regarding the tree age and the structure of gds are presented in table 2 thresholds of both indices and the minimal number of trees with gd were reached in seven cases in morávka 1997 1999 2000 2010 2014 2017 and 2018 fig 3 a the highest indices values were reached in 2010 and 2014 it 28 6 and 29 1 respectively wit 24 0 and 30 3 respectively both indices detected the same number in the same events the total relevant chronology length was 28 years and the reconstructed mean flood recurrence was 4 0 years the same reconstruction results were obtained when the indices threshold increased to 7 5 and 2 respectively the same results were even obtained when the it threshold increased to 10 but only six events were detected when the wit threshold was increased to 2 5 fig 4 a both indices thresholds enabled the detection of seven events even for čeladenka 1972 1997 2001 2007 2010 2014 and 2017 fig 3b all events were detected by both indices simultaneously the highest indices values were reached in 1997 45 7 and 66 2 respectively the total relevant length of chronology was 49 years thus the mean reconstructed recurrence interval of flood events was 7 0 years nevertheless if the chronology length is limited since the largest detected flood in 1997 followed by an abrupt increase in sample size the recurrence interval decreases to 3 7 years if the indices thresholds increase to 7 5 and 2 respectively the number of detected flood events decreases to six the number of detected events decreases to five if the indices thresholds increase to 10 and 2 5 respectively fig 4b however both indices still detect the same events 4 2 the character of detected flood events the lowest maximal annual discharge detected by dendrogeomorphic methods in the case of morávka was in 2014 28 4 m3 s 1 this discharge was larger than q2 q2 24 8 m3 s 1 during the reconstructed period this discharge was reached in 14 years and seven of them were detected by dendrogeomorphic methods 50 fig 5 a the increase in indices thresholds up to 10 and 2 5 respectively did not bring different results the values of indices during the detected events do not provide any correspondence with culmination discharges r 0 16 and 0 13 respectively in contrast the lowest detected maximal annual discharge in the case of čeladenka was in 2017 7 9 m3 s 1 this discharge generally corresponds to q2 q2 8 5 m3 s 1 and since the 1997 flood it was reached in 13 years dendrogeomorphic methods detected six of these years 53 8 in contrast to morávka the values of both indices significantly correlate with discharge values r 0 74 and 0 49 respectively in the case of čeladenka if the indices thresholds increase to 10 and 2 5 simultaneously respectively the number of detected high flow events since 1997 decreases and the minimal detected discharge increases to 10 6 m3 s 1 q5 14 4 m3 s 1 fig 5b since the 1997 flood this discharge was reached in six years and dendrogeomorphic methods detected four of them 66 7 the dates of maximal annual discharge during dated high flow events in morávka ranged between may 17 2014 and september 24 2017 similar results were observed in the case of čeladenka where the dates ranged between april 28 2017 and september 7 2007 these dates correspond well with the seasonal dating of scars based on intra annual position of callus tissue in the total tree ring width fig 6 if the volume of a high flow event is considered the minimal volume was recorded in 2014 10 2 mil m3 for morávka this volume was reached in 10 years after 1997 and dendrogeomorphic methods recorded 70 of them in contrast the minimal recorded volume of the high flow event was 3 23 mil m3 2014 in the case of čeladenka this volume was reached in nine years after 1997 and dendrogeomorphic methods were able to detect 66 7 of them the same results as in the maximal discharge analysis fig 7 5 discussion the effectiveness of dendrogeomorphic methods for past flood event detection was tested on two rivers with different physical geographic channel parameters in total 55 trees were analysed in the morávka river in the multi thread channel reach and unconfined valley settings and 46 trees were analysed in the čeladenka river in the single thread reach and confined valley settings seven past high flow events were dated in both catchments and the dating results were compared with the long term series of monitored discharges and calculated volumes of the events the structure of detected tree species in both catchments corresponds to the general biogeographical assumptions douda et al 2016 when the broadleaf trees were the exclusive species in the fluvial corridor of morávka in contrast a greater proportion of coniferous trees was typical of the more mountainous character of čeladenka zielonka et al 2008 this tree species distribution has a direct impact on the number and types of identified gd left by past flood events trd as a response to stem wounding was exclusively detected in the case of čeladenka due to the presence of p abies stoffel 2008 generally scars fully dominated among the gd types this fact was expected due to the very selective method of sampling nevertheless this proportion is distinctly larger than e g that measured by ballesteros et al 2015a who used the same sampling strategy the difference in this study could have been caused by the much younger age of the scars in which it was much easier to extract the sample from an accurate position next the thin bark of dominating broad leaved trees could also affected on more precise sampling moreover the variable bark thickness or wood density of different tree species can have even the direct impact on the ability of a tree to be damaged during a flood and to record the events in their tree ring series the ability of trees in the čeladenka river to form trd compared to the morávka river could positively affect the number of recorded flood events in this locality however the higher bark thickness in coniferous trees with trd production ability could reduce the sensitivity of trees to floods considering both mentioned aspects trd formation vs high bark thickness it does not seem that the different ratio of coniferous and deciduous trees in both studied localities would have a significant effect on the reconstructed chronology however this could be verified in future research the high proportion of dated scars has a direct impact on the values of the wit index because they have the highest weight of all gd types and intensities in the same line of thought the high presence of scars within the structure of dated gd ensures the high dating precision compared to abrupt growth changes that can suffer from inaccuracies stoffel and bollschweiler 2008 despite the limited possibilities for statistical verification of the cross dating accuracy of young broad leaved trees it seems that they provide more valuable data regarding recent floods than old coniferous trees this species dependent sensitivity of trees can suggest the direct impact of tree species and tree age on the resulting tree ring based chronologies of past flood events the mentioned aspects can be even considered when working following the recent general methodical approach presented by bodoque et al 2020 the spatial distribution of tree ages corresponded to the floodplain morphological zone in morávka the higher surface position corresponding to the upper terrace was reached only during the largest and less frequent floods see extensive inundation area for 20 year recurrence interval in fig 1d thus trees in these positions were not frequently damaged and logically express a greater mean age victoriano et al 2018 this spatially dependent age structure has a subsequent impact on the dated flood chronology when the oldest events are recorded exclusively by trees occupying the upper terrace which confirms the assumption of ruiz villanueva et al 2010 in contrast a similar state was not detected in the case of čeladenka whose channel is strictly confined by adjacent hillslopes with an absence of distinct floodplain segments generally culmination flood discharge is assessed via hydraulic modelling using the psi as height water mark hwm ballesteros et al 2011 in this study the possibility of various dendrogeomorphic indices for the relative assessment of the maximal annual daily discharge was tested generally a good correspondence between it and wit with maximal discharge was found in the case of čeladenka most likely the water level during a high flow event rapidly rises with increasing discharge owing to the strict valley confinement and thus the number of affected inundated trees located above the channel gradually increases in contrast no relationship between dendrogeomorphic indices and flood discharge was found in the case of morávka the water level after inundation in the active floodplain rises only slightly owing to the unconfined character of the valley floor which results in low differences in the number of inundated and wounded trees during flow events of various magnitudes dendrogeomorphic reconstruction in both catchments generally detected a relatively low number of high flow events 50 0 and 53 8 respectively in both contrasting catchments using standard indices thresholds these results are the first regarding the effectiveness of tree ring based methods in palaeohydrology and suggest a relatively high number of undetected events that agrees with the general assumption of the minimal frequency of dated events using dendrogeomorphic methods stoffel and bollschweiler 2008 better results are obtained when comparing the tree ring based data with the real volume of high flow events 70 0 and 66 7 respectively a more realistic chronology with a 30 0 gap was reconstructed in morávka this suggests that the total volume of a flood plays a more important role than the maximal discharge in wide braided reaches regarding the ability of floods to leave botanical evidence most likely in the river system with a relatively limited ability to raise the water level during floods due to the large width of the active floodplain the prolonged period of overbank flow increases the chance of riparian vegetation being damaged rather than the maximal discharge value with limited temporal duration moreover bank erosion as a local important process may be responsible for more intensive recruitment of large wood and therefore a higher potential to damage living trees by floating wood when compared to the confined reaches of čeladenka with no identified zones of massive tree recruitment the effect of the limited increase in water level during floods in morávka compared with čeladenka is observable even in the results obtained from the increased indices thresholds it seems that a very similar number of trees was inundated during high flows of various magnitudes in the case of morávka and the values of the dendrogeomorphic indices do not depend on their magnitude thus even very strict high indices thresholds are not able to effectively filter the largest floods this finding contrasts with čeladenka where the number of inundated and possibly damageable trees increased with increasing discharge in this case the shift of indices threshold is able to reduce the gaps in the reconstructed flood chronology focused on the largest floods all in all it is necessary to mention here that the above mentioned findings were obtained only from two catchments although contrasting and thus the conclusions cannot be taken as general to distinguish if the missing flood events in the tree ring based chronology are the results of trees that are not able to detect them or due to sampling approach controlled experiments should be performed in the future garrote et al 2018 a possible uncertainty in the approach used in this study is in the identification of the recorded flood from the discharge time series in some years several floods could have occurred škarpich et al 2013 in the studied catchments in these cases the dendrogeomorphic dating of floods with seasonal precision brought more light based on the intra annual position of the callus within the entire tree ring width tichavský et al 2021 the correct flood event during each year was selected next this analysis provided evidence that the largest flood during a year was always recorded in the tree ring series the results obtained clearly demonstrate the relative incompleteness of dendrogeomorphic records of past flood events primarily for the high flow events with 2 5 year recurrence intervals however these low magnitude events can be responsible for significant geomorphic changes in some dynamic fluvial environments e g braided rivers or ephemeral channels zen et al 2017 lotsari et al 2018 the reasons for this inconsistency can be caused by several factors generally the number of sampled trees can cause limited tree ring records nevertheless ballesteros et al 2015a and rodriguez morata et al 2016 used an even smaller number of sampled trees to obtain acceptable results and mentioned the limitations associated with the low number of trees another factor can be found in the limited number of damaged trees from all inundated trees during the flood this can be affected by the volume of flowing material during floods or by the sheltering effect of trees in groups next in line with the thoughts presented above the duration of floods can have an important effect on their ability to damage trees longer floods even with lower maximal discharges can damage more trees than short duration high magnitude flood events the volume of flowing material is the next important factor next the different tree species expresses the different sensitivity to geomorphic processes this sensitivity is often strongly age dependent šilhán et al 2015 šilhán 2021 thus the variety of tree species and their ages can impact the results of this study as well finally the absence of some earlier large floods in the tree ring based chronology can be caused by the destructive effect of later floods that destroy trees possibly containing signs of past flood events this was probably the case for the 1997 flood in čeladenka the destructive effect of this flood is supported by the increased colonization during the following years as recorded from sample size development in this sense the recovery potential of vegetation should also be taken into account when some broadleaf species e g willows or poplars are able to resprout immediately after floods zen et al 2017 6 conclusions this study attempts to critically evaluate and quantify the effectiveness of dendrogeomorphic methods for the detection of past flood events the tree ring based approach was tested on two contrasting catchments in a region in the outer western carpathians in total the analysis of 101 disturbed trees provided evidence of 126 growth disturbances revealing seven past flood events in both catchments the environmental character of each catchment determined the tree species structure which had a direct impact on the type and intensity of flood induced growth disturbances subsequently the character of the disturbances directly affected the values of the reconstructed dendrogeomorphic indices the physical geographical parameters of the catchments seem to be crucial even for the entire tree ring based analysis due to contrasting water level behaviour during flood events water inundation is limited in the confined mountainous valley the water level increases very distinctly and the values of the dendrogeomorphic indices directly correspond to the values of maximal discharge this contrasts with the wide active channel in the unconfined valley floor with a practically unlimited possibility of water inundation where the water level increase is not so distinct and a very similar number of trees is affected during floods of various magnitudes however the results are obtained only from two catchments so their generalization is limited generally the use of standard dendrogeomorphic indices was able to record approximately half of the flood events above the minimal sensitivity of the tree ring approach increasing indices thresholds generally detect larger floods with lower gaps nevertheless this effect was observed only in the case of single thread confined channels in contrast tree ring based data from a wide channel with unconfined valley settings correspond well with flood volumes suggesting a larger effect of the length of tree exposition to increased water level than the value of the maximal water level thus the main conclusion and recommendation of this study is to carefully consider the characteristics of the studied catchment and channel reach confined vs unconfined during dendrogeomorphic dating of floods because this factor directly affects the effectiveness of this approach the next possibly important factor affecting the tree ring based flood chronology is the species and age structure of the analysed trees the main findings of this study should be verified in the next catchments in the future credit authorship contribution statement karel šilhán conceptualization methodology investigation writing original draft writing review editing tomáš galia methodology investigation formal analysis writing original draft writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement this research was funded by university of ostrava project no sgs12 přf 2021 
3901,estimation of a soil water retention curve swrc is essential for modeling the water flow and solute transport a simple method to fit the measured retention data is the campbell function in this study the campbell function with an anchored gravimetric water content at 1500 kpa w1500 was used that included two parameters the campbell b and w1500 an inexpensive methodology was proposed for predicting these campbell parameters using visible near infrared spectroscopy vis nirs four calibration partial least squares regression models were developed the first model built on 230 soil samples predicted campbell b and w1500 vis nirs1 the second model used the same dataset for predicting campbell b but included 1570 samples for predicting w1500 vis nirs2 the third model combined predicted campbell b with measured w1500 vis nirs measured w1500 similar to approaches used in rosetta 1 software the fourth model used the entire datasets without splitting them into calibration and validation vis nirs3 the r2 of the campbell b and w1500 ranged from 0 to 0 89 and 0 02 0 91 respectively results showed that predicted swrcs were comparable with estimates from the rosetta 1 for two scenarios using soil texture and bulk density as inputs rosetta 1sc2 and using in addition water content at 33 and 1500 kpa rosetta 1sc4 it was concluded that the vis nirs based models captured the shapes of the swrc and vis nirs2 and vis nirs measured w1500 could be used as an alternative to rosetta 1sc2 however vis nirs based models failed to predict the swrc for the sandy soils most likely due to a small sample size abbreviations vis nirs visible near infrared spectroscopy plsr partial least squares regression swrc soil water retention curve w gravimetric water content ψ soil water matric potential keywords swrc pls vis nirs rosetta 1 1 introduction modeling of soil variable saturated flow and contaminant transport requires knowledge of the soil hydraulic properties such as the soil water retention curve and hydraulic conductivity soil water diffusivity and climatic conditions and agricultural practices the non linear relation between soil water content and matric potential is considered a crucial hydraulic property in the vadose zone describing the amount of water retained in a porous medium at a given matric potential and it depends on soil texture pore geometry and discontinuity sharma and uehara 1968 williams et al 1983 furthermore soil moisture characteristics are essential for describing the availability of soil water to plants and simultaneously are fundamental input in water flow and solute transport modeling varvaris et al 2021a varvaris et al 2019 several models mechanistic and empirical have been proposed for accurately fitting the measured soil water retention at the wet end or in drier conditions campbell and shiozawa 1992 or and tuller 1999 oswin 1946 rossi and nimmo 1994 van den berg and bruin 1981 van genuchten 1980 determination of swrc through direct measurements is a laborious and time consuming process furthermore the spatial variability of the soil properties within a field results in requiring a large number of soil samples to reduce uncertainties in relation to hydrogeological modeling since swrcs are essential for the modeling of water transport and biochemical processes in the unsaturated zone mader 1963 nielsen et al 1973 peck et al 1977 pham and fredlund 2008 varvaris et al 2018 varvaris et al 2019 wood et al 1988 therefore a methodology that provides fast and inexpensive predictions for swrc with a reasonable degree of accuracy is required a method that is well established and has successfully been used as an alternative for determining swrc is the pedotransfer function ptf iversen et al 2011 kotlar et al 2019 pittaki chrysodonta et al 2019 silva et al 2017 varvaris et al 2021b a ptf can be developed when knowledge of typically available soil properties such as clay content organic matter bulk density is available several researchers have developed ptfs for predicting the swrc using typically known soil properties such as soil texture and bulk density clapp and hornberger 1978 gupta and larson 1979 pittaki chrysodonta et al 2018 rudiyanto et al 2021 schaap et al 1998 schaap et al 2001 developed a computer program rosetta 1 for estimating swrcs by implementing hierarchical ptfs more recently rudiyanto et al 2021 improved the ptfs using the neuro m neural networks approach with different sets as inputs such as soil textural class or sand silt and clay contents and bulk density over the last few decades a large number of attempts have been made to predict soil properties using a promising spectroscopic method called visible near infrared spectroscopy vis nirs because of its simplicity rapidity a measurement takes only a few seconds reproducibility non destructiveness and avoids the use of hazardous chemicals knadel et al 2018 pittaki chrysodonta et al 2019 stenberg et al 2010 moreover the little sample preparation air drying and sieving before analysis makes this method more advantageous compared to other conventional laboratory methods in the literature there are only a few studies babaeian et al 2015a pittaki chrysodonta et al 2019 pittaki chrysodonta et al 2018 santra et al 2009 that have shown the ability of vis nirs to predict the swrc babaeian et al 2015a developed spectral transfer functions stfs for predicting soil water contents at nine specific soil matric potentials from saturation up to 1500 kpa they also developed vis nirs models for predicting the parameters of van genuchten α and n and brooks corey α and λ santra et al 2009 used stfs to predict the van genuchten α and n water retention model from saturation up to 80 kpa pittaki chrysodonta et al 2018 and pittaki chrysodonta et al 2019 examine whether vis nirs can be as good a predictor of the wet and dry part of the swrc respectively as classical ptfs in sandy to sandy loams there is a need to further explore the potential of using the vis nirs for predicting the swrc the objectives of this study were to 1 develop vis nirs models for predicting the two parameters of the anchored campbell soil water retention function at the driest available soil water potential i e 1500 kpa for 11 soil textural classes 2 evaluate the models performance a based on an independent validation dataset b within different textural classes c for horizon specific models by predicting the vis nirs swrc for subsoils using a calibration model derived from topsoil spectral data and vice versa d to improve the vis nirs models by adding soil water retention measured at 1500 kpa or predicted from a large vis nirs dataset and e by comparing the vis nirs predicted swrc with the predictions obtained from the rosetta ptfs across different soil textural classes and at different soil water matric potentials 2 materials and methods 2 1 soil database a total of 306 small library fig 1 and 1 658 larger library fig s1 soil samples were included in this study which were obtained from the national soil survey center nssc kellogg soil survey laboratory kssl database the database contains soil pedons with measured chemical and physical properties representing geographically diverse soils from across the conterminous united states hawaii and alaska seybold et al 2019 the soil samples were collected from topsoil and subsoil 2 2 measurements in order to determine the soil texture distribution the clay silt and sand contents were measured based on the pipette method kilmer and alexander 1949 the soil water retention data were measured for seven matric potentials at 6 10 33 100 200 500 and 1500 kpa the soil samples were air dried ground and 2 mm sieved the pressure plate 3c1a e1a and pressure membrane 3c2a1a b extraction methods were used to determine the water retention from 6 up to 500 and at 1500 kpa respectively briefly an air dried sieved soil sample is placed in a retainer ring sitting on a porous ceramic plate in a pressure plate extractor for water contents at from 6 up to 500 kpa or on a cellulose membrane in a pressure membrane extractor for water content at 1500 kpa the plate and the membrane are covered with water to wet the samples by capillarity and the soil sample is equilibrated at the specified matric potentials the pressure is kept constant until equilibrium is obtained klute 1986 and then the gravimetric water content is determined detailed information about the methods for the determination of the soil water contents is according to soil survey staff 2014 2 3 campbell soil water retention function anchored at 1500 kpa the campbell 1974 soil water retention function requires knowledge of a curve shape parameter namely campbell b and the gravimetric saturated water content wgs at the air entry soil water potential ψe the campbell 1974 soil water retention function is given by 1 ψ ψ e w w gs b where ψe is the air entry matric potential kpa and is the matric potential at which the air starts to enter to the largest pores in the soil campbell b is determined as the negative slope of the soil water retention measurements on a log ψ vs log w system and can be considered as a pore size distribution index moldrup et al 2001 moreover it was found that the campbell b is strongly dependent on soil texture clapp and hornberger 1978 pittaki chrysodonta et al 2018 for this study eq 1 was modified and anchored at 1500 kpa instead of wgs since the latter is mostly soil structure dependent and less related to soil texture babaeian et al 2015b jarvis et al 1999 additionally according to clapp and hornberger 1978 the estimation of ψe varies substantially even within the same class and hence is not so texture dependent furthermore at the lowers soil water potentials the soil water contents are strongly related to the soil texture jensen et al 2015 pittaki chrysodonta et al 2019 pittaki chrysodonta et al 2018 it was therefore used an anchored campbell soil water retention function 2 ψ 1500 w w 1500 b where w1500 is the gravimetric water content kg kg 1 at 1500 kpa thereafter calibration models for the two parameters of campbell b and w1500 need to be developed for this study only the soil samples that yielded an r2 0 9 between the log ψ vs log w were included 2 4 spectral measurements and pre processing the spectrometer used was the asd labspec 2500 analytical spectral devices inc boulder co with a spectral range of 350 2500 with a spectral resolution of 3 nm and 10 nm at 700 nm and 1400 nm respectively the spectral interval is 1 nm the air dried soil samples were initially ground and sieved to 2 mm then loaded into a sample holder pucks and pressed to 46 psi to assure that there is no void space the sample holder is placed onto muglight lamp and scanned iteratively three times in order to calibrate the spectrometer a white reference panel was used prior to scans and after every ca 30 min mcdowell et al 2012 spectral measurements were transformed from reflectance into apparent absorbance by log reflectance 1 to improve the quality of the spectral data different pre processing techniques were applied these techniques reduce undesired scatter effects such as baseline shifts and non linearities rinnan et al 2009 wetterlind et al 2013 the tested pre processing techniques for this study were the savitzky golay and gap segment derivatives norris 2001 savitzky and golay 1964 standard normal variate snv transformation and detrending barnes et al 1989 and the orthogonal signal correction osc sjöblom et al 1998 a brief description regarding the pretreatments could be found in pittaki chrysodonta et al 2021 finally the spectral data were mean centered i e the mean offset from each variable was removed 2 5 calibration and validation sample selection for the independent validation the dataset of the 306 soil samples was divided into calibration 70 and validation 30 datasets cross validation for all developed vis nirs models was performed using the leave one out cross validation method the cross validation was performed using i the calibration dataset and ii the entire dataset the split of the two datasets was based on two criteria 1 for each dataset at least one sample derived from a textural class was included and 2 the samples from each pedon were kept in the same dataset calibration or validation for validating horizon specific models in the calibration dataset the topsoils or subsoils from the small library were included as well in the validation of the subsoils or topsoils for developing a second calibration model of the w1500 a representative number of soil samples from a larger library were included 215 from the small library and 1352 from a larger database 1567 2 6 multivariate data analysis in order to develop the calibration models the partial least squares pls regression analysis with the straight forward implementation of a statistically inspired modification of the pls simpls algorithm de jong 1993 was used in brief this algorithm directly calculates the factors of the pls as linear combinations of the original variables by maximizing a covariance criterion de jong 1993 the careful selection of the number of factors is important since the amount of variation in the spectral data should be maximized however a higher or lower number of pls factors would lead to an overestimation or underestimation respectively this number is defined as the local minimum value of the root mean square errors of calibration rmsecal and cross validation rmsecv that represented the most significant change in slope gowen et al 2011 the development of the pls models was performed using the pls toolbox 8 8 software eigenvector research which is an advanced chemometric multivariate analysis tool within the matlab computational environment 2 7 rosetta 1 the rosetta 1 is a computer program based on neural network analyses with the bootstrap method which implements a number of pedotransfer functions ptfs for estimating van genucthen water retention parameters and the saturated hydraulic conductivity schaap et al 2001 the van genucthen soil water retention curve is given by 3 θ θ r θ s θ r 1 a ψ n 1 1 n where θr and θs cm3 cm 3 denote the residual and saturated volumetric water contents respectively α cm 1 is related to the inverse of the air entry pressure and n is a measure of the pore size distribution index van genuchten 1980 for estimating the parameters of the van genuchten rosetta 1 includes five hierarchical models depending on the input data h1 the first hierarchical model is a class ptf that provides parameter averages for each usda textural class h2 it uses as inputs the sand silt and clay contents ssc h3 in addition it includes bulk density sscbd h4 in addition it uses a volumetric water content at 33 kpa sscbdθ33 h5 in addition it includes a volumetric water content at 1500 kpa sscbdθ33θ1500 detailed information for rosetta 1 could be found in schaap et al 2001 in this study the vis nirs predicted swrc of the independent validation were compared with h3 and h5 the h3 and h5 were namely scenario 2 rosetta 1sc2 and scenario 4 rosetta 1sc4 2 8 evaluation of model performance the developed pls models of the two parameters w1500 campbell b were evaluated using the square of the pearson correlation coefficient r r2 bias and rmse r 2 bias and rmse are defined as 4 r 2 n i 1 n y i y y p i y p 2 2 i 1 n y i y 2 i 1 n y p i y p 2 5 bias y p y 6 rmse 1 n i 1 n y i y p i 2 where n is the number of samples y i is the measurements y p i the predicted values y the mean value of the measurements and y p is the average of the predicted values in order to examine whether the vis nirs models were over fitted in addition to the cross validation and validation a permutation test n 50 was further conducted in brief permutation tests repeatedly and randomly reorder the soil property y by rebuilding the calibration model with its current settings after each reordering specifically the evaluation was based on the pairwise wilcoxon signed rank pairwise signed rank randomization t tests and plots of sum squared ssq y versus y block correlation the permutation tests were performed for the models that were developed using the entire dataset 306 and 1658 soil samples included in campbell b and w1500 respectively 2 9 comparison of visible near infrared spectroscopy and rosetta 1 to assess the performance of the vis nirs built on small vis nirs1 or larger library vis nirs2 vis nirs and a measured w1500 vis nirs w1500 and rosetta 1 predicted swrc the r 2 and rmse of validation dataset and the prediction bias were used specifically the vis nirs predicted parameters w1500 campbell b for the three scenarios vis nirs1 vis nirs2 vis nirs w1500 were inserted into the anchored campbell function and the swrc was obtained for each soil sample for the rosetta 1 for each of two scenarios rosetta 1sc2 rosetta 1sc4 the swrc was obtained based on the van genuchten equation using the predicted parameters from rosetta 1 the assessment was based on the water contents of the seven matric potentials 6 10 33 100 200 500 and 1500 kpa for each soil sample from the validation dataset only the soil samples with measured bulk density n 56 were included since the rosetta 1 predicted water contents are not gravimetric but volumetric therefore the predicted volumetric water contents were converted into gravimetric a flowchart of the two applied methods for obtaining an swrc is illustrated in fig 2 3 results 3 1 descriptive statistics of soil properties and soil water retention curves the soil samples used for the development as well as for the validation of the pls models covered 11 out of 12 usda soil texture classes as shown in fig 1 the soil samples included in the larger library covered all the soil texture classes fig s1 in the table 1 the mean median q1 q3 standard deviation σ the skewness skew and the range minimum maximum of w1500 and campbell b for each textural class for each dataset are presented the w1500 ranged from 0 013 to 0 362 0 001 to 0 598 and 0 018 to 0 229 kg kg 1 for the calibration of the small larger and validation datasets respectively the lowest mean values of w1500 are presented in the textural classes with a high percentage of sand such as sand 0 023 0 025 and 0 026 kg kg 1 for calibration of small and large and validation datasets respectively and loamy sand 0 031 0 050 and 0 032 kg kg 1 for calibration of a small and large library and validation respectively while the highest mean values are observed in the silty clay 0 260 0 210 and 0 155 kg kg 1 for calibration of a small and large library and validation respectively and clay 0 284 0 228 and 0 183 kg kg 1 for calibration of a small and large library and validation respectively classes the median values are similar to the mean values for most of the classes for the calibration dataset of the smaller library except for the loam mean value equals 0 096 and median 0 087 kg kg 1 and silt loam mean value equals 0 124 and median 0 097 kg kg 1 for the larger library the median values were always lower than the average except for the silt class mean value 0 047 and median 0 54 kg kg 1 for the validation dataset the median values are differentiated from the mean values for the loam 0 115 and 0 103 kg kg 1 the mean and median respectively and clay 0 183 and 0 161 kg kg 1 the mean and median respectively classes however the number of soil samples included in the clay textural class of the validation dataset is small n 3 the highest σ values are observed in silty loam 0 065 kg kg 1 and silty clay 0 144 kg kg 1 for the calibration dataset of the smaller library and in silty clay 0 076 kg kg 1 and clay 0 068 kg kg 1 for the calibration of the larger library silt loam 0 044 kg kg 1 clay loam 0 043 and clay 0 040 have the highest values of the σ compared to other textural classes for the validation dataset regarding the skewness for the calibration of the small library only the silty clay loam 0 298 and clay 0 167 classes are left skewed while negative skewness for the validation dataset is presented in loamy sand 0 467 sandy loam 0 617 sandy clay loam 0 407 and silty clay loam 1 152 the dataset of the larger library presented only positive skewness for the validation dataset for the sand sandy clay and silty clay only the mean and median are estimated since the soil samples for each of these classes are less than three the values of the campbell b were derived from the small library and the validation dataset and are varied from 2 41 to 8 41 and 2 08 to 7 19 for the calibration and validation dataset respectively the lowest value of campbell b is observed in the loamy sand and sandy loam classes for the calibration and validation dataset respectively the highest value is presented in the sandy loam and silty clay soil for the calibration and validation dataset respectively the higher mean values of each class are observed in the classes with a high percentage of sand or clay while the loamier classes present lower values the highest σ is observed in the sand 1 71 and loam 1 27 for the calibration and validation dataset respectively the lowest negative value of skew is observed in sandy clay loam 1 31 and silty clay loam 1 71 for calibration and validation dataset respectively 3 2 visible near infrared spectroscopy vis nirs measurements in fig 3 four absorption spectra of two soil samples with the lowest and highest values of campbell b 2 08 and 8 4 respectively and two with the lowest and highest values of w1500 0 013 and 0 36 kg kg 1 respectively are illustrated it is observed that the samples with high values of campbell b and w1500 have stronger peaks compared to soils with low values near of 1400 and 1900 nm while the sample with the highest value of campbell b presents as well near of 2220 nm 3 3 partial least squares regression analysis the pre processing techniques that yield the best pls models were the savitzky golay first derivative and osc for the w1500 and campbell b calibration model of the small library respectively and osc for the w1500 of the larger library the optimum number of factors was set to five and two for the w1500 for both models and campbell b respectively figure s2 illustrates the normalized regression coefficients as a function of wavelength for the three calibration models the fitted model coefficients for the campbell b and w1500 from the vis nirs3 are provided in table s2 the results of the three calibration models are presented in table 2 specifically the statistical characteristics of the cross validation and validation datasets and cross validation using the entire small for campbell b and larger for w1500 datasets for each textural class are given for the classes with less than five soil samples the statistics were not calculated but were included to estimate the statistics for all soil samples regarding the cross validation dataset table 2 a the r2 bias and rmse were 0 64 0 0 039 respectively for the w1500 model of the small library and 0 52 0 and 0 058 for the larger library while for the campbell b model the respective figures were 0 56 0 and 0 769 based on the r2 of the w1500 model of the small library for each class it is observed that the loamy sand sandy loam and sandy clay loam present values of r2 close to 0 the sandy clay loam presented the highest rmse value 0 073 kg kg 1 the values of the r2 and rmse for the w1500 of the larger library varied respectively from 0 15 silty clay to 0 64 silt and 0 039 sandy clay loam to 0 086 silty clay kg kg 1 it is observed a higher rmse of 0 086 kg kg 1 in soil samples that their textural classes were not defined since the textural data were not available the highest value of bias 0 046 was observed in the sand class low values of r2 ca 0 of campbell b model were presented in silt loam clay loam and clay classes but a high rmse value 1 43 was observed in sandy clay loam for the validation dataset table 2 b the statistics were worst compared to the cross validation dataset for the small library specifically for the predictions of the w1500 the value of r2 bias and rmse were 0 34 0 027 and 0 049 respectively while for the predictions of the campbell b the figures were 0 19 0 306 and 1 009 respectively the silt loam class presented the lowest rmse 0 031 kg kg 1 of the w1500 compared to the other classes while the highest r2 was observed in the loamy sand the silt loam was presented the highest value of the r2 0 73 and the second lowest value of rmse 0 566 for the prediction of the campbell b the lowest rmse was presented in the sandy clay loam class 0 501 regarding the statistics obtained from the w1500 of the large library the loamy sand sandy loam and sandy clay loam presented lower rmse compared to the statistics derived from the smaller library the silt loam presented a slightly higher value of rmse 0 036 instead of 0 031 kg kg 1 and the loam has the same rmse value 0 039 kg kg 1 compared to the w1500 of the smaller library the absolute values of bias were lower for the w1500 of the larger library among the five textural classes except for the silt loam the r2 bias and rmse for all samples included in the validation dataset were improved 0 49 0 008 kg kg 1 and 0 035 kg kg 1 respectively instead of 0 34 0 027 kg kg 1 and 0 049 kg kg 1 respectively for the predicted from the larger library of the w1500 the statistics of the sandy clay clay loam silty clay loam silty clay and clay were not available since the included soil samples into these classes were less than five soil samples the statistics obtained from the cross validation using the entire datasets small for campbell b and large for w1500 are presented in table 2 c it is observed that the values of r2 bias and rmse were similar to those obtained from the cross validation of the calibration dataset table 2 a regarding the statistics obtained from the cross validation of the campbell b were slightly worst compared to these of table 2 a the permutation results yielded values of 0 05 for cross validation for all tests wilcoxon sign test and rand t test for both models campbell b and w1500 and thus the models were significant at the 95 confidence level additionally based on fig s3 it is observed that the values of standardized sum squared of y values from calibration and cross validation were relatively close to each other and significantly lower than the un permuted soil property far right side of the plot for both models campbell b and w1500 therefore the calibration models were significant and not over fit table 3 a and b presents the statistical characteristic of the predicted w1500 and campbell b derived from the topsoils and subsoils for each soil textural class when the calibration models were included only subsoils and topsoils respectively for the smaller library for the topsoil predicted w1500 the r2 bias and rmse were 0 49 0 016 kg kg 1 and 0 042 kg kg 1 respectively while for the campbell b these figures were 0 55 0 390 and 0 791 respectively for the subsoils predicted w1500 and campbell b r2 bias and rmse were respectively 0 05 0 007 kg kg 1 and 0 073 kg kg 1 and 0 37 0 226 and 1 075 except for the statistics of the three calibration models vis nirs1 vis nirs2 vis nirs measured w1500 for the validation dataset the r2 rmse and bias for each swrc based on the vis nirs predicted soil water retention and the measured points for the validation dataset were calculated the results of these are shown in the box and whisker plots for each textural class in fig 4 all textural classes presented a high value of r2 ca r2 0 85 between the measured and predicted gravimetric water contents at the seven matric potentials of each sample moreover it is observed that the r2 is the same for the three vis nirs scenarios since the values of the campbell b were predicted using the same calibration model obtained from the small library regarding the predictions obtained from the small library vis nirs1 the values of the rmse varied from 0 014 to 0 239 kg kg 1 and a mean value of 0 097 kg kg 1 with the lowest and highest values to be observed in silt loam and loamy sand class respectively the values of bias were from 0 10 to 0 22 kg kg 1 with the silty clay loam and loam classes to be least and most biased respectively lower values of the rmse were observed in the predictions obtained from the larger library vis nirs2 specifically the rmse ranged from 0 009 clay to 0 207 silt loam with an average of 0 065 kg kg 1 the bias for the predictions obtained from the larger library varied from 0 15 to 0 12 with an average of 0 03 kg kg 1 when a measured point at 1500 kpa was included the rmse values were improved 0 008 clay to 0 164 loam with an average of 0 049 kg kg 1 and the bias ranged from 0 073 to 0 138 with a mean value of 0 018 kg kg 1 based on fig 4 it was observed that the rmse values when the predictions were derived from the calibration model of the larger library were significantly improved for all textural classes 3 4 vis nirs and rosetta 1 predictive performance of soil water retention curve in fig 5 the box and whisker plots of the three statistics r2 rmse and bias for each textural class for the five scenarios three for vis nirs and two for rosetta 1 are illustrated the scenarios were the vis nirs1 vis nirs2 vis nirs measured w1500 rosetta 1sc2 and rosetta 1sc4 predicted swrc it was observed that except for the loamy sand class the vis nirs predicted swrc yielded higher values of r2 compared to rosetta 1sc2 the values of the r2 for the rosetta 1sc4 were lower compared to rosetta 1sc2 for all textural classes except for sand the silty clay loam 0 65 0 9 and clay 0 53 0 64 classes presented the lowest values of r2 the values of the rmse for the vis nirs1 predicted swrc for all classes were higher compared to the other four scenarios except for the silt loam in which the higher values of rmse were presented in rosetta 1sc2 the lowest values of rmse were observed in the vis nirs measured w1500 and vis nirs2 scenarios except for the sand class in which the rosetta 1sc4 presented the lowest values of rmse by observing the values of the bias the predictions obtained from the rosetta 1sc4 were least biased compared to rosetta 1sc2 while the most biased predictions were obtained from vis nirs1 fig 6 represents the values of the rmse and bias obtained from the five scenarios at seven soil water matric potentials 6 10 33 100 200 500 and 1500 kpa it is observed that the vis nirs1 presented the highest values of rmse and bias the wettest point 6 kpa was better predicted rmse 0 096 kg kg 1 from the vis nirs2 while close values of the rmse were observed in vis nirs measured w1500 0 102 kg kg 1 and rosetta 1sc4 0 103 kg kg 1 for the rmse of the soil water matric potentials at 10 33 100 and 200 the rosetta 1sc4 presented the lowest values 0 059 0 016 0 023 and 0 023 kg kg 1 compared to the other four scenarios for the driest soil water matric potentials 500 and 1500 kpa the vis nirs measured w1500 presented lower rmse values while the vis nirs2 rosetta 1sc2 and rosetta 1sc4 illustrated similar values the least biased predictions were observed in vis nirs measured w1500 and vis nirs2 having obtained the predicted parameters of each scenario i e w1500 and campbell b for the vis nirs θr θs α and n for rosetta 1sc2 and rosetta 1sc4 they were inserted into the anchored campbell soil water retention function vis nirs scenarios and van genuchten rosetta 1 and the swrcs from near saturation 2 kpa up to 1600 kpa were obtained the predictive performance of swrc for 12 soil samples at least one soil sample from each textural class using the five scenarios is illustrated in fig 7 it is observed that all scenarios of the vis nirs predicted swrc had a similar shape with the soil water retention measurements however for the sand fig 7a loamy sand fig 7b and sandy clay loam fig 7g the vis nirs1 predicted swrcs have presented higher gravimetric water contents at the given matric potentials while the vis nirs1 and vis nirs2 predicted gravimetric water contents for the silty clay soil fig 7k were lower than the measured contents the vis nirs1 predicted swrc for the remaining soils were compared closely with the measurements the swrc obtained from the vis nirs2 were compared closely with the measured data except for the sand loamy sand and silty clay fig 7a b k comparing the two scenarios of the rosetta 1 it is observed that the swrcs derived from scenario 4 were better predicted in horizontal shift compared to scenario 2 but not in shape specifically for the sandy clay loam fig 7g silty clay loam fig 7j silty clay fig 7k and clay fig 7l the predicted swrcs derived from the scenario 4 could not predict the wetter end the predicted swrc obtained from the vis nirs measured w1500 were better predicted compared to the other four scenarios for all the soil samples except for the sandy loam fig 7d loam fig 7e and clay loam fig 7h 4 discussion 4 1 soil water retention curve and anchored campbell function the campbell swrc was selected since can accurately fit the measured soil water retention data moreover the parameter of the campbell b was found that is directly related to the clay contents and organic matter which are predicted from vis nirs with high accuracy clapp and hornberger 1978 olesen et al 1996 pittaki chrysodonta et al 2018 williams et al 1989 furthermore the saturated water content is poorly related to the vis nirs babaeian et al 2015b the water contents at drier points could be predicted from basic soil properties such as clay karup et al 2017 pittaki chrysodonta et al 2019 pittaki chrysodonta et al 2018 rawls et al 1982 therefore the parameters of the anchored campbell swrc would be predicted from the vis nirs a more widely used function is the van genuchten swrc which has four parameters needed to be estimated θs θr α and n however the α value is a scaling parameter jong van lier and pinheiro 2018 and substantially varied even within a soil textural class and it would probably be poorly predicted from the vis nirs the measurements of the soil water retention curve were based on sieved soil samples measurements on undisturbed columns would allow to include in the calibration models the structure of the soil as well since undisturbed samples retain the in situ properties of the soil 4 2 spectral measurements and peaks the peaks near of 1400 and 1900 nm indicate the presence of water molecules and if molecular water is present these two features always appear hunt 1977 at 2200 nm the peak is because of the combination of the oh stretch with the fundamental al oh bending mode hunt 1977 in the visible range the peaks could be assigned to organic matter galvao and vitorello 1998 viscarra rossel et al 2006 and iron oxide minerals hunt 1977 additionally peaks around 1400 nm can be attributed to the 1st overtone of the structural o h stretching mode and a combination of vibrations of water bound in the interlayer lattices as hydrated cations and adsorbed water on particle surfaces bishop et al 1994 in the region of 2200 to 2500 nm there can be a combination of vibrations including o h stretching and metal oh bends stenberg et al 2010 the minerals and organic components of soil are indirectly related to the w1500 and campbell b since these are linked with the clay and carbon contents and thus the peaks in the visible and near infrared range could be used for the development of calibration models for predicting the two parameters w1500 campbell b 4 3 performance of the vis nirs models in different soil texture classes and horizons the predictions for the w1500 in the validation dataset were improved when the calibration model was based on a larger library indicating that more soil samples in the calibration dataset led the calibration models to better capture the important peaks unfortunately this could not be tested for the calibration model of the campbell b because of the limitation of the available data moreover it was found that the highest values of the rmse were in the sandier classes for both parameters regardless of the applied library blaschek et al 2019 have found that the sand contents were poorly predicted from the vis nirs the statistics of the predicted swrc of each soil textural class were improved when in the calibration model of the w1500 more soil samples were included however the statistics obtained from both cross validations using the calibration and the entire datasets for the w1500 of the larger database were slightly worst compared to those obtained from the small library similarly the statistics derived from the cross validation including all the soil samples were slightly worse compared to those derived from the cross validation of the calibration dataset this is probably because more textural classes were included and simultaneously evaluated e g sand sandy clay silty clay and silt moreover the range and the number of soil samples of the w1500 for each class were larger the horizon specific models have shown that a soil sample from topsoil could be predicted from a calibration model built on subsoils however the predictions of the subsoils based on a model built from topsoil did not yield sufficient predictive ability a reason for that is because the topsoils were predicted from a larger database since the number of the subsoils was almost three times higher than the topsoils moreover a subsoil consists of greater minerals and materials of iron and aluminum compounds than topsoil these compounds are reflected in the vis nirs range and thus a model including only topsoils would be not sufficiently predicted the subsoils 4 4 comparison with other vis nirs models for predicting the swrc currently there are few studies in the literature for predicting the swrc babaeian et al 2015b pittaki chrysodonta et al 2018 santra et al 2009 the development of their calibration models was based on topsoils covering specific soil textural ranges the samples included in their studies were undisturbed and derived from regional sampling babaeian et al 2015b and santra et al 2009 developed spectral models for predicting the van genuchten parameters while pittaki chrysodonta et al 2018 have predicted an anchored at 100 kpa campbell swrc specifically for predicting the swrc babaeian et al 2015b developed point and parametric spectral transfer functions to predict soil water contents at nine specific soil matric potentials from saturation up to 1500 kpa and the parameters of van genuchten and brooks corey soil water retention functions the soil samples included in the calibration models were derived from an area from iran were topsoils and varied within a specific soil texture range e g clay 15 45 sand 13 63 silt contents 21 52 they have reported similar to this study r2 0 63 for the water content at 1500 kpa and the r2 of van genuchten and brooks corey parameters varied from 0 14 to 0 44 in their study the development of the calibration models was based on topsoils and subsoils and the soils were derived from a larger geographical area covering more textural classes pittaki chrysodonta et al 2018 have developed a similar concept to this study for predicting an swrc from a vis nirs specifically they have used an anchored campbell soil water retention function anchored at a wetter point 100 kpa the measurements of the swrc were derived from undisturbed 100 cm3 cores and were based solely on danish agricultural soil samples for the development of their calibration models they have included 5 out of 12 soil texture classes and the soils were topsoils they have found higher compared to this study predictive performance for campbell b r2 0 86 and this could be ascribed to the fact that they have included only soils that comprise up to 20 v v and they have used a more local database moreover they have found higher values of the campbell b for each textural class and this is probably because they have used undisturbed soil column santra et al 2009 used spectral transfer functions to predict the two parameters of van genuchten water retention model a and n at the wet part of the swrc ψ 80 kpa additionally they have related the spectral transfer function to the parameters of van genuchten and brooks and corey 4 5 vis nirs models vs rosetta 1 ptfs for predicting the swrc the vis nirs for all scenarios captured the shape of the swrc while the rosetta 1sc4 failed for few soil samples since the predicted curve sharply reached the saturation degree at drier ψ moreover the vis nirs2 yielded to better prediction for the wettest water contents on the other hand the vis nirs1 and vis nirs2 failed to predict the swrc of the sandier soils compared to the rosetta 1 scenarios and as it was discussed this is because of the poor predictability of the spectroscopy for the sandier soils however when a measured w1500 was included the predictions derived from the vis nis were equally good as with rosetta 1 and compared closely to the measured soil water retention data an advantage of the vis nirs is that only the knowledge of the spectral data is required to obtain a predicted swrc without having known the soil texture analysis and bulk density additionally rosetta 1sc4 required the knowledge of two volumetric water content at specific matric potential 33 and 1500 kpa while for the vis nirs measured w1500 a point approximately closed to that potential would be sufficient however the anchored campbell swr function should be anchored at the measured soil water matric potential silva et al 2021 have developed software namely splintex 2 0 which is a ptf model developed with a user friendly computer interface for estimating hydraulic functions parameters they have also compared their model development with the predictions obtained from rosetta and have found comparable results with rosetta with lower rmse values of the volumetric water content in rosetta furthermore wösten et al 2001 and pachepsky et al 2001 found that differences from 0 06 up to 0 11 in the volumetric water contents are acceptable 4 6 implications caveats and future work this study could be applied for obtaining a rapid estimation of the swrc compared to the conventional methods specifically a small amount of air dried and sieved soil sample needed to be scanned in a spectrometer and within few seconds the parameters of the anchored campbell soil water retention function could be obtained because of the rapidity and low cost of the proposed method the estimation of the swrcs could be at a high spatial resolution and thus could assist in modeling and forecasting in different disciplines such as hydrogeology environmental geosciences a limitation of this study is that probably the vis nirs predicted swrc obtained for sandier soils would not have sufficient predictive ability although this study included soil samples that covered a wide textural distribution more soil samples should be added to have a better representation of all classes in the calibration model of the campbell b in this study the calibration models were based on pls regression models while machine learning and deep learning models could be developed as well furthermore the spectral measurements were obtained in a laboratory controlled environment and future studies should examine whether field spectral measurements would result in sufficient estimation of the swrc however different spectrometers would result in having different spectral measurements and transferring methods should be included pittaki chrysodonta et al 2021 specifically according to pittaki chrysodonta et al 2021 the spectral space transformation is most favorable for transferring a soil spectral model from the primary to a secondary instrument moreover the horizon specific models have shown that a soil sample from topsoil could be predicted from a calibration model built on subsoils while the predictions of the subsoils from a calibration model for topsoils should be further investigated since the results of the predictive ability were not sufficient this may be because of the low number of soil samples included in the calibration model for topsoils 100 finally the applicability of the vis nirs for estimating swrc at larger fields and regions based on remote sensing techniques could be explored in future studies 5 conclusions the main objective of this study was to examine if vis nirs could be used as a tool to predict an swrc from the near saturation 2 kpa to 1500 kpa for different soil textural classes the anchored at 1500 kpa campbell soil water retention function was chosen to fit the measured data and thus the two parameters for which calibration models were built were the campbell b and w1500 three calibration models i e pls were developed based on a small 230 soil samples and a larger 1570 soil samples library and three scenarios were examined specifically two calibration models for predicting the campbell b and the w1500 scenario vis nirs1 based on the small library and a calibration model for predicting the w1500 scenario vis nirs2 were developed moreover it was examined whether adding a measurement at 1500 kpa would improve the predictions of the vis nirs swrc scenario vis nirs measured w1500 although the values of the r2 of the campbell b and w1500 were low for most soil textural classes the swrcs at seven soil water matric potentials were predicted with r2 0 8 furthermore the predicted swrcs were compared with these obtained from the rosetta 1 ptfs for two scenarios using as input the soil texture and bulk density rosetta 1sc2 and the soil texture bulk density volumetric water content at 33 and 1500 kpa rosetta 1sc4 it is concluded that vis nirs can be used for predicting the swrc vis nirs captured the shape of the swrc vis nirs failed to predict the soils with a high percentage of sand probably due to the small sample size the horizon specific models have shown that a soil sample from topsoil could be predicted from a calibration model built on subsoils however the predictions of the subsoils based on a model built from topsoil did not yield sufficient predictive ability by adding a measured w1500 the predictive performance of the swrc was increased even for sandy soils predictions of the swrc obtained from the vis nirs2 were comparable to those obtained from rosetta 1sc2 for the majority of the examined soil textural classes vis nirs2 presented equally well performance as rosetta 1sc2 for predicting the gravimetric water content at specified soil water matric potentials credit authorship contribution statement zampela pittaki chrysodonta conceptualization methodology software formal analysis data curation writing original draft writing review editing visualization alfred e hartemink writing original draft writing review editing supervision funding acquisition jingyi huang conceptualization methodology data curation writing original draft writing review editing supervision funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we acknowledge the coordination data collection and data provisioning roles played by kellogg soil survey laboratory kssl team members ryan mathiesen scarlett murphy and rich ferguson for this nonroutine project support for this research was provided by the university of wisconsin madison office of the vice chancellor for research and graduate education with funding from the wisconsin alumni research foundation we also acknowledge editor professor emmanouil anagnostou and two anonymous reviewers for their constructive comments on the original manuscript appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 127195 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
3901,estimation of a soil water retention curve swrc is essential for modeling the water flow and solute transport a simple method to fit the measured retention data is the campbell function in this study the campbell function with an anchored gravimetric water content at 1500 kpa w1500 was used that included two parameters the campbell b and w1500 an inexpensive methodology was proposed for predicting these campbell parameters using visible near infrared spectroscopy vis nirs four calibration partial least squares regression models were developed the first model built on 230 soil samples predicted campbell b and w1500 vis nirs1 the second model used the same dataset for predicting campbell b but included 1570 samples for predicting w1500 vis nirs2 the third model combined predicted campbell b with measured w1500 vis nirs measured w1500 similar to approaches used in rosetta 1 software the fourth model used the entire datasets without splitting them into calibration and validation vis nirs3 the r2 of the campbell b and w1500 ranged from 0 to 0 89 and 0 02 0 91 respectively results showed that predicted swrcs were comparable with estimates from the rosetta 1 for two scenarios using soil texture and bulk density as inputs rosetta 1sc2 and using in addition water content at 33 and 1500 kpa rosetta 1sc4 it was concluded that the vis nirs based models captured the shapes of the swrc and vis nirs2 and vis nirs measured w1500 could be used as an alternative to rosetta 1sc2 however vis nirs based models failed to predict the swrc for the sandy soils most likely due to a small sample size abbreviations vis nirs visible near infrared spectroscopy plsr partial least squares regression swrc soil water retention curve w gravimetric water content ψ soil water matric potential keywords swrc pls vis nirs rosetta 1 1 introduction modeling of soil variable saturated flow and contaminant transport requires knowledge of the soil hydraulic properties such as the soil water retention curve and hydraulic conductivity soil water diffusivity and climatic conditions and agricultural practices the non linear relation between soil water content and matric potential is considered a crucial hydraulic property in the vadose zone describing the amount of water retained in a porous medium at a given matric potential and it depends on soil texture pore geometry and discontinuity sharma and uehara 1968 williams et al 1983 furthermore soil moisture characteristics are essential for describing the availability of soil water to plants and simultaneously are fundamental input in water flow and solute transport modeling varvaris et al 2021a varvaris et al 2019 several models mechanistic and empirical have been proposed for accurately fitting the measured soil water retention at the wet end or in drier conditions campbell and shiozawa 1992 or and tuller 1999 oswin 1946 rossi and nimmo 1994 van den berg and bruin 1981 van genuchten 1980 determination of swrc through direct measurements is a laborious and time consuming process furthermore the spatial variability of the soil properties within a field results in requiring a large number of soil samples to reduce uncertainties in relation to hydrogeological modeling since swrcs are essential for the modeling of water transport and biochemical processes in the unsaturated zone mader 1963 nielsen et al 1973 peck et al 1977 pham and fredlund 2008 varvaris et al 2018 varvaris et al 2019 wood et al 1988 therefore a methodology that provides fast and inexpensive predictions for swrc with a reasonable degree of accuracy is required a method that is well established and has successfully been used as an alternative for determining swrc is the pedotransfer function ptf iversen et al 2011 kotlar et al 2019 pittaki chrysodonta et al 2019 silva et al 2017 varvaris et al 2021b a ptf can be developed when knowledge of typically available soil properties such as clay content organic matter bulk density is available several researchers have developed ptfs for predicting the swrc using typically known soil properties such as soil texture and bulk density clapp and hornberger 1978 gupta and larson 1979 pittaki chrysodonta et al 2018 rudiyanto et al 2021 schaap et al 1998 schaap et al 2001 developed a computer program rosetta 1 for estimating swrcs by implementing hierarchical ptfs more recently rudiyanto et al 2021 improved the ptfs using the neuro m neural networks approach with different sets as inputs such as soil textural class or sand silt and clay contents and bulk density over the last few decades a large number of attempts have been made to predict soil properties using a promising spectroscopic method called visible near infrared spectroscopy vis nirs because of its simplicity rapidity a measurement takes only a few seconds reproducibility non destructiveness and avoids the use of hazardous chemicals knadel et al 2018 pittaki chrysodonta et al 2019 stenberg et al 2010 moreover the little sample preparation air drying and sieving before analysis makes this method more advantageous compared to other conventional laboratory methods in the literature there are only a few studies babaeian et al 2015a pittaki chrysodonta et al 2019 pittaki chrysodonta et al 2018 santra et al 2009 that have shown the ability of vis nirs to predict the swrc babaeian et al 2015a developed spectral transfer functions stfs for predicting soil water contents at nine specific soil matric potentials from saturation up to 1500 kpa they also developed vis nirs models for predicting the parameters of van genuchten α and n and brooks corey α and λ santra et al 2009 used stfs to predict the van genuchten α and n water retention model from saturation up to 80 kpa pittaki chrysodonta et al 2018 and pittaki chrysodonta et al 2019 examine whether vis nirs can be as good a predictor of the wet and dry part of the swrc respectively as classical ptfs in sandy to sandy loams there is a need to further explore the potential of using the vis nirs for predicting the swrc the objectives of this study were to 1 develop vis nirs models for predicting the two parameters of the anchored campbell soil water retention function at the driest available soil water potential i e 1500 kpa for 11 soil textural classes 2 evaluate the models performance a based on an independent validation dataset b within different textural classes c for horizon specific models by predicting the vis nirs swrc for subsoils using a calibration model derived from topsoil spectral data and vice versa d to improve the vis nirs models by adding soil water retention measured at 1500 kpa or predicted from a large vis nirs dataset and e by comparing the vis nirs predicted swrc with the predictions obtained from the rosetta ptfs across different soil textural classes and at different soil water matric potentials 2 materials and methods 2 1 soil database a total of 306 small library fig 1 and 1 658 larger library fig s1 soil samples were included in this study which were obtained from the national soil survey center nssc kellogg soil survey laboratory kssl database the database contains soil pedons with measured chemical and physical properties representing geographically diverse soils from across the conterminous united states hawaii and alaska seybold et al 2019 the soil samples were collected from topsoil and subsoil 2 2 measurements in order to determine the soil texture distribution the clay silt and sand contents were measured based on the pipette method kilmer and alexander 1949 the soil water retention data were measured for seven matric potentials at 6 10 33 100 200 500 and 1500 kpa the soil samples were air dried ground and 2 mm sieved the pressure plate 3c1a e1a and pressure membrane 3c2a1a b extraction methods were used to determine the water retention from 6 up to 500 and at 1500 kpa respectively briefly an air dried sieved soil sample is placed in a retainer ring sitting on a porous ceramic plate in a pressure plate extractor for water contents at from 6 up to 500 kpa or on a cellulose membrane in a pressure membrane extractor for water content at 1500 kpa the plate and the membrane are covered with water to wet the samples by capillarity and the soil sample is equilibrated at the specified matric potentials the pressure is kept constant until equilibrium is obtained klute 1986 and then the gravimetric water content is determined detailed information about the methods for the determination of the soil water contents is according to soil survey staff 2014 2 3 campbell soil water retention function anchored at 1500 kpa the campbell 1974 soil water retention function requires knowledge of a curve shape parameter namely campbell b and the gravimetric saturated water content wgs at the air entry soil water potential ψe the campbell 1974 soil water retention function is given by 1 ψ ψ e w w gs b where ψe is the air entry matric potential kpa and is the matric potential at which the air starts to enter to the largest pores in the soil campbell b is determined as the negative slope of the soil water retention measurements on a log ψ vs log w system and can be considered as a pore size distribution index moldrup et al 2001 moreover it was found that the campbell b is strongly dependent on soil texture clapp and hornberger 1978 pittaki chrysodonta et al 2018 for this study eq 1 was modified and anchored at 1500 kpa instead of wgs since the latter is mostly soil structure dependent and less related to soil texture babaeian et al 2015b jarvis et al 1999 additionally according to clapp and hornberger 1978 the estimation of ψe varies substantially even within the same class and hence is not so texture dependent furthermore at the lowers soil water potentials the soil water contents are strongly related to the soil texture jensen et al 2015 pittaki chrysodonta et al 2019 pittaki chrysodonta et al 2018 it was therefore used an anchored campbell soil water retention function 2 ψ 1500 w w 1500 b where w1500 is the gravimetric water content kg kg 1 at 1500 kpa thereafter calibration models for the two parameters of campbell b and w1500 need to be developed for this study only the soil samples that yielded an r2 0 9 between the log ψ vs log w were included 2 4 spectral measurements and pre processing the spectrometer used was the asd labspec 2500 analytical spectral devices inc boulder co with a spectral range of 350 2500 with a spectral resolution of 3 nm and 10 nm at 700 nm and 1400 nm respectively the spectral interval is 1 nm the air dried soil samples were initially ground and sieved to 2 mm then loaded into a sample holder pucks and pressed to 46 psi to assure that there is no void space the sample holder is placed onto muglight lamp and scanned iteratively three times in order to calibrate the spectrometer a white reference panel was used prior to scans and after every ca 30 min mcdowell et al 2012 spectral measurements were transformed from reflectance into apparent absorbance by log reflectance 1 to improve the quality of the spectral data different pre processing techniques were applied these techniques reduce undesired scatter effects such as baseline shifts and non linearities rinnan et al 2009 wetterlind et al 2013 the tested pre processing techniques for this study were the savitzky golay and gap segment derivatives norris 2001 savitzky and golay 1964 standard normal variate snv transformation and detrending barnes et al 1989 and the orthogonal signal correction osc sjöblom et al 1998 a brief description regarding the pretreatments could be found in pittaki chrysodonta et al 2021 finally the spectral data were mean centered i e the mean offset from each variable was removed 2 5 calibration and validation sample selection for the independent validation the dataset of the 306 soil samples was divided into calibration 70 and validation 30 datasets cross validation for all developed vis nirs models was performed using the leave one out cross validation method the cross validation was performed using i the calibration dataset and ii the entire dataset the split of the two datasets was based on two criteria 1 for each dataset at least one sample derived from a textural class was included and 2 the samples from each pedon were kept in the same dataset calibration or validation for validating horizon specific models in the calibration dataset the topsoils or subsoils from the small library were included as well in the validation of the subsoils or topsoils for developing a second calibration model of the w1500 a representative number of soil samples from a larger library were included 215 from the small library and 1352 from a larger database 1567 2 6 multivariate data analysis in order to develop the calibration models the partial least squares pls regression analysis with the straight forward implementation of a statistically inspired modification of the pls simpls algorithm de jong 1993 was used in brief this algorithm directly calculates the factors of the pls as linear combinations of the original variables by maximizing a covariance criterion de jong 1993 the careful selection of the number of factors is important since the amount of variation in the spectral data should be maximized however a higher or lower number of pls factors would lead to an overestimation or underestimation respectively this number is defined as the local minimum value of the root mean square errors of calibration rmsecal and cross validation rmsecv that represented the most significant change in slope gowen et al 2011 the development of the pls models was performed using the pls toolbox 8 8 software eigenvector research which is an advanced chemometric multivariate analysis tool within the matlab computational environment 2 7 rosetta 1 the rosetta 1 is a computer program based on neural network analyses with the bootstrap method which implements a number of pedotransfer functions ptfs for estimating van genucthen water retention parameters and the saturated hydraulic conductivity schaap et al 2001 the van genucthen soil water retention curve is given by 3 θ θ r θ s θ r 1 a ψ n 1 1 n where θr and θs cm3 cm 3 denote the residual and saturated volumetric water contents respectively α cm 1 is related to the inverse of the air entry pressure and n is a measure of the pore size distribution index van genuchten 1980 for estimating the parameters of the van genuchten rosetta 1 includes five hierarchical models depending on the input data h1 the first hierarchical model is a class ptf that provides parameter averages for each usda textural class h2 it uses as inputs the sand silt and clay contents ssc h3 in addition it includes bulk density sscbd h4 in addition it uses a volumetric water content at 33 kpa sscbdθ33 h5 in addition it includes a volumetric water content at 1500 kpa sscbdθ33θ1500 detailed information for rosetta 1 could be found in schaap et al 2001 in this study the vis nirs predicted swrc of the independent validation were compared with h3 and h5 the h3 and h5 were namely scenario 2 rosetta 1sc2 and scenario 4 rosetta 1sc4 2 8 evaluation of model performance the developed pls models of the two parameters w1500 campbell b were evaluated using the square of the pearson correlation coefficient r r2 bias and rmse r 2 bias and rmse are defined as 4 r 2 n i 1 n y i y y p i y p 2 2 i 1 n y i y 2 i 1 n y p i y p 2 5 bias y p y 6 rmse 1 n i 1 n y i y p i 2 where n is the number of samples y i is the measurements y p i the predicted values y the mean value of the measurements and y p is the average of the predicted values in order to examine whether the vis nirs models were over fitted in addition to the cross validation and validation a permutation test n 50 was further conducted in brief permutation tests repeatedly and randomly reorder the soil property y by rebuilding the calibration model with its current settings after each reordering specifically the evaluation was based on the pairwise wilcoxon signed rank pairwise signed rank randomization t tests and plots of sum squared ssq y versus y block correlation the permutation tests were performed for the models that were developed using the entire dataset 306 and 1658 soil samples included in campbell b and w1500 respectively 2 9 comparison of visible near infrared spectroscopy and rosetta 1 to assess the performance of the vis nirs built on small vis nirs1 or larger library vis nirs2 vis nirs and a measured w1500 vis nirs w1500 and rosetta 1 predicted swrc the r 2 and rmse of validation dataset and the prediction bias were used specifically the vis nirs predicted parameters w1500 campbell b for the three scenarios vis nirs1 vis nirs2 vis nirs w1500 were inserted into the anchored campbell function and the swrc was obtained for each soil sample for the rosetta 1 for each of two scenarios rosetta 1sc2 rosetta 1sc4 the swrc was obtained based on the van genuchten equation using the predicted parameters from rosetta 1 the assessment was based on the water contents of the seven matric potentials 6 10 33 100 200 500 and 1500 kpa for each soil sample from the validation dataset only the soil samples with measured bulk density n 56 were included since the rosetta 1 predicted water contents are not gravimetric but volumetric therefore the predicted volumetric water contents were converted into gravimetric a flowchart of the two applied methods for obtaining an swrc is illustrated in fig 2 3 results 3 1 descriptive statistics of soil properties and soil water retention curves the soil samples used for the development as well as for the validation of the pls models covered 11 out of 12 usda soil texture classes as shown in fig 1 the soil samples included in the larger library covered all the soil texture classes fig s1 in the table 1 the mean median q1 q3 standard deviation σ the skewness skew and the range minimum maximum of w1500 and campbell b for each textural class for each dataset are presented the w1500 ranged from 0 013 to 0 362 0 001 to 0 598 and 0 018 to 0 229 kg kg 1 for the calibration of the small larger and validation datasets respectively the lowest mean values of w1500 are presented in the textural classes with a high percentage of sand such as sand 0 023 0 025 and 0 026 kg kg 1 for calibration of small and large and validation datasets respectively and loamy sand 0 031 0 050 and 0 032 kg kg 1 for calibration of a small and large library and validation respectively while the highest mean values are observed in the silty clay 0 260 0 210 and 0 155 kg kg 1 for calibration of a small and large library and validation respectively and clay 0 284 0 228 and 0 183 kg kg 1 for calibration of a small and large library and validation respectively classes the median values are similar to the mean values for most of the classes for the calibration dataset of the smaller library except for the loam mean value equals 0 096 and median 0 087 kg kg 1 and silt loam mean value equals 0 124 and median 0 097 kg kg 1 for the larger library the median values were always lower than the average except for the silt class mean value 0 047 and median 0 54 kg kg 1 for the validation dataset the median values are differentiated from the mean values for the loam 0 115 and 0 103 kg kg 1 the mean and median respectively and clay 0 183 and 0 161 kg kg 1 the mean and median respectively classes however the number of soil samples included in the clay textural class of the validation dataset is small n 3 the highest σ values are observed in silty loam 0 065 kg kg 1 and silty clay 0 144 kg kg 1 for the calibration dataset of the smaller library and in silty clay 0 076 kg kg 1 and clay 0 068 kg kg 1 for the calibration of the larger library silt loam 0 044 kg kg 1 clay loam 0 043 and clay 0 040 have the highest values of the σ compared to other textural classes for the validation dataset regarding the skewness for the calibration of the small library only the silty clay loam 0 298 and clay 0 167 classes are left skewed while negative skewness for the validation dataset is presented in loamy sand 0 467 sandy loam 0 617 sandy clay loam 0 407 and silty clay loam 1 152 the dataset of the larger library presented only positive skewness for the validation dataset for the sand sandy clay and silty clay only the mean and median are estimated since the soil samples for each of these classes are less than three the values of the campbell b were derived from the small library and the validation dataset and are varied from 2 41 to 8 41 and 2 08 to 7 19 for the calibration and validation dataset respectively the lowest value of campbell b is observed in the loamy sand and sandy loam classes for the calibration and validation dataset respectively the highest value is presented in the sandy loam and silty clay soil for the calibration and validation dataset respectively the higher mean values of each class are observed in the classes with a high percentage of sand or clay while the loamier classes present lower values the highest σ is observed in the sand 1 71 and loam 1 27 for the calibration and validation dataset respectively the lowest negative value of skew is observed in sandy clay loam 1 31 and silty clay loam 1 71 for calibration and validation dataset respectively 3 2 visible near infrared spectroscopy vis nirs measurements in fig 3 four absorption spectra of two soil samples with the lowest and highest values of campbell b 2 08 and 8 4 respectively and two with the lowest and highest values of w1500 0 013 and 0 36 kg kg 1 respectively are illustrated it is observed that the samples with high values of campbell b and w1500 have stronger peaks compared to soils with low values near of 1400 and 1900 nm while the sample with the highest value of campbell b presents as well near of 2220 nm 3 3 partial least squares regression analysis the pre processing techniques that yield the best pls models were the savitzky golay first derivative and osc for the w1500 and campbell b calibration model of the small library respectively and osc for the w1500 of the larger library the optimum number of factors was set to five and two for the w1500 for both models and campbell b respectively figure s2 illustrates the normalized regression coefficients as a function of wavelength for the three calibration models the fitted model coefficients for the campbell b and w1500 from the vis nirs3 are provided in table s2 the results of the three calibration models are presented in table 2 specifically the statistical characteristics of the cross validation and validation datasets and cross validation using the entire small for campbell b and larger for w1500 datasets for each textural class are given for the classes with less than five soil samples the statistics were not calculated but were included to estimate the statistics for all soil samples regarding the cross validation dataset table 2 a the r2 bias and rmse were 0 64 0 0 039 respectively for the w1500 model of the small library and 0 52 0 and 0 058 for the larger library while for the campbell b model the respective figures were 0 56 0 and 0 769 based on the r2 of the w1500 model of the small library for each class it is observed that the loamy sand sandy loam and sandy clay loam present values of r2 close to 0 the sandy clay loam presented the highest rmse value 0 073 kg kg 1 the values of the r2 and rmse for the w1500 of the larger library varied respectively from 0 15 silty clay to 0 64 silt and 0 039 sandy clay loam to 0 086 silty clay kg kg 1 it is observed a higher rmse of 0 086 kg kg 1 in soil samples that their textural classes were not defined since the textural data were not available the highest value of bias 0 046 was observed in the sand class low values of r2 ca 0 of campbell b model were presented in silt loam clay loam and clay classes but a high rmse value 1 43 was observed in sandy clay loam for the validation dataset table 2 b the statistics were worst compared to the cross validation dataset for the small library specifically for the predictions of the w1500 the value of r2 bias and rmse were 0 34 0 027 and 0 049 respectively while for the predictions of the campbell b the figures were 0 19 0 306 and 1 009 respectively the silt loam class presented the lowest rmse 0 031 kg kg 1 of the w1500 compared to the other classes while the highest r2 was observed in the loamy sand the silt loam was presented the highest value of the r2 0 73 and the second lowest value of rmse 0 566 for the prediction of the campbell b the lowest rmse was presented in the sandy clay loam class 0 501 regarding the statistics obtained from the w1500 of the large library the loamy sand sandy loam and sandy clay loam presented lower rmse compared to the statistics derived from the smaller library the silt loam presented a slightly higher value of rmse 0 036 instead of 0 031 kg kg 1 and the loam has the same rmse value 0 039 kg kg 1 compared to the w1500 of the smaller library the absolute values of bias were lower for the w1500 of the larger library among the five textural classes except for the silt loam the r2 bias and rmse for all samples included in the validation dataset were improved 0 49 0 008 kg kg 1 and 0 035 kg kg 1 respectively instead of 0 34 0 027 kg kg 1 and 0 049 kg kg 1 respectively for the predicted from the larger library of the w1500 the statistics of the sandy clay clay loam silty clay loam silty clay and clay were not available since the included soil samples into these classes were less than five soil samples the statistics obtained from the cross validation using the entire datasets small for campbell b and large for w1500 are presented in table 2 c it is observed that the values of r2 bias and rmse were similar to those obtained from the cross validation of the calibration dataset table 2 a regarding the statistics obtained from the cross validation of the campbell b were slightly worst compared to these of table 2 a the permutation results yielded values of 0 05 for cross validation for all tests wilcoxon sign test and rand t test for both models campbell b and w1500 and thus the models were significant at the 95 confidence level additionally based on fig s3 it is observed that the values of standardized sum squared of y values from calibration and cross validation were relatively close to each other and significantly lower than the un permuted soil property far right side of the plot for both models campbell b and w1500 therefore the calibration models were significant and not over fit table 3 a and b presents the statistical characteristic of the predicted w1500 and campbell b derived from the topsoils and subsoils for each soil textural class when the calibration models were included only subsoils and topsoils respectively for the smaller library for the topsoil predicted w1500 the r2 bias and rmse were 0 49 0 016 kg kg 1 and 0 042 kg kg 1 respectively while for the campbell b these figures were 0 55 0 390 and 0 791 respectively for the subsoils predicted w1500 and campbell b r2 bias and rmse were respectively 0 05 0 007 kg kg 1 and 0 073 kg kg 1 and 0 37 0 226 and 1 075 except for the statistics of the three calibration models vis nirs1 vis nirs2 vis nirs measured w1500 for the validation dataset the r2 rmse and bias for each swrc based on the vis nirs predicted soil water retention and the measured points for the validation dataset were calculated the results of these are shown in the box and whisker plots for each textural class in fig 4 all textural classes presented a high value of r2 ca r2 0 85 between the measured and predicted gravimetric water contents at the seven matric potentials of each sample moreover it is observed that the r2 is the same for the three vis nirs scenarios since the values of the campbell b were predicted using the same calibration model obtained from the small library regarding the predictions obtained from the small library vis nirs1 the values of the rmse varied from 0 014 to 0 239 kg kg 1 and a mean value of 0 097 kg kg 1 with the lowest and highest values to be observed in silt loam and loamy sand class respectively the values of bias were from 0 10 to 0 22 kg kg 1 with the silty clay loam and loam classes to be least and most biased respectively lower values of the rmse were observed in the predictions obtained from the larger library vis nirs2 specifically the rmse ranged from 0 009 clay to 0 207 silt loam with an average of 0 065 kg kg 1 the bias for the predictions obtained from the larger library varied from 0 15 to 0 12 with an average of 0 03 kg kg 1 when a measured point at 1500 kpa was included the rmse values were improved 0 008 clay to 0 164 loam with an average of 0 049 kg kg 1 and the bias ranged from 0 073 to 0 138 with a mean value of 0 018 kg kg 1 based on fig 4 it was observed that the rmse values when the predictions were derived from the calibration model of the larger library were significantly improved for all textural classes 3 4 vis nirs and rosetta 1 predictive performance of soil water retention curve in fig 5 the box and whisker plots of the three statistics r2 rmse and bias for each textural class for the five scenarios three for vis nirs and two for rosetta 1 are illustrated the scenarios were the vis nirs1 vis nirs2 vis nirs measured w1500 rosetta 1sc2 and rosetta 1sc4 predicted swrc it was observed that except for the loamy sand class the vis nirs predicted swrc yielded higher values of r2 compared to rosetta 1sc2 the values of the r2 for the rosetta 1sc4 were lower compared to rosetta 1sc2 for all textural classes except for sand the silty clay loam 0 65 0 9 and clay 0 53 0 64 classes presented the lowest values of r2 the values of the rmse for the vis nirs1 predicted swrc for all classes were higher compared to the other four scenarios except for the silt loam in which the higher values of rmse were presented in rosetta 1sc2 the lowest values of rmse were observed in the vis nirs measured w1500 and vis nirs2 scenarios except for the sand class in which the rosetta 1sc4 presented the lowest values of rmse by observing the values of the bias the predictions obtained from the rosetta 1sc4 were least biased compared to rosetta 1sc2 while the most biased predictions were obtained from vis nirs1 fig 6 represents the values of the rmse and bias obtained from the five scenarios at seven soil water matric potentials 6 10 33 100 200 500 and 1500 kpa it is observed that the vis nirs1 presented the highest values of rmse and bias the wettest point 6 kpa was better predicted rmse 0 096 kg kg 1 from the vis nirs2 while close values of the rmse were observed in vis nirs measured w1500 0 102 kg kg 1 and rosetta 1sc4 0 103 kg kg 1 for the rmse of the soil water matric potentials at 10 33 100 and 200 the rosetta 1sc4 presented the lowest values 0 059 0 016 0 023 and 0 023 kg kg 1 compared to the other four scenarios for the driest soil water matric potentials 500 and 1500 kpa the vis nirs measured w1500 presented lower rmse values while the vis nirs2 rosetta 1sc2 and rosetta 1sc4 illustrated similar values the least biased predictions were observed in vis nirs measured w1500 and vis nirs2 having obtained the predicted parameters of each scenario i e w1500 and campbell b for the vis nirs θr θs α and n for rosetta 1sc2 and rosetta 1sc4 they were inserted into the anchored campbell soil water retention function vis nirs scenarios and van genuchten rosetta 1 and the swrcs from near saturation 2 kpa up to 1600 kpa were obtained the predictive performance of swrc for 12 soil samples at least one soil sample from each textural class using the five scenarios is illustrated in fig 7 it is observed that all scenarios of the vis nirs predicted swrc had a similar shape with the soil water retention measurements however for the sand fig 7a loamy sand fig 7b and sandy clay loam fig 7g the vis nirs1 predicted swrcs have presented higher gravimetric water contents at the given matric potentials while the vis nirs1 and vis nirs2 predicted gravimetric water contents for the silty clay soil fig 7k were lower than the measured contents the vis nirs1 predicted swrc for the remaining soils were compared closely with the measurements the swrc obtained from the vis nirs2 were compared closely with the measured data except for the sand loamy sand and silty clay fig 7a b k comparing the two scenarios of the rosetta 1 it is observed that the swrcs derived from scenario 4 were better predicted in horizontal shift compared to scenario 2 but not in shape specifically for the sandy clay loam fig 7g silty clay loam fig 7j silty clay fig 7k and clay fig 7l the predicted swrcs derived from the scenario 4 could not predict the wetter end the predicted swrc obtained from the vis nirs measured w1500 were better predicted compared to the other four scenarios for all the soil samples except for the sandy loam fig 7d loam fig 7e and clay loam fig 7h 4 discussion 4 1 soil water retention curve and anchored campbell function the campbell swrc was selected since can accurately fit the measured soil water retention data moreover the parameter of the campbell b was found that is directly related to the clay contents and organic matter which are predicted from vis nirs with high accuracy clapp and hornberger 1978 olesen et al 1996 pittaki chrysodonta et al 2018 williams et al 1989 furthermore the saturated water content is poorly related to the vis nirs babaeian et al 2015b the water contents at drier points could be predicted from basic soil properties such as clay karup et al 2017 pittaki chrysodonta et al 2019 pittaki chrysodonta et al 2018 rawls et al 1982 therefore the parameters of the anchored campbell swrc would be predicted from the vis nirs a more widely used function is the van genuchten swrc which has four parameters needed to be estimated θs θr α and n however the α value is a scaling parameter jong van lier and pinheiro 2018 and substantially varied even within a soil textural class and it would probably be poorly predicted from the vis nirs the measurements of the soil water retention curve were based on sieved soil samples measurements on undisturbed columns would allow to include in the calibration models the structure of the soil as well since undisturbed samples retain the in situ properties of the soil 4 2 spectral measurements and peaks the peaks near of 1400 and 1900 nm indicate the presence of water molecules and if molecular water is present these two features always appear hunt 1977 at 2200 nm the peak is because of the combination of the oh stretch with the fundamental al oh bending mode hunt 1977 in the visible range the peaks could be assigned to organic matter galvao and vitorello 1998 viscarra rossel et al 2006 and iron oxide minerals hunt 1977 additionally peaks around 1400 nm can be attributed to the 1st overtone of the structural o h stretching mode and a combination of vibrations of water bound in the interlayer lattices as hydrated cations and adsorbed water on particle surfaces bishop et al 1994 in the region of 2200 to 2500 nm there can be a combination of vibrations including o h stretching and metal oh bends stenberg et al 2010 the minerals and organic components of soil are indirectly related to the w1500 and campbell b since these are linked with the clay and carbon contents and thus the peaks in the visible and near infrared range could be used for the development of calibration models for predicting the two parameters w1500 campbell b 4 3 performance of the vis nirs models in different soil texture classes and horizons the predictions for the w1500 in the validation dataset were improved when the calibration model was based on a larger library indicating that more soil samples in the calibration dataset led the calibration models to better capture the important peaks unfortunately this could not be tested for the calibration model of the campbell b because of the limitation of the available data moreover it was found that the highest values of the rmse were in the sandier classes for both parameters regardless of the applied library blaschek et al 2019 have found that the sand contents were poorly predicted from the vis nirs the statistics of the predicted swrc of each soil textural class were improved when in the calibration model of the w1500 more soil samples were included however the statistics obtained from both cross validations using the calibration and the entire datasets for the w1500 of the larger database were slightly worst compared to those obtained from the small library similarly the statistics derived from the cross validation including all the soil samples were slightly worse compared to those derived from the cross validation of the calibration dataset this is probably because more textural classes were included and simultaneously evaluated e g sand sandy clay silty clay and silt moreover the range and the number of soil samples of the w1500 for each class were larger the horizon specific models have shown that a soil sample from topsoil could be predicted from a calibration model built on subsoils however the predictions of the subsoils based on a model built from topsoil did not yield sufficient predictive ability a reason for that is because the topsoils were predicted from a larger database since the number of the subsoils was almost three times higher than the topsoils moreover a subsoil consists of greater minerals and materials of iron and aluminum compounds than topsoil these compounds are reflected in the vis nirs range and thus a model including only topsoils would be not sufficiently predicted the subsoils 4 4 comparison with other vis nirs models for predicting the swrc currently there are few studies in the literature for predicting the swrc babaeian et al 2015b pittaki chrysodonta et al 2018 santra et al 2009 the development of their calibration models was based on topsoils covering specific soil textural ranges the samples included in their studies were undisturbed and derived from regional sampling babaeian et al 2015b and santra et al 2009 developed spectral models for predicting the van genuchten parameters while pittaki chrysodonta et al 2018 have predicted an anchored at 100 kpa campbell swrc specifically for predicting the swrc babaeian et al 2015b developed point and parametric spectral transfer functions to predict soil water contents at nine specific soil matric potentials from saturation up to 1500 kpa and the parameters of van genuchten and brooks corey soil water retention functions the soil samples included in the calibration models were derived from an area from iran were topsoils and varied within a specific soil texture range e g clay 15 45 sand 13 63 silt contents 21 52 they have reported similar to this study r2 0 63 for the water content at 1500 kpa and the r2 of van genuchten and brooks corey parameters varied from 0 14 to 0 44 in their study the development of the calibration models was based on topsoils and subsoils and the soils were derived from a larger geographical area covering more textural classes pittaki chrysodonta et al 2018 have developed a similar concept to this study for predicting an swrc from a vis nirs specifically they have used an anchored campbell soil water retention function anchored at a wetter point 100 kpa the measurements of the swrc were derived from undisturbed 100 cm3 cores and were based solely on danish agricultural soil samples for the development of their calibration models they have included 5 out of 12 soil texture classes and the soils were topsoils they have found higher compared to this study predictive performance for campbell b r2 0 86 and this could be ascribed to the fact that they have included only soils that comprise up to 20 v v and they have used a more local database moreover they have found higher values of the campbell b for each textural class and this is probably because they have used undisturbed soil column santra et al 2009 used spectral transfer functions to predict the two parameters of van genuchten water retention model a and n at the wet part of the swrc ψ 80 kpa additionally they have related the spectral transfer function to the parameters of van genuchten and brooks and corey 4 5 vis nirs models vs rosetta 1 ptfs for predicting the swrc the vis nirs for all scenarios captured the shape of the swrc while the rosetta 1sc4 failed for few soil samples since the predicted curve sharply reached the saturation degree at drier ψ moreover the vis nirs2 yielded to better prediction for the wettest water contents on the other hand the vis nirs1 and vis nirs2 failed to predict the swrc of the sandier soils compared to the rosetta 1 scenarios and as it was discussed this is because of the poor predictability of the spectroscopy for the sandier soils however when a measured w1500 was included the predictions derived from the vis nis were equally good as with rosetta 1 and compared closely to the measured soil water retention data an advantage of the vis nirs is that only the knowledge of the spectral data is required to obtain a predicted swrc without having known the soil texture analysis and bulk density additionally rosetta 1sc4 required the knowledge of two volumetric water content at specific matric potential 33 and 1500 kpa while for the vis nirs measured w1500 a point approximately closed to that potential would be sufficient however the anchored campbell swr function should be anchored at the measured soil water matric potential silva et al 2021 have developed software namely splintex 2 0 which is a ptf model developed with a user friendly computer interface for estimating hydraulic functions parameters they have also compared their model development with the predictions obtained from rosetta and have found comparable results with rosetta with lower rmse values of the volumetric water content in rosetta furthermore wösten et al 2001 and pachepsky et al 2001 found that differences from 0 06 up to 0 11 in the volumetric water contents are acceptable 4 6 implications caveats and future work this study could be applied for obtaining a rapid estimation of the swrc compared to the conventional methods specifically a small amount of air dried and sieved soil sample needed to be scanned in a spectrometer and within few seconds the parameters of the anchored campbell soil water retention function could be obtained because of the rapidity and low cost of the proposed method the estimation of the swrcs could be at a high spatial resolution and thus could assist in modeling and forecasting in different disciplines such as hydrogeology environmental geosciences a limitation of this study is that probably the vis nirs predicted swrc obtained for sandier soils would not have sufficient predictive ability although this study included soil samples that covered a wide textural distribution more soil samples should be added to have a better representation of all classes in the calibration model of the campbell b in this study the calibration models were based on pls regression models while machine learning and deep learning models could be developed as well furthermore the spectral measurements were obtained in a laboratory controlled environment and future studies should examine whether field spectral measurements would result in sufficient estimation of the swrc however different spectrometers would result in having different spectral measurements and transferring methods should be included pittaki chrysodonta et al 2021 specifically according to pittaki chrysodonta et al 2021 the spectral space transformation is most favorable for transferring a soil spectral model from the primary to a secondary instrument moreover the horizon specific models have shown that a soil sample from topsoil could be predicted from a calibration model built on subsoils while the predictions of the subsoils from a calibration model for topsoils should be further investigated since the results of the predictive ability were not sufficient this may be because of the low number of soil samples included in the calibration model for topsoils 100 finally the applicability of the vis nirs for estimating swrc at larger fields and regions based on remote sensing techniques could be explored in future studies 5 conclusions the main objective of this study was to examine if vis nirs could be used as a tool to predict an swrc from the near saturation 2 kpa to 1500 kpa for different soil textural classes the anchored at 1500 kpa campbell soil water retention function was chosen to fit the measured data and thus the two parameters for which calibration models were built were the campbell b and w1500 three calibration models i e pls were developed based on a small 230 soil samples and a larger 1570 soil samples library and three scenarios were examined specifically two calibration models for predicting the campbell b and the w1500 scenario vis nirs1 based on the small library and a calibration model for predicting the w1500 scenario vis nirs2 were developed moreover it was examined whether adding a measurement at 1500 kpa would improve the predictions of the vis nirs swrc scenario vis nirs measured w1500 although the values of the r2 of the campbell b and w1500 were low for most soil textural classes the swrcs at seven soil water matric potentials were predicted with r2 0 8 furthermore the predicted swrcs were compared with these obtained from the rosetta 1 ptfs for two scenarios using as input the soil texture and bulk density rosetta 1sc2 and the soil texture bulk density volumetric water content at 33 and 1500 kpa rosetta 1sc4 it is concluded that vis nirs can be used for predicting the swrc vis nirs captured the shape of the swrc vis nirs failed to predict the soils with a high percentage of sand probably due to the small sample size the horizon specific models have shown that a soil sample from topsoil could be predicted from a calibration model built on subsoils however the predictions of the subsoils based on a model built from topsoil did not yield sufficient predictive ability by adding a measured w1500 the predictive performance of the swrc was increased even for sandy soils predictions of the swrc obtained from the vis nirs2 were comparable to those obtained from rosetta 1sc2 for the majority of the examined soil textural classes vis nirs2 presented equally well performance as rosetta 1sc2 for predicting the gravimetric water content at specified soil water matric potentials credit authorship contribution statement zampela pittaki chrysodonta conceptualization methodology software formal analysis data curation writing original draft writing review editing visualization alfred e hartemink writing original draft writing review editing supervision funding acquisition jingyi huang conceptualization methodology data curation writing original draft writing review editing supervision funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we acknowledge the coordination data collection and data provisioning roles played by kellogg soil survey laboratory kssl team members ryan mathiesen scarlett murphy and rich ferguson for this nonroutine project support for this research was provided by the university of wisconsin madison office of the vice chancellor for research and graduate education with funding from the wisconsin alumni research foundation we also acknowledge editor professor emmanouil anagnostou and two anonymous reviewers for their constructive comments on the original manuscript appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 127195 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
3902,as a warming climate leads to more frequent heavy rainfall the importance of accurate rainfall statistics is increasing rainfall statistics are often presented as intensity duration frequency idf curves showing the rainfall intensity return level that can be expected at a location for a duration and the frequency of this intensity return period idf curves are commonly constructed by fitting generalized extreme value gev distributions to observed annual maximum rainfall for several target durations as the estimation is performed independently across durations the resulting idf curves may be inconsistent across durations and return periods this paper proposes to ensure consistency by post processing the estimated idf curves two post processing approaches are considered a quantile selection algorithm that searches for consistent return levels within the posterior quantiles of a bayesian inference approach and adjustments based on isotonic regression the methods are evaluated for simulated data and for norwegian rainfall data from 83 locations for hourly and sub hourly durations the post processing yields consistent estimates that are at least as accurate as the unadjusted inconsistent estimates we also demonstrate how our approach differs from d gev a method that performs simultaneous estimation across durations an r implementation for the post processing methods is available at https github com climdesign fixidf keywords extreme precipitation design rainfall intensity duration frequency curves extreme value distributions bayesian statistics 1 introduction water is one of the major causes of natural disasters globally unesco un water 2020 a warming climate leads to intensified and more frequent heavy rainfall boucher 2013 since the warmer atmosphere can hold more moisture trenberth et al 2003 this has already manifested itself in observations around the globe showing increased mean and extreme precipitation in many places e g westra et al 2013 according to a growing number of studies extreme short duration precipitation responds more strongly to global warming than less heavy precipitation e g utsumi et al 2011 lenderink and van meijgaard 2008 westra et al 2014 along with continued urbanization more intense and frequent rain showers will place enormous demands on future urban stormwater management also in norway there have been changes in the precipitation regime a large assessment report hanssen bauer et al 2017 documented a temperature increase of about 1 c and an increase in annual precipitation of approximately 18 since 1900 sorteberg et al 2018 showed mainly positive trends in the highest daily precipitation during summer for the period 1968 2017 dyrrdal et al 2012 demonstrated that the intensity of daily annual precipitation maxima increased in large parts of norway during 1968 2010 further norwegian cities have experienced several episodes of severe urban flooding and the societal costs associated with these events are significant nou2015 16 given recent intensified rainfall events a trend that is expected to continue in the future the importance of adequate infrastructure design is obvious this also stresses the importance of accurate rainfall statistics particularly for urban stormwater management as heavy rainfall often leads to surface runoff in urbanized areas with a high degree of impermeable surfaces rainfall statistics or design rainfall is often presented as intensity duration frequency idf curves where intensity refers to the rainfall amount or the return level in mm hour or in mm duration refers to the duration of the rainfall in minutes or hours and frequency is given as a return period in years the idf relationship shows the maximum amount of rain that can be expected for a time duration and how often this rainfall intensity is expected to occur idf curves are commonly constructed by fitting an extreme value distribution to annual maximum am precipitation data lutz et al 2020 for example fitted the well known generalized extreme value gev distribution e g jenkinson 1955 coles 2001 to annual maximum precipitation at 14 stations in and around oslo the capital of norway for 16 durations from 1 min to 1440 min and for return periods from 2 to 200 years the estimation was performed independently across durations at each location using a bayesian approach dyrrdal et al 2015 proposed a spatial model for estimating return levels for locations with or without rainfall observations here the three parameters of the gev distribution were modeled as a function of geographic and climatic explanatory variables in addition gev distributions have successfully been used to estimate return levels in countries like australia canada sweden and switzerland e g huard et al 2010 lehmann et al 2016 fukutome and schindler 2018 olsson et al 2019 many of the methods mentioned above are limited to single durations lutz et al 2020 dyrrdal et al 2015 huard et al 2010 fukutome and schindler 2018 olsson et al 2019 a mathematical formulation of the full idf relationship of intensity and frequency across multiple durations was proposed by koutsoyiannis et al 1998 here the rainfall intensity of a given duration for a specific return period is taken to be a separable function of the duration and the return period under this formulation the idf curves are necessarily consistent in that for a given frequency the return levels are ensured to be increasing with duration when the return level is given in mm or decreasing for return levels given in mm hour this formulation is e g exploited in the so called d gev distribution van de vyver 2015 ritschel et al 2017 ulrich et al 2020 jurado et al 2020 a d gev distribution is a gev distribution that is re parametrized such that two of its three parameters are given as functions of duration with a common scaling exponent similar approaches have also been applied in regional settings nguyen et al 1998 yu et al 2004 lehmann et al 2013 lehmann et al 2016 in the context of spatial variability of hydrological processes gupta and waymire 1990 provide a probabilistic characterization of the spatial process underlying the idf relationship introducing the hypothesis of simple scaling and multiscaling while simple scaling separable frameworks such as that proposed by koutsoyiannis et al 1998 are most commonly used for constructing idf curves van de vyver 2018 argues that a multiscaling approach with different scaling exponents for the location and the scale parameter of the gev distribution is more appropriate when analyzing rainfall for 16 durations between 1 and 1440 min lutz et al 2020 found substantial variations in the estimated shape parameters when different gev distributions were fitted independently to each duration this violates the assumption of all the data arising from a single stochastic process under either simple scaling or multiscaling as both of these assume a fixed shape parameter across durations however if the single duration method of lutz et al 2020 is used to estimate return levels at all available measurement stations in norway for instance 25 of the locations obtain inconsistent curves one illustrative example is shown in fig 1 which shows the idf curves for the oslo station vestre vika for this station the estimated idf relationship gives more rain for the 720 min duration compared to a 1440 min duration for most return levels the result violates basic physical laws demonstrating that an ideal idf relationship is not obtained if the durations are treated independently in the analysis furthermore when only short time series of precipitation are available which often is the case for sub daily precipitation the probability of obtaining inconsistent curves increases as the estimation uncertainty increases the main objective of our paper is to investigate whether accurate and consistent idf curves can be obtained by post processing bayesian estimates that are derived independently for each duration assuming a non parametric consistent idf relationship if successful this will be a more flexible alternative to the models described above that constrain the return levels across durations and return periods through parametric relationships the reason why we use the bayesian framework is the embedded uncertainty assessment it offers when using a bayesian model we do not only get the most likely values of the model parameters but an entire probability distribution for the parameter set expressed through a posterior distribution bayesian approaches to idf curve estimation have become quite common in recent years e g lima et al 2016 huard et al 2010 boukhelifa et al 2018 van de vyver 2015 lehmann et al 2016 a drawback with the bayesian framework however is that bayesian models in general are slow the increased computational complexity of adding consistency constraints to e g the bayesian spatial model in dyrrdal et al 2015 could be substantial by using a post processing method to ensure consistency instead the computational complexity of a model like this can be reduced as independent estimation across durations can easily be performed in a parallel manner the post processing techniques proposed here come at a very low additional computational cost in the following we propose two post processing methods for adjusting return level estimates the first method is an iterative algorithm that adjusts the estimated posterior median curves to more general quantile curves so that the chosen quantiles are as close to the median as possible subject to consistency across durations and return levels this approach considers the full posterior distributions of the return levels and is thus only applicable in combination with inference approaches that return distributional estimates of return levels on the other hand it respects and propagates forward the uncertainty quantification performed in the initial bayesian inference step the second approach we consider is based on isotonic regression wu et al 2014 burdakov et al 2006 stout 2013 the isotonic regression approach adjusts idf curves based on the posterior median return level estimates such that the resulting curves are necessarily monotonically increasing in both duration and return period requiring monotonically increasing idf curves make sense when modeling the return levels with unit mm and not mm hour as we do in this paper the benefit of the isotonic regression approach is that it always yields a result and can be applied to any type of return level estimates not only distributional ones however it does not consider the uncertainty information given in the bayesian posterior distributions and may yield idf curves that lie outside of their support the new post processing techniques are built on the bayesian inference approach of lutz et al 2020 as this will be introduced as the new method for estimating design rainfall values at the norwegian meteorological institute met norway in the near future but in practice the suggested approaches can be used together with any bayesian method for estimating return levels to evaluate the two suggested post processing approaches we present two simulation studies and one study where we use observed rainfall data from 83 observation stations on the mainland of norway in our experiments we compare our post processed return levels to the unadjusted return levels from lutz et al 2020 we also discuss how the proposed approach differs from the d gev approach discussed in ritschel et al 2017 ulrich et al 2020 and jurado et al 2020 where idf curves are estimated simultaneously for all durations in a single step that ensures consistency across durations the remainder of the paper is organized as follows section 2 describes the norwegian precipitation data used for this study the bayesian estimation of idf curves the quantile selection algorithm the isotonic regression and the d gev approach are detailed in section 3 and the experimental setup for the two simulation studies is described in section 4 results for both simulation studies and the norwegian case study are presented in section 5 finally a discussion of the results and conclusions are given in section 6 2 data measurements of precipitation with a time resolution of one minute form the basis for idf calculations at met norway tipping bucket pluviographs are used for this purpose the first stations with pluviographs were equipped with the norwegian produced plumatic manufactured by kongsberg våpenfabrikk a s kv kongsberg norway and were established in the late 1960s the plumatic had a measuring range of 0 2 mm and was only operated during the extended summer months mid april to mid october as it had no heating in the late 1990s and the early 2000s the plumatic pluviographs were successively replaced with the lambrecht 1518h3 tipping bucket pluviometer lambrecht meteo gmbh göttingen germany the lambrecht 1518h3 has a measuring range of 0 1 mm and is heated thus operated all year round in this paper idf curves are estimated locally based on data from the 83 pluviographs shown in fig 2 here we have marked stations that had inconsistent and consistent idf curves with turquoise and red respectively these will be referred to later in the results section the pluviographs in fig 2 are mainly located in populated areas or close to critical infrastructure and regulated waterways thus there are higher density networks of pluviographs in and around the larger cities outside the larger cities particularly at higher elevations and in the north of norway the network is sparse the pluviographs in fig 2 have measured precipitation each minute for at least ten years between 1970 and 2019 the median number of observation years at the 83 stations is 19 years and the maximum number of years is 49 at a station in oslo for the purpose of idf estimates the 1 min observations from the pluviographs are aggregated to longer durations namely 2 3 5 10 15 20 30 45 60 90 120 180 360 720 and 1440 min using sliding windows whereby the highest value for each year and duration is extracted this provides 16 annual maximum time series for each of the locations in fig 2 the most severe rainfall events in norway usually take place during may september our quality control aims for at least 80 data coverage during these months each year if the data coverage is below 80 for these months the annual maximum value of that particular year is omitted more details can be found in lutz et al 2020 met norway acquired an automated data reception system in 2005 and since then automated quality control routines have been in place older data before 2005 has not undergone automatic quality control and manual control is required this is demanding and time consuming the manual control and evaluation of data coverage have already been carried out for the stations in the oslo area fig 2 while stations in the rest of the country will be controlled in the near future we consider the delay in the manual quality control not to have a large impact on this study later we show that inconsistent curves also are obtained in oslo despite having data with particularly high quality here in addition to evaluating the proposed methods on the norwegian time series of annual maxima we conduct two simulation studies where the simulated data are inspired by the norwegian setting described above see section 4 for details 3 methods 3 1 creating idf curves from extreme value distributions extreme value theory provides a modeling framework for the tail of probability distributions specifically denote by x 1 x n a set of continuous univariate random variables that are assumed to be independent and identically distributed if the normalized distribution of the maximum max x 1 x n converges as n it converges to a gev distribution jenkinson 1955 for this reason the gev distribution is commonly used to model block maxima such as annual maximum am precipitation coles 2001 denote by x the observed am precipitation mm for duration d for a specific year the cumulative distribution of the three parameter gev distribution is then given by 1 g x μ d σ d ξ d exp 1 ξ d x μ d σ d 1 ξ d for 1 ξ d x μ d σ d 0 where μ d r is the location parameter σ d 0 is the scale parameter and ξ d r is the shape parameter associated with the duration d we use the convention of coles 2001 meaning that a positive ξ d refers to a fréchet distribution a negative ξ d refers to a weibull distribution and ξ d 0 refers to the particular case of the gumbel distribution note that we model the return levels with unit mm and not mm h when developing our methodology as this is common practice when constructing idf curves in norway for design purposes we are interested in the return level z d t associated with a return period t and duration d where the return period t is defined as the expected time between two extreme events of size z d t here given in years the return level can be derived from t 1 prob x z d t 1 1 g z d t μ d σ d ξ d with g being the cumulative gev distribution in eq 1 this results in 2 z d t μ d σ d ξ d 1 log 1 1 t ξ d in order to determine the return levels z d t from eq 2 the parameters μ d σ d and ξ d must be estimated as the parameters change with duration one gev distribution must be fitted to each target duration and this is done independently across durations the workflow is illustrated in fig 3 where it is referred to as independent estimation the estimation of μ d σ d and ξ d can be done either by using frequentist methods such as maximum likelihood estimation or using a bayesian approach see e g kobierska et al 2018 for a comparison of various estimation approaches in this work we consider bayesian methods and use the bayesian method described in lutz et al 2020 for estimating parameters for our experiments this is a sampling based mcmc approach gamerman and lopes 2006 mcmc provides n s samples of the parameters μ d ξ d and σ d for each duration representing the parameters posterior distributions each of the n s sets of sampled parameters can then be inserted into eq 2 yielding n s possible return levels z d t for each duration and return period these return levels define the posterior distribution of z d t to estimate our parameters we carry out 50 000 mcmc steps with a burn in time of 47 000 steps which means that only the last 3 000 mcmc steps are used to construct the posterior distributions the first 47 000 samples are neglected to ensure that the results are not affected by the mcmc method s initial conditions usually a point estimate for z d t is given by the mean mode or median of the posterior distribution of z d t this is also the estimate we typically would present in an idf curve in the following we discuss if the idf curves can be constructed from any α d quantile of z d t denoted z d t α d where α d 0 01 0 02 0 98 0 99 represents the probability associated with the quantile hence with this notation the posterior median return level for a duration d and return level t is denoted z d t 0 5 while the return level corresponding to the posterior 99 quantile is denoted z d t 0 99 if gev distributions are used to estimate return levels for a set of durations d i d 1 d n and return periods t t 1 t m the results can be summarized through a set of n curves one per duration which we denote c d i t α d i for i 1 n a curve c d i t α d i is defined by a vector that contains all return levels for the duration of interest i e 3 c d i t α d i z d i t 1 α d i z d i t m α d i the elements in c d i t α d i are composed from the posterior quantiles of a gev distribution where each target duration is associated with one gev distribution the variable α d i 0 01 0 02 0 98 0 99 represents the quantile that is chosen as the summary statistic for duration d i example curves for 3 durations are shown in the middle and right panel of fig 3 with return period t on the x axis and return levels z d i t j α d i on the y axis the middle panel of this figure also illustrates how the independent estimation of gev distributions sometimes give inconsistent curve sets where a curve corresponding to one duration crosses with a curve corresponding to another duration by introducing post processing methods for return level adjustments we aim to adjust inconsistent curve sets such that the return levels become consistent across durations and return periods mathematically we define a set of curves c d 1 t α d 1 c d n t α d n as consistent if 4 z d i t j α d i z d k t l α d k for d i d k and t j t l for any i k 1 n and j l 1 m i e the return levels modeled with unit mm should be monotonically increasing as a function of duration and return period note that for a fixed set of gev parameters the return levels z d t in 2 are necessarily monotonically increasing for increasing values of t as they stem from a single gev distribution consequently the elements in c d i t α d i for a fixed d i are also monotonically increasing the two curves c d i t α d i and c d k t α d k however may initially be inconsistent with each other for i k if the two curves were fitted independently of each other 3 2 post processing methods in the following we present the two post processing methods that can be used to adjust the return level estimates of a bayesian method a quantile selection algorithm and adjustments by isotonic regression the adjusted curve set represents the curves for each duration that we believe is closest to reality and that we e g would present to a user that is not a trained statistician note that the uncertainty bounds given by the bayesian model are not adjusted throughout the text we assume that the original uncertainty bounds are acceptable for the idf curves as long as the initial bayesian model is competent the workflow of the proposed approach for consistent return level estimation is illustrated in fig 3 3 2 1 quantile selection algorithm we introduce the first post processing method by using the curves in fig 4 as an example in this figure we see c 360 min t 0 5 c 720 min t 0 5 and c 1440 min t 0 5 for the oslo station vestre vika estimated independently across durations by using the method in lutz et al 2020 these are zoomed in versions of some of the curves in the right panel of fig 1 when the posterior estimates are given by the posterior medians we again notice that there are inconsistencies between the 720 min and 1440 min durations however an inspection of the curves shows that we can obtain consistent curves if we replace the posterior median estimates by the posterior 43 quantile for the 720 min duration and the posterior 58 quantile for the 1440 min duration i e if we use c 720 min t 0 43 and c 1440 min t 0 58 as our point estimates for these durations hence to resolve the inconsistency issues for this curve set a minor deviation from the posterior median for two of the durations curves is all that is needed inspired by this we propose to adjust inconsistent return levels by using an algorithm that searches for a consistent set of curves within the bayesian posterior quantiles over all durations the idea behind the algorithm is that we can choose any posterior quantile in 1 2 98 99 as the summary statistic for a specific curve as long as it gives consistent return levels more formally our goal is to select α d 1 α d n such that the curves c d 1 t α d 1 c d n t α d n are consistent according to 4 furthermore we would like to select the α d i i such that the chosen summary statistics are as close as possible to the posterior median α d i 0 5 for all i since the posterior medians reflect the most likely return levels of the initial bayesian approach algorithm1 quantile selection algorithm in theory we could construct an algorithm that inspects all possible combinations of posterior quantiles for our n curves and returns the consistent solution that is closest to the original posterior median however in practice this is not possible if we have n 16 curves as in the oslo example in fig 1 and 99 quantiles to choose from 0 01 0 02 0 99 we would have 99 16 combinations of posterior quantiles to investigate this is computationally unfeasible and calls for simplifications particularly because we usually want to carry out the procedure for a large number of locations we therefore propose the simple algorithm presented in algorithm 1 which we refer to as the quantile selection algorithm the algorithm works by shifting curves that cross with a higher or lower duration s curve towards a higher or lower posterior quantile this is done iteratively until the algorithm finds a consistent set of curves c d 1 t α d 1 c d n t α d n or until it reaches a maximum number of iterations k indicating non convergence the quantile selection algorithm consists of four steps but in step 3 two different choices can be made regarding where to move the curves in practice the different choices give two different sub algorithms represented by steps 1 2 3a 4 and 1 2 3b 4 respectively by including both we increase the probability that at least one of the selection strategies converges another reason for having two options is that it increases the possibility of selecting summary statistics closer to the posterior medians if both of the sub algorithms converge we return the solution with curves that are closer to the initial posterior median in terms of the root mean square error rmse this is formulated mathematically in step 4 in algorithm 1 3 2 2 isotonic regression as an alternative method to the quantile selection algorithm we suggest using isotonic regression for post processing the return levels isotonic regression is a method for fitting a piece wise linear model to a set of observations y i under the constraint that the resulting linear model is monotonically increasing as a function of one or several covariates wu et al 2014 burdakov et al 2006 stout 2013 more formally assuming we have a set of n observations y i and p associated covariates x ik for i 1 n and k 1 p isotonic regression is performed by finding the function f that minimizes 5 i 1 n y i f x i 1 x ik x ip 2 where f is such that f x i 1 x ik x ip f x j 1 x jk x jp whenever x ik x jk for all i j and k if we treat the return level as the response variable and the return period and duration as two covariates the isotonic regression solution requires that z d i t j z d k t l whenever d i d k and t j t l for i k 1 n and j l 1 m this is also exactly what we demand for a consistent set of curves according to 4 consequently isotonic regression can be used to adjust the posterior point estimates from a bayesian approach or any other inference approach as it does not utilize the entire bayesian posterior distribution here we use the posterior medians z d i t j 0 5 from the bayesian method in lutz et al 2020 as our initial return level estimates for all d i and t j the function iso pen from the r package isotonic pen with pen false is used to perform a multiple least squares isotonic regression in its simplest form the r implementation in iso pen is based on the algorithm described in meyer 2013 3 3 reference method d gev in the literature other methods for obtaining consistent idf curves have been proposed one of them suggests fitting a so called d gev distribution to observed annual maximum rainfall intensities for several durations at once e g ritschel et al 2017 ulrich et al 2020 jurado et al 2020 a d gev distribution is simply a gev distribution that is reparametrized such that the location parameter μ d i and the scale parameter σ d i in eq 1 depend on the duration d i through an empirical relationship between rainfall intensities mm hour and durations hour the empirical relationship was developed by koutsoyiannis et al 1998 and is given by 6 σ d i σ 0 d i θ η μ d i μ σ d i when assuming that the rainfall is modeled with unit mm h or mm min here θ 0 0 η 1 and σ 0 0 the shape parameter ξ d is kept constant across durations hence the d gev distribution has five parameters that must be estimated θ η σ 0 μ and ξ d i ξ these can e g be estimated by maximum likelihood estimation where the likelihood is a product over all observed rainfall intensities with the unit mm min or mm hour and durations min or hour we use d gev as a reference method for the two post processing methods proposed in this article where the parameter estimation is performed using the fit d gev function in the r package idf ulrich et al 2020 note that the d gev approach provides a framework for estimating return levels jointly for several durations as opposed to our proposed two stage approach in which return levels are first estimated independently for each duration and then modified to ensure consistency 4 experimental setup in this section we present the experimental setup for evaluating the methods for return level estimation presented in section 3 2 the methods are evaluated through two simulation studies and a case study of am precipitation data from 83 observation stations in norway the same sets of durations and return periods are considered for all three experiments specifically we use 16 durations d i d where d 1 2 3 5 10 15 20 30 45 60 90 120 180 360 720 1440 minutes and the following set of return periods t 2 5 10 20 25 50 100 200 years this gives a set of 16 curves c d 1 t α d 1 c d 1 t α d 16 per location the above durations and return periods are chosen because these are the ones used operationally at met norway when creating idf curves 4 1 simulation study 1 direct simulation of return levels from gev distributions in the first simulation study data is simulated directly from gev distributions allowing for a direct comparison of estimated and true return levels in order to allow for different climatic settings we simulate 100 data sets using different sets of gev parameters that are determined by random sampling specifically the location scale and shape parameters of the gev distribution are assumed to follow simple linear models as follows 7 μ d i 1 22 μ d i 1 for i 1 log σ d i 0 35 0 85 log σ d i 1 for i 1 ξ d i 0 02 0 83 ξ d i 1 ε d i for i 1 μ d 1 n 2 0 5 2 log σ d 1 n 0 5 0 1 2 ξ d 1 n 0 0 05 2 here μ d i σ d i and ξ d i are the location scale and shape parameters respectively for duration d i d with i 1 n and is the absolute value included to ensure positive location parameters further is ε d i an error term distributed as n 0 0 05 2 this set of linear models was based on performing linear regression on the estimated gev parameters at the station vestli in oslo one of the longest series in our data set the available am data from 1974 to 2019 was modeled under the bayesian framework of lutz et al 2020 and we saw that the posterior mean values for μ d i and log σ d i followed linear relationships the relationship was less clear for the posterior mean of ξ d i thus we added the error term ε d i the distributions for the starting values μ d 1 log σ d 1 and ξ d 1 were selected by trial and error where the goal was to find starting values yielding realistic parameter values with corresponding realistic non crossing idf curves the parameter sets were sampled from the linear model in 7 until 100 sets of parameters resulting in consistent true idf curves were obtained three examples of the resulting idf curve sets are shown in fig 5 the 100 parameter sets were then used to simulate 100 data sets with 30 values for each duration in d based on these data return values were estimated for the return periods in t independently across durations as illustrated in fig 3 by using the bayesian method of lutz et al 2020 subsequently inconsistencies were corrected with isotonic regression and the quantile selection algorithm after the adjustment the estimated return levels were compared to the true return levels for all return periods and durations in terms of the root mean square error rmse and the absolute normalized error ane the rmse and ane are in general defined as 8 rmse 1 n i 1 n y i y i 2 9 ane i y i y i y i where y i and y i denote a pair of true and predicted values respectively in this case the true and predicted return levels while ane is a scale independent evaluation score rmse is scale dependent but both criteria are defined such that a low value corresponds to an accurate prediction we calculate the ane and rmse for each data set i e based on return levels for eight return periods and 16 durations the average ane for a data set is used as a summary score we also compute the average ane for each return period and return level to see whether there is a trend in the predictive performance in this first simulation study three methods are compared independent return level estimation with adjustments using the quantile selection algorithm and isotonic regression and independent return level estimation with no adjustments the unadjusted return levels are given by the posterior medians of the initial bayesian method only data sets with inconsistencies in the unadjusted return levels are included in the comparison since the simulation design includes shape parameters ξ d i that change with duration we have excluded the d gev approach which assumes constant shape across durations from the comparison the primary motivation for this simulation design is that we know the true return levels and can evaluate the post processing methods across an extensive range of gev distributions however a drawback is that the simulated am data sets are simulated independently across durations this may be interpreted as if am data for 1 min durations are sampled from different years than the data for 2 min durations consequently there will be more inconsistencies in the estimated return levels than for an actual am data set however this somewhat unrealistic setting provides an assessment of the robustness of the proposed post processing methods and can contribute to an improved understanding of the differences between the methods 4 2 simulation study 2 blrpm weather simulator the goal of the second simulation study is to evaluate the post processing methods in a more realistic setting than that described above for this we simulate precipitation with a temporal resolution of one minute from a stochastic rainfall generator more specifically the bartlett lewis rectangular pulse model blrpm see e g onof and wheater 1994 cowpertwait 1998 kaczmarska 2011 and ritschel et al 2017 in a blrpm it is assumed that precipitation occurs during storms where a storm consists of a cluster of so called cells and where each cell causes precipitation of a certain intensity mathematically the storms or cell clusters are generated according to a poisson process with generation rate λ and with exponentially distributed lifetime with expectation 1 γ the cells within the cell clusters are then generated according to another poisson process with rate β and exponentially distributed lifetime with expectation 1 η finally the intensity of the precipitation associated with a cell is assumed to be constant within the duration of the cell an exponential distribution with mean μ x models the intensity of a cell the five blrpm parameters have the unit min 1 when considering precipitation with a resolution of one minute except the intensity parameter μ x that has the unit mmmin 1 for the simulation we use the r package blrpm ritschel et al 2017 for a realistic set of parameters we use the results from table a2 in ritschel et al 2017 which lists estimated monthly parameters for hourly precipitation at a station in berlin germany heavy rainfall in berlin typically happens in summer therefore our simulation setup only considers one 90 day season per year with parameter values equal to the reported parameter values averaged over the months june july and august after rounding and converting the parameters to the unit min 1 we obtain the following parameter values λ 0 00028 min 1 γ 0 0039 min 1 β 0 0072 min 1 η 0 057 min 1 and μ x 0 106 mm min 1 to get an estimated ground truth for this setting we simulate 1000 seasons of precipitation 129600 min per year and extract sliding maxima for each duration d i d to obtain a data set of 1000 years of observed seasonal maxima the return level estimates retrieved with the bayesian model of lutz et al 2020 applied independently to the 1000 data points for each duration are then considered to represent the ground truth see fig 6 as shown the resulting return levels are consistent we then construct 100 new seasonal maximum data sets each with 15 seasons of data by randomly drawing 15 seasons from the original set of 1000 seasons this way we obtain consistent data sets where the observed seasonal maximum precipitation monotonically increases with the duration within an observation year we now proceed as in the previous simulation study return level estimates for each data set obtained with the bayesian model of lutz et al 2020 are post processed with the quantile selection algorithm and isotonic regression if the original posterior medians are inconsistent as illustrated in fig 3 the data are also modeled with the d gev approach as described in section 3 3 the resulting return levels are then compared to the return levels from fig 6 in terms of ane and rmse as before our presentation of the results only includes results from experiments that initially gave inconsistent curves before adjustments unless otherwise specified 4 3 observed am data from norway finally we test the quantile selection algorithm isotonic regression and the d gev approach on am data from the 83 norwegian precipitation stations from fig 2 for the real data set we do not know the true underlying return levels and cannot evaluate the results in terms of rmse and ane instead we highlight differences between the methods compare them visually and discuss convergence properties of the quantile selection algorithm 5 results 5 1 simulation study 1 direct simulation of return levels from gev distributions in the first simulation study where data was simulated directly from gev distributions the original bayesian estimation yields inconsistent posterior median return levels for all 100 data sets on average 7 of 16 curves crossed with a lower and or higher duration s curve and as many as 12 out of 16 curves crossed at the most despite the many inconsistencies the quantile selection algorithm converged for 100 out of 100 data sets the predictive performance is summarized in fig 7 we see that the adjustment with both isotonic regression and the quantile selection algorithm improves the accuracy compared to the initial posterior median estimates unadjusted estimates in terms of ane and rmse in addition to producing consistent curves on average the quantile selection algorithm performs slightly better than isotonic regression further investigation shows that the quantile selection algorithm improves the initial estimates for 95 out of 100 data sets in terms of average ane while isotonic regression improves the initial estimates for 99 out of 100 data sets furthermore the quantile selection algorithm resulted in a lower average ane than isotonic regression for 85 out of 100 data sets in fig 8 we visualize the difference in average ane between adjusted and unadjusted return levels for all durations and return periods we also include a histogram showing which durations gave crossing curves when using the posterior medians as estimates fig 8 illustrates that the changes made by isotonic regression and the quantile selection algorithm tend to improve the initial return level estimates for all durations and or return periods for which adjustments were needed the figure also shows that while the quantile selection algorithm and isotonic regression perform similarly across durations and return periods the quantile selection algorithm in general produces slightly better estimates than isotonic regression in terms of ane the fact that the quantile selection algorithm converged for all 100 data sets shows that the algorithm is robust and able to handle quite severe inconsistencies one illustrative example is shown in fig 9 for the selected data set 11 curves crossed initially note that two of the durations have switched places entirely in fig 9a and c the 20 min duration provides larger return levels than the 30 min duration for all return periods fig 9e shows how the winning sub algorithm sub algorithm 3b was able to solve the inconsistency issues by systematically moving one curve per iteration towards a higher or lower posterior quantile in the chosen example 215 iterations were needed to find a consistent set of return levels but on average the number of iterations required to find a valid solution for the winning sub algorithm was 94 for the 100 data sets used in this simulation study this means that the algorithm converges quite fast often within 2 s on a regular personal computer fig 10 shows which quantile was chosen by the quantile selection algorithm in cases where the posterior median was rejected we see that the chosen quantiles are normally distributed around the 50 quantile showing that the algorithm indeed prefers solutions centered around the initial posterior median in this sense the quantile selection algorithm is unbiased with respect to the initial median not tending to prefer moving towards higher or lower quantiles while the quantile selection algorithm requires that a valid solution exists within the initial 1 99 posterior prediction intervals isotonic regression can move the return levels wherever needed to achieve consistency because of this isotonic regression is more flexible than the quantile selection algorithm and will find valid solutions in cases where the algorithm does not converge another main difference between the post processing methods is that the quantile selection algorithm moves the whole curve c d i t α d i during the adjustment while isotonic regression can move single return levels z d i t i 0 5 in fig 11 we illustrate how these model differences affect the adjusted return levels here we compare the unadjusted return levels to the adjusted return levels provided by the quantile selection algorithm and isotonic regression fig 11 shows that isotonic regression as the quantile selection algorithm gives return levels centered around the unadjusted posterior median return levels however isotonic regression tends to provide return levels closer to the initial posterior medians for example it yielded return levels within the 40 60 posterior intervals for 90 of the return levels while for the quantile selection algorithm this happened for only 78 3 of the return levels in the first simulation study this is likely a consequence of isotonic regression s ability to perform a more local adjustment compared to the quantile selection algorithm despite producing adjusted return levels closer to the posterior medians isotonic regression performs poorer than the quantile selection algorithm according to the rmse and ane scores as displayed in figs 7 and 8 the reason might be that to move the whole curve c d i t α d i for all return periods t simultaneously as the quantile selection algorithm does is a better strategy than moving the return levels more independently the shape of the underlying gev distribution is preserved when the entire curve c d i t α d i is shifted towards a higher or lower quantile which can represent a benefit 5 2 simulation study 2 blrpm weather simulator in the second simulation study we generated more realistic data by simulating data from a blrpm weather simulator with a temporal resolution of one minute after the initial bayesian estimation 87 of the 100 simulated data sets yield inconsistent estimated idf curves with the mean number of crossed curves equal to 3 7 out of a total of 16 curves the quantile selection algorithm converged for all 87 cases with the mean number of iterations needed to find a set of valid curves equal to 23 for the winning sub algorithm these numbers are considerably lower than for the first simulation study where the mean number of curve crossings equals 7 and the mean number of iterations needed to find a solution equals 94 in fig 12 we present the predictive performance of the post processing methods for the 87 data sets in simulation study 2 that initially gave inconsistent posterior median return levels the results are further compared to using the unadjusted posterior median return levels and the d gev reference method we find that the predictive performance of the three bayesian approaches algorithm isotonic and unadjusted is very similar with the quantile selection algorithm giving a slightly lower average rmse than the other two in terms of average ane isotonic regression and the quantile selection algorithm perform equally well we see only small differences in average ane and rmse between the post processing methods and the unadjusted solutions because few adjustments were needed to achieve a consistent set of curves fig 10 shows that the quantile selection algorithm chooses quantiles considerably closer to the posterior median in this simulation study than for simulation study 1 the right panel of fig 13 further shows that there rarely were inconsistencies for durations lower than 45 min for the initial return level estimates for simulation study 2 hence no adjustments were needed for the curves representing these durations however for durations above 45 min adjustments were often necessary and here the post processing methods move the return levels closer to the true return levels according to fig 13 although the differences between the methods are negligible in practical applications in fig 14 the return levels estimated by d gev are compared to the true return levels and to the return levels adjusted through the quantile selection algorithm we see that the d gev return level estimates are more biased than the estimates given by our suggested approach this is also confirmed by the ane and the rmse of d gev from fig 12 the result can be explained by the fact that d gev is less flexible than our suggested method since d gev is constrained by the parametric relationship in 6 d gev also requires a constant shape parameter ξ d i across durations the latter assumption does not seem to apply to the simulated data according to our bayesian estimates the posterior mean shape parameter varies from 0 03 to 0 15 when we fitted the model to 1000 years of simulated data for 16 durations particularly for shorter durations 120 min the shape parameter varies and increases as a function of duration another explanation for d gev s poorer performance may be that the parameters of d gev are estimated using a likelihood where most of the rainfall data are data for shorter durations as a result short duration data are given more weight than long duration data which might lead to biases particularly for return levels corresponding to longer durations 5 3 observed am data from norway finally we discuss the performance of the different methods applied on real am data from the 83 norwegian precipitation stations in fig 2 the results show that 20 out of the 83 stations have inconsistent return level curves when using the unadjusted posterior medians from the bayesian method in lutz et al 2020 as point estimates these are the locations marked in turquoise in fig 2 in general stations with shorter time series generate crossing curves more often than stations with longer time series for locations with inconsistent return level curves the 20 50 and 80 quantiles for the number of years of am observations were 13 16 and 21 years respectively for locations with consistent return level curves these quantiles were 16 20 and 29 years in fig 15 we visualize how many times each duration s curve was inconsistent with at least one other duration s curve this happened most frequently for moderate durations 45 120 min and rarely for low durations 15 minutes the quantile selection algorithm converged for all 20 locations with inconsistent return levels and on average only 6 15 iterations were needed to find a consistent set of curves furthermore the average number of curves crossing for a location was 2 7 while the maximum number of crossing curves was 5 out of 16 the quantiles chosen by the quantile selection algorithm are plotted in the histogram in fig 10 for cases where the posterior median was not selected and it turns out that only quantiles between the 43 quantile and the 56 quantile were chosen this shows that for real rainfall data often only small adjustments are needed to achieve consistent curve sets the two post processing methods isotonic regression and the quantile selection algorithm give quite similar results for the real data set they are also approximately equally fast performing the adjustments within a few seconds for each location however isotonic regression again tends to provide adjusted estimates closer to the initial posterior medians note that this does not imply that this method is better according to the results from simulation study 2 a comparison between the return levels estimated by d gev and the quantile selection algorithm for the real am data set is shown in fig 16 only return levels from the 20 stations that initially had inconsistent return levels are included we see that the two methods give quite different results for many locations a key difference is that d gev tends to produce smoother idf curves than the bayesian approach combined with the post processing methods discussed in this article particularly at locations for which the bayesian method initially produced inconsistent curves the post processing techniques tend to generate rougher curves than d gev one example can be seen in fig 16 where the idf curves for the location gvarv located in the southeast of norway are shown for durations shorter than 500 min it seems that the curves produced by the bayesian method and the quantile selection algorithm have a saddle point this tendency is connected to the fact that the bayesian method treats each duration independently giving a very flexible model while d gev assumes the smooth relationship in eq 6 as in simulation study 2 we observe that the bayesian estimation yields non constant shape parameter estimates here the estimates can vary between 0 1 and 0 28 across durations within a location in addition to the 83 stations discussed here we tested the post processing methods on norwegian am data from 6 additional locations with less than 10 years of am data available a sample size that is generally not considered appropriate for fitting a three parameter extreme value distribution indeed we found that the quantile selection algorithm did not converge for 5 of these locations with inspection revealing that the initial bayesian mcmc samples were poorly mixed for several of the durations giving extremely narrow posterior distributions as a result no valid solutions existed within the 1 99 posterior intervals for the return levels isotonic regression on the other hand always returns a solution however this example illustrates that the non convergence of the quantile selection algorithm can be used as a tool for flagging issues with the initial bayesian estimates 6 discussion and conclusions this paper proposes two post processing methods for adjusting posterior return levels for extreme precipitation estimated by bayesian inference in a manner that ensures consistent intensity duration frequency curves across durations the results show that both post processing methods a quantile selection algorithm and an isotonic regression approach are able to provide consistent curves that also increase the accuracy of the estimated return levels compared to retaining the unadjusted estimates both methods perform the adjustments within a few seconds for one location overall the proposed quantile selection algorithm provides slightly more accurate predicted return levels than isotonic regression hence searching for consistent return levels within the posterior 1 99 quantiles of a bayesian model is a promising strategy for constructing reliable and consistent return levels our results also indicate that a bayesian inference approach applied to each duration independently combined with a post processing method outperforms d gev a method that simultaneously estimates return levels for several durations and return periods in a manner that ensures consistency for obtaining consistent idf curves at observation stations in norway we thus suggest applying the bayesian method of lutz et al 2020 combined with the quantile selection algorithm in the future we plan to extend or replace the method in lutz et al 2020 such that a changing climate is taken into account through a non stationary model for example as in sarhadi and soulis 2017 the post processing methods presented in this paper have the major advantage of allowing to expand the initial bayesian model as needed while still using the post processing methods to ensure consistency the estimation of idf curves is generally associated with a high degree of uncertainty in particular for shorter time series an example of this was demonstrated in fig 4 that shows the 1 and 99 posterior quantiles for the return level estimates for two durations at a station with 13 available am observations despite the extensive uncertainty it is necessary to issue return level estimates given by a single number for each duration and return period as infrastructure planning and other decision making processes usually require deterministic rather than probabilistic values as inputs for this reason we have here focused on issuing and evaluating deterministic return value estimates a detailed discussion of the various sources of uncertainty and a comprehensive framework for assessing the reliability of uncertainty estimates is given in renard et al 2013 in the context of flood frequency analysis as the work in renard et al 2013 is based on fitting gev distributions to series of annual maxima this same framework equally applies in the current setting of idf curve estimation and provides a direction for further future work related to the assessment of the associated uncertainties the quantile selection algorithm in its current form is quite simple and could be extended in several ways for example the algorithm terminates the search as soon as it finds a consistent set of return levels an alternative solution would be to continue the search for several iterations after convergence in an attempt to find even more optimal solutions in its current form the algorithm requires the difference between two subsequent return levels to be greater or equal to 0 although this requirement is flexible it may result in idf curves that are non smooth smoother curves could be obtained by changing the consistency definition in 4 to require that z d i t j α d i z d k t l α d k δ for d i d k and t j t l instead where δ 0 denotes the minimum allowed distance between two return levels however this would limit the flexibility of the quantile selection algorithm and potentially result in a higher rate of non convergence it would also introduce the need to subjectively choose the bandwidth δ which probably should be modeled as a function of return level and or the return period above we connected d gev s poorer performance to its treatment of the shape parameter ξ d as constant over durations which contradicts the bayesian inference results both for simulation study 2 and the norwegian am data in a previous study veneziano et al 2007 found that ξ d peaks for durations around 1 3 h and decays for shorter and longer durations on the other hand in a study of radar measurements in the netherlands overeem et al 2009 found a less positive ξ d for 15 and 30 min than for longer durations for durations longer than 30 min the shape parameter seemed to be relatively constant but the uncertainty was very large according to koutsoyiannis 2004 and koutsoyiannis 2004 the shape parameter can also be difficult to identify for short data series the examples above demonstrate that there is no complete agreement regarding the shape parameter in the literature but what is evident from our study is that the flexibility of the chosen gev model has a large impact on the resulting idf curves for both actual and simulated precipitation data simulation study 2 also indicates a need for more flexible gev distributions in return level estimation while the parametric relationship from eq 6 used in d gev might be suitable for some target durations it is not necessarily suitable for modeling a larger range of target durations at once due to differences in the precipitation generating processes that cause long duration and short duration precipitation an advantage of the d gev approach is that return levels for out of sample durations i e for durations without am data can easily be obtained through the parametric formulas for the location and scale parameters in eq 6 our proposed approach on the other hand demands that each duration be linked to an am precipitation data set and that each duration be fitted with a single gev distribution alternatively we could use linear interpolation between the available return levels to estimate return levels for out of sample durations in this setting however the flexibility of the proposed approach can be a disadvantage as opposed to d gev that produces smoother curves d gev also offers extrapolation to return levels of durations that are longer or shorter than the ones for which we have data if it is of interest to estimate idf curves at out of sample locations spatial bayesian methods like that suggested by dyrrdal et al 2015 can be applied to obtain out of sample estimates independently for each duration of interest because of the independent spatial interpolations that ensue the rate of inconsistencies for such a procedure is expected to be higher than seen here for the observed am data the resulting estimates can then be post processed using the quantile selection algorithm or the isotonic regression in the same way as described here for the local method of lutz et al 2020 this two step approach can be expected to be considerably faster than extending the method in dyrrdal et al 2015 to model several durations at once under consistency constraints declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the research council of norway supported this work through grant nr 302457 climate adjusted design values for extreme precipitation and flooding climdesign the authors thank kolbjørn engeland and danielle barna for valuable discussions we also thank per ove kjensli and åse moen vidal met norway for the manual quality control of the pluviograph data the norwegian precipitation data are available at www seklima met no and https frost met no the r package fixidf with functionality to apply the quantile selection algorithm and the isotonic regression algorithm is available at https github com climdesign fixidf appendix a supplementary data supplementary data associated with this article can be found in the online version at https doi org 10 1016 j jhydrol 2021 127000 supplementary data the following are the supplementary data to this article supplementary data 1 
3902,as a warming climate leads to more frequent heavy rainfall the importance of accurate rainfall statistics is increasing rainfall statistics are often presented as intensity duration frequency idf curves showing the rainfall intensity return level that can be expected at a location for a duration and the frequency of this intensity return period idf curves are commonly constructed by fitting generalized extreme value gev distributions to observed annual maximum rainfall for several target durations as the estimation is performed independently across durations the resulting idf curves may be inconsistent across durations and return periods this paper proposes to ensure consistency by post processing the estimated idf curves two post processing approaches are considered a quantile selection algorithm that searches for consistent return levels within the posterior quantiles of a bayesian inference approach and adjustments based on isotonic regression the methods are evaluated for simulated data and for norwegian rainfall data from 83 locations for hourly and sub hourly durations the post processing yields consistent estimates that are at least as accurate as the unadjusted inconsistent estimates we also demonstrate how our approach differs from d gev a method that performs simultaneous estimation across durations an r implementation for the post processing methods is available at https github com climdesign fixidf keywords extreme precipitation design rainfall intensity duration frequency curves extreme value distributions bayesian statistics 1 introduction water is one of the major causes of natural disasters globally unesco un water 2020 a warming climate leads to intensified and more frequent heavy rainfall boucher 2013 since the warmer atmosphere can hold more moisture trenberth et al 2003 this has already manifested itself in observations around the globe showing increased mean and extreme precipitation in many places e g westra et al 2013 according to a growing number of studies extreme short duration precipitation responds more strongly to global warming than less heavy precipitation e g utsumi et al 2011 lenderink and van meijgaard 2008 westra et al 2014 along with continued urbanization more intense and frequent rain showers will place enormous demands on future urban stormwater management also in norway there have been changes in the precipitation regime a large assessment report hanssen bauer et al 2017 documented a temperature increase of about 1 c and an increase in annual precipitation of approximately 18 since 1900 sorteberg et al 2018 showed mainly positive trends in the highest daily precipitation during summer for the period 1968 2017 dyrrdal et al 2012 demonstrated that the intensity of daily annual precipitation maxima increased in large parts of norway during 1968 2010 further norwegian cities have experienced several episodes of severe urban flooding and the societal costs associated with these events are significant nou2015 16 given recent intensified rainfall events a trend that is expected to continue in the future the importance of adequate infrastructure design is obvious this also stresses the importance of accurate rainfall statistics particularly for urban stormwater management as heavy rainfall often leads to surface runoff in urbanized areas with a high degree of impermeable surfaces rainfall statistics or design rainfall is often presented as intensity duration frequency idf curves where intensity refers to the rainfall amount or the return level in mm hour or in mm duration refers to the duration of the rainfall in minutes or hours and frequency is given as a return period in years the idf relationship shows the maximum amount of rain that can be expected for a time duration and how often this rainfall intensity is expected to occur idf curves are commonly constructed by fitting an extreme value distribution to annual maximum am precipitation data lutz et al 2020 for example fitted the well known generalized extreme value gev distribution e g jenkinson 1955 coles 2001 to annual maximum precipitation at 14 stations in and around oslo the capital of norway for 16 durations from 1 min to 1440 min and for return periods from 2 to 200 years the estimation was performed independently across durations at each location using a bayesian approach dyrrdal et al 2015 proposed a spatial model for estimating return levels for locations with or without rainfall observations here the three parameters of the gev distribution were modeled as a function of geographic and climatic explanatory variables in addition gev distributions have successfully been used to estimate return levels in countries like australia canada sweden and switzerland e g huard et al 2010 lehmann et al 2016 fukutome and schindler 2018 olsson et al 2019 many of the methods mentioned above are limited to single durations lutz et al 2020 dyrrdal et al 2015 huard et al 2010 fukutome and schindler 2018 olsson et al 2019 a mathematical formulation of the full idf relationship of intensity and frequency across multiple durations was proposed by koutsoyiannis et al 1998 here the rainfall intensity of a given duration for a specific return period is taken to be a separable function of the duration and the return period under this formulation the idf curves are necessarily consistent in that for a given frequency the return levels are ensured to be increasing with duration when the return level is given in mm or decreasing for return levels given in mm hour this formulation is e g exploited in the so called d gev distribution van de vyver 2015 ritschel et al 2017 ulrich et al 2020 jurado et al 2020 a d gev distribution is a gev distribution that is re parametrized such that two of its three parameters are given as functions of duration with a common scaling exponent similar approaches have also been applied in regional settings nguyen et al 1998 yu et al 2004 lehmann et al 2013 lehmann et al 2016 in the context of spatial variability of hydrological processes gupta and waymire 1990 provide a probabilistic characterization of the spatial process underlying the idf relationship introducing the hypothesis of simple scaling and multiscaling while simple scaling separable frameworks such as that proposed by koutsoyiannis et al 1998 are most commonly used for constructing idf curves van de vyver 2018 argues that a multiscaling approach with different scaling exponents for the location and the scale parameter of the gev distribution is more appropriate when analyzing rainfall for 16 durations between 1 and 1440 min lutz et al 2020 found substantial variations in the estimated shape parameters when different gev distributions were fitted independently to each duration this violates the assumption of all the data arising from a single stochastic process under either simple scaling or multiscaling as both of these assume a fixed shape parameter across durations however if the single duration method of lutz et al 2020 is used to estimate return levels at all available measurement stations in norway for instance 25 of the locations obtain inconsistent curves one illustrative example is shown in fig 1 which shows the idf curves for the oslo station vestre vika for this station the estimated idf relationship gives more rain for the 720 min duration compared to a 1440 min duration for most return levels the result violates basic physical laws demonstrating that an ideal idf relationship is not obtained if the durations are treated independently in the analysis furthermore when only short time series of precipitation are available which often is the case for sub daily precipitation the probability of obtaining inconsistent curves increases as the estimation uncertainty increases the main objective of our paper is to investigate whether accurate and consistent idf curves can be obtained by post processing bayesian estimates that are derived independently for each duration assuming a non parametric consistent idf relationship if successful this will be a more flexible alternative to the models described above that constrain the return levels across durations and return periods through parametric relationships the reason why we use the bayesian framework is the embedded uncertainty assessment it offers when using a bayesian model we do not only get the most likely values of the model parameters but an entire probability distribution for the parameter set expressed through a posterior distribution bayesian approaches to idf curve estimation have become quite common in recent years e g lima et al 2016 huard et al 2010 boukhelifa et al 2018 van de vyver 2015 lehmann et al 2016 a drawback with the bayesian framework however is that bayesian models in general are slow the increased computational complexity of adding consistency constraints to e g the bayesian spatial model in dyrrdal et al 2015 could be substantial by using a post processing method to ensure consistency instead the computational complexity of a model like this can be reduced as independent estimation across durations can easily be performed in a parallel manner the post processing techniques proposed here come at a very low additional computational cost in the following we propose two post processing methods for adjusting return level estimates the first method is an iterative algorithm that adjusts the estimated posterior median curves to more general quantile curves so that the chosen quantiles are as close to the median as possible subject to consistency across durations and return levels this approach considers the full posterior distributions of the return levels and is thus only applicable in combination with inference approaches that return distributional estimates of return levels on the other hand it respects and propagates forward the uncertainty quantification performed in the initial bayesian inference step the second approach we consider is based on isotonic regression wu et al 2014 burdakov et al 2006 stout 2013 the isotonic regression approach adjusts idf curves based on the posterior median return level estimates such that the resulting curves are necessarily monotonically increasing in both duration and return period requiring monotonically increasing idf curves make sense when modeling the return levels with unit mm and not mm hour as we do in this paper the benefit of the isotonic regression approach is that it always yields a result and can be applied to any type of return level estimates not only distributional ones however it does not consider the uncertainty information given in the bayesian posterior distributions and may yield idf curves that lie outside of their support the new post processing techniques are built on the bayesian inference approach of lutz et al 2020 as this will be introduced as the new method for estimating design rainfall values at the norwegian meteorological institute met norway in the near future but in practice the suggested approaches can be used together with any bayesian method for estimating return levels to evaluate the two suggested post processing approaches we present two simulation studies and one study where we use observed rainfall data from 83 observation stations on the mainland of norway in our experiments we compare our post processed return levels to the unadjusted return levels from lutz et al 2020 we also discuss how the proposed approach differs from the d gev approach discussed in ritschel et al 2017 ulrich et al 2020 and jurado et al 2020 where idf curves are estimated simultaneously for all durations in a single step that ensures consistency across durations the remainder of the paper is organized as follows section 2 describes the norwegian precipitation data used for this study the bayesian estimation of idf curves the quantile selection algorithm the isotonic regression and the d gev approach are detailed in section 3 and the experimental setup for the two simulation studies is described in section 4 results for both simulation studies and the norwegian case study are presented in section 5 finally a discussion of the results and conclusions are given in section 6 2 data measurements of precipitation with a time resolution of one minute form the basis for idf calculations at met norway tipping bucket pluviographs are used for this purpose the first stations with pluviographs were equipped with the norwegian produced plumatic manufactured by kongsberg våpenfabrikk a s kv kongsberg norway and were established in the late 1960s the plumatic had a measuring range of 0 2 mm and was only operated during the extended summer months mid april to mid october as it had no heating in the late 1990s and the early 2000s the plumatic pluviographs were successively replaced with the lambrecht 1518h3 tipping bucket pluviometer lambrecht meteo gmbh göttingen germany the lambrecht 1518h3 has a measuring range of 0 1 mm and is heated thus operated all year round in this paper idf curves are estimated locally based on data from the 83 pluviographs shown in fig 2 here we have marked stations that had inconsistent and consistent idf curves with turquoise and red respectively these will be referred to later in the results section the pluviographs in fig 2 are mainly located in populated areas or close to critical infrastructure and regulated waterways thus there are higher density networks of pluviographs in and around the larger cities outside the larger cities particularly at higher elevations and in the north of norway the network is sparse the pluviographs in fig 2 have measured precipitation each minute for at least ten years between 1970 and 2019 the median number of observation years at the 83 stations is 19 years and the maximum number of years is 49 at a station in oslo for the purpose of idf estimates the 1 min observations from the pluviographs are aggregated to longer durations namely 2 3 5 10 15 20 30 45 60 90 120 180 360 720 and 1440 min using sliding windows whereby the highest value for each year and duration is extracted this provides 16 annual maximum time series for each of the locations in fig 2 the most severe rainfall events in norway usually take place during may september our quality control aims for at least 80 data coverage during these months each year if the data coverage is below 80 for these months the annual maximum value of that particular year is omitted more details can be found in lutz et al 2020 met norway acquired an automated data reception system in 2005 and since then automated quality control routines have been in place older data before 2005 has not undergone automatic quality control and manual control is required this is demanding and time consuming the manual control and evaluation of data coverage have already been carried out for the stations in the oslo area fig 2 while stations in the rest of the country will be controlled in the near future we consider the delay in the manual quality control not to have a large impact on this study later we show that inconsistent curves also are obtained in oslo despite having data with particularly high quality here in addition to evaluating the proposed methods on the norwegian time series of annual maxima we conduct two simulation studies where the simulated data are inspired by the norwegian setting described above see section 4 for details 3 methods 3 1 creating idf curves from extreme value distributions extreme value theory provides a modeling framework for the tail of probability distributions specifically denote by x 1 x n a set of continuous univariate random variables that are assumed to be independent and identically distributed if the normalized distribution of the maximum max x 1 x n converges as n it converges to a gev distribution jenkinson 1955 for this reason the gev distribution is commonly used to model block maxima such as annual maximum am precipitation coles 2001 denote by x the observed am precipitation mm for duration d for a specific year the cumulative distribution of the three parameter gev distribution is then given by 1 g x μ d σ d ξ d exp 1 ξ d x μ d σ d 1 ξ d for 1 ξ d x μ d σ d 0 where μ d r is the location parameter σ d 0 is the scale parameter and ξ d r is the shape parameter associated with the duration d we use the convention of coles 2001 meaning that a positive ξ d refers to a fréchet distribution a negative ξ d refers to a weibull distribution and ξ d 0 refers to the particular case of the gumbel distribution note that we model the return levels with unit mm and not mm h when developing our methodology as this is common practice when constructing idf curves in norway for design purposes we are interested in the return level z d t associated with a return period t and duration d where the return period t is defined as the expected time between two extreme events of size z d t here given in years the return level can be derived from t 1 prob x z d t 1 1 g z d t μ d σ d ξ d with g being the cumulative gev distribution in eq 1 this results in 2 z d t μ d σ d ξ d 1 log 1 1 t ξ d in order to determine the return levels z d t from eq 2 the parameters μ d σ d and ξ d must be estimated as the parameters change with duration one gev distribution must be fitted to each target duration and this is done independently across durations the workflow is illustrated in fig 3 where it is referred to as independent estimation the estimation of μ d σ d and ξ d can be done either by using frequentist methods such as maximum likelihood estimation or using a bayesian approach see e g kobierska et al 2018 for a comparison of various estimation approaches in this work we consider bayesian methods and use the bayesian method described in lutz et al 2020 for estimating parameters for our experiments this is a sampling based mcmc approach gamerman and lopes 2006 mcmc provides n s samples of the parameters μ d ξ d and σ d for each duration representing the parameters posterior distributions each of the n s sets of sampled parameters can then be inserted into eq 2 yielding n s possible return levels z d t for each duration and return period these return levels define the posterior distribution of z d t to estimate our parameters we carry out 50 000 mcmc steps with a burn in time of 47 000 steps which means that only the last 3 000 mcmc steps are used to construct the posterior distributions the first 47 000 samples are neglected to ensure that the results are not affected by the mcmc method s initial conditions usually a point estimate for z d t is given by the mean mode or median of the posterior distribution of z d t this is also the estimate we typically would present in an idf curve in the following we discuss if the idf curves can be constructed from any α d quantile of z d t denoted z d t α d where α d 0 01 0 02 0 98 0 99 represents the probability associated with the quantile hence with this notation the posterior median return level for a duration d and return level t is denoted z d t 0 5 while the return level corresponding to the posterior 99 quantile is denoted z d t 0 99 if gev distributions are used to estimate return levels for a set of durations d i d 1 d n and return periods t t 1 t m the results can be summarized through a set of n curves one per duration which we denote c d i t α d i for i 1 n a curve c d i t α d i is defined by a vector that contains all return levels for the duration of interest i e 3 c d i t α d i z d i t 1 α d i z d i t m α d i the elements in c d i t α d i are composed from the posterior quantiles of a gev distribution where each target duration is associated with one gev distribution the variable α d i 0 01 0 02 0 98 0 99 represents the quantile that is chosen as the summary statistic for duration d i example curves for 3 durations are shown in the middle and right panel of fig 3 with return period t on the x axis and return levels z d i t j α d i on the y axis the middle panel of this figure also illustrates how the independent estimation of gev distributions sometimes give inconsistent curve sets where a curve corresponding to one duration crosses with a curve corresponding to another duration by introducing post processing methods for return level adjustments we aim to adjust inconsistent curve sets such that the return levels become consistent across durations and return periods mathematically we define a set of curves c d 1 t α d 1 c d n t α d n as consistent if 4 z d i t j α d i z d k t l α d k for d i d k and t j t l for any i k 1 n and j l 1 m i e the return levels modeled with unit mm should be monotonically increasing as a function of duration and return period note that for a fixed set of gev parameters the return levels z d t in 2 are necessarily monotonically increasing for increasing values of t as they stem from a single gev distribution consequently the elements in c d i t α d i for a fixed d i are also monotonically increasing the two curves c d i t α d i and c d k t α d k however may initially be inconsistent with each other for i k if the two curves were fitted independently of each other 3 2 post processing methods in the following we present the two post processing methods that can be used to adjust the return level estimates of a bayesian method a quantile selection algorithm and adjustments by isotonic regression the adjusted curve set represents the curves for each duration that we believe is closest to reality and that we e g would present to a user that is not a trained statistician note that the uncertainty bounds given by the bayesian model are not adjusted throughout the text we assume that the original uncertainty bounds are acceptable for the idf curves as long as the initial bayesian model is competent the workflow of the proposed approach for consistent return level estimation is illustrated in fig 3 3 2 1 quantile selection algorithm we introduce the first post processing method by using the curves in fig 4 as an example in this figure we see c 360 min t 0 5 c 720 min t 0 5 and c 1440 min t 0 5 for the oslo station vestre vika estimated independently across durations by using the method in lutz et al 2020 these are zoomed in versions of some of the curves in the right panel of fig 1 when the posterior estimates are given by the posterior medians we again notice that there are inconsistencies between the 720 min and 1440 min durations however an inspection of the curves shows that we can obtain consistent curves if we replace the posterior median estimates by the posterior 43 quantile for the 720 min duration and the posterior 58 quantile for the 1440 min duration i e if we use c 720 min t 0 43 and c 1440 min t 0 58 as our point estimates for these durations hence to resolve the inconsistency issues for this curve set a minor deviation from the posterior median for two of the durations curves is all that is needed inspired by this we propose to adjust inconsistent return levels by using an algorithm that searches for a consistent set of curves within the bayesian posterior quantiles over all durations the idea behind the algorithm is that we can choose any posterior quantile in 1 2 98 99 as the summary statistic for a specific curve as long as it gives consistent return levels more formally our goal is to select α d 1 α d n such that the curves c d 1 t α d 1 c d n t α d n are consistent according to 4 furthermore we would like to select the α d i i such that the chosen summary statistics are as close as possible to the posterior median α d i 0 5 for all i since the posterior medians reflect the most likely return levels of the initial bayesian approach algorithm1 quantile selection algorithm in theory we could construct an algorithm that inspects all possible combinations of posterior quantiles for our n curves and returns the consistent solution that is closest to the original posterior median however in practice this is not possible if we have n 16 curves as in the oslo example in fig 1 and 99 quantiles to choose from 0 01 0 02 0 99 we would have 99 16 combinations of posterior quantiles to investigate this is computationally unfeasible and calls for simplifications particularly because we usually want to carry out the procedure for a large number of locations we therefore propose the simple algorithm presented in algorithm 1 which we refer to as the quantile selection algorithm the algorithm works by shifting curves that cross with a higher or lower duration s curve towards a higher or lower posterior quantile this is done iteratively until the algorithm finds a consistent set of curves c d 1 t α d 1 c d n t α d n or until it reaches a maximum number of iterations k indicating non convergence the quantile selection algorithm consists of four steps but in step 3 two different choices can be made regarding where to move the curves in practice the different choices give two different sub algorithms represented by steps 1 2 3a 4 and 1 2 3b 4 respectively by including both we increase the probability that at least one of the selection strategies converges another reason for having two options is that it increases the possibility of selecting summary statistics closer to the posterior medians if both of the sub algorithms converge we return the solution with curves that are closer to the initial posterior median in terms of the root mean square error rmse this is formulated mathematically in step 4 in algorithm 1 3 2 2 isotonic regression as an alternative method to the quantile selection algorithm we suggest using isotonic regression for post processing the return levels isotonic regression is a method for fitting a piece wise linear model to a set of observations y i under the constraint that the resulting linear model is monotonically increasing as a function of one or several covariates wu et al 2014 burdakov et al 2006 stout 2013 more formally assuming we have a set of n observations y i and p associated covariates x ik for i 1 n and k 1 p isotonic regression is performed by finding the function f that minimizes 5 i 1 n y i f x i 1 x ik x ip 2 where f is such that f x i 1 x ik x ip f x j 1 x jk x jp whenever x ik x jk for all i j and k if we treat the return level as the response variable and the return period and duration as two covariates the isotonic regression solution requires that z d i t j z d k t l whenever d i d k and t j t l for i k 1 n and j l 1 m this is also exactly what we demand for a consistent set of curves according to 4 consequently isotonic regression can be used to adjust the posterior point estimates from a bayesian approach or any other inference approach as it does not utilize the entire bayesian posterior distribution here we use the posterior medians z d i t j 0 5 from the bayesian method in lutz et al 2020 as our initial return level estimates for all d i and t j the function iso pen from the r package isotonic pen with pen false is used to perform a multiple least squares isotonic regression in its simplest form the r implementation in iso pen is based on the algorithm described in meyer 2013 3 3 reference method d gev in the literature other methods for obtaining consistent idf curves have been proposed one of them suggests fitting a so called d gev distribution to observed annual maximum rainfall intensities for several durations at once e g ritschel et al 2017 ulrich et al 2020 jurado et al 2020 a d gev distribution is simply a gev distribution that is reparametrized such that the location parameter μ d i and the scale parameter σ d i in eq 1 depend on the duration d i through an empirical relationship between rainfall intensities mm hour and durations hour the empirical relationship was developed by koutsoyiannis et al 1998 and is given by 6 σ d i σ 0 d i θ η μ d i μ σ d i when assuming that the rainfall is modeled with unit mm h or mm min here θ 0 0 η 1 and σ 0 0 the shape parameter ξ d is kept constant across durations hence the d gev distribution has five parameters that must be estimated θ η σ 0 μ and ξ d i ξ these can e g be estimated by maximum likelihood estimation where the likelihood is a product over all observed rainfall intensities with the unit mm min or mm hour and durations min or hour we use d gev as a reference method for the two post processing methods proposed in this article where the parameter estimation is performed using the fit d gev function in the r package idf ulrich et al 2020 note that the d gev approach provides a framework for estimating return levels jointly for several durations as opposed to our proposed two stage approach in which return levels are first estimated independently for each duration and then modified to ensure consistency 4 experimental setup in this section we present the experimental setup for evaluating the methods for return level estimation presented in section 3 2 the methods are evaluated through two simulation studies and a case study of am precipitation data from 83 observation stations in norway the same sets of durations and return periods are considered for all three experiments specifically we use 16 durations d i d where d 1 2 3 5 10 15 20 30 45 60 90 120 180 360 720 1440 minutes and the following set of return periods t 2 5 10 20 25 50 100 200 years this gives a set of 16 curves c d 1 t α d 1 c d 1 t α d 16 per location the above durations and return periods are chosen because these are the ones used operationally at met norway when creating idf curves 4 1 simulation study 1 direct simulation of return levels from gev distributions in the first simulation study data is simulated directly from gev distributions allowing for a direct comparison of estimated and true return levels in order to allow for different climatic settings we simulate 100 data sets using different sets of gev parameters that are determined by random sampling specifically the location scale and shape parameters of the gev distribution are assumed to follow simple linear models as follows 7 μ d i 1 22 μ d i 1 for i 1 log σ d i 0 35 0 85 log σ d i 1 for i 1 ξ d i 0 02 0 83 ξ d i 1 ε d i for i 1 μ d 1 n 2 0 5 2 log σ d 1 n 0 5 0 1 2 ξ d 1 n 0 0 05 2 here μ d i σ d i and ξ d i are the location scale and shape parameters respectively for duration d i d with i 1 n and is the absolute value included to ensure positive location parameters further is ε d i an error term distributed as n 0 0 05 2 this set of linear models was based on performing linear regression on the estimated gev parameters at the station vestli in oslo one of the longest series in our data set the available am data from 1974 to 2019 was modeled under the bayesian framework of lutz et al 2020 and we saw that the posterior mean values for μ d i and log σ d i followed linear relationships the relationship was less clear for the posterior mean of ξ d i thus we added the error term ε d i the distributions for the starting values μ d 1 log σ d 1 and ξ d 1 were selected by trial and error where the goal was to find starting values yielding realistic parameter values with corresponding realistic non crossing idf curves the parameter sets were sampled from the linear model in 7 until 100 sets of parameters resulting in consistent true idf curves were obtained three examples of the resulting idf curve sets are shown in fig 5 the 100 parameter sets were then used to simulate 100 data sets with 30 values for each duration in d based on these data return values were estimated for the return periods in t independently across durations as illustrated in fig 3 by using the bayesian method of lutz et al 2020 subsequently inconsistencies were corrected with isotonic regression and the quantile selection algorithm after the adjustment the estimated return levels were compared to the true return levels for all return periods and durations in terms of the root mean square error rmse and the absolute normalized error ane the rmse and ane are in general defined as 8 rmse 1 n i 1 n y i y i 2 9 ane i y i y i y i where y i and y i denote a pair of true and predicted values respectively in this case the true and predicted return levels while ane is a scale independent evaluation score rmse is scale dependent but both criteria are defined such that a low value corresponds to an accurate prediction we calculate the ane and rmse for each data set i e based on return levels for eight return periods and 16 durations the average ane for a data set is used as a summary score we also compute the average ane for each return period and return level to see whether there is a trend in the predictive performance in this first simulation study three methods are compared independent return level estimation with adjustments using the quantile selection algorithm and isotonic regression and independent return level estimation with no adjustments the unadjusted return levels are given by the posterior medians of the initial bayesian method only data sets with inconsistencies in the unadjusted return levels are included in the comparison since the simulation design includes shape parameters ξ d i that change with duration we have excluded the d gev approach which assumes constant shape across durations from the comparison the primary motivation for this simulation design is that we know the true return levels and can evaluate the post processing methods across an extensive range of gev distributions however a drawback is that the simulated am data sets are simulated independently across durations this may be interpreted as if am data for 1 min durations are sampled from different years than the data for 2 min durations consequently there will be more inconsistencies in the estimated return levels than for an actual am data set however this somewhat unrealistic setting provides an assessment of the robustness of the proposed post processing methods and can contribute to an improved understanding of the differences between the methods 4 2 simulation study 2 blrpm weather simulator the goal of the second simulation study is to evaluate the post processing methods in a more realistic setting than that described above for this we simulate precipitation with a temporal resolution of one minute from a stochastic rainfall generator more specifically the bartlett lewis rectangular pulse model blrpm see e g onof and wheater 1994 cowpertwait 1998 kaczmarska 2011 and ritschel et al 2017 in a blrpm it is assumed that precipitation occurs during storms where a storm consists of a cluster of so called cells and where each cell causes precipitation of a certain intensity mathematically the storms or cell clusters are generated according to a poisson process with generation rate λ and with exponentially distributed lifetime with expectation 1 γ the cells within the cell clusters are then generated according to another poisson process with rate β and exponentially distributed lifetime with expectation 1 η finally the intensity of the precipitation associated with a cell is assumed to be constant within the duration of the cell an exponential distribution with mean μ x models the intensity of a cell the five blrpm parameters have the unit min 1 when considering precipitation with a resolution of one minute except the intensity parameter μ x that has the unit mmmin 1 for the simulation we use the r package blrpm ritschel et al 2017 for a realistic set of parameters we use the results from table a2 in ritschel et al 2017 which lists estimated monthly parameters for hourly precipitation at a station in berlin germany heavy rainfall in berlin typically happens in summer therefore our simulation setup only considers one 90 day season per year with parameter values equal to the reported parameter values averaged over the months june july and august after rounding and converting the parameters to the unit min 1 we obtain the following parameter values λ 0 00028 min 1 γ 0 0039 min 1 β 0 0072 min 1 η 0 057 min 1 and μ x 0 106 mm min 1 to get an estimated ground truth for this setting we simulate 1000 seasons of precipitation 129600 min per year and extract sliding maxima for each duration d i d to obtain a data set of 1000 years of observed seasonal maxima the return level estimates retrieved with the bayesian model of lutz et al 2020 applied independently to the 1000 data points for each duration are then considered to represent the ground truth see fig 6 as shown the resulting return levels are consistent we then construct 100 new seasonal maximum data sets each with 15 seasons of data by randomly drawing 15 seasons from the original set of 1000 seasons this way we obtain consistent data sets where the observed seasonal maximum precipitation monotonically increases with the duration within an observation year we now proceed as in the previous simulation study return level estimates for each data set obtained with the bayesian model of lutz et al 2020 are post processed with the quantile selection algorithm and isotonic regression if the original posterior medians are inconsistent as illustrated in fig 3 the data are also modeled with the d gev approach as described in section 3 3 the resulting return levels are then compared to the return levels from fig 6 in terms of ane and rmse as before our presentation of the results only includes results from experiments that initially gave inconsistent curves before adjustments unless otherwise specified 4 3 observed am data from norway finally we test the quantile selection algorithm isotonic regression and the d gev approach on am data from the 83 norwegian precipitation stations from fig 2 for the real data set we do not know the true underlying return levels and cannot evaluate the results in terms of rmse and ane instead we highlight differences between the methods compare them visually and discuss convergence properties of the quantile selection algorithm 5 results 5 1 simulation study 1 direct simulation of return levels from gev distributions in the first simulation study where data was simulated directly from gev distributions the original bayesian estimation yields inconsistent posterior median return levels for all 100 data sets on average 7 of 16 curves crossed with a lower and or higher duration s curve and as many as 12 out of 16 curves crossed at the most despite the many inconsistencies the quantile selection algorithm converged for 100 out of 100 data sets the predictive performance is summarized in fig 7 we see that the adjustment with both isotonic regression and the quantile selection algorithm improves the accuracy compared to the initial posterior median estimates unadjusted estimates in terms of ane and rmse in addition to producing consistent curves on average the quantile selection algorithm performs slightly better than isotonic regression further investigation shows that the quantile selection algorithm improves the initial estimates for 95 out of 100 data sets in terms of average ane while isotonic regression improves the initial estimates for 99 out of 100 data sets furthermore the quantile selection algorithm resulted in a lower average ane than isotonic regression for 85 out of 100 data sets in fig 8 we visualize the difference in average ane between adjusted and unadjusted return levels for all durations and return periods we also include a histogram showing which durations gave crossing curves when using the posterior medians as estimates fig 8 illustrates that the changes made by isotonic regression and the quantile selection algorithm tend to improve the initial return level estimates for all durations and or return periods for which adjustments were needed the figure also shows that while the quantile selection algorithm and isotonic regression perform similarly across durations and return periods the quantile selection algorithm in general produces slightly better estimates than isotonic regression in terms of ane the fact that the quantile selection algorithm converged for all 100 data sets shows that the algorithm is robust and able to handle quite severe inconsistencies one illustrative example is shown in fig 9 for the selected data set 11 curves crossed initially note that two of the durations have switched places entirely in fig 9a and c the 20 min duration provides larger return levels than the 30 min duration for all return periods fig 9e shows how the winning sub algorithm sub algorithm 3b was able to solve the inconsistency issues by systematically moving one curve per iteration towards a higher or lower posterior quantile in the chosen example 215 iterations were needed to find a consistent set of return levels but on average the number of iterations required to find a valid solution for the winning sub algorithm was 94 for the 100 data sets used in this simulation study this means that the algorithm converges quite fast often within 2 s on a regular personal computer fig 10 shows which quantile was chosen by the quantile selection algorithm in cases where the posterior median was rejected we see that the chosen quantiles are normally distributed around the 50 quantile showing that the algorithm indeed prefers solutions centered around the initial posterior median in this sense the quantile selection algorithm is unbiased with respect to the initial median not tending to prefer moving towards higher or lower quantiles while the quantile selection algorithm requires that a valid solution exists within the initial 1 99 posterior prediction intervals isotonic regression can move the return levels wherever needed to achieve consistency because of this isotonic regression is more flexible than the quantile selection algorithm and will find valid solutions in cases where the algorithm does not converge another main difference between the post processing methods is that the quantile selection algorithm moves the whole curve c d i t α d i during the adjustment while isotonic regression can move single return levels z d i t i 0 5 in fig 11 we illustrate how these model differences affect the adjusted return levels here we compare the unadjusted return levels to the adjusted return levels provided by the quantile selection algorithm and isotonic regression fig 11 shows that isotonic regression as the quantile selection algorithm gives return levels centered around the unadjusted posterior median return levels however isotonic regression tends to provide return levels closer to the initial posterior medians for example it yielded return levels within the 40 60 posterior intervals for 90 of the return levels while for the quantile selection algorithm this happened for only 78 3 of the return levels in the first simulation study this is likely a consequence of isotonic regression s ability to perform a more local adjustment compared to the quantile selection algorithm despite producing adjusted return levels closer to the posterior medians isotonic regression performs poorer than the quantile selection algorithm according to the rmse and ane scores as displayed in figs 7 and 8 the reason might be that to move the whole curve c d i t α d i for all return periods t simultaneously as the quantile selection algorithm does is a better strategy than moving the return levels more independently the shape of the underlying gev distribution is preserved when the entire curve c d i t α d i is shifted towards a higher or lower quantile which can represent a benefit 5 2 simulation study 2 blrpm weather simulator in the second simulation study we generated more realistic data by simulating data from a blrpm weather simulator with a temporal resolution of one minute after the initial bayesian estimation 87 of the 100 simulated data sets yield inconsistent estimated idf curves with the mean number of crossed curves equal to 3 7 out of a total of 16 curves the quantile selection algorithm converged for all 87 cases with the mean number of iterations needed to find a set of valid curves equal to 23 for the winning sub algorithm these numbers are considerably lower than for the first simulation study where the mean number of curve crossings equals 7 and the mean number of iterations needed to find a solution equals 94 in fig 12 we present the predictive performance of the post processing methods for the 87 data sets in simulation study 2 that initially gave inconsistent posterior median return levels the results are further compared to using the unadjusted posterior median return levels and the d gev reference method we find that the predictive performance of the three bayesian approaches algorithm isotonic and unadjusted is very similar with the quantile selection algorithm giving a slightly lower average rmse than the other two in terms of average ane isotonic regression and the quantile selection algorithm perform equally well we see only small differences in average ane and rmse between the post processing methods and the unadjusted solutions because few adjustments were needed to achieve a consistent set of curves fig 10 shows that the quantile selection algorithm chooses quantiles considerably closer to the posterior median in this simulation study than for simulation study 1 the right panel of fig 13 further shows that there rarely were inconsistencies for durations lower than 45 min for the initial return level estimates for simulation study 2 hence no adjustments were needed for the curves representing these durations however for durations above 45 min adjustments were often necessary and here the post processing methods move the return levels closer to the true return levels according to fig 13 although the differences between the methods are negligible in practical applications in fig 14 the return levels estimated by d gev are compared to the true return levels and to the return levels adjusted through the quantile selection algorithm we see that the d gev return level estimates are more biased than the estimates given by our suggested approach this is also confirmed by the ane and the rmse of d gev from fig 12 the result can be explained by the fact that d gev is less flexible than our suggested method since d gev is constrained by the parametric relationship in 6 d gev also requires a constant shape parameter ξ d i across durations the latter assumption does not seem to apply to the simulated data according to our bayesian estimates the posterior mean shape parameter varies from 0 03 to 0 15 when we fitted the model to 1000 years of simulated data for 16 durations particularly for shorter durations 120 min the shape parameter varies and increases as a function of duration another explanation for d gev s poorer performance may be that the parameters of d gev are estimated using a likelihood where most of the rainfall data are data for shorter durations as a result short duration data are given more weight than long duration data which might lead to biases particularly for return levels corresponding to longer durations 5 3 observed am data from norway finally we discuss the performance of the different methods applied on real am data from the 83 norwegian precipitation stations in fig 2 the results show that 20 out of the 83 stations have inconsistent return level curves when using the unadjusted posterior medians from the bayesian method in lutz et al 2020 as point estimates these are the locations marked in turquoise in fig 2 in general stations with shorter time series generate crossing curves more often than stations with longer time series for locations with inconsistent return level curves the 20 50 and 80 quantiles for the number of years of am observations were 13 16 and 21 years respectively for locations with consistent return level curves these quantiles were 16 20 and 29 years in fig 15 we visualize how many times each duration s curve was inconsistent with at least one other duration s curve this happened most frequently for moderate durations 45 120 min and rarely for low durations 15 minutes the quantile selection algorithm converged for all 20 locations with inconsistent return levels and on average only 6 15 iterations were needed to find a consistent set of curves furthermore the average number of curves crossing for a location was 2 7 while the maximum number of crossing curves was 5 out of 16 the quantiles chosen by the quantile selection algorithm are plotted in the histogram in fig 10 for cases where the posterior median was not selected and it turns out that only quantiles between the 43 quantile and the 56 quantile were chosen this shows that for real rainfall data often only small adjustments are needed to achieve consistent curve sets the two post processing methods isotonic regression and the quantile selection algorithm give quite similar results for the real data set they are also approximately equally fast performing the adjustments within a few seconds for each location however isotonic regression again tends to provide adjusted estimates closer to the initial posterior medians note that this does not imply that this method is better according to the results from simulation study 2 a comparison between the return levels estimated by d gev and the quantile selection algorithm for the real am data set is shown in fig 16 only return levels from the 20 stations that initially had inconsistent return levels are included we see that the two methods give quite different results for many locations a key difference is that d gev tends to produce smoother idf curves than the bayesian approach combined with the post processing methods discussed in this article particularly at locations for which the bayesian method initially produced inconsistent curves the post processing techniques tend to generate rougher curves than d gev one example can be seen in fig 16 where the idf curves for the location gvarv located in the southeast of norway are shown for durations shorter than 500 min it seems that the curves produced by the bayesian method and the quantile selection algorithm have a saddle point this tendency is connected to the fact that the bayesian method treats each duration independently giving a very flexible model while d gev assumes the smooth relationship in eq 6 as in simulation study 2 we observe that the bayesian estimation yields non constant shape parameter estimates here the estimates can vary between 0 1 and 0 28 across durations within a location in addition to the 83 stations discussed here we tested the post processing methods on norwegian am data from 6 additional locations with less than 10 years of am data available a sample size that is generally not considered appropriate for fitting a three parameter extreme value distribution indeed we found that the quantile selection algorithm did not converge for 5 of these locations with inspection revealing that the initial bayesian mcmc samples were poorly mixed for several of the durations giving extremely narrow posterior distributions as a result no valid solutions existed within the 1 99 posterior intervals for the return levels isotonic regression on the other hand always returns a solution however this example illustrates that the non convergence of the quantile selection algorithm can be used as a tool for flagging issues with the initial bayesian estimates 6 discussion and conclusions this paper proposes two post processing methods for adjusting posterior return levels for extreme precipitation estimated by bayesian inference in a manner that ensures consistent intensity duration frequency curves across durations the results show that both post processing methods a quantile selection algorithm and an isotonic regression approach are able to provide consistent curves that also increase the accuracy of the estimated return levels compared to retaining the unadjusted estimates both methods perform the adjustments within a few seconds for one location overall the proposed quantile selection algorithm provides slightly more accurate predicted return levels than isotonic regression hence searching for consistent return levels within the posterior 1 99 quantiles of a bayesian model is a promising strategy for constructing reliable and consistent return levels our results also indicate that a bayesian inference approach applied to each duration independently combined with a post processing method outperforms d gev a method that simultaneously estimates return levels for several durations and return periods in a manner that ensures consistency for obtaining consistent idf curves at observation stations in norway we thus suggest applying the bayesian method of lutz et al 2020 combined with the quantile selection algorithm in the future we plan to extend or replace the method in lutz et al 2020 such that a changing climate is taken into account through a non stationary model for example as in sarhadi and soulis 2017 the post processing methods presented in this paper have the major advantage of allowing to expand the initial bayesian model as needed while still using the post processing methods to ensure consistency the estimation of idf curves is generally associated with a high degree of uncertainty in particular for shorter time series an example of this was demonstrated in fig 4 that shows the 1 and 99 posterior quantiles for the return level estimates for two durations at a station with 13 available am observations despite the extensive uncertainty it is necessary to issue return level estimates given by a single number for each duration and return period as infrastructure planning and other decision making processes usually require deterministic rather than probabilistic values as inputs for this reason we have here focused on issuing and evaluating deterministic return value estimates a detailed discussion of the various sources of uncertainty and a comprehensive framework for assessing the reliability of uncertainty estimates is given in renard et al 2013 in the context of flood frequency analysis as the work in renard et al 2013 is based on fitting gev distributions to series of annual maxima this same framework equally applies in the current setting of idf curve estimation and provides a direction for further future work related to the assessment of the associated uncertainties the quantile selection algorithm in its current form is quite simple and could be extended in several ways for example the algorithm terminates the search as soon as it finds a consistent set of return levels an alternative solution would be to continue the search for several iterations after convergence in an attempt to find even more optimal solutions in its current form the algorithm requires the difference between two subsequent return levels to be greater or equal to 0 although this requirement is flexible it may result in idf curves that are non smooth smoother curves could be obtained by changing the consistency definition in 4 to require that z d i t j α d i z d k t l α d k δ for d i d k and t j t l instead where δ 0 denotes the minimum allowed distance between two return levels however this would limit the flexibility of the quantile selection algorithm and potentially result in a higher rate of non convergence it would also introduce the need to subjectively choose the bandwidth δ which probably should be modeled as a function of return level and or the return period above we connected d gev s poorer performance to its treatment of the shape parameter ξ d as constant over durations which contradicts the bayesian inference results both for simulation study 2 and the norwegian am data in a previous study veneziano et al 2007 found that ξ d peaks for durations around 1 3 h and decays for shorter and longer durations on the other hand in a study of radar measurements in the netherlands overeem et al 2009 found a less positive ξ d for 15 and 30 min than for longer durations for durations longer than 30 min the shape parameter seemed to be relatively constant but the uncertainty was very large according to koutsoyiannis 2004 and koutsoyiannis 2004 the shape parameter can also be difficult to identify for short data series the examples above demonstrate that there is no complete agreement regarding the shape parameter in the literature but what is evident from our study is that the flexibility of the chosen gev model has a large impact on the resulting idf curves for both actual and simulated precipitation data simulation study 2 also indicates a need for more flexible gev distributions in return level estimation while the parametric relationship from eq 6 used in d gev might be suitable for some target durations it is not necessarily suitable for modeling a larger range of target durations at once due to differences in the precipitation generating processes that cause long duration and short duration precipitation an advantage of the d gev approach is that return levels for out of sample durations i e for durations without am data can easily be obtained through the parametric formulas for the location and scale parameters in eq 6 our proposed approach on the other hand demands that each duration be linked to an am precipitation data set and that each duration be fitted with a single gev distribution alternatively we could use linear interpolation between the available return levels to estimate return levels for out of sample durations in this setting however the flexibility of the proposed approach can be a disadvantage as opposed to d gev that produces smoother curves d gev also offers extrapolation to return levels of durations that are longer or shorter than the ones for which we have data if it is of interest to estimate idf curves at out of sample locations spatial bayesian methods like that suggested by dyrrdal et al 2015 can be applied to obtain out of sample estimates independently for each duration of interest because of the independent spatial interpolations that ensue the rate of inconsistencies for such a procedure is expected to be higher than seen here for the observed am data the resulting estimates can then be post processed using the quantile selection algorithm or the isotonic regression in the same way as described here for the local method of lutz et al 2020 this two step approach can be expected to be considerably faster than extending the method in dyrrdal et al 2015 to model several durations at once under consistency constraints declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the research council of norway supported this work through grant nr 302457 climate adjusted design values for extreme precipitation and flooding climdesign the authors thank kolbjørn engeland and danielle barna for valuable discussions we also thank per ove kjensli and åse moen vidal met norway for the manual quality control of the pluviograph data the norwegian precipitation data are available at www seklima met no and https frost met no the r package fixidf with functionality to apply the quantile selection algorithm and the isotonic regression algorithm is available at https github com climdesign fixidf appendix a supplementary data supplementary data associated with this article can be found in the online version at https doi org 10 1016 j jhydrol 2021 127000 supplementary data the following are the supplementary data to this article supplementary data 1 
3903,boundary conditions of well screen are critical formodeling reactive transport around a partially penetrated well in a single well push pull swpp test previous swpp test models often assumed that water flux was uniformly distributed along the well screen of the partially penetrated well named the uniformly distributed flux boundary condition ufbc to investigate the influence of such an assumption on reactive transport in the swpp test we develop a new finite difference numerical model under a flow field with a finite hydraulic diffusivity in this study considering the wellbore storage the uniformly distributed head boundary condition uhbc is employed for both groundwater flow and reactive transport across the well screen the dispersion coefficients are in a tensor form depending on both horizontal and vertical flow components the results show that the ufbc model may cause non negligible errors when modeling reactive transport in the swpp test with a partially penetrated well such errors are obvious at the early stage of the extraction phase but become negligible at late stage of the extraction phase the uhbc solution for reactive transport is smaller than the ufbc solution at the middle of the well screen but greater than the ufbc solution at the top or bottom of the well screen using the swpp test to investigate the reactive transport in subsurface in addition to the breakthrough curves btcs the information of the flow field like well geometry information and the observed time drawdown data is necessary and could be used to calibrate the model field application demonstrates that the uhbc model performs better than the ufbc model when interpreting btcs of the swpp test in the extraction phase the findings of this study can help for better understanding of reactive transport in the swpp test keywords parameter estimation flow velocity wellbore storage radial dispersion 1 introduction the single well push pull swpp test has been widely used as an effective method to determine in situ aquifer flow and transport parameters such as porosity dispersivity reaction or sorption rates and regional groundwater flow velocity gelhar and collins 1971 hall et al 1991 istok et al 1997 schroth and istok 2006 schroth et al 2000 due to its easy implementation lower cost and high efficiency the swpp test only needs a single well through which a prepared solution tracer is injected into a targeted aquifer and then the mixed solution is extracted from the aquifer for analysis hebig et al 2015 phanikumar and mcguire 2010 a complete swpp test usually includes four phases of injection chasing resting and pumping or extraction in which the chasing and resting phases are sometimes omitted to estimate the reaction or sorption rates one may use multiple tracers like a reactive tracer simultaneously with a conservative tracer in a swpp test in the swpp test the parameters of concern are mainly estimated by best fitting the observed breakthrough curves btcs in the well during the extraction phase with analytical numerical models lai et al 2016 schroth et al 2000 becker and shapiro 2003 pointed out that the estimated parameters varied significantly by different models probably because the mathematical models used were highly simplified up to date there are a number of studies focused on developing approximated analytical or semi analytical solutions of the swpp test for instance gelhar and collins 1971 derived an approximate solution using the method of the boundary layer approximation assuming that the tracer transport behaved as a diffusion like fickian process namely the transport model could be governed by advection dispersion equation ade such an approximate solution has been subsequently used widely to estimate radial dispersivity and retardation factor schroth et al 2000 however such a solution assumes that the test well fully penetrates a homogeneous and isotropic aquifer and therefore it might cause great errors for the partially penetrated wells this is because the vertical flow components around the wellbore could be non negligible especially for thick aquifers jung and pruess 2012 presented an analytical solution of the swpp test of the fully penetrated well in a single fracture aquifer considering the matrix diffusion to overcome the shortcomings of the models with the fully penetrated well schroth and istok 2005 presented an approximate analytical solution of the swpp test under a spherical flow field which could be used to approximate reactive transport around a partially penetrated well specially it worked well for a very short well screen in respect to the aquifer thickness recently huang et al 2010 developed an analytical solution of the swpp test for a partially penetrated well considering both longitudinal and transverse dispersion effects but assuming that the vertical component of the flow velocity was negligible such an assumption is inevitable when deriving the solution analytically however it might introduce non negligible errors that affect the parameter estimation this is not only because the vertical flow could directly result in the vertical advection but it also can affect both radial and vertical dispersion processes in another word the dispersion coefficients should be expressed in a tensor rather than linearly change with the radial flow velocity only as claimed by some investigators huang et al 2010 meanwhile the assumption of a homogeneous and isotropic aquifer is also inevitable for developing the analytical solutions many recent studies demonstrated that the aquifer heterogeneity could result in the matrix diffusion which was an important transport mechanism especially at the late stage carrera et al 1998 haggerty et al 2001 klepikova et al 2016 another assumption used in the analytical solutions of swpp tests is that the flow field associated with the swpp test is usually highly simplified and some important processes are grossly overlooked for instance the flow field during the tracer injection or pumping phase is assumed to reach steady state instantaneously and any mixing process in the test wellbore is ignored the drawdown buildup or flow velocity is only controlled by the well discharge and is independent of the media elasticity in another word the hydraulic diffusivity which is the ratio of the radial hydraulic conductivity over the specific storage is assumed to be infinite or the media is incompressible this assumption is sometimes called the steady state flow assumption or infinite hydraulic diffusivity assumption in previous studies mathias 2010 wang et al 2017 which is not true for the case in the swpp test because the swpp test involves the change of well discharge at different times it will inevitably induce time dependent drawdown buildup or flow velocity different from the infinite hydraulic diffusivity assumption or an incompressible media case this study considers a finite hydraulic diffusivity or a compressible media case which is more suitable particularly at the beginning of each phase of the swpp test mathias 2010 investigated the influence of the infinite hydraulic diffusivity assumption for the injection phase and found that it could result in overestimation of the plume front vandenbohede et al 2009 and wang et al 2017 investigated the effect of the flow field on mass and heat transport in the swpp test using numerical methods and found that the infinite hydraulic diffusivity assumption could create non negligible errors in parameter estimations however above mentioned studies only involve fully penetrated wells and whether this assumption will influence the swpp test results for a partially penetrated well is still unclear in addition to the issues mentioned above wellbore storage is demonstrated to be another important factor influencing the flow field around wellbore at early pumping stage the reactrans model associated with the swpp test assumed that water was only extracted from the wellbore storage over a period of 0 t 1 where t 1 was an initial small lapse of time of pumpage t the simulated initial time of the swpp test was chosen to start at t 0 t 1 instead of t 0 where t 0 was the actual starting time of the test t and klepikova et al 2016 suggested that t 1 could be as small as 0 1 min or 0 01 min when the horizontal conductivity was larger than 20 0 m d such a treatment might work well when modeling groundwater flow field but not for the reactive transport in the swpp test this is because a certain amount of mass would move into the aquifer during the period of 0 t 1 which may affect the btcs in the extraction phase actually assumptions involved in the analytical solutions mentioned above could be removed in the numerical solutions carrera et al 1998 wang and zhan 2017a e g considering the infinite hydraulic diffusivity the dispersion coefficient tensor wellbore storage the heterogeneity of the aquifer and so on huang et al 2010 and langevin 2008 employed the moflow mt3dms package to replicate the reactive transport in the swpp test and the results showed that the discrepancy between the analytical solutions and numerical solutions were obvious the traditional well package in modflow contains an assumption when treating the wellbore i e the discharge of the well block is dependent on the transmissivity of that well block harbaugh et al 2000 specifically for a homogeneous aquifer such an assumption leads to a uniformly distributed flux along the well screen which is named a uniform flux boundary condition ufbc similarly vandenbohede et al 2009 employed reactrans to model the swpp test reactrans is a finite difference two dimensional axially symmetric groundwater flow and reactive transport model vandenbohede et al 2008 in which the boundary condition of the wellbore is also ufbc additionally sun 2016 and zhao et al 2016 respectively used feflow diersch 2014 and toughreact xu 2008 to replicate the swpp test using ufbc for wellbore however the fitness between observed and computed data is not well ufbc does not consider the permeability of the wellbore which is much greater than the permeability of the surrounding aquifer and many previous studies demonstrate that the uniform head boundary condition uhbc seems to be more reasonable than ufbc for the partially penetrated well since it assumes the permeability of the wellbore to be infinite wang and zhan 2017a b investigated the effect of two models ufbc and uhbc on the flow field and their results were similar to hantush 1964 i e the effect was obvious in the region near the screen but became negligible when r 0 25 b k r k z where r is radial distance l b is aquifer thickness l kr and kz are the radial and vertical hydraulic conductivities lt 1 respectively as the swpp test mainly concerns the aquifer properties near the testing well thus the influence of the wellbore boundary condition could be very important it seems that one can use a very large value to approximate the infinite permeability of the wellbore in numerical modeling neville and tonkin 2004 however wang et al 2018 pointed out that previous numerical models produced some errors in describing the mixing processes between the injected tracer and original tracer in the wellbore such as moflow mt3dms in summary it is not always possible or desirable to design a fully penetrated well which is particularly true for a thick aquifer even for a fully penetrated well the screen might be only set over a small portion of wellbore different from a fully penetrated well a partially penetrated well could create vertical flow gradients in the vicinity of the well however most of the previous models of the swpp test contain assumptions which could render results inaccurate regardless of analytical or numerical models specifically the conceptual model is simple for analytical solutions huang et al 2010 wang et al 2017 for instance the hydraulic diffusivity is not finite and the advection and the dispersion is one dimensional for partial penetrated well these assumptions could be released in the numerical solutions however the mixing processes between the injected tracer and original tracer in the wellbore could not be treated properly in the numerical models such as moflow mt3dms feflow and so on in this study first a new numerical model of the swpp test will be established under the flow field with a finite hydraulic diffusivity considering a partially penetrated well and the wellbore storage two types of boundary conditions will be considered for the well screen ufbc and uhbc meanwhile four phases will be considered in the swpp test injection of a prepared solution injection of a chaser resting phase and extraction of the mixed solution then sensitivity analysis is conducted to test the influence of physical parameters on the reactive transport in the swpp test finally the experimental data of the swpp test by tong et al 2016 is employed to test the new model of this study the new model of this study is an extension of previous models of the swpp test since both heat transport and mass transport in the subsurface could be described by ade in similar forms the solutions could be extended to heat transport in the swpp test as well 2 problem statement of the swpp test similar to wang et al 2017 fig 1 shows the schematic diagram of the conceptual model of swpp test a cylindrical coordinate system is adopted in which the r axis is horizontal from the well and the z axis is vertically upward the origin of the system is at the center of the well and located at bottom of the aquifer the detailed information of the mathematical model of swpp test is shown in section s1 of supplementary materials assuming that advection dispersion and sorption are involved in the transport processes the governing equation of reactive transport in the swpp test is chen et al 2010 cosler 2004 1 r c t 1 r r r d rr c r r d rz c z z d zr c r d zz c z v r c r v z c z κ r c r r w where c is resident concentration of the aquifer ml 3 d rr d rz d zr and d zz are the four components of the dispersion coefficient tensor l2t 1 respectively t is time t z is the vertical distance l v r u r θ and v z u z θ are average pore velocity components lt 1 in the r and z axes respectively u r and u z are radial and vertical darcian velocity components lt 1 respectively θ represents porosity dimensionless r w is the well radius l κ is a constant rate for the first order biodegradation or radioactive decay or the first order reaction rate in the aquifer t 1 r 1 ρ b k d θ is known as the retardation factor of the aquifer dimensionless k d is the equilibrium distribution coefficient l3m 1 ρ b is the bulk density of the aquifer material ml 3 the governing equation of eq 1 describes the traditional fickian based ade model which works well in reproducing the swpp test when the observed btcs do not show considerable tailing effects dejam et al 2014 dejam 2019 one may need to use a different governing equation such as a fractional ade or fade to describe the late time btcs when the observed btcs show considerable tailing as has been done by chen et al 2017 the research on other non fickian transport processes associated with the swpp tests such as the rate limited mass transfer in dual porosity or dual permeability systems will be explored in near future in this study the velocity is calculated by darcy s law 2 u r k r s r 3 u z k z s z where s is drawdown l which could be obtained by solving the following mass balance equation with proper initial and boundary conditions 4 u r r u r r u z z s s s r z t t r r w where s s is the specific storage of the aquifer l 1 one interesting point to note is that considering an infinite hydraulic diffusivity and a ufbc condition for the test well huang et al 2010 proposed the following equation for a partially penetrated well 5 v r r r w q 2 π r w b θ where q q inj 0 t t inj q cha t inj t t inj t cha 0 t inj t cha t t inj t cha t res q ext t inj t cha t res t t inj t cha t res t ext q inj q cha and q ext are the flow rates of the well l3t 1 in the injection chasing and extraction phases respectively q inj and q cha are positive while q ext is negative after a careful consideration one could find that eq 5 may result in errors from two aspects firstly v r varies with time in the flow field with a finite hydraulic diffusivity especially right after a discharge change of the well such as at beginning of injection or extraction phase secondly eq 5 underestimates the flow velocity at the well screen for the ufbc model and the errors become greater with decreasing well screen length many studies showed that eq 5 only works in the aquifer when r 0 25 b k r k z hantush 1964 at the well screen it should be equal to dejam et al 2013 6 v r r r w q 2 π r w z top z bot θ in the regions from r w to 0 25 b k r k z the vertical component of the flow velocity ignored by eq 5 in huang et al 2010 may also affect the accuracy of the results the uhbc type of wellbore is represented as 7 2 π r b z bot z top u r z d z r r w π r w 2 d s w t dt q z bot z z top 8 s r r w z i s r r w z j where s w is the drawdown inside the wellbore l i and j are positive integers started from 1 hereinafter z i and z j z bot z top z bot and z top represent the vertical coordinates of the top and bottom of the well screen l respectively as for the ufbc type of wellbore the flux at the screen may be influenced by the aquifer properties in a homogeneous and isotropic aquifer u r is independent on the vertical location and uhbc reduces to ufbc 9 lim r r w 2 π r z top z bot u r π r w 2 d s w t dt q z bot z z top 10 u r z i r r w u r z j r r w z b o t z z t o p as for a well penetrating a heterogeneous aquifer which is sometimes named a multi aquifer well harbaugh et al 2000 neville and tonkin 2004 the distribution of u r is not uniform along the screen and it may be dependent on the transmissivity of the well blocks well blocks refer to the cells of grid system containing the well in the numerical simulation assuming the hydraulic properties of each cell being homogeneous and isotropic one has 11 k r δ z j δ z j u r δ z i r r w k r δ z i δ z i u r δ z j r r w where δ z i z i 1 2 z i 1 2 δ z j z j 1 2 z j 1 2 δ z i represents the vertical dimension of the well block i with the top elevation z z i 1 2 and bottom elevation z z i 1 2 and δ z j is defined similarly k r δ z i and k r δ z j represent the hydraulic conductivities of the well blocks i and j respectively k r δ z i δ z i and k r δ z j δ z j represent the transmissivities of the well blocks i and j respectively u r δ z i r r w and u r δ z j r r w respectively represent the radial darcian flow velocities of the well blocks i and j at the well screen eq 11 is similar to treatment in conventional well package of modflow harbaugh et al 2000 neville and tonkin 2004 and it assumes no storativity in the well blocks well block is shown in fig 1 of wang et al 2017 the model of eqs 1 11 is an extension of huang et al 2010 by considering the actual flow field of a partially penetrated well another difference between this study and huang et al 2010 is that this study considers the dispersion tensor which depends on both the radial and vertical flow velocities while huang et al 2010 assumed that the radial and vertical dispersion coefficients were only proportional to the radial flow velocity which is inadequate from eqs 1 11 one may find that the mathematical model of the swpp test is axisymmetric and the regional flow is not considered whether or not to include the influence of regional flow depends of the purpose of the swpp test for instance if the purpose of test is to determine the dispersivity which is the focus of this study the swpp test is usually conducted within a short period of time several hours to 1 day with the injecting and or pumping dominating the flow field near the well in such a scenario the background regional flow is usually negligible given the generally mild hydraulic gradient of regional flow in most shallow aquifers usually less than 0 005 such as those in jianghan plain of china as reported by tong et al 2016 and zhao et al 2016 however if the purpose of the swpp test is to determine the regional flow velocity then the swpp test must include at least three phases of injection resting and pumping specifically the resting phase allows the injected tracer to ride with the regional groundwater flow thus is a key phase to include for this type of test the swpp test time is usually much longer than the swpp test time required for determining the dispersivity because it takes a long time for the tracer to migrate with the regional groundwater flow to a considerable distance from the point of injection nevertheless the regional flow is not included for the purpose of this study and axisymmetric flow is presented from a numerical perspective langevin 2008 pointed out that the numerical solutions of the axisymmetric model could be 1000 times faster than the numerical solutions of the equivalent three dimensional 3d models 3 solutions of the swpp test 3 1 numerical solutions in this study we employ a finite difference method to solve the models of groundwater flow and reactive transport in the swpp test and use a stiff integrator ode15s which is available in the standard version of matlab to facilitate the computation ode15sis a variable step and variable order solver for the ordinary differential equation based on the numerical differentiation formulas of orders 1 to 5 it employs the gear s method the backward differentiation formulas to solve the stiff problems which arenumerically unstable one effective approach is to take small steps to obtain satisfactory results for the numerical solution as for the numerical solution of ade it commonly suffers from some numerical errors like artificial oscillation and numerical dispersion which are non negligible for advection dominating transport ode15s which could automatically adjust the dimension of the steps is a good choice for numerical simulation of the swpp test meanwhile many studies demonstrate that ode15s performs well for problems of groundwater flow and reactive transport around injection extraction wells mathias and wen 2015 wang and zhan 2017a as mentioned above the finite difference solution of the ade model generally suffers from the numerical errors such as numerical dispersion and artificially oscillation and the numerical dispersion is related to the grid peclet number 12 p e u r δ r d rr where p e is the grid peclet number many studies demonstrated that the numerical dispersion was negligible when p e 2 syriopoulou and koussis 1991 thomson et al 1984 in the following section the values of p e is smaller than 2 for the numerical solution of this study to minimize errors of the numerical solution and to reduce the computational cost simulations will be conducted with a non uniform grid system similar to mathias and wen 2015 the spatial steps are smaller near the wellbore and become progressively greater away from the wellbore in the r axis direction 3 2 verification of the solutions to check the accuracy of the numerical solution the exact analytical solution of huang et al 2010 will serve as the benchmark however the model of huang et al 2010 contains some assumptions which have been mentioned in the introduction under the flow field with an infinite hydraulic diffusivity ignoring the vertical flow c 0 inj is constant and without the chasing and resting phases to satisfy these assumptions only two phases injection and extraction are considered the well fully penetrates the aquifer and the flow field is assumed to be with an infinite hydraulic diffusivity for the numerical solution fig 2 shows figs 3 and 4 comparison between solutions of huang et al 2010 and this study for a fully penetrated well and the parameters used are as follows b 6 m rw 0 1 m zbot 0 m ztop 6 m θ 0 3 m tinj 0 5 day t cha 0 day t res 0 day d m 0 m2 day qinj 24 m3 day and qext 24 m3 day where qinj and qext denote the rates of injection and extraction of the well respectively t cha 0 and t res 0 represents the swpp test only considering the injection and extraction phases two sets of α l are chosen as 0 1 m and 0 3 m and α t is assumed to be 1 10 of α l for the sake of simplicity obviously the numerical solution of the swpp test is accurate and reliable for this special case as evident from fig 2 3 3 comparison with modflow mt3dms up to date there are many numerical codes that are capable of simulating the transport process occurring around the well such as sutra voss 1984 feflow diersch 2014 modflow mt3dms harbaugh et al 2000 zheng and wang 1999 toughreact xu 2008 and so on modflow is used to simulate the groundwater flow in the aquifer and mt3dms is developed to simulate reactive transport in the aquifer in which the flow terms are calculated by modflow modflow mt3dms is an open source model distributed by united states geological survey and it has been widely employed to solve the problems related to 3d transient groundwater flow and reactive transport including the axisymmetric flow and transport associated with this study however there are at least four aspects limiting the accuracy of the numerical solutions of modflow mt3dms if it is directly employed for the problem of concern here firstly the cell of the grid system in modflow mt3dms is cuboid or cube which is a poor approximation of the cylinder shape of the wellbore used in the swpp test secondly an asymmetrically non uniform grid mesh is necessary to simulate the flow and transport problem near a swpp test well but is difficult to setup in modflow mt3dms as the numerical errors are closely related to the non uniform grid resolution near the test well the poor configuration of grid mesh near the well will be a major numerical concern the third aspect is the treatment of the boundary condition of the wellbore as mentioned above the uhbc model may be more reasonable than ufbc in treating the flow and reactive transport in the wellbore modflow contains a package for uhbc namely the multi node well mnw package when the dimension of the well blocks is equal to the well diameter the mnw approach reduces to the high kv in the well block hkwb approach where the hkwb approach assumes that the hydraulic conductivity of the well block is so high to approach infinity the problem is that the mnw approach only works when the dimension of the well block is greater the well diameter which could substantially increase the numerical errors of the solution for the reactive transport as for the hkwb approach great discrepancy of the conductivities between the well blocks and the surrounding cells of the aquifer might cause convergent issues for the numerical solutions the four aspect is that modflow mt3dms assumes that the volume of water in the wellbore is dependent on the aquifer thickness not on the water level in the wellbore wang et al 2018 such assumption could result in errors when describing the mixing effect in the wellbore langevin 2008 compared analytical solutions of the swpp test by schroth and istok 2005 with modflow mt3dms in which the well was assumed to be a point source sink and the flow field was spherical the results showed that the discrepancy between them was also obvious as shown in fig 8 of schroth and istok 2005 as for actual applications the point source sink well is far less common as the fully or partially penetrated well therefore the performance of modflow mt3dms for a fully or partially penetrated swpp test well cannot be evaluated using the point source sink well of langevin 2008 and will be investigated in this section to serve this purpose gms 7 0 will be employed for the calculation and the hkwb approach will be employed to produce the uhbc solution of the swpp test where version 2005 of modflow and mt3dms are included in gms 7 0 to resolve the numerical dispersion and numerical oscillation issues mt3dms contains five techniques for the advection term of ade zheng and wang 1999 such as the third order tvd scheme ultimate standard finite difference method sfdm the particle tracking based method of characteristics moc and its variants modified method of characteristics mmoc and hybrid moc mmoc hmoc zheng et al 2012 pointed out that no single numerical technique was effective for all transport conditions and each technique had its own strengths and limitations for instance moc is most effective in eliminating the errors of the numerical dispersion while it may lead to great mass discrepancy sfdm is mass conservative but is vulnerable to the errors of the numerical dispersion when the advective effect is dominating in the comparison between the analytical solutions and modflow mt3dms by langevin 2008 the numerical solutions are obtained based on sfdm which has obvious discrepancy with analytical solutions in this study the performance of the other numerical approaches will be tested for the swpp test to decrease the computational time and increase the accuracy of the numerical solution a non uniform grid system will be employed for the discretization of the horizontal layer but a uniform grid system remains for the vertical discretization due to many difficulties in setting up non uniform vertical grid system in gms 7 0 the detailed information of the grid system can be seen in s2 of supplementary materials to test the numerical solutions of modflow mt3dms the physical parameters of b rw θ tinj t cha t res and d m in this section are similar with ones used in fig 2 which is to check the accuracy of the numerical solution of this study k r k z 0 1 m day ss 0 0001 m 1 to exclude that influence of mixing effect on the results by modflow mt3dms c 0 inj is computed in priori by the model of wang and zhan 2019 show the results of a fully penetrated well and a partially penetrated test well respectively zbot 0 m and ztop 6 m are for the fully penetrated well and zbot 1 5 m and ztop 4 5 m are for the partially penetrated well fig 3a shows the comparison of the drawdowns by this study and modflow for different flow rates fig 4a shows the comparison of the drawdowns by this study and modflow for different vertical locations in the wellbore since the hkwb approach is used to treat the wellbore the drawdowns are the same at different vertical locations in the wellbore the agreements between the analytical and numerical drawdowns are satisfactory for both fully penetrated and partially penetrated wells using the swpp test to investigate the reactive transport the physical and chemical information is mainly included in btcs in the extraction phase and fig 3b and 4b show the btcs by this study and modflow mt3dms in the extraction phase one may find that the methods of sfdm and mmoc perform worse than the methods of ultimate and hmoc for both fully penetrated and partially penetrated wells ultimate and hmoc work better for the fully penetrated well than for the partially penetrated well the discrepancy between the solutions of this study and the ultimate and hmoc approaches is obvious for the partially penetrated well the hmoc solution oscillates with time in summary the comparison between the numerical and the analytical solutions demonstrates the accuracy of this study comparing the solutions of this study with modflow mt3dms one may conclude that the ultimate and hmoc approaches are recommended for modeling the reactive transport in the swpp test 4 discussion and results 4 1 effect of boundary condition of wellbore on the swpp test due to much higher permeability of the wellbore than the aquifer permeability uhbc is more reasonable than ufbc since ufbc does not consider the discrepancy of the permeability between the wellbore and aquifer and assumes that the water flux is uniformly distributed along the well screen as demonstrated in previous studies the flow direction is not horizontal especially in the vicinity of the partially penetrated well the flux at the well screen not only changes with locations but also with time wang and zhan 2017a b in this section we mainly investigate the influence of the boundary conditions of the well screen on the reactive transport in the swpp test figs 5 7 represent the comparison between the ufbc and uhbc solutions fig 5a and 5b represent the spatial distributions of the concentration along the screen at early and late extraction stages respectively the legends in fig 5a are the same as those in fig 5b for the purpose of comparison we employ a dimensionless vertical coordinate of the well zw 13 z w z z bot z top z bot z bot z z top therefore the dimensionless vertical coordinate of the well screen is in the range of 0 1 as shown in fig 5a and 5b three sets of the screen length are chosen 1 6b 3 6b and 5 6b the other parameters used are as follows b 6 m rw 0 1 m k r k z 0 1 m day ss 0 0001 m 1 α l 0 1 m α t 0 01 m θ 0 1 m tinj 0 1 day text 10 day t cha 0 day t res 0 day qinj 10 m3 day and qext 10 m3 day the values of these parameters are from the reference of wang and zhan 2019 fig 6 shows btcs at different locations of the wellbore for the case of zbot 1 5 m ztop 4 5 m in fig 5 in which zmid zbot ztop 2 represents the screen center by comparing fig 5a 5b and fig 6 two interesting observations can be made firstly the difference between the ufbc and uhbc btcs is obvious at early extraction stage and becomes negligible with time going regardless of the screen length this observation could be explained by the flow fields produced by ufbc and uhbc models as the flow velocity is a key parameter controlling advection and dispersion of solute in subsurface hantush 1964 pointed out that the influence of the boundary condition of partially penetrating well on flow field was mainly around the wellbore meanwhile with time going the solute concentration becomes smaller and might be no detectable when c c 0 inj 1 0 10 3 therefore the difference between ufbc and uhbc btcs becomes negligible and the influence on the swpp test could be ignored secondly the values of the uhbc solution are smaller than the values of the ufbc solution at the well center but larger at the well ends in another word the ufbc solution overestimates the concentration at the well center but underestimates it at the well ends fig 7a and 7b show the contour maps of the ufbc and uhbc concentrations in the aquifer where the dash line represents the uhbc solution and the solid line represents the ufbc solution the parameters used in these two figures are the same as in fig 6 one could see that the difference between the ufbc and uhbc solutions is obvious in the region near the well ends or around z zmid far from the wellbore the contour lines of the concentration are similar to the flow velocity lines namely the contour lines of ufbc are parallel with the screen in the region near the screen due to the uniform flux distribution as for the uhbc contour lines the velocity is larger in the region near the well ends and that is why the ufbc contour map is different from the uhbc contour map 4 2 effect of flow field on the swpp test as demonstrated in the mathematical model of the swpp test discussed in section 2 the flow velocity is a primary driving force for reactive transport in the porous media and it is not only included in the advection terms but also in the dispersion terms however many previous studies assumed that flow field was with an infinite hydraulic diffusivity resulting in that the flow velocity was time independent which was not true for the swpp test for instance the hydraulic diffusivity is 1 0 103 m2 day for the fine sand aquifer when kr kz 1 0 10 1 m day and ss 1 0 10 4 m 1 is 1 0 104 m2 day for the medium sand aquifer when kr kz 1 0 m day and ss 1 0 10 4 m 1 and is 1 0 106 m2 day for the coarse sand aquifer when kr kz 10 0 m day and ss 1 0 10 5 m 1 the parameters used in this study are from domenico and schwartz 1990 and batu 1998 obviously the values of hydraulic diffusivity are not infinite for all kind of aquifers and it is greater for the coarse sand aquifer than for the fine sand aquifer the other parameters are b 6 m rw 0 1 m α l 0 1 m α t 0 01 m θ 0 1 m zbot 1 5 m ztop 4 5 m tinj 0 1 day tchs 0 1 day and tres 0 1 day text 10 day qinj 10 m3 day qchs 10 m3 day qres 0 m3 day and qext 10 m3 day where qchs and qres respectively represent the discharges of the well in the chasing and resting phases the boundary condition of well screen is uhbc fig 8 shows the flow velocity variations with time at different locations of the wellbore where ufbc eq 10 represents the ufbc model with an infinite hydraulic diffusivity while the others represent the uhbc model with a finite hydraulic diffusivity obviously the curve of ufbc eq 10 is different from the curves of the uhbc model interestingly the velocity of ufbc eq 10 is between the velocities at the top screen z ztop and the middle screen z zmid during the injection and extraction phases this is because the groundwater flux is not uniform over the entire screen for the uhbc model instead it varies with location and is larger near the well ends due to the greater influence volume there in contrast ufbc eq 10 assumes that the well discharge is uniformly distributed along the screen another interesting observation is that a greater hydraulic diffusivity will lead to a shorter transient duration for the velocity approaching its quasi steady state by checking the hydraulic parameters of the clay rich and gravel rich aquifers one could find that the hydraulic diffusivity value is smaller for the clay rich aquifer while larger for the gravel rich aquifer therefore one may conclude that the assumption of an infinite hydraulic diffusivity could approximate the actual cases better for the coarse sand aquifer or the gravel aquifer but not for the fine sand aquifer or the clay rich aquifer fig 9 shows btcs at the extraction phase corresponding fig 8 the difference of btcs between different types of aquifers is obvious the peak value of btcs is the greatest for the coarse sand aquifer and is the smallest for the fine sand aquifer such a difference becomes less dramatic at the late stage of the extraction phase the arrival time for the peak values is also different for different porous media this is because the flow model assumes a finite hydraulic diffusivity thus it always requires some finite time to propagate the well discharge change to the advective front and a greater hydraulic diffusivity value will require a shorter propagation time such an observation implies that the assumption of an infinite hydraulic diffusivity may work at the late stage of the extraction phase but not at the early stage of the extraction phase 4 3 effect of wellbore storage on the swpp test wellbore storage happens immediately after a discharge change of the well and its effect depends on the volume of the wellbore with a larger well radius leads to a greater wellbore storage effect the swpp test contains four different phases and the flow rate change rapidly at the start of each phase therefore wellbore storage effect becomes an obvious concern when studying reactive transport in the swpp test fig 10 shows btcs for different well radii representing various degrees of wellbore storage and the parameters used in fig 10 are the same as in figs 8 and 9 except for the well radius one could see that the influence of the wellbore storage is obviously non negligible for the swpp test and a smaller radius results in a smaller peak concentration this is because the smaller well radius means smaller volume of the wellbore and the solute concentration entering aquifer from the wellbore needs longer time the values of btcs increase with the deceasing well radius at the early stage of the extraction phase while decrease with the deceasing well radius at the late stage of the extraction phase 4 4 sensitivity analysis to test the influence of physical parameters on the reactive transport in the swpp test the technique of sensitivity analysis will be employed kabala 2001 yang and yeh 2009 14 s c i j i j o i i j δ i j o i i j δ i j where s c i j is the sensitivity coefficient o i is the output function of the model δ i j is a small increment i is the i th time for o i j is the j th parameter of the model in this study o i is the dimensionless concentration c d by analyzing the dimension of s c i j one could understand how sensitive of the parameters is to the results and the greater absolute values of s c i j imply greater influence the analyzed parameters include hydraulic diffusivity dispersion coefficient anisotropy screen length and well radius the base values of parameters used in the sensitivity analysis are kr kz 1 0 10 1 m day and ss 1 0 10 4 m 1 b 6 m rw 0 1 m θ 0 3 m α l α t 0 1 m tinj 0 5 day t cha 0 day t res 0 day d m 0 m2 day qinj 10 m3 day qext 10 m3 day zbot 1 5 m and ztop 4 5 m fig 11 shows the sensitivity of the hydraulic diffusivity dispersion coefficient anisotropy screen length and well radius on the btcs in the well one may find that the influence is greatest and positive for the hydraulic diffusivity while is the smallest for the dispersion coefficient anisotropy the influence is negative for the well radius 4 5 discussions many previous studies on the mathematical model of the swpp test were based on some over simplified assumptions which have been released in the model of this study for instance the hydraulic diffusivity is finite the advection is two dimensional the dispersion coefficients are expressed in a tensor and the mixing processes between the injected tracer and original tracer in the wellbore are considered in the new models of this study results in sections 4 1 4 4 indicate that a smaller peak value of btcs could be caused by boundary conditions as shown in fig 6 by a larger hydraulic diffusivity as shown in fig 9 or by a smaller well radius as shown in fig 10 therefore if the parameter estimation is done solely based the information of btcs non uniqueness of parameter values is inevitable to overcome this issue it is necessary to gather the information of the flow field such as the well geometry information and the observed time drawdown data besides the information of btcs the observed time drawdown data are used to calibrate the model of groundwater flow and then to determine the hydraulic diffusivity of the aquifer well geometry information could be used to determine the wellbore storage however some limitations are still included in the new models of this study for instance the new model of this study is used to simulate the conservative tracer transport in the swpp test it will be extended for the multi spices transport model in near future meanwhile the mechanism of reactive transport is complex in subsurface and it could be affected by the water temperature variation water saturation soilmicrobes and so on these factors have not been considered in the new model of this study 5 field application to test the field applicability of this study data of a field swpp test in a confined aquifer conducted by tong et al 2016 will be employed in this swpp test the well partially penetrates the aquifer with a radius of 0 033 m where the aquifer is composed of fine medium and coarse sands the total length of the well is 37 4 m and the screen length is 2 4 m from 20 6 m to 23 0 m the swpp test contains four phases tinj 9 0 min qinj 40 l min c 0 inj 100 mg l tcha 1 0 min qcha 30 l min c 0 cha 0 mg l tres 12 h and text 13 h as for qext it ranges from 0 72 l min to 0 90 l min and is set as 0 85 l min as done by tong et al 2016 and zhao et al 2016 the initial water level is 2 m below the ground surface the detailed information of the swpp test can be seen in tong et al 2016 and zhao et al 2016 to understand the behavior of the tracer movement in the swpp test reported by tong et al 2016 sun 2016 used feflow diersch 2014 to establish a numerical model based on ufbc assuming the aquifer to be homogeneous with kr 3 m day kz 0 3 m day θ 0 3 d m 1 10 9 m2 s α r 5 m and α z 0 5 m as a result sun 2016 found that it was difficult to interpret the in situ data using a homogeneous aquifer model zhao et al 2016 employed toughreact eos9 to rebuild a numerical model of the swpp test for a heterogeneous aquifer and presented a response on such comments by sun 2016 the toughreact eos9 model is based on ufbc due to the heterogeneity of the aquifer the aquifer was vertically and spatially discretized into 7 layers in the numerical model of zhao et al 2016 and each layer itself was assume to be homogeneous the first and seventh layers are clay with very small permeability which were aquitard the regional flow was assumed to be uniform with a hydraulic gradient of 0 0005 while it was 0 001 in sun 2016 the fitness of btcs by zhao et al 2016 was far better than that by sun 2016 however there are still three points that seem questionable firstly the simulated concentration was greater than the observed one for the first sample in the extraction phase as shown in fig 1 of zhao et al 2016 or fig 12 of this study sun 2016 raised a similar question in his comments secondly fig 1 of zhao et al 2016 or fig 12 of this study showed that the computed btcs by toughreact eos9 in the well increased with time in the resting phase which implied that the tracer was transported back into the well from the aquifer this is probably due to the influence of the regional gradient or numerical errors thirdly the peak values of the observed btcs are greater than their counterparts of the computed btcs in this section we aim to use the uhbc model of this study to replicate the swpp test of tong et al 2016 however the information of the flow field was very limited for instance the observed time drawdown data were not available the observed btc data is listed in table s1 of supplementary material s to increase the accuracy of the results the aquifer is vertically discretized into 36 layers and the well screen is discretized into 18 layers in the numerical solution of this study based on other parameters used in zhao et al 2016 we find that the parameters of d m 1 10 9 m2 s α r 0 1 m and α z 0 05 m could fit the observed btcs after a trial and error process as shown in fig 12 to further test the accuracy of the new numerical solution the error analysis has been conducted in this section the errors between observed and computed btcs could be computed by 27 e r r o r i 1 n y i obs y i est 2 i 1 n y i obs y mean 2 where y i obs is the i th observed value y i est is the i th estimated value y mean is the mean of the observation data and n is the total number of observations the errors for best fitting the observed data are 0 3061 for this study 0 4259 for the model of zhao et al 2016 the results demonstrate that the model of this study performs better than the previous studies when interpreting the field data of the swpp test of tong et al 2016 the reason for better fitness of this study than zhao et al 2016 is probably due to a few issues associated with zhao et al 2016 including inadequate flow field description discrepancy of the gird cells of toughreact eos9 and the wellbore lower grid resolution resulting in the numerical errors and the inadequate treatment of the boundary conditions of the wellbore 6 summary and conclusions when quantifying the in site parameters associated with solute or heat transport like dispersivity porosity and biogeochemical reaction rates the swpp test is preferred due to its easy implementation lower cost and high efficiency the accuracy of estimated parameters not only depends on the operation of the test but also on the accuracy of the models however previous studies on the swpp test using a partially penetrated well assumed that the boundary condition of the well screen was ufbc instead of uhbc which could lead to substantial errors in this study we developed a uhbc model of the swpp test using finite difference method with an injection phase a chasing phase a resting phase and an extraction phase the in situ field data of tong et al 2016 were used to test the model of this study the following conclusions can be drawn 1 the influence of ufbc and uhbc for describing the well discharge over the well screen is obvious at the early stage of the extraction phase but becomes negligible at late stage of the extraction phase the uhbc solution is smaller than the ufbc solution at the middle of the well screen but greater than the ufbc solution at the top or bottom of the well screen 2 hydraulic diffusivity has great influence on the reactive transport in the swpp test and the assumption of a time independent flow velocity or an infinite hydraulic diffusivity may cause non negligible errors 3 using the swpp test to determine the in situ aquifer characteristics of geological formations the information of the flow field like well geometry information and the observed time drawdown data should be collected during the test which could help resolve the non uniqueness of parameter estimation and improve the accuracy of the results 4 the sensitivity analysis shows that the result of this study is most sensitive to the hydraulic diffusivity and least sensitive to the dispersion coefficient anisotropy 5 the uhbc model of this study performs better than the previous studies when interpreting the field data of the swpp test of tong et al 2016 credit authorship contribution statement yu chen conceptualization data curation quanrong wang conceptualization methodology supervision writing original draft writing review amp editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was partially supported by programs of natural science foundation of china no 41772252 no 41972250 and no 41502229 innovative research groups of the national nature science foundation of china no 41521001 the 111 program state administration of foreign experts affairs the ministry of education of china no b18049 the fundamental research funds for the central universities china university of geosciences wuhan no cuggc07 and the belt and road special foundation of the state key laboratory of hydrology water resources and hydraulic engineering no 2020492011 we thank the editor associate editor and anonymous reviewers for their constructive comments which help improve the quality of the paper appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 127035 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
3903,boundary conditions of well screen are critical formodeling reactive transport around a partially penetrated well in a single well push pull swpp test previous swpp test models often assumed that water flux was uniformly distributed along the well screen of the partially penetrated well named the uniformly distributed flux boundary condition ufbc to investigate the influence of such an assumption on reactive transport in the swpp test we develop a new finite difference numerical model under a flow field with a finite hydraulic diffusivity in this study considering the wellbore storage the uniformly distributed head boundary condition uhbc is employed for both groundwater flow and reactive transport across the well screen the dispersion coefficients are in a tensor form depending on both horizontal and vertical flow components the results show that the ufbc model may cause non negligible errors when modeling reactive transport in the swpp test with a partially penetrated well such errors are obvious at the early stage of the extraction phase but become negligible at late stage of the extraction phase the uhbc solution for reactive transport is smaller than the ufbc solution at the middle of the well screen but greater than the ufbc solution at the top or bottom of the well screen using the swpp test to investigate the reactive transport in subsurface in addition to the breakthrough curves btcs the information of the flow field like well geometry information and the observed time drawdown data is necessary and could be used to calibrate the model field application demonstrates that the uhbc model performs better than the ufbc model when interpreting btcs of the swpp test in the extraction phase the findings of this study can help for better understanding of reactive transport in the swpp test keywords parameter estimation flow velocity wellbore storage radial dispersion 1 introduction the single well push pull swpp test has been widely used as an effective method to determine in situ aquifer flow and transport parameters such as porosity dispersivity reaction or sorption rates and regional groundwater flow velocity gelhar and collins 1971 hall et al 1991 istok et al 1997 schroth and istok 2006 schroth et al 2000 due to its easy implementation lower cost and high efficiency the swpp test only needs a single well through which a prepared solution tracer is injected into a targeted aquifer and then the mixed solution is extracted from the aquifer for analysis hebig et al 2015 phanikumar and mcguire 2010 a complete swpp test usually includes four phases of injection chasing resting and pumping or extraction in which the chasing and resting phases are sometimes omitted to estimate the reaction or sorption rates one may use multiple tracers like a reactive tracer simultaneously with a conservative tracer in a swpp test in the swpp test the parameters of concern are mainly estimated by best fitting the observed breakthrough curves btcs in the well during the extraction phase with analytical numerical models lai et al 2016 schroth et al 2000 becker and shapiro 2003 pointed out that the estimated parameters varied significantly by different models probably because the mathematical models used were highly simplified up to date there are a number of studies focused on developing approximated analytical or semi analytical solutions of the swpp test for instance gelhar and collins 1971 derived an approximate solution using the method of the boundary layer approximation assuming that the tracer transport behaved as a diffusion like fickian process namely the transport model could be governed by advection dispersion equation ade such an approximate solution has been subsequently used widely to estimate radial dispersivity and retardation factor schroth et al 2000 however such a solution assumes that the test well fully penetrates a homogeneous and isotropic aquifer and therefore it might cause great errors for the partially penetrated wells this is because the vertical flow components around the wellbore could be non negligible especially for thick aquifers jung and pruess 2012 presented an analytical solution of the swpp test of the fully penetrated well in a single fracture aquifer considering the matrix diffusion to overcome the shortcomings of the models with the fully penetrated well schroth and istok 2005 presented an approximate analytical solution of the swpp test under a spherical flow field which could be used to approximate reactive transport around a partially penetrated well specially it worked well for a very short well screen in respect to the aquifer thickness recently huang et al 2010 developed an analytical solution of the swpp test for a partially penetrated well considering both longitudinal and transverse dispersion effects but assuming that the vertical component of the flow velocity was negligible such an assumption is inevitable when deriving the solution analytically however it might introduce non negligible errors that affect the parameter estimation this is not only because the vertical flow could directly result in the vertical advection but it also can affect both radial and vertical dispersion processes in another word the dispersion coefficients should be expressed in a tensor rather than linearly change with the radial flow velocity only as claimed by some investigators huang et al 2010 meanwhile the assumption of a homogeneous and isotropic aquifer is also inevitable for developing the analytical solutions many recent studies demonstrated that the aquifer heterogeneity could result in the matrix diffusion which was an important transport mechanism especially at the late stage carrera et al 1998 haggerty et al 2001 klepikova et al 2016 another assumption used in the analytical solutions of swpp tests is that the flow field associated with the swpp test is usually highly simplified and some important processes are grossly overlooked for instance the flow field during the tracer injection or pumping phase is assumed to reach steady state instantaneously and any mixing process in the test wellbore is ignored the drawdown buildup or flow velocity is only controlled by the well discharge and is independent of the media elasticity in another word the hydraulic diffusivity which is the ratio of the radial hydraulic conductivity over the specific storage is assumed to be infinite or the media is incompressible this assumption is sometimes called the steady state flow assumption or infinite hydraulic diffusivity assumption in previous studies mathias 2010 wang et al 2017 which is not true for the case in the swpp test because the swpp test involves the change of well discharge at different times it will inevitably induce time dependent drawdown buildup or flow velocity different from the infinite hydraulic diffusivity assumption or an incompressible media case this study considers a finite hydraulic diffusivity or a compressible media case which is more suitable particularly at the beginning of each phase of the swpp test mathias 2010 investigated the influence of the infinite hydraulic diffusivity assumption for the injection phase and found that it could result in overestimation of the plume front vandenbohede et al 2009 and wang et al 2017 investigated the effect of the flow field on mass and heat transport in the swpp test using numerical methods and found that the infinite hydraulic diffusivity assumption could create non negligible errors in parameter estimations however above mentioned studies only involve fully penetrated wells and whether this assumption will influence the swpp test results for a partially penetrated well is still unclear in addition to the issues mentioned above wellbore storage is demonstrated to be another important factor influencing the flow field around wellbore at early pumping stage the reactrans model associated with the swpp test assumed that water was only extracted from the wellbore storage over a period of 0 t 1 where t 1 was an initial small lapse of time of pumpage t the simulated initial time of the swpp test was chosen to start at t 0 t 1 instead of t 0 where t 0 was the actual starting time of the test t and klepikova et al 2016 suggested that t 1 could be as small as 0 1 min or 0 01 min when the horizontal conductivity was larger than 20 0 m d such a treatment might work well when modeling groundwater flow field but not for the reactive transport in the swpp test this is because a certain amount of mass would move into the aquifer during the period of 0 t 1 which may affect the btcs in the extraction phase actually assumptions involved in the analytical solutions mentioned above could be removed in the numerical solutions carrera et al 1998 wang and zhan 2017a e g considering the infinite hydraulic diffusivity the dispersion coefficient tensor wellbore storage the heterogeneity of the aquifer and so on huang et al 2010 and langevin 2008 employed the moflow mt3dms package to replicate the reactive transport in the swpp test and the results showed that the discrepancy between the analytical solutions and numerical solutions were obvious the traditional well package in modflow contains an assumption when treating the wellbore i e the discharge of the well block is dependent on the transmissivity of that well block harbaugh et al 2000 specifically for a homogeneous aquifer such an assumption leads to a uniformly distributed flux along the well screen which is named a uniform flux boundary condition ufbc similarly vandenbohede et al 2009 employed reactrans to model the swpp test reactrans is a finite difference two dimensional axially symmetric groundwater flow and reactive transport model vandenbohede et al 2008 in which the boundary condition of the wellbore is also ufbc additionally sun 2016 and zhao et al 2016 respectively used feflow diersch 2014 and toughreact xu 2008 to replicate the swpp test using ufbc for wellbore however the fitness between observed and computed data is not well ufbc does not consider the permeability of the wellbore which is much greater than the permeability of the surrounding aquifer and many previous studies demonstrate that the uniform head boundary condition uhbc seems to be more reasonable than ufbc for the partially penetrated well since it assumes the permeability of the wellbore to be infinite wang and zhan 2017a b investigated the effect of two models ufbc and uhbc on the flow field and their results were similar to hantush 1964 i e the effect was obvious in the region near the screen but became negligible when r 0 25 b k r k z where r is radial distance l b is aquifer thickness l kr and kz are the radial and vertical hydraulic conductivities lt 1 respectively as the swpp test mainly concerns the aquifer properties near the testing well thus the influence of the wellbore boundary condition could be very important it seems that one can use a very large value to approximate the infinite permeability of the wellbore in numerical modeling neville and tonkin 2004 however wang et al 2018 pointed out that previous numerical models produced some errors in describing the mixing processes between the injected tracer and original tracer in the wellbore such as moflow mt3dms in summary it is not always possible or desirable to design a fully penetrated well which is particularly true for a thick aquifer even for a fully penetrated well the screen might be only set over a small portion of wellbore different from a fully penetrated well a partially penetrated well could create vertical flow gradients in the vicinity of the well however most of the previous models of the swpp test contain assumptions which could render results inaccurate regardless of analytical or numerical models specifically the conceptual model is simple for analytical solutions huang et al 2010 wang et al 2017 for instance the hydraulic diffusivity is not finite and the advection and the dispersion is one dimensional for partial penetrated well these assumptions could be released in the numerical solutions however the mixing processes between the injected tracer and original tracer in the wellbore could not be treated properly in the numerical models such as moflow mt3dms feflow and so on in this study first a new numerical model of the swpp test will be established under the flow field with a finite hydraulic diffusivity considering a partially penetrated well and the wellbore storage two types of boundary conditions will be considered for the well screen ufbc and uhbc meanwhile four phases will be considered in the swpp test injection of a prepared solution injection of a chaser resting phase and extraction of the mixed solution then sensitivity analysis is conducted to test the influence of physical parameters on the reactive transport in the swpp test finally the experimental data of the swpp test by tong et al 2016 is employed to test the new model of this study the new model of this study is an extension of previous models of the swpp test since both heat transport and mass transport in the subsurface could be described by ade in similar forms the solutions could be extended to heat transport in the swpp test as well 2 problem statement of the swpp test similar to wang et al 2017 fig 1 shows the schematic diagram of the conceptual model of swpp test a cylindrical coordinate system is adopted in which the r axis is horizontal from the well and the z axis is vertically upward the origin of the system is at the center of the well and located at bottom of the aquifer the detailed information of the mathematical model of swpp test is shown in section s1 of supplementary materials assuming that advection dispersion and sorption are involved in the transport processes the governing equation of reactive transport in the swpp test is chen et al 2010 cosler 2004 1 r c t 1 r r r d rr c r r d rz c z z d zr c r d zz c z v r c r v z c z κ r c r r w where c is resident concentration of the aquifer ml 3 d rr d rz d zr and d zz are the four components of the dispersion coefficient tensor l2t 1 respectively t is time t z is the vertical distance l v r u r θ and v z u z θ are average pore velocity components lt 1 in the r and z axes respectively u r and u z are radial and vertical darcian velocity components lt 1 respectively θ represents porosity dimensionless r w is the well radius l κ is a constant rate for the first order biodegradation or radioactive decay or the first order reaction rate in the aquifer t 1 r 1 ρ b k d θ is known as the retardation factor of the aquifer dimensionless k d is the equilibrium distribution coefficient l3m 1 ρ b is the bulk density of the aquifer material ml 3 the governing equation of eq 1 describes the traditional fickian based ade model which works well in reproducing the swpp test when the observed btcs do not show considerable tailing effects dejam et al 2014 dejam 2019 one may need to use a different governing equation such as a fractional ade or fade to describe the late time btcs when the observed btcs show considerable tailing as has been done by chen et al 2017 the research on other non fickian transport processes associated with the swpp tests such as the rate limited mass transfer in dual porosity or dual permeability systems will be explored in near future in this study the velocity is calculated by darcy s law 2 u r k r s r 3 u z k z s z where s is drawdown l which could be obtained by solving the following mass balance equation with proper initial and boundary conditions 4 u r r u r r u z z s s s r z t t r r w where s s is the specific storage of the aquifer l 1 one interesting point to note is that considering an infinite hydraulic diffusivity and a ufbc condition for the test well huang et al 2010 proposed the following equation for a partially penetrated well 5 v r r r w q 2 π r w b θ where q q inj 0 t t inj q cha t inj t t inj t cha 0 t inj t cha t t inj t cha t res q ext t inj t cha t res t t inj t cha t res t ext q inj q cha and q ext are the flow rates of the well l3t 1 in the injection chasing and extraction phases respectively q inj and q cha are positive while q ext is negative after a careful consideration one could find that eq 5 may result in errors from two aspects firstly v r varies with time in the flow field with a finite hydraulic diffusivity especially right after a discharge change of the well such as at beginning of injection or extraction phase secondly eq 5 underestimates the flow velocity at the well screen for the ufbc model and the errors become greater with decreasing well screen length many studies showed that eq 5 only works in the aquifer when r 0 25 b k r k z hantush 1964 at the well screen it should be equal to dejam et al 2013 6 v r r r w q 2 π r w z top z bot θ in the regions from r w to 0 25 b k r k z the vertical component of the flow velocity ignored by eq 5 in huang et al 2010 may also affect the accuracy of the results the uhbc type of wellbore is represented as 7 2 π r b z bot z top u r z d z r r w π r w 2 d s w t dt q z bot z z top 8 s r r w z i s r r w z j where s w is the drawdown inside the wellbore l i and j are positive integers started from 1 hereinafter z i and z j z bot z top z bot and z top represent the vertical coordinates of the top and bottom of the well screen l respectively as for the ufbc type of wellbore the flux at the screen may be influenced by the aquifer properties in a homogeneous and isotropic aquifer u r is independent on the vertical location and uhbc reduces to ufbc 9 lim r r w 2 π r z top z bot u r π r w 2 d s w t dt q z bot z z top 10 u r z i r r w u r z j r r w z b o t z z t o p as for a well penetrating a heterogeneous aquifer which is sometimes named a multi aquifer well harbaugh et al 2000 neville and tonkin 2004 the distribution of u r is not uniform along the screen and it may be dependent on the transmissivity of the well blocks well blocks refer to the cells of grid system containing the well in the numerical simulation assuming the hydraulic properties of each cell being homogeneous and isotropic one has 11 k r δ z j δ z j u r δ z i r r w k r δ z i δ z i u r δ z j r r w where δ z i z i 1 2 z i 1 2 δ z j z j 1 2 z j 1 2 δ z i represents the vertical dimension of the well block i with the top elevation z z i 1 2 and bottom elevation z z i 1 2 and δ z j is defined similarly k r δ z i and k r δ z j represent the hydraulic conductivities of the well blocks i and j respectively k r δ z i δ z i and k r δ z j δ z j represent the transmissivities of the well blocks i and j respectively u r δ z i r r w and u r δ z j r r w respectively represent the radial darcian flow velocities of the well blocks i and j at the well screen eq 11 is similar to treatment in conventional well package of modflow harbaugh et al 2000 neville and tonkin 2004 and it assumes no storativity in the well blocks well block is shown in fig 1 of wang et al 2017 the model of eqs 1 11 is an extension of huang et al 2010 by considering the actual flow field of a partially penetrated well another difference between this study and huang et al 2010 is that this study considers the dispersion tensor which depends on both the radial and vertical flow velocities while huang et al 2010 assumed that the radial and vertical dispersion coefficients were only proportional to the radial flow velocity which is inadequate from eqs 1 11 one may find that the mathematical model of the swpp test is axisymmetric and the regional flow is not considered whether or not to include the influence of regional flow depends of the purpose of the swpp test for instance if the purpose of test is to determine the dispersivity which is the focus of this study the swpp test is usually conducted within a short period of time several hours to 1 day with the injecting and or pumping dominating the flow field near the well in such a scenario the background regional flow is usually negligible given the generally mild hydraulic gradient of regional flow in most shallow aquifers usually less than 0 005 such as those in jianghan plain of china as reported by tong et al 2016 and zhao et al 2016 however if the purpose of the swpp test is to determine the regional flow velocity then the swpp test must include at least three phases of injection resting and pumping specifically the resting phase allows the injected tracer to ride with the regional groundwater flow thus is a key phase to include for this type of test the swpp test time is usually much longer than the swpp test time required for determining the dispersivity because it takes a long time for the tracer to migrate with the regional groundwater flow to a considerable distance from the point of injection nevertheless the regional flow is not included for the purpose of this study and axisymmetric flow is presented from a numerical perspective langevin 2008 pointed out that the numerical solutions of the axisymmetric model could be 1000 times faster than the numerical solutions of the equivalent three dimensional 3d models 3 solutions of the swpp test 3 1 numerical solutions in this study we employ a finite difference method to solve the models of groundwater flow and reactive transport in the swpp test and use a stiff integrator ode15s which is available in the standard version of matlab to facilitate the computation ode15sis a variable step and variable order solver for the ordinary differential equation based on the numerical differentiation formulas of orders 1 to 5 it employs the gear s method the backward differentiation formulas to solve the stiff problems which arenumerically unstable one effective approach is to take small steps to obtain satisfactory results for the numerical solution as for the numerical solution of ade it commonly suffers from some numerical errors like artificial oscillation and numerical dispersion which are non negligible for advection dominating transport ode15s which could automatically adjust the dimension of the steps is a good choice for numerical simulation of the swpp test meanwhile many studies demonstrate that ode15s performs well for problems of groundwater flow and reactive transport around injection extraction wells mathias and wen 2015 wang and zhan 2017a as mentioned above the finite difference solution of the ade model generally suffers from the numerical errors such as numerical dispersion and artificially oscillation and the numerical dispersion is related to the grid peclet number 12 p e u r δ r d rr where p e is the grid peclet number many studies demonstrated that the numerical dispersion was negligible when p e 2 syriopoulou and koussis 1991 thomson et al 1984 in the following section the values of p e is smaller than 2 for the numerical solution of this study to minimize errors of the numerical solution and to reduce the computational cost simulations will be conducted with a non uniform grid system similar to mathias and wen 2015 the spatial steps are smaller near the wellbore and become progressively greater away from the wellbore in the r axis direction 3 2 verification of the solutions to check the accuracy of the numerical solution the exact analytical solution of huang et al 2010 will serve as the benchmark however the model of huang et al 2010 contains some assumptions which have been mentioned in the introduction under the flow field with an infinite hydraulic diffusivity ignoring the vertical flow c 0 inj is constant and without the chasing and resting phases to satisfy these assumptions only two phases injection and extraction are considered the well fully penetrates the aquifer and the flow field is assumed to be with an infinite hydraulic diffusivity for the numerical solution fig 2 shows figs 3 and 4 comparison between solutions of huang et al 2010 and this study for a fully penetrated well and the parameters used are as follows b 6 m rw 0 1 m zbot 0 m ztop 6 m θ 0 3 m tinj 0 5 day t cha 0 day t res 0 day d m 0 m2 day qinj 24 m3 day and qext 24 m3 day where qinj and qext denote the rates of injection and extraction of the well respectively t cha 0 and t res 0 represents the swpp test only considering the injection and extraction phases two sets of α l are chosen as 0 1 m and 0 3 m and α t is assumed to be 1 10 of α l for the sake of simplicity obviously the numerical solution of the swpp test is accurate and reliable for this special case as evident from fig 2 3 3 comparison with modflow mt3dms up to date there are many numerical codes that are capable of simulating the transport process occurring around the well such as sutra voss 1984 feflow diersch 2014 modflow mt3dms harbaugh et al 2000 zheng and wang 1999 toughreact xu 2008 and so on modflow is used to simulate the groundwater flow in the aquifer and mt3dms is developed to simulate reactive transport in the aquifer in which the flow terms are calculated by modflow modflow mt3dms is an open source model distributed by united states geological survey and it has been widely employed to solve the problems related to 3d transient groundwater flow and reactive transport including the axisymmetric flow and transport associated with this study however there are at least four aspects limiting the accuracy of the numerical solutions of modflow mt3dms if it is directly employed for the problem of concern here firstly the cell of the grid system in modflow mt3dms is cuboid or cube which is a poor approximation of the cylinder shape of the wellbore used in the swpp test secondly an asymmetrically non uniform grid mesh is necessary to simulate the flow and transport problem near a swpp test well but is difficult to setup in modflow mt3dms as the numerical errors are closely related to the non uniform grid resolution near the test well the poor configuration of grid mesh near the well will be a major numerical concern the third aspect is the treatment of the boundary condition of the wellbore as mentioned above the uhbc model may be more reasonable than ufbc in treating the flow and reactive transport in the wellbore modflow contains a package for uhbc namely the multi node well mnw package when the dimension of the well blocks is equal to the well diameter the mnw approach reduces to the high kv in the well block hkwb approach where the hkwb approach assumes that the hydraulic conductivity of the well block is so high to approach infinity the problem is that the mnw approach only works when the dimension of the well block is greater the well diameter which could substantially increase the numerical errors of the solution for the reactive transport as for the hkwb approach great discrepancy of the conductivities between the well blocks and the surrounding cells of the aquifer might cause convergent issues for the numerical solutions the four aspect is that modflow mt3dms assumes that the volume of water in the wellbore is dependent on the aquifer thickness not on the water level in the wellbore wang et al 2018 such assumption could result in errors when describing the mixing effect in the wellbore langevin 2008 compared analytical solutions of the swpp test by schroth and istok 2005 with modflow mt3dms in which the well was assumed to be a point source sink and the flow field was spherical the results showed that the discrepancy between them was also obvious as shown in fig 8 of schroth and istok 2005 as for actual applications the point source sink well is far less common as the fully or partially penetrated well therefore the performance of modflow mt3dms for a fully or partially penetrated swpp test well cannot be evaluated using the point source sink well of langevin 2008 and will be investigated in this section to serve this purpose gms 7 0 will be employed for the calculation and the hkwb approach will be employed to produce the uhbc solution of the swpp test where version 2005 of modflow and mt3dms are included in gms 7 0 to resolve the numerical dispersion and numerical oscillation issues mt3dms contains five techniques for the advection term of ade zheng and wang 1999 such as the third order tvd scheme ultimate standard finite difference method sfdm the particle tracking based method of characteristics moc and its variants modified method of characteristics mmoc and hybrid moc mmoc hmoc zheng et al 2012 pointed out that no single numerical technique was effective for all transport conditions and each technique had its own strengths and limitations for instance moc is most effective in eliminating the errors of the numerical dispersion while it may lead to great mass discrepancy sfdm is mass conservative but is vulnerable to the errors of the numerical dispersion when the advective effect is dominating in the comparison between the analytical solutions and modflow mt3dms by langevin 2008 the numerical solutions are obtained based on sfdm which has obvious discrepancy with analytical solutions in this study the performance of the other numerical approaches will be tested for the swpp test to decrease the computational time and increase the accuracy of the numerical solution a non uniform grid system will be employed for the discretization of the horizontal layer but a uniform grid system remains for the vertical discretization due to many difficulties in setting up non uniform vertical grid system in gms 7 0 the detailed information of the grid system can be seen in s2 of supplementary materials to test the numerical solutions of modflow mt3dms the physical parameters of b rw θ tinj t cha t res and d m in this section are similar with ones used in fig 2 which is to check the accuracy of the numerical solution of this study k r k z 0 1 m day ss 0 0001 m 1 to exclude that influence of mixing effect on the results by modflow mt3dms c 0 inj is computed in priori by the model of wang and zhan 2019 show the results of a fully penetrated well and a partially penetrated test well respectively zbot 0 m and ztop 6 m are for the fully penetrated well and zbot 1 5 m and ztop 4 5 m are for the partially penetrated well fig 3a shows the comparison of the drawdowns by this study and modflow for different flow rates fig 4a shows the comparison of the drawdowns by this study and modflow for different vertical locations in the wellbore since the hkwb approach is used to treat the wellbore the drawdowns are the same at different vertical locations in the wellbore the agreements between the analytical and numerical drawdowns are satisfactory for both fully penetrated and partially penetrated wells using the swpp test to investigate the reactive transport the physical and chemical information is mainly included in btcs in the extraction phase and fig 3b and 4b show the btcs by this study and modflow mt3dms in the extraction phase one may find that the methods of sfdm and mmoc perform worse than the methods of ultimate and hmoc for both fully penetrated and partially penetrated wells ultimate and hmoc work better for the fully penetrated well than for the partially penetrated well the discrepancy between the solutions of this study and the ultimate and hmoc approaches is obvious for the partially penetrated well the hmoc solution oscillates with time in summary the comparison between the numerical and the analytical solutions demonstrates the accuracy of this study comparing the solutions of this study with modflow mt3dms one may conclude that the ultimate and hmoc approaches are recommended for modeling the reactive transport in the swpp test 4 discussion and results 4 1 effect of boundary condition of wellbore on the swpp test due to much higher permeability of the wellbore than the aquifer permeability uhbc is more reasonable than ufbc since ufbc does not consider the discrepancy of the permeability between the wellbore and aquifer and assumes that the water flux is uniformly distributed along the well screen as demonstrated in previous studies the flow direction is not horizontal especially in the vicinity of the partially penetrated well the flux at the well screen not only changes with locations but also with time wang and zhan 2017a b in this section we mainly investigate the influence of the boundary conditions of the well screen on the reactive transport in the swpp test figs 5 7 represent the comparison between the ufbc and uhbc solutions fig 5a and 5b represent the spatial distributions of the concentration along the screen at early and late extraction stages respectively the legends in fig 5a are the same as those in fig 5b for the purpose of comparison we employ a dimensionless vertical coordinate of the well zw 13 z w z z bot z top z bot z bot z z top therefore the dimensionless vertical coordinate of the well screen is in the range of 0 1 as shown in fig 5a and 5b three sets of the screen length are chosen 1 6b 3 6b and 5 6b the other parameters used are as follows b 6 m rw 0 1 m k r k z 0 1 m day ss 0 0001 m 1 α l 0 1 m α t 0 01 m θ 0 1 m tinj 0 1 day text 10 day t cha 0 day t res 0 day qinj 10 m3 day and qext 10 m3 day the values of these parameters are from the reference of wang and zhan 2019 fig 6 shows btcs at different locations of the wellbore for the case of zbot 1 5 m ztop 4 5 m in fig 5 in which zmid zbot ztop 2 represents the screen center by comparing fig 5a 5b and fig 6 two interesting observations can be made firstly the difference between the ufbc and uhbc btcs is obvious at early extraction stage and becomes negligible with time going regardless of the screen length this observation could be explained by the flow fields produced by ufbc and uhbc models as the flow velocity is a key parameter controlling advection and dispersion of solute in subsurface hantush 1964 pointed out that the influence of the boundary condition of partially penetrating well on flow field was mainly around the wellbore meanwhile with time going the solute concentration becomes smaller and might be no detectable when c c 0 inj 1 0 10 3 therefore the difference between ufbc and uhbc btcs becomes negligible and the influence on the swpp test could be ignored secondly the values of the uhbc solution are smaller than the values of the ufbc solution at the well center but larger at the well ends in another word the ufbc solution overestimates the concentration at the well center but underestimates it at the well ends fig 7a and 7b show the contour maps of the ufbc and uhbc concentrations in the aquifer where the dash line represents the uhbc solution and the solid line represents the ufbc solution the parameters used in these two figures are the same as in fig 6 one could see that the difference between the ufbc and uhbc solutions is obvious in the region near the well ends or around z zmid far from the wellbore the contour lines of the concentration are similar to the flow velocity lines namely the contour lines of ufbc are parallel with the screen in the region near the screen due to the uniform flux distribution as for the uhbc contour lines the velocity is larger in the region near the well ends and that is why the ufbc contour map is different from the uhbc contour map 4 2 effect of flow field on the swpp test as demonstrated in the mathematical model of the swpp test discussed in section 2 the flow velocity is a primary driving force for reactive transport in the porous media and it is not only included in the advection terms but also in the dispersion terms however many previous studies assumed that flow field was with an infinite hydraulic diffusivity resulting in that the flow velocity was time independent which was not true for the swpp test for instance the hydraulic diffusivity is 1 0 103 m2 day for the fine sand aquifer when kr kz 1 0 10 1 m day and ss 1 0 10 4 m 1 is 1 0 104 m2 day for the medium sand aquifer when kr kz 1 0 m day and ss 1 0 10 4 m 1 and is 1 0 106 m2 day for the coarse sand aquifer when kr kz 10 0 m day and ss 1 0 10 5 m 1 the parameters used in this study are from domenico and schwartz 1990 and batu 1998 obviously the values of hydraulic diffusivity are not infinite for all kind of aquifers and it is greater for the coarse sand aquifer than for the fine sand aquifer the other parameters are b 6 m rw 0 1 m α l 0 1 m α t 0 01 m θ 0 1 m zbot 1 5 m ztop 4 5 m tinj 0 1 day tchs 0 1 day and tres 0 1 day text 10 day qinj 10 m3 day qchs 10 m3 day qres 0 m3 day and qext 10 m3 day where qchs and qres respectively represent the discharges of the well in the chasing and resting phases the boundary condition of well screen is uhbc fig 8 shows the flow velocity variations with time at different locations of the wellbore where ufbc eq 10 represents the ufbc model with an infinite hydraulic diffusivity while the others represent the uhbc model with a finite hydraulic diffusivity obviously the curve of ufbc eq 10 is different from the curves of the uhbc model interestingly the velocity of ufbc eq 10 is between the velocities at the top screen z ztop and the middle screen z zmid during the injection and extraction phases this is because the groundwater flux is not uniform over the entire screen for the uhbc model instead it varies with location and is larger near the well ends due to the greater influence volume there in contrast ufbc eq 10 assumes that the well discharge is uniformly distributed along the screen another interesting observation is that a greater hydraulic diffusivity will lead to a shorter transient duration for the velocity approaching its quasi steady state by checking the hydraulic parameters of the clay rich and gravel rich aquifers one could find that the hydraulic diffusivity value is smaller for the clay rich aquifer while larger for the gravel rich aquifer therefore one may conclude that the assumption of an infinite hydraulic diffusivity could approximate the actual cases better for the coarse sand aquifer or the gravel aquifer but not for the fine sand aquifer or the clay rich aquifer fig 9 shows btcs at the extraction phase corresponding fig 8 the difference of btcs between different types of aquifers is obvious the peak value of btcs is the greatest for the coarse sand aquifer and is the smallest for the fine sand aquifer such a difference becomes less dramatic at the late stage of the extraction phase the arrival time for the peak values is also different for different porous media this is because the flow model assumes a finite hydraulic diffusivity thus it always requires some finite time to propagate the well discharge change to the advective front and a greater hydraulic diffusivity value will require a shorter propagation time such an observation implies that the assumption of an infinite hydraulic diffusivity may work at the late stage of the extraction phase but not at the early stage of the extraction phase 4 3 effect of wellbore storage on the swpp test wellbore storage happens immediately after a discharge change of the well and its effect depends on the volume of the wellbore with a larger well radius leads to a greater wellbore storage effect the swpp test contains four different phases and the flow rate change rapidly at the start of each phase therefore wellbore storage effect becomes an obvious concern when studying reactive transport in the swpp test fig 10 shows btcs for different well radii representing various degrees of wellbore storage and the parameters used in fig 10 are the same as in figs 8 and 9 except for the well radius one could see that the influence of the wellbore storage is obviously non negligible for the swpp test and a smaller radius results in a smaller peak concentration this is because the smaller well radius means smaller volume of the wellbore and the solute concentration entering aquifer from the wellbore needs longer time the values of btcs increase with the deceasing well radius at the early stage of the extraction phase while decrease with the deceasing well radius at the late stage of the extraction phase 4 4 sensitivity analysis to test the influence of physical parameters on the reactive transport in the swpp test the technique of sensitivity analysis will be employed kabala 2001 yang and yeh 2009 14 s c i j i j o i i j δ i j o i i j δ i j where s c i j is the sensitivity coefficient o i is the output function of the model δ i j is a small increment i is the i th time for o i j is the j th parameter of the model in this study o i is the dimensionless concentration c d by analyzing the dimension of s c i j one could understand how sensitive of the parameters is to the results and the greater absolute values of s c i j imply greater influence the analyzed parameters include hydraulic diffusivity dispersion coefficient anisotropy screen length and well radius the base values of parameters used in the sensitivity analysis are kr kz 1 0 10 1 m day and ss 1 0 10 4 m 1 b 6 m rw 0 1 m θ 0 3 m α l α t 0 1 m tinj 0 5 day t cha 0 day t res 0 day d m 0 m2 day qinj 10 m3 day qext 10 m3 day zbot 1 5 m and ztop 4 5 m fig 11 shows the sensitivity of the hydraulic diffusivity dispersion coefficient anisotropy screen length and well radius on the btcs in the well one may find that the influence is greatest and positive for the hydraulic diffusivity while is the smallest for the dispersion coefficient anisotropy the influence is negative for the well radius 4 5 discussions many previous studies on the mathematical model of the swpp test were based on some over simplified assumptions which have been released in the model of this study for instance the hydraulic diffusivity is finite the advection is two dimensional the dispersion coefficients are expressed in a tensor and the mixing processes between the injected tracer and original tracer in the wellbore are considered in the new models of this study results in sections 4 1 4 4 indicate that a smaller peak value of btcs could be caused by boundary conditions as shown in fig 6 by a larger hydraulic diffusivity as shown in fig 9 or by a smaller well radius as shown in fig 10 therefore if the parameter estimation is done solely based the information of btcs non uniqueness of parameter values is inevitable to overcome this issue it is necessary to gather the information of the flow field such as the well geometry information and the observed time drawdown data besides the information of btcs the observed time drawdown data are used to calibrate the model of groundwater flow and then to determine the hydraulic diffusivity of the aquifer well geometry information could be used to determine the wellbore storage however some limitations are still included in the new models of this study for instance the new model of this study is used to simulate the conservative tracer transport in the swpp test it will be extended for the multi spices transport model in near future meanwhile the mechanism of reactive transport is complex in subsurface and it could be affected by the water temperature variation water saturation soilmicrobes and so on these factors have not been considered in the new model of this study 5 field application to test the field applicability of this study data of a field swpp test in a confined aquifer conducted by tong et al 2016 will be employed in this swpp test the well partially penetrates the aquifer with a radius of 0 033 m where the aquifer is composed of fine medium and coarse sands the total length of the well is 37 4 m and the screen length is 2 4 m from 20 6 m to 23 0 m the swpp test contains four phases tinj 9 0 min qinj 40 l min c 0 inj 100 mg l tcha 1 0 min qcha 30 l min c 0 cha 0 mg l tres 12 h and text 13 h as for qext it ranges from 0 72 l min to 0 90 l min and is set as 0 85 l min as done by tong et al 2016 and zhao et al 2016 the initial water level is 2 m below the ground surface the detailed information of the swpp test can be seen in tong et al 2016 and zhao et al 2016 to understand the behavior of the tracer movement in the swpp test reported by tong et al 2016 sun 2016 used feflow diersch 2014 to establish a numerical model based on ufbc assuming the aquifer to be homogeneous with kr 3 m day kz 0 3 m day θ 0 3 d m 1 10 9 m2 s α r 5 m and α z 0 5 m as a result sun 2016 found that it was difficult to interpret the in situ data using a homogeneous aquifer model zhao et al 2016 employed toughreact eos9 to rebuild a numerical model of the swpp test for a heterogeneous aquifer and presented a response on such comments by sun 2016 the toughreact eos9 model is based on ufbc due to the heterogeneity of the aquifer the aquifer was vertically and spatially discretized into 7 layers in the numerical model of zhao et al 2016 and each layer itself was assume to be homogeneous the first and seventh layers are clay with very small permeability which were aquitard the regional flow was assumed to be uniform with a hydraulic gradient of 0 0005 while it was 0 001 in sun 2016 the fitness of btcs by zhao et al 2016 was far better than that by sun 2016 however there are still three points that seem questionable firstly the simulated concentration was greater than the observed one for the first sample in the extraction phase as shown in fig 1 of zhao et al 2016 or fig 12 of this study sun 2016 raised a similar question in his comments secondly fig 1 of zhao et al 2016 or fig 12 of this study showed that the computed btcs by toughreact eos9 in the well increased with time in the resting phase which implied that the tracer was transported back into the well from the aquifer this is probably due to the influence of the regional gradient or numerical errors thirdly the peak values of the observed btcs are greater than their counterparts of the computed btcs in this section we aim to use the uhbc model of this study to replicate the swpp test of tong et al 2016 however the information of the flow field was very limited for instance the observed time drawdown data were not available the observed btc data is listed in table s1 of supplementary material s to increase the accuracy of the results the aquifer is vertically discretized into 36 layers and the well screen is discretized into 18 layers in the numerical solution of this study based on other parameters used in zhao et al 2016 we find that the parameters of d m 1 10 9 m2 s α r 0 1 m and α z 0 05 m could fit the observed btcs after a trial and error process as shown in fig 12 to further test the accuracy of the new numerical solution the error analysis has been conducted in this section the errors between observed and computed btcs could be computed by 27 e r r o r i 1 n y i obs y i est 2 i 1 n y i obs y mean 2 where y i obs is the i th observed value y i est is the i th estimated value y mean is the mean of the observation data and n is the total number of observations the errors for best fitting the observed data are 0 3061 for this study 0 4259 for the model of zhao et al 2016 the results demonstrate that the model of this study performs better than the previous studies when interpreting the field data of the swpp test of tong et al 2016 the reason for better fitness of this study than zhao et al 2016 is probably due to a few issues associated with zhao et al 2016 including inadequate flow field description discrepancy of the gird cells of toughreact eos9 and the wellbore lower grid resolution resulting in the numerical errors and the inadequate treatment of the boundary conditions of the wellbore 6 summary and conclusions when quantifying the in site parameters associated with solute or heat transport like dispersivity porosity and biogeochemical reaction rates the swpp test is preferred due to its easy implementation lower cost and high efficiency the accuracy of estimated parameters not only depends on the operation of the test but also on the accuracy of the models however previous studies on the swpp test using a partially penetrated well assumed that the boundary condition of the well screen was ufbc instead of uhbc which could lead to substantial errors in this study we developed a uhbc model of the swpp test using finite difference method with an injection phase a chasing phase a resting phase and an extraction phase the in situ field data of tong et al 2016 were used to test the model of this study the following conclusions can be drawn 1 the influence of ufbc and uhbc for describing the well discharge over the well screen is obvious at the early stage of the extraction phase but becomes negligible at late stage of the extraction phase the uhbc solution is smaller than the ufbc solution at the middle of the well screen but greater than the ufbc solution at the top or bottom of the well screen 2 hydraulic diffusivity has great influence on the reactive transport in the swpp test and the assumption of a time independent flow velocity or an infinite hydraulic diffusivity may cause non negligible errors 3 using the swpp test to determine the in situ aquifer characteristics of geological formations the information of the flow field like well geometry information and the observed time drawdown data should be collected during the test which could help resolve the non uniqueness of parameter estimation and improve the accuracy of the results 4 the sensitivity analysis shows that the result of this study is most sensitive to the hydraulic diffusivity and least sensitive to the dispersion coefficient anisotropy 5 the uhbc model of this study performs better than the previous studies when interpreting the field data of the swpp test of tong et al 2016 credit authorship contribution statement yu chen conceptualization data curation quanrong wang conceptualization methodology supervision writing original draft writing review amp editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was partially supported by programs of natural science foundation of china no 41772252 no 41972250 and no 41502229 innovative research groups of the national nature science foundation of china no 41521001 the 111 program state administration of foreign experts affairs the ministry of education of china no b18049 the fundamental research funds for the central universities china university of geosciences wuhan no cuggc07 and the belt and road special foundation of the state key laboratory of hydrology water resources and hydraulic engineering no 2020492011 we thank the editor associate editor and anonymous reviewers for their constructive comments which help improve the quality of the paper appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 127035 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
3904,rain on snow ros events influence the hydrological regime of rivers in regions with seasonal snow cover although ros events are often related to floods they do not always cause severe runoff during ros the snowpack has an ambiguous effect on runoff generation it can either store a significant portion of rain or amplify runoff by additional snowmelt there is a need to understand under what circumstances ros events produce runoff we analysed eleven years of hourly meteorological snow water equivalent and streamflow data from 15 catchments located in two mountain ranges in czechia we identified 611 ros events which were further analysed and classified using selected meteorological snow and runoff indices the analysis of the runoff response of all ros events revealed that only 5 of them resulted in high runoff exceeding the 1 year return period but most of the events 82 did not cause any significant runoff increase employing self organising maps enabled us to categorise the events and better understand what combination of hydrometeorological characteristics leads to various runoff responses high volumes of rain together with low snow cover were identified as important factors in the generation of high runoffs in contrast a deep and extended snowpack affected by rain under low air temperatures usually caused lower runoffs the results of this study showed the importance of the snowpack which can often prevent extreme runoff even when a large amount of rainfall occurs understanding the hydrological regime of ros is becoming even more important with the ongoing decline of the snowfall fraction and subsequent changes in snow storage keywords snow hydrology snowmelt runoff generation rain on snow self organising maps 1 introduction rain on snow ros events have been in the focus of hydrologists in recent decades and blöschl et al 2019 addressed ros as one of the twenty three unsolved hydrological problems in the context of complex water management ros events are often associated with natural hazards such as floods badoux et al 2013 mccabe et al 2007 pomeroy et al 2016 rössler et al 2014 avalanches baggi and schweizer 2008 conway and raymond 1993 haywood 1988 or slushflows clark et al 2009 decaulne and saemundsson 2006 often with severe consequences for human lives health and property for instance floods in the bernese alps switzerland in 2011 rössler et al 2014 or large floods in alberta canada in 2013 cost millions of dollars and caused the evacuation of thousands of inhabitants pomeroy et al 2016 since global precipitation patterns are changing markonis et al 2019 the frequency of ros is changing as well this is mainly because of rising air temperatures at high elevations dong and menzel 2019 marty et al 2017 pepin et al 2015 and changes in global atmospheric circulation cassou and cattiaux 2016 these changes impact snow cover and precipitation and therefore ros events snow cover depth and the number of days with snow on the ground beniston et al 2018 dong and menzel 2019 marty et al 2017 snow density zhong et al 2014 as well as snowfall fraction li et al 2020 are decreasing in many regions of the world notarnicola 2020 in the main river catchment in germany ros events were found to be an important factor for runoff generation above the elevation of 400 m sui et al 2010 however changes in elevation and temporal distribution of ros can be expected in the future musselman et al 2018 predicted that ros in the usa will be more frequent at higher elevations and will shift from spring to winter many historical floods in the usa are associated with ros events originating at elevations of 1000 1500 m above sea level a s l moreover ros are predicted to originate even above 2000 m li et al 2019 this is mainly because increasing temperatures results in more frequent liquid rather than solid precipitation at higher elevations musselman et al 2018 additionally a similar trend in the change in precipitation can be observed in the arctic bintanja 2018 and in europe jacob et al 2014 the most severe floods from ros events are usually associated with simultaneous snowmelt which can contribute considerably to runoff sui et al 2010 reported that in the main river watershed snowmelt contributed between 23 and 64 of an equivalent precipitation depth during ros another study from north western usa reports that maximum snowmelt contribution during ros varied between 2 and 47 wayand et al 2015 trubilowicz and moore 2017 showed that snowmelt enhanced snowpack runoff from a lysimeter by about 25 nevertheless the contribution of heat energy from rain to the total melt is usually only up to 10 at daily and longer temporal resolutions hotovy and jenicek 2020 li et al 2019 trubilowicz and moore 2017 also the main contributor to melt production usually differs depending on the locality and meteorological conditions during the ros event li et al 2019 reported that the dominant factor in western usa was net radiation but in eastern usa both net radiation and turbulent heat flux contributed equally to snowmelt production during ros this supports a study from germany where during ros snowmelt was mostly initiated by the turbulent exchange of latent and sensible heat in open sites whereas longwave radiation and turbulent fluxes contributed equally to snowmelt in forested sites garvelmann et al 2014 dominance of turbulent heat exchange as a main contributor for snowmelt during ros was also reported in würzer et al 2016 in the swiss alps although ros events can cause an increase in runoff not all ros events do so the snowpack can store a considerable amount of incoming rainwater and thus may generate reduced or even zero runoff previous field experiments conducted by juras et al 2017 showed that snowpack temporarily stored up to 70 of incoming rainwater volume about 40 mm the actual storage potential for the rainwater is controlled by the snow ripeness and snowpack physical properties such as grain shape grain size singh and singh 2001 and layering especially the presence of capillary barriers avanzi et al 2016 wayand et al 2015 showed that half of the largest investigated ros events in north western usa did not cause floods kattelmann 1987b reported that forested catchments even stored all rainwater during ros and generated no additional snowpack outflow snow also insulates the ground and prevents it from freezing more water is able to infiltrate into unfrozen soil compared to frozen soil seibert et al 2014 previous studies showed that runoff can often be generated faster and with higher magnitude from snow free areas seibert et al 2014 these facts emphasize the ambiguous effect and importance of snowpack on the hydrological regime during ros and the need to understand why and when ros events produce exceptional runoff blöschl et al 2019 although several studies have focused on modelled runoff response würzer et al 2016 würzer and jonas 2018 or on single events garvelmann et al 2015 rössler et al 2014 empirical analyses of the extended ros events dataset using measured streamflow at an hourly resolution are rather rare merz et al 2006 or even missing in many regions with seasonal snow cover additionally there is still limited knowledge of the role of individual climate and snowpack characteristics which control the dynamics of runoff response many of the studies were performed in the usa or the european alps to fill this knowledge gap we set the main objectives of our study to 1 identify past ros events in low altitude central european mountain ranges and analyse their characteristics in terms of seasonal variability and runoff response and 2 classify the ros events according to major drivers controlling runoff response our methods also account for the fact that only a part of the catchment contributes to runoff during the specific ros event due to strong dependence of snowmelt on air temperature at specific elevation explaining the causes leading to high runoff during ros events is one of the unsolved scientific problems in hydrology recently defined by the hydrological community blöschl et al 2019 our study benefits from 11 years of hourly climatological and hydrological data from 15 catchments at different elevations the focus on elevation is important because ros events highly depend on air temperature influencing the phase of precipitation which also influences the fraction of the catchment contributing to runoff 2 material and methods 2 1 study area the hydrological response of ros events was analysed for 15 catchments fig 1 table 1 in the two highest czech mountain ranges or in very close proximity to them krkonoše or giant mountains and jeseníky in the sudetes region czechia for 10 cold seasons 2004 2014 nov 1st to may 31st two catchments kr cs jes bp only covered 2005 to 2014 due to data gaps the catchments were selected based on large snow storage during winter and thus the potential of ros occurrences and the availability of adequate data the catchments were chosen to be as natural as possible without dams or water transfers even though the catchments are partly urbanised and include some ski resorts the total extent of such areas is minor or negligible the location and basic characteristics of catchments are depicted in fig 1 and summarized in table 1 the elevation range of all catchments is from 438 m to 1602 m a s l and the area varies in size between 2 6 and 181 3 km2 the land cover of the catchments is characterized by coniferous forests prevailing european spruce picea abies while the highest parts of the catchments are usually above the tree line partially covered by mountain pine pinus mugo shrubs the forest coverage ranges between 26 and 93 and areas above 1 400 m a s l are mountain tundra 2 2 rain on snow events 2 2 1 rain on snow event definition a ros event was defined as the period of rain occurring simultaneously with snow laying on the ground specifically when snow water equivalent swe 10 mm air temperature threshold temperature tt and rainfall 0 mm 2 2 2 input data and modelling approaches meteorological and runoff data were acquired from the czech hydrometeorological institute chmi air temperature streamflow and precipitation were provided in an hourly time step observed snow water equivalent swe data were only available in a weekly time step measured every monday rain on snow can vary with elevation and may differ across the catchment in order to include elevation in the analysis we used the semi distributed bucket type hbv model in its software implementation hbv light lindström et al 1997 seibert and vis 2012 to obtain spatial distribution of precipitation air temperature snowmelt and swe and to estimate the precipitation phase across elevations note that runoff used in this study was not modelled but measured the model was chosen for its comprehensive snow accumulation and snowmelt routine and the robust way of model calibration the snow routine included in the model uses a degree day approach which calculates snow accumulation and snowmelt including snow water holding capacity and potential refreezing of meltwater the main inputs of the model form time series of daily mean air temperature daily precipitation and monthly mean potential evapotranspiration pet the pet values were calculated by the temperature based method presented by oudin et al 2005 additionally daily lapse rates for air temperature were calculated from observed data received from two neighbouring stations located at different elevations precipitation phase partitioning was performed using a single threshold temperature tt approach the value of tt was calibrated separately for each catchment details regarding model structure can be found in several studies girons lopez et al 2020 seibert and vis 2012 the hbv light model was calibrated automatically for each study catchment against observed runoff and swe using a genetic optimization algorithm seibert 2000 for the hydrological years 2004 2009 2006 2010 for two catchments with shorter time series a combination of three objective criteria was used to evaluate goodness of fit of the model 1 logarithmic nash sutcliffe efficiency for runoff nash and sutcliffe 1970 2 nash sutcliffe efficiency for swe and 3 volume error for runoff the main emphasis was put on model ability to reproduce the observed swe the model was validated for 2010 2014 ten different optimized parameter sets resulting from ten calibration runs were used to create ten simulations the median simulation was used for further analysis the results of model calibration and validation are shown in supplement table s1 fig s1 a similar approach for model calibration was also used by jenicek and ledvinka 2020 for partly the same study region simulated daily snowmelt was downscaled to an hourly step considering its diurnal cycle using the method of tobin et al 2013 as follows 1 m x t a r t x t t t n 0 t x t t t t x t t t where t x t is the air temperature at a given elevation zone x at a given hour t parameter ar represents a constant degree day factor mm c day 1 and tt is a threshold temperature above which snowmelt can occur both ar and tt were calibrated by the hbv model as described above and particular values are presented in table s1 in the supplement 2 2 3 catchment division semi distributed approach catchment division enables detailed spatial assessment of runoff response which depends on the fraction of the catchment area involved in the runoff generation process since the meteorological input data were not available in gridded form the semi distributed approach was used as the best available method to estimate area portion contributing to ros or runoff each catchment was divided into 100 m high elevation zones between 450 m and 1650 m a s l in these zones snow water equivalent swe snowmelt and ros occurrence were modelled see section 2 2 2 total swe and snowmelt per catchment were calculated as a weighted mean and a weighted sum respectively where the area of a given zone represented the weight the area of each elevation zone was calculated according to the hypsographic curve for each catchment these curves were constructed based on a digital elevation model with a resolution of 1 arcsec lat 50 20 m farr et al 2007 using a modified hypsometric function included in the hydrotsm package zambrano bigiarini 2020 in the r language r core team 2019 mean air temperature was then calculated as an average of the highest and lowest point temperature of the catchment the snow covered elevation zone was determined when swe 0 mm otherwise the zone was considered snow free runoff contributing area rca represents the sum of elevation zone areas where runoff occurred either by snowmelt or by rain in other words rca represents the area located below the freezing level defined by threshold temperature tt fig 2 finally we calculated the relative fraction of each specific zone described above to the entire catchment area a graphical interpretation of the concept is depicted in fig 2 2 2 4 rain on snow event selection ros events were identified for every hour and each elevation zone to be able to estimate the fraction of catchment affected by ros hereafter ros area total ros area was calculated as a sum of elevation zones affected by ros next we defined ros runoff duration rrd as a period of a ros event extended by the subsequent runoff response fig 3 from the initial selection above we further created a subset of events when at least 5 mm of cumulative rain was recorded the rrd was shorter than 144 h and runoff increase was detected multiple events were characterised by two or more ros events in one rrd with a time gap between rain onsets shorter than 96 h for longer time gaps the events were classified as two separate events 2 3 hydrograph analysis for streamflow analysis the original discharge data were recalculated to runoff depth mm rainfall and streamflow parameters used in this study are defined in the following fig 3 is a graphic conceptualization of the main hydrograph parameters the following parameters were estimated event start corresponds to rain onset of the ros event event end was calculated from the falling limb of the hydrograph based on the constant k method according to blume et al 2007 2 k d q obs dt 1 q obs t where qobs mm represents observed runoff at a specific hour t after visual validation of the method parameter k was smoothed to avoid discrepancies caused by occasional high volatility in runoff data event end was set when the absolute value of k 3 hour moving average reached the limit 1e 2 event rainfall pevent represents total amount of rain mm recorded at the closest meteorological station during an ros event fig 1 event runoff qevent represents total runoff volume caused by ros mm event runoff was distinguished from base flow qbase by the linear separation method depicted in fig 3 dingman 2015 we assume that the observed runoff only consists of base flow during the first and last hour of the event linear interpolation between these two points gives us a separation line between two runoff components where event runoff is above this line and base flow below it event runoff can be thus calculated as 3 q event t t 1 n q obs t q base t where qobs mm is observed runoff and qbase mm is base flow runoff linearly interpolated between the first and last hour of observed runoff in a single rrd n represents the number of hours of the event and t represents iteration for a given hour runoff coefficient c is the ratio of event runoff qevent to event rainfall pevent water budget wb defines the difference between qevent and pevent mm a negative wb represents water storage in the catchment whereas a positive wb indicates runoff excess we neglected other physical processes such as evapotranspiration sublimation or condensation in the wb calculation 2 3 1 runoff types the resulting ros events were divided into four types according to event runoff named negligible runoff low runoff medium runoff and high runoff table 2 this categorisation helps to better describe precursors of different hydrological responses to ros the ros event was classified as type 1 negligible runoff if cumulative event runoff did not exceed 25 of cumulative baseflow the ros event was classified as type 2 low runoff if cumulative event runoff exceeded 25 but not 75 of cumulative baseflow the ros event was classified as type 3 medium runoff if cumulative event runoff exceeded 75 of cumulative baseflow anytime during the course of the rrd and ros events of runoff type 4 high runoff were selected from the previously defined types if observed runoff qobs exceeded the 1 y return period q1 2 4 events clustering self organizing maps one of the key questions is how to detect which hydrometeorological conditions lead to increased runoff or even to floods and which do not a possible approach is classification of the conditions related to specific ros events with some data driven clustering technique to further categorize ros events and detect some patterns in their characteristics the self organizing map som technique was applied it is based on a data driven iterative algorithm used to classify the original multivariate dataset into some representative categories the algorithm is presented in detail by kohonen 1990 while numerous applications of soms in water resources can be found in the work of kalteh et al 2008 the basic principle of the method is to create a two dimensional output layer of nodes where each node attracts members of the original dataset with common features in our case these are ros events the next step is to decide which properties will be used as descriptors or classifiers i e event rainfall and initial swe in this example with each iteration of the algorithm events with similar rainfall and swe will move closer to each other this procedure is repeated until there is no change in the number of events per node finally all events that have similar descriptors will cluster over different nodes and each node can then be regarded as an individual group an advantage of the som algorithm lies in the fact that there is no need for preselecting the constraints of each group the number of nodes must be predefined though however there is no standard approach to determine the number of nodes in most studies various experiments are performed with soms of different sizes there is a significant amount of subjectivity in the selection of node number usually it is based on a balance between the homogeneity of different clusters and comprehensibility of the classification scheme chang et al 2010 ley et al 2011 markonis et al 2018 markonis et al 2021 rousi et al 2017 in this study a range of som sizes between 9 and 36 was examined for symmetrical topologies i e 3 3 to 6 6 using the kohonen package in r language wehrens and kruisselbrink 2018 to select the most representative one we used the node variance minimization approach markonis and strnad 2020 the som with the minimum variance between its nodes has dimensions of 4 4 nodes which corresponds to a theoretical average of 38 events per node clustering ros events into 16 groups brings the best solution based on node variance minimization this number allows statistical inference from the sample of each node however in practice some nodes are expected to be quite higher and others lower or even zero it should be noted that soms reveal patterns of similarity with no causal attribution and therefore their interpretation should be performed with caution 3 results 3 1 rain on snow occurrence we identified 611 ros events in the study area during 2004 2014 ros events were more frequent in krkonoše 479 compared to jeseníky 132 fig 4 a the highest occurrence of ros was identified during november 17 8 and the lowest during february 6 2 the seasonal distribution of ros events differed between the mountain ranges ros in krkonoše mostly occurred during may 15 9 and in jeseníky during march 6 2 in contrast february saw the fewest ros events in both mountain ranges 6 2 since a single ros event can start in one month and end in the next one the occurrences are related to event start from the annual perspective the richest year in ros events was 2007 when 71 events occurred in krkonoše and 29 in jeseníky note that ros events can occur simultaneously in several individual catchments while only event start or event end can differ table 3 summarises the number of events from the runoff response perspective where almost half of all events caused negligible runoff 59 this means that most of the rain was retained in the catchment more ros events caused low runoff 23 than medium runoff 13 and only 5 of ros events resulted in high runoff the longest exceedance of q1 for a single event lasted for 28 h in the opava catchment jes op jeseníky nevertheless in regard to events causing high runoff none exceeded a 5 year return period or higher most high runoff events were identified in the modrý potok catchment kr mp krkonoše the time distribution of runoff types over the season is depicted in fig 4b which shows that ros events causing high runoff were mostly generated during november march and may 3 2 seasonal variability of rain on snow descriptors since the definition of ros events is based on meteorological inputs such as air temperature distinguishing between solid and liquid precipitation swe and rainfall the analysis of seasonal distribution of these descriptors over ros events was performed mean air temperatures in the catchments over the course of ros ranged between 2 2 c to 13 9 c the results showed that ros featured similar mean air temperature in krkonoše 2 8 c and in jeseníky 2 9 c temporal monthly distribution of the mean air temperature for individual ros events shows a similar pattern for both mountain ranges fig 5 a although in our study ros events were defined for air temperatures above tt which is unique for each catchment lower mean temperatures could occur as well this is because mean air temperature is calculated for the entire catchment and in some cases ros events do not occurs in the higher parts where the air temperature is bellow tt snow storage demonstrated the largest seasonal differences among the investigated ros descriptors analysis of initial swe shows that ros events are associated with considerably higher swe in krkonoše fig 5b here the highest mean values of initial swe were observed in april 229 mm and the lowest in november 35 mm in contrast the highest swe values in jeseníky were reached in march 72 mm with the lowest in november 20 mm event rainfall showed similar patterns in both mountain ranges for event rainfall and duration fig 5c d ros events are on average associated with more rain and longer rain durations 20 0 mm 19 h in krkonoše compared to jeseníky 13 2 mm 17 6 h ros events associated with the highest mean of rainfall amounts occurred in november in krkonoše 33 2 mm and in may in jeseníky 18 1 mm nonetheless total maximum rainfall 99 9 mm during one ros event was observed in the elbe catchment krkonoše in december 2007 3 3 hydrometeorological characteristics of runoff types several hydrometeorological descriptors for each runoff response type were analysed 1 negligible runoff 2 low runoff 3 medium runoff 4 high runoff these descriptors included snowmelt rainfall initial swe runoff and rainfall intensity and runoff coefficient fig 6 these analysis revealed different patterns among the runoff types and also between the two mountain ranges whereas snowmelt and rainfall increased with runoff type in krkonoše in jeseníky the event rainfall was lowest for runoff type 4 the greatest difference in jeseníky could be seen between types 3 and 4 while type 3 was mostly associated with higher rainfall compared to snowmelt mean values of water input in type 3 in krkonoše reached 38 5 mm 30 mm of rain 8 5 mm of snowmelt while jeseníky experienced only 26 7 mm 23 3 mm 3 4 mm as expected type 4 was initiated by the largest snowmelt and rainfall with mean water inputs of 62 0 mm 48 9 mm 13 1 mm in krkonoše and 26 9 mm 15 3 mm 11 6 mm in jeseníky details on water inputs for each runoff type are presented in fig 6a b since runoff response depends on initial catchment conditions initial swe within the ros area was analysed interestingly few differences were documented between runoff types initial swe values were mostly higher in krkonoše than in jeseníky which is depicted in fig 6c in krkonoše initial swe slightly decreased with runoff type while the lowest values were recorded for type 4 and highest for type 1 when the median reached 32 mm and 93 mm respectively in jeseníky the lowest initial swe values were recorded for type 2 21 mm and the highest for type 4 115 mm high snow cover in combination with high temperatures median 3 9 c clearly released a significant amount of meltwater resulting in high runoff in jeseníky comparing the input characteristics for krkonoše type 1 and jeseníky type 4 we found that mean initial swe krkonoše 133 mm jeseníky 119 mm and event rainfall krkonoše 14 0 mm jeseníky 15 3 mm were comparable the significant difference was identified within the mean snowmelt volumes krkonoše 5 7 mm jeseníky 11 6 mm runoff intensity represents how fast event runoff volume can be transported within a stream over ros runoff duration event runoff divided by rrd runoff intensity increases with runoff type in both mountain ranges but krkonoše shows higher runoff intensities compared to jeseníky fig 6d high runoff intensities were also associated with high rainfall intensity fig 6e although this effect was clear only in krkonoše high runoff in krkonoše was related not only to high volumes of rainfall but also to high rainfall intensity mean 1 8 mm h 1 in contrast high runoff in jeseníky was associated with the lowest rainfall intensity mean 0 75 mm h 1 maximum rainfall intensity 4 8 mm h 1 was recorded in krkonoše which resulted in low runoff as expected runoff coefficient c increased with runoff type in both mountain ranges the runoff coefficient also rarely exceeded 1 indicating higher runoff volume than incoming rainfall such high values of runoff coefficient were only documented in krkonoše and only for runoff types 2 3 and 4 fig 6f interestingly the highest runoff coefficient for jeseníky was identified within runoff type 4 although median rainfall was the lowest among all runoff types this means that high runoff in jeseníky was mainly driven mainly by snowmelt and only slightly by rainfall however runoff type 4 only contains four ros events therefore we have to interpret such results with caution we also investigated if the catchment fraction effected by ros influenced runoff response moreover we analysed the effect on event runoff of the snow covered area sca and runoff contributing area rca fig 7 runoff was not generated from the entire catchment in many cases since ros events only occurred in part of the catchment i e only below the freezing level and with sufficient snow cover the extent of the sca also matters because it represents the source of snowmelt during non ros conditions and potential for possible storage of rainwater these parameters can significantly influence runoff response the analysis revealed that the mentioned areal fractions differed between all runoff types and mountain ranges median rca fraction is 50 except runoff type 3 in jeseníky fig 7a in contrast median ros area fraction was less than 56 of the catchment area for all runoff types fig 7b in addition the highest snow area fractions were associated with medium runoff in krkonoše median 98 but highest sca resulted in negligible runoff in jeseníky median 81 fig 7c on the other hand sca within types 1 and 3 showed very similar coverage per mountain range ros responded in both mountain ranges with high runoff when snowpack extended over the smallest part of the catchment in contrast runoff type 4 was generated from the largest part of the catchments in both mountain ranges which documented high medians of rca fraction krkonoše 0 83 jeseníky 0 92 fig 7a high runoff was characterised in jeseníky by higher rca compared to the sca which means that runoff was also generated from snow free areas 3 4 temporal dynamics of rain on snow events better understanding of ros events requires analysis of the dynamics of hydrometeorological parameters over the course of the events fig 8 shows mean temporal evolution of the rca air temperature snowmelt volume and event runoff over the rrd to compare events of different duration from different catchments the rrd of all events was normalised where 0 is the start and 100 the end of an event first rca shrank over the course of the events for runoff types 1 and 2 fig 8a similar behaviour showed that mean air temperature decreased over time for runoff types 1 2 and 3 fig 8b the lowest temperatures were found during runoff type 3 and in contrast the highest temperatures were recorded for runoff type 4 for runoff type 3 temperature decreased over the course of the event which was consistent with decreasing snowmelt production shown in fig 8c in contrast a temperature increase was only identified for type 4 snowmelt fraction increased at the beginning for all runoff types during medium runoff events snowmelt only contributed a little to runoff fig 8c despite the event runoff constantly being second highest fig 8d this shows that medium runoff was mostly driven by rainfall with snowmelt as a secondary factor event runoff expectedly differed according to runoff type with the steepest increasing and decreasing limb in the hydrograph for runoff type 4 and the flattest curve for runoff type 1 3 5 classification of rain on snow events with self organizing maps for the detection of any meaningful classes between the ros events four variables were used as classifiers these were pevent initial swe runoff coefficient c and snowmelt they were chosen after considering two factors the first was maintaining representability of the processes involved in maximum runoff generation and second was to use the least correlated variables the resulting 16 groups of the som have a range between 8 and 118 events per node with a median of 25 5 which is quite close to the theoretical mean of 38 2 fig 9 each radar plot represents the standardized mean value of each variable per node group and are ordered regarding to event rainfall for instance in group 1 we have the 14 events with the highest rainfall low snowmelt and runoff coefficient and minimal initial swe these are the events in which rainfall is the key driver resulting mainly in high runoff runoff type 4 in contrast the 14 ros events within group 16 are classified by minimum rainfall but high runoff coefficient snowmelt and swe generating minimal event runoff runoff type 1 the rest of the nodes represent other combinations of the four classifying variables providing a rich mosaic of various ros event categories that can help us understand the relationship between climatic and hydrological variables to do so we further examined four additional key variables mean air temperature maximum runoff mean runoff contributing area and mean snow covered area that are linearly correlated to the four classifiers and see whether any nonlinear relationships appear fig 10 as expected the groups dominated by high or medium runoff types 3 and 4 are linked to high rainfall groups 1 2 temperature group 14 or both group 3 these are groups with a small number of events except for group 2 40 events which consists of events with extremely low air temperature and thus snowmelt low initial snow water equivalent and rca and varying sca its main difference from group 1 is the amount of rainfall which in the latter case is quite high on the other hand group 14 is driven solely by temperature it represents a small number of events that occurred in spring and generated rather high maximum runoff it is interesting to compare it with group 16 which mainly represents late spring events has similar rainfall and snowmelt behaviour but results in negligible runoff perhaps the answer may lie in the difference in initial snow conditions higher swe sca for group 14 group 3 consists of events with high qmax and c that are driven by high temperature and medium rainfall these are events that occurred exclusively in autumn and spring and even though the snow covered area is smaller their runoff contributing area is larger the last medium runoff group group 6 has a broad rainfall range under low temperature conditions the maximum runoff and runoff coefficient are high as well as initial snow amount and coverage the regime seems to be similar to group 14 but with the values of climatic variables reversed high rainfall low temperature among the groups with low or negligible runoff group 5 89 events from october to may is a reasonable candidate for the most representative group of ros events even though group 15 has a higher number of events 119 rainfall is minimal and offers no real insight into the processes involved in contrast group 5 is characterized by medium rainfall under cold air temperature low snowmelt and snow water equivalent and medium runoff contribution and snow covered areas group 5 events generate low maximum runoff and have one of the lowest runoff coefficients as expected from runoff type 1 this is not the case though for the 27 events of group 4 in these events approximately 30 more rainfall and a two degree increase in air temperature result in maximum runoff that is comparable to medium and high runoff types 3 and 4 further comparison with the high runoff events and group 3 in particular reveals that even though both groups have similar rainfall group 4 presents high initial snow amount and coverage which could restrain total runoff at lower temperatures another noteworthy comparison between runoff type 1 is between group 7 and group 8 these groups have identical climatic conditions and very similar snow water equivalent and coverage but result in extremely different snowmelt further investigation showed that group 7 consists of events that occurred solely in the krkonoše mountains providing some insight into the importance of catchment properties in snowmelt the rest of the groups contain a reasonable number of events from both mountain ranges although group 10 and group 13 are dominated by events over the jeseníky mountains summary of the major groups 1 2 3 5 14 of ros events according to som is depicted in table 4 4 discussion 4 1 rain on snow events characteristics the absolute number of identified events can depend beside other things on the ros definition and subsequent selection criteria in particular thresholds for swe and rain can affect the number of identified ros events however a preliminary sensitivity analysis revealed that the presented patterns of ros characteristics remain similar even if the limits for minimum cumulative rainfall and swe are changed swe 20 mm rainfall 10 mm nonetheless a unified international definition of ros is needed to make results of different studies comparable in addition estimation of the exact amount of liquid precipitation and spatial distribution of snow is also challenging rain intensity is usually not constant over a catchment at a given moment furthermore snow cover is distributed unevenly in the catchment because of changing topography and related snow transport these issues introduce uncertainty into the computation of water inputs and rain affected area in general weather conditions govern the temporal distribution of ros over the cold season low occurrence of ros during february was usually caused by lower frequency of liquid precipitation due to low temperatures in contrast high numbers of ros events were observed during months when rainfall is more probable and the snowpack featured sufficient swe during november catchments usually experience the first snow with low swe which often melts may is typified by high temperatures frequent rain and a ripped snowpack with shallow snow depths but high densities our results thus partially agree with study of freudiger et al 2014 who reported ros occurrence in the uplands of german catchments from december to april in contrast other studies from the european region describing floods initiated by ros in october rössler et al 2014 december garvelmann et al 2015 or january to march freudiger et al 2014 thus we can assume that ros occurrence varies with regional conditions despite their close proximity even the two mountain ranges analysed here showed different ros frequencies fig 4 we argue that this can be caused by slightly different synoptic and climate patterns combined with local peculiarities jeseníky is more influenced by ombric continentality causing lower precipitation during the winter season on the other hand the krkonoše mountains received more precipitation in the snow seasons mean 672 mm over the study period compared to jeseníky mean 387 mm due to frequent w and sw winds bringing humidity from the atlantic tolasz 2007 žák 2021 lower precipitation in jeseníky can also be caused by their lower mean elevation compared to krkonoše table 1 different patterns in ros related to climate were also found by li et al 2019 who pointed out that the western mountain ranges of the usa are affected by ros more frequently than the eastern mountain ranges important aspects within the ros analysis are the meteorological conditions which can be used as a proxy for further hydrological modelling and forecasting of hydrological consequences moreover we can directly compare these meteorological conditions during ros with other studies our results show that identified ros events were characterised by similar mean air temperatures compared to other european regions würzer et al 2016 found that 90 of 1063 ros in the swiss alps exceeded 1 7 c and garvelmann et al 2015 reported 1 9 c and 4 4 c respectively for two ros events in the black forest germany as expected the high runoffs were associated with the high air temperatures initializing intensive snowmelt fig 8b c which also reported würzer and jonas 2018 the importance of snowmelt contribution to high runoff generation or even floods is also emphasized by other studies garvelmann et al 2015 li et al 2019 wayand et al 2015 würzer and jonas 2018 in most cases snowmelt production at the end of the ros event is higher than event runoff compare fig 8c and d this can be explained by the snowmelt runoff process when not all produced snowmelt appears in a stream but can be stored in the soil underneath or in the snowpack kattelmann 1987a woelber et al 2018 furthermore snowmelt volume is not only dependent on air temperature but also on snow volume i e swe and sca this is probably the case in the modrý potok catchment which showed the most ros events resulting in high runoff this catchment is located on the leeward part of the mountain and thus accumulates high amounts of snow which can often reach about 10 m hejcman et al 2006 this in combination with southern aspects enables high snowmelt rates and prolonged the snow and thus ros season nevertheless the reported typical maximum values of swe during the identified ros events are comparable with garvelmann et al 2015 who reported the highest swe of 289 mm during ros in december in the black forrest studies from other regions refer to even higher maximum precipitation values for instance during mid winter an ros event in the british columbia canada saw 343 mm of rain trubilowicz and moore 2017 and 613 mm in the swiss alps würzer et al 2016 additionally the recorded maximum rainfall intensity during ros over czech catchments was about half compared to another study conducted in the swiss alps würzer et al 2016 on the other hand würzer et al 2016 reported a mean rain duration of about 18 h ranging from 3 to 96 h which is comparable to our study runoff coefficient varied with the runoff group and in some cases runoff volume even exceeded incoming rainfall high runoff coefficient for ros events already described in merz et al 2006 for the austrian catchments we assume that values over 1 can be caused mainly by a combination of two factors 1 during ros a substantial amount of snowmelt can be induced due to positive air temperature and additional heat energy from rain and wind 2 a wet snowpack starts to release pre event water stored in its pores liquid water content while this water is pushed by the incoming rainwater this mechanism can be described as a piston flow effect feng et al 2001 juras et al 2017 unnikrishna et al 2002 previous physical experiments showed that rainwater contributed about 20 50 to snowpack runoff juras et al 2017 the som classification highlighted that ros events present very rich patterns with various combinations between climatic conditions initial snow regime and runoff behaviour as a general remark rainfall is the main driver of maximum runoff and runoff in general however the events that are associated with the high rainfall can result to either high group 1 or medium runoff groups 2 types with events in group 2 appearing three times more often compared to the events of group 1 table 4 temperature is found to have a secondary role amplifying or weakening runoff response depending on initial snow water equivalent it is likely that there might be some temperature threshold controlling the role of existing snow amount to enhance or constrain the intensity of ros events this is a plausible interpretation of the comparison between group 3 and group 4 but a clear relationship remains inconclusive it might seem counter intuitive but the representation of the enhanced variety in the ros event features is one of the main benefits of using som or any other classification algorithm because it reveals the underlying complexity of the phenomenon 4 2 the role of snowpack in runoff generation during rain on snow the effect of snow cover on runoff generation is ambiguous on the one hand snowpack holds rainwater and on the other snowmelt strengthens runoff the results show that not only swe but also sca plays an important role in generating ros event runoff the vast majority of the analysed ros events 82 caused only negligible or low event runoff this means that most of the incoming rainfall during ros was held by the snow covered catchment which involves retention in the snowpack soil or canopy the snowpack itself can also store a significant amount of rainwater but the holding capacity of snowpack changes during the season and depends on snow properties like microstructure fierz 2009 singh and singh 2001 self organizing maps revealed that during the 27 ros events group 4 snow cover most significantly prevented extensive runoff this is because high rainfall median 29 1 mm over a sufficient snowpack medians swe 214 mm sca 99 caused only 3 8 mm median of the event runoff although relatively high qmax 0 9 mm h 1 was also reached during these events this was probably caused by high baseflow and not by event runoff high rainwater storage by snow covered catchments can be also seen within the 54 ros events groups 1 2 which received the highest amount of rainfall but about 76 81 was stored in the catchment and only a little portion appeared in runoff this fact is documented by the lowest water budget and relatively low runoff coefficient fig 10 groups 1 and 2 are also related to low swe and shallow snowpack which can only store a limited amount of liquid water therefore within these groups it was most likely that the rainwater was also stored in the soil or retained by the vegetation cover because swe was often insufficient to hold such amounts of water although a significant amount of rainwater was stored during ros events within groups 1 and 2 total water input was so significant that stream runoff reacted with a massive increase the highest runoffs groups 1 and 3 were associated with high inputs of meltwater in combination with high rainfall fig 6 but also with the lower swe and sca fig 10 this is in agreement with other studies e g rücker et al 2019 würzer and jonas 2018 on the other hand significant runoff response occurred also during 21 ros events group 6 when sufficient snow cover sca 100 swe 269 mm median was hit by a considerable amount of rain median 18 3 mm runoff responded with high qmax and c which could be explained by two effects first the combination of high baseflow and event runoff second the higher amount of discharged water can also be generated due to the piston flow effect when incoming rainwater pushes out less mobile meltwater the piston flow effect is closely discussed in section 4 1 both effects can also explain the runoff reaction of group 14 fig 10 when mostly lower amounts of rainfall resulted in the highest runoff coefficients and even in runoff excess within group 14 positive water budget surprisingly we do not see similar runoff reactions within ros events of group 7 featured by the highest snowmelt and rainfall comparable to group 6 nevertheless the most significant difference between group 7 and groups 6 and 14 is lower swe sca and ros affected area the highest qmax groups 1 4 6 14 were rarely generated from the entire catchment area in particular when rca is smaller than sca fig 7 and fig 10 then runoff is generated mostly within the snowpack würzer and jonas 2018 reported that in swiss catchments high runoff was connected to snow cover together with high air temperatures moreover they emphasize the significance of sca while snow free parts of the catchment caused higher runoff earlier compared to snow covered parts our results are ambiguous regarding this issue and therefore cannot support their conclusions about high runoff timing surprisingly most of the ros events resulting in high runoff supported by high snowmelt group 1 3 occurring during early winter nov dec n 14 and only few n 6 occurred during spring apr may this finding differs from the study of würzer and jonas 2018 which reported most of highest runoffs during spring months however snowmelt water does not necessarily have to propagate to streamflow some part of snowmelt is usually stored in the snowpack or infiltrates into the soil woelber et al 2018 this can be clearly seen in group 7 and partially in group 16 where a significant amount of snowmelt appeared over the course of ros but apparently only a fraction appeared in the runoff the importance of snowmelt during runoff generation can also be documented by comparison of groups 5 and 10 eventhough both groups are characterised by similar snowpack and water input median 24 1 mm and 24 9 mm respectively group 10 caused double the qmax and qevent this can be explained by different snowmelt volumes where in group 5only 8 of the water input was snowmelt compared to 54 within group 10 4 3 uncertainties of modelling and analysis a potential uncertainty in simulating swe data may be the threshold temperature for precipitation phase partition and snowmelt threshold temperature controls the amount of snowfall and thus snow storage and it was calibrated by the hbv model separately for each catchment testing of different hbv model structures which was recently done partly over the same study area did not show a considerable improvement of use i e two threshold temperatures with linear or exponential functions for precipitation phase partition between these two threshold temperatures girons lopez et al 2020 overall the study by girons lopez et al 2020 tested 64 modifications of the hbv model snow routine and showed that the original snow routine also used in our study included in the hbv model provided relatively good results although some modifications might represent an interesting alternative such as using an exponential snowmelt function or seasonally variable melt factor nevertheless increased model complexity does not necessarily mean better model ability to reproduce swe and runoff uncertainty issues resulting from swe data used for ros analysis might be overcome by using an energy balance approach which would better reflect the physical nature of the snowmelt process however our analysis was done at a multi catchment level over a broader region which did not allow for the use of energy balance approaches since sufficiently dense input data from climate stations are only available for precipitation and air temperature other necessary meteorological data do not sufficiently cover the whole region and elevation extent or they are even missing in general energy balance calculations are usually employed at a site level see i e hotovy and jenicek 2020 moeser et al 2020 and such approaches are not easily transferable to larger regions for which the degree day approach is widely used freudiger et al 2014 or they even rely on observed swe data mccabe et al 2007 however we introduced a downscaling approach of daily snowmelt data to hourly step to reflect its diurnal cycle eq 1 the limitation of this approach is clearly the fact that the diurnal cycle has been considered only for days when snowmelt was simulated by the hbv model due to a lack of data we ignored snow microstructure in the analysis although this factor plays a crucial role in water movement storage and release juras et al 2017 würzer et al 2017 moreover detailed snowpack data are usually provided at a point scale which is not necessarily representative for the catchment scale würzer and jonas 2018 waldner et al 2004 reported that a heterogeneous snowpack is more often connected to preferential flow contrary to matrix flow which appears more likely in homogenous snow although rainwater can be transported faster through preferential flow paths hirashima et al 2010 juras et al 2017 waldner et al 2004 a considerable amount of liquid water can also be stored above capillary barriers avanzi et al 2016 beside the above mentioned hydrometeorological descriptors runoff generation during the ros is also driven by individual catchment characteristics such as the presence and type of forest bedrock aspect or slope kattelmann 1987b li et al 2019 for instance we can assume that forested catchments would respond differently to the given ros event compared to catchments with less or no portion of forest first precipitation is usually reduced in forested catchments due to canopy interception beria et al 2018 second snowmelt production is usually lower compared to open sites due to less snow and reduction of solar radiation and turbulent heat exchange garvelmann et al 2014 however more studies relating to catchment characteristics and runoff response would be beneficial to even better understand runoff generation during ros 5 conclusions employing hbv model and geomorphological catchment characteristics we identified 611 ros events over the study period of 10 winter seasons 2004 2014 most ros events did not cause a significant runoff increase identified ros events were sorted into four types according to runoff response furthermore with self organising maps 16 groups of ros events with similar characteristics were classified that helped us shed some light on the links between hydrometeorological descriptors and runoff response our results revealed that snowpack is an important element protecting catchments against floods because 82 of ros events resulted in low or negligible runoff we argue that this is probably a consequence of high storage potential of snow covered catchment while a sufficient volume of incoming rainfall did not appear directly in runoff in contrast when heavy rainfall met shallow and sparsely distributed snow cover supported by intense snowmelt streamflow responded mostly with high runoffs high rainfall or snowmelt alone were usually not strong enough to initiate high runoffs nevertheless the highest runoffs were not extreme while only 29 ros events exceeded a 1 year return period but not higher seasonal distribution of ros also plays its role in runoff response medium or high runoffs were mostly observed during late autumn or spring when snowpack is usually low and high air temperatures support intense snowmelt despite the spatial proximity of investigated mountain ranges we found that the frequency and magnitude of the main drivers governing runoff response differ significantly ros events were more frequent in the krkonoše mts where they also caused higher runoffs this dissimilarity is likely because of less precipitation in the jeseníky mts due to different climatic patterns we hope that our study may contribute to better forecasting of ros runoff response over low and medium mountain ranges in central europe further research should be oriented to the implementation of catchment characteristics and snowpack structure which can bring even better insights necessary for the understanding of ros events and subsequent runoff response credit authorship contribution statement roman juras conceptualization formal analysis supervision methodology data curation writing original draft visualization johanna r blöcher methodology data curation visualization funding acquisition formal analysis writing original draft michal jenicek methodology data curation formal analysis writing original draft visualization ondrej hotovy formal analysis writing review editing yannis markonis methodology writing original draft visualization formal analysis declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we would like to thank the internal grant agency of faculty of environmental sciences czech university of life sciences prague project no 20184236 and the charles university grant agency project no gauk 272119 for financial support of this research we are also grateful to the czech hydrometeorological institute that provided hydrological and climatic data thanks are due to mark sixsmith who carefully proofread the manuscript and ondřej ledvinka from chmi for providing hydrological data and valuable comments appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 127002 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
3904,rain on snow ros events influence the hydrological regime of rivers in regions with seasonal snow cover although ros events are often related to floods they do not always cause severe runoff during ros the snowpack has an ambiguous effect on runoff generation it can either store a significant portion of rain or amplify runoff by additional snowmelt there is a need to understand under what circumstances ros events produce runoff we analysed eleven years of hourly meteorological snow water equivalent and streamflow data from 15 catchments located in two mountain ranges in czechia we identified 611 ros events which were further analysed and classified using selected meteorological snow and runoff indices the analysis of the runoff response of all ros events revealed that only 5 of them resulted in high runoff exceeding the 1 year return period but most of the events 82 did not cause any significant runoff increase employing self organising maps enabled us to categorise the events and better understand what combination of hydrometeorological characteristics leads to various runoff responses high volumes of rain together with low snow cover were identified as important factors in the generation of high runoffs in contrast a deep and extended snowpack affected by rain under low air temperatures usually caused lower runoffs the results of this study showed the importance of the snowpack which can often prevent extreme runoff even when a large amount of rainfall occurs understanding the hydrological regime of ros is becoming even more important with the ongoing decline of the snowfall fraction and subsequent changes in snow storage keywords snow hydrology snowmelt runoff generation rain on snow self organising maps 1 introduction rain on snow ros events have been in the focus of hydrologists in recent decades and blöschl et al 2019 addressed ros as one of the twenty three unsolved hydrological problems in the context of complex water management ros events are often associated with natural hazards such as floods badoux et al 2013 mccabe et al 2007 pomeroy et al 2016 rössler et al 2014 avalanches baggi and schweizer 2008 conway and raymond 1993 haywood 1988 or slushflows clark et al 2009 decaulne and saemundsson 2006 often with severe consequences for human lives health and property for instance floods in the bernese alps switzerland in 2011 rössler et al 2014 or large floods in alberta canada in 2013 cost millions of dollars and caused the evacuation of thousands of inhabitants pomeroy et al 2016 since global precipitation patterns are changing markonis et al 2019 the frequency of ros is changing as well this is mainly because of rising air temperatures at high elevations dong and menzel 2019 marty et al 2017 pepin et al 2015 and changes in global atmospheric circulation cassou and cattiaux 2016 these changes impact snow cover and precipitation and therefore ros events snow cover depth and the number of days with snow on the ground beniston et al 2018 dong and menzel 2019 marty et al 2017 snow density zhong et al 2014 as well as snowfall fraction li et al 2020 are decreasing in many regions of the world notarnicola 2020 in the main river catchment in germany ros events were found to be an important factor for runoff generation above the elevation of 400 m sui et al 2010 however changes in elevation and temporal distribution of ros can be expected in the future musselman et al 2018 predicted that ros in the usa will be more frequent at higher elevations and will shift from spring to winter many historical floods in the usa are associated with ros events originating at elevations of 1000 1500 m above sea level a s l moreover ros are predicted to originate even above 2000 m li et al 2019 this is mainly because increasing temperatures results in more frequent liquid rather than solid precipitation at higher elevations musselman et al 2018 additionally a similar trend in the change in precipitation can be observed in the arctic bintanja 2018 and in europe jacob et al 2014 the most severe floods from ros events are usually associated with simultaneous snowmelt which can contribute considerably to runoff sui et al 2010 reported that in the main river watershed snowmelt contributed between 23 and 64 of an equivalent precipitation depth during ros another study from north western usa reports that maximum snowmelt contribution during ros varied between 2 and 47 wayand et al 2015 trubilowicz and moore 2017 showed that snowmelt enhanced snowpack runoff from a lysimeter by about 25 nevertheless the contribution of heat energy from rain to the total melt is usually only up to 10 at daily and longer temporal resolutions hotovy and jenicek 2020 li et al 2019 trubilowicz and moore 2017 also the main contributor to melt production usually differs depending on the locality and meteorological conditions during the ros event li et al 2019 reported that the dominant factor in western usa was net radiation but in eastern usa both net radiation and turbulent heat flux contributed equally to snowmelt production during ros this supports a study from germany where during ros snowmelt was mostly initiated by the turbulent exchange of latent and sensible heat in open sites whereas longwave radiation and turbulent fluxes contributed equally to snowmelt in forested sites garvelmann et al 2014 dominance of turbulent heat exchange as a main contributor for snowmelt during ros was also reported in würzer et al 2016 in the swiss alps although ros events can cause an increase in runoff not all ros events do so the snowpack can store a considerable amount of incoming rainwater and thus may generate reduced or even zero runoff previous field experiments conducted by juras et al 2017 showed that snowpack temporarily stored up to 70 of incoming rainwater volume about 40 mm the actual storage potential for the rainwater is controlled by the snow ripeness and snowpack physical properties such as grain shape grain size singh and singh 2001 and layering especially the presence of capillary barriers avanzi et al 2016 wayand et al 2015 showed that half of the largest investigated ros events in north western usa did not cause floods kattelmann 1987b reported that forested catchments even stored all rainwater during ros and generated no additional snowpack outflow snow also insulates the ground and prevents it from freezing more water is able to infiltrate into unfrozen soil compared to frozen soil seibert et al 2014 previous studies showed that runoff can often be generated faster and with higher magnitude from snow free areas seibert et al 2014 these facts emphasize the ambiguous effect and importance of snowpack on the hydrological regime during ros and the need to understand why and when ros events produce exceptional runoff blöschl et al 2019 although several studies have focused on modelled runoff response würzer et al 2016 würzer and jonas 2018 or on single events garvelmann et al 2015 rössler et al 2014 empirical analyses of the extended ros events dataset using measured streamflow at an hourly resolution are rather rare merz et al 2006 or even missing in many regions with seasonal snow cover additionally there is still limited knowledge of the role of individual climate and snowpack characteristics which control the dynamics of runoff response many of the studies were performed in the usa or the european alps to fill this knowledge gap we set the main objectives of our study to 1 identify past ros events in low altitude central european mountain ranges and analyse their characteristics in terms of seasonal variability and runoff response and 2 classify the ros events according to major drivers controlling runoff response our methods also account for the fact that only a part of the catchment contributes to runoff during the specific ros event due to strong dependence of snowmelt on air temperature at specific elevation explaining the causes leading to high runoff during ros events is one of the unsolved scientific problems in hydrology recently defined by the hydrological community blöschl et al 2019 our study benefits from 11 years of hourly climatological and hydrological data from 15 catchments at different elevations the focus on elevation is important because ros events highly depend on air temperature influencing the phase of precipitation which also influences the fraction of the catchment contributing to runoff 2 material and methods 2 1 study area the hydrological response of ros events was analysed for 15 catchments fig 1 table 1 in the two highest czech mountain ranges or in very close proximity to them krkonoše or giant mountains and jeseníky in the sudetes region czechia for 10 cold seasons 2004 2014 nov 1st to may 31st two catchments kr cs jes bp only covered 2005 to 2014 due to data gaps the catchments were selected based on large snow storage during winter and thus the potential of ros occurrences and the availability of adequate data the catchments were chosen to be as natural as possible without dams or water transfers even though the catchments are partly urbanised and include some ski resorts the total extent of such areas is minor or negligible the location and basic characteristics of catchments are depicted in fig 1 and summarized in table 1 the elevation range of all catchments is from 438 m to 1602 m a s l and the area varies in size between 2 6 and 181 3 km2 the land cover of the catchments is characterized by coniferous forests prevailing european spruce picea abies while the highest parts of the catchments are usually above the tree line partially covered by mountain pine pinus mugo shrubs the forest coverage ranges between 26 and 93 and areas above 1 400 m a s l are mountain tundra 2 2 rain on snow events 2 2 1 rain on snow event definition a ros event was defined as the period of rain occurring simultaneously with snow laying on the ground specifically when snow water equivalent swe 10 mm air temperature threshold temperature tt and rainfall 0 mm 2 2 2 input data and modelling approaches meteorological and runoff data were acquired from the czech hydrometeorological institute chmi air temperature streamflow and precipitation were provided in an hourly time step observed snow water equivalent swe data were only available in a weekly time step measured every monday rain on snow can vary with elevation and may differ across the catchment in order to include elevation in the analysis we used the semi distributed bucket type hbv model in its software implementation hbv light lindström et al 1997 seibert and vis 2012 to obtain spatial distribution of precipitation air temperature snowmelt and swe and to estimate the precipitation phase across elevations note that runoff used in this study was not modelled but measured the model was chosen for its comprehensive snow accumulation and snowmelt routine and the robust way of model calibration the snow routine included in the model uses a degree day approach which calculates snow accumulation and snowmelt including snow water holding capacity and potential refreezing of meltwater the main inputs of the model form time series of daily mean air temperature daily precipitation and monthly mean potential evapotranspiration pet the pet values were calculated by the temperature based method presented by oudin et al 2005 additionally daily lapse rates for air temperature were calculated from observed data received from two neighbouring stations located at different elevations precipitation phase partitioning was performed using a single threshold temperature tt approach the value of tt was calibrated separately for each catchment details regarding model structure can be found in several studies girons lopez et al 2020 seibert and vis 2012 the hbv light model was calibrated automatically for each study catchment against observed runoff and swe using a genetic optimization algorithm seibert 2000 for the hydrological years 2004 2009 2006 2010 for two catchments with shorter time series a combination of three objective criteria was used to evaluate goodness of fit of the model 1 logarithmic nash sutcliffe efficiency for runoff nash and sutcliffe 1970 2 nash sutcliffe efficiency for swe and 3 volume error for runoff the main emphasis was put on model ability to reproduce the observed swe the model was validated for 2010 2014 ten different optimized parameter sets resulting from ten calibration runs were used to create ten simulations the median simulation was used for further analysis the results of model calibration and validation are shown in supplement table s1 fig s1 a similar approach for model calibration was also used by jenicek and ledvinka 2020 for partly the same study region simulated daily snowmelt was downscaled to an hourly step considering its diurnal cycle using the method of tobin et al 2013 as follows 1 m x t a r t x t t t n 0 t x t t t t x t t t where t x t is the air temperature at a given elevation zone x at a given hour t parameter ar represents a constant degree day factor mm c day 1 and tt is a threshold temperature above which snowmelt can occur both ar and tt were calibrated by the hbv model as described above and particular values are presented in table s1 in the supplement 2 2 3 catchment division semi distributed approach catchment division enables detailed spatial assessment of runoff response which depends on the fraction of the catchment area involved in the runoff generation process since the meteorological input data were not available in gridded form the semi distributed approach was used as the best available method to estimate area portion contributing to ros or runoff each catchment was divided into 100 m high elevation zones between 450 m and 1650 m a s l in these zones snow water equivalent swe snowmelt and ros occurrence were modelled see section 2 2 2 total swe and snowmelt per catchment were calculated as a weighted mean and a weighted sum respectively where the area of a given zone represented the weight the area of each elevation zone was calculated according to the hypsographic curve for each catchment these curves were constructed based on a digital elevation model with a resolution of 1 arcsec lat 50 20 m farr et al 2007 using a modified hypsometric function included in the hydrotsm package zambrano bigiarini 2020 in the r language r core team 2019 mean air temperature was then calculated as an average of the highest and lowest point temperature of the catchment the snow covered elevation zone was determined when swe 0 mm otherwise the zone was considered snow free runoff contributing area rca represents the sum of elevation zone areas where runoff occurred either by snowmelt or by rain in other words rca represents the area located below the freezing level defined by threshold temperature tt fig 2 finally we calculated the relative fraction of each specific zone described above to the entire catchment area a graphical interpretation of the concept is depicted in fig 2 2 2 4 rain on snow event selection ros events were identified for every hour and each elevation zone to be able to estimate the fraction of catchment affected by ros hereafter ros area total ros area was calculated as a sum of elevation zones affected by ros next we defined ros runoff duration rrd as a period of a ros event extended by the subsequent runoff response fig 3 from the initial selection above we further created a subset of events when at least 5 mm of cumulative rain was recorded the rrd was shorter than 144 h and runoff increase was detected multiple events were characterised by two or more ros events in one rrd with a time gap between rain onsets shorter than 96 h for longer time gaps the events were classified as two separate events 2 3 hydrograph analysis for streamflow analysis the original discharge data were recalculated to runoff depth mm rainfall and streamflow parameters used in this study are defined in the following fig 3 is a graphic conceptualization of the main hydrograph parameters the following parameters were estimated event start corresponds to rain onset of the ros event event end was calculated from the falling limb of the hydrograph based on the constant k method according to blume et al 2007 2 k d q obs dt 1 q obs t where qobs mm represents observed runoff at a specific hour t after visual validation of the method parameter k was smoothed to avoid discrepancies caused by occasional high volatility in runoff data event end was set when the absolute value of k 3 hour moving average reached the limit 1e 2 event rainfall pevent represents total amount of rain mm recorded at the closest meteorological station during an ros event fig 1 event runoff qevent represents total runoff volume caused by ros mm event runoff was distinguished from base flow qbase by the linear separation method depicted in fig 3 dingman 2015 we assume that the observed runoff only consists of base flow during the first and last hour of the event linear interpolation between these two points gives us a separation line between two runoff components where event runoff is above this line and base flow below it event runoff can be thus calculated as 3 q event t t 1 n q obs t q base t where qobs mm is observed runoff and qbase mm is base flow runoff linearly interpolated between the first and last hour of observed runoff in a single rrd n represents the number of hours of the event and t represents iteration for a given hour runoff coefficient c is the ratio of event runoff qevent to event rainfall pevent water budget wb defines the difference between qevent and pevent mm a negative wb represents water storage in the catchment whereas a positive wb indicates runoff excess we neglected other physical processes such as evapotranspiration sublimation or condensation in the wb calculation 2 3 1 runoff types the resulting ros events were divided into four types according to event runoff named negligible runoff low runoff medium runoff and high runoff table 2 this categorisation helps to better describe precursors of different hydrological responses to ros the ros event was classified as type 1 negligible runoff if cumulative event runoff did not exceed 25 of cumulative baseflow the ros event was classified as type 2 low runoff if cumulative event runoff exceeded 25 but not 75 of cumulative baseflow the ros event was classified as type 3 medium runoff if cumulative event runoff exceeded 75 of cumulative baseflow anytime during the course of the rrd and ros events of runoff type 4 high runoff were selected from the previously defined types if observed runoff qobs exceeded the 1 y return period q1 2 4 events clustering self organizing maps one of the key questions is how to detect which hydrometeorological conditions lead to increased runoff or even to floods and which do not a possible approach is classification of the conditions related to specific ros events with some data driven clustering technique to further categorize ros events and detect some patterns in their characteristics the self organizing map som technique was applied it is based on a data driven iterative algorithm used to classify the original multivariate dataset into some representative categories the algorithm is presented in detail by kohonen 1990 while numerous applications of soms in water resources can be found in the work of kalteh et al 2008 the basic principle of the method is to create a two dimensional output layer of nodes where each node attracts members of the original dataset with common features in our case these are ros events the next step is to decide which properties will be used as descriptors or classifiers i e event rainfall and initial swe in this example with each iteration of the algorithm events with similar rainfall and swe will move closer to each other this procedure is repeated until there is no change in the number of events per node finally all events that have similar descriptors will cluster over different nodes and each node can then be regarded as an individual group an advantage of the som algorithm lies in the fact that there is no need for preselecting the constraints of each group the number of nodes must be predefined though however there is no standard approach to determine the number of nodes in most studies various experiments are performed with soms of different sizes there is a significant amount of subjectivity in the selection of node number usually it is based on a balance between the homogeneity of different clusters and comprehensibility of the classification scheme chang et al 2010 ley et al 2011 markonis et al 2018 markonis et al 2021 rousi et al 2017 in this study a range of som sizes between 9 and 36 was examined for symmetrical topologies i e 3 3 to 6 6 using the kohonen package in r language wehrens and kruisselbrink 2018 to select the most representative one we used the node variance minimization approach markonis and strnad 2020 the som with the minimum variance between its nodes has dimensions of 4 4 nodes which corresponds to a theoretical average of 38 events per node clustering ros events into 16 groups brings the best solution based on node variance minimization this number allows statistical inference from the sample of each node however in practice some nodes are expected to be quite higher and others lower or even zero it should be noted that soms reveal patterns of similarity with no causal attribution and therefore their interpretation should be performed with caution 3 results 3 1 rain on snow occurrence we identified 611 ros events in the study area during 2004 2014 ros events were more frequent in krkonoše 479 compared to jeseníky 132 fig 4 a the highest occurrence of ros was identified during november 17 8 and the lowest during february 6 2 the seasonal distribution of ros events differed between the mountain ranges ros in krkonoše mostly occurred during may 15 9 and in jeseníky during march 6 2 in contrast february saw the fewest ros events in both mountain ranges 6 2 since a single ros event can start in one month and end in the next one the occurrences are related to event start from the annual perspective the richest year in ros events was 2007 when 71 events occurred in krkonoše and 29 in jeseníky note that ros events can occur simultaneously in several individual catchments while only event start or event end can differ table 3 summarises the number of events from the runoff response perspective where almost half of all events caused negligible runoff 59 this means that most of the rain was retained in the catchment more ros events caused low runoff 23 than medium runoff 13 and only 5 of ros events resulted in high runoff the longest exceedance of q1 for a single event lasted for 28 h in the opava catchment jes op jeseníky nevertheless in regard to events causing high runoff none exceeded a 5 year return period or higher most high runoff events were identified in the modrý potok catchment kr mp krkonoše the time distribution of runoff types over the season is depicted in fig 4b which shows that ros events causing high runoff were mostly generated during november march and may 3 2 seasonal variability of rain on snow descriptors since the definition of ros events is based on meteorological inputs such as air temperature distinguishing between solid and liquid precipitation swe and rainfall the analysis of seasonal distribution of these descriptors over ros events was performed mean air temperatures in the catchments over the course of ros ranged between 2 2 c to 13 9 c the results showed that ros featured similar mean air temperature in krkonoše 2 8 c and in jeseníky 2 9 c temporal monthly distribution of the mean air temperature for individual ros events shows a similar pattern for both mountain ranges fig 5 a although in our study ros events were defined for air temperatures above tt which is unique for each catchment lower mean temperatures could occur as well this is because mean air temperature is calculated for the entire catchment and in some cases ros events do not occurs in the higher parts where the air temperature is bellow tt snow storage demonstrated the largest seasonal differences among the investigated ros descriptors analysis of initial swe shows that ros events are associated with considerably higher swe in krkonoše fig 5b here the highest mean values of initial swe were observed in april 229 mm and the lowest in november 35 mm in contrast the highest swe values in jeseníky were reached in march 72 mm with the lowest in november 20 mm event rainfall showed similar patterns in both mountain ranges for event rainfall and duration fig 5c d ros events are on average associated with more rain and longer rain durations 20 0 mm 19 h in krkonoše compared to jeseníky 13 2 mm 17 6 h ros events associated with the highest mean of rainfall amounts occurred in november in krkonoše 33 2 mm and in may in jeseníky 18 1 mm nonetheless total maximum rainfall 99 9 mm during one ros event was observed in the elbe catchment krkonoše in december 2007 3 3 hydrometeorological characteristics of runoff types several hydrometeorological descriptors for each runoff response type were analysed 1 negligible runoff 2 low runoff 3 medium runoff 4 high runoff these descriptors included snowmelt rainfall initial swe runoff and rainfall intensity and runoff coefficient fig 6 these analysis revealed different patterns among the runoff types and also between the two mountain ranges whereas snowmelt and rainfall increased with runoff type in krkonoše in jeseníky the event rainfall was lowest for runoff type 4 the greatest difference in jeseníky could be seen between types 3 and 4 while type 3 was mostly associated with higher rainfall compared to snowmelt mean values of water input in type 3 in krkonoše reached 38 5 mm 30 mm of rain 8 5 mm of snowmelt while jeseníky experienced only 26 7 mm 23 3 mm 3 4 mm as expected type 4 was initiated by the largest snowmelt and rainfall with mean water inputs of 62 0 mm 48 9 mm 13 1 mm in krkonoše and 26 9 mm 15 3 mm 11 6 mm in jeseníky details on water inputs for each runoff type are presented in fig 6a b since runoff response depends on initial catchment conditions initial swe within the ros area was analysed interestingly few differences were documented between runoff types initial swe values were mostly higher in krkonoše than in jeseníky which is depicted in fig 6c in krkonoše initial swe slightly decreased with runoff type while the lowest values were recorded for type 4 and highest for type 1 when the median reached 32 mm and 93 mm respectively in jeseníky the lowest initial swe values were recorded for type 2 21 mm and the highest for type 4 115 mm high snow cover in combination with high temperatures median 3 9 c clearly released a significant amount of meltwater resulting in high runoff in jeseníky comparing the input characteristics for krkonoše type 1 and jeseníky type 4 we found that mean initial swe krkonoše 133 mm jeseníky 119 mm and event rainfall krkonoše 14 0 mm jeseníky 15 3 mm were comparable the significant difference was identified within the mean snowmelt volumes krkonoše 5 7 mm jeseníky 11 6 mm runoff intensity represents how fast event runoff volume can be transported within a stream over ros runoff duration event runoff divided by rrd runoff intensity increases with runoff type in both mountain ranges but krkonoše shows higher runoff intensities compared to jeseníky fig 6d high runoff intensities were also associated with high rainfall intensity fig 6e although this effect was clear only in krkonoše high runoff in krkonoše was related not only to high volumes of rainfall but also to high rainfall intensity mean 1 8 mm h 1 in contrast high runoff in jeseníky was associated with the lowest rainfall intensity mean 0 75 mm h 1 maximum rainfall intensity 4 8 mm h 1 was recorded in krkonoše which resulted in low runoff as expected runoff coefficient c increased with runoff type in both mountain ranges the runoff coefficient also rarely exceeded 1 indicating higher runoff volume than incoming rainfall such high values of runoff coefficient were only documented in krkonoše and only for runoff types 2 3 and 4 fig 6f interestingly the highest runoff coefficient for jeseníky was identified within runoff type 4 although median rainfall was the lowest among all runoff types this means that high runoff in jeseníky was mainly driven mainly by snowmelt and only slightly by rainfall however runoff type 4 only contains four ros events therefore we have to interpret such results with caution we also investigated if the catchment fraction effected by ros influenced runoff response moreover we analysed the effect on event runoff of the snow covered area sca and runoff contributing area rca fig 7 runoff was not generated from the entire catchment in many cases since ros events only occurred in part of the catchment i e only below the freezing level and with sufficient snow cover the extent of the sca also matters because it represents the source of snowmelt during non ros conditions and potential for possible storage of rainwater these parameters can significantly influence runoff response the analysis revealed that the mentioned areal fractions differed between all runoff types and mountain ranges median rca fraction is 50 except runoff type 3 in jeseníky fig 7a in contrast median ros area fraction was less than 56 of the catchment area for all runoff types fig 7b in addition the highest snow area fractions were associated with medium runoff in krkonoše median 98 but highest sca resulted in negligible runoff in jeseníky median 81 fig 7c on the other hand sca within types 1 and 3 showed very similar coverage per mountain range ros responded in both mountain ranges with high runoff when snowpack extended over the smallest part of the catchment in contrast runoff type 4 was generated from the largest part of the catchments in both mountain ranges which documented high medians of rca fraction krkonoše 0 83 jeseníky 0 92 fig 7a high runoff was characterised in jeseníky by higher rca compared to the sca which means that runoff was also generated from snow free areas 3 4 temporal dynamics of rain on snow events better understanding of ros events requires analysis of the dynamics of hydrometeorological parameters over the course of the events fig 8 shows mean temporal evolution of the rca air temperature snowmelt volume and event runoff over the rrd to compare events of different duration from different catchments the rrd of all events was normalised where 0 is the start and 100 the end of an event first rca shrank over the course of the events for runoff types 1 and 2 fig 8a similar behaviour showed that mean air temperature decreased over time for runoff types 1 2 and 3 fig 8b the lowest temperatures were found during runoff type 3 and in contrast the highest temperatures were recorded for runoff type 4 for runoff type 3 temperature decreased over the course of the event which was consistent with decreasing snowmelt production shown in fig 8c in contrast a temperature increase was only identified for type 4 snowmelt fraction increased at the beginning for all runoff types during medium runoff events snowmelt only contributed a little to runoff fig 8c despite the event runoff constantly being second highest fig 8d this shows that medium runoff was mostly driven by rainfall with snowmelt as a secondary factor event runoff expectedly differed according to runoff type with the steepest increasing and decreasing limb in the hydrograph for runoff type 4 and the flattest curve for runoff type 1 3 5 classification of rain on snow events with self organizing maps for the detection of any meaningful classes between the ros events four variables were used as classifiers these were pevent initial swe runoff coefficient c and snowmelt they were chosen after considering two factors the first was maintaining representability of the processes involved in maximum runoff generation and second was to use the least correlated variables the resulting 16 groups of the som have a range between 8 and 118 events per node with a median of 25 5 which is quite close to the theoretical mean of 38 2 fig 9 each radar plot represents the standardized mean value of each variable per node group and are ordered regarding to event rainfall for instance in group 1 we have the 14 events with the highest rainfall low snowmelt and runoff coefficient and minimal initial swe these are the events in which rainfall is the key driver resulting mainly in high runoff runoff type 4 in contrast the 14 ros events within group 16 are classified by minimum rainfall but high runoff coefficient snowmelt and swe generating minimal event runoff runoff type 1 the rest of the nodes represent other combinations of the four classifying variables providing a rich mosaic of various ros event categories that can help us understand the relationship between climatic and hydrological variables to do so we further examined four additional key variables mean air temperature maximum runoff mean runoff contributing area and mean snow covered area that are linearly correlated to the four classifiers and see whether any nonlinear relationships appear fig 10 as expected the groups dominated by high or medium runoff types 3 and 4 are linked to high rainfall groups 1 2 temperature group 14 or both group 3 these are groups with a small number of events except for group 2 40 events which consists of events with extremely low air temperature and thus snowmelt low initial snow water equivalent and rca and varying sca its main difference from group 1 is the amount of rainfall which in the latter case is quite high on the other hand group 14 is driven solely by temperature it represents a small number of events that occurred in spring and generated rather high maximum runoff it is interesting to compare it with group 16 which mainly represents late spring events has similar rainfall and snowmelt behaviour but results in negligible runoff perhaps the answer may lie in the difference in initial snow conditions higher swe sca for group 14 group 3 consists of events with high qmax and c that are driven by high temperature and medium rainfall these are events that occurred exclusively in autumn and spring and even though the snow covered area is smaller their runoff contributing area is larger the last medium runoff group group 6 has a broad rainfall range under low temperature conditions the maximum runoff and runoff coefficient are high as well as initial snow amount and coverage the regime seems to be similar to group 14 but with the values of climatic variables reversed high rainfall low temperature among the groups with low or negligible runoff group 5 89 events from october to may is a reasonable candidate for the most representative group of ros events even though group 15 has a higher number of events 119 rainfall is minimal and offers no real insight into the processes involved in contrast group 5 is characterized by medium rainfall under cold air temperature low snowmelt and snow water equivalent and medium runoff contribution and snow covered areas group 5 events generate low maximum runoff and have one of the lowest runoff coefficients as expected from runoff type 1 this is not the case though for the 27 events of group 4 in these events approximately 30 more rainfall and a two degree increase in air temperature result in maximum runoff that is comparable to medium and high runoff types 3 and 4 further comparison with the high runoff events and group 3 in particular reveals that even though both groups have similar rainfall group 4 presents high initial snow amount and coverage which could restrain total runoff at lower temperatures another noteworthy comparison between runoff type 1 is between group 7 and group 8 these groups have identical climatic conditions and very similar snow water equivalent and coverage but result in extremely different snowmelt further investigation showed that group 7 consists of events that occurred solely in the krkonoše mountains providing some insight into the importance of catchment properties in snowmelt the rest of the groups contain a reasonable number of events from both mountain ranges although group 10 and group 13 are dominated by events over the jeseníky mountains summary of the major groups 1 2 3 5 14 of ros events according to som is depicted in table 4 4 discussion 4 1 rain on snow events characteristics the absolute number of identified events can depend beside other things on the ros definition and subsequent selection criteria in particular thresholds for swe and rain can affect the number of identified ros events however a preliminary sensitivity analysis revealed that the presented patterns of ros characteristics remain similar even if the limits for minimum cumulative rainfall and swe are changed swe 20 mm rainfall 10 mm nonetheless a unified international definition of ros is needed to make results of different studies comparable in addition estimation of the exact amount of liquid precipitation and spatial distribution of snow is also challenging rain intensity is usually not constant over a catchment at a given moment furthermore snow cover is distributed unevenly in the catchment because of changing topography and related snow transport these issues introduce uncertainty into the computation of water inputs and rain affected area in general weather conditions govern the temporal distribution of ros over the cold season low occurrence of ros during february was usually caused by lower frequency of liquid precipitation due to low temperatures in contrast high numbers of ros events were observed during months when rainfall is more probable and the snowpack featured sufficient swe during november catchments usually experience the first snow with low swe which often melts may is typified by high temperatures frequent rain and a ripped snowpack with shallow snow depths but high densities our results thus partially agree with study of freudiger et al 2014 who reported ros occurrence in the uplands of german catchments from december to april in contrast other studies from the european region describing floods initiated by ros in october rössler et al 2014 december garvelmann et al 2015 or january to march freudiger et al 2014 thus we can assume that ros occurrence varies with regional conditions despite their close proximity even the two mountain ranges analysed here showed different ros frequencies fig 4 we argue that this can be caused by slightly different synoptic and climate patterns combined with local peculiarities jeseníky is more influenced by ombric continentality causing lower precipitation during the winter season on the other hand the krkonoše mountains received more precipitation in the snow seasons mean 672 mm over the study period compared to jeseníky mean 387 mm due to frequent w and sw winds bringing humidity from the atlantic tolasz 2007 žák 2021 lower precipitation in jeseníky can also be caused by their lower mean elevation compared to krkonoše table 1 different patterns in ros related to climate were also found by li et al 2019 who pointed out that the western mountain ranges of the usa are affected by ros more frequently than the eastern mountain ranges important aspects within the ros analysis are the meteorological conditions which can be used as a proxy for further hydrological modelling and forecasting of hydrological consequences moreover we can directly compare these meteorological conditions during ros with other studies our results show that identified ros events were characterised by similar mean air temperatures compared to other european regions würzer et al 2016 found that 90 of 1063 ros in the swiss alps exceeded 1 7 c and garvelmann et al 2015 reported 1 9 c and 4 4 c respectively for two ros events in the black forest germany as expected the high runoffs were associated with the high air temperatures initializing intensive snowmelt fig 8b c which also reported würzer and jonas 2018 the importance of snowmelt contribution to high runoff generation or even floods is also emphasized by other studies garvelmann et al 2015 li et al 2019 wayand et al 2015 würzer and jonas 2018 in most cases snowmelt production at the end of the ros event is higher than event runoff compare fig 8c and d this can be explained by the snowmelt runoff process when not all produced snowmelt appears in a stream but can be stored in the soil underneath or in the snowpack kattelmann 1987a woelber et al 2018 furthermore snowmelt volume is not only dependent on air temperature but also on snow volume i e swe and sca this is probably the case in the modrý potok catchment which showed the most ros events resulting in high runoff this catchment is located on the leeward part of the mountain and thus accumulates high amounts of snow which can often reach about 10 m hejcman et al 2006 this in combination with southern aspects enables high snowmelt rates and prolonged the snow and thus ros season nevertheless the reported typical maximum values of swe during the identified ros events are comparable with garvelmann et al 2015 who reported the highest swe of 289 mm during ros in december in the black forrest studies from other regions refer to even higher maximum precipitation values for instance during mid winter an ros event in the british columbia canada saw 343 mm of rain trubilowicz and moore 2017 and 613 mm in the swiss alps würzer et al 2016 additionally the recorded maximum rainfall intensity during ros over czech catchments was about half compared to another study conducted in the swiss alps würzer et al 2016 on the other hand würzer et al 2016 reported a mean rain duration of about 18 h ranging from 3 to 96 h which is comparable to our study runoff coefficient varied with the runoff group and in some cases runoff volume even exceeded incoming rainfall high runoff coefficient for ros events already described in merz et al 2006 for the austrian catchments we assume that values over 1 can be caused mainly by a combination of two factors 1 during ros a substantial amount of snowmelt can be induced due to positive air temperature and additional heat energy from rain and wind 2 a wet snowpack starts to release pre event water stored in its pores liquid water content while this water is pushed by the incoming rainwater this mechanism can be described as a piston flow effect feng et al 2001 juras et al 2017 unnikrishna et al 2002 previous physical experiments showed that rainwater contributed about 20 50 to snowpack runoff juras et al 2017 the som classification highlighted that ros events present very rich patterns with various combinations between climatic conditions initial snow regime and runoff behaviour as a general remark rainfall is the main driver of maximum runoff and runoff in general however the events that are associated with the high rainfall can result to either high group 1 or medium runoff groups 2 types with events in group 2 appearing three times more often compared to the events of group 1 table 4 temperature is found to have a secondary role amplifying or weakening runoff response depending on initial snow water equivalent it is likely that there might be some temperature threshold controlling the role of existing snow amount to enhance or constrain the intensity of ros events this is a plausible interpretation of the comparison between group 3 and group 4 but a clear relationship remains inconclusive it might seem counter intuitive but the representation of the enhanced variety in the ros event features is one of the main benefits of using som or any other classification algorithm because it reveals the underlying complexity of the phenomenon 4 2 the role of snowpack in runoff generation during rain on snow the effect of snow cover on runoff generation is ambiguous on the one hand snowpack holds rainwater and on the other snowmelt strengthens runoff the results show that not only swe but also sca plays an important role in generating ros event runoff the vast majority of the analysed ros events 82 caused only negligible or low event runoff this means that most of the incoming rainfall during ros was held by the snow covered catchment which involves retention in the snowpack soil or canopy the snowpack itself can also store a significant amount of rainwater but the holding capacity of snowpack changes during the season and depends on snow properties like microstructure fierz 2009 singh and singh 2001 self organizing maps revealed that during the 27 ros events group 4 snow cover most significantly prevented extensive runoff this is because high rainfall median 29 1 mm over a sufficient snowpack medians swe 214 mm sca 99 caused only 3 8 mm median of the event runoff although relatively high qmax 0 9 mm h 1 was also reached during these events this was probably caused by high baseflow and not by event runoff high rainwater storage by snow covered catchments can be also seen within the 54 ros events groups 1 2 which received the highest amount of rainfall but about 76 81 was stored in the catchment and only a little portion appeared in runoff this fact is documented by the lowest water budget and relatively low runoff coefficient fig 10 groups 1 and 2 are also related to low swe and shallow snowpack which can only store a limited amount of liquid water therefore within these groups it was most likely that the rainwater was also stored in the soil or retained by the vegetation cover because swe was often insufficient to hold such amounts of water although a significant amount of rainwater was stored during ros events within groups 1 and 2 total water input was so significant that stream runoff reacted with a massive increase the highest runoffs groups 1 and 3 were associated with high inputs of meltwater in combination with high rainfall fig 6 but also with the lower swe and sca fig 10 this is in agreement with other studies e g rücker et al 2019 würzer and jonas 2018 on the other hand significant runoff response occurred also during 21 ros events group 6 when sufficient snow cover sca 100 swe 269 mm median was hit by a considerable amount of rain median 18 3 mm runoff responded with high qmax and c which could be explained by two effects first the combination of high baseflow and event runoff second the higher amount of discharged water can also be generated due to the piston flow effect when incoming rainwater pushes out less mobile meltwater the piston flow effect is closely discussed in section 4 1 both effects can also explain the runoff reaction of group 14 fig 10 when mostly lower amounts of rainfall resulted in the highest runoff coefficients and even in runoff excess within group 14 positive water budget surprisingly we do not see similar runoff reactions within ros events of group 7 featured by the highest snowmelt and rainfall comparable to group 6 nevertheless the most significant difference between group 7 and groups 6 and 14 is lower swe sca and ros affected area the highest qmax groups 1 4 6 14 were rarely generated from the entire catchment area in particular when rca is smaller than sca fig 7 and fig 10 then runoff is generated mostly within the snowpack würzer and jonas 2018 reported that in swiss catchments high runoff was connected to snow cover together with high air temperatures moreover they emphasize the significance of sca while snow free parts of the catchment caused higher runoff earlier compared to snow covered parts our results are ambiguous regarding this issue and therefore cannot support their conclusions about high runoff timing surprisingly most of the ros events resulting in high runoff supported by high snowmelt group 1 3 occurring during early winter nov dec n 14 and only few n 6 occurred during spring apr may this finding differs from the study of würzer and jonas 2018 which reported most of highest runoffs during spring months however snowmelt water does not necessarily have to propagate to streamflow some part of snowmelt is usually stored in the snowpack or infiltrates into the soil woelber et al 2018 this can be clearly seen in group 7 and partially in group 16 where a significant amount of snowmelt appeared over the course of ros but apparently only a fraction appeared in the runoff the importance of snowmelt during runoff generation can also be documented by comparison of groups 5 and 10 eventhough both groups are characterised by similar snowpack and water input median 24 1 mm and 24 9 mm respectively group 10 caused double the qmax and qevent this can be explained by different snowmelt volumes where in group 5only 8 of the water input was snowmelt compared to 54 within group 10 4 3 uncertainties of modelling and analysis a potential uncertainty in simulating swe data may be the threshold temperature for precipitation phase partition and snowmelt threshold temperature controls the amount of snowfall and thus snow storage and it was calibrated by the hbv model separately for each catchment testing of different hbv model structures which was recently done partly over the same study area did not show a considerable improvement of use i e two threshold temperatures with linear or exponential functions for precipitation phase partition between these two threshold temperatures girons lopez et al 2020 overall the study by girons lopez et al 2020 tested 64 modifications of the hbv model snow routine and showed that the original snow routine also used in our study included in the hbv model provided relatively good results although some modifications might represent an interesting alternative such as using an exponential snowmelt function or seasonally variable melt factor nevertheless increased model complexity does not necessarily mean better model ability to reproduce swe and runoff uncertainty issues resulting from swe data used for ros analysis might be overcome by using an energy balance approach which would better reflect the physical nature of the snowmelt process however our analysis was done at a multi catchment level over a broader region which did not allow for the use of energy balance approaches since sufficiently dense input data from climate stations are only available for precipitation and air temperature other necessary meteorological data do not sufficiently cover the whole region and elevation extent or they are even missing in general energy balance calculations are usually employed at a site level see i e hotovy and jenicek 2020 moeser et al 2020 and such approaches are not easily transferable to larger regions for which the degree day approach is widely used freudiger et al 2014 or they even rely on observed swe data mccabe et al 2007 however we introduced a downscaling approach of daily snowmelt data to hourly step to reflect its diurnal cycle eq 1 the limitation of this approach is clearly the fact that the diurnal cycle has been considered only for days when snowmelt was simulated by the hbv model due to a lack of data we ignored snow microstructure in the analysis although this factor plays a crucial role in water movement storage and release juras et al 2017 würzer et al 2017 moreover detailed snowpack data are usually provided at a point scale which is not necessarily representative for the catchment scale würzer and jonas 2018 waldner et al 2004 reported that a heterogeneous snowpack is more often connected to preferential flow contrary to matrix flow which appears more likely in homogenous snow although rainwater can be transported faster through preferential flow paths hirashima et al 2010 juras et al 2017 waldner et al 2004 a considerable amount of liquid water can also be stored above capillary barriers avanzi et al 2016 beside the above mentioned hydrometeorological descriptors runoff generation during the ros is also driven by individual catchment characteristics such as the presence and type of forest bedrock aspect or slope kattelmann 1987b li et al 2019 for instance we can assume that forested catchments would respond differently to the given ros event compared to catchments with less or no portion of forest first precipitation is usually reduced in forested catchments due to canopy interception beria et al 2018 second snowmelt production is usually lower compared to open sites due to less snow and reduction of solar radiation and turbulent heat exchange garvelmann et al 2014 however more studies relating to catchment characteristics and runoff response would be beneficial to even better understand runoff generation during ros 5 conclusions employing hbv model and geomorphological catchment characteristics we identified 611 ros events over the study period of 10 winter seasons 2004 2014 most ros events did not cause a significant runoff increase identified ros events were sorted into four types according to runoff response furthermore with self organising maps 16 groups of ros events with similar characteristics were classified that helped us shed some light on the links between hydrometeorological descriptors and runoff response our results revealed that snowpack is an important element protecting catchments against floods because 82 of ros events resulted in low or negligible runoff we argue that this is probably a consequence of high storage potential of snow covered catchment while a sufficient volume of incoming rainfall did not appear directly in runoff in contrast when heavy rainfall met shallow and sparsely distributed snow cover supported by intense snowmelt streamflow responded mostly with high runoffs high rainfall or snowmelt alone were usually not strong enough to initiate high runoffs nevertheless the highest runoffs were not extreme while only 29 ros events exceeded a 1 year return period but not higher seasonal distribution of ros also plays its role in runoff response medium or high runoffs were mostly observed during late autumn or spring when snowpack is usually low and high air temperatures support intense snowmelt despite the spatial proximity of investigated mountain ranges we found that the frequency and magnitude of the main drivers governing runoff response differ significantly ros events were more frequent in the krkonoše mts where they also caused higher runoffs this dissimilarity is likely because of less precipitation in the jeseníky mts due to different climatic patterns we hope that our study may contribute to better forecasting of ros runoff response over low and medium mountain ranges in central europe further research should be oriented to the implementation of catchment characteristics and snowpack structure which can bring even better insights necessary for the understanding of ros events and subsequent runoff response credit authorship contribution statement roman juras conceptualization formal analysis supervision methodology data curation writing original draft visualization johanna r blöcher methodology data curation visualization funding acquisition formal analysis writing original draft michal jenicek methodology data curation formal analysis writing original draft visualization ondrej hotovy formal analysis writing review editing yannis markonis methodology writing original draft visualization formal analysis declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we would like to thank the internal grant agency of faculty of environmental sciences czech university of life sciences prague project no 20184236 and the charles university grant agency project no gauk 272119 for financial support of this research we are also grateful to the czech hydrometeorological institute that provided hydrological and climatic data thanks are due to mark sixsmith who carefully proofread the manuscript and ondřej ledvinka from chmi for providing hydrological data and valuable comments appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 127002 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
