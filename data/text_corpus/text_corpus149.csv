index,text
745,we study quasi static drainage displacement experiments in bentheimer sandstone micro cores using x ray computed microtomography two nonwetting fluids air and n decane are investigated under high and low flow rate conditions experimental conditions consider viscosity ratios that vary by a factor of 40 and capillary numbers that range five orders of magnitude but all experiments investigated are conducted under nominally capillary dominated conditions indicating that drainage displacements should demonstrate percolation like invasion patterns however we observe significant and prevalent snap off of nonwetting phase under all experimental conditions a phenomena not predicted by the conceptual model of percolation invasion we further observe that the size and persistence of snapped off ganglia are influenced by the experimental flow rate and the nonwetting phase fluid the quasi static experimental observations are supported by lattice boltzmann modelling of drainage dynamics these findings indicate that current conceptual models of drainage are incomplete with implications for future experimental and modelling studies as well as engineering applications 1 introduction multiphase flow processes in porous media are important to understand for subsurface environmental and engineering applications such as rainfall infiltration into the vadose zone oil recovery geologic co2 sequestration containment of nuclear waste geothermal energy production and remediation of non aqueous phase liquids significant research efforts have been devoted to fundamental flow physics particularly in the case when two immiscible fluids are present two phase flow in these systems the interfacial interactions between the two fluids and the solid surface contribute to determining the distribution and flow patterns of the flowing fluids the wettability state of the solid surface characterizes solid fluid fluid interfacial interactions and is quantified by measuring the contact angle created at the fluid fluid solid contact point through the phase of interest contact angles are often reported relative to the aqueous phase a hydrophilic solid surface is termed water wet contact angle of 0 75 a hydrophobic surface could be termed oil wet or co2 wet depending on the second fluid present in the system contact angle of 105 180 and a surface with only slight or no preference for either fluid would be termed intermediate wet contact angle 75 105 anderson 1987 treiber and owens 1972 for water wet systems such as the one under study here brine is the wetting phase while oil and gas are nonwetting phases the wetting fluid will coat the walls of the solid matrix preferentially occupying small crevices and pore throats while nonwetting fluid will tend to invade and occupy the larger pore spaces and reside in the center of pore bodies when nonwetting phase fluid invades the pore spaces of the medium and displaces wetting phase the process is termed drainage the reverse process where wetting phase enters a medium and nonwetting fluid is displaced is termed imbibition these processes are not simply mirror images to each other there is a hysteresis in these flow processes due to a number of factors not all of which are well understood jerauld and salter 1990 hassanizadeh and gray 1993 hilfer 2006 hilfer and doster 2010 joekar niasar et al 2013 schlüter et al 2016 thus fluid displacement mechanisms are fundamentally different for drainage and imbibition current conceptual models for drainage are largely derived from observations of 2d micromodels in systems where capillary forces and interfacial interactions dominate flow processes capillary fingering drainage patterns arise nonwetting phase invades the largest available pore throats and progressively invades smaller and smaller pore throats in an invasion percolation process as nonwetting phase pressure increases relative to wetting phase pressure and drainage proceeds lenormand et al 1988 hilpert and miller 2001 in situations when body forces such as gravity or viscous forces become dominant over interfacial forces in a system displacement processes are not limited to percolation cluster growth but instead may exhibit compact stable fluid fronts when invading nonwetting fluid is more viscous than the defending wetting phase or the formation of viscous fingering when nonwetting fluid is relatively less viscous configurations which do not conform solely to interfacial forces the appearance and delineation of fluid flow regimes have been investigated from a force balance perspective by many previous studies lenormand et al 1988 vizika et al 1994 méheust et al 2002 løvoll et al 2005 or 2008 zhang et al 2011 wang et al 2012 tsuji et al 2015 and phase diagrams have been developed which compare the relative importance of gravity viscosity and capillarity and indicate which flow regime will dominate a given displacement process following the original phase diagram proposed by lenormand et al 1988 the conceptual model for imbibition is distinct from drainage wetting phase travels preferentially through the small crevices and pore throats in porous media and thickens films on the surface of grains these films swell from the grain surface into the pore space in some cases merging and completely emptying nonwetting phase fluid out of pore bodies termed piston like displacement and in other cases enclosing and trapping nonwetting phase within pore bodies as thickening menisci merge at constrictions in the porous media and snap off ganglia roof 1970 snap off is enhanced during imbibition by lower flow rates chatzis and morrow 1984 morrow et al 1988 nguyen et al 2006 high pore body pore throat aspect ratios li and wardlaw 1986a jerauld and salter 1990 mahmud and nguyen 2006 and low contact angles li and wardlaw 1986a 1986b mahmud and nguyen 2006 mobilization and transport of individual ganglia can then occur if the pressure drop across a ganglion is sufficient to push it through the constrictions which impede it payatakes et al 1980 while the above descriptions of drainage and imbibition describe the generalized transport of fluids during flow processes additional complex flow mechanisms occur intermittently under very rapid time scales milliseconds and very small length scales sub pore these fast small events are thus difficult to observe under experimental settings but nonetheless can result in significant changes to fluid connectivity and pore occupancy for example rapid haines jumps during drainage when the capillary pressure across a fluid interface exceeds the critical pressure required to invade a constriction and nonwetting fluid rushes into the adjacent pore body may lead to localized imbibition of wetting phase at the constriction causing snap off of small isolated nonwetting ganglia in front of the main invading fluid front al gharbi and blunt 2005 andrew et al 2015 roof 1970 other recent experimental observations have demonstrated that haines jumps can also lead to nonlocal reconfigurations of fluid due to cooperative filling as fluid enters a large pore body it may pull fluid from other previously filled pore throats or bodies to supply the rapid invasion armstrong et al 2015 the impacts of these very rapid displacement processes and fluid reconfigurations are not captured by the capillary fingering viscous fingering stable displacement flow regimes described above in addition to the disparity in temporal dependence between local rapid events and bulk flow the spatial dimension of a flow process introduces significant additional complexity flow processes are relatively well studied from 2d and quasi 2d perspectives however investigations into 3d systems have been inhibited by the difficulties inherent in visualizing opaque 3d systems at relevant length and time scales only recently has imaging technology advanced such that 3d flow processes can be imaged in real time resulting in enhanced understanding of processes including haines jumps during drainage berg et al 2013 bultreys et al 2015 the transition from connected pathway flow to ganglion dynamics during imbibition rücker et al 2015 capillary pressure conditions of different displacement mechanisms during imbibition singh et al 2017 fluid breakup during co injection datta et al 2014 and different snap off mechanisms occurring during drainage andrew et al 2015 it has long been known that the very high velocities attained during haines jumps in drainage violate the assumptions of capillary dominance but only recently has it been possible to explore the consequences of this armstrong and berg 2013 andrew et al 2015 reynolds et al 2017 singh et al 2017 the prevalence overall influence and implications of snap off events and transiently disconnected ganglia on drainage patterns have yet to be fully examined here we use 3d x ray computed microtomography x ray microct to observe quasi static unsteady state drainage experiments in bentheimer sandstone for two sets of wetting nonwetting fluid pairs air nonwetting brine wetting and n decane nonwetting brine wetting for each set of fluids two flow rate conditions were investigated encompassing three orders of magnitude of flow velocity we observe widespread snap off in all experiments particularly at low nonwetting phase saturation levels below 50 the dynamics of snap off during drainage are further explored by lattice boltzmann simulation the quasi static time steps of the simulation show repeated snap off and reconnection events supporting experimental results and providing a pathway to further investigation of this phenomenon 2 materials and methods 2 1 experimental fluid pairs the wetting fluid for all experiments was degassed 1 0 m potassium iodide ki brine the ki attenuates x rays and thus acts as a contrast agent in imaging studies two nonwetting fluids were investigated representing two common categories of gas and oil ambient condition air and n decane properties of these fluids are reported in table 1 interfacial tension and contact angle were measured via goniomenter as bentheimer sandstone consists of greater than 90 quartz mayr and burkhardt 2006 peksa et al 2015 a glass slide was used to approximate the surface properties of sandstone for contact angle measurement 2 2 sandstone sample and core holder assembly bentheimer sandstone samples of 4 4 mm diameter and approximately 13 mm long were used for experiments bentheimer is a clean and relatively homogenous sandstone with low clay content and well described petrophysical properties maloney et al 1990 peksa et al 2015 2016 the samples used for these studies were unfired data from several cores was compiled for analysis as indicated in table 2 bentheimer sandstone is a relatively homogenous medium and all analytical volumes are larger than a standard rev e g as determined in herring et al 2013 2015 porosity of 24 10 and absolute permeability of 4 25 darcy measured via lattice boltzmann modelling for one of the imaged micro cores used in this study have been reported previously liu et al 2017 cores were re used for multiple experiments samples exposed to n decane were cleaned by progressive submersion in acetone ethanol and deionized water between experiments to ensure that surface chemistry alteration did not occur due to exposure of oil solvents or x rays dynamic capillary pressure saturation curves were recorded and inspected during each experiment no significant changes in shape or magnitude of the capillary pressure saturation curves was observed indicating that contact angle remained consistent for each core throughout the series of experiments the experimental apparatus and description for air brine experimental suite has been reported previously herring et al 2017 this apparatus and procedure was slightly modified for n decane experiments as described below a new polyetheretherketone peek and glass core holder was designed and built in house replacing the titanium core holder used in air brine experiments herring et al 2016 2017 the design of this new core holder allowed for tighter packing of the cores and thus more effective brine saturation prior to drainage experiments fig 1 the core holder consisted of a glass capillary tube at the base an empty peek chamber for the sandstone core and an adjustable screw top upper endcap to assemble the core holder the dry sandstone core was wrapped in two layers of hydrophilic nylon membrane pore size of 1 2 µm general electric company fairfield ct united states and one outer layer of teflon tape additional circular layers of hydrophilic membrane were also placed directly below the core and compressed onto the lower face of the core via viton o rings the hydrophilic membrane provided water wet boundary conditions and reduced the occurrence of nonwetting phase breakthrough through the core allowing for achievement of relatively high capillary pressures during drainage however it was found that breakthrough did occur in decane brine experiments we attributed this to the increased contact angle and reduced interfacial tension of the oil brine system relative to the air brine system table 1 thus extra membrane layers were used in decane brine experiments five circular layers on the lower core face compared to air brine experiments two layers the core was assembled within the core holder between a series of viton o rings which seal and compress to the core when axial compression is applied and circular teflon disks to reduce the torque on the core when endcaps were screwed on during assembly the base of the core holder was connected to a flexible peek tube with a diameter of 0 75 mm and a length of 1 5 m this line was connected to a harvard phd2000 syringe pump harvard apparatus holliston ma united states a brine reservoir contained within a syringe and a keller series 35x pressure transmitter accuracy of 0 1 mbar keller american inc newport news va united states which provided continuous measurements of brine pressure temperature controls were incorporated into the microct enclosure by design and the temperature was closely monitored during experiments the temperature variation during each experiment was consistently 1 c and was within the range of 21 25 c between experiments prior to flow experiments the dry core and core holder assembly was attached to a vacuum pump and air was evacuated from the system under vacuum of at least 60 kpa relative to ambient pressure for approximately five minutes after which brine was allowed to enter the core still under vacuum after this point cycles of vacuum pressure applied by closing the valve leading to the vacuum line and manually pushing on the reservoir syringe containing ki brine and brine flushing were carried out until visual inspection of radiographs indicated that air was removed as shown in the section 4 this saturation procedure was not entirely successful and some air was present in all experiments equivalent to 0 2 3 3 saturation in n decane experiments and approximately 6 in air experiments for air experiments a flexible wax cover was sealed in place on the top endcap in order to prevent evaporation but still allow for air to be pulled into the core during drainage for n decane experiments the top endcap was connected to a sealed oil reservoir via another peek tube with an inside diameter of 0 75 mm and a length of 1 5 m a syringe needle was inserted into the top of the otherwise sealed oil reservoir to maintain oil reservoir pressure at constant atmospheric pressure while preventing contamination of the n decane reservoir throughout the experiments a schematic representation of the experimental set up is shown in fig 1 2 3 flow experiments the rate and frequency of pumping cycles were controlled by a labview program that integrated the syringe pump controls pressure and temperature measurement and microct scan acquisition software to effect quasi static flow experiments as described by herring et al 2017 for each experiment a scan was acquired of the initial brine saturated state of the system and then brine was withdrawn from the micro core via the syringe pump at the set experimental flow rate until the nonwetting phase entry pressure determined during practice experiments was measured at this point pumping was halted the system was allowed to equilibrate for a set amount of time also estimated from pressure profiles measured during practice experiments reported in table 2 and then another scan was acquired after this point cycles of pumping of predetermined volume equilibration and scanning were carried out until drainage was complete irreducible wetting saturation was achieved as indicated by transducer measured capillary pressure values exceeding 15 kpa herring et al 2017 or the experiment otherwise terminated due to n decane breakthrough through the hydrophilic boundary layer below the core the volume of fluid withdrawn during each pumping cycle which subsequently determined the number of scans collected was selected based on the total scanner time available for each experiment due to the relatively small pore volume of the micro cores and the differences in pressure measured for the different fluid and flow rate conditions it was impossible to achieve exactly the same saturation levels across all experiments however sufficient data was collected to span the range of saturation of interest for all experiments 2 4 lattice boltzmann modelling a subsection of a drainage experiment was also modeled using the lattice boltzmann lb method the lb method is a numerical method for solving the navier stokes equations which are based on the mesoscopic kinetic theory chen and doolen 1998 succi 2001 with the growing popularity in recent two decades the lb method has become a well developed numerical tool for modeling multicomponent fluid flows in porous media with complex boundary conditions in this work we used a multi relaxation time mrt color lb model described by mcclure et al 2014 additional details of the lb model implementation can be found in mcclure et al 2016a where it has shown that computed static and dynamic contact angles are consistent with existing slip models such that the interfacial and contact line dynamics can be accurately recovered this lb implementation also incorporates an in situ analysis module that generates a range of measures such as minkowski functionals based on the multiscale averaging theory at high temporal resolution armstrong et al 2016 mcclure et al 2016b due to the low miscibility and compressibility nature of our lb model only n decane brine drainage was simulated the relaxation parameters in the lb model are chosen for n decane and brine such that the experimental viscosity ratio m 0 8 is matched the density ratio was set to 1 0 for simplicity as the gravitational force plays limited role in the n decane brine system and a contact angle of 0 strongly water wetting was used to avoid the generation of very small non physical nonwetting droplets this issue is described in detail in li et al 2018 the model parameter α is set to match the n decane brine interfacial tension given the image resolution of 4 90 µm and considering the conversion relation between lb and physical units based on schaap et al 2007 the lb simulation has a temporal resolution of 0 89 microsecond per lb iteration the imbedded analysis module in our lb implementation mcclure et al 2016b reports physically morphologically averaged quantities every 1000 lb iterations i e 1 millisecond which is good enough to capture rapid drainage events such as haines jumps armstrong and berg 2013 zacharoudiou and boek 2016 a sub domain of 2563 voxels of a dry bentheimer sandstone image was used corresponding to a cube with side lengths 1 27 mm the simulation domain consists of a non wetting phase reservoir nwr and a wetting phase reservoir wr at the inlet and outlet respectively and a porous barrier between the porous medium and wr which prevents the invading non wetting phase from exiting at the inlet a flux boundary condition is applied to mimic the constant non wetting phase injection while a fixed pressure boundary condition is applied at the outlet this flux boundary condition is advantageous since an inlet volumetric flow rate can be specified in advance to match the experimental capillary number for the 2563 voxels sub domain a flow rate of 435 µl h is used to give ca 10 5 which matches the high flow rate case in the experiment 3 data processing and quantification x ray computed microtomography x ray ct was used to visualize the 3d internal structure and fluid configurations within bentheimer sandstone this imaging technology is widely used for characterization of geologic materials and fluid flows wildenschild and sheppard 2013 x ray ct scans were acquired at a tube voltage of 100 kv n decane experiments in the peek core holder utilize a current of 15 µa while air experiments within a titanium core holder used 65 µa other parameters of scan acquisition and data analyzed are reported in table 2 data processing was accomplished with mango an image processing and quantification software developed by the department of applied mathematics at the anu cylindrical subsections were selected to exclude preferential wall flow the inherent geometry at the core edges where irregular grains meet the smooth membrane dictated that some of the larger flow paths occurred at the core edges which caused nonwetting fluid to preferentially enter the regions near the walls all quantitative results are calculated from the smaller subsection excluding wall flow two phase segmentation nonwetting phase and combined wetting solid phase was accomplished using an active contours segmentation routine sheppard et al 2004 post segmentation speckle noise removal was achieved by removing isolated clusters labeled as nonwetting phase smaller than the volume equivalent to a sphere of 15 µm radius which is smaller than the smallest pore size expected for bentheimer sandstone maloney et al 1990 all nonwetting phase ganglia quantitative metrics were calculated on the final segmented data volumes using mango and 3d visualization of data was achieved using the commercial software avizo fig 2 illustrates an example data set a shows raw grayscale data of the reconstruction of the first data volume in the drainage series including some air bubbles which are present due to incomplete vacuum saturation process b shows raw grayscale data of the same sample after n decane drainage increases nonwetting phase saturation to 9 and c shows segmented nonwetting phase ganglia with each ganglia labeled in a different color overlain on the grayscale as shown in table 2 multiple experiments were conducted for various given fluid flow rate conditions data from the different experiments for a given fluid flow rate condition are combined and presented as a single class of experiments in section 4 4 results and discussion two phase drainage flows are often classified into flow regimes via dimensional analysis of fluid and flow properties e g lenormand et al 1988 zhang et al 2011 based on these established classification schemes which compare the relative influence of viscous and capillary forces all drainage experiments considered herein fall within the capillary fingering regime or are in a transitional region very close to the capillary fingering domain see definitions of capillary number and viscosity ratio in table 1 and location of experimental conditions in fig 3 in this regime flow is defined as being dominated by capillary forces and is characterized by percolation like invasion i e nonwetting phase invades pore spaces according to the size distribution of pore throats available with preference to larger pore throats this standard understanding of drainage is challenged by our results which are presented in the following sections bulk phase capillary pressure measurements section 4 1 topological measurements of nonwetting phase ganglia section 4 2 and nonwetting snapped off ganglia size distributions section 4 3 section 4 4 presents a lattice boltzmann simulation that illustrates the dynamics of a snap off event and section 4 5 provides discussion and a conceptual interpretation of our results 4 1 pc σ sw relationships the relationship between transducer measured capillary pressure pc normalized by interfacial tension σ and image derived brine saturation sw is shown in fig 4 for representative experiments at high and low flow rates for drainage experiments of n decane and air and for the high flow rate n decane lb simulation which was executed for the early part of drainage the capillary pressure in the lb simulation is calculated based on the interface averaged mean curvature the data points were extracted every 1000 lb steps i e 1 ms and it can be seen that a non monotonic pc σ sw is obtained which well captures sudden pc drops as the non wetting phase advances during haines jumps within each flow rate regime the air and n decane pc σ sw relationships agree but pressure values are elevated for the 3000 µl h experiments of both air and n decane and for the dynamic lb simulation data the phenomena of elevated pc measured in the bulk fluid phases across the core via physical pressure transducer during these quasi static flow experiments has been previously reported herring et al 2017 herring and co authors attributed elevated pc measurements at high flow rates to the sharp boundary condition at the base of the core causing a rapid redistribution of fluids the authors proposed that fluids are stabilized in the higher pc state because the fluid phases become hydraulically disconnected during the rapid redistribution in those experiments the agreement of the dynamic curvature values measured via lb simulation and the quasi static equilibrium pressure values measured during experiments supports this interpretation the pc σ sw relationships shown in fig 4 provide insight into nonwetting phase invasion under the four experimental conditions investigated herein both n decane and air show approximately the same pc σ sw relationships at each flow rate this indicates that for a given saturation and flow rate nonwetting phase either n decane or air is likely to invade similar regions of the pore space the pc σ sw relationships for the high flow rate experiments are elevated relative to the low flow rate experimental data implying that at higher flow rate nonwetting phase can invade smaller pore throats and pore spaces 4 2 topological metrics nonwetting phase topology as quantified by the euler characteristic χ has recently been identified as a parameter with potential to inform understanding about fluid configurations permeability and trapping during two phase flow herring et al 2013 2015 rücker et al 2015 armstrong et al 2016 mcclure et al 2016c schlüter et al 2016 liu et al 2017 here we present the normalized euler characteristic of the nonwetting phase as a function of nonwetting phase saturation fig 5 for full description and interpretation of how nonwetting configurations manifest to produce particular euler characteristic values we refer to herring et al 2013 2015 for interpretation of fig 5 we note that a normalized euler characteristic of 1 0 indicates that nonwetting phase has reached maximum interconnectivity there are no disconnected nonwetting phase regions and the nonwetting phase has occupied all pore throats thus achieving the same level of interconnectivity as the pore space alternatively normalized euler values of zero or less than zero indicate that there are relatively high numbers of disconnected isolated nonwetting phase ganglia fig 5 demonstrates that all experimental systems investigated herein exhibit similar topological signatures low interconnectivity relatively large numbers of disconnected ganglia at nonwetting phase saturations less than 50 with dramatically increasing interconnectivity increases in redundant loops and connections of nonwetting phase as the nonwetting saturation increases above the percolation threshold which occurs at approximately 50 nonwetting phase saturation this general relationship has been observed in many other experimental systems herring et al 2013 2015 schlüter et al 2016 minor differences in the data are observed the air drainage experiments which are more fully sampled at nonwetting phase saturations above 50 indicate that changes in flow rate are relatively insignificant at least for the range of flow rates considered here which vary by a factor of 150 the n decane experiments are less well sampled at higher nonwetting phase saturations but where data exists it demonstrates a higher interconnected nonwetting phase for a given saturation value relative to the air data schlüter et al 2016 propose that normalized euler saturation relationships can be used to quantitatively identify two phase flow regimes according to the approach presented by schlüter and co authors we measured the power law trends for our experimental data where χ n w 0 table 3 based on the analysis of schlüter et al 2016 the values presented in table 3 do indeed indicate that the flow experiments examined herein fall within the capillary fingering regime as suggested by the traditional force balance flow regime analysis we note that power law analysis was not achievable for the high flow rate n decane experiments due to the lack of data points where χ n w 0 in those experiments however earlier in drainage at saturations below the percolation threshold i e 50 we also observe negative normalized euler values indicating significant numbers of disconnected nonwetting phase ganglia this observation does not conform to conventional conceptual models of invasion percolation patterns to further investigate the occurrence of disconnected nonwetting ganglia in fig 6 we present numbers of isolated ganglia as a function of nonwetting phase saturation for saturation levels below 50 as described in section 2 3 initial vacuum saturation methods were inadequate and some amount of air was present within rock cores for all experiments thus in fig 6 we present the increase in isolated nonwetting phase ganglia relative to the number of air bubbles which were originally present in each sample under the conventional conceptualization of capillary fingering and percolation invasion the number of isolated ganglia should decrease as nonwetting phase invades and connects to each isolated bubble however as shown in fig 6 we rather observe large increases in numbers of disconnected ganglia as drainage proceeds and nonwetting phase saturation increases indeed increases of approximately 500 isolated snapped off nonwetting ganglia are observed at nonwetting phase saturations of approximately 20 representing a significant volume fraction i e 50 of the nonwetting phase present details on ganglia size distributions follow in section 4 3 after this point as drainage proceeds and more nonwetting fluid invades the pore space these individual ganglia merge and the number of distinct ganglia decrease as the nonwetting phase saturation approaches the percolation threshold at approximately 50 4 3 distribution of nonwetting phase to provide context for the following discussion of nonwetting phase ganglia distributions illustration of ganglia size values with reference to the bentheimer micro cores investigated in this study is provided in fig 7 ganglia illustrating the range of ganglia volume values are identified and are labeled in red with the other nonwetting phase present in the system shown in transparent blue during experiments small individual pores may be filled with ganglia on the order of 10 3 mm3 singlets ganglia of 10 2 mm3 represent larger pores and doublets i e ganglia which fill a couple of pores bodies connected via thinner pore throats and ganglia which measure 10 1 mm3 span tens of pore bodies ganglia on the order of 1 mm3 comprise hundreds of connected pore bodies filling a significant fraction of the pore space of the micro core and as ganglia increase in size beyond 1 mm3 and approaching 10 mm3 they span the core and can be considered to be a part of the main percolating cluster for context the physical size of analyzed volume of these micro cores was approximately 100 mm3 with resulting pore volumes on the order of 20 25 mm3 visualization of nonwetting phase distribution during early drainage i e nonwetting saturation 50 is presented in fig 8 distinct nonwetting phase ganglia are labeled with different colors in fig 8 and the exact saturation level calculated for each data volume is presented with each isosurface as described in section 2 3 experimental complications were encountered in a achieving 100 brine saturation conditions at the start of each experiment as displayed in the top row of fig 8 and b in achieving exactly the desired saturation levels in these bentheimer micro cores nevertheless the data collected provide valuable information on the evolution of nonwetting phase occupancy of the pore space under the different experimental conditions and comparisons between data sets at approximately equivalent saturation levels are feasible as demonstrated in fig 8 these images suggest that initial air saturation prior to drainage experiments does not influence results significantly cumulative ganglia size distributions are shown for selected data sets in fig 9 and provide additional quantitative context for interpreting the qualitative isosurfaces of fig 8 in particular we observe the air ganglia which are present at the start of drainage experiments are similar in spatial distribution fig 8 and size distribution fig 9a there was more air present at the beginning of air drainage experiments 100 of air bubbles existing in n decane experiments and approximately 90 by volume of air bubbles existing in air experiments were smaller than 10 2 mm3 meaning that air present at the beginning of drainage existed in single pore bodies or doublets in n decane experiments comparisons of ganglia at 9 nonwetting saturation demonstrate that n decane under high flow rate conditions exists in larger disconnected clusters relative to slow flow rate conditions investigation of the ganglia distributions at 28 29 saturation indicate that both high and low flow rate conditions exhibit the formation of a spanning percolating cluster i e a ganglion 1 mm3 by 28 29 nonwetting saturation in air experiments under slow flow rate conditions the formation of a large spanning percolating cluster 1 mm3 is apparent at 28 saturation similar to the n decane results however under high flow rate conditions the spanning percolating cluster is not yet present at 45 nonwetting saturation a dramatic deviation from the other experiments 4 4 lattice boltzmann simulation of snap off event all the experimental data presented herein represent quasi static conditions in order to demonstrate the dynamics of these snap off events we use the lattice boltzmann lb method to simulate a snap off event during n decane drainage under high flow rate conditions capillary number of 10 5 visualization of the snap off and subsequent reconnection event along with the relevant subsection of the curvature derived pc σ sw relationship is shown in fig 10 the changes in fluid distribution shown in fig 10 occur over a very small overall saturation range overall nonwetting saturation change of approx 1 5 each 3d visualization shows the difference in fluid distribution between two specific states we use here the color convention presented by helland et al 2017 that is gold indicates fluid which is present for both before and after states red indicates fluid which was present in the before but not the after and blue indicates new fluid which is only present in the after state the original snap off event occurs between stages a and b prior to a haines jump the capillary pressure increases as the non wetting phase is forced into the narrowest parts of the pore space when the meniscus finally squeezes through the pore neck the associated energy is released and the local capillary pressure decreases i e stage a the local decrease in capillary pressure is what allows snap off to occur during drainage since connectivity through the pore throat may not be maintained throughout the haines jump this process is illustrated in fig 10 at stage a pc σ is dropping as nonwetting fluid invades a large pore body during a haines jump the ganglia then snaps off and as pc σ and snw increase to stage b nonwetting fluid expands the terminal menisci of the connected cluster between stages b and c the nonwetting fluid reconnects to the snapped off ganglia and some fluid is redistributed the terminal menisci of the main connected cluster retract and that fluid is added to the snapped off ganglia from c to d the previously disconnected ganglia becomes reconnected and the terminal menisci of the connected cluster retract further to provide the additional fluid needed to maintain the connection the simulation results indicate that the quasi static experimental data presented above have captured snapshots of the dynamic drainage process wherein fluid may disconnect and reconnect intermittently many times during the nonwetting fluid invasion the simulation results also agree well with other recent experimental observations of dynamic connectivity reynolds et al 2017 and cooperative filling armstrong and berg 2013 mechanisms 4 5 conceptual model for snap off during drainage we identify several effects which influence the size and connectivity of the nonwetting ganglia in these experiments a the imposed fluid flow rate and the resulting pressure drop across the micro core during pumping b the difference in compressibility and viscosity of the fluids and c the contact angle difference between fluid pairs we note that while ganglia size profiles and ganglia distributions are likely influenced by the geometry and boundary conditions of our experimental system we can still draw some inferences about how the factors identified above influenced ganglia formation in these experiments under low flow rate conditions ganglia become disconnected via a process similar to the roof snap off mechanism described by andrew et al 2015 as nonwetting phase quickly invades a pore body in a haines jump some resident wetting phase is pushed backwards towards the pore throat this displaced wetting phase then reconnects in the throat and the nonwetting phase becomes snapped off ahead of the advancing nonwetting phase flow pathway the ganglia size distributions at 28 nonwetting saturation for low flow rate n decane fig 9b and low flow rate air fig 9c are quite similar indicating that ganglia observed in the low flow rate experiments of both fluids are the product of the same snap off mechanism the picture is different in high flow rate conditions under high flow rate conditions we observe elevated capillary pressure measurements for both fluids fig 4 this implies that nonwetting phase in the high flow rate systems has the ability to invade smaller pore throats relative to low flow rate experiments at the same saturation level this effect has the potential to create larger and more interconnected ganglia as nonwetting phase can flow and be connected through a larger fraction of pore throat sizes than the equivalent low flow rate condition system at the same saturation level this behavior is indeed observed via the ganglia distribution of the n decane experiments which are skewed to significantly larger ganglion sizes relative to the slow flow rate condition i e the 9 saturation images in fig 8 and the 9 curves of fig 9b however for high flow rate air experiments it appears that although the elevated capillary pressure may allow for air invasion through relatively smaller pore throats this is quickly followed by subsequent air disconnection brine reconnection in these pore throats there are multiple factors which could contribute to the enhanced levels of snap off for high flow rate air experiments including the high compressibility and low viscosity of air and the more strongly water wet conditions of air brine experiments table 1 this effect manifests in the creation and persistence of disconnected air ganglia even at relatively high saturations e g disconnected air ganglia distribution which approximate a logarithmic distribution at 45 air saturation fig 9c the effects of fluid viscosity compressibility and contact angle are intertwined in the current study because these properties vary simultaneously however it is anticipated that comparison of experimental data with simulations where properties can be manipulated independently e g starnoni and pokrajac 2018 will help pinpoint the dominant fluid property controls on the occurrence and size of snap off events occurring during drainage 5 conclusions in this study four types of quasi static brine drainage experiments were investigated air invasion at 18 µl h and 3000 µl h and n decane invasion at 20 µl h and 3000 µl h after each pumping cycle the experimental system was allowed to equilibrate and an x ray ct scan of the system at equilibrium was acquired which provided 3d visualization and quantification of the nonwetting phase invasion into the bentheimer sandstone micro cores in addition lattice boltzmann simulations were used to observe the dynamics of the drainage process under parameters approximating the high flow rate n decane invasion the occurrence of significant numbers of disconnected nonwetting ganglia observed in all drainage experiments which are conducted under nominally capillary dominated conditions are supported by dynamic observations of snap off using lb modelling and indicate that the traditional conceptual model of drainage as a connected phase invasion percolation process is incomplete particularly at nonwetting phase saturation levels less than approximately 50 we note that previous studies in 3d media have often focused on the later stages of drainage i e high nonwetting phase saturation levels which is possibly why this early drainage effect has not been widely reported our observations which represent quasi static conditions provide new evidence which support the findings of recent dynamic imaging studies which report repeated displacement disconnection reconnection events during flow andrew et al 2015 reynolds et al 2017 singh et al 2017 and also confirm that these disconnection reconnection events are persistent as they survive equilibration and scanning periods in these experiments nonwetting phase ganglion distributions were visualized and measured and significant differences in ganglion distributions were observed for the different experimental conditions we propose that the differences in the size and connectivity of the disconnected ganglia are attributable to compressibility capillary number and viscosity ratio as well as surface wettability these observations have significant practical implications for future study of 3d multiphase fluid flows from an experimental standpoint quantitative discernment of flow regimes in 3d analogous to the 2d analysis by lenormand et al 1988 will be complicated by the increased opportunity for snap off in 3d in particular for systems with nonwetting phase saturations below the percolation threshold models of drainage which are based on quasi static continuous phase percolation invasion are also likely to result in unphysical and inaccurate fluid distributions and also inaccurate capillary pressure estimations because capillary pressure measured at the boundary does not account for disconnected regions this means that the capillary pressure inferred from boundary measurements will not be consistent with the internal energy of the system practically the occurrence of snap off during drainage processes may have implications for engineering applications such as geologic carbon sequestration where snap off capillary trapping of nonwetting phase carbon dioxide co2 is advantageous for secure storage of the co2 fluid considering that snap off occurs during both drainage and imbibition processes may necessitate updates to estimates of the amount of co2 which will be securely trapped under various injection scenarios in addition for injection of fluids for which interface active agents have been added e g nano particle enhanced injections as in worthen et al 2013 the formation of isolated ganglia in front of the injection plume could have impacts to field relevant engineering properties such as relative permeability and sweep efficiency acknowledgments we gratefully acknowledge funding from the australian research council through discovery project dp160104995 and the member companies of the anu unsw digicore research consortium anna herring is supported by arc discovery early career fellowship de180100082 we also wish to thank tim sawkins and ron cruikshank for contributing to experimental component design and manufacture 3d tomograms and segmented data sets will be made available upon request 
745,we study quasi static drainage displacement experiments in bentheimer sandstone micro cores using x ray computed microtomography two nonwetting fluids air and n decane are investigated under high and low flow rate conditions experimental conditions consider viscosity ratios that vary by a factor of 40 and capillary numbers that range five orders of magnitude but all experiments investigated are conducted under nominally capillary dominated conditions indicating that drainage displacements should demonstrate percolation like invasion patterns however we observe significant and prevalent snap off of nonwetting phase under all experimental conditions a phenomena not predicted by the conceptual model of percolation invasion we further observe that the size and persistence of snapped off ganglia are influenced by the experimental flow rate and the nonwetting phase fluid the quasi static experimental observations are supported by lattice boltzmann modelling of drainage dynamics these findings indicate that current conceptual models of drainage are incomplete with implications for future experimental and modelling studies as well as engineering applications 1 introduction multiphase flow processes in porous media are important to understand for subsurface environmental and engineering applications such as rainfall infiltration into the vadose zone oil recovery geologic co2 sequestration containment of nuclear waste geothermal energy production and remediation of non aqueous phase liquids significant research efforts have been devoted to fundamental flow physics particularly in the case when two immiscible fluids are present two phase flow in these systems the interfacial interactions between the two fluids and the solid surface contribute to determining the distribution and flow patterns of the flowing fluids the wettability state of the solid surface characterizes solid fluid fluid interfacial interactions and is quantified by measuring the contact angle created at the fluid fluid solid contact point through the phase of interest contact angles are often reported relative to the aqueous phase a hydrophilic solid surface is termed water wet contact angle of 0 75 a hydrophobic surface could be termed oil wet or co2 wet depending on the second fluid present in the system contact angle of 105 180 and a surface with only slight or no preference for either fluid would be termed intermediate wet contact angle 75 105 anderson 1987 treiber and owens 1972 for water wet systems such as the one under study here brine is the wetting phase while oil and gas are nonwetting phases the wetting fluid will coat the walls of the solid matrix preferentially occupying small crevices and pore throats while nonwetting fluid will tend to invade and occupy the larger pore spaces and reside in the center of pore bodies when nonwetting phase fluid invades the pore spaces of the medium and displaces wetting phase the process is termed drainage the reverse process where wetting phase enters a medium and nonwetting fluid is displaced is termed imbibition these processes are not simply mirror images to each other there is a hysteresis in these flow processes due to a number of factors not all of which are well understood jerauld and salter 1990 hassanizadeh and gray 1993 hilfer 2006 hilfer and doster 2010 joekar niasar et al 2013 schlüter et al 2016 thus fluid displacement mechanisms are fundamentally different for drainage and imbibition current conceptual models for drainage are largely derived from observations of 2d micromodels in systems where capillary forces and interfacial interactions dominate flow processes capillary fingering drainage patterns arise nonwetting phase invades the largest available pore throats and progressively invades smaller and smaller pore throats in an invasion percolation process as nonwetting phase pressure increases relative to wetting phase pressure and drainage proceeds lenormand et al 1988 hilpert and miller 2001 in situations when body forces such as gravity or viscous forces become dominant over interfacial forces in a system displacement processes are not limited to percolation cluster growth but instead may exhibit compact stable fluid fronts when invading nonwetting fluid is more viscous than the defending wetting phase or the formation of viscous fingering when nonwetting fluid is relatively less viscous configurations which do not conform solely to interfacial forces the appearance and delineation of fluid flow regimes have been investigated from a force balance perspective by many previous studies lenormand et al 1988 vizika et al 1994 méheust et al 2002 løvoll et al 2005 or 2008 zhang et al 2011 wang et al 2012 tsuji et al 2015 and phase diagrams have been developed which compare the relative importance of gravity viscosity and capillarity and indicate which flow regime will dominate a given displacement process following the original phase diagram proposed by lenormand et al 1988 the conceptual model for imbibition is distinct from drainage wetting phase travels preferentially through the small crevices and pore throats in porous media and thickens films on the surface of grains these films swell from the grain surface into the pore space in some cases merging and completely emptying nonwetting phase fluid out of pore bodies termed piston like displacement and in other cases enclosing and trapping nonwetting phase within pore bodies as thickening menisci merge at constrictions in the porous media and snap off ganglia roof 1970 snap off is enhanced during imbibition by lower flow rates chatzis and morrow 1984 morrow et al 1988 nguyen et al 2006 high pore body pore throat aspect ratios li and wardlaw 1986a jerauld and salter 1990 mahmud and nguyen 2006 and low contact angles li and wardlaw 1986a 1986b mahmud and nguyen 2006 mobilization and transport of individual ganglia can then occur if the pressure drop across a ganglion is sufficient to push it through the constrictions which impede it payatakes et al 1980 while the above descriptions of drainage and imbibition describe the generalized transport of fluids during flow processes additional complex flow mechanisms occur intermittently under very rapid time scales milliseconds and very small length scales sub pore these fast small events are thus difficult to observe under experimental settings but nonetheless can result in significant changes to fluid connectivity and pore occupancy for example rapid haines jumps during drainage when the capillary pressure across a fluid interface exceeds the critical pressure required to invade a constriction and nonwetting fluid rushes into the adjacent pore body may lead to localized imbibition of wetting phase at the constriction causing snap off of small isolated nonwetting ganglia in front of the main invading fluid front al gharbi and blunt 2005 andrew et al 2015 roof 1970 other recent experimental observations have demonstrated that haines jumps can also lead to nonlocal reconfigurations of fluid due to cooperative filling as fluid enters a large pore body it may pull fluid from other previously filled pore throats or bodies to supply the rapid invasion armstrong et al 2015 the impacts of these very rapid displacement processes and fluid reconfigurations are not captured by the capillary fingering viscous fingering stable displacement flow regimes described above in addition to the disparity in temporal dependence between local rapid events and bulk flow the spatial dimension of a flow process introduces significant additional complexity flow processes are relatively well studied from 2d and quasi 2d perspectives however investigations into 3d systems have been inhibited by the difficulties inherent in visualizing opaque 3d systems at relevant length and time scales only recently has imaging technology advanced such that 3d flow processes can be imaged in real time resulting in enhanced understanding of processes including haines jumps during drainage berg et al 2013 bultreys et al 2015 the transition from connected pathway flow to ganglion dynamics during imbibition rücker et al 2015 capillary pressure conditions of different displacement mechanisms during imbibition singh et al 2017 fluid breakup during co injection datta et al 2014 and different snap off mechanisms occurring during drainage andrew et al 2015 it has long been known that the very high velocities attained during haines jumps in drainage violate the assumptions of capillary dominance but only recently has it been possible to explore the consequences of this armstrong and berg 2013 andrew et al 2015 reynolds et al 2017 singh et al 2017 the prevalence overall influence and implications of snap off events and transiently disconnected ganglia on drainage patterns have yet to be fully examined here we use 3d x ray computed microtomography x ray microct to observe quasi static unsteady state drainage experiments in bentheimer sandstone for two sets of wetting nonwetting fluid pairs air nonwetting brine wetting and n decane nonwetting brine wetting for each set of fluids two flow rate conditions were investigated encompassing three orders of magnitude of flow velocity we observe widespread snap off in all experiments particularly at low nonwetting phase saturation levels below 50 the dynamics of snap off during drainage are further explored by lattice boltzmann simulation the quasi static time steps of the simulation show repeated snap off and reconnection events supporting experimental results and providing a pathway to further investigation of this phenomenon 2 materials and methods 2 1 experimental fluid pairs the wetting fluid for all experiments was degassed 1 0 m potassium iodide ki brine the ki attenuates x rays and thus acts as a contrast agent in imaging studies two nonwetting fluids were investigated representing two common categories of gas and oil ambient condition air and n decane properties of these fluids are reported in table 1 interfacial tension and contact angle were measured via goniomenter as bentheimer sandstone consists of greater than 90 quartz mayr and burkhardt 2006 peksa et al 2015 a glass slide was used to approximate the surface properties of sandstone for contact angle measurement 2 2 sandstone sample and core holder assembly bentheimer sandstone samples of 4 4 mm diameter and approximately 13 mm long were used for experiments bentheimer is a clean and relatively homogenous sandstone with low clay content and well described petrophysical properties maloney et al 1990 peksa et al 2015 2016 the samples used for these studies were unfired data from several cores was compiled for analysis as indicated in table 2 bentheimer sandstone is a relatively homogenous medium and all analytical volumes are larger than a standard rev e g as determined in herring et al 2013 2015 porosity of 24 10 and absolute permeability of 4 25 darcy measured via lattice boltzmann modelling for one of the imaged micro cores used in this study have been reported previously liu et al 2017 cores were re used for multiple experiments samples exposed to n decane were cleaned by progressive submersion in acetone ethanol and deionized water between experiments to ensure that surface chemistry alteration did not occur due to exposure of oil solvents or x rays dynamic capillary pressure saturation curves were recorded and inspected during each experiment no significant changes in shape or magnitude of the capillary pressure saturation curves was observed indicating that contact angle remained consistent for each core throughout the series of experiments the experimental apparatus and description for air brine experimental suite has been reported previously herring et al 2017 this apparatus and procedure was slightly modified for n decane experiments as described below a new polyetheretherketone peek and glass core holder was designed and built in house replacing the titanium core holder used in air brine experiments herring et al 2016 2017 the design of this new core holder allowed for tighter packing of the cores and thus more effective brine saturation prior to drainage experiments fig 1 the core holder consisted of a glass capillary tube at the base an empty peek chamber for the sandstone core and an adjustable screw top upper endcap to assemble the core holder the dry sandstone core was wrapped in two layers of hydrophilic nylon membrane pore size of 1 2 µm general electric company fairfield ct united states and one outer layer of teflon tape additional circular layers of hydrophilic membrane were also placed directly below the core and compressed onto the lower face of the core via viton o rings the hydrophilic membrane provided water wet boundary conditions and reduced the occurrence of nonwetting phase breakthrough through the core allowing for achievement of relatively high capillary pressures during drainage however it was found that breakthrough did occur in decane brine experiments we attributed this to the increased contact angle and reduced interfacial tension of the oil brine system relative to the air brine system table 1 thus extra membrane layers were used in decane brine experiments five circular layers on the lower core face compared to air brine experiments two layers the core was assembled within the core holder between a series of viton o rings which seal and compress to the core when axial compression is applied and circular teflon disks to reduce the torque on the core when endcaps were screwed on during assembly the base of the core holder was connected to a flexible peek tube with a diameter of 0 75 mm and a length of 1 5 m this line was connected to a harvard phd2000 syringe pump harvard apparatus holliston ma united states a brine reservoir contained within a syringe and a keller series 35x pressure transmitter accuracy of 0 1 mbar keller american inc newport news va united states which provided continuous measurements of brine pressure temperature controls were incorporated into the microct enclosure by design and the temperature was closely monitored during experiments the temperature variation during each experiment was consistently 1 c and was within the range of 21 25 c between experiments prior to flow experiments the dry core and core holder assembly was attached to a vacuum pump and air was evacuated from the system under vacuum of at least 60 kpa relative to ambient pressure for approximately five minutes after which brine was allowed to enter the core still under vacuum after this point cycles of vacuum pressure applied by closing the valve leading to the vacuum line and manually pushing on the reservoir syringe containing ki brine and brine flushing were carried out until visual inspection of radiographs indicated that air was removed as shown in the section 4 this saturation procedure was not entirely successful and some air was present in all experiments equivalent to 0 2 3 3 saturation in n decane experiments and approximately 6 in air experiments for air experiments a flexible wax cover was sealed in place on the top endcap in order to prevent evaporation but still allow for air to be pulled into the core during drainage for n decane experiments the top endcap was connected to a sealed oil reservoir via another peek tube with an inside diameter of 0 75 mm and a length of 1 5 m a syringe needle was inserted into the top of the otherwise sealed oil reservoir to maintain oil reservoir pressure at constant atmospheric pressure while preventing contamination of the n decane reservoir throughout the experiments a schematic representation of the experimental set up is shown in fig 1 2 3 flow experiments the rate and frequency of pumping cycles were controlled by a labview program that integrated the syringe pump controls pressure and temperature measurement and microct scan acquisition software to effect quasi static flow experiments as described by herring et al 2017 for each experiment a scan was acquired of the initial brine saturated state of the system and then brine was withdrawn from the micro core via the syringe pump at the set experimental flow rate until the nonwetting phase entry pressure determined during practice experiments was measured at this point pumping was halted the system was allowed to equilibrate for a set amount of time also estimated from pressure profiles measured during practice experiments reported in table 2 and then another scan was acquired after this point cycles of pumping of predetermined volume equilibration and scanning were carried out until drainage was complete irreducible wetting saturation was achieved as indicated by transducer measured capillary pressure values exceeding 15 kpa herring et al 2017 or the experiment otherwise terminated due to n decane breakthrough through the hydrophilic boundary layer below the core the volume of fluid withdrawn during each pumping cycle which subsequently determined the number of scans collected was selected based on the total scanner time available for each experiment due to the relatively small pore volume of the micro cores and the differences in pressure measured for the different fluid and flow rate conditions it was impossible to achieve exactly the same saturation levels across all experiments however sufficient data was collected to span the range of saturation of interest for all experiments 2 4 lattice boltzmann modelling a subsection of a drainage experiment was also modeled using the lattice boltzmann lb method the lb method is a numerical method for solving the navier stokes equations which are based on the mesoscopic kinetic theory chen and doolen 1998 succi 2001 with the growing popularity in recent two decades the lb method has become a well developed numerical tool for modeling multicomponent fluid flows in porous media with complex boundary conditions in this work we used a multi relaxation time mrt color lb model described by mcclure et al 2014 additional details of the lb model implementation can be found in mcclure et al 2016a where it has shown that computed static and dynamic contact angles are consistent with existing slip models such that the interfacial and contact line dynamics can be accurately recovered this lb implementation also incorporates an in situ analysis module that generates a range of measures such as minkowski functionals based on the multiscale averaging theory at high temporal resolution armstrong et al 2016 mcclure et al 2016b due to the low miscibility and compressibility nature of our lb model only n decane brine drainage was simulated the relaxation parameters in the lb model are chosen for n decane and brine such that the experimental viscosity ratio m 0 8 is matched the density ratio was set to 1 0 for simplicity as the gravitational force plays limited role in the n decane brine system and a contact angle of 0 strongly water wetting was used to avoid the generation of very small non physical nonwetting droplets this issue is described in detail in li et al 2018 the model parameter α is set to match the n decane brine interfacial tension given the image resolution of 4 90 µm and considering the conversion relation between lb and physical units based on schaap et al 2007 the lb simulation has a temporal resolution of 0 89 microsecond per lb iteration the imbedded analysis module in our lb implementation mcclure et al 2016b reports physically morphologically averaged quantities every 1000 lb iterations i e 1 millisecond which is good enough to capture rapid drainage events such as haines jumps armstrong and berg 2013 zacharoudiou and boek 2016 a sub domain of 2563 voxels of a dry bentheimer sandstone image was used corresponding to a cube with side lengths 1 27 mm the simulation domain consists of a non wetting phase reservoir nwr and a wetting phase reservoir wr at the inlet and outlet respectively and a porous barrier between the porous medium and wr which prevents the invading non wetting phase from exiting at the inlet a flux boundary condition is applied to mimic the constant non wetting phase injection while a fixed pressure boundary condition is applied at the outlet this flux boundary condition is advantageous since an inlet volumetric flow rate can be specified in advance to match the experimental capillary number for the 2563 voxels sub domain a flow rate of 435 µl h is used to give ca 10 5 which matches the high flow rate case in the experiment 3 data processing and quantification x ray computed microtomography x ray ct was used to visualize the 3d internal structure and fluid configurations within bentheimer sandstone this imaging technology is widely used for characterization of geologic materials and fluid flows wildenschild and sheppard 2013 x ray ct scans were acquired at a tube voltage of 100 kv n decane experiments in the peek core holder utilize a current of 15 µa while air experiments within a titanium core holder used 65 µa other parameters of scan acquisition and data analyzed are reported in table 2 data processing was accomplished with mango an image processing and quantification software developed by the department of applied mathematics at the anu cylindrical subsections were selected to exclude preferential wall flow the inherent geometry at the core edges where irregular grains meet the smooth membrane dictated that some of the larger flow paths occurred at the core edges which caused nonwetting fluid to preferentially enter the regions near the walls all quantitative results are calculated from the smaller subsection excluding wall flow two phase segmentation nonwetting phase and combined wetting solid phase was accomplished using an active contours segmentation routine sheppard et al 2004 post segmentation speckle noise removal was achieved by removing isolated clusters labeled as nonwetting phase smaller than the volume equivalent to a sphere of 15 µm radius which is smaller than the smallest pore size expected for bentheimer sandstone maloney et al 1990 all nonwetting phase ganglia quantitative metrics were calculated on the final segmented data volumes using mango and 3d visualization of data was achieved using the commercial software avizo fig 2 illustrates an example data set a shows raw grayscale data of the reconstruction of the first data volume in the drainage series including some air bubbles which are present due to incomplete vacuum saturation process b shows raw grayscale data of the same sample after n decane drainage increases nonwetting phase saturation to 9 and c shows segmented nonwetting phase ganglia with each ganglia labeled in a different color overlain on the grayscale as shown in table 2 multiple experiments were conducted for various given fluid flow rate conditions data from the different experiments for a given fluid flow rate condition are combined and presented as a single class of experiments in section 4 4 results and discussion two phase drainage flows are often classified into flow regimes via dimensional analysis of fluid and flow properties e g lenormand et al 1988 zhang et al 2011 based on these established classification schemes which compare the relative influence of viscous and capillary forces all drainage experiments considered herein fall within the capillary fingering regime or are in a transitional region very close to the capillary fingering domain see definitions of capillary number and viscosity ratio in table 1 and location of experimental conditions in fig 3 in this regime flow is defined as being dominated by capillary forces and is characterized by percolation like invasion i e nonwetting phase invades pore spaces according to the size distribution of pore throats available with preference to larger pore throats this standard understanding of drainage is challenged by our results which are presented in the following sections bulk phase capillary pressure measurements section 4 1 topological measurements of nonwetting phase ganglia section 4 2 and nonwetting snapped off ganglia size distributions section 4 3 section 4 4 presents a lattice boltzmann simulation that illustrates the dynamics of a snap off event and section 4 5 provides discussion and a conceptual interpretation of our results 4 1 pc σ sw relationships the relationship between transducer measured capillary pressure pc normalized by interfacial tension σ and image derived brine saturation sw is shown in fig 4 for representative experiments at high and low flow rates for drainage experiments of n decane and air and for the high flow rate n decane lb simulation which was executed for the early part of drainage the capillary pressure in the lb simulation is calculated based on the interface averaged mean curvature the data points were extracted every 1000 lb steps i e 1 ms and it can be seen that a non monotonic pc σ sw is obtained which well captures sudden pc drops as the non wetting phase advances during haines jumps within each flow rate regime the air and n decane pc σ sw relationships agree but pressure values are elevated for the 3000 µl h experiments of both air and n decane and for the dynamic lb simulation data the phenomena of elevated pc measured in the bulk fluid phases across the core via physical pressure transducer during these quasi static flow experiments has been previously reported herring et al 2017 herring and co authors attributed elevated pc measurements at high flow rates to the sharp boundary condition at the base of the core causing a rapid redistribution of fluids the authors proposed that fluids are stabilized in the higher pc state because the fluid phases become hydraulically disconnected during the rapid redistribution in those experiments the agreement of the dynamic curvature values measured via lb simulation and the quasi static equilibrium pressure values measured during experiments supports this interpretation the pc σ sw relationships shown in fig 4 provide insight into nonwetting phase invasion under the four experimental conditions investigated herein both n decane and air show approximately the same pc σ sw relationships at each flow rate this indicates that for a given saturation and flow rate nonwetting phase either n decane or air is likely to invade similar regions of the pore space the pc σ sw relationships for the high flow rate experiments are elevated relative to the low flow rate experimental data implying that at higher flow rate nonwetting phase can invade smaller pore throats and pore spaces 4 2 topological metrics nonwetting phase topology as quantified by the euler characteristic χ has recently been identified as a parameter with potential to inform understanding about fluid configurations permeability and trapping during two phase flow herring et al 2013 2015 rücker et al 2015 armstrong et al 2016 mcclure et al 2016c schlüter et al 2016 liu et al 2017 here we present the normalized euler characteristic of the nonwetting phase as a function of nonwetting phase saturation fig 5 for full description and interpretation of how nonwetting configurations manifest to produce particular euler characteristic values we refer to herring et al 2013 2015 for interpretation of fig 5 we note that a normalized euler characteristic of 1 0 indicates that nonwetting phase has reached maximum interconnectivity there are no disconnected nonwetting phase regions and the nonwetting phase has occupied all pore throats thus achieving the same level of interconnectivity as the pore space alternatively normalized euler values of zero or less than zero indicate that there are relatively high numbers of disconnected isolated nonwetting phase ganglia fig 5 demonstrates that all experimental systems investigated herein exhibit similar topological signatures low interconnectivity relatively large numbers of disconnected ganglia at nonwetting phase saturations less than 50 with dramatically increasing interconnectivity increases in redundant loops and connections of nonwetting phase as the nonwetting saturation increases above the percolation threshold which occurs at approximately 50 nonwetting phase saturation this general relationship has been observed in many other experimental systems herring et al 2013 2015 schlüter et al 2016 minor differences in the data are observed the air drainage experiments which are more fully sampled at nonwetting phase saturations above 50 indicate that changes in flow rate are relatively insignificant at least for the range of flow rates considered here which vary by a factor of 150 the n decane experiments are less well sampled at higher nonwetting phase saturations but where data exists it demonstrates a higher interconnected nonwetting phase for a given saturation value relative to the air data schlüter et al 2016 propose that normalized euler saturation relationships can be used to quantitatively identify two phase flow regimes according to the approach presented by schlüter and co authors we measured the power law trends for our experimental data where χ n w 0 table 3 based on the analysis of schlüter et al 2016 the values presented in table 3 do indeed indicate that the flow experiments examined herein fall within the capillary fingering regime as suggested by the traditional force balance flow regime analysis we note that power law analysis was not achievable for the high flow rate n decane experiments due to the lack of data points where χ n w 0 in those experiments however earlier in drainage at saturations below the percolation threshold i e 50 we also observe negative normalized euler values indicating significant numbers of disconnected nonwetting phase ganglia this observation does not conform to conventional conceptual models of invasion percolation patterns to further investigate the occurrence of disconnected nonwetting ganglia in fig 6 we present numbers of isolated ganglia as a function of nonwetting phase saturation for saturation levels below 50 as described in section 2 3 initial vacuum saturation methods were inadequate and some amount of air was present within rock cores for all experiments thus in fig 6 we present the increase in isolated nonwetting phase ganglia relative to the number of air bubbles which were originally present in each sample under the conventional conceptualization of capillary fingering and percolation invasion the number of isolated ganglia should decrease as nonwetting phase invades and connects to each isolated bubble however as shown in fig 6 we rather observe large increases in numbers of disconnected ganglia as drainage proceeds and nonwetting phase saturation increases indeed increases of approximately 500 isolated snapped off nonwetting ganglia are observed at nonwetting phase saturations of approximately 20 representing a significant volume fraction i e 50 of the nonwetting phase present details on ganglia size distributions follow in section 4 3 after this point as drainage proceeds and more nonwetting fluid invades the pore space these individual ganglia merge and the number of distinct ganglia decrease as the nonwetting phase saturation approaches the percolation threshold at approximately 50 4 3 distribution of nonwetting phase to provide context for the following discussion of nonwetting phase ganglia distributions illustration of ganglia size values with reference to the bentheimer micro cores investigated in this study is provided in fig 7 ganglia illustrating the range of ganglia volume values are identified and are labeled in red with the other nonwetting phase present in the system shown in transparent blue during experiments small individual pores may be filled with ganglia on the order of 10 3 mm3 singlets ganglia of 10 2 mm3 represent larger pores and doublets i e ganglia which fill a couple of pores bodies connected via thinner pore throats and ganglia which measure 10 1 mm3 span tens of pore bodies ganglia on the order of 1 mm3 comprise hundreds of connected pore bodies filling a significant fraction of the pore space of the micro core and as ganglia increase in size beyond 1 mm3 and approaching 10 mm3 they span the core and can be considered to be a part of the main percolating cluster for context the physical size of analyzed volume of these micro cores was approximately 100 mm3 with resulting pore volumes on the order of 20 25 mm3 visualization of nonwetting phase distribution during early drainage i e nonwetting saturation 50 is presented in fig 8 distinct nonwetting phase ganglia are labeled with different colors in fig 8 and the exact saturation level calculated for each data volume is presented with each isosurface as described in section 2 3 experimental complications were encountered in a achieving 100 brine saturation conditions at the start of each experiment as displayed in the top row of fig 8 and b in achieving exactly the desired saturation levels in these bentheimer micro cores nevertheless the data collected provide valuable information on the evolution of nonwetting phase occupancy of the pore space under the different experimental conditions and comparisons between data sets at approximately equivalent saturation levels are feasible as demonstrated in fig 8 these images suggest that initial air saturation prior to drainage experiments does not influence results significantly cumulative ganglia size distributions are shown for selected data sets in fig 9 and provide additional quantitative context for interpreting the qualitative isosurfaces of fig 8 in particular we observe the air ganglia which are present at the start of drainage experiments are similar in spatial distribution fig 8 and size distribution fig 9a there was more air present at the beginning of air drainage experiments 100 of air bubbles existing in n decane experiments and approximately 90 by volume of air bubbles existing in air experiments were smaller than 10 2 mm3 meaning that air present at the beginning of drainage existed in single pore bodies or doublets in n decane experiments comparisons of ganglia at 9 nonwetting saturation demonstrate that n decane under high flow rate conditions exists in larger disconnected clusters relative to slow flow rate conditions investigation of the ganglia distributions at 28 29 saturation indicate that both high and low flow rate conditions exhibit the formation of a spanning percolating cluster i e a ganglion 1 mm3 by 28 29 nonwetting saturation in air experiments under slow flow rate conditions the formation of a large spanning percolating cluster 1 mm3 is apparent at 28 saturation similar to the n decane results however under high flow rate conditions the spanning percolating cluster is not yet present at 45 nonwetting saturation a dramatic deviation from the other experiments 4 4 lattice boltzmann simulation of snap off event all the experimental data presented herein represent quasi static conditions in order to demonstrate the dynamics of these snap off events we use the lattice boltzmann lb method to simulate a snap off event during n decane drainage under high flow rate conditions capillary number of 10 5 visualization of the snap off and subsequent reconnection event along with the relevant subsection of the curvature derived pc σ sw relationship is shown in fig 10 the changes in fluid distribution shown in fig 10 occur over a very small overall saturation range overall nonwetting saturation change of approx 1 5 each 3d visualization shows the difference in fluid distribution between two specific states we use here the color convention presented by helland et al 2017 that is gold indicates fluid which is present for both before and after states red indicates fluid which was present in the before but not the after and blue indicates new fluid which is only present in the after state the original snap off event occurs between stages a and b prior to a haines jump the capillary pressure increases as the non wetting phase is forced into the narrowest parts of the pore space when the meniscus finally squeezes through the pore neck the associated energy is released and the local capillary pressure decreases i e stage a the local decrease in capillary pressure is what allows snap off to occur during drainage since connectivity through the pore throat may not be maintained throughout the haines jump this process is illustrated in fig 10 at stage a pc σ is dropping as nonwetting fluid invades a large pore body during a haines jump the ganglia then snaps off and as pc σ and snw increase to stage b nonwetting fluid expands the terminal menisci of the connected cluster between stages b and c the nonwetting fluid reconnects to the snapped off ganglia and some fluid is redistributed the terminal menisci of the main connected cluster retract and that fluid is added to the snapped off ganglia from c to d the previously disconnected ganglia becomes reconnected and the terminal menisci of the connected cluster retract further to provide the additional fluid needed to maintain the connection the simulation results indicate that the quasi static experimental data presented above have captured snapshots of the dynamic drainage process wherein fluid may disconnect and reconnect intermittently many times during the nonwetting fluid invasion the simulation results also agree well with other recent experimental observations of dynamic connectivity reynolds et al 2017 and cooperative filling armstrong and berg 2013 mechanisms 4 5 conceptual model for snap off during drainage we identify several effects which influence the size and connectivity of the nonwetting ganglia in these experiments a the imposed fluid flow rate and the resulting pressure drop across the micro core during pumping b the difference in compressibility and viscosity of the fluids and c the contact angle difference between fluid pairs we note that while ganglia size profiles and ganglia distributions are likely influenced by the geometry and boundary conditions of our experimental system we can still draw some inferences about how the factors identified above influenced ganglia formation in these experiments under low flow rate conditions ganglia become disconnected via a process similar to the roof snap off mechanism described by andrew et al 2015 as nonwetting phase quickly invades a pore body in a haines jump some resident wetting phase is pushed backwards towards the pore throat this displaced wetting phase then reconnects in the throat and the nonwetting phase becomes snapped off ahead of the advancing nonwetting phase flow pathway the ganglia size distributions at 28 nonwetting saturation for low flow rate n decane fig 9b and low flow rate air fig 9c are quite similar indicating that ganglia observed in the low flow rate experiments of both fluids are the product of the same snap off mechanism the picture is different in high flow rate conditions under high flow rate conditions we observe elevated capillary pressure measurements for both fluids fig 4 this implies that nonwetting phase in the high flow rate systems has the ability to invade smaller pore throats relative to low flow rate experiments at the same saturation level this effect has the potential to create larger and more interconnected ganglia as nonwetting phase can flow and be connected through a larger fraction of pore throat sizes than the equivalent low flow rate condition system at the same saturation level this behavior is indeed observed via the ganglia distribution of the n decane experiments which are skewed to significantly larger ganglion sizes relative to the slow flow rate condition i e the 9 saturation images in fig 8 and the 9 curves of fig 9b however for high flow rate air experiments it appears that although the elevated capillary pressure may allow for air invasion through relatively smaller pore throats this is quickly followed by subsequent air disconnection brine reconnection in these pore throats there are multiple factors which could contribute to the enhanced levels of snap off for high flow rate air experiments including the high compressibility and low viscosity of air and the more strongly water wet conditions of air brine experiments table 1 this effect manifests in the creation and persistence of disconnected air ganglia even at relatively high saturations e g disconnected air ganglia distribution which approximate a logarithmic distribution at 45 air saturation fig 9c the effects of fluid viscosity compressibility and contact angle are intertwined in the current study because these properties vary simultaneously however it is anticipated that comparison of experimental data with simulations where properties can be manipulated independently e g starnoni and pokrajac 2018 will help pinpoint the dominant fluid property controls on the occurrence and size of snap off events occurring during drainage 5 conclusions in this study four types of quasi static brine drainage experiments were investigated air invasion at 18 µl h and 3000 µl h and n decane invasion at 20 µl h and 3000 µl h after each pumping cycle the experimental system was allowed to equilibrate and an x ray ct scan of the system at equilibrium was acquired which provided 3d visualization and quantification of the nonwetting phase invasion into the bentheimer sandstone micro cores in addition lattice boltzmann simulations were used to observe the dynamics of the drainage process under parameters approximating the high flow rate n decane invasion the occurrence of significant numbers of disconnected nonwetting ganglia observed in all drainage experiments which are conducted under nominally capillary dominated conditions are supported by dynamic observations of snap off using lb modelling and indicate that the traditional conceptual model of drainage as a connected phase invasion percolation process is incomplete particularly at nonwetting phase saturation levels less than approximately 50 we note that previous studies in 3d media have often focused on the later stages of drainage i e high nonwetting phase saturation levels which is possibly why this early drainage effect has not been widely reported our observations which represent quasi static conditions provide new evidence which support the findings of recent dynamic imaging studies which report repeated displacement disconnection reconnection events during flow andrew et al 2015 reynolds et al 2017 singh et al 2017 and also confirm that these disconnection reconnection events are persistent as they survive equilibration and scanning periods in these experiments nonwetting phase ganglion distributions were visualized and measured and significant differences in ganglion distributions were observed for the different experimental conditions we propose that the differences in the size and connectivity of the disconnected ganglia are attributable to compressibility capillary number and viscosity ratio as well as surface wettability these observations have significant practical implications for future study of 3d multiphase fluid flows from an experimental standpoint quantitative discernment of flow regimes in 3d analogous to the 2d analysis by lenormand et al 1988 will be complicated by the increased opportunity for snap off in 3d in particular for systems with nonwetting phase saturations below the percolation threshold models of drainage which are based on quasi static continuous phase percolation invasion are also likely to result in unphysical and inaccurate fluid distributions and also inaccurate capillary pressure estimations because capillary pressure measured at the boundary does not account for disconnected regions this means that the capillary pressure inferred from boundary measurements will not be consistent with the internal energy of the system practically the occurrence of snap off during drainage processes may have implications for engineering applications such as geologic carbon sequestration where snap off capillary trapping of nonwetting phase carbon dioxide co2 is advantageous for secure storage of the co2 fluid considering that snap off occurs during both drainage and imbibition processes may necessitate updates to estimates of the amount of co2 which will be securely trapped under various injection scenarios in addition for injection of fluids for which interface active agents have been added e g nano particle enhanced injections as in worthen et al 2013 the formation of isolated ganglia in front of the injection plume could have impacts to field relevant engineering properties such as relative permeability and sweep efficiency acknowledgments we gratefully acknowledge funding from the australian research council through discovery project dp160104995 and the member companies of the anu unsw digicore research consortium anna herring is supported by arc discovery early career fellowship de180100082 we also wish to thank tim sawkins and ron cruikshank for contributing to experimental component design and manufacture 3d tomograms and segmented data sets will be made available upon request 
746,recently we have analytically derived a temporal velocity random walk model for macrodispersion or transport uncertainty quantification based on velocity statistics from classical first order perturbation expansions the applicability of these expansions is limited to mildly heterogeneous formations with log conductivity variances σ y 2 1 in this work we reformulate our model in order to account for velocity skewness and inter component correlation that emerge as key drivers of non fickian dispersion at elevated heterogeneity levels σy eventually we arrive at a light weight parametrization of macrodispersion that is consistent with our earlier formulation but at the same time is applicable for formations with multi gaussian log conductivity characterization of variable heterogeneity i e σy from 0 to 1 and beyond keywords macrodispersion transport uncertainty quantification non fickian transport random walk perturbation expansion langevin equation stochastic diffusion process periodic flow fields 1 introduction macrodispersion is the spreading of fluid or tracer particles resulting from spatial velocity differences gelhar 1993 equation 5 1 10 these differences may arise in an aquifer comprised of horizontal layers gelhar et al 1979 just to give one possible scenario for example in the well documented krauthausen tracer experiment vereecken et al 2000 section 5 1 extracted a vertical conductivity variogram with a clear nugget effect and roughly ten times smaller correlation length compared to its horizontal counterpart which did not have a nugget this behavior is indicative of a horizontal layer structure since the hydraulic conductivity y x is typically a spatially heterogeneous quantity gelhar 1993 fig 1 3 the flow field in the different layers varies vereecken et al 2000 section 6 1 as a result even though particles originate from the same vertical line in the aquifer they will travel with different velocities in the layers which leads to a horizontal spreading or dispersion when focusing on the vertically averaged tracer concentration 1 1 groundwater wells can be viewed as vertical mixers over the different layers similar to a vertical average macrodispersion is typically the dominant spreading mechanism compared to dispersion at the pore scale see dagan and fiori 1997 or caroni and fiorotto 2005 figs 2 5 and 6 with péclet mostly 100 rubin 2003 section 10 5 2 early attempts to model macrodispersion have focused on the advection dispersion equation for the tracer concentration with time or scale dependent dispersivities e g dagan 1987 de dreuzy et al 2007 fernandez garcia et al 2005 salandin and fiorotto 1998 silliman and simpson 1987 these dispersivities were studied experimentally for example by silliman and simpson 1987 or fernandez garcia et al 2005 derived analytically by means of low order perturbation theory e g by dagan 1987 or jaekel and vereecken 1997 and numerically investigated for example by salandin and fiorotto 1998 or de dreuzy et al 2007 through monte carlo mc simulations the numerical simulation studies revealed that deviations in velocity statistics and dispersivities between reference mc and perturbation theory become apparent for log conductivity variances σ y 2 1 deviations were mainly attributed to increasingly non gaussian velocity statistics that are induced by preferential flow paths or channels salandin and fiorotto 1998 trefry et al 2003 spanning over several correlation lengths ly of y more realistic stochastic models based on fluid or tracer particles have been developed since e g berkowitz et al 2006 le borgne et al 2008a 2008b jenny et al 2006 kang et al 2015 meyer 2017 meyer and saggini 2016 meyer and tchelepi 2010 meyer et al 2013 and were partly reviewed by noetinger et al 2016 while berkowitz et al 2006 promoted the versatile continuous time random walk ctrw framework that was for example adapted by le borgne et al 2008a b and kang et al 2015 for the description of diffusive advective transport in heterogeneous porous media and advective transport in fractured media respectively our work has mainly focused on advective transport in two dimensional multi gaussian fields with variable heterogeneity levels multi gaussian fields are widely applied and were recently found in connection with ergodic plumes 2 2 plumes that are large enough such that ensemble and spatial averages are interchangeable are referred to as ergodic plumes and three dimensional formations to lead to similar dispersion behavior as more complex geostatistical models jankovic et al 2017 in our work meyer and tchelepi 2010 meyer et al 2013 we have systematically studied similar to trefry et al 2003 fig 2 and nowak et al 2008 the increasingly complex velocity dynamics which are at the heart of the non fickian transport behavior arising at elevated heterogeneity levels these dynamics result from stagnant fluid motion in low conductivity islands interrupted by intermittent high velocity bursts induced by particle motion in high conductivity channels moreover we have investigated the applicability of temporal velocity random walks rws as surrogate models for these dynamics by systematically evaluating the markov hypothesis for the lagrangian velocity process meyer and saggini 2016 velocity rw models were formulated meyer and tchelepi 2010 meyer et al 2013 that account for the velocity skewness and the complex temporal correlation behavior in the absence of pore scale dispersion the addition of pore scale dispersion which is typically accounted for in lagrangian numerical schemes by brownian motion salamon et al 2006 increases velocity de correlation and promotes randomness which seem to facilitate the formulation of stochastic models the previously outlined lagrangian models are particularly useful in the context of reactive flows as showcased in the extensive work of pope 2011 about flow and transport in turbulence while fluid phase reaction source terms can be incorporated in exact form and the effect of pore scale dispersion on the mean concentration can be reflected by a brownian motion in the particle position equation meyer et al 2010 eqs 10 and 20 mixing models are required to account for species mixing or dilution within fluid particles due to sub darcy or pore scale effects meyer et al 2010 eq 12 suciu et al 2015 current research efforts focus on a better understanding of mixing in heterogeneous porous media e g aquino and bolster 2017 le borgne et al 2013 dentz et al 2011 de dreuzy et al 2012 lester et al 2016 furthermore the previously outlined lagrangian models can be applied in the context of uncertainty quantification of subsurface flow and transport here the different aquifer layers of the initial example translate into several probable scenarios of a shallow two dimensional aquifer with uncertain transmissivity distribution 3 3 the transmissivity results from a vertical average of the conductivity bear 1972 section 5 8 1 fluid particles now travel in different aquifer scenarios or realizations enabling the estimation of e g the concentration mean standard deviation distributions or the concentration probability density function pdf in our contributions dünser and meyer 2016 meyer et al 2013 we demonstrate the applicability of our stochastic models for highly non stationary settings involving different transmissivity measurement configurations from our model computations transport predictions were obtained at a tiny fraction of the computational cost of standard mc meyer et al 2013 section 4 2 3 during the review process we were made aware of the percolation based framework by hunt and coworkers ghanbarian alavijeh et al 2012 hunt and skinner 2008 here similar to preferential flow paths that form at the darcy scale for σy high critical paths establish in strongly disordered pore networks in connection with critical path analysis hunt and coworkers outline a model for dispersion phenomena in partly as well as fully saturated media with fractal pore radius distributions and apply the model in a number of cases hunt and sahimi 2017 certain model parameters are determined for example in the saturated case by fitting the particle arrival time distribution for one medium size and by predicting subsequently arrival times at other sizes hunt and skinner 2008 similarly most of the previously cited rw modeling efforts rely on numerical model calibration le borgne et al 2008a b used numerical velocity transition matrices while curve fits for drift and diffusion functions corresponding to velocity transition moments were applied in our work meyer and tchelepi 2010 meyer et al 2013 more recently we have analytically derived these functions for temporal stochastic diffusion processes of fluid particles in mildly heterogeneous multi gaussian fields meyer 2017 to this end the gaussian lagrangian velocity statistics resulting from first order perturbation theory dagan 1985 rubin 1990 were used as a basis in the present contribution we reformulate the rw model derived from perturbation theory such that it becomes compatible with the non gaussian velocity statistics that emerge at increasing σy the reformulated rw model reduces for σy 0 to its gaussian origin from perturbation theory and is considerably simpler compared to our earlier efforts meyer and tchelepi 2010 meyer et al 2013 it is parametrized in terms of the mean flow velocity the log conductivity or transmissivity correlation length variance and provides accurate transport predictions for mildly as well as highly heterogeneous formations our work is structured as follows in section 2 we summarize the gaussian rw model resulting for σy 0 from first order perturbation theory as outlined in meyer 2017 the velocity statistics presented in section 3 were gathered from mc simulations for σy 0 and enable the quantification and parametrization of deviations from the gaussian perturbation theory statistics in section 4 the rw model from section 2 is reformulated in order to account for the non gaussian velocity statistics parametrized in section 3 the accuracy of the resulting refined rw model is assessed in section 5 and a summary of the present work is provided in section 6 2 random walk from first order perturbation theory in this work we focus on two dimensional space stationary formations with multi gaussian log conductivity or transmissivity distributions y x at position x x 1 x 2 t the ensemble mean log conductivity y and variance σ y 2 are constant and the spatial variability of y x is described by an exponentially decaying autocorrelation function ρ y r exp r l y with correlation length ly and separation vector r x x of points x and x if advection by the flow field u x is the dominant and sole transport mechanism no pore scale dispersion the position of a fluid or tracer particle x t x 0 is given as a function of time t and its initial location x 0 at t t 0 by 1 x t x 0 x 0 t 0 t u x t x 0 d t here the velocity u x q x n with u being its ensemble mean depends through the constant porosity n on the specific discharge q x the latter is given by darcy s law 2 q k h where k x exp y x is the conductivity or transmissivity 4 4 a less common but in terms of physical units better definition of the log conductivity y is k k 0 ey with the unit constant k 0 1 m s attinger et al 2002 this definition has no impact on y and σy since y ln k ln k 0 with ln k 0 0 and h x is the hydraulic head together with mass conservation q 0 the head equation 3 k h 0 is resulting which is supplemented in the work of dagan 1985 by the head condition 4 h x j x where j is a prescribed constant mean head gradient vector in the present setup the eulerian ensemble mean u x and its lagrangian counterpart u x t x 0 are equal 5 5 from equation 1 we have d x d t u x t x 0 u l t x 0 with the lagrangian velocity u l t x 0 by taking the mean we get u x t x 0 u l t x 0 with the flow field being space stationary and by assuming ergodicity the first mean u x t x 0 lim l 1 l 2 0 l 0 l u x t x 0 t d x 0 since q 0 and n const leading to u 0 particles with initial positions x 0 uniformly distributed in x remain uniform in x t x 0 for t t 0 and thus u x t x 0 lim l 1 l 2 0 l 0 l u x d x u l a similar equality with q x t x 0 instead of u l was recently stated by jankovic et al 2017 end of section 2 3 by assuming σy to be small dagan 1985 has derived by means of first order perturbation expansions with respect to σy the statistics of the flow field u x these statistics reported in dagan 1985 and rubin 1990 were found up to first order to be joint gaussian and were utilized in our previous work meyer 2017 sections 3 and 4 together with a bridging relation between the eulerian and lagrangian reference frames meyer 2017 eq 11 to derive a temporal velocity rw model with statistically independent velocity components u 1 t and u 2 t the model is defined in terms of the linear stochastic differential equations sdes 5 d u 1 8 u 15 l y u 1 u d t 2 u 3 σ y 2 5 l y d w and 6 d u 2 16 u 15 l y u 2 ω 0 2 y d t 2 2 u 3 σ y 2 15 l y d w where d y u 2 t d t ω 0 0 338 16u 15ly u exp y j n is the mean velocity in x 1 direction with j j 0 t and dw is a wiener process with d w 0 and d w 2 d t gardiner 2004 section 3 8 1 6 6 in these sdes the first and second terms on the right hand side are drift and diffusion terms respectively exp y in u corresponds to the geometric mean of k dagan 1989 p 6 which is a first order approximation of exp y valid for small σy the particle dispersion predictions resulting from the rw model were found to be gaussian and are initially in close agreement with the results from perturbation theory deviations appear after a non dimensional time t t 0 u l y 10 with the model under predicting the amount of dispersion in the mean flow parallel x 1 and transverse x 2 directions in line with the theoretical asymptotic behavior derived by attinger et al 2004 the model reproduces constant and zero mean flow parallel and transverse macrodispersion coefficients respectively for t t 0 7 7 schwarze et al 2001 have assessed the impact of pore scale dispersion on asymptotic macrodispersion by means of large scale numerical simulations involving kraichnan flow fields and low order perturbation theory the latter involved higher order transport corrections that were developed based on a renormalization group analysis jaekel and vereecken 1997 3 lagrangian velocity process u x t similar to the earlier mc studies de dreuzy et al 2007 meyer and tchelepi 2010 nowak et al 2008 salandin and fiorotto 1998 trefry et al 2003 we inspect in a next step how as σy increases velocity statistics depart from the statistically independent and joint gaussian behavior derived from first order perturbation theory with σy 0 3 1 monte carlo setup a numerical setup that comes closest to the spatially infinite domain with the constant mean head gradient j considered in the previous section is given by applying periodic boundary conditions for head fluctuations this is unlike to the mc studies cited in the introduction where either head or flux boundary conditions were applied in the mean flow and or the transverse directions leading to boundary layers where the velocity statistics are impacted by the boundary conditions e g salandin and fiorotto 1998 fig 2 more specifically in analogy to expression 4 the hydraulic head is decomposed into a non periodic mean and an l periodic fluctuating part h x as h x j x h x where l is the side length of the quadratic computational domain insertion into the head problem 3 leads to k h j k this equation was discretized with finite volumes using 16 volumes or grid cells per correlation length ly see convergence study meyer and tchelepi 2010 paragraph 26 an algebraic multi grid solver stueben 1983 was applied to compute the periodic head fluctuation h x for the generation of doubly l periodic conductivity fields k x the spectral method outlined by dietrich and newsam 1997 and wood and chan 1994 was applied in order to track particles in the periodic flow fields u x resulting from h x and darcy s law 2 with a constant porosity n the semi analytical method of pollock 1988 was applied to extract lagrangian velocity statistics for a particular σy a quadratic and periodic y x field of side length l 384 l y with a sloping mean head gradient j was applied similar to the setup shown in fig 1 note that the parameters y n and j can be absorbed into the mean flow velocity u u which together with the correlation length ly is applied to normalize flow and transport the slope was chosen large enough such that u x t x 0 or shorter u x t remains uncorrelated in adjacent pathline sections the lagrangian velocity along a pathline was then sampled with a constant time step δt in order to arrive at velocity statistics with negligible statistical or bias errors data was collected from 32 for σ y 1 4 to up to 128 pathlines for σ y 2 displaying infrequent high velocities comparisons of exemplary lagrangian velocity statistics resulting from the present mc setup and our earlier mc study meyer and tchelepi 2010 are provided in fig 2 and close agreement is found 8 8 the mean flow parallel velocity component u 1 t can become negative at large σy which corresponds to reverse flow and which was reported earlier by trefry et al 2003 paragraph 1 here streamlines bypass low conductivity zones by bending backwards for the collection of transport statistics such as x t x 0 or covariances of x t x 0 quantifying the degree of macrodispersion the positions x t of 49 152 particles were tracked in mc simulations from uniformly distributed initial positions x 0 in 384 flow fields 128 particles in each flow field all flow fields were computed as previously outlined and standard estimators for position means and variances were applied e g gelhar 1993 p 23 3 2 departure from joint gaussian velocity pdf the lagrangian joint velocity pdf f u 1 u 2 from perturbation theory was found to be joint gaussian with mean u u 0 t and standard deviations σ u 1 3 8 u σ y and σ u 2 1 8 u σ y dagan 1989 eq 3 7 27 with the correlation coefficient between components u 1 and u 2 being equal to zero for symmetry reasons i e f u 1 u 2 f u 1 u 2 the gaussianity found for σy 0 implies statistical independence or more precisely f u 1 u 2 f u 1 f u 2 this enabled the rw formulation presented in section 2 with two independent stochastic processes for u 1 t and u 2 t in the first column of fig 3 joint pdfs of u 1 x t and u 2 x t are inspected for increasing σy here and from now on the mean velocity u that is used for normalization is not determined based on the analytical expression from perturbation theory given after eq 6 but is directly estimated via 1 m i 0 m 1 u x t 0 i δ t x 0 from the numerical pathline data with a constant time step δt the parametrization of u in terms of j n and the statistics of y x is not part of this work corresponding efforts are documented elsewhere e g cvetkovic et al 1995 eq 11 each panel is comprised of two halves the bottom half represents the joint pdf estimated from the pathline data and the top half correspond to a joint pdf resulting through f u 1 f u 2 from data based estimates of the marginal pdfs f u 1 and f u 2 if both halves agree f u 1 u 2 f u 1 f u 2 and consequently the components are to a good approximation statistically independent we can observe that indeed for the smallest σ y 1 4 represented by the first row in fig 3 u 1 and u 2 are approximately independent however for σ y 1 and 2 the panel halves are increasingly different which documents a breakdown of independence when considering instead of the cartesian velocity components 7 θ arctan u 2 u 1 and v log u u statistical independence is recovered to a good approximation as seen in the second column of fig 3 this observation is in line with our earlier findings meyer et al 2013 paragraph 14 moreover we can observe that both the velocity direction angle θ and the log velocity magnitude v seem to follow gaussian distributions approximately however f v becomes increasingly skewed as σy grows based on the fact that the initial ballistic macrodispersion regime is dominated by the joint velocity pdf f u 1 u 2 meyer et al 2013 eq 10 9 9 tracer particles are initially distributed as f x t 1 t t 0 2 f u x x 0 t t 0 for t t 0 or equivalently f θ v f θ f v we parametrize f v as a function of σy in a next step to this end we apply the skew normal distribution 8 f v 1 2 π σ exp v μ 2 2 σ 2 erfc α v μ 2 σ which reduces for a skewness parameter α 0 to a gaussian distribution with mean μ and standard deviation σ based on particle pathline data for log conductivity fields with σ y 2 1 16 1 8 1 4 1 2 1 2 3 and 4 the following power laws for the distribution parameters were extracted 9 μ 0 34 σ y 2 1 9 σ 0 77 σ y 2 1 8 and α 1 2 σ y 2 5 these fits reflect among other aspects the increasingly tortuous particle pathline geometry observable for example in fig 1 the accuracy of the parametric model for the log velocity distribution f v given by eqs 8 and 9 is assessed in fig 4 for a range of σy values and good agreement is found 4 refined random walk 4 1 reformulation with polar coordinates motivated by the observation that v and θ are statistically independent to a good approximation irrespective of σy see fig 3 b we reformulate the rw model eqs 5 and 6 obtained from perturbation theory for σy 0 meyer 2017 to this end we relate u 1 u 2 with θ v or more precisely u as follows 10 u 1 t u t cos θ t u t and u 2 t u t sin θ t u t θ t u θ t the last equalities in both expressions are first order approximations and sin θ θ which is accurate for θ being small with σy 0 isolating the last approximate equality for θ leads to θ u 2 u and therefore we obtain from sde 6 11 d θ 16 15 θ ω 0 l y u 2 y d t 2 σ y 15 d w with ω 0 l y u 0 338 16 15 0 361 and the non dimensional quantities t t u ly y y ly including the wiener process d w 0 d w 2 d t the ordinary differential equation for y given after sde 6 leads with the second expression in eq 10 to d y u u θ d t e v θ d t this process introduces a weak dependence of θ t on v t which is important to keep in the two dimensional settings considered in this work transverse spreading bounded at late times attinger et al 2004 10 10 in the absence of the non linear factor ev in dy the sdes for θ t and y t form a bi variate ornstein uhlenbeck process whose stationary joint pdf is analytically determined by a zero mean standard deviations σ θ σ y 2 2 3 2 and σ y σ θ ω 0 l y u and a zero covariance risken 1989 section 10 2 with ev included in dy numerical results show that while θ and y remain approximately gaussian and the standard deviations remain close to the stated analytical values at σ y 1 4 they increasingly exceed the analytical values up to 10 and 50 at σ y 2 for θ and y respectively with u u u and the first equation in expression 10 we obtain from sde 5 12 d u 8 15 u 1 d t 2 5 σ y d w given ito s transformation formula gardiner 2004 eq 4 3 14 d y g x a x 1 2 g x b x 2 d t g x b x d w for the generic random processes y t and d x a x d t b x d w related via y g x and where e g g x represents the first derivative of g x we obtain from the mapping v log u and sde 12 d v 8 15 1 u u 1 d t 1 2 1 u 2 2 5 σ y 2 d t 1 u 2 5 σ y d w the second term on the right hand side is negligible for σy 0 and with u 1 the first order approximation of the last term reads 2 5 σ y d w the first term on the right hand side reduces at first order to 8 15 1 u u 1 d t 8 15 1 e v d t 8 15 v d t and eventually we get 13 d v 8 15 v d t 2 5 σ y d w for the log velocity magnitude v log u u this process has a gaussian stationary pdf with standard deviation 3 8 σ y and is very similar to the velocity process 5 for u 1 t the latter is normally distributed with mean u and standard deviation 3 8 u σ y this similarity is because for σy 0 v log u u log u 1 u u 1 u 1 with u 1 u 1 being small moreover the dependence of the standard deviation on σy is similar to the fit for the standard deviation parameter σ reported in expression 9 even though the sde sets 5 6 and 11 13 are equivalent as σy 0 the sdes for v and θ imply for any σy a joint gaussian pdf f v θ and an increasingly skewed velocity distribution as σy 0 in accordance with fig 3 in fig 5 the distribution of the velocity magnitude u resulting from model 13 is compared with pathline data extracted for different σy despite the good agreement deviations grow with σy and transport predictions resulting from sdes 11 and 13 were found to be quantitatively inaccurate for σy 1 and t u ly 20 11 11 for all model computations explicit euler time integration was applied for d x u d t and the velocity and angle sdes accurate statistical estimates e g of the particle position variance were resulting from ensembles with 5 104 particles x t 0 0 0 t and the velocity and angle sdes were initialized from their steady state pdfs e g gaussian for sde 13 for example as seen in fig 6 a and c where time evolutions of particle position variances resulting from the mc simulations and the v θ rw model are shown respectively macrodispersion in mean flow direction is over predicted 12 12 here and from now on we assume that the initial time t 0 0 one possible explanation for this deficiency is the high velocity tail that is more pronounced in the log normal velocity magnitude pdf resulting from sde 13 when compared to the skew normal pdf 8 4 2 accounting for skew normality of log velocity in a final step the log velocity model v t is improved by accounting for the skew normal behavior described and parametrized in section 3 2 to this end we devise a process v t with a functional form of the drift term such that the stationary pdf of the process becomes equal to the skewn normal pdf 8 the stationary pdf of a generic random process d x a x d t b x d w is given by f x c b x 2 exp x 0 x 2 a x b x 2 d x where c is a normalization constant and x 0 is a freely choosable parameter gardiner 2004 section 5 2 2 insertion of pdf 8 on the left hand side and a constant diffusion coefficient b independent of v on the right hand side leads to the drift coefficient 14 a v b 2 2 σ μ v σ 2 π α exp α 2 v μ 2 2 σ 2 erfc α μ v 2 σ to arrive at a drift coefficient a v that is for σy 0 and accordingly α μ 0 consistent with the coefficient 8 15 v derived in the context of perturbation theory sde 13 the diffusion coefficient in expression 14 must satisfy b 4 15 σ this leads with σ from expression 9 to b 0 8 σ y 2 1 8 the resulting convergence of a v to 8 15 v for σy 0 is illustrated in fig 7 4 3 time scale correction applying the aforementioned drift and diffusion coefficients in sde 15 d v a v d t b d w together with angle sde 11 leads to transport predictions that are in good agreement for times t t u l y 5 but at later times under predict the extent of mean flow parallel macrodispersion compare fig 6 a and d the same deficiency was reported in meyer 2017 fig 3 for the u 1 u 2 rw model given by eqs 5 and 6 an ad hoc remedy is to increase the time scale in sde 15 by reducing the diffusion coefficient b to 0 48 σ y 2 1 8 b 2 is inversely proportional to a time scale as a result both the initial ballistic macrodispersion regime and the asymptotic behavior are accurately reproduced by the model as partly seen in fig 6 a and b and as will be documented in greater detail in the next section 5 validation macrodispersion predictions after having outlined a refined velocity rw model based on results from perturbation theory we assess the accuracy of the new model against mc simulation data see section 3 in the following validations the time horizon is based on the observation that the overall aquifer scale is typically of the order of ten correlation length scales ly gelhar 1993 fig 6 6 in a first step we complement the mean flow parallel dispersion results provided in fig 6 by transverse particle position variances presented in fig 8 reasonable agreement is found between the mc reference data given in panel a and the model results in panel b the mean particle positions not shown were found to agree with x t x 0 u 0 t t t 0 resulting from eq 1 next a more detailed model assessment based on particle clouds or more precisely joint and marginal pdfs of the particle displacement x t x 0 is presented in fig 9 the joint pdf for σ y 2 1 16 at an early time t u l y 0 5 is provided documenting that transport is from early on close to joint gaussian for the small level of heterogeneity given a more detailed comparison between the mc reference and the model given in terms of marginal pdfs is shown in fig 10 while the model is initially in agreement with the mc reference they start to deviate at later times the deviation stays however limited an analogous comparison with σ y 1 is provided for the joint pdf at t u l y 0 5 in fig 11 and for the marginal distributions f x 1 t and f x 2 t in fig 12 here the initial joint pdf displays a strong tailing that transitions to a joint gaussian pdf at later times compare fig 12 d the model captures this behavior finally comparisons between the refined rw model and the mc reference are provided for σ y 2 4 in figs 13 and 14 at the elevated level of heterogeneity dispersion stays non gaussian or non fickian for non dimensional times exceeding 32 the model is initially in agreement with the mc reference but at later times deviations appear in the mean flow parallel direction 6 summary and outlook we have presented a lagrangian temporal velocity rw model for macrodispersion or transport uncertainty quantification in heterogeneous subsurface formations the basis of the model was laid out by transforming a cartesian rw to polar coordinates the former was derived analytically based on velocity statistics from first order perturbation theory in an earlier work meyer 2017 our model reformulation was motived by an analysis of velocity statistics stemming from monte carlo simulations in a subsequent step while maintaining the angle process in unchanged form the log velocity magnitude process was modified in order to account for log velocity skewness effects that influence mean flow parallel macrodispersion in the pre asymptotic non gaussian regime the resulting temporal velocity rw model given by eqs 9 11 14 and 15 provides accurate macrodispersion predictions for a range of heterogeneity levels as was confirmed by validations with σ y 2 up to 4 in a future research effort more insight into the shape of the log velocity distribution should be gained by analytical means here an analysis based on the first few moments of the velocity magnitude should suffice to replace the curve fits presently applied with a more rigorous skewness characterization another avenue for future research is the application of the present model in non stationary cases resulting for example from boundary conditions such as wells or conductivity measurements in the latter case encouraging results were obtained with our earlier model in different non stationary settings dünser and meyer 2016 meyer et al 2013 finally perspectives for an extension to three dimensional domains are available from our work in the context of pore scale dispersion meyer and bijeljic 2016 here we have developed a three dimensional velocity rw model that is applicable for media ranging from bead packs sandstones to complex carbonates while the parametrization of a three dimensional rw is expected to be more complicated on the other hand dispersion will become unbounded in transverse direction attinger et al 2004 which is a simplifying aspect of such an extension acknowledgments the author acknowledges funding from eth zürich and is grateful to frédéric saggini and simon dünser who helped with the implementation of the periodic flow solver and implemented the random field generator respectively moreover valuable feedback from six reviewers is gratefully acknowledged 
746,recently we have analytically derived a temporal velocity random walk model for macrodispersion or transport uncertainty quantification based on velocity statistics from classical first order perturbation expansions the applicability of these expansions is limited to mildly heterogeneous formations with log conductivity variances σ y 2 1 in this work we reformulate our model in order to account for velocity skewness and inter component correlation that emerge as key drivers of non fickian dispersion at elevated heterogeneity levels σy eventually we arrive at a light weight parametrization of macrodispersion that is consistent with our earlier formulation but at the same time is applicable for formations with multi gaussian log conductivity characterization of variable heterogeneity i e σy from 0 to 1 and beyond keywords macrodispersion transport uncertainty quantification non fickian transport random walk perturbation expansion langevin equation stochastic diffusion process periodic flow fields 1 introduction macrodispersion is the spreading of fluid or tracer particles resulting from spatial velocity differences gelhar 1993 equation 5 1 10 these differences may arise in an aquifer comprised of horizontal layers gelhar et al 1979 just to give one possible scenario for example in the well documented krauthausen tracer experiment vereecken et al 2000 section 5 1 extracted a vertical conductivity variogram with a clear nugget effect and roughly ten times smaller correlation length compared to its horizontal counterpart which did not have a nugget this behavior is indicative of a horizontal layer structure since the hydraulic conductivity y x is typically a spatially heterogeneous quantity gelhar 1993 fig 1 3 the flow field in the different layers varies vereecken et al 2000 section 6 1 as a result even though particles originate from the same vertical line in the aquifer they will travel with different velocities in the layers which leads to a horizontal spreading or dispersion when focusing on the vertically averaged tracer concentration 1 1 groundwater wells can be viewed as vertical mixers over the different layers similar to a vertical average macrodispersion is typically the dominant spreading mechanism compared to dispersion at the pore scale see dagan and fiori 1997 or caroni and fiorotto 2005 figs 2 5 and 6 with péclet mostly 100 rubin 2003 section 10 5 2 early attempts to model macrodispersion have focused on the advection dispersion equation for the tracer concentration with time or scale dependent dispersivities e g dagan 1987 de dreuzy et al 2007 fernandez garcia et al 2005 salandin and fiorotto 1998 silliman and simpson 1987 these dispersivities were studied experimentally for example by silliman and simpson 1987 or fernandez garcia et al 2005 derived analytically by means of low order perturbation theory e g by dagan 1987 or jaekel and vereecken 1997 and numerically investigated for example by salandin and fiorotto 1998 or de dreuzy et al 2007 through monte carlo mc simulations the numerical simulation studies revealed that deviations in velocity statistics and dispersivities between reference mc and perturbation theory become apparent for log conductivity variances σ y 2 1 deviations were mainly attributed to increasingly non gaussian velocity statistics that are induced by preferential flow paths or channels salandin and fiorotto 1998 trefry et al 2003 spanning over several correlation lengths ly of y more realistic stochastic models based on fluid or tracer particles have been developed since e g berkowitz et al 2006 le borgne et al 2008a 2008b jenny et al 2006 kang et al 2015 meyer 2017 meyer and saggini 2016 meyer and tchelepi 2010 meyer et al 2013 and were partly reviewed by noetinger et al 2016 while berkowitz et al 2006 promoted the versatile continuous time random walk ctrw framework that was for example adapted by le borgne et al 2008a b and kang et al 2015 for the description of diffusive advective transport in heterogeneous porous media and advective transport in fractured media respectively our work has mainly focused on advective transport in two dimensional multi gaussian fields with variable heterogeneity levels multi gaussian fields are widely applied and were recently found in connection with ergodic plumes 2 2 plumes that are large enough such that ensemble and spatial averages are interchangeable are referred to as ergodic plumes and three dimensional formations to lead to similar dispersion behavior as more complex geostatistical models jankovic et al 2017 in our work meyer and tchelepi 2010 meyer et al 2013 we have systematically studied similar to trefry et al 2003 fig 2 and nowak et al 2008 the increasingly complex velocity dynamics which are at the heart of the non fickian transport behavior arising at elevated heterogeneity levels these dynamics result from stagnant fluid motion in low conductivity islands interrupted by intermittent high velocity bursts induced by particle motion in high conductivity channels moreover we have investigated the applicability of temporal velocity random walks rws as surrogate models for these dynamics by systematically evaluating the markov hypothesis for the lagrangian velocity process meyer and saggini 2016 velocity rw models were formulated meyer and tchelepi 2010 meyer et al 2013 that account for the velocity skewness and the complex temporal correlation behavior in the absence of pore scale dispersion the addition of pore scale dispersion which is typically accounted for in lagrangian numerical schemes by brownian motion salamon et al 2006 increases velocity de correlation and promotes randomness which seem to facilitate the formulation of stochastic models the previously outlined lagrangian models are particularly useful in the context of reactive flows as showcased in the extensive work of pope 2011 about flow and transport in turbulence while fluid phase reaction source terms can be incorporated in exact form and the effect of pore scale dispersion on the mean concentration can be reflected by a brownian motion in the particle position equation meyer et al 2010 eqs 10 and 20 mixing models are required to account for species mixing or dilution within fluid particles due to sub darcy or pore scale effects meyer et al 2010 eq 12 suciu et al 2015 current research efforts focus on a better understanding of mixing in heterogeneous porous media e g aquino and bolster 2017 le borgne et al 2013 dentz et al 2011 de dreuzy et al 2012 lester et al 2016 furthermore the previously outlined lagrangian models can be applied in the context of uncertainty quantification of subsurface flow and transport here the different aquifer layers of the initial example translate into several probable scenarios of a shallow two dimensional aquifer with uncertain transmissivity distribution 3 3 the transmissivity results from a vertical average of the conductivity bear 1972 section 5 8 1 fluid particles now travel in different aquifer scenarios or realizations enabling the estimation of e g the concentration mean standard deviation distributions or the concentration probability density function pdf in our contributions dünser and meyer 2016 meyer et al 2013 we demonstrate the applicability of our stochastic models for highly non stationary settings involving different transmissivity measurement configurations from our model computations transport predictions were obtained at a tiny fraction of the computational cost of standard mc meyer et al 2013 section 4 2 3 during the review process we were made aware of the percolation based framework by hunt and coworkers ghanbarian alavijeh et al 2012 hunt and skinner 2008 here similar to preferential flow paths that form at the darcy scale for σy high critical paths establish in strongly disordered pore networks in connection with critical path analysis hunt and coworkers outline a model for dispersion phenomena in partly as well as fully saturated media with fractal pore radius distributions and apply the model in a number of cases hunt and sahimi 2017 certain model parameters are determined for example in the saturated case by fitting the particle arrival time distribution for one medium size and by predicting subsequently arrival times at other sizes hunt and skinner 2008 similarly most of the previously cited rw modeling efforts rely on numerical model calibration le borgne et al 2008a b used numerical velocity transition matrices while curve fits for drift and diffusion functions corresponding to velocity transition moments were applied in our work meyer and tchelepi 2010 meyer et al 2013 more recently we have analytically derived these functions for temporal stochastic diffusion processes of fluid particles in mildly heterogeneous multi gaussian fields meyer 2017 to this end the gaussian lagrangian velocity statistics resulting from first order perturbation theory dagan 1985 rubin 1990 were used as a basis in the present contribution we reformulate the rw model derived from perturbation theory such that it becomes compatible with the non gaussian velocity statistics that emerge at increasing σy the reformulated rw model reduces for σy 0 to its gaussian origin from perturbation theory and is considerably simpler compared to our earlier efforts meyer and tchelepi 2010 meyer et al 2013 it is parametrized in terms of the mean flow velocity the log conductivity or transmissivity correlation length variance and provides accurate transport predictions for mildly as well as highly heterogeneous formations our work is structured as follows in section 2 we summarize the gaussian rw model resulting for σy 0 from first order perturbation theory as outlined in meyer 2017 the velocity statistics presented in section 3 were gathered from mc simulations for σy 0 and enable the quantification and parametrization of deviations from the gaussian perturbation theory statistics in section 4 the rw model from section 2 is reformulated in order to account for the non gaussian velocity statistics parametrized in section 3 the accuracy of the resulting refined rw model is assessed in section 5 and a summary of the present work is provided in section 6 2 random walk from first order perturbation theory in this work we focus on two dimensional space stationary formations with multi gaussian log conductivity or transmissivity distributions y x at position x x 1 x 2 t the ensemble mean log conductivity y and variance σ y 2 are constant and the spatial variability of y x is described by an exponentially decaying autocorrelation function ρ y r exp r l y with correlation length ly and separation vector r x x of points x and x if advection by the flow field u x is the dominant and sole transport mechanism no pore scale dispersion the position of a fluid or tracer particle x t x 0 is given as a function of time t and its initial location x 0 at t t 0 by 1 x t x 0 x 0 t 0 t u x t x 0 d t here the velocity u x q x n with u being its ensemble mean depends through the constant porosity n on the specific discharge q x the latter is given by darcy s law 2 q k h where k x exp y x is the conductivity or transmissivity 4 4 a less common but in terms of physical units better definition of the log conductivity y is k k 0 ey with the unit constant k 0 1 m s attinger et al 2002 this definition has no impact on y and σy since y ln k ln k 0 with ln k 0 0 and h x is the hydraulic head together with mass conservation q 0 the head equation 3 k h 0 is resulting which is supplemented in the work of dagan 1985 by the head condition 4 h x j x where j is a prescribed constant mean head gradient vector in the present setup the eulerian ensemble mean u x and its lagrangian counterpart u x t x 0 are equal 5 5 from equation 1 we have d x d t u x t x 0 u l t x 0 with the lagrangian velocity u l t x 0 by taking the mean we get u x t x 0 u l t x 0 with the flow field being space stationary and by assuming ergodicity the first mean u x t x 0 lim l 1 l 2 0 l 0 l u x t x 0 t d x 0 since q 0 and n const leading to u 0 particles with initial positions x 0 uniformly distributed in x remain uniform in x t x 0 for t t 0 and thus u x t x 0 lim l 1 l 2 0 l 0 l u x d x u l a similar equality with q x t x 0 instead of u l was recently stated by jankovic et al 2017 end of section 2 3 by assuming σy to be small dagan 1985 has derived by means of first order perturbation expansions with respect to σy the statistics of the flow field u x these statistics reported in dagan 1985 and rubin 1990 were found up to first order to be joint gaussian and were utilized in our previous work meyer 2017 sections 3 and 4 together with a bridging relation between the eulerian and lagrangian reference frames meyer 2017 eq 11 to derive a temporal velocity rw model with statistically independent velocity components u 1 t and u 2 t the model is defined in terms of the linear stochastic differential equations sdes 5 d u 1 8 u 15 l y u 1 u d t 2 u 3 σ y 2 5 l y d w and 6 d u 2 16 u 15 l y u 2 ω 0 2 y d t 2 2 u 3 σ y 2 15 l y d w where d y u 2 t d t ω 0 0 338 16u 15ly u exp y j n is the mean velocity in x 1 direction with j j 0 t and dw is a wiener process with d w 0 and d w 2 d t gardiner 2004 section 3 8 1 6 6 in these sdes the first and second terms on the right hand side are drift and diffusion terms respectively exp y in u corresponds to the geometric mean of k dagan 1989 p 6 which is a first order approximation of exp y valid for small σy the particle dispersion predictions resulting from the rw model were found to be gaussian and are initially in close agreement with the results from perturbation theory deviations appear after a non dimensional time t t 0 u l y 10 with the model under predicting the amount of dispersion in the mean flow parallel x 1 and transverse x 2 directions in line with the theoretical asymptotic behavior derived by attinger et al 2004 the model reproduces constant and zero mean flow parallel and transverse macrodispersion coefficients respectively for t t 0 7 7 schwarze et al 2001 have assessed the impact of pore scale dispersion on asymptotic macrodispersion by means of large scale numerical simulations involving kraichnan flow fields and low order perturbation theory the latter involved higher order transport corrections that were developed based on a renormalization group analysis jaekel and vereecken 1997 3 lagrangian velocity process u x t similar to the earlier mc studies de dreuzy et al 2007 meyer and tchelepi 2010 nowak et al 2008 salandin and fiorotto 1998 trefry et al 2003 we inspect in a next step how as σy increases velocity statistics depart from the statistically independent and joint gaussian behavior derived from first order perturbation theory with σy 0 3 1 monte carlo setup a numerical setup that comes closest to the spatially infinite domain with the constant mean head gradient j considered in the previous section is given by applying periodic boundary conditions for head fluctuations this is unlike to the mc studies cited in the introduction where either head or flux boundary conditions were applied in the mean flow and or the transverse directions leading to boundary layers where the velocity statistics are impacted by the boundary conditions e g salandin and fiorotto 1998 fig 2 more specifically in analogy to expression 4 the hydraulic head is decomposed into a non periodic mean and an l periodic fluctuating part h x as h x j x h x where l is the side length of the quadratic computational domain insertion into the head problem 3 leads to k h j k this equation was discretized with finite volumes using 16 volumes or grid cells per correlation length ly see convergence study meyer and tchelepi 2010 paragraph 26 an algebraic multi grid solver stueben 1983 was applied to compute the periodic head fluctuation h x for the generation of doubly l periodic conductivity fields k x the spectral method outlined by dietrich and newsam 1997 and wood and chan 1994 was applied in order to track particles in the periodic flow fields u x resulting from h x and darcy s law 2 with a constant porosity n the semi analytical method of pollock 1988 was applied to extract lagrangian velocity statistics for a particular σy a quadratic and periodic y x field of side length l 384 l y with a sloping mean head gradient j was applied similar to the setup shown in fig 1 note that the parameters y n and j can be absorbed into the mean flow velocity u u which together with the correlation length ly is applied to normalize flow and transport the slope was chosen large enough such that u x t x 0 or shorter u x t remains uncorrelated in adjacent pathline sections the lagrangian velocity along a pathline was then sampled with a constant time step δt in order to arrive at velocity statistics with negligible statistical or bias errors data was collected from 32 for σ y 1 4 to up to 128 pathlines for σ y 2 displaying infrequent high velocities comparisons of exemplary lagrangian velocity statistics resulting from the present mc setup and our earlier mc study meyer and tchelepi 2010 are provided in fig 2 and close agreement is found 8 8 the mean flow parallel velocity component u 1 t can become negative at large σy which corresponds to reverse flow and which was reported earlier by trefry et al 2003 paragraph 1 here streamlines bypass low conductivity zones by bending backwards for the collection of transport statistics such as x t x 0 or covariances of x t x 0 quantifying the degree of macrodispersion the positions x t of 49 152 particles were tracked in mc simulations from uniformly distributed initial positions x 0 in 384 flow fields 128 particles in each flow field all flow fields were computed as previously outlined and standard estimators for position means and variances were applied e g gelhar 1993 p 23 3 2 departure from joint gaussian velocity pdf the lagrangian joint velocity pdf f u 1 u 2 from perturbation theory was found to be joint gaussian with mean u u 0 t and standard deviations σ u 1 3 8 u σ y and σ u 2 1 8 u σ y dagan 1989 eq 3 7 27 with the correlation coefficient between components u 1 and u 2 being equal to zero for symmetry reasons i e f u 1 u 2 f u 1 u 2 the gaussianity found for σy 0 implies statistical independence or more precisely f u 1 u 2 f u 1 f u 2 this enabled the rw formulation presented in section 2 with two independent stochastic processes for u 1 t and u 2 t in the first column of fig 3 joint pdfs of u 1 x t and u 2 x t are inspected for increasing σy here and from now on the mean velocity u that is used for normalization is not determined based on the analytical expression from perturbation theory given after eq 6 but is directly estimated via 1 m i 0 m 1 u x t 0 i δ t x 0 from the numerical pathline data with a constant time step δt the parametrization of u in terms of j n and the statistics of y x is not part of this work corresponding efforts are documented elsewhere e g cvetkovic et al 1995 eq 11 each panel is comprised of two halves the bottom half represents the joint pdf estimated from the pathline data and the top half correspond to a joint pdf resulting through f u 1 f u 2 from data based estimates of the marginal pdfs f u 1 and f u 2 if both halves agree f u 1 u 2 f u 1 f u 2 and consequently the components are to a good approximation statistically independent we can observe that indeed for the smallest σ y 1 4 represented by the first row in fig 3 u 1 and u 2 are approximately independent however for σ y 1 and 2 the panel halves are increasingly different which documents a breakdown of independence when considering instead of the cartesian velocity components 7 θ arctan u 2 u 1 and v log u u statistical independence is recovered to a good approximation as seen in the second column of fig 3 this observation is in line with our earlier findings meyer et al 2013 paragraph 14 moreover we can observe that both the velocity direction angle θ and the log velocity magnitude v seem to follow gaussian distributions approximately however f v becomes increasingly skewed as σy grows based on the fact that the initial ballistic macrodispersion regime is dominated by the joint velocity pdf f u 1 u 2 meyer et al 2013 eq 10 9 9 tracer particles are initially distributed as f x t 1 t t 0 2 f u x x 0 t t 0 for t t 0 or equivalently f θ v f θ f v we parametrize f v as a function of σy in a next step to this end we apply the skew normal distribution 8 f v 1 2 π σ exp v μ 2 2 σ 2 erfc α v μ 2 σ which reduces for a skewness parameter α 0 to a gaussian distribution with mean μ and standard deviation σ based on particle pathline data for log conductivity fields with σ y 2 1 16 1 8 1 4 1 2 1 2 3 and 4 the following power laws for the distribution parameters were extracted 9 μ 0 34 σ y 2 1 9 σ 0 77 σ y 2 1 8 and α 1 2 σ y 2 5 these fits reflect among other aspects the increasingly tortuous particle pathline geometry observable for example in fig 1 the accuracy of the parametric model for the log velocity distribution f v given by eqs 8 and 9 is assessed in fig 4 for a range of σy values and good agreement is found 4 refined random walk 4 1 reformulation with polar coordinates motivated by the observation that v and θ are statistically independent to a good approximation irrespective of σy see fig 3 b we reformulate the rw model eqs 5 and 6 obtained from perturbation theory for σy 0 meyer 2017 to this end we relate u 1 u 2 with θ v or more precisely u as follows 10 u 1 t u t cos θ t u t and u 2 t u t sin θ t u t θ t u θ t the last equalities in both expressions are first order approximations and sin θ θ which is accurate for θ being small with σy 0 isolating the last approximate equality for θ leads to θ u 2 u and therefore we obtain from sde 6 11 d θ 16 15 θ ω 0 l y u 2 y d t 2 σ y 15 d w with ω 0 l y u 0 338 16 15 0 361 and the non dimensional quantities t t u ly y y ly including the wiener process d w 0 d w 2 d t the ordinary differential equation for y given after sde 6 leads with the second expression in eq 10 to d y u u θ d t e v θ d t this process introduces a weak dependence of θ t on v t which is important to keep in the two dimensional settings considered in this work transverse spreading bounded at late times attinger et al 2004 10 10 in the absence of the non linear factor ev in dy the sdes for θ t and y t form a bi variate ornstein uhlenbeck process whose stationary joint pdf is analytically determined by a zero mean standard deviations σ θ σ y 2 2 3 2 and σ y σ θ ω 0 l y u and a zero covariance risken 1989 section 10 2 with ev included in dy numerical results show that while θ and y remain approximately gaussian and the standard deviations remain close to the stated analytical values at σ y 1 4 they increasingly exceed the analytical values up to 10 and 50 at σ y 2 for θ and y respectively with u u u and the first equation in expression 10 we obtain from sde 5 12 d u 8 15 u 1 d t 2 5 σ y d w given ito s transformation formula gardiner 2004 eq 4 3 14 d y g x a x 1 2 g x b x 2 d t g x b x d w for the generic random processes y t and d x a x d t b x d w related via y g x and where e g g x represents the first derivative of g x we obtain from the mapping v log u and sde 12 d v 8 15 1 u u 1 d t 1 2 1 u 2 2 5 σ y 2 d t 1 u 2 5 σ y d w the second term on the right hand side is negligible for σy 0 and with u 1 the first order approximation of the last term reads 2 5 σ y d w the first term on the right hand side reduces at first order to 8 15 1 u u 1 d t 8 15 1 e v d t 8 15 v d t and eventually we get 13 d v 8 15 v d t 2 5 σ y d w for the log velocity magnitude v log u u this process has a gaussian stationary pdf with standard deviation 3 8 σ y and is very similar to the velocity process 5 for u 1 t the latter is normally distributed with mean u and standard deviation 3 8 u σ y this similarity is because for σy 0 v log u u log u 1 u u 1 u 1 with u 1 u 1 being small moreover the dependence of the standard deviation on σy is similar to the fit for the standard deviation parameter σ reported in expression 9 even though the sde sets 5 6 and 11 13 are equivalent as σy 0 the sdes for v and θ imply for any σy a joint gaussian pdf f v θ and an increasingly skewed velocity distribution as σy 0 in accordance with fig 3 in fig 5 the distribution of the velocity magnitude u resulting from model 13 is compared with pathline data extracted for different σy despite the good agreement deviations grow with σy and transport predictions resulting from sdes 11 and 13 were found to be quantitatively inaccurate for σy 1 and t u ly 20 11 11 for all model computations explicit euler time integration was applied for d x u d t and the velocity and angle sdes accurate statistical estimates e g of the particle position variance were resulting from ensembles with 5 104 particles x t 0 0 0 t and the velocity and angle sdes were initialized from their steady state pdfs e g gaussian for sde 13 for example as seen in fig 6 a and c where time evolutions of particle position variances resulting from the mc simulations and the v θ rw model are shown respectively macrodispersion in mean flow direction is over predicted 12 12 here and from now on we assume that the initial time t 0 0 one possible explanation for this deficiency is the high velocity tail that is more pronounced in the log normal velocity magnitude pdf resulting from sde 13 when compared to the skew normal pdf 8 4 2 accounting for skew normality of log velocity in a final step the log velocity model v t is improved by accounting for the skew normal behavior described and parametrized in section 3 2 to this end we devise a process v t with a functional form of the drift term such that the stationary pdf of the process becomes equal to the skewn normal pdf 8 the stationary pdf of a generic random process d x a x d t b x d w is given by f x c b x 2 exp x 0 x 2 a x b x 2 d x where c is a normalization constant and x 0 is a freely choosable parameter gardiner 2004 section 5 2 2 insertion of pdf 8 on the left hand side and a constant diffusion coefficient b independent of v on the right hand side leads to the drift coefficient 14 a v b 2 2 σ μ v σ 2 π α exp α 2 v μ 2 2 σ 2 erfc α μ v 2 σ to arrive at a drift coefficient a v that is for σy 0 and accordingly α μ 0 consistent with the coefficient 8 15 v derived in the context of perturbation theory sde 13 the diffusion coefficient in expression 14 must satisfy b 4 15 σ this leads with σ from expression 9 to b 0 8 σ y 2 1 8 the resulting convergence of a v to 8 15 v for σy 0 is illustrated in fig 7 4 3 time scale correction applying the aforementioned drift and diffusion coefficients in sde 15 d v a v d t b d w together with angle sde 11 leads to transport predictions that are in good agreement for times t t u l y 5 but at later times under predict the extent of mean flow parallel macrodispersion compare fig 6 a and d the same deficiency was reported in meyer 2017 fig 3 for the u 1 u 2 rw model given by eqs 5 and 6 an ad hoc remedy is to increase the time scale in sde 15 by reducing the diffusion coefficient b to 0 48 σ y 2 1 8 b 2 is inversely proportional to a time scale as a result both the initial ballistic macrodispersion regime and the asymptotic behavior are accurately reproduced by the model as partly seen in fig 6 a and b and as will be documented in greater detail in the next section 5 validation macrodispersion predictions after having outlined a refined velocity rw model based on results from perturbation theory we assess the accuracy of the new model against mc simulation data see section 3 in the following validations the time horizon is based on the observation that the overall aquifer scale is typically of the order of ten correlation length scales ly gelhar 1993 fig 6 6 in a first step we complement the mean flow parallel dispersion results provided in fig 6 by transverse particle position variances presented in fig 8 reasonable agreement is found between the mc reference data given in panel a and the model results in panel b the mean particle positions not shown were found to agree with x t x 0 u 0 t t t 0 resulting from eq 1 next a more detailed model assessment based on particle clouds or more precisely joint and marginal pdfs of the particle displacement x t x 0 is presented in fig 9 the joint pdf for σ y 2 1 16 at an early time t u l y 0 5 is provided documenting that transport is from early on close to joint gaussian for the small level of heterogeneity given a more detailed comparison between the mc reference and the model given in terms of marginal pdfs is shown in fig 10 while the model is initially in agreement with the mc reference they start to deviate at later times the deviation stays however limited an analogous comparison with σ y 1 is provided for the joint pdf at t u l y 0 5 in fig 11 and for the marginal distributions f x 1 t and f x 2 t in fig 12 here the initial joint pdf displays a strong tailing that transitions to a joint gaussian pdf at later times compare fig 12 d the model captures this behavior finally comparisons between the refined rw model and the mc reference are provided for σ y 2 4 in figs 13 and 14 at the elevated level of heterogeneity dispersion stays non gaussian or non fickian for non dimensional times exceeding 32 the model is initially in agreement with the mc reference but at later times deviations appear in the mean flow parallel direction 6 summary and outlook we have presented a lagrangian temporal velocity rw model for macrodispersion or transport uncertainty quantification in heterogeneous subsurface formations the basis of the model was laid out by transforming a cartesian rw to polar coordinates the former was derived analytically based on velocity statistics from first order perturbation theory in an earlier work meyer 2017 our model reformulation was motived by an analysis of velocity statistics stemming from monte carlo simulations in a subsequent step while maintaining the angle process in unchanged form the log velocity magnitude process was modified in order to account for log velocity skewness effects that influence mean flow parallel macrodispersion in the pre asymptotic non gaussian regime the resulting temporal velocity rw model given by eqs 9 11 14 and 15 provides accurate macrodispersion predictions for a range of heterogeneity levels as was confirmed by validations with σ y 2 up to 4 in a future research effort more insight into the shape of the log velocity distribution should be gained by analytical means here an analysis based on the first few moments of the velocity magnitude should suffice to replace the curve fits presently applied with a more rigorous skewness characterization another avenue for future research is the application of the present model in non stationary cases resulting for example from boundary conditions such as wells or conductivity measurements in the latter case encouraging results were obtained with our earlier model in different non stationary settings dünser and meyer 2016 meyer et al 2013 finally perspectives for an extension to three dimensional domains are available from our work in the context of pore scale dispersion meyer and bijeljic 2016 here we have developed a three dimensional velocity rw model that is applicable for media ranging from bead packs sandstones to complex carbonates while the parametrization of a three dimensional rw is expected to be more complicated on the other hand dispersion will become unbounded in transverse direction attinger et al 2004 which is a simplifying aspect of such an extension acknowledgments the author acknowledges funding from eth zürich and is grateful to frédéric saggini and simon dünser who helped with the implementation of the periodic flow solver and implemented the random field generator respectively moreover valuable feedback from six reviewers is gratefully acknowledged 
747,this work presents an efficient and accurate algorithm for multicomponent compressible single phase flow in fractured media the model covers 2d 2 5d and 3d unstructured gridding and accounts for heterogeneity and anisotropy the fracture cross flow equilibrium approach fcfe is applied in triangular finite elements fe in 2d and prism and tetrahedra fe in 2 5d and 3d respectively one can then simulate flow in fractured media with fractures in different orientations unstructured gridding with fcfe allows simulating realistic fractured porous media efficiently in addition fcfe in unstructured gridding alleviates the limitation of the number of intersecting fractures in rectangular and hexahedron fe the number is limited to 2 in 2d and 3 in 3d to generate domains with complicated boundaries we have developed a computer aided design cad interface we demonstrate the efficiency and accuracy of our model by several numerical examples our examples include comparison with analytical solution and convergence rate keywords compressible flow fractured media mixed finite element discontinuous galerkin cross flow equilibrium discrete fractures impec method unstructured mesh anisotropy heterogeneous media 1 introduction modelling of compressible flow is of high interest in geochemical and petroleum subsurface formations a challenge in subsurface simulation relates to flow in the fractures fractured porous media impose large range in spatial scales permeabilities and fluxes and generally have complex geometries using structured grids may not accurately describe the complexity commercial simulators may not converge in the near well region because structured grids are not well suited to model radial flow near wells fung et al 2013 numerous approximations are used for flow modelling in fractured media these approximations are applied in single phase flow sandve et al 2012 ahmed et al 2015 hoteit and firoozabadi 2005 and multi phase flow bastian et al 2000 granet et al 1998 bogdanov et al 2003 geiger et al 2004 2009 abushaikhaa et al 2015 chen et al 2015 nick and matthäi 2011 matthäi et al 2007a b unsal et al 2010 the approximations are divided into two broad categories the dual continuum model and the discrete fracture matrix model the low computational cost of the dual continuum models makes them attractive in modeling fracture networks warren and root 1963 gilman and kazemi 1983 the dual porosity model has been extended to multi rate transfer function di donato et al 2004 geiger et al 2013 the discrete fracture matrix dfm model is known for high accuracy and flexibility in fracture representation karimi fard et al 2004 kim and deo 2000 reichenberger et al 2006 makedonska et al 2015 hyman et al 2015 hoteit and firoozabadi 2008 zidane and firoozabadi 2014 2017 the dfm approach geometrically matches the fracture and matrix grid cells when a lower dimension fractures representation is used the fracture elements in dfm coincide with the matrix element interfaces in addition to the classical dfm li and lee 2008 proposed the embedded discrete fracture model edfm it was later adopted by moinfar et al 2014 the edfm is considered as a non conforming dfm model as a result in edfm one could have more than four intersecting fractures even when applied on structured grids the edfm is known to have limitations to model low permeability fractures tene et al 2017 presented the projection based edfm pedfm to overcome the limitations of the edfm in this work we have selected the dfm for its attractive features in large scale and sparse fracture systems we assume that the fracture aperture is small compared to the matrix scale noorishad and mehran 1982 granet et al 1998 martin et al 2005 therefore the fractures are represented by n 1 dimensional elements in an n dimensional domain the ease of implementation makes the finite difference fd and the finite volume fv approaches the most commonly used numerical methods in structured and unstructured grids respectively the fd and fv approaches are usually accompanied with a two point flux approximation tpfa to calculate the field fluxes the fv method aavatsmark et al 1998 edwards 2002 edwards and zheng 2010 lamine and edwards 2010 2013 is more convenient to model oblique fractures karimi fard et al 2004 schmid et al 2013 however the coupling between the lowest order methods and tpfa produces excessive numerical dispersion and suffers from grid sensitivity to overcome the limitations of tpfa the multipoint flux approximation mpfa has been introduced aavatsmark 2002 kozdon et al 2011 huggenberger et al 2015 bastista et al 2013 nordbotten et al 2007 aavatsmark et al 2008 younes et al 2013 younes et al 2015 aavatsmark et al 2010 matringe et al 2009 salama et al 2013 wheeler and yotov 2006 wheeler et al 2011 2012 the fluxes in mpfa are constructed from pressures in the surrounding elements making mpfa attractive in unstructured grids however mpfa may produce unphysical oscillations in the pressure field nordbotten et al 2007 aavatsmark et al 2008 younes et al 2014 the use of finite element fe method in unstructured gridding has gained popularity since 1970 s in many disciplines in science and engineering nejati et al 2015 moortgat and firoozabadi 2016 in this work we adopt the combination of the mixed finite element mfe method and the discontinuous galerkin dg method the mfe in its hybridized form provides pressure at the cell center and the traces of pressure at the cell interfaces this ensures high accuracy in flux calculation in fractured reservoirs the mass conservative dg method is used to discretize the mass transport equation dg is particularly attractive in fractured reservoir simulation because the approximation does not have to be continuous between elements by using dg in highly heterogeneous fractured media one can capture the discontinuity of concentration between the low permeable matrix and the high permeable fracture network the cross flow equilibrium cfe concept in the discrete fracture approach was introduced to model multicomponent compressible flow in fractured porous media hoteit and firoozabadi 2005 in cfe the pressure concentration in a fracture element is assumed to be equal to the pressure concentration in the surrounding matrix elements this assumption requires the matrix grids next to fractures to be small the small grid cells may impose restriction on the size of time step due to the courant freidricks levy cfl condition in explicit schemes later hoteit and firoozabadi 2008 advanced the efficiency of flow calculations in fractured media by the fracture cross flow equilibrium fcfe approach in incompressible flow in 2014 zidane and firoozabadi 2014 have used the fcfe to model multicomponent compressible flow in fractured porous media in compositional extension it is assumed that both pressure and concentration are constant across the fracture width compared to cfe concept the fcfe approach alleviates the need for small elements in the matrix grid cells in our previous application the method was limited to structured grid cells in this work we apply for the first time the fcfe approach in compressible flow in 2d 2 5d and in 3d for all commonly used finite elements fe discretization of the pressure equation in compressible multicomponent flow is more complicated than the incompressible flow as we will show in the discretization section our model applies to quadrangular and triangular elements in 2d and to hexahedra prism and tetrahedra elements in 3d in addition we have developed for the first time a computer aided design cad interface coupled with our mesh generator this allows the user to generate very complicated fractured domains in an efficient way unstructured grids offer several advantages over structured grids in reservoir simulation the advantages include the ease to simulate fractured reservoirs in which fractures have different orientations a triangular finite element could be oriented in different directions such that one or more of its edges is are aligned with the fractures one of the challenges is to generate unstructured triangular grids that some elements are aligned to the orientation of the different fractures we highlight the two dominant methods in unstructured triangular grid generation and justify our choice for one of the two in one the advancing front method the cells that make up the interior of the mesh are modeled by marching away from the boundaries of the domain anderson 1994 the other method is the delaunay triangulation the delaunay technique triangulates a set of points in such a way that no extremely skewed cells are generated in the delaunay triangulation one can have the points on the desired edges to be part of the field points generated a priori when using the fcfe model the details of the delaunay triangulation are presented in anderson 1994 in 2 5d one uses prism type fe extruded from 2d triangular elements as we will explain later prism fe provides a more realistic representation of the fractures compared to hexahedron fe in dfm in 3d we use fully unstructured tetrahedron grids similarly to 2d in 2 5d and 3d the fractures are also represented by the interfaces of the fe we provide a description of the proposed model in generating unstructured 2d and 3d grids in the next section then we present the differential equations that describe multicomponent compressible flow in fractured media and a brief overview on the discretization of the pressure and the species mass balance equations in the rock matrix and the fracture network we provide several examples to highlight the features of the model and conclude with few remarks 2 model description for completeness we briefly present the main features of our model which combines different spatial and temporal discretization schemes in the matrix and in the fracture network to advance efficiency and accuracy the basis and test functions in the numerical discretization for different types of fes are presented in appendix a the essences of the model are the hybridized mixed finite element method mfe is used to calculate the fluxes in the matrix domain and the fracture network durlofsky 1994 mosé et al 1994 darlow et al 1984 hoteit and firoozabdi 2008 younes et al 2011 zidane et al 2012 zidane et al 2014a zidane et al 2014b zidane and firoozabadi 2014 zidane and firoozabdi 2015 the mfe formulation can readily accommodate full permeability tensors the discontinuous galerkin dg method is used to solve the mass balance equations in the matrix a slope limiter is used to remove the nonphysical oscillations cockburn and shu 1989 1998 younes et al 2014 2015 chavent and jaffré 1986 hoteit et al 2004 siegel et al 1997 a finite volume approach is used to discretize the species mass balance equations in the fractures the traces of the pressure in the matrix and the fracture network are implicitly updated at each time step the molar densities in the fracture network are implicitly updated at each time step the molar densities in the matrix domain are explicitly updated at each time step the implicit pressure explicit concentration impec approach in the matrix domain is found to be stable and efficient in single phase flow and also in multiphase compositional flow as demonstrated in moortgat and firoozabadi 2016 and zidane and firoozabdi 2017 however an impec approach is not efficient when used in the fractures this is due to the small size of the fracture elements that impose a severe restriction on the size of time step therefore we adopt an implicit time scheme in the fracture network the larger size of the matrix elements justifies the use of an explicit discretization in the matrix domain instead of a fully implicit scheme unstructured triangular elements are used in 2d and prism and tetrahedron elements are used in 3d 3 unstructured 2d 2 5d and 3d grid generation triangular elements allow simulating oblique fractures fig 1a without imposing approximations on the matrix elements reiter et al 2012 in fcfe the set of points that define the domain and the locations of the fractures should be provided a priori fig 1a b the grids are then generated by starting from the domain and the fracture input data points fig 1c in rectangular domains and a small number of fractures fig 1b the set of points could be manually generated however this technique is not efficient when the domain boundaries are complex and the number of fractures is high to overcome this deficiency we have developed an interface to read data points from a cad computer aided design output cad software is usually used to create two and three dimensional graphical representations of physical objects using a cad interface makes it possible to generate very complex boundaries as will be shown in the examples rapidly in addition the cad software allows reading pre existing maps domains that have dwg dws dwt and dxf extensions and edit them by adding removing boundary and or fracture points unstructured prism fe is used in 2 5d the prisms are constructed from triangular 2d surfaces fig 1d the 2d triangles are then extruded to as many layers as required fig 1e and extrude the edges of the triangles to 2d planes in space the technique can generate several layers of a reservoir and assign different properties to each layer as will be demonstrated later in the examples the edge defining the fracture in 2d by two nodes e g n 2 n 3 fig 1e the extruded nodes of this edge n 5 n 6 fig 1f are defined as fracture nodes in 3d the pre existing nodes and the extruded nodes define a fracture element in 3d fig 1f tetrahedra are used in full 3d discretization and they are generated by dividing a hexahedra fe into 6 tetrahedra and by using tetgen see fig 1g si 2011 4 mathematical model 4 1 governing equations in the matrix the rock matrix and the discrete fractures in our model have different geometrical dimensions in the simulation domain n d for the matrix domain and n 1 d for the fracture network the governing equations are therefore treated separately the superscript m denotes the matrix the superscript f denotes the fractures the mass balance of component i in miscible and compressible flow is given by the following equation 1 m c i m t c i m v m f i m 0 i 1 n c in ω 0 τ in the above equation denotes the porosity v the velocity field ci czi the molar density of component i where c is the overall molar density zi and fi are the mole fraction and the sink source term of component i in the mixture respectively ω is the computational domain and τ denotes the simulation time and nc is the number of components the flow in porous media is described by darcy s law 2 v k μ p ρ g where k is the absolute permeability tensor μ the dynamic viscosity p the pressure ρ the mass density and g the gravitational acceleration the peng robinson equation of state eos peng and robinson 1976 is used to describe the molar density c as a function of the composition temperature and pressure as follows c p z r t 3 z 3 1 b z 2 a 3 b 2 2 b z a b b 2 b 3 0 z is the compressibility factor r the gas constant t the temperature and mi the molar mass of component i to complete the system of equations we use the volume balance approach from acs et al 1985 and watts 1986 to compute the pressure field in compressible flow the expression for the volume balance is given by 4 m c t m p m t i 1 n c v i m c i m v m f i m 0 where ct is the total compressibility v i is the total partial molar volume of component i in the mixture firoozabadi 2015 4 2 governing equations in the fractures the mass balance equations in the fractures integrated along the fracture width ε in n 1 d are expressed by 5 f c i f t c i f v f q i f f i f 0 i 1 n c the term q i f is the mass flux of component i across the matrix fracture boundaries in the mixture similarly to the matrix domain the pressure field in the fractures is obtained from 6 f c t f p f t i 1 n c v i f c i f v f q i f f i f 0 5 numerical discretization 5 1 discretization of the flow equation the hybridized mixed finite element mfe method with the lowest order raviart thomas rt basis space is used to discretize the volumetric flow in the matrix and the fractures the global system of equations for the pressure is obtained by writing the continuity of fluxes and pressures at all the interfaces of the matrix elements and the fractures elements the number of unknowns equals the number of interfaces in the matrix domain tp m p f plus the number of interfaces in the fracture network tp f 7 a m m a m f 0 a m f a f f r f 0 r t f m f tp m p f tp f v m v f 0 derivation of eq 7 and the definition of all elements are given in appendix a 5 2 discretization of the transport equations the dg method is used to discretize the species transport equations in the matrix with an explicit time scheme multiplying the first expression in eq 1 by the shape function φ k l and integrating over each matrix element k we get 8 i 1 n j d c i k j m d t k k m φ k l φ k j k φ k l f i m j 1 n j e 1 n e q k e c i k j m k φ k j w k e φ k l c i k e j m e e φ k l φ k j in the above equation for a matrix element k c i k j m is the molar density of component i at node j nj is the number of nodes c i k e j m is the upstream molar density of component i at node j of interface e q k e is the volume flux across the interface e and ne is the total number of interfaces in matrix element k the system of ordinary differential equations of order nj per element is obtained by writing eq 8 over each element k in the matrix domain coupled with a slope limiter stabilization to remove the nonphysical oscillations as opposed to the matrix elements the mass balance equation in the small fracture elements is discretized with an implicit time scheme to overcome the cfl restriction to avoid the expensive dg approximation in the fractures a finite volume method is applied in the fractures as follows 9 k f c i k f n 1 c i k f n δ t e 1 n e c i e f n q k e f n q i f k 1 q i f k 2 f i k f n where c i e f n denotes the upstream value of the molar density the term q i f k j j 1 2 represents the matrix fracture exchange flux the discretization in the fractures and coupling the fracture network with the matrix domain are presented in appendix b the above equation is written for all the fracture elements and the system of equations are linearized and solved using the newton raphson nr method 5 3 upstream technique for multiple intersecting fractures in structured grids the maximum number of intersecting fracture elements at one interface is four in unstructured grids the maximum number of intersecting fracture elements may be higher in principle it depends on the mesh quality and the order of refinement near the fractures in two intersecting fractures the upstream value is deduced from the flux direction when nt fractures intersect at point o and nu is the number of fractures with fluxes in the upstream direction fig 2 the upstream value at the intersection is given as follows zidane and firoozabadi 2014 10 c i o f j 1 n u c i k j f q k j f j 1 n u q k j f 6 numerical examples we present in the following seven examples with different number of fractures and different geometries in addition to the examples we present in appendix c a pinch out problem and a domain with oblique fracture in 3d in appendix d the implementation of a barrier in fcfe is demonstrated in appendix e and one example with anisotropy is studied in appendix f an intel core i5 pc 3 ghz cpu 4 gbram is used in all the runs cpu time is for 1 pore volume injection pvi unless specified otherwise 6 1 example 1 single fracture in this example we consider the single fracture problem from ahmed et al 2015 the domain is 1 m 1 m with one oblique fracture fig 3 a the fracture thickness is 1 mm with 104 md permeability the permeability of the matrix is 1 md the injector is located at one corner and production at constant pressure is at the opposite corner the injection rate is 0 3171 pv year a neumann boundary condition with zero flux is imposed on the domain boundary we compare the results of our model to the control volume distributed multipoint flux approximation model with lower dimensional fractures or cvd mpfa l ahmed et al 2015 and the hybrid sandve et al 2012 cvd mpfa h and to the equidimensional model where fractures are represented by the same dimension as the matrix elements note that eq 4 should be reduced to incompressible single phase flow to make the problem the same as in ahmed et al 2015 the tracer concentration at the production well is recorded throughout the simulation and compared to the results of the three different models as shown in fig 4 an excellent agreement is observed between our model fcfe and cvd mpfa l and cvd mpfa h and the equidimensional model in fig 3b we show the tracer concentration at 1 2 pvi the contour profile is similar to the one by ahmed et al 2015 in the tracer incompressible flow 6 2 example 2 intersecting fractures we compare our model to the vertex approximate gradient vag finite volume scheme and the results to an example presented in xing et al 2016 the importance of this example is the analytical solution provided by the authors xing et al 2016 comparing our numerical results to an exact solution demonstrates the accuracy of the model the domain of unit surface area contains four intersecting fractures that we denote by f1 f2 f3 and f4 fig 5 the fracture to matrix permeability ratio is 200 for f1 and f2 and 400 for f3 and f4 the fracture aperture is 0 01 for all fractures porosity is set to one in the whole domain in fig 6 we show the convergence of the relative l 1 and l 2 errors between the analytical solution and the numerical solution of our model and the model of xing et al 2016 at different mesh refinements in the matrix and the fractures as shown in fig 6 the error in our model is less than the vag model in both the matrix and the fractures even with lower mesh refinement in our model the error difference between our model and vag is more significant in the matrix domain than the fractures this is because of the accuracy of our higher order dg results in the matrix 6 3 example 3 cpu time in this example we consider a network of intersecting fractures as shown in fig 7 the properties of the domain are given in table 1 locations of injection and production wells are the same as in example 1 the overall mole fraction of methane is shown in fig 8 at different pvis the total number of matrix elements is 1400 the fracture network includes 80 n 1 d elements higher number of fracture elements implies a larger matrix to be inverted during the nr iterations see eq 9 to evaluate the effect of the number of fracture elements on the cpu time we randomly remove 10 fracture elements from the fracture network the order and or location of the randomly removed fractures does not affect the cpu cost as a result the new domain has 70 n 1 d fracture elements this procedure is repeated 8 times by reducing the number of fracture elements 10 at a time see fig 9 a to g in the 8th reduction the problem reduces to unfractured media fig 9h we show in table 2 the cpu time at 100 pvi for different cases with different number of fractures from 0 unfractured media to 80 fracture elements shown in fig 7 in fig 10 we show the overall mole fraction of methane at 70 pvi at different fracture reductions the small increase in the cpu time from 1 54 min for unfractured media to 2 42 min 80 fracture elements demonstrates the efficiency of our model 6 4 example 4 1 km long domain in this example we consider a 1000 m 300 m domain fig 11 with a set of randomly distributed fractures with lengths from 220 m to 350 m we run this example in five different mesh refinements fig 11 going from a very coarse mesh of 75 elements to 1600 elements the properties of the domain are the same as in example 3 except a 1 mm fracture thickness is used injection well is located at one corner with a constant rate of 1 pv year and production is performed at constant pressure at the opposite corner in figs 12 and 13 we show the overall mole fraction of methane at 10 and 60 pvi with all meshes results show that even with the coarse mesh of 600 elements the model produces comparable results to the relatively fine mesh of 1600 elements at low and high pvi the high accuracy of our model is partly due to the higher order nodal discontinuous galerkin method in nodal dg one node connects more information with the surrounding elements compared to the lower order fv method in the latter one grid cell shares the same average value with the surrounding three elements at the edges of the triangular finite element for a more qualitative study of the mesh refinement we compare the overall mole fraction of methane at the production well in all meshes fig 14 a good agreement is observed starting from a 300 elements compared to the 1600 mesh the cpu time is 4 min for 1600 refined mesh we run a simulation with 3200 elements for this problem not shown and results are in agreement with the results of 1600 element mesh 6 5 example 5 non regular boundaries in the previous examples we considered rectangular domains although the discretization is based on unstructured grids in such cases where there is no complexity in geometry the use of our cad interface is not needed when the geometry becomes more complex the use of our cad interface becomes essential for efficient mesh generation in this example we consider a complicated domain boundaries as shown in fig 15 a the domain is generated using the cad interface that was discussed above the domain includes a set of randomly distributed fractures with different lengths varying from 140 to 460 m co2 is injected at one corner to displace propane to the opposite corner of the domain the locations of the injection and production wells are shown in fig 15a the relevant data of the domain is shown in table 3 two different mesh refinements are used a coarse mesh of 600 elements and a fine mesh of 2600 elements fig 15b c the overall mole fraction of co2 at 10 and 50 pvi is shown in figs 16 and 17 respectively for both meshes there is good agreement as shown in fig 15 the largest elements in the computational domain are located near the fracture network this advantage of the fcfe approach results in i lower total number of elements and ii avoiding the excessive cfl condition in and near the fractures away from the fracture network the size of the elements reduces as a result of the complex boundaries and not as a requirement by the model in a domain with complex boundaries the small areas are discretized with smaller finite elements in this example these areas are located between 450 and 750 m shown by dashed circles in fig 15c having a coarser mesh in these areas is possible but will result in losing details of the meanders at the boundaries the cpu time for the refined mesh is 8 min 6 6 example 6 2 5d vertical extrusion of the 2d complex domain the cad interface in our mesh generator help with the generation of complicated 3d domains in this example the domain of the previous example is extruded in the z direction with a thickness of 100 m fig 18 a the properties of the domain in this example are the same as in example 5 locations of the injection and production wells are shown in fig 18a the mesh is based on the refined mesh of example 5 2600 elements see fig 15c the 2d mesh is then extruded into 3 layers 2 layers of 25 m thickness and a third layer at the top of 50 m thickness the fractures that are represented by lines in 2d are now represented by planes in 3d the mesh of the domain with the fractures is shown in fig 18b extruding a triangular finite element into a 3d space creates a prism fe the prism fe offers the same flexibility as the triangular fe offers in 2d the prism could be rotated in a way that one or more of the interfaces is are aligned with the desired locations of the fractures in figs 19 and 20 we show the overall mole fraction of co2 in the matrix figs 19a 20a and in the fracture network figs 19b 20b at 10 and 50 pvi respectively the cpu time to 1 pvi in this example is 45 min 6 7 example 7 fractured sandwich reservoir in the last example we consider a multilayered fractured reservoir with 1 km long 0 3 km width and 0 3 km height fig 21 a to d as shown in fig 21 the fractures have different orientations along the x and y axes the reservoir consists of four overlapped layers two layers have a permeability of 0 1 md and a porosity of 10 and two layers with 10 md and a porosity of 20 the layers are arranged as shown in fig 21 e the mesh and the location of the fractures are shown in fig 21 f the properties of the domain are given in table 4 the total number of elements in the matrix domain and the fracture network are 6000 and 600 respectively the composition of the initial oil is shown in table 5 co2 is uniformly injected at one vertical side and production is performed uniformly at the opposite vertical side of the domain for reference we show the overall mole fraction of the injected co2 at 15 25 and 80 pvi in both the matrix domain and the fracture network fig 22 the high value of mole fraction of the injected fluid at the top and the low value at the bottom even at 80 pvi are due to two factors i the difference in matrix permeability between top and bottom and ii the effect of the boundary meanders on flow the cpu time in this example is about 28 min 7 summary and conclusions we have incorporated the fcfe concept in 2d 2 5d and 3d unstructured grids to simulate multicomponent compressible flow in fractured media our grid generator is coupled with a cad interface based on the results from the examples in the text and in the appendices we draw the following conclusions one can readily adapt the mfe formulation to simulate anisotropic and heterogeneous media the mixed finite element mfe formulation can be readily adapted to account for full permeability tensors to simulate anisotropic and heterogeneous media we demonstrate that the incorporation of the fcfe concept with higher order dg alleviates the need for mesh refinement in complicated domains in unstructured gridding the prism and tetrahedra fe with fcfe in 3d allow simulation of realistic fractured domains the extrusion of prism fe from 2d triangular elements makes the fracture entities in 3d to be represented by planes as a result one could have the fractures oriented with different angles along the three axes and removes the limitation on the number of intersecting fractures as opposed to hexahedron fe accuracy of the algorithm is demonstrated by convergence of coarser mesh to the results of a more refined mesh even in complicated geometries the use of a cad interface is found to be a very efficient way to generate complex geometries in 2d and 3d unstructured tetrahedron fe allows simulation of domains that include sharp boundaries in physical properties as in the case of pinch out problems application of our cad interface to fractures in fully unstructured gridding is limited in this work to planar fracture shapes when the fracture shapes are more complex coupling with cad is challenging this will be investigated in the future the work covers single phase flow in 2d and in 3d a full extension to multiphase compositional flow adds more complexity to the formulation and the computational time on unstructured 3d gridding the surface tension in compositional multiphase flow is low which reduces the effect of capillary pressure however more complexity arises when calculating the matrix fracture and fracture fracture exchange flux in different phases since phase fluxes could be in different directions from matrix to fractures and vice versa as opposed to single phase flow in multiphase compositional flow the implicit solution of the transport equation in the fractures requires the calculation of derivatives of the molar density of each component in each phase with respect to the total molar density of each component when applied in unstructured grid in 2d and or 3d these derivatives should be calculated for all intersected fractures in single phase flow this derivative is always one full coupling of the cad to unstructured tetrahedron fe and adding multiphase compositional flow to unstructured 2d and 3d grids is in progress for future publication acknowledgement this work was supported by the member companies of the reservoir engineering research institute reri whose support is gratefully acknowledged appendix a discretization of the pressure equation in this appendix we show how to obtain the global system of equations to solve for the pressure the continuity of the fluxes and the pressure at the interfaces in the matrix domain leads to 11 r t m m r t m f p m m m m m f m m m f m f f tp m p f 0 q f and in the fracture network 12 r t f p f m f tp f 0 integration of the pressure equation eq 6 in the text in the matrix gives 13 d m p m r m m r m f tp m p f f m and in the fractures 14 d f p f r f tp f f f q f combining the above equations and using the gaussian elimination to reduce the size of the global system we get 15 a m m a m f 0 a m f a f f r f 0 r t f m f tp m p f tp f v m v f 0 the elements of the matrices in the above equations are given in table a1 the coefficient w k e in table a1 are the raviart thomas basis functions and k is the permeability tensor see zidane and firoozabadi 2014 in table a1 e represents the edge where the parameters α k e β k e e are evaluated and e represents the adjacent edges of e in the element k appendix b matrix and fractures discretization variables and exchange fluxes we adopt a lower dimensional representation of the fractures compared to the matrix dimension this is justified because of small fracture aperture compared to the matrix domain each fracture element exchanges fluxes with two matrix elements the two fluxes q i f k 1 q i f k 2 belong to the interfaces of the matrix grid cells if the fracture element is at the boundary of the domain the interaction in this case is limited to one matrix element therefore three different scenarios could be observed regarding the matrix fracture flux the first case is when the two matrix elements are feeding the fracture element represented by fracture f 1 in fig b1 the second case is when the fracture is feeding the adjacent two matrix elements represented by fracture f 2 in fig b1 the last case when one matrix element is feeding the fracture and the latter is feeding the adjacent matrix element fracture f 3 in fig b1 the effect of the three scenarios in the numerical discretization follows in the first case fracture f 1 both fluxes q i f k 1 q i f k 2 are treated explicitly in the temporal scheme in the second case fracture f 2 both fluxes q i f k 3 q i f k 4 are treated implicitly in the last case one flux is treated implicitly q i f k 4 and one flux is treated explicitly q i f k 5 in the implicit treatment the flux is added to the updated netwon raphson nr iteration and in the explicit treatment the flux is added to the residual function in the nr iteration the flow and transport variables are represented by different symbols in fig b1 appendix c pinch out problem subsurface formations are generally complex structured grid cells and or grids that are based on the concept of pillars may not describe complex formations description of pinch outs is a clear example of the limitations of cartesian grids in our algorithm to simulate complex systems the unstructured tetrahedra are natural choices we show in fig c1 a domain of 30 km long 20 km wide and 10 km height we consider a pinched out impermeable layer in the domain the exact location of the impermeable layer is shown in fig c1 we inject of co2 along one vertical side of the domain and production is performed at the opposite vertical side all properties of the problem are the same as in example 7 for reference we show in fig c4 the overall mole fraction of co2 at different pvis for simplicity we consider a no gravity scenario the cpu time to 1 pvi is 8 min with a total of 4500 elements appendix d oblique fracture the modeling of unstructured tetrahedra is not limited to pinch out problems one important application is the modelling of oblique fractures in this appendix we show the application of fcfe in unstructured tetrahedra we consider the oblique fracture shown in fig d1 in a domain of 12 km long 5 km wide and 5 km height to model such oblique fractures the use of unstructured tetrahedra is a necessity the application of cad to unstructured tetrahedra with fractures is limited to planar fracture shapes when the fracture shapes become more complex coupling cad with unstructured tetrahedra is more challenging this will be investigated in future co2 is injected at one vertical side and production is at the opposite vertical side of the domain all properties of the problem are the same as in example 7 for reference we show the overall mole fraction of co2 at different pvis in fig d2 the cpu time for 1 pvi is 13 min with a total of 5500 elements appendix e impermeable fault all examples so far demonstrate the applicability of the fcfe in high permeability fractures the fcfe concept can be readily applied to simulate flow in a domain with barriers as we present in this example we consider a 10 10 km2 domain and 4 km height as shown in fig e1 the domain has a flow barrier shown in the thick black line fig e1 near the injection well corner co2 is injected at one corner to displace propane toward the production well at the opposite corner at a rate of 0 1 pv year the reservoir temperature is at 311 k and the pressure is 69 bar permeability is 1 md and the porosity is 20 implementation of flow barriers in fcfe is straightforward this is due to the fact that the fcfe elements are aligned with the interfaces of the matrix elements by imposing a zero flux for interfaces with barrier index the flux is redistributed along the rest of matrix interfaces the mass balance is always guaranteed this is applied for the two matrix elements adjacent to the n 1 d element with a barrier index for reference we show the overall mole fraction of injected co2 at different pvis in fig e2 with a number of grids of 1500 elements the cpu time is 5 min appendix f anisotropy and heterogeneity in this example we consider a 100 m 50 m domain initially saturated with propane c3 co2 is injected at one corner to displace propane toward the production well at the opposite corner at a rate of 1 pv year the reservoir temperature is at 311 k and the pressure is 69 bar we study three different setups that we denote by examples fa fb and fc in the first two setups we choose two permeability tensors such that the first has a higher permeability within the diagonal from the injection to the production well k1 with an anisotropy ratio of 140 4 at an angle of 27 in k2 the angle is 27 1 k 1 112 55 55 32 k 2 112 55 55 32 in the third setup we consider heterogeneous media by assigning a random permeability value to each grid cell fig f1 porosity is set to 20 in all setups the overall mole fraction of co2 in the three domains is shown at different pore volume injections pvis in fig f2 the effect of the orientation of the shear is apparent between the first two setups anisotropy significantly affects the oil recovery in the first setup where the shear is aligned with the flow direction breakthrough occurs at 40 pvi fig f3 in the second setup breakthrough is delayed until 70 pvi the result is more than 50 difference in oil recovery compared to the first setup fig f3 the cpu time is 3 min with a total of 3000 elements 
747,this work presents an efficient and accurate algorithm for multicomponent compressible single phase flow in fractured media the model covers 2d 2 5d and 3d unstructured gridding and accounts for heterogeneity and anisotropy the fracture cross flow equilibrium approach fcfe is applied in triangular finite elements fe in 2d and prism and tetrahedra fe in 2 5d and 3d respectively one can then simulate flow in fractured media with fractures in different orientations unstructured gridding with fcfe allows simulating realistic fractured porous media efficiently in addition fcfe in unstructured gridding alleviates the limitation of the number of intersecting fractures in rectangular and hexahedron fe the number is limited to 2 in 2d and 3 in 3d to generate domains with complicated boundaries we have developed a computer aided design cad interface we demonstrate the efficiency and accuracy of our model by several numerical examples our examples include comparison with analytical solution and convergence rate keywords compressible flow fractured media mixed finite element discontinuous galerkin cross flow equilibrium discrete fractures impec method unstructured mesh anisotropy heterogeneous media 1 introduction modelling of compressible flow is of high interest in geochemical and petroleum subsurface formations a challenge in subsurface simulation relates to flow in the fractures fractured porous media impose large range in spatial scales permeabilities and fluxes and generally have complex geometries using structured grids may not accurately describe the complexity commercial simulators may not converge in the near well region because structured grids are not well suited to model radial flow near wells fung et al 2013 numerous approximations are used for flow modelling in fractured media these approximations are applied in single phase flow sandve et al 2012 ahmed et al 2015 hoteit and firoozabadi 2005 and multi phase flow bastian et al 2000 granet et al 1998 bogdanov et al 2003 geiger et al 2004 2009 abushaikhaa et al 2015 chen et al 2015 nick and matthäi 2011 matthäi et al 2007a b unsal et al 2010 the approximations are divided into two broad categories the dual continuum model and the discrete fracture matrix model the low computational cost of the dual continuum models makes them attractive in modeling fracture networks warren and root 1963 gilman and kazemi 1983 the dual porosity model has been extended to multi rate transfer function di donato et al 2004 geiger et al 2013 the discrete fracture matrix dfm model is known for high accuracy and flexibility in fracture representation karimi fard et al 2004 kim and deo 2000 reichenberger et al 2006 makedonska et al 2015 hyman et al 2015 hoteit and firoozabadi 2008 zidane and firoozabadi 2014 2017 the dfm approach geometrically matches the fracture and matrix grid cells when a lower dimension fractures representation is used the fracture elements in dfm coincide with the matrix element interfaces in addition to the classical dfm li and lee 2008 proposed the embedded discrete fracture model edfm it was later adopted by moinfar et al 2014 the edfm is considered as a non conforming dfm model as a result in edfm one could have more than four intersecting fractures even when applied on structured grids the edfm is known to have limitations to model low permeability fractures tene et al 2017 presented the projection based edfm pedfm to overcome the limitations of the edfm in this work we have selected the dfm for its attractive features in large scale and sparse fracture systems we assume that the fracture aperture is small compared to the matrix scale noorishad and mehran 1982 granet et al 1998 martin et al 2005 therefore the fractures are represented by n 1 dimensional elements in an n dimensional domain the ease of implementation makes the finite difference fd and the finite volume fv approaches the most commonly used numerical methods in structured and unstructured grids respectively the fd and fv approaches are usually accompanied with a two point flux approximation tpfa to calculate the field fluxes the fv method aavatsmark et al 1998 edwards 2002 edwards and zheng 2010 lamine and edwards 2010 2013 is more convenient to model oblique fractures karimi fard et al 2004 schmid et al 2013 however the coupling between the lowest order methods and tpfa produces excessive numerical dispersion and suffers from grid sensitivity to overcome the limitations of tpfa the multipoint flux approximation mpfa has been introduced aavatsmark 2002 kozdon et al 2011 huggenberger et al 2015 bastista et al 2013 nordbotten et al 2007 aavatsmark et al 2008 younes et al 2013 younes et al 2015 aavatsmark et al 2010 matringe et al 2009 salama et al 2013 wheeler and yotov 2006 wheeler et al 2011 2012 the fluxes in mpfa are constructed from pressures in the surrounding elements making mpfa attractive in unstructured grids however mpfa may produce unphysical oscillations in the pressure field nordbotten et al 2007 aavatsmark et al 2008 younes et al 2014 the use of finite element fe method in unstructured gridding has gained popularity since 1970 s in many disciplines in science and engineering nejati et al 2015 moortgat and firoozabadi 2016 in this work we adopt the combination of the mixed finite element mfe method and the discontinuous galerkin dg method the mfe in its hybridized form provides pressure at the cell center and the traces of pressure at the cell interfaces this ensures high accuracy in flux calculation in fractured reservoirs the mass conservative dg method is used to discretize the mass transport equation dg is particularly attractive in fractured reservoir simulation because the approximation does not have to be continuous between elements by using dg in highly heterogeneous fractured media one can capture the discontinuity of concentration between the low permeable matrix and the high permeable fracture network the cross flow equilibrium cfe concept in the discrete fracture approach was introduced to model multicomponent compressible flow in fractured porous media hoteit and firoozabadi 2005 in cfe the pressure concentration in a fracture element is assumed to be equal to the pressure concentration in the surrounding matrix elements this assumption requires the matrix grids next to fractures to be small the small grid cells may impose restriction on the size of time step due to the courant freidricks levy cfl condition in explicit schemes later hoteit and firoozabadi 2008 advanced the efficiency of flow calculations in fractured media by the fracture cross flow equilibrium fcfe approach in incompressible flow in 2014 zidane and firoozabadi 2014 have used the fcfe to model multicomponent compressible flow in fractured porous media in compositional extension it is assumed that both pressure and concentration are constant across the fracture width compared to cfe concept the fcfe approach alleviates the need for small elements in the matrix grid cells in our previous application the method was limited to structured grid cells in this work we apply for the first time the fcfe approach in compressible flow in 2d 2 5d and in 3d for all commonly used finite elements fe discretization of the pressure equation in compressible multicomponent flow is more complicated than the incompressible flow as we will show in the discretization section our model applies to quadrangular and triangular elements in 2d and to hexahedra prism and tetrahedra elements in 3d in addition we have developed for the first time a computer aided design cad interface coupled with our mesh generator this allows the user to generate very complicated fractured domains in an efficient way unstructured grids offer several advantages over structured grids in reservoir simulation the advantages include the ease to simulate fractured reservoirs in which fractures have different orientations a triangular finite element could be oriented in different directions such that one or more of its edges is are aligned with the fractures one of the challenges is to generate unstructured triangular grids that some elements are aligned to the orientation of the different fractures we highlight the two dominant methods in unstructured triangular grid generation and justify our choice for one of the two in one the advancing front method the cells that make up the interior of the mesh are modeled by marching away from the boundaries of the domain anderson 1994 the other method is the delaunay triangulation the delaunay technique triangulates a set of points in such a way that no extremely skewed cells are generated in the delaunay triangulation one can have the points on the desired edges to be part of the field points generated a priori when using the fcfe model the details of the delaunay triangulation are presented in anderson 1994 in 2 5d one uses prism type fe extruded from 2d triangular elements as we will explain later prism fe provides a more realistic representation of the fractures compared to hexahedron fe in dfm in 3d we use fully unstructured tetrahedron grids similarly to 2d in 2 5d and 3d the fractures are also represented by the interfaces of the fe we provide a description of the proposed model in generating unstructured 2d and 3d grids in the next section then we present the differential equations that describe multicomponent compressible flow in fractured media and a brief overview on the discretization of the pressure and the species mass balance equations in the rock matrix and the fracture network we provide several examples to highlight the features of the model and conclude with few remarks 2 model description for completeness we briefly present the main features of our model which combines different spatial and temporal discretization schemes in the matrix and in the fracture network to advance efficiency and accuracy the basis and test functions in the numerical discretization for different types of fes are presented in appendix a the essences of the model are the hybridized mixed finite element method mfe is used to calculate the fluxes in the matrix domain and the fracture network durlofsky 1994 mosé et al 1994 darlow et al 1984 hoteit and firoozabdi 2008 younes et al 2011 zidane et al 2012 zidane et al 2014a zidane et al 2014b zidane and firoozabadi 2014 zidane and firoozabdi 2015 the mfe formulation can readily accommodate full permeability tensors the discontinuous galerkin dg method is used to solve the mass balance equations in the matrix a slope limiter is used to remove the nonphysical oscillations cockburn and shu 1989 1998 younes et al 2014 2015 chavent and jaffré 1986 hoteit et al 2004 siegel et al 1997 a finite volume approach is used to discretize the species mass balance equations in the fractures the traces of the pressure in the matrix and the fracture network are implicitly updated at each time step the molar densities in the fracture network are implicitly updated at each time step the molar densities in the matrix domain are explicitly updated at each time step the implicit pressure explicit concentration impec approach in the matrix domain is found to be stable and efficient in single phase flow and also in multiphase compositional flow as demonstrated in moortgat and firoozabadi 2016 and zidane and firoozabdi 2017 however an impec approach is not efficient when used in the fractures this is due to the small size of the fracture elements that impose a severe restriction on the size of time step therefore we adopt an implicit time scheme in the fracture network the larger size of the matrix elements justifies the use of an explicit discretization in the matrix domain instead of a fully implicit scheme unstructured triangular elements are used in 2d and prism and tetrahedron elements are used in 3d 3 unstructured 2d 2 5d and 3d grid generation triangular elements allow simulating oblique fractures fig 1a without imposing approximations on the matrix elements reiter et al 2012 in fcfe the set of points that define the domain and the locations of the fractures should be provided a priori fig 1a b the grids are then generated by starting from the domain and the fracture input data points fig 1c in rectangular domains and a small number of fractures fig 1b the set of points could be manually generated however this technique is not efficient when the domain boundaries are complex and the number of fractures is high to overcome this deficiency we have developed an interface to read data points from a cad computer aided design output cad software is usually used to create two and three dimensional graphical representations of physical objects using a cad interface makes it possible to generate very complex boundaries as will be shown in the examples rapidly in addition the cad software allows reading pre existing maps domains that have dwg dws dwt and dxf extensions and edit them by adding removing boundary and or fracture points unstructured prism fe is used in 2 5d the prisms are constructed from triangular 2d surfaces fig 1d the 2d triangles are then extruded to as many layers as required fig 1e and extrude the edges of the triangles to 2d planes in space the technique can generate several layers of a reservoir and assign different properties to each layer as will be demonstrated later in the examples the edge defining the fracture in 2d by two nodes e g n 2 n 3 fig 1e the extruded nodes of this edge n 5 n 6 fig 1f are defined as fracture nodes in 3d the pre existing nodes and the extruded nodes define a fracture element in 3d fig 1f tetrahedra are used in full 3d discretization and they are generated by dividing a hexahedra fe into 6 tetrahedra and by using tetgen see fig 1g si 2011 4 mathematical model 4 1 governing equations in the matrix the rock matrix and the discrete fractures in our model have different geometrical dimensions in the simulation domain n d for the matrix domain and n 1 d for the fracture network the governing equations are therefore treated separately the superscript m denotes the matrix the superscript f denotes the fractures the mass balance of component i in miscible and compressible flow is given by the following equation 1 m c i m t c i m v m f i m 0 i 1 n c in ω 0 τ in the above equation denotes the porosity v the velocity field ci czi the molar density of component i where c is the overall molar density zi and fi are the mole fraction and the sink source term of component i in the mixture respectively ω is the computational domain and τ denotes the simulation time and nc is the number of components the flow in porous media is described by darcy s law 2 v k μ p ρ g where k is the absolute permeability tensor μ the dynamic viscosity p the pressure ρ the mass density and g the gravitational acceleration the peng robinson equation of state eos peng and robinson 1976 is used to describe the molar density c as a function of the composition temperature and pressure as follows c p z r t 3 z 3 1 b z 2 a 3 b 2 2 b z a b b 2 b 3 0 z is the compressibility factor r the gas constant t the temperature and mi the molar mass of component i to complete the system of equations we use the volume balance approach from acs et al 1985 and watts 1986 to compute the pressure field in compressible flow the expression for the volume balance is given by 4 m c t m p m t i 1 n c v i m c i m v m f i m 0 where ct is the total compressibility v i is the total partial molar volume of component i in the mixture firoozabadi 2015 4 2 governing equations in the fractures the mass balance equations in the fractures integrated along the fracture width ε in n 1 d are expressed by 5 f c i f t c i f v f q i f f i f 0 i 1 n c the term q i f is the mass flux of component i across the matrix fracture boundaries in the mixture similarly to the matrix domain the pressure field in the fractures is obtained from 6 f c t f p f t i 1 n c v i f c i f v f q i f f i f 0 5 numerical discretization 5 1 discretization of the flow equation the hybridized mixed finite element mfe method with the lowest order raviart thomas rt basis space is used to discretize the volumetric flow in the matrix and the fractures the global system of equations for the pressure is obtained by writing the continuity of fluxes and pressures at all the interfaces of the matrix elements and the fractures elements the number of unknowns equals the number of interfaces in the matrix domain tp m p f plus the number of interfaces in the fracture network tp f 7 a m m a m f 0 a m f a f f r f 0 r t f m f tp m p f tp f v m v f 0 derivation of eq 7 and the definition of all elements are given in appendix a 5 2 discretization of the transport equations the dg method is used to discretize the species transport equations in the matrix with an explicit time scheme multiplying the first expression in eq 1 by the shape function φ k l and integrating over each matrix element k we get 8 i 1 n j d c i k j m d t k k m φ k l φ k j k φ k l f i m j 1 n j e 1 n e q k e c i k j m k φ k j w k e φ k l c i k e j m e e φ k l φ k j in the above equation for a matrix element k c i k j m is the molar density of component i at node j nj is the number of nodes c i k e j m is the upstream molar density of component i at node j of interface e q k e is the volume flux across the interface e and ne is the total number of interfaces in matrix element k the system of ordinary differential equations of order nj per element is obtained by writing eq 8 over each element k in the matrix domain coupled with a slope limiter stabilization to remove the nonphysical oscillations as opposed to the matrix elements the mass balance equation in the small fracture elements is discretized with an implicit time scheme to overcome the cfl restriction to avoid the expensive dg approximation in the fractures a finite volume method is applied in the fractures as follows 9 k f c i k f n 1 c i k f n δ t e 1 n e c i e f n q k e f n q i f k 1 q i f k 2 f i k f n where c i e f n denotes the upstream value of the molar density the term q i f k j j 1 2 represents the matrix fracture exchange flux the discretization in the fractures and coupling the fracture network with the matrix domain are presented in appendix b the above equation is written for all the fracture elements and the system of equations are linearized and solved using the newton raphson nr method 5 3 upstream technique for multiple intersecting fractures in structured grids the maximum number of intersecting fracture elements at one interface is four in unstructured grids the maximum number of intersecting fracture elements may be higher in principle it depends on the mesh quality and the order of refinement near the fractures in two intersecting fractures the upstream value is deduced from the flux direction when nt fractures intersect at point o and nu is the number of fractures with fluxes in the upstream direction fig 2 the upstream value at the intersection is given as follows zidane and firoozabadi 2014 10 c i o f j 1 n u c i k j f q k j f j 1 n u q k j f 6 numerical examples we present in the following seven examples with different number of fractures and different geometries in addition to the examples we present in appendix c a pinch out problem and a domain with oblique fracture in 3d in appendix d the implementation of a barrier in fcfe is demonstrated in appendix e and one example with anisotropy is studied in appendix f an intel core i5 pc 3 ghz cpu 4 gbram is used in all the runs cpu time is for 1 pore volume injection pvi unless specified otherwise 6 1 example 1 single fracture in this example we consider the single fracture problem from ahmed et al 2015 the domain is 1 m 1 m with one oblique fracture fig 3 a the fracture thickness is 1 mm with 104 md permeability the permeability of the matrix is 1 md the injector is located at one corner and production at constant pressure is at the opposite corner the injection rate is 0 3171 pv year a neumann boundary condition with zero flux is imposed on the domain boundary we compare the results of our model to the control volume distributed multipoint flux approximation model with lower dimensional fractures or cvd mpfa l ahmed et al 2015 and the hybrid sandve et al 2012 cvd mpfa h and to the equidimensional model where fractures are represented by the same dimension as the matrix elements note that eq 4 should be reduced to incompressible single phase flow to make the problem the same as in ahmed et al 2015 the tracer concentration at the production well is recorded throughout the simulation and compared to the results of the three different models as shown in fig 4 an excellent agreement is observed between our model fcfe and cvd mpfa l and cvd mpfa h and the equidimensional model in fig 3b we show the tracer concentration at 1 2 pvi the contour profile is similar to the one by ahmed et al 2015 in the tracer incompressible flow 6 2 example 2 intersecting fractures we compare our model to the vertex approximate gradient vag finite volume scheme and the results to an example presented in xing et al 2016 the importance of this example is the analytical solution provided by the authors xing et al 2016 comparing our numerical results to an exact solution demonstrates the accuracy of the model the domain of unit surface area contains four intersecting fractures that we denote by f1 f2 f3 and f4 fig 5 the fracture to matrix permeability ratio is 200 for f1 and f2 and 400 for f3 and f4 the fracture aperture is 0 01 for all fractures porosity is set to one in the whole domain in fig 6 we show the convergence of the relative l 1 and l 2 errors between the analytical solution and the numerical solution of our model and the model of xing et al 2016 at different mesh refinements in the matrix and the fractures as shown in fig 6 the error in our model is less than the vag model in both the matrix and the fractures even with lower mesh refinement in our model the error difference between our model and vag is more significant in the matrix domain than the fractures this is because of the accuracy of our higher order dg results in the matrix 6 3 example 3 cpu time in this example we consider a network of intersecting fractures as shown in fig 7 the properties of the domain are given in table 1 locations of injection and production wells are the same as in example 1 the overall mole fraction of methane is shown in fig 8 at different pvis the total number of matrix elements is 1400 the fracture network includes 80 n 1 d elements higher number of fracture elements implies a larger matrix to be inverted during the nr iterations see eq 9 to evaluate the effect of the number of fracture elements on the cpu time we randomly remove 10 fracture elements from the fracture network the order and or location of the randomly removed fractures does not affect the cpu cost as a result the new domain has 70 n 1 d fracture elements this procedure is repeated 8 times by reducing the number of fracture elements 10 at a time see fig 9 a to g in the 8th reduction the problem reduces to unfractured media fig 9h we show in table 2 the cpu time at 100 pvi for different cases with different number of fractures from 0 unfractured media to 80 fracture elements shown in fig 7 in fig 10 we show the overall mole fraction of methane at 70 pvi at different fracture reductions the small increase in the cpu time from 1 54 min for unfractured media to 2 42 min 80 fracture elements demonstrates the efficiency of our model 6 4 example 4 1 km long domain in this example we consider a 1000 m 300 m domain fig 11 with a set of randomly distributed fractures with lengths from 220 m to 350 m we run this example in five different mesh refinements fig 11 going from a very coarse mesh of 75 elements to 1600 elements the properties of the domain are the same as in example 3 except a 1 mm fracture thickness is used injection well is located at one corner with a constant rate of 1 pv year and production is performed at constant pressure at the opposite corner in figs 12 and 13 we show the overall mole fraction of methane at 10 and 60 pvi with all meshes results show that even with the coarse mesh of 600 elements the model produces comparable results to the relatively fine mesh of 1600 elements at low and high pvi the high accuracy of our model is partly due to the higher order nodal discontinuous galerkin method in nodal dg one node connects more information with the surrounding elements compared to the lower order fv method in the latter one grid cell shares the same average value with the surrounding three elements at the edges of the triangular finite element for a more qualitative study of the mesh refinement we compare the overall mole fraction of methane at the production well in all meshes fig 14 a good agreement is observed starting from a 300 elements compared to the 1600 mesh the cpu time is 4 min for 1600 refined mesh we run a simulation with 3200 elements for this problem not shown and results are in agreement with the results of 1600 element mesh 6 5 example 5 non regular boundaries in the previous examples we considered rectangular domains although the discretization is based on unstructured grids in such cases where there is no complexity in geometry the use of our cad interface is not needed when the geometry becomes more complex the use of our cad interface becomes essential for efficient mesh generation in this example we consider a complicated domain boundaries as shown in fig 15 a the domain is generated using the cad interface that was discussed above the domain includes a set of randomly distributed fractures with different lengths varying from 140 to 460 m co2 is injected at one corner to displace propane to the opposite corner of the domain the locations of the injection and production wells are shown in fig 15a the relevant data of the domain is shown in table 3 two different mesh refinements are used a coarse mesh of 600 elements and a fine mesh of 2600 elements fig 15b c the overall mole fraction of co2 at 10 and 50 pvi is shown in figs 16 and 17 respectively for both meshes there is good agreement as shown in fig 15 the largest elements in the computational domain are located near the fracture network this advantage of the fcfe approach results in i lower total number of elements and ii avoiding the excessive cfl condition in and near the fractures away from the fracture network the size of the elements reduces as a result of the complex boundaries and not as a requirement by the model in a domain with complex boundaries the small areas are discretized with smaller finite elements in this example these areas are located between 450 and 750 m shown by dashed circles in fig 15c having a coarser mesh in these areas is possible but will result in losing details of the meanders at the boundaries the cpu time for the refined mesh is 8 min 6 6 example 6 2 5d vertical extrusion of the 2d complex domain the cad interface in our mesh generator help with the generation of complicated 3d domains in this example the domain of the previous example is extruded in the z direction with a thickness of 100 m fig 18 a the properties of the domain in this example are the same as in example 5 locations of the injection and production wells are shown in fig 18a the mesh is based on the refined mesh of example 5 2600 elements see fig 15c the 2d mesh is then extruded into 3 layers 2 layers of 25 m thickness and a third layer at the top of 50 m thickness the fractures that are represented by lines in 2d are now represented by planes in 3d the mesh of the domain with the fractures is shown in fig 18b extruding a triangular finite element into a 3d space creates a prism fe the prism fe offers the same flexibility as the triangular fe offers in 2d the prism could be rotated in a way that one or more of the interfaces is are aligned with the desired locations of the fractures in figs 19 and 20 we show the overall mole fraction of co2 in the matrix figs 19a 20a and in the fracture network figs 19b 20b at 10 and 50 pvi respectively the cpu time to 1 pvi in this example is 45 min 6 7 example 7 fractured sandwich reservoir in the last example we consider a multilayered fractured reservoir with 1 km long 0 3 km width and 0 3 km height fig 21 a to d as shown in fig 21 the fractures have different orientations along the x and y axes the reservoir consists of four overlapped layers two layers have a permeability of 0 1 md and a porosity of 10 and two layers with 10 md and a porosity of 20 the layers are arranged as shown in fig 21 e the mesh and the location of the fractures are shown in fig 21 f the properties of the domain are given in table 4 the total number of elements in the matrix domain and the fracture network are 6000 and 600 respectively the composition of the initial oil is shown in table 5 co2 is uniformly injected at one vertical side and production is performed uniformly at the opposite vertical side of the domain for reference we show the overall mole fraction of the injected co2 at 15 25 and 80 pvi in both the matrix domain and the fracture network fig 22 the high value of mole fraction of the injected fluid at the top and the low value at the bottom even at 80 pvi are due to two factors i the difference in matrix permeability between top and bottom and ii the effect of the boundary meanders on flow the cpu time in this example is about 28 min 7 summary and conclusions we have incorporated the fcfe concept in 2d 2 5d and 3d unstructured grids to simulate multicomponent compressible flow in fractured media our grid generator is coupled with a cad interface based on the results from the examples in the text and in the appendices we draw the following conclusions one can readily adapt the mfe formulation to simulate anisotropic and heterogeneous media the mixed finite element mfe formulation can be readily adapted to account for full permeability tensors to simulate anisotropic and heterogeneous media we demonstrate that the incorporation of the fcfe concept with higher order dg alleviates the need for mesh refinement in complicated domains in unstructured gridding the prism and tetrahedra fe with fcfe in 3d allow simulation of realistic fractured domains the extrusion of prism fe from 2d triangular elements makes the fracture entities in 3d to be represented by planes as a result one could have the fractures oriented with different angles along the three axes and removes the limitation on the number of intersecting fractures as opposed to hexahedron fe accuracy of the algorithm is demonstrated by convergence of coarser mesh to the results of a more refined mesh even in complicated geometries the use of a cad interface is found to be a very efficient way to generate complex geometries in 2d and 3d unstructured tetrahedron fe allows simulation of domains that include sharp boundaries in physical properties as in the case of pinch out problems application of our cad interface to fractures in fully unstructured gridding is limited in this work to planar fracture shapes when the fracture shapes are more complex coupling with cad is challenging this will be investigated in the future the work covers single phase flow in 2d and in 3d a full extension to multiphase compositional flow adds more complexity to the formulation and the computational time on unstructured 3d gridding the surface tension in compositional multiphase flow is low which reduces the effect of capillary pressure however more complexity arises when calculating the matrix fracture and fracture fracture exchange flux in different phases since phase fluxes could be in different directions from matrix to fractures and vice versa as opposed to single phase flow in multiphase compositional flow the implicit solution of the transport equation in the fractures requires the calculation of derivatives of the molar density of each component in each phase with respect to the total molar density of each component when applied in unstructured grid in 2d and or 3d these derivatives should be calculated for all intersected fractures in single phase flow this derivative is always one full coupling of the cad to unstructured tetrahedron fe and adding multiphase compositional flow to unstructured 2d and 3d grids is in progress for future publication acknowledgement this work was supported by the member companies of the reservoir engineering research institute reri whose support is gratefully acknowledged appendix a discretization of the pressure equation in this appendix we show how to obtain the global system of equations to solve for the pressure the continuity of the fluxes and the pressure at the interfaces in the matrix domain leads to 11 r t m m r t m f p m m m m m f m m m f m f f tp m p f 0 q f and in the fracture network 12 r t f p f m f tp f 0 integration of the pressure equation eq 6 in the text in the matrix gives 13 d m p m r m m r m f tp m p f f m and in the fractures 14 d f p f r f tp f f f q f combining the above equations and using the gaussian elimination to reduce the size of the global system we get 15 a m m a m f 0 a m f a f f r f 0 r t f m f tp m p f tp f v m v f 0 the elements of the matrices in the above equations are given in table a1 the coefficient w k e in table a1 are the raviart thomas basis functions and k is the permeability tensor see zidane and firoozabadi 2014 in table a1 e represents the edge where the parameters α k e β k e e are evaluated and e represents the adjacent edges of e in the element k appendix b matrix and fractures discretization variables and exchange fluxes we adopt a lower dimensional representation of the fractures compared to the matrix dimension this is justified because of small fracture aperture compared to the matrix domain each fracture element exchanges fluxes with two matrix elements the two fluxes q i f k 1 q i f k 2 belong to the interfaces of the matrix grid cells if the fracture element is at the boundary of the domain the interaction in this case is limited to one matrix element therefore three different scenarios could be observed regarding the matrix fracture flux the first case is when the two matrix elements are feeding the fracture element represented by fracture f 1 in fig b1 the second case is when the fracture is feeding the adjacent two matrix elements represented by fracture f 2 in fig b1 the last case when one matrix element is feeding the fracture and the latter is feeding the adjacent matrix element fracture f 3 in fig b1 the effect of the three scenarios in the numerical discretization follows in the first case fracture f 1 both fluxes q i f k 1 q i f k 2 are treated explicitly in the temporal scheme in the second case fracture f 2 both fluxes q i f k 3 q i f k 4 are treated implicitly in the last case one flux is treated implicitly q i f k 4 and one flux is treated explicitly q i f k 5 in the implicit treatment the flux is added to the updated netwon raphson nr iteration and in the explicit treatment the flux is added to the residual function in the nr iteration the flow and transport variables are represented by different symbols in fig b1 appendix c pinch out problem subsurface formations are generally complex structured grid cells and or grids that are based on the concept of pillars may not describe complex formations description of pinch outs is a clear example of the limitations of cartesian grids in our algorithm to simulate complex systems the unstructured tetrahedra are natural choices we show in fig c1 a domain of 30 km long 20 km wide and 10 km height we consider a pinched out impermeable layer in the domain the exact location of the impermeable layer is shown in fig c1 we inject of co2 along one vertical side of the domain and production is performed at the opposite vertical side all properties of the problem are the same as in example 7 for reference we show in fig c4 the overall mole fraction of co2 at different pvis for simplicity we consider a no gravity scenario the cpu time to 1 pvi is 8 min with a total of 4500 elements appendix d oblique fracture the modeling of unstructured tetrahedra is not limited to pinch out problems one important application is the modelling of oblique fractures in this appendix we show the application of fcfe in unstructured tetrahedra we consider the oblique fracture shown in fig d1 in a domain of 12 km long 5 km wide and 5 km height to model such oblique fractures the use of unstructured tetrahedra is a necessity the application of cad to unstructured tetrahedra with fractures is limited to planar fracture shapes when the fracture shapes become more complex coupling cad with unstructured tetrahedra is more challenging this will be investigated in future co2 is injected at one vertical side and production is at the opposite vertical side of the domain all properties of the problem are the same as in example 7 for reference we show the overall mole fraction of co2 at different pvis in fig d2 the cpu time for 1 pvi is 13 min with a total of 5500 elements appendix e impermeable fault all examples so far demonstrate the applicability of the fcfe in high permeability fractures the fcfe concept can be readily applied to simulate flow in a domain with barriers as we present in this example we consider a 10 10 km2 domain and 4 km height as shown in fig e1 the domain has a flow barrier shown in the thick black line fig e1 near the injection well corner co2 is injected at one corner to displace propane toward the production well at the opposite corner at a rate of 0 1 pv year the reservoir temperature is at 311 k and the pressure is 69 bar permeability is 1 md and the porosity is 20 implementation of flow barriers in fcfe is straightforward this is due to the fact that the fcfe elements are aligned with the interfaces of the matrix elements by imposing a zero flux for interfaces with barrier index the flux is redistributed along the rest of matrix interfaces the mass balance is always guaranteed this is applied for the two matrix elements adjacent to the n 1 d element with a barrier index for reference we show the overall mole fraction of injected co2 at different pvis in fig e2 with a number of grids of 1500 elements the cpu time is 5 min appendix f anisotropy and heterogeneity in this example we consider a 100 m 50 m domain initially saturated with propane c3 co2 is injected at one corner to displace propane toward the production well at the opposite corner at a rate of 1 pv year the reservoir temperature is at 311 k and the pressure is 69 bar we study three different setups that we denote by examples fa fb and fc in the first two setups we choose two permeability tensors such that the first has a higher permeability within the diagonal from the injection to the production well k1 with an anisotropy ratio of 140 4 at an angle of 27 in k2 the angle is 27 1 k 1 112 55 55 32 k 2 112 55 55 32 in the third setup we consider heterogeneous media by assigning a random permeability value to each grid cell fig f1 porosity is set to 20 in all setups the overall mole fraction of co2 in the three domains is shown at different pore volume injections pvis in fig f2 the effect of the orientation of the shear is apparent between the first two setups anisotropy significantly affects the oil recovery in the first setup where the shear is aligned with the flow direction breakthrough occurs at 40 pvi fig f3 in the second setup breakthrough is delayed until 70 pvi the result is more than 50 difference in oil recovery compared to the first setup fig f3 the cpu time is 3 min with a total of 3000 elements 
748,a segmented two phase flow model is developed to describe immiscible two phase flow in discrete fracture networks i e there is an abrupt interface separating the two immiscible fluids the capillary pressure on the fluid material interface and gravity are considered for two phase flow in fracture networks it is inevitable to form a mixed fluid in some fracture segments the mixed fluid is described by a homogeneous model and parameter γ is introduced as a critical value controlling new fluid formation in mixed fluid the governing equations for two phase flow are solved with a developed numerical manifold method nmm which is verified using the finite element and analytical methods with two examples two phase flow through a single fracture intersection acting as one of the basic elements for complex fracture networks is then analysed different inlet and outlet configurations are considered including one inlet two outlets two inlets one outlet and one inlet multi outlets for the second configuration parametric studies of defined parameter γ and boundary conditions are carried out in the third configuration capillary pressure and gravity effects are discussed the developed nmm is applied to the analysis of two phase flow in a complicated fracture network showing that it is an efficient method for simulating segmented two phase flow in fracture networks complex two phase flow characteristics in the fracture networks that cannot be addressed in continuum models e g the change in flow direction and transition from static to flow are also revealed and analysed keywords incompressible two phase flow discrete fracture networks numerical manifold method segmented two phase flow model 1 introduction two phase and multi phase flows in fracture networks are common in energy and environmental engineering including nuclear waste isolation pruess et al 1990 vaughn et al 2000 geological storage of carbon dioxide ren et al 2017a yin et al 2017 enhanced oil recovery in fractured reservoirs raeini et al 2015 iglauer et al 2016 and non aqueous phase liquid napl migration slough et al 1999 popp et al 2016 two phase flow also plays important roles during unsaturated flow in fractured rock fractures are ubiquitous in natural rock mass zhuang et al 2011 wu et al 2013 hu et al 2016 fan et al 2017 2018 wang et al 2017 and they ordinarily paly a dominant role in fluid flow in the fractured medium because of higher permeability there are three basic conceptual models used for simulating fluid flow in fractured media li et al 2014 ren et al 2017b chen et al 2018a 2018b 1 the equivalent continuum model 2 the dual continuum model and 3 the discrete fracture model dfm these three models differ in their representations of fractured media heterogeneity among the three models the dfm describe fractures in rock media explicitly having received increasing attention for simulating single phase two phase and multi phase flows in fractured media over the past several decades murphy et al 1993 liu et al 2016 benedetto et al 2016 ye et al 2017 ma et al 2018 the dfm can be divided into two categories based on whether the rock matrix permeability in fractured media is considered kim et al 2000 reichenberger et al 2006 or not hoteit and firoozabadi 2009 the assumption that fluid flow occurs only within connected fracture networks can be adopted in a simulation and this assumption generally yields satisfactory results when the rock matrix permeability is much lower than that of the fracture systems in naturally fractured reservoirs chen et al 1987 in addition the reduced dimension method which is used to reduce the fracture dimension from n to n 1 is often applied to increase computational efficiency in the dfm hoteit and firoozabadi 2005 many studies have examined two phase flow in fractured media using the dfm the widely used governing equations of two phase flow are saturation equations for each phase which include mass conservation darcy s law relative permeability functions and capillary pressure functions ordinarily the relative permeability and capillary pressure are expressed by saturation of wetting fluid which can be determined through laboratory tests several experiments have indicated that the above governing equations are a satisfactory approximation for describing two phase flow in porous media scheidegger 1974 however the relative permeability functions are hard to obtain for fractures because of difficulty in controlling and measuring fluid saturation in fractures pruess et al 1990 moreover shad et al 2013 found that oil water relative permeability is not only a function of saturation it is also related to fluid and fracture properties fracture orientation and flow pattern basing on a series of laboratory experiments because these relationships are often nonlinear and different for rock fractures and rock matrix they may result in discontinuities of saturation and pressure field equations various numerical methods based on the dfm and the governing equations of two phase flow have been developed to simulate two phase flow in fractured media including finite difference fd method popp et al 2016 finite volume fv method karimi fard et al 2003 monteagudo et al 2004 galerkin finite element gfe method kim et al 2000 hoteit and firoozabadi 2005 and hybrid methods hoteit and firoozabadi 2008 huang et al 2014 for two phase flow in fracture networks the transition zone between two immiscible fluids is narrow relative to the regional dimensions occupied by each fluid alone therefore a segmented two phase flow model can be adopted to describe this phenomenon which is shown in experiments conducted by berger et al 2000 and huang et al 2005 the basic idea of the segmented model is that each fluid is confined to a defined portion of the flow domain with abrupt interfaces separating each domain namely it is a single phase in each side of an interface moving boundaries as well as pressure discontinuity are involved because of the abrupt interface berger et al 2000 used the segmented two phase flow model solved by the galerkin finite element gfe method to study gas water displacement in discrete fracture networks a time adaptive element mesh with the finest discretization at the abrupt interface was adopted because of moving interfaces however the finest discretization at the abrupt interface may increase computational burden when there are many interfaces in a fracture network notably the numerical manifold method nmm is an effective way to solve this problem based on its finite dual cover system with independent mathematical covers and physical covers remeshing techniques for the traditional finite element method are no longer required for studying a moving boundary under the nmm framework shi 1991 1992 wu et al 2014 2017 zheng et al 2014 cai et al 2013 hitherto the nmm has been developed a useful method about seepage problem in porous media and fractured porous media by wang et al 2016 zheng et al 2015 and hu et al 2016 2017 the detailed method describing two phase flow in fracture networks with nmm can be seen in our previous study ma et al 2017 however the systematic analysis of two phase flow in fracture networks with capillary pressure and gravity has not been carried out in detail with this method the present study as an extension of our previous work ma et al 2017 presents a segmented two phase flow analysis in fracture networks based on a developed nmm in detail the nmm schemes for two phase flow in fracture networks are briefly introduced in section 2 in section 3 two examples of two phase flow in a fracture network and a vertical single fracture are presented to verify this method two phase flow through different single fracture intersections is analysed in section 4 three single fracture intersections with different inlet and outlet configurations are considered i e one inlet and two outlets two inlets and one outlet and one inlet and multi outlets for the second configuration the effects of defined parameter γ and boundary conditions on two phase flow behaviours are analysed for the third configuration the capillary pressure and gravity influences are discussed finally we apply the nmm to analyse two phase flow in a complicated fracture network in section 5 in the last section we present the conclusions of this study 2 nmm schemes for two phase flow in fracture networks 2 1 governing equations of two phase flow in fracture networks in the current study we assume that 1 the reduced dimension method is adopted to study two phase flow in 2d fractured media based on discrete fracture network model 2 the fluid density does not change 3 two phase flow in fractures obey darcy s law whltaker 1986 4 the permeability of rock matrix and compressibility of fluids are ignored and 5 a parallel plate model is adopted to describe fractures fig 1 a shows a simple fracture network in xz plane where two fluids separated by abrupt interfaces are assumed to flow from left to right the governing equations used to model two phase flow in a fracture network under gravity are as follows 1 k j μ i x j p x j ρ i g δ z j l j k j μ i x j p x j ρ i g sin θ i 0 x j ω i x where subscript i denotes the fluid phase and subscript j is the fracture segment number lj is the length of fracture segment j zj is the difference in height between the endpoints of fracture segment j θj is the angle between fracture segment j and the x axis in the xz plane the range of which is 0 90 which is shown in fig 1 b p is fluid pressure μ is fluid dynamic viscosity of each phase ρ is fluid density of each phase g is the gravity constant of 10 n kg k is permeability of a fracture k b jh 2 12 based on the cubic law and bjh is the equivalent hydraulic aperture of fracture segment j the fluid velocity in a fracture is calculated as follows based on darcy s law 2 v j k j μ i p x j ρ i g δ z j l j the pressure on the abrupt interfaces can be expressed as follows 3 p j ξ t p j ξ t p j c o n x ξ t where ξ t represents material interface positions at time t pjξ t and pjξ t are the pressures on the left and right sides of the material interface in fracture segment j respectively pjc is the capillary pressure on the abrupt interface which can be derived from the general young laplace equation 4 p c p n w p w σ 1 r 1 1 r 2 where pc is the capillary force pnw and pw are the non wetting and wetting phase pressures respectively σ is the interfacial tension r 1 and r 2 are the principal radii of curvature of the interface as shown in fig 1 c r 1 is the radius of in plane curvature and r 2 is perpendicular to the fracture plane with the assumptions that the fracture walls are composed of two parallel plates with hydraulic aperture bh the in plane interface is flat and thus r 1 and r 2 can be calculated as r 2 bh 2cosβ substituting for r 1 and r 2 in the general eq 4 gives 5 p c σ 1 r 1 1 r 2 σ 1 1 b h 2 cos β 2 σ cos β b h for a fracture segment j the capillary pressure is 6 p j c 2 σ cos β b j h where subscript j is the fracture segment number bjh is the equivalent hydraulic aperture of fracture segment j β is the contact angle between wetting fluid and the fracture wall the interface condition for fluid velocity in fracture segment j can be obtained through flux conservation as follows 7 k j μ 1 p x j ρ 1 g δ z j l j b j h k j μ 2 p x j ρ 2 g δ z j l j b j h q j o n x ξ t where qj is the flow rate in fracture segment j 2 2 mixed fluids in a fracture network mixed fluids may be formed during the process of two phase flow through a fracture intersection as shown in fig 2 both fluid 1 in fracture segment 1 and fluid 2 in fracture segment 2 flow into fracture segment 3 at the same time forming a mixed fluid ma et al 2017 this type of two phase flow in a fracture is very complicated the main issue is that there are many flow patterns which are affected by many factors such as the velocity of each phase mixture flow rate finite density difference ratio of fluid viscosities phase surface tension and fracture wall wettability shear stress between phases as well as the fracture aperture and fracture inclination based on two phase flow in pipes ismail et al 2015 to reduce numerical model complexity a homogeneous model was introduced to describe mixed fluid flow in fractures mixed fluid is treated as a new fluid in this study and the viscosity μm and density ρm for a new fluid are as follows 8 μ m μ 1 λ 1 μ 2 λ 2 ρ m ρ 1 λ 1 ρ 2 λ 2 where λ is the ratio of the flux of each phase to the total flux of the two phase flow the ratio of the flux of each phase to the total flux of the two phase flow in a mixed fluid can be expressed by fractional flow of each phase at time t as follows ma et al 2017 9 λ 1 q 1 t q 1 t q 2 t λ 2 q 2 t q 1 t q 2 t where q 1 t and q 2 t are flow rates of fluid 1 and fluid 2 forming a mixed fluid at time t respectively during the process of two phase flow flow rates may vary with time thus the ratio of the flux of each phase to the total flux of the two phase flow is different and different new mixed fluid may appear at each time step increasing the computational burden to solve this problem a new parameter γ was introduced to control whether a new mixed fluid is formed the value of γ is determined as follows 10 γ α max k j μ 1 min k j μ 2 0 α 1 where α is a dimensionless parameter kj is permeability of fracture segment j μ 1 and μ 2 are the dynamic viscosities of fluid 1 and fluid 2 respectively during the simulation of two phase flow in a fracture network for example a mixed fluid begins to be formed at time t in a fracture segment the mixed fluid dynamic viscosity and density are calculated by eqs 8 and 9 then the same method is used to obtain the mixed fluid parameter at time t t before continuing we check if the value of eq 11 is smaller than the parameter γ 11 k j u 1 t 0 δ t k j u 2 t 0 if the value is smaller than the critical value γ the mixed fluids at time t t t is treated as the mixed fluid at time t otherwise a new mixed fluid is formed with new parameters calculated at time t t and a new discrete interface are also appeared to separate the two mixed fluids fig 2 schematically shows three mixed fluids in fracture segment 3 for the mixed fluid the governing equation is as follows 12 k j μ m x j p x j ρ m g sin θ m 0 x j ω m x which has the same format as eq 1 and where kj and μm are the permeability of fracture segment j and mixed fluid dynamic viscosity respectively ω m x is the mixed fluid domain i e the line segment occupied by mixed fluid 2 3 nmm for two phase flow in a fracture network fig 3 illustrates the developed nmm for two phase flow in a fracture network fig 3 a shows a fracture network fig 3 b displays three typical fracture intersections in the fracture network fig 3 a fig 3 c shows the mathematical covers and their weighting functions for the three intersections fracture intersection n3 formed by fracture segments 4 5 and 6 is taken as an example the discretion for each fracture segment can be obtained based on 1d nmm discretion shi 1991 1992 ma et al 2017 fig 3 d presents the corresponding physical covers formed by the mathematical covers and the material interfaces for fracture intersection n3 if there is no material interface in the intersection mathematical cover the physical cover is the mathematical cover which is shown in fig 3 d1 and d1 if a material interface is in the intersection mathematical cover as shown in fig 3 d2 and d3 the mathematical covers are divided into physical covers p n 3 1 and p n 3 2 as shown in fig 3 d2 and d3 notably when a material interface is only at an intersection point the interface conditions need to be considered in the global discrete equation it is warranted to add the following equations to the global discrete equation for a fracture network e g fig 3 b3 to satisfy the flux conservation for the intersection of three fractures 4 5 and 6 13 v 4 b h 4 v 5 b h 5 v 6 b h 6 q 0 where bhj denotes the hydraulic aperture of fracture j and subscript j is the fracture segment number connected to an intersection q is sink source term in this study the inflow velocity is assumed to be positive the outflow velocity negative and in the following simulation the sink source term q 0 the nmm discretization equations for manifold elements were obtained based on the galerkin method which is as follows 14 k α μ α l e ω x i ω t x i d x i p k α μ α ω p x i l e x i ω α x where p p 1 p 2 and ω w 1 w 2 t the global discrete equation for a fracture network can be obtained by assembling the discrete equation for each fracture segment which is based on the physical cover codes for fracture segments and intersection points the pressure functions of physical covers can be obtained by solving the global discrete equation under appropriate boundary and initial conditions the fluid velocity at any point can be obtained using the parallel plates model ren et al 2017a and dacrcy s law 15 v b h 2 12 μ p x where x is the local coordinate for the fracture p is fluid pressure μ is the fluid dynamic viscosity bh is hydraulic aperture the movement of interfaces in fractures j can be calculated by the following equation 16 ξ j x t δ t ξ j x t v j t δ t where ξj x t and ξj x t t are the interface positions at time t and t t in fracture segment j respectively vjt is the material interface velocity at time t in fracture segment j and t is the time step 3 method verification the nmm simulations of two phase flow in a horizontal single fractures are verified with the analytical and finite element methods in our previous study ma et al 2017 the nmm is an efficient method for two phase flow in fractures in this section two examples are presented to further validate the method the first example is two phase flow in a horizontal fracture network under steady state condition without considering capillary pressure and gravity which is compared with the finite element method results the second example is two phase flow in a vertical single fracture considering gravity and capillary pressure which is validated by the analytical results 3 1 two phase flow in a horizontal fracture network the computational model is shown in fig 4 a which is a square domain of 10 m 10 m containing 5 fractures the original computational model is shown in fig 4 a1 fig 4 a2 shows the fracture network without the dead and isolated fracture segments which are deleted by the tree cutting method this method was presented in detail in some references li et al 2014 ma et al 2017 there are two different fluids in this fracture network as shown in fig 4 a the material interface positions separating the two fluids are 0 5 m 2 m and 1 5 m 8 m in the coordinate system the permeability of each fractures is the same k 1 0 10 7 m2 the dynamic viscosities for fluid 1 grey colour and fluid 2 red colour are 0 01 pa s and 0 001 pa s the left and right of the model are inlet pressure boundary and outlet pressure boundary respectively where pin 11 0 pa and pout 1 0 pa the nmm and fem results of hydraulic pressure distribution in the fracture network are shown in fig 4 b and c respectively the pressures of some key points are listed in table 1 which include intersection points and material interfaces comparing the results the nmm agree well with the fem and illustrating the nmm accuracy in simulating two phase flow in fracture networks moreover the hydraulic pressure gradient in the fluid 2 zone is smaller than that in the fluid 1 zone this phenomenon is the result of the fluid 1 mobility m 1 k 1 μ 1 being smaller than the fluid 2 mobility m 2 k 2 μ 2 therefore only when the pressure gradient is smaller in the fluid 2 zone than that in the fluid 1 zone can eq 7 be satisfied 3 2 two phase flow in a vertical single fracture considering the effects of gravity and capillary pressure the computational model is shown in fig 5 a there are two immiscible fluids in the vertical single fracture the length of which is 0 1 m the red colour represents fluid 1 and the grey colour represents fluid 2 the permeability of the fracture is 1 10 7 m2 and the dynamic viscosities for fluid 1 and fluid 2 are 0 0001 pa s and 0 0002 pa s respectively the densities for fluid 1 and fluid 2 are 1000 kg m3 and 800 kg m3 respectively the position of the material interface between the two fluids is z 0 05 m at the initial time four different boundary conditions and capillary pressures were considered which are as follows 1 p 1 800 pa p 2 0 pa pc 0 pa 2 p 1 1000 pa p 2 0 pa pc 0 pa 3 p 1 0 pa p 2 0 pa pc 840 pa and 4 p 1 0 pa p 2 0 pa pc 960 pa where pc p 1 p 2 the computational results are shown in fig 5 b and c fig 5 b presents the variations of fluid velocity in the vertical fracture for the above four situations the fluid velocity is positive when it is along the positive direction of z axis negative along the opposite direction as shown in fig 5 b the fluids flow from top to bottom in situations 1 and 3 because the total downward force is larger than the total upward force for the two situations initially for situations 2 and 4 because the total upward force is larger than the total downward force initially the fluid velocities are positive i e the fluids flow from bottom to top also shown in fig 5 b the values of fluids velocities gradually decrease over time in the four situations the material interface does not move until the gravity boundary pressures and capillary pressure are in a balanced state i e the total downward force is equal to the total upward force 16 ρ 1 g l 1 ρ 2 g l 2 p 1 p 2 p c where l 1 and l 2 are the heights of fluid 1 and fluid 2 respectively the material interface positions in a stable state for the four situations are shown in fig 5 c which are z 0 m z 0 1 m z 0 02 m and z 0 08 m respectively the correctness can be easily validated by a balancing analysis on forces through eq 16 in this example the computation ceases when the fluid velocity is smaller than 10 5 m s 4 two phase flow through a single fracture intersection two phase flow through a single fracture intersection with different inlet and outlet configurations are analysed in this section which are divided into two cases according to whether the capillary pressure is considered or not the capillary pressure is not considered in the first case and considered in the second case 4 1 one inlet two outlets and two inlets one outlet in this section three tasks are conducted 1 an overall behavioural analysis of two phase flow through the two single fracture intersections 2 effects of parameter γ on two phase flow through a fracture intersection with two inlets and one outlet and 3 effects of boundary conditions on two phase flow through the fracture intersection with two inlets and one outlet 4 1 1 overall behavioural analysis of two phase flow through two single fracture intersections the computational model with one inlet and two outlets and the model with two inlets and one outlet are shown in fig 6 a and b respectively the left and right of the model are inlet pressure and outlet pressure boundaries respectively where pin including pin 1 and pin 2 is 1 1 kpa and pout including pout 1 and pout 2 is 0 0 kpa the fracture intersection is saturated with fluid 1 initially then fluid 2 is injected into the fracture intersection from the inlet boundary the material interfaces are 0 01 m from the left endpoints of the fracture segments at t 0 s for both computational models the fracture permeability is 1 0 10 7 m2 and the dynamic viscosities for fluid 1 and fluid 2 are 0 01 pa s and 0 001 pa s respectively for the second model two different γ are set γ 0 01 m 1 m 2 and γ m 1 m 2 total time and time step were 10 000 s and 0 1 s respectively the processes of two phase flow through the fracture intersection with different inlet and outlet configurations are illustrated in fig 7 fig 7 a is for the model with one inlet and two outlets where from t 0 00 s to t 25 12 s fluid 2 red colour flows in fracture segment 1 and reaches the intersection point at t 25 12 s subsequently fluid 2 begins to flow into fracture segments 2 and 3 at t 43 62 s fluid 2 in fracture segment 2 arrives at its right endpoint at t 56 59 s fluid 2 reaches the right endpoint of fracture segment 3 in our programme the calculation is terminated under one of the following conditions 1 the cumulative time reaches the specified time or 2 the fracture network is only saturated by the driving fluid fig 7 b and c is for the model with two inlets and one outlet where γ 0 01 m 1 m 2 and γ m 1 m 2 respectively for γ 0 01 m 1 m 2 the mixed fluid formed by fluid 1 and fluid 2 in fracture segment 3 is separated into 27 different fluids at time t 84 95 s there are 16 different fluids in fracture segment 3 for γ m 1 m 2 there are only 3 different fluids during the two phase flow process i e fluid 1 fluid 2 and the mixed fluid formed by the two fluids the variations of intersection point pressures for the two models are shown in fig 8 a and b respectively based on fig 8 a from t 0 s to t 25 12 s the intersection point pressure increases over time and at t 25 12 s i e the moment that fluid 2 red colour in fracture segment 1 arrives at the intersection point the pressure reaches its maximum value after that moment the pressure decreases over time slowly at first and then decreases rapidly over time until t 43 62 s which is the moment that fluid 2 reaches the right endpoint of fracture segment 2 from t 43 62 s to t 56 59 s the pressure variation decreases slowly over time in the beginning then decreases rapidly over time the pressure variation for the intersection point in the model shown in fig 6 b is shown in fig 8 b with γ 0 01 m 1 m 2 based on fig 8 b from t 0 00 s to t 52 40 s the pressure increases over time at t 52 40 s the pressure reaches its maximum value of 1 01 kpa at t 52 40 s fluid 2 in fracture segment 1 reaches the intersection point from t 52 40 s to t 68 47 s the pressure at the intersection point decreases over time based on fig 7 b 68 47 s is the moment that the first mixed fluid reaches the end of fracture segment 3 from t 68 47 s to t 84 86 s the pressure increases again over time subsequently the pressure at the intersection point decreases over time and reduces to 0 694 kpa 4 1 2 effects of parameter γ on two phase flow through a single fracture intersection in section 2 2 a new parameter γ is introduced to control whether a new mixed fluid is formed or not when parameter γ is small enough many new mixed fluids are formed which improves accuracy but increases the computational burden if parameter γ is large enough the number of mixed fluid decreases which improves the calculation efficiency but accuracy is lessened therefore it is necessary to discuss the effects of parameter γ on two phase flow fracture networks to select an appropriate γ for the simulation we use the single fracture intersection shown in fig 6 b as an example eight γ values are set as follows γ 1 0 01 m 1 m 2 γ 2 0 03 m 1 m 2 γ 3 0 05 m 1 m 2 γ 4 0 07 m 1 m 2 γ 5 0 09 m 1 m 2 γ 6 0 1 m 1 m 2 γ 7 0 5 m 1 m 2 and γ 8 m 1 m 2 the other necessary parameters are the same as those in section 4 1 1 during the process of two phase flow through the fracture intersection the fluid velocity variations in these fracture segments and the pressure at the intersection point for all selected γ values are shown in fig 9 based on fig 9 the defined parameter γ has little effect on the fluid velocities and pressures prior to t 68 s in this example combined with fig 7 b or c t 68 s is the moment that the first mixed fluid reaches the end of fracture segment 3 after t 68 s the parameter γ has observable effects on the fluid velocities and pressures however the pressure and velocity variation trends are similar with different γ values in our previous study we set γ m 1 m 2 to simulate two phase flow in fracture networks which is a reasonable approximation the minimum value of γ with which there are only three fluids i e fluid 1 fluid 2 and one mixed fluid is defined as the critical value of γ based on the figures the critical value of γ is between 9 0 10 6 and 4 5 10 5 because there are no differences in velocity and pressure variations when γ 4 5 10 5 from fig 9 a b c and d the following phenomena are observed 1 the fluid velocities do not increase with the increase of parameter γ until γ reaches its critical value 2 the pressures at the intersection point do not decrease with the increase of γ until γ reaches its critical value 3 after the critical γ value is reached the parameter has no effects on the two phase flow behaviour and 4 before the critical value of γ is reached the larger the value of γ the smaller the pressures are and the larger the velocities are taking γ 9 0 10 7 for example and comparing fig 9 a and b we find an interesting phenomenon from t 0 s to t 52 40 s the pressure gradient decreases over time in fracture segment 1 because of the pressure increase at the intersection point but the velocities in this fracture segment increases over time this is because the fluid velocities are not only related to the pressure gradient but also the fluid mobility although the pressure gradient decreases over time the reduction is not enough to decrease the fluid velocities because the driving fluid has higher mobility than the driven fluid 4 1 3 effects of boundary conditions on two phase flow through the fracture intersections with two inlets and one outlet the model shown in fig 6 b is taken as an example in which two different situations are considered 1 fluid 2 drives fluid 1 and 2 fluid 1 drives fluid 2 the dynamic viscosities of fluid 1 and fluid 2 are 0 01 pa s and 0 001 pa s respectively namely the mobility of fluid 1 is smaller than that of fluid 2 the permeability of each fracture segment is 1 0 10 7 m2 in this section pin 1 1 1 kpa and pout 0 kpa for the first situation pin 2 0 1 kpa 0 3 pa 0 5 kpa 0 6 kpa 0 7 kpa 0 9 kpa and 1 0 kpa for the second situation pin 2 0 1 kpa 0 3 kpa 0 5 kpa 0 6 kpa 0 7 kpa and 0 9 kpa the material interfaces in fracture segments 1 and 2 are 0 01 m and 0 3 m from the left endpoint of the fracture segments at t 0 s respectively during the process of two phase flow through the single intersection the pressure variations at the intersection point and fluid velocities in fracture segment 2 for the first situation are shown in fig 10 a and b respectively the pressure and velocity variations for the second situation are shown in fig 10 c and d in fig 10 a and c lines with symbols represent the intersection point pressure short dashes represent boundary pressure of fracture segment 2 pin 2 in fig 10 b and d short dashes represent the velocity of fracture segment 2 as 0 m s based on fig 10 a when pin 2 0 1 kpa 0 3 kpa and 0 5 kpa the intersection point pressures are always larger than the corresponding pin 2 accordingly the fluid velocities in fracture segment 2 flow from right to left during the process i e negative when pin 2 0 6 kpa 0 7 kpa and 0 9 kpa the intersection point pressure is smaller than the corresponding pin 2 in the beginning as the process continues the pressures become larger than the corresponding pin 2 after a period of time the pressures once again become smaller than the corresponding pin 2 thus for pin 2 0 6 kpa 0 7 kpa and 0 9 kpa the fluid velocities in fracture segment 2 are positive at first then become negative and later become positive again which are shown in fig 10 b when pin 2 1 0 kpa the pressures at the intersection point are always smaller than 1 0 kpa thus the velocities in fracture segment 2 are always positive from fig 10 c it can be found that when pin 2 0 6 kpa 0 7 kpa and 0 9 kpa the pressure at the intersection point are always smaller than corresponding pin 2 accordingly the fluids velocities in fracture segment 2 are positive when pin 2 0 1 kpa 0 3 kpa and 0 5 kpa the pressure at the intersection point is larger than the corresponding pin 2 in the beginning with the increase of time the pressures start to be smaller than corresponding pin 2 after a period of time the pressures are larger than the corresponding pin 2 again for pin 2 0 1 kpa 0 3 kpa and 0 5 kpa the fluids velocities in fracture segment 2 are negative at first then positive later negative again as shown in fig 10 d note that when pin 2 0 1 kpa the pressures at the intersection point are almost always larger than 0 1 kpa thus the velocities in fracture segment 2 are always negative comparing fig 10 a and c one can also see that for the first situation the range of pin 2 is 0 5 kpa 1 0 kpa under which the direction of fluids flow in fracture segment 2 would change while for the second situation the range of pin 2 is 0 1 kpa 0 5 kpa 4 2 two phase flow through a fracture intersection with one inlet and multi outlets in this section two phase flow through a single fracture intersection with one inlet and multi outlets is conducted with consideration of capillary pressure and gravity the study includes 1 the overall behavioural analysis of the two phase flow through the fracture intersection 2 effects of capillary pressure on the two phase flow through the fracture intersection and 3 effects of both gravity and capillary pressure on the two phase flow through the fracture intersection 4 2 1 overall behavioural analysis of the two phase flow through the fracture intersection the computational model for the fracture intersection with one inlet and multi outlets is shown in fig 11 a there are 10 fracture segments 1 main fracture segment and 9 branching fracture segments the left and right boundaries of the model are pressure boundary conditions which are 10 0 pa and 0 0 pa respectively the fracture intersection is initially saturated with fluid 1 then fluid 2 is injected into the fracture intersection from the left boundary the material interfaces are 0 01 m from the left end of the fracture segment1 at t 0 s the permeability of the fractures is 2 0 10 5 m2 the dynamic viscosities for fluids 1 and 2 are 0 001 pa s and 0 0001 pa s respectively the capillary pressure between the two fluids is 5 pa the initial time step is 0 1 s the process of two phase flow through the fracture intersection is illustrated in fig 12 a based on fig 12 a from t 0 0000 s to t 0 7408 s fluid 2 red colour flows in fracture segment 1 and reaches the intersection point at t 0 7408 s subsequently fluid 2 begins to flow into branching fracture segments 2 3 4 5 and 6 at t 4 9178 s fluid 2 in fracture segment 2 arrives at its right endpoint later the fluids in all the fracture segments continue to flow from left to right and at t 5 1746 s fluid 2 in fracture segment 3 reaches its endpoint after that the fluids in fracture segments 4 5 and 6 begin to flow from right to left which is shown in fig 12 a at t 17 9646 s the fluid distribution in the fracture intersection in a stable state is shown at t 40 0003 s in fig 12 a during the process the fluid velocities vary in each fracture segment which are presented in fig 12 b1 based on fig 12 b1 the variations are obvious from t 0 s to t 7 0 s and from t 31 s to t 32 s to analyse the fluid velocity variations in each fracture segment in detail two partial enlarged drawings are presented in fig 12 b2 and b3 which cover the periods from t 0 to t 7 0 s and t 31 s to 32 s respectively based on fig 12 b2 from t 0 s to t 0 7408 s the fluid velocity in all fracture segments are positive and increase over time from t 0 7408 s to t 4 9178 s all fluid velocities are positive and the fluids velocities in fracture segments 1 2 and 3 obviously increase while the fluid velocity variations in fracture segments 4 5 and 6 are not obvious at t 4 9178 s the fluid velocities in all fracture segments change suddenly the velocities in fracture segments 1 and 2 increase suddenly and in fracture segments 4 5 and 6 decrease suddenly this because there is capillary pressure in fracture segment 2 from t 0 7408 s to t 4 9178 s after t 4 9178 s the capillary pressure in fracture segment 2 disappears from t 4 9178 s to t 5 1746 s the velocities in fracture segments 1 and 3 slightly increase in fracture segment 2 slightly decreases and in fracture segments 4 5 and 6 show no obvious changes in addition the fluid velocities in all fracture segments are positive during this period fluid velocity changes suddenly again in all fracture segments at t 5 1746 s because of the capillary pressure disappearance in fracture segment 3 at this moment the velocities in fracture segments 1 and 3 increase suddenly and in fracture segments 2 4 5 and 6 decrease suddenly it is noteworthy that the velocities in fracture segments 4 5 and 6 become negative combining fig 12 a from t 5 1746 s to t 17 9646 s one can see that the fluids in fracture segments 4 5 and 6 moves from right to left after t 5 1746 s the velocities in all fracture segments show no obvious changes until t 31 2246 s when fluid 2 in fracture segments 3 4 and 5 flows back to the intersection point as shown in fig 12 b3 after t 31 2246 s all velocities have a slight vibration the reason of this phenomenon is as follows when the fluid 2 is in fracture segments 3 4 and 5 the velocities are always negative since t 5 1746 s however once a material interface in fracture segments 3 4 or 5 reaches the intersection point the fluid velocity in this fracture segment becomes positive instantly again thus the result is the reciprocating motion of the fluids near the intersection point of fracture segments 4 2 2 effects of capillary pressure on two phase flow through the fracture intersection in this section we aim to investigate the capillary pressure effects on two phase flow through the fracture intersection computational model initial conditions boundary conditions and the hydraulic properties of fractures and fluids are the same as those in section 4 2 1 four different capillary pressures between the two immiscible fluids are set which are pc 1 pa pc 3 pa pc 7 pa and pc 9 pa the fluid distribution in the single fracture intersection for all four situations in a stable state are shown in fig 13 different capillary pressures have different effects on fluid flow and fluid distribution in a stable state for the first situation since the capillary pressure is smaller fluid 2 displaces fluid 1 from left to right during the whole process and the fracture intersection is saturated with fluid 2 in the end which is shown in fig 13 a for pc 3 pa fluid 2 drives fluid 1 from left to right until the moment that fracture segments 2 3 4 and 5 are saturated with fluid 2 subsequently the fluids in fracture segment 6 begin to flow in opposite direction until fluid 2 flows back to the intersection point which is shown in fig 13 b when pc 7 pa the fluids flow from left to right from the initial time to the moment when fluid 2 reaches the right endpoint of fracture segment 2 then the fluid velocities in all fracture segments suddenly drop to 0 m s fig 13 c shows the fluid distribution in a stable state in the fracture intersection for pc 7 pa for the fourth situation because of the larger capillary pressure pc 9 pa when fluid 2 reaches the right endpoint of fracture segment 2 the fluids in fracture segments 3 4 5 and 6 become backflow and reach a stable state when fluid 2 in these fractures segments reaches the intersection point which is shown in fig 13 d 4 2 3 effects of both gravity and capillary pressure on two phase flow through the fracture intersection in this section both gravity and capillary pressure are considered to investigate the two phase flow through the fracture intersection the computational model considering gravity force and the number for each fracture segments are shown in fig 11 b the left and right boundaries of the model are also pressure boundary conditions which are 10 0 kpa and 0 0 kpa respectively the permeability of the fractures is 1 0 10 8 m2 the densities for both fluids are 500 kg m3 the dynamic viscosities for both fluids initial conditions and the time step are the same as those in section 4 2 1 to investigate the effect of capillary pressure on two phase flow in the fracture intersection under gravity two situations are considered 1 pc 500 pa and 2 pc 0 pa the processes for both situations are illustrated in fig 14 fig 14 a is for the first situation pc 500 pa and fig 14 b is for the second situation pc 0 pa comparing the two processes they have the same characters before fluid 2 reaches the right endpoint of fracture segment 8 as follows 1 chronologically fluid 2 reaches the right boundary of this model in the order of fracture segments 5 3 7 9 2 4 6 and 8 2 due to the gravity effect the fluids in fracture segments 3 5 7 and 9 move faster than the fluids in fracture segments 4 6 8 and 10 however after that moment the behaviours of the two phase flow in the fracture intersection are different for each situation fluid 2 in fracture segment 10 begins to flow from right to left for the first situation and fluid 2 in this fracture segment continues to flow from left to right for the second situation 5 two phase flow in a fracture network in this section the developed nmm was adopted to analyse two phase flow in a fracture network the original computational model is shown in fig 15 a fig 15 b shows the fracture network without isolated and dead fracture segments the top and bottom of the domain are impermeable boundaries and the left and right sides are inlet pressure boundary with p 1 1 1 mpa and outlet pressure boundary with p 2 0 0 mpa respectively the fracture network is saturated with fluid 1 at the initial time and then fluid 2 is injected from the inlet boundary of the model the material interfaces between the two fluids are 0 01 m from the left end of the fracture segments at t 0 s the permeability of the fractures is 1 0 10 8 m2 and the dynamic viscosities for fluids 1 and 2 are 0 0001 pa s and 0 001 pa s respectively the gravity and capillary pressure between the two fluids were not considered in the study parameter γ 0 1 m 1 m 2 the total time and time step were set to 10 000 s and 0 1 s respectively the process of two phase flow in the fracture network is shown in fig 16 we select only 12 typical pictures from t 0 s to t 126 08 s the grey colour represents fluid 1 and the red colour represents fluid 2 in fig 16 the mixed fluid is indicated by the colour as follows 17 m i x e d f l u i d g r a y s 1 r e d s 2 where s 1 and s 2 indicate fluid 1 and fluid 2 concentrations in a mixed fluid respectively from fig 16 we find the following phenomenon 1 the direction of fluid velocities in some fracture segments may change such as fracture segment 70 there is an obvious material interface in the fracture segment which is close to the lower endpoint at t 0 49 s while at t 1 59 s the former material interface disappears and another material interface appears which is close to the upper endpoint later the material interface flow moves from the upper to lower endpoints fig 17 a shows that the pressures of the lower endpoint are larger than those of the upper endpoint from t 0 0 s to t 0 47 s thus the fluids in fracture segment 70 flow from the lower to upper endpoints during this period after t 0 47 s the pressure of the lower endpoint is smaller than that of the upper endpoint and the fluids in this fracture segment flow from the upper to lower endpoints 2 the fluids in some fractures are no flow or nearly no flow at some time such as fracture segment 82 the driving fluid i e fluid 2 hardly enters this fracture segment from t 0 11 s to t 0 49 s fig 17 b shows the pressure variations of the lower and upper endpoints of fracture segment 82 and the pressures at the two endpoints are approximately equal from t 0 00 s to t 0 49 s after t 0 49 s the pressure at the upper endpoint become larger than that at the lower endpoint and the fluid begins to enter fracture segment 82 from its upper endpoint 3 the above phenomena all take place in vertical fracture segments of the fracture network because they are perpendicular to the direction of the maximum pressure gradient moreover the variations of concentrations of fluid 2 driving fluid in the domain and at the outlet boundary caused by different boundary pressures are discussed different inlet pressures are set pin 0 1 mpa 0 5 mpa 0 8 mpa 1 1 mpa the outlet pressure is fixed value with pout 0 mpa the variations of concentrations of fluid 2 in the domain and at the outlet boundary with time under different inlet pressure are shown in fig 18 because the curves for the variations of concentrations of fluid 2 at the outlet boundary are non smooth an exponential function is adopted to fit the curves the fitting equations are also shown in fig 18 from the figure one can see that except the fluid velocities the variations of concentrations of fluid 2 in the domain and at the outlet boundary have the same features for the above model under different inlet pressures 1 during the displacement process the concentrations of fluid 2 in the domain increase with time and tend towards stability 2 in the beginning the concentrations of fluid 2 at the outlet boundary is less than that in the domain while with time increase the former is gradually larger than the latter 3 the concentrations of fluid 2 is approximately equal at the moment when the concentrations of fluid 2 in the domain and at the outlet boundary are equal 4 the concentrations of fluid 2 in the domain are also approximately equal at breakthrough time of fluid 2 the reason causing this phenomenon is the assumption of darcy s law under which the relationship between fluid velocity and pressure is linear thus the pressure distribution along the fracture segments occupied by fluid 1 fluid 2 or a mixed fluid is linear as shown in the governing equation of segmented two phase flow eqs 1 and 9 when changing the inlet pressure the pressure gradient in each fracture segment increases and decreases in equal proportion 6 conclusions in this study a systematic segmented two phase flow analysis in fracture networks based on the numerical manifold method has been presented with consideration of capillary pressure and gravity effects the following main conclusions are drawn 1 for the model with one inlet and two outlets when the driving fluid reaches the intersection point it flows into the other two fracture segments however for the model with two inlets and one outlet mixed fluids might be formed the pressure variations at the intersection point for the two models are different 2 the smaller parameter γ is the more the numbers of mixed fluids are for two phase flow through a fracture intersection with two inlets and one outlet parameter γ has little effects on the fluid velocities and pressures before the first mixed fluid in fracture segment 3 reaches its end after that the parameter has observable effects on these terms however the variation trends of pressures and velocities are similar with different γ values 3 for two phase flow through a single fracture intersection fluid velocity directions in a fracture segment might change which is affected by pressure boundary conditions in the fracture segment as well as the mobilities of the driving fluid and driven fluid when the mobility of the driving fluid is larger than that of the driven fluid the pressures under which the direction of fluid flow changes are larger than those for the reverse situation 4 the capillary pressure between two fluids vanishes when the material interface moves to outside of a fracture which causes a sudden change of fluid velocities in all fracture segments such as a sudden increase sudden decrease or a direction change 5 the pressures at the intersection points are variable during the process of two phase flow in fracture networks the pressures result in the fluids in some fracture segments have no flow or almost no flow at some time and the fluid velocity directions may change in some fracture segments 6 for a horizontal fracture network regardless of capillary pressure the variations of concentrations of fluid 2 in the domain and at the outlet boundary have the same features and the concentration of each fluid in the domain is also approximately equal at the breakthrough time of driving fluid under different inlet pressures acknowledgement the research is supported by the national natural science foundation of china nsfc nos 11572282 51778021 51627812 and 51778029 and china scholarship council csc no 201706540014 
748,a segmented two phase flow model is developed to describe immiscible two phase flow in discrete fracture networks i e there is an abrupt interface separating the two immiscible fluids the capillary pressure on the fluid material interface and gravity are considered for two phase flow in fracture networks it is inevitable to form a mixed fluid in some fracture segments the mixed fluid is described by a homogeneous model and parameter γ is introduced as a critical value controlling new fluid formation in mixed fluid the governing equations for two phase flow are solved with a developed numerical manifold method nmm which is verified using the finite element and analytical methods with two examples two phase flow through a single fracture intersection acting as one of the basic elements for complex fracture networks is then analysed different inlet and outlet configurations are considered including one inlet two outlets two inlets one outlet and one inlet multi outlets for the second configuration parametric studies of defined parameter γ and boundary conditions are carried out in the third configuration capillary pressure and gravity effects are discussed the developed nmm is applied to the analysis of two phase flow in a complicated fracture network showing that it is an efficient method for simulating segmented two phase flow in fracture networks complex two phase flow characteristics in the fracture networks that cannot be addressed in continuum models e g the change in flow direction and transition from static to flow are also revealed and analysed keywords incompressible two phase flow discrete fracture networks numerical manifold method segmented two phase flow model 1 introduction two phase and multi phase flows in fracture networks are common in energy and environmental engineering including nuclear waste isolation pruess et al 1990 vaughn et al 2000 geological storage of carbon dioxide ren et al 2017a yin et al 2017 enhanced oil recovery in fractured reservoirs raeini et al 2015 iglauer et al 2016 and non aqueous phase liquid napl migration slough et al 1999 popp et al 2016 two phase flow also plays important roles during unsaturated flow in fractured rock fractures are ubiquitous in natural rock mass zhuang et al 2011 wu et al 2013 hu et al 2016 fan et al 2017 2018 wang et al 2017 and they ordinarily paly a dominant role in fluid flow in the fractured medium because of higher permeability there are three basic conceptual models used for simulating fluid flow in fractured media li et al 2014 ren et al 2017b chen et al 2018a 2018b 1 the equivalent continuum model 2 the dual continuum model and 3 the discrete fracture model dfm these three models differ in their representations of fractured media heterogeneity among the three models the dfm describe fractures in rock media explicitly having received increasing attention for simulating single phase two phase and multi phase flows in fractured media over the past several decades murphy et al 1993 liu et al 2016 benedetto et al 2016 ye et al 2017 ma et al 2018 the dfm can be divided into two categories based on whether the rock matrix permeability in fractured media is considered kim et al 2000 reichenberger et al 2006 or not hoteit and firoozabadi 2009 the assumption that fluid flow occurs only within connected fracture networks can be adopted in a simulation and this assumption generally yields satisfactory results when the rock matrix permeability is much lower than that of the fracture systems in naturally fractured reservoirs chen et al 1987 in addition the reduced dimension method which is used to reduce the fracture dimension from n to n 1 is often applied to increase computational efficiency in the dfm hoteit and firoozabadi 2005 many studies have examined two phase flow in fractured media using the dfm the widely used governing equations of two phase flow are saturation equations for each phase which include mass conservation darcy s law relative permeability functions and capillary pressure functions ordinarily the relative permeability and capillary pressure are expressed by saturation of wetting fluid which can be determined through laboratory tests several experiments have indicated that the above governing equations are a satisfactory approximation for describing two phase flow in porous media scheidegger 1974 however the relative permeability functions are hard to obtain for fractures because of difficulty in controlling and measuring fluid saturation in fractures pruess et al 1990 moreover shad et al 2013 found that oil water relative permeability is not only a function of saturation it is also related to fluid and fracture properties fracture orientation and flow pattern basing on a series of laboratory experiments because these relationships are often nonlinear and different for rock fractures and rock matrix they may result in discontinuities of saturation and pressure field equations various numerical methods based on the dfm and the governing equations of two phase flow have been developed to simulate two phase flow in fractured media including finite difference fd method popp et al 2016 finite volume fv method karimi fard et al 2003 monteagudo et al 2004 galerkin finite element gfe method kim et al 2000 hoteit and firoozabadi 2005 and hybrid methods hoteit and firoozabadi 2008 huang et al 2014 for two phase flow in fracture networks the transition zone between two immiscible fluids is narrow relative to the regional dimensions occupied by each fluid alone therefore a segmented two phase flow model can be adopted to describe this phenomenon which is shown in experiments conducted by berger et al 2000 and huang et al 2005 the basic idea of the segmented model is that each fluid is confined to a defined portion of the flow domain with abrupt interfaces separating each domain namely it is a single phase in each side of an interface moving boundaries as well as pressure discontinuity are involved because of the abrupt interface berger et al 2000 used the segmented two phase flow model solved by the galerkin finite element gfe method to study gas water displacement in discrete fracture networks a time adaptive element mesh with the finest discretization at the abrupt interface was adopted because of moving interfaces however the finest discretization at the abrupt interface may increase computational burden when there are many interfaces in a fracture network notably the numerical manifold method nmm is an effective way to solve this problem based on its finite dual cover system with independent mathematical covers and physical covers remeshing techniques for the traditional finite element method are no longer required for studying a moving boundary under the nmm framework shi 1991 1992 wu et al 2014 2017 zheng et al 2014 cai et al 2013 hitherto the nmm has been developed a useful method about seepage problem in porous media and fractured porous media by wang et al 2016 zheng et al 2015 and hu et al 2016 2017 the detailed method describing two phase flow in fracture networks with nmm can be seen in our previous study ma et al 2017 however the systematic analysis of two phase flow in fracture networks with capillary pressure and gravity has not been carried out in detail with this method the present study as an extension of our previous work ma et al 2017 presents a segmented two phase flow analysis in fracture networks based on a developed nmm in detail the nmm schemes for two phase flow in fracture networks are briefly introduced in section 2 in section 3 two examples of two phase flow in a fracture network and a vertical single fracture are presented to verify this method two phase flow through different single fracture intersections is analysed in section 4 three single fracture intersections with different inlet and outlet configurations are considered i e one inlet and two outlets two inlets and one outlet and one inlet and multi outlets for the second configuration the effects of defined parameter γ and boundary conditions on two phase flow behaviours are analysed for the third configuration the capillary pressure and gravity influences are discussed finally we apply the nmm to analyse two phase flow in a complicated fracture network in section 5 in the last section we present the conclusions of this study 2 nmm schemes for two phase flow in fracture networks 2 1 governing equations of two phase flow in fracture networks in the current study we assume that 1 the reduced dimension method is adopted to study two phase flow in 2d fractured media based on discrete fracture network model 2 the fluid density does not change 3 two phase flow in fractures obey darcy s law whltaker 1986 4 the permeability of rock matrix and compressibility of fluids are ignored and 5 a parallel plate model is adopted to describe fractures fig 1 a shows a simple fracture network in xz plane where two fluids separated by abrupt interfaces are assumed to flow from left to right the governing equations used to model two phase flow in a fracture network under gravity are as follows 1 k j μ i x j p x j ρ i g δ z j l j k j μ i x j p x j ρ i g sin θ i 0 x j ω i x where subscript i denotes the fluid phase and subscript j is the fracture segment number lj is the length of fracture segment j zj is the difference in height between the endpoints of fracture segment j θj is the angle between fracture segment j and the x axis in the xz plane the range of which is 0 90 which is shown in fig 1 b p is fluid pressure μ is fluid dynamic viscosity of each phase ρ is fluid density of each phase g is the gravity constant of 10 n kg k is permeability of a fracture k b jh 2 12 based on the cubic law and bjh is the equivalent hydraulic aperture of fracture segment j the fluid velocity in a fracture is calculated as follows based on darcy s law 2 v j k j μ i p x j ρ i g δ z j l j the pressure on the abrupt interfaces can be expressed as follows 3 p j ξ t p j ξ t p j c o n x ξ t where ξ t represents material interface positions at time t pjξ t and pjξ t are the pressures on the left and right sides of the material interface in fracture segment j respectively pjc is the capillary pressure on the abrupt interface which can be derived from the general young laplace equation 4 p c p n w p w σ 1 r 1 1 r 2 where pc is the capillary force pnw and pw are the non wetting and wetting phase pressures respectively σ is the interfacial tension r 1 and r 2 are the principal radii of curvature of the interface as shown in fig 1 c r 1 is the radius of in plane curvature and r 2 is perpendicular to the fracture plane with the assumptions that the fracture walls are composed of two parallel plates with hydraulic aperture bh the in plane interface is flat and thus r 1 and r 2 can be calculated as r 2 bh 2cosβ substituting for r 1 and r 2 in the general eq 4 gives 5 p c σ 1 r 1 1 r 2 σ 1 1 b h 2 cos β 2 σ cos β b h for a fracture segment j the capillary pressure is 6 p j c 2 σ cos β b j h where subscript j is the fracture segment number bjh is the equivalent hydraulic aperture of fracture segment j β is the contact angle between wetting fluid and the fracture wall the interface condition for fluid velocity in fracture segment j can be obtained through flux conservation as follows 7 k j μ 1 p x j ρ 1 g δ z j l j b j h k j μ 2 p x j ρ 2 g δ z j l j b j h q j o n x ξ t where qj is the flow rate in fracture segment j 2 2 mixed fluids in a fracture network mixed fluids may be formed during the process of two phase flow through a fracture intersection as shown in fig 2 both fluid 1 in fracture segment 1 and fluid 2 in fracture segment 2 flow into fracture segment 3 at the same time forming a mixed fluid ma et al 2017 this type of two phase flow in a fracture is very complicated the main issue is that there are many flow patterns which are affected by many factors such as the velocity of each phase mixture flow rate finite density difference ratio of fluid viscosities phase surface tension and fracture wall wettability shear stress between phases as well as the fracture aperture and fracture inclination based on two phase flow in pipes ismail et al 2015 to reduce numerical model complexity a homogeneous model was introduced to describe mixed fluid flow in fractures mixed fluid is treated as a new fluid in this study and the viscosity μm and density ρm for a new fluid are as follows 8 μ m μ 1 λ 1 μ 2 λ 2 ρ m ρ 1 λ 1 ρ 2 λ 2 where λ is the ratio of the flux of each phase to the total flux of the two phase flow the ratio of the flux of each phase to the total flux of the two phase flow in a mixed fluid can be expressed by fractional flow of each phase at time t as follows ma et al 2017 9 λ 1 q 1 t q 1 t q 2 t λ 2 q 2 t q 1 t q 2 t where q 1 t and q 2 t are flow rates of fluid 1 and fluid 2 forming a mixed fluid at time t respectively during the process of two phase flow flow rates may vary with time thus the ratio of the flux of each phase to the total flux of the two phase flow is different and different new mixed fluid may appear at each time step increasing the computational burden to solve this problem a new parameter γ was introduced to control whether a new mixed fluid is formed the value of γ is determined as follows 10 γ α max k j μ 1 min k j μ 2 0 α 1 where α is a dimensionless parameter kj is permeability of fracture segment j μ 1 and μ 2 are the dynamic viscosities of fluid 1 and fluid 2 respectively during the simulation of two phase flow in a fracture network for example a mixed fluid begins to be formed at time t in a fracture segment the mixed fluid dynamic viscosity and density are calculated by eqs 8 and 9 then the same method is used to obtain the mixed fluid parameter at time t t before continuing we check if the value of eq 11 is smaller than the parameter γ 11 k j u 1 t 0 δ t k j u 2 t 0 if the value is smaller than the critical value γ the mixed fluids at time t t t is treated as the mixed fluid at time t otherwise a new mixed fluid is formed with new parameters calculated at time t t and a new discrete interface are also appeared to separate the two mixed fluids fig 2 schematically shows three mixed fluids in fracture segment 3 for the mixed fluid the governing equation is as follows 12 k j μ m x j p x j ρ m g sin θ m 0 x j ω m x which has the same format as eq 1 and where kj and μm are the permeability of fracture segment j and mixed fluid dynamic viscosity respectively ω m x is the mixed fluid domain i e the line segment occupied by mixed fluid 2 3 nmm for two phase flow in a fracture network fig 3 illustrates the developed nmm for two phase flow in a fracture network fig 3 a shows a fracture network fig 3 b displays three typical fracture intersections in the fracture network fig 3 a fig 3 c shows the mathematical covers and their weighting functions for the three intersections fracture intersection n3 formed by fracture segments 4 5 and 6 is taken as an example the discretion for each fracture segment can be obtained based on 1d nmm discretion shi 1991 1992 ma et al 2017 fig 3 d presents the corresponding physical covers formed by the mathematical covers and the material interfaces for fracture intersection n3 if there is no material interface in the intersection mathematical cover the physical cover is the mathematical cover which is shown in fig 3 d1 and d1 if a material interface is in the intersection mathematical cover as shown in fig 3 d2 and d3 the mathematical covers are divided into physical covers p n 3 1 and p n 3 2 as shown in fig 3 d2 and d3 notably when a material interface is only at an intersection point the interface conditions need to be considered in the global discrete equation it is warranted to add the following equations to the global discrete equation for a fracture network e g fig 3 b3 to satisfy the flux conservation for the intersection of three fractures 4 5 and 6 13 v 4 b h 4 v 5 b h 5 v 6 b h 6 q 0 where bhj denotes the hydraulic aperture of fracture j and subscript j is the fracture segment number connected to an intersection q is sink source term in this study the inflow velocity is assumed to be positive the outflow velocity negative and in the following simulation the sink source term q 0 the nmm discretization equations for manifold elements were obtained based on the galerkin method which is as follows 14 k α μ α l e ω x i ω t x i d x i p k α μ α ω p x i l e x i ω α x where p p 1 p 2 and ω w 1 w 2 t the global discrete equation for a fracture network can be obtained by assembling the discrete equation for each fracture segment which is based on the physical cover codes for fracture segments and intersection points the pressure functions of physical covers can be obtained by solving the global discrete equation under appropriate boundary and initial conditions the fluid velocity at any point can be obtained using the parallel plates model ren et al 2017a and dacrcy s law 15 v b h 2 12 μ p x where x is the local coordinate for the fracture p is fluid pressure μ is the fluid dynamic viscosity bh is hydraulic aperture the movement of interfaces in fractures j can be calculated by the following equation 16 ξ j x t δ t ξ j x t v j t δ t where ξj x t and ξj x t t are the interface positions at time t and t t in fracture segment j respectively vjt is the material interface velocity at time t in fracture segment j and t is the time step 3 method verification the nmm simulations of two phase flow in a horizontal single fractures are verified with the analytical and finite element methods in our previous study ma et al 2017 the nmm is an efficient method for two phase flow in fractures in this section two examples are presented to further validate the method the first example is two phase flow in a horizontal fracture network under steady state condition without considering capillary pressure and gravity which is compared with the finite element method results the second example is two phase flow in a vertical single fracture considering gravity and capillary pressure which is validated by the analytical results 3 1 two phase flow in a horizontal fracture network the computational model is shown in fig 4 a which is a square domain of 10 m 10 m containing 5 fractures the original computational model is shown in fig 4 a1 fig 4 a2 shows the fracture network without the dead and isolated fracture segments which are deleted by the tree cutting method this method was presented in detail in some references li et al 2014 ma et al 2017 there are two different fluids in this fracture network as shown in fig 4 a the material interface positions separating the two fluids are 0 5 m 2 m and 1 5 m 8 m in the coordinate system the permeability of each fractures is the same k 1 0 10 7 m2 the dynamic viscosities for fluid 1 grey colour and fluid 2 red colour are 0 01 pa s and 0 001 pa s the left and right of the model are inlet pressure boundary and outlet pressure boundary respectively where pin 11 0 pa and pout 1 0 pa the nmm and fem results of hydraulic pressure distribution in the fracture network are shown in fig 4 b and c respectively the pressures of some key points are listed in table 1 which include intersection points and material interfaces comparing the results the nmm agree well with the fem and illustrating the nmm accuracy in simulating two phase flow in fracture networks moreover the hydraulic pressure gradient in the fluid 2 zone is smaller than that in the fluid 1 zone this phenomenon is the result of the fluid 1 mobility m 1 k 1 μ 1 being smaller than the fluid 2 mobility m 2 k 2 μ 2 therefore only when the pressure gradient is smaller in the fluid 2 zone than that in the fluid 1 zone can eq 7 be satisfied 3 2 two phase flow in a vertical single fracture considering the effects of gravity and capillary pressure the computational model is shown in fig 5 a there are two immiscible fluids in the vertical single fracture the length of which is 0 1 m the red colour represents fluid 1 and the grey colour represents fluid 2 the permeability of the fracture is 1 10 7 m2 and the dynamic viscosities for fluid 1 and fluid 2 are 0 0001 pa s and 0 0002 pa s respectively the densities for fluid 1 and fluid 2 are 1000 kg m3 and 800 kg m3 respectively the position of the material interface between the two fluids is z 0 05 m at the initial time four different boundary conditions and capillary pressures were considered which are as follows 1 p 1 800 pa p 2 0 pa pc 0 pa 2 p 1 1000 pa p 2 0 pa pc 0 pa 3 p 1 0 pa p 2 0 pa pc 840 pa and 4 p 1 0 pa p 2 0 pa pc 960 pa where pc p 1 p 2 the computational results are shown in fig 5 b and c fig 5 b presents the variations of fluid velocity in the vertical fracture for the above four situations the fluid velocity is positive when it is along the positive direction of z axis negative along the opposite direction as shown in fig 5 b the fluids flow from top to bottom in situations 1 and 3 because the total downward force is larger than the total upward force for the two situations initially for situations 2 and 4 because the total upward force is larger than the total downward force initially the fluid velocities are positive i e the fluids flow from bottom to top also shown in fig 5 b the values of fluids velocities gradually decrease over time in the four situations the material interface does not move until the gravity boundary pressures and capillary pressure are in a balanced state i e the total downward force is equal to the total upward force 16 ρ 1 g l 1 ρ 2 g l 2 p 1 p 2 p c where l 1 and l 2 are the heights of fluid 1 and fluid 2 respectively the material interface positions in a stable state for the four situations are shown in fig 5 c which are z 0 m z 0 1 m z 0 02 m and z 0 08 m respectively the correctness can be easily validated by a balancing analysis on forces through eq 16 in this example the computation ceases when the fluid velocity is smaller than 10 5 m s 4 two phase flow through a single fracture intersection two phase flow through a single fracture intersection with different inlet and outlet configurations are analysed in this section which are divided into two cases according to whether the capillary pressure is considered or not the capillary pressure is not considered in the first case and considered in the second case 4 1 one inlet two outlets and two inlets one outlet in this section three tasks are conducted 1 an overall behavioural analysis of two phase flow through the two single fracture intersections 2 effects of parameter γ on two phase flow through a fracture intersection with two inlets and one outlet and 3 effects of boundary conditions on two phase flow through the fracture intersection with two inlets and one outlet 4 1 1 overall behavioural analysis of two phase flow through two single fracture intersections the computational model with one inlet and two outlets and the model with two inlets and one outlet are shown in fig 6 a and b respectively the left and right of the model are inlet pressure and outlet pressure boundaries respectively where pin including pin 1 and pin 2 is 1 1 kpa and pout including pout 1 and pout 2 is 0 0 kpa the fracture intersection is saturated with fluid 1 initially then fluid 2 is injected into the fracture intersection from the inlet boundary the material interfaces are 0 01 m from the left endpoints of the fracture segments at t 0 s for both computational models the fracture permeability is 1 0 10 7 m2 and the dynamic viscosities for fluid 1 and fluid 2 are 0 01 pa s and 0 001 pa s respectively for the second model two different γ are set γ 0 01 m 1 m 2 and γ m 1 m 2 total time and time step were 10 000 s and 0 1 s respectively the processes of two phase flow through the fracture intersection with different inlet and outlet configurations are illustrated in fig 7 fig 7 a is for the model with one inlet and two outlets where from t 0 00 s to t 25 12 s fluid 2 red colour flows in fracture segment 1 and reaches the intersection point at t 25 12 s subsequently fluid 2 begins to flow into fracture segments 2 and 3 at t 43 62 s fluid 2 in fracture segment 2 arrives at its right endpoint at t 56 59 s fluid 2 reaches the right endpoint of fracture segment 3 in our programme the calculation is terminated under one of the following conditions 1 the cumulative time reaches the specified time or 2 the fracture network is only saturated by the driving fluid fig 7 b and c is for the model with two inlets and one outlet where γ 0 01 m 1 m 2 and γ m 1 m 2 respectively for γ 0 01 m 1 m 2 the mixed fluid formed by fluid 1 and fluid 2 in fracture segment 3 is separated into 27 different fluids at time t 84 95 s there are 16 different fluids in fracture segment 3 for γ m 1 m 2 there are only 3 different fluids during the two phase flow process i e fluid 1 fluid 2 and the mixed fluid formed by the two fluids the variations of intersection point pressures for the two models are shown in fig 8 a and b respectively based on fig 8 a from t 0 s to t 25 12 s the intersection point pressure increases over time and at t 25 12 s i e the moment that fluid 2 red colour in fracture segment 1 arrives at the intersection point the pressure reaches its maximum value after that moment the pressure decreases over time slowly at first and then decreases rapidly over time until t 43 62 s which is the moment that fluid 2 reaches the right endpoint of fracture segment 2 from t 43 62 s to t 56 59 s the pressure variation decreases slowly over time in the beginning then decreases rapidly over time the pressure variation for the intersection point in the model shown in fig 6 b is shown in fig 8 b with γ 0 01 m 1 m 2 based on fig 8 b from t 0 00 s to t 52 40 s the pressure increases over time at t 52 40 s the pressure reaches its maximum value of 1 01 kpa at t 52 40 s fluid 2 in fracture segment 1 reaches the intersection point from t 52 40 s to t 68 47 s the pressure at the intersection point decreases over time based on fig 7 b 68 47 s is the moment that the first mixed fluid reaches the end of fracture segment 3 from t 68 47 s to t 84 86 s the pressure increases again over time subsequently the pressure at the intersection point decreases over time and reduces to 0 694 kpa 4 1 2 effects of parameter γ on two phase flow through a single fracture intersection in section 2 2 a new parameter γ is introduced to control whether a new mixed fluid is formed or not when parameter γ is small enough many new mixed fluids are formed which improves accuracy but increases the computational burden if parameter γ is large enough the number of mixed fluid decreases which improves the calculation efficiency but accuracy is lessened therefore it is necessary to discuss the effects of parameter γ on two phase flow fracture networks to select an appropriate γ for the simulation we use the single fracture intersection shown in fig 6 b as an example eight γ values are set as follows γ 1 0 01 m 1 m 2 γ 2 0 03 m 1 m 2 γ 3 0 05 m 1 m 2 γ 4 0 07 m 1 m 2 γ 5 0 09 m 1 m 2 γ 6 0 1 m 1 m 2 γ 7 0 5 m 1 m 2 and γ 8 m 1 m 2 the other necessary parameters are the same as those in section 4 1 1 during the process of two phase flow through the fracture intersection the fluid velocity variations in these fracture segments and the pressure at the intersection point for all selected γ values are shown in fig 9 based on fig 9 the defined parameter γ has little effect on the fluid velocities and pressures prior to t 68 s in this example combined with fig 7 b or c t 68 s is the moment that the first mixed fluid reaches the end of fracture segment 3 after t 68 s the parameter γ has observable effects on the fluid velocities and pressures however the pressure and velocity variation trends are similar with different γ values in our previous study we set γ m 1 m 2 to simulate two phase flow in fracture networks which is a reasonable approximation the minimum value of γ with which there are only three fluids i e fluid 1 fluid 2 and one mixed fluid is defined as the critical value of γ based on the figures the critical value of γ is between 9 0 10 6 and 4 5 10 5 because there are no differences in velocity and pressure variations when γ 4 5 10 5 from fig 9 a b c and d the following phenomena are observed 1 the fluid velocities do not increase with the increase of parameter γ until γ reaches its critical value 2 the pressures at the intersection point do not decrease with the increase of γ until γ reaches its critical value 3 after the critical γ value is reached the parameter has no effects on the two phase flow behaviour and 4 before the critical value of γ is reached the larger the value of γ the smaller the pressures are and the larger the velocities are taking γ 9 0 10 7 for example and comparing fig 9 a and b we find an interesting phenomenon from t 0 s to t 52 40 s the pressure gradient decreases over time in fracture segment 1 because of the pressure increase at the intersection point but the velocities in this fracture segment increases over time this is because the fluid velocities are not only related to the pressure gradient but also the fluid mobility although the pressure gradient decreases over time the reduction is not enough to decrease the fluid velocities because the driving fluid has higher mobility than the driven fluid 4 1 3 effects of boundary conditions on two phase flow through the fracture intersections with two inlets and one outlet the model shown in fig 6 b is taken as an example in which two different situations are considered 1 fluid 2 drives fluid 1 and 2 fluid 1 drives fluid 2 the dynamic viscosities of fluid 1 and fluid 2 are 0 01 pa s and 0 001 pa s respectively namely the mobility of fluid 1 is smaller than that of fluid 2 the permeability of each fracture segment is 1 0 10 7 m2 in this section pin 1 1 1 kpa and pout 0 kpa for the first situation pin 2 0 1 kpa 0 3 pa 0 5 kpa 0 6 kpa 0 7 kpa 0 9 kpa and 1 0 kpa for the second situation pin 2 0 1 kpa 0 3 kpa 0 5 kpa 0 6 kpa 0 7 kpa and 0 9 kpa the material interfaces in fracture segments 1 and 2 are 0 01 m and 0 3 m from the left endpoint of the fracture segments at t 0 s respectively during the process of two phase flow through the single intersection the pressure variations at the intersection point and fluid velocities in fracture segment 2 for the first situation are shown in fig 10 a and b respectively the pressure and velocity variations for the second situation are shown in fig 10 c and d in fig 10 a and c lines with symbols represent the intersection point pressure short dashes represent boundary pressure of fracture segment 2 pin 2 in fig 10 b and d short dashes represent the velocity of fracture segment 2 as 0 m s based on fig 10 a when pin 2 0 1 kpa 0 3 kpa and 0 5 kpa the intersection point pressures are always larger than the corresponding pin 2 accordingly the fluid velocities in fracture segment 2 flow from right to left during the process i e negative when pin 2 0 6 kpa 0 7 kpa and 0 9 kpa the intersection point pressure is smaller than the corresponding pin 2 in the beginning as the process continues the pressures become larger than the corresponding pin 2 after a period of time the pressures once again become smaller than the corresponding pin 2 thus for pin 2 0 6 kpa 0 7 kpa and 0 9 kpa the fluid velocities in fracture segment 2 are positive at first then become negative and later become positive again which are shown in fig 10 b when pin 2 1 0 kpa the pressures at the intersection point are always smaller than 1 0 kpa thus the velocities in fracture segment 2 are always positive from fig 10 c it can be found that when pin 2 0 6 kpa 0 7 kpa and 0 9 kpa the pressure at the intersection point are always smaller than corresponding pin 2 accordingly the fluids velocities in fracture segment 2 are positive when pin 2 0 1 kpa 0 3 kpa and 0 5 kpa the pressure at the intersection point is larger than the corresponding pin 2 in the beginning with the increase of time the pressures start to be smaller than corresponding pin 2 after a period of time the pressures are larger than the corresponding pin 2 again for pin 2 0 1 kpa 0 3 kpa and 0 5 kpa the fluids velocities in fracture segment 2 are negative at first then positive later negative again as shown in fig 10 d note that when pin 2 0 1 kpa the pressures at the intersection point are almost always larger than 0 1 kpa thus the velocities in fracture segment 2 are always negative comparing fig 10 a and c one can also see that for the first situation the range of pin 2 is 0 5 kpa 1 0 kpa under which the direction of fluids flow in fracture segment 2 would change while for the second situation the range of pin 2 is 0 1 kpa 0 5 kpa 4 2 two phase flow through a fracture intersection with one inlet and multi outlets in this section two phase flow through a single fracture intersection with one inlet and multi outlets is conducted with consideration of capillary pressure and gravity the study includes 1 the overall behavioural analysis of the two phase flow through the fracture intersection 2 effects of capillary pressure on the two phase flow through the fracture intersection and 3 effects of both gravity and capillary pressure on the two phase flow through the fracture intersection 4 2 1 overall behavioural analysis of the two phase flow through the fracture intersection the computational model for the fracture intersection with one inlet and multi outlets is shown in fig 11 a there are 10 fracture segments 1 main fracture segment and 9 branching fracture segments the left and right boundaries of the model are pressure boundary conditions which are 10 0 pa and 0 0 pa respectively the fracture intersection is initially saturated with fluid 1 then fluid 2 is injected into the fracture intersection from the left boundary the material interfaces are 0 01 m from the left end of the fracture segment1 at t 0 s the permeability of the fractures is 2 0 10 5 m2 the dynamic viscosities for fluids 1 and 2 are 0 001 pa s and 0 0001 pa s respectively the capillary pressure between the two fluids is 5 pa the initial time step is 0 1 s the process of two phase flow through the fracture intersection is illustrated in fig 12 a based on fig 12 a from t 0 0000 s to t 0 7408 s fluid 2 red colour flows in fracture segment 1 and reaches the intersection point at t 0 7408 s subsequently fluid 2 begins to flow into branching fracture segments 2 3 4 5 and 6 at t 4 9178 s fluid 2 in fracture segment 2 arrives at its right endpoint later the fluids in all the fracture segments continue to flow from left to right and at t 5 1746 s fluid 2 in fracture segment 3 reaches its endpoint after that the fluids in fracture segments 4 5 and 6 begin to flow from right to left which is shown in fig 12 a at t 17 9646 s the fluid distribution in the fracture intersection in a stable state is shown at t 40 0003 s in fig 12 a during the process the fluid velocities vary in each fracture segment which are presented in fig 12 b1 based on fig 12 b1 the variations are obvious from t 0 s to t 7 0 s and from t 31 s to t 32 s to analyse the fluid velocity variations in each fracture segment in detail two partial enlarged drawings are presented in fig 12 b2 and b3 which cover the periods from t 0 to t 7 0 s and t 31 s to 32 s respectively based on fig 12 b2 from t 0 s to t 0 7408 s the fluid velocity in all fracture segments are positive and increase over time from t 0 7408 s to t 4 9178 s all fluid velocities are positive and the fluids velocities in fracture segments 1 2 and 3 obviously increase while the fluid velocity variations in fracture segments 4 5 and 6 are not obvious at t 4 9178 s the fluid velocities in all fracture segments change suddenly the velocities in fracture segments 1 and 2 increase suddenly and in fracture segments 4 5 and 6 decrease suddenly this because there is capillary pressure in fracture segment 2 from t 0 7408 s to t 4 9178 s after t 4 9178 s the capillary pressure in fracture segment 2 disappears from t 4 9178 s to t 5 1746 s the velocities in fracture segments 1 and 3 slightly increase in fracture segment 2 slightly decreases and in fracture segments 4 5 and 6 show no obvious changes in addition the fluid velocities in all fracture segments are positive during this period fluid velocity changes suddenly again in all fracture segments at t 5 1746 s because of the capillary pressure disappearance in fracture segment 3 at this moment the velocities in fracture segments 1 and 3 increase suddenly and in fracture segments 2 4 5 and 6 decrease suddenly it is noteworthy that the velocities in fracture segments 4 5 and 6 become negative combining fig 12 a from t 5 1746 s to t 17 9646 s one can see that the fluids in fracture segments 4 5 and 6 moves from right to left after t 5 1746 s the velocities in all fracture segments show no obvious changes until t 31 2246 s when fluid 2 in fracture segments 3 4 and 5 flows back to the intersection point as shown in fig 12 b3 after t 31 2246 s all velocities have a slight vibration the reason of this phenomenon is as follows when the fluid 2 is in fracture segments 3 4 and 5 the velocities are always negative since t 5 1746 s however once a material interface in fracture segments 3 4 or 5 reaches the intersection point the fluid velocity in this fracture segment becomes positive instantly again thus the result is the reciprocating motion of the fluids near the intersection point of fracture segments 4 2 2 effects of capillary pressure on two phase flow through the fracture intersection in this section we aim to investigate the capillary pressure effects on two phase flow through the fracture intersection computational model initial conditions boundary conditions and the hydraulic properties of fractures and fluids are the same as those in section 4 2 1 four different capillary pressures between the two immiscible fluids are set which are pc 1 pa pc 3 pa pc 7 pa and pc 9 pa the fluid distribution in the single fracture intersection for all four situations in a stable state are shown in fig 13 different capillary pressures have different effects on fluid flow and fluid distribution in a stable state for the first situation since the capillary pressure is smaller fluid 2 displaces fluid 1 from left to right during the whole process and the fracture intersection is saturated with fluid 2 in the end which is shown in fig 13 a for pc 3 pa fluid 2 drives fluid 1 from left to right until the moment that fracture segments 2 3 4 and 5 are saturated with fluid 2 subsequently the fluids in fracture segment 6 begin to flow in opposite direction until fluid 2 flows back to the intersection point which is shown in fig 13 b when pc 7 pa the fluids flow from left to right from the initial time to the moment when fluid 2 reaches the right endpoint of fracture segment 2 then the fluid velocities in all fracture segments suddenly drop to 0 m s fig 13 c shows the fluid distribution in a stable state in the fracture intersection for pc 7 pa for the fourth situation because of the larger capillary pressure pc 9 pa when fluid 2 reaches the right endpoint of fracture segment 2 the fluids in fracture segments 3 4 5 and 6 become backflow and reach a stable state when fluid 2 in these fractures segments reaches the intersection point which is shown in fig 13 d 4 2 3 effects of both gravity and capillary pressure on two phase flow through the fracture intersection in this section both gravity and capillary pressure are considered to investigate the two phase flow through the fracture intersection the computational model considering gravity force and the number for each fracture segments are shown in fig 11 b the left and right boundaries of the model are also pressure boundary conditions which are 10 0 kpa and 0 0 kpa respectively the permeability of the fractures is 1 0 10 8 m2 the densities for both fluids are 500 kg m3 the dynamic viscosities for both fluids initial conditions and the time step are the same as those in section 4 2 1 to investigate the effect of capillary pressure on two phase flow in the fracture intersection under gravity two situations are considered 1 pc 500 pa and 2 pc 0 pa the processes for both situations are illustrated in fig 14 fig 14 a is for the first situation pc 500 pa and fig 14 b is for the second situation pc 0 pa comparing the two processes they have the same characters before fluid 2 reaches the right endpoint of fracture segment 8 as follows 1 chronologically fluid 2 reaches the right boundary of this model in the order of fracture segments 5 3 7 9 2 4 6 and 8 2 due to the gravity effect the fluids in fracture segments 3 5 7 and 9 move faster than the fluids in fracture segments 4 6 8 and 10 however after that moment the behaviours of the two phase flow in the fracture intersection are different for each situation fluid 2 in fracture segment 10 begins to flow from right to left for the first situation and fluid 2 in this fracture segment continues to flow from left to right for the second situation 5 two phase flow in a fracture network in this section the developed nmm was adopted to analyse two phase flow in a fracture network the original computational model is shown in fig 15 a fig 15 b shows the fracture network without isolated and dead fracture segments the top and bottom of the domain are impermeable boundaries and the left and right sides are inlet pressure boundary with p 1 1 1 mpa and outlet pressure boundary with p 2 0 0 mpa respectively the fracture network is saturated with fluid 1 at the initial time and then fluid 2 is injected from the inlet boundary of the model the material interfaces between the two fluids are 0 01 m from the left end of the fracture segments at t 0 s the permeability of the fractures is 1 0 10 8 m2 and the dynamic viscosities for fluids 1 and 2 are 0 0001 pa s and 0 001 pa s respectively the gravity and capillary pressure between the two fluids were not considered in the study parameter γ 0 1 m 1 m 2 the total time and time step were set to 10 000 s and 0 1 s respectively the process of two phase flow in the fracture network is shown in fig 16 we select only 12 typical pictures from t 0 s to t 126 08 s the grey colour represents fluid 1 and the red colour represents fluid 2 in fig 16 the mixed fluid is indicated by the colour as follows 17 m i x e d f l u i d g r a y s 1 r e d s 2 where s 1 and s 2 indicate fluid 1 and fluid 2 concentrations in a mixed fluid respectively from fig 16 we find the following phenomenon 1 the direction of fluid velocities in some fracture segments may change such as fracture segment 70 there is an obvious material interface in the fracture segment which is close to the lower endpoint at t 0 49 s while at t 1 59 s the former material interface disappears and another material interface appears which is close to the upper endpoint later the material interface flow moves from the upper to lower endpoints fig 17 a shows that the pressures of the lower endpoint are larger than those of the upper endpoint from t 0 0 s to t 0 47 s thus the fluids in fracture segment 70 flow from the lower to upper endpoints during this period after t 0 47 s the pressure of the lower endpoint is smaller than that of the upper endpoint and the fluids in this fracture segment flow from the upper to lower endpoints 2 the fluids in some fractures are no flow or nearly no flow at some time such as fracture segment 82 the driving fluid i e fluid 2 hardly enters this fracture segment from t 0 11 s to t 0 49 s fig 17 b shows the pressure variations of the lower and upper endpoints of fracture segment 82 and the pressures at the two endpoints are approximately equal from t 0 00 s to t 0 49 s after t 0 49 s the pressure at the upper endpoint become larger than that at the lower endpoint and the fluid begins to enter fracture segment 82 from its upper endpoint 3 the above phenomena all take place in vertical fracture segments of the fracture network because they are perpendicular to the direction of the maximum pressure gradient moreover the variations of concentrations of fluid 2 driving fluid in the domain and at the outlet boundary caused by different boundary pressures are discussed different inlet pressures are set pin 0 1 mpa 0 5 mpa 0 8 mpa 1 1 mpa the outlet pressure is fixed value with pout 0 mpa the variations of concentrations of fluid 2 in the domain and at the outlet boundary with time under different inlet pressure are shown in fig 18 because the curves for the variations of concentrations of fluid 2 at the outlet boundary are non smooth an exponential function is adopted to fit the curves the fitting equations are also shown in fig 18 from the figure one can see that except the fluid velocities the variations of concentrations of fluid 2 in the domain and at the outlet boundary have the same features for the above model under different inlet pressures 1 during the displacement process the concentrations of fluid 2 in the domain increase with time and tend towards stability 2 in the beginning the concentrations of fluid 2 at the outlet boundary is less than that in the domain while with time increase the former is gradually larger than the latter 3 the concentrations of fluid 2 is approximately equal at the moment when the concentrations of fluid 2 in the domain and at the outlet boundary are equal 4 the concentrations of fluid 2 in the domain are also approximately equal at breakthrough time of fluid 2 the reason causing this phenomenon is the assumption of darcy s law under which the relationship between fluid velocity and pressure is linear thus the pressure distribution along the fracture segments occupied by fluid 1 fluid 2 or a mixed fluid is linear as shown in the governing equation of segmented two phase flow eqs 1 and 9 when changing the inlet pressure the pressure gradient in each fracture segment increases and decreases in equal proportion 6 conclusions in this study a systematic segmented two phase flow analysis in fracture networks based on the numerical manifold method has been presented with consideration of capillary pressure and gravity effects the following main conclusions are drawn 1 for the model with one inlet and two outlets when the driving fluid reaches the intersection point it flows into the other two fracture segments however for the model with two inlets and one outlet mixed fluids might be formed the pressure variations at the intersection point for the two models are different 2 the smaller parameter γ is the more the numbers of mixed fluids are for two phase flow through a fracture intersection with two inlets and one outlet parameter γ has little effects on the fluid velocities and pressures before the first mixed fluid in fracture segment 3 reaches its end after that the parameter has observable effects on these terms however the variation trends of pressures and velocities are similar with different γ values 3 for two phase flow through a single fracture intersection fluid velocity directions in a fracture segment might change which is affected by pressure boundary conditions in the fracture segment as well as the mobilities of the driving fluid and driven fluid when the mobility of the driving fluid is larger than that of the driven fluid the pressures under which the direction of fluid flow changes are larger than those for the reverse situation 4 the capillary pressure between two fluids vanishes when the material interface moves to outside of a fracture which causes a sudden change of fluid velocities in all fracture segments such as a sudden increase sudden decrease or a direction change 5 the pressures at the intersection points are variable during the process of two phase flow in fracture networks the pressures result in the fluids in some fracture segments have no flow or almost no flow at some time and the fluid velocity directions may change in some fracture segments 6 for a horizontal fracture network regardless of capillary pressure the variations of concentrations of fluid 2 in the domain and at the outlet boundary have the same features and the concentration of each fluid in the domain is also approximately equal at the breakthrough time of driving fluid under different inlet pressures acknowledgement the research is supported by the national natural science foundation of china nsfc nos 11572282 51778021 51627812 and 51778029 and china scholarship council csc no 201706540014 
749,in the past decade shallow water solvers have dramatically improved both in terms of accuracy and computational power new mathematical models and numerical schemes have been systematically verified against 1d exact solutions and laboratory experiments despite the two dimensional nature of some of these benchmark tests none of them reports complete 2d water depth fields but only a few profiles are measured and reported in the best case this work reports a new benchmarking dataset for validation of shallow water solvers in which two dimensional transient water depth measurements are available for complex steady and transient laboratory flume experiments ranging from transcritical steady flow to dam break flows around obstacles and complex beds the transient water surface was measured using a commercial grade rgb d sensing device which allows to capture a succession of color coded point clouds at a high frequency these experimental measurements are compared with 2d shallow water simulations carried out with an extensively tested finite volume solver results asses the suitability of this dataset to perform as benchmark tests identifying potential limitations of current and future models keywords finite volumes shallow water equations 3d sensing rgb d sensor transient free surface flow 1 introduction shallow water solvers have received wide attention in the past decade resulting in a new generation of robust and efficient models garcía navarro 2016 hinkelmann et al 2015 in the search for large scale and long term computations of complex transients on both natural and man made environments shallow water models have been extensively benchmarked against test cases which are widespread in the literature the solvers have been systematically verified against analytical solutions for simplified problems delestre et al 2013 fernández pato et al 2018 macdonald et al 1997 murillo and garcía navarro 2012 in addition they have also been validated against laboratory experiments briggs et al 1995 fraccarollo and toro 1995 hiver 2000 kocaman and ozmen cagatay 2015 liu et al 2008 ozmen cagatay et al 2014 ratia et al 2014 soares frazão and zech 2007 2008 testa et al 2007 velickovic et al 2016 as well as some well documented real scale field cases caviedes voullième et al 2012 fernández pato et al 2016 hervouet and petitjean 1999 more recently the experimental literature continues to report transient shallow flows though with an added interest on sediment transport and moving beds carrivick 2010 carrivick et al 2011 juez et al 2017 soares frazão et al 2012 spinewine and capart 2013 swartenbroekx et al 2013 despite the two dimensional nature of some of the aforementioned benchmark tests none of them reports 2d transient water surface elevations at best transient data along a few profiles are reported and more often transient data are only reported at a few points moreover in field cases fully transient data are seldom available well established instruments such as pressure gauges hiver 2000 soares frazão and zech 2008 ultrasonic gauges carrivick et al 2011 goutiere et al 2011 soares frazão et al 2012 velickovic et al 2016 and electrically resistive rods creëlle et al 2018 have been often used to measure water depth evolution at discrete points however in order to capture a 2d transient field too many of these instruments would be required making the experimental setup cumbersome impractical and expensive without still really achieving high spatial resolution in 1d flumes this problem has been solved by using longitudinal imaging carrivick et al 2011 fent et al 2018 kocaman and ozmen cagatay 2012 2015 ozmen cagatay et al 2014 in some cases piv plif techniques have been used to obtain velocity fields bento et al 2017 muste et al 2014 soares frazão and zech 2008 additionally in experimental fluid mechanics measuring the evolution of a free surface has received little attention as it has been mainly understood as a problem for shallow water flows and more recently for free surface granular flows caviedes voullième et al 2014 pouliquen and forterre 2002 wieland et al 1999 as numerical models have become more sophisticated more complex flow phenomena can be in principle accurately simulated perhaps some of the most challenging are fast transcritical transients over complex topography and obstacles these are flows of great interest in civil engineering urban flooding and risk management in general costabile and macchione 2015 it is therefore highly relevant to formally verify that numerical models can indeed reproduce such flow phenomena the lack of 2d transient experimental measurements generates a gap in model validation the unavailability of 2d transient datasets comes from the inherent difficulty of measuring a fast moving water attempting to fully cover the flow field this is a task for which optical methods are best suited refraction based reconstructions daida et al 1995 engelen et al 2018 morris 2004 stereophotography based measurements daida et al 1995 evers and hager 2015 morris 2004 zou et al 2016 photogrammetry based methods d odeigne et al 2018 franzini et al 2016 although restricted to steady flows light absorption methods aureli et al 2014 2010 stereo correlation chatellier et al 2013 stereo refraction gomit et al 2013 and twin camera refraction analysis of reflected laser light and piv ng et al 2010 have all been tested in attempts to capture moving water surfaces each with their inherent drawbacks on requiring projected referenced grids specific lighting sophisticated and expensive equipment and technical challenges in their setup and processing recently a wide range of low cost 3d sensors have appeared as a consequence of the videogame industry development which are henceforth termed rgb d red green blue depth sensors the original devices carmine released by primesense and kinect released by microsoft in 2010 were designed to capture human body movements for interaction with video games the massive size of the videogame market enabled these sensors to be developed and mass produced at a per unit cost far below that of time of flight tof cameras with comparable aquisition frequencies these low cost sensors were quickly adapted to new applications such as interactive 3d modelling of indoor environments du et al 2011 autonomous flight huang et al 2017 fluid dynamics measurements berger et al 2014 or simultaneous location and mapping izadi et al 2011 the early rgb d devices were based on the structured light principle this approach is an active stereo vision technique a set of known patterns sequentially projected onto an object gets deformed by the geometric shape the object is then observed with a camera from a different direction by analysing the distortion of the observed pattern i e the disparity from the original projected pattern depth information can be extracted metrological studies have extensively documented the accuracy and usability ranges for such devices gonzález jorge et al 2013 2015 sarbolandi et al 2015 showing that the depth accuracy of rgb d sensors strongly depends on the distance to the measured objects decreasing quadratically at a short range 4 6 m gonzález jorge et al 2013 on the other hand low cost tof based sensors such as kinect2 perform better for most of the indoor conditions gonzález jorge et al 2015 stoyanov et al 2013 compared the kinect device to several tof devices in a robotic vision context concluding that they all deliver similar framerates and that both the kinect and some tofs achieve lower depth accuracy than high grade industrial instruments although the kinect outperformed some tof systems in the short ranges horaud et al 2016 tested several tof devices reporting their maximum framerates which range between 30 and 60 fps putting the kinect sensor in the lower end of acquistion rates of tof cameras when capturing complex objects lachat et al 2015 showed that low cost rgb d sensors are below the accuracy of standard photogrammetry tools together with other limitations in terms of field of view hämmerle et al 2014 compared a kinect sensor to a lidar device when capturing 3d cave features noting again that the kinect underperforms compared to lidar though still highlighting its ease of use and very low cost compared to the high end instruments altogether the literature suggests that the main limitations of rgb d devices are depth accuracy as compared to tof or laser ranging devices and their relatively short operational range of distances additional practical limitations have been identified such as limited capability to measure on surfaces with low reflectivity dal mutto et al 2012 langmann et al 2012 although this has also been reported to be an issue for some industry grade tof sensors kahn et al 2013 or infrared absorbing surfaces mankoff and russo 2013 excessive background illumination dal mutto et al 2012 high ambient infrared mankoff and russo 2013 and the inability to capture data from surfaces nearly parallel to the optical axis dal mutto et al 2012 langmann et al 2012 moreover because of their extended use and their low cost manufacturing these devices suffer from technical issues such as low thermal stability g guidi 2016 mankoff and russo 2013 although arguably the errors introduced may be acceptable for many applications in contrast it has been argued that tof devices may suffer from motion artifacts if there is indeed movement in the images relatively low resolution they are more expensive and require somewhat more power setup and equipment to operate kahn et al 2013 langmann et al 2012 stoyanov et al 2013 the obvious advantage of rgb d sensors compared to conventional stereo vision cameras and time of flight sensors is clearly their very affordable cost which makes them an attractive tool for many researchers despite the aforementioned limitations researchers have obtained results of enough accuracy using these sensors in applications such as coastal mapping butkiewicz 2014 soil and sediment characterisation chávez et al 2014 marinello et al 2015 thomsen et al 2015 indoor ambient reconstruction khoshelham and elberink 2012 plant phenotyping and sizing hämmerle and höfle 2016 paulus et al 2014 wang et al 2017 and to obtain dynamic measurements berger et al 2011 dutta 2012 a few pioneering studies using rgb d sensors have been reported in hydraulic or fluid mechanics applications combes et al 2011 showed the feasibility of capturing moving opaque water surfaces with a kinect device caviedes voullième et al 2014 measured the transient dynamics of a fast moving granular surface with a carmine device nichols and rubinato 2016 measured surface water gravity waves in clear water in a flume as a proof of concept that refraction can be used for such purposes in the same line klopfer et al 2017 measured submerged bathymetry with a kinect device and chourasiya et al 2017 used a kinect device to measure the movement of sediment surfaces submerged in clear water by introducing a refraction correction and to measure the breach morphologic evolution of a failed earth dam amaral et al 2018 tests have also been performed with submerged devices anwer et al 2017 the trend in the literature suggests that it is in fact possible and convenient to measure dynamic water surfaces with rgb d devices by capturing a seeded flow motion of the water surface or by creating an opaque flow evers and hager 2015 in the light of this we present a novel set of transient free surface water flow experiments with complex geometries with flow conditions ranging from steady transcritical flows to dam break cases in all cases we report the 2d temporal evolution of the water surface captured by means of a commercial grade rgb d device measuring opaque water two different sensors were used in this set of tests a primesense carmine 1 09 and a microsoft kinect for windows sdk 1 8 the aim of the study is to provide a novel and accessible experimental transient water surface dataset it can serve as benchmark test for current and future generations of 2d shallow water models both to validate their capabilities and help identify the next set of challenges to be solved we also point out that this is the first application to the authors knowledge of rgb d sensors for the measurement of complex transient shallow water dynamics the paper is organised as follows the description of the experimental setup and methods hydraulic setups and postprocessing procedures are presented in section 2 section 3 is devoted to the mathematical model used in this paper to provide a quantitative characterisation of the data set capability to work as benchmarking tool as well as the model calibration section 4 reports the experimental results where the main features observed in the measured 2d water depth fields for each test are described and compared with the numerical predictions finally in section 5 some conclusions are drawn 2 experimental tests program 2 1 experimental setup and methods the experiments were performed on a 6 m long rectangular cross section 240 150 mm plexiglass flume connected to an upstream reservoir in the channel reach of interest the slope was designed to be zero although measurements reveal a slope of 0 00092 m m in the first 326 cm downstream a bed kink leads to a flume slope of 0 0404 m m so as to force supercritical flow downstream the measurement region fig 3 a closed circuit allows to establish steady state flow in the flume and a pneumatically actuated gate in the upstream boundary allows to generate dam break conditions with different water elevations in the upstream reservoir the downstream boundary was always a free outfall into a recirculation tank a number of obstacle configurations were placed in the flume which combined with different steady inflows or dam break conditions generated complex 2d water surfaces the water surfaces were recorded using a consumer grade rgb d sensor the device was suspended 0 7 m above the flume a good compromise between field of view 2d resolution millimeters per pixel and depth accuracy caviedes voullième et al 2014 gonzález jorge et al 2013 khoshelham and elberink 2012 a generic setup is shown in fig 1 the different experiments were measured using two different sensors primesense carmine 1 09 and microsoft kinect for windows sdk 1 8 both devices provide a sequence of 640 480 px rgb depth coded images in short the devices project standard structured light sl into an infrared pattern by means of nir laser diode at 850 nm wavelength onto the objects the apparent pattern deformation due to the position and shape of the objects is recorded by a monochrome nir camera observing from a slightly different angle the apparent deformation allows the devices to produce in hardware a depth map for the vga image the device streams both the rgb and depth coded vga images they were recorded with skanect on a laptop computer with a frame rate of 30 fps approximately however actual acquisition frequency depends on additional processes which are computer dependent ranging from hardware limitations mainly regarding sufficient memory to buffer the streams and disk dumping speed to os prioritised processes it should be noted that for our rather short experiments the memory buffer was sufficient 32gb and data were dumped onto a solid state drive to maintain the highest speed possible nonetheless in practice the streams were captured with frame rates from 10 to 30 fps captured images were timestamped with millisecond resolution from which it was possible to study acquisition frequency and lost frames therefore did not affect the time line reconstruction it is important to note that these devices need a pre heating time before providing reliable range measurements mittet et al 2013 the sensors were turned on about 30 min before the beginning of the measurements and left on during the full session for transient cases it is of particular interest to register the gate actuation time this was done by placing a led on the flume structure within the field of view of the rgb d sensor the led was switched on when the gate was actuated allowing to register the time of gate actuation and the duration of gate opening or gate closing the led lighting was detected in the image by a matlab script which then time stamped the image sequence accordingly in order to easily georeference the flume section and the location of the obstacles six spatial reference points were placed on the flume structure within the field of view of the sensors three points at each side of the flume the devices used project a sl pattern which in order to observe the water surface needs to be reflected by it the transparent nature of water does not allow for this a simple solution is to tint water until it is opaque and reflects the pattern at the surface a proof of concept of this was reported by combes et al 2011 and used with stereophotography by evers and hager 2015 in the present work water was tinted with titanium oxide tio2 at a concentration of 1 2 in mass the tio2 was previously mixed with the canal water then the tinted water was recirculated avoiding deposition the required concentration was very small so that the fluid density did not change this allows to reflect the pattern off the water surface thus not requiring reflection corrections as proposed by nichols and rubinato 2016 chourasiya et al 2017 it also has the advantage that the white color of the water allows for visual color contrast with the obstacles and channel bed in addition to the transient flow surfaces the flume bed and obstacles were also captured with the rgb d in a dry condition to completely characterise the channel bed within the field of view 2 2 tested cases four different geometrical configurations were set using a floor bump 20 1 cm radius 31 24 cm footprint 7 3 cm maximum height lateral venturi constriction elements 20 1 cm radius 31 cm long 15 cm height and 7 3 cm maximum width a rectangular obstacle 16 3x8 0x7 0 cm and a bridge structure the reason to choose them was the best compromise between the possibilities offered by our experimental canal and the necessity to force flow situations of sufficient variability all elements except the bridge structure were constructed out of pvc the bridge structure was constructed from styrene sheets the four configurations are next presented 1 g1 rectangular obstacle placed at the center line of the flume as shown in fig 2 2 g2 floor bump across the entire flume width followed by a rectangular obstacle placed at the center line of the flume as shown in fig 3 3 g3 venturi narrowing and a rectangular obstacle downstream as shown in fig 4 4 g4 bridge structure with two arches the arches were 8 cm wide and 5 cm high at the center downstream the bridge two slender rectangular obstacles were placed one of them following the flume center line 19 2 1 0 3 5 cm and the other obliquely to the flume wall 9 5 1 5 5 0 cm and 21 o respect to the flume wall as shown in fig 5 the aforementioned geometry configurations were used for various steady and unsteady flow conditions which are summarised in table 1 totalizing eleven experimental tests steady cases were performed setting a constant discharge in the flume for dam break cases the reservoir was filled to a height h 0 above the flume floor then the gate was suddenly open and the water free surface was captured with the variable frequency provided by the rgb d sensor the gate opening time was determined from the indicator led light placed in the sensor view area and it was set as the initial time for measurements 2 3 post processing the raw data recorded with skanect were treated with an ad hoc c code based on the open sourced pcl library together with an ad hoc matlab script the raw depth maps were processed into 3d point clouds and then projected into a constant 2d structured grid a raster essentially in order to obtain operable data sets for the free surface elevation for steady cases the discharge in the channel was controlled and the obtained 2d water depth fields were averaged in time in unsteady cases a dam break wave moves through the initially dry measurement area the temporal evolution of the water free surface field showed the formation and development of complex two dimensional transient structures for steady flow cases the reported water surfaces were determined from averaging 60 images of the sequence water depths were determined for all cases by substracting the topography surface containing the flume bed and obstacles from the water surface averaged in steady cases instantaneous in transient cases 3 mathematical model and numerical scheme 3 1 mathematical model in this paper surface flow is modelled using the 2d shallow water equations saint venant 1871 vreugdenhil 1994 which can be written as 1 u t f u x g u y h s where 2 u h q x q y t are the conserved variables being h l the water depth and q x h u and q y h v the unit discharges l t along the x and y coordinates respectively with u and v the depth averaged components of the velocity vector u l t the fluxes associated to these conserved variables are 3 f q x q x 2 h 1 2 g h 2 q x q y h t g q y q x q y h q y 2 h 1 2 g h 2 t where g l t 2 is the gravity acceleration the source terms on the right hand side of the system are split into two kind of terms depending on the nature of the source the term s represents the friction and it is defined as 4 s 0 g h s f x g h s f y t where sfx sfy are the friction slopes in the x and y direction respectively here expressed in terms of the manning s roughness coefficient n t l 1 3 5 s f x n 2 u u 2 v 2 h 4 3 s f y n 2 v u 2 v 2 h 4 3 the term h accounts for the variation of the pressure force along the bottom in both x and y directions it is formulated in terms of the bed slopes of the bottom level z l 6 h 0 g h z x g h z y t eq 1 are a depth averaged model that is only valid under the assumption of negligible vertical accelerations and therefore is associated to a hydrostatic pressure distribution however it represents a widespread formulation in hydraulic engineering system 1 is non linear time dependent and contains several source terms it can be included into the family of hyperbolic systems under the hypothesis of dominant advection among the mathematical properties of 1 is the existence of a jacobian matrix jn of the flux in the outward normal direction given by the unit vector n e n f n x g n y murillo and garcía navarro 2010 defined as 7 j n e n u f u n x g u n y 3 2 numerical scheme the numerical resolution of system 1 can be obtained by means of a first order upwind finite volume scheme the system of equations 1 can be written in a compact way 8 u t e h s where e f g integrating in a volume or grid cell ω 9 d dt ω u d ω ω e d ω ω h s d ω d dt ω u d ω c e n dc ω h s d ω where n is the outward normal direction e n is the normal flux and c denotes the contour surrounding the cell ω assuming a piecewise discretisation of the conserved variables 9 can be expressed as follows 10 d d t ω u d ω k 1 n e δ e t k n k l k 0 where δ e k e j e i and e i is the value of the flux e evaluated at cell i being i j the indexes of the cells sharing this edge k moreover n k n x n y k is the outward normal vector to the cell edge k ne indicates the number of edges in cell i and lk is the length of edge k the source terms are also associated to the edges defining t k as follows 11 ω h s d ω k 1 n e t n k n with 12 t n k n 0 g h δ z g h s f n n x g h δ z g h s f n n y k it is possible to define a jacobian matrix j k of the normal flux at each edge to implement a local linearisation 13 δ e n k j k δ u k and to diagonalize it in terms of matrices λ and p formed by its eigenvalues λ m and eigenvectors e m respectively 14 λ λ 1 0 0 0 λ 2 0 0 0 λ 3 p e 1 e 2 e 3 e 1 1 u c n x v c n y e 2 0 c n y c n x e 3 1 u c n x v c n y λ 1 u n c λ 2 u n λ 3 u n c where u n u n x v n y and c is average celerity the definition of the averaged variables is as follows 15 u k u i h i u j h j h i h j v k v i h i v j h j h i h j c k g h i h j 2 the difference across the edge k can be projected onto the eigenvectors basis 16 δ u k u j u i p k a k m 1 3 α m e m k where a k α 1 α 2 α 3 k t contains the set of wave strengths following the same procedure with the source terms 17 t n k p k b k m 1 3 β m e m k where b k β 1 β 2 β 3 k t contains the source strengths more information about the values of the wave and the source strengths as well as the entropy fix can be found in murillo and garcía navarro 2010 combining the contributions due to the fluxes and the source terms in a compact expression 18 δ e t k n k m 1 3 λ m α m β m e m k m 1 3 γ m e m k the 2d numerical upwind explicit scheme is formulated using only the contributions that arrive to the cell 19 γ k 1 2 1 sign λ k γ k so that the finite volume approach for the updating of a single cell of area ωi from time level n to time level n 1 is 20 u i n 1 u i n δ t ω i k 1 n e m 1 3 γ m e m l k n considering that in the explicit scheme 20 each k cell edge is used to deliver information between a pair of neighboring cells of different size the time step size compatible with numerical stability is limited by 21 δ t δ t λ δ t λ min χ i χ j max m 1 2 3 λ m considering unstructured meshes the distance χi in each cell i must consider the volume of the cell and the length of the shared k edges 22 χ i ω i max k 1 n e l k the control of the numerical stability is defined by the dimensionless quantity 23 c f l δ t δ t λ 1 however this stability condition is inadequate in presence of relatively important source terms or wet dry fronts a simple generalisation of the cfl condition paying attention to the existence of the source terms or wet dry fronts can lead to extremely small values of δt various orders of magnitude smaller than the value dictated by the homogeneous condition hence rendering the method impractical this can be avoided by means of a reconstruction of the approximate solution the strategy selected is based on enforcing positive values of auxiliary quantities h i and h j respectively 24 h i h i n α k 1 β λ k 1 0 h j h j n α k 3 β λ k 3 0 so that when they become negative the numerical source term is reduced instead of reducing the time step size the numerical scheme had been previously proved well balanced and able to deal with situations of wet dry fronts and emerged topography providing stable solutions with a mass error comparable to the machine accuracy a detailed explanation can be found in murillo and navas montilla 2016 3 3 manning roughness calibration in order to properly predict the friction term influence in the flow behaviour the manning roughness coefficients n for the plexiglass flume and the pvc bed bump were calibrated in a first step five different steady inlet discharges q 1 1 17 m 3 h q 2 4 01 m 3 h q 3 7 41 m 3 h q 4 10 76 m 3 h q 5 14 06 m 3 h were set and the water depth was directly measured with a rule at different points along the flume center axis a first set of measurements was performed with a clear flume bed without any obstacles in order to estimate the plexiglass roughness coefficient then a second set of measurements was performed placing the bed bump 1 845 m downstream the gate see fig 3 and setting the same steady inflows experimental water depth values measured along the longitudinal flume center axis were compared with simulations carried out setting identical steady inflows to that of the experiments and varying the manning s roughness coefficient n for plexiglass and pvc material between 0 008 sm 1 3 and 0 012 sm 1 3 numerical results showed the best agreement with experimental water depth in the reach of the flume for a manning coefficient of 0 01 sm 1 3 for both plexiglass floor and pvc bed bump fig 6 shows the longitudinal water depth profiles with n 0 01 sm 1 3 and n 0 008 sm 1 3 for the clean plexiglass flume to justify the selection 4 experimental results 4 1 rgb d sensor validation with direct measurements as initial test case for the validation of rgb d sensor measurements a steady discharge q 11 66 m 3 h was set in the flume with the venturi narrowing placed at 214 5 cm downstream the pneumatic gate upstream the narrowing the flow was subcritical changing to supercritical at the throat downstream the narrowing a supercritical diamond shape structure appeared with small water depth values at the flume center the water depth profile along the longitudinal flume center axis was direct measured each 5 cm from x 205 cm to x 275 cm using a rule moreover the water free surface was captured with the primesense carmine 1 09 device and it was processed to obtain the steady 2d water depth field fig 7 left shows the reconstructed water free surface at the narrowing region fig 7 right depicts the water depth profile along the longitudinal flume center axis y 12 cm for the direct measurements and the rgb d sensor results relative differences in absolute value between both set of experimental data normalized by the mean flow depth upstream the narrowing are also shown in the same figure the higher differences were found downstream the venturi where the flow was supercritical and the water depth values were more limited nevertheless relative differences remained below 10 of the mean flow depth along the longitudinal profile which can be regarded as a good approximation to the directly measured results this allows us to conclude that rgb d sensors are appropriated for the accuracy requirements of the present work 4 2 centered obstacle g1 4 2 1 steady flow cases g1 s 1 g1 s 2 and g1 s 3 three different steady discharges were used q 1 5 05 m 3 h q 2 9 01 m 3 h and q 3 12 05 m 3 h with this geometrical configuration time averaged water depth fields are depicted in fig 8 experimental results showed a steady rarefaction wave generated at the upstream face of the obstacle this wave increased its height as discharge increased downstream the obstacle upstream face a complex wave structure was observed with different diagonal shock waves a symmetric wake appeared downstream the obstacle tail the position of the different waves did not show significant changes as the discharge increased numerical simulations fig 8 right predicted with an acceptable accuracy the flow structure observed in the experiments especially the upstream frontal rarefaction wave and the diamond wake configuration some differences were found at both sides of the centered obstacle where the numerical model predicted a slightly different flow configuration since the transverse shock wave at both sides of the obstacle appeared slightly upstream in the numerical prediction than in the experimental measurements also it can be observed that the water flow surface at the final section is not well reproduced by the numerical model a comparison of measured and simulated water depth profiles along the two longitudinal axis y 0 12 m and y 0 20 m of the flume and two cross sections x 2 10 m and x 2 30 m is depicted in fig 9 larger differences are observed in the obstacle wake close to the field of view limit region and in the immediate neighbourhood of the obstacle it should be stressed that in the field of view ending region the numerical model was able to predict reasonably well the hydraulic jump locations but the water depth was underestimated especially along the longitudinal y 0 20 m the possibility to obtain any water depth profile depending on the modeller requirements is one of the main advantages of the reported experimental data set compared with other existing benchmarking tests the relative differences between experimental and simulated water depth normalized by the mean flow depth upstream the obstacle region along the longitudinal profile y 0 12 m and cross section x 2 10 m are also shown in fig 10 the relative depth difference was higher at the wake center and close to the obstacle s lateral faces this difference always remained below 20 in the wake region but it increased close to the downstream end of the field of view where the measurements may be affected by an excessive optical angle and the reduced flow depth sarbolandi et al 2015 the cross section profile at x 2 10 m showed relative differences below 10 far from the obstacle s sides but it increased close to them 35 this increment was mainly caused by the disagreement in the oblique shock wave position between experimental measurement and numerical prediction as it was commented above experimental errors exist around the obstacle sides due to shading and high sloping water surfaces this is due to having a single sensor with a vertical optical axis meaning that certain regions around obstacles and vertical surfaces are occluded this can of course be alleviated by placing more sensors with different fields of view and perhaps different optical axis simulated results may also be inaccurate due to shallow water model assumptions breaking in the immediate neighborhood of the obstacle moreover the lack of symmetry in the numerical profiles is due to the use of an unstructured triangular mesh in summary high errors in such close range of the obstacle are to be expected and are difficult to attribute solely to either experimental or numerical issues 4 2 2 dam break flow case g1 d 1 a dam break case was performed in the flume by setting an initial water depth upstream the boundary gate of h 0 5 5 cm above the flume bed the gate was suddenly opened and the actuation time t 0 was captured by the indicator led light the time necessary to open the gate was 500 ms approximately fig 11 shows a time sequence of the 2d water depth field for the kinect data left column and the numerical results right column the dam break wave propagated downstream through the flume reach of interest until it reached the centered obstacle at t 2 6 s a shock wave developed upstream the obstacle initially increasing its depth with time the shock wave bended symmetrically around the obstacle taking a slightly curved shape concave in the downstream direction t 3 051 s which later developed into a downstream oriented diagonal front upstream the obstacle the shock wave developed into a hydraulic jump fully perpendicular to the main flow direction t 3 863 s which propagated upstream until it was dissipated at the boundary reservoir downstream the obstacle a narrow diamond wake was formed similar to the steady cases t 3 301 s the numerical model accurately predicted the dam break wave arrival time and the development of the shock wave upstream the obstacle furthermore the temporal evolution of the computed free surface showed a suitable agreement with what was observed in the laboratory especially for the frontal hydraulic jump appearance and evolution differences between the measured and simulated free surface structure appeared in particular for the upstream shock wave generation process t 3 s flow around and downstream the obstacle was well predicted by the numerical model wake structures and their opening angles were well captured fig 12 depicts the temporal evolution of water depth along the flume longitudinal axis y 12 cm and a longitudinal profile located equidistant from the left flume wall and the obstacle left face y 20 cm the numerical water depth profiles show a good agreement with the experimental data although the hydraulic jump position is not well captured these line snapshots are examples of the kind of information that can be extracted from the dataset straightforwardly finally the temporal evolution of the water column at three different gauge points for the test case g1 d 1 is plotted in fig 13 gauge 1 top was placed at the flume center and 25 cm upstream the obstacle front x y 180 12 cm gauge 2 center was located in the middle of the gap between the obstacle and the flume wall and 5 cm downstream the obstacle front x y 210 20 cm and gauge 3 bottom was at the flume center and 8 7 cm downstream the obstacle tail x y 230 12 cm the numerical model offers good predictions for the water depth temporal evolution at gauges 2 and 3 whereas for gauge 1 some reasonable differences can be found although the arrival time for both the original dambreak wave and the upstream moving hydraulic jump were captured accurately the simulation overestimated the water depth value upstream the centered obstacle especially at the first stages after the dambreak arrival 4 3 floor bump and centered obstacle g2 4 3 1 steady flow cases g2 s 1 and g2 s 2 for this geometry two different steady inflow discharges were set q 1 5 05 m 3 h and q 2 9 01 m 3 h experimental time averaged water depth fields are depicted in fig 14 left the flow was subcritical upstream the bump for both tested discharges and it became supercritical downstream the bump the flow velocity increased in the transcritical region over the pvc floor bump resulting in a very low water depth difficult to measure with traditional experimental techniques a slightly marked and curved shock wave appeared upstream the obstacle for a discharge of 5 05 m3 h and it evolved to a hydraulic jump perpendicular to the flow direction when the discharge increased to 9 01 m3 h downstream this hydraulic jump a complex wave structure was observed with different transverse shock waves as in the previous geometry g1 a symmetrical wake appeared again downstream the obstacle tail but the observed oblique shock waves on both sides of the centered obstacle were weaker for this configuration the numerical results fig 14 right showed an acceptable agreement with the observed flow structure for both discharges although the computational model was able to capture the transverse waves downstream the obstacle front face important differences were found in the flow configuration upstream the obstacle actually the numerical discontinuities were somehow exaggerated when compared to those observed experimentally with a discharge of 5 05 m3 h the numerical model predicted a oblique hydraulic jump upstream the obstacle but when discharge was increased to 9 01 m3 h the numerical result did not show its evolution to a perpendicular hydraulic jump as it was observed in the kinect measurement the comparison of measured and computed water depth along the longitudinal flume center axis y 0 12 m and the cross section at x 2 40 m is depicted in fig 15 for both flow cases s 1 and s 2 longitudinal water depth profiles at the flume center axis show a good agreement for experimental and simulated data except near the obstacle whereas more significant differences appeared in the cross section profile these differences can be produced by the combination of shading areas and high slope water surfaces as it was stated for the previous steady cases it is interesting to note that the experimental cross sectional profile for q 1 5 05 m 3 h shows an exponential behaviour whereas the numerical solution exhibits a logarithmic behaviour suggesting wall effects which are not captured in the model however the relative differences between numerical and experimental water depth normalized by the mean flow depth upstream the floor bump remained always below 20 far from the obstacle faces fig 16 close to the obstacle s upstream face the relative difference was more marked due to the disagreement in the hydraulic jump shape and height 4 3 2 dam break flow case g2 d 2 a dam break with initial water depth upstream the gate of h 0 13 0 cm above the flume bed was tested with this geometry fig 17 shows a time sequence of the measured two dimensional water depth field left column and the corresponding numerical results right column the supercritical dam break wave overcame the bed bump with a high velocity and reached the centered obstacle at t 1 6 1 8 s a strong shock wave appeared immediately at the front of the obstacle exceeding its height and running over it t 2 153 2 755 s then this shock wave reduced its height and evolved to a hydraulic jump perpendicular to the main flow direction upstream the centered obstacle t 3 527 5 512 s simultaneously a clear wake appeared downstream the obstacle the numerical model was able to correctly predict the arrival time of the dam break wave and the main flow structure created around the centered obstacle but some differences appeared in terms of the wave time progress although in general the computed and experimental results showed a good agreement the numerical model demonstrated to suffer difficulties to accurately reproduce the flow over the obstacle as observed in the experiment underestimating the frontal shock wave height this is justified by the possible loss of validity of the shallow water approximation in this case it neither predicted the position of the hydraulic jump properly this may be due to the high velocity of water upon impact and the consequent three dimensionality of flow during the impact the wave arrival process in this case was more kinetic and violent than in previous cases fig 18 shows the water depth temporal evolution along both the longitudinal flume center axis y 12 cm and the longitudinal profile equidistant from the left flume wall and the left face of the obstacle y 20 cm differences in water depth can be found between numerical and observed values especially for the frontal shock wave height and the hydraulic jump position the profiles confirm that the shock developed into a vertical column which cannot be reproduced by the 2d simulations this column later collapsed into a standing wave as the process evolved and the initial violent impact effects disappeared the model performed increasingly better fig 19 depicts the water depth temporal evolution at three different points gauge 1 top placed at the flume center and 2 5 cm upstream the obstacle front x y 232 5 12 cm gauge 2 center in the middle of the gap between the obstacle and the flume wall and 5 cm downstream the obstacle front x y 240 20 cm and gauge 3 bottom at the flume center and 8 7 cm downstream the obstacle tail x y 260 12 cm as we stated above the numerical model was able to correctly predict the arrival time for the initial dambreak wave but it failed to estimate the water column height upstream the obstacle front 4 4 venturi narrowing and centered obstacle g3 4 4 1 steady flow cases g3 s 1 and g3 s 2 for the geometry g3 two different constant discharges were again set in the flume q 1 5 05 m 3 h and q 2 9 01 m 3 h experimental time averaged water depth fields are depicted in fig 20 left the flow was subcritical upstream the venturi narrowing for both tested discharges and it became supercritical downstream the throat a steady hydraulic jump with an upstream concave shape appeared downstream the narrowing changing again to subcritical regime before the flow reached the obstacle downstream the obstacle the free surface developed a complex wave structure as with the previously reported geometries the experimental flow field width reduction observed upstream the venturi region was caused by visual shadowing zones created by the narrowing pieces the numerical model fig 20 right was able to predict the observed flow structure including the position of the hydraulic jump in the narrow region although some differences were found in the jump through and the complex downstream wave structure a comparison of measured and computed water depth along the longitudinal flume center axis y 0 12 m and cross section at x 2 40 m is depicted in fig 21 the experimental and computed water depth values agree well for the longitudinal flume center profile including the hydraulic jump height and position as well as the diamond wake depth the relative differences between observed and computed water depth normalized by the mean flow depth upstream of the venturi remained always below 20 fig 16 except for the hydraulic jump through where the mismatch in the jump position between numerical and experimental results lead to very local higher differences finally the measured and computed water depth along the cross section at x 2 40 m also showed an acceptable agreement with relative water depth differences below 20 once again the overestimation of water depth by the numerical simulation in the cross sectional profiles near the obstacle suggests that significant wall effects near the obstacle are not represented properly in the model 4 4 2 dam break flow case g3 d 1 a dam break case with an initial water depth upstream the boundary gate of h 0 5 5 cm was performed in the flume fig 23 shows a time sequence of the 2d water depth field for the kinect data left column the supercritical dam break wave reached the centered obstacle at approximately t 2 3 s a shock wave appeared upstream the obstacle as in the previous cases increasing with time and taking a curved shape t 2 729 2 995 s concave in the downstream direction the free surface elevation increased upstream the central point of the venturi narrowing the downstream part of the shock wave resulted in a diagonal pattern whereas the upstream part of the shock wave evolved upstream and developed an upstream concave curvature as time increased t 3 416 3 853 s forming a curved hydraulic jump downstream the central point of the narrowing t 5 756 s at this point the flow field acquired a similar structure as in the steady cases fig 23 right column shows the computed results for that transient flow the numerical model was able to predict accurately all the free surface structures and the flow evolution although the exact position of the structures was not perfectly reproduced nevertheless a delay of 200 300 ms for the numerically computed flow evolution respect to that measured by the rgb d sensor was observed for this case such delay could be caused by the difficulty to match the actual gate opening instant and the initial time extracted from the kinect images even a delay of around 200 ms could be possible this must be taken into account when comparing experimental and numerical plots in fig 23 the water depth temporal evolution along both the longitudinal flume center axis y 12 cm and the longitudinal profile at y 20 cm are shown in fig 24 the numerical water depth profiles showed again a good agreement with the rgb d sensor data including the position of the hydraulic jump upstream the centered obstacle as in the previous unsteady tests the temporal evolution of the water column for the test case g3 d 1 is again depicted in fig 25 at gauge 1 top placed at the flume center and 10 cm upstream the obstacle front x y 225 12 cm gauge 2 center in the middle of the gap between the obstacle and the flume wall and 5 cm downstream the obstacle front x y 240 20 cm and gauge 3 bottom located at the flume center and 8 7 cm downstream the obstacle tail x y 260 12 cm the computed results showed an acceptable agreement with the measured depth evolution for the gauge points 2 and 3 nevertheless the predicted arrival times to gauge 1 for the initial dambreak wave and the upstream moving hydraulic jump were larger than those were experimentally measured moreover the water depth was slightly underestimated by the numerical model at gauge point 1 especially for the first stages after the initial drambreak arrival 4 5 two arch bridge with downstream obstacles g4 s 1 finally a case with more complex geometry was carried out by placing a two arch bridge linked to a centered longitudinal element which separated the flow out of each bride arch in addition a second obstacle was placed oblique to the flow direction and adjacent to the flume wall in order to perturb the flow out of the left arch the inflow was set to 5 75 m3 h ensuring that the water level remained below the arch top point this fact was important to ensure that the hypothesis of flow under hydrostatic pressure was still acceptable and hence the shallow water mathematical model remained applicable flow upstream the bridge was subcritical and became supercritical downstream moreover the obstacles position and orientation caused a complex non symmetrical flow structure downstream the bridge with a high degree of interaction between shock and rarefaction waves fig 26 shows the 2d water depth field obtained by the rgb d sensor left and computed right for this steady case note that experimental data were not acquired in the arch due to the presence of the bridge top board the numerical model was able to predict the measured flow structure in both regions separated by the centered longitudinal piece including both the backwater effect in the left arch and the complex wave interaction downstream the right arch the right arch region is numerically challenging due to the elevated number of involved waves and the low flow depth in order to perform a 2d spatial comparison of the flow structure the froude number field was computed from numerical results note that this is not possible to do from experimental results since the velocity field was not measured and is shown in 27 left panel the gradient of the froude field was computed and the regions with highest local gradient were identified which correspond to shock wave regions and are superimposed on the experimental depth field reported in fig 27 right panel the figure shows that the simulated shock wave structure agrees well with the experimental flow field although some differences were found shock wave angles and curvatures are well reproduced a small mismatch is observed downstream the oblique and longitudinal obstacles in the low depth region 2 5 x 2 7 0 12 y 0 24 furthermore fig 28 left shows measured and computed water depth along the longitudinal profile at y 0 07 m centerline of right arch and y 0 165 m centerline of left arch the experimental and computed water depth values along these longitudinal profiles agree well the longitudinal profile at y 0 165 m allows to clarify the slight differences in the shock wave structure as simulated results show a sharper shock at x 2 65 m than experimental results the relative water depth difference normalized by the mean water depth upstream the bridge along these two longitudinal sections is also displayed in fig 28 right remaining always below 20 5 conclusions the results of a laboratory scale experimental campaign including eleven tests of steady and unsteady 2d water surfaces ranging from steady transcritical flows to dam break flows around obstacles in a plexiglas flume have been presented this work constitutes a new benchmarking dataset in which 2d transient water surfaces are available for shallow water model developers and users to further test and develop these models this dataset has been acquired by a novel use of commercial grade rgb d sensing devices which allows to capture a succession of 3d color coded point clouds and construct the 2d free surface elevation field for each measurement the result is a novel collection of 2d benchmark shallow flow cases with transient water depth and water elevation data for the entire visible flow field allowing for qualitative and quantitative spatio temporal comparisons with numerical simulations we show that this technology is cost effective and accurate for the purposes of this work opening the way for furthering more complex applications to generate experimental benchmarks for models and other applications of flume measurements the main limitations of the experimental approach are technical in terms of a limited field of view thus requiring more sensors accurately positioned to cover a larger flume or basin with no shading areas perhaps even with non parallel optical axises and the need to create an opaque water volume because of the low cost of the sensors arguably their main advantage together with their off the shelf operation makes a multi sensor setup quite feasible this new 2d transient data can help identify limitations in the current generation of solvers thus laying the ground for improvements in the near future in consequence simulations performed with an extensively tested state of the art 2d shallow water numerical model were performed and compared against the experimental data the results show the suitability of this dataset for benchmarking purposes furthermore the tested solver performed well even for complex transient flows spatial comparisons of flow structures were performed and the high spatio temporal resolution of the experimental and numerical data set allows to identify potential shortcomings in the numerical model such shortcoming is perhaps local friction effects around obstacles suggesting a need for further mesh refinement and or better friction calibration or representation the comparisons also show that numerical results are much sharper at shock waves and much smoother elsewhere than the experimental results this behaviour is a mix of the turbulent chaotic behaviour in the experiment which is not represented in the model together with experimental uncertainty the methods and results here presented should be useful for the shallow water community to further validate numerical solvers under more strenuous tests since the technology and methods are inexpensive and relatively straightforward this work paves the way to performing more complex flow cases for example in 2d basins with complex terrain or including further processes such as moving beds and sediment transport acknowledgemnts this work was partially funded by the mineco feder under research project cgl2015 66114 r and by diputacion general de aragon dga through fondo europeo de desarrollo regional feder the experimental data set is available in http fiona cps unizar es ghcuser kinect exp data zip supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2018 08 013 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
749,in the past decade shallow water solvers have dramatically improved both in terms of accuracy and computational power new mathematical models and numerical schemes have been systematically verified against 1d exact solutions and laboratory experiments despite the two dimensional nature of some of these benchmark tests none of them reports complete 2d water depth fields but only a few profiles are measured and reported in the best case this work reports a new benchmarking dataset for validation of shallow water solvers in which two dimensional transient water depth measurements are available for complex steady and transient laboratory flume experiments ranging from transcritical steady flow to dam break flows around obstacles and complex beds the transient water surface was measured using a commercial grade rgb d sensing device which allows to capture a succession of color coded point clouds at a high frequency these experimental measurements are compared with 2d shallow water simulations carried out with an extensively tested finite volume solver results asses the suitability of this dataset to perform as benchmark tests identifying potential limitations of current and future models keywords finite volumes shallow water equations 3d sensing rgb d sensor transient free surface flow 1 introduction shallow water solvers have received wide attention in the past decade resulting in a new generation of robust and efficient models garcía navarro 2016 hinkelmann et al 2015 in the search for large scale and long term computations of complex transients on both natural and man made environments shallow water models have been extensively benchmarked against test cases which are widespread in the literature the solvers have been systematically verified against analytical solutions for simplified problems delestre et al 2013 fernández pato et al 2018 macdonald et al 1997 murillo and garcía navarro 2012 in addition they have also been validated against laboratory experiments briggs et al 1995 fraccarollo and toro 1995 hiver 2000 kocaman and ozmen cagatay 2015 liu et al 2008 ozmen cagatay et al 2014 ratia et al 2014 soares frazão and zech 2007 2008 testa et al 2007 velickovic et al 2016 as well as some well documented real scale field cases caviedes voullième et al 2012 fernández pato et al 2016 hervouet and petitjean 1999 more recently the experimental literature continues to report transient shallow flows though with an added interest on sediment transport and moving beds carrivick 2010 carrivick et al 2011 juez et al 2017 soares frazão et al 2012 spinewine and capart 2013 swartenbroekx et al 2013 despite the two dimensional nature of some of the aforementioned benchmark tests none of them reports 2d transient water surface elevations at best transient data along a few profiles are reported and more often transient data are only reported at a few points moreover in field cases fully transient data are seldom available well established instruments such as pressure gauges hiver 2000 soares frazão and zech 2008 ultrasonic gauges carrivick et al 2011 goutiere et al 2011 soares frazão et al 2012 velickovic et al 2016 and electrically resistive rods creëlle et al 2018 have been often used to measure water depth evolution at discrete points however in order to capture a 2d transient field too many of these instruments would be required making the experimental setup cumbersome impractical and expensive without still really achieving high spatial resolution in 1d flumes this problem has been solved by using longitudinal imaging carrivick et al 2011 fent et al 2018 kocaman and ozmen cagatay 2012 2015 ozmen cagatay et al 2014 in some cases piv plif techniques have been used to obtain velocity fields bento et al 2017 muste et al 2014 soares frazão and zech 2008 additionally in experimental fluid mechanics measuring the evolution of a free surface has received little attention as it has been mainly understood as a problem for shallow water flows and more recently for free surface granular flows caviedes voullième et al 2014 pouliquen and forterre 2002 wieland et al 1999 as numerical models have become more sophisticated more complex flow phenomena can be in principle accurately simulated perhaps some of the most challenging are fast transcritical transients over complex topography and obstacles these are flows of great interest in civil engineering urban flooding and risk management in general costabile and macchione 2015 it is therefore highly relevant to formally verify that numerical models can indeed reproduce such flow phenomena the lack of 2d transient experimental measurements generates a gap in model validation the unavailability of 2d transient datasets comes from the inherent difficulty of measuring a fast moving water attempting to fully cover the flow field this is a task for which optical methods are best suited refraction based reconstructions daida et al 1995 engelen et al 2018 morris 2004 stereophotography based measurements daida et al 1995 evers and hager 2015 morris 2004 zou et al 2016 photogrammetry based methods d odeigne et al 2018 franzini et al 2016 although restricted to steady flows light absorption methods aureli et al 2014 2010 stereo correlation chatellier et al 2013 stereo refraction gomit et al 2013 and twin camera refraction analysis of reflected laser light and piv ng et al 2010 have all been tested in attempts to capture moving water surfaces each with their inherent drawbacks on requiring projected referenced grids specific lighting sophisticated and expensive equipment and technical challenges in their setup and processing recently a wide range of low cost 3d sensors have appeared as a consequence of the videogame industry development which are henceforth termed rgb d red green blue depth sensors the original devices carmine released by primesense and kinect released by microsoft in 2010 were designed to capture human body movements for interaction with video games the massive size of the videogame market enabled these sensors to be developed and mass produced at a per unit cost far below that of time of flight tof cameras with comparable aquisition frequencies these low cost sensors were quickly adapted to new applications such as interactive 3d modelling of indoor environments du et al 2011 autonomous flight huang et al 2017 fluid dynamics measurements berger et al 2014 or simultaneous location and mapping izadi et al 2011 the early rgb d devices were based on the structured light principle this approach is an active stereo vision technique a set of known patterns sequentially projected onto an object gets deformed by the geometric shape the object is then observed with a camera from a different direction by analysing the distortion of the observed pattern i e the disparity from the original projected pattern depth information can be extracted metrological studies have extensively documented the accuracy and usability ranges for such devices gonzález jorge et al 2013 2015 sarbolandi et al 2015 showing that the depth accuracy of rgb d sensors strongly depends on the distance to the measured objects decreasing quadratically at a short range 4 6 m gonzález jorge et al 2013 on the other hand low cost tof based sensors such as kinect2 perform better for most of the indoor conditions gonzález jorge et al 2015 stoyanov et al 2013 compared the kinect device to several tof devices in a robotic vision context concluding that they all deliver similar framerates and that both the kinect and some tofs achieve lower depth accuracy than high grade industrial instruments although the kinect outperformed some tof systems in the short ranges horaud et al 2016 tested several tof devices reporting their maximum framerates which range between 30 and 60 fps putting the kinect sensor in the lower end of acquistion rates of tof cameras when capturing complex objects lachat et al 2015 showed that low cost rgb d sensors are below the accuracy of standard photogrammetry tools together with other limitations in terms of field of view hämmerle et al 2014 compared a kinect sensor to a lidar device when capturing 3d cave features noting again that the kinect underperforms compared to lidar though still highlighting its ease of use and very low cost compared to the high end instruments altogether the literature suggests that the main limitations of rgb d devices are depth accuracy as compared to tof or laser ranging devices and their relatively short operational range of distances additional practical limitations have been identified such as limited capability to measure on surfaces with low reflectivity dal mutto et al 2012 langmann et al 2012 although this has also been reported to be an issue for some industry grade tof sensors kahn et al 2013 or infrared absorbing surfaces mankoff and russo 2013 excessive background illumination dal mutto et al 2012 high ambient infrared mankoff and russo 2013 and the inability to capture data from surfaces nearly parallel to the optical axis dal mutto et al 2012 langmann et al 2012 moreover because of their extended use and their low cost manufacturing these devices suffer from technical issues such as low thermal stability g guidi 2016 mankoff and russo 2013 although arguably the errors introduced may be acceptable for many applications in contrast it has been argued that tof devices may suffer from motion artifacts if there is indeed movement in the images relatively low resolution they are more expensive and require somewhat more power setup and equipment to operate kahn et al 2013 langmann et al 2012 stoyanov et al 2013 the obvious advantage of rgb d sensors compared to conventional stereo vision cameras and time of flight sensors is clearly their very affordable cost which makes them an attractive tool for many researchers despite the aforementioned limitations researchers have obtained results of enough accuracy using these sensors in applications such as coastal mapping butkiewicz 2014 soil and sediment characterisation chávez et al 2014 marinello et al 2015 thomsen et al 2015 indoor ambient reconstruction khoshelham and elberink 2012 plant phenotyping and sizing hämmerle and höfle 2016 paulus et al 2014 wang et al 2017 and to obtain dynamic measurements berger et al 2011 dutta 2012 a few pioneering studies using rgb d sensors have been reported in hydraulic or fluid mechanics applications combes et al 2011 showed the feasibility of capturing moving opaque water surfaces with a kinect device caviedes voullième et al 2014 measured the transient dynamics of a fast moving granular surface with a carmine device nichols and rubinato 2016 measured surface water gravity waves in clear water in a flume as a proof of concept that refraction can be used for such purposes in the same line klopfer et al 2017 measured submerged bathymetry with a kinect device and chourasiya et al 2017 used a kinect device to measure the movement of sediment surfaces submerged in clear water by introducing a refraction correction and to measure the breach morphologic evolution of a failed earth dam amaral et al 2018 tests have also been performed with submerged devices anwer et al 2017 the trend in the literature suggests that it is in fact possible and convenient to measure dynamic water surfaces with rgb d devices by capturing a seeded flow motion of the water surface or by creating an opaque flow evers and hager 2015 in the light of this we present a novel set of transient free surface water flow experiments with complex geometries with flow conditions ranging from steady transcritical flows to dam break cases in all cases we report the 2d temporal evolution of the water surface captured by means of a commercial grade rgb d device measuring opaque water two different sensors were used in this set of tests a primesense carmine 1 09 and a microsoft kinect for windows sdk 1 8 the aim of the study is to provide a novel and accessible experimental transient water surface dataset it can serve as benchmark test for current and future generations of 2d shallow water models both to validate their capabilities and help identify the next set of challenges to be solved we also point out that this is the first application to the authors knowledge of rgb d sensors for the measurement of complex transient shallow water dynamics the paper is organised as follows the description of the experimental setup and methods hydraulic setups and postprocessing procedures are presented in section 2 section 3 is devoted to the mathematical model used in this paper to provide a quantitative characterisation of the data set capability to work as benchmarking tool as well as the model calibration section 4 reports the experimental results where the main features observed in the measured 2d water depth fields for each test are described and compared with the numerical predictions finally in section 5 some conclusions are drawn 2 experimental tests program 2 1 experimental setup and methods the experiments were performed on a 6 m long rectangular cross section 240 150 mm plexiglass flume connected to an upstream reservoir in the channel reach of interest the slope was designed to be zero although measurements reveal a slope of 0 00092 m m in the first 326 cm downstream a bed kink leads to a flume slope of 0 0404 m m so as to force supercritical flow downstream the measurement region fig 3 a closed circuit allows to establish steady state flow in the flume and a pneumatically actuated gate in the upstream boundary allows to generate dam break conditions with different water elevations in the upstream reservoir the downstream boundary was always a free outfall into a recirculation tank a number of obstacle configurations were placed in the flume which combined with different steady inflows or dam break conditions generated complex 2d water surfaces the water surfaces were recorded using a consumer grade rgb d sensor the device was suspended 0 7 m above the flume a good compromise between field of view 2d resolution millimeters per pixel and depth accuracy caviedes voullième et al 2014 gonzález jorge et al 2013 khoshelham and elberink 2012 a generic setup is shown in fig 1 the different experiments were measured using two different sensors primesense carmine 1 09 and microsoft kinect for windows sdk 1 8 both devices provide a sequence of 640 480 px rgb depth coded images in short the devices project standard structured light sl into an infrared pattern by means of nir laser diode at 850 nm wavelength onto the objects the apparent pattern deformation due to the position and shape of the objects is recorded by a monochrome nir camera observing from a slightly different angle the apparent deformation allows the devices to produce in hardware a depth map for the vga image the device streams both the rgb and depth coded vga images they were recorded with skanect on a laptop computer with a frame rate of 30 fps approximately however actual acquisition frequency depends on additional processes which are computer dependent ranging from hardware limitations mainly regarding sufficient memory to buffer the streams and disk dumping speed to os prioritised processes it should be noted that for our rather short experiments the memory buffer was sufficient 32gb and data were dumped onto a solid state drive to maintain the highest speed possible nonetheless in practice the streams were captured with frame rates from 10 to 30 fps captured images were timestamped with millisecond resolution from which it was possible to study acquisition frequency and lost frames therefore did not affect the time line reconstruction it is important to note that these devices need a pre heating time before providing reliable range measurements mittet et al 2013 the sensors were turned on about 30 min before the beginning of the measurements and left on during the full session for transient cases it is of particular interest to register the gate actuation time this was done by placing a led on the flume structure within the field of view of the rgb d sensor the led was switched on when the gate was actuated allowing to register the time of gate actuation and the duration of gate opening or gate closing the led lighting was detected in the image by a matlab script which then time stamped the image sequence accordingly in order to easily georeference the flume section and the location of the obstacles six spatial reference points were placed on the flume structure within the field of view of the sensors three points at each side of the flume the devices used project a sl pattern which in order to observe the water surface needs to be reflected by it the transparent nature of water does not allow for this a simple solution is to tint water until it is opaque and reflects the pattern at the surface a proof of concept of this was reported by combes et al 2011 and used with stereophotography by evers and hager 2015 in the present work water was tinted with titanium oxide tio2 at a concentration of 1 2 in mass the tio2 was previously mixed with the canal water then the tinted water was recirculated avoiding deposition the required concentration was very small so that the fluid density did not change this allows to reflect the pattern off the water surface thus not requiring reflection corrections as proposed by nichols and rubinato 2016 chourasiya et al 2017 it also has the advantage that the white color of the water allows for visual color contrast with the obstacles and channel bed in addition to the transient flow surfaces the flume bed and obstacles were also captured with the rgb d in a dry condition to completely characterise the channel bed within the field of view 2 2 tested cases four different geometrical configurations were set using a floor bump 20 1 cm radius 31 24 cm footprint 7 3 cm maximum height lateral venturi constriction elements 20 1 cm radius 31 cm long 15 cm height and 7 3 cm maximum width a rectangular obstacle 16 3x8 0x7 0 cm and a bridge structure the reason to choose them was the best compromise between the possibilities offered by our experimental canal and the necessity to force flow situations of sufficient variability all elements except the bridge structure were constructed out of pvc the bridge structure was constructed from styrene sheets the four configurations are next presented 1 g1 rectangular obstacle placed at the center line of the flume as shown in fig 2 2 g2 floor bump across the entire flume width followed by a rectangular obstacle placed at the center line of the flume as shown in fig 3 3 g3 venturi narrowing and a rectangular obstacle downstream as shown in fig 4 4 g4 bridge structure with two arches the arches were 8 cm wide and 5 cm high at the center downstream the bridge two slender rectangular obstacles were placed one of them following the flume center line 19 2 1 0 3 5 cm and the other obliquely to the flume wall 9 5 1 5 5 0 cm and 21 o respect to the flume wall as shown in fig 5 the aforementioned geometry configurations were used for various steady and unsteady flow conditions which are summarised in table 1 totalizing eleven experimental tests steady cases were performed setting a constant discharge in the flume for dam break cases the reservoir was filled to a height h 0 above the flume floor then the gate was suddenly open and the water free surface was captured with the variable frequency provided by the rgb d sensor the gate opening time was determined from the indicator led light placed in the sensor view area and it was set as the initial time for measurements 2 3 post processing the raw data recorded with skanect were treated with an ad hoc c code based on the open sourced pcl library together with an ad hoc matlab script the raw depth maps were processed into 3d point clouds and then projected into a constant 2d structured grid a raster essentially in order to obtain operable data sets for the free surface elevation for steady cases the discharge in the channel was controlled and the obtained 2d water depth fields were averaged in time in unsteady cases a dam break wave moves through the initially dry measurement area the temporal evolution of the water free surface field showed the formation and development of complex two dimensional transient structures for steady flow cases the reported water surfaces were determined from averaging 60 images of the sequence water depths were determined for all cases by substracting the topography surface containing the flume bed and obstacles from the water surface averaged in steady cases instantaneous in transient cases 3 mathematical model and numerical scheme 3 1 mathematical model in this paper surface flow is modelled using the 2d shallow water equations saint venant 1871 vreugdenhil 1994 which can be written as 1 u t f u x g u y h s where 2 u h q x q y t are the conserved variables being h l the water depth and q x h u and q y h v the unit discharges l t along the x and y coordinates respectively with u and v the depth averaged components of the velocity vector u l t the fluxes associated to these conserved variables are 3 f q x q x 2 h 1 2 g h 2 q x q y h t g q y q x q y h q y 2 h 1 2 g h 2 t where g l t 2 is the gravity acceleration the source terms on the right hand side of the system are split into two kind of terms depending on the nature of the source the term s represents the friction and it is defined as 4 s 0 g h s f x g h s f y t where sfx sfy are the friction slopes in the x and y direction respectively here expressed in terms of the manning s roughness coefficient n t l 1 3 5 s f x n 2 u u 2 v 2 h 4 3 s f y n 2 v u 2 v 2 h 4 3 the term h accounts for the variation of the pressure force along the bottom in both x and y directions it is formulated in terms of the bed slopes of the bottom level z l 6 h 0 g h z x g h z y t eq 1 are a depth averaged model that is only valid under the assumption of negligible vertical accelerations and therefore is associated to a hydrostatic pressure distribution however it represents a widespread formulation in hydraulic engineering system 1 is non linear time dependent and contains several source terms it can be included into the family of hyperbolic systems under the hypothesis of dominant advection among the mathematical properties of 1 is the existence of a jacobian matrix jn of the flux in the outward normal direction given by the unit vector n e n f n x g n y murillo and garcía navarro 2010 defined as 7 j n e n u f u n x g u n y 3 2 numerical scheme the numerical resolution of system 1 can be obtained by means of a first order upwind finite volume scheme the system of equations 1 can be written in a compact way 8 u t e h s where e f g integrating in a volume or grid cell ω 9 d dt ω u d ω ω e d ω ω h s d ω d dt ω u d ω c e n dc ω h s d ω where n is the outward normal direction e n is the normal flux and c denotes the contour surrounding the cell ω assuming a piecewise discretisation of the conserved variables 9 can be expressed as follows 10 d d t ω u d ω k 1 n e δ e t k n k l k 0 where δ e k e j e i and e i is the value of the flux e evaluated at cell i being i j the indexes of the cells sharing this edge k moreover n k n x n y k is the outward normal vector to the cell edge k ne indicates the number of edges in cell i and lk is the length of edge k the source terms are also associated to the edges defining t k as follows 11 ω h s d ω k 1 n e t n k n with 12 t n k n 0 g h δ z g h s f n n x g h δ z g h s f n n y k it is possible to define a jacobian matrix j k of the normal flux at each edge to implement a local linearisation 13 δ e n k j k δ u k and to diagonalize it in terms of matrices λ and p formed by its eigenvalues λ m and eigenvectors e m respectively 14 λ λ 1 0 0 0 λ 2 0 0 0 λ 3 p e 1 e 2 e 3 e 1 1 u c n x v c n y e 2 0 c n y c n x e 3 1 u c n x v c n y λ 1 u n c λ 2 u n λ 3 u n c where u n u n x v n y and c is average celerity the definition of the averaged variables is as follows 15 u k u i h i u j h j h i h j v k v i h i v j h j h i h j c k g h i h j 2 the difference across the edge k can be projected onto the eigenvectors basis 16 δ u k u j u i p k a k m 1 3 α m e m k where a k α 1 α 2 α 3 k t contains the set of wave strengths following the same procedure with the source terms 17 t n k p k b k m 1 3 β m e m k where b k β 1 β 2 β 3 k t contains the source strengths more information about the values of the wave and the source strengths as well as the entropy fix can be found in murillo and garcía navarro 2010 combining the contributions due to the fluxes and the source terms in a compact expression 18 δ e t k n k m 1 3 λ m α m β m e m k m 1 3 γ m e m k the 2d numerical upwind explicit scheme is formulated using only the contributions that arrive to the cell 19 γ k 1 2 1 sign λ k γ k so that the finite volume approach for the updating of a single cell of area ωi from time level n to time level n 1 is 20 u i n 1 u i n δ t ω i k 1 n e m 1 3 γ m e m l k n considering that in the explicit scheme 20 each k cell edge is used to deliver information between a pair of neighboring cells of different size the time step size compatible with numerical stability is limited by 21 δ t δ t λ δ t λ min χ i χ j max m 1 2 3 λ m considering unstructured meshes the distance χi in each cell i must consider the volume of the cell and the length of the shared k edges 22 χ i ω i max k 1 n e l k the control of the numerical stability is defined by the dimensionless quantity 23 c f l δ t δ t λ 1 however this stability condition is inadequate in presence of relatively important source terms or wet dry fronts a simple generalisation of the cfl condition paying attention to the existence of the source terms or wet dry fronts can lead to extremely small values of δt various orders of magnitude smaller than the value dictated by the homogeneous condition hence rendering the method impractical this can be avoided by means of a reconstruction of the approximate solution the strategy selected is based on enforcing positive values of auxiliary quantities h i and h j respectively 24 h i h i n α k 1 β λ k 1 0 h j h j n α k 3 β λ k 3 0 so that when they become negative the numerical source term is reduced instead of reducing the time step size the numerical scheme had been previously proved well balanced and able to deal with situations of wet dry fronts and emerged topography providing stable solutions with a mass error comparable to the machine accuracy a detailed explanation can be found in murillo and navas montilla 2016 3 3 manning roughness calibration in order to properly predict the friction term influence in the flow behaviour the manning roughness coefficients n for the plexiglass flume and the pvc bed bump were calibrated in a first step five different steady inlet discharges q 1 1 17 m 3 h q 2 4 01 m 3 h q 3 7 41 m 3 h q 4 10 76 m 3 h q 5 14 06 m 3 h were set and the water depth was directly measured with a rule at different points along the flume center axis a first set of measurements was performed with a clear flume bed without any obstacles in order to estimate the plexiglass roughness coefficient then a second set of measurements was performed placing the bed bump 1 845 m downstream the gate see fig 3 and setting the same steady inflows experimental water depth values measured along the longitudinal flume center axis were compared with simulations carried out setting identical steady inflows to that of the experiments and varying the manning s roughness coefficient n for plexiglass and pvc material between 0 008 sm 1 3 and 0 012 sm 1 3 numerical results showed the best agreement with experimental water depth in the reach of the flume for a manning coefficient of 0 01 sm 1 3 for both plexiglass floor and pvc bed bump fig 6 shows the longitudinal water depth profiles with n 0 01 sm 1 3 and n 0 008 sm 1 3 for the clean plexiglass flume to justify the selection 4 experimental results 4 1 rgb d sensor validation with direct measurements as initial test case for the validation of rgb d sensor measurements a steady discharge q 11 66 m 3 h was set in the flume with the venturi narrowing placed at 214 5 cm downstream the pneumatic gate upstream the narrowing the flow was subcritical changing to supercritical at the throat downstream the narrowing a supercritical diamond shape structure appeared with small water depth values at the flume center the water depth profile along the longitudinal flume center axis was direct measured each 5 cm from x 205 cm to x 275 cm using a rule moreover the water free surface was captured with the primesense carmine 1 09 device and it was processed to obtain the steady 2d water depth field fig 7 left shows the reconstructed water free surface at the narrowing region fig 7 right depicts the water depth profile along the longitudinal flume center axis y 12 cm for the direct measurements and the rgb d sensor results relative differences in absolute value between both set of experimental data normalized by the mean flow depth upstream the narrowing are also shown in the same figure the higher differences were found downstream the venturi where the flow was supercritical and the water depth values were more limited nevertheless relative differences remained below 10 of the mean flow depth along the longitudinal profile which can be regarded as a good approximation to the directly measured results this allows us to conclude that rgb d sensors are appropriated for the accuracy requirements of the present work 4 2 centered obstacle g1 4 2 1 steady flow cases g1 s 1 g1 s 2 and g1 s 3 three different steady discharges were used q 1 5 05 m 3 h q 2 9 01 m 3 h and q 3 12 05 m 3 h with this geometrical configuration time averaged water depth fields are depicted in fig 8 experimental results showed a steady rarefaction wave generated at the upstream face of the obstacle this wave increased its height as discharge increased downstream the obstacle upstream face a complex wave structure was observed with different diagonal shock waves a symmetric wake appeared downstream the obstacle tail the position of the different waves did not show significant changes as the discharge increased numerical simulations fig 8 right predicted with an acceptable accuracy the flow structure observed in the experiments especially the upstream frontal rarefaction wave and the diamond wake configuration some differences were found at both sides of the centered obstacle where the numerical model predicted a slightly different flow configuration since the transverse shock wave at both sides of the obstacle appeared slightly upstream in the numerical prediction than in the experimental measurements also it can be observed that the water flow surface at the final section is not well reproduced by the numerical model a comparison of measured and simulated water depth profiles along the two longitudinal axis y 0 12 m and y 0 20 m of the flume and two cross sections x 2 10 m and x 2 30 m is depicted in fig 9 larger differences are observed in the obstacle wake close to the field of view limit region and in the immediate neighbourhood of the obstacle it should be stressed that in the field of view ending region the numerical model was able to predict reasonably well the hydraulic jump locations but the water depth was underestimated especially along the longitudinal y 0 20 m the possibility to obtain any water depth profile depending on the modeller requirements is one of the main advantages of the reported experimental data set compared with other existing benchmarking tests the relative differences between experimental and simulated water depth normalized by the mean flow depth upstream the obstacle region along the longitudinal profile y 0 12 m and cross section x 2 10 m are also shown in fig 10 the relative depth difference was higher at the wake center and close to the obstacle s lateral faces this difference always remained below 20 in the wake region but it increased close to the downstream end of the field of view where the measurements may be affected by an excessive optical angle and the reduced flow depth sarbolandi et al 2015 the cross section profile at x 2 10 m showed relative differences below 10 far from the obstacle s sides but it increased close to them 35 this increment was mainly caused by the disagreement in the oblique shock wave position between experimental measurement and numerical prediction as it was commented above experimental errors exist around the obstacle sides due to shading and high sloping water surfaces this is due to having a single sensor with a vertical optical axis meaning that certain regions around obstacles and vertical surfaces are occluded this can of course be alleviated by placing more sensors with different fields of view and perhaps different optical axis simulated results may also be inaccurate due to shallow water model assumptions breaking in the immediate neighborhood of the obstacle moreover the lack of symmetry in the numerical profiles is due to the use of an unstructured triangular mesh in summary high errors in such close range of the obstacle are to be expected and are difficult to attribute solely to either experimental or numerical issues 4 2 2 dam break flow case g1 d 1 a dam break case was performed in the flume by setting an initial water depth upstream the boundary gate of h 0 5 5 cm above the flume bed the gate was suddenly opened and the actuation time t 0 was captured by the indicator led light the time necessary to open the gate was 500 ms approximately fig 11 shows a time sequence of the 2d water depth field for the kinect data left column and the numerical results right column the dam break wave propagated downstream through the flume reach of interest until it reached the centered obstacle at t 2 6 s a shock wave developed upstream the obstacle initially increasing its depth with time the shock wave bended symmetrically around the obstacle taking a slightly curved shape concave in the downstream direction t 3 051 s which later developed into a downstream oriented diagonal front upstream the obstacle the shock wave developed into a hydraulic jump fully perpendicular to the main flow direction t 3 863 s which propagated upstream until it was dissipated at the boundary reservoir downstream the obstacle a narrow diamond wake was formed similar to the steady cases t 3 301 s the numerical model accurately predicted the dam break wave arrival time and the development of the shock wave upstream the obstacle furthermore the temporal evolution of the computed free surface showed a suitable agreement with what was observed in the laboratory especially for the frontal hydraulic jump appearance and evolution differences between the measured and simulated free surface structure appeared in particular for the upstream shock wave generation process t 3 s flow around and downstream the obstacle was well predicted by the numerical model wake structures and their opening angles were well captured fig 12 depicts the temporal evolution of water depth along the flume longitudinal axis y 12 cm and a longitudinal profile located equidistant from the left flume wall and the obstacle left face y 20 cm the numerical water depth profiles show a good agreement with the experimental data although the hydraulic jump position is not well captured these line snapshots are examples of the kind of information that can be extracted from the dataset straightforwardly finally the temporal evolution of the water column at three different gauge points for the test case g1 d 1 is plotted in fig 13 gauge 1 top was placed at the flume center and 25 cm upstream the obstacle front x y 180 12 cm gauge 2 center was located in the middle of the gap between the obstacle and the flume wall and 5 cm downstream the obstacle front x y 210 20 cm and gauge 3 bottom was at the flume center and 8 7 cm downstream the obstacle tail x y 230 12 cm the numerical model offers good predictions for the water depth temporal evolution at gauges 2 and 3 whereas for gauge 1 some reasonable differences can be found although the arrival time for both the original dambreak wave and the upstream moving hydraulic jump were captured accurately the simulation overestimated the water depth value upstream the centered obstacle especially at the first stages after the dambreak arrival 4 3 floor bump and centered obstacle g2 4 3 1 steady flow cases g2 s 1 and g2 s 2 for this geometry two different steady inflow discharges were set q 1 5 05 m 3 h and q 2 9 01 m 3 h experimental time averaged water depth fields are depicted in fig 14 left the flow was subcritical upstream the bump for both tested discharges and it became supercritical downstream the bump the flow velocity increased in the transcritical region over the pvc floor bump resulting in a very low water depth difficult to measure with traditional experimental techniques a slightly marked and curved shock wave appeared upstream the obstacle for a discharge of 5 05 m3 h and it evolved to a hydraulic jump perpendicular to the flow direction when the discharge increased to 9 01 m3 h downstream this hydraulic jump a complex wave structure was observed with different transverse shock waves as in the previous geometry g1 a symmetrical wake appeared again downstream the obstacle tail but the observed oblique shock waves on both sides of the centered obstacle were weaker for this configuration the numerical results fig 14 right showed an acceptable agreement with the observed flow structure for both discharges although the computational model was able to capture the transverse waves downstream the obstacle front face important differences were found in the flow configuration upstream the obstacle actually the numerical discontinuities were somehow exaggerated when compared to those observed experimentally with a discharge of 5 05 m3 h the numerical model predicted a oblique hydraulic jump upstream the obstacle but when discharge was increased to 9 01 m3 h the numerical result did not show its evolution to a perpendicular hydraulic jump as it was observed in the kinect measurement the comparison of measured and computed water depth along the longitudinal flume center axis y 0 12 m and the cross section at x 2 40 m is depicted in fig 15 for both flow cases s 1 and s 2 longitudinal water depth profiles at the flume center axis show a good agreement for experimental and simulated data except near the obstacle whereas more significant differences appeared in the cross section profile these differences can be produced by the combination of shading areas and high slope water surfaces as it was stated for the previous steady cases it is interesting to note that the experimental cross sectional profile for q 1 5 05 m 3 h shows an exponential behaviour whereas the numerical solution exhibits a logarithmic behaviour suggesting wall effects which are not captured in the model however the relative differences between numerical and experimental water depth normalized by the mean flow depth upstream the floor bump remained always below 20 far from the obstacle faces fig 16 close to the obstacle s upstream face the relative difference was more marked due to the disagreement in the hydraulic jump shape and height 4 3 2 dam break flow case g2 d 2 a dam break with initial water depth upstream the gate of h 0 13 0 cm above the flume bed was tested with this geometry fig 17 shows a time sequence of the measured two dimensional water depth field left column and the corresponding numerical results right column the supercritical dam break wave overcame the bed bump with a high velocity and reached the centered obstacle at t 1 6 1 8 s a strong shock wave appeared immediately at the front of the obstacle exceeding its height and running over it t 2 153 2 755 s then this shock wave reduced its height and evolved to a hydraulic jump perpendicular to the main flow direction upstream the centered obstacle t 3 527 5 512 s simultaneously a clear wake appeared downstream the obstacle the numerical model was able to correctly predict the arrival time of the dam break wave and the main flow structure created around the centered obstacle but some differences appeared in terms of the wave time progress although in general the computed and experimental results showed a good agreement the numerical model demonstrated to suffer difficulties to accurately reproduce the flow over the obstacle as observed in the experiment underestimating the frontal shock wave height this is justified by the possible loss of validity of the shallow water approximation in this case it neither predicted the position of the hydraulic jump properly this may be due to the high velocity of water upon impact and the consequent three dimensionality of flow during the impact the wave arrival process in this case was more kinetic and violent than in previous cases fig 18 shows the water depth temporal evolution along both the longitudinal flume center axis y 12 cm and the longitudinal profile equidistant from the left flume wall and the left face of the obstacle y 20 cm differences in water depth can be found between numerical and observed values especially for the frontal shock wave height and the hydraulic jump position the profiles confirm that the shock developed into a vertical column which cannot be reproduced by the 2d simulations this column later collapsed into a standing wave as the process evolved and the initial violent impact effects disappeared the model performed increasingly better fig 19 depicts the water depth temporal evolution at three different points gauge 1 top placed at the flume center and 2 5 cm upstream the obstacle front x y 232 5 12 cm gauge 2 center in the middle of the gap between the obstacle and the flume wall and 5 cm downstream the obstacle front x y 240 20 cm and gauge 3 bottom at the flume center and 8 7 cm downstream the obstacle tail x y 260 12 cm as we stated above the numerical model was able to correctly predict the arrival time for the initial dambreak wave but it failed to estimate the water column height upstream the obstacle front 4 4 venturi narrowing and centered obstacle g3 4 4 1 steady flow cases g3 s 1 and g3 s 2 for the geometry g3 two different constant discharges were again set in the flume q 1 5 05 m 3 h and q 2 9 01 m 3 h experimental time averaged water depth fields are depicted in fig 20 left the flow was subcritical upstream the venturi narrowing for both tested discharges and it became supercritical downstream the throat a steady hydraulic jump with an upstream concave shape appeared downstream the narrowing changing again to subcritical regime before the flow reached the obstacle downstream the obstacle the free surface developed a complex wave structure as with the previously reported geometries the experimental flow field width reduction observed upstream the venturi region was caused by visual shadowing zones created by the narrowing pieces the numerical model fig 20 right was able to predict the observed flow structure including the position of the hydraulic jump in the narrow region although some differences were found in the jump through and the complex downstream wave structure a comparison of measured and computed water depth along the longitudinal flume center axis y 0 12 m and cross section at x 2 40 m is depicted in fig 21 the experimental and computed water depth values agree well for the longitudinal flume center profile including the hydraulic jump height and position as well as the diamond wake depth the relative differences between observed and computed water depth normalized by the mean flow depth upstream of the venturi remained always below 20 fig 16 except for the hydraulic jump through where the mismatch in the jump position between numerical and experimental results lead to very local higher differences finally the measured and computed water depth along the cross section at x 2 40 m also showed an acceptable agreement with relative water depth differences below 20 once again the overestimation of water depth by the numerical simulation in the cross sectional profiles near the obstacle suggests that significant wall effects near the obstacle are not represented properly in the model 4 4 2 dam break flow case g3 d 1 a dam break case with an initial water depth upstream the boundary gate of h 0 5 5 cm was performed in the flume fig 23 shows a time sequence of the 2d water depth field for the kinect data left column the supercritical dam break wave reached the centered obstacle at approximately t 2 3 s a shock wave appeared upstream the obstacle as in the previous cases increasing with time and taking a curved shape t 2 729 2 995 s concave in the downstream direction the free surface elevation increased upstream the central point of the venturi narrowing the downstream part of the shock wave resulted in a diagonal pattern whereas the upstream part of the shock wave evolved upstream and developed an upstream concave curvature as time increased t 3 416 3 853 s forming a curved hydraulic jump downstream the central point of the narrowing t 5 756 s at this point the flow field acquired a similar structure as in the steady cases fig 23 right column shows the computed results for that transient flow the numerical model was able to predict accurately all the free surface structures and the flow evolution although the exact position of the structures was not perfectly reproduced nevertheless a delay of 200 300 ms for the numerically computed flow evolution respect to that measured by the rgb d sensor was observed for this case such delay could be caused by the difficulty to match the actual gate opening instant and the initial time extracted from the kinect images even a delay of around 200 ms could be possible this must be taken into account when comparing experimental and numerical plots in fig 23 the water depth temporal evolution along both the longitudinal flume center axis y 12 cm and the longitudinal profile at y 20 cm are shown in fig 24 the numerical water depth profiles showed again a good agreement with the rgb d sensor data including the position of the hydraulic jump upstream the centered obstacle as in the previous unsteady tests the temporal evolution of the water column for the test case g3 d 1 is again depicted in fig 25 at gauge 1 top placed at the flume center and 10 cm upstream the obstacle front x y 225 12 cm gauge 2 center in the middle of the gap between the obstacle and the flume wall and 5 cm downstream the obstacle front x y 240 20 cm and gauge 3 bottom located at the flume center and 8 7 cm downstream the obstacle tail x y 260 12 cm the computed results showed an acceptable agreement with the measured depth evolution for the gauge points 2 and 3 nevertheless the predicted arrival times to gauge 1 for the initial dambreak wave and the upstream moving hydraulic jump were larger than those were experimentally measured moreover the water depth was slightly underestimated by the numerical model at gauge point 1 especially for the first stages after the initial drambreak arrival 4 5 two arch bridge with downstream obstacles g4 s 1 finally a case with more complex geometry was carried out by placing a two arch bridge linked to a centered longitudinal element which separated the flow out of each bride arch in addition a second obstacle was placed oblique to the flow direction and adjacent to the flume wall in order to perturb the flow out of the left arch the inflow was set to 5 75 m3 h ensuring that the water level remained below the arch top point this fact was important to ensure that the hypothesis of flow under hydrostatic pressure was still acceptable and hence the shallow water mathematical model remained applicable flow upstream the bridge was subcritical and became supercritical downstream moreover the obstacles position and orientation caused a complex non symmetrical flow structure downstream the bridge with a high degree of interaction between shock and rarefaction waves fig 26 shows the 2d water depth field obtained by the rgb d sensor left and computed right for this steady case note that experimental data were not acquired in the arch due to the presence of the bridge top board the numerical model was able to predict the measured flow structure in both regions separated by the centered longitudinal piece including both the backwater effect in the left arch and the complex wave interaction downstream the right arch the right arch region is numerically challenging due to the elevated number of involved waves and the low flow depth in order to perform a 2d spatial comparison of the flow structure the froude number field was computed from numerical results note that this is not possible to do from experimental results since the velocity field was not measured and is shown in 27 left panel the gradient of the froude field was computed and the regions with highest local gradient were identified which correspond to shock wave regions and are superimposed on the experimental depth field reported in fig 27 right panel the figure shows that the simulated shock wave structure agrees well with the experimental flow field although some differences were found shock wave angles and curvatures are well reproduced a small mismatch is observed downstream the oblique and longitudinal obstacles in the low depth region 2 5 x 2 7 0 12 y 0 24 furthermore fig 28 left shows measured and computed water depth along the longitudinal profile at y 0 07 m centerline of right arch and y 0 165 m centerline of left arch the experimental and computed water depth values along these longitudinal profiles agree well the longitudinal profile at y 0 165 m allows to clarify the slight differences in the shock wave structure as simulated results show a sharper shock at x 2 65 m than experimental results the relative water depth difference normalized by the mean water depth upstream the bridge along these two longitudinal sections is also displayed in fig 28 right remaining always below 20 5 conclusions the results of a laboratory scale experimental campaign including eleven tests of steady and unsteady 2d water surfaces ranging from steady transcritical flows to dam break flows around obstacles in a plexiglas flume have been presented this work constitutes a new benchmarking dataset in which 2d transient water surfaces are available for shallow water model developers and users to further test and develop these models this dataset has been acquired by a novel use of commercial grade rgb d sensing devices which allows to capture a succession of 3d color coded point clouds and construct the 2d free surface elevation field for each measurement the result is a novel collection of 2d benchmark shallow flow cases with transient water depth and water elevation data for the entire visible flow field allowing for qualitative and quantitative spatio temporal comparisons with numerical simulations we show that this technology is cost effective and accurate for the purposes of this work opening the way for furthering more complex applications to generate experimental benchmarks for models and other applications of flume measurements the main limitations of the experimental approach are technical in terms of a limited field of view thus requiring more sensors accurately positioned to cover a larger flume or basin with no shading areas perhaps even with non parallel optical axises and the need to create an opaque water volume because of the low cost of the sensors arguably their main advantage together with their off the shelf operation makes a multi sensor setup quite feasible this new 2d transient data can help identify limitations in the current generation of solvers thus laying the ground for improvements in the near future in consequence simulations performed with an extensively tested state of the art 2d shallow water numerical model were performed and compared against the experimental data the results show the suitability of this dataset for benchmarking purposes furthermore the tested solver performed well even for complex transient flows spatial comparisons of flow structures were performed and the high spatio temporal resolution of the experimental and numerical data set allows to identify potential shortcomings in the numerical model such shortcoming is perhaps local friction effects around obstacles suggesting a need for further mesh refinement and or better friction calibration or representation the comparisons also show that numerical results are much sharper at shock waves and much smoother elsewhere than the experimental results this behaviour is a mix of the turbulent chaotic behaviour in the experiment which is not represented in the model together with experimental uncertainty the methods and results here presented should be useful for the shallow water community to further validate numerical solvers under more strenuous tests since the technology and methods are inexpensive and relatively straightforward this work paves the way to performing more complex flow cases for example in 2d basins with complex terrain or including further processes such as moving beds and sediment transport acknowledgemnts this work was partially funded by the mineco feder under research project cgl2015 66114 r and by diputacion general de aragon dga through fondo europeo de desarrollo regional feder the experimental data set is available in http fiona cps unizar es ghcuser kinect exp data zip supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2018 08 013 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
