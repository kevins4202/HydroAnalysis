index,text
24850,the hydra effect in ecology corresponds to the increase in the equilibrium or time averaged density of a population when its mortality rate is augmented the literature presents examples of the hydra effect in continuous as well as in discrete time population models described by nonlinear systems of ordinary differential and difference equations respectively the novelty of this work is that we show by means of numerical simulation the occurrence of the hydra effect in some stationary dynamics of one dimensional reaction diffusion predator prey models described by nonlinear systems of partial differential equations with distinct nonlinear functional responses reaction diffusion models are a set of mathematical models that take into account population dynamics and dispersal diffusivity within a predefined spatial domain we show that for a type 2 functional response an increasing diffusivity shortens the range of the hydra effect another interesting result concerns the fact that together with the hydra effect the prey density also increases with the increase of the per capita density independent mortality rate of the predator this result indicates that this top down disturbance does not necessarily create a trophic cascade in a spatial predator prey interaction at the steady state regime keywords hydra effect functional responses spatial predator prey models 1 introduction by definition the hydra effect is the increase in the equilibrium or time averaged density of a population when its mortality rate is augmented abrams 2009 abrams and matsuda 2005 this phenomenon is named hydra effect after the mythological beast that grew two heads to replace each one that was beheaded studies dealing with positive effects at the population level as a result of an increase in mortality of populations have been addressed both in theoretical cortez 2016 cortez and abrams 2016 costa and anjos 2018 liz 2017 and in empirical systems abrams 2009 cortez 2016 schröder et al 2014 zipkin et al 2009 present a list of references with empirical evidence for the hydra effect in an applied context of population control through removal of individuals of plant insect and fish populations this positive effect of mortality can have significant consequences in applied ecology and epidemiology for instance because harvest removal of species is actually an additional mortality factor for empirical examples see abrams 2009 and references therein in his review abrams 2009 puts forward three key mechanisms underlying the hydra effect the first one refers to altered variation in population size that are supposed to cause changes in the form and amplitude of cycles with greater mortality usually decreasing the amplitude of cycles and increasing population temporal average density the second mechanism is the temporal separation between mortality and density dependence abrams 2009 argues that mortality must operate before the overcompensatory density dependence to create a hydra effect finally the third mechanism asserts that changes in the interplay between consumer and resource may reduce consumption giving rise to what he called prudent resource exploitation abrams 2009 the two latter mechanisms were investigated in mcintire and juliano 2018 considering two species of aedes which act as vectors in some viral human diseases they found that mortality at the early stage yielded greater production of adults they could not find any evidence for the mechanism of prudent resource exploitation abrams 2009 in the studied species in which for this system is associated with changing in larval feeding behavior in response to water borne predation cues mcintire and juliano 2018 however such mechanism has already been identified in the theoretical study performed by sieber and hilker 2012 in which they analyzed predator prey models with type 2 and 3 functional responses sieber and hilker 2012 also point out the importance of investigating the occurrence of hydra effects in most natural ecological systems that exhibit density dependent net growth rate of the predator this would be the case for example when the density dependent mortality is driven by a quadratic term which describes competition among predator individuals for resources other than the focal prey cortez and abrams 2016 hypothesized that saturating functional responses e g type 2 and 3 and direct intraspecific predator competition increasing in predator per capita mortality rate and or decreasing functional response with predator density are two mechanisms that can lead to hydra effects the previous mentioned theoretical studies were restricted to spatially homogeneous scenarios leaving out mechanisms such as species dispersion and migration a recent review presented in deangelis and yurek 2017 highlights the increasing number of studies considering spatially explicit models in ecology by using different techniques regarding hydra effects the paper of strevens and bonsall 2011 discusses strategies of harvesting in a host parasitoid metapopulation system the bruchid beetle callosobruchus maculatus is a pest species which is parasited by the wasp anisopteromalus calandrae by means of numerical simulations and laboratory experimentation they found the hydra effect in the pest species yielding higher number of individuals in harvested metapopulations compared with unharvested metapopulations employing similar metapopulation models and laboratory experiments fox et al 2017 address the influence of the dispersal rate in some discrete and continuous time models they identified that catastrophic perturbations that causes local extinction allow metapopulation asynchrony a factor that enhanced metapopulation persistence when subject to sufficiently high dispersal rates although very high dispersion rates may prevent asynchrony and lead to species extinction the hydra effect is observed because local extinctions increased recolonization yielding metapopulation persistence thus far the hydra effect has not yet been identified in spatially explicit models considering diffusion spatial processes can be included in such models by considering systems of nonlinear partial differential equations in which species dynamics are dictated by coupled reaction diffusion equations with both dispersal and population dynamics taken into account simultaneously holmes et al 1994 the work of holmes et al 1994 presents different applications regarding the use of reaction diffusion models in ecology such as spatial patterning liu et al 2014 ecological invasions petrovskii et al 2005 and critical patch size azevedo et al 2012 in this work by means of numerical simulations of one dimensional spatial predator prey models with reaction diffusion terms and functional responses type 1 2 3 and an alternative version from upadhyay et al 2010 denoted as type 4 functional response hereinafter we investigate the occurrence of the hydra effect in the predator when its per capita density independent mortality rate is augmented of note the analysis of sieber and hilker 2012 did not include type 4 functional response because this functional response does not fit the assumption presented in the paper of predator consumption as a strictly increasing function of prey density the inclusion of functional response type 4 rests upon two characteristics not shared with functional responses type 2 and 3 i it is a non saturating functional response ii it models a possible antipredatory behavior of the prey kot 2001 upadhyay et al 2010 such as the case of dangerous prey in spider ant interactions líznarová and pekár 2013 the antipredatory behavior of the prey can cause a prudent exploitation of the prey resource by the predator consumer and as mentioned before this item can be an underlying reason for the occurrence of the hydra effect abrams 2009 we also investigate how the diffusivity affects the occurrence of the hydra effect in type 2 functional response by varying the diffusion intensities of the consumer population in essence the aim of the present work is to find at least one instance of the predator hydra effect in each of the above mentioned functional responses we think that among other things this result is important because to our knowledge this type of behavior has not been reported in the literature of theoretical modeling of spatial multispecies dynamics with reaction diffusion to corroborate our view in a recent paper pal et al 2019 suggested the investigation of the possible occurrence of the hydra effect in spatially structured systems in a perspective of theoretical population dynamics as one of the potential directions of search for this phenomenon the outline of the work is as follows section 2 presents the mathematical models employed in the present work section 3 presents the results of the analyses of the functional responses type 1 and 2 and in section 4 we discuss our findings additional relevant issues for the present analysis are presented in the supplementary materials supplementary material a contains instances of the hydra effect in one dimensional spatial predator prey models with functional responses types 3 and 4 and predator s density dependent mortality supplementary material b presents bifurcation diagrams of the non spatial models with functional responses type 2 3 and 4 supplementary material c shows the steady state spatial distribution of predator resulting from model simulations for functional responses type 2 3 and 4 with a larger domain length finally supplementary material d shows the occurrence of the hydra effect for type 2 functional response without the predator s density dependent mortality 2 methods 2 1 general description of the predator prey model in this section we present the general spatial predator prey model that will be analyzed throughout the work this model is defined in the one dimensional spatial temporal domain 0 l 0 t and reads as follows 1 r t d r 2 r x 2 r r 1 r k f r c c t d c 2 c x 2 e f r c f r c m c c q c c 2 r and c are the densities of prey and predator individuals respectively and the prey grows according to a logistic equation the predator possesses both a density independent and a density dependent per capita mortality rate the reactive part of the model 1 is based on costa and anjos 2018 which encountered multiple hydra effects for the type 2 functional response with allee effects acting on the predator population we analyze different types of functional response f i r i 1 2 3 4 namely type 1 2 3 and 4 functional responses the definition of variables and parameters used in this work are displayed in table 1 all parameters are strictly positive constants we employ one spatial dimension because it is the simplest form to deal with spatial spread where it is assumed that species movement occurs in one spatial dimension and population density varies in just one dimension vitense et al 2016 this spatial feature in the model could be ascribed for instance to environmental conditions that can create a preferential direction of diffusion soboleva et al 2003 2 2 functional responses in the following the two considered models based on a set of spatial predator prey models in biological pest control lewis et al 2016 are obtained from eq 1 by setting either a type 1 functional response 2 f 1 r a c r r or a type 2 functional response 3 f 2 r a c r r 1 a c r t h c r r in these relations acr is the attack coefficient of species c on species r thcr is the manipulation time of species c on species r as mentioned before our study also encompasses type 3 and 4 functional responses whose analysis are shown in the supplementary material a 2 3 model settings given a set of parameter values we evaluate the role of parameter mc in the occurrence of the hydra effect for each considered model to set such a scenario we first analyze the corresponding non spatial model and varied systematically the parameter values with the intention to create when possible an occurrence of the predator hydra effect in this context the bifurcation analysis presented in supplementary material b shows the results for the non spatial models such a set is then used in the spatial model and we perform extensive simulations to find the diffusivity coefficients for prey and predator species so as to generate the hydra effect in the spatial context this procedure is repeated for every considered model we assume that the initial spatial distributions of prey and predator are uniform along the domain except on the boundaries in this regard we set r x 0 1 2 and c x 0 1 for all simulations we apply homogeneous dirichlet boundary conditions that is r 0 t r l t c 0 t c l t 0 these boundary conditions can represent a land with plant cultivation where pest and agent individuals cannot survive on and beyond its borders because outside the domain lies an inhospitable environment such as a roadway hence these boundaries are said to be of absorbing type with respect to the choice of these boundary conditions it is important to mention that the hostile environment boundary condition we have assumed in this work dirichlet boundary conditions has also been employed in other biological setups such as plankton blooms critical plankton filaments fish populations in marine protected areas annual plants and bacterial colonies under ultraviolet light see méndez et al 2011 and references therein before proceeding we mention that the analyses in this work are undertaken as they stand that is we do not convert to dimensionless variables and parameters the main drive of our choice is the flexibility of separately analyzing cases for any chosen set of parameters of the studied model kot 2001 thus given a set of parameter values we evaluate the role of parameter mc in the occurrence of the hydra effect for each considered model finally it is important to remark that as we focus on finding the hydra effect in predator prey spatial models with stationary final distributions we dismiss set of parameter values that create distributions with spatiotemporal oscillations as in the paper of cortez and abrams 2016 2 4 numerical solution the models with the studied functional responses analyzed here are numerically solved following the assumptions and the numerical procedure described below the partial differential equations were solved numerically by using the finite differences method to this end the spatial domain is uniformly discretized into n parts so that δ x l n and δt is the time discretization model evaluation continues until a steady state solution is reached thus throughout this work the simulations are carried out until a time at which no more changes in the species distributions are detected these distributions are called final species distributions convergence to steady state is then defined by comparing both prey and predator populations of two subsequent time steps if their absolute values are smaller than the tolerance of 10 10 the program stops running if convergence is not achieved the simulation continues until a maximum time t 1000 is reached this criterion is necessary for avoiding infinite loops caused by a limit cycle the crank nicolson method is used to approximate the time derivative and the second order operator is approximated by central differences leveque 2007 the resulting system of algebraic equations is linearized using the picard method and solved by uncoupling the equations using a gauss seidel structure finally the associated systems of algebraic equations are solved by using the conjugate gradient method leveque 2007 in all simulations the spatial domain ranges from x 0 to x l 10 we set δ x 0 05 corresponding to a uniform spatial discretization with n 200 and δ t 0 01 which yield convergent discrete approximations in order to detect the occurrence of the hydra effect we simulate the models until we get the stable stationary final distribution for a arbitrarily decided range of increasing mc in the procedure of model simulation we calculate the integrated abundance through space iatsi i r c for prey and predator this quantity represents the total number of individuals over the considered spatial domain after this step we have a list of iats for the range of mc employed in the analysis these values of iats can be compared to identify if the population density increased or decreased with increasing mc specifically for each two consecutive values of mc we compared the corresponding values of iats of the predator if the value of iatsc increases we have an instance of predator hydra effect 3 results we analyzed the steady state solutions of the spatial explicitly model for type 1 and 2 functional responses the computational domain length is set l 10 in supplementary materials b and c we present the bifurcation diagrams for the non spatial counterpart of model for the employed functional responses and the model outcomes for a larger domain length respectively 3 1 type 1 functional response beforehand it is important to recall that there is no evidence in the literature of the hydra effect for type 1 functional response spatially homogeneous models cortez and abrams 2016 sieber and hilker 2012 thus to check the occurrence of hydra effects in the present analysis we performed extensive numerical experiments to cover a wide range of the parametric space we consistently obtained the typical spatial distribution of predator depicted in fig 1 for two different values of the per capita mortality rate of the predator m c 0 02 and m c 0 025 while keeping the other parameters fixed notice that the increase of mc leads to a decrease in the predator population indicating the absence of the hydra effect we also simulate the model for a wider range values of the predator per capita mortality rate varying mc from 0 02 to 0 025 with steps of 0 001 while keeping the other parameters fixed the values of the iats for the increasing values of mc at the steady state are shown in fig 2 notice that the reduction in the population of predators is accompanied by the increase of the prey population reflecting a trophic cascade generated by a top down disturbance these parameter specific results corroborate the fact that in continuous time and unstructured predator prey models the predator needs to possess a nonlinear functional response so that a hydra effect occurs cortez and abrams 2016 sieber and hilker 2012 3 2 type 2 functional response according to the usual definition of hydra effect abrams 2009 an increase in the population density should follow an increase in its density independent per capita mortality rate this dynamical outcome is shown next by numerical simulations of model 1 with type 2 functional response when altering the predator density independent per capita mortality rate mc when mc is increased from 0 0201 to 0 0202 the predator density increases in the spatial domain fig 3 exhibiting a hydra effect to investigate the sensitivity of the hydra effect with the variation of the predator density independent per capita mortality rate we simulate the model for increasing values of mc beginning with m c 0 02 with steps of 0 0001 to obtain the values of the iats for both predator and prey populations as displayed in fig 4 a hydra effect in the predator population occurs for 0 02 mc 0 0205 notice that an increase of mc from 0 0201 to 0 0202 as showed in fig 3 amounts to an abrupt increase of 5 42 in the iats of the predator such change in the iatsc could be related to the presence of a bifurcation point in the corresponding non spatial model see fig 1 of the supplementary material b as mc takes on higher values than 0 0202 we note a reduction in the increase of the iats of the predator until the hydra effect disappears for mc greater than 0 0205 moreover the left panel of fig 4 also shows that the small top down disturbance i e increase in the density independent per capita mortality rate of the predator mc along the referred interval augments the prey population over part of the mc range explored in the table this outcome indicates that the augmentation of mc between 0 02 and 0 0205 does not create a trophic cascade at the steady state regime in the analyzed ditrophic food chain despite it is out of the scope of this work the analysis of the transient could also bring further insights the results of f 3 r and f 4 r are qualitative similar to the results of the f 2 r they both showed the hydra effect for some range of mc these results are shown in the supplementary material a 3 3 influence of the predator diffusion coefficient on the interval of the hydra effect in the case of type 2 functional response given the spatial context of this work it would be interesting to assess how the predator diffusivity affects its own hydra effect as an example for the assessment of the influence of the predator diffusivity on the magnitude of the mc interval where the predator hydra effect occurs we identify the interval of mc for which the hydra effect occurs at steady state solution of model 1 with f 2 r for a variety of values of predator diffusivity the resulting diagram is depicted in fig 5 as dc increases the interval of mc for which the predator hydra effect occurs decreases until disappearing for dc 1 05 the range of mc that causes the hydra effect becomes shorter with increasing diffusivity and the minimum value of these mc ranges first increases and then decreases with increasing diffusivity fig 5 this behavior occurs because the diffusion becomes more influential when dc increases and in turn it does not facilitate the emergence of the predator hydra effect 4 discussion 4 1 hydra effect in spatial predator prey models with nonlinear functional responses the occurrence of the hydra effect for the selected nonlinear functional responses indicates that this phenomenon can arise even in spatially explicit models it is important to remark that the hydra effect found in this work occurs for nonlinear saturating f 2 r and f 3 r as well as non saturating functional responses f 4 r despite the narrow range of parameter values the presence of the predator hydra effect across different functional responses points to the fact that the occurrence of the hydra effect in natural populations can be in some way more common than expected in non spatial models two processes can induce the hydra effect by means of the mechanism of prudent resource exploitation abrams 2009 i saturating functional responses cortez and abrams 2016 sieber and hilker 2012 according to abrams 2009 a type 2 functional response causes the reduction in attack rate due to increased handling time with greater prey abundance likewise we could argue that the same is valid for a type 3 functional response ii direct intraspecific predator competition cortez and abrams 2016 which in our studied models takes the form of the quadratic mortality rate in the predator qcc 2 however item ii is not a necessary condition for the hydra effect in the predator to occur see supplementary material d for an example of occurrence of the hydra effect for f 2 r when q c 0 in this view these processes could be considered as components that also facilitate the occurrence of the hydra effect in the spatial context of model 1 mcintire and juliano 2018 did not find evidences for the mechanism of prudent exploitation to generate hydra effect in their studied system however sieber and hilker 2012 draw attention to the importance of this mechanism in the ecological context the present work also highlights the importance of the mechanism of prudent exploitation and we think that more experimental studies are needed to further evaluate this mechanism furthermore sieber and hilker 2012 suggested to investigate the quadratic mortality which we have done in the present work for the employed set of parameter values we detected the occurrence of the hydra effect for the studied nonlinear functional responses it may be argued that some parameter values in real systems are certainly quite different from the ones employed in the analyzed models and therefore real systems might not reproduce the hydra effect presented in this work however it should be stressed that the intention of this work is to demonstrate through numerical simulations of a strategic model may 2001 the potential for the generation of the hydra effect rather than an analysis of all possible dynamical outcomes generated by diverse chosen sets of parameter values abrams and roth 1994 strategic models are those that do not usually describe the dynamics of a specific real community instead they can describe a relatively vast class of communities may 2001 in this view one could investigate for example the potential of hydra effect in spatial predator prey models for a more general class of functional responses given by f r a c r r n 1 a c r t h c r r n as a function of the steepness n see boukal et al 2007 note that functional responses type 2 and 3 are two elements of this class of functions it can be observed that for the functional responses that presented the hydra effect it occurred for narrow ranges of mc in the framework of systems of ordinary differential equations this feature also occurred not only for the corresponding non spatial models of this work supplementary material b but also for a similar non spatial predator prey model with a multiple hydra effect see costa and anjos 2018 see also liz 2017 for a multiple hydra effect in a discrete time population model 4 2 hydra effects and spatial settings predator spatial diffusivity can influence the strength of the hydra effect in the case f 2 r by shortening its interval of occurrence with increasing predator diffusivity see fig 5 our simulations also indicate that in the case f 2 r there is a predator s diffusion threshold beyond which the occurrence of the hydra effect no longer ensues we may argue that this result contradicts some predictions in the metapopulation level fox et al 2017 found that local catastrophic extinctions analogue to high mortality in our study prevents synchronization at high dispersal rates and then it gives rise to what the authors called spatial hydra effects furthermore at low dispersal rates the likelihood of metapopulation extinction is higher because there are insufficient recolonization on the other hand from what was asserted at the beginning of this paragraph the results in the present work point out that increasing the predator s diffusion coefficient shortens the interval of the hydra effect until it vanishes however there is also similarity in our results and those of fox et al 2017 if the predator s dispersal rates are sufficiently high the predator metapopulation collapses to extinction due to synchronization of local populations in our study sufficiently high dispersion also causes predator extinction it is known from the literature that the system s dynamics in reaction diffusion equations can depend on the type of initial distribution morozov and petrovskii 2009 the size of the spatial domain morozov and petrovskii 2009 the boundary conditions lewis et al 2016 and on the diffusion coefficients lewis et al 2016 accordingly the occurrence of the hydra effect and related results in this work are likely to depend on these factors in the case of f 2 r for instance it takes the form of a prominent hollow in the middle of the spatial domain the same occurs though much less accentuated in the f 3 r and f 4 r cases see supplementary material a the occurrence of the hydra effect in the middle of the spatial domain could be ascribed in part to the assumption of homogeneous dirichlet boundary conditions r 0 t r l t c 0 t c l t 0 because in the neighborhood of each boundary the dynamics are forced to behave in a way to decrease the densities until they reach zero on the other hand in the middle of the spatial domain the species density can take on any other form of distribution in this respect if we compare the boundaries of the spatial domain of the functional responses 2 fig 3 3 and 4 supplementary material a the distribution patterns corresponding to variations of mc almost coincide regarding dirichlet boundary conditions maini and myerscough 1997 show that the augmentation of the predator diffusion coefficient in a predator prey like model with dirichlet boundary conditions can stabilize the final spatial distribution of the species this stabilization manifests through the dampening of spatial fluctuations in the stationary distributions when the predator diffusion coefficient is augmented in a way it can be argued that our results are similar to those of maini and myerscough 1997 in this respect recall that we use dirichlet boundary conditions in our models the dampening of spatial fluctuations in the stationary distributions of the species occurs when the per capita density independent mortality rate of the predator mc is gradually augmented on the other hand for non flux boundary conditions neumann boundary conditions and uniform initial distributions the final distributions are likely to be also uniform medvinsky et al 2001 hence in order to assess the robustness of the results it would certainly be worthwhile to check if the dynamical outcomes presented in this study hold true for instance with neumann zero flux boundary conditions and or larger spatial domain sizes this is the subject of a forthcoming investigation regarding the size of spatial domain the f 2 r case presented spatial oscillations represented by multiple hollows across the spatial domain for l 50 supplementary material c recall that for the spatial domain l 10 hollows with distinct magnitudes occurred in the cases of all the analyzed functional responses on the other hand for a sufficiently small spatial domain with absorbing boundaries the consumer population might be vulnerable to extinction due to a rapid spatial spreading towards the boundaries where individuals cannot survive result not shown at this stage it is worth mentioning that we mainly focused on finding diffusion coefficients of prey and predator that could bring about the hydra effect in the predator in a spatial context when the hydra effect also occurs in the predator in the related non spatial predator prey model for the same set of parameter values this is probably one of the reasons for the striking difference between the magnitudes of prey and predator diffusion coefficients in our analysis of the type 2 functional response it is expected that there may be parameter values for which the hydra effect with f 2 r can occur with diffusion coefficients having less accentuated difference in their magnitudes this feature is qualitatively corroborated by a survey of data on the spatial spread rates of pest species and biocontrol agents released against them these data revealed ratios of pest spread rate to predator spread rate spanning four orders of magnitude fagan et al 2002 4 3 trophic cascade and hydra effects cortez and abrams 2016 indicates that hydra effects affect the predictions of trophic cascades through communities our analyses show that for the studied models the top down disturbance caused by an increase in the predator per capita density independent mortality rate does not necessarily create a trophic cascade at the steady state regime of a spatial predator prey interaction subject to predator hydra effects morozov and petrovskii 2009 analyzed a similar model employing a type 3 functional response in the context of biological pest control the controlling factor was assumed to be predation of the pest prey by the agent predator intensity of predation can be regulated by means of varying agent predator mortality thus a relevant controlling parameter is mc the lower is the predator per capita mortality rate mc the stronger the predator is and therefore more effective as a pest controlling factor within this setup it is intuitively expected that to keep harmful species under control the density of the controlling agent e g its predator should be sufficiently high our results concerning the lack of trophic cascade at the steady state run counter to this intuition in the hydra effect interval decreasing mc thus a stronger predator decreases the predator density and concomitantly the pest prey density consequently improving pest control our results are qualitatively in accordance with the theoretical works of zipkin et al 2008 and zipkin et al 2009 which employed control through harvest of predatory pest species by means of discrete time models parameterized with empirical data the removal of predator s individuals the fish smallmouth bass resulted in an undesired increase of the whole population zipkin et al 2008 in other words these two counter intuitive results concerning prey and predator densities while decreasing mc point out that controlling pest does not necessarily always require high densities of biocontrol agent predator in this work we showed that the addition of diffusion in three spatial predator prey models f 2 r in fig 4 and f 3 r f 4 r in the supplementary material a can maintain the hydra effect and eliminate the trophic cascade at the steady state regime a top down effect in their respective food chains for the chosen set of parameter values and initial distributions this result is in accordance with empirical studies such as for example in jopp et al 2011 that describes the movement of small fish in the presence of high density of piscivores which may decrease the strength of the top down interaction moreover as mentioned in the above paragraph our results point to the fact that there can be a positive correlation between prey and predator densities when the per capita mortality rate of the predator mc is increased i e trophic cascades at the steady state negative correlation between prey and predator densities can be eliminated in this way these processes are shown to significantly alter top down effects in a specific spatial food chain a spatial predator prey system we think this elimination of trophic cascades can be seen as a new insight in the theory of spatial food chain under top down disturbances as mentioned before the absence of trophic cascade was observed at the steady state regime future works could investigate what happens in the transient regime 4 4 how does the predator s mortality affect the occurrence of the hydra effect with regard to the hydra effect our analysis was based on the variation of the density independent per capita mortality rate of the predator namely mc however it is important to mention that there is a broader definition of the hydra effect which relates it to the increase of a species with the increase of its per capita mortality rate schröder et al 2014 this remark means that our study is amenable to search for hydra effects as a result of the increase of a density dependent mortality rate for instance qc for examples of the hydra effect in such density dependent contexts see costa et al 2017 the novel contribution of this work is the detection of hydra effect in spatial one dimensional predator prey models with functional response of type 2 3 and 4 we are not aware of such result in the theoretical literature of population dynamics dealing with systems of coupled nonlinear partial differential equations as we showed before in the three cases the area under the stationary distribution of the predator along the one dimensional spatial domain augmented when its per capita density independent death rate increased the importance of the results in terms of the predator prey theory is that the hydra effect can also be found in the spatial context of this trophic interaction in terms of future works the present study could motivate the search for the occurrence of the hydra effect in spatial predator prey models and models with different types of ecological interactions this would be in line with the assertion that the hydra effect may be ubiquitous in population models cortez and abrams 2016 4 5 other ecological interactions finally given that there is a strong interest in the spatial dynamical analysis of food webs involving among others top down and bottom up effects holt 1996 our findings indicate that one of the aspects of food web spatial dynamics that is worth studying is the occurrence of the hydra effect in the spatial context of other community modules holt 1997 we think that the venture into this area can be all the more encouraged taking into account the conditions for the hydra effect to occur in a general class of non spatial multispecies models cortez and abrams 2016 in this respect it is important to mention the occurrence of top predator hydra effect in some non spatial food web dynamical models involving three and four species in costa and anjos 2020 and also the occurrence of the hydra effect in different trophic levels of non spatial food chain models with functional response type 2 in pal et al 2019 by pooling the results of these various proposed studies in spatially structured community modules it is possible that one finds that the hydra effect may emerge in diverse spatial food webs chain the numerical findings of the hydra effect in some spatial predator prey models in this work could help bring new insights concerning the hydra effect as a possible common pattern in the context of spatial multispecies models as well as in other systems like eco epidemiology mcintire and juliano 2018 sasmal et al 2015 and public health keane 2016 thus the consequences of measures should be properly evaluated in systems subjected to hydra effects in contexts of applied ecology and applied sciences credit authorship contribution statement lucas dos anjos software formal analysis investigation writing original draft writing review editing visualization michel iskin da s costa conceptualization methodology investigation writing original draft writing review editing regina c almeida methodology software formal analysis investigation writing review editing declaration of competing interest the authors declare that they do not have any financial or nonfinancial conflict of interests acknowledgements the authors acknowledge the helpful comments and suggestions made by the reviewers on an earlier version of this work lucas dos anjos was supported by a fellowship from the institutional training program pci from ministry of science technology innovation and communication mctic grant number 301327 2020 3 supplementary material supplementary material associated with this article can be found in the online version at 10 1016 j ecolmodel 2020 109109 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 supplementary data s2 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s2 supplementary data s3 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s3 supplementary data s4 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s4 
24850,the hydra effect in ecology corresponds to the increase in the equilibrium or time averaged density of a population when its mortality rate is augmented the literature presents examples of the hydra effect in continuous as well as in discrete time population models described by nonlinear systems of ordinary differential and difference equations respectively the novelty of this work is that we show by means of numerical simulation the occurrence of the hydra effect in some stationary dynamics of one dimensional reaction diffusion predator prey models described by nonlinear systems of partial differential equations with distinct nonlinear functional responses reaction diffusion models are a set of mathematical models that take into account population dynamics and dispersal diffusivity within a predefined spatial domain we show that for a type 2 functional response an increasing diffusivity shortens the range of the hydra effect another interesting result concerns the fact that together with the hydra effect the prey density also increases with the increase of the per capita density independent mortality rate of the predator this result indicates that this top down disturbance does not necessarily create a trophic cascade in a spatial predator prey interaction at the steady state regime keywords hydra effect functional responses spatial predator prey models 1 introduction by definition the hydra effect is the increase in the equilibrium or time averaged density of a population when its mortality rate is augmented abrams 2009 abrams and matsuda 2005 this phenomenon is named hydra effect after the mythological beast that grew two heads to replace each one that was beheaded studies dealing with positive effects at the population level as a result of an increase in mortality of populations have been addressed both in theoretical cortez 2016 cortez and abrams 2016 costa and anjos 2018 liz 2017 and in empirical systems abrams 2009 cortez 2016 schröder et al 2014 zipkin et al 2009 present a list of references with empirical evidence for the hydra effect in an applied context of population control through removal of individuals of plant insect and fish populations this positive effect of mortality can have significant consequences in applied ecology and epidemiology for instance because harvest removal of species is actually an additional mortality factor for empirical examples see abrams 2009 and references therein in his review abrams 2009 puts forward three key mechanisms underlying the hydra effect the first one refers to altered variation in population size that are supposed to cause changes in the form and amplitude of cycles with greater mortality usually decreasing the amplitude of cycles and increasing population temporal average density the second mechanism is the temporal separation between mortality and density dependence abrams 2009 argues that mortality must operate before the overcompensatory density dependence to create a hydra effect finally the third mechanism asserts that changes in the interplay between consumer and resource may reduce consumption giving rise to what he called prudent resource exploitation abrams 2009 the two latter mechanisms were investigated in mcintire and juliano 2018 considering two species of aedes which act as vectors in some viral human diseases they found that mortality at the early stage yielded greater production of adults they could not find any evidence for the mechanism of prudent resource exploitation abrams 2009 in the studied species in which for this system is associated with changing in larval feeding behavior in response to water borne predation cues mcintire and juliano 2018 however such mechanism has already been identified in the theoretical study performed by sieber and hilker 2012 in which they analyzed predator prey models with type 2 and 3 functional responses sieber and hilker 2012 also point out the importance of investigating the occurrence of hydra effects in most natural ecological systems that exhibit density dependent net growth rate of the predator this would be the case for example when the density dependent mortality is driven by a quadratic term which describes competition among predator individuals for resources other than the focal prey cortez and abrams 2016 hypothesized that saturating functional responses e g type 2 and 3 and direct intraspecific predator competition increasing in predator per capita mortality rate and or decreasing functional response with predator density are two mechanisms that can lead to hydra effects the previous mentioned theoretical studies were restricted to spatially homogeneous scenarios leaving out mechanisms such as species dispersion and migration a recent review presented in deangelis and yurek 2017 highlights the increasing number of studies considering spatially explicit models in ecology by using different techniques regarding hydra effects the paper of strevens and bonsall 2011 discusses strategies of harvesting in a host parasitoid metapopulation system the bruchid beetle callosobruchus maculatus is a pest species which is parasited by the wasp anisopteromalus calandrae by means of numerical simulations and laboratory experimentation they found the hydra effect in the pest species yielding higher number of individuals in harvested metapopulations compared with unharvested metapopulations employing similar metapopulation models and laboratory experiments fox et al 2017 address the influence of the dispersal rate in some discrete and continuous time models they identified that catastrophic perturbations that causes local extinction allow metapopulation asynchrony a factor that enhanced metapopulation persistence when subject to sufficiently high dispersal rates although very high dispersion rates may prevent asynchrony and lead to species extinction the hydra effect is observed because local extinctions increased recolonization yielding metapopulation persistence thus far the hydra effect has not yet been identified in spatially explicit models considering diffusion spatial processes can be included in such models by considering systems of nonlinear partial differential equations in which species dynamics are dictated by coupled reaction diffusion equations with both dispersal and population dynamics taken into account simultaneously holmes et al 1994 the work of holmes et al 1994 presents different applications regarding the use of reaction diffusion models in ecology such as spatial patterning liu et al 2014 ecological invasions petrovskii et al 2005 and critical patch size azevedo et al 2012 in this work by means of numerical simulations of one dimensional spatial predator prey models with reaction diffusion terms and functional responses type 1 2 3 and an alternative version from upadhyay et al 2010 denoted as type 4 functional response hereinafter we investigate the occurrence of the hydra effect in the predator when its per capita density independent mortality rate is augmented of note the analysis of sieber and hilker 2012 did not include type 4 functional response because this functional response does not fit the assumption presented in the paper of predator consumption as a strictly increasing function of prey density the inclusion of functional response type 4 rests upon two characteristics not shared with functional responses type 2 and 3 i it is a non saturating functional response ii it models a possible antipredatory behavior of the prey kot 2001 upadhyay et al 2010 such as the case of dangerous prey in spider ant interactions líznarová and pekár 2013 the antipredatory behavior of the prey can cause a prudent exploitation of the prey resource by the predator consumer and as mentioned before this item can be an underlying reason for the occurrence of the hydra effect abrams 2009 we also investigate how the diffusivity affects the occurrence of the hydra effect in type 2 functional response by varying the diffusion intensities of the consumer population in essence the aim of the present work is to find at least one instance of the predator hydra effect in each of the above mentioned functional responses we think that among other things this result is important because to our knowledge this type of behavior has not been reported in the literature of theoretical modeling of spatial multispecies dynamics with reaction diffusion to corroborate our view in a recent paper pal et al 2019 suggested the investigation of the possible occurrence of the hydra effect in spatially structured systems in a perspective of theoretical population dynamics as one of the potential directions of search for this phenomenon the outline of the work is as follows section 2 presents the mathematical models employed in the present work section 3 presents the results of the analyses of the functional responses type 1 and 2 and in section 4 we discuss our findings additional relevant issues for the present analysis are presented in the supplementary materials supplementary material a contains instances of the hydra effect in one dimensional spatial predator prey models with functional responses types 3 and 4 and predator s density dependent mortality supplementary material b presents bifurcation diagrams of the non spatial models with functional responses type 2 3 and 4 supplementary material c shows the steady state spatial distribution of predator resulting from model simulations for functional responses type 2 3 and 4 with a larger domain length finally supplementary material d shows the occurrence of the hydra effect for type 2 functional response without the predator s density dependent mortality 2 methods 2 1 general description of the predator prey model in this section we present the general spatial predator prey model that will be analyzed throughout the work this model is defined in the one dimensional spatial temporal domain 0 l 0 t and reads as follows 1 r t d r 2 r x 2 r r 1 r k f r c c t d c 2 c x 2 e f r c f r c m c c q c c 2 r and c are the densities of prey and predator individuals respectively and the prey grows according to a logistic equation the predator possesses both a density independent and a density dependent per capita mortality rate the reactive part of the model 1 is based on costa and anjos 2018 which encountered multiple hydra effects for the type 2 functional response with allee effects acting on the predator population we analyze different types of functional response f i r i 1 2 3 4 namely type 1 2 3 and 4 functional responses the definition of variables and parameters used in this work are displayed in table 1 all parameters are strictly positive constants we employ one spatial dimension because it is the simplest form to deal with spatial spread where it is assumed that species movement occurs in one spatial dimension and population density varies in just one dimension vitense et al 2016 this spatial feature in the model could be ascribed for instance to environmental conditions that can create a preferential direction of diffusion soboleva et al 2003 2 2 functional responses in the following the two considered models based on a set of spatial predator prey models in biological pest control lewis et al 2016 are obtained from eq 1 by setting either a type 1 functional response 2 f 1 r a c r r or a type 2 functional response 3 f 2 r a c r r 1 a c r t h c r r in these relations acr is the attack coefficient of species c on species r thcr is the manipulation time of species c on species r as mentioned before our study also encompasses type 3 and 4 functional responses whose analysis are shown in the supplementary material a 2 3 model settings given a set of parameter values we evaluate the role of parameter mc in the occurrence of the hydra effect for each considered model to set such a scenario we first analyze the corresponding non spatial model and varied systematically the parameter values with the intention to create when possible an occurrence of the predator hydra effect in this context the bifurcation analysis presented in supplementary material b shows the results for the non spatial models such a set is then used in the spatial model and we perform extensive simulations to find the diffusivity coefficients for prey and predator species so as to generate the hydra effect in the spatial context this procedure is repeated for every considered model we assume that the initial spatial distributions of prey and predator are uniform along the domain except on the boundaries in this regard we set r x 0 1 2 and c x 0 1 for all simulations we apply homogeneous dirichlet boundary conditions that is r 0 t r l t c 0 t c l t 0 these boundary conditions can represent a land with plant cultivation where pest and agent individuals cannot survive on and beyond its borders because outside the domain lies an inhospitable environment such as a roadway hence these boundaries are said to be of absorbing type with respect to the choice of these boundary conditions it is important to mention that the hostile environment boundary condition we have assumed in this work dirichlet boundary conditions has also been employed in other biological setups such as plankton blooms critical plankton filaments fish populations in marine protected areas annual plants and bacterial colonies under ultraviolet light see méndez et al 2011 and references therein before proceeding we mention that the analyses in this work are undertaken as they stand that is we do not convert to dimensionless variables and parameters the main drive of our choice is the flexibility of separately analyzing cases for any chosen set of parameters of the studied model kot 2001 thus given a set of parameter values we evaluate the role of parameter mc in the occurrence of the hydra effect for each considered model finally it is important to remark that as we focus on finding the hydra effect in predator prey spatial models with stationary final distributions we dismiss set of parameter values that create distributions with spatiotemporal oscillations as in the paper of cortez and abrams 2016 2 4 numerical solution the models with the studied functional responses analyzed here are numerically solved following the assumptions and the numerical procedure described below the partial differential equations were solved numerically by using the finite differences method to this end the spatial domain is uniformly discretized into n parts so that δ x l n and δt is the time discretization model evaluation continues until a steady state solution is reached thus throughout this work the simulations are carried out until a time at which no more changes in the species distributions are detected these distributions are called final species distributions convergence to steady state is then defined by comparing both prey and predator populations of two subsequent time steps if their absolute values are smaller than the tolerance of 10 10 the program stops running if convergence is not achieved the simulation continues until a maximum time t 1000 is reached this criterion is necessary for avoiding infinite loops caused by a limit cycle the crank nicolson method is used to approximate the time derivative and the second order operator is approximated by central differences leveque 2007 the resulting system of algebraic equations is linearized using the picard method and solved by uncoupling the equations using a gauss seidel structure finally the associated systems of algebraic equations are solved by using the conjugate gradient method leveque 2007 in all simulations the spatial domain ranges from x 0 to x l 10 we set δ x 0 05 corresponding to a uniform spatial discretization with n 200 and δ t 0 01 which yield convergent discrete approximations in order to detect the occurrence of the hydra effect we simulate the models until we get the stable stationary final distribution for a arbitrarily decided range of increasing mc in the procedure of model simulation we calculate the integrated abundance through space iatsi i r c for prey and predator this quantity represents the total number of individuals over the considered spatial domain after this step we have a list of iats for the range of mc employed in the analysis these values of iats can be compared to identify if the population density increased or decreased with increasing mc specifically for each two consecutive values of mc we compared the corresponding values of iats of the predator if the value of iatsc increases we have an instance of predator hydra effect 3 results we analyzed the steady state solutions of the spatial explicitly model for type 1 and 2 functional responses the computational domain length is set l 10 in supplementary materials b and c we present the bifurcation diagrams for the non spatial counterpart of model for the employed functional responses and the model outcomes for a larger domain length respectively 3 1 type 1 functional response beforehand it is important to recall that there is no evidence in the literature of the hydra effect for type 1 functional response spatially homogeneous models cortez and abrams 2016 sieber and hilker 2012 thus to check the occurrence of hydra effects in the present analysis we performed extensive numerical experiments to cover a wide range of the parametric space we consistently obtained the typical spatial distribution of predator depicted in fig 1 for two different values of the per capita mortality rate of the predator m c 0 02 and m c 0 025 while keeping the other parameters fixed notice that the increase of mc leads to a decrease in the predator population indicating the absence of the hydra effect we also simulate the model for a wider range values of the predator per capita mortality rate varying mc from 0 02 to 0 025 with steps of 0 001 while keeping the other parameters fixed the values of the iats for the increasing values of mc at the steady state are shown in fig 2 notice that the reduction in the population of predators is accompanied by the increase of the prey population reflecting a trophic cascade generated by a top down disturbance these parameter specific results corroborate the fact that in continuous time and unstructured predator prey models the predator needs to possess a nonlinear functional response so that a hydra effect occurs cortez and abrams 2016 sieber and hilker 2012 3 2 type 2 functional response according to the usual definition of hydra effect abrams 2009 an increase in the population density should follow an increase in its density independent per capita mortality rate this dynamical outcome is shown next by numerical simulations of model 1 with type 2 functional response when altering the predator density independent per capita mortality rate mc when mc is increased from 0 0201 to 0 0202 the predator density increases in the spatial domain fig 3 exhibiting a hydra effect to investigate the sensitivity of the hydra effect with the variation of the predator density independent per capita mortality rate we simulate the model for increasing values of mc beginning with m c 0 02 with steps of 0 0001 to obtain the values of the iats for both predator and prey populations as displayed in fig 4 a hydra effect in the predator population occurs for 0 02 mc 0 0205 notice that an increase of mc from 0 0201 to 0 0202 as showed in fig 3 amounts to an abrupt increase of 5 42 in the iats of the predator such change in the iatsc could be related to the presence of a bifurcation point in the corresponding non spatial model see fig 1 of the supplementary material b as mc takes on higher values than 0 0202 we note a reduction in the increase of the iats of the predator until the hydra effect disappears for mc greater than 0 0205 moreover the left panel of fig 4 also shows that the small top down disturbance i e increase in the density independent per capita mortality rate of the predator mc along the referred interval augments the prey population over part of the mc range explored in the table this outcome indicates that the augmentation of mc between 0 02 and 0 0205 does not create a trophic cascade at the steady state regime in the analyzed ditrophic food chain despite it is out of the scope of this work the analysis of the transient could also bring further insights the results of f 3 r and f 4 r are qualitative similar to the results of the f 2 r they both showed the hydra effect for some range of mc these results are shown in the supplementary material a 3 3 influence of the predator diffusion coefficient on the interval of the hydra effect in the case of type 2 functional response given the spatial context of this work it would be interesting to assess how the predator diffusivity affects its own hydra effect as an example for the assessment of the influence of the predator diffusivity on the magnitude of the mc interval where the predator hydra effect occurs we identify the interval of mc for which the hydra effect occurs at steady state solution of model 1 with f 2 r for a variety of values of predator diffusivity the resulting diagram is depicted in fig 5 as dc increases the interval of mc for which the predator hydra effect occurs decreases until disappearing for dc 1 05 the range of mc that causes the hydra effect becomes shorter with increasing diffusivity and the minimum value of these mc ranges first increases and then decreases with increasing diffusivity fig 5 this behavior occurs because the diffusion becomes more influential when dc increases and in turn it does not facilitate the emergence of the predator hydra effect 4 discussion 4 1 hydra effect in spatial predator prey models with nonlinear functional responses the occurrence of the hydra effect for the selected nonlinear functional responses indicates that this phenomenon can arise even in spatially explicit models it is important to remark that the hydra effect found in this work occurs for nonlinear saturating f 2 r and f 3 r as well as non saturating functional responses f 4 r despite the narrow range of parameter values the presence of the predator hydra effect across different functional responses points to the fact that the occurrence of the hydra effect in natural populations can be in some way more common than expected in non spatial models two processes can induce the hydra effect by means of the mechanism of prudent resource exploitation abrams 2009 i saturating functional responses cortez and abrams 2016 sieber and hilker 2012 according to abrams 2009 a type 2 functional response causes the reduction in attack rate due to increased handling time with greater prey abundance likewise we could argue that the same is valid for a type 3 functional response ii direct intraspecific predator competition cortez and abrams 2016 which in our studied models takes the form of the quadratic mortality rate in the predator qcc 2 however item ii is not a necessary condition for the hydra effect in the predator to occur see supplementary material d for an example of occurrence of the hydra effect for f 2 r when q c 0 in this view these processes could be considered as components that also facilitate the occurrence of the hydra effect in the spatial context of model 1 mcintire and juliano 2018 did not find evidences for the mechanism of prudent exploitation to generate hydra effect in their studied system however sieber and hilker 2012 draw attention to the importance of this mechanism in the ecological context the present work also highlights the importance of the mechanism of prudent exploitation and we think that more experimental studies are needed to further evaluate this mechanism furthermore sieber and hilker 2012 suggested to investigate the quadratic mortality which we have done in the present work for the employed set of parameter values we detected the occurrence of the hydra effect for the studied nonlinear functional responses it may be argued that some parameter values in real systems are certainly quite different from the ones employed in the analyzed models and therefore real systems might not reproduce the hydra effect presented in this work however it should be stressed that the intention of this work is to demonstrate through numerical simulations of a strategic model may 2001 the potential for the generation of the hydra effect rather than an analysis of all possible dynamical outcomes generated by diverse chosen sets of parameter values abrams and roth 1994 strategic models are those that do not usually describe the dynamics of a specific real community instead they can describe a relatively vast class of communities may 2001 in this view one could investigate for example the potential of hydra effect in spatial predator prey models for a more general class of functional responses given by f r a c r r n 1 a c r t h c r r n as a function of the steepness n see boukal et al 2007 note that functional responses type 2 and 3 are two elements of this class of functions it can be observed that for the functional responses that presented the hydra effect it occurred for narrow ranges of mc in the framework of systems of ordinary differential equations this feature also occurred not only for the corresponding non spatial models of this work supplementary material b but also for a similar non spatial predator prey model with a multiple hydra effect see costa and anjos 2018 see also liz 2017 for a multiple hydra effect in a discrete time population model 4 2 hydra effects and spatial settings predator spatial diffusivity can influence the strength of the hydra effect in the case f 2 r by shortening its interval of occurrence with increasing predator diffusivity see fig 5 our simulations also indicate that in the case f 2 r there is a predator s diffusion threshold beyond which the occurrence of the hydra effect no longer ensues we may argue that this result contradicts some predictions in the metapopulation level fox et al 2017 found that local catastrophic extinctions analogue to high mortality in our study prevents synchronization at high dispersal rates and then it gives rise to what the authors called spatial hydra effects furthermore at low dispersal rates the likelihood of metapopulation extinction is higher because there are insufficient recolonization on the other hand from what was asserted at the beginning of this paragraph the results in the present work point out that increasing the predator s diffusion coefficient shortens the interval of the hydra effect until it vanishes however there is also similarity in our results and those of fox et al 2017 if the predator s dispersal rates are sufficiently high the predator metapopulation collapses to extinction due to synchronization of local populations in our study sufficiently high dispersion also causes predator extinction it is known from the literature that the system s dynamics in reaction diffusion equations can depend on the type of initial distribution morozov and petrovskii 2009 the size of the spatial domain morozov and petrovskii 2009 the boundary conditions lewis et al 2016 and on the diffusion coefficients lewis et al 2016 accordingly the occurrence of the hydra effect and related results in this work are likely to depend on these factors in the case of f 2 r for instance it takes the form of a prominent hollow in the middle of the spatial domain the same occurs though much less accentuated in the f 3 r and f 4 r cases see supplementary material a the occurrence of the hydra effect in the middle of the spatial domain could be ascribed in part to the assumption of homogeneous dirichlet boundary conditions r 0 t r l t c 0 t c l t 0 because in the neighborhood of each boundary the dynamics are forced to behave in a way to decrease the densities until they reach zero on the other hand in the middle of the spatial domain the species density can take on any other form of distribution in this respect if we compare the boundaries of the spatial domain of the functional responses 2 fig 3 3 and 4 supplementary material a the distribution patterns corresponding to variations of mc almost coincide regarding dirichlet boundary conditions maini and myerscough 1997 show that the augmentation of the predator diffusion coefficient in a predator prey like model with dirichlet boundary conditions can stabilize the final spatial distribution of the species this stabilization manifests through the dampening of spatial fluctuations in the stationary distributions when the predator diffusion coefficient is augmented in a way it can be argued that our results are similar to those of maini and myerscough 1997 in this respect recall that we use dirichlet boundary conditions in our models the dampening of spatial fluctuations in the stationary distributions of the species occurs when the per capita density independent mortality rate of the predator mc is gradually augmented on the other hand for non flux boundary conditions neumann boundary conditions and uniform initial distributions the final distributions are likely to be also uniform medvinsky et al 2001 hence in order to assess the robustness of the results it would certainly be worthwhile to check if the dynamical outcomes presented in this study hold true for instance with neumann zero flux boundary conditions and or larger spatial domain sizes this is the subject of a forthcoming investigation regarding the size of spatial domain the f 2 r case presented spatial oscillations represented by multiple hollows across the spatial domain for l 50 supplementary material c recall that for the spatial domain l 10 hollows with distinct magnitudes occurred in the cases of all the analyzed functional responses on the other hand for a sufficiently small spatial domain with absorbing boundaries the consumer population might be vulnerable to extinction due to a rapid spatial spreading towards the boundaries where individuals cannot survive result not shown at this stage it is worth mentioning that we mainly focused on finding diffusion coefficients of prey and predator that could bring about the hydra effect in the predator in a spatial context when the hydra effect also occurs in the predator in the related non spatial predator prey model for the same set of parameter values this is probably one of the reasons for the striking difference between the magnitudes of prey and predator diffusion coefficients in our analysis of the type 2 functional response it is expected that there may be parameter values for which the hydra effect with f 2 r can occur with diffusion coefficients having less accentuated difference in their magnitudes this feature is qualitatively corroborated by a survey of data on the spatial spread rates of pest species and biocontrol agents released against them these data revealed ratios of pest spread rate to predator spread rate spanning four orders of magnitude fagan et al 2002 4 3 trophic cascade and hydra effects cortez and abrams 2016 indicates that hydra effects affect the predictions of trophic cascades through communities our analyses show that for the studied models the top down disturbance caused by an increase in the predator per capita density independent mortality rate does not necessarily create a trophic cascade at the steady state regime of a spatial predator prey interaction subject to predator hydra effects morozov and petrovskii 2009 analyzed a similar model employing a type 3 functional response in the context of biological pest control the controlling factor was assumed to be predation of the pest prey by the agent predator intensity of predation can be regulated by means of varying agent predator mortality thus a relevant controlling parameter is mc the lower is the predator per capita mortality rate mc the stronger the predator is and therefore more effective as a pest controlling factor within this setup it is intuitively expected that to keep harmful species under control the density of the controlling agent e g its predator should be sufficiently high our results concerning the lack of trophic cascade at the steady state run counter to this intuition in the hydra effect interval decreasing mc thus a stronger predator decreases the predator density and concomitantly the pest prey density consequently improving pest control our results are qualitatively in accordance with the theoretical works of zipkin et al 2008 and zipkin et al 2009 which employed control through harvest of predatory pest species by means of discrete time models parameterized with empirical data the removal of predator s individuals the fish smallmouth bass resulted in an undesired increase of the whole population zipkin et al 2008 in other words these two counter intuitive results concerning prey and predator densities while decreasing mc point out that controlling pest does not necessarily always require high densities of biocontrol agent predator in this work we showed that the addition of diffusion in three spatial predator prey models f 2 r in fig 4 and f 3 r f 4 r in the supplementary material a can maintain the hydra effect and eliminate the trophic cascade at the steady state regime a top down effect in their respective food chains for the chosen set of parameter values and initial distributions this result is in accordance with empirical studies such as for example in jopp et al 2011 that describes the movement of small fish in the presence of high density of piscivores which may decrease the strength of the top down interaction moreover as mentioned in the above paragraph our results point to the fact that there can be a positive correlation between prey and predator densities when the per capita mortality rate of the predator mc is increased i e trophic cascades at the steady state negative correlation between prey and predator densities can be eliminated in this way these processes are shown to significantly alter top down effects in a specific spatial food chain a spatial predator prey system we think this elimination of trophic cascades can be seen as a new insight in the theory of spatial food chain under top down disturbances as mentioned before the absence of trophic cascade was observed at the steady state regime future works could investigate what happens in the transient regime 4 4 how does the predator s mortality affect the occurrence of the hydra effect with regard to the hydra effect our analysis was based on the variation of the density independent per capita mortality rate of the predator namely mc however it is important to mention that there is a broader definition of the hydra effect which relates it to the increase of a species with the increase of its per capita mortality rate schröder et al 2014 this remark means that our study is amenable to search for hydra effects as a result of the increase of a density dependent mortality rate for instance qc for examples of the hydra effect in such density dependent contexts see costa et al 2017 the novel contribution of this work is the detection of hydra effect in spatial one dimensional predator prey models with functional response of type 2 3 and 4 we are not aware of such result in the theoretical literature of population dynamics dealing with systems of coupled nonlinear partial differential equations as we showed before in the three cases the area under the stationary distribution of the predator along the one dimensional spatial domain augmented when its per capita density independent death rate increased the importance of the results in terms of the predator prey theory is that the hydra effect can also be found in the spatial context of this trophic interaction in terms of future works the present study could motivate the search for the occurrence of the hydra effect in spatial predator prey models and models with different types of ecological interactions this would be in line with the assertion that the hydra effect may be ubiquitous in population models cortez and abrams 2016 4 5 other ecological interactions finally given that there is a strong interest in the spatial dynamical analysis of food webs involving among others top down and bottom up effects holt 1996 our findings indicate that one of the aspects of food web spatial dynamics that is worth studying is the occurrence of the hydra effect in the spatial context of other community modules holt 1997 we think that the venture into this area can be all the more encouraged taking into account the conditions for the hydra effect to occur in a general class of non spatial multispecies models cortez and abrams 2016 in this respect it is important to mention the occurrence of top predator hydra effect in some non spatial food web dynamical models involving three and four species in costa and anjos 2020 and also the occurrence of the hydra effect in different trophic levels of non spatial food chain models with functional response type 2 in pal et al 2019 by pooling the results of these various proposed studies in spatially structured community modules it is possible that one finds that the hydra effect may emerge in diverse spatial food webs chain the numerical findings of the hydra effect in some spatial predator prey models in this work could help bring new insights concerning the hydra effect as a possible common pattern in the context of spatial multispecies models as well as in other systems like eco epidemiology mcintire and juliano 2018 sasmal et al 2015 and public health keane 2016 thus the consequences of measures should be properly evaluated in systems subjected to hydra effects in contexts of applied ecology and applied sciences credit authorship contribution statement lucas dos anjos software formal analysis investigation writing original draft writing review editing visualization michel iskin da s costa conceptualization methodology investigation writing original draft writing review editing regina c almeida methodology software formal analysis investigation writing review editing declaration of competing interest the authors declare that they do not have any financial or nonfinancial conflict of interests acknowledgements the authors acknowledge the helpful comments and suggestions made by the reviewers on an earlier version of this work lucas dos anjos was supported by a fellowship from the institutional training program pci from ministry of science technology innovation and communication mctic grant number 301327 2020 3 supplementary material supplementary material associated with this article can be found in the online version at 10 1016 j ecolmodel 2020 109109 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 supplementary data s2 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s2 supplementary data s3 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s3 supplementary data s4 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s4 
24851,soils form the foundation of terrestrial ecosystems that regulate the processes and functions driving ecosystem goods and services provisions that humans rely on including agriculture pressing agricultural resource challenges persist including those involving irrigation fertilization and salinization due to the complex coupled and feedback driven connectivity of various soil processes that are difficult to manage soil moisture dynamics cross cut these processes and is a logical integration point for generating understanding and new insights for improved agroecosystem management this paper presents an integrated soil water nutrient plant interaction model built within a system dynamics framework with the purpose of replicating soil moisture evolution for a set of unique soils and climates examining model performance given common irrigation e g frequency and application rates and crop management considerations e g fertilization tillage cover cropping and evaluating via sensitivity analysis model robustness and quantifying influential management parameters effect on core bio physical feedbacks at the soil level the model has four main state variables soil moisture soil nitrogen soil sodium and plant canopy cover that interact dynamically via feedback processes formulated as coupled partial differential equations between them exogenous variables included precipitation time series data and required climatic parameters to determine reference potential evapotranspiration the time unit used from simulation was 1 day time step 0 25 with a simulation horizon of 365 days the model was calibrated using a variety of sources in the literature and with comparison to observed soil moisture data from four sites in texas usa and evaluated statistically for accuracy mean bias precision coefficient of determination and overall fit theil inequality statistics sensitivity analyses were conducted for a variety of hydroclimate forcing and irrigation fertilization and crop management decisions to examine the impacts to soil moisture evolution soil salinity and cropping profitability among other variables calibration results showed high degrees of agreement between observed and predicted values mean r2 0 67 mean bias 0 008 sensitivity results demonstrated that precipitation frequency was more influential than precipitation depth in regulating soil moisture that irrigation threshold i e the soil moisture level inducing irrigation was the variable most influential to crop profitability which was maximized at the lowest irrigation threshold value and that several conservation management strategies i e no till with residue management or cover cropping improved soil moisture and crop profitability contrary to common management perceptions several other tests for alternative fertilization irrigation and tile drain installation strategies produced results that corroborate common observations of agroecosystem management i e despite environmental risks crop profitability was enhanced future model extensions include expansion of the irrigation fertilization and crop management decision making factors to better capture how decisions that respond to economic and policy signals influence resource use and soil system dynamics modeling these complex feedback driven agroecosystems processes remains an arena for future modeling innovations that will support important resource management improvements keywords soil moisture irrigation fertilization soil salinity agroecosystems system dynamics 1 introduction soils are the foundation of terrestrial ecosystems and as such functioning soil systems are critical to the sustainability of ecosystem processes particularly nutrient cycling of carbon nitrogen and water adhikari and hartemink 2016 swift et al 2004 that provide wide ranging ecosystem goods and services for human well being adhikari and hartemink 2016 including agricultural production power 2010 humans rely on these processes for the regulation and provisioning of food production as well as fresh water the sustainability of these functions are currently at risk due to agricultural intensification and expansion of cultivated landscapes both considered vital strategies to meet rising food feed and bioenergy demand induced by global population growth alexander et al 2015 power 2010 turner et al 2018a unfortunately both cultivation expansion extensification and intensification increased factor productivity on existing agricultural lands have created a number of unintended consequences that may weaken efforts to achieve global food security including but not limited to groundwater depletion water quality contamination increased greenhouse gas emissions loss of soil organic carbon soil erosion by both wind and water and soil salinization turner et al 2018a turner et al 2018b horrigan et al 2002 hurni et al 2015 these factors and others e g irrigation fertilization and leaching may be collectively called 21st century challenges for agriculture due to the complex coupled feedback driven connectivity that arise in attempts to meet growing societal demands figure 1 for example increased groundwater pumping for irrigation reduces water table levels which may inadvertently raise groundwater salinity levels and exacerbate soil salinity problems with continued irrigation applications gates et al 2002 konikow 2013 konikow and kendy 2005 konikow and person 1985 smedema and shiati 2002 texas water development board 2019 united states department of agriculture 2014 a typical response to this problem is to flush the salts out by still additional water applications agricultural intensification via crop selection for maximum yields can also lead to heavy or over fertilization of nutrients which are subject to leaching into water supplies and reduces soil microbial activity needed to sustain organic carbon levels carpenter et al 1998 matson et al 1997 scanlon et al 2007 tilman et al 2002 international fertilizer association 2019 become reliant on chemical treatments to limit pest damages which accelerates pest genetic selection for chemical resistance denholm 1998 kranthi et al 2002 pimentel et al 1992 international fertilizer association 2012 tilman et al 2002 and conventional tillage which exposes the soil surface and accelerates erosion turner et al 2018a 2018b montgomery 2007 nearing et al 2017 nearing et al 2005 twenty first century agricultural resource problems are therefore fundamentally coupled soil crop and water management problems since hydrologic processes and soil functions are not independent but are interlinked co dependent this makes agricultural soil system management defined here as management of the aboveground processes and disturbances of the soil surface down to the bottom of the rooting zone a critical leverage point for mitigating these systemic problems as just indicated typical management decisions including irrigation fertilization and crop and tillage decisions collectively can either strengthen or weaken the ability of a soil systems to function such as nutrient retention water cycling and shallow groundwater recharge adhikari and hartemink 2016 turner et al 2018a 2018b fernald et al 2010 to add to the complexity that arises between soil processes and management decisions is the extreme hydro climate variability both spatially and temporally that further complicates irrigation planning and control fertilization efficiency and crop productivity and profitability daly and porporato 2006 the central problem of this variability stems from the unpredictability of precipitation droogers et al 2000 which is expected to become more variable under projected climate change mendelsohn et al 2007 motha and baier 2005 given the connectivity between soil processes and agricultural decisions both of which are in part driven by this extreme hydro climate variability particularly precipitation understanding complex resource management problems requires a means to integrate the underlying dynamics of multiple soil hydrologic nutrient and human related factors e g socio hydrology dynamics in fernald et al 2012 gunda et al 2018 turner et al 2016a or agricultural land use dynamics in menendez et al 2019 turner et al 2016b turner et al 2017a soil moisture dynamics cross cuts each of these factors and a logical integration point for several reasons first soil moisture dynamics provide a link between precipitation variability and therefore irrigation demands and plant productivity and therefore profitability abd and ali 2013 ali et al 2007 porporato et al 2015 porporato et al 2001 soil physical properties control the intensity and duration of soil water deficit since these properties drive the soil moisture dynamics international fertilizer association 2007 porporato et al 2001 power 2010 stephenson 1990 swift et al 2004 and soil water deficits in turn regulates plant physiology since plants must uptake water from the soil falkenmark and rockstrom 2006 second plants productivity may be reduced to levels observed under drought conditions even with acceptable precipitation due to poor soil characteristics particularly regarding soil hydrologic functions such as soil moisture retention branson et al 1970 branson et al 1976 daubenmire 1968 harrington 1991 newman 1967 nilsen and orcutt 1998 sadras and angus 2006 vico and porporato 2013 third soil water stress is often the reason for poor plant nutrient uptake particularly nitrogen since soil moisture regulates ammonification and nitrification and this total plant nutrient uptake bennett et al 1989 brady and weil 1996 larcher 1995 manzoni and porporato 2009 nilsen and orcutt 1998 wang et al 2012 soil moisture is therefore a key system component capable of integrating the soil system dynamics arising from soil climate vegetative crop management irrigation and fertilization characteristics and the interacting feedbacks between factors across evapotranspiration et regimes seneviratne et al 2010 understanding these complex feedbacks and the implications they have on agroecosystem management could be aided by the use of a dynamic systems approach capable of modeling coupled soil plant water dynamics in relatively simple and parsimonious means the discipline of ecohydrology has provided a hydrologic foundation from which to understand observed vegetation characteristics due to the linkages and flows between climate e g stochastic precipitation soil properties e g soil water holding capacity and vegetation through soil moisture mediated plant transpiration rodriguez iturbe et al 1999 rodriguez iturbe 2000 rodriguez iturbe et al 2001 porporato et al 2002 illustrated in figure 2 well documented ecohydrology models have focused on development and analysis of analytic expressions and probability density functions that describe soil moisture characteristics e g porporato et al 2002 de michele et al 2008 laio et al 2001a laio et al 2001b porporato et al 2015 porporato et al 2001 and only more recently matching model predicted values with observed levels of soil moisture e g kumar et al 2013 pan et al 2015 turner 2017b xia and shao 2008 ecohydrologic models have focused on semi arid ecosystems like rangelands or savannas because they are primarily water controlled i e rainfall dependent have vegetation characteristics that are reflective of historical climate regimes and soil properties and where vegetation often exerts control on watershed balances through myriad land atmosphere feedbacks more recently however ecohydrologic models have been recognized as useful frameworks for investigating agricultural soil problems such as irrigation fertilization and salinity dynamics due to their parsimonious representation of soil processes ability to capture both stochastic and dynamic coupling between state variables and given that the underlying assumptions regarding soil and plant characteristics are well matched with typical agroecosystem porporato et al 2015 the objectives of this work were to 1 utilize the foundational framework described in the ecohydrology literature to develop a dynamic plant soil water nutrient model robust enough to adequately replicate the soil moisture evolution for a variety of soils and climate conditions 2 overlay the model with common irrigation and crop management considerations including irrigation method timing and application volume fertilization times and volumes and no till practices with crop residue management or cover cropping and 3 evaluate the model using a variety of sensitivity analyses to examine both model robustness and quantify which parameters are most influential to the core bio physical feedbacks included in the model the remainder of the paper follows with a description of the development of the model and the calibration and evaluation procedures employed to verify its ability to adequately capture the high level feedbacks operating within a coupled plant soil water agroecosystem then several hypothesis tests are applied to the model regarding crop and irrigation decision making across a variety of landscape and climatic conditions results are then provided with a discussion centered in the context of sustainability of soil and water resources and agricultural profitability given 21st century agricultural and land use pressures we conclude with several recommendations and outline future research directions and model applications for both sustainability research and teaching 2 materials and methods 2 1 model overview the model represents a soil water nutrient plant continuum which integrates inflows and outflows of water and nutrients through feedbacks between soil moisture s expressed as a percentage of field capacity and plant productivity c representing the percentage of soil surface covered with the interaction effects of nutrient balances nitrogen and sodium and management factors cropping and irrigation decisions the model has four main state variables soil moisture soil nitrogen soil sodium and canopy cover which interact dynamically through various feedbacks between each other feedback mechanisms formulated as coupled partial differential equations link s and c dynamics through a variety of processes including infiltration and interception capturing infiltration excess runoff dynamics evapotranspiration rates which drive plant production or induce plant stress nitrogen uptake which either reinforces plant canopy growth nitrogen leaching an important factor for crop management as well as environmental quality sodium accumulation which may reduce plant water update and irrigation decisions which can respond to soil moisture conditions as well as influence nitrogen or sodium dynamics while crop biomass production or yield is driven by the outcomes of the system canopy cover does interact dynamically with water and nutrient balances via its influence on interception and transpiration terms exogenous variables included precipitation time series data input and required climatic parameters to determine reference or potential evapotranspiration et the coupled soil water plant model conceptualized in figure 3 was constructed using the system dynamics sd modeling environment vensim ventana systems inc cambridge ma usa the time unit used from simulation was 1 day with time step 0 25 and a simulation time horizon of 365 days the main strengths of using the sd platform was the ease with which the high number of feedback mechanisms could be formalized as integrated coupled difference equations a rapid simulation time and a visually appealing means in which to incorporate the dynamics of interest turner et al 2016c the model was used to examine the various trajectories in soil moisture nutrient balances and profitability response given alternative agroecosystem features and management decisions in the sections that follow we describe in detail the soil water plant model components and their feedback connections many aspects of which have been derived replicated or extended from a variety of other soil moisture crop or nutrient models kumar et al 2013 laio et al 2001a laio et al 2001b manzoni and porporato 2009 mau and porporato 2015 pelak et al 2017 porporato et al 2015 porporato et al 2001 rodriguez iturbe et al 2001 vico and porporato 2011a vico and porporato 2011b vico and porporato 2013 but that have not been integrated into one cohesive model key model variable names and equations are provided in the sections that follow additional descriptions of variable names symbols parameter values and their sources are provided in the appendix 2 2 soil water balance dynamics soil moisture was modeled as the balance between moisture gains precipitation and irrigation and losses evapotranspiration and leakage expressed as 1 n z r ds dt r t i s t et s t c t q s t where n is the soil porosity zr is the active soil rooting depth s is the vertically averaged relative soil moisture content 0 s 1 where 1 is fully saturated conditions r t represents the inflow of rainfall over time while i s t is the inflow from irrigation applications et s t c t is the coupled water losses from evaporation and transpiration modulated by s and canopy cover c t q s t represents the coupled losses from runoff and percolation below the rooting zone zr and dt is the integration delta time for full methodological considerations see laio et al 2001a laio et al 2001b porporato et al 2015 porporato et al 2001 rodriguez iturbe et al 2001 the simplifying assumptions of this soil water balance approach were that root growth not modeled here is restricted to zr such that the soil column is relatively uniform in composition and hydraulic redistribution throughout zr allows for water to flow to areas of lower saturation previous soil water balance models have explored the stochastic nature of precipitation times and depths laio et al 2001a laio et al 2001b rodriguez iturbe et al 2001 here stochastic precipitation r t representing a semi arid rain fed environment was used for model development where the average precipitation arrival time followed the poisson distribution mean arrival time 1 21 day 1 mean precipitation depth 0 4 cm respectively the irrigation term i s t represents the irrigation rate as a function of s and t depending on the irrigation method e g drip flood spray and decision rule used i e the frequency and volume of desired irrigation applications the decision rules of the irrigation term require that an irrigation intervention threshold ii and target soil moisture level it be set both ii and it are expressed as a soil moisture percentage of field capacity the intervention threshold ii indicates the point at which irrigation is induced while the target soil moisture level it indicates the point at which irrigation will cease once s reaches or exceeds it water applied directly to the surface via drip or flood irrigation become subject to the dynamics of s while water applied aerially via sprinkler or pivot irrigation is subject to canopy interception and runoff prior to the s dynamics in the soil column the evapotranspiration rate et was assumed proportional to s and c such that et s t c t e t lsw c t k c b e t 0 where etlsw represents the water stress coefficient due to limited soil water availability c t is canopy cover kcb is the basal crop coefficient after allen et al 1998 and et0 is the potential evapotranspiration which was calculated using the hargraeves method to minimize required input data latitude and monthly mean maximum and minimum temperatures hargreaves 1975 hargreaves and allen 2003 the water stress coefficient etlsw is given as a function of s t 2 e t lsw e t w s s h s w s h e t w e t 0 e t w s s w s s w e t 0 s h s s w s w s s s s 1 where s is the soil moisture value below which plants become stressed and begin stomatal closure sw is the soil moisture value inducing plant wilting point sh is the soil moisture value crossing the plant hygroscopic point beyond which moisture losses cease and etw is the reduced evapotranspiration rate under wilting conditions following similar conventions used in porporato et al 2001 porporato et al 2005 laio et al 2001a laio et al 2001b pelak et al 2017 rodriguez iturbe et al 2001 additionally evaporation rate e was explicitly decomposed within et via an evaporation reduction coefficient that was proportionally scaled to c following pelak et al 2017 such that 3 e s c t k r s 1 c e b e t 0 t where eb is the baseline evaporation coefficient and kr s is the evaporation reduction coefficient given by 4 kr s 0 s s h 1 s h s s h s s h this simplification still captures rates of high and low evaporation as s approaches full saturation or sh and allows for decomposition of et during earlier or later parts of the growing seasons as dominance shifts from evaporation e to transpiration t a broader discussion of this tradeoff is given in pelak et al 2017 graphical illustrations of each relationship are shown figure 4 the moisture leakage term q captures losses from runoff as well as deep percolation runoff is modeled as a nonlinear function of c figure 4 while percolation was equal to the hydraulic conductivity given as 5 k s k sat s d where k is the hydraulic conductivity ksat is the saturated hydraulic conductivity and d is an empirically derived parameter value brooks and corey 1964 rodriguez iturbe and porporato 2004 2 3 soil physical and hydraulic conductivity dynamics in order to capture the effects of soil and crop management factors that influence soil processes we incorporate the dynamics of porosity n and matric potential ψs following pelak and porporato pelak and porporato 2019 and clapp and hornberger 1978 the pore size distribution f is modeled as a function of soil pore radius r over time such that 6 dt dt d vf dr mf where v is the soil drift term for shrinking pore radii and m is a source sink term gain or loss of pores at given radius r the integration of the pore size distribution over r is porosity n follows a power law distribution where 7 n t a t r b t dr where a is a scaling parameter and be is the power law exponent the change in radii dr is driven by the v and m defined as 8 v r t r a t b t a t b t ln r a t and 9 m r t b t b t 1 ln r a t a t b t where the prime noted variables are the parameters time derivatives using the same convention as mualem and dagan 1978 brutsaert 2005 and pelak and porporato 2019 the matric potential was expressed as 10 ψ s s t c s r m t s 1 1 b t where cs represents the surface tension of water and rm t is the maximum effective pore radius from this the hydraulic conductivity ksat may be estimated dynamically using the form 11 k sat s t γ w g e n t 2 rm t 2 1 b t 2 μ 3 b t 2 b t s 4 2 b t 1 b t where γw and μ are the specific weight and dynamic viscosity of water and g e is equal to 1 8 assuming the hagen poiseuille equation brutsaert 2005 following the convention used by pelak and porporato 2019 the power law exponent b was decomposed into two time dependent variables that aim to capture management and landscape changes arising from tillage and consolidation and soil organic matter som dynamics introduction of tillage immediately induces soil pore redistribution closer to uniform pore radii that gradually consolidate over time pore consolidation is modeled as an exponential decay function towards the untilled soil pore distribution expressed as the settling term 12 γ b r b 1 r b exp k b ttd where γb is the management factor used in the b term rb is the ratio of the parameter value in an untilled state to the base value kb is the rate of settling and ttd is the time since tillage in days in a cultivated system tillage resets the soil pore distribution to its initial value since ttd equals 0 although som and its turnover cross cuts many of soil processes influencing soil porosity and hydraulic properties and is likely coupled to landscape management practices the som contribution is treated independently the function for bc the effect of som on the b term defined as 13 b c om t b 0 σ b om t where b c is the parameter value at om equal to 0 and σb is the slope of the b om relationship assuming a linear function provides a parsimonious means to incorporating som dynamics however a nonlinear functional form would likely be more realistic the b term then becomes 14 b t t d om t γ b b c finally as porosity n changes over time the porosity value feeds back to the affect the water balance in equation 1 2 4 plant canopy cover dynamics the plant productivity and canopy cover component consists of a single stock of biomass which accumulates through growth due to et and diminishes through losses of senescence and physical disturbance through harvesting livestock grazing or other management treatments giving 15 dc dt g c s n t m c t h c t where g is the canopy growth rate and m is the metabolic and senescence term the growth rate is proportional to nitrogen uptake u 16 g c s n t r g u c s n t where rg represents a scaler of canopy cover growth per unit of nitrogen utilization the metabolic and senescence rate m is defined as a function of both constant metabolism and time dependent senescence terms such that senescence only occurs after the completion of the growing season i e post plant maturity described as 17 m c t r m γ t t sen θ t t sen c 2 where rm is the metabolic constant tsen is the estimated time of senescence in days γ is the slope of the senescence curve post tsen and θ is a step function that causes senescence to begin when soil moisture and nitrogen are non limiting c exhibits patterns of the logistic growth equation exponential growth followed by leveling off near the maturation canopy level hsiao et al 2009 laio et al 2001a pelak et al 2017 finally harvest h is given by 18 h c h v h d where h is initiated at the day of harvest hd either at the end of the growing season e g for crops or periodically e g for grazing with a percentage of biomass removed hv of canopy c canopy that is not harvested becomes soil surface litter cover based on the fraction of canopy becoming surface material c lc and time to litter fall c lt litter remains is a transient state during the nutrient turnover process therefore litter turnover lt is approximated as c lc divided by plant litter turnover time c tt lt reduces the fraction of soil surface coverage and contributes to natural nitrogen deposition described below 2 5 soil nitrogen dynamics soil nitrogen in the soil column is expressed as the balance between fertilization deposition leaching and plant uptake 19 d n c d t d t f n t l s n u s n c t where nc is the total mineral nitrogen content level per unit area soil d is the natural deposition rate assumed constant and f is the fertilization rate at time t of fertilizer application individual nitrate and ammonium concentrations are not modeled since plants may use both forms of n simplifying the model n parameterization a similar convention to pelak et al 2017 leakage l is proportional to the moisture leakage q and the nitrogen concentration at time t 20 l s n η q s where η represents the nitrogen content of soil moisture estimated as 21 η a n s n z where a represents the dissolved n percentage within the soil column plant uptake u is estimated as 22 u s n c t f η t s c t where f η represents the limitation of nitrogen uptake beyond the critical threshold ηc which is the point where additional nitrogen uptake does not facilitate increases in plant growth this takes the form 23 f η a n s n z a n s n z η c η c a n s n z η c using this parameterization it has been shown that reduction in s can either facilitate or hinder nitrogen uptake u pelak et al 2017 for example when s s and η ηc reducing s causes increase in u when s s u will decrease with the corresponding decrease in et 2 6 salinity dynamics the salt content balance expressed as the number of moles of charge or equivalent of cations per unit area is expressed 24 d q s d t i v i q v where qs is the salt dissolved in water in the soil column salt inflow is a function of irrigation applications i with salt concentration vi and the outflow is a function of leakage from the soil column q and v representing the dissolved salt concentration salt concentration v can be expressed as qs w where w represents volumetric water content common cations in saline soils include na ca2 mg2 and k subject to adsorption and desorption dynamics following hsiao et al 2009 we simplify the model consideration to na and ca2 the salt dissolved in water in the soil column qs may therefore be decomposed to 25 q s q s na q s ca or on a percentage basis as 26 e s na q s na q s e s ca q s ca q s where es na es ca 1 total charge of dissolved salts may then be described given 27 q s na c w e s na 28 q s ca c w e s ca to account for the cations adsorbed to negatively charged soil particles the cation exchange capacity cec is used the cec is expressed as 29 c e c q x m q x na q x ca m where x denotes cations in the exchange complex and m is the mass of dry soil to depth zr the salt quantities in the exchange complex are then expressed as 30 q x na c e c m e x na 31 q x ca c e c m e x ca where the fraction of sodium in the exchange complex ex na is noted as the exchangeable sodium percentage esp useful for delineating sodicity hazards in a given soil the balance between soil water and the exchange complex are assumed to be in thermodynamic equilibrium using the following exchange function for the exchangeable sodium ration esr 32 e s r k g s a r where kg represents the gapon selectivity coefficient and sar represents the sodium adsoprtion ratio the esr and esp can therefore be further defined as 33 esr e x na e x ca esp 100 1 esp 100 34 s a r na ca mg 2 which assumes that ca and mg are indistinguishable in the exchange complex following mau and porporato 2015 inclusion of soil salinity and sodicity is important from an agricultural resource management perspective since accumulation of salts can hinder proper plant functions that lead to productivity given the effects of salinity and sodicity on plant productivity allen et al 1998 bernstein 1975 duncan et al 2008 niu and cabrera 2010 qadir and oster 2004 wichelns and qadir 2015 the sodium impact on basal crop coefficient was included as a nonlinear table function such that for ex na or esp levels below 0 3 or 30 there is no reduction in kcb for levels of ex na between 30 and 100 kcb is reduced by 50 figure 4 d 2 7 crop production and yield dynamics the endogenous dynamics of the model are coupled through the linkages between c s n and qs described above out of which crop production and yield arise as products of the interactions between the soil water plant system following the convention of pelak et al 2017 accumulation of crop biomass b is given as a function of water productivity driven by transpiration t along with nitrogen uptake and soil moisture dynamics including nitrogen dynamics along with soil moisture availability which partially drives et allows for examination of moisture and nitrogen limitation in tandem an important coupling in terms of agricultural resource management the detailed formulation for b is described as 35 d b d t w u s n c t η cet 0 t w η c k s s k c b f η c yield y was then estimated as a fraction of the biomass using a harvest index hi giving 36 y b h i 2 8 economic dynamics the economic dynamics account for the input costs and output revenues of the production system input costs include fertilizer expenses dependent on the volume and per unit cost of n while irrigation includes both fixed and variable costs fixed costs of irrigation can vary depending on the method of application while the variable costs of irrigation are simply the volume of water applied multiplied by the water cost per unit this captures the trade off between irrigation systems where systems with high fixed costs per user e g drip or sprinkler systems which have lower variable costs due to savings created through lower water requirements versus systems with lower fixed costs to the user e g flood irrigation that possess higher variable costs due to higher volumes of water applied lastly revenues are determined using the price per unit of crop p multiplied by the yield y returns were then calculated as the difference between revenues and costs 2 9 model calibration measurements and model evaluation in order to calibrate the developed model soil moisture data were obtained via the north american soil moisture database quiring et al 2016 for four locations in the state of texas usa figure 5 representing contrasting soil ecoregional climatic and precipitation regimes and irrigation capabilities table 1 initial s was set to the initial soil moisture level for an observation year containing up to 365 days climate data needed for precipitation forcing and hargreaves et0 calculations were downloaded from weather underground wunderground com for each location since precipitation data were obtained in proximity to and not directly at the locations where soil moisture was recorded an adjustment had to be made for clear outlier precipitation events that did occur in the general area but did not occur at the specific soil monitoring point in total precipitation events had to be reduced or eliminated for 27 days out of a total 1460 days or 365 days for each of the 4 locations or 1 8 of the total simulation days after accounting for these events calibration measurements were taken for metrics of model accuracy mean bias precision coefficient of determination r2 and overall fit theil inequality measures for each site following model evaluation considerations of tedeschi tedeschi 2005 and oliva oliva 1995 theil inequality analysis decomposes the total model error into errors attributable to discrepancies in the mean variance and covariance s of predicted and observed values generally lower theil values for mean and variance are preferable to higher values i e the model captures the general patterns of behavior and where less emphasis is needed on point estimates that would achieve high agreement in covariance estimates however in the case of soil moisture errors in covariance should be considered given the stochastic nature of hydroclimate forcing at each particular location additional calibration checks were made using the other core state variables of the model namely canopy soil cover soil nitrogen and salinity content and the critical soil physical and hydraulic properties including porosity saturated conductivity and soil matric potential in order to evaluate the model s adequacy to replicate behavior patterns and structures in these variables but without data corresponding to the soil moisture monitoring locations we calibrate the model by running a hypothetical crop growing season with similar soils and parameter values as those found in the literature where observed data were used in model development in these cases model simulations of a growing season were compared to model outputs for soil moisture crop canopy cover nitrogen biomass and yield dynamics pelak et al 2017 and soil porosity and pore radii pelak and porporato 2019 to examine the adequacy of underlying soil processes sensitivity analyses were run to examine the behavior of soil salinity to altering irrigation and leakage rates similar to mau and porporato 2015 or for alternative soil moisture levels that drive saturated hydraulic conductivity and soil matric potential similar to pelak and porporato 2019 in the former irrigation and leakage rates were set to constant levels while salinity was allowed to vary while in the latter case soil moisture as a percentage of field capacity was varied from 0 to 100 percent and conductivity and matric potential responses were recorded 2 10 sensitivity analyses after examining the calibration performance for each site the model was returned to its generic soil characteristics used during model development representing an agricultural soil similar to pelak et al pelak et al 2017 for a variety of sensitivity analyses the objective of these tests were to examine the response patterns or characteristics of key model structures to varying parameter value changes representing alternative management schemes in doing so identification of parameters contributing to significant responses in model state variables is possible while simultaneously insuring the model did not produce any physically unrealistic results e g negative soil moisture levels results of sensitivity simulations were compared to the base model results using the statistical screening approach ford and flynn 2005 where variations in input values are correlated to output responses for each time step t this yields an estimate of correlation coefficient r which can take on values from 1 to 1 at each time step making it capable of evaluating the relative strength that each input variable exerts on the output variable over the length of the simulation a useful approach for evaluating the feedback loop strength that the input variables regulate and potential shifting dominance for example negative correlation values indicate a negative or opposite polarity between input and output variables i e reductions in the input lead to increases in the output on the other hand positive correlation values indicate a positive or reinforcing polarity i e increases in on variable lead to sill greater increases in another values closer to 1 indicate perfect negative polarity while values nearer to 1 indicate perfect positive polarity if the coefficient of determination between the input and output variables shifts from negative to positive a shift in polarity may have occurred whereas several other works have examined the sensitivity of exogenous management inputs such as irrigation or fertilization pelak et al 2017 or endogenous factors such as salinity equations mau and porporato 2015 here we present sensitivity analyses of critical climate features primarily precipitation or management features that influence the soil column that have not been well examined in previous modeling work to complete the sensitivity analyses several assumptions were made for the climate test namely alteration of precipitation depth and frequencies we assumed no irrigation to take place in order to examine the response in crop water irrigation requirements from changing precipitation patterns altering frequency and depth of precipitation 25 from their base values of 1 per 40 days for mean event arrival time and 0 5c m for mean depth respectively provided a pragmatic way to evaluate soil moisture dynamics and the plant canopy productivity it supports as well as the derived irrigation demand i e the estimated irrigation demand for crops that would have been demanded given a particular management strategy the hypothetical irrigation system used from comparison was a sprinkler irrigation system subject to canopy interception and runoff dynamics where a relative soil moisture value of 40 of field capacity would induce irrigation applications up to the target relative soil moisture value of 60 of field capacity irrigation application intervals up to 10 days and no flush applications would be applied after the growing season for the remaining management tests we assume that such an irrigation scheme is in use while we vary salinity and crop management factors each test is described below and summarized in table 1 irrigation management factors namely electrolyte concentration of irrigation applications the soil moisture level inducing irrigation application the target soil moisture level at which irrigation applications cease and the application interval base value equal to 10 days were varied from the base irrigation scheme just described by 25 of their initial base values additionally several important crop management factors were also tested fertilization is a significant agroecosystem input as it facilitates crop growth but is also a source of significant economic and environmental cost through leakage and runoff to examine the tradeoff between fertilization costs and benefits fertilization was varied 50 in fertilization rate assuming 1 application at the beginning of the growing season similar to fertilization tillage is an important management practice since it increases soil microporosity and provides a large nutrient release at crop planting however consecutive tillage in the longer term can lead to subsurface compaction from increasing equipment traffic in the field to test the model sensitivity to potential compaction from excessive tillage we vary the soil porosity via a 50 reduction in the initial porosity value alternative soil management practices such as no tillage system that reduce soil disturbance are generally compensated for by the ability to better manage crop residue on the soil surface as well as implement cover cropping systems we therefore examined the impact of no tillage through the incorporation of crop residue management via reduction in canopy removal at time of crop harvest from 100 of crop biomass to 50 as well as implementation of non irrigated cover crops via allowance of plant canopy growth outside of the ordinary growing season finally an increasingly important management practice has been the installation of tile drainage networks to remove water where soils are subject to periodic saturation due to rising water tables a function of snowmelt dynamics but primarily the proximity to low lying wetlands we tested the impact of subsurface tile drainage installation via an additional outflow from the soil column representing tile drain releases where the tile was installed at a depth of 45c m with a 7 5c m diameter in this case the irrigation system is removed since moisture is typically excessive due to water table rises incorporated via capillary rise of 0 05c m per day to represent these alternative soil moisture inflows that necessitate drainage each of these sensitivity simulations provided a means of evaluating model performance while simultaneously gleaning important insights regarding the potential impact that individual alternative management strategies may have on the overall soil moisture and nutrient dynamics arising from common agroecosystems via quantifying strength of influence of input parameters on output variables through statistical screening ford and flynn 2005 3 results 3 1 calibration results overall the model was adequately replicated the soil moisture evolution under varying soil physical and climatic conditions table 2 and figure 6 accuracy measured by mean bias in soil moisture percentage terms was extremely high mean of 0 008 and precision estimates were excellent for two sites edinburg and palestine fair for one site seymour and low for one site that did not have a representative 365 day sample freeman ranch mean r2 value given all sites 0 67 behavior over time graphs for the model generated data compared to observed soil moisture levels as well as the evolution of each theil inequality statistic are provided figure 6 the noteworthy discrepancies between observations and model predictions for each specific site are discussed below the major errors associated with the edinburg and freeman ranch simulations occurred later in the simulation in edinburg this began with several precipitation events occurring at different days between day 240 and 310 after day 275 the model simulated soil moisture did not decline at as rapid a rate as the observed time series indicating that moisture losses or outflows were smaller in the model than in the real world this was likely due in part to the timing of precipitation events but also to the specification of soil evaporation for the ending months at this site was too low because of this the contribution of errors in mean to total model errors rose sharply until the end of the simulation period or growing season data for the freeman ranch were the scarcest leading to fewer days of allowable comparison for the days we did compare discrepancies indicated that the observed and predicted time series both peak at similar points corresponding to precipitation events the slope of the recession limb post precipitation was much steeper in the observed data indicating that the outflows in the model may not be increasing at the appropriate rate especially near the end of the simulation or growing season similar to the edinburg location the results of the edinburg and freeman ranch simulations illustrated a the trade off between accuracy of the mean and covariance estimates that arise in any simulation and b evapotranspiration demand is likely higher at this site at the end of the year due to other environmental factors not included in the model both the palestine and seymour simulations showed high agreement with the observed dynamics of those locations unlike the previous two sites where the moisture outflows were not high enough to drain the soil moisture stock as quickly as the observed record the outflows for the palestine and seymour cases seem to be very well matched i e similar moisture regression slopes regardless of precipitation event the palestine and seymour simulations appeared to be the best behaved compared to the observed data but several discrepancies may be found in either case in the palestine site peaks of soil moisture tend to be somewhat lower or higher compared to the historical data while the slope of soil moisture drawdowns remain consistent therefore the major errors associated with this run were likely the mismatch between location of precipitation events driving the soil moisture as well as parameterization of infiltration and runoff but given the overall estimates for errors in the mean and variance such improvements may not yield significant gains in model performance the seymour site appears to be the model that is the best behaved most of the error resides in the covariance fraction comparing the observed and predicted data there are some discrepancies between the timing of precipitation events relevant to the site e g days 57 85 days 183 211 etc there is likely minimal parameterization improvements needed for the seymour model other than having a precipitation record closer to the soil observation point importantly the integrated model was able to replicate behavior patterns in critical state variables across model components for a hypothetical crop growing season figure 7 soil moisture evolution response to a given precipitation and irrigation sequence figure 7a exhibited similar correspondence a similar ecohydrologic model while crop canopy cover exhibited logistic growth patterns figure 7b planting time 120 days similar to pelak et al pelak et al 2017 tillage which generally occurs just prior to crop planting dates created additional pore space via increase soil pore radii figure 7c and d which gradually collapsed over the growing season as soil properties revert back to pre tillage conditions pelak and porporato 2019 nitrogen uptake figure 7e mimicked crop canopy since nitrogen fuels accelerated crop growth up to the point of maturity at which time nutritent uptake begins to decline pelak et al 2017 while crop biomass and yield continue to grow until harvest harvest time 270 days figure 7f meanwhile salt concentration accumulated in the soil column driven by irrigation rate and leachage fraction defined as the fraction of irrigation applications that infiltrate below the rooting zone expressed similar nonlinear behaviors as mau and porporato mau and porporato 2015 figure 7g additionally varying soil moisture levels had the appropriate response on hydraulic conductivity figure 8 a and matric potential figure 8b 3 2 sensitivity analyses 3 2 1 precipitation frequency and depth the purpose of the precipitation sensitivity test was to evaluate the robustness of the model to alternative values of precipitation by varying mean rainfall arrival times and depths the precipitation sensitivity test had large significant effects on soil moisture and therefore the derived irrigation demand figure 9 in this particular test rainfall was varied from its parameterization of a semi arid precipitation regime up to very humid or down to extremely arid regimes evidenced by the large variation in soil moisture figure 9a of the two factors arrival time had a higher correlation r compared to precipitation depth 0 52 vs 0 24 table 3 and figure 9b indicating that precipitation mean arrival time was more influential in regulating higher soil moisture levels that mean precipitation depths the same effect was also observed in average soil moisture figure 9c and d in terms of derived irrigation demand the mean volume of irrigation that would have been demanded assuming spray irrigation induced at 40 of field capacity continuing until the target soil moisture level of 60 of field capacity is reached was 110cm figure 9e similar to the soil moisture estimates frequency or mean arrival time was more influential than mean precipitation depth i e as mean arrival time was shortened derived irrigation demand decreased table 3 figure 9f 3 2 2 irrigation management tests the purpose of the irrigation management sensitivity test was to evaluate the probable responses of key system characteristics to altered irrigation management criteria irrigation threshold i e the soil moisture level that induces irrigation applications the electrolyte concentration of each irrigation application the irrigation interval i e days between applications and the target soil moisture level that ceases applications altered behavior patterns in response variables are shown in figure 10 while ending cc values between input value changes and responses in model are shown in table 3 no changes in soil moisture occur until the start of the growing season and irrigation applications begin near day 120 figure 10a the majority of simulations occurred within 25 of the mean soil moisture level depending on the particular input combination cumulative irrigation ranged between 25 and 40c m with the majority of simulations occurring within 33 of the mean irrigation level figure 10b although canopy cover varied throughout the growing season in response to moisture availability the ending canopy cover values were within 10 of the mean cover figure 10c electrolyte concentration a function of irrigation applications and the salt concentration therein mimicked the response of cumulative irrigation figure 10d because of the irrigation strategy maintained soil moisture levels greater than what would have been achieved without it both mean soil moisture figure 10e and yield figure 10f showed less variability than did the other parameters of the irrigation sensitivity parameters irrigation threshold had the strongest influence on soil moisture cc 0 44 and yield cc 0 33 table 3 since raising irrigation threshold would induce irrigation applications earlier reducing the likelihood of soil moisture becoming a crop growth limiting factor however a trade off was observed between soil moisture and yield with profit since increased irrigation threshold created greater irrigation applications cc 0 44 which led to increased costs that necessarily reduced profits cc 0 44 similarly raising the target soil moisture level led to increased irrigation levels cc 0 75 and therefore costs which profitability cc 0 83 table 3 electrolyte concentration in irrigation water had little impact on soil and crop parameters except for the soil salt concentration 0 81 at the end of the growing season the influence of irrigation application interval days was consistent across soil and crop factors with cc values ranging from 0 09 to 0 13 but did not as significantly influence any particular factor as the other irrigation parameters table 3 3 2 3 crop management tests the purpose of the crop management sensitivity tests was to evaluate changes in soil and crop system behaviors to alternative management practices employed in various agroecosystems the most common of these practices is fertilization reducing fertilization rates 50 from the base case 0 011k g m2 led to reduced crop transpiration yield and profit figure 11 because of the reduced transpiration mean soil moisture was higher than in the base case table 4 on the other hand increasing fertilization led to greater transpiration due to crop growth rates unhindered by nutrient availability yield and profit figure 11 with a corresponding decrease in mean soil moisture table 4 the influence of tillage if excessive to the point to create a compacted subsurface soil column significantly reduced soil moisture figure 12 a infiltration rates figure 12b mean soil moisture yields and profits table 4 two no till scenarios one with crop residue management and one with non irrigated cover crops revealed divergent dynamics table 4 incorporation of crop residue increased soil moisture levels 10 7 over the base case figure 12c compared to the cover crop scenario of 0 79 respectively figure 12e this was due in large part to the increased transpiration canopy cover and yield under the cover crop scenario that was not present in the crop residue scenario table 4 figure 12d and f for those systems where excessive moisture becomes a problem installation of tile drainage is a common practice used to manage water in the soil column the tile drainage scenario which did not include irrigation due to excessive moisture of rising water tables did reduce soil moisture as well as the evapotranspiration dynamics table 4 figure 12g although yield and profitability were also reduced compared to the base case in reality where these soils necessitating drainage exist yield and profitability prior to drainage are effectively zero therefore the percentage changes for yield and profit under drainage are not shown so long as the annualized cost of tile drain installation does not outweigh expected crop profit margins per unit area it would be economically justifiable to tile table 4 the resulting evapotranspiration dynamics for each of the crop management tests revealed unique evolutions in the soil water balance figure 13 although the peaks rates of et under compaction were similar to that of the no till scenarios it was also more variable figure 13a contributing to lower yields and profits table 4 between the no till scenarios managing for crop residue produced greater mean soil moisture compared to cover cropping table 4 since et was significantly less during times of the year outside of the growing season figure 13b compared to the cover crop whose transpiration rate year round figure 13c drew down soil moisture levels finally the influence of tile drainage created a unique soil moisture evolution given rising water tables figure 13d with drainage soil moisture was maintained near its average condition which constrained et both within and outside of the growing season 4 discussion soil systems form the foundation of agroecosystems that society relies on for the production of food feed and bioenergy and as such the functioning of soil processes are critical for meeting the growing demands of population growth as agricultural production attempts to expand via both intensification i e increasing efficiency and productivity on existing agricultural lands and extensification i e increasing the land use devoted to agriculture soil functions and processes will become increasingly stressed due to a number of unintended consequences such as erosion reduction in water holding capacity loss of soil organic carbon excessive fertilization and water runoff contamination and soil salinization among other externalities variability in hydro climate forcing adds to the already complex nature and behavior of soil systems this paper presented a soil system dynamics model grounded in soil moisture dynamics applications stemming from the field of ecohydrology that demonstrated the ability to integrate soil water and nutrient processes and cross cut multiple agroecosystem management strategies primarily irrigation fertilization and crop management techniques including cover cropping and various tillage practices the model included core state variables for soil moisture nitrogen and salinity crop canopy cover and soil ground cover and crop system profitability the relationships between these components were quantified and parameterized using parsimonious assumptions and leveraging existing ecohydrologic modeling frameworks from a multitude of sources the calibration results efficiently replicated observed soil moisture dynamics for a variety of soil types while other measures or relationships e g nitrogen dynamics canopy cover soil hydraulic conductivity and matric potential produced by the model matched extremely closely to observed or modeled expectations in the literature using a variety of model tests we examined the response in soil system behaviors to varying precipitation irrigation and crop management factors to identify critical feedback linkages between system components some of the response patterns were expected and build additional confidence in the model structure for example increasing frequency and depth of precipitation reduced irrigation demand and therefore costs increased mean soil moisture and yields resulting in improved profitability on the other hand altering irrigation decision parameters resulted in important soil resource and economic outcomes reducing the soil moisture level that induces irrigation and the target soil moisture level led to similar reductions in soil moisture and yield of the two the soil moisture level inducing irrigation was more significant but increased profitability due to the reduced irrigation costs these effects help up regardless of irrigation application interval implying that moisture levels inducing irrigation applications be set as low as possible e g near to s and that the target soil moisture level be determined by the ease of application e g just above s for drip or micro irrigation systems or sfc for spray or flood irrigation systems although previous model studies focused less on the type of irrigation system the convergence on s as an optimal point was also identified by pelak et al 2017 specifically regarding crop management tests increasing or decreasing fertilization rate led to corresponding increases or decreases in soil moisture driven by the changes in transpiration greater fertilization led to greater crop biomass which transpired more moisture or consider soil compaction a common symptom impacting many agroecosystems due to excessive surface disturbances that compress soil pore space under the soil compaction test significant reductions were observed in mean soil moisture evapotranspiration dynamics yield and profit overcoming compaction issues and maintaining adequate pore space for soil water infiltration and storage capacity requires fewer disturbances such as no tillage cultivation practices cover cropping that increases rooting activity and aids in soil aggregation or some combination of the two despite increasing scientific and anecdotal managerial evidence regarding the benefits of no till or cover crop practices in cultivated systems adoption of such practices remain slow less than 20 in the united states united states department of agriculture 2017 this may be due to reluctance to change tillage practices due to high investment costs for equipment in the case of no tillage adoption or concern that residual soil moisture at the beginning of the cash crop growing season will be lower than optimal due to increase et induced during the off season in the case of cover crop adoption in either case the model results showed that no till with residue management or no till with cover cropping both significantly increased yield and profitability with cover cropping being the most profitable and 60 greater than no till with residue management only in terms of soil moisture both strategies increased mean soil moisture levels but only the no till with residue management was significantly greater than the base case for agricultural soils similar to those used to parameterize the model for testing results here show that the benefits in yield and profitability could far outweigh any trade offs in soil moisture dynamics lastly tile drainage which is increasingly used in agroecosystems prone to water table rises in or near wetlands or other low lying areas did significantly reduce soil moisture as well as et dynamics and plant biomass but did lead to significant increases in profitability this provides some economic justification as to why many regions that have experienced recent rapid growth in drain tile installations including in the grain belt of the united states despite potential water runoff and quality issues that may arise like traditional ecohydrologic models the rooting dynamics of various plant or crop types e g shallow vs deep tap vs fibrous and the effect that various rooting strategies have on soil aggregation dynamics was not well parameterized and remains an area for future model improvement especially given the important role that soil aggregation has in regulating soil moisture dynamics along with inherent soil porosity and depth unlike ecohydrologic models however we include the transition from canopy cover to soil cover which facilitated reincorporation of nutrients into the soil column as organic matter is turned over this provides a clear link to expand the model boundary to include soil microbiology dynamics i e the soil food web which would provide a means to scientifically evaluate the physical chemical and biological trade offs that exist in managing the soil processes and function given the variety of goals and constraints of various agroecosystem structures although the model data presented here represented one year at four locations the model can be simulated for longer time horizons preliminary analyses of the long term 10 year evolution in soil moisture and other state variables using alternative precipitation and climate parameters indicate the resulting behavior patterns to be robust however when feedbacks between management strategies were included novel behavior patterns in soil moisture canopy cover and nutrient dynamics emerge results not reported here refining this analysis is the focus of future work described below modeling complex coupled natural human systems including agroecosystems remains an important inter and transdisciplinary research area that requires additional effort and attention given the nature of 21st century problems related to agricultural production future extensions of this model will require expansion of the model boundaries to include additional irrigation fertilization and crop management decision making factors these may include how producers respond to market or policy signals regarding production decisions e g crop type planting and harvest dates environmental penalties due to nutrient leakage etc even more interesting will be to expand the endogenous decision making factors to examine how those feedbacks may alter optimal input strategies for example regions undergoing extensification may see fertilization rates increase above the optimal fertilizer rates to compensate for the lower soil quality soils of newly planted lands that are less suitable for crop production alexander et al 2015 carpenter et al 1998 matson et al 1997 tilman et al 2002 turner et al 2018a turner et al 2018b similarly irrigation strategies may be altered from the optimal irrigation rates due to the nature and distribution of water rights if producers water rights for allocations will be reduced or removed due to lower water use potentially stemming from increased production efficiency then the observed irrigation strategy will likely be higher than the optimal strategy leading to greater water use and reduced profitability per unit output on the other hand where water rights are less clearly defined producers may opportunistically seek to increase water use as a competitive strategy to out produce competitors or secure a claim to the right based on historical use a fuller examination of these decision making tradeoffs is needed which will be explored in future applications of the model presented here and described in a companion paper 5 conclusion effective agricultural systems management requires the knowledge and ability to examine and understand evaluate and then manage the complex dynamic often non linear trade offs that exist at the structural level of agroecosystems including soil systems the soil system dynamics model presented here demonstrated the complex feedback driven relationships that lie at the center of many soil and resource management problems relevant to agroecosystem management today namely the soil moisture nutrient plant canopy feedbacks that give rise to the non linear characteristics of soil moisture and nutrient evolution and crop performance outcomes mathematical modeling of such features in agricultural systems remains an area of much needed development if we are to improve our understanding of and ability to manage complex resource management problems e g irrigation fertilization soil salinity soil erosion and or compaction etc that continue to plague agroecosystems around the world an important feedback process not explicitly included in the model here is the problem of managerial feedback that captures how managers typically respond to agroecosystem challenges e g over irrigation or over fertilization reluctance to adopt no till or cover crop practices in such problems modeling efforts require a broader interdisciplinary perspective beyond the soil system dynamics that include the psychological factors that lead to specific managerial decisions modeling efforts that combine those relationships described here with the human dimensions that drive decision making will help provide a more comprehensive accurate representation of real world problems and provide a more solid foundation for evaluating the effectiveness of proposed agricultural policies and strategies aimed at addressing pressing agricultural resource management problems declaration of competing interests the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was partially supported by united states department of agriculture s higher education challenge grant no 2018 70003 27664 and the national science foundation s center for research excellence in science and technology crest award number 1914745 appendix a table a1 
24851,soils form the foundation of terrestrial ecosystems that regulate the processes and functions driving ecosystem goods and services provisions that humans rely on including agriculture pressing agricultural resource challenges persist including those involving irrigation fertilization and salinization due to the complex coupled and feedback driven connectivity of various soil processes that are difficult to manage soil moisture dynamics cross cut these processes and is a logical integration point for generating understanding and new insights for improved agroecosystem management this paper presents an integrated soil water nutrient plant interaction model built within a system dynamics framework with the purpose of replicating soil moisture evolution for a set of unique soils and climates examining model performance given common irrigation e g frequency and application rates and crop management considerations e g fertilization tillage cover cropping and evaluating via sensitivity analysis model robustness and quantifying influential management parameters effect on core bio physical feedbacks at the soil level the model has four main state variables soil moisture soil nitrogen soil sodium and plant canopy cover that interact dynamically via feedback processes formulated as coupled partial differential equations between them exogenous variables included precipitation time series data and required climatic parameters to determine reference potential evapotranspiration the time unit used from simulation was 1 day time step 0 25 with a simulation horizon of 365 days the model was calibrated using a variety of sources in the literature and with comparison to observed soil moisture data from four sites in texas usa and evaluated statistically for accuracy mean bias precision coefficient of determination and overall fit theil inequality statistics sensitivity analyses were conducted for a variety of hydroclimate forcing and irrigation fertilization and crop management decisions to examine the impacts to soil moisture evolution soil salinity and cropping profitability among other variables calibration results showed high degrees of agreement between observed and predicted values mean r2 0 67 mean bias 0 008 sensitivity results demonstrated that precipitation frequency was more influential than precipitation depth in regulating soil moisture that irrigation threshold i e the soil moisture level inducing irrigation was the variable most influential to crop profitability which was maximized at the lowest irrigation threshold value and that several conservation management strategies i e no till with residue management or cover cropping improved soil moisture and crop profitability contrary to common management perceptions several other tests for alternative fertilization irrigation and tile drain installation strategies produced results that corroborate common observations of agroecosystem management i e despite environmental risks crop profitability was enhanced future model extensions include expansion of the irrigation fertilization and crop management decision making factors to better capture how decisions that respond to economic and policy signals influence resource use and soil system dynamics modeling these complex feedback driven agroecosystems processes remains an arena for future modeling innovations that will support important resource management improvements keywords soil moisture irrigation fertilization soil salinity agroecosystems system dynamics 1 introduction soils are the foundation of terrestrial ecosystems and as such functioning soil systems are critical to the sustainability of ecosystem processes particularly nutrient cycling of carbon nitrogen and water adhikari and hartemink 2016 swift et al 2004 that provide wide ranging ecosystem goods and services for human well being adhikari and hartemink 2016 including agricultural production power 2010 humans rely on these processes for the regulation and provisioning of food production as well as fresh water the sustainability of these functions are currently at risk due to agricultural intensification and expansion of cultivated landscapes both considered vital strategies to meet rising food feed and bioenergy demand induced by global population growth alexander et al 2015 power 2010 turner et al 2018a unfortunately both cultivation expansion extensification and intensification increased factor productivity on existing agricultural lands have created a number of unintended consequences that may weaken efforts to achieve global food security including but not limited to groundwater depletion water quality contamination increased greenhouse gas emissions loss of soil organic carbon soil erosion by both wind and water and soil salinization turner et al 2018a turner et al 2018b horrigan et al 2002 hurni et al 2015 these factors and others e g irrigation fertilization and leaching may be collectively called 21st century challenges for agriculture due to the complex coupled feedback driven connectivity that arise in attempts to meet growing societal demands figure 1 for example increased groundwater pumping for irrigation reduces water table levels which may inadvertently raise groundwater salinity levels and exacerbate soil salinity problems with continued irrigation applications gates et al 2002 konikow 2013 konikow and kendy 2005 konikow and person 1985 smedema and shiati 2002 texas water development board 2019 united states department of agriculture 2014 a typical response to this problem is to flush the salts out by still additional water applications agricultural intensification via crop selection for maximum yields can also lead to heavy or over fertilization of nutrients which are subject to leaching into water supplies and reduces soil microbial activity needed to sustain organic carbon levels carpenter et al 1998 matson et al 1997 scanlon et al 2007 tilman et al 2002 international fertilizer association 2019 become reliant on chemical treatments to limit pest damages which accelerates pest genetic selection for chemical resistance denholm 1998 kranthi et al 2002 pimentel et al 1992 international fertilizer association 2012 tilman et al 2002 and conventional tillage which exposes the soil surface and accelerates erosion turner et al 2018a 2018b montgomery 2007 nearing et al 2017 nearing et al 2005 twenty first century agricultural resource problems are therefore fundamentally coupled soil crop and water management problems since hydrologic processes and soil functions are not independent but are interlinked co dependent this makes agricultural soil system management defined here as management of the aboveground processes and disturbances of the soil surface down to the bottom of the rooting zone a critical leverage point for mitigating these systemic problems as just indicated typical management decisions including irrigation fertilization and crop and tillage decisions collectively can either strengthen or weaken the ability of a soil systems to function such as nutrient retention water cycling and shallow groundwater recharge adhikari and hartemink 2016 turner et al 2018a 2018b fernald et al 2010 to add to the complexity that arises between soil processes and management decisions is the extreme hydro climate variability both spatially and temporally that further complicates irrigation planning and control fertilization efficiency and crop productivity and profitability daly and porporato 2006 the central problem of this variability stems from the unpredictability of precipitation droogers et al 2000 which is expected to become more variable under projected climate change mendelsohn et al 2007 motha and baier 2005 given the connectivity between soil processes and agricultural decisions both of which are in part driven by this extreme hydro climate variability particularly precipitation understanding complex resource management problems requires a means to integrate the underlying dynamics of multiple soil hydrologic nutrient and human related factors e g socio hydrology dynamics in fernald et al 2012 gunda et al 2018 turner et al 2016a or agricultural land use dynamics in menendez et al 2019 turner et al 2016b turner et al 2017a soil moisture dynamics cross cuts each of these factors and a logical integration point for several reasons first soil moisture dynamics provide a link between precipitation variability and therefore irrigation demands and plant productivity and therefore profitability abd and ali 2013 ali et al 2007 porporato et al 2015 porporato et al 2001 soil physical properties control the intensity and duration of soil water deficit since these properties drive the soil moisture dynamics international fertilizer association 2007 porporato et al 2001 power 2010 stephenson 1990 swift et al 2004 and soil water deficits in turn regulates plant physiology since plants must uptake water from the soil falkenmark and rockstrom 2006 second plants productivity may be reduced to levels observed under drought conditions even with acceptable precipitation due to poor soil characteristics particularly regarding soil hydrologic functions such as soil moisture retention branson et al 1970 branson et al 1976 daubenmire 1968 harrington 1991 newman 1967 nilsen and orcutt 1998 sadras and angus 2006 vico and porporato 2013 third soil water stress is often the reason for poor plant nutrient uptake particularly nitrogen since soil moisture regulates ammonification and nitrification and this total plant nutrient uptake bennett et al 1989 brady and weil 1996 larcher 1995 manzoni and porporato 2009 nilsen and orcutt 1998 wang et al 2012 soil moisture is therefore a key system component capable of integrating the soil system dynamics arising from soil climate vegetative crop management irrigation and fertilization characteristics and the interacting feedbacks between factors across evapotranspiration et regimes seneviratne et al 2010 understanding these complex feedbacks and the implications they have on agroecosystem management could be aided by the use of a dynamic systems approach capable of modeling coupled soil plant water dynamics in relatively simple and parsimonious means the discipline of ecohydrology has provided a hydrologic foundation from which to understand observed vegetation characteristics due to the linkages and flows between climate e g stochastic precipitation soil properties e g soil water holding capacity and vegetation through soil moisture mediated plant transpiration rodriguez iturbe et al 1999 rodriguez iturbe 2000 rodriguez iturbe et al 2001 porporato et al 2002 illustrated in figure 2 well documented ecohydrology models have focused on development and analysis of analytic expressions and probability density functions that describe soil moisture characteristics e g porporato et al 2002 de michele et al 2008 laio et al 2001a laio et al 2001b porporato et al 2015 porporato et al 2001 and only more recently matching model predicted values with observed levels of soil moisture e g kumar et al 2013 pan et al 2015 turner 2017b xia and shao 2008 ecohydrologic models have focused on semi arid ecosystems like rangelands or savannas because they are primarily water controlled i e rainfall dependent have vegetation characteristics that are reflective of historical climate regimes and soil properties and where vegetation often exerts control on watershed balances through myriad land atmosphere feedbacks more recently however ecohydrologic models have been recognized as useful frameworks for investigating agricultural soil problems such as irrigation fertilization and salinity dynamics due to their parsimonious representation of soil processes ability to capture both stochastic and dynamic coupling between state variables and given that the underlying assumptions regarding soil and plant characteristics are well matched with typical agroecosystem porporato et al 2015 the objectives of this work were to 1 utilize the foundational framework described in the ecohydrology literature to develop a dynamic plant soil water nutrient model robust enough to adequately replicate the soil moisture evolution for a variety of soils and climate conditions 2 overlay the model with common irrigation and crop management considerations including irrigation method timing and application volume fertilization times and volumes and no till practices with crop residue management or cover cropping and 3 evaluate the model using a variety of sensitivity analyses to examine both model robustness and quantify which parameters are most influential to the core bio physical feedbacks included in the model the remainder of the paper follows with a description of the development of the model and the calibration and evaluation procedures employed to verify its ability to adequately capture the high level feedbacks operating within a coupled plant soil water agroecosystem then several hypothesis tests are applied to the model regarding crop and irrigation decision making across a variety of landscape and climatic conditions results are then provided with a discussion centered in the context of sustainability of soil and water resources and agricultural profitability given 21st century agricultural and land use pressures we conclude with several recommendations and outline future research directions and model applications for both sustainability research and teaching 2 materials and methods 2 1 model overview the model represents a soil water nutrient plant continuum which integrates inflows and outflows of water and nutrients through feedbacks between soil moisture s expressed as a percentage of field capacity and plant productivity c representing the percentage of soil surface covered with the interaction effects of nutrient balances nitrogen and sodium and management factors cropping and irrigation decisions the model has four main state variables soil moisture soil nitrogen soil sodium and canopy cover which interact dynamically through various feedbacks between each other feedback mechanisms formulated as coupled partial differential equations link s and c dynamics through a variety of processes including infiltration and interception capturing infiltration excess runoff dynamics evapotranspiration rates which drive plant production or induce plant stress nitrogen uptake which either reinforces plant canopy growth nitrogen leaching an important factor for crop management as well as environmental quality sodium accumulation which may reduce plant water update and irrigation decisions which can respond to soil moisture conditions as well as influence nitrogen or sodium dynamics while crop biomass production or yield is driven by the outcomes of the system canopy cover does interact dynamically with water and nutrient balances via its influence on interception and transpiration terms exogenous variables included precipitation time series data input and required climatic parameters to determine reference or potential evapotranspiration et the coupled soil water plant model conceptualized in figure 3 was constructed using the system dynamics sd modeling environment vensim ventana systems inc cambridge ma usa the time unit used from simulation was 1 day with time step 0 25 and a simulation time horizon of 365 days the main strengths of using the sd platform was the ease with which the high number of feedback mechanisms could be formalized as integrated coupled difference equations a rapid simulation time and a visually appealing means in which to incorporate the dynamics of interest turner et al 2016c the model was used to examine the various trajectories in soil moisture nutrient balances and profitability response given alternative agroecosystem features and management decisions in the sections that follow we describe in detail the soil water plant model components and their feedback connections many aspects of which have been derived replicated or extended from a variety of other soil moisture crop or nutrient models kumar et al 2013 laio et al 2001a laio et al 2001b manzoni and porporato 2009 mau and porporato 2015 pelak et al 2017 porporato et al 2015 porporato et al 2001 rodriguez iturbe et al 2001 vico and porporato 2011a vico and porporato 2011b vico and porporato 2013 but that have not been integrated into one cohesive model key model variable names and equations are provided in the sections that follow additional descriptions of variable names symbols parameter values and their sources are provided in the appendix 2 2 soil water balance dynamics soil moisture was modeled as the balance between moisture gains precipitation and irrigation and losses evapotranspiration and leakage expressed as 1 n z r ds dt r t i s t et s t c t q s t where n is the soil porosity zr is the active soil rooting depth s is the vertically averaged relative soil moisture content 0 s 1 where 1 is fully saturated conditions r t represents the inflow of rainfall over time while i s t is the inflow from irrigation applications et s t c t is the coupled water losses from evaporation and transpiration modulated by s and canopy cover c t q s t represents the coupled losses from runoff and percolation below the rooting zone zr and dt is the integration delta time for full methodological considerations see laio et al 2001a laio et al 2001b porporato et al 2015 porporato et al 2001 rodriguez iturbe et al 2001 the simplifying assumptions of this soil water balance approach were that root growth not modeled here is restricted to zr such that the soil column is relatively uniform in composition and hydraulic redistribution throughout zr allows for water to flow to areas of lower saturation previous soil water balance models have explored the stochastic nature of precipitation times and depths laio et al 2001a laio et al 2001b rodriguez iturbe et al 2001 here stochastic precipitation r t representing a semi arid rain fed environment was used for model development where the average precipitation arrival time followed the poisson distribution mean arrival time 1 21 day 1 mean precipitation depth 0 4 cm respectively the irrigation term i s t represents the irrigation rate as a function of s and t depending on the irrigation method e g drip flood spray and decision rule used i e the frequency and volume of desired irrigation applications the decision rules of the irrigation term require that an irrigation intervention threshold ii and target soil moisture level it be set both ii and it are expressed as a soil moisture percentage of field capacity the intervention threshold ii indicates the point at which irrigation is induced while the target soil moisture level it indicates the point at which irrigation will cease once s reaches or exceeds it water applied directly to the surface via drip or flood irrigation become subject to the dynamics of s while water applied aerially via sprinkler or pivot irrigation is subject to canopy interception and runoff prior to the s dynamics in the soil column the evapotranspiration rate et was assumed proportional to s and c such that et s t c t e t lsw c t k c b e t 0 where etlsw represents the water stress coefficient due to limited soil water availability c t is canopy cover kcb is the basal crop coefficient after allen et al 1998 and et0 is the potential evapotranspiration which was calculated using the hargraeves method to minimize required input data latitude and monthly mean maximum and minimum temperatures hargreaves 1975 hargreaves and allen 2003 the water stress coefficient etlsw is given as a function of s t 2 e t lsw e t w s s h s w s h e t w e t 0 e t w s s w s s w e t 0 s h s s w s w s s s s 1 where s is the soil moisture value below which plants become stressed and begin stomatal closure sw is the soil moisture value inducing plant wilting point sh is the soil moisture value crossing the plant hygroscopic point beyond which moisture losses cease and etw is the reduced evapotranspiration rate under wilting conditions following similar conventions used in porporato et al 2001 porporato et al 2005 laio et al 2001a laio et al 2001b pelak et al 2017 rodriguez iturbe et al 2001 additionally evaporation rate e was explicitly decomposed within et via an evaporation reduction coefficient that was proportionally scaled to c following pelak et al 2017 such that 3 e s c t k r s 1 c e b e t 0 t where eb is the baseline evaporation coefficient and kr s is the evaporation reduction coefficient given by 4 kr s 0 s s h 1 s h s s h s s h this simplification still captures rates of high and low evaporation as s approaches full saturation or sh and allows for decomposition of et during earlier or later parts of the growing seasons as dominance shifts from evaporation e to transpiration t a broader discussion of this tradeoff is given in pelak et al 2017 graphical illustrations of each relationship are shown figure 4 the moisture leakage term q captures losses from runoff as well as deep percolation runoff is modeled as a nonlinear function of c figure 4 while percolation was equal to the hydraulic conductivity given as 5 k s k sat s d where k is the hydraulic conductivity ksat is the saturated hydraulic conductivity and d is an empirically derived parameter value brooks and corey 1964 rodriguez iturbe and porporato 2004 2 3 soil physical and hydraulic conductivity dynamics in order to capture the effects of soil and crop management factors that influence soil processes we incorporate the dynamics of porosity n and matric potential ψs following pelak and porporato pelak and porporato 2019 and clapp and hornberger 1978 the pore size distribution f is modeled as a function of soil pore radius r over time such that 6 dt dt d vf dr mf where v is the soil drift term for shrinking pore radii and m is a source sink term gain or loss of pores at given radius r the integration of the pore size distribution over r is porosity n follows a power law distribution where 7 n t a t r b t dr where a is a scaling parameter and be is the power law exponent the change in radii dr is driven by the v and m defined as 8 v r t r a t b t a t b t ln r a t and 9 m r t b t b t 1 ln r a t a t b t where the prime noted variables are the parameters time derivatives using the same convention as mualem and dagan 1978 brutsaert 2005 and pelak and porporato 2019 the matric potential was expressed as 10 ψ s s t c s r m t s 1 1 b t where cs represents the surface tension of water and rm t is the maximum effective pore radius from this the hydraulic conductivity ksat may be estimated dynamically using the form 11 k sat s t γ w g e n t 2 rm t 2 1 b t 2 μ 3 b t 2 b t s 4 2 b t 1 b t where γw and μ are the specific weight and dynamic viscosity of water and g e is equal to 1 8 assuming the hagen poiseuille equation brutsaert 2005 following the convention used by pelak and porporato 2019 the power law exponent b was decomposed into two time dependent variables that aim to capture management and landscape changes arising from tillage and consolidation and soil organic matter som dynamics introduction of tillage immediately induces soil pore redistribution closer to uniform pore radii that gradually consolidate over time pore consolidation is modeled as an exponential decay function towards the untilled soil pore distribution expressed as the settling term 12 γ b r b 1 r b exp k b ttd where γb is the management factor used in the b term rb is the ratio of the parameter value in an untilled state to the base value kb is the rate of settling and ttd is the time since tillage in days in a cultivated system tillage resets the soil pore distribution to its initial value since ttd equals 0 although som and its turnover cross cuts many of soil processes influencing soil porosity and hydraulic properties and is likely coupled to landscape management practices the som contribution is treated independently the function for bc the effect of som on the b term defined as 13 b c om t b 0 σ b om t where b c is the parameter value at om equal to 0 and σb is the slope of the b om relationship assuming a linear function provides a parsimonious means to incorporating som dynamics however a nonlinear functional form would likely be more realistic the b term then becomes 14 b t t d om t γ b b c finally as porosity n changes over time the porosity value feeds back to the affect the water balance in equation 1 2 4 plant canopy cover dynamics the plant productivity and canopy cover component consists of a single stock of biomass which accumulates through growth due to et and diminishes through losses of senescence and physical disturbance through harvesting livestock grazing or other management treatments giving 15 dc dt g c s n t m c t h c t where g is the canopy growth rate and m is the metabolic and senescence term the growth rate is proportional to nitrogen uptake u 16 g c s n t r g u c s n t where rg represents a scaler of canopy cover growth per unit of nitrogen utilization the metabolic and senescence rate m is defined as a function of both constant metabolism and time dependent senescence terms such that senescence only occurs after the completion of the growing season i e post plant maturity described as 17 m c t r m γ t t sen θ t t sen c 2 where rm is the metabolic constant tsen is the estimated time of senescence in days γ is the slope of the senescence curve post tsen and θ is a step function that causes senescence to begin when soil moisture and nitrogen are non limiting c exhibits patterns of the logistic growth equation exponential growth followed by leveling off near the maturation canopy level hsiao et al 2009 laio et al 2001a pelak et al 2017 finally harvest h is given by 18 h c h v h d where h is initiated at the day of harvest hd either at the end of the growing season e g for crops or periodically e g for grazing with a percentage of biomass removed hv of canopy c canopy that is not harvested becomes soil surface litter cover based on the fraction of canopy becoming surface material c lc and time to litter fall c lt litter remains is a transient state during the nutrient turnover process therefore litter turnover lt is approximated as c lc divided by plant litter turnover time c tt lt reduces the fraction of soil surface coverage and contributes to natural nitrogen deposition described below 2 5 soil nitrogen dynamics soil nitrogen in the soil column is expressed as the balance between fertilization deposition leaching and plant uptake 19 d n c d t d t f n t l s n u s n c t where nc is the total mineral nitrogen content level per unit area soil d is the natural deposition rate assumed constant and f is the fertilization rate at time t of fertilizer application individual nitrate and ammonium concentrations are not modeled since plants may use both forms of n simplifying the model n parameterization a similar convention to pelak et al 2017 leakage l is proportional to the moisture leakage q and the nitrogen concentration at time t 20 l s n η q s where η represents the nitrogen content of soil moisture estimated as 21 η a n s n z where a represents the dissolved n percentage within the soil column plant uptake u is estimated as 22 u s n c t f η t s c t where f η represents the limitation of nitrogen uptake beyond the critical threshold ηc which is the point where additional nitrogen uptake does not facilitate increases in plant growth this takes the form 23 f η a n s n z a n s n z η c η c a n s n z η c using this parameterization it has been shown that reduction in s can either facilitate or hinder nitrogen uptake u pelak et al 2017 for example when s s and η ηc reducing s causes increase in u when s s u will decrease with the corresponding decrease in et 2 6 salinity dynamics the salt content balance expressed as the number of moles of charge or equivalent of cations per unit area is expressed 24 d q s d t i v i q v where qs is the salt dissolved in water in the soil column salt inflow is a function of irrigation applications i with salt concentration vi and the outflow is a function of leakage from the soil column q and v representing the dissolved salt concentration salt concentration v can be expressed as qs w where w represents volumetric water content common cations in saline soils include na ca2 mg2 and k subject to adsorption and desorption dynamics following hsiao et al 2009 we simplify the model consideration to na and ca2 the salt dissolved in water in the soil column qs may therefore be decomposed to 25 q s q s na q s ca or on a percentage basis as 26 e s na q s na q s e s ca q s ca q s where es na es ca 1 total charge of dissolved salts may then be described given 27 q s na c w e s na 28 q s ca c w e s ca to account for the cations adsorbed to negatively charged soil particles the cation exchange capacity cec is used the cec is expressed as 29 c e c q x m q x na q x ca m where x denotes cations in the exchange complex and m is the mass of dry soil to depth zr the salt quantities in the exchange complex are then expressed as 30 q x na c e c m e x na 31 q x ca c e c m e x ca where the fraction of sodium in the exchange complex ex na is noted as the exchangeable sodium percentage esp useful for delineating sodicity hazards in a given soil the balance between soil water and the exchange complex are assumed to be in thermodynamic equilibrium using the following exchange function for the exchangeable sodium ration esr 32 e s r k g s a r where kg represents the gapon selectivity coefficient and sar represents the sodium adsoprtion ratio the esr and esp can therefore be further defined as 33 esr e x na e x ca esp 100 1 esp 100 34 s a r na ca mg 2 which assumes that ca and mg are indistinguishable in the exchange complex following mau and porporato 2015 inclusion of soil salinity and sodicity is important from an agricultural resource management perspective since accumulation of salts can hinder proper plant functions that lead to productivity given the effects of salinity and sodicity on plant productivity allen et al 1998 bernstein 1975 duncan et al 2008 niu and cabrera 2010 qadir and oster 2004 wichelns and qadir 2015 the sodium impact on basal crop coefficient was included as a nonlinear table function such that for ex na or esp levels below 0 3 or 30 there is no reduction in kcb for levels of ex na between 30 and 100 kcb is reduced by 50 figure 4 d 2 7 crop production and yield dynamics the endogenous dynamics of the model are coupled through the linkages between c s n and qs described above out of which crop production and yield arise as products of the interactions between the soil water plant system following the convention of pelak et al 2017 accumulation of crop biomass b is given as a function of water productivity driven by transpiration t along with nitrogen uptake and soil moisture dynamics including nitrogen dynamics along with soil moisture availability which partially drives et allows for examination of moisture and nitrogen limitation in tandem an important coupling in terms of agricultural resource management the detailed formulation for b is described as 35 d b d t w u s n c t η cet 0 t w η c k s s k c b f η c yield y was then estimated as a fraction of the biomass using a harvest index hi giving 36 y b h i 2 8 economic dynamics the economic dynamics account for the input costs and output revenues of the production system input costs include fertilizer expenses dependent on the volume and per unit cost of n while irrigation includes both fixed and variable costs fixed costs of irrigation can vary depending on the method of application while the variable costs of irrigation are simply the volume of water applied multiplied by the water cost per unit this captures the trade off between irrigation systems where systems with high fixed costs per user e g drip or sprinkler systems which have lower variable costs due to savings created through lower water requirements versus systems with lower fixed costs to the user e g flood irrigation that possess higher variable costs due to higher volumes of water applied lastly revenues are determined using the price per unit of crop p multiplied by the yield y returns were then calculated as the difference between revenues and costs 2 9 model calibration measurements and model evaluation in order to calibrate the developed model soil moisture data were obtained via the north american soil moisture database quiring et al 2016 for four locations in the state of texas usa figure 5 representing contrasting soil ecoregional climatic and precipitation regimes and irrigation capabilities table 1 initial s was set to the initial soil moisture level for an observation year containing up to 365 days climate data needed for precipitation forcing and hargreaves et0 calculations were downloaded from weather underground wunderground com for each location since precipitation data were obtained in proximity to and not directly at the locations where soil moisture was recorded an adjustment had to be made for clear outlier precipitation events that did occur in the general area but did not occur at the specific soil monitoring point in total precipitation events had to be reduced or eliminated for 27 days out of a total 1460 days or 365 days for each of the 4 locations or 1 8 of the total simulation days after accounting for these events calibration measurements were taken for metrics of model accuracy mean bias precision coefficient of determination r2 and overall fit theil inequality measures for each site following model evaluation considerations of tedeschi tedeschi 2005 and oliva oliva 1995 theil inequality analysis decomposes the total model error into errors attributable to discrepancies in the mean variance and covariance s of predicted and observed values generally lower theil values for mean and variance are preferable to higher values i e the model captures the general patterns of behavior and where less emphasis is needed on point estimates that would achieve high agreement in covariance estimates however in the case of soil moisture errors in covariance should be considered given the stochastic nature of hydroclimate forcing at each particular location additional calibration checks were made using the other core state variables of the model namely canopy soil cover soil nitrogen and salinity content and the critical soil physical and hydraulic properties including porosity saturated conductivity and soil matric potential in order to evaluate the model s adequacy to replicate behavior patterns and structures in these variables but without data corresponding to the soil moisture monitoring locations we calibrate the model by running a hypothetical crop growing season with similar soils and parameter values as those found in the literature where observed data were used in model development in these cases model simulations of a growing season were compared to model outputs for soil moisture crop canopy cover nitrogen biomass and yield dynamics pelak et al 2017 and soil porosity and pore radii pelak and porporato 2019 to examine the adequacy of underlying soil processes sensitivity analyses were run to examine the behavior of soil salinity to altering irrigation and leakage rates similar to mau and porporato 2015 or for alternative soil moisture levels that drive saturated hydraulic conductivity and soil matric potential similar to pelak and porporato 2019 in the former irrigation and leakage rates were set to constant levels while salinity was allowed to vary while in the latter case soil moisture as a percentage of field capacity was varied from 0 to 100 percent and conductivity and matric potential responses were recorded 2 10 sensitivity analyses after examining the calibration performance for each site the model was returned to its generic soil characteristics used during model development representing an agricultural soil similar to pelak et al pelak et al 2017 for a variety of sensitivity analyses the objective of these tests were to examine the response patterns or characteristics of key model structures to varying parameter value changes representing alternative management schemes in doing so identification of parameters contributing to significant responses in model state variables is possible while simultaneously insuring the model did not produce any physically unrealistic results e g negative soil moisture levels results of sensitivity simulations were compared to the base model results using the statistical screening approach ford and flynn 2005 where variations in input values are correlated to output responses for each time step t this yields an estimate of correlation coefficient r which can take on values from 1 to 1 at each time step making it capable of evaluating the relative strength that each input variable exerts on the output variable over the length of the simulation a useful approach for evaluating the feedback loop strength that the input variables regulate and potential shifting dominance for example negative correlation values indicate a negative or opposite polarity between input and output variables i e reductions in the input lead to increases in the output on the other hand positive correlation values indicate a positive or reinforcing polarity i e increases in on variable lead to sill greater increases in another values closer to 1 indicate perfect negative polarity while values nearer to 1 indicate perfect positive polarity if the coefficient of determination between the input and output variables shifts from negative to positive a shift in polarity may have occurred whereas several other works have examined the sensitivity of exogenous management inputs such as irrigation or fertilization pelak et al 2017 or endogenous factors such as salinity equations mau and porporato 2015 here we present sensitivity analyses of critical climate features primarily precipitation or management features that influence the soil column that have not been well examined in previous modeling work to complete the sensitivity analyses several assumptions were made for the climate test namely alteration of precipitation depth and frequencies we assumed no irrigation to take place in order to examine the response in crop water irrigation requirements from changing precipitation patterns altering frequency and depth of precipitation 25 from their base values of 1 per 40 days for mean event arrival time and 0 5c m for mean depth respectively provided a pragmatic way to evaluate soil moisture dynamics and the plant canopy productivity it supports as well as the derived irrigation demand i e the estimated irrigation demand for crops that would have been demanded given a particular management strategy the hypothetical irrigation system used from comparison was a sprinkler irrigation system subject to canopy interception and runoff dynamics where a relative soil moisture value of 40 of field capacity would induce irrigation applications up to the target relative soil moisture value of 60 of field capacity irrigation application intervals up to 10 days and no flush applications would be applied after the growing season for the remaining management tests we assume that such an irrigation scheme is in use while we vary salinity and crop management factors each test is described below and summarized in table 1 irrigation management factors namely electrolyte concentration of irrigation applications the soil moisture level inducing irrigation application the target soil moisture level at which irrigation applications cease and the application interval base value equal to 10 days were varied from the base irrigation scheme just described by 25 of their initial base values additionally several important crop management factors were also tested fertilization is a significant agroecosystem input as it facilitates crop growth but is also a source of significant economic and environmental cost through leakage and runoff to examine the tradeoff between fertilization costs and benefits fertilization was varied 50 in fertilization rate assuming 1 application at the beginning of the growing season similar to fertilization tillage is an important management practice since it increases soil microporosity and provides a large nutrient release at crop planting however consecutive tillage in the longer term can lead to subsurface compaction from increasing equipment traffic in the field to test the model sensitivity to potential compaction from excessive tillage we vary the soil porosity via a 50 reduction in the initial porosity value alternative soil management practices such as no tillage system that reduce soil disturbance are generally compensated for by the ability to better manage crop residue on the soil surface as well as implement cover cropping systems we therefore examined the impact of no tillage through the incorporation of crop residue management via reduction in canopy removal at time of crop harvest from 100 of crop biomass to 50 as well as implementation of non irrigated cover crops via allowance of plant canopy growth outside of the ordinary growing season finally an increasingly important management practice has been the installation of tile drainage networks to remove water where soils are subject to periodic saturation due to rising water tables a function of snowmelt dynamics but primarily the proximity to low lying wetlands we tested the impact of subsurface tile drainage installation via an additional outflow from the soil column representing tile drain releases where the tile was installed at a depth of 45c m with a 7 5c m diameter in this case the irrigation system is removed since moisture is typically excessive due to water table rises incorporated via capillary rise of 0 05c m per day to represent these alternative soil moisture inflows that necessitate drainage each of these sensitivity simulations provided a means of evaluating model performance while simultaneously gleaning important insights regarding the potential impact that individual alternative management strategies may have on the overall soil moisture and nutrient dynamics arising from common agroecosystems via quantifying strength of influence of input parameters on output variables through statistical screening ford and flynn 2005 3 results 3 1 calibration results overall the model was adequately replicated the soil moisture evolution under varying soil physical and climatic conditions table 2 and figure 6 accuracy measured by mean bias in soil moisture percentage terms was extremely high mean of 0 008 and precision estimates were excellent for two sites edinburg and palestine fair for one site seymour and low for one site that did not have a representative 365 day sample freeman ranch mean r2 value given all sites 0 67 behavior over time graphs for the model generated data compared to observed soil moisture levels as well as the evolution of each theil inequality statistic are provided figure 6 the noteworthy discrepancies between observations and model predictions for each specific site are discussed below the major errors associated with the edinburg and freeman ranch simulations occurred later in the simulation in edinburg this began with several precipitation events occurring at different days between day 240 and 310 after day 275 the model simulated soil moisture did not decline at as rapid a rate as the observed time series indicating that moisture losses or outflows were smaller in the model than in the real world this was likely due in part to the timing of precipitation events but also to the specification of soil evaporation for the ending months at this site was too low because of this the contribution of errors in mean to total model errors rose sharply until the end of the simulation period or growing season data for the freeman ranch were the scarcest leading to fewer days of allowable comparison for the days we did compare discrepancies indicated that the observed and predicted time series both peak at similar points corresponding to precipitation events the slope of the recession limb post precipitation was much steeper in the observed data indicating that the outflows in the model may not be increasing at the appropriate rate especially near the end of the simulation or growing season similar to the edinburg location the results of the edinburg and freeman ranch simulations illustrated a the trade off between accuracy of the mean and covariance estimates that arise in any simulation and b evapotranspiration demand is likely higher at this site at the end of the year due to other environmental factors not included in the model both the palestine and seymour simulations showed high agreement with the observed dynamics of those locations unlike the previous two sites where the moisture outflows were not high enough to drain the soil moisture stock as quickly as the observed record the outflows for the palestine and seymour cases seem to be very well matched i e similar moisture regression slopes regardless of precipitation event the palestine and seymour simulations appeared to be the best behaved compared to the observed data but several discrepancies may be found in either case in the palestine site peaks of soil moisture tend to be somewhat lower or higher compared to the historical data while the slope of soil moisture drawdowns remain consistent therefore the major errors associated with this run were likely the mismatch between location of precipitation events driving the soil moisture as well as parameterization of infiltration and runoff but given the overall estimates for errors in the mean and variance such improvements may not yield significant gains in model performance the seymour site appears to be the model that is the best behaved most of the error resides in the covariance fraction comparing the observed and predicted data there are some discrepancies between the timing of precipitation events relevant to the site e g days 57 85 days 183 211 etc there is likely minimal parameterization improvements needed for the seymour model other than having a precipitation record closer to the soil observation point importantly the integrated model was able to replicate behavior patterns in critical state variables across model components for a hypothetical crop growing season figure 7 soil moisture evolution response to a given precipitation and irrigation sequence figure 7a exhibited similar correspondence a similar ecohydrologic model while crop canopy cover exhibited logistic growth patterns figure 7b planting time 120 days similar to pelak et al pelak et al 2017 tillage which generally occurs just prior to crop planting dates created additional pore space via increase soil pore radii figure 7c and d which gradually collapsed over the growing season as soil properties revert back to pre tillage conditions pelak and porporato 2019 nitrogen uptake figure 7e mimicked crop canopy since nitrogen fuels accelerated crop growth up to the point of maturity at which time nutritent uptake begins to decline pelak et al 2017 while crop biomass and yield continue to grow until harvest harvest time 270 days figure 7f meanwhile salt concentration accumulated in the soil column driven by irrigation rate and leachage fraction defined as the fraction of irrigation applications that infiltrate below the rooting zone expressed similar nonlinear behaviors as mau and porporato mau and porporato 2015 figure 7g additionally varying soil moisture levels had the appropriate response on hydraulic conductivity figure 8 a and matric potential figure 8b 3 2 sensitivity analyses 3 2 1 precipitation frequency and depth the purpose of the precipitation sensitivity test was to evaluate the robustness of the model to alternative values of precipitation by varying mean rainfall arrival times and depths the precipitation sensitivity test had large significant effects on soil moisture and therefore the derived irrigation demand figure 9 in this particular test rainfall was varied from its parameterization of a semi arid precipitation regime up to very humid or down to extremely arid regimes evidenced by the large variation in soil moisture figure 9a of the two factors arrival time had a higher correlation r compared to precipitation depth 0 52 vs 0 24 table 3 and figure 9b indicating that precipitation mean arrival time was more influential in regulating higher soil moisture levels that mean precipitation depths the same effect was also observed in average soil moisture figure 9c and d in terms of derived irrigation demand the mean volume of irrigation that would have been demanded assuming spray irrigation induced at 40 of field capacity continuing until the target soil moisture level of 60 of field capacity is reached was 110cm figure 9e similar to the soil moisture estimates frequency or mean arrival time was more influential than mean precipitation depth i e as mean arrival time was shortened derived irrigation demand decreased table 3 figure 9f 3 2 2 irrigation management tests the purpose of the irrigation management sensitivity test was to evaluate the probable responses of key system characteristics to altered irrigation management criteria irrigation threshold i e the soil moisture level that induces irrigation applications the electrolyte concentration of each irrigation application the irrigation interval i e days between applications and the target soil moisture level that ceases applications altered behavior patterns in response variables are shown in figure 10 while ending cc values between input value changes and responses in model are shown in table 3 no changes in soil moisture occur until the start of the growing season and irrigation applications begin near day 120 figure 10a the majority of simulations occurred within 25 of the mean soil moisture level depending on the particular input combination cumulative irrigation ranged between 25 and 40c m with the majority of simulations occurring within 33 of the mean irrigation level figure 10b although canopy cover varied throughout the growing season in response to moisture availability the ending canopy cover values were within 10 of the mean cover figure 10c electrolyte concentration a function of irrigation applications and the salt concentration therein mimicked the response of cumulative irrigation figure 10d because of the irrigation strategy maintained soil moisture levels greater than what would have been achieved without it both mean soil moisture figure 10e and yield figure 10f showed less variability than did the other parameters of the irrigation sensitivity parameters irrigation threshold had the strongest influence on soil moisture cc 0 44 and yield cc 0 33 table 3 since raising irrigation threshold would induce irrigation applications earlier reducing the likelihood of soil moisture becoming a crop growth limiting factor however a trade off was observed between soil moisture and yield with profit since increased irrigation threshold created greater irrigation applications cc 0 44 which led to increased costs that necessarily reduced profits cc 0 44 similarly raising the target soil moisture level led to increased irrigation levels cc 0 75 and therefore costs which profitability cc 0 83 table 3 electrolyte concentration in irrigation water had little impact on soil and crop parameters except for the soil salt concentration 0 81 at the end of the growing season the influence of irrigation application interval days was consistent across soil and crop factors with cc values ranging from 0 09 to 0 13 but did not as significantly influence any particular factor as the other irrigation parameters table 3 3 2 3 crop management tests the purpose of the crop management sensitivity tests was to evaluate changes in soil and crop system behaviors to alternative management practices employed in various agroecosystems the most common of these practices is fertilization reducing fertilization rates 50 from the base case 0 011k g m2 led to reduced crop transpiration yield and profit figure 11 because of the reduced transpiration mean soil moisture was higher than in the base case table 4 on the other hand increasing fertilization led to greater transpiration due to crop growth rates unhindered by nutrient availability yield and profit figure 11 with a corresponding decrease in mean soil moisture table 4 the influence of tillage if excessive to the point to create a compacted subsurface soil column significantly reduced soil moisture figure 12 a infiltration rates figure 12b mean soil moisture yields and profits table 4 two no till scenarios one with crop residue management and one with non irrigated cover crops revealed divergent dynamics table 4 incorporation of crop residue increased soil moisture levels 10 7 over the base case figure 12c compared to the cover crop scenario of 0 79 respectively figure 12e this was due in large part to the increased transpiration canopy cover and yield under the cover crop scenario that was not present in the crop residue scenario table 4 figure 12d and f for those systems where excessive moisture becomes a problem installation of tile drainage is a common practice used to manage water in the soil column the tile drainage scenario which did not include irrigation due to excessive moisture of rising water tables did reduce soil moisture as well as the evapotranspiration dynamics table 4 figure 12g although yield and profitability were also reduced compared to the base case in reality where these soils necessitating drainage exist yield and profitability prior to drainage are effectively zero therefore the percentage changes for yield and profit under drainage are not shown so long as the annualized cost of tile drain installation does not outweigh expected crop profit margins per unit area it would be economically justifiable to tile table 4 the resulting evapotranspiration dynamics for each of the crop management tests revealed unique evolutions in the soil water balance figure 13 although the peaks rates of et under compaction were similar to that of the no till scenarios it was also more variable figure 13a contributing to lower yields and profits table 4 between the no till scenarios managing for crop residue produced greater mean soil moisture compared to cover cropping table 4 since et was significantly less during times of the year outside of the growing season figure 13b compared to the cover crop whose transpiration rate year round figure 13c drew down soil moisture levels finally the influence of tile drainage created a unique soil moisture evolution given rising water tables figure 13d with drainage soil moisture was maintained near its average condition which constrained et both within and outside of the growing season 4 discussion soil systems form the foundation of agroecosystems that society relies on for the production of food feed and bioenergy and as such the functioning of soil processes are critical for meeting the growing demands of population growth as agricultural production attempts to expand via both intensification i e increasing efficiency and productivity on existing agricultural lands and extensification i e increasing the land use devoted to agriculture soil functions and processes will become increasingly stressed due to a number of unintended consequences such as erosion reduction in water holding capacity loss of soil organic carbon excessive fertilization and water runoff contamination and soil salinization among other externalities variability in hydro climate forcing adds to the already complex nature and behavior of soil systems this paper presented a soil system dynamics model grounded in soil moisture dynamics applications stemming from the field of ecohydrology that demonstrated the ability to integrate soil water and nutrient processes and cross cut multiple agroecosystem management strategies primarily irrigation fertilization and crop management techniques including cover cropping and various tillage practices the model included core state variables for soil moisture nitrogen and salinity crop canopy cover and soil ground cover and crop system profitability the relationships between these components were quantified and parameterized using parsimonious assumptions and leveraging existing ecohydrologic modeling frameworks from a multitude of sources the calibration results efficiently replicated observed soil moisture dynamics for a variety of soil types while other measures or relationships e g nitrogen dynamics canopy cover soil hydraulic conductivity and matric potential produced by the model matched extremely closely to observed or modeled expectations in the literature using a variety of model tests we examined the response in soil system behaviors to varying precipitation irrigation and crop management factors to identify critical feedback linkages between system components some of the response patterns were expected and build additional confidence in the model structure for example increasing frequency and depth of precipitation reduced irrigation demand and therefore costs increased mean soil moisture and yields resulting in improved profitability on the other hand altering irrigation decision parameters resulted in important soil resource and economic outcomes reducing the soil moisture level that induces irrigation and the target soil moisture level led to similar reductions in soil moisture and yield of the two the soil moisture level inducing irrigation was more significant but increased profitability due to the reduced irrigation costs these effects help up regardless of irrigation application interval implying that moisture levels inducing irrigation applications be set as low as possible e g near to s and that the target soil moisture level be determined by the ease of application e g just above s for drip or micro irrigation systems or sfc for spray or flood irrigation systems although previous model studies focused less on the type of irrigation system the convergence on s as an optimal point was also identified by pelak et al 2017 specifically regarding crop management tests increasing or decreasing fertilization rate led to corresponding increases or decreases in soil moisture driven by the changes in transpiration greater fertilization led to greater crop biomass which transpired more moisture or consider soil compaction a common symptom impacting many agroecosystems due to excessive surface disturbances that compress soil pore space under the soil compaction test significant reductions were observed in mean soil moisture evapotranspiration dynamics yield and profit overcoming compaction issues and maintaining adequate pore space for soil water infiltration and storage capacity requires fewer disturbances such as no tillage cultivation practices cover cropping that increases rooting activity and aids in soil aggregation or some combination of the two despite increasing scientific and anecdotal managerial evidence regarding the benefits of no till or cover crop practices in cultivated systems adoption of such practices remain slow less than 20 in the united states united states department of agriculture 2017 this may be due to reluctance to change tillage practices due to high investment costs for equipment in the case of no tillage adoption or concern that residual soil moisture at the beginning of the cash crop growing season will be lower than optimal due to increase et induced during the off season in the case of cover crop adoption in either case the model results showed that no till with residue management or no till with cover cropping both significantly increased yield and profitability with cover cropping being the most profitable and 60 greater than no till with residue management only in terms of soil moisture both strategies increased mean soil moisture levels but only the no till with residue management was significantly greater than the base case for agricultural soils similar to those used to parameterize the model for testing results here show that the benefits in yield and profitability could far outweigh any trade offs in soil moisture dynamics lastly tile drainage which is increasingly used in agroecosystems prone to water table rises in or near wetlands or other low lying areas did significantly reduce soil moisture as well as et dynamics and plant biomass but did lead to significant increases in profitability this provides some economic justification as to why many regions that have experienced recent rapid growth in drain tile installations including in the grain belt of the united states despite potential water runoff and quality issues that may arise like traditional ecohydrologic models the rooting dynamics of various plant or crop types e g shallow vs deep tap vs fibrous and the effect that various rooting strategies have on soil aggregation dynamics was not well parameterized and remains an area for future model improvement especially given the important role that soil aggregation has in regulating soil moisture dynamics along with inherent soil porosity and depth unlike ecohydrologic models however we include the transition from canopy cover to soil cover which facilitated reincorporation of nutrients into the soil column as organic matter is turned over this provides a clear link to expand the model boundary to include soil microbiology dynamics i e the soil food web which would provide a means to scientifically evaluate the physical chemical and biological trade offs that exist in managing the soil processes and function given the variety of goals and constraints of various agroecosystem structures although the model data presented here represented one year at four locations the model can be simulated for longer time horizons preliminary analyses of the long term 10 year evolution in soil moisture and other state variables using alternative precipitation and climate parameters indicate the resulting behavior patterns to be robust however when feedbacks between management strategies were included novel behavior patterns in soil moisture canopy cover and nutrient dynamics emerge results not reported here refining this analysis is the focus of future work described below modeling complex coupled natural human systems including agroecosystems remains an important inter and transdisciplinary research area that requires additional effort and attention given the nature of 21st century problems related to agricultural production future extensions of this model will require expansion of the model boundaries to include additional irrigation fertilization and crop management decision making factors these may include how producers respond to market or policy signals regarding production decisions e g crop type planting and harvest dates environmental penalties due to nutrient leakage etc even more interesting will be to expand the endogenous decision making factors to examine how those feedbacks may alter optimal input strategies for example regions undergoing extensification may see fertilization rates increase above the optimal fertilizer rates to compensate for the lower soil quality soils of newly planted lands that are less suitable for crop production alexander et al 2015 carpenter et al 1998 matson et al 1997 tilman et al 2002 turner et al 2018a turner et al 2018b similarly irrigation strategies may be altered from the optimal irrigation rates due to the nature and distribution of water rights if producers water rights for allocations will be reduced or removed due to lower water use potentially stemming from increased production efficiency then the observed irrigation strategy will likely be higher than the optimal strategy leading to greater water use and reduced profitability per unit output on the other hand where water rights are less clearly defined producers may opportunistically seek to increase water use as a competitive strategy to out produce competitors or secure a claim to the right based on historical use a fuller examination of these decision making tradeoffs is needed which will be explored in future applications of the model presented here and described in a companion paper 5 conclusion effective agricultural systems management requires the knowledge and ability to examine and understand evaluate and then manage the complex dynamic often non linear trade offs that exist at the structural level of agroecosystems including soil systems the soil system dynamics model presented here demonstrated the complex feedback driven relationships that lie at the center of many soil and resource management problems relevant to agroecosystem management today namely the soil moisture nutrient plant canopy feedbacks that give rise to the non linear characteristics of soil moisture and nutrient evolution and crop performance outcomes mathematical modeling of such features in agricultural systems remains an area of much needed development if we are to improve our understanding of and ability to manage complex resource management problems e g irrigation fertilization soil salinity soil erosion and or compaction etc that continue to plague agroecosystems around the world an important feedback process not explicitly included in the model here is the problem of managerial feedback that captures how managers typically respond to agroecosystem challenges e g over irrigation or over fertilization reluctance to adopt no till or cover crop practices in such problems modeling efforts require a broader interdisciplinary perspective beyond the soil system dynamics that include the psychological factors that lead to specific managerial decisions modeling efforts that combine those relationships described here with the human dimensions that drive decision making will help provide a more comprehensive accurate representation of real world problems and provide a more solid foundation for evaluating the effectiveness of proposed agricultural policies and strategies aimed at addressing pressing agricultural resource management problems declaration of competing interests the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was partially supported by united states department of agriculture s higher education challenge grant no 2018 70003 27664 and the national science foundation s center for research excellence in science and technology crest award number 1914745 appendix a table a1 
24852,temporal aggregation of air quality time series is typically used to investigate stylized facts of the underlying series such as multiple seasonal cycles while aggregation reduces complexity commonly used aggregates can suffer from non representativeness or non robustness for example definitions of specific events such as extremes are subjective and may be prone to data contaminations the aim of this paper is to assess the predictability of hourly nitrogen dioxide concentrations and to explore how predictability depends on i level of temporal aggregation ii hour of day and iii concentration level exploratory tools are applied to identify structural patterns problems related to commonly used aggregate statistics and suitable statistical modeling philosophies capable of handling multiple seasonalities and non stationarities hourly times series and subseries of daily measurements for each hour of day are used to investigate the predictability of pollutant levels for each hour of day with prediction horizons ranging from one hour to one week ahead predictability is assessed by time series cross validation of a loss function based on out of sample prediction errors empirical evidence on hourly nitrogen dioxide measurements suggests that predictability strongly depends on conditions i iii for all statistical models for specific hours of day models based on daily series outperform models based on hourly series while in general predictability deteriorates with exposure level keywords air pollution prediction nitrogen dioxide predictability aggregation level multiple seasonality 1 introduction many environmental and socio economic processes are shaped by seasonal variations in annual cycles while anthropogenic influences typically contribute daily and weekly seasonal patterns air pollutants are a particularly complex example of such processes for example nitrogen dioxide no2 concentrations have a pronounced daily cycle layered on top of weekly and annual cycles assessment and prediction of such processes is of considerable public and political interest to protect human health the european air quality directive 2008 50 ec requires that the member states of the european union are obliged to monitor air quality and take action if the limit values for air pollutant concentrations are expected to be exceeded council of the european union 2008 the projects review of evidence on health aspects of air pollution revihaap who 2013 and health risks of air pollution in europe hrapie who 2013 are carried out by the world health organization who to provide a comprehensive scientific evidence based overview of the links between air pollution and adverse health effects and the associated economic consequences in the realm of revihaap and hrapie so called concentration response functions are defined to quantify the health impacts due to air pollution and then used as a basis for a cost benefit analysis of eu air quality policy héroux et al 2015 the reports of revihaap and hrapie give evidence that short and long term exposure to no2 may encourage respiratory and cardiovasular diseases recent works reviewing epidemiological studies are among others hoek et al 2013 and atkinson et al 2018 according to the 2018 report on air quality in europe eea 2018 the ambient air concentrations of particulate matter pm ozone o3 no2 and further pollutants decreased between 2000 and 2016 there are however still exceedances of the critical values and related health risks require further research hence the development of accurate and reliable methods for assessment and prediction of air quality indicators remains to be an important field of research the prediction of local air quality indicators such as no2 concentrations is a particularly challenging problem due to the requirement of statistical modeling of periodic components and their potential variation over time although air quality data are typically available as hourly time series analyses often rely on aggregated data using statistics such as daily maxima or averages various modeling frameworks can be used to address the inherent non stationarities and to produce temporal or spatiotemporal predictions for different time horizons e g cabaneros et al 2019 gocheva ilieva et al 2014 lawson et al 2011 moisan et al 2018 sharma et al 2009 zhao et al 2018 such as hourly exposure daily maxima or annual averages consequences of aggregation are on the one hand a reduction of the number of seasonal cycles but on the other hand an inability to predict the precise hour and not only the level of the maximum exposure on the next day hence relevant information can be masked biased or even deleted in the aggregation process for times series with multiple seasonal patterns such as local no2 concentrations simple aggregates such as time series of daily maxima still exhibit cyclical patterns of weekly and annual length and hence require complex modeling approaches in the literature on multiple seasonal patterns in air quality processes the focus of removing one or more components of the underlying time series often is on descriptive data analysis visualizations at different levels of temporal aggregation are used to detect seasonal patterns and discuss their anthropogenic and meteorological drivers mayer 1999 conducts an exploratory analysis of hourly data on four air pollutants nitrogen monoxide no no2 o3 and the sum of no2 and o3 o x recorded in stuttgart southern germany over the period 1981 1993 and identifies annual weekly and daily cycles degaetano and doherty 2004 analyze data on meteorology and hourly pm concentration levels at 20 monitoring sites in new york city with respect to their spatial and temporal variation they consider extreme concentration percentiles and the median concentration level for each day hour combination their findings suggest that the amplitudes of the seasonal patterns vary with percentiles and that daily and weekly patterns are mainly caused by anthropogenic factors whereas annual patterns arise rather due to meteorological variations liu et al 2015 investigate hourly pm2 5 and pm10 concentration levels in beijing over the period 2004 2012 they explore the daily and annual seasonal patterns in the data using heatmaps to visualize the distribution of the pollutants in dependence of the month and the time of the day further they provide a thorough discussion about the extent to which the patterns can be traced back to meteorological phenomena using bivariate polar plots and correlations moisan et al 2018 account for multiple seasonalities and predict pm2 5 but use multivariate techniques which require auxiliary variables and corresponding predictions and may thus suffer from additional sources of bias one of the few studies dealing with univariate air quality prediction under consideration of multiple seasonalities is the recent work of zhao et al 2018 they use a time series analysis procedure called prophet to investigate weekly and annual seasonality of daily pm2 5 concentrations measured at 220 monitoring sites across the united states over the period 2007 2015 prophet was initially developed for smoothing and predicting daily business data and relies on the generalized additive modeling approach assuming the time series to be additively decomposable into trend seasonality holiday and error component taylor and letham 2018 lawson et al 2011 apply structural time series models to hourly nitrogen oxide data recorded at a monitoring site in dublin to predict one day i e 24 hourly steps ahead due to the short time period of just 40 days of data a single daily seasonal pattern is considered and data referring to weekend days are not included in the analysis in addition they use separate models for the series of morning and evening peak values for some ad hoc selected hours as this can be seen as an aggregation of hourly to daily data the one day ahead predictions correspond to one step ahead predictions applications of the box jenkins modeling approach can be found among others in sharma et al 2009 kumar and jain 2010 or gocheva ilieva et al 2014 they employ seasonal autoregressive integrated moving average sarima models based on hourly data for six pollutants over one year and monthly maxima values of three pollutants over 15 years respectively the prediction horizon is one hour to three days ahead and one month to two years ahead respectively the aim of this work is to assess the predictability of local concentration levels of no2 based on hourly measurements generated by local monitoring sites for the protection of the public against adverse health effects caused by high exposure levels not only the value of a daily statistic is important for assessing the exposure but also the hour of day at which a specific exposure such as the maximum occurs hence our analysis maintains the hour of day reference and considers one hourly time series yt as well as 24 daily series y t ι for each hour ι for every monitoring station in our sample we identify daily and weekly seasonal patterns and apply suitable state of the art univariate time series modeling techniques capable of handling multiple seasonalities and nonstationarities predictability is defined by a loss function based on out of sample h step prediction errors using time series cross validation we produce out of sample predictions for no2 concentration levels for each hour of day with prediction horizons h ranging from one hour to one week we thoroughly discuss the relation between predictability and hour of day and respective no2 concentration level in detail concerning a prediction horizon between one and 24 h the root mean squared error rmse is calculated over the prediction errors that refer to the specific hour of day to be predicted with regard to a prediction horizon between one and seven days the hourly and daily models are evaluated under consideration of the hour of day reference the comparison between daily and hourly models is used to assess whether and if so for which hours of the day the aggregation of hourly to daily data improves the predictive performance to check the robustness of our results we conduct the analysis for different monitoring sites in addition to reporting the predictive performance over all h step prediction errors we evaluate the models predictive performance separately for each hour of day to be predicted the remainder of the paper is organized as follows section 2 describes data and exploratory visualization tools to gain insights into the complex seasonal patterns of the data section 3 introduces modeling framework and methods used to calculate and evaluate predictions section 4 discusses the estimated models and their corresponding predictive performance while section 5 concludes 2 material in our empirical application we consider data on the hourly no2 concentration level in μg m 3 recorded by the european environment agency in four cities located in the south eastern part of bavaria germany over the years 2014 and 2015 the four selected cities differ with respect to population density and monitoring site environment leading to sufficiently heterogeneous exposure levels for the purposes in this study in addition following cabaneros et al 2020 sites with a low percentage of missing values between 2014 and 2015 were selected tables 1 and 2 display the characteristics of the selected monitoring sites and descriptive statistics of the raw data respectively missing values are imputed by applying the r function na approx alternative imputations were calculated using the functions na seadec from r package imputets and na interp from r package forecast both developed for seasonal time series the use of different imputation techniques did not lead to changes in the interpretation of our empirical results predictive gains especially in situations with higher percentages of missing values may be obtained by using more complex and computationally demanding imputation techniques specifically designed for certain constellations of missings and data types examples are procedures requiring geo referenced data e g yi et al 2016 or methods based on recurrent dynamics which do not rely on assumptions about the data generating process e g cao et al 2018 a novel procedure proposed by cabaneros et al 2020 allows spatiotemporal interpolation and hence may also be used for imputation following this avenue is however beyond the scope of this paper all visualizations and the empirical analysis are produced with the statistical software r r core team 2013 in particular the packages cowplot wilke 2019 data table dowle and srinivasan 2019 forecast hyndman and khandakar 2008 hyndman et al 2019 fpp2 hyndman 2018 ggplot2 wickham 2016 imputets moritz and bartz beielstein 2017 lubridate grolemund and wickham 2011 rcolorbrewer neuwirth 2014 reshape2 wickham 2007 and xts ryan and ulrich 2018 in our exposition we discuss empirical findings exemplarily for data recorded in passau germany and provide a summary of results for other monitoring sites used in this study at the end of section 4 fig 1 exemplarily displays the complete and imputed time series of hourly data for passau due to the complexity of temporal air quality processes some key properties of the data can hardly be detected by visual inspection of the complete hourly time series fig 2 provides a more comprehensive picture of no2 variation over daily and weekly cycles we observe differences in the average and median concentration level and the amplitude of the daily series indicating the presence of daily seasonality e g abdullah et al 2019 cabaneros et al 2020 between 5pm and 10pm higher mean and median values and higher amplitudes occur in comparison to the other times of day with all daily series the mean is above the median where the gap between mean and median increases in the evening hours implying an increase in right skewness specifically we highlight the daily time series for 7pm referring to the 60 min between 6pm and 7pm in the bottom left display as the typical peak characterizing the bimodal shape of the no2 concentration distribution over the hours of a day other stylized facts of the daily seasonal pattern we will use in our discussion are the 8am series representing the morning peak and the 1pm series as the minimum between the peaks in the bottom right the boxplots of the daily series for 7pm illustrate the weekly cycle over the days of the week the polar plots shown in fig 3 represent the hourly left display and the 7pm daily right display time series in a circular layout each color refers to a specific week and the corresponding line connects the 24 7 168 measurements for the hourly and the seven measurements for the daily time series respectively the polar plots reveal the variation of daily and weekly seasonality we observe higher values in the evening hours both on weekdays and weekend days this might be due to an increasing traffic load people returning from work or going out on weekends the no2 concentration on saturday and sunday mornings usually is remarkably lower as compared to the mornings of the working days fig 4 displays the variation in daily and weekly seasonal patterns over the no2 concentration distribution the plot is constructed by building a weekly series for each day hour combination which results in 168 weekly series over 2014 and 2015 for each weekday the mean and median curves exhibit the typical bimodal shape caused by anthropogenic factors whereas on weekends just one peak occurs in the evening with regard to the pollution peaks i e values in the top decile q90 max we observe more variability as compared to other quantiles min q50 q50 q75 and q75 q90 and values that are twice as high as the respective mean and median in contrast to the smooth curves for mean and central quantiles the tails of the no2 concentration distribution exhibit more wiggliness and remarkable variations in the amplitude an analysis based on daily mean or median values may draw an overly simplified picture of air pollutant distributions vice versa an analysis based only on daily maxima may be prone to outlier problems and in general may give an unrepresentative picture of air pollutant concentrations since it just incorporates one of the 24 values occurring each day in any case the aggregation of the 24 hourly values to a daily statistic such as mean median or maximum causes the hour of day reference to disappear based on existing health evidence even one hour peak exposures can have adverse health effects who 2013 this means that not only the level of daily peaks is relevant to protect the population from exposure to harmful levels but also the time at which these levels occur if an artificial time series is constructed based on ranks over several series such as daily maxima the resulting series in general does not correspond to an observable time series and has only limited scope for ecological policies an illustrative example for this claim is given by the two panels in fig 5 exemplarily for 8am 1pm and 7pm and two weeks the no2 data is shown in form of boxplots over 24 no2 measurements one for each day of week the pink and lightgreen dotted lines connect the median and maximum values respectively and the darkgreen purple and orange solid lines connect the measurements referring to 8am 1pm and 7pm we observe changes in the seasonal figure and the amplitude of the daily series in particular with respect to the 8am and 7pm series regarding the 7pm values e g the sequence of the increases and decreases from tuesday to sunday in the left and right panel is exactly reversed the amplitude of the 8am series is noticeably higher in the left panel than in the right panel in the left panel the 7pm values coincide with the maximum values and are remarkably higher as compared to the median values on five of the seven days they are even marked as outliers considering the right panel the maximum values are outliers on five of the seven days but do not match a specific hour of day since the daily maximum values correspond to different hours of the day it is not possible to provide a hour of day reference using this daily statistic in air quality assessment fig 6 displays the empirical density curves for the 8am 1pm and 7pm series indicating remarkable differences in the properties of the three time series whereas the values of the 1pm series exhibit a narrow and almost symmetrical distribution the variation of the 8pm series is larger and we observe a tendency to produce more extreme values this tendency peaks for the 7pm series which exhibits by far the largest variation and a pronounced skewness to the right a more detailed picture of the empirical densities is given by fig 7 where the density curves are estimated for every quarter of each of the two years under consideration for all three series the empirical densities vary over the quarters with respect to their mean variance and skewness the 7pm series appears to be less stable over time than the 8am and 1pm series in particular the empirical density curve of the 7pm concentration appears to be most volatile over quarters for our data we do not observe relevant annual changes and hence we will focus on the daily and weekly seasonality the exploratory analysis reveals the presence of a pronounced daily and weekly seasonality in the data with slightly changing features over time this suggests the application of time series modeling techniques capable of dealing with nonstationarities due to complex seasonal patterns we illustrate that the hour of day reference plays an important role in short term prediction in order to protect citizens from harmful levels of pollutants hence we will not aggregate from hourly data to daily statistics e g mean median or maximum as the latter statistics do not provide a complete and representative picture of the practically most relevant daily distribution of air pollutants therefore the hour of day reference is maintained when considering hourly models and daily models built upon time series for specific hours in our exposition exemplarily for 8am 1pm and 7pm according to figs 5 7 the daily series differ with respect to their time series properties exhibiting non stationarities of varying degrees and changes in the seasonal figure and the amplitude over time due to the observed differences it seems reasonable to take hourly and daily models into account and to assess whether and specifically for which hours of the day the daily models enhance the predictability with respect to predicting the hourly no2 concentration level for a specific hour and prediction horizon 3 methods the statistical problems arising from the pronounced anthropogenic structures inherent in air pollutant time series bear a resemblance to other areas of research such as the modeling of local electricity demand examples of resulting modeling tasks are multiple seasonalities trends nonlinearities and associations to related phenomena such as meteorological processes as a consequence similar approaches for modeling complex time series can be applied e g arora and taylor 2018 taylor 2003 2010 taylor and mcsharry 2007 basically there are two ways to handle the prediction task in presence of seasonalities see e g bell and hillmer 1984 or harvey 1989 p 29 one way is to decompose the time series into seasonal and non seasonal components which entails three steps with respect to prediction i e de seasonalizing prediction and re seasonalizing this approach relies on the crucial assumptions of additivity and orthogonality of the seasonal and non seasonal components see proietti and riani 2009 the other way is to incorporate the seasonal patterns in the time series model in the present work we consider one modeling approach based on additive decomposition and two approaches that incorporate seasonal structures directly we consider observed time series y t ι d m t 1 t where ι refers to hour ι 1 24 corresponding to 1am 12pm d refers to day and m refers to month reflecting the different cycles typically present in no2 concentration data as we will not model annual seasonal effects all models allow for arima structures to remedy the potential problems of serial correlation in the error process in our empirical analysis we study hourly time series yt t 1 t and daily time series y t ι t 1 ι t ι for a given hour ι for ease of exposition we will omit ι whenever the context is clear we assume a simple but flexible model structure where yt depends on trend tt season st and perturbation rt a well known member of this model class is the univariate unobserved components model 1 y t h t t s t r t this model is most frequently considered in its additive form h t t s t r t t t s t r t and rt modeled as an arima process the model can be extended to include a cyclical component and exogenous variables see e g young et al 1999 there is a huge literature on models of this type allowing for different mixtures of deterministic and stochastic model components degrees of flexibility and computational burdens the three modeling approaches used in this paper follow the assumption that a linear decomposition of eq 1 exists but allow for some nonlinearities by considering the transformed response variable y t λ with box cox parameter λ where 2 y t λ y t λ 1 λ λ 0 log y t λ 0 as a consequence we study regression models where we assume that y t λ can be approximated by functions of trend and seasonal components such that a dynamically complete specification arises i e a remainder process et can be assumed to be gaussian white noise our baseline predictions are generated using seasonal autoregressive integrated moving average sarima models under the assumption of unchanging seasonal and non seasonal parameters over time e g taylor and mcsharry 2007 see section 3 1 second under the same assumption we employ harmonic regression models with arima errors denoted by harmreg which rely on decomposing the time series into a seasonal and a non seasonal component see section 3 2 third allowing for time varying patterns in all components we employ the tbats model of de livera et al 2011 which incorporates trigonometric seasonality box cox transformation arima errors trend and seasonal components into a state space framework related approaches can be found in taylor 2003 or gould et al 2008 see section 3 3 predictability is analyzed using the cross validated out of sample prediction errors e t h to calculate the rmse see section 3 4 for 75 models i e three hourly and 3 24 72 daily models for each monitoring site in our sample 3 1 seasonal arima model the extension of classical arima models to allow for seasonal cycles of various length belongs to the toolbox of many applied researchers and is a frequently employed benchmark in various fields of application despite the cumbersome structure of seasonal lag polynomials we employ the formulation of hyndman and khandakar 2008 and definition 2 and consider a sarima p d q p d q m model given by 3 φ l m ϕ l 1 l m d 1 l d y t λ θ l m θ l e t where ϕ l 1 ϕ 1 l ϕ p l p and θ l 1 θ 1 l θ q l q are ar and ma lag polynomials of order p and q respectively φ l m 1 φ 1 l m φ p l p m and θ l 1 θ 1 l m θ q l q m denote the seasonal ar and ma lag polynomials of order p and q respectively and e t i i d n 0 σ 2 is gaussian white noise the estimation of a sarima p d q p d q m requires to solve several interrelated problems first identifying the lag lengths p and q and the relevant mode of filtering for stationarity d second estimating the parameters in φ lm and θ l and third testing model validity in our application we use the r function arima and select optimal orders according to the aic akaike information criterion due to its asymptotic efficiency and asymptotic equivalence to the final prediction error criterion which results in testing 324 combinations p q p q 0 1 2 and d d 0 1 the estimated model exemplarily for a sarima 1 0 1 0 1 1 24 model is given by 4 y t λ ϕ 1 y t 1 λ y t 24 λ ϕ 1 y t 25 λ e t θ 1 e t 1 θ 1 e t 24 θ 1 θ 1 e t 25 the corresponding equations for a h step ahead prediction are given by 5 y t h t λ ϕ 1 y t λ y t 23 λ ϕ 1 y t 24 λ θ 1 e t θ 1 e t 23 θ 1 θ 1 e t 24 h 1 ϕ 1 y t h 1 t λ y t h 24 λ ϕ 1 y t h 25 λ θ 1 e t h 24 θ 1 θ 1 e t h 25 1 h 24 ϕ 1 y t 24 t λ y t 1 t λ ϕ 1 y t λ θ 1 θ 1 e t h 25 ϕ 1 y t h 1 t λ y t h 24 t λ ϕ 1 y t h 25 t λ h 25 note that the prediction equations for 1 h 24 can also be written as 6 y t h t λ ϕ 1 h y t λ y t 24 h λ ϕ 1 h y t 24 λ ϕ 1 h 1 θ 1 e t θ 1 e t 24 h ϕ 1 h 1 θ 1 θ 1 e t 24 j 1 h 1 ϕ 1 h 1 j ϕ 1 θ 1 θ 1 e t 24 j applying the inverse box cox transformation of wooldridge 1992 to the prediction yields 7 y t h t λ y t h t λ 1 1 λ λ 0 exp y t h t λ λ 0 to apply the sarima model stated in eq 3 to y t ι substitute yt by y t ι and set m 7 3 2 harmonic regression model with arima errors for this model class we assume that yt is additively separable and can be decomposed into a seasonal component st that corresponds to a sum of seasonal terms s j t j 1 j and a non seasonal component zt modeled as an arima p d q process under these assumptions and definition 2 a harmonic regression model with arima errors can be stated as 8a y t λ s t z t 8b ϕ l 1 l d z t θ l e t where ϕ l 1 ϕ 1 l ϕ p l p and θ l 1 θ 1 l θ q l q are ar and ma lag polynomials of order p and q respectively e t i i d n 0 σ 2 is gaussian white noise and the seasonal component in 8a is defined by 9 s t j 1 j s j t j 1 j k 0 k j a j k cos 2 π t k m j b j k sin 2 π t k m j the seasonal component st is assumed to be a periodic process with multiple frequencies and amplitudes the frequency of s j t is denoted by mj and the number of harmonics required for s j t is denoted by kj where 0 kj mj 2 for even values of mj and 0 k j m j 1 2 for odd values of mj e g harvey 1989 ch 3 2 and shumway and stoffer 2017 ch 4 the hourly no2 time series have two seasonal cycles with frequencies 24 and 168 i e j 2 m 1 24 and m 2 168 to apply model 8a and 8b to daily time series y t ι substitute yt by y t ι and set j 1 and m 1 7 for estimation the r function auto arima is applied to hourly data for different combinations of k 1 and k 2 and to daily data for different numbers of k 1 in order to identify the optimal number s of harmonics minimizing aic see section 3 1 this includes three steps first estimating λ for pre specified k 1 and k 2 second regressing the transformed response y t λ on the harmonics cos 2πtk mj and sin 2 π t k m j k 0 k j j 1 2 to obtain the residuals z t and third fitting a family of arima models to the residuals z t in order to identify the optimal order in eq 8b according to aic the equations for a h step ahead prediction exemplarily with arima 1 0 2 errors are given by 10a y t h t λ e y t h λ z t z t 1 z 1 s t h 10b s t h ϕ 1 z t θ 1 e t θ 2 e t 1 h 1 ϕ 1 z t 1 t θ 2 e t h 2 ϕ 1 z t h 1 t h 2 eq 10a states that the predicted value corresponds to the expected value conditional on the residuals from the auxiliary regression and the prediction for s t h which is according to eq 9 obtained by s t h j 1 j k 0 k j a j k cos 2 π t h k m j b j k sin 2 π t h k m j note that the procedure described above substantially differs from the dynamic harmonic regression model of young et al 1999 which allows for stochastic time varying parameters in eq 9 in a state space framework 3 3 tbats model de livera et al 2011 propose a state space framework to deal with multiple seasonality extending earlier exponential smoothing approaches their approach allows for complex non integer seasonality provides a simple remedy for neglected cycles causing serially correlated errors and avoids issues with nonlinear exponential smoothing models the tbats model is given by 11a y t λ l t 1 ψ b t 1 j 1 j s t 1 j d t 11b l t l t 1 α d t 11c b t 1 ψ b ψ b t 1 β d t 11d s t j k 1 k j s k t j 11e d t i 1 p ϕ i d t i i 1 q θ i e t i e t where the seasonal components in 11d are calculated according to 12a s k t j s k t 1 j cos 2 π t k m j s k t 1 j sin 2 π t k m j γ 1 j d t 12b s k t j s k t 1 j sin 2 π t k m j s k t 1 j cos 2 π t k m j γ 2 j d t eq 11a denotes the measurement equation eqs 11b to 11d are the smoothing equations for level trend and seasonality where b denotes the long term trend and eq 11e incorporates arima structures in the error component where again e t i i d n 0 σ 2 is gaussian white noise the smoothness of the seasonal component s t j is controlled by the number of harmonics kj for no2 data we observe two seasonalities with frequencies 24 and 168 and have to estimate the box cox parameter λ the dampening parameter ψ the smoothing parameters α β γ 1 j γ 2 j j 1 2 the number of harmonics k 1 and k 2 the arima parameters ϕ 1 ϕ p and θ 1 θ q as well as starting values for the level for the fourier coefficients s k t 1 j and s k t 1 j j 1 2 and for the error term for the application of the tbats model to y t ι we substitute yt by y t ι and set j 1 and m 1 7 in matrix notation the tbats model 11a to 11e is given by 13a y t λ w x t 1 e t 13b x t f x t 1 g e t the h step ahead prediction is given by 14 y t h t λ w f h 1 x t and the re transformation is carried out according to eq 7 3 4 procedure for evaluation of predictability for model evaluation we conduct a time series out of sample cross validation with extending windows in each validation loop the training sample is extended by one time unit i e one hour for hourly hly time series and one day for daily dly time series respectively in order to get reliable initial estimates for further iteration we split the data after the first 69 weeks the resulting training sample then has length 69 168 11592 69 7 483 for the hourly daily models respectively which corresponds to approx 66 66 of the data given that we consider prediction horizons ranging between 1 and 168 h for hly time series 1 and 7 days for dly time series we can conduct 5000 hly 240 dly cross validation steps which implies that the testing uses approx 28 5 33 of the data note that k fold cross validation is not feasible as all models employed in this study are fully iterative see bergmeir et al 2018 in the following we provide details on the evaluation algorithm hourly time series hly 1 fit the model to an initial training sample y t 0 y t 1 where t 0 1 and t 1 69 168 11592 i e the training sample comprises 69 weeks of data and denote the estimated model by m o d t 1 hly 2 in the n th loop n 0 n n 4999 of the time series cross validation extend the training sample by n hours update m o d t 1 for the new training sample and use the updated model to predict one hour to one week ahead which yields the predicted values y t 1 n h t 1 n for each h 1 168 calculate the out of sample prediction errors e t 1 n h t 1 n y t 1 n h y t 1 n h t 1 n hly 3 after 5000 loops for each prediction horizon h calculate the out of sample rmse 15 r m s e h h l y 1 n 1 n 0 n e t 1 n h t 1 n 2 hly 4 filter the estimated prediction errors for hour ι of the respective day and calculate for each combination of ι and h the respective rmse 16 r m s e h ι h l y 1 n 1 24 n 0 t 1 n h refers to ι 4992 1 e t 1 n h t 1 n 2 where the upper bound is set to 4991 to ensure that the subseries of prediction errors are of equal length for each ι ι 1 24 daily time series dly 1 fit the model to an initial training sample y t 0 ι y t 1 ι where t 0 1 and t 1 69 7 483 i e the training sample comprises 69 weeks of data and denote the estimated model by m o d t 1 dly 2 in the n th loop n 0 n n 239 of the time series cross validation extend the training sample by n days update m o d t 1 for the new training sample and use the updated model to predict one day to one week ahead which yields y t 1 ι n h t 1 ι n for each h 1 7 calculate the out of sample errors e t 1 ι n h t 1 ι n y t 1 ι n h y t 1 ι n h t 1 ι n dly 3 after 240 loops for each prediction horizon h calculate the out of sample rmse 17 r m s e h ι d l y 1 n 1 n 0 n e t 1 ι n h t 1 n 2 the flowchart in fig 8 graphically summarizes the steps of our empirical analysis 4 results and discussion in this section we discuss the prediction accuracy of the estimated models using hourly data yt and daily data y t ι exemplarily for the hours ι 8am 1pm 7pm as motivated in section 2 further details are given in the appendix the evaluation of the models is carried out according to the procedure described in the preceding section note that due to the estimation procedure of the implemented r functions the fitted values and the residuals refer to one step ahead predictions and one step ahead prediction errors respectively corresponding to one hour ahead using hourly data and one day ahead using daily data prediction horizons as shown in fig 9 the hourly sarima model outperforms the daily sarima models for all hours of day concerning the in sample rmse values however when the focus lies on predicting the air pollutant concentration one day ahead it might be reasonable to consider 24 step ahead prediction errors and 1 step ahead prediction errors for the hourly and daily models respectively to provide an appropriate comparison between hourly and daily models the upper panel of fig 10 displays for the last week of the initial training sample and the first week of the initial test sample the fitted and predicted values derived from the hourly models concerning the training period all models fit the data remarkably well as sarima just incorporates the daily seasonality the pattern in the predicted values repeats every 24 h differences in the daily course of the no2 concentration levels from weekdays to weekend days can clearly be seen in the predicted values referring to harmreg and tbats the morning and evening modes are less pronounced between t 72 and t 120 which correspond to saturday and sunday the lower panel of fig 10 zooms into the upper panel and displays the last day of the initial training sample and the first day of the initial test sample fig 11 displays boxplots of the fitted sarima model values for each hour of day derived from the hourly upper panel and the 24 daily lower panel models both panels in fig 11 reveal the bimodal daily pattern the interquartile range the gap between median and mean value and the number of outliers are higher for the hourly model compared to the daily models in particular concerning the evening hours analogous plots for the residuals in fig 12 reveal a tendency that the use of hourly data provides a more accurate fit to the training data in comparison to the use of daily data figures such as fig 11 and fig 12 for the fitted values and the residuals derived from the other two modeling approaches harmreg and tbats provide an analogous conclusion fig 13 shows the out of sample rmse values for a prediction horizon from 1 to 24 h calculated according to eq 15 and reveals that sarima outperforms the other two models with respect to the rmse values built over all prediction errors according to fig 14 there is no remarkable change in the out of sample rmse values concerning a prediction horizon from 1 to 7 days sarima still outperforms the other two models with respect to the rmse values built over all prediction errors regarding the panels in fig 15 a different conclusion is drawn the prediction performance of each model depends on the hour of day to be predicted in terms of rmse for 8am upper panel of fig 15 harmreg outperforms tbats and sarima for h 4 concerning 1pm middle panel of fig 15 harmreg slightly outperforms sarima and tbats for h 8 according to the lower panel of fig 15 the 7pm values are best predicted by sarima there are remarkable differences in the rmse values for different hours of day which might be due the various degrees of variability and complexity in the daily series y t ι compare fig 6 and fig 7 a comparison of the model performance in terms of the aggregation level of the data is shown in fig 16 where the rmse for prediction horizons h 1 7 is depicted for the daily and hourly models the formulas to obtain the rmse values correspond to those stated in eqs 16 and 17 note that the scale of the ordinate in the panels of fig 16 is fixed in order to ease model comparison with respect to the predictability of the hours of day the left and right panel suggest to build models based on daily series whereas the middle panel shows the lowest rmse values for the hourly harmreg model in the right panel in particular rmse values are remarkably lower for models using daily series we conclude our discussion with tables 3 and 4 summarizing the previous results and contrasting them for all four monitoring sites in this study for a prediction horizon of 1 24 and 168 h s the overall rmse for each hourly model is reported in table 3 there are no remarkable differences in the rmse values between the three modeling techniques the rmse increases with the prediction horizon up to 24 h ahead and changes only slightly afterwards this can be explained as follows the underlying time series is stationary at every position hour s of the seasonal cycle hence with increasing prediction horizon h beyond h 24 for a prediction y t h t h 25 26 only the predictive power of the long term mean of the time series at every position s remains and the prediction error converges to the long run variance of the underlying process note that this prediction only has information up to time period t but not about the latest seasonal cycle i e y t 1 y t 24 theoretically and given a consistent estimate of the long term mean the predictive power of the long term mean should not deteriorate substantially as long as the properties of the underlying process do not change substantially see brockwell and davis 1991 sec 5 2 exemplarily for sarima and a prediction horizon of 24 h 1 day and 168 h 7 days the rmse in dependence of the hour of day to be predicted is shown in table 4 for sarima as well as harmreg and tbats and several hours we observe a tendency that the use of daily data reduces rmse in comparison to the use of hourly data further results are available from the authors upon request 5 conclusions predictions of air pollutant concentrations play an important role in protecting the population from potential adverse health effects the development of appropriate prediction models is challenging as temporal air quality processes exhibit multiple seasonal patterns and non stationarities there are many studies on predicting air quality taking into account one seasonality but few on multi seasonal prediction models furthermore model evaluation is generally based on all prediction errors without reference to the hour to be predicted e g time of day we propose a framework to assess the predictability of local concentration levels of no2 or other air pollutants based on hourly measurements generated by local monitoring sites our analysis maintains the hour of day reference and considers hourly time series and daily series for each hour and every monitoring site predictability is assessed via loss functions based on out of sample h step prediction errors using time series cross validation we produce out of sample predictions for no2 concentration levels for each hour of day with prediction horizons h ranging from one hour to one week in an empirical analysis we apply state of the art multi seasonal univariate prediction models to hourly no2 data from four monitoring sites in germany we thoroughly discuss the relation between predictability and hour of day and respective no2 concentration level separately for each hour of day to obtain a comprehensive picture of the model performance we find that prediction accuracy strongly depends on the hour of day to be predicted for hours that tend to exhibit relatively high pollutant levels the predictability of both hourly and daily models deteriorates for some hours a prediction gain can be achieved by building the models on daily instead of hourly data similar findings for the other monitoring sites suggest at least some regional robustness of our results in future extensions of this work further performance criteria can be investigated such as a hit or success rate for correct forecasts of the hour of maximal exposure the use of univariate methods has the advantage of being independent of additional and potentially costly predictors on the other hand the inclusion of covariates e g information on weather or traffic may improve the predictability in general and of hours of day with high exposure in particular acknowledgments we thank two anonymous referees an associate editor marek brabec markus fritsch philipp sibbertsen james taylor matthias wild and the participants of the international society for ecological modelling global conference 2019 in salzburg austria and the participants of the workshop on statistical modelling of environmental data 2019 in passau germany for helpful comments and suggestions all remaining errors are ours appendix a this appendix provides details on estimation setups and results for models based on hourly and daily data recorded in 2014 and 2015 at the monitoring site in passau table 5 gives an overview over the meta parameters of the estimated hourly and daily models we focus on details for harmreg and tbats further results are available upon request details harmreg we have applied the function auto arima to the training sample yt for 192 different combinations of k 1 and k 2 with k 1 1 12 and k 2 1 16 to identify the optimal number of harmonics in harmreg fig a 17 displays how the deciles of the resulting aic values are distributed over the combinations of k 1 and k 2 where the combination k 1 11 and k 2 13 14 returns the minimum aic value the residuals derived from the harmonic regression with k 1 11 and k 2 13 harmonics representing daily and weekly seasonal patterns respectively follow an arima 5 1 1 process for the daily models the identification of the optimal number of harmonics is less cumbersome since the weekly seasonality implies m 1 7 and thus 0 k 1 3 see subsection 3 2 details tbats an extract from the output of the estimated hourly tbats model is given by tbats 0 207 0 0 0 801 24 5 168 5 lambda 0 206589 alpha 1 204514 beta 0 2897133 damping parameter 0 80129 gamma 1 values 0 004004553 0 001977883 gamma 2 values 0 001286855 0 0001531337 the estimated number of harmonics is five for both the daily and weekly seasonal component the box cox and damping parameter equals 0 207 and 0 801 respectively and the estimated error follows a white noise process the smoothing parameters of the seasonal components are quite small the smoothing parameter for the level and trend equation is equal to 1 205 and 0 290 respectively fig 17 shows for the first five weeks of the initial training sample the components of the hourly tbats model the component observed refers to the box cox transformed data that are decomposed into level slope season1 daily seasonality season2 weekly seasonality and residuals season refers to the sum of season1 and season2 note that the first day of the data under consideration 1st january 2014 is a wednesday and the drops in season2 refer to the weekends the component level changes much faster than the seasonal components which is in accordance to the values of the corresponding smoothing parameters further we observe that the value range of season is about a fifth of the value range of level we may understand level as the baseline no2 exposure and season as the variation due to the day of the week and the hour of day the estimated daily tbats models for 8am 1pm and 7pm are t b a t s 0 108 1 0 7 3 t b a t s 0 512 0 0 7 3 and t b a t s 0 234 0 1 7 3 respectively 
24852,temporal aggregation of air quality time series is typically used to investigate stylized facts of the underlying series such as multiple seasonal cycles while aggregation reduces complexity commonly used aggregates can suffer from non representativeness or non robustness for example definitions of specific events such as extremes are subjective and may be prone to data contaminations the aim of this paper is to assess the predictability of hourly nitrogen dioxide concentrations and to explore how predictability depends on i level of temporal aggregation ii hour of day and iii concentration level exploratory tools are applied to identify structural patterns problems related to commonly used aggregate statistics and suitable statistical modeling philosophies capable of handling multiple seasonalities and non stationarities hourly times series and subseries of daily measurements for each hour of day are used to investigate the predictability of pollutant levels for each hour of day with prediction horizons ranging from one hour to one week ahead predictability is assessed by time series cross validation of a loss function based on out of sample prediction errors empirical evidence on hourly nitrogen dioxide measurements suggests that predictability strongly depends on conditions i iii for all statistical models for specific hours of day models based on daily series outperform models based on hourly series while in general predictability deteriorates with exposure level keywords air pollution prediction nitrogen dioxide predictability aggregation level multiple seasonality 1 introduction many environmental and socio economic processes are shaped by seasonal variations in annual cycles while anthropogenic influences typically contribute daily and weekly seasonal patterns air pollutants are a particularly complex example of such processes for example nitrogen dioxide no2 concentrations have a pronounced daily cycle layered on top of weekly and annual cycles assessment and prediction of such processes is of considerable public and political interest to protect human health the european air quality directive 2008 50 ec requires that the member states of the european union are obliged to monitor air quality and take action if the limit values for air pollutant concentrations are expected to be exceeded council of the european union 2008 the projects review of evidence on health aspects of air pollution revihaap who 2013 and health risks of air pollution in europe hrapie who 2013 are carried out by the world health organization who to provide a comprehensive scientific evidence based overview of the links between air pollution and adverse health effects and the associated economic consequences in the realm of revihaap and hrapie so called concentration response functions are defined to quantify the health impacts due to air pollution and then used as a basis for a cost benefit analysis of eu air quality policy héroux et al 2015 the reports of revihaap and hrapie give evidence that short and long term exposure to no2 may encourage respiratory and cardiovasular diseases recent works reviewing epidemiological studies are among others hoek et al 2013 and atkinson et al 2018 according to the 2018 report on air quality in europe eea 2018 the ambient air concentrations of particulate matter pm ozone o3 no2 and further pollutants decreased between 2000 and 2016 there are however still exceedances of the critical values and related health risks require further research hence the development of accurate and reliable methods for assessment and prediction of air quality indicators remains to be an important field of research the prediction of local air quality indicators such as no2 concentrations is a particularly challenging problem due to the requirement of statistical modeling of periodic components and their potential variation over time although air quality data are typically available as hourly time series analyses often rely on aggregated data using statistics such as daily maxima or averages various modeling frameworks can be used to address the inherent non stationarities and to produce temporal or spatiotemporal predictions for different time horizons e g cabaneros et al 2019 gocheva ilieva et al 2014 lawson et al 2011 moisan et al 2018 sharma et al 2009 zhao et al 2018 such as hourly exposure daily maxima or annual averages consequences of aggregation are on the one hand a reduction of the number of seasonal cycles but on the other hand an inability to predict the precise hour and not only the level of the maximum exposure on the next day hence relevant information can be masked biased or even deleted in the aggregation process for times series with multiple seasonal patterns such as local no2 concentrations simple aggregates such as time series of daily maxima still exhibit cyclical patterns of weekly and annual length and hence require complex modeling approaches in the literature on multiple seasonal patterns in air quality processes the focus of removing one or more components of the underlying time series often is on descriptive data analysis visualizations at different levels of temporal aggregation are used to detect seasonal patterns and discuss their anthropogenic and meteorological drivers mayer 1999 conducts an exploratory analysis of hourly data on four air pollutants nitrogen monoxide no no2 o3 and the sum of no2 and o3 o x recorded in stuttgart southern germany over the period 1981 1993 and identifies annual weekly and daily cycles degaetano and doherty 2004 analyze data on meteorology and hourly pm concentration levels at 20 monitoring sites in new york city with respect to their spatial and temporal variation they consider extreme concentration percentiles and the median concentration level for each day hour combination their findings suggest that the amplitudes of the seasonal patterns vary with percentiles and that daily and weekly patterns are mainly caused by anthropogenic factors whereas annual patterns arise rather due to meteorological variations liu et al 2015 investigate hourly pm2 5 and pm10 concentration levels in beijing over the period 2004 2012 they explore the daily and annual seasonal patterns in the data using heatmaps to visualize the distribution of the pollutants in dependence of the month and the time of the day further they provide a thorough discussion about the extent to which the patterns can be traced back to meteorological phenomena using bivariate polar plots and correlations moisan et al 2018 account for multiple seasonalities and predict pm2 5 but use multivariate techniques which require auxiliary variables and corresponding predictions and may thus suffer from additional sources of bias one of the few studies dealing with univariate air quality prediction under consideration of multiple seasonalities is the recent work of zhao et al 2018 they use a time series analysis procedure called prophet to investigate weekly and annual seasonality of daily pm2 5 concentrations measured at 220 monitoring sites across the united states over the period 2007 2015 prophet was initially developed for smoothing and predicting daily business data and relies on the generalized additive modeling approach assuming the time series to be additively decomposable into trend seasonality holiday and error component taylor and letham 2018 lawson et al 2011 apply structural time series models to hourly nitrogen oxide data recorded at a monitoring site in dublin to predict one day i e 24 hourly steps ahead due to the short time period of just 40 days of data a single daily seasonal pattern is considered and data referring to weekend days are not included in the analysis in addition they use separate models for the series of morning and evening peak values for some ad hoc selected hours as this can be seen as an aggregation of hourly to daily data the one day ahead predictions correspond to one step ahead predictions applications of the box jenkins modeling approach can be found among others in sharma et al 2009 kumar and jain 2010 or gocheva ilieva et al 2014 they employ seasonal autoregressive integrated moving average sarima models based on hourly data for six pollutants over one year and monthly maxima values of three pollutants over 15 years respectively the prediction horizon is one hour to three days ahead and one month to two years ahead respectively the aim of this work is to assess the predictability of local concentration levels of no2 based on hourly measurements generated by local monitoring sites for the protection of the public against adverse health effects caused by high exposure levels not only the value of a daily statistic is important for assessing the exposure but also the hour of day at which a specific exposure such as the maximum occurs hence our analysis maintains the hour of day reference and considers one hourly time series yt as well as 24 daily series y t ι for each hour ι for every monitoring station in our sample we identify daily and weekly seasonal patterns and apply suitable state of the art univariate time series modeling techniques capable of handling multiple seasonalities and nonstationarities predictability is defined by a loss function based on out of sample h step prediction errors using time series cross validation we produce out of sample predictions for no2 concentration levels for each hour of day with prediction horizons h ranging from one hour to one week we thoroughly discuss the relation between predictability and hour of day and respective no2 concentration level in detail concerning a prediction horizon between one and 24 h the root mean squared error rmse is calculated over the prediction errors that refer to the specific hour of day to be predicted with regard to a prediction horizon between one and seven days the hourly and daily models are evaluated under consideration of the hour of day reference the comparison between daily and hourly models is used to assess whether and if so for which hours of the day the aggregation of hourly to daily data improves the predictive performance to check the robustness of our results we conduct the analysis for different monitoring sites in addition to reporting the predictive performance over all h step prediction errors we evaluate the models predictive performance separately for each hour of day to be predicted the remainder of the paper is organized as follows section 2 describes data and exploratory visualization tools to gain insights into the complex seasonal patterns of the data section 3 introduces modeling framework and methods used to calculate and evaluate predictions section 4 discusses the estimated models and their corresponding predictive performance while section 5 concludes 2 material in our empirical application we consider data on the hourly no2 concentration level in μg m 3 recorded by the european environment agency in four cities located in the south eastern part of bavaria germany over the years 2014 and 2015 the four selected cities differ with respect to population density and monitoring site environment leading to sufficiently heterogeneous exposure levels for the purposes in this study in addition following cabaneros et al 2020 sites with a low percentage of missing values between 2014 and 2015 were selected tables 1 and 2 display the characteristics of the selected monitoring sites and descriptive statistics of the raw data respectively missing values are imputed by applying the r function na approx alternative imputations were calculated using the functions na seadec from r package imputets and na interp from r package forecast both developed for seasonal time series the use of different imputation techniques did not lead to changes in the interpretation of our empirical results predictive gains especially in situations with higher percentages of missing values may be obtained by using more complex and computationally demanding imputation techniques specifically designed for certain constellations of missings and data types examples are procedures requiring geo referenced data e g yi et al 2016 or methods based on recurrent dynamics which do not rely on assumptions about the data generating process e g cao et al 2018 a novel procedure proposed by cabaneros et al 2020 allows spatiotemporal interpolation and hence may also be used for imputation following this avenue is however beyond the scope of this paper all visualizations and the empirical analysis are produced with the statistical software r r core team 2013 in particular the packages cowplot wilke 2019 data table dowle and srinivasan 2019 forecast hyndman and khandakar 2008 hyndman et al 2019 fpp2 hyndman 2018 ggplot2 wickham 2016 imputets moritz and bartz beielstein 2017 lubridate grolemund and wickham 2011 rcolorbrewer neuwirth 2014 reshape2 wickham 2007 and xts ryan and ulrich 2018 in our exposition we discuss empirical findings exemplarily for data recorded in passau germany and provide a summary of results for other monitoring sites used in this study at the end of section 4 fig 1 exemplarily displays the complete and imputed time series of hourly data for passau due to the complexity of temporal air quality processes some key properties of the data can hardly be detected by visual inspection of the complete hourly time series fig 2 provides a more comprehensive picture of no2 variation over daily and weekly cycles we observe differences in the average and median concentration level and the amplitude of the daily series indicating the presence of daily seasonality e g abdullah et al 2019 cabaneros et al 2020 between 5pm and 10pm higher mean and median values and higher amplitudes occur in comparison to the other times of day with all daily series the mean is above the median where the gap between mean and median increases in the evening hours implying an increase in right skewness specifically we highlight the daily time series for 7pm referring to the 60 min between 6pm and 7pm in the bottom left display as the typical peak characterizing the bimodal shape of the no2 concentration distribution over the hours of a day other stylized facts of the daily seasonal pattern we will use in our discussion are the 8am series representing the morning peak and the 1pm series as the minimum between the peaks in the bottom right the boxplots of the daily series for 7pm illustrate the weekly cycle over the days of the week the polar plots shown in fig 3 represent the hourly left display and the 7pm daily right display time series in a circular layout each color refers to a specific week and the corresponding line connects the 24 7 168 measurements for the hourly and the seven measurements for the daily time series respectively the polar plots reveal the variation of daily and weekly seasonality we observe higher values in the evening hours both on weekdays and weekend days this might be due to an increasing traffic load people returning from work or going out on weekends the no2 concentration on saturday and sunday mornings usually is remarkably lower as compared to the mornings of the working days fig 4 displays the variation in daily and weekly seasonal patterns over the no2 concentration distribution the plot is constructed by building a weekly series for each day hour combination which results in 168 weekly series over 2014 and 2015 for each weekday the mean and median curves exhibit the typical bimodal shape caused by anthropogenic factors whereas on weekends just one peak occurs in the evening with regard to the pollution peaks i e values in the top decile q90 max we observe more variability as compared to other quantiles min q50 q50 q75 and q75 q90 and values that are twice as high as the respective mean and median in contrast to the smooth curves for mean and central quantiles the tails of the no2 concentration distribution exhibit more wiggliness and remarkable variations in the amplitude an analysis based on daily mean or median values may draw an overly simplified picture of air pollutant distributions vice versa an analysis based only on daily maxima may be prone to outlier problems and in general may give an unrepresentative picture of air pollutant concentrations since it just incorporates one of the 24 values occurring each day in any case the aggregation of the 24 hourly values to a daily statistic such as mean median or maximum causes the hour of day reference to disappear based on existing health evidence even one hour peak exposures can have adverse health effects who 2013 this means that not only the level of daily peaks is relevant to protect the population from exposure to harmful levels but also the time at which these levels occur if an artificial time series is constructed based on ranks over several series such as daily maxima the resulting series in general does not correspond to an observable time series and has only limited scope for ecological policies an illustrative example for this claim is given by the two panels in fig 5 exemplarily for 8am 1pm and 7pm and two weeks the no2 data is shown in form of boxplots over 24 no2 measurements one for each day of week the pink and lightgreen dotted lines connect the median and maximum values respectively and the darkgreen purple and orange solid lines connect the measurements referring to 8am 1pm and 7pm we observe changes in the seasonal figure and the amplitude of the daily series in particular with respect to the 8am and 7pm series regarding the 7pm values e g the sequence of the increases and decreases from tuesday to sunday in the left and right panel is exactly reversed the amplitude of the 8am series is noticeably higher in the left panel than in the right panel in the left panel the 7pm values coincide with the maximum values and are remarkably higher as compared to the median values on five of the seven days they are even marked as outliers considering the right panel the maximum values are outliers on five of the seven days but do not match a specific hour of day since the daily maximum values correspond to different hours of the day it is not possible to provide a hour of day reference using this daily statistic in air quality assessment fig 6 displays the empirical density curves for the 8am 1pm and 7pm series indicating remarkable differences in the properties of the three time series whereas the values of the 1pm series exhibit a narrow and almost symmetrical distribution the variation of the 8pm series is larger and we observe a tendency to produce more extreme values this tendency peaks for the 7pm series which exhibits by far the largest variation and a pronounced skewness to the right a more detailed picture of the empirical densities is given by fig 7 where the density curves are estimated for every quarter of each of the two years under consideration for all three series the empirical densities vary over the quarters with respect to their mean variance and skewness the 7pm series appears to be less stable over time than the 8am and 1pm series in particular the empirical density curve of the 7pm concentration appears to be most volatile over quarters for our data we do not observe relevant annual changes and hence we will focus on the daily and weekly seasonality the exploratory analysis reveals the presence of a pronounced daily and weekly seasonality in the data with slightly changing features over time this suggests the application of time series modeling techniques capable of dealing with nonstationarities due to complex seasonal patterns we illustrate that the hour of day reference plays an important role in short term prediction in order to protect citizens from harmful levels of pollutants hence we will not aggregate from hourly data to daily statistics e g mean median or maximum as the latter statistics do not provide a complete and representative picture of the practically most relevant daily distribution of air pollutants therefore the hour of day reference is maintained when considering hourly models and daily models built upon time series for specific hours in our exposition exemplarily for 8am 1pm and 7pm according to figs 5 7 the daily series differ with respect to their time series properties exhibiting non stationarities of varying degrees and changes in the seasonal figure and the amplitude over time due to the observed differences it seems reasonable to take hourly and daily models into account and to assess whether and specifically for which hours of the day the daily models enhance the predictability with respect to predicting the hourly no2 concentration level for a specific hour and prediction horizon 3 methods the statistical problems arising from the pronounced anthropogenic structures inherent in air pollutant time series bear a resemblance to other areas of research such as the modeling of local electricity demand examples of resulting modeling tasks are multiple seasonalities trends nonlinearities and associations to related phenomena such as meteorological processes as a consequence similar approaches for modeling complex time series can be applied e g arora and taylor 2018 taylor 2003 2010 taylor and mcsharry 2007 basically there are two ways to handle the prediction task in presence of seasonalities see e g bell and hillmer 1984 or harvey 1989 p 29 one way is to decompose the time series into seasonal and non seasonal components which entails three steps with respect to prediction i e de seasonalizing prediction and re seasonalizing this approach relies on the crucial assumptions of additivity and orthogonality of the seasonal and non seasonal components see proietti and riani 2009 the other way is to incorporate the seasonal patterns in the time series model in the present work we consider one modeling approach based on additive decomposition and two approaches that incorporate seasonal structures directly we consider observed time series y t ι d m t 1 t where ι refers to hour ι 1 24 corresponding to 1am 12pm d refers to day and m refers to month reflecting the different cycles typically present in no2 concentration data as we will not model annual seasonal effects all models allow for arima structures to remedy the potential problems of serial correlation in the error process in our empirical analysis we study hourly time series yt t 1 t and daily time series y t ι t 1 ι t ι for a given hour ι for ease of exposition we will omit ι whenever the context is clear we assume a simple but flexible model structure where yt depends on trend tt season st and perturbation rt a well known member of this model class is the univariate unobserved components model 1 y t h t t s t r t this model is most frequently considered in its additive form h t t s t r t t t s t r t and rt modeled as an arima process the model can be extended to include a cyclical component and exogenous variables see e g young et al 1999 there is a huge literature on models of this type allowing for different mixtures of deterministic and stochastic model components degrees of flexibility and computational burdens the three modeling approaches used in this paper follow the assumption that a linear decomposition of eq 1 exists but allow for some nonlinearities by considering the transformed response variable y t λ with box cox parameter λ where 2 y t λ y t λ 1 λ λ 0 log y t λ 0 as a consequence we study regression models where we assume that y t λ can be approximated by functions of trend and seasonal components such that a dynamically complete specification arises i e a remainder process et can be assumed to be gaussian white noise our baseline predictions are generated using seasonal autoregressive integrated moving average sarima models under the assumption of unchanging seasonal and non seasonal parameters over time e g taylor and mcsharry 2007 see section 3 1 second under the same assumption we employ harmonic regression models with arima errors denoted by harmreg which rely on decomposing the time series into a seasonal and a non seasonal component see section 3 2 third allowing for time varying patterns in all components we employ the tbats model of de livera et al 2011 which incorporates trigonometric seasonality box cox transformation arima errors trend and seasonal components into a state space framework related approaches can be found in taylor 2003 or gould et al 2008 see section 3 3 predictability is analyzed using the cross validated out of sample prediction errors e t h to calculate the rmse see section 3 4 for 75 models i e three hourly and 3 24 72 daily models for each monitoring site in our sample 3 1 seasonal arima model the extension of classical arima models to allow for seasonal cycles of various length belongs to the toolbox of many applied researchers and is a frequently employed benchmark in various fields of application despite the cumbersome structure of seasonal lag polynomials we employ the formulation of hyndman and khandakar 2008 and definition 2 and consider a sarima p d q p d q m model given by 3 φ l m ϕ l 1 l m d 1 l d y t λ θ l m θ l e t where ϕ l 1 ϕ 1 l ϕ p l p and θ l 1 θ 1 l θ q l q are ar and ma lag polynomials of order p and q respectively φ l m 1 φ 1 l m φ p l p m and θ l 1 θ 1 l m θ q l q m denote the seasonal ar and ma lag polynomials of order p and q respectively and e t i i d n 0 σ 2 is gaussian white noise the estimation of a sarima p d q p d q m requires to solve several interrelated problems first identifying the lag lengths p and q and the relevant mode of filtering for stationarity d second estimating the parameters in φ lm and θ l and third testing model validity in our application we use the r function arima and select optimal orders according to the aic akaike information criterion due to its asymptotic efficiency and asymptotic equivalence to the final prediction error criterion which results in testing 324 combinations p q p q 0 1 2 and d d 0 1 the estimated model exemplarily for a sarima 1 0 1 0 1 1 24 model is given by 4 y t λ ϕ 1 y t 1 λ y t 24 λ ϕ 1 y t 25 λ e t θ 1 e t 1 θ 1 e t 24 θ 1 θ 1 e t 25 the corresponding equations for a h step ahead prediction are given by 5 y t h t λ ϕ 1 y t λ y t 23 λ ϕ 1 y t 24 λ θ 1 e t θ 1 e t 23 θ 1 θ 1 e t 24 h 1 ϕ 1 y t h 1 t λ y t h 24 λ ϕ 1 y t h 25 λ θ 1 e t h 24 θ 1 θ 1 e t h 25 1 h 24 ϕ 1 y t 24 t λ y t 1 t λ ϕ 1 y t λ θ 1 θ 1 e t h 25 ϕ 1 y t h 1 t λ y t h 24 t λ ϕ 1 y t h 25 t λ h 25 note that the prediction equations for 1 h 24 can also be written as 6 y t h t λ ϕ 1 h y t λ y t 24 h λ ϕ 1 h y t 24 λ ϕ 1 h 1 θ 1 e t θ 1 e t 24 h ϕ 1 h 1 θ 1 θ 1 e t 24 j 1 h 1 ϕ 1 h 1 j ϕ 1 θ 1 θ 1 e t 24 j applying the inverse box cox transformation of wooldridge 1992 to the prediction yields 7 y t h t λ y t h t λ 1 1 λ λ 0 exp y t h t λ λ 0 to apply the sarima model stated in eq 3 to y t ι substitute yt by y t ι and set m 7 3 2 harmonic regression model with arima errors for this model class we assume that yt is additively separable and can be decomposed into a seasonal component st that corresponds to a sum of seasonal terms s j t j 1 j and a non seasonal component zt modeled as an arima p d q process under these assumptions and definition 2 a harmonic regression model with arima errors can be stated as 8a y t λ s t z t 8b ϕ l 1 l d z t θ l e t where ϕ l 1 ϕ 1 l ϕ p l p and θ l 1 θ 1 l θ q l q are ar and ma lag polynomials of order p and q respectively e t i i d n 0 σ 2 is gaussian white noise and the seasonal component in 8a is defined by 9 s t j 1 j s j t j 1 j k 0 k j a j k cos 2 π t k m j b j k sin 2 π t k m j the seasonal component st is assumed to be a periodic process with multiple frequencies and amplitudes the frequency of s j t is denoted by mj and the number of harmonics required for s j t is denoted by kj where 0 kj mj 2 for even values of mj and 0 k j m j 1 2 for odd values of mj e g harvey 1989 ch 3 2 and shumway and stoffer 2017 ch 4 the hourly no2 time series have two seasonal cycles with frequencies 24 and 168 i e j 2 m 1 24 and m 2 168 to apply model 8a and 8b to daily time series y t ι substitute yt by y t ι and set j 1 and m 1 7 for estimation the r function auto arima is applied to hourly data for different combinations of k 1 and k 2 and to daily data for different numbers of k 1 in order to identify the optimal number s of harmonics minimizing aic see section 3 1 this includes three steps first estimating λ for pre specified k 1 and k 2 second regressing the transformed response y t λ on the harmonics cos 2πtk mj and sin 2 π t k m j k 0 k j j 1 2 to obtain the residuals z t and third fitting a family of arima models to the residuals z t in order to identify the optimal order in eq 8b according to aic the equations for a h step ahead prediction exemplarily with arima 1 0 2 errors are given by 10a y t h t λ e y t h λ z t z t 1 z 1 s t h 10b s t h ϕ 1 z t θ 1 e t θ 2 e t 1 h 1 ϕ 1 z t 1 t θ 2 e t h 2 ϕ 1 z t h 1 t h 2 eq 10a states that the predicted value corresponds to the expected value conditional on the residuals from the auxiliary regression and the prediction for s t h which is according to eq 9 obtained by s t h j 1 j k 0 k j a j k cos 2 π t h k m j b j k sin 2 π t h k m j note that the procedure described above substantially differs from the dynamic harmonic regression model of young et al 1999 which allows for stochastic time varying parameters in eq 9 in a state space framework 3 3 tbats model de livera et al 2011 propose a state space framework to deal with multiple seasonality extending earlier exponential smoothing approaches their approach allows for complex non integer seasonality provides a simple remedy for neglected cycles causing serially correlated errors and avoids issues with nonlinear exponential smoothing models the tbats model is given by 11a y t λ l t 1 ψ b t 1 j 1 j s t 1 j d t 11b l t l t 1 α d t 11c b t 1 ψ b ψ b t 1 β d t 11d s t j k 1 k j s k t j 11e d t i 1 p ϕ i d t i i 1 q θ i e t i e t where the seasonal components in 11d are calculated according to 12a s k t j s k t 1 j cos 2 π t k m j s k t 1 j sin 2 π t k m j γ 1 j d t 12b s k t j s k t 1 j sin 2 π t k m j s k t 1 j cos 2 π t k m j γ 2 j d t eq 11a denotes the measurement equation eqs 11b to 11d are the smoothing equations for level trend and seasonality where b denotes the long term trend and eq 11e incorporates arima structures in the error component where again e t i i d n 0 σ 2 is gaussian white noise the smoothness of the seasonal component s t j is controlled by the number of harmonics kj for no2 data we observe two seasonalities with frequencies 24 and 168 and have to estimate the box cox parameter λ the dampening parameter ψ the smoothing parameters α β γ 1 j γ 2 j j 1 2 the number of harmonics k 1 and k 2 the arima parameters ϕ 1 ϕ p and θ 1 θ q as well as starting values for the level for the fourier coefficients s k t 1 j and s k t 1 j j 1 2 and for the error term for the application of the tbats model to y t ι we substitute yt by y t ι and set j 1 and m 1 7 in matrix notation the tbats model 11a to 11e is given by 13a y t λ w x t 1 e t 13b x t f x t 1 g e t the h step ahead prediction is given by 14 y t h t λ w f h 1 x t and the re transformation is carried out according to eq 7 3 4 procedure for evaluation of predictability for model evaluation we conduct a time series out of sample cross validation with extending windows in each validation loop the training sample is extended by one time unit i e one hour for hourly hly time series and one day for daily dly time series respectively in order to get reliable initial estimates for further iteration we split the data after the first 69 weeks the resulting training sample then has length 69 168 11592 69 7 483 for the hourly daily models respectively which corresponds to approx 66 66 of the data given that we consider prediction horizons ranging between 1 and 168 h for hly time series 1 and 7 days for dly time series we can conduct 5000 hly 240 dly cross validation steps which implies that the testing uses approx 28 5 33 of the data note that k fold cross validation is not feasible as all models employed in this study are fully iterative see bergmeir et al 2018 in the following we provide details on the evaluation algorithm hourly time series hly 1 fit the model to an initial training sample y t 0 y t 1 where t 0 1 and t 1 69 168 11592 i e the training sample comprises 69 weeks of data and denote the estimated model by m o d t 1 hly 2 in the n th loop n 0 n n 4999 of the time series cross validation extend the training sample by n hours update m o d t 1 for the new training sample and use the updated model to predict one hour to one week ahead which yields the predicted values y t 1 n h t 1 n for each h 1 168 calculate the out of sample prediction errors e t 1 n h t 1 n y t 1 n h y t 1 n h t 1 n hly 3 after 5000 loops for each prediction horizon h calculate the out of sample rmse 15 r m s e h h l y 1 n 1 n 0 n e t 1 n h t 1 n 2 hly 4 filter the estimated prediction errors for hour ι of the respective day and calculate for each combination of ι and h the respective rmse 16 r m s e h ι h l y 1 n 1 24 n 0 t 1 n h refers to ι 4992 1 e t 1 n h t 1 n 2 where the upper bound is set to 4991 to ensure that the subseries of prediction errors are of equal length for each ι ι 1 24 daily time series dly 1 fit the model to an initial training sample y t 0 ι y t 1 ι where t 0 1 and t 1 69 7 483 i e the training sample comprises 69 weeks of data and denote the estimated model by m o d t 1 dly 2 in the n th loop n 0 n n 239 of the time series cross validation extend the training sample by n days update m o d t 1 for the new training sample and use the updated model to predict one day to one week ahead which yields y t 1 ι n h t 1 ι n for each h 1 7 calculate the out of sample errors e t 1 ι n h t 1 ι n y t 1 ι n h y t 1 ι n h t 1 ι n dly 3 after 240 loops for each prediction horizon h calculate the out of sample rmse 17 r m s e h ι d l y 1 n 1 n 0 n e t 1 ι n h t 1 n 2 the flowchart in fig 8 graphically summarizes the steps of our empirical analysis 4 results and discussion in this section we discuss the prediction accuracy of the estimated models using hourly data yt and daily data y t ι exemplarily for the hours ι 8am 1pm 7pm as motivated in section 2 further details are given in the appendix the evaluation of the models is carried out according to the procedure described in the preceding section note that due to the estimation procedure of the implemented r functions the fitted values and the residuals refer to one step ahead predictions and one step ahead prediction errors respectively corresponding to one hour ahead using hourly data and one day ahead using daily data prediction horizons as shown in fig 9 the hourly sarima model outperforms the daily sarima models for all hours of day concerning the in sample rmse values however when the focus lies on predicting the air pollutant concentration one day ahead it might be reasonable to consider 24 step ahead prediction errors and 1 step ahead prediction errors for the hourly and daily models respectively to provide an appropriate comparison between hourly and daily models the upper panel of fig 10 displays for the last week of the initial training sample and the first week of the initial test sample the fitted and predicted values derived from the hourly models concerning the training period all models fit the data remarkably well as sarima just incorporates the daily seasonality the pattern in the predicted values repeats every 24 h differences in the daily course of the no2 concentration levels from weekdays to weekend days can clearly be seen in the predicted values referring to harmreg and tbats the morning and evening modes are less pronounced between t 72 and t 120 which correspond to saturday and sunday the lower panel of fig 10 zooms into the upper panel and displays the last day of the initial training sample and the first day of the initial test sample fig 11 displays boxplots of the fitted sarima model values for each hour of day derived from the hourly upper panel and the 24 daily lower panel models both panels in fig 11 reveal the bimodal daily pattern the interquartile range the gap between median and mean value and the number of outliers are higher for the hourly model compared to the daily models in particular concerning the evening hours analogous plots for the residuals in fig 12 reveal a tendency that the use of hourly data provides a more accurate fit to the training data in comparison to the use of daily data figures such as fig 11 and fig 12 for the fitted values and the residuals derived from the other two modeling approaches harmreg and tbats provide an analogous conclusion fig 13 shows the out of sample rmse values for a prediction horizon from 1 to 24 h calculated according to eq 15 and reveals that sarima outperforms the other two models with respect to the rmse values built over all prediction errors according to fig 14 there is no remarkable change in the out of sample rmse values concerning a prediction horizon from 1 to 7 days sarima still outperforms the other two models with respect to the rmse values built over all prediction errors regarding the panels in fig 15 a different conclusion is drawn the prediction performance of each model depends on the hour of day to be predicted in terms of rmse for 8am upper panel of fig 15 harmreg outperforms tbats and sarima for h 4 concerning 1pm middle panel of fig 15 harmreg slightly outperforms sarima and tbats for h 8 according to the lower panel of fig 15 the 7pm values are best predicted by sarima there are remarkable differences in the rmse values for different hours of day which might be due the various degrees of variability and complexity in the daily series y t ι compare fig 6 and fig 7 a comparison of the model performance in terms of the aggregation level of the data is shown in fig 16 where the rmse for prediction horizons h 1 7 is depicted for the daily and hourly models the formulas to obtain the rmse values correspond to those stated in eqs 16 and 17 note that the scale of the ordinate in the panels of fig 16 is fixed in order to ease model comparison with respect to the predictability of the hours of day the left and right panel suggest to build models based on daily series whereas the middle panel shows the lowest rmse values for the hourly harmreg model in the right panel in particular rmse values are remarkably lower for models using daily series we conclude our discussion with tables 3 and 4 summarizing the previous results and contrasting them for all four monitoring sites in this study for a prediction horizon of 1 24 and 168 h s the overall rmse for each hourly model is reported in table 3 there are no remarkable differences in the rmse values between the three modeling techniques the rmse increases with the prediction horizon up to 24 h ahead and changes only slightly afterwards this can be explained as follows the underlying time series is stationary at every position hour s of the seasonal cycle hence with increasing prediction horizon h beyond h 24 for a prediction y t h t h 25 26 only the predictive power of the long term mean of the time series at every position s remains and the prediction error converges to the long run variance of the underlying process note that this prediction only has information up to time period t but not about the latest seasonal cycle i e y t 1 y t 24 theoretically and given a consistent estimate of the long term mean the predictive power of the long term mean should not deteriorate substantially as long as the properties of the underlying process do not change substantially see brockwell and davis 1991 sec 5 2 exemplarily for sarima and a prediction horizon of 24 h 1 day and 168 h 7 days the rmse in dependence of the hour of day to be predicted is shown in table 4 for sarima as well as harmreg and tbats and several hours we observe a tendency that the use of daily data reduces rmse in comparison to the use of hourly data further results are available from the authors upon request 5 conclusions predictions of air pollutant concentrations play an important role in protecting the population from potential adverse health effects the development of appropriate prediction models is challenging as temporal air quality processes exhibit multiple seasonal patterns and non stationarities there are many studies on predicting air quality taking into account one seasonality but few on multi seasonal prediction models furthermore model evaluation is generally based on all prediction errors without reference to the hour to be predicted e g time of day we propose a framework to assess the predictability of local concentration levels of no2 or other air pollutants based on hourly measurements generated by local monitoring sites our analysis maintains the hour of day reference and considers hourly time series and daily series for each hour and every monitoring site predictability is assessed via loss functions based on out of sample h step prediction errors using time series cross validation we produce out of sample predictions for no2 concentration levels for each hour of day with prediction horizons h ranging from one hour to one week in an empirical analysis we apply state of the art multi seasonal univariate prediction models to hourly no2 data from four monitoring sites in germany we thoroughly discuss the relation between predictability and hour of day and respective no2 concentration level separately for each hour of day to obtain a comprehensive picture of the model performance we find that prediction accuracy strongly depends on the hour of day to be predicted for hours that tend to exhibit relatively high pollutant levels the predictability of both hourly and daily models deteriorates for some hours a prediction gain can be achieved by building the models on daily instead of hourly data similar findings for the other monitoring sites suggest at least some regional robustness of our results in future extensions of this work further performance criteria can be investigated such as a hit or success rate for correct forecasts of the hour of maximal exposure the use of univariate methods has the advantage of being independent of additional and potentially costly predictors on the other hand the inclusion of covariates e g information on weather or traffic may improve the predictability in general and of hours of day with high exposure in particular acknowledgments we thank two anonymous referees an associate editor marek brabec markus fritsch philipp sibbertsen james taylor matthias wild and the participants of the international society for ecological modelling global conference 2019 in salzburg austria and the participants of the workshop on statistical modelling of environmental data 2019 in passau germany for helpful comments and suggestions all remaining errors are ours appendix a this appendix provides details on estimation setups and results for models based on hourly and daily data recorded in 2014 and 2015 at the monitoring site in passau table 5 gives an overview over the meta parameters of the estimated hourly and daily models we focus on details for harmreg and tbats further results are available upon request details harmreg we have applied the function auto arima to the training sample yt for 192 different combinations of k 1 and k 2 with k 1 1 12 and k 2 1 16 to identify the optimal number of harmonics in harmreg fig a 17 displays how the deciles of the resulting aic values are distributed over the combinations of k 1 and k 2 where the combination k 1 11 and k 2 13 14 returns the minimum aic value the residuals derived from the harmonic regression with k 1 11 and k 2 13 harmonics representing daily and weekly seasonal patterns respectively follow an arima 5 1 1 process for the daily models the identification of the optimal number of harmonics is less cumbersome since the weekly seasonality implies m 1 7 and thus 0 k 1 3 see subsection 3 2 details tbats an extract from the output of the estimated hourly tbats model is given by tbats 0 207 0 0 0 801 24 5 168 5 lambda 0 206589 alpha 1 204514 beta 0 2897133 damping parameter 0 80129 gamma 1 values 0 004004553 0 001977883 gamma 2 values 0 001286855 0 0001531337 the estimated number of harmonics is five for both the daily and weekly seasonal component the box cox and damping parameter equals 0 207 and 0 801 respectively and the estimated error follows a white noise process the smoothing parameters of the seasonal components are quite small the smoothing parameter for the level and trend equation is equal to 1 205 and 0 290 respectively fig 17 shows for the first five weeks of the initial training sample the components of the hourly tbats model the component observed refers to the box cox transformed data that are decomposed into level slope season1 daily seasonality season2 weekly seasonality and residuals season refers to the sum of season1 and season2 note that the first day of the data under consideration 1st january 2014 is a wednesday and the drops in season2 refer to the weekends the component level changes much faster than the seasonal components which is in accordance to the values of the corresponding smoothing parameters further we observe that the value range of season is about a fifth of the value range of level we may understand level as the baseline no2 exposure and season as the variation due to the day of the week and the hour of day the estimated daily tbats models for 8am 1pm and 7pm are t b a t s 0 108 1 0 7 3 t b a t s 0 512 0 0 7 3 and t b a t s 0 234 0 1 7 3 respectively 
24853,the energy consumed by regions in china may have a huge gap after considering embodied energy due to interregional trade and therefore impact the proposal of energy conservation the aim of this research is to differentiate the effects from direct and indirect flows which comprise embodied energy consumption at provincial and sectoral scales through introducing the theory of interdependence of organisms from ecology in this paper hebei province in china has been selected as a case study based on national multiregional input output tables from 2002 2007 and 2012 as well as energy input data direct energy flows and embodied energy were used to investigate the energy consumption between hebei and 29 other provinces the results showed that the direct flows and embodied energy consumption of hebei province increased and then decreased from 2002 to 2012 shanxi inner mongolia and jilin provinces were providers with to hebei province through both direct flows and embodied consumption on the supply side shanghai zhejiang and guangdong were the top three provinces receiving the most from hebei by sector direct flows and embodied consumption related to industrial activity were dominant this research identified the energy unitization characteristics within one province and meanwhile shed light on the actors of different provinces due to interregional trade keywords multiregional input output analysis embodied energy direct flows interregional trade hebei 1 introduction since 2010 energy consumption in china has ranked the highest among countries worldwide and it continues to grow rapidly in 2010 the total energy consumption was 3 606 metric tons of carbon equivalent mtce increasing to 4 490 mtce in 2017 which equates to an average growth rate of 3 5 per year nbsc 2018 since coal accounts for a large proportion of consumed energy this increase has resulted in growing carbon emissions liu et al 2015 this situation of high consumption and high emissions has affected the whole country to meet china s climate and energy targets for the year 2030 the chinese national targets have been allocated down to all provincial authorities to meet the regional targets based on their specific industrial and governmental infrastructure profiles hubacek and sun 2001 yu et al 2018 furthermore in order to provide scientific basis for energy conservation strategies energy consumed through products or services trade has been treated as an indispensible element embodied energy is the total energy required on the whole processing of production in cities costanza 1980 lenzen 1998 input output analysis is an effective way to quantify the embodied resource uses energy transfers or waste emissions associated with cross boundary exchanges of goods and services leontief 1970 miller and blair 2009 multiregional input output tables can separate the different production technologies used in different regions or countries wiedmann 2009 wiedmann et al 2007 previous studies that performed embodied analyses of china s provinces or regions have included evaluations of water consumption zhang and anadon 2014 embodied energy use liang et al 2007 embodied carbon emissions duan et al 2018 meng et al 2018a b and embodied sulfur dioxide emissions qian et al 2019 such studies can be extended to conduct nexus analyses of china such as the interregional nexus of water and energy wang et al 2019 the water energy nexus of urban agglomerations wang and chen 2016 or the water energy food nexus liu et al 2017 the measurement and analysis of the resources or energy use embodied in domestic trade between provinces or regions can help to identify regional disparities in resource use or energy flows from spatiotemporal perspectives feng et al 2012 2013 these research mostly analyzed embodied resources or wastes from the perspective of regions or provinces in china rather than conducted research at the scale of industrial sectors several studies have analyzed embodied energy consumption and energy flow for different regions and sectors in china researchers initially used input output analysis methods based on the leontief inverse matrix to generate the complete consumption coefficient and direct energy consumption data liang et al 2007 used this method to measure embodied energy consumption treating china as eight regions with four sectors in each region using this method they predicted the expected energy use for 2010 and 2020 to further detail the number of different sectors tang et al 2019 used a chinese multiregional input output table from 2010 to establish two networks one with 30 provinces and another that divided each province into 30 sectors aside from embodied energy consumption they also analyzed embodied energy flows within the two networks their results mainly concerned inflows and outflows showing that the highest embodied energy flows were between sectors within the same province using temporal dynamic analysis zhao et al 2018 built five multiregional input output tables spanning 2007 2011 they used multiregional input output table based structure decomposing analysis technique to figure out the driving forces of embodied energy consumption due to interregional trade of 30 provinces and 30 sectors from a spatial perspective other studies have merged input output tables with system ecology theory to build energy equilibrium equations these used the complete consumption coefficient and multiplied it by the intermediate input or final demand data based on this approach kok et al 2006 analyzed the embodied energy requirements of households in the netherlands using three methods a basic energy input output analysis an input output energy analysis combined with household survey data and an input output analysis combined with process analysis their results indicated that the embodied energy estimates were almost the same using the three methods the choice of method depended on the study aim for example whether it described consumption from an aggregated perspective aimed to calculate energy requirements quickly or sought to reveal detailed information about the production and consumption aspects of the processes furthermore they separated direct and indirect energy requirements for household consumption and found the importance of indirect energy sun et al 2017 and zheng et al 2017 applied this method on an interregional scale to energy exchanges between urban agglomerations in china they selected the yangtze river delta pearl river delta and the jing jin ji urban agglomerations to trace the embodied energy flows between them and with other provinces in china they quantified the energy supply from or energy demands of entities in other provinces included in the energy exchange activity among the three agglomerations zhang et al 2016a extended the boundaries to the national level calculating the embodied energy consumption of eight regions in china for 2002 and 2007 as well as the inflows or outflows between them in addition to the regional perspective zheng et al 2017 added a provincial network and investigated the consumption and flow data between regions and provinces for both years zhang et al 2013 used intermediate input and final demand data in a multiregional input output table for 2007 and found that domestic trade was the main driving force for provincial energy supply and demand that study also identified separate producer or consumer entities in provinces engaged in energy exchanges therefore the research of embodied energy consumption is useful in determining the responsibility of regions in energy conservation comprehensively the indirect energy contributed to the embodied energy is the energy required for all goods or services production distribution and disposal kok et al 2006 indirect energy is formed based on the interregional trade among regions or sectors and it can be analyzed based on the theory of hannon 1973 that the interdependence of organisms in an ecosystem could be linked directly and indirectly from this perspective indirect energy consumption between any two components in an ecosystem or socioeconomic system could be further separated into two parts direct flow connects two components through one step and indirect flow means the resource travels several steps to reach other component fath and patten 1999 zhang et al 2010 most of the previous researches discussed the indirect energy consumption and did not further separate into direct flow and indirect flow between any two sectors or regions and this could help to quantify the direct and indirect effects as mediated by flows hebei province is located in the jing jin ji urban agglomeration fig 1 it is a prime example of an area that has experienced industrial transformation and development constituting a peripheral economic zone around the municipalities of beijing and tianjin air pollution and the destruction of the ecological environment have become serious problems in the region in 2016 hebei province s gross domestic products gdp accounted for 4 33 of china s national gdp however the proportions of energy consumption and coal use were higher at 6 53 and 6 61 respectively nbsc 2017 due to this high rate of energy consumption of the 10 chinese cities with the worst air quality in 2016 six were in hebei province to tackle the problem of high energy consumption and high emissions the 13th five year plan for energy development in hebei was issued by the people s government of hebei province in 2017 it proposed that the three highest priorities were introducing an improved energy utilization structure enhancing energy use efficiencies and reducing carbon emissions the plan also emphasized that aside from emission reduction energy use by self sufficient entities should be coordinated and how energy is supplied to other users should be managed in this way energy use within the province could be exploited most effectively it was also suggested that the province should establish basic levels of resource provision to others such as coal petroleum and national gas and develop renewable energy 1 1 http info hebei gov cn eportal ui pageid 1962757 articlekey 6753062 columnid 329982 therefore it is important to conduct quantitative analysis on the energy consumption and flows among sectors within one province or among sectors between different provinces this research chooses hebei province as a case study and focuses on the direct and indirect flows at sectoral and provincial scales due to interregional trade chinese national multiregional input output tables for 2002 2007 and 2012 are used for the study analyzing direct flow and embodied energy use from a province level perspective is useful for evaluating energy inflows or outflows and for identifying the producers and consumers arising from exchanges of goods or services the quantitative evaluation of energy flow between sectors along with information about local geography and economic development can help to reflect the proportion of direct and indirect energy flows and shed light on the energy utilization structures of different sectors the combination of two scales analysis would identify the energy unitization characteristics within one province and meanwhile shed light on the actors of different provinces due to interregional trade 2 methodology 2 1 explanation of energy flow terms considering a region with higher developed level tends to import more products or services from others or some regions purchase more goods and services from other regions as opposed to producing them locally the energy use implied in these products or services through interregional trade needs to be elaborated when proposing energy reduction strategies zhang et al 2014 as frequent large exchanges of resources or energy have led to closer economic and industrial ties between provinces or regions large disparities in such flows can create economic or resource imbalances that jeopardize sustainable development zhang et al 2016b therefore aside from the energy consumed by regions the indirect energy consumption implied in the transfers between regions also contribute to the uneven distribution of regional energy consumption and additionally the regional targets the sum of them is embodied energy zhang et al 2016a afterwards the terms separating the indirect energy consumption can be defined direct energy flow is the implied energy in the products or semifinished products that are transferred between regions through a direct path e g the energy implied in cement which is produced by a cement plant and directly purchased by a construction company indirect energy flow means the energy implied in the linkage of any two regions that cannot connect directly instead there are mediated regions and the paths between the two regions are more than one see fig 2 furthermore energy input refers to energy a region uses that comes from outside its borders energy input datasets for each province were obtained from the china emission accounts and datasets for 2002 2007 and 2012 ceads http www ceads net each dataset included data from 42 sectors the three multiregional input output tables included 21 sectors in 2002 shi and zhang 2012 30 sectors in 2007 liu et al 2012 and 42 sectors in 2012 liu et al 2018 both the energy datasets and the input output datasets included the 22 provinces four municipalities and four autonomous regions that are collectively referred to as provinces tibet was not covered comprehensively due to a lack of full datasets the sector data for the three time periods were merged into four composite sectors agriculture industry construction and others this information is summarized in supplemental table s1 2 2 embodied energy flow accounting the energy input data list the energy produced and used by different energy types and from different sources these include the following raw coal cleaned coal other washed coal briquettes coke coke oven gas other gas other coking products crude oil gasoline kerosene diesel oil fuel oil liquid propane gas by refinery from other petroleum products natural gas energy as heat energy as electricity and from other energy sources the total energy input for each sector in every province was calculated by converting all quantities of these energy sources into common units of tons of coal equivalent tce 1 e i f m 1 e i f m where e i f m represents the m energy source consumer by sector i in province f e i f refers to the energy inputs for each sector in the province based on input output analysis equations leontief 1970 2 x i f s 1 30 j 1 4 x i j f s y i f where x i f is the total output of sector i in province f x i j f s refers to the intermediate use of the monetary flows from sector i in province f to sector j in province s and y i f is the total final energy use supplied by sector i in province f the technical coefficient matrix a can be calculated by 3 a i f x i j f s x j f combing eqs 2 and 3 gives 4 x i f i a i f 1 y i f where i is the identity matrix the direct energy consumption intensity from each sector in each province is 5 k i f e i f x i f where k i f denotes the factor vector of the direct energy coefficient for each sector eqs 4 and 5 can then be combined to produce the final equation 6 e m b o d i e d i f k i f i a i f 1 y i f where e m b o d i e d i f denotes the embodied energy consumption of sector i in province f this can be extended using the following power series to produce an equation yang et al 2016 7 e m b o d i e d i f k i f a 0 a 1 a 2 a l y i f where a 0 reflects any flow that originates from and returns to itself a 1 reflects flows between a pair of sectors i e flows with a path length of 1 and the higher powers of a represent flows through different lengths direct and indirect energy flows can then be calculated as follows 8 d i r e c t i f k i f a 1 y i f 9 i n d i r e c t i f e m b o d i e d i f d i r e c t i f k i f y i f where d i r e c t i f and i n d i r e c t i f denote direct and indirect energy flows respectively thus the direct and indirect energy flows for each sector can be separated from the indirect energy consumption 3 results analysis 3 1 energy input the energy input data for hebei province showed that energy input increased significantly from 2002 to 2012 the total in 2007 was 2 07 times that of 2002 and it had doubled again by 2012 3 2 direct energy flows 3 2 1 provincial analysis figs 3 and 4 show the energy flows through one path among provinces including all the direct flows between hebei and the other 29 provinces the total direct energy inflow from other regions to hebei grew during 2002 2007 but decreased during 2007 2012 the total inflow in 2007 was 3 12 times that of 2002 but the inflow in 2012 was only 0 16 that of 2007 the reason for this can be seen in the monetary table as all 29 provinces inputted lower levels of products or services to hebei in 2012 compared to 2007 among the provinces direct flows from shanxi inner mongolia and jilin to hebei were the highest in 2002 and 2007 shanxi inputted the most energy through a direct path to hebei accounting for 26 38 of the total in 2002 and 21 39 in 2007 the second highest was inner mongolia its inflow accounted for 19 61 of the total in 2007 and 14 59 in 2012 these two provinces may have different reasons for the highest inflows shanxi was one of the provinces in china in 2002 and 2007 that consumed the largest quantity of energy input and produced products or services with high energy consumption the energy input of inner mongolia was not high however the indigenous production of coal total of shanxi and inner mongolia both ranked in the front in china these coal products may be transferred to hebei in 2012 the inflow from ningxia reached its highest proportion accounting for 14 56 of the total inflow this could be referred to ningxia s output data for 2012 more products flowed to other provinces from the coal mining and dressing sector compared to 2007 the inflow was followed by shanxi which supplied 12 75 an analysis of inflow changes across the three time periods showed that from 2002 to 2007 inflows from all the other 28 provinces increased only beijing was an exception this could have to do with the policy of relocating high pollution plants or industries away from beijing to cities in hebei a trend that has continued to increase over time for example with the relocation of shougang group a new iron and steel base was built in caofeidian tangshan which resulted in the relocation of products with high energy consumption the casting department of first machine tool plant and one plastic plant have both been moved to baoding in summary there were about 300 enterprises have been moved from beijing to zhangjiakou chengde langfang baoding and tangshan the increases from shandong hainan chongqing guizhou yunnan and ningxia were the largest this was partly due to their low initial inflows in 2002 which were all below 0 53 mtce the rates from the other 22 provinces also increased over the time period ranging from a factor of 1 65 heilongjiang to 15 67 henan following this period of acceleration the inflows in 2012 were all lower than in 2007 qinghai accounted for 24 36 of the total in 2007 while the other 28 provinces all supplied less than 15 of the total for that year fig 5 shows the direct flows from hebei to the other provinces the total outflow from hebei grew after 2002 and then decreased between 2007 and 2012 the total direct outflow from hebei to the other 29 provinces in 2007 was 24 31 times that of 2002 which then decreased by 41 by 2012 a comparison of the outflows to the other 29 provinces shows that the largest outflows from hebei by direct paths were to jiangsu zhejiang and guangdong this was due to the large volume of product and service exchanges between hebei and these provinces in 2002 the direct energy flow from hebei to shanghai was the highest accounting for 16 46 of the total outflow next were zhejiang and guangdong with proportions of 12 57 and 12 24 respectively in 2007 jiangsu guangdong and zhejiang received the largest quantities of energy from hebei the total proportion of these three outflows increased compared to 2002 growing to 67 17 of the total outflow in 2012 hebei also supplied the largest amount of energy to jiangsu and guangdong accounting for 37 96 and 15 70 of the total respectively all direct outflows changed significantly from 2002 to 2007 except for the flows from hebei to heilongjiang and hainan which increased only moderately to 1 08 times and 2 56 times that of 2002 respectively energy flows to the other 27 provinces all more than quadrupled by 2007 by 2012 the outflows to anhai jiangxi hunan hainan and chongqing had all increased again among them the outflow to hainan increased the most and was 16 times what it had been in 2007 this was because of the relatively small quantities of energy flowing from hebei to hainan in 2002 and 2007 by 2012 outflows to the other provinces had decreased by 12 83 compared to 2007 3 2 2 sectoral analysis further analysis of the direct flows between sectors within hebei and between other provinces is shown in table 1 inflows from industrial sectors in the other provinces to hebei accounted for the highest proportion with the largest quantity of direct energy going to the industrial sector this was because that the industrial sectors in the different provinces used similar processing technologies and systems when processing raw products into similar products or services in some industries for example electricity in china is now mostly produced by thermal power accounting for over 70 of the country s total power generating capacity 2 2 http www chyxx com industry 201811 692651 html this is principally because of the low cost of employing this mature technology thermal power plants use coal petroleum and natural gas as fuel and produce electricity by first converting chemical energy into heat energy and then into mechanical energy and finally into electrical energy cheng et al 2019 industrial sectors in the other provinces also inputted largest energy through direct paths to other three sectors in hebei this occurred because sectors such as the service sector or the construction sector are downstream from the industrial sectors in other provinces i e they utilize products or by products produced by industrial sectors as raw or processed materials sectors in provinces with high inflows to hebei e g shanxi inner mongolia and ningxia all showed the same trend direct flows from the industrial sector in shanxi were the largest accounting for more than 54 of the total flow from the four industrial sectors which constituted the largest quantity of energy supplied to hebei s industrial sector and 42 of the total outflow from shanxi the flows from other sectors to sectors in hebei increased from 2002 to 2007 except for the industrial sector in beijing from which flows to all sectors in hebei decreased accounting for 41 in 2007 compared to 77 in 2002 all flows decreased from 2007 to 2012 except for those from other sectors in shanxi which increased slightly table 2 shows the outflows from the four sectors in hebei province to sectors in other provinces the data indicate that hebei s industrial sector supplied most of its energy to other sectors through a direct path compared to inflows the total quantity of outflows was lower sectors in provinces with the highest energy flows such as jiangsu zhejiang and guangdong also showed the same characteristic the four sectors in jiangsu received the largest quantity of energy from hebei s industrial sector accounting for 75 of the total energy flowing into the four sectors in jiangsu among these sectors 91 of the total energy input flowed into jiangsu s industrial sector an analysis of the changes in outflows from hebei over time showed that from 2002 to 2007 most outflows from sectors in hebei and sectors in other provinces increased by 2012 however outflows from hebei s industrial sector had decreased especially with regard to the industrial sectors in the other provinces 3 2 3 comparison analysis of two scales a comparison of inflows and outflows to and from hebei and its sectors in 2002 and 2007 showed that hebei was a net receiver of energy through direct flows and the sum of the inflows from other provinces was larger than the total outflows hebei generated in 2002 the inflows were 10 43 times larger than the outflows and this remained almost the same in 2007 in 2012 hebei was a net provider and the outflows were 1 86 times the inflows the data showed that hebei was only a provider when exchanging direct energy flows with shanghai jiangsu zhejiang fujian shandong henan and guangdong hebei received more energy than it supplied from the other provinces through direct paths especially when exchanging energy products or services 3 3 embodied energy consumption 3 3 1 provincial scale the embodied energy consumption between provinces can be seen from figs 3 and 6 the trend in the total inflow of embodied energy to hebei was similar to the trend in the total inflow of direct energy for both periods increasing from 2002 to 2007 and then decreasing until 2012 the degree of variation in the embodied flows was however lower than for the direct flows in 2007 the total embodied inflow was 2 73 times that of 2002 and by 2012 it was only one fifth that of 2007 the embodied energy inflows from shanxi inner mongolia and jilin to hebei were the highest but the total quantity of these flows was less than their direct flows to hebei excluding beijing the other 25 provinces delivered less than 10 of the total inflow to hebei a comparison of direct inflows and embodied inflows direct indirect energy input showed that the embodied inflows were larger approximately 2 95 9 18 times that of the direct inflows this indicates that direct energy flows accounted for a larger proportion of the total than the others comparatively jiangxi henan guangdong and chongqing supplied higher proportions of indirect energy flows than direct energy to hebei the graph showing embodied outflows from hebei to the other provinces fig 7 indicates that embodied outflows increased from 2002 to 2007 and then decreased until 2012 the degree of variation in the embodied flows was also lower than for the direct flows in 2007 the total outflow was 14 73 times that of 2002 and in 2012 the amount decreased to 55 75 of the 2007 value embodied outflows from hebei to jiangsu zhejiang shanghai and guangdong were the highest qinghai and chongqing received significantly less energy compared to other provinces regarding the ratios of embodied flows to direct flows the outflow ratios varied significantly between different provinces jiangsu had the highest ratio at 14 2 followed by shandong this indicates that most of the energy resources supplied to these two provinces were transferred through multiple paths rather than by a direct path in 2007 and 2012 the ratios for the 29 provinces were all between 3 0 and 8 0 further analysis of the net embodied energy flows showed a significant gap between inflows and outflows from hebei to shanghai jiangsu zhejiang fujian shandong henan and guangdong which were all net consumers of exchanged energy products or services via embodied energy flows net outflows from hebei to jiangsu anahi and guangdong were the highest and the data for 2007 were much higher than for 2012 hebei was a net receiver of energy products and services from the other 22 provinces during all three years studied shanxi inner mongolia and jilin supplied the highest amounts of energy to hebei 3 3 2 sectoral scale an analysis of embodied energy consumption between sectors in hebei province and other provinces showed that inflows from industrial sectors in the other provinces accounted for most of the energy supplied to all sectors in hebei table 3 a comparison of inflows showed that the proportions of embodied flows from industrial sectors also increased over time and the proportion of agriculture sector ranked second as the foundation sector of national economy the impact of agriculture sector expanded chen et al 2018 taking shanxi as an example embodied inflows from its industrial sector accounted for more than 71 of the total inflows from this province and more than 63 of the total was supplied to hebei s industrial sector regarding sector level embodied energy flows hebei s industrial sector delivered the largest quantity of energy to other provinces and this energy mostly flowed into the industrial sectors in the other provinces table 4 the sectors in jiangsu zhejiang and shanghai received the highest outflows from hebei s industrial sector accounting for more than 84 of the total outflow from hebei 4 discussion a multiregional input output table can be used to effectively analyze interregional trade among provinces in china direct and embodied energy flows were calculated for interregional trade and were subdivided into inflows from other provinces to hebei and outflows from hebei to other provinces this aided the investigation of the entities involved both energy suppliers and receivers in the exchange of energy products or services with regard to hebei and other provinces prior studies using multiregional input output tables to investigate energy flows through interregional trade mainly focused on the quantity of embodied energy for example tang et al 2019 calculated the embodied energy flows between china s 30 provinces for 2010 using a leontief inverse matrix the results indicated that the highest embodied energy flow was from hebei to jiangsu followed by the flows from hebei to zhejiang beijing shandong and liaoning those results are in line with the results of the present research namely embodied energy flows from hebei to jiangsu were the highest in 2007 and 2012 at the regional level sun et al 2017 and zheng et al 2018 studied beijing tianjin and hebei as the jing jin ji urban agglomeration and found that shanxi inner mongolia and shaanxi were the main suppliers of embodied energy flows to the jing jin ji region from 2002 to 2010 the current study found a similar trend in that shanxi and inner mongolia supplied the largest quantity of embodied energy to hebei in all the years studied 2002 2012 combining direct flow results could serve to further illustrate interregional trade between provinces for example direct flows helped to reflect the flow of coal or iron and steel products between other provinces and hebei based on the output data for each province in each year at the sectoral level taking jiangsu as an example flows from hebei s industrial sector to jiangsu accounted for over three quarters of the total inflows to jiangsu and over 90 of the input to the industrial sector in jiangsu this shows there was a strong demand for energy from the industrial sectors and that industrial sectors at the national level tended to employ similar production processes this research analyzed hebei province s energy utilization structures with respect to other provinces as well as by sector the industrial sector remained the sector that consumed the largest amount of energy through both direct and embodied energy flows which is in accordance with the industrial focus of hebei s economy the increase in energy use by secondary industries accounted for more than 47 of the total increase from 2006 to 2016 to be specific the industries of the smelting and pressing of ferrous metals and production and supply of electric power and heat power accounted for the highest hebei economic yearbook 2016 this is related to the largest quantity of iron and steel production and also large numbers of coal fired power plants located in hebei as the development of tertiary industries in hebei progressed energy use in other sectors also accounted for a significant proportion fig 8 consumption in these sectors increased from 2002 to 2007 but remained below that of the industrial sector it is therefore a priority for hebei to exploit more clean energy production systems e g solar and wind energy to reduce its dependence on primary energy supplies that generate emissions 5 conclusions this study used hebei as a case study to analyze energy flows at the provincial and sectoral levels in 2002 2007 and 2012 the energy input analyses did not consider the exchanges of products which more than quadrupled from 2002 to 2012 we first separated direct energy flows from embodied flows since energy products or services are exchanged between provinces or sectors via direct path and also indirect paths the results for inflows from other provinces to hebei and the outflows from hebei to other provinces both showed that direct energy flows increased from 2002 to 2007 and then decreased until 2012 at the sector level direct energy flows related to the industrial sector dominated regarding embodied energy flows between provinces from 2002 to 2012 the quantity of embodied energy supplied to hebei did not change significantly jiangsu received the highest energy flows during all three years studied the ratio of embodied energy flows to direct energy flows shows that most provinces relied on indirect energy flows the embodied energy flows expressed by the sectors also showed that industrial sectors were the main suppliers to hebei and that most energy was delivered to hebei s industrial sector data on direct and embodied energy flows helped to determine that hebei was a receiver for most provinces but by 2012 it had become a supplier the present research represents a preliminary study of energy flows through interregional trade in china but has some limitations first the latest multiregional input output tables were from 2012 however rapid economic development since 2012 and more recent industrial adjustments in hebei province could have caused shifts in the trends second merging sectors in the input output tables and the energy input dataset decreased the gaps between provinces an additional improvement would be to expand the study to include previous and subsequent years thereby revealing embodied energy flows over a longer period credit authorship contribution statement hongmei zheng conceptualization methodology writing original draft aimin li validation data curation fanxin meng visualization investigation gengyuan liu supervision software declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was supported by the national natural science foundation of china no 41801206 71804023 by the sino italian cooperation of china natural science foundation cnsc no 71861137001 by the italian ministry of foreign affairs and international cooperation maeci high relevance bilateral projects by the research project of humanities and social sciences in colleges and universities of hebei province no sd182003 and by the team support projects of tangshan normal university nos 2020c04 and 2020c10 appendix a table a1 
24853,the energy consumed by regions in china may have a huge gap after considering embodied energy due to interregional trade and therefore impact the proposal of energy conservation the aim of this research is to differentiate the effects from direct and indirect flows which comprise embodied energy consumption at provincial and sectoral scales through introducing the theory of interdependence of organisms from ecology in this paper hebei province in china has been selected as a case study based on national multiregional input output tables from 2002 2007 and 2012 as well as energy input data direct energy flows and embodied energy were used to investigate the energy consumption between hebei and 29 other provinces the results showed that the direct flows and embodied energy consumption of hebei province increased and then decreased from 2002 to 2012 shanxi inner mongolia and jilin provinces were providers with to hebei province through both direct flows and embodied consumption on the supply side shanghai zhejiang and guangdong were the top three provinces receiving the most from hebei by sector direct flows and embodied consumption related to industrial activity were dominant this research identified the energy unitization characteristics within one province and meanwhile shed light on the actors of different provinces due to interregional trade keywords multiregional input output analysis embodied energy direct flows interregional trade hebei 1 introduction since 2010 energy consumption in china has ranked the highest among countries worldwide and it continues to grow rapidly in 2010 the total energy consumption was 3 606 metric tons of carbon equivalent mtce increasing to 4 490 mtce in 2017 which equates to an average growth rate of 3 5 per year nbsc 2018 since coal accounts for a large proportion of consumed energy this increase has resulted in growing carbon emissions liu et al 2015 this situation of high consumption and high emissions has affected the whole country to meet china s climate and energy targets for the year 2030 the chinese national targets have been allocated down to all provincial authorities to meet the regional targets based on their specific industrial and governmental infrastructure profiles hubacek and sun 2001 yu et al 2018 furthermore in order to provide scientific basis for energy conservation strategies energy consumed through products or services trade has been treated as an indispensible element embodied energy is the total energy required on the whole processing of production in cities costanza 1980 lenzen 1998 input output analysis is an effective way to quantify the embodied resource uses energy transfers or waste emissions associated with cross boundary exchanges of goods and services leontief 1970 miller and blair 2009 multiregional input output tables can separate the different production technologies used in different regions or countries wiedmann 2009 wiedmann et al 2007 previous studies that performed embodied analyses of china s provinces or regions have included evaluations of water consumption zhang and anadon 2014 embodied energy use liang et al 2007 embodied carbon emissions duan et al 2018 meng et al 2018a b and embodied sulfur dioxide emissions qian et al 2019 such studies can be extended to conduct nexus analyses of china such as the interregional nexus of water and energy wang et al 2019 the water energy nexus of urban agglomerations wang and chen 2016 or the water energy food nexus liu et al 2017 the measurement and analysis of the resources or energy use embodied in domestic trade between provinces or regions can help to identify regional disparities in resource use or energy flows from spatiotemporal perspectives feng et al 2012 2013 these research mostly analyzed embodied resources or wastes from the perspective of regions or provinces in china rather than conducted research at the scale of industrial sectors several studies have analyzed embodied energy consumption and energy flow for different regions and sectors in china researchers initially used input output analysis methods based on the leontief inverse matrix to generate the complete consumption coefficient and direct energy consumption data liang et al 2007 used this method to measure embodied energy consumption treating china as eight regions with four sectors in each region using this method they predicted the expected energy use for 2010 and 2020 to further detail the number of different sectors tang et al 2019 used a chinese multiregional input output table from 2010 to establish two networks one with 30 provinces and another that divided each province into 30 sectors aside from embodied energy consumption they also analyzed embodied energy flows within the two networks their results mainly concerned inflows and outflows showing that the highest embodied energy flows were between sectors within the same province using temporal dynamic analysis zhao et al 2018 built five multiregional input output tables spanning 2007 2011 they used multiregional input output table based structure decomposing analysis technique to figure out the driving forces of embodied energy consumption due to interregional trade of 30 provinces and 30 sectors from a spatial perspective other studies have merged input output tables with system ecology theory to build energy equilibrium equations these used the complete consumption coefficient and multiplied it by the intermediate input or final demand data based on this approach kok et al 2006 analyzed the embodied energy requirements of households in the netherlands using three methods a basic energy input output analysis an input output energy analysis combined with household survey data and an input output analysis combined with process analysis their results indicated that the embodied energy estimates were almost the same using the three methods the choice of method depended on the study aim for example whether it described consumption from an aggregated perspective aimed to calculate energy requirements quickly or sought to reveal detailed information about the production and consumption aspects of the processes furthermore they separated direct and indirect energy requirements for household consumption and found the importance of indirect energy sun et al 2017 and zheng et al 2017 applied this method on an interregional scale to energy exchanges between urban agglomerations in china they selected the yangtze river delta pearl river delta and the jing jin ji urban agglomerations to trace the embodied energy flows between them and with other provinces in china they quantified the energy supply from or energy demands of entities in other provinces included in the energy exchange activity among the three agglomerations zhang et al 2016a extended the boundaries to the national level calculating the embodied energy consumption of eight regions in china for 2002 and 2007 as well as the inflows or outflows between them in addition to the regional perspective zheng et al 2017 added a provincial network and investigated the consumption and flow data between regions and provinces for both years zhang et al 2013 used intermediate input and final demand data in a multiregional input output table for 2007 and found that domestic trade was the main driving force for provincial energy supply and demand that study also identified separate producer or consumer entities in provinces engaged in energy exchanges therefore the research of embodied energy consumption is useful in determining the responsibility of regions in energy conservation comprehensively the indirect energy contributed to the embodied energy is the energy required for all goods or services production distribution and disposal kok et al 2006 indirect energy is formed based on the interregional trade among regions or sectors and it can be analyzed based on the theory of hannon 1973 that the interdependence of organisms in an ecosystem could be linked directly and indirectly from this perspective indirect energy consumption between any two components in an ecosystem or socioeconomic system could be further separated into two parts direct flow connects two components through one step and indirect flow means the resource travels several steps to reach other component fath and patten 1999 zhang et al 2010 most of the previous researches discussed the indirect energy consumption and did not further separate into direct flow and indirect flow between any two sectors or regions and this could help to quantify the direct and indirect effects as mediated by flows hebei province is located in the jing jin ji urban agglomeration fig 1 it is a prime example of an area that has experienced industrial transformation and development constituting a peripheral economic zone around the municipalities of beijing and tianjin air pollution and the destruction of the ecological environment have become serious problems in the region in 2016 hebei province s gross domestic products gdp accounted for 4 33 of china s national gdp however the proportions of energy consumption and coal use were higher at 6 53 and 6 61 respectively nbsc 2017 due to this high rate of energy consumption of the 10 chinese cities with the worst air quality in 2016 six were in hebei province to tackle the problem of high energy consumption and high emissions the 13th five year plan for energy development in hebei was issued by the people s government of hebei province in 2017 it proposed that the three highest priorities were introducing an improved energy utilization structure enhancing energy use efficiencies and reducing carbon emissions the plan also emphasized that aside from emission reduction energy use by self sufficient entities should be coordinated and how energy is supplied to other users should be managed in this way energy use within the province could be exploited most effectively it was also suggested that the province should establish basic levels of resource provision to others such as coal petroleum and national gas and develop renewable energy 1 1 http info hebei gov cn eportal ui pageid 1962757 articlekey 6753062 columnid 329982 therefore it is important to conduct quantitative analysis on the energy consumption and flows among sectors within one province or among sectors between different provinces this research chooses hebei province as a case study and focuses on the direct and indirect flows at sectoral and provincial scales due to interregional trade chinese national multiregional input output tables for 2002 2007 and 2012 are used for the study analyzing direct flow and embodied energy use from a province level perspective is useful for evaluating energy inflows or outflows and for identifying the producers and consumers arising from exchanges of goods or services the quantitative evaluation of energy flow between sectors along with information about local geography and economic development can help to reflect the proportion of direct and indirect energy flows and shed light on the energy utilization structures of different sectors the combination of two scales analysis would identify the energy unitization characteristics within one province and meanwhile shed light on the actors of different provinces due to interregional trade 2 methodology 2 1 explanation of energy flow terms considering a region with higher developed level tends to import more products or services from others or some regions purchase more goods and services from other regions as opposed to producing them locally the energy use implied in these products or services through interregional trade needs to be elaborated when proposing energy reduction strategies zhang et al 2014 as frequent large exchanges of resources or energy have led to closer economic and industrial ties between provinces or regions large disparities in such flows can create economic or resource imbalances that jeopardize sustainable development zhang et al 2016b therefore aside from the energy consumed by regions the indirect energy consumption implied in the transfers between regions also contribute to the uneven distribution of regional energy consumption and additionally the regional targets the sum of them is embodied energy zhang et al 2016a afterwards the terms separating the indirect energy consumption can be defined direct energy flow is the implied energy in the products or semifinished products that are transferred between regions through a direct path e g the energy implied in cement which is produced by a cement plant and directly purchased by a construction company indirect energy flow means the energy implied in the linkage of any two regions that cannot connect directly instead there are mediated regions and the paths between the two regions are more than one see fig 2 furthermore energy input refers to energy a region uses that comes from outside its borders energy input datasets for each province were obtained from the china emission accounts and datasets for 2002 2007 and 2012 ceads http www ceads net each dataset included data from 42 sectors the three multiregional input output tables included 21 sectors in 2002 shi and zhang 2012 30 sectors in 2007 liu et al 2012 and 42 sectors in 2012 liu et al 2018 both the energy datasets and the input output datasets included the 22 provinces four municipalities and four autonomous regions that are collectively referred to as provinces tibet was not covered comprehensively due to a lack of full datasets the sector data for the three time periods were merged into four composite sectors agriculture industry construction and others this information is summarized in supplemental table s1 2 2 embodied energy flow accounting the energy input data list the energy produced and used by different energy types and from different sources these include the following raw coal cleaned coal other washed coal briquettes coke coke oven gas other gas other coking products crude oil gasoline kerosene diesel oil fuel oil liquid propane gas by refinery from other petroleum products natural gas energy as heat energy as electricity and from other energy sources the total energy input for each sector in every province was calculated by converting all quantities of these energy sources into common units of tons of coal equivalent tce 1 e i f m 1 e i f m where e i f m represents the m energy source consumer by sector i in province f e i f refers to the energy inputs for each sector in the province based on input output analysis equations leontief 1970 2 x i f s 1 30 j 1 4 x i j f s y i f where x i f is the total output of sector i in province f x i j f s refers to the intermediate use of the monetary flows from sector i in province f to sector j in province s and y i f is the total final energy use supplied by sector i in province f the technical coefficient matrix a can be calculated by 3 a i f x i j f s x j f combing eqs 2 and 3 gives 4 x i f i a i f 1 y i f where i is the identity matrix the direct energy consumption intensity from each sector in each province is 5 k i f e i f x i f where k i f denotes the factor vector of the direct energy coefficient for each sector eqs 4 and 5 can then be combined to produce the final equation 6 e m b o d i e d i f k i f i a i f 1 y i f where e m b o d i e d i f denotes the embodied energy consumption of sector i in province f this can be extended using the following power series to produce an equation yang et al 2016 7 e m b o d i e d i f k i f a 0 a 1 a 2 a l y i f where a 0 reflects any flow that originates from and returns to itself a 1 reflects flows between a pair of sectors i e flows with a path length of 1 and the higher powers of a represent flows through different lengths direct and indirect energy flows can then be calculated as follows 8 d i r e c t i f k i f a 1 y i f 9 i n d i r e c t i f e m b o d i e d i f d i r e c t i f k i f y i f where d i r e c t i f and i n d i r e c t i f denote direct and indirect energy flows respectively thus the direct and indirect energy flows for each sector can be separated from the indirect energy consumption 3 results analysis 3 1 energy input the energy input data for hebei province showed that energy input increased significantly from 2002 to 2012 the total in 2007 was 2 07 times that of 2002 and it had doubled again by 2012 3 2 direct energy flows 3 2 1 provincial analysis figs 3 and 4 show the energy flows through one path among provinces including all the direct flows between hebei and the other 29 provinces the total direct energy inflow from other regions to hebei grew during 2002 2007 but decreased during 2007 2012 the total inflow in 2007 was 3 12 times that of 2002 but the inflow in 2012 was only 0 16 that of 2007 the reason for this can be seen in the monetary table as all 29 provinces inputted lower levels of products or services to hebei in 2012 compared to 2007 among the provinces direct flows from shanxi inner mongolia and jilin to hebei were the highest in 2002 and 2007 shanxi inputted the most energy through a direct path to hebei accounting for 26 38 of the total in 2002 and 21 39 in 2007 the second highest was inner mongolia its inflow accounted for 19 61 of the total in 2007 and 14 59 in 2012 these two provinces may have different reasons for the highest inflows shanxi was one of the provinces in china in 2002 and 2007 that consumed the largest quantity of energy input and produced products or services with high energy consumption the energy input of inner mongolia was not high however the indigenous production of coal total of shanxi and inner mongolia both ranked in the front in china these coal products may be transferred to hebei in 2012 the inflow from ningxia reached its highest proportion accounting for 14 56 of the total inflow this could be referred to ningxia s output data for 2012 more products flowed to other provinces from the coal mining and dressing sector compared to 2007 the inflow was followed by shanxi which supplied 12 75 an analysis of inflow changes across the three time periods showed that from 2002 to 2007 inflows from all the other 28 provinces increased only beijing was an exception this could have to do with the policy of relocating high pollution plants or industries away from beijing to cities in hebei a trend that has continued to increase over time for example with the relocation of shougang group a new iron and steel base was built in caofeidian tangshan which resulted in the relocation of products with high energy consumption the casting department of first machine tool plant and one plastic plant have both been moved to baoding in summary there were about 300 enterprises have been moved from beijing to zhangjiakou chengde langfang baoding and tangshan the increases from shandong hainan chongqing guizhou yunnan and ningxia were the largest this was partly due to their low initial inflows in 2002 which were all below 0 53 mtce the rates from the other 22 provinces also increased over the time period ranging from a factor of 1 65 heilongjiang to 15 67 henan following this period of acceleration the inflows in 2012 were all lower than in 2007 qinghai accounted for 24 36 of the total in 2007 while the other 28 provinces all supplied less than 15 of the total for that year fig 5 shows the direct flows from hebei to the other provinces the total outflow from hebei grew after 2002 and then decreased between 2007 and 2012 the total direct outflow from hebei to the other 29 provinces in 2007 was 24 31 times that of 2002 which then decreased by 41 by 2012 a comparison of the outflows to the other 29 provinces shows that the largest outflows from hebei by direct paths were to jiangsu zhejiang and guangdong this was due to the large volume of product and service exchanges between hebei and these provinces in 2002 the direct energy flow from hebei to shanghai was the highest accounting for 16 46 of the total outflow next were zhejiang and guangdong with proportions of 12 57 and 12 24 respectively in 2007 jiangsu guangdong and zhejiang received the largest quantities of energy from hebei the total proportion of these three outflows increased compared to 2002 growing to 67 17 of the total outflow in 2012 hebei also supplied the largest amount of energy to jiangsu and guangdong accounting for 37 96 and 15 70 of the total respectively all direct outflows changed significantly from 2002 to 2007 except for the flows from hebei to heilongjiang and hainan which increased only moderately to 1 08 times and 2 56 times that of 2002 respectively energy flows to the other 27 provinces all more than quadrupled by 2007 by 2012 the outflows to anhai jiangxi hunan hainan and chongqing had all increased again among them the outflow to hainan increased the most and was 16 times what it had been in 2007 this was because of the relatively small quantities of energy flowing from hebei to hainan in 2002 and 2007 by 2012 outflows to the other provinces had decreased by 12 83 compared to 2007 3 2 2 sectoral analysis further analysis of the direct flows between sectors within hebei and between other provinces is shown in table 1 inflows from industrial sectors in the other provinces to hebei accounted for the highest proportion with the largest quantity of direct energy going to the industrial sector this was because that the industrial sectors in the different provinces used similar processing technologies and systems when processing raw products into similar products or services in some industries for example electricity in china is now mostly produced by thermal power accounting for over 70 of the country s total power generating capacity 2 2 http www chyxx com industry 201811 692651 html this is principally because of the low cost of employing this mature technology thermal power plants use coal petroleum and natural gas as fuel and produce electricity by first converting chemical energy into heat energy and then into mechanical energy and finally into electrical energy cheng et al 2019 industrial sectors in the other provinces also inputted largest energy through direct paths to other three sectors in hebei this occurred because sectors such as the service sector or the construction sector are downstream from the industrial sectors in other provinces i e they utilize products or by products produced by industrial sectors as raw or processed materials sectors in provinces with high inflows to hebei e g shanxi inner mongolia and ningxia all showed the same trend direct flows from the industrial sector in shanxi were the largest accounting for more than 54 of the total flow from the four industrial sectors which constituted the largest quantity of energy supplied to hebei s industrial sector and 42 of the total outflow from shanxi the flows from other sectors to sectors in hebei increased from 2002 to 2007 except for the industrial sector in beijing from which flows to all sectors in hebei decreased accounting for 41 in 2007 compared to 77 in 2002 all flows decreased from 2007 to 2012 except for those from other sectors in shanxi which increased slightly table 2 shows the outflows from the four sectors in hebei province to sectors in other provinces the data indicate that hebei s industrial sector supplied most of its energy to other sectors through a direct path compared to inflows the total quantity of outflows was lower sectors in provinces with the highest energy flows such as jiangsu zhejiang and guangdong also showed the same characteristic the four sectors in jiangsu received the largest quantity of energy from hebei s industrial sector accounting for 75 of the total energy flowing into the four sectors in jiangsu among these sectors 91 of the total energy input flowed into jiangsu s industrial sector an analysis of the changes in outflows from hebei over time showed that from 2002 to 2007 most outflows from sectors in hebei and sectors in other provinces increased by 2012 however outflows from hebei s industrial sector had decreased especially with regard to the industrial sectors in the other provinces 3 2 3 comparison analysis of two scales a comparison of inflows and outflows to and from hebei and its sectors in 2002 and 2007 showed that hebei was a net receiver of energy through direct flows and the sum of the inflows from other provinces was larger than the total outflows hebei generated in 2002 the inflows were 10 43 times larger than the outflows and this remained almost the same in 2007 in 2012 hebei was a net provider and the outflows were 1 86 times the inflows the data showed that hebei was only a provider when exchanging direct energy flows with shanghai jiangsu zhejiang fujian shandong henan and guangdong hebei received more energy than it supplied from the other provinces through direct paths especially when exchanging energy products or services 3 3 embodied energy consumption 3 3 1 provincial scale the embodied energy consumption between provinces can be seen from figs 3 and 6 the trend in the total inflow of embodied energy to hebei was similar to the trend in the total inflow of direct energy for both periods increasing from 2002 to 2007 and then decreasing until 2012 the degree of variation in the embodied flows was however lower than for the direct flows in 2007 the total embodied inflow was 2 73 times that of 2002 and by 2012 it was only one fifth that of 2007 the embodied energy inflows from shanxi inner mongolia and jilin to hebei were the highest but the total quantity of these flows was less than their direct flows to hebei excluding beijing the other 25 provinces delivered less than 10 of the total inflow to hebei a comparison of direct inflows and embodied inflows direct indirect energy input showed that the embodied inflows were larger approximately 2 95 9 18 times that of the direct inflows this indicates that direct energy flows accounted for a larger proportion of the total than the others comparatively jiangxi henan guangdong and chongqing supplied higher proportions of indirect energy flows than direct energy to hebei the graph showing embodied outflows from hebei to the other provinces fig 7 indicates that embodied outflows increased from 2002 to 2007 and then decreased until 2012 the degree of variation in the embodied flows was also lower than for the direct flows in 2007 the total outflow was 14 73 times that of 2002 and in 2012 the amount decreased to 55 75 of the 2007 value embodied outflows from hebei to jiangsu zhejiang shanghai and guangdong were the highest qinghai and chongqing received significantly less energy compared to other provinces regarding the ratios of embodied flows to direct flows the outflow ratios varied significantly between different provinces jiangsu had the highest ratio at 14 2 followed by shandong this indicates that most of the energy resources supplied to these two provinces were transferred through multiple paths rather than by a direct path in 2007 and 2012 the ratios for the 29 provinces were all between 3 0 and 8 0 further analysis of the net embodied energy flows showed a significant gap between inflows and outflows from hebei to shanghai jiangsu zhejiang fujian shandong henan and guangdong which were all net consumers of exchanged energy products or services via embodied energy flows net outflows from hebei to jiangsu anahi and guangdong were the highest and the data for 2007 were much higher than for 2012 hebei was a net receiver of energy products and services from the other 22 provinces during all three years studied shanxi inner mongolia and jilin supplied the highest amounts of energy to hebei 3 3 2 sectoral scale an analysis of embodied energy consumption between sectors in hebei province and other provinces showed that inflows from industrial sectors in the other provinces accounted for most of the energy supplied to all sectors in hebei table 3 a comparison of inflows showed that the proportions of embodied flows from industrial sectors also increased over time and the proportion of agriculture sector ranked second as the foundation sector of national economy the impact of agriculture sector expanded chen et al 2018 taking shanxi as an example embodied inflows from its industrial sector accounted for more than 71 of the total inflows from this province and more than 63 of the total was supplied to hebei s industrial sector regarding sector level embodied energy flows hebei s industrial sector delivered the largest quantity of energy to other provinces and this energy mostly flowed into the industrial sectors in the other provinces table 4 the sectors in jiangsu zhejiang and shanghai received the highest outflows from hebei s industrial sector accounting for more than 84 of the total outflow from hebei 4 discussion a multiregional input output table can be used to effectively analyze interregional trade among provinces in china direct and embodied energy flows were calculated for interregional trade and were subdivided into inflows from other provinces to hebei and outflows from hebei to other provinces this aided the investigation of the entities involved both energy suppliers and receivers in the exchange of energy products or services with regard to hebei and other provinces prior studies using multiregional input output tables to investigate energy flows through interregional trade mainly focused on the quantity of embodied energy for example tang et al 2019 calculated the embodied energy flows between china s 30 provinces for 2010 using a leontief inverse matrix the results indicated that the highest embodied energy flow was from hebei to jiangsu followed by the flows from hebei to zhejiang beijing shandong and liaoning those results are in line with the results of the present research namely embodied energy flows from hebei to jiangsu were the highest in 2007 and 2012 at the regional level sun et al 2017 and zheng et al 2018 studied beijing tianjin and hebei as the jing jin ji urban agglomeration and found that shanxi inner mongolia and shaanxi were the main suppliers of embodied energy flows to the jing jin ji region from 2002 to 2010 the current study found a similar trend in that shanxi and inner mongolia supplied the largest quantity of embodied energy to hebei in all the years studied 2002 2012 combining direct flow results could serve to further illustrate interregional trade between provinces for example direct flows helped to reflect the flow of coal or iron and steel products between other provinces and hebei based on the output data for each province in each year at the sectoral level taking jiangsu as an example flows from hebei s industrial sector to jiangsu accounted for over three quarters of the total inflows to jiangsu and over 90 of the input to the industrial sector in jiangsu this shows there was a strong demand for energy from the industrial sectors and that industrial sectors at the national level tended to employ similar production processes this research analyzed hebei province s energy utilization structures with respect to other provinces as well as by sector the industrial sector remained the sector that consumed the largest amount of energy through both direct and embodied energy flows which is in accordance with the industrial focus of hebei s economy the increase in energy use by secondary industries accounted for more than 47 of the total increase from 2006 to 2016 to be specific the industries of the smelting and pressing of ferrous metals and production and supply of electric power and heat power accounted for the highest hebei economic yearbook 2016 this is related to the largest quantity of iron and steel production and also large numbers of coal fired power plants located in hebei as the development of tertiary industries in hebei progressed energy use in other sectors also accounted for a significant proportion fig 8 consumption in these sectors increased from 2002 to 2007 but remained below that of the industrial sector it is therefore a priority for hebei to exploit more clean energy production systems e g solar and wind energy to reduce its dependence on primary energy supplies that generate emissions 5 conclusions this study used hebei as a case study to analyze energy flows at the provincial and sectoral levels in 2002 2007 and 2012 the energy input analyses did not consider the exchanges of products which more than quadrupled from 2002 to 2012 we first separated direct energy flows from embodied flows since energy products or services are exchanged between provinces or sectors via direct path and also indirect paths the results for inflows from other provinces to hebei and the outflows from hebei to other provinces both showed that direct energy flows increased from 2002 to 2007 and then decreased until 2012 at the sector level direct energy flows related to the industrial sector dominated regarding embodied energy flows between provinces from 2002 to 2012 the quantity of embodied energy supplied to hebei did not change significantly jiangsu received the highest energy flows during all three years studied the ratio of embodied energy flows to direct energy flows shows that most provinces relied on indirect energy flows the embodied energy flows expressed by the sectors also showed that industrial sectors were the main suppliers to hebei and that most energy was delivered to hebei s industrial sector data on direct and embodied energy flows helped to determine that hebei was a receiver for most provinces but by 2012 it had become a supplier the present research represents a preliminary study of energy flows through interregional trade in china but has some limitations first the latest multiregional input output tables were from 2012 however rapid economic development since 2012 and more recent industrial adjustments in hebei province could have caused shifts in the trends second merging sectors in the input output tables and the energy input dataset decreased the gaps between provinces an additional improvement would be to expand the study to include previous and subsequent years thereby revealing embodied energy flows over a longer period credit authorship contribution statement hongmei zheng conceptualization methodology writing original draft aimin li validation data curation fanxin meng visualization investigation gengyuan liu supervision software declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was supported by the national natural science foundation of china no 41801206 71804023 by the sino italian cooperation of china natural science foundation cnsc no 71861137001 by the italian ministry of foreign affairs and international cooperation maeci high relevance bilateral projects by the research project of humanities and social sciences in colleges and universities of hebei province no sd182003 and by the team support projects of tangshan normal university nos 2020c04 and 2020c10 appendix a table a1 
24854,ecosystem models are important tools for conducting ecosystem based management a particularly useful method of characterizing the flow of energy through an ecosystem and the subsequent direct and indirect implications of management actions is mass balance modeling here we outline the equations as utilized in rpath an r implementation of the mass balance algorithms popularized by ecopath with ecosim that are designed to work with fisheries data sources we believe that common practices in r will aid in the reproducibility of conducting analysis using a mass balance model as all of the code is contained within a single script file this includes the built in statistical and graphical functions of r in addition to added reproducibility r is a coding language with which ecologists are familiar this familiarity offers greater flexibility for practitioners to tailor the model to their needs we have made the code available on an open software development platform which should aid in continuous community development of the tool keywords ecopath ecosim mass balance reproducibility r rpath 1 introduction mass balance models describe the structure and flow of energy through the system they are commonly used for quantifying food web interactions in a whole ecosystem context the most popular of these models is ecopath which was first developed by polovina 1984 to explain the net primary production required to support a tropical reef system that model has been modified and expanded to fit all types of aquatic and even terrestrial ecosystems fretzer 2014 part of its power is that it makes use of input quantities that are regularly measured in single species resource management such as biomass mortality rates and growth rates that are then placed into the mass balance framework to determine ecosystem unknowns such as lower trophic level productivity ecosim walters et al 1997 uses ecopath models as a basis for parameterizing a set of biomass dynamics differential equations that include functional responses between predators and prey removals by humans hereafter fishing and environmental drivers that may be time varying ecosim is used to conduct dynamic simulations either to explain historical changes in ecosystem structure and function or to predict the direct and indirect effects of both human driven and natural ecosystem perturbations a later iteration of the ecosim equations walters et al 2000 added a method for modeling age specific life stages hereafter stanzas for individual species using delay difference equations in conjunction with the biomass dynamics model to explicitly model recruitment variable growth ontogenetic diet shifts and age based fisheries selectivity ecopath and ecosim are used together in an ecosystem based management context to identify and quantify major energy flows in the system describe ecosystem resources and their interactions evaluate the ecosystem effects of fishing or environmental changes and exploring management policy options plaganyi 2007 a large measure of these tools popularity comes from the development of a user friendly package ecopath with ecosim ewe christensen and pauly 1992 steenbeek et al 2015 ewe has many strengths including ease of use through a convenient graphical user interface gui and the ability to track data quality as an inherent part of ewe data entry further the ewe package includes a wide range of add on tools for calculating ecosystem properties such as cycling diversity and throughput users can input their parameters directly into a spreadsheet or import them from a comma delimitated file modifications can be made within the gui for running simulations however this strength is also a weakness users must take extreme caution to insure that user error is not introduced as running multiple simulations requires users to record the settings for each run it is possible that some modifications may not be saved and therefore limit the reproducibility by other users ewe software is open source and freely available at www ecopath org open source means that there is universal access to the code and that the code can be redistributed or subsequently improved by any interested users steenbeek et al 2015 this allows users to overcome some gui specific issues such as running scripts directly from the base code the base code is built on the microsoft net platform primarily using visual basic many ecologists are familiar with the rapidly growing statistical language r tippmann 2014 it is the software of choice for many scientists who are transitioning from costly platform specific commercial software packages a recent search on elsevier s scopus database showed that one in 100 scholarly articles cite r or one of its packages with even greater citation rates in the agricultural and environmental sciences tippmann 2014 r is available for multiple operating systems and has a rich user community with strong on line support r was the 12th most popular programming language on github a popular version control repository including the most new collaborations per repository which demonstrates that it is being actively used and modified smith 2015 r also boasts a publication quality graphical engine that allows users to generate figures in the same programming environment that they conducted their statistical analyses here we introduce an r implementation of ecopath and ecosim called rpath which is meant to be a complement to the existing ewe software our goals were to develop a flexible tool that would take advantage of the built in graphical and statistical prowess of r and allow for better reproducibility of ecosystem modeling by capturing all changes in a script format meaning analyses can be easily recreated by others furthermore recoding of ecopath and ecosim using r s extensive libraries for linear algebra and matrix manipulation allows for greater readability of the underlying code and greater extensibility by the community of researchers familiar with r rpath includes the mass balance methods of polovina 1984 the biomass dynamics methods walters et al 1997 and the life history stanzas methods walters et al 2000 the mass balance algorithms are implemented using r s linear algebra library the core dynamic simulation derivative and numerical integration routines are implemented using c code based on aydin et al 2007 re written using the rcpp library eddelbuettel and francois 2011 to make use of r s vector operations and transparent coding structure within the c code while allowing the parameter setup and results analysis to be performed seamlessly in the r environment the rsim family of functions within the rpath package this paper is not meant to serve as a user s manual for rpath but rather to describe the mass balance and dynamic simulation algorithms that are implemented in the base library of rpath the r package which can be downloaded at https github com noaa edab rpath includes several vignettes that demonstrate how to run the model 2 mass balance in rpath 2 1 processes of the function rpath ecopath is a system of linear equations that describes the mass balance of an ecosystem there are two master equations that govern the mass balance one that characterizes production and the other consumption production is calculated as the sum of all predation on a group as well as non predatory losses fishing emigration etc while consumption must account for all production as well as unassimilated food and respiration the production equation can be rearranged as eq 1 see christensen and pauly 1992 for full derivation the parameters for ecopath equations are described in table 1 with subscript definitions in table 2 1 b i p b i e e i j 1 n b j q b j d c i j e x i this form of the ecopath master equation allows for the algebraic solution for unknown biomasses b or ecotrophic efficiencies ee rpath unlike the ewe software does not solve for unknown pb or qb on the right hand side of eq 1 is the sum of predator mortality as well as other exports ex from the system these exports include fishery removals biomass accumulation and net migration within the rpath package mass balance is carried out with the rpath family of functions fig 1 with the function rpath executing the solution of the system of equations first it simplifies the list of possible unknown parameters using relationships to other known parameters specifically unknown growth efficiencies ge alternately named pq in some literature for production to consumption are solved using eq 2 2 g e i p b i q b i after the list of unknown parameters is minimized the remaining unknowns are solved using matrix multiplication eq 1 is expressed in the traditional matrix algebra form of ax b where a is an n x n matrix with the diagonal of coefficients either bipbi or pbieei based on which is the unknown parameter and the off diagonal coefficients relating to consumption if the biomass of a predator is unknown x is an n dimensional vector of unknown b or ee and b is an n dimensional vector of mortality terms eq 1 is solved by inverting a using the general inverse function ginv from the mass package venables and ripley 2003 and multiplying by b in addition to calculating unknown b or ee rpath calculates several ancillary parameters these include detrital biomass and ecotrophic efficiency trophic levels and mortality terms detrital biomass and ecotrophic efficiency are not necessary for ecopath but are necessary when transitioning to the dynamic simulation ecosim trophic levels and mortality terms are of general interest to researchers typically detrital biomasses are unknown while detritus groups do not respire or consume anything detritus is consumed in most models therefore it is important to account for how much detritus exists and is used detritus is generated through non mortality loss the unassimilated portions of consumption and fishery discards eq 3 it is subsequently removed via consumption eq 4 knowing both detrital input and output eedt is calculated as detoutputdt detinputdt further if detrital biomass is not provided it is calculated using b d t d e t i n p u t d t p b d t note if pbdt is not provided a default value of 0 5 is used so the default detrital biomass is twice detinputdt 3 d e t i n p u t d t j 1 n d e t f a t e d t j m 0 j b j b j q b j u j k 1 n d e t f a t e d t k j 1 n c j g d i s c 4 d e t o u t p u t d t j 1 n b j q b j d c d t j the trophic levels for ecosystem components are calculated in a similar method to unknown b or ee using matrix algebra the trophic level equation eq 5 is rearranged as eq 6 in this case the matrix notation b is an n dimensional vector of ones the a matrix is a transposed matrix of negative diet composition in the off diagonals with ones in the diagonal rpath then solves for x an n dimensional vector of unknown trophic levels in the case of mixotrophs their diets are renormalized to take into account the proportion of primary production as d c i j d c i j 1 p p i 5 t l j 1 i 1 n t l i d c i j 6 1 i 1 n t l i d c i j t l j t l j 1 the final set of ancillary calculations is the various mortality rates on a species group these include predation mortality m2 fishing mortality f and other mortality m0 predation mortality is calculated as the loss of biomass to a predator divided by the biomass of that prey group eq 7 total catch for each species i and fleet g includes both landings c ig land and discards c ig disc landings and discards are entered separately for each fleet g f for each species is the sum of all catches of that species divided by its biomass eq 8 discards are considered an input to a detritus group as 100 mortality is assumed other mortality accounts for losses outside of the model domain calculated as eq 9 7 m 2 i j d c i j q b j b j b i 8 f i g 1 n c i g l a n d c i g d i s c b i 9 m 0 i p b i 1 e e i 2 2 multistanza groups to account for ontogenetic shifts in species diet and mortality rates rpath includes the ability to parameterize multistanza species groups linking these groups together by simple biomass flow would produce unrealistic dynamics walters et al 1997 as a result a delay difference model is parameterized so that flow between stanzas is based on numbers and biomass although this is more of a concern for dynamic simulations rpath bases the biomass and consumption estimates for all of the stages based on one leading stage the function rpath stanzas will calculate the appropriate fields by calculating the weight at age using the generalized von bertalanffy growth equation eq 10 essington et al 2001 the more common specialized growth equation assumes d 2 3 which creates a carrying capacity parameter ksp that is k 3 ewe uses the specialized version of the growth equation so for consistency rpath stanzas takes ksp as the parameter and converts to k within the code as with the general ecopath equations parameter definitions for stanza equations can be found in table 3 10 w a w 1 e k 1 d t t 0 1 1 d assuming a stable age distribution b and qb for all non leading stanzas are calculated using the proportion of the population at age a as eq 11 where la is the population growth rate corrected survivorship eq 12 christensen and walters 2004 the relative biomass of the population in stanza s is calculated as the proportion of survivors within stanza s to the entire age structure eq 13 christensen and walters 2004 ewe calculates amax the maximum age at 0 9 w and accounts for the additional biomass in a plus group we decided that calculation was unnecessary with the current computing power and decided to calculate it at 0 99 w 11 a a 0 n a l a a 0 n l a 12 l a e a z a a b a b 13 b s a a s min a s max l a w a a 1 a max l a w a once the proportional biomass for each stanza is determined the biomass is calculated using the leading stanza first the total biomass for the complex is calculated as eq 14 then the trailing stanza groups biomasses are calculated as eq 15 consumption for each stanza is calculated in a similar way using the consumption by weight assumption of eq 16 instead of wa in eq 13 consumption is then substituted in for biomass in the calculations of total consumption for the complex eq 14 and consumption for trailing stanza groups eq 15 14 b m s b l e a d i n g s b l e a d i n g s 15 b s b s b m s 16 q a w a d although not used in the mass balance portion of rpath rpath stanzas also calculates the abundance at age for each stanza group to be used in dynamic simulations abundance at age is based on the relative contribution of recruits by the leading stanza eq 17 actual numbers are calculated as n a r i l a 17 r i b l e a d i n g a a l e a d i n g min a l e a d i n g max l a w a 3 dynamic simulations in rpath 3 1 from path to rates rsim the static snap shot provided by the ecopath equations was initially extended to dynamic simulations ecosim by walters et al 1997 with later modifications described in walters et al 2000 and christensen and walters 2004 as incorporated into ewe ecosim describes the dynamics of the ecosystem as a set of ordinary differential equations governing the change in the biomass of each group over time and are implemented in rpath as the rsim family of functions similar to the rpath and multistanza parameters the parameters for the rsim functions can be found in table 4 for each living non detrital group the governing equation is 18 d b i d t 1 a i u i j q b i b j f o r c e d m o r t i m j q b j b i m 0 i b i f o r c e d m i g r a t e i m b i c m b i where q bi bj is the predator prey functional response between group i and group j described in eq 19 and cm bi is the time dependent fisheries induced mortality function described in eq 25 ai and ui are energetic loss terms specified as a fraction of total consumption representing active respiration loss and unassimilated food respectively by default 1 a i u i is equal to the ecopath growth efficiency ge eq 2 the active respiration portion of consumption is considered lost to the system while the unassimilated portion is gained by detrital groups in proportion to each living group s ecopath detrital fate eq 3 m0 i is a mortality term for other mortality with a default value calculated from ecopath eq 9 the total biomass lost from a living group due to other mortality also enters detritus according to the group s detrital fate forcedmortim and forcedmigrateim are forcing functions described further in section 3 4 3 2 predator prey responses for the predator prey functional response q bi bj rpath uses an alternate form of the walters et al 1997 consumption equation derived in aydin 2004 in order to better relate the functional form to fitting and uncertainty analysis e g gaichas et al 2011 gaichas et al 2012 the formulation separates density dependent effects for predator j and prey i using 19 q b i b j q i j v i j y p r e d j v i j 1 1 s i j y p r e d j s i k α k j y p r e d k d i j y p r e y i θ i j d i j 1 1 h i j y p r e y i h i k β i k y p r e y k θ i j the state variables in eq 19 are contained in the terms ypred and yprey that represent each species foraging activity as predator and prey respectively these are calculated as ratios with respect to set reference levels 20 y p r e d j f o r c e d p r e d j m f t i m e j b j b j 21 y p r e y i f o r c e d p r e d i m f t i m e i b i b i ftimei is a state variable that has an initial condition of 1 0 and does not change unless the foraging time adjustment parameter fadji is nonzero therefore at ecopath equilibrium ypred and yprey are equal to 1 so that eq 19 reduces to q b i b j q i j forcedpred is a forcing function explained in more detail in section 3 4 primary producers are modeled as predators using eq 19 but with ypreyi i e sunlight fixed at 1 0 therefore the self saturation of phytoplankton group j is set through vij 22 f t i m e i m 1 0 1 0 9 f t i m e i m 1 f a d j i q b i q b i m 1 changes in ftime are made on a monthly time step m using the difference eq 22 where q b i is the reference consumption to biomass ratio from ecopath by default and qbim is the predator s current total consumption summed across all prey eq 19 divided by its current biomass walters and kitchell 2001 importantly for comparison in rpath the default for fadji is 0 while in ewe the default is 0 5 leading to differences in results when using the default assumptions from respective implementations the higher value will result in a smaller magnitude perturbation as species groups consume more to mitigate their losses in eq 19 q i j is the reference consumption rate consumption flow from prey i to predator j vij is the main vulnerability parameter input into ecosim to account for predator density dependent foraging xij in the original derivation of walters et al 1997 and dij is the handling time parameter accounting for prey density dependence predator saturation the range of vij and dij is 1 for practical use values 1000 are indistinguishable from infinity the default value for vij is 2 0 while the default value for dij is 1000 table 6 θij controls the shape of the prey density dependent response with a value of 1 0 default resulting in a holling type ii functional response and a value of 2 0 representing a holling type iii response though θij is not restricted to integer values the parameters sij and hij are flags that control whether the predator density dependence sij or prey density dependence hij are affected solely by the biomass levels of the particular predator and prey or whether a suite of other species biomasses in similar roles impact the relationship for the default value for sij of 0 off the predator density dependence is only a function of that predator biomass and likewise for prey with the default value of 0 for hij values greater than 0 allow for a density dependent effects to be affected by a weighted sum across all species for predators eq 23 and for prey eq 24 the weights αkj and βkj are normalized such that the sum for each functional response i e k αkj and k βkj for the functional response between predator j and prey i sum to 1 the weights are calculated from the density independent search rates for each predator prey pair aij terms in walters et al 1997 which is equal to 2 q i j v i j v i j 1 b i b j 23 p r e d s u i t e k α k j y p r e d k 24 p r e y s u i t e k β i k y p r e y k 3 3 fishing responses a primary use of ecosim is to simulate both the direct and indirect effects of fishing on ecosystem biomasses eq 25 offers multiple ways to specify time specific catch 25 c m b i g 1 n q i g l a n d e g m b i g 1 n q i g d i s c e g m b i f o r c e d f r a t e i m b i min f o r c e d c a t c h i y 12 b i p i n e t here q ig land and q ig disc are calculated for each fleet g by assuming that egm is 1 0 in ecopath equilibrium so that q is calculated from ecopath catches as eqs 26 and 27 the gear effort egm can be supplied by the user at a monthly resolution m and defaults to 1 0 forcedfrateim is an additional instantaneous fishing mortality rate defaulting to 0 that can be applied to a functional group independently of gear type while forcing rates are input at a monthly resolution the units are annual year 1 an additional absolute loss term forcedcatchiy can be further supplied at an annual resolution as total catch in biomass units for the simulation year defaulting to 0 this annual quantity is divided into 12 equal monthly catches as the loss term forcedcatch is not dependent on biomass if the loss would exceed the biomass of a group plus its production in a particular time step b i p i n e t then the removal is set to b i p i n e t this may cause the biomass of the group to crash and prevent the desired catch from being achieved although the desired forcedcatchiy is input with annual resolution catches for later months in the year are not increased to make up for catch shortfalls in earlier months catch removed through gears retains the discard rate of those gears that is the proportion of catch discarded by each gear input into ecopath enters detrital groups according to each gear s detrital fate eq 3 all catch removed through forcedfrate or forcedcatch are considered landings and removed from the system and do not enter a detrital group 26 q i g l a n d c i g l a n d b i 27 q i g d i s c c i g d i s c b i 3 4 other forcing responses in addition to fishing rpath offers several methods of applying time dependent data forcing to an rsim run to account for various sources of environmental variability table 5 in eq 18 forcedmort and forcedmigrate are forcing functions for mortality and migration respectively in eq 20 forcedpred affects the predation rate of a predator across all its prey while in eq 21 forcedprey affects the exposure of prey to all of its predators forcedrec affects the egg production in eq 36 all environmental forcing functions are input with monthly resolution m forcedmort forcedpred forcedprey and forcedrec are non negative multipliers with a default value of 1 0 for all months of the simulation mortality forcing affects both losses by predation and other losses by multiplying forcedmort to the sum of predation consumption as well as m0 eq 18 forcedmigrate is input with monthly resolution as an annualized instantaneous rate units of year 1 it is applied as a loss term so positive values indicate emigration from the system while negative values indicate immigration into the system finally rpath allows the biomass dynamics equations of rsim to be overridden on a species by species level by entering monthly time series of biomass into the forcedbiomass forcing function if forcedbiomass contains a non negative value for species i and time step m the biomass of that group is set equal to the input value for the next time step 3 5 setting the scene rsim scenario while the ecosim equations can be parameterized independently of ecopath the supported use in both ewe and rpath is to use a balanced ecopath model to create an initial ecosim parameter set in rpath the initial parameterization is accomplished using the rsim scenario function fig 2 the initial biomass for each group biomass at t 0 hereafter b i is taken from the balanced biomass of eq 1 ge and m0 are taken from eqs 2 and 9 respectively and fisheries catch is assumed to have a constant ecopath calculated mortality rate eq 8 the parameters for each predator prey functional response q bi bj are set such that if b i b i and b j b j then q b i b j m 2 i j b i d c i j q b j b j b i eq 7 with this parameterization if the ecopath model is balanced all ees 1 0 and all biomass accumulation and or emigration is 0 the system of dynamic equations implied by eq 18 has a stable equilibrium d b i d t 0 for all i at its initial state where all b i b i if biomass accumulation and emigration have a net nonzero value or a group has an ee 1 0 then the derivative d b i d t will be out of equilibrium at b i b i by that amount sub functions of rsim scenario generate default list objects that run the simulations fig 2 the sub function rsim state creates numeric vectors for reference biomasses from the balanced ecopath model numbers for multi stanza groups and foraging time the sub function rsim fishing creates three matrices the first matrix has a number of columns equal to the number of fleets and contains time varying fishing effort by month the other two matrices have a number of columns equal to the number of species groups and a number of rows equal to the length of the simulation in years these two are used for forcedfrate and forcedcatch the sub function rsim forcing generates six matrices corresponding to the remaining forcing functions table 5 each has a number of columns equal to the number of species groups and a number of rows equal to the length of the simulation in months the sub function rsim stanzas generates the parameter list necessary to perform multi stanza calculations unlike the other sub functions a large part of this routine is carrying over the appropriate numbers from the rpath param object rather than default values fig 2 the sub function accounts for the species group codes beginning and end months for each stanza as well as the weight number and consumption at age calculated using the rpath stanzas function it also sets up the base spawning biomass eq 28 and the slope of the adult growth rate eq 29 for eq 29 vbm is the energy required to grow a unit in weight scaled to w from the von bertalanffy equation v b m 1 3 k s p 12 where ksp is divided by 12 to convert from yearly to monthly value 28 b s p a w n w a s w m a t n a s w a s w m a t 29 β a w a 1 v b m w a n a s q a s q s 3 6 adjustment functions while rsim scenario creates a list object that is populated by default values table 6 all of the parameters can be modified for a given scenario users can choose to modify the parameter lists directly but that is not recommended for efficiency the numerical integration is done in c rather than r however r and c index differently which can cause some confusion to compensate all of the vectors and matrices created for the simulations have a leading zero this can make it difficult to determine which value should be modified for a given scenario therefore in order to assist users a series of adjustment functions have been developed fig 2 general parameters generated by rsim params can be adjusted using the function adjust scenario the function adjust fishing can change fishing effort forcedeffort forcedfrate or forcedcatch finally adjust forcing will modify the matrices created by the rsim forcing sub function these functions will ensure that the correct inputs are changed prior to running the simulation more on how to use the adjustment functions can be found in the rsim vignette that accompanies the rpath package 3 7 running rsim the differential equations of the ecosim routine can be numerically integrated using either a 4th order runge kutta rk4 or a two step adams bashforth ab method the time step for the ab method is fixed at one time step per month the rk4 method defaults to four time steps per month but this can be altered by the user the trade off between the two methods is accuracy and speed rk4 requires four derivative calculations per time step fig 3 or with the default time step 16 calculations per month while ab requires one plus the derivative saved from the previous time step fig 4 with a single monthly time step the ab method is too coarse to model rapid seasonal scale changes e g plankton blooms to provide stability for modeling inter annual changes in species with high turnover rates the ab method includes the fast equilibrium method described in walters et al 1997 by default this is used in the ab method for species with a turnover rate greater than once a month as determined by m0bi 24 changes in biomass for those groups are calculated as eq 30 where totalgains are a summation of biomass gained via consumption and totalloss the sum of biomass loss to predation fishing and other sources press et al 2007 offers more details on the two methods 30 b i t 0 5 t o t a l g a i n s t o t a l l o s s b i 0 5 b i t 1 both numerical integration methods use the same underlying sub functions there is a sub function that sums up multi stanza groups to total biomass one that calculates the derivative of the biomass at each time step and one that updates the multi stanza parameters the first sub function splitsetpred sums the biomass consumption and numbers for each multi stanza group at time step t as eqs 31 32 and 33 31 b t a 1 n n a w a 32 q t a 1 n n a q a 33 n t a 1 n n a the sub function deriv vector calculates the change in biomass consumption and fishing at each time step changes in biomass are based on the total gains by a species group offset by the total losses total gains are a sum of the food consumed eq 19 while losses are a combination of predation eq 19 fishing eq 25 energetics respiration and unassimilated food and other losses eq 18 the final sub function of rsim run is splitupdate this sub function updates all of the multi stanza parameters before the next time step the survival rate is updated base on the actual loss of biomass and applied to the abundance at age eq 34 weight at age is updated as eq 35 spawning biomass is then updated as eq 28 abundance of the oldest age group is a sum of the surviving members of the age group and those surviving to the plus group from the previous age group weight at age for the plus group is an average of the previous plus group s weight at age and the updated weight at age for the younger age group all other age groups are updated from the younger age group s survivors and weights finally the relationship between recruits and spawners is determined using eq 36 and scaled in eq 37 34 n a n a e b s l o s s 12 b s 35 w a w a v b m i g e β a 36 e g g b s p s e s x s x 1 b s p b s p f o r c e d r e c 37 n a 1 r s c a l e r 0 e e r p 4 graphical routines one advantage of implementing ewe on the r platform is the ability to take advantage of r s built in graphical engine there are many graphical packages available for r and even the base package can produce publication quality figures we included two built in graphical routines that can be applied to the outputs from the functions rpath and rsim run the first is a function called webplot which uses an rpath obj generated by rpath this creates a foodweb similar to the flow diagrams available in the ewe software fig 5 the second is a function for visualizing the results of rsim simulations called rsim plot fig 6 for more details on how to customize the outputs see the vignettes that are included with the rpath package 5 discussion as ecosystem based fisheries management ebfm moves from the theoretical stage towards implementation the need for flexible modeling tools will increase ecopath with ecosim is a popular tool for ecosystem modelers and offers an open source platform coll et al 2015 heymans et al 2016 steenbeek et al 2015 rpath is the latest extension of the ewe windows software to another code base fortran and matlab versions are also available akoglu et al 2015 kearney and both provide flexibility to extend beyond the traditional scope of the ewe software like those versions our r implementation is not meant to be a replacement to the current ewe software but was developed as a complement rpath provides two services above the standard ewe software reproducibility and adaptability although replication is the gold standard in science it is nearly impossible for ecosystem modeling this common problem facing many computational science fields has led to a call for reproducible research peng 2011 ewe s greatest strength is its easy to use gui but using a complex gui may lead to user error hampering the ability to reproduce the research users can use the base code directly in a script if so desired to avoid this potential pit fall steenbeek et al 2015 likewise r is adept at providing reproducibility because the code needed to run analyses can be stored in a script and made publicly available via services like github allowing reviewers and other researchers the chance to recreate a given model or simulation the streamlined work flow of rpath using a single software platform enhances reproducibility at the 30th anniversary ewe conference in barcelona spain coll et al 2015 several presenters referenced r or one of its packages for some part of their analysis several presenters used an r package called ecotroph which was developed as an ewe add on to conduct trophic network analysis colléter et al 2013 rpath offers users the ability to keep all their analysis in one place rather than switch between software platforms the open source nature of ewe allows for the modification of the code to fit the user s needs rpath expands on the open source nature of the code by porting it to a commonly used computer dialect by ecologists r some of the underlying simulation code is written in c for speed the c code is available for modification but it may require a more advanced programmer to modify fortunately the individual functions within the c code are available within r which allows them to be used independently if so desired the current version of rpath only contains the base functionality of ewe this excludes the spatial module ecospace as well as several more minor features that have been developed over time for specific use cases however with the amount of interest generated by rpath we anticipate community development and expect that more advanced functions of ewe will be coded within the rpath framework considering the flexibility of r new developments can include functionality that is not part of the ewe software for example there is active development on a bayesian estimation approach based on parameter re sampling called ecosense see e g gaichas et al 2015 our goal for this article was to make the rpath code as transparent as possible the future of rpath relies on community development which requires an understanding of the underlying mechanics rpath is not meant for the novice ewe user but to allow more advanced users the opportunity to tailor their models and outputs to their needs r offers a wide range of statistical and graphical packages which can be used to enhance mass balance studies as a community the impetus will be to share advancements to the modeling framework and unlock the full potential of the open source nature of ewe further development of this flexible tool that integrates statistical analysis and visualization tools in one package will be extremely useful in bridging the gap from ecosystem management theory to practice credit authorship contribution statement sean m lucey methodology writing original draft software validation sarah k gaichas methodology writing review editing software kerim y aydin methodology writing review editing software conceptualization declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the authors would like to thank the many beta testers that have pointed out areas to improve the code the original authors of the mass balance algorithims m simpkins s cadrin g fay and m fogarty that provided early edits to the manuscript a whitehouse for assisting in many discussions during package development the noaa integrated ecosystem assessment iea program for travel support during the software development and the two anonymous reviewers supplementary material supplementary material associated with this article can be found in the online version at 10 1016 j ecolmodel 2020 109057 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
24854,ecosystem models are important tools for conducting ecosystem based management a particularly useful method of characterizing the flow of energy through an ecosystem and the subsequent direct and indirect implications of management actions is mass balance modeling here we outline the equations as utilized in rpath an r implementation of the mass balance algorithms popularized by ecopath with ecosim that are designed to work with fisheries data sources we believe that common practices in r will aid in the reproducibility of conducting analysis using a mass balance model as all of the code is contained within a single script file this includes the built in statistical and graphical functions of r in addition to added reproducibility r is a coding language with which ecologists are familiar this familiarity offers greater flexibility for practitioners to tailor the model to their needs we have made the code available on an open software development platform which should aid in continuous community development of the tool keywords ecopath ecosim mass balance reproducibility r rpath 1 introduction mass balance models describe the structure and flow of energy through the system they are commonly used for quantifying food web interactions in a whole ecosystem context the most popular of these models is ecopath which was first developed by polovina 1984 to explain the net primary production required to support a tropical reef system that model has been modified and expanded to fit all types of aquatic and even terrestrial ecosystems fretzer 2014 part of its power is that it makes use of input quantities that are regularly measured in single species resource management such as biomass mortality rates and growth rates that are then placed into the mass balance framework to determine ecosystem unknowns such as lower trophic level productivity ecosim walters et al 1997 uses ecopath models as a basis for parameterizing a set of biomass dynamics differential equations that include functional responses between predators and prey removals by humans hereafter fishing and environmental drivers that may be time varying ecosim is used to conduct dynamic simulations either to explain historical changes in ecosystem structure and function or to predict the direct and indirect effects of both human driven and natural ecosystem perturbations a later iteration of the ecosim equations walters et al 2000 added a method for modeling age specific life stages hereafter stanzas for individual species using delay difference equations in conjunction with the biomass dynamics model to explicitly model recruitment variable growth ontogenetic diet shifts and age based fisheries selectivity ecopath and ecosim are used together in an ecosystem based management context to identify and quantify major energy flows in the system describe ecosystem resources and their interactions evaluate the ecosystem effects of fishing or environmental changes and exploring management policy options plaganyi 2007 a large measure of these tools popularity comes from the development of a user friendly package ecopath with ecosim ewe christensen and pauly 1992 steenbeek et al 2015 ewe has many strengths including ease of use through a convenient graphical user interface gui and the ability to track data quality as an inherent part of ewe data entry further the ewe package includes a wide range of add on tools for calculating ecosystem properties such as cycling diversity and throughput users can input their parameters directly into a spreadsheet or import them from a comma delimitated file modifications can be made within the gui for running simulations however this strength is also a weakness users must take extreme caution to insure that user error is not introduced as running multiple simulations requires users to record the settings for each run it is possible that some modifications may not be saved and therefore limit the reproducibility by other users ewe software is open source and freely available at www ecopath org open source means that there is universal access to the code and that the code can be redistributed or subsequently improved by any interested users steenbeek et al 2015 this allows users to overcome some gui specific issues such as running scripts directly from the base code the base code is built on the microsoft net platform primarily using visual basic many ecologists are familiar with the rapidly growing statistical language r tippmann 2014 it is the software of choice for many scientists who are transitioning from costly platform specific commercial software packages a recent search on elsevier s scopus database showed that one in 100 scholarly articles cite r or one of its packages with even greater citation rates in the agricultural and environmental sciences tippmann 2014 r is available for multiple operating systems and has a rich user community with strong on line support r was the 12th most popular programming language on github a popular version control repository including the most new collaborations per repository which demonstrates that it is being actively used and modified smith 2015 r also boasts a publication quality graphical engine that allows users to generate figures in the same programming environment that they conducted their statistical analyses here we introduce an r implementation of ecopath and ecosim called rpath which is meant to be a complement to the existing ewe software our goals were to develop a flexible tool that would take advantage of the built in graphical and statistical prowess of r and allow for better reproducibility of ecosystem modeling by capturing all changes in a script format meaning analyses can be easily recreated by others furthermore recoding of ecopath and ecosim using r s extensive libraries for linear algebra and matrix manipulation allows for greater readability of the underlying code and greater extensibility by the community of researchers familiar with r rpath includes the mass balance methods of polovina 1984 the biomass dynamics methods walters et al 1997 and the life history stanzas methods walters et al 2000 the mass balance algorithms are implemented using r s linear algebra library the core dynamic simulation derivative and numerical integration routines are implemented using c code based on aydin et al 2007 re written using the rcpp library eddelbuettel and francois 2011 to make use of r s vector operations and transparent coding structure within the c code while allowing the parameter setup and results analysis to be performed seamlessly in the r environment the rsim family of functions within the rpath package this paper is not meant to serve as a user s manual for rpath but rather to describe the mass balance and dynamic simulation algorithms that are implemented in the base library of rpath the r package which can be downloaded at https github com noaa edab rpath includes several vignettes that demonstrate how to run the model 2 mass balance in rpath 2 1 processes of the function rpath ecopath is a system of linear equations that describes the mass balance of an ecosystem there are two master equations that govern the mass balance one that characterizes production and the other consumption production is calculated as the sum of all predation on a group as well as non predatory losses fishing emigration etc while consumption must account for all production as well as unassimilated food and respiration the production equation can be rearranged as eq 1 see christensen and pauly 1992 for full derivation the parameters for ecopath equations are described in table 1 with subscript definitions in table 2 1 b i p b i e e i j 1 n b j q b j d c i j e x i this form of the ecopath master equation allows for the algebraic solution for unknown biomasses b or ecotrophic efficiencies ee rpath unlike the ewe software does not solve for unknown pb or qb on the right hand side of eq 1 is the sum of predator mortality as well as other exports ex from the system these exports include fishery removals biomass accumulation and net migration within the rpath package mass balance is carried out with the rpath family of functions fig 1 with the function rpath executing the solution of the system of equations first it simplifies the list of possible unknown parameters using relationships to other known parameters specifically unknown growth efficiencies ge alternately named pq in some literature for production to consumption are solved using eq 2 2 g e i p b i q b i after the list of unknown parameters is minimized the remaining unknowns are solved using matrix multiplication eq 1 is expressed in the traditional matrix algebra form of ax b where a is an n x n matrix with the diagonal of coefficients either bipbi or pbieei based on which is the unknown parameter and the off diagonal coefficients relating to consumption if the biomass of a predator is unknown x is an n dimensional vector of unknown b or ee and b is an n dimensional vector of mortality terms eq 1 is solved by inverting a using the general inverse function ginv from the mass package venables and ripley 2003 and multiplying by b in addition to calculating unknown b or ee rpath calculates several ancillary parameters these include detrital biomass and ecotrophic efficiency trophic levels and mortality terms detrital biomass and ecotrophic efficiency are not necessary for ecopath but are necessary when transitioning to the dynamic simulation ecosim trophic levels and mortality terms are of general interest to researchers typically detrital biomasses are unknown while detritus groups do not respire or consume anything detritus is consumed in most models therefore it is important to account for how much detritus exists and is used detritus is generated through non mortality loss the unassimilated portions of consumption and fishery discards eq 3 it is subsequently removed via consumption eq 4 knowing both detrital input and output eedt is calculated as detoutputdt detinputdt further if detrital biomass is not provided it is calculated using b d t d e t i n p u t d t p b d t note if pbdt is not provided a default value of 0 5 is used so the default detrital biomass is twice detinputdt 3 d e t i n p u t d t j 1 n d e t f a t e d t j m 0 j b j b j q b j u j k 1 n d e t f a t e d t k j 1 n c j g d i s c 4 d e t o u t p u t d t j 1 n b j q b j d c d t j the trophic levels for ecosystem components are calculated in a similar method to unknown b or ee using matrix algebra the trophic level equation eq 5 is rearranged as eq 6 in this case the matrix notation b is an n dimensional vector of ones the a matrix is a transposed matrix of negative diet composition in the off diagonals with ones in the diagonal rpath then solves for x an n dimensional vector of unknown trophic levels in the case of mixotrophs their diets are renormalized to take into account the proportion of primary production as d c i j d c i j 1 p p i 5 t l j 1 i 1 n t l i d c i j 6 1 i 1 n t l i d c i j t l j t l j 1 the final set of ancillary calculations is the various mortality rates on a species group these include predation mortality m2 fishing mortality f and other mortality m0 predation mortality is calculated as the loss of biomass to a predator divided by the biomass of that prey group eq 7 total catch for each species i and fleet g includes both landings c ig land and discards c ig disc landings and discards are entered separately for each fleet g f for each species is the sum of all catches of that species divided by its biomass eq 8 discards are considered an input to a detritus group as 100 mortality is assumed other mortality accounts for losses outside of the model domain calculated as eq 9 7 m 2 i j d c i j q b j b j b i 8 f i g 1 n c i g l a n d c i g d i s c b i 9 m 0 i p b i 1 e e i 2 2 multistanza groups to account for ontogenetic shifts in species diet and mortality rates rpath includes the ability to parameterize multistanza species groups linking these groups together by simple biomass flow would produce unrealistic dynamics walters et al 1997 as a result a delay difference model is parameterized so that flow between stanzas is based on numbers and biomass although this is more of a concern for dynamic simulations rpath bases the biomass and consumption estimates for all of the stages based on one leading stage the function rpath stanzas will calculate the appropriate fields by calculating the weight at age using the generalized von bertalanffy growth equation eq 10 essington et al 2001 the more common specialized growth equation assumes d 2 3 which creates a carrying capacity parameter ksp that is k 3 ewe uses the specialized version of the growth equation so for consistency rpath stanzas takes ksp as the parameter and converts to k within the code as with the general ecopath equations parameter definitions for stanza equations can be found in table 3 10 w a w 1 e k 1 d t t 0 1 1 d assuming a stable age distribution b and qb for all non leading stanzas are calculated using the proportion of the population at age a as eq 11 where la is the population growth rate corrected survivorship eq 12 christensen and walters 2004 the relative biomass of the population in stanza s is calculated as the proportion of survivors within stanza s to the entire age structure eq 13 christensen and walters 2004 ewe calculates amax the maximum age at 0 9 w and accounts for the additional biomass in a plus group we decided that calculation was unnecessary with the current computing power and decided to calculate it at 0 99 w 11 a a 0 n a l a a 0 n l a 12 l a e a z a a b a b 13 b s a a s min a s max l a w a a 1 a max l a w a once the proportional biomass for each stanza is determined the biomass is calculated using the leading stanza first the total biomass for the complex is calculated as eq 14 then the trailing stanza groups biomasses are calculated as eq 15 consumption for each stanza is calculated in a similar way using the consumption by weight assumption of eq 16 instead of wa in eq 13 consumption is then substituted in for biomass in the calculations of total consumption for the complex eq 14 and consumption for trailing stanza groups eq 15 14 b m s b l e a d i n g s b l e a d i n g s 15 b s b s b m s 16 q a w a d although not used in the mass balance portion of rpath rpath stanzas also calculates the abundance at age for each stanza group to be used in dynamic simulations abundance at age is based on the relative contribution of recruits by the leading stanza eq 17 actual numbers are calculated as n a r i l a 17 r i b l e a d i n g a a l e a d i n g min a l e a d i n g max l a w a 3 dynamic simulations in rpath 3 1 from path to rates rsim the static snap shot provided by the ecopath equations was initially extended to dynamic simulations ecosim by walters et al 1997 with later modifications described in walters et al 2000 and christensen and walters 2004 as incorporated into ewe ecosim describes the dynamics of the ecosystem as a set of ordinary differential equations governing the change in the biomass of each group over time and are implemented in rpath as the rsim family of functions similar to the rpath and multistanza parameters the parameters for the rsim functions can be found in table 4 for each living non detrital group the governing equation is 18 d b i d t 1 a i u i j q b i b j f o r c e d m o r t i m j q b j b i m 0 i b i f o r c e d m i g r a t e i m b i c m b i where q bi bj is the predator prey functional response between group i and group j described in eq 19 and cm bi is the time dependent fisheries induced mortality function described in eq 25 ai and ui are energetic loss terms specified as a fraction of total consumption representing active respiration loss and unassimilated food respectively by default 1 a i u i is equal to the ecopath growth efficiency ge eq 2 the active respiration portion of consumption is considered lost to the system while the unassimilated portion is gained by detrital groups in proportion to each living group s ecopath detrital fate eq 3 m0 i is a mortality term for other mortality with a default value calculated from ecopath eq 9 the total biomass lost from a living group due to other mortality also enters detritus according to the group s detrital fate forcedmortim and forcedmigrateim are forcing functions described further in section 3 4 3 2 predator prey responses for the predator prey functional response q bi bj rpath uses an alternate form of the walters et al 1997 consumption equation derived in aydin 2004 in order to better relate the functional form to fitting and uncertainty analysis e g gaichas et al 2011 gaichas et al 2012 the formulation separates density dependent effects for predator j and prey i using 19 q b i b j q i j v i j y p r e d j v i j 1 1 s i j y p r e d j s i k α k j y p r e d k d i j y p r e y i θ i j d i j 1 1 h i j y p r e y i h i k β i k y p r e y k θ i j the state variables in eq 19 are contained in the terms ypred and yprey that represent each species foraging activity as predator and prey respectively these are calculated as ratios with respect to set reference levels 20 y p r e d j f o r c e d p r e d j m f t i m e j b j b j 21 y p r e y i f o r c e d p r e d i m f t i m e i b i b i ftimei is a state variable that has an initial condition of 1 0 and does not change unless the foraging time adjustment parameter fadji is nonzero therefore at ecopath equilibrium ypred and yprey are equal to 1 so that eq 19 reduces to q b i b j q i j forcedpred is a forcing function explained in more detail in section 3 4 primary producers are modeled as predators using eq 19 but with ypreyi i e sunlight fixed at 1 0 therefore the self saturation of phytoplankton group j is set through vij 22 f t i m e i m 1 0 1 0 9 f t i m e i m 1 f a d j i q b i q b i m 1 changes in ftime are made on a monthly time step m using the difference eq 22 where q b i is the reference consumption to biomass ratio from ecopath by default and qbim is the predator s current total consumption summed across all prey eq 19 divided by its current biomass walters and kitchell 2001 importantly for comparison in rpath the default for fadji is 0 while in ewe the default is 0 5 leading to differences in results when using the default assumptions from respective implementations the higher value will result in a smaller magnitude perturbation as species groups consume more to mitigate their losses in eq 19 q i j is the reference consumption rate consumption flow from prey i to predator j vij is the main vulnerability parameter input into ecosim to account for predator density dependent foraging xij in the original derivation of walters et al 1997 and dij is the handling time parameter accounting for prey density dependence predator saturation the range of vij and dij is 1 for practical use values 1000 are indistinguishable from infinity the default value for vij is 2 0 while the default value for dij is 1000 table 6 θij controls the shape of the prey density dependent response with a value of 1 0 default resulting in a holling type ii functional response and a value of 2 0 representing a holling type iii response though θij is not restricted to integer values the parameters sij and hij are flags that control whether the predator density dependence sij or prey density dependence hij are affected solely by the biomass levels of the particular predator and prey or whether a suite of other species biomasses in similar roles impact the relationship for the default value for sij of 0 off the predator density dependence is only a function of that predator biomass and likewise for prey with the default value of 0 for hij values greater than 0 allow for a density dependent effects to be affected by a weighted sum across all species for predators eq 23 and for prey eq 24 the weights αkj and βkj are normalized such that the sum for each functional response i e k αkj and k βkj for the functional response between predator j and prey i sum to 1 the weights are calculated from the density independent search rates for each predator prey pair aij terms in walters et al 1997 which is equal to 2 q i j v i j v i j 1 b i b j 23 p r e d s u i t e k α k j y p r e d k 24 p r e y s u i t e k β i k y p r e y k 3 3 fishing responses a primary use of ecosim is to simulate both the direct and indirect effects of fishing on ecosystem biomasses eq 25 offers multiple ways to specify time specific catch 25 c m b i g 1 n q i g l a n d e g m b i g 1 n q i g d i s c e g m b i f o r c e d f r a t e i m b i min f o r c e d c a t c h i y 12 b i p i n e t here q ig land and q ig disc are calculated for each fleet g by assuming that egm is 1 0 in ecopath equilibrium so that q is calculated from ecopath catches as eqs 26 and 27 the gear effort egm can be supplied by the user at a monthly resolution m and defaults to 1 0 forcedfrateim is an additional instantaneous fishing mortality rate defaulting to 0 that can be applied to a functional group independently of gear type while forcing rates are input at a monthly resolution the units are annual year 1 an additional absolute loss term forcedcatchiy can be further supplied at an annual resolution as total catch in biomass units for the simulation year defaulting to 0 this annual quantity is divided into 12 equal monthly catches as the loss term forcedcatch is not dependent on biomass if the loss would exceed the biomass of a group plus its production in a particular time step b i p i n e t then the removal is set to b i p i n e t this may cause the biomass of the group to crash and prevent the desired catch from being achieved although the desired forcedcatchiy is input with annual resolution catches for later months in the year are not increased to make up for catch shortfalls in earlier months catch removed through gears retains the discard rate of those gears that is the proportion of catch discarded by each gear input into ecopath enters detrital groups according to each gear s detrital fate eq 3 all catch removed through forcedfrate or forcedcatch are considered landings and removed from the system and do not enter a detrital group 26 q i g l a n d c i g l a n d b i 27 q i g d i s c c i g d i s c b i 3 4 other forcing responses in addition to fishing rpath offers several methods of applying time dependent data forcing to an rsim run to account for various sources of environmental variability table 5 in eq 18 forcedmort and forcedmigrate are forcing functions for mortality and migration respectively in eq 20 forcedpred affects the predation rate of a predator across all its prey while in eq 21 forcedprey affects the exposure of prey to all of its predators forcedrec affects the egg production in eq 36 all environmental forcing functions are input with monthly resolution m forcedmort forcedpred forcedprey and forcedrec are non negative multipliers with a default value of 1 0 for all months of the simulation mortality forcing affects both losses by predation and other losses by multiplying forcedmort to the sum of predation consumption as well as m0 eq 18 forcedmigrate is input with monthly resolution as an annualized instantaneous rate units of year 1 it is applied as a loss term so positive values indicate emigration from the system while negative values indicate immigration into the system finally rpath allows the biomass dynamics equations of rsim to be overridden on a species by species level by entering monthly time series of biomass into the forcedbiomass forcing function if forcedbiomass contains a non negative value for species i and time step m the biomass of that group is set equal to the input value for the next time step 3 5 setting the scene rsim scenario while the ecosim equations can be parameterized independently of ecopath the supported use in both ewe and rpath is to use a balanced ecopath model to create an initial ecosim parameter set in rpath the initial parameterization is accomplished using the rsim scenario function fig 2 the initial biomass for each group biomass at t 0 hereafter b i is taken from the balanced biomass of eq 1 ge and m0 are taken from eqs 2 and 9 respectively and fisheries catch is assumed to have a constant ecopath calculated mortality rate eq 8 the parameters for each predator prey functional response q bi bj are set such that if b i b i and b j b j then q b i b j m 2 i j b i d c i j q b j b j b i eq 7 with this parameterization if the ecopath model is balanced all ees 1 0 and all biomass accumulation and or emigration is 0 the system of dynamic equations implied by eq 18 has a stable equilibrium d b i d t 0 for all i at its initial state where all b i b i if biomass accumulation and emigration have a net nonzero value or a group has an ee 1 0 then the derivative d b i d t will be out of equilibrium at b i b i by that amount sub functions of rsim scenario generate default list objects that run the simulations fig 2 the sub function rsim state creates numeric vectors for reference biomasses from the balanced ecopath model numbers for multi stanza groups and foraging time the sub function rsim fishing creates three matrices the first matrix has a number of columns equal to the number of fleets and contains time varying fishing effort by month the other two matrices have a number of columns equal to the number of species groups and a number of rows equal to the length of the simulation in years these two are used for forcedfrate and forcedcatch the sub function rsim forcing generates six matrices corresponding to the remaining forcing functions table 5 each has a number of columns equal to the number of species groups and a number of rows equal to the length of the simulation in months the sub function rsim stanzas generates the parameter list necessary to perform multi stanza calculations unlike the other sub functions a large part of this routine is carrying over the appropriate numbers from the rpath param object rather than default values fig 2 the sub function accounts for the species group codes beginning and end months for each stanza as well as the weight number and consumption at age calculated using the rpath stanzas function it also sets up the base spawning biomass eq 28 and the slope of the adult growth rate eq 29 for eq 29 vbm is the energy required to grow a unit in weight scaled to w from the von bertalanffy equation v b m 1 3 k s p 12 where ksp is divided by 12 to convert from yearly to monthly value 28 b s p a w n w a s w m a t n a s w a s w m a t 29 β a w a 1 v b m w a n a s q a s q s 3 6 adjustment functions while rsim scenario creates a list object that is populated by default values table 6 all of the parameters can be modified for a given scenario users can choose to modify the parameter lists directly but that is not recommended for efficiency the numerical integration is done in c rather than r however r and c index differently which can cause some confusion to compensate all of the vectors and matrices created for the simulations have a leading zero this can make it difficult to determine which value should be modified for a given scenario therefore in order to assist users a series of adjustment functions have been developed fig 2 general parameters generated by rsim params can be adjusted using the function adjust scenario the function adjust fishing can change fishing effort forcedeffort forcedfrate or forcedcatch finally adjust forcing will modify the matrices created by the rsim forcing sub function these functions will ensure that the correct inputs are changed prior to running the simulation more on how to use the adjustment functions can be found in the rsim vignette that accompanies the rpath package 3 7 running rsim the differential equations of the ecosim routine can be numerically integrated using either a 4th order runge kutta rk4 or a two step adams bashforth ab method the time step for the ab method is fixed at one time step per month the rk4 method defaults to four time steps per month but this can be altered by the user the trade off between the two methods is accuracy and speed rk4 requires four derivative calculations per time step fig 3 or with the default time step 16 calculations per month while ab requires one plus the derivative saved from the previous time step fig 4 with a single monthly time step the ab method is too coarse to model rapid seasonal scale changes e g plankton blooms to provide stability for modeling inter annual changes in species with high turnover rates the ab method includes the fast equilibrium method described in walters et al 1997 by default this is used in the ab method for species with a turnover rate greater than once a month as determined by m0bi 24 changes in biomass for those groups are calculated as eq 30 where totalgains are a summation of biomass gained via consumption and totalloss the sum of biomass loss to predation fishing and other sources press et al 2007 offers more details on the two methods 30 b i t 0 5 t o t a l g a i n s t o t a l l o s s b i 0 5 b i t 1 both numerical integration methods use the same underlying sub functions there is a sub function that sums up multi stanza groups to total biomass one that calculates the derivative of the biomass at each time step and one that updates the multi stanza parameters the first sub function splitsetpred sums the biomass consumption and numbers for each multi stanza group at time step t as eqs 31 32 and 33 31 b t a 1 n n a w a 32 q t a 1 n n a q a 33 n t a 1 n n a the sub function deriv vector calculates the change in biomass consumption and fishing at each time step changes in biomass are based on the total gains by a species group offset by the total losses total gains are a sum of the food consumed eq 19 while losses are a combination of predation eq 19 fishing eq 25 energetics respiration and unassimilated food and other losses eq 18 the final sub function of rsim run is splitupdate this sub function updates all of the multi stanza parameters before the next time step the survival rate is updated base on the actual loss of biomass and applied to the abundance at age eq 34 weight at age is updated as eq 35 spawning biomass is then updated as eq 28 abundance of the oldest age group is a sum of the surviving members of the age group and those surviving to the plus group from the previous age group weight at age for the plus group is an average of the previous plus group s weight at age and the updated weight at age for the younger age group all other age groups are updated from the younger age group s survivors and weights finally the relationship between recruits and spawners is determined using eq 36 and scaled in eq 37 34 n a n a e b s l o s s 12 b s 35 w a w a v b m i g e β a 36 e g g b s p s e s x s x 1 b s p b s p f o r c e d r e c 37 n a 1 r s c a l e r 0 e e r p 4 graphical routines one advantage of implementing ewe on the r platform is the ability to take advantage of r s built in graphical engine there are many graphical packages available for r and even the base package can produce publication quality figures we included two built in graphical routines that can be applied to the outputs from the functions rpath and rsim run the first is a function called webplot which uses an rpath obj generated by rpath this creates a foodweb similar to the flow diagrams available in the ewe software fig 5 the second is a function for visualizing the results of rsim simulations called rsim plot fig 6 for more details on how to customize the outputs see the vignettes that are included with the rpath package 5 discussion as ecosystem based fisheries management ebfm moves from the theoretical stage towards implementation the need for flexible modeling tools will increase ecopath with ecosim is a popular tool for ecosystem modelers and offers an open source platform coll et al 2015 heymans et al 2016 steenbeek et al 2015 rpath is the latest extension of the ewe windows software to another code base fortran and matlab versions are also available akoglu et al 2015 kearney and both provide flexibility to extend beyond the traditional scope of the ewe software like those versions our r implementation is not meant to be a replacement to the current ewe software but was developed as a complement rpath provides two services above the standard ewe software reproducibility and adaptability although replication is the gold standard in science it is nearly impossible for ecosystem modeling this common problem facing many computational science fields has led to a call for reproducible research peng 2011 ewe s greatest strength is its easy to use gui but using a complex gui may lead to user error hampering the ability to reproduce the research users can use the base code directly in a script if so desired to avoid this potential pit fall steenbeek et al 2015 likewise r is adept at providing reproducibility because the code needed to run analyses can be stored in a script and made publicly available via services like github allowing reviewers and other researchers the chance to recreate a given model or simulation the streamlined work flow of rpath using a single software platform enhances reproducibility at the 30th anniversary ewe conference in barcelona spain coll et al 2015 several presenters referenced r or one of its packages for some part of their analysis several presenters used an r package called ecotroph which was developed as an ewe add on to conduct trophic network analysis colléter et al 2013 rpath offers users the ability to keep all their analysis in one place rather than switch between software platforms the open source nature of ewe allows for the modification of the code to fit the user s needs rpath expands on the open source nature of the code by porting it to a commonly used computer dialect by ecologists r some of the underlying simulation code is written in c for speed the c code is available for modification but it may require a more advanced programmer to modify fortunately the individual functions within the c code are available within r which allows them to be used independently if so desired the current version of rpath only contains the base functionality of ewe this excludes the spatial module ecospace as well as several more minor features that have been developed over time for specific use cases however with the amount of interest generated by rpath we anticipate community development and expect that more advanced functions of ewe will be coded within the rpath framework considering the flexibility of r new developments can include functionality that is not part of the ewe software for example there is active development on a bayesian estimation approach based on parameter re sampling called ecosense see e g gaichas et al 2015 our goal for this article was to make the rpath code as transparent as possible the future of rpath relies on community development which requires an understanding of the underlying mechanics rpath is not meant for the novice ewe user but to allow more advanced users the opportunity to tailor their models and outputs to their needs r offers a wide range of statistical and graphical packages which can be used to enhance mass balance studies as a community the impetus will be to share advancements to the modeling framework and unlock the full potential of the open source nature of ewe further development of this flexible tool that integrates statistical analysis and visualization tools in one package will be extremely useful in bridging the gap from ecosystem management theory to practice credit authorship contribution statement sean m lucey methodology writing original draft software validation sarah k gaichas methodology writing review editing software kerim y aydin methodology writing review editing software conceptualization declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the authors would like to thank the many beta testers that have pointed out areas to improve the code the original authors of the mass balance algorithims m simpkins s cadrin g fay and m fogarty that provided early edits to the manuscript a whitehouse for assisting in many discussions during package development the noaa integrated ecosystem assessment iea program for travel support during the software development and the two anonymous reviewers supplementary material supplementary material associated with this article can be found in the online version at 10 1016 j ecolmodel 2020 109057 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
