index,text
50,in this study we investigate the impact of pore space deformation on various trapping mechanisms of supercritical co2 scco2 relevant to storage of co2 in deep saline aquifers a series of unsteady state two phase brine scco2 drainage imbibition and dissolution tests were performed on a miniature sandpack sample under various stress conditions high resolution x ray microtomography techniques were employed to acquire the pore and fluid occupancy maps at each step of the experiment which were subsequently utilized to characterize the pore space deformation and changes in the frequencies of various pore scale fluid displacement events our results revealed that during the scco2 injection stage additional scco2 was stored in the sandpack sample after the sandpack was compressed due to an increase in the pressure gradient even though the pore volume had decreased on the other hand the capillary trapping was impaired by the pore space contraction because all the imbibition displacement mechanisms at the pore scale including the piston like advance and snap off were facilitated as a consequence of an increase in their threshold capillary pressures the increased frequency of snap off events caused additional trapping but more importantly displaced scco2 from throats by fragmenting large residual scco2 clusters into smaller globules during the dissolution process the trapped scco2 clusters and globules shrank in both pore bodies and throats resulting in movement of the main terminal meniscus mtm interfaces and snap off events respectively the water relative permeability during the dissolution process decreased at a fixed saturation with the increase in the effective stress since the small pores occupied by the water phase deformed more significantly than the large pores keywords geological co2 sequestration pore space deformation capillary trapping pore scale displacement physics x ray microtomography data availability data will be made available on request 1 introduction carbon dioxide co2 emissions as one of the main causes of global warming have received broad attention due to their adverse impacts on the climate davis et al 2010 the increase in earth s temperature causes a series of environmental issues such as the melting of the polar ice stirling and derocher 2012 rise of sea level raper and braithwaite 2006 and increase in the frequency and intensity of droughts and floods vicente serrano et al 2020 mousavi et al 2011 moreover ocean acidification can be triggered directly by increased concentration of co2 in the atmosphere which may disturb the marine ecosystem such as marine biodiversity and biophysiology pandolfi et al 2011 alfonso et al 2021 pistevos et al 2015 in other words anthropogenic co2 emissions adversely impact balance of nature and thereby numerous interconnected aspects of human life to mitigate co2 emissions the most practical and effective option is carbon capture and storage ccs pires et al 2011 haszeldine 2009 ccs refers to a number of technologies utilized for separating co2 during different stages of the industrial process e g post combustion pre combustion and oxyfuel combustion transporting it to a storage location stable geological formation or ocean and isolating it from the atmosphere for a long period boot handford et al 2014 metz et al 2005 it is believed that ccs can within expected technological limitations reduce 20 40 of global co2 emissions by 2050 metz et al 2005 the co2 storage technologies mainly involve geological storage ocean storage and mineral carbonation among these scenarios geological storage which refers to the injection of co2 into a stable geological formation is economically more viable allinson et al 2003 anderson 2017 akimoto et al 2007 this could be further classified into three main categories based on the types of geological formations 1 oil reservoirs 2 unmineable coal seams and 3 deep saline aquifers the third category is considered to have the largest storage capacity metz et al 2005 bui et al 2018 as co2 is injected into saline aquifers it usually retains a supercritical state due to the high pressure and high temperature conditions caused by the geological formation s depth under these conditions the fluid has a liquid like density that establishes the potential to efficiently utilize the underground storage space bickle 2009 supercritical co2 scco2 plumes tend to migrate upward in aquifers due to buoyancy at this stage the sealing cap at the top of the aquifer such as a low permeability layer or a fault serves as a barrier that prevents it from leaking into the atmosphere szulczewski et al 2013 in the meantime imbibition occurs at the tail of the scco2 plume due to favorable pressure fields developed by the aforementioned upward movement as a consequence a portion of the scco2 becomes hydraulically disconnected due to the capillary trapping phenomenon pentland et al 2011 s krevor et al 2015 since the trapped scco2 is immobile capillary trapping is considered to be one of the most significant short term trapping mechanisms in geological storage of scco2 uc bandara et al 2011 in the last decades multiple experimental and simulation studies have been conducted to characterize multiphase flow and trapping of co2 at macro and micro scales akbarabadi and piri 2013 andrew et al 2013 gershenzon et al 2017 it was discovered that capillary trapping of scco2 was governed by the wettability of porous media hu et al 2017 øren et al 2019 moreover the displacement patterns and the amount of trapped scco2 depended on capillary and bond numbers uc bandara et al 2011 it was also reported by chaudhary et al 2013 that the angularity of grains can significantly affect the capillary trapping of scco2 in saline aquifers in addition dissolution of scco2 in the aqueous phase serves as one of the main long term trapping mechanisms akbarabadi and piri 2013 soltanian et al 2017 agartan et al 2015 once scco2 is dissolved into the brine it migrates with the flow of the brine and is unlikely to recover to a separate phase and be released into the atmosphere again dissolution of scco2 was often assumed to be instantaneous in numerical modeling pruess and spycher 2007 zhou et al 2010 however recent macro and micro scale experimental studies have shown a prolonged depletion of residual scco2 by dissolution akbarabadi and piri 2013 berg et al 2013 chang et al 2016 this is mainly because the mass transfer rate between the residual scco2 and displacing water decreases as residual scco2 clusters dissolve chang et al 2014 as a consequence the maximum mass fraction of dissolved scco2 in displacing water was merely approximately 2 to 13 of co2 solubility depending on the pore heterogeneity and flow rate chang et al 2019 in the previous co2 geosequestration studies one of the factors that is often neglected is the pore space expansion caused by the rising pore pressure during injection as a consequence not only the total pore volume of the aquifer but also the displacement threshold capillary pressures which govern the displacement efficiency during co2 injection and subsequent imbibition s krevor et al 2015 may change hence the co2 volume that can be stored in aquifers may be significantly different from what is expected moreover the water flow behavior during the dissolution process may also be affected by variations in the water hydraulic conductivity hence it is essential to investigate the impact of the pore space deformation on various geological storage mechanisms during co2 geosequestration to this end we performed a series of unsteady state two phase brine and supercritical co2 drainage imbibition and co2 dissolution experiments on a miniature sandpack under various stress conditions these respectively represented the fluid displacements that occur during supercritical co2 scco2 injection imbibition at the tail of the scco2 plume and dissolution in deep saline aquifers the pore and fluid occupancy maps at each step of the experiment were imaged using a high resolution micro ct scanner and then utilized for characterizing the deformation of the pore space and changes in the frequencies of various fluid displacement events variations in the local fluid pressure were evaluated by direct simulation which used a finite volume method to solve navier stokes equations mostaghimi et al 2013 zakirov and galeev 2019 zhang et al 2019 moreover we characterized dissolution of trapped scco2 in water at the pore scale by comparing the fluid configurations imaged at different dissolution stages we also measured the water relative permeability during dissolution under different stress conditions the remaining sections of this paper are devoted to first introducing the sample fluids and experimental apparatus and procedure utilized in the core flooding tests this is followed by a description of the data acquisition processing and analysis techniques afterward the main findings of the experiments are reported and discussed in detail finally the paper is concluded with a summary of the findings 2 experiments 2 1 rock sample fluids and experimental conditions to establish a measurable pore space deformation under limited experimental pressure a cement free sandpack with a diameter of 10 mm and a length of 75 mm was created and used in the core flooding experiments it was specially designed and constructed according to the sandpack preparation method reported by wang et al 2022 the sandpack was a mixture that consisted of 17 48 21 7 and 7 wt of 60 70 80 100 and 140 mesh respectively high roundness and high sphericity northern white monocrystalline sands 100 sio2 this aimed at mimicking the grain size distribution of the berea sandstone wang et al 2022 so that the sample was representative of natural unconsolidated sandstones once the sands were well mixed the pack was densified by being subjected to vibration for three hours by controlling vibration time and the mixture composition we were able to build a homogenous sandpack sample with desired porosity and permeability before being transported to a miniature core holder the sandpack was partially saturated with distilled water through the spontaneous imbibition process and then frozen in liquid nitrogen to maintain its properties the aqueous phase used in the two phase core flooding experiment was a 2 wt nacl brine solution tagged with 4 wt nai nai was added into the brine to enhance its contrast with the carbon dioxide in the micro ct images by increasing the energy attenuation of the x ray in the aqueous phase since the brine solution s grayscale intensity on the images appeared to be similar to that of the sand grains it was replaced by a brine containing only 2 wt nacl before we acquired a reference scan to map the pore space for brevity the brine solutions with and without nai are labeled as doped and non doped respectively in the following sections the co2 phase was maintained at a supercritical state 1250 psig 8 7 mpa and 50 c throughout the experiments before the core flooding experiments were commenced the doped brine and the scco2 were circulated bypassing the core holder while being supplied from a 1300 cc hastelloy cell this step was incorporated into the experimental procedure to equilibrate the two fluids and thereby mitigate any dissolution exsolution of scco2 during the drainage and imbibition tests the properties of the doped brine and scco2 used in this study are estimated from the experimental data provided by kestin et al 1981 and bachu and bennion 2009 respectively table 1 2 2 experimental apparatus a high temperature and high pressure core flooding system integrated with a high resolution x ray micro ct scanner were employed to conduct the flow experiments fig 1 compared to conventional two phase core flooding systems this apparatus included a bypass loop and an equilibration cell that were utilized for equilibrating the fluids before the experiments to this end a compensation pump was connected to the equilibration cell to replenish the scco2 and make up for the pressure decline caused by scco2 dissolution in brine liquid co2 was supplied from a cylinder and subsequently passed through a secondary equilibration cell that contained brine before it was further pressurized and injected by the compensation pump into the primary equilibration cell this pre equilibration process allowed for the fluids to establish an equilibration state in a shorter amount of time during the core flooding experiments the equilibrated brine and scco2 stored in the primary equilibration cell were injected into the core sample at constant flow rates by two individual quizix pumps with flow rate range and resolution of 0 000031 to 15 cc min and 0 000001 cc min respectively the effluent was collected at constant pressure by the back pressure regulation pump and discharged into a semi enclosed glassware the compensation pump continued its operation to make up for scco2 injection and maintain the pressure in the primary equilibration cell with absolute pressure measurement range and accuracy of 0 to 10 000 psi and 0 1 psi respectively two more pumps applied the radial and axial stresses to establish hydrostatic stress conditions meanwhile pressure drops were recorded by rosemount differential pressure transducers with the differential pressure measurement range and accuracy of 0 to 250 inch of water inh2o and 0 01 inh2o respectively to maintain the supercritical state of co2 all the core flooding components except for the liquid co2 cylinder and core holder were set in an oven with a constant temperature of 50 c the tubing and the core holder in the micro ct scanner were properly heated and insulated by heating and insulation tapes the pumps differential pressure transducers liquid co2 cylinder and equilibration cells were all connected by corrosion resistant hastelloy tubing whereas flexible peek tubing was used in the micro ct scanner to eliminate the torque applied on the core holder due to its rotation during the scanning process the high resolution heliscan x ray micro ct scanner manufactured by thermo fisher scientific was comprised of an x ray source a high voltage power supply a sample stage and a large area x ray detector a series of x ray projections of the sample was collected at pre defined rotation angles during the experiments these projection images were further reconstructed using a supercomputer to generate three dimensional pore and fluid occupancy maps 2 3 experimental procedure after the frozen sample was transferred into a core holder the entire assembly was vertically mounted on the sample stage of the micro ct scanner and connected to other core flooding components the core holder was left in place for several hours until it thawed completely at this stage gaseous co2 was injected at 30 psig 0 31 kpa to dry the core sample and simultaneously displace the air left in the pore space subsequently the assembly was vacuumed overnight and fully saturated with brine once 100 water saturation was confirmed at multiple locations by rapid scans the pore and confining pressures were gradually increased to 1250 and 1400 psig 8 7 and 9 8 mpa respectively at this stage we measured the initial absolute permeability by recording the pressure drop at various brine flow rates and calculated the image based porosity by performing a reference scan after displacing the doped brine with its non doped counterpart finally the non doped brine was replaced by the doped solution before conducting the two phase flow tests it is worth noting that the sandpack sample was saturated with the doped brine after being vacuumed this guaranteed that all the dead volumes and the tubing were filled with doped brine as well otherwise brine scco2 interfaces may become blurry in the x ray images obtained during the core flooding experiments due to diffusion caused by the difference in the iodide ion concentration in the dead volumes and the pore space to investigate the impacts of pore space deformation induced by the injection of scco2 on stratigraphic and capillary trapping of the fluid in deep saline aquifers we conducted a series of drainage and imbibition tests under various stress conditions to eliminate any interference caused by changes in the fluid properties such as the density viscosity and interfacial tension the effective stress was adjusted by changing the confining pressure and maintaining the pore pressure constant berg et al 2013 michels et al 1957 fenghour et al 1998 since the pore space deformation would be less prominent if the sandpack had deformed plastically the two phase flow tests were first carried out at low and then at high effective stresses during the experiments 15 pore volumes pvs of scco2 were injected into the sandpack at a constant flow rate of 1 2cc min capillary number nca 5 39 10 7 afterward 15 pvs of chase brine were injected at a flow rate of 0 05 cc min to mimic imbibition at the tail of the scco2 plume the low brine flow rate guaranteed that the imbibition occurred under a capillary dominated flow regime capillary number nca 5 87 10 7 lenormand et al 1988 lenormand et al 1989 this was followed by a bump test during which another 5 pvs brine was injected at 0 07 cc min capillary number nca 8 22 10 7 to examine if any additional scco2 would be produced at this stage the scco2 that remained in the pore space was considered hydraulically disconnected and trapped subsequently we gradually dissolved the trapped scco2 by injecting undersaturated brine while measuring the relative permeability of the aqueous phase by recording the pressure drop across the core sample at the flow rates of 0 05 to 0 2 cc min capillary number nca 5 39 10 7 to 2 35 10 6 during the dissolution process configurations of shrinking trapped globules of scco2 were imaged at multiple steps a chemical solution comprised of 50 isopropanol and 50 methanol which had a much larger co2 solubility compared to water was injected into the sandpack sample to accelerate the scco2 dissolution the chemical that remained in the pore space was then miscibly displaced by the doped brine once a 100 water saturation was confirmed by absolute permeability measurements and quick scans at multiple locations the sandpack was compressed by gradually increasing the hydrostatic confining pressure to 3400 psig 23 5 mpa after the compression the drainage imbibition and dissolution tests were repeated with the same flow rates and the new fluid occupancy images acquired at each step were compared with their counterparts obtained before the compression the detailed experimental procedure is illustrated in fig 2 3 image acquisition and processing during the core flooding experiments two groups of scans were conducted the imaging parameters are listed in table 2 the first was a succession of rapid monitoring scans once two successive fluid occupancy maps acquired by these scans were similar we considered that the sandpack sample and the fluids in the pore space had reached a steady state condition the second group was the main scans that were utilized for accurately maping and quantifying the volume of each phase after the steady state condition had been established based on the objectives they could be further divided into reference scans which were used to measure the properties of the pore space and the two phase scans for measuring fluid saturations and characterizing the in situ wettability and pore scale fluid displacements during the main scans the detector collected 5 projection images frame to average 5 at each pre designed angle these were subsequently merged into one single projection image to eliminate the noise that was randomly posed during the scans after being reconstructed by a supercomputer the images were pre processed and analyzed using the avizo software purswani et al 2020 non local means and median filters were first applied to remove the internal noise in each phase and sharpen the fluid fluid and fluid solid interfaces the images acquired by the reference scans were then segmented using the interactive thresholding function to distinguish the pore space from the solid due to the similar grayscale intensities it was challenging to directly segment the sand grains and the doped brine in the fluid occupancy maps therefore we registered the fluid occupancy maps and the reference scan images and then multiplied the intensities of the former by those of the segmented pore map using this approach the intensity of the sand grains became zero and only the scco2 and doped brine phases remained in the images which then could be directly segmented using the interactive thresholding function finally the segmented brine scco2 and solid phases were represented by blue yellow and gray colors respectively and combined into one image for analysis by counting the voxels of each phase the image based porosity and fluid saturation could be calculated 4 results and discussion 4 1 pore space deformation as the effective stress was increased from 150 to 2 150 psi 1 to 14 8 mpa the image based porosity and the absolute permeability of the sandpack sample decreased from 0 32 and 7 82 d to 0 30 and 5 00 d respectively the reduction in the porosity was constant along the axial direction of the sample indicating that the sandpack deformed uniformly fig 3 at the micro scale as seen in fig 4 adjoining grain particles approached each other with negligible rotation as the effective stress increased consequently the pore volume was reduced and a portion of the throats were completely closed due to their smaller sizes areas bounded by rectangles in fig 4 compared to the pore space contraction the deformation of individual solid grains was negligible since the sandpack was relatively loosely packed hu and rutqvist 2020 and the quartz had an extremely large young s modulus brace and walsh 1962 to quantify the pore space deformation we computed a series of pore space properties under different effective stress conditions by extracting ball stick pore network models in which balls and sticks represent pore bodies and throats respectively from the segmented pore maps using the maximal ball algorithm silin and patzek 2006 as listed in table 3 the diameters of both pore bodies and throats decreased approximately by 5 um as the effective stress was increased from 150 to 2 150 psi 1 to 14 8 mpa this could be attributed to the earlier finding that the sandpack deformation was mainly governed by grain displacement rather than grain rotation as seen from the pore and throat size distribution curves fig 5 different pore elements showed similar deformation magnitude however the contractions of the throats were relatively more pronounced than those of the pore bodies due to their smaller initial sizes as a consequence approximately 4 of the throats were closed as the effective stress increased whereas the count of the pore bodies was negligibly affected resulting in a slight reduction in the coordination number for the same reason the average aspect ratio i e the average of the ratio of the equivalent pore diameter to the equivalent throat diameter increased after the compression the different relative deformation degrees of the throats and pore bodies indicated that the hydraulic conductivity to the wetting phase i e water which mainly occupied the small pore elements such as throats corners and crevices could be more significantly impaired by the compression than that to the non wetting phase i e scco2 residing at the center of the large pores wang et al 2022 hence we can anticipate that during compression the water effective permeability decreases relatively more significantly than the scco2 effective permeability 4 2 stratigraphic storage of scco2 at various stress conditions as scco2 is injected into deep saline aquifers the pore space may expand due to an increase in pore pressure consequently both the fluid flow behavior e g velocity and pressure and the pore scale displacement threshold capillary pressures the capillary pressures above below which drainage imbibition displacements can occur may vary which subsequently affect the frequency of the pore scale fluid displacement events and hence the amount of the scco2 that could be stored to investigate the impact of the pore space deformation on the storage capacity we compared the scco2 injection tests performed at the effective stresses of 150 and 2 150 psi 1 and 14 8 mpa since they were performed with the same initial conditions swi 1 and injection flow rates we may consider that any differences in the fluid occupancy were triggered by the pore space deformation as observed in fig 6 the scco2 occupied the center of large pores while the water mainly resided in small pores throats and corners indicating a strongly water wet state this was further confirmed by the measurements of in situ contact angles mean θ receding 39 78 mean θ advancing 47 85 using an in house algorithm zankoor et al 2021 fig 7 after the effective stress was increased from 150 to 2 150 psi 1 to 14 8 mpa it was found that the piston like displacements were reinforced areas bounded by solid squares in fig 6 although the threshold capillary pressure was increased additional water was displaced by invading menisci which is refered to as the main terminal menisci mtms mason and morrow 1991 from both adjoining pore bodies and throats fig 8 as a consequence the scco2 volume increased even though the pore volume had decreased table 4 we believe that this reinforcement was mainly induced by the reduction in the permeability and cross sectional area of the sample which gave rise to an increase in the scco2 pressure gradient as the flow rates remained unchanged this could be verifieid by simulating the flow of scco2 at various stress conditions using the avizo software during the simulations a stabilization zone where pressure was quasistatic and the fluid could freely spread across the cross section of the porous medium was created in the front and rear sides of the segmented scco2 images a one voxel wide plane of solids with no slip boundary condition was added to other sides of the image to avoid the flow from those directions the outlet pressure inlet flow rate and fluid viscosity were set according to those in the experiments finally the pressure fields for the flow of the scco2 phase were generated by solving the navier stokes equations using the finite volume method mostaghimi et al 2013 zakirov and galeev 2019 zhang et al 2019 as seen in fig 9 the scco2 pressure gradient increased due to the pore space compaction and the reduction in the permeability of the sample since the viscosity of scco2 was as low as 0 022 under the experimental condition the increase in the pressure gradient was very slight in such a small sub volume even though the scco2 was injected into the sandpack at a high flow rate of 1 2cc min nevertheless because the outlet pressure was maintained constant the local scco2 pressure rose particularly in the region close to the inlet of the sub volume such slight increase observed in the small sub volume used for the simulation can accumulate in larger volumes of imaging fov or the entire sandpack as a consequence the scco2 pressure exceeded the threshold pressures required for entering smaller pore elements and hence the initial water saturation decreased after the compression in addition due to the reduction in the porosity the capillary number slightly increased from 5 39 10 7 to 5 75 10 7 after the compression which also slightly reinforced the piston like advances on the other hand it was observed that the scco2 to water displacements were also hindered locally as the effective stress was increased area bounded by dashed diamonds in fig 6 some of the water residing in throats and crevices was no longer displaced by the scco2 as the threshold capillary pressures had increased after the compression fig 10 compared to the displacement enhancement triggered by the increased scco2 pressure the frequency of the hindrance was much lower this may be attributed to the relatively high flow rate used during the injection of scco2 which caused a significant increase in the pressure gradient as the pore size decreased furthermore we believe the pressure drop was more sensitive to the pore space deformation than the displacement threshold capillary pressures since both the permeability and cross sectional area of the sample were dependent on the pore radius in summary the impact of the pore space deformation on the storage capacity of scco2 in a brine saturated porous medium is governed by two opposing factors the local scco2 pressure and displacement threshold capillary pressures any parameters in darcy s law and young laplace equation such as the effective permeability flow velocity fluid viscosity interfacial tension and wettability may affect the dominance of these two factors which in turn influences the frequency of the scco2 to water drainage displacements and thereby scco2 storage capacity in deep saline aquifers similar effects were also reported in oil water drainage tests performed by wang et al 2022 4 3 residual trapping under various stress conditions as scco2 is injected into deep saline aquifers its plume tends to migrate upward due to buoyancy until it reaches an ultra low permeability seal and then spreads laterally during this process the pressure field changes such that it becomes conducive to imbibition by chase brine brine to scco2 displacements at the tail of the plume consequently a portion of the scco2 is trapped at the center of large pores to probe the effect of pore space deformation on the residual trapping of scco2 we compared the fluid occupancies acquired after the two chase brine injection experiments conducted at the effective stresses of 150 and 2 150 psi 1 and 14 8 mpa compared to the scco2 flooding the frequency of the fluid displacements during the chase brine injection was affected merely by the threshold capillary pressure but not pressure gradient this is because the brine to scco2 imbibition displacement was performed under a capillary dominated flow regime as the effective stress was increased from 150 to 2 150 psi 1 to 14 8 mpa the brine to scco2 displacements were facilitated due to the rising threshold capillary pressure areas bounded by rectangles in fig 11 as a consequence the volume of scco2 that was trapped by capillary forces in the pore space decreased after the compression even though additional scco2 had been stored during the preceding scco2 flooding step see table 4 this indicated that the impact of saturation hysteresis on the residual trapping of the scco2 was less significant compared to that of the pore space contraction the facilitated brine to scco2 displacements involved both piston like advances as well as pore body filling whose investigations are beyond the scope of this study controlled by mtms and snap off events governed by the movements of the arc menisci ams as seen in fig 12 mtms moved forward further as the effective stress was increased and displaced additional scco2 in the neighboring pore elements area bounded by ellipses in fig 11 by contrast the assisted snap off events which were commonly regarded as one of the main trapping mechanisms in strongly water wet porous media gave rise to two opposite effects on the capillary trapping of scco2 on one hand as seen in fig 13 additional scco2 was trapped after the compression due to the higher frequency of the snap off events even though similar fluid occupancies were established by the preceding scco2 flooding steps consequently the residual scco2 saturation rose locally as the effective stress increased area bounded by dashed diamonds in fig 11 however this behavior was not commonly observed in the fov this was mainly because the average coordination number of the sandpack sample was as large as 10 see table 3 due to the absence of cement and clays and capillary trapping occurred more frequently in the pores with small coordination numbers in order to trap additional scco2 snap off events had to occur in all adjoining throats of a pore or a group of interconnected pores and thereby completely isolate a scco2 globule or cluster before piston like advances or pore body filling events occurred however this was difficult since the average aspect ratio of the sandpack sample was small table 3 tanino and blunt 2012 on the other hand since the scco2 remained hydraulically connected the new interfaces formed by snap off would serve as the mtms for the piston like advances or pore body filling displacements that would then contribute to the mobilization of scco2 as the capillary pressure further decreased in other words due to the large coordination number and small aspect ratio of the sandpack the additional snap off events induced by the pore space contraction were more likely to contribute to the brine to scco2 displacements by providing additional mtms for the piston like advances and pore body filling displacements rather than trapping additional scco2 additionally by probing the coordination number of different pore elements it was discovered that the coordination number increased with the pore size see fig 14 this indicated that the pore elements occupied by the scco2 might had larger coordination number than the average value i e 10 since the scco2 was the non wetting phase in this strongly water wet sandpack sample this made the capillary trapping of additional scco2 more difficult contrary to the small globules trapped in consolidated rocks andrew et al 2013 hu et al 2017 chaudhary et al 2013 the residual scco2 in the sandpack sample was mainly comprised of a large scco2 cluster at the effective stress of 150 psi 1mpa fig 15 a the good connectivity of the cluster was mainly caused by the large coordination number and small aspect ratio of the pore space after the compression due to the increased frequency of the snap off events the residual scco2 at the effective stress of 2 150 psi 14 8 mpa was fragmented into multiple smaller clusters and globules fig 15 b this was similar to the methane clusters observed in a proppant packed fracture by arshadi 2018 as additional scco2 was displaced from throats by snap off fig 16 the total volume of the residual scco2 was reduced even though the count of the scco2 clusters globules increased drastically table 5 this behavior is also shown in the scco2 cluster globule size distributions before and after the compression as seen in fig 17 the frequency of the small scco2 cluster globule significantly increased as the effective stress increased from 150 to 2 150 psi 1 to 14 8 mpa whereas the size of the largest cluster reduced substantially overall the capillary trapping of scco2 was impaired as the effective stress was increased due to the fact that pore scale displacement mechanisms such as the piston like advance and snap off were facilitated even though the snap off was commonly regarded as the main trapping mechanism of the scco2 in strongly water wet porous media we believe it can also contribute to brine to scco2 displacements by providing additional mtms for piston like advance and pore body filling displacement and fragmenting large scco2 clusters into smaller globules especially in unconsolidated sandstones this conflict is mainly caused by the different pore space topological properties between the consolidated and consolidated rocks as the coordination number decreases and the aspect ratio increases enhanced snap off is more likely to trap additional scco2 rather than merely fragmenting large scco2 clusters into smaller globules therefore an opposite trend may be observed in consolidated porous media which warrants further investigations 4 4 scco2 dissolution and water relative permeability to mimic scco2 dissolution in deep saline aquifers undersaturated water was injected into the sandpack sample at the end of each chase brine injection this allowed the trapped globules of carbon dioxide to gradually dissolve the configuration of these disconnected clusters was monitored by imaging them at different injection steps of undersaturated brine e g dissolution 1 dissolution 2 etc the information was subsequently processed and utilized to characterize the dissolution process at the micro scale fig 18 shows variations in the scco2 occupancy during the dissolution process at the effective stress of 150 psi 1 mpa as scco2 molecules transferred to the aqueous phase through brine scco2 interfaces mtms gradually moved from small pores and throats toward the center of large pores areas bounded by squares in fig 18 resulting in a decrease in the scco2 volume meanwhile some new brine scco2 interfaces were formed in throats areas bounded by circles in fig 18 this phenomenon was similar to the snap off events observed in the imbibition tests this was because the scco2 could also be dissolved into the brine through the ams in throats and corners as the scco2 clusters shrank in throats the surrounding aqueous phase swelled and eventually met and formed new interfaces similar observations have been reported by chang et al 2019 in a scco2 dissolution experiment conducted using 2 dimentional micromodels a three dimensional example of the mtm movement and the snap off caused by dissolution is shown in fig 19 since the scco2 dissolution was a dynamic process the fluid occupancy acquired at different effective stresses continued to change making it more challenging to investigate the impact of pore space deformation on the dissolution process at the pore scale nevertheless we believe that the dissolution was facilitated as the effective stress increased because less scco2 was trapped by capillary forces furthermore since additional brine scco2 interfaces were formed due to the increased frequency of the snap off events during the preceding brine injection stage the residual scco2 was expected to be dissolved more rapidly at the high effective stress to examine the relative preference of scco2 dissolution in pore elements with different sizes we evaluated variations in scco2 volume in the pores with diameters smaller than 150 um between 150 and 250 um and greater than 250 um during the dissolution process since the majority of the pores were within the range of 150 to 250 um changes in the scco2 volume in these pores were much larger than those in other elements to eliminate the skewed trend in the presented data we used the ratio of the changes in the scco2 volumes to their initial values before the dissolution at the end of the imbibition experiment to evaluate dissolution in different pores as seen in fig 20 16 of the scco2 in the pores smaller than 150 um was dissolved during the first stage of the dissolution dissolution 1 at the effective stress of 150 psi 1 mpa while the reduction in the scco2 volume in the pores with sizes between 150 and 250 um and greater than 250 um was only 11 and 6 respectively similar trends were also observed during the second dissolution stage at the effective stress of 150 psi 1 mpa and the one after the compression the results indicate that the scco2 dissolution was more favored in smaller pores this is similar to the preference of the brine to scco2 displacements to take place in smaller pores during the imbibition tests we believe this preference was caused mainly by the specific locations of the brine scco2 interfaces that were determined by wettability since the sandpack was strongly water wet the residual scco2 was mainly trapped at the center of the large pores therefore most of the brine scco2 interfaces were located in corners throats and small pores see figs 11 and 18 resulting in a higher frequency of scco2 dissolution in small pore elements it is worth noting that some of the scco2 globules might be displaced by the flowing brine during the dissolution process as the trapped scco2 kept shrinking these brine to scco2 displacements were more favored in smaller pores as well since smaller scco2 globules could be mobilized with less drag force khishvand et al 2016 the water relative permeability during the dissolution process is shown in fig 21 since the residual scco2 mainly resided in the center of the large pores the water flow was significantly hindered leading to small water relative permeability values at the beginning of the dissolution process as the residual scco2 clusters and globules shrank the relative permeability of the water gradually increased this behavior could be observed during both dissolution tests conducted before and after the compression at a fixed saturation the relative permeability measured at the effective stress of 2 150 psi 14 8 mpa was smaller than that measured at the effective stress of 150 psi this could be attributed to the early finding that the throats corners and crevices where the wetting phase was hosted deformed relatively more prominently compared to large pores occupied by the non wetting phase for a given fluid distribution the effective permeability to water decreased more than the absolute permeability after the compression resulting in a reduction in the water relative permeability this behavior agrees with akbarabadi and piri s observation that the water relative permeability increased with the absolute permeability of rock samples during the scco2 dissolution process akbarabadi and piri 2013 moreover a similar trend was also observed in an imbibition relative permeability study reported by wang et al 2022 overall the scco2 dissolution showed certain similarities to the brine to scco2 imbibition even though the mechanisms at the pore and molecular scales are different the mtms moved from throats and small pores to the center of large pores during the dissolution process snap off occurred in throats as scco2 molecules were dissolved into the aqueous phase through the ams furthermore scco2 dissolution was also more favored in smaller pores at the macro scale the water relative permeability during the dissolution decreased with the increase in the effective stress at a fixed saturation due to the higher stress sensitivity of the small pores occupied by the water phase 5 summary and conclusions to investigate the impact of pore space deformation on various scco2 trapping mechanisms in deep saline aquifers i e stratigraphic capillary and dissolution trapping we performed a series of two phase scco2 brine drainage imbibition and dissolution experiments on a miniature sandpack sample at various stress conditions a high resolution x ray micro ct scanner was employed to image the pore and fluid configurations which were subsequently used for characterizing the deformation of the pore space and changes in the scco2 volume and saturation as the effective stress increased from 150 to 2 150 psi 1 to 14 8 mpa the porosity and absolute permeability of the sandpack sample decreased from 0 32 and 7 82 d to 0 30 and 5 00 d respectively the average equivalent diameters of both pore bodies and throats decreased by 5 um however due to the different initial sizes the contraction was relatively more prominent in throats than in pore bodies consequently the aspect ratio and the coordination number increased and decreased respectively after the compression by comparing the two scco2 flooding tests performed under different stress conditions it was found that the scco2 volume increased after the compression even though the pore volume had decreased this was mainly because piston like advances were reinforced as the scco2 pressure gradient increased due to the reduction in permeability and void cross sectional area of the sample even though the hindrance caused by the increased threshold capillary pressures was also observed locally it was not as frequent as the reinforcement mentioned earlier during the subsequent imbibition tests both piston like advances and snap off events were facilitated after the compression owing to the increase in the threshold capillary pressures since the sandpack sample had a large coordination number and small aspect ratio additional scco2 trapping was not frequently observed on the other hand the facilitated snap off contributed to the brine to scco2 displacement by providing additional mtms for the piston like advances and pore body filling events and fragmenting large scco2 clusters into smaller globules consequently the amount of trapped scco2 decreased after the compression even though additional scco2 was stored in the pore space by the preceding scco2 flooding test by comparing the scco2 configurations acquired at different stages of the dissolution process it was found that mtms moved from small pores and throats toward the center of large pores resulting in a reduction in the residual scco2 volume meanwhile snap off was triggered in throats as scco2 molecules were dissolved into the aqueous phase through the ams since most of the brine scco2 interfaces were located in throats corners and small pores scco2 dissolution was more favored in small pore elements in relation to the macroscopic flow properties the water relative permeability during the dissolution process decreased with the increase in the effective stress this could be ascribed to the finding that the small pores occupied by the water phase deformed relatively more prominently than the large pores overall the scco2 dissolution showed certain similarities to the imbibition process even though the pore and molecular scale mechanisms were completely different credit authorship contribution statement rui wang conceptualization methodology data curation investigation software formal analysis writing original draft writing review editing maziar arshadi conceptualization methodology supervision writing review editing mohammad piri conceptualization funding acquisition methodology project administration resources supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment we gratefully acknowledge the financial support of hess corporation and the university of wyoming 
50,in this study we investigate the impact of pore space deformation on various trapping mechanisms of supercritical co2 scco2 relevant to storage of co2 in deep saline aquifers a series of unsteady state two phase brine scco2 drainage imbibition and dissolution tests were performed on a miniature sandpack sample under various stress conditions high resolution x ray microtomography techniques were employed to acquire the pore and fluid occupancy maps at each step of the experiment which were subsequently utilized to characterize the pore space deformation and changes in the frequencies of various pore scale fluid displacement events our results revealed that during the scco2 injection stage additional scco2 was stored in the sandpack sample after the sandpack was compressed due to an increase in the pressure gradient even though the pore volume had decreased on the other hand the capillary trapping was impaired by the pore space contraction because all the imbibition displacement mechanisms at the pore scale including the piston like advance and snap off were facilitated as a consequence of an increase in their threshold capillary pressures the increased frequency of snap off events caused additional trapping but more importantly displaced scco2 from throats by fragmenting large residual scco2 clusters into smaller globules during the dissolution process the trapped scco2 clusters and globules shrank in both pore bodies and throats resulting in movement of the main terminal meniscus mtm interfaces and snap off events respectively the water relative permeability during the dissolution process decreased at a fixed saturation with the increase in the effective stress since the small pores occupied by the water phase deformed more significantly than the large pores keywords geological co2 sequestration pore space deformation capillary trapping pore scale displacement physics x ray microtomography data availability data will be made available on request 1 introduction carbon dioxide co2 emissions as one of the main causes of global warming have received broad attention due to their adverse impacts on the climate davis et al 2010 the increase in earth s temperature causes a series of environmental issues such as the melting of the polar ice stirling and derocher 2012 rise of sea level raper and braithwaite 2006 and increase in the frequency and intensity of droughts and floods vicente serrano et al 2020 mousavi et al 2011 moreover ocean acidification can be triggered directly by increased concentration of co2 in the atmosphere which may disturb the marine ecosystem such as marine biodiversity and biophysiology pandolfi et al 2011 alfonso et al 2021 pistevos et al 2015 in other words anthropogenic co2 emissions adversely impact balance of nature and thereby numerous interconnected aspects of human life to mitigate co2 emissions the most practical and effective option is carbon capture and storage ccs pires et al 2011 haszeldine 2009 ccs refers to a number of technologies utilized for separating co2 during different stages of the industrial process e g post combustion pre combustion and oxyfuel combustion transporting it to a storage location stable geological formation or ocean and isolating it from the atmosphere for a long period boot handford et al 2014 metz et al 2005 it is believed that ccs can within expected technological limitations reduce 20 40 of global co2 emissions by 2050 metz et al 2005 the co2 storage technologies mainly involve geological storage ocean storage and mineral carbonation among these scenarios geological storage which refers to the injection of co2 into a stable geological formation is economically more viable allinson et al 2003 anderson 2017 akimoto et al 2007 this could be further classified into three main categories based on the types of geological formations 1 oil reservoirs 2 unmineable coal seams and 3 deep saline aquifers the third category is considered to have the largest storage capacity metz et al 2005 bui et al 2018 as co2 is injected into saline aquifers it usually retains a supercritical state due to the high pressure and high temperature conditions caused by the geological formation s depth under these conditions the fluid has a liquid like density that establishes the potential to efficiently utilize the underground storage space bickle 2009 supercritical co2 scco2 plumes tend to migrate upward in aquifers due to buoyancy at this stage the sealing cap at the top of the aquifer such as a low permeability layer or a fault serves as a barrier that prevents it from leaking into the atmosphere szulczewski et al 2013 in the meantime imbibition occurs at the tail of the scco2 plume due to favorable pressure fields developed by the aforementioned upward movement as a consequence a portion of the scco2 becomes hydraulically disconnected due to the capillary trapping phenomenon pentland et al 2011 s krevor et al 2015 since the trapped scco2 is immobile capillary trapping is considered to be one of the most significant short term trapping mechanisms in geological storage of scco2 uc bandara et al 2011 in the last decades multiple experimental and simulation studies have been conducted to characterize multiphase flow and trapping of co2 at macro and micro scales akbarabadi and piri 2013 andrew et al 2013 gershenzon et al 2017 it was discovered that capillary trapping of scco2 was governed by the wettability of porous media hu et al 2017 øren et al 2019 moreover the displacement patterns and the amount of trapped scco2 depended on capillary and bond numbers uc bandara et al 2011 it was also reported by chaudhary et al 2013 that the angularity of grains can significantly affect the capillary trapping of scco2 in saline aquifers in addition dissolution of scco2 in the aqueous phase serves as one of the main long term trapping mechanisms akbarabadi and piri 2013 soltanian et al 2017 agartan et al 2015 once scco2 is dissolved into the brine it migrates with the flow of the brine and is unlikely to recover to a separate phase and be released into the atmosphere again dissolution of scco2 was often assumed to be instantaneous in numerical modeling pruess and spycher 2007 zhou et al 2010 however recent macro and micro scale experimental studies have shown a prolonged depletion of residual scco2 by dissolution akbarabadi and piri 2013 berg et al 2013 chang et al 2016 this is mainly because the mass transfer rate between the residual scco2 and displacing water decreases as residual scco2 clusters dissolve chang et al 2014 as a consequence the maximum mass fraction of dissolved scco2 in displacing water was merely approximately 2 to 13 of co2 solubility depending on the pore heterogeneity and flow rate chang et al 2019 in the previous co2 geosequestration studies one of the factors that is often neglected is the pore space expansion caused by the rising pore pressure during injection as a consequence not only the total pore volume of the aquifer but also the displacement threshold capillary pressures which govern the displacement efficiency during co2 injection and subsequent imbibition s krevor et al 2015 may change hence the co2 volume that can be stored in aquifers may be significantly different from what is expected moreover the water flow behavior during the dissolution process may also be affected by variations in the water hydraulic conductivity hence it is essential to investigate the impact of the pore space deformation on various geological storage mechanisms during co2 geosequestration to this end we performed a series of unsteady state two phase brine and supercritical co2 drainage imbibition and co2 dissolution experiments on a miniature sandpack under various stress conditions these respectively represented the fluid displacements that occur during supercritical co2 scco2 injection imbibition at the tail of the scco2 plume and dissolution in deep saline aquifers the pore and fluid occupancy maps at each step of the experiment were imaged using a high resolution micro ct scanner and then utilized for characterizing the deformation of the pore space and changes in the frequencies of various fluid displacement events variations in the local fluid pressure were evaluated by direct simulation which used a finite volume method to solve navier stokes equations mostaghimi et al 2013 zakirov and galeev 2019 zhang et al 2019 moreover we characterized dissolution of trapped scco2 in water at the pore scale by comparing the fluid configurations imaged at different dissolution stages we also measured the water relative permeability during dissolution under different stress conditions the remaining sections of this paper are devoted to first introducing the sample fluids and experimental apparatus and procedure utilized in the core flooding tests this is followed by a description of the data acquisition processing and analysis techniques afterward the main findings of the experiments are reported and discussed in detail finally the paper is concluded with a summary of the findings 2 experiments 2 1 rock sample fluids and experimental conditions to establish a measurable pore space deformation under limited experimental pressure a cement free sandpack with a diameter of 10 mm and a length of 75 mm was created and used in the core flooding experiments it was specially designed and constructed according to the sandpack preparation method reported by wang et al 2022 the sandpack was a mixture that consisted of 17 48 21 7 and 7 wt of 60 70 80 100 and 140 mesh respectively high roundness and high sphericity northern white monocrystalline sands 100 sio2 this aimed at mimicking the grain size distribution of the berea sandstone wang et al 2022 so that the sample was representative of natural unconsolidated sandstones once the sands were well mixed the pack was densified by being subjected to vibration for three hours by controlling vibration time and the mixture composition we were able to build a homogenous sandpack sample with desired porosity and permeability before being transported to a miniature core holder the sandpack was partially saturated with distilled water through the spontaneous imbibition process and then frozen in liquid nitrogen to maintain its properties the aqueous phase used in the two phase core flooding experiment was a 2 wt nacl brine solution tagged with 4 wt nai nai was added into the brine to enhance its contrast with the carbon dioxide in the micro ct images by increasing the energy attenuation of the x ray in the aqueous phase since the brine solution s grayscale intensity on the images appeared to be similar to that of the sand grains it was replaced by a brine containing only 2 wt nacl before we acquired a reference scan to map the pore space for brevity the brine solutions with and without nai are labeled as doped and non doped respectively in the following sections the co2 phase was maintained at a supercritical state 1250 psig 8 7 mpa and 50 c throughout the experiments before the core flooding experiments were commenced the doped brine and the scco2 were circulated bypassing the core holder while being supplied from a 1300 cc hastelloy cell this step was incorporated into the experimental procedure to equilibrate the two fluids and thereby mitigate any dissolution exsolution of scco2 during the drainage and imbibition tests the properties of the doped brine and scco2 used in this study are estimated from the experimental data provided by kestin et al 1981 and bachu and bennion 2009 respectively table 1 2 2 experimental apparatus a high temperature and high pressure core flooding system integrated with a high resolution x ray micro ct scanner were employed to conduct the flow experiments fig 1 compared to conventional two phase core flooding systems this apparatus included a bypass loop and an equilibration cell that were utilized for equilibrating the fluids before the experiments to this end a compensation pump was connected to the equilibration cell to replenish the scco2 and make up for the pressure decline caused by scco2 dissolution in brine liquid co2 was supplied from a cylinder and subsequently passed through a secondary equilibration cell that contained brine before it was further pressurized and injected by the compensation pump into the primary equilibration cell this pre equilibration process allowed for the fluids to establish an equilibration state in a shorter amount of time during the core flooding experiments the equilibrated brine and scco2 stored in the primary equilibration cell were injected into the core sample at constant flow rates by two individual quizix pumps with flow rate range and resolution of 0 000031 to 15 cc min and 0 000001 cc min respectively the effluent was collected at constant pressure by the back pressure regulation pump and discharged into a semi enclosed glassware the compensation pump continued its operation to make up for scco2 injection and maintain the pressure in the primary equilibration cell with absolute pressure measurement range and accuracy of 0 to 10 000 psi and 0 1 psi respectively two more pumps applied the radial and axial stresses to establish hydrostatic stress conditions meanwhile pressure drops were recorded by rosemount differential pressure transducers with the differential pressure measurement range and accuracy of 0 to 250 inch of water inh2o and 0 01 inh2o respectively to maintain the supercritical state of co2 all the core flooding components except for the liquid co2 cylinder and core holder were set in an oven with a constant temperature of 50 c the tubing and the core holder in the micro ct scanner were properly heated and insulated by heating and insulation tapes the pumps differential pressure transducers liquid co2 cylinder and equilibration cells were all connected by corrosion resistant hastelloy tubing whereas flexible peek tubing was used in the micro ct scanner to eliminate the torque applied on the core holder due to its rotation during the scanning process the high resolution heliscan x ray micro ct scanner manufactured by thermo fisher scientific was comprised of an x ray source a high voltage power supply a sample stage and a large area x ray detector a series of x ray projections of the sample was collected at pre defined rotation angles during the experiments these projection images were further reconstructed using a supercomputer to generate three dimensional pore and fluid occupancy maps 2 3 experimental procedure after the frozen sample was transferred into a core holder the entire assembly was vertically mounted on the sample stage of the micro ct scanner and connected to other core flooding components the core holder was left in place for several hours until it thawed completely at this stage gaseous co2 was injected at 30 psig 0 31 kpa to dry the core sample and simultaneously displace the air left in the pore space subsequently the assembly was vacuumed overnight and fully saturated with brine once 100 water saturation was confirmed at multiple locations by rapid scans the pore and confining pressures were gradually increased to 1250 and 1400 psig 8 7 and 9 8 mpa respectively at this stage we measured the initial absolute permeability by recording the pressure drop at various brine flow rates and calculated the image based porosity by performing a reference scan after displacing the doped brine with its non doped counterpart finally the non doped brine was replaced by the doped solution before conducting the two phase flow tests it is worth noting that the sandpack sample was saturated with the doped brine after being vacuumed this guaranteed that all the dead volumes and the tubing were filled with doped brine as well otherwise brine scco2 interfaces may become blurry in the x ray images obtained during the core flooding experiments due to diffusion caused by the difference in the iodide ion concentration in the dead volumes and the pore space to investigate the impacts of pore space deformation induced by the injection of scco2 on stratigraphic and capillary trapping of the fluid in deep saline aquifers we conducted a series of drainage and imbibition tests under various stress conditions to eliminate any interference caused by changes in the fluid properties such as the density viscosity and interfacial tension the effective stress was adjusted by changing the confining pressure and maintaining the pore pressure constant berg et al 2013 michels et al 1957 fenghour et al 1998 since the pore space deformation would be less prominent if the sandpack had deformed plastically the two phase flow tests were first carried out at low and then at high effective stresses during the experiments 15 pore volumes pvs of scco2 were injected into the sandpack at a constant flow rate of 1 2cc min capillary number nca 5 39 10 7 afterward 15 pvs of chase brine were injected at a flow rate of 0 05 cc min to mimic imbibition at the tail of the scco2 plume the low brine flow rate guaranteed that the imbibition occurred under a capillary dominated flow regime capillary number nca 5 87 10 7 lenormand et al 1988 lenormand et al 1989 this was followed by a bump test during which another 5 pvs brine was injected at 0 07 cc min capillary number nca 8 22 10 7 to examine if any additional scco2 would be produced at this stage the scco2 that remained in the pore space was considered hydraulically disconnected and trapped subsequently we gradually dissolved the trapped scco2 by injecting undersaturated brine while measuring the relative permeability of the aqueous phase by recording the pressure drop across the core sample at the flow rates of 0 05 to 0 2 cc min capillary number nca 5 39 10 7 to 2 35 10 6 during the dissolution process configurations of shrinking trapped globules of scco2 were imaged at multiple steps a chemical solution comprised of 50 isopropanol and 50 methanol which had a much larger co2 solubility compared to water was injected into the sandpack sample to accelerate the scco2 dissolution the chemical that remained in the pore space was then miscibly displaced by the doped brine once a 100 water saturation was confirmed by absolute permeability measurements and quick scans at multiple locations the sandpack was compressed by gradually increasing the hydrostatic confining pressure to 3400 psig 23 5 mpa after the compression the drainage imbibition and dissolution tests were repeated with the same flow rates and the new fluid occupancy images acquired at each step were compared with their counterparts obtained before the compression the detailed experimental procedure is illustrated in fig 2 3 image acquisition and processing during the core flooding experiments two groups of scans were conducted the imaging parameters are listed in table 2 the first was a succession of rapid monitoring scans once two successive fluid occupancy maps acquired by these scans were similar we considered that the sandpack sample and the fluids in the pore space had reached a steady state condition the second group was the main scans that were utilized for accurately maping and quantifying the volume of each phase after the steady state condition had been established based on the objectives they could be further divided into reference scans which were used to measure the properties of the pore space and the two phase scans for measuring fluid saturations and characterizing the in situ wettability and pore scale fluid displacements during the main scans the detector collected 5 projection images frame to average 5 at each pre designed angle these were subsequently merged into one single projection image to eliminate the noise that was randomly posed during the scans after being reconstructed by a supercomputer the images were pre processed and analyzed using the avizo software purswani et al 2020 non local means and median filters were first applied to remove the internal noise in each phase and sharpen the fluid fluid and fluid solid interfaces the images acquired by the reference scans were then segmented using the interactive thresholding function to distinguish the pore space from the solid due to the similar grayscale intensities it was challenging to directly segment the sand grains and the doped brine in the fluid occupancy maps therefore we registered the fluid occupancy maps and the reference scan images and then multiplied the intensities of the former by those of the segmented pore map using this approach the intensity of the sand grains became zero and only the scco2 and doped brine phases remained in the images which then could be directly segmented using the interactive thresholding function finally the segmented brine scco2 and solid phases were represented by blue yellow and gray colors respectively and combined into one image for analysis by counting the voxels of each phase the image based porosity and fluid saturation could be calculated 4 results and discussion 4 1 pore space deformation as the effective stress was increased from 150 to 2 150 psi 1 to 14 8 mpa the image based porosity and the absolute permeability of the sandpack sample decreased from 0 32 and 7 82 d to 0 30 and 5 00 d respectively the reduction in the porosity was constant along the axial direction of the sample indicating that the sandpack deformed uniformly fig 3 at the micro scale as seen in fig 4 adjoining grain particles approached each other with negligible rotation as the effective stress increased consequently the pore volume was reduced and a portion of the throats were completely closed due to their smaller sizes areas bounded by rectangles in fig 4 compared to the pore space contraction the deformation of individual solid grains was negligible since the sandpack was relatively loosely packed hu and rutqvist 2020 and the quartz had an extremely large young s modulus brace and walsh 1962 to quantify the pore space deformation we computed a series of pore space properties under different effective stress conditions by extracting ball stick pore network models in which balls and sticks represent pore bodies and throats respectively from the segmented pore maps using the maximal ball algorithm silin and patzek 2006 as listed in table 3 the diameters of both pore bodies and throats decreased approximately by 5 um as the effective stress was increased from 150 to 2 150 psi 1 to 14 8 mpa this could be attributed to the earlier finding that the sandpack deformation was mainly governed by grain displacement rather than grain rotation as seen from the pore and throat size distribution curves fig 5 different pore elements showed similar deformation magnitude however the contractions of the throats were relatively more pronounced than those of the pore bodies due to their smaller initial sizes as a consequence approximately 4 of the throats were closed as the effective stress increased whereas the count of the pore bodies was negligibly affected resulting in a slight reduction in the coordination number for the same reason the average aspect ratio i e the average of the ratio of the equivalent pore diameter to the equivalent throat diameter increased after the compression the different relative deformation degrees of the throats and pore bodies indicated that the hydraulic conductivity to the wetting phase i e water which mainly occupied the small pore elements such as throats corners and crevices could be more significantly impaired by the compression than that to the non wetting phase i e scco2 residing at the center of the large pores wang et al 2022 hence we can anticipate that during compression the water effective permeability decreases relatively more significantly than the scco2 effective permeability 4 2 stratigraphic storage of scco2 at various stress conditions as scco2 is injected into deep saline aquifers the pore space may expand due to an increase in pore pressure consequently both the fluid flow behavior e g velocity and pressure and the pore scale displacement threshold capillary pressures the capillary pressures above below which drainage imbibition displacements can occur may vary which subsequently affect the frequency of the pore scale fluid displacement events and hence the amount of the scco2 that could be stored to investigate the impact of the pore space deformation on the storage capacity we compared the scco2 injection tests performed at the effective stresses of 150 and 2 150 psi 1 and 14 8 mpa since they were performed with the same initial conditions swi 1 and injection flow rates we may consider that any differences in the fluid occupancy were triggered by the pore space deformation as observed in fig 6 the scco2 occupied the center of large pores while the water mainly resided in small pores throats and corners indicating a strongly water wet state this was further confirmed by the measurements of in situ contact angles mean θ receding 39 78 mean θ advancing 47 85 using an in house algorithm zankoor et al 2021 fig 7 after the effective stress was increased from 150 to 2 150 psi 1 to 14 8 mpa it was found that the piston like displacements were reinforced areas bounded by solid squares in fig 6 although the threshold capillary pressure was increased additional water was displaced by invading menisci which is refered to as the main terminal menisci mtms mason and morrow 1991 from both adjoining pore bodies and throats fig 8 as a consequence the scco2 volume increased even though the pore volume had decreased table 4 we believe that this reinforcement was mainly induced by the reduction in the permeability and cross sectional area of the sample which gave rise to an increase in the scco2 pressure gradient as the flow rates remained unchanged this could be verifieid by simulating the flow of scco2 at various stress conditions using the avizo software during the simulations a stabilization zone where pressure was quasistatic and the fluid could freely spread across the cross section of the porous medium was created in the front and rear sides of the segmented scco2 images a one voxel wide plane of solids with no slip boundary condition was added to other sides of the image to avoid the flow from those directions the outlet pressure inlet flow rate and fluid viscosity were set according to those in the experiments finally the pressure fields for the flow of the scco2 phase were generated by solving the navier stokes equations using the finite volume method mostaghimi et al 2013 zakirov and galeev 2019 zhang et al 2019 as seen in fig 9 the scco2 pressure gradient increased due to the pore space compaction and the reduction in the permeability of the sample since the viscosity of scco2 was as low as 0 022 under the experimental condition the increase in the pressure gradient was very slight in such a small sub volume even though the scco2 was injected into the sandpack at a high flow rate of 1 2cc min nevertheless because the outlet pressure was maintained constant the local scco2 pressure rose particularly in the region close to the inlet of the sub volume such slight increase observed in the small sub volume used for the simulation can accumulate in larger volumes of imaging fov or the entire sandpack as a consequence the scco2 pressure exceeded the threshold pressures required for entering smaller pore elements and hence the initial water saturation decreased after the compression in addition due to the reduction in the porosity the capillary number slightly increased from 5 39 10 7 to 5 75 10 7 after the compression which also slightly reinforced the piston like advances on the other hand it was observed that the scco2 to water displacements were also hindered locally as the effective stress was increased area bounded by dashed diamonds in fig 6 some of the water residing in throats and crevices was no longer displaced by the scco2 as the threshold capillary pressures had increased after the compression fig 10 compared to the displacement enhancement triggered by the increased scco2 pressure the frequency of the hindrance was much lower this may be attributed to the relatively high flow rate used during the injection of scco2 which caused a significant increase in the pressure gradient as the pore size decreased furthermore we believe the pressure drop was more sensitive to the pore space deformation than the displacement threshold capillary pressures since both the permeability and cross sectional area of the sample were dependent on the pore radius in summary the impact of the pore space deformation on the storage capacity of scco2 in a brine saturated porous medium is governed by two opposing factors the local scco2 pressure and displacement threshold capillary pressures any parameters in darcy s law and young laplace equation such as the effective permeability flow velocity fluid viscosity interfacial tension and wettability may affect the dominance of these two factors which in turn influences the frequency of the scco2 to water drainage displacements and thereby scco2 storage capacity in deep saline aquifers similar effects were also reported in oil water drainage tests performed by wang et al 2022 4 3 residual trapping under various stress conditions as scco2 is injected into deep saline aquifers its plume tends to migrate upward due to buoyancy until it reaches an ultra low permeability seal and then spreads laterally during this process the pressure field changes such that it becomes conducive to imbibition by chase brine brine to scco2 displacements at the tail of the plume consequently a portion of the scco2 is trapped at the center of large pores to probe the effect of pore space deformation on the residual trapping of scco2 we compared the fluid occupancies acquired after the two chase brine injection experiments conducted at the effective stresses of 150 and 2 150 psi 1 and 14 8 mpa compared to the scco2 flooding the frequency of the fluid displacements during the chase brine injection was affected merely by the threshold capillary pressure but not pressure gradient this is because the brine to scco2 imbibition displacement was performed under a capillary dominated flow regime as the effective stress was increased from 150 to 2 150 psi 1 to 14 8 mpa the brine to scco2 displacements were facilitated due to the rising threshold capillary pressure areas bounded by rectangles in fig 11 as a consequence the volume of scco2 that was trapped by capillary forces in the pore space decreased after the compression even though additional scco2 had been stored during the preceding scco2 flooding step see table 4 this indicated that the impact of saturation hysteresis on the residual trapping of the scco2 was less significant compared to that of the pore space contraction the facilitated brine to scco2 displacements involved both piston like advances as well as pore body filling whose investigations are beyond the scope of this study controlled by mtms and snap off events governed by the movements of the arc menisci ams as seen in fig 12 mtms moved forward further as the effective stress was increased and displaced additional scco2 in the neighboring pore elements area bounded by ellipses in fig 11 by contrast the assisted snap off events which were commonly regarded as one of the main trapping mechanisms in strongly water wet porous media gave rise to two opposite effects on the capillary trapping of scco2 on one hand as seen in fig 13 additional scco2 was trapped after the compression due to the higher frequency of the snap off events even though similar fluid occupancies were established by the preceding scco2 flooding steps consequently the residual scco2 saturation rose locally as the effective stress increased area bounded by dashed diamonds in fig 11 however this behavior was not commonly observed in the fov this was mainly because the average coordination number of the sandpack sample was as large as 10 see table 3 due to the absence of cement and clays and capillary trapping occurred more frequently in the pores with small coordination numbers in order to trap additional scco2 snap off events had to occur in all adjoining throats of a pore or a group of interconnected pores and thereby completely isolate a scco2 globule or cluster before piston like advances or pore body filling events occurred however this was difficult since the average aspect ratio of the sandpack sample was small table 3 tanino and blunt 2012 on the other hand since the scco2 remained hydraulically connected the new interfaces formed by snap off would serve as the mtms for the piston like advances or pore body filling displacements that would then contribute to the mobilization of scco2 as the capillary pressure further decreased in other words due to the large coordination number and small aspect ratio of the sandpack the additional snap off events induced by the pore space contraction were more likely to contribute to the brine to scco2 displacements by providing additional mtms for the piston like advances and pore body filling displacements rather than trapping additional scco2 additionally by probing the coordination number of different pore elements it was discovered that the coordination number increased with the pore size see fig 14 this indicated that the pore elements occupied by the scco2 might had larger coordination number than the average value i e 10 since the scco2 was the non wetting phase in this strongly water wet sandpack sample this made the capillary trapping of additional scco2 more difficult contrary to the small globules trapped in consolidated rocks andrew et al 2013 hu et al 2017 chaudhary et al 2013 the residual scco2 in the sandpack sample was mainly comprised of a large scco2 cluster at the effective stress of 150 psi 1mpa fig 15 a the good connectivity of the cluster was mainly caused by the large coordination number and small aspect ratio of the pore space after the compression due to the increased frequency of the snap off events the residual scco2 at the effective stress of 2 150 psi 14 8 mpa was fragmented into multiple smaller clusters and globules fig 15 b this was similar to the methane clusters observed in a proppant packed fracture by arshadi 2018 as additional scco2 was displaced from throats by snap off fig 16 the total volume of the residual scco2 was reduced even though the count of the scco2 clusters globules increased drastically table 5 this behavior is also shown in the scco2 cluster globule size distributions before and after the compression as seen in fig 17 the frequency of the small scco2 cluster globule significantly increased as the effective stress increased from 150 to 2 150 psi 1 to 14 8 mpa whereas the size of the largest cluster reduced substantially overall the capillary trapping of scco2 was impaired as the effective stress was increased due to the fact that pore scale displacement mechanisms such as the piston like advance and snap off were facilitated even though the snap off was commonly regarded as the main trapping mechanism of the scco2 in strongly water wet porous media we believe it can also contribute to brine to scco2 displacements by providing additional mtms for piston like advance and pore body filling displacement and fragmenting large scco2 clusters into smaller globules especially in unconsolidated sandstones this conflict is mainly caused by the different pore space topological properties between the consolidated and consolidated rocks as the coordination number decreases and the aspect ratio increases enhanced snap off is more likely to trap additional scco2 rather than merely fragmenting large scco2 clusters into smaller globules therefore an opposite trend may be observed in consolidated porous media which warrants further investigations 4 4 scco2 dissolution and water relative permeability to mimic scco2 dissolution in deep saline aquifers undersaturated water was injected into the sandpack sample at the end of each chase brine injection this allowed the trapped globules of carbon dioxide to gradually dissolve the configuration of these disconnected clusters was monitored by imaging them at different injection steps of undersaturated brine e g dissolution 1 dissolution 2 etc the information was subsequently processed and utilized to characterize the dissolution process at the micro scale fig 18 shows variations in the scco2 occupancy during the dissolution process at the effective stress of 150 psi 1 mpa as scco2 molecules transferred to the aqueous phase through brine scco2 interfaces mtms gradually moved from small pores and throats toward the center of large pores areas bounded by squares in fig 18 resulting in a decrease in the scco2 volume meanwhile some new brine scco2 interfaces were formed in throats areas bounded by circles in fig 18 this phenomenon was similar to the snap off events observed in the imbibition tests this was because the scco2 could also be dissolved into the brine through the ams in throats and corners as the scco2 clusters shrank in throats the surrounding aqueous phase swelled and eventually met and formed new interfaces similar observations have been reported by chang et al 2019 in a scco2 dissolution experiment conducted using 2 dimentional micromodels a three dimensional example of the mtm movement and the snap off caused by dissolution is shown in fig 19 since the scco2 dissolution was a dynamic process the fluid occupancy acquired at different effective stresses continued to change making it more challenging to investigate the impact of pore space deformation on the dissolution process at the pore scale nevertheless we believe that the dissolution was facilitated as the effective stress increased because less scco2 was trapped by capillary forces furthermore since additional brine scco2 interfaces were formed due to the increased frequency of the snap off events during the preceding brine injection stage the residual scco2 was expected to be dissolved more rapidly at the high effective stress to examine the relative preference of scco2 dissolution in pore elements with different sizes we evaluated variations in scco2 volume in the pores with diameters smaller than 150 um between 150 and 250 um and greater than 250 um during the dissolution process since the majority of the pores were within the range of 150 to 250 um changes in the scco2 volume in these pores were much larger than those in other elements to eliminate the skewed trend in the presented data we used the ratio of the changes in the scco2 volumes to their initial values before the dissolution at the end of the imbibition experiment to evaluate dissolution in different pores as seen in fig 20 16 of the scco2 in the pores smaller than 150 um was dissolved during the first stage of the dissolution dissolution 1 at the effective stress of 150 psi 1 mpa while the reduction in the scco2 volume in the pores with sizes between 150 and 250 um and greater than 250 um was only 11 and 6 respectively similar trends were also observed during the second dissolution stage at the effective stress of 150 psi 1 mpa and the one after the compression the results indicate that the scco2 dissolution was more favored in smaller pores this is similar to the preference of the brine to scco2 displacements to take place in smaller pores during the imbibition tests we believe this preference was caused mainly by the specific locations of the brine scco2 interfaces that were determined by wettability since the sandpack was strongly water wet the residual scco2 was mainly trapped at the center of the large pores therefore most of the brine scco2 interfaces were located in corners throats and small pores see figs 11 and 18 resulting in a higher frequency of scco2 dissolution in small pore elements it is worth noting that some of the scco2 globules might be displaced by the flowing brine during the dissolution process as the trapped scco2 kept shrinking these brine to scco2 displacements were more favored in smaller pores as well since smaller scco2 globules could be mobilized with less drag force khishvand et al 2016 the water relative permeability during the dissolution process is shown in fig 21 since the residual scco2 mainly resided in the center of the large pores the water flow was significantly hindered leading to small water relative permeability values at the beginning of the dissolution process as the residual scco2 clusters and globules shrank the relative permeability of the water gradually increased this behavior could be observed during both dissolution tests conducted before and after the compression at a fixed saturation the relative permeability measured at the effective stress of 2 150 psi 14 8 mpa was smaller than that measured at the effective stress of 150 psi this could be attributed to the early finding that the throats corners and crevices where the wetting phase was hosted deformed relatively more prominently compared to large pores occupied by the non wetting phase for a given fluid distribution the effective permeability to water decreased more than the absolute permeability after the compression resulting in a reduction in the water relative permeability this behavior agrees with akbarabadi and piri s observation that the water relative permeability increased with the absolute permeability of rock samples during the scco2 dissolution process akbarabadi and piri 2013 moreover a similar trend was also observed in an imbibition relative permeability study reported by wang et al 2022 overall the scco2 dissolution showed certain similarities to the brine to scco2 imbibition even though the mechanisms at the pore and molecular scales are different the mtms moved from throats and small pores to the center of large pores during the dissolution process snap off occurred in throats as scco2 molecules were dissolved into the aqueous phase through the ams furthermore scco2 dissolution was also more favored in smaller pores at the macro scale the water relative permeability during the dissolution decreased with the increase in the effective stress at a fixed saturation due to the higher stress sensitivity of the small pores occupied by the water phase 5 summary and conclusions to investigate the impact of pore space deformation on various scco2 trapping mechanisms in deep saline aquifers i e stratigraphic capillary and dissolution trapping we performed a series of two phase scco2 brine drainage imbibition and dissolution experiments on a miniature sandpack sample at various stress conditions a high resolution x ray micro ct scanner was employed to image the pore and fluid configurations which were subsequently used for characterizing the deformation of the pore space and changes in the scco2 volume and saturation as the effective stress increased from 150 to 2 150 psi 1 to 14 8 mpa the porosity and absolute permeability of the sandpack sample decreased from 0 32 and 7 82 d to 0 30 and 5 00 d respectively the average equivalent diameters of both pore bodies and throats decreased by 5 um however due to the different initial sizes the contraction was relatively more prominent in throats than in pore bodies consequently the aspect ratio and the coordination number increased and decreased respectively after the compression by comparing the two scco2 flooding tests performed under different stress conditions it was found that the scco2 volume increased after the compression even though the pore volume had decreased this was mainly because piston like advances were reinforced as the scco2 pressure gradient increased due to the reduction in permeability and void cross sectional area of the sample even though the hindrance caused by the increased threshold capillary pressures was also observed locally it was not as frequent as the reinforcement mentioned earlier during the subsequent imbibition tests both piston like advances and snap off events were facilitated after the compression owing to the increase in the threshold capillary pressures since the sandpack sample had a large coordination number and small aspect ratio additional scco2 trapping was not frequently observed on the other hand the facilitated snap off contributed to the brine to scco2 displacement by providing additional mtms for the piston like advances and pore body filling events and fragmenting large scco2 clusters into smaller globules consequently the amount of trapped scco2 decreased after the compression even though additional scco2 was stored in the pore space by the preceding scco2 flooding test by comparing the scco2 configurations acquired at different stages of the dissolution process it was found that mtms moved from small pores and throats toward the center of large pores resulting in a reduction in the residual scco2 volume meanwhile snap off was triggered in throats as scco2 molecules were dissolved into the aqueous phase through the ams since most of the brine scco2 interfaces were located in throats corners and small pores scco2 dissolution was more favored in small pore elements in relation to the macroscopic flow properties the water relative permeability during the dissolution process decreased with the increase in the effective stress this could be ascribed to the finding that the small pores occupied by the water phase deformed relatively more prominently than the large pores overall the scco2 dissolution showed certain similarities to the imbibition process even though the pore and molecular scale mechanisms were completely different credit authorship contribution statement rui wang conceptualization methodology data curation investigation software formal analysis writing original draft writing review editing maziar arshadi conceptualization methodology supervision writing review editing mohammad piri conceptualization funding acquisition methodology project administration resources supervision writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment we gratefully acknowledge the financial support of hess corporation and the university of wyoming 
51,the inclusion of a priori information is helpful to obtain high resolution parameter identifications a common practice is to exploit structural information in the search for detailed hydrogeological characterizations of subsurface in this study we proposed to incorporate cross gradients as a constraint in nonlinear inverse problems the resultant inversion scheme is successfully applied to three synthetic experiments and one laboratory rock block experiment with structural similarities in hydraulic parameters and also compared to estimated results with a traditional method our results show similar estimated hydraulic parameters whether the objective function has the cross gradients operator or not the improvements are only enhanced when assuming one type of parameter is completely known the limited improvement is proved by the small contribution from the cross gradients term in the objective function therefore the cross gradients constraint is a weak structural constraint the main reason is that drawdown data has already contained correlated hydrogeological parameter information estimated results substantiate the rationalization for a simplified assumption that hydraulic conductivity and specific storage are treated as mutual independent variables keywords structural similarity hydraulic tomography cross gradients numerical simulation inverse problem data availability data will be made available on request 1 introduction hydrogeological parameter information has been widely applied to contemporary issues including groundwater dynamic monitoring pollutant transport and water resource evaluation the solution of hydrogeological problems depends on accurate descriptions of heterogeneity to circumvent weaknesses of conventional pumping tests and efficiently gain spatial distributions of hydrogeological parameters gottlieb and dietrich 1995 proposed a sequential aquifer test scheme hydraulic tomography ht it collects numerous datasets of pressure responses by changing pumping positions which can greatly settle the non uniqueness issue and reveal details of heterogeneous parameter fields mao et al 2013c a lot of researches have contributed to efficiently interpret responses from ht tests over the last two decades for example yeh and liu 2000 developed sequential successive linear estimator ssle on the basis of geostatistics and further developed simultaneous successive linear estimator simsle where parameters were estimated by considering all pumping tests at the same time regardless of the sequence of pumping tests mao et al 2013b xiang et al 2009 based on the relation between the peak time of a recorded transient pressure curve and the diffusivity of the investigated system brauchler et al 2003 proposed travel time inversion of hydraulic or pneumatic tests afterwards an explicit trade off between measurement misfits and subjective a priori information was presented in an interactive bayesian geostatistical inverse approach in the determination of structural parameters or in the selection of zones interactive opportunities allowed practitioners to audit the algorithm and override decisions fienen et al 2008 additionally schöniger et al 2012 adapted ensemble kalman filters enkfs by combining with gaussian anamorphosis ga for parameter estimations in groundwater applications ga achieves implicit pseudo linearization of drawdown as a function of log conductivity which improves predictions of flows however a priori information of aquifers is still not sufficiently considered or neglected in these inversion methods geological expertise judgments as a priori information have been an auxiliary means while inverting response datasets such information results in geologically meaningful solutions about parameter identifications the significance has been investigated through laboratory sandbox and field experiments zhao and illman 2017 zhao et al 2016 fracture geometry connectivity and matrix hydraulic parameters of varying accuracies were utilized as a priori information on transient hydraulic tomography analyses in fractured rocks by zhao et al 2021 results indicated the importance of incorporating accurate geological data when drawdown data are sparse and not available within the matrix air permeameter measurements on outcrops of unconsolidated sediments can be a proxy for aquifer heterogeneity it was rescaled as a linear correction for low resolution subsurface borehole data to identify undetected small scale geological structures rogiers et al 2013 the sharp boundaries between geologic structures are often smoothed out and these abrupt jumps can be functioned as a thresholding or clustering problem in order to minimize the correlation of hydraulic parameters in different large scale geological structures li et al 2019 an alternative approach is based on the development of geostatistical concept for example zha et al 2017 introduced a general statistical framework containing site specific large scale spatial patterns of geologic features adjusted by conditional mean and covariance park 2020 presented an adaptation evolution strategy in conjunction with geostatistical covariance functions and simultaneous enkfs hwang et al 2021 provided an adaptive zone based refinement scheme to parsimoniously select zones via refinement indicators under certain conditions e g in fractured media the image guided inversion has been utilized to overcome distribution discontinuities of hydraulic properties through structural features for example seismic and ground penetrating radar sections or geological cross sections obtained from digital image analysis techniques were applied to aid inversion processes the structural constraints were imposed via a weighted four direction smoothing matrix along structural features in the regularizer soueid ahmed et al 2015 hydraulic conductivity k and specific storage ss are regarded as conventional parameters to depict the subsurface heterogeneity and we are inspired by characterizations of correlated hydrogeological parameters in other words spatial distributions of k and ss are structurally similar and a correlation between them can be found in certain geological formations e g facies zones faults paleochannels and karst conduits kuang et al 2020 for instance during two large scale cross hole pumping tests in mizunami japan three dimensional k and ss tomograms showed several consistent high k and low ss zones which appeared to delineate fault zones and their connectivity illman et al 2009 another laboratory experiment through multiple pumping tests in a fractured dolomitic rock block yielded similar high k and low ss zones that captured the fracture pattern and their connectivity quite well sharmeen et al 2012 in summary none of inversion methods mentioned above consider correlations between hydrogeological parameters on the contrary k and ss are assumed as mutual independent random variables whether incorporating geological information or not we expect to seek for a parameter estimation methodology imposing correlations to constrain inversion processes and enhance structural similarities this will perhaps improve property imaging and obtain high resolution results this requires the imposition of physically matching conditions at structural boundaries it is worth noting that not all property distributions in the subsurface are structurally coincident and considering flexibility in model reconstructions is necessary in geological environments haber and gazit 2013 the concept of cross gradients constraint developed by gallardo and meju 2003 assists us in expanding this idea their robust inversion scheme absorbed cross gradients of electrical resistivity and seismic velocity as constraints to investigate resistivity velocity relationships in complex environments meju et al 2003 the structural conformity incorporation led to geologically meaningful solutions without additionally forcing or assuming relationships between them gallardo and meju 2004 the cross gradients structure coupled approach can also be applied to any combinations of independent geophysical methods including but not limited to electrical resistivity and ground penetrating radar methods linde et al 2006 ground penetrating radar and seismic methods linde et al 2008 electromagnetic and acoustic methods zhang et al 2020 gravity and magnetic methods vatankhah et al 2022 and even multiple cross gradient joint inversion for geospectral imaging gallardo 2007 gallardo et al 2012 moreover cross gradients are even applied to medical imaging like ct image guided electrical impedance tomography li et al 2020 based on the cross gradients definition it is feasible to fuse it into hydraulic tomography this study aims to fulfill reconstructions of hydrogeological parameter distributions we define a structural link and integrate it in a traditional least square objective function three synthetic experiments and a laboratory dataset are employed for validations and estimated parameters are compared with results from the traditional algorithm the effect of constraints is measured subsequently when one type of parameter k or ss distribution is known a priori finally we explore weak constraint mechanisms of the cross gradients constraint 2 methodology 2 1 groundwater flow equation groundwater flow in saturated and heterogeneous media can be described by the governing equation zhu and yeh 2005 1 k h q s s h t subject to boundary and initial conditions 2 h γ 1 h 1 k h n γ 2 q and h t 0 h 0 where k is hydraulic conductivity lt 1 h is hydraulic head l q is pumping rate t 1 ss is specific storage l 1 and t is time t h 1 is prescribed hydraulic head at dirichlet boundary γ1 q is specific flow rate l t at neumann boundary γ2 n is a unit vector normal to γ1 and γ2 and h 0 is initial hydraulic head the groundwater flow equation is solved with numerical methods here we choose finite element method supported by comsol multiphysics and resultant drawdown curves can serve as survey datasets in the parameter estimations comsol 2016 2 2 groundwater inverse algorithm for groundwater inverse problem classical least square inverse algorithm is referred to obtain distributions of k and ss exploiting observed hydraulic head data however if the aquifer is parameterized into a large number of model parameters the underdetermined problem results in infinite possible solutions yeh et al 2015 in such cases the inverse problem must be regularized mathematically it is commonly formulated as an optimization problem and the objective function is defined by the following expression aster et al 2005 viz minimize 3 φ h d t c data 1 h d α 2 m t w tr t w tr m m m ref t c ref 1 m m ref where h is computed hydraulic head d is observed hydraulic head α is a constant weighting factor controlling the level of smoothness m m f m s is model parameters i e logarithm of hydraulic conductivity m f and specific storage m s w tr is a discrete version of first order tikhonov regularization matrix acting on m m ref is reference model parameters based on a priori information and c data and c ref are diagonal covariance matrices eq 3 is nonlinear because of the nonlinear groundwater flow equation and thus the solution is achieved by linearization and iteration i e the solution at iteration k 1 is expressed as 4 m k 1 m k j k t c data 1 j k α 2 w tr t w tr c ref 1 1 j k t c data 1 h k d α 2 w tr t w tr m k c ref 1 m k m ref where j k j f k j s k is sensitivity matrix i e partial derivatives of observation data with respect to model parameters 2 3 gradient based measure of structural similarity the cross gradients function is defined as vector product of two gradients gallardo and meju 2011 5 τ m f m s where m f and m s are gradients of hydraulic conductivity and specific storage the direction of cross gradients vector conforms with right hand rule and it is consistent with the geometry of object the magnitude emphasizes morphological differences common structures are picked up when cross gradients are zero gallardo and meju 2011 for two dimensional cases x and y components of τ vanish we are interested in z component henceforth referred to as scalar τ gallardo and meju 2004 6 τ m f x m s y m f y m s x here derivatives are calculated using forward difference yielding the approximate formula 7 τ c 4 δ x δ y m f r m f c m s t m s c m f t m f c m s r m s c where subscripts c r and t denote the center right and top rectangular cell of the three cell scheme depicted in fig 1 δx and δy are horizontal and vertical cell dimensions after calculating the cross gradient value of each element τ can be assembled whereas elements corresponding to right and top boundaries are null because of incomplete three cell schemes 2 4 inverse formulation with cross gradients constraint based on the objective function it is redefined and subject to the cross gradients constraint τ m 0 gallardo and meju 2003 relevant approximate expressions computing derivative of cross gradients w cg are obtained from the two dimensional model 8 w cg f c τ c m f c τ c m f r τ c m f t 4 δ x δ y m s r m s t m s t m s c m s c m s r w cg s c τ c m s c τ c m s r τ c m s t 4 δ x δ y m f t m f r m f c m f t m f r m f c specifically w cg w cg f w cg s w cg f and w cg s are square matrices corresponding to each element in the model domain one by one and the order of matrix is equal to the total number of model elements for an arbitrary element that is in a row or column vector only the three elements corresponding to the three cell scheme may not be zero otherwise the row or column elements of the vector are null the cross gradients constraint is nonlinear and the solution requires by virtue of lagrange multiplier i e the solution at iteration k 1 is expressed as 9 m k 1 m k j k t c data 1 j k α 2 w tr t w tr c ref 1 1 j k t c data 1 h k d α 2 w tr t w tr m k c ref 1 m k m ref w cg k t β k where lagrange multiplier is given by 10 β k w cg k j k t c data 1 j k α 2 w tr t w tr c ref 1 1 w cg k t 1 w cg k j k t c data 1 j k α 2 w tr t w tr c ref 1 1 j k t c data 1 h k d α 2 w tr t w tr m k c ref 1 m k m ref τ k the first term in braces of eq 9 corresponds to the regularized least square solution while the second term is the linking contribution from the cross gradients constraint the proportion of cross gradients in the objective function is controlled spontaneously by lagrange multiplier β k the search for the optimal solution is started with an initial model m 0 which is then updated at every iterative step a matlab code is written with the assistance of comsol multiphysics to implement presented methodology matching scientific and engineering applications comsol 2016 mao et al 2016 3 synthetic and laboratory experiments in this section three synthetic aquifer models were designed to explore efficiencies of the cross gradients constraint in parameter estimations in all models there are two homogeneous zones with structural similarities one zone with a high k and low ss represented for a geological anomaly or specific geological structure e g paleochannel or fracture zone the other one was a low k and high ss medium as background hydraulic head data was collected by performing a series of pumping tests moreover a laboratory rock block experiment was retested with the newly developed approach sharmeen et al 2012 the specific descriptions of experiments are summarized in the following sections 3 1 square anomaly model this was a toy model 60 60 m2 with a square anomaly 20 20 m2 in the center fig 2a the whole simulation domain was discretized into 3600 elements of 1 1 m2 in size which mapped to different parameter values k and ss of the anomaly were assumed to be 10 1 m s and 10 5 m 1 while the background was equal to 10 3 m s and 10 3 m 1 constant hydraulic head boundaries of 1000 m were prescribed around the domain and initial hydraulic head was spatially uniform with 1000 m nine wells were symmetrically distributed and three pumping tests were induced at well w02 w04 and w05 marked with black open circles the constant pumping rate was set to be 0 01 m3 s lasting for 600 s transient pressure responses were recorded every 5 s at the rest eight pressure monitoring ports on each simulated drawdown time curve five data points were selected at time 10 s 60 s 120 s 300 s and 600 s eventually drawdown datasets with the total number of 120 3 8 5 were sampled to estimate k and ss distributions mao et al 2013a sun et al 2013 the effective values of k and ss calculated from above drawdown datasets were 10 3 m s and 5 10 4 m 1 and they were assigned as the initial values different initial values were tested and the estimated k and ss distributions were not significantly changed therefore only the inversion results from the above mentioned initial values were presented 3 2 paleochannel model in this model there was a fictitious river estuary with changing paleochannel widths fig 2b the experiment was designed to underscore complex models the simulation domain 80 45 m2 was discretized into 3600 square elements with the edge length of 1 m k and ss of the paleochannel were 2 10 3 m s and 10 4 m 1 while surrounding sediments were 10 4 m s and 2 10 3 m 1 all four boundaries were set to be constant hydraulic head boundaries of 1000 m and assuming that groundwater was hydrostatic prior to the beginning of each pumping test i e initial hydraulic head was 1000 m there were 35 wells evenly distributed all over the domain where 11 wells were located inside the paleochannel three independent pumping tests were conducted at well w07 w18 and w29 the constant pumping rate was 0 002 m3 s with a duration of 2 h transient pressure responses were recorded with a time step of 60 s five data points were selected on each drawdown curve covering preliminary intermediate and steady state time periods making a total of 510 data points 3 34 5 initial k and ss were 5 10 4 m s and 1 4 10 3 m 1 3 3 fracture zone model this experiment was employed to investigate feasibility of detecting fracture zones and their connectivity the synthetic model 0 8 0 45 m2 was discretized into 3600 elements with dimensions of 1 1 cm2 there was one horizontal and two vertical orthogonal fracture zones embedded in the rock matrix fig 2c notice that synthetic fracture zones of 4 cm in width were deliberately wider than the laboratory experiments the reason for this setting was to construct gradients when calculating τ k and ss of fracture zones were 2 10 4 m s and 10 3 m 1 while the surrounding rock matrix was 10 5 m s and 2 10 2 m 1 left and right boundaries were constant hydraulic head of 1000 m and remaining two boundaries were prescribed as no flow boundaries initial conditions were set to be spatially uniform hydraulic head of 1000 m here 11 wells were arranged along the fracture three pumping tests were induced at well w07 w18 and w29 sequentially and the pumping rate was set at 10 cm3 s the total simulation time and time step were 300 s and 3 s initial k and ss values were 3 10 5 m s and 1 9 10 2 m 1 with observed hydraulic head data the total number of 510 k and ss distributions were identified subsequently to investigate extents and interconnectivity of the fracture zones 3 4 laboratory rock block model the section was based on the previous transient hydraulic tomography analysis conducted by sharmeen et al 2012 in a fractured dolostone we further simplified this model into 2d to estimate transmissivity t and storativity s the model domain was consistent with the rock block 91 5 cm 60 5 cm fig 2d the discrete mesh and port deployment are the same as sharmeen et al 2012 so that results could be compared the finer elements were located along the ports and the coarser elements were situated near boundaries fig 2d as observed in the three pumping tests port 3 5 and 7 the drawdown was unmeasurable at the matrix observation ports compared to the fractures same drawdown datasets were utilized with the total number of 450 3 pumping tests 30 observation ports 5 data points from drawdown curve to estimate t and s distributions simultaneously the initial guessed t and s were 7 10 6 m2 s and 2 5 10 2 more detailed information on the rock block facilities and laboratory experiments were provided in sharmeen et al 2012 4 results hydrogeological parameters were estimated simultaneously with the only smoothing constraint added in the traditional ht inversion and the cross gradients constraint included in the second attempt to ensure comparability of parameter estimation results the two estimations converged to the same number of iterations and all settings including selected observation data initial values of model parameters and the weighting factor of smoothness were the same besides distributions of estimated k and ss contour maps of cross gradients τ were also plotted 4 1 k and ss estimates of square anomaly model as shown in fig 3 least square inversion method has correctly reproduced the position of anomaly comparing with the conventional method cross gradients constraint inversion method provides similar estimated results of k and ss and constraints are valid indeed especially for ss like in fig 3b the pattern of ss is relatively centrosymmetric in line with the true square anomaly model but the ss anomaly estimated with cross gradients constraint inversion method fig 3e appears to have clearly received a signal from estimated k in the meantime and eventually is corrected symmetrically along the sub diagonal obviously the correction of similarity is transmitted via the cross gradients constraint in addition fig 3c is the τ contour map assembled by k and ss in fig 3a and b here τ is not involved in parameter estimations and it only serves as an indicator to evaluate structural similarities comparing with fig 3f it is affected by pumping locations and its distribution is also symmetrical along the sub diagonal while τ values in fig 3f approach to zero throughout the domain in accordance with minimization of the objective function what s more cross gradients contour plots magnify structural differences visually between k and ss which helps to understand structural constraints objective function values are slightly less than those of least square inversion method with the cross gradients constraint added and each term of the objective function has small differences between these two methods hence objective function values and each term are shown in fig 10a only with cross gradients constraint inversion method the data misfit фdata accounts for a significant proportion of the objective function ф and there is a consistent descending trend from 7 6 to 3 6 10 4 and 1 8 10 3 tikhonov regularization фtr has been roughly static around 10 3 owing to homogeneous initial fields the cross gradients фcg is extremely small at the first iteration at the second iteration the pattern of heterogeneity has been revealed and this term ascends to a peak value 1 5 10 2 the following iterations reserve this original pattern and modify estimated results gradually and meanwhile фcg decreases steadily to 1 3 10 5 which is only 1 of ф 4 2 k and ss estimates of paleochannel model cross gradients constraint inversion results fig 4d and e are slightly improved in contrast with least square inversion results fig 4a and b for paleochannel model in fig 4d and e the high k and low ss zone in the upper right corner extends to right and top constant hydraulic head boundaries and the residual initial value distribution in the upper left and lower right corners is also corrected to match true parameter values of surrounding sediments however the estimation in the lower left corner of the domain is like a blind area which is directly related to absence of observation wells fig 2b the presence of transition zones near paleochannel boundaries is also ineradicable comparing with square anomaly model improvements in structural similarities between k and ss become evident with the cross gradients constraint estimated ss also accommodates to heterogeneity of k which is indicated by wu et al 2005 from cross correlation analysis as well the temporal and spatial distribution of cross correlations suggests that observed hydraulic head is strongly affected by k over a large area and has little relation with ss field mao et al 2013a these features are preserved even imposing the cross gradients constraint in addition nonzero τ values are concentrated along paleochannel boundaries fig 4c while τ shown in fig 4f are approximate to zero throughout the domain indicating that the cross gradients constraint has enhanced structural similarities between k and ss and thus identifications of geological structures to further quantify the effect of parameter estimations for the proposed algorithm the misfit at each iteration is shown in fig 10b the variation and magnitude of each term is the same as the square anomaly model fig 10a ф and dominating фdata are decreasing synchronously from 8 4 to 4 9 10 3 and 5 1 10 4 as iteration progresses фtr is steady around 4 10 3 and its moderative growth trend is inconspicuous in a logarithmic coordinate фcg increases from zero to 1 2 10 2 and then descends to 3 3 10 5 4 3 k and ss estimates of fracture zone model fig 5a and d are k tomograms obtained without and with the cross gradients constraint fig 5b and e show estimated ss tomograms simultaneously the emergence of high k and low ss zones reflects the fracture patterns and connectivity features especially in the central portion of fracture in particular final k tomogram reveals less details near top and bottom no flow boundaries and fracture zones extend to left and right constant hydraulic head boundaries however the connectivity of fracture zones represented by estimated ss is contrary in the vicinity of two types of boundaries and there are only slight improvements near left and right constant hydraulic head boundaries with cross gradients constraint inversion method these defects are also reflected in figs 3 6 presented by sharmeen et al 2012 which includes k and ss tomograms computed using synthetic and real data reviewing the τ contour plot fig 5c nonzero values are not only mapped to fracture but also to wider areas along the fracture their absolute values are also much larger than that of square anomaly and paleochannel models as a result of great magnitudes of parameter gradients in the fracture zone model even so they are almost zero eventually with the cross gradients constraint as shown in fig 5f except for slow growing фtr from 4 5 10 5 to 3 9 10 4 the variation trend of objective function fig 10c is the same as the first two models fig 10a and b ф and фdata are decreasing synchronously from 3 8 10 2 to 5 3 10 4 and 1 4 10 4 as iteration progresses фcg increases from zero to 1 2 10 4 and then descends to 5 8 10 6 as results are iteratively updated heterogeneity becomes clear and smoothness constraints come into play thus фtr should also increase gradually it is just that boundaries of specific geological structures in the synthetic models are sharp and corresponding distributions of estimated parameters should avoid containing transition zones as much as possible hence the weight α of smoothness constraints is set at a smaller value for example 10 5 in the first two models and 10 6 in the third model and the increasing trend of фtr is moderate for the same reason the occurrence of peak value for фcg should also be a gradual process not accompanied by the second iteration after crossing the peak value фcg decreased slowly as expected 4 4 t and s estimates of laboratory rock block t and s tomograms are shown in fig 6 it is able to capture the general fracture pattern bordered by a low t zone fig 6a and d the low s zone mapped on the s tomogram fig 6b and e generally corresponds with the fracture pattern within the rock sample the mapped fracture pattern near the boundaries is not distinct which is limited by observation port locations the improvement of parameter estimation with the cross gradients constraint is mainly reflected in the characterization of horizontal fracture such as enhancing its connectivity it is noted that in areas close to port 3 the horizontal fracture does not extend continuously to port 1 which can be explained by the cross correlation analysis between observed head and hydraulic properties there is a lack of sufficient observation data to cover this area the τ contour plots fig 6c and f reflect the structural similarity between t and s before and after imposed the cross gradients constraint the objective function and its terms at each iteration are shown in fig 10d the variation trend is the same as the three synthetic models and the difference between ф and фdata is even less 5 discussion from the estimated results of four experiments with or without the cross gradients constraint it can be seen that the improvement of hydrogeological parameter estimations is limited as the reasons for this limitation are unclear further discussions are needed 5 1 k or ss estimate with a priori information in order to measure the role of cross gradients constraint we designed a series of scenarios based on the three synthetic experiments different from estimating completely unknown k and ss simultaneously it was assumed that ss distribution was known then k distribution was estimated and vice versa the a priori information here is more idealized and more accurate than the geological stratification model zhao and illman 2021 and the geological zonation approach zha et al 2017 zhao and illman 2017 zhao et al 2016 in this situation like ss is treated as known and corresponding partial derivatives with respect to such parameter do not exist like j s and w cg s eqs 9 and 10 are still generic and the only thing is to pay special attention to the number of rows and columns of each matrix and their correspondences i e the solution of k at iteration k 1 is expressed as 11 m f k 1 m f k j f k t c data 1 j f k α 2 w tr f t w tr f c ref f 1 1 j f k t c data 1 h k d α 2 w tr f t w tr f m f k c ref f 1 m f k m ref f w cg f k t β k where lagrange multiplier is given by 12 β k w cg f k j f k t c data 1 j f k α 2 w tr f t w tr f c ref f 1 1 w cg f k t 1 w cg f k j f k t c data 1 j f k α 2 w tr f t w tr f c ref f 1 1 j f k t c data 1 h k d α 2 w tr f t w tr f m f k c ref f 1 m f k m ref f τ k w tr w tr f w tr s and c ref c ref f c ref s are partitioned matrices for square anomaly model with least square inversion method when known one type of parameter to estimate another type of parameter obtained imaging k tomogram in fig 7a and ss tomogram in fig 7c is better than the simultaneous inversion amplitudes of the true model are better retrieved and smoothing effects are weakened at interfaces of two media as for τ derived from the estimation and another true distribution fig 7b and d nonzero values are concentrated on boundaries of the square anomaly because gradients and corresponding τ inside two homogeneous zones are zero everywhere the alternation of positive or negative values is determined by the gradient direction of estimated parameters and they also obey the same symmetrical distribution along the sub diagonal line of domain as fig 3c correspondingly fig 7e h are results with cross gradients constraint inversion method where clear boundaries of square anomaly have emerged as shown in fig 7e estimated k is slightly flawed near right and top boundaries of the anomaly comparing fig 7c and g differences between the two are not easy to perceive but after imposing the cross gradients constraint these nonzero τ values along boundaries of the anomaly disappear eventually see fig 7f and h the constraints do play their part at structural boundaries to guide similar structures but it makes no sense in the rest of homogeneous zones similar to fig 7 figs 8 and 9 are estimated k or ss for paleochannel and fracture zone models with a priori geological information for the paleochannel model the low resolution still exists in the lower left corner of the domain comparing figs 4 and 8 it can be found that the effect of a priori geological information is much stronger than the cross gradients constraint although the paleochannel model is indeed not as complex as the fracture zone model the improvement from the cross gradients constraint for the former model is not better than the latter for fracture zone model fracture zones of high k and low ss extend to surrounding boundaries and intersect the entire rock matrix estimated ss values corresponding to fracture zones differ slightly from the rock matrix with known k distribution фdata at the first iteration for fracture zone model is smaller than that of simultaneous estimation fig 5 or k estimation fig 9a and c about less than one tenth moreover the sensitivity of observed hydraulic head with respect to ss j s is small not only in value but also in scope of influence mao et al 2013a wu et al 2005 this means that the updated ss is extremely small at each iteration i e fine tuning in fig 9b and d although the boundaries of fracture zones have been grasped with the help of the cross gradients constraint and known k distribution 5 2 weak constraint mechanism the cross gradients constraint contributes to the improvements of estimated results especially in the case of additional a priori geological information however its effect is subtle in delineating anomaly boundaries the relative magnitude of фcg and ф at each iteration in fig 10 is compelling evidence and фcg is far less than other terms of objective function taking the square anomaly model as an example fig 7e and f fig 11 shows iterative objective function values when k is estimated known ss distribution with cross gradients constraint inversion method which is another evidence it can be said that the cross gradients constraint is a weak constraint benavoli et al 2006 comparing to image guided inversion by soueid ahmed et al 2015 the algorithm does not deliberately control spatial distributions of estimated parameters the operator only tries to carry more similarity information besides what buried in the hydraulic head data if observation data is reduced appropriately parameter estimation results may become worse then imposing the cross gradients constraint can potentially improve estimated results therefore the first square anomaly model was continued to take as an example to validate the conjecture only one pumping tests was trigged at well w02 fig 2a near the left boundary of the anomaly and estimated results are shown in fig 12 both algorithms capture the general pattern of parameter distributions but the cross gradients constraint does not provide more details about parameter distributions when imposing the cross gradients constraint we still utilize observation head and no more data types are added the similar estimated results indicate the correlation between k and ss already exists in the head data and this similarity will participate in the inversion process whether the cross gradients operator is included or not the addition of cross gradients in the objective function only slightly enhances this correlated information if the cross gradients constraint is imposed on the basis of adding other data sources e g geophysical data it is bound to achieve desired results for example lochbühler et al 2013 inverted cross hole ground penetrating radar gpr travel times jointly with hydraulic tomography data as well as with tracer mean arrival times to retrieve the 2d distribution of gpr velocities and hydraulic conductivities incorporating the gpr data improved the resolution and localization properties of the estimated hydraulic conductivity field 6 conclusions in this research we tried to utilize structure information and implement it with a new parameter estimation method based on the cross gradients structural constraint structural similarities between multiple types of hydraulic property distributions are emphasized by imposing the cross gradients constraint the proposed algorithm is tested with three synthetic ht experiments and further validated with laboratory rock block ht conducted by sharmeen et al 2012 the study leads to the following major findings the experiments are designed to represent geologically consistent parameter distribution patterns estimated k is satisfactory with traditional inversion method after imposing the cross gradients constraint it only has slight improvements and the improvement for ss is better than that of k comparing with least square inversion method the depiction of structures boundaries is moderately accurate in cross gradients constraint inversion results it is especially distinct under conditions of exactly knowing one type of parameters whether estimating k and ss simultaneously with cross gradients constraint inversion method or separately the improvement of estimated results is limited the cross gradients accounts for a lower proportion of the objective function compared with other terms especially when estimating k or ss with a priori geological information using the square anomaly model as an example it has been further demonstrated that the cross gradients constraint is a weak constraint even if reducing the number of observation data drawdown data is a single data source for k and ss estimations which already contains spatial distribution and structural similarity information among hydrogeological parameters even if imposing the additional cross gradients constraint and considering correlations between k and ss estimation improvements are still limited profound breakthroughs may be by virtue of other geophysical means superimposing data sources we will explore this possibility in future research credit authorship contribution statement ruijue zhao formal analysis visualization writing original draft qingrong xiong project administration writing review editing zaibin liu resources writing review editing shiliang liu validation software supervision xinmin ma investigation data curation deqiang mao methodology writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper deqiang mao reports financial support was provided by shandong national science foundation deqiang mao reports was provided by national natural science foundation of china acknowledgments the corresponding author would like to thank the support of shandong national science foundation zr2019mee109 and national science foundation 42177056 we would like to thank the laboratory data provided by dr walter illman and mrs huawen zhao 
51,the inclusion of a priori information is helpful to obtain high resolution parameter identifications a common practice is to exploit structural information in the search for detailed hydrogeological characterizations of subsurface in this study we proposed to incorporate cross gradients as a constraint in nonlinear inverse problems the resultant inversion scheme is successfully applied to three synthetic experiments and one laboratory rock block experiment with structural similarities in hydraulic parameters and also compared to estimated results with a traditional method our results show similar estimated hydraulic parameters whether the objective function has the cross gradients operator or not the improvements are only enhanced when assuming one type of parameter is completely known the limited improvement is proved by the small contribution from the cross gradients term in the objective function therefore the cross gradients constraint is a weak structural constraint the main reason is that drawdown data has already contained correlated hydrogeological parameter information estimated results substantiate the rationalization for a simplified assumption that hydraulic conductivity and specific storage are treated as mutual independent variables keywords structural similarity hydraulic tomography cross gradients numerical simulation inverse problem data availability data will be made available on request 1 introduction hydrogeological parameter information has been widely applied to contemporary issues including groundwater dynamic monitoring pollutant transport and water resource evaluation the solution of hydrogeological problems depends on accurate descriptions of heterogeneity to circumvent weaknesses of conventional pumping tests and efficiently gain spatial distributions of hydrogeological parameters gottlieb and dietrich 1995 proposed a sequential aquifer test scheme hydraulic tomography ht it collects numerous datasets of pressure responses by changing pumping positions which can greatly settle the non uniqueness issue and reveal details of heterogeneous parameter fields mao et al 2013c a lot of researches have contributed to efficiently interpret responses from ht tests over the last two decades for example yeh and liu 2000 developed sequential successive linear estimator ssle on the basis of geostatistics and further developed simultaneous successive linear estimator simsle where parameters were estimated by considering all pumping tests at the same time regardless of the sequence of pumping tests mao et al 2013b xiang et al 2009 based on the relation between the peak time of a recorded transient pressure curve and the diffusivity of the investigated system brauchler et al 2003 proposed travel time inversion of hydraulic or pneumatic tests afterwards an explicit trade off between measurement misfits and subjective a priori information was presented in an interactive bayesian geostatistical inverse approach in the determination of structural parameters or in the selection of zones interactive opportunities allowed practitioners to audit the algorithm and override decisions fienen et al 2008 additionally schöniger et al 2012 adapted ensemble kalman filters enkfs by combining with gaussian anamorphosis ga for parameter estimations in groundwater applications ga achieves implicit pseudo linearization of drawdown as a function of log conductivity which improves predictions of flows however a priori information of aquifers is still not sufficiently considered or neglected in these inversion methods geological expertise judgments as a priori information have been an auxiliary means while inverting response datasets such information results in geologically meaningful solutions about parameter identifications the significance has been investigated through laboratory sandbox and field experiments zhao and illman 2017 zhao et al 2016 fracture geometry connectivity and matrix hydraulic parameters of varying accuracies were utilized as a priori information on transient hydraulic tomography analyses in fractured rocks by zhao et al 2021 results indicated the importance of incorporating accurate geological data when drawdown data are sparse and not available within the matrix air permeameter measurements on outcrops of unconsolidated sediments can be a proxy for aquifer heterogeneity it was rescaled as a linear correction for low resolution subsurface borehole data to identify undetected small scale geological structures rogiers et al 2013 the sharp boundaries between geologic structures are often smoothed out and these abrupt jumps can be functioned as a thresholding or clustering problem in order to minimize the correlation of hydraulic parameters in different large scale geological structures li et al 2019 an alternative approach is based on the development of geostatistical concept for example zha et al 2017 introduced a general statistical framework containing site specific large scale spatial patterns of geologic features adjusted by conditional mean and covariance park 2020 presented an adaptation evolution strategy in conjunction with geostatistical covariance functions and simultaneous enkfs hwang et al 2021 provided an adaptive zone based refinement scheme to parsimoniously select zones via refinement indicators under certain conditions e g in fractured media the image guided inversion has been utilized to overcome distribution discontinuities of hydraulic properties through structural features for example seismic and ground penetrating radar sections or geological cross sections obtained from digital image analysis techniques were applied to aid inversion processes the structural constraints were imposed via a weighted four direction smoothing matrix along structural features in the regularizer soueid ahmed et al 2015 hydraulic conductivity k and specific storage ss are regarded as conventional parameters to depict the subsurface heterogeneity and we are inspired by characterizations of correlated hydrogeological parameters in other words spatial distributions of k and ss are structurally similar and a correlation between them can be found in certain geological formations e g facies zones faults paleochannels and karst conduits kuang et al 2020 for instance during two large scale cross hole pumping tests in mizunami japan three dimensional k and ss tomograms showed several consistent high k and low ss zones which appeared to delineate fault zones and their connectivity illman et al 2009 another laboratory experiment through multiple pumping tests in a fractured dolomitic rock block yielded similar high k and low ss zones that captured the fracture pattern and their connectivity quite well sharmeen et al 2012 in summary none of inversion methods mentioned above consider correlations between hydrogeological parameters on the contrary k and ss are assumed as mutual independent random variables whether incorporating geological information or not we expect to seek for a parameter estimation methodology imposing correlations to constrain inversion processes and enhance structural similarities this will perhaps improve property imaging and obtain high resolution results this requires the imposition of physically matching conditions at structural boundaries it is worth noting that not all property distributions in the subsurface are structurally coincident and considering flexibility in model reconstructions is necessary in geological environments haber and gazit 2013 the concept of cross gradients constraint developed by gallardo and meju 2003 assists us in expanding this idea their robust inversion scheme absorbed cross gradients of electrical resistivity and seismic velocity as constraints to investigate resistivity velocity relationships in complex environments meju et al 2003 the structural conformity incorporation led to geologically meaningful solutions without additionally forcing or assuming relationships between them gallardo and meju 2004 the cross gradients structure coupled approach can also be applied to any combinations of independent geophysical methods including but not limited to electrical resistivity and ground penetrating radar methods linde et al 2006 ground penetrating radar and seismic methods linde et al 2008 electromagnetic and acoustic methods zhang et al 2020 gravity and magnetic methods vatankhah et al 2022 and even multiple cross gradient joint inversion for geospectral imaging gallardo 2007 gallardo et al 2012 moreover cross gradients are even applied to medical imaging like ct image guided electrical impedance tomography li et al 2020 based on the cross gradients definition it is feasible to fuse it into hydraulic tomography this study aims to fulfill reconstructions of hydrogeological parameter distributions we define a structural link and integrate it in a traditional least square objective function three synthetic experiments and a laboratory dataset are employed for validations and estimated parameters are compared with results from the traditional algorithm the effect of constraints is measured subsequently when one type of parameter k or ss distribution is known a priori finally we explore weak constraint mechanisms of the cross gradients constraint 2 methodology 2 1 groundwater flow equation groundwater flow in saturated and heterogeneous media can be described by the governing equation zhu and yeh 2005 1 k h q s s h t subject to boundary and initial conditions 2 h γ 1 h 1 k h n γ 2 q and h t 0 h 0 where k is hydraulic conductivity lt 1 h is hydraulic head l q is pumping rate t 1 ss is specific storage l 1 and t is time t h 1 is prescribed hydraulic head at dirichlet boundary γ1 q is specific flow rate l t at neumann boundary γ2 n is a unit vector normal to γ1 and γ2 and h 0 is initial hydraulic head the groundwater flow equation is solved with numerical methods here we choose finite element method supported by comsol multiphysics and resultant drawdown curves can serve as survey datasets in the parameter estimations comsol 2016 2 2 groundwater inverse algorithm for groundwater inverse problem classical least square inverse algorithm is referred to obtain distributions of k and ss exploiting observed hydraulic head data however if the aquifer is parameterized into a large number of model parameters the underdetermined problem results in infinite possible solutions yeh et al 2015 in such cases the inverse problem must be regularized mathematically it is commonly formulated as an optimization problem and the objective function is defined by the following expression aster et al 2005 viz minimize 3 φ h d t c data 1 h d α 2 m t w tr t w tr m m m ref t c ref 1 m m ref where h is computed hydraulic head d is observed hydraulic head α is a constant weighting factor controlling the level of smoothness m m f m s is model parameters i e logarithm of hydraulic conductivity m f and specific storage m s w tr is a discrete version of first order tikhonov regularization matrix acting on m m ref is reference model parameters based on a priori information and c data and c ref are diagonal covariance matrices eq 3 is nonlinear because of the nonlinear groundwater flow equation and thus the solution is achieved by linearization and iteration i e the solution at iteration k 1 is expressed as 4 m k 1 m k j k t c data 1 j k α 2 w tr t w tr c ref 1 1 j k t c data 1 h k d α 2 w tr t w tr m k c ref 1 m k m ref where j k j f k j s k is sensitivity matrix i e partial derivatives of observation data with respect to model parameters 2 3 gradient based measure of structural similarity the cross gradients function is defined as vector product of two gradients gallardo and meju 2011 5 τ m f m s where m f and m s are gradients of hydraulic conductivity and specific storage the direction of cross gradients vector conforms with right hand rule and it is consistent with the geometry of object the magnitude emphasizes morphological differences common structures are picked up when cross gradients are zero gallardo and meju 2011 for two dimensional cases x and y components of τ vanish we are interested in z component henceforth referred to as scalar τ gallardo and meju 2004 6 τ m f x m s y m f y m s x here derivatives are calculated using forward difference yielding the approximate formula 7 τ c 4 δ x δ y m f r m f c m s t m s c m f t m f c m s r m s c where subscripts c r and t denote the center right and top rectangular cell of the three cell scheme depicted in fig 1 δx and δy are horizontal and vertical cell dimensions after calculating the cross gradient value of each element τ can be assembled whereas elements corresponding to right and top boundaries are null because of incomplete three cell schemes 2 4 inverse formulation with cross gradients constraint based on the objective function it is redefined and subject to the cross gradients constraint τ m 0 gallardo and meju 2003 relevant approximate expressions computing derivative of cross gradients w cg are obtained from the two dimensional model 8 w cg f c τ c m f c τ c m f r τ c m f t 4 δ x δ y m s r m s t m s t m s c m s c m s r w cg s c τ c m s c τ c m s r τ c m s t 4 δ x δ y m f t m f r m f c m f t m f r m f c specifically w cg w cg f w cg s w cg f and w cg s are square matrices corresponding to each element in the model domain one by one and the order of matrix is equal to the total number of model elements for an arbitrary element that is in a row or column vector only the three elements corresponding to the three cell scheme may not be zero otherwise the row or column elements of the vector are null the cross gradients constraint is nonlinear and the solution requires by virtue of lagrange multiplier i e the solution at iteration k 1 is expressed as 9 m k 1 m k j k t c data 1 j k α 2 w tr t w tr c ref 1 1 j k t c data 1 h k d α 2 w tr t w tr m k c ref 1 m k m ref w cg k t β k where lagrange multiplier is given by 10 β k w cg k j k t c data 1 j k α 2 w tr t w tr c ref 1 1 w cg k t 1 w cg k j k t c data 1 j k α 2 w tr t w tr c ref 1 1 j k t c data 1 h k d α 2 w tr t w tr m k c ref 1 m k m ref τ k the first term in braces of eq 9 corresponds to the regularized least square solution while the second term is the linking contribution from the cross gradients constraint the proportion of cross gradients in the objective function is controlled spontaneously by lagrange multiplier β k the search for the optimal solution is started with an initial model m 0 which is then updated at every iterative step a matlab code is written with the assistance of comsol multiphysics to implement presented methodology matching scientific and engineering applications comsol 2016 mao et al 2016 3 synthetic and laboratory experiments in this section three synthetic aquifer models were designed to explore efficiencies of the cross gradients constraint in parameter estimations in all models there are two homogeneous zones with structural similarities one zone with a high k and low ss represented for a geological anomaly or specific geological structure e g paleochannel or fracture zone the other one was a low k and high ss medium as background hydraulic head data was collected by performing a series of pumping tests moreover a laboratory rock block experiment was retested with the newly developed approach sharmeen et al 2012 the specific descriptions of experiments are summarized in the following sections 3 1 square anomaly model this was a toy model 60 60 m2 with a square anomaly 20 20 m2 in the center fig 2a the whole simulation domain was discretized into 3600 elements of 1 1 m2 in size which mapped to different parameter values k and ss of the anomaly were assumed to be 10 1 m s and 10 5 m 1 while the background was equal to 10 3 m s and 10 3 m 1 constant hydraulic head boundaries of 1000 m were prescribed around the domain and initial hydraulic head was spatially uniform with 1000 m nine wells were symmetrically distributed and three pumping tests were induced at well w02 w04 and w05 marked with black open circles the constant pumping rate was set to be 0 01 m3 s lasting for 600 s transient pressure responses were recorded every 5 s at the rest eight pressure monitoring ports on each simulated drawdown time curve five data points were selected at time 10 s 60 s 120 s 300 s and 600 s eventually drawdown datasets with the total number of 120 3 8 5 were sampled to estimate k and ss distributions mao et al 2013a sun et al 2013 the effective values of k and ss calculated from above drawdown datasets were 10 3 m s and 5 10 4 m 1 and they were assigned as the initial values different initial values were tested and the estimated k and ss distributions were not significantly changed therefore only the inversion results from the above mentioned initial values were presented 3 2 paleochannel model in this model there was a fictitious river estuary with changing paleochannel widths fig 2b the experiment was designed to underscore complex models the simulation domain 80 45 m2 was discretized into 3600 square elements with the edge length of 1 m k and ss of the paleochannel were 2 10 3 m s and 10 4 m 1 while surrounding sediments were 10 4 m s and 2 10 3 m 1 all four boundaries were set to be constant hydraulic head boundaries of 1000 m and assuming that groundwater was hydrostatic prior to the beginning of each pumping test i e initial hydraulic head was 1000 m there were 35 wells evenly distributed all over the domain where 11 wells were located inside the paleochannel three independent pumping tests were conducted at well w07 w18 and w29 the constant pumping rate was 0 002 m3 s with a duration of 2 h transient pressure responses were recorded with a time step of 60 s five data points were selected on each drawdown curve covering preliminary intermediate and steady state time periods making a total of 510 data points 3 34 5 initial k and ss were 5 10 4 m s and 1 4 10 3 m 1 3 3 fracture zone model this experiment was employed to investigate feasibility of detecting fracture zones and their connectivity the synthetic model 0 8 0 45 m2 was discretized into 3600 elements with dimensions of 1 1 cm2 there was one horizontal and two vertical orthogonal fracture zones embedded in the rock matrix fig 2c notice that synthetic fracture zones of 4 cm in width were deliberately wider than the laboratory experiments the reason for this setting was to construct gradients when calculating τ k and ss of fracture zones were 2 10 4 m s and 10 3 m 1 while the surrounding rock matrix was 10 5 m s and 2 10 2 m 1 left and right boundaries were constant hydraulic head of 1000 m and remaining two boundaries were prescribed as no flow boundaries initial conditions were set to be spatially uniform hydraulic head of 1000 m here 11 wells were arranged along the fracture three pumping tests were induced at well w07 w18 and w29 sequentially and the pumping rate was set at 10 cm3 s the total simulation time and time step were 300 s and 3 s initial k and ss values were 3 10 5 m s and 1 9 10 2 m 1 with observed hydraulic head data the total number of 510 k and ss distributions were identified subsequently to investigate extents and interconnectivity of the fracture zones 3 4 laboratory rock block model the section was based on the previous transient hydraulic tomography analysis conducted by sharmeen et al 2012 in a fractured dolostone we further simplified this model into 2d to estimate transmissivity t and storativity s the model domain was consistent with the rock block 91 5 cm 60 5 cm fig 2d the discrete mesh and port deployment are the same as sharmeen et al 2012 so that results could be compared the finer elements were located along the ports and the coarser elements were situated near boundaries fig 2d as observed in the three pumping tests port 3 5 and 7 the drawdown was unmeasurable at the matrix observation ports compared to the fractures same drawdown datasets were utilized with the total number of 450 3 pumping tests 30 observation ports 5 data points from drawdown curve to estimate t and s distributions simultaneously the initial guessed t and s were 7 10 6 m2 s and 2 5 10 2 more detailed information on the rock block facilities and laboratory experiments were provided in sharmeen et al 2012 4 results hydrogeological parameters were estimated simultaneously with the only smoothing constraint added in the traditional ht inversion and the cross gradients constraint included in the second attempt to ensure comparability of parameter estimation results the two estimations converged to the same number of iterations and all settings including selected observation data initial values of model parameters and the weighting factor of smoothness were the same besides distributions of estimated k and ss contour maps of cross gradients τ were also plotted 4 1 k and ss estimates of square anomaly model as shown in fig 3 least square inversion method has correctly reproduced the position of anomaly comparing with the conventional method cross gradients constraint inversion method provides similar estimated results of k and ss and constraints are valid indeed especially for ss like in fig 3b the pattern of ss is relatively centrosymmetric in line with the true square anomaly model but the ss anomaly estimated with cross gradients constraint inversion method fig 3e appears to have clearly received a signal from estimated k in the meantime and eventually is corrected symmetrically along the sub diagonal obviously the correction of similarity is transmitted via the cross gradients constraint in addition fig 3c is the τ contour map assembled by k and ss in fig 3a and b here τ is not involved in parameter estimations and it only serves as an indicator to evaluate structural similarities comparing with fig 3f it is affected by pumping locations and its distribution is also symmetrical along the sub diagonal while τ values in fig 3f approach to zero throughout the domain in accordance with minimization of the objective function what s more cross gradients contour plots magnify structural differences visually between k and ss which helps to understand structural constraints objective function values are slightly less than those of least square inversion method with the cross gradients constraint added and each term of the objective function has small differences between these two methods hence objective function values and each term are shown in fig 10a only with cross gradients constraint inversion method the data misfit фdata accounts for a significant proportion of the objective function ф and there is a consistent descending trend from 7 6 to 3 6 10 4 and 1 8 10 3 tikhonov regularization фtr has been roughly static around 10 3 owing to homogeneous initial fields the cross gradients фcg is extremely small at the first iteration at the second iteration the pattern of heterogeneity has been revealed and this term ascends to a peak value 1 5 10 2 the following iterations reserve this original pattern and modify estimated results gradually and meanwhile фcg decreases steadily to 1 3 10 5 which is only 1 of ф 4 2 k and ss estimates of paleochannel model cross gradients constraint inversion results fig 4d and e are slightly improved in contrast with least square inversion results fig 4a and b for paleochannel model in fig 4d and e the high k and low ss zone in the upper right corner extends to right and top constant hydraulic head boundaries and the residual initial value distribution in the upper left and lower right corners is also corrected to match true parameter values of surrounding sediments however the estimation in the lower left corner of the domain is like a blind area which is directly related to absence of observation wells fig 2b the presence of transition zones near paleochannel boundaries is also ineradicable comparing with square anomaly model improvements in structural similarities between k and ss become evident with the cross gradients constraint estimated ss also accommodates to heterogeneity of k which is indicated by wu et al 2005 from cross correlation analysis as well the temporal and spatial distribution of cross correlations suggests that observed hydraulic head is strongly affected by k over a large area and has little relation with ss field mao et al 2013a these features are preserved even imposing the cross gradients constraint in addition nonzero τ values are concentrated along paleochannel boundaries fig 4c while τ shown in fig 4f are approximate to zero throughout the domain indicating that the cross gradients constraint has enhanced structural similarities between k and ss and thus identifications of geological structures to further quantify the effect of parameter estimations for the proposed algorithm the misfit at each iteration is shown in fig 10b the variation and magnitude of each term is the same as the square anomaly model fig 10a ф and dominating фdata are decreasing synchronously from 8 4 to 4 9 10 3 and 5 1 10 4 as iteration progresses фtr is steady around 4 10 3 and its moderative growth trend is inconspicuous in a logarithmic coordinate фcg increases from zero to 1 2 10 2 and then descends to 3 3 10 5 4 3 k and ss estimates of fracture zone model fig 5a and d are k tomograms obtained without and with the cross gradients constraint fig 5b and e show estimated ss tomograms simultaneously the emergence of high k and low ss zones reflects the fracture patterns and connectivity features especially in the central portion of fracture in particular final k tomogram reveals less details near top and bottom no flow boundaries and fracture zones extend to left and right constant hydraulic head boundaries however the connectivity of fracture zones represented by estimated ss is contrary in the vicinity of two types of boundaries and there are only slight improvements near left and right constant hydraulic head boundaries with cross gradients constraint inversion method these defects are also reflected in figs 3 6 presented by sharmeen et al 2012 which includes k and ss tomograms computed using synthetic and real data reviewing the τ contour plot fig 5c nonzero values are not only mapped to fracture but also to wider areas along the fracture their absolute values are also much larger than that of square anomaly and paleochannel models as a result of great magnitudes of parameter gradients in the fracture zone model even so they are almost zero eventually with the cross gradients constraint as shown in fig 5f except for slow growing фtr from 4 5 10 5 to 3 9 10 4 the variation trend of objective function fig 10c is the same as the first two models fig 10a and b ф and фdata are decreasing synchronously from 3 8 10 2 to 5 3 10 4 and 1 4 10 4 as iteration progresses фcg increases from zero to 1 2 10 4 and then descends to 5 8 10 6 as results are iteratively updated heterogeneity becomes clear and smoothness constraints come into play thus фtr should also increase gradually it is just that boundaries of specific geological structures in the synthetic models are sharp and corresponding distributions of estimated parameters should avoid containing transition zones as much as possible hence the weight α of smoothness constraints is set at a smaller value for example 10 5 in the first two models and 10 6 in the third model and the increasing trend of фtr is moderate for the same reason the occurrence of peak value for фcg should also be a gradual process not accompanied by the second iteration after crossing the peak value фcg decreased slowly as expected 4 4 t and s estimates of laboratory rock block t and s tomograms are shown in fig 6 it is able to capture the general fracture pattern bordered by a low t zone fig 6a and d the low s zone mapped on the s tomogram fig 6b and e generally corresponds with the fracture pattern within the rock sample the mapped fracture pattern near the boundaries is not distinct which is limited by observation port locations the improvement of parameter estimation with the cross gradients constraint is mainly reflected in the characterization of horizontal fracture such as enhancing its connectivity it is noted that in areas close to port 3 the horizontal fracture does not extend continuously to port 1 which can be explained by the cross correlation analysis between observed head and hydraulic properties there is a lack of sufficient observation data to cover this area the τ contour plots fig 6c and f reflect the structural similarity between t and s before and after imposed the cross gradients constraint the objective function and its terms at each iteration are shown in fig 10d the variation trend is the same as the three synthetic models and the difference between ф and фdata is even less 5 discussion from the estimated results of four experiments with or without the cross gradients constraint it can be seen that the improvement of hydrogeological parameter estimations is limited as the reasons for this limitation are unclear further discussions are needed 5 1 k or ss estimate with a priori information in order to measure the role of cross gradients constraint we designed a series of scenarios based on the three synthetic experiments different from estimating completely unknown k and ss simultaneously it was assumed that ss distribution was known then k distribution was estimated and vice versa the a priori information here is more idealized and more accurate than the geological stratification model zhao and illman 2021 and the geological zonation approach zha et al 2017 zhao and illman 2017 zhao et al 2016 in this situation like ss is treated as known and corresponding partial derivatives with respect to such parameter do not exist like j s and w cg s eqs 9 and 10 are still generic and the only thing is to pay special attention to the number of rows and columns of each matrix and their correspondences i e the solution of k at iteration k 1 is expressed as 11 m f k 1 m f k j f k t c data 1 j f k α 2 w tr f t w tr f c ref f 1 1 j f k t c data 1 h k d α 2 w tr f t w tr f m f k c ref f 1 m f k m ref f w cg f k t β k where lagrange multiplier is given by 12 β k w cg f k j f k t c data 1 j f k α 2 w tr f t w tr f c ref f 1 1 w cg f k t 1 w cg f k j f k t c data 1 j f k α 2 w tr f t w tr f c ref f 1 1 j f k t c data 1 h k d α 2 w tr f t w tr f m f k c ref f 1 m f k m ref f τ k w tr w tr f w tr s and c ref c ref f c ref s are partitioned matrices for square anomaly model with least square inversion method when known one type of parameter to estimate another type of parameter obtained imaging k tomogram in fig 7a and ss tomogram in fig 7c is better than the simultaneous inversion amplitudes of the true model are better retrieved and smoothing effects are weakened at interfaces of two media as for τ derived from the estimation and another true distribution fig 7b and d nonzero values are concentrated on boundaries of the square anomaly because gradients and corresponding τ inside two homogeneous zones are zero everywhere the alternation of positive or negative values is determined by the gradient direction of estimated parameters and they also obey the same symmetrical distribution along the sub diagonal line of domain as fig 3c correspondingly fig 7e h are results with cross gradients constraint inversion method where clear boundaries of square anomaly have emerged as shown in fig 7e estimated k is slightly flawed near right and top boundaries of the anomaly comparing fig 7c and g differences between the two are not easy to perceive but after imposing the cross gradients constraint these nonzero τ values along boundaries of the anomaly disappear eventually see fig 7f and h the constraints do play their part at structural boundaries to guide similar structures but it makes no sense in the rest of homogeneous zones similar to fig 7 figs 8 and 9 are estimated k or ss for paleochannel and fracture zone models with a priori geological information for the paleochannel model the low resolution still exists in the lower left corner of the domain comparing figs 4 and 8 it can be found that the effect of a priori geological information is much stronger than the cross gradients constraint although the paleochannel model is indeed not as complex as the fracture zone model the improvement from the cross gradients constraint for the former model is not better than the latter for fracture zone model fracture zones of high k and low ss extend to surrounding boundaries and intersect the entire rock matrix estimated ss values corresponding to fracture zones differ slightly from the rock matrix with known k distribution фdata at the first iteration for fracture zone model is smaller than that of simultaneous estimation fig 5 or k estimation fig 9a and c about less than one tenth moreover the sensitivity of observed hydraulic head with respect to ss j s is small not only in value but also in scope of influence mao et al 2013a wu et al 2005 this means that the updated ss is extremely small at each iteration i e fine tuning in fig 9b and d although the boundaries of fracture zones have been grasped with the help of the cross gradients constraint and known k distribution 5 2 weak constraint mechanism the cross gradients constraint contributes to the improvements of estimated results especially in the case of additional a priori geological information however its effect is subtle in delineating anomaly boundaries the relative magnitude of фcg and ф at each iteration in fig 10 is compelling evidence and фcg is far less than other terms of objective function taking the square anomaly model as an example fig 7e and f fig 11 shows iterative objective function values when k is estimated known ss distribution with cross gradients constraint inversion method which is another evidence it can be said that the cross gradients constraint is a weak constraint benavoli et al 2006 comparing to image guided inversion by soueid ahmed et al 2015 the algorithm does not deliberately control spatial distributions of estimated parameters the operator only tries to carry more similarity information besides what buried in the hydraulic head data if observation data is reduced appropriately parameter estimation results may become worse then imposing the cross gradients constraint can potentially improve estimated results therefore the first square anomaly model was continued to take as an example to validate the conjecture only one pumping tests was trigged at well w02 fig 2a near the left boundary of the anomaly and estimated results are shown in fig 12 both algorithms capture the general pattern of parameter distributions but the cross gradients constraint does not provide more details about parameter distributions when imposing the cross gradients constraint we still utilize observation head and no more data types are added the similar estimated results indicate the correlation between k and ss already exists in the head data and this similarity will participate in the inversion process whether the cross gradients operator is included or not the addition of cross gradients in the objective function only slightly enhances this correlated information if the cross gradients constraint is imposed on the basis of adding other data sources e g geophysical data it is bound to achieve desired results for example lochbühler et al 2013 inverted cross hole ground penetrating radar gpr travel times jointly with hydraulic tomography data as well as with tracer mean arrival times to retrieve the 2d distribution of gpr velocities and hydraulic conductivities incorporating the gpr data improved the resolution and localization properties of the estimated hydraulic conductivity field 6 conclusions in this research we tried to utilize structure information and implement it with a new parameter estimation method based on the cross gradients structural constraint structural similarities between multiple types of hydraulic property distributions are emphasized by imposing the cross gradients constraint the proposed algorithm is tested with three synthetic ht experiments and further validated with laboratory rock block ht conducted by sharmeen et al 2012 the study leads to the following major findings the experiments are designed to represent geologically consistent parameter distribution patterns estimated k is satisfactory with traditional inversion method after imposing the cross gradients constraint it only has slight improvements and the improvement for ss is better than that of k comparing with least square inversion method the depiction of structures boundaries is moderately accurate in cross gradients constraint inversion results it is especially distinct under conditions of exactly knowing one type of parameters whether estimating k and ss simultaneously with cross gradients constraint inversion method or separately the improvement of estimated results is limited the cross gradients accounts for a lower proportion of the objective function compared with other terms especially when estimating k or ss with a priori geological information using the square anomaly model as an example it has been further demonstrated that the cross gradients constraint is a weak constraint even if reducing the number of observation data drawdown data is a single data source for k and ss estimations which already contains spatial distribution and structural similarity information among hydrogeological parameters even if imposing the additional cross gradients constraint and considering correlations between k and ss estimation improvements are still limited profound breakthroughs may be by virtue of other geophysical means superimposing data sources we will explore this possibility in future research credit authorship contribution statement ruijue zhao formal analysis visualization writing original draft qingrong xiong project administration writing review editing zaibin liu resources writing review editing shiliang liu validation software supervision xinmin ma investigation data curation deqiang mao methodology writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper deqiang mao reports financial support was provided by shandong national science foundation deqiang mao reports was provided by national natural science foundation of china acknowledgments the corresponding author would like to thank the support of shandong national science foundation zr2019mee109 and national science foundation 42177056 we would like to thank the laboratory data provided by dr walter illman and mrs huawen zhao 
52,in this study a new numerical treatment of the friction source term is proposed for modeling shallow water flows over complex bed topography we design a novel semi implicit temporal discretization technique based on taylor series expansion of friction source terms a well balanced positivity preserving finite volume scheme on unstructured triangular grids is used to solve the shallow water model we present a series of numerical tests to demonstrate the robustness and effectiveness of the proposed numerical model where we used rapidly varying flows over complex topography as well as flows involving small values of water depth and wet dry zones the simulation results of the numerical model based on the proposed approach for friction source terms are compared to experimental data and to those obtained by using other existing techniques the proposed numerical model is stable and second order accurate and our predictions are in good agreement with experimental observations keywords shallow water flow friction source terms wetting and drying well balanced scheme overland flow data availability no data was used for the research described in the article 1 introduction many natural phenomena can be simulated using shallow water equations swes for free surface flows including overland flows flood waves and tsunamis mignot et al 2006 liang 2010 fernández pato et al 2016 esteves et al 2000 cho et al 2007 bates et al 2010 bouchut et al 2003 gray et al 2003 several studies have been performed to analyze overland flows sander et al 1990 and develop numerical methods for solving shallow water systems with different source terms audusse et al 2004 hanini et al 2021 liang and marche 2009 bermudez and vazquez 1994 hou et al 2013 murillo and garcía navarro 2012 chertock et al 2015 cea et al 2010 duran 2015 liang and marche 2009 hou et al 2018 karjoun et al 2022 beljadid et al 2016b hernandez duenas and beljadid 2016 to design stable and accurate numerical schemes well balanced and positivity preserving techniques have been developed in the presence of complex bed topography and small water depths in the neighborhood of dry zones bermudez and vazquez 1994 hanini et al 2021 beljadid et al 2016a audusse et al 2004 kurganov and petrova 2007 audusse and bristeau 2005 there are many challenges in the design of efficient discretization techniques of the friction source term to ensure stability and accuracy of numerical methods xia and liang 2018 xia et al 2017 liang and marche 2009 cea et al 2010 berthon et al 2011 hou et al 2018 fiedler and ramirez 2000 costabile et al 2013 simons et al 2014 brufau et al 2004 valiani et al 1999 used a semi implicit treatment for the friction source term where an appropriate coefficient is introduced to weight this term at current and previous time steps delestre et al 2008 used two methods to perform numerical simulations of rain water overland flow the first method is based on the apparent topography method introduced in bouchut 2004 in the second method bristeau and coussin 2001 a semi implicit treatment is introduced for the friction source term where the current and next time steps are considered for both the water depth and discharge variables and no linearization with respect to the variables of the system is applied for the source term in liang and marche 2009 the friction source term is discretized using a splitting implicit method recently in xia and liang 2018 the authors proposed a fully implicit scheme where the obtained formulation at the discrete level is solved analytically in xia et al 2017 a new surface reconstruction method srm is developed for overland flow and an implicit discretization scheme is implemented for nonlinear friction terms the authors used iterative procedure to solve the obtained system based on newton raphson method to preserve the exact balance between bed and friction source terms for uniform flows cea and vázquez cendón 2012 developed a semi implicit method which takes into account the centered and upwind contributions of the discretization of these terms an implicit friction source term treatment is developed in hou et al 2018 for modeling shallow water flow where the discharge variables are assumed to vary over the time step while the water depth remains explicit to simplify the resolution of the system zhao and liang 2022 improved the implicit technique proposed in hou et al 2018 where the flow variables are first updated explicitly to produce intermediate flow variables in time in order to obtain a quadratic equation for the discharge variables the main challenge in the discretization of friction source term is its non linearity and stiffness for very small water depth which require implicit or semi implicit techniques costabile et al 2013 brufau et al 2004 liang and marche 2009 fiedler and ramirez 2000 implicit schemes require an iterative procedure in order to solve the obtained system xia et al 2017 and can be expensive in terms of computational cost furthermore iterative techniques may lead to convergence issues for some particular cases of overland flow zha et al 2017 in this study we propose a novel linear semi implicit time stepping method to approximate the friction source term for modeling overland flow this is a follow up to the papers keita et al 2021b c a in which the first author and his collaborators have developed a class of numerical schemes for solving other types of nonlinear systems using extrapolation formulas and semi implicit taylor approximations for the temporal discretization of nonlinear terms this methodology is extended to the system of shallow water flows where a special technique using taylor series expansion is applied to the friction source term in the proposed technique we linearize friction source terms in the momentum equations using only the discharge variables since the water depth at the next time level is known which is computed from the continuity equation the stiffness of the coefficients of the obtained linear system at the discrete level does not increase which is suitable for modeling flow involving small water depth the use of the proposed approach makes the developed numerical model efficient in terms of computational cost since the obtained system is linear and no iterative resolution is needed at each time step in this study the flux term is computed using the central upwind scheme this scheme is first introduced by kurganov et al 2001 for hyperbolic conservation laws and hamilton jacobi equations and has successfully applied to a variety of problems as mentioned in kurganov et al 2001 the first order version of the central upwind scheme is exactly the semi discrete version of the hll scheme harten et al 1983 kurganov and petrova 2005 extended this scheme to triangular grids for solving hyperbolic systems of conservation laws a second order positivity preserving scheme is proposed in kurganov and petrova 2007 using cartesian grids for the saint venant system in kurganov and petrova 2009 central upwind scheme is applied for two layer shallow water equations a well balanced positivity preserving central upwind scheme is developed for the saint venant system in bryson et al 2011 using a triangular mesh in beljadid et al 2016a a well balanced positivity preserving cell vertex central upwind scheme is developed for modeling shallow water flows this numerical scheme is extended for modeling surface water flows with transport processes karjoun et al 2022 a well balanced positivity preserving central upwind scheme on unstructured triangular grids is proposed in hanini et al 2021 for modeling shallow water flows with variable density in our approach we combine the advantages of the proposed techniques for stiff friction source terms and those of the well balanced positivity preserving central upwind schemes this leads to a numerical model for overland flow which is capable of handling both the stiffness of friction terms and the positivity in the presence of small water depth in the proposed numerical model no iterative methods are used in the central upwind scheme and in the proposed semi implicit techniques for the friction source term the rest of this paper is organized as follows in section 2 we present the governing equations section 3 describes the numerical scheme used to solve the shallow water system in section 4 a novel discretization technique of the friction source term is developed in section 5 we prove that the proposed numerical model preserves nontrivial steady state solutions for uniform flows at the discrete level in section 6 the results of the proposed numerical model are validated using reference solutions and experimental data finally some conclusions are drawn in section 7 2 mathematical model the two dimensional shallow water model with variable topography including friction effects can be expressed as follows 1 t h x h u y h v r x y t a t h u x h u 2 1 2 g h 2 y h u v g h x z g n f 2 h 1 3 u u 2 v 2 b t h v x h u v y h v 2 1 2 g h 2 g h y z g n f 2 h 1 3 v u 2 v 2 c where t is time h is the water depth u v the averaged components of the water velocity vector in the x and y directions respectively z is the elevation of the bottom topography n f is the manning coefficient r is the rainfall intensity and g is the acceleration due to gravity the use of the water surface elevation w h z instead of the water depth h is more useful for developing well balanced numerical methods bryson et al 2011 kurganov and petrova 2007 kurganov and levy 2002 beljadid et al 2016a karjoun et al 2022 chertock et al 2015 liu and beljadid 2017 the system 1 can be rewritten in the following compact vectorial form 2 t w x f w y g w r s b s f where we use the vector of the unknown conserved flow variables w w p h u q h v f and g are the fluxes in the x and y directions and r s b and s f are the source terms due to rainfall variable bed topography and friction effects respectively the components of the vectors in eq 2 are given by 3 f p p 2 w z 1 2 g w z 2 p q w z t g q p q w z q 2 w z 1 2 g w z 2 t r r 0 0 t s b 0 g w z x z g w z y z t s f 0 g n f 2 h 7 3 p p 2 q 2 g n f 2 h 7 3 q p 2 q 2 t 3 numerical scheme in this study we use a finite volume method and an unstructured triangulation t j t j of the computational domain with cells t j of areas t j in fig 1 x j y j denotes the coordinates of the barycenter g j of the triangle t j m j k x j k y j k is the midpoint of the k th side of the triangle t j 1 t j 2 and t j 3 are the triangles that share a common side with t j and n j k cos θ j k sin θ j k t denotes the unit vector normal to γ j k the k th side of t j with length γ j k k 1 2 3 and θ j k is the angle of the unit normal vector n j k with the x axis the variable w j is the approximation of the solution over the cell t j at time t using finite volume techniques 4 w j t 1 t j t j w t x y d x d y to discretize the system 1 the central upwind method kurganov and petrova 2005 is adopted and we obtain the following semi discrete form of the scheme 5 d w j d t 1 t j k 1 3 γ j k a j k i n a j k o u t cos θ j k a j k i n f w j k m j k a j k o u t f w j m j k sin θ j k a j k i n g w j k m j k a j k o u t g w j m j k a j k i n a j k o u t w j k m j k w j m j k s b s f the values w j m j k and w j k m j k in the semi discrete eq 5 are approximated at the midpoint m j k on the two sides of interfaces using a reconstruction w 6 w j m j k lim x y m j k x y t j w x y w j k m j k lim x y m j k x y t j k w x y we use a piecewise linear reconstruction of the discrete numerical solutions 7 w x y w j x w j x x j y w j y y j x y t j since we are using a linear reconstruction the cell average solution w j is exactly the value w j w x j y j at the cell center the inner and outer local speeds a j k i n and a j k o u t at interfaces are computed using the eigenvalues of the jacobian matrix j j k of the system 1 as 8 a j k i n min λ m i n j j k w j m j k λ m i n j j k w j k m j k 0 a j k o u t max λ m a x j j k w j m j k λ m a x j j k w j k m j k 0 where λ m i n and λ m a x are the minimum and maximum values respectively of the eigenvalues of the jacobian matrix j j k defined by 9 j j k f w cos θ j k g w sin θ j k for simplicity we used the normal velocities at the midpoints m j k 10 u j θ m j k u j m j k cos θ j k v j m j k sin θ j k u j k θ m j k u j k m j k cos θ j k v j k m j k sin θ j k to obtain the following expressions of the directional local speeds 11 a j k i n min u j θ m j k g h j m j k u j k θ m j k g h j k m j k 0 a j k o u t max u j θ m j k g h j m j k u j k θ m j k g h j k m j k 0 to discretize the bed topography source term s b j 1 t j t j s b t x y d x d y we used the techniques developed in bryson et al 2011 to ensure the well balanced property of the proposed scheme the following discretizations are used 12 s b j 2 g 2 t j k 1 3 γ j k w j m j k z j k 2 cos θ j k g w j z j w x x j y j s b j 3 g 2 t j k 1 3 γ j k w j m j k z j k 2 sin θ j k g w j z j w y x j y j in the linear reconstruction of the discrete numerical solution we compute the numerical gradient of the i th component of the variable w based on the technique developed in jawahar and kamath 2000 which consists in two steps the gradient in each cell t j is first computed using the values of the solution for each component i of the variable w in the neighboring cells t j k k 1 2 3 as follows 13 w x i j 0 y j 3 y j 1 w j 2 i w j 1 i y j 2 y j 1 w j 3 i w j 1 i y j 3 y j 1 x j 2 x j 1 y j 2 y j 1 x j 3 x j 1 w y i j 0 x j 2 x j 1 w j 3 i w j 1 i x j 3 x j 1 w j 2 i w j 1 i x j 2 x j 1 y j 3 y j 1 x j 3 x j 1 y j 2 y j 1 in the second step for each component i we obtain the limited value of the numerical gradient in the cell t j via the following weighted average of the computed gradients w i j 1 0 w i j 2 0 and w i j 3 0 14 w i j λ j 1 w i j 1 0 λ j 2 w i j 3 0 λ j 3 w i j 3 0 where the weights λ j 1 λ j 2 and λ j 3 are expressed as jawahar and kamath 2000 15 λ j 1 w i j 2 0 2 w i j 3 0 2 ϵ w i j 1 0 4 w i j 2 0 4 w i j 3 0 4 3 ϵ λ j 2 w i j 1 0 2 w i j 3 0 2 ϵ w i j 1 0 4 w i j 2 0 4 w i j 3 0 4 3 ϵ λ j 3 w i j 1 0 2 w i j 2 0 2 ϵ w i j 1 0 4 w i j 2 0 4 w i j 3 0 4 3 ϵ to avoid division by zero in the denominator of eqs 15 we set ϵ 1 0 14 the central upwind schemes using forward euler temporal method and suitable corrections of the reconstruction of the water surface elevation are positivity preserving as proved in previous studies e g bryson et al 2011 kurganov and petrova 2007 beljadid et al 2016a hanini et al 2021 and karjoun et al 2022 in our case to guarantee the positivity of the computed water depth in the whole domain at all times we apply the procedure developed in bryson et al 2011 for the positivity preserving correction of the piecewise linear reconstruction for the water surface elevation note that in the proposed numerical model we used ssp rk2 which guarantees also the positivity of the computed water depth since ssp rk2 is a convex combination of two steps euler methods 4 discretization of friction source terms numerical simulations of overland flows with friction effects may lead to nonphysical solutions although implicit schemes are widely used for modeling shallow water flows with friction effects these schemes may encounter convergence issues if iterative techniques are used to solve the obtained system in this study we introduce a semi implicit technique for friction source terms based on taylor series expansion in our approach we rewrite the first equation of the semi discrete form of the scheme 5 for the water depth using the forward euler method 16 h j n α h j n α δ t t j k 1 3 γ j k a j k i n a j k o u t cos θ j k a j k i n p j k n m j k a j k o u t p j n m j k sin θ j k a j k i n q j k n m j k a j k o u t q j n m j k a j k i n a j k o u t h j k n m j k h j n m j k α δ t r j n where α 0 1 and r j n is the first order discretization of the rainfall source term in the cell t j at time t n n δ t next the discharges are expressed at time t n 1 as 17 p j n 1 p j n δ t a x n δ t g n f 2 h j n α 7 3 p j n α p j n α 2 q j n α 2 q j n 1 q j n δ t a y n δ t g n f 2 h j n α 7 3 q j n α p j n α 2 q j n α 2 where a x n and a y n are respectively the x and y components of the discretizations of the fluxes and topographic source term which are expressed as follows 18 a x n 1 t j k 1 3 γ j k a j k i n a j k o u t cos θ j k a j k i n p j k n 2 m j k h j k n m j k 1 2 g h j k n 2 m j k a j k o u t p j n 2 m j k h j n m j k 1 2 g h j n 2 m j k sin θ j k a j k i n p j k n m j k q j k n m j k h j k n m j k a j k o u t p j n m j k q j n m j k h j n m j k a j k i n a j k o u t p j k n m j k p j n m j k s b j 2 19 a y n 1 t j k 1 3 γ j k a j k i n a j k o u t cos θ j k a j k i n p j k n m j k q j k n m j k h j k n m j k a j k o u t p j n m j k q j n m j k h j n m j k sin θ j k a j k i n q j k n 2 m j k h j k n m j k 1 2 g h j k n 2 m j k a j k o u t q j n 2 m j k h j n m j k 1 2 g h j n 2 m j k a j k i n a j k o u t q j k n m j k q j n m j k s b j 3 where the components of the topography source term s b j 2 and s b j 3 are given by eq 12 to discretize the friction source terms in 17 we propose a semi implicit technique where we consider the functions 20 φ p q p p 2 q 2 h p q q p 2 q 2 these expressions are used to rewrite eq 17 in the following form 21 p j n 1 p j n δ t a x n δ t g n f 2 h j n α 7 3 φ n α q j n 1 q j n δ t a y n δ t g n f 2 h j n α 7 3 h n α where the time index n α corresponds to the value of a variable at time between t n and t n 1 as shown in fig 2 we compute the water depth h j n 1 using eq 16 for α 1 the water depth at time t n α given by eq 16 satisfies the relationship h j n α α h j n 1 1 α h j n with α 0 1 which is used to compute h j n α we used taylor expansion keita et al 2021c b a of the operators in eq 20 to linearize the friction term 22 φ p j n α q j n α φ n φ p n p j n α p j n φ q n q j n α q j n h p j n α q j n α h n h p n p j n α p j n h q n q j n α q j n and the introduced parameters used on the right hand side of the above eq 22 are obtained using simple algebraic calculations as follows 23 φ p φ p 2 p 2 q 2 p 2 q 2 φ q φ q p q p 2 q 2 h p h p p q p 2 q 2 h q h q p 2 2 q 2 p 2 q 2 where we omit time index n for simplicity the above results lead to the following new form of eq 17 24 p j n 1 p j n δ t a x n δ t g n f 2 h j n α 7 3 φ n φ p n p j n α p j n φ q n q j n α q j n q j n 1 q j n δ t a y n δ t g n f 2 h j n α 7 3 h n h p n p j n α p j n h q n q j n α q j n from the approximations p j n α α p j n 1 1 α p j n and q j n α α q j n 1 1 α q j n we obtain p j n α p j n α p j n 1 p j n and q j n α q j n α q j n 1 q j n using these simplifications and by rearranging eq 24 becomes 25 1 δ t β j n α α φ p n p j n 1 δ t β j n α α φ q n q j n 1 r h p δ t β j n α α h p n p j n 1 1 δ t β j n α α h q n q j n 1 r h q where β j n α g n f 2 h j n α 7 3 and r h p and r h q are explicitly expressed as follows 26 r h p p j n δ t a x n δ t β j n α φ n α φ p n p j n α φ q n q j n r h q q j n δ t a y n δ t β j n α h n α h p n p j n α h q n q j n we note that the matrix of the system 25 is symmetric thanks to the relationship φ q h p mentioned in eq 23 finally the discharges at time level t n 1 are computed using the following formulas 27 p j n 1 1 d j n r h p 1 δ t β j n α α h q n r h q δ t β j n α α φ q n q j n 1 1 d j n r h q 1 δ t β j n α α φ p n r h p δ t β j n α α h p n where d j n is the determinant of the obtained system 25 expressed as 28 d j n 1 3 δ t β j n α α p j n 2 q j n 2 2 δ t 2 β j n α 2 α 2 p j n 2 q j n 2 which is greater than one for all values of h p and q we note that under some conditions the effects of advection and topography can reverse the flow direction xia and liang 2018 but the friction effects can only decelerate the flow and the maximum is to stop the propagation of the fluid in the following we will consider a one dimensional system to analyze the impact of friction effects at the discrete level on the direction of the discharge for one dimensional system q j n 0 we have 29 φ n p j n p j n h n 0 φ p n 2 p j n φ q n 0 h p n 0 h q n p j n and we get 30 r h p p j n δ t a x n δ t β j n α 1 2 α p j n p j n d j n 1 2 δ t α β j n α p j n 1 δ t α β j n α p j n p j n finally eq 27 is used to obtain the discharge 31 p j n 1 p j n δ t a x n δ t β j n α p j n p j n 1 2 α 1 2 δ t α β j n α p j n the second term in the numerator of eq 31 is related to the impact of the advection and topography the third term in the numerator and the term in the denominator of 31 are related to the effect of friction it is interesting to note that for the value of α 0 5 the third term in the numerator which may impact the sign of the resulting discharge vanishes this leads to the following expression of the discharge 32 p j n 1 p j n δ t a x n 1 δ t β j n 1 2 p j n the value of the denominator of eq 32 is positive and becomes large in the case of small water depths especially near the wet dry area we conclude from eq 32 that the only impact of the proposed discretization of friction term on the resulting discharge due to advection and topography p j n δ t a x n is the reduction of its absolute value without inverting its sign the value α 0 5 which also presents the advantage in terms of accuracy will be used in our numerical simulations in section 6 5 exact balance between bed friction and bed slope in this section we will analyze the balance at the discrete level between the proposed discretization for friction source terms and the discretization of the bottom topography described in section 3 we note that uniform channel flow is characterized by an exact balance between bed friction and bed slope in the following we will prove that the proposed method is capable to preserve the following class of non trivial steady state solutions for uniform channel flow chertock et al 2015 33 h h 0 p p 0 q 0 x z c y z 0 r 0 where we consider a steady flow with constant non vanishing velocity and water depth over an inclined topography with a constant slope and the water depth is expressed as follows 34 h 0 n f 2 p 0 2 c 3 10 we assume that at time t n 35 h j n h 0 p j n p 0 q j n 0 x z j c y z j 0 r j n 0 j where h 0 p 0 and c are positive constants and satisfying the condition 34 in the following we will prove that the proposed techniques preserve this type of solution at the next time step t n 1 i e 36 h j n 1 h 0 p j n 1 p 0 q j n 1 0 j since we are using linear reconstruction at time step t n under the condition 35 we obtain constant water depth and discharges at cell interfaces with the same values as in 35 then eq 16 can be written as follows 37 h j n α h 0 α δ t t j k 1 3 γ j k a j k i n a j k o u t cos θ j k a j k i n p 0 a j k o u t p 0 h 0 α δ t t j p 0 k 1 3 γ j k cos θ j k h 0 where we used k 1 3 γ j k cos θ j k 0 which is satisfied for every triangle therefore h n α h 0 for every value of α 0 1 in particular for α 1 similarly to the water depth we will prove that q j n 1 0 by substituting the values at time t n of the water depth and discharges at cell interfaces in eq 19 we obtain 38 a y n 1 t j k 1 3 γ j k a j k i n a j k o u t sin θ j k a j k i n 1 2 g h 0 2 a j k o u t 1 2 g h 0 2 s b j 3 1 t j 1 2 g h 0 2 k 1 3 γ j k sin θ j k s b j 3 s b j 3 since k 1 3 γ j k sin θ j k 0 eq 12 becomes 39 s b j 3 g 2 t j k 1 3 γ j k h 0 2 sin θ j k 0 therefore a y n 0 since q j n 0 h n 0 and h p n 0 then r h q 0 and finally from the second equation in 27 we conclude that q j n 1 0 in the following we will prove that p j n 1 p 0 we first compute a x n from eq 18 40 a x n 1 t j k 1 3 γ j k a j k i n a j k o u t cos θ j k a j k i n p 0 2 h 0 1 2 g h 0 2 a j k o u t p 0 2 h 0 1 2 g h 0 2 s b j 2 s b j 2 g h 0 c we have φ n p 0 2 φ p n 2 p 0 and q j n 0 then eq 26 leads to 41 r h p p 0 δ t g h 0 c δ t β j n α p 0 2 2 α p 0 2 using β j n α β 0 g n f 2 h 0 7 3 and eq 34 we obtain g h 0 c β 0 p 0 2 then eq 41 can be written as follows 42 r h p p 0 1 2 δ t β 0 α p 0 then the first equation in 27 becomes 43 p j n 1 r h p 1 δ t β 0 α p 0 1 2 δ t β 0 α p 0 1 δ t β 0 α p 0 p 0 we note that the proof we present using the forward euler temporal scheme remains valid if the method ssp rk2 is used since this method is a combination of two forward euler steps then the proposed numerical model preserves the exact balance between topography and friction source terms for uniform channel flows 6 model validation this section is devoted to numerical experiments which are performed to test the proposed discretization of the friction source term in terms of stability and accuracy the ssp rk2 temporal method described in the appendix is used to discretize the semi discrete finite volume scheme reference solutions and laboratory experiments are used to validate the results of the proposed numerical model in all numerical tests the gravitational acceleration is set to g 9 81ms 2 spatial discretizations are based on unstructured triangular grids as shown in fig 3 the following time step condition is used for the numerical stability of the scheme 44 δ t c f l δ t c where δ t c 1 6 min j k h j k max j k a j k o u t h j k are the heights of the triangle t j in the following numerical tests the c f l constant is set to 0 7 and the parameter α 0 5 in our numerical simulations we used the desingularisation procedure kurganov and petrova 2007 to avoid division by very small values of the computed water depth 6 1 example 1 analysis of the accuracy in this section we analyze the order of accuracy of the proposed numerical model using an analytical solution michel dansac et al 2017 the computational domain is 0 3 0 3 0 4 1 and the bottom topography is given by 45 z x y 2 g n f 2 s 1 2 g s 2 where s x y t we consider the following steady solution michel dansac et al 2017 of eq 1 46 h x y t 1 p x y t x s 2 q x y t y s 2 where the boundary and initial conditions are obtained from the analytical expressions 46 these conditions are used to perform simulations using the proposed numerical model until the final time t 0 1 s the l 1 error is computed as follows 47 e 1 t i 1 n t i f i f i e x where t is the area of the domain and n is the number of computational cells table 1 presents the errors and the convergence rates at the final time t t for the variables h p and q for different sizes of triangular meshes for small sizes of the computational cells we obtain good results in terms of convergence rate 6 2 example 2 experimental rainfall runoff several experimental rainfall runoff tests for different values for the slope roughness and rainfall intensity using an artificial rainfall simulator have been conducted by the los angeles district of the u s army corps of engineers this experiment was reported in part in the original report in yu and mcnown 1963 in this example we consider the test case 1 from yu and mcnown 1963 using a concrete surface with a slope of 0 02 152 4m long and 0 3m wide and the manning coefficient is set to 0 011sm 1 3 the domain which is initially dry receives a constant rainfall intensity of 180mmh 1 during 8min through an artificial rainfall simulator and the duration of the experiment is 16min all boundaries of the domain are closed except for the outlet of the domain for which we consider outflow condition in fig 4 we present the computed discharge hydrographs at the channel outlet using the proposed numerical model and the numerical models using the techniques developed for friction source terms in xia and liang 2018 and xia et al 2017 where we used the central upwind method for the flux term the numerical simulations are performed until the final time t 16 min using computational grids with an average cell areas t j 0 015 with c f l 0 7 and the reference solution is obtained using the friction term discretization proposed in xia and liang 2018 the central upwind method ssp rk2 for temporal discretization a refined mesh with an average cell areas t j 0 0038 and c f l 0 2 fig 4 shows the computed discharge for each method as well as the reference solution and experimental data the l 1 error is computed as follows 48 e 1 n i n q t i q r e f t i where q and q r e f are the computed discharges using the numerical solution of each method and the reference solution respectively in 48 we used n 32 discrete points in time from our simulations table 2 presents the computed errors for three methods and confirms the accuracy of the proposed techniques fig 5 presents the observed yu and mcnown 1963 and computed hydrographs using a grid with the cell average areas t j 0 0046 and c f l 0 7 and shows the improvement of the results of the proposed numerical model by decreasing the size of computational cells our model predictions are in good agreement with the experimental observations in order to be consistent in terms of comparison of the computational cost we compare the developed method and the method proposed in xia and liang 2018 for friction source term where we used an unstructured central upwind scheme with linear reconstruction in space and the euler method for the temporal discretization a triangular mesh discretization is used with the cell average areas t j 0 015 we perform numerical simulations using the proposed method with c f l 0 7 and we obtain an l 1 error of 2 38 e 5 and cpu time of 725s to obtain the same result in terms of accuracy the method using the techniques proposed in xia and liang 2018 for friction term requires the value of c f l 0 33 which leads to a cpu time of 1380s this demonstrates the efficiency of the proposed method in terms of computational cost 6 3 example 3 idealized v shaped catchment experiment in this numerical test we consider the idealized v shaped catchment overton and brakensiek 1970 which involves very small water depth and stiff bottom topography this challenging example is used to validate the proposed approach in predicting overland flows with stiff friction term an approximate analytical solution for the v shaped catchment was developed see overton and brakensiek 1970 and meadows and stephenson 1986 for more details based on kinematic wave assumptions this approximation approach is used in previous studies xia and liang 2018 xia et al 2017 di giammarco et al 1996 to compute a reference solution based on other characteristics of the domain and data which will be used in this study and described in the following a rectangular computational domain 0 1000 0 1620 is considered and discretized using an unstructured triangular mesh with an average cell areas t j 35 as illustrated in fig 6 two slopes are used 0 05 for the two sides with 1000m long and 800m wide each and 0 02 for the channel with 1000m long and 20m wide having the manning coefficient 0 015sm 1 3 and 0 15sm 1 3 respectively xia and liang 2018 xia et al 2017 di giammarco et al 1996 wall boundary conditions are used everywhere except for the downstream outlet at the end of the channel where outflow boundary condition is imposed initially the domain is dry and we consider a constant rainfall intensity of 10 8mmh 1 during t 1 5h fig 7 shows a comparison between the computed hydrographs at the channel outlet using the proposed method and previous methods developed by xia and liang 2018 and xia et al 2017 as well as the reference solution obtained based on the approximation approach and data mentioned before the proposed method is in good agreement with the reference solution and all methods converge to the same solution we note that for this numerical test there is no significant difference between the computed discharge hydrographs using our method and those proposed in xia and liang 2018 and xia et al 2017 6 4 example 4 two dimensional surface rainfall runoff experimental test in this example we consider a challenging numerical test based on the experiments performed by iwagaki 1955 in the presence of rainfall runoff phenomena over variable topography with a cascade of three planes see fig 8 we perform numerical simulations to test the capability of the numerical model using the proposed discretization of the friction source term to reproduce the results of two experimental sets a and b in iwagaki 1955 in the first experiment a we consider one inclined plane of slope 0 015 with a length of 24m and width of 0 196m which is initially dry in iwagaki 1955 a mechanism of lateral supply of water into the experimental flume is used to ensure the most uniform distribution possible of 299 88cmh 1 in the second experiment b three flat sections inclined decreasingly with slopes equal to 0 02 0 015 and 0 01 respectively are considered where each of these planes is 8m long and 0 196m wide these three planes are also initially dry and receiving a lateral supply of water of 389cmh 1 230cmh 1 and 288cmh 1 respectively in the experiment a four cases of water supply regime are considered with durations of 10s 20s 30s and 40s and three for the experiment b using durations of 10s 20s and 30s for all the experiments considered in this example the domain is discretized using 2828 triangular cells and the manning coefficient is set to 0 009sm 1 3 the domain is closed except for the channel outlet where outflow boundary conditions are imposed we plot the numerical results and data of the experiment a for the discharge hydrograph and water depth at the channel outlet for the different water supply durations 10s 20s 30s and 40s in figs 9 12 respectively the numerical results and data of the experiment b are shown in figs 13 15 for the water supply durations 10s 20s and 30s respectively as shown in figs 9 12 for the experiment a we observe good agreement between our numerical simulations and experimental data for the discharge and water depth hydrographs for the experiment b in fig 13 a we observe that the computed hydrograph of the discharge is in good agreement with experimental data for the water supply duration t 10 s we note that the peak of the hydrograph of the discharge is a bit overestimated which is generally observed for available techniques costabile et al 2013 fiedler and ramirez 2000 compared to the experiment performed in iwagaki 1955 for the water depth shown in fig 13 b we obtain good agreement between numerical simulations and experimental data for the water supply durations 20s and 30s figs 14 and 15 show good agreement between our numerical simulations and the data of experiment b for both the discharge and water depth hydrographs with an overestimation near the peak of the discharge finally we conclude that we observe good overall agreement between the predictions of the numerical model for overland flow using the proposed discretization techniques for the friction source term and the experiments performed by iwagaki 1955 for modeling rainfall runoff phenomena over variable topography 6 5 example 5 dam break wave over a triangular bottom sill experiment here the numerical model using the proposed discretization techniques for the friction source terms is applied to perform simulations and the results are compared with the laboratory experiments conducted by soares frazão 2007 in a channel of length 5 6m and width 0 5m which is delimited by a solid wall along its borders a diaphragm representing a dam is placed at x 2 39m in the part of the domain at the left of the diaphragm the water depth is h 0 111m while the part of the domain at the right of the diaphragm is dry as shown in fig 16 a symmetrical triangular bottom sill 0 9m long and 0 065m height is placed at the downstream of the channel the area of the channel between the sill and the wall at the downstream is initially filled with water of depth h 0 02m this numerical test is challenging since it involves sharp topography and wet dry zones which generates complex behaviors of the flow the computational domain is discretized into 7792 unstructured triangular cells the numerical test is performed using the manning coefficient of value 0 011sm 1 3 as estimated in the experiment performed in soares frazão 2007 we perform the numerical simulations until the final time t 45s of the laboratory experiment soares frazão 2007 fig 17 shows three dimensional views of the water surface elevation at different times and confirms that the proposed method satisfies the positivity of the computed water depth in the presence of dry zone and under complex topography fig 18 presents the numerical results of the model against experimental measurements for the water surface elevation at the gauges g 1 g 2 and g 3 shown in fig 16 we obtain a good agreement between numerical simulations and experimental data which confirms the accuracy of the proposed numerical techniques for modeling overland flows to analyze the long term mass conservation in fig 19 we present the ratio q t q 0 where q 0 and q t are the total water volume computed at the initial and time t respectively the results confirm that the proposed numerical model satisfies the conservation of mass in a closed system 7 conclusion shallow water equations is among the most commonly used models for simulating rainfall runoff processes and overland flows in this study we used a second order temporal scheme ssp rk2 and an unstructured well balanced positivity preserving finite volume method to discretize shallow water equations and proposed a novel discretization technique for friction source terms for modeling overland flow over complex topography in our approach we used taylor series expansion to linearize the friction source terms in the momentum equations using only the discharge variables since the water depth at the next time level is computed from the continuity equation this allows us to solve the system using semi implicit techniques without increasing the stiffness of the problem for small water depth the proposed approach leads to a numerical model for overland flow which is capable of handling both the stiffness of friction source terms and the positivity of the computed water depth in the proposed techniques no iterative methods are used in the central upwind scheme and in the proposed technique for friction source terms numerical simulations are performed to validate the proposed numerical model based on reference solutions and laboratory experiments involving rapidly varying flows sharp topography small water depth and wet dry zones the proposed techniques are stable and second order accurate we obtain good agreement between numerical solutions and experimental data the proposed numerical model can be used to simulate overland flow over variable topography with friction effects the novel discretization techniques for friction source terms can be incorporated in hydrological models in the presence of stiff friction effects to improve the accuracy and the efficiency in terms of computational cost of the models declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the first author acknowledges funding from um6p ocp group of morocco um6p ocp 2018 appendix a time integration method here we apply the two stage second order runge kutta method for the semi discrete scheme 5 the first step of the method is defined as follows 49 h n h n δ t a h n δ t r n p n p n δ t a x n δ t c p n q n q n δ t a y n δ t c q n and the second step is given by 50 h n 1 1 2 h n 1 2 h n 1 2 δ t a h n 1 2 δ t r n p n 1 1 2 p n 1 2 p n 1 2 δ t a x n 1 2 δ t c p n 1 q n 1 1 2 q n 1 2 q n 1 2 δ t a y n 1 2 δ t c q n 1 where we used 51 c p n g n f 2 h n 1 2 7 3 φ n 1 2 φ p n p n p n 1 2 φ q n q n q n c q n g n f 2 h n 1 2 7 3 h n 1 2 h p n p n p n 1 2 h q n q n q n c p n 1 g n f 2 h n 1 2 7 3 φ n 1 2 φ p n p n 1 p n 1 2 φ q n q n 1 q n c q n 1 g n f 2 h n 1 2 7 3 h n 1 2 h p n p n 1 p n 1 2 h q n q n 1 q n with h n 1 2 h n h n 2 and h n 1 2 h n h n 1 2 appendix b in this appendix we briefly recall the friction source term discretizations proposed in xia et al 2017 and xia and liang 2018 in xia et al 2017 the momentum components of the scheme are written as follows 52 q j n 1 q j n δ t a j n s f j n 1 where q j p j q j a j is the momentum components of the convective fluxes and slope source terms and s f j is the friction source term in xia et al 2017 the following equation is solved 53 u j n 1 u j n δ t a j n s f j n 1 where u j n 1 q j n 1 h j n 1 u j n q j n h j n 1 a j n a j n h j n 1 h j n 1 is known from the continuity equation and 54 s f j n 1 g n f 2 h j n 1 4 3 u j n 1 u j n 1 eq 53 is solved using the newton raphson iterative method 55 u p 1 u p i δ t j u p 1 δ t s f u p δ t a j n u p u j n where i is the identity matrix j is the jacobian matrix of s f and p denotes the index of iteration steps the convergence criteria u p 1 u p 0 001 u p is used in xia et al 2017 in xia and liang 2018 the momentum components are expressed as follows 56 p j n 1 p j n δ t b x δ t g n f 2 h j n 7 3 p j n 1 p j n 1 2 q j n 1 2 q j n 1 q j n δ t b y δ t g n f 2 h j n 7 3 q j n 1 p j n 1 2 q j n 1 2 where b x and b y are the contributions of the flux and topography in x and y directions respectively eq 56 is solved analytically to find p j n 1 and q j n 1 and slightly modified to avoid singularity in the calculation xia and liang 2018 using eqs 57 and 58 given in box i where m x p j n δ t b x and m y q j n δ t b y 
52,in this study a new numerical treatment of the friction source term is proposed for modeling shallow water flows over complex bed topography we design a novel semi implicit temporal discretization technique based on taylor series expansion of friction source terms a well balanced positivity preserving finite volume scheme on unstructured triangular grids is used to solve the shallow water model we present a series of numerical tests to demonstrate the robustness and effectiveness of the proposed numerical model where we used rapidly varying flows over complex topography as well as flows involving small values of water depth and wet dry zones the simulation results of the numerical model based on the proposed approach for friction source terms are compared to experimental data and to those obtained by using other existing techniques the proposed numerical model is stable and second order accurate and our predictions are in good agreement with experimental observations keywords shallow water flow friction source terms wetting and drying well balanced scheme overland flow data availability no data was used for the research described in the article 1 introduction many natural phenomena can be simulated using shallow water equations swes for free surface flows including overland flows flood waves and tsunamis mignot et al 2006 liang 2010 fernández pato et al 2016 esteves et al 2000 cho et al 2007 bates et al 2010 bouchut et al 2003 gray et al 2003 several studies have been performed to analyze overland flows sander et al 1990 and develop numerical methods for solving shallow water systems with different source terms audusse et al 2004 hanini et al 2021 liang and marche 2009 bermudez and vazquez 1994 hou et al 2013 murillo and garcía navarro 2012 chertock et al 2015 cea et al 2010 duran 2015 liang and marche 2009 hou et al 2018 karjoun et al 2022 beljadid et al 2016b hernandez duenas and beljadid 2016 to design stable and accurate numerical schemes well balanced and positivity preserving techniques have been developed in the presence of complex bed topography and small water depths in the neighborhood of dry zones bermudez and vazquez 1994 hanini et al 2021 beljadid et al 2016a audusse et al 2004 kurganov and petrova 2007 audusse and bristeau 2005 there are many challenges in the design of efficient discretization techniques of the friction source term to ensure stability and accuracy of numerical methods xia and liang 2018 xia et al 2017 liang and marche 2009 cea et al 2010 berthon et al 2011 hou et al 2018 fiedler and ramirez 2000 costabile et al 2013 simons et al 2014 brufau et al 2004 valiani et al 1999 used a semi implicit treatment for the friction source term where an appropriate coefficient is introduced to weight this term at current and previous time steps delestre et al 2008 used two methods to perform numerical simulations of rain water overland flow the first method is based on the apparent topography method introduced in bouchut 2004 in the second method bristeau and coussin 2001 a semi implicit treatment is introduced for the friction source term where the current and next time steps are considered for both the water depth and discharge variables and no linearization with respect to the variables of the system is applied for the source term in liang and marche 2009 the friction source term is discretized using a splitting implicit method recently in xia and liang 2018 the authors proposed a fully implicit scheme where the obtained formulation at the discrete level is solved analytically in xia et al 2017 a new surface reconstruction method srm is developed for overland flow and an implicit discretization scheme is implemented for nonlinear friction terms the authors used iterative procedure to solve the obtained system based on newton raphson method to preserve the exact balance between bed and friction source terms for uniform flows cea and vázquez cendón 2012 developed a semi implicit method which takes into account the centered and upwind contributions of the discretization of these terms an implicit friction source term treatment is developed in hou et al 2018 for modeling shallow water flow where the discharge variables are assumed to vary over the time step while the water depth remains explicit to simplify the resolution of the system zhao and liang 2022 improved the implicit technique proposed in hou et al 2018 where the flow variables are first updated explicitly to produce intermediate flow variables in time in order to obtain a quadratic equation for the discharge variables the main challenge in the discretization of friction source term is its non linearity and stiffness for very small water depth which require implicit or semi implicit techniques costabile et al 2013 brufau et al 2004 liang and marche 2009 fiedler and ramirez 2000 implicit schemes require an iterative procedure in order to solve the obtained system xia et al 2017 and can be expensive in terms of computational cost furthermore iterative techniques may lead to convergence issues for some particular cases of overland flow zha et al 2017 in this study we propose a novel linear semi implicit time stepping method to approximate the friction source term for modeling overland flow this is a follow up to the papers keita et al 2021b c a in which the first author and his collaborators have developed a class of numerical schemes for solving other types of nonlinear systems using extrapolation formulas and semi implicit taylor approximations for the temporal discretization of nonlinear terms this methodology is extended to the system of shallow water flows where a special technique using taylor series expansion is applied to the friction source term in the proposed technique we linearize friction source terms in the momentum equations using only the discharge variables since the water depth at the next time level is known which is computed from the continuity equation the stiffness of the coefficients of the obtained linear system at the discrete level does not increase which is suitable for modeling flow involving small water depth the use of the proposed approach makes the developed numerical model efficient in terms of computational cost since the obtained system is linear and no iterative resolution is needed at each time step in this study the flux term is computed using the central upwind scheme this scheme is first introduced by kurganov et al 2001 for hyperbolic conservation laws and hamilton jacobi equations and has successfully applied to a variety of problems as mentioned in kurganov et al 2001 the first order version of the central upwind scheme is exactly the semi discrete version of the hll scheme harten et al 1983 kurganov and petrova 2005 extended this scheme to triangular grids for solving hyperbolic systems of conservation laws a second order positivity preserving scheme is proposed in kurganov and petrova 2007 using cartesian grids for the saint venant system in kurganov and petrova 2009 central upwind scheme is applied for two layer shallow water equations a well balanced positivity preserving central upwind scheme is developed for the saint venant system in bryson et al 2011 using a triangular mesh in beljadid et al 2016a a well balanced positivity preserving cell vertex central upwind scheme is developed for modeling shallow water flows this numerical scheme is extended for modeling surface water flows with transport processes karjoun et al 2022 a well balanced positivity preserving central upwind scheme on unstructured triangular grids is proposed in hanini et al 2021 for modeling shallow water flows with variable density in our approach we combine the advantages of the proposed techniques for stiff friction source terms and those of the well balanced positivity preserving central upwind schemes this leads to a numerical model for overland flow which is capable of handling both the stiffness of friction terms and the positivity in the presence of small water depth in the proposed numerical model no iterative methods are used in the central upwind scheme and in the proposed semi implicit techniques for the friction source term the rest of this paper is organized as follows in section 2 we present the governing equations section 3 describes the numerical scheme used to solve the shallow water system in section 4 a novel discretization technique of the friction source term is developed in section 5 we prove that the proposed numerical model preserves nontrivial steady state solutions for uniform flows at the discrete level in section 6 the results of the proposed numerical model are validated using reference solutions and experimental data finally some conclusions are drawn in section 7 2 mathematical model the two dimensional shallow water model with variable topography including friction effects can be expressed as follows 1 t h x h u y h v r x y t a t h u x h u 2 1 2 g h 2 y h u v g h x z g n f 2 h 1 3 u u 2 v 2 b t h v x h u v y h v 2 1 2 g h 2 g h y z g n f 2 h 1 3 v u 2 v 2 c where t is time h is the water depth u v the averaged components of the water velocity vector in the x and y directions respectively z is the elevation of the bottom topography n f is the manning coefficient r is the rainfall intensity and g is the acceleration due to gravity the use of the water surface elevation w h z instead of the water depth h is more useful for developing well balanced numerical methods bryson et al 2011 kurganov and petrova 2007 kurganov and levy 2002 beljadid et al 2016a karjoun et al 2022 chertock et al 2015 liu and beljadid 2017 the system 1 can be rewritten in the following compact vectorial form 2 t w x f w y g w r s b s f where we use the vector of the unknown conserved flow variables w w p h u q h v f and g are the fluxes in the x and y directions and r s b and s f are the source terms due to rainfall variable bed topography and friction effects respectively the components of the vectors in eq 2 are given by 3 f p p 2 w z 1 2 g w z 2 p q w z t g q p q w z q 2 w z 1 2 g w z 2 t r r 0 0 t s b 0 g w z x z g w z y z t s f 0 g n f 2 h 7 3 p p 2 q 2 g n f 2 h 7 3 q p 2 q 2 t 3 numerical scheme in this study we use a finite volume method and an unstructured triangulation t j t j of the computational domain with cells t j of areas t j in fig 1 x j y j denotes the coordinates of the barycenter g j of the triangle t j m j k x j k y j k is the midpoint of the k th side of the triangle t j 1 t j 2 and t j 3 are the triangles that share a common side with t j and n j k cos θ j k sin θ j k t denotes the unit vector normal to γ j k the k th side of t j with length γ j k k 1 2 3 and θ j k is the angle of the unit normal vector n j k with the x axis the variable w j is the approximation of the solution over the cell t j at time t using finite volume techniques 4 w j t 1 t j t j w t x y d x d y to discretize the system 1 the central upwind method kurganov and petrova 2005 is adopted and we obtain the following semi discrete form of the scheme 5 d w j d t 1 t j k 1 3 γ j k a j k i n a j k o u t cos θ j k a j k i n f w j k m j k a j k o u t f w j m j k sin θ j k a j k i n g w j k m j k a j k o u t g w j m j k a j k i n a j k o u t w j k m j k w j m j k s b s f the values w j m j k and w j k m j k in the semi discrete eq 5 are approximated at the midpoint m j k on the two sides of interfaces using a reconstruction w 6 w j m j k lim x y m j k x y t j w x y w j k m j k lim x y m j k x y t j k w x y we use a piecewise linear reconstruction of the discrete numerical solutions 7 w x y w j x w j x x j y w j y y j x y t j since we are using a linear reconstruction the cell average solution w j is exactly the value w j w x j y j at the cell center the inner and outer local speeds a j k i n and a j k o u t at interfaces are computed using the eigenvalues of the jacobian matrix j j k of the system 1 as 8 a j k i n min λ m i n j j k w j m j k λ m i n j j k w j k m j k 0 a j k o u t max λ m a x j j k w j m j k λ m a x j j k w j k m j k 0 where λ m i n and λ m a x are the minimum and maximum values respectively of the eigenvalues of the jacobian matrix j j k defined by 9 j j k f w cos θ j k g w sin θ j k for simplicity we used the normal velocities at the midpoints m j k 10 u j θ m j k u j m j k cos θ j k v j m j k sin θ j k u j k θ m j k u j k m j k cos θ j k v j k m j k sin θ j k to obtain the following expressions of the directional local speeds 11 a j k i n min u j θ m j k g h j m j k u j k θ m j k g h j k m j k 0 a j k o u t max u j θ m j k g h j m j k u j k θ m j k g h j k m j k 0 to discretize the bed topography source term s b j 1 t j t j s b t x y d x d y we used the techniques developed in bryson et al 2011 to ensure the well balanced property of the proposed scheme the following discretizations are used 12 s b j 2 g 2 t j k 1 3 γ j k w j m j k z j k 2 cos θ j k g w j z j w x x j y j s b j 3 g 2 t j k 1 3 γ j k w j m j k z j k 2 sin θ j k g w j z j w y x j y j in the linear reconstruction of the discrete numerical solution we compute the numerical gradient of the i th component of the variable w based on the technique developed in jawahar and kamath 2000 which consists in two steps the gradient in each cell t j is first computed using the values of the solution for each component i of the variable w in the neighboring cells t j k k 1 2 3 as follows 13 w x i j 0 y j 3 y j 1 w j 2 i w j 1 i y j 2 y j 1 w j 3 i w j 1 i y j 3 y j 1 x j 2 x j 1 y j 2 y j 1 x j 3 x j 1 w y i j 0 x j 2 x j 1 w j 3 i w j 1 i x j 3 x j 1 w j 2 i w j 1 i x j 2 x j 1 y j 3 y j 1 x j 3 x j 1 y j 2 y j 1 in the second step for each component i we obtain the limited value of the numerical gradient in the cell t j via the following weighted average of the computed gradients w i j 1 0 w i j 2 0 and w i j 3 0 14 w i j λ j 1 w i j 1 0 λ j 2 w i j 3 0 λ j 3 w i j 3 0 where the weights λ j 1 λ j 2 and λ j 3 are expressed as jawahar and kamath 2000 15 λ j 1 w i j 2 0 2 w i j 3 0 2 ϵ w i j 1 0 4 w i j 2 0 4 w i j 3 0 4 3 ϵ λ j 2 w i j 1 0 2 w i j 3 0 2 ϵ w i j 1 0 4 w i j 2 0 4 w i j 3 0 4 3 ϵ λ j 3 w i j 1 0 2 w i j 2 0 2 ϵ w i j 1 0 4 w i j 2 0 4 w i j 3 0 4 3 ϵ to avoid division by zero in the denominator of eqs 15 we set ϵ 1 0 14 the central upwind schemes using forward euler temporal method and suitable corrections of the reconstruction of the water surface elevation are positivity preserving as proved in previous studies e g bryson et al 2011 kurganov and petrova 2007 beljadid et al 2016a hanini et al 2021 and karjoun et al 2022 in our case to guarantee the positivity of the computed water depth in the whole domain at all times we apply the procedure developed in bryson et al 2011 for the positivity preserving correction of the piecewise linear reconstruction for the water surface elevation note that in the proposed numerical model we used ssp rk2 which guarantees also the positivity of the computed water depth since ssp rk2 is a convex combination of two steps euler methods 4 discretization of friction source terms numerical simulations of overland flows with friction effects may lead to nonphysical solutions although implicit schemes are widely used for modeling shallow water flows with friction effects these schemes may encounter convergence issues if iterative techniques are used to solve the obtained system in this study we introduce a semi implicit technique for friction source terms based on taylor series expansion in our approach we rewrite the first equation of the semi discrete form of the scheme 5 for the water depth using the forward euler method 16 h j n α h j n α δ t t j k 1 3 γ j k a j k i n a j k o u t cos θ j k a j k i n p j k n m j k a j k o u t p j n m j k sin θ j k a j k i n q j k n m j k a j k o u t q j n m j k a j k i n a j k o u t h j k n m j k h j n m j k α δ t r j n where α 0 1 and r j n is the first order discretization of the rainfall source term in the cell t j at time t n n δ t next the discharges are expressed at time t n 1 as 17 p j n 1 p j n δ t a x n δ t g n f 2 h j n α 7 3 p j n α p j n α 2 q j n α 2 q j n 1 q j n δ t a y n δ t g n f 2 h j n α 7 3 q j n α p j n α 2 q j n α 2 where a x n and a y n are respectively the x and y components of the discretizations of the fluxes and topographic source term which are expressed as follows 18 a x n 1 t j k 1 3 γ j k a j k i n a j k o u t cos θ j k a j k i n p j k n 2 m j k h j k n m j k 1 2 g h j k n 2 m j k a j k o u t p j n 2 m j k h j n m j k 1 2 g h j n 2 m j k sin θ j k a j k i n p j k n m j k q j k n m j k h j k n m j k a j k o u t p j n m j k q j n m j k h j n m j k a j k i n a j k o u t p j k n m j k p j n m j k s b j 2 19 a y n 1 t j k 1 3 γ j k a j k i n a j k o u t cos θ j k a j k i n p j k n m j k q j k n m j k h j k n m j k a j k o u t p j n m j k q j n m j k h j n m j k sin θ j k a j k i n q j k n 2 m j k h j k n m j k 1 2 g h j k n 2 m j k a j k o u t q j n 2 m j k h j n m j k 1 2 g h j n 2 m j k a j k i n a j k o u t q j k n m j k q j n m j k s b j 3 where the components of the topography source term s b j 2 and s b j 3 are given by eq 12 to discretize the friction source terms in 17 we propose a semi implicit technique where we consider the functions 20 φ p q p p 2 q 2 h p q q p 2 q 2 these expressions are used to rewrite eq 17 in the following form 21 p j n 1 p j n δ t a x n δ t g n f 2 h j n α 7 3 φ n α q j n 1 q j n δ t a y n δ t g n f 2 h j n α 7 3 h n α where the time index n α corresponds to the value of a variable at time between t n and t n 1 as shown in fig 2 we compute the water depth h j n 1 using eq 16 for α 1 the water depth at time t n α given by eq 16 satisfies the relationship h j n α α h j n 1 1 α h j n with α 0 1 which is used to compute h j n α we used taylor expansion keita et al 2021c b a of the operators in eq 20 to linearize the friction term 22 φ p j n α q j n α φ n φ p n p j n α p j n φ q n q j n α q j n h p j n α q j n α h n h p n p j n α p j n h q n q j n α q j n and the introduced parameters used on the right hand side of the above eq 22 are obtained using simple algebraic calculations as follows 23 φ p φ p 2 p 2 q 2 p 2 q 2 φ q φ q p q p 2 q 2 h p h p p q p 2 q 2 h q h q p 2 2 q 2 p 2 q 2 where we omit time index n for simplicity the above results lead to the following new form of eq 17 24 p j n 1 p j n δ t a x n δ t g n f 2 h j n α 7 3 φ n φ p n p j n α p j n φ q n q j n α q j n q j n 1 q j n δ t a y n δ t g n f 2 h j n α 7 3 h n h p n p j n α p j n h q n q j n α q j n from the approximations p j n α α p j n 1 1 α p j n and q j n α α q j n 1 1 α q j n we obtain p j n α p j n α p j n 1 p j n and q j n α q j n α q j n 1 q j n using these simplifications and by rearranging eq 24 becomes 25 1 δ t β j n α α φ p n p j n 1 δ t β j n α α φ q n q j n 1 r h p δ t β j n α α h p n p j n 1 1 δ t β j n α α h q n q j n 1 r h q where β j n α g n f 2 h j n α 7 3 and r h p and r h q are explicitly expressed as follows 26 r h p p j n δ t a x n δ t β j n α φ n α φ p n p j n α φ q n q j n r h q q j n δ t a y n δ t β j n α h n α h p n p j n α h q n q j n we note that the matrix of the system 25 is symmetric thanks to the relationship φ q h p mentioned in eq 23 finally the discharges at time level t n 1 are computed using the following formulas 27 p j n 1 1 d j n r h p 1 δ t β j n α α h q n r h q δ t β j n α α φ q n q j n 1 1 d j n r h q 1 δ t β j n α α φ p n r h p δ t β j n α α h p n where d j n is the determinant of the obtained system 25 expressed as 28 d j n 1 3 δ t β j n α α p j n 2 q j n 2 2 δ t 2 β j n α 2 α 2 p j n 2 q j n 2 which is greater than one for all values of h p and q we note that under some conditions the effects of advection and topography can reverse the flow direction xia and liang 2018 but the friction effects can only decelerate the flow and the maximum is to stop the propagation of the fluid in the following we will consider a one dimensional system to analyze the impact of friction effects at the discrete level on the direction of the discharge for one dimensional system q j n 0 we have 29 φ n p j n p j n h n 0 φ p n 2 p j n φ q n 0 h p n 0 h q n p j n and we get 30 r h p p j n δ t a x n δ t β j n α 1 2 α p j n p j n d j n 1 2 δ t α β j n α p j n 1 δ t α β j n α p j n p j n finally eq 27 is used to obtain the discharge 31 p j n 1 p j n δ t a x n δ t β j n α p j n p j n 1 2 α 1 2 δ t α β j n α p j n the second term in the numerator of eq 31 is related to the impact of the advection and topography the third term in the numerator and the term in the denominator of 31 are related to the effect of friction it is interesting to note that for the value of α 0 5 the third term in the numerator which may impact the sign of the resulting discharge vanishes this leads to the following expression of the discharge 32 p j n 1 p j n δ t a x n 1 δ t β j n 1 2 p j n the value of the denominator of eq 32 is positive and becomes large in the case of small water depths especially near the wet dry area we conclude from eq 32 that the only impact of the proposed discretization of friction term on the resulting discharge due to advection and topography p j n δ t a x n is the reduction of its absolute value without inverting its sign the value α 0 5 which also presents the advantage in terms of accuracy will be used in our numerical simulations in section 6 5 exact balance between bed friction and bed slope in this section we will analyze the balance at the discrete level between the proposed discretization for friction source terms and the discretization of the bottom topography described in section 3 we note that uniform channel flow is characterized by an exact balance between bed friction and bed slope in the following we will prove that the proposed method is capable to preserve the following class of non trivial steady state solutions for uniform channel flow chertock et al 2015 33 h h 0 p p 0 q 0 x z c y z 0 r 0 where we consider a steady flow with constant non vanishing velocity and water depth over an inclined topography with a constant slope and the water depth is expressed as follows 34 h 0 n f 2 p 0 2 c 3 10 we assume that at time t n 35 h j n h 0 p j n p 0 q j n 0 x z j c y z j 0 r j n 0 j where h 0 p 0 and c are positive constants and satisfying the condition 34 in the following we will prove that the proposed techniques preserve this type of solution at the next time step t n 1 i e 36 h j n 1 h 0 p j n 1 p 0 q j n 1 0 j since we are using linear reconstruction at time step t n under the condition 35 we obtain constant water depth and discharges at cell interfaces with the same values as in 35 then eq 16 can be written as follows 37 h j n α h 0 α δ t t j k 1 3 γ j k a j k i n a j k o u t cos θ j k a j k i n p 0 a j k o u t p 0 h 0 α δ t t j p 0 k 1 3 γ j k cos θ j k h 0 where we used k 1 3 γ j k cos θ j k 0 which is satisfied for every triangle therefore h n α h 0 for every value of α 0 1 in particular for α 1 similarly to the water depth we will prove that q j n 1 0 by substituting the values at time t n of the water depth and discharges at cell interfaces in eq 19 we obtain 38 a y n 1 t j k 1 3 γ j k a j k i n a j k o u t sin θ j k a j k i n 1 2 g h 0 2 a j k o u t 1 2 g h 0 2 s b j 3 1 t j 1 2 g h 0 2 k 1 3 γ j k sin θ j k s b j 3 s b j 3 since k 1 3 γ j k sin θ j k 0 eq 12 becomes 39 s b j 3 g 2 t j k 1 3 γ j k h 0 2 sin θ j k 0 therefore a y n 0 since q j n 0 h n 0 and h p n 0 then r h q 0 and finally from the second equation in 27 we conclude that q j n 1 0 in the following we will prove that p j n 1 p 0 we first compute a x n from eq 18 40 a x n 1 t j k 1 3 γ j k a j k i n a j k o u t cos θ j k a j k i n p 0 2 h 0 1 2 g h 0 2 a j k o u t p 0 2 h 0 1 2 g h 0 2 s b j 2 s b j 2 g h 0 c we have φ n p 0 2 φ p n 2 p 0 and q j n 0 then eq 26 leads to 41 r h p p 0 δ t g h 0 c δ t β j n α p 0 2 2 α p 0 2 using β j n α β 0 g n f 2 h 0 7 3 and eq 34 we obtain g h 0 c β 0 p 0 2 then eq 41 can be written as follows 42 r h p p 0 1 2 δ t β 0 α p 0 then the first equation in 27 becomes 43 p j n 1 r h p 1 δ t β 0 α p 0 1 2 δ t β 0 α p 0 1 δ t β 0 α p 0 p 0 we note that the proof we present using the forward euler temporal scheme remains valid if the method ssp rk2 is used since this method is a combination of two forward euler steps then the proposed numerical model preserves the exact balance between topography and friction source terms for uniform channel flows 6 model validation this section is devoted to numerical experiments which are performed to test the proposed discretization of the friction source term in terms of stability and accuracy the ssp rk2 temporal method described in the appendix is used to discretize the semi discrete finite volume scheme reference solutions and laboratory experiments are used to validate the results of the proposed numerical model in all numerical tests the gravitational acceleration is set to g 9 81ms 2 spatial discretizations are based on unstructured triangular grids as shown in fig 3 the following time step condition is used for the numerical stability of the scheme 44 δ t c f l δ t c where δ t c 1 6 min j k h j k max j k a j k o u t h j k are the heights of the triangle t j in the following numerical tests the c f l constant is set to 0 7 and the parameter α 0 5 in our numerical simulations we used the desingularisation procedure kurganov and petrova 2007 to avoid division by very small values of the computed water depth 6 1 example 1 analysis of the accuracy in this section we analyze the order of accuracy of the proposed numerical model using an analytical solution michel dansac et al 2017 the computational domain is 0 3 0 3 0 4 1 and the bottom topography is given by 45 z x y 2 g n f 2 s 1 2 g s 2 where s x y t we consider the following steady solution michel dansac et al 2017 of eq 1 46 h x y t 1 p x y t x s 2 q x y t y s 2 where the boundary and initial conditions are obtained from the analytical expressions 46 these conditions are used to perform simulations using the proposed numerical model until the final time t 0 1 s the l 1 error is computed as follows 47 e 1 t i 1 n t i f i f i e x where t is the area of the domain and n is the number of computational cells table 1 presents the errors and the convergence rates at the final time t t for the variables h p and q for different sizes of triangular meshes for small sizes of the computational cells we obtain good results in terms of convergence rate 6 2 example 2 experimental rainfall runoff several experimental rainfall runoff tests for different values for the slope roughness and rainfall intensity using an artificial rainfall simulator have been conducted by the los angeles district of the u s army corps of engineers this experiment was reported in part in the original report in yu and mcnown 1963 in this example we consider the test case 1 from yu and mcnown 1963 using a concrete surface with a slope of 0 02 152 4m long and 0 3m wide and the manning coefficient is set to 0 011sm 1 3 the domain which is initially dry receives a constant rainfall intensity of 180mmh 1 during 8min through an artificial rainfall simulator and the duration of the experiment is 16min all boundaries of the domain are closed except for the outlet of the domain for which we consider outflow condition in fig 4 we present the computed discharge hydrographs at the channel outlet using the proposed numerical model and the numerical models using the techniques developed for friction source terms in xia and liang 2018 and xia et al 2017 where we used the central upwind method for the flux term the numerical simulations are performed until the final time t 16 min using computational grids with an average cell areas t j 0 015 with c f l 0 7 and the reference solution is obtained using the friction term discretization proposed in xia and liang 2018 the central upwind method ssp rk2 for temporal discretization a refined mesh with an average cell areas t j 0 0038 and c f l 0 2 fig 4 shows the computed discharge for each method as well as the reference solution and experimental data the l 1 error is computed as follows 48 e 1 n i n q t i q r e f t i where q and q r e f are the computed discharges using the numerical solution of each method and the reference solution respectively in 48 we used n 32 discrete points in time from our simulations table 2 presents the computed errors for three methods and confirms the accuracy of the proposed techniques fig 5 presents the observed yu and mcnown 1963 and computed hydrographs using a grid with the cell average areas t j 0 0046 and c f l 0 7 and shows the improvement of the results of the proposed numerical model by decreasing the size of computational cells our model predictions are in good agreement with the experimental observations in order to be consistent in terms of comparison of the computational cost we compare the developed method and the method proposed in xia and liang 2018 for friction source term where we used an unstructured central upwind scheme with linear reconstruction in space and the euler method for the temporal discretization a triangular mesh discretization is used with the cell average areas t j 0 015 we perform numerical simulations using the proposed method with c f l 0 7 and we obtain an l 1 error of 2 38 e 5 and cpu time of 725s to obtain the same result in terms of accuracy the method using the techniques proposed in xia and liang 2018 for friction term requires the value of c f l 0 33 which leads to a cpu time of 1380s this demonstrates the efficiency of the proposed method in terms of computational cost 6 3 example 3 idealized v shaped catchment experiment in this numerical test we consider the idealized v shaped catchment overton and brakensiek 1970 which involves very small water depth and stiff bottom topography this challenging example is used to validate the proposed approach in predicting overland flows with stiff friction term an approximate analytical solution for the v shaped catchment was developed see overton and brakensiek 1970 and meadows and stephenson 1986 for more details based on kinematic wave assumptions this approximation approach is used in previous studies xia and liang 2018 xia et al 2017 di giammarco et al 1996 to compute a reference solution based on other characteristics of the domain and data which will be used in this study and described in the following a rectangular computational domain 0 1000 0 1620 is considered and discretized using an unstructured triangular mesh with an average cell areas t j 35 as illustrated in fig 6 two slopes are used 0 05 for the two sides with 1000m long and 800m wide each and 0 02 for the channel with 1000m long and 20m wide having the manning coefficient 0 015sm 1 3 and 0 15sm 1 3 respectively xia and liang 2018 xia et al 2017 di giammarco et al 1996 wall boundary conditions are used everywhere except for the downstream outlet at the end of the channel where outflow boundary condition is imposed initially the domain is dry and we consider a constant rainfall intensity of 10 8mmh 1 during t 1 5h fig 7 shows a comparison between the computed hydrographs at the channel outlet using the proposed method and previous methods developed by xia and liang 2018 and xia et al 2017 as well as the reference solution obtained based on the approximation approach and data mentioned before the proposed method is in good agreement with the reference solution and all methods converge to the same solution we note that for this numerical test there is no significant difference between the computed discharge hydrographs using our method and those proposed in xia and liang 2018 and xia et al 2017 6 4 example 4 two dimensional surface rainfall runoff experimental test in this example we consider a challenging numerical test based on the experiments performed by iwagaki 1955 in the presence of rainfall runoff phenomena over variable topography with a cascade of three planes see fig 8 we perform numerical simulations to test the capability of the numerical model using the proposed discretization of the friction source term to reproduce the results of two experimental sets a and b in iwagaki 1955 in the first experiment a we consider one inclined plane of slope 0 015 with a length of 24m and width of 0 196m which is initially dry in iwagaki 1955 a mechanism of lateral supply of water into the experimental flume is used to ensure the most uniform distribution possible of 299 88cmh 1 in the second experiment b three flat sections inclined decreasingly with slopes equal to 0 02 0 015 and 0 01 respectively are considered where each of these planes is 8m long and 0 196m wide these three planes are also initially dry and receiving a lateral supply of water of 389cmh 1 230cmh 1 and 288cmh 1 respectively in the experiment a four cases of water supply regime are considered with durations of 10s 20s 30s and 40s and three for the experiment b using durations of 10s 20s and 30s for all the experiments considered in this example the domain is discretized using 2828 triangular cells and the manning coefficient is set to 0 009sm 1 3 the domain is closed except for the channel outlet where outflow boundary conditions are imposed we plot the numerical results and data of the experiment a for the discharge hydrograph and water depth at the channel outlet for the different water supply durations 10s 20s 30s and 40s in figs 9 12 respectively the numerical results and data of the experiment b are shown in figs 13 15 for the water supply durations 10s 20s and 30s respectively as shown in figs 9 12 for the experiment a we observe good agreement between our numerical simulations and experimental data for the discharge and water depth hydrographs for the experiment b in fig 13 a we observe that the computed hydrograph of the discharge is in good agreement with experimental data for the water supply duration t 10 s we note that the peak of the hydrograph of the discharge is a bit overestimated which is generally observed for available techniques costabile et al 2013 fiedler and ramirez 2000 compared to the experiment performed in iwagaki 1955 for the water depth shown in fig 13 b we obtain good agreement between numerical simulations and experimental data for the water supply durations 20s and 30s figs 14 and 15 show good agreement between our numerical simulations and the data of experiment b for both the discharge and water depth hydrographs with an overestimation near the peak of the discharge finally we conclude that we observe good overall agreement between the predictions of the numerical model for overland flow using the proposed discretization techniques for the friction source term and the experiments performed by iwagaki 1955 for modeling rainfall runoff phenomena over variable topography 6 5 example 5 dam break wave over a triangular bottom sill experiment here the numerical model using the proposed discretization techniques for the friction source terms is applied to perform simulations and the results are compared with the laboratory experiments conducted by soares frazão 2007 in a channel of length 5 6m and width 0 5m which is delimited by a solid wall along its borders a diaphragm representing a dam is placed at x 2 39m in the part of the domain at the left of the diaphragm the water depth is h 0 111m while the part of the domain at the right of the diaphragm is dry as shown in fig 16 a symmetrical triangular bottom sill 0 9m long and 0 065m height is placed at the downstream of the channel the area of the channel between the sill and the wall at the downstream is initially filled with water of depth h 0 02m this numerical test is challenging since it involves sharp topography and wet dry zones which generates complex behaviors of the flow the computational domain is discretized into 7792 unstructured triangular cells the numerical test is performed using the manning coefficient of value 0 011sm 1 3 as estimated in the experiment performed in soares frazão 2007 we perform the numerical simulations until the final time t 45s of the laboratory experiment soares frazão 2007 fig 17 shows three dimensional views of the water surface elevation at different times and confirms that the proposed method satisfies the positivity of the computed water depth in the presence of dry zone and under complex topography fig 18 presents the numerical results of the model against experimental measurements for the water surface elevation at the gauges g 1 g 2 and g 3 shown in fig 16 we obtain a good agreement between numerical simulations and experimental data which confirms the accuracy of the proposed numerical techniques for modeling overland flows to analyze the long term mass conservation in fig 19 we present the ratio q t q 0 where q 0 and q t are the total water volume computed at the initial and time t respectively the results confirm that the proposed numerical model satisfies the conservation of mass in a closed system 7 conclusion shallow water equations is among the most commonly used models for simulating rainfall runoff processes and overland flows in this study we used a second order temporal scheme ssp rk2 and an unstructured well balanced positivity preserving finite volume method to discretize shallow water equations and proposed a novel discretization technique for friction source terms for modeling overland flow over complex topography in our approach we used taylor series expansion to linearize the friction source terms in the momentum equations using only the discharge variables since the water depth at the next time level is computed from the continuity equation this allows us to solve the system using semi implicit techniques without increasing the stiffness of the problem for small water depth the proposed approach leads to a numerical model for overland flow which is capable of handling both the stiffness of friction source terms and the positivity of the computed water depth in the proposed techniques no iterative methods are used in the central upwind scheme and in the proposed technique for friction source terms numerical simulations are performed to validate the proposed numerical model based on reference solutions and laboratory experiments involving rapidly varying flows sharp topography small water depth and wet dry zones the proposed techniques are stable and second order accurate we obtain good agreement between numerical solutions and experimental data the proposed numerical model can be used to simulate overland flow over variable topography with friction effects the novel discretization techniques for friction source terms can be incorporated in hydrological models in the presence of stiff friction effects to improve the accuracy and the efficiency in terms of computational cost of the models declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the first author acknowledges funding from um6p ocp group of morocco um6p ocp 2018 appendix a time integration method here we apply the two stage second order runge kutta method for the semi discrete scheme 5 the first step of the method is defined as follows 49 h n h n δ t a h n δ t r n p n p n δ t a x n δ t c p n q n q n δ t a y n δ t c q n and the second step is given by 50 h n 1 1 2 h n 1 2 h n 1 2 δ t a h n 1 2 δ t r n p n 1 1 2 p n 1 2 p n 1 2 δ t a x n 1 2 δ t c p n 1 q n 1 1 2 q n 1 2 q n 1 2 δ t a y n 1 2 δ t c q n 1 where we used 51 c p n g n f 2 h n 1 2 7 3 φ n 1 2 φ p n p n p n 1 2 φ q n q n q n c q n g n f 2 h n 1 2 7 3 h n 1 2 h p n p n p n 1 2 h q n q n q n c p n 1 g n f 2 h n 1 2 7 3 φ n 1 2 φ p n p n 1 p n 1 2 φ q n q n 1 q n c q n 1 g n f 2 h n 1 2 7 3 h n 1 2 h p n p n 1 p n 1 2 h q n q n 1 q n with h n 1 2 h n h n 2 and h n 1 2 h n h n 1 2 appendix b in this appendix we briefly recall the friction source term discretizations proposed in xia et al 2017 and xia and liang 2018 in xia et al 2017 the momentum components of the scheme are written as follows 52 q j n 1 q j n δ t a j n s f j n 1 where q j p j q j a j is the momentum components of the convective fluxes and slope source terms and s f j is the friction source term in xia et al 2017 the following equation is solved 53 u j n 1 u j n δ t a j n s f j n 1 where u j n 1 q j n 1 h j n 1 u j n q j n h j n 1 a j n a j n h j n 1 h j n 1 is known from the continuity equation and 54 s f j n 1 g n f 2 h j n 1 4 3 u j n 1 u j n 1 eq 53 is solved using the newton raphson iterative method 55 u p 1 u p i δ t j u p 1 δ t s f u p δ t a j n u p u j n where i is the identity matrix j is the jacobian matrix of s f and p denotes the index of iteration steps the convergence criteria u p 1 u p 0 001 u p is used in xia et al 2017 in xia and liang 2018 the momentum components are expressed as follows 56 p j n 1 p j n δ t b x δ t g n f 2 h j n 7 3 p j n 1 p j n 1 2 q j n 1 2 q j n 1 q j n δ t b y δ t g n f 2 h j n 7 3 q j n 1 p j n 1 2 q j n 1 2 where b x and b y are the contributions of the flux and topography in x and y directions respectively eq 56 is solved analytically to find p j n 1 and q j n 1 and slightly modified to avoid singularity in the calculation xia and liang 2018 using eqs 57 and 58 given in box i where m x p j n δ t b x and m y q j n δ t b y 
53,we consider non linear bayesian inversion problems targeting the geostatistical hyperparameters of a random field describing hydrogeological or geophysical properties given hydrogeological or geophysical data this problem is of particular importance in the non ergodic setting as there are no analytical upscaling relationships linking the data to the hyperparameters such as mean standard deviation and integral scales full inversion of the hyperparameters and the local properties of the field typically involving many thousands of unknowns brings substantial computational challenges such that simplifying model assumptions e g homogeneity or ergodicity are typically made to prevent the errors resulting from such simplified assumptions while also circumventing the burden of high dimensional full inversions we use a pseudo marginal metropolis hastings algorithm that treats the random field as latent variables in this random effects model the intractable likelihood of observing the data given the hyperparameters is estimated by monte carlo averaging over realizations of the random field to increase the efficiency of the method low variance approximations of the likelihood ratio are obtained by using importance sampling and by correlating the samples used in the proposed and current steps of the markov chain we assess the performance of this correlated pseudo marginal method by considering two representative inversion problems involving diffusion based and wave based physics respectively in which we infer the hyperparameters of 1 hydraulic conductivity fields using apparent hydraulic conductivity data in a data poor setting and 2 fracture aperture fields using borehole ground penetrating radar gpr reflection data in a more data rich setting for the first test case we find that the correlated pseudo marginal method generates similar estimates of the geostatistical mean as classical rejection sampling while an inversion assuming ergodicity provides biased estimates for the second test case we find that the correlated pseudo marginal method estimates the hyperparameters well while rejection sampling is computationally unfeasible and a simplified model assuming homogeneity leads to biased estimates graphical abstract keywords geostatistics hyperparameters bayesian inversion latent variable model likelihood estimation non ergodicity data availability data will be made available on request 1 introduction the scale dependence of most environmental processes poses significant challenges for hydrogeological and geophysical modeling e g klemeš 1983 blöschl and sivapalan 1995 the governing partial differential equations pdes traditionally employed to describe fluid flow chemical or electrical transport neuman and di federico 2003 are solved at some support volume scale assumed to be a representative elementary volume rev hill 1963 that is it is assumed that smaller scale heterogeneity averages out and can be represented with regard to the process under consideration by averaged physical or chemical properties in practice the conditions necessary for the existence of a rev are often not met because geological media exhibit heterogeneity over a wide range of scales neuman and di federico 2003 errors occurring when only partially accounting for or ignoring heterogeneity generally grow with the non linearity of the physical or chemical process under study and can result in misleading predictions e g dentz et al 2011 yu and michael 2021 for this reason it is essential to characterize and account for the statistical properties of small scale heterogeneity even when targeting mean properties we consider non linear inversion problems targeting geostatistical hyperparameters e g mean standard deviation integral scale and anisotropy factor of a random field describing hydrogeological or geophysical properties given indirect data this problem setting is applicable when the main properties of interest are the hyperparameters and not the local field properties the geostatistical literature is full of studies e g rehfeldt et al 1992 hess et al 1992 bohling et al 2016 focusing on hyperparameter estimation based on direct data e g permeability data along boreholes but much less work has considered indirect data e g pressure data tracer breakthrough data as in the present study in what follows we only discuss this latter case one of the first approaches considering unknown hyperparameters in such an inversion setting was the quasi linear geostatistical approach by kitanidis 1995 which optimizes the hyperparameters along with the spatial field another approach enabling joint inference of a gaussian random field and its variogram parameters relied on so called sequential gibbs sampling hansen et al 2012 hansen et al 2013a hansen et al 2013b zhao and luo 2021 applied an iterative approach based on principal components which is updating biased or unknown hyperparameters while solving a non linear inversion problem recently wang et al 2022 proposed an hierarchical bayesian inversion targeting first global variables such as hyperparameters but also physical variables and later the posterior of the whole field referred to as spatial variables note that none of these studies focus on inferring the hyperparameters only we rely on a bayesian framework and infer the hyperparameters posterior probability density function pdf given indirect hydrogeological or geophysical measurements to sample from the posterior we apply a markov chain monte carlo mcmc method building on the metropolis hastings algorithm mh hastings 1970 metropolis et al 1953 the basic procedure of the mh algorithm in this setting is to propose iteratively a new set of hyperparameters which are then accepted or rejected based on their prior probabilities and likelihoods we consider synthetic experimental setups in which the hydrogeological or geophysical data average over a random field realization that is either ergodic or non ergodic a random field must be stationary to be ergodic but not vice versa stationarity implies that the distribution does not change with position ergodicity on the other hand implies that the field realization is much larger than the characteristic scale of heterogeneity by the so called ergodic setting we consider data that average over a scale that is much larger than the field s scale of heterogeneity such that the effects of small scale fluctuations average out consequently the data do not depend on the local properties of a given random field realization but on the hyperparameters only by the non ergodic setting we refer to cases when the data averaging takes place over a scale that is smaller or comparable to the scale of heterogeneity this implies that the data depend not only on the hyperparameters but also on the random field realization on which measurements are made that is variations between field realizations in terms of magnitudes and locations of high and low property values lead to different data responses as the fluctuations do not average out broadly speaking such behavior is expected when the physical response is averaging over length scales that are less than some ten correlation lengths of the parameter field in the non ergodic setting there are no analytical upscaling relationships linking the data to the hyperparameters of interest if relationships assuming ergodicity or assumptions of homogeneity are employed in such a case bias is likely to occur in the inferred hyperparameters e g visentini et al 2020 shakas and linde 2017 we suggest that most measurements in hydrogeology and geophysics take place in such a non ergodic setting equivalent properties derived from measurements of one type of physics e g the equivalent aperture describing fluid flow generally do not represent the equivalent property for another type of physics e g the equivalent aperture of thermal transport e g tsang 1992 this disparity occurs as soon as the underlying physics is non linear implying for instance that equivalent mean properties do not correspond to arithmetic mean properties e g jougnot et al 2018 shakas and linde 2015 one solution to this problem that is pursued in the present study is to instead infer hyperparameters while accounting for small scale heterogeneity in this way it is possible to use estimates derived from one type of physics to make predictions for another type of physics in many ergodic settings upscaling theory provides relevant relationships between hyperparameters and equivalent properties e g renard and de marsily 1997 torquato and haslach 2002 sanchez vila et al 2006 while no such relationships are available in the non ergodic setting one way to infer hyperparameters in the non ergodic setting by mcmc methods is to parameterize the field by hyperparameters and white noise to describe the local properties as e g in laloy et al 2015 hunziker et al 2017 and xiao et al 2021 the corresponding full inversion problem involves typically many thousands of parameters for which either an efficient mh proposal scheme has to be designed e g xiao et al 2021 or dimensionality reduction arguments have to be invoked e g laloy et al 2015 rubin et al 2010 while the first approach is very challenging curse of dimensionality e g robert et al 2018 the second approach may lead to biased estimates laloy et al 2015 an example of the application of dimensionality reduction relevant to the current study is shakas et al 2018 who inferred fracture aperture distribution and geometry by combining gpr forward modeling with flow and transport simulations even if this study provided reasonable estimates of the statistical properties it was plagued by a low acceptance rate slow mixing of the chains and no formal convergence despite a large number of iterations instead of a full inversion we here target the hyperparameters of interest only since the local properties of the field influence the observations in the non ergodic setting the field is considered a latent unobservable variable due to the random effect the unobservable field has on the data we speak of a random effects model to implement a mh algorithm inferring the hyperparameters only we have to evaluate the likelihood of observing the data given the currently proposed set of hyperparameters in a random effects model this likelihood has generally no analytical form and is therefore referred to as intractable the pseudo marginal pm method introduced by beaumont 2003 and studied by andrieu and roberts 2009 relies on an unbiased estimator of this intractable likelihood function that is based on averaging over monte carlo samples of the latent variables this implies that after proposing a new set of hyperparameters different field realizations with the same hyperparameters are sampled then the likelihood of each field realization can be calculated and the intractable likelihood function is estimated by averaging over the obtained values beaumont 2003 demonstrates that using such a non negative and unbiased estimator of the likelihood within the mh algorithm results in an algorithm that draws samples from the same target distribution as when using the true likelihood in the pm method a high variance of the log likelihood ratio estimator has a very strong adverse impact on performance but achieving a low variance often comes at the price of using an excessive number of samples in the monte carlo averaging to obtain an efficient algorithm balancing these two aspects it has been shown that the standard deviation of the log likelihood estimator should be around 1 2 1 5 doucet et al 2015 this can be ensured by 1 properly choosing the number of samples used in the monte carlo averaging and by 2 applying importance sampling to draw the realizations of the latent variables in the context of state space models the number of samples has to increase linearly with the number of observations which is computationally impractical in data rich settings deligiannidis et al 2018 to address this problem the correlated pseudo marginal cpm by deligiannidis et al 2018 correlates the draws of latent variables between two subsequent iterations thereby reducing the number of monte carlo draws needed to ensure low variance log likelihood ratio approximations the pseudo marginal and correlated pseudo marginal methods have hardly been studied in hydrogeological and geophysical settings in friedli et al 2022 the cpm method was shown to outperform other competing approaches to lithological tomography bosch 1999 in which geophysical data are used to directly infer hydro geological properties of interest friedli et al 2022 considered a very high dimensionality of the target and latent variables under the assumption of known hyperparameters here the interest is instead placed on inferring few hyperparameters while accounting for the effects of thousands of latent variables this leads to a very different model setting and study objectives than friedli et al 2022 we assess the performance of the cpm method with two synthetic test cases in which we infer the hyperparameters describing 1 hydraulic property fields using equivalent apparent hydraulic conductivity data and 2 fracture aperture fields using borehole ground penetrating radar gpr reflection data the two test cases are chosen to be representative for transmission problems governed by diffusion e g groundwater flow heat transport electrical conduction and reflection problems governed by wave based physics e g gpr seismics and acoustics in the first test case we consider a very data poor setting and are mainly interested in the geostatistical mean of the field by comparing the cpm results with those of an mh algorithm that replaces the forward solver with an analytical upscaling relationship that assumes ergodicity we show that assuming a simplified model can lead to strongly biased estimates of the hyperparameters in the non ergodic setting we also demonstrate that the cpm results are in agreement with those obtained by rejection sampling which is computationally feasible for this very data poor example in the second test case we consider much more data and show that the cpm method provides accurate estimates of the geostatistical mean and other hyperparameters additionally we show how these hyperparameters describing aperture properties inferred from gpr data allow us to predict fracture transmissivity this paper is structured as follows section 2 introduces the cpm methodology in the considered context section 3 presents the first test case based on measurements across a hydraulic conductivity field and section 4 presents the second test case in which borehole gpr data are used to infer the hyperparameters of fracture aperture fields this is followed by a discussion in section 5 and conclusions in section 6 2 methodology the methodology section starts by presenting the considered random effects model and the chosen notation of gaussian random fields section 2 1 bayesian inference and mcmc algorithms are then described section 2 2 before introducing the correlated pseudo marginal method section 2 3 and giving a brief introduction into rejection sampling section 2 4 it ends with a description of the performance assessment metrics used to evaluate the results section 2 5 2 1 random effects model we are interested in a random field describing hydrogeological or geophysical property distributions a random field spatial stochastic process x d ω with ω ω is a family of random variables indexed by the spatial location d d r 2 chiles and delfiner 2009 for fixed ω ω 0 x ω 0 is a realization of the random field with ω referring to the randomness of the field for a fixed location d d 0 x d 0 is a real valued random variable for simplicity in the following we write x to indicate x ω the true hydrogeological or geophysical property field is considered a realization of the underlying random field we are interested in inferring the hyperparameters θ parameterizing the geostatistical distribution of the random field x we consider a gaussian random field grf x for which all finite dimensional distributions are multivariate gaussians chiles and delfiner 2009 its distribution is determined by the mean and the covariance function we assume the mean function μ θ to be constant even if it would be straightforward to employ a non stationary function for the covariance function c θ we apply the powered exponential expressed here in isotropic form 1 c θ b b σ 2 e x p b b i 2 h whereby b b t b denotes the euclidean norm σ the standard deviation i the integral scale and h the hurst exponent with 0 h 1 for h 0 5 the powered exponential covariance function reduces to the classical exponential covariance function and for h 1 to the gaussian squared exponential covariance function we also consider geometric anisotropy e g chiles and delfiner 2009 for which the covariance depends not only on the euclidean distance but also on the direction between the considered positions we assume a known anisotropy angle of 90 degrees and refer to the integral scale in the vertical direction as i y which multiplied by the anisotropy factor λ gives the integral scale in the horizontal direction i x to infer the p hyperparameters θ θ 1 θ 2 θ p we have access to t measurements y y 1 y 2 y t as generally there exists no upscaling relationship linking the hyperparameters to the measurements we formulate the problem with a random effects model using the latent random field x 2 x f θ y x g θ x for the latent random field x we use a discretized representation on a d d grid whereby we assume the grid cells to be representative elementary volumes rev for the governing physical process we consider a setting in which the number of target hyperparameters p is much smaller than the number of latent variables grid cells d 2 the measurements are described by the random variable y g x ɛ o with g r d 2 r t denoting the physical forward solver and ɛ o the observational noise while y refers to the random variable y denotes the true measurements considered to be a realization of y assuming the latent random field to be gaussian we write f θ x φ d 2 x μ θ σ θ with φ d 2 μ θ σ θ denoting the pdf of a d 2 variate normal distribution with mean vector μ θ μ θ b i 1 i d 2 and covariance matrix σ θ c θ b i b j 1 i j d 2 specified by the hyperparameters θ furthermore we assume the observational noise ɛ o to be gaussian such that y x g θ x is distributed with the pdf g θ y x φ t y g x σ y with σ y being a diagonal matrix with the variance of the observational noise on its diagonal to generate a realization of the d 2 dimensional grf x with mean vector μ θ and covariance matrix σ θ we rely on a pixel based parameterization 3 x μ θ σ θ 1 2 z with z denoting a d 2 dimensional random vector consisting of i i d standard normal distributed variables 2 2 bayesian inference with markov chain monte carlo bayes theorem specifies the posterior pdf p θ y of the model parameters θ conditioned on the measurements y as 4 p θ y p θ p y θ p y p θ p y θ where p θ denotes the prior pdf of the model parameters p y θ the likelihood function and p y the evidence assumed positive if there is no analytical form of the posterior pdf but it is possible to evaluate the unnormalized entity for some value of θ mcmc methods see e g robert and casella 2013 can be applied to generate realizations drawn proportionally from the posterior pdf the basic procedure behind mcmc algorithms is to propose new values for the target parameters which are then accepted or rejected with a given probability the metropolis hastings mh metropolis et al 1953 hastings 1970 method is a well known example at iteration j it proceeds as follows first new values for the target parameters θ j are proposed using the model proposal density q θ j 1 then the acceptance probability 5 α m h θ j 1 θ j min 1 q θ j 1 θ j p θ j y q θ j θ j 1 p θ j 1 y 6 min 1 q θ j 1 θ j p θ j p y θ j q θ j θ j 1 p θ j 1 p y θ j 1 is calculated and the proposed θ j is accepted if α m h θ j 1 θ j v or rejected if α m h θ j 1 θ j v on the basis of a draw of a uniformly distributed random variable v unif 0 1 if the proposed θ j is rejected the mcmc chain remains at the old position θ j θ j 1 in order to evaluate the acceptance probability in eq 6 the value of the likelihood function θ p y θ j has to be calculated in a random effects model see section 2 1 the likelihood function is given by 7 p y θ g θ y x f θ x d x this integral often does not admit an analytical form making the direct implementation of the mh algorithm impossible and specific algorithms such as the correlated pseudo marginal method are needed outlined in section 2 3 below 2 2 1 mcmc proposal scheme to achieve an efficient mcmc algorithm one needs a suitable proposal density q θ j 1 even in an inversion targeting only few parameters one has to choose the direction and size of the model proposal steps carefully too large steps lead to a low acceptance rate while too small steps lead to very slow exploration of the target space both of these situations lead to an algorithm needing an unnecessarily large number of iterations until convergence see section 2 5 below for the assessment of convergence to generate model proposals we apply the adaptive metropolis algorithm of haario et al 2001 in which the covariance matrix describing the gaussian proposal distribution is updated during the mcmc run despite the adaptation the algorithm is ensured to be ergodic although not markovian haario et al 2001 the gaussian proposal distribution at iteration j is expressed as q θ j θ 0 θ 1 θ j 1 φ d θ j 1 c j with 8 c j c 0 j j 0 s p c o v θ 0 θ 1 θ j 1 ϵ i p j j 0 denoting the evolving covariance matrix during the first j 0 iterations the method uses an initial covariance matrix c 0 selected according to available prior knowledge after this initial period the covariance matrix is updated with c j s p c o v θ 0 θ 1 θ j 1 ϵ i p where s p is a parameter depending on the dimension of the target space haario et al 2001 use s p 2 4 2 p as in gelman et al 1996 ϵ 0 is a small constant and i p denotes the identity matrix of dimension p to ensure an efficient calculation haario et al 2001 use the recursion formula 9 c j 1 j 1 j c j s p j j θ j 1 θ j 1 t j 1 θ j θ j t θ j θ j t ϵ i p with θ j 1 j 1 i 0 j θ i and θ i considered to be column vectors for a target parameter θ i with bounded support a b one has to make sure that the proposed value lies within the considered interval therefore we apply fold boundary handling implying that a proposal which passes one boundary of the support is re entered through the other boundary vrugt 2016 that is similar to periodic boundary conditions in numerical simulations 2 3 pseudo marginal and correlated pseudo marginal method in section 2 2 we explained that the considered random effects model has an intractable likelihood function the pseudo marginal and correlated pseudo marginal methods presented below provide a solution to this in the form of monte carlo estimations of the likelihood function to illustrate the presented concepts a flow chart describing the basic procedure of the correlated pseudo marginal method is depicted in fig 1 2 3 1 pseudo marginal method a mh algorithm employing a non negative unbiased estimator of the likelihood function samples realizations of the same target distribution as one using the true likelihood beaumont 2003 to exploit this remarkable property beaumont 2003 proposes a mh algorithm estimating at each iteration an intractable likelihood function using monte carlo averaging over samples of the latent variables this approach was termed the pseudo marginal pm method and analyzed theoretically by andrieu and roberts 2009 the efficiency of the pm method depends mainly on the variability of the likelihood estimator when only one brute force monte carlo sample of the latent variables is used to estimate the likelihood the algorithm is likely to suffer from a low acceptance rate caused by the high variability of the log likelihood estimator this happens when the likelihood estimator can take very different values for different realizations of the latent variables in our setting this is the case if different local properties of the latent random field x lead to very different data responses even if the hyperparameters of the fields are the same the variance of the log likelihood estimator can be reduced by 1 using many samples of the latent variables and 2 selecting a well working importance sampling is e g owen and zhou 2000 scheme to draw them from the pm method proposes the following unbiased estimator for the likelihood p y θ of eq 7 10 p ˆ n y θ 1 n n 1 n w θ y x n with w θ y x n g θ y x n f θ x n m θ x n where x n i i d m θ for n 1 2 n with m θ denoting the importance density function to derive the importance density x m θ we follow the approach of friedli et al 2022 therefore we choose a distribution which is nearly proportional to x g θ y x f θ x see e g owen and zhou 2000 referring to the results of kahn and marshall 1953 since it holds that p x θ y g θ y x f θ x we approximate the importance density with a gaussian expression of x p x θ y for details see appendix a 2 3 2 correlated pseudo marginal method the efficiency of the pm method depends strongly on the number of latent variable samples n used to estimate the likelihood function if this number is too low the variability of the log likelihood ratio estimator is likely to be high and the mh algorithm suffers from an impractically low acceptance rate beaumont 2003 in the context of state space models deligiannidis et al 2018 show that n needs to increase linearly with the number of data t thereby often implying prohibitively high computational costs for this reason deligiannidis et al 2018 adapted the pm method by correlating the draws of latent variables used in the current and proposed step of the mh algorithm the resulting correlated pseudo marginal method cpm method illustrated in fig 1 leads to a better performance as the variance of a ratio of estimators is reduced when positively correlating the estimators of the denominator and numerator koop 1972 for a standard normal distributed latent variable z the cpm method draws a correlated realization of the n th latent variable in iteration j by 11 z n j ρ z n j 1 1 ρ 2 ϵ with ρ 0 1 and ϵ ϵ 1 ϵ 2 ϵ l ϵ i i i d n 0 1 as numerous distributions can be obtained by transformations from standard normal variates the general applicability of the cpm method is not limited by the uncorrelated gaussian assumption e g chen et al 2018 for example in our two test cases that will follow we generate correlated gaussian latent variables x with mean μ θ and covariance matrix σ θ or μ is and σ is by transforming correlated standard normally distributed variables z using eq 3 we stress that the proposed latent variables z n j are only saved if θ j is accepted otherwise we keep z n j z n j 1 as for θ j θ j 1 in the mh algorithm the cpm method has two additional parameters compared to the standard mh algorithm the latent variable sample size n and the correlation parameter ρ deligiannidis et al 2018 propose to select n and ρ such that the variance of the log likelihood ratio estimator 12 w log p ˆ n j y θ log p ˆ n j 1 y θ takes values between 1 0 and 2 0 for θ fixed in a region of high posterior probability mass in practice decreasing the variance of the estimator requires 1 more samples of the latent field or 2 a higher correlation of the samples making the exploration of the latent space slower the range of 1 0 to 2 0 ensures a reasonable trade off between the variance of the estimator the exploration of the latent space which would be slowed down by high ρ and the computational cost increases with increasing n the region of θ with high posterior mass can be chosen based on an initial mcmc run with n and ρ selected according to available prior knowledge this choice can be inefficient but will anyway give some first information in practice we first fix the number of samples n such that it is smaller than the number of available parallel processors then we test a range of values for ρ and select one leading to v a r w being between 1 0 and 2 0 2 4 rejection sampling rejection sampling rs ripley 1987 is a basic monte carlo technique to generate independent samples from the posterior pdf while it often suffers from an unfeasibly low acceptance rate it is an exact sampling method e g robert and casella 2013 proceeding as follows 1 sample θ from its prior distribution p θ 2 sample u from a uniform distribution over 0 1 3 accept θ if u p y θ s l where s l is the supremum of the likelihood function for our random effects model section 2 1 we estimate the intractable likelihood p y θ by sampling one brute force realization x of the latent variable field x f θ with hyperparameters θ 13 p ˆ y θ g θ y x φ t y g x σ y det 2 π σ y 1 2 exp 1 2 y g x t σ y 1 y g x in practice an important challenge of rs methods is the need to estimate a tight bound s l for the likelihood function the most conservative choice is to assume a perfect data fit such that for our gaussian likelihood function above we get s l det 2 π σ y 1 2 but this will typically lead to an acceptance rate being close to zero if we assume the errors to be equal to the standard deviation of the observational noise we get s l det 2 π σ y 1 2 exp 1 2 t which might lead to some bias as some realizations are likely to have higher likelihoods one further possibility is to use the maximum likelihood value of the prior samples to achieve this rs is run by first saving all sampled prior realizations and their corresponding likelihood values from this database the maximum likelihood value is determined and all samples are assessed using this value to obtain some accepted prior samples of θ while ensuring an accurate estimate we combine the second and the third approach and use the maximum of those two values as the supremum s l 2 5 performance assessment to assess if the cpm algorithm has converged we use the r ˆ statistic of gelman and rubin 1992 comparing the within chain variance with the between chain variance of the second half of the mcmc chains we follow the convention that the r ˆ statistic has to be smaller or equal to 1 2 for all model parameters we also consider the acceptance rates ar which are aimed to be between 15 and 30 as proposed by vrugt 2016 we evaluate the amount of information gained by the inversion by comparing the marginal prior and posterior pdfs of the hyperparameters this is achieved using the kullback leibler divergence kl divergence kullback and leibler 1951 expressing the distance between two pdfs z p 1 z and z p 2 z assumed positive by 14 k l p 1 p 2 p 1 z log p 1 z p 2 z d z if k l p 1 p 2 0 this means that the two pdfs are equal almost everywhere while an increasing value indicates diverging distributions for example for a standard normal pdf p 2 a kl divergence k l p 1 p 2 0 1 is obtained by reducing the standard deviation within a centered standard normal p 1 to 0 7 and a kl divergence k l p 1 p 2 1 is obtained by reducing the standard deviation to 0 23 to approximate the posterior pdfs we apply kernel density estimation to the posterior samples with manually adapted bandwidth to assess the quality of the posterior estimates we use histograms to visually compare the marginal distributions with the true underlying values additionally we evaluate the accuracy of the obtained posterior samples for each hyperparameter θ i i 1 2 p numerically by applying a so called scoring rule krüger et al 2021 a scoring rule assesses the accuracy of a predictive pdf z p z with respect to a true value θ by accounting for both the statistical consistency between predictions and observations calibration and the sharpness of the prediction gneiting and raftery 2007 for our test cases we employ the logarithmic score logs good 1952 defined by 15 logs p θ log p θ that is related to the kullback leibler divergence gneiting and raftery 2007 if we compare two posterior estimates the one with the lower score is favored in practice as for the kl divergence we use a kernel density estimate of the posterior samples which depends on the choice of the kernel and the bandwidth of the kernel smoothing window we use a gaussian kernel with manually adapted bandwidth our testings show that the choice influences the specific score values but that the main results in terms of comparisons and conclusions are robust if the posterior samples do not include the true value of θ the density estimate of p θ can be numerically zero resulting in a logarithmic score of infinity the logarithmic score is also available for multivariate densities thereby allowing evaluation of the estimated joint posterior pdfs of the hyperparameters 3 test case 1 hydraulic conductivity field hydraulic conductivity is a key hydrogeological property particularly in contamination studies the spatial variation of hydraulic conductivity plays an important role as it has a major influence on solute movement 9 visentini et al 2020 rely on time lapse electrical resistance data during a tracer test to demonstrate that measurements of equivalent electrical properties at a given scale can be used to infer hyperparameters of the hydraulic conductivity field below this scale here we seek to infer the hyperparameters of a log hydraulic conductivity field in a data poor setting involving only horizontally and vertically averaged equivalent hydraulic conductivity data with such limited data it is tempting to ignore heterogeneity or rely on upscaling relations valid for ergodic fields as there is little hope that the data can constrain the field or its hyperparameters well this example is used to demonstrate that ignoring heterogeneity or assuming ergodicity leads to significant errors when estimating the geostatistical mean furthermore this data poor setting allows for comparisons with rejection sampling section 2 4 thereby demonstrating that the cpm method targets the right posterior of the hyperparameters 3 1 data and inversion setting we target a 1 m 1 m log hydraulic conductivity field distributed according to a gaussian random field g r f μ θ c θ with constant mean μ θ and exponential covariance function c θ eq 1 with h 0 5 we allow geometric anisotropy section 2 1 and denote the integral scale in the vertical direction depth as i y and the anisotropy factor as λ together with the mean and standard deviation of the log field this forms the hyperparameters θ μ σ i y λ although we are mainly interested in the mean we infer the other hyperparameters along with it thereby accounting for the possible non ergodicity of the field the log hydraulic conductivity field natural logarithm is generated on a 100 100 grid cell size is 1 cm using a pixel based approach section 2 1 3 1 1 synthetic data generation we generate noise contaminated synthetic data in both an ergodic and a non ergodic setting for the ergodic setting we create one true field realization from which we obtain noise contaminated data by assuming the field to be isotropic and use θ l n 1 0 4 0 5 0 03 m 1 and for the non ergodic anisotropic case we choose θ l n 1 0 4 1 5 0 1 m 3 the true log hydraulic conductivity fields are shown in fig 2 due to the discretization of the field chosen to limit the number of grid cells the ergodic field is only nearly ergodic implying that the generated data will vary somewhat when considering different field realizations with the true hyperparameters in what follows we will refer to it as ergodic except when a more specific designation is needed for the simulated measurements we impose a hydraulic pressure gradient along either the horizontal or the vertical direction of the target field and observe a flux across one boundary this information can then be used to calculate the equivalent horizontal and vertical hydraulic conductivities given by visentini et al 2020 16 k h 1 φ h γ h k x x φ h x d x 17 k v 1 φ v γ v k x y φ v x d x where k x denotes the hydraulic conductivity at position x with x x y t referring to the 2 d position vector furthermore φ h φ v 1 kpa denotes the constant hydraulic pressure difference imposed along the horizontal and vertical direction respectively and φ h x and φ v x the resulting hydraulic head finally γ h and γ v refer to integration paths separating the left and right and the top and bottom boundaries respectively for the ergodic and isotropic field fig 2 a we obtain equivalent hydraulic conductivities of k h k v 9 2 1 0 5 m s and for the non ergodic anisotropic field fig 2 b we get an equivalent horizontal hydraulic conductivity of k h 6 6 1 0 5 m s and an equivalent vertical hydraulic conductivity of k v 4 8 1 0 5 m s finally we add i i d relative errors ɛ o to the data pairs using a centered gaussian distribution with a standard deviation given by 3 of the corresponding values 3 1 2 inversion settings and prior assumptions the cpm method is implemented running three chains in parallel with adaptive proposals section 2 2 1 using an initialization period of j 0 100 where c 0 is a diagonal matrix with 0 008 0 008 0 002 0 2 along its diagonal for the prior pdfs of the first three hyperparameters we use uniform distributions for the mean μ we use the interval log 1 0 5 log 1 0 3 a range of standard deviation σ in between 0 2 and for the integral scale i y we assume 0 m 0 5 m to account for the anisotropy factor λ being asymmetric around one we employ a log uniform distribution with boundaries 0 1 10 to tune n and ρ in the cpm method section 2 3 2 we consider the variance of the log likelihood ratio estimator w eq 12 fig 3 depicts the dependence of the variance of w on the correlation ρ for ten and fifty samples n 10 50 of the latent variable x for both the ergodic and the non ergodic data setting to evaluate the variances we fix θ at values having high posterior probability and draw realizations of the field by both sampling from its prior pdf f θ x nois and using importance sampling is appendix a in the ergodic setting fig 3 a all considered cases lead to variances of w being close to the target range between 1 0 and 2 0 recommended by deligiannidis et al 2018 even for ρ 0 this is not surprising as in a purely ergodic setting the realization of the random field does not influence the data for the non ergodic setting fig 3 b the variance of w is up to 1 0 3 times higher and it is necessary to employ importance sampling of course sampling from the prior could lead to variances of w being within the desired range but the required values of n and ρ would lead to either excessively high computational costs at each iteration or very slow mixing in the draws of the latent variables in the limit of ρ 1 the variance of w is trivially equal to zero for all settings as we use the same latent variable samples in the first and second term of w but this would lead to biased results initial mcmc runs showed that very diverse values of σ i y and λ have high posterior probabilities in both the ergodic and non ergodic data settings as in both cases non ergodic field realizations are sampled frequently by the cpm method to ensure a controlled variance for all values θ with high posterior probability for both data settings we perform importance sampling and choose n 50 and ρ 0 975 as it is appropriate for the more challenging non ergodic settings for comparison purposes we also run rejection sampling rs see section 2 4 and a mh inversion assuming the parameter field to be ergodic referred to as simplified mh fig 4 for rs we use the same number of field samples with corresponding forward simulations as needed by the cpm method for convergence for the simplified mh we rely on equations presented by gelhar and axness 1983 for the equivalent hydraulic conductivities in a two dimensional anisotropic infinite domain ensuring ergodicity under mean uniform flow conditions 18 k h k g 1 σ 2 1 2 1 1 λ 19 k v k g 1 σ 2 1 2 λ 1 λ with k g denoting the geometric mean of the linear hydraulic conductivity field k exp x entry wise exponential which is the only parameter influencing the response for isotropic fields λ 1 it holds that k g exp x with x being the arithmetic mean of x 3 2 results we consider first the posterior pdf of the geostatistical mean μ obtained with the cpm method for the data generated with the ergodic setting fig 2 a only the samples obtained for the second half of the chains after convergence has been declared with respect to the r ˆ statistics table 1 are shown the posterior pdf of the mean value μ in the ergodic data setting is centered around the true geostatistical mean and is clearly distinguishable from the uniform prior pdf fig 5 a this is confirmed by the correspondingly low logarithmic score emphasizing the accuracy of the posterior samples and the high kl divergence with respect to the prior pdf table 1 comparison with the posterior samples obtained with rs fig 5 b shows that both methods generate similar results with comparable kl divergences to the prior and almost equal logarithmic scores table 1 for the posterior samples obtained by assuming ergodicity simplified mh fig 4 we note a more compactly defined posterior than with cpm and rs with values of the mean being close to the true value c f figs 5 a 5 c still the logarithmic score of the mean is much higher than the one obtained with cpm and rs table 1 indicating that the samples generated under ergodic assumptions are not centered around the true geostatistical mean and are overconfident this somewhat paradoxical result is a consequence of the data setting only being nearly ergodic demonstrating the risk of getting biased and overconfident results even when the assumption of ergodicity is nearly fulfilled the considered measurement scale is indeed 33 times larger than the integral scale for the non ergodic data setting fig 2 b the cpm derived posterior distribution of the mean value μ contains the true value while being shifted towards the observed equivalent properties log k h and log k v leading to a higher logarithmic score than in the ergodic setting fig 5 d and table 1 the posterior samples obtained with rs fig 5 e are spread slightly wider than the ones of cpm thereby capturing more frequently the true value and leading to a lower kl divergence and a lower logarithmic score we note that rs has an acceptance rate of 0 04 in this very data poor and non ergodic setting in the non ergodic setting the simplified mh method leads to important errors in the estimated mean value fig 5 f indeed the posterior samples are located around the log transformed observed equivalent properties k h and k v and are removed from the true value of the geostatistical mean this is reflected in a logarithmic score of infinity see table 1 importantly while the inversion assuming ergodicity solely samples mean values outside of the true value and has a very small posterior width the cpm method includes the true value in the posterior samples figs 5 d and 5 f for the other hyperparameters σ i y and λ inferred along with the mean μ we get less well resolved posterior estimates with both the cpm method and rs indicating that they are only weakly resolved by the available data the corresponding plots are depicted in appendix b 4 test case 2 fracture aperture fields rock fractures play an important role as conduits or barriers for flow and solute transport their properties have often a major influence on hydrogeologic and geotechnical processes national research council nrc 1996 but field characterization is inherently difficult the high contrast between the electrical properties of the filling of the fractures and the host rock e g a water filled fracture in granite host rock leads to a very strong thin bed response in ground penetrating radar gpr data quite remarkably even sub mm apertures yield measurable gpr responses even when the wavelength in the host rock may be on a metric scale imaging and characterization of fractures with gpr data has been studied extensively both from a theoretical perspective e g bradford and deeds 2006 deparis and garambois 2008 and in controlled experiments e g grégoire and hollender 2004 tsoflias et al 2015 in these studies it is typically either assumed that the aperture and material properties do not vary over the first fresnel zone or that the influence of heterogeneous aperture fields average arithmetically in the acquired data in a modeling study shakas and linde 2017 assess this latter simplification by exploring a deterministic inversion in which the actual aperture field is heterogeneous at small scales while it is assumed to be homogeneous when inferred for despite that the data can be fitted to the noise level they find that the estimated apertures offer only reliable approximations of the arithmetic mean of the aperture field when the correlation length of the aperture heterogeneity is larger than the first fresnel zone since fractures are known to be highly heterogeneous with self affine properties the study by shakas and linde 2017 suggest that many gpr based estimations of mean apertures are biased and unreliable they suggest that such heterogeneity needs to be explicitly accounted for but they do not propose a solution in this second data rich test case we will demonstrate how the cpm method can be used to obtain unbiased estimates of the mean aperture and statistics pertaining to the aperture field we will then show how this information can be used to predict the equivalent hydraulic transmissivity of the fractures 4 1 data and inversion setting we consider a 5 m 5 m fracture aperture field x described as an isotropic gaussian random field g r f μ θ c θ with constant mean μ θ and powered exponential covariance function c θ as specified in eq 1 with the cpm method we target the mean μ the standard deviation σ the integral scale i i x i y and the hurst exponent h the heterogeneous aperture field x is simulated using a pixel based approach section 2 1 on a 50 50 dimensional grid d 50 cells of 10 cm side lengths 4 1 1 synthetic data generation the fracture aperture field from which data are generated is depicted in fig 6 a the true hyperparameters are θ μ σ i h 0 5 cm 0 1 0 2 m 0 8 we only consider a single fracture in a model domain of 10 m 10 m 10 m fig 6 b the background rock matrix is assumed to be homogeneous with a relative electrical permittivity of 9 and an electrical conductivity of 0 001 s m for the fracture we assume a constant relative electrical permittivity of 81 and electrical conductivity of 0 1 s m to generate the synthetic gpr reflection data we rely on the effective dipole method of shakas and linde 2015 this modeling framework combines analytical solutions for radiation in the matrix domain and dipole elements corresponding to discretized sections of the fracture radiating as electric dipoles modulated by the thin bed reflection coefficients a simple schematic of the method is represented in fig 6 c adapted from fig 3 of shakas and linde 2017 we use two gpr reflection traces generated with sources and receivers located 5 m away from the fracture and with offsets of 0 m and 2 m fig 6 b the source signal is assumed to be vertically oriented with a source spectrum consisting of a ricker wavelet with dominant wavelength of 100 cm with a discretization of 10 cm of the aperture field this results in 10 elements per dominant wavelength for which highly accurate simulations are expected shakas and linde 2017 the responses are generated in the frequency domain using a frequency range from zero to 300 mhz with a sampling step size of 1 mhz as in practice the amplitude of the source wavelet is unknown shakas and linde 2017 normalize the response values in the data generation and inversion here we instead introduce an unknown factor c a by which the responses are multiplied this factor is equal to one for the true data and it is inferred within the inversion this extends the target variables to θ μ σ 2 l c h c a finally for each of the 300 complex valued numbers representing the electric field we add independent realizations of gaussian measurement noise ɛ o with a standard deviation of 3 of the maximal value the inversions are performed in the frequency domain but we present for visual purposes the two corresponding traces in the time domain fig 6 d for completeness we also show the smoother traces fig 6 e obtained by sampling over the same frequency range with a sampling step size of 0 1 mhz 4 1 2 inversion settings and prior assumptions as in the first test case we run an adaptive metropolis hastings version of the cpm method with three chains in parallel we specify j 0 500 and c 0 as a diagonal matrix with 0 001 on its diagonal furthermore to ensure a suitable acceptance rate we decrease the step size by 50 for the prior pdfs of the hyperparameters we use uniform distributions for the mean μ we use unif 0 cm 1 cm for the standard deviation σ we use unif 0 cm 0 5 cm for the integral scale l c we use unif 0 m 1 m for the hurst exponent h we use unif 0 1 1 and for the amplitude factor c a we use unif 0 5 2 the importance sampling mean μ is for the latent aperture field x when the proposed θ j is the true hyperparameters is depicted in fig 7 a see formulas in appendix a fig 7 b depicts the dependence of the variance of the log likelihood ratio estimator w eq 12 on n and ρ the importance sampling leads to a tremendous decrease of the variance of w e g for n 1 and ρ 0 the variance of w is reduced from 1 0 6 to 1 0 2 furthermore increasing the number of latent variable samples n and the correlation parameter ρ also reduces the variance of w strongly following fig 7 b we run the cpm algorithm with n 5 and ρ 0 975 in combination with importance sampling to place the results obtained with cpm into context we compare them to those obtained with an inversion assuming the aperture field to be homogeneous illustrated with a flow chart in fig 8 to achieve this we only infer the mean aperture μ and the amplitude factor c a which is broadly similar to the inversion setting considered by shakas and linde 2017 4 2 results the estimated marginal posterior pdfs of θ μ σ 2 l c h c a obtained with the cpm method are depicted in figs 9 a 9 e convergence is reached within 10 000 iterations with respect to the r ˆ statistic and we display the results for the second half of the chains the histograms depicting the posterior samples of the mean μ fig 9 a standard deviation σ fig 9 b and amplitude factor c a fig 9 e show the strongest concentration with respect to the prior and correspondingly high kl divergences table 2 the sample range for the integral scale i fig 9 c and the hurst exponent h fig 9 d is equally wide as the respective prior pdfs and the corresponding kl divergences are rather small nonetheless the integral scale is preferentially sampled in the region of the true value as the values of the logarithmic score table 2 can generally not be compared between hyperparameters different width of support they will become of interest only in the comparison with a competing method figs 9 f and 9 g show the histograms of the posterior samples for the mean μ and the amplitude factor c a obtained for the inversion assuming a homogeneous aperture fig 8 the range of the samples is very narrow with high kl divergences with respect to the prior pdf table 2 but located far from the true parameter values this results in infinite logarithmic scores table 2 as we have seen the cpm method accounting for heterogeneity leads to posterior samples of the mean and amplitude factor that cover a wider range including the true values used to generate the data as reflected in lower logarithmic scores table 2 the estimates of the mean aperture μ and the amplitude factor c a are highly correlated fig 9 h shows that under the assumption of knowing c a 1 the range of the samples obtained with cpm for the mean aperture would be more narrow and shifted towards the true value of 0 5 cm we further see that the homogeneous inversion only explores a small part and the wrong part of the joint posterior model space leading to a logarithmic score of infinity for the estimated joint posterior pdf table 2 for this second data rich test case rejection sampling is unfeasible as the acceptance rate is below 0 001 4 2 1 predictions of hydraulic transmissivity to complement the results obtained for this gpr test case and to strengthen the link to hydrogeology we use the aperture field estimates to derive equivalent hydraulic transmissivities first we use the inferred mean apertures obtained with the inversion assuming the field to be homogeneous fig 9 f these aperture field realizations are used to derive hydraulic transmissivities at the fracture scale using the classical parallel plate model tsang 1992 20 t 1 12 η μ 3 with η 8 9 1 0 4 pa s denoting the dynamic viscosity 25 degree c and μ being the inferred mean aperture values in meters the resulting horizontal equivalent log hydraulic transmissivities are shown in fig 10 light gray this result is now compared with the value obtained for the true aperture field under the assumption that the reynolds equation is valid implying that we can apply eq 20 locally to obtain a hydraulic transmissivity field and then solve numerically for the resulting effective transmissivity at the fracture scale the results show that the true effective hydraulic transmissivity is roughly one order of magnitude smaller and that the posterior pdf of the homogeneous inversion light gray is nowhere close to include this value this is reflected in a infinite logarithmic score we then sample field realizations using the posterior pdfs of the hyperparameters inferred with the cpm method the resulting equivalent log hydraulic transmissivity values are shown in fig 10 blue this distribution is much wider it includes the true value and the mean is clearly shifted towards the true value the corresponding logarithmic score is 0 23 5 discussion our two test cases presented in sections 3 and 4 demonstrate the ability of the correlated pseudo marginal method cpm method fig 1 to estimate the posterior pdf of the target field s hyperparameters e g mean standard deviation integral scale hurst exponent and anisotropy factor while accounting for the impact of small scale heterogeneity within the estimate of the likelihood function we further demonstrate that inversions invoking simplified assumption such as ergodicity or homogeneity lead to biased and overconfident results such that the inferred posteriors often do not include the true values compared to previous inversion approaches targeting hyperparameters e g laloy et al 2015 and xiao et al 2021 the cpm method infers the hyperparameters only thereby avoiding to infer the posterior pdf of the many thousands of latent variables the two presented test cases cover one data poor transmission problem governed by diffusion e g electrical conduction heat conduction or groundwater flow and one more data rich reflection problem governed by wave based physics e g gpr seismics acoustics the generality of these settings suggest that the cpm method has a wide applicability in hydrogeology and geophysics the first test case related to heterogeneous hydraulic conductivity fields concerns a very data poor setting in which only the horizontal and vertical equivalent hydraulic conductivities are used as data points to compare the performance of the cpm method with an inversion assuming ergodicity referred to as simplified mh fig 4 we consider a nearly ergodic and a non ergodic data setting in both settings the geostatistical mean of the model domain can be inferred from the equivalent conductivities using the cpm method in the ergodic setting both the cpm method and the simplified mh lead to reasonable estimates of the geostatistical mean with the posterior range of the cpm method being wider as its underlying assumptions are less restrictive figs 5 a and 5 c in the non ergodic data setting the simplified mh leads to important errors in the estimation of the geostatistical mean with a posterior range far from the true value fig 5 f for the cpm method the estimated posterior uncertainty is wider and the true value of the mean is included fig 5 d thereby the logarithmic score is reduced from infinity to 1 57 when applying cpm compared with the simplified mh table 1 we conclude that even in this extremely data poor setting the use of simplified model assumptions leads to a substantial bias in the mean estimate and an overconfident posterior bound for the other hyperparameters standard deviation integral scale and anisotropy factor we conclude that only little information can be gained in this data poor setting furthermore we demonstrate that the cpm results are in agreement with those obtained by rejection sampling in the second test case concerning fracture aperture fields we limit ourselves to a non ergodic data setting and compare the results obtained with cpm with those of an inversion assuming the aperture field to be homogeneous fig 8 we can consider this homogeneous inversion as either 1 an inversion inferring the geostatistical mean under simplified model assumptions or 2 an inversion targeting the equivalent gpr aperture we show that the homogeneous assumption leads to posterior samples being located far from the true geostatistical mean value fig 9 f demonstrating in accordance with shakas and linde 2017 1 that the geostatistical mean of the aperture field can be very different than the equivalent gpr aperture and 2 that inferring the geostatistical mean based on a too simple model description leads to biased estimates indeed in such an inversion one appears to get increasingly certain about the wrong parameter values as more data are added or the data noise level is decreased brynjarsdóttir and o hagan 2014 in contrast the cpm method accounting for non ergodicity and heterogeneity by inferring additionally for the standard deviation integral scale and hurst exponent leads to a wider posterior including the true value of the aperture mean fig 9 a for this second example employing the cpm method leads to a reduction of the logarithmic score from infinity to 0 60 for the posterior estimate of the mean in comparison with the homogeneous inversion table 2 additionally cpm enables to infer information about other hyperparameters standard deviation and integral scale of the field probabilistic inference of hyperparameters offers the possibility to translate from one type of equivalent property to another we demonstrate this by predicting the equivalent log hydraulic transmissivity at the fracture scale using the fracture aperture fields obtained in the second test case fig 10 the predicted values for the constant aperture field inversion are obtained by applying the equivalent gpr aperture in the cubic law when deriving hydraulic properties from these constant fields we assume that this equivalent gpr aperture is the same as the equivalent cubic law aperture in the sense of tsang 1992 which is the equivalent parallel plate aperture with respect to hydraulic flow properties these predictions are very different from those obtained from the true aperture field when applying the local cubic law fig 10 this visualizes clearly that the equivalent aperture for one type of physics cannot be assumed to be the same when considering another type of physics actually the equivalent aperture in a cubic law sense with respect to the hydraulic data of the true aperture field is 0 47 cm a value considerably diverging from the one inferred from the gpr data when assuming homogeneity about 0 9 cm using field realizations sampled with the posterior pdfs of the hyperparameters obtained by cpm lead to a wider and more accurate range of effective log hydraulic transmissivity values fig 10 while the logarithmic score for the transmissivity predictions obtained with the homogeneous inversion is infinity the one obtained with cpm is 0 23 this suggests that while equivalent properties always refer to one specific kind of physics the inference of hyperparameters enables a general description of the model domain the cpm method is well suited to achieve this by targeting only the hyperparameters of interest thereby enabling probabilistic forecasts for different types of physics this study expands further the range of applications that the cpm method can address in geoscientific settings while friedli et al 2022 used it to account for uncertainties in petrophysical relationships in the context of hydrogeophysics we provide here a very different problem setting in which the cpm method is used to account for non ergodicity and small scale heterogeneities when inferring hyperparameters in these examples we only consider heterogeneities in two dimensions in field applications the data are of course affected by heterogeneities outside the 2 d plane of measurements e g between boreholes or by outer space effects maurer and friedel 2006 to further improve the estimation and uncertainty quantification in such setups the cpm method could be employed to integrate out heterogeneities in three dimensions in the context of the present study or in the third out of plane dimension in the setting considered by friedli et al 2022 or in general 2 d inversions to avoid over confident and possibly biased estimates for the presented test cases we used a pixel based representation of the gaussian latent random field we stress that there exist many alternative ways to represent and generate a gaussian random field as for example the fast circulant embedding technique using a spectral representation by dietrich and newsam 1997 while such an approach offers an increased efficiency in the generation of the random field realizations careful consideration must be given on a case by case basis as to whether this could be integrated into a well working importance sampling strategy moreover in settings where the correlation length is of similar size as the model domain the embedding has to be extended and the efficiency is reduced we assume the latent random fields to be gaussian simplifying the derivation of the importance sampling density an important topic for future research would be to develop and assess suitable importance distributions in non gaussian settings the efficiency of the cpm method depends strongly on the variance of the log likelihood ratio estimator especially in settings with a high number of observations with a low signal to noise ratio one needs a well working importance density when sampling the latent variables the relevance of a well tuned importance sampling strategy becomes clear when comparing the number of samples needed to control the variance in the first and second test cases figs 3 and 7 b for the first test case the is density is of only moderate quality and many samples n 50 are needed even for this data poor setting for the second more data rich test case with a well defined is density only a few samples n 5 are sufficient if the determination of a well working is distribution is not feasible this can be detrimental to the applicability of the cpm method in such a scenario there is also the risk of poor exploration of the latent space namely if the likelihood estimator depends mainly on one or two latent variable samples with a particularly beneficial small scale structure one solution in such a scenario is to infer some additional main features of the latent field together with the hyperparameters and then to apply the cpm method to sample out the remaining randomness of the field this could be done using the main components of a dimensionality reduction approach and should reduce the importance of a well tuned is density we leave this idea for future research recently wang et al 2022 proposed an hierarchical bayesian inversion approach targeting first so called global variables such as hyperparameters but also physical variables and then estimating the posterior of the whole field for the estimation of the global variable s posterior in a non linear setting wang et al 2022 apply a machine learning based approach and train a neural network to output the global variables given a data realization followed by kernel density estimation of the results such a method relies on the ability to estimate the hyperparameters by brute force prior sampling and subsequent comparison of the resulting data with the true measurements in strongly non ergodic settings this can be computationally challenging as an unrealistically high number of prior samples would be needed to obtain reasonable estimates to illustrate this fig 11 shows the 100 highest log likelihood values sampled from 5000 prior samples of the aperture field in the second test case section 4 we note that no sample was generated with a likelihood close to the true one black horizontal line implying that an unfeasible large amount of samples would be needed to guarantee accurate hyperparameter estimates indeed even the highest sampled likelihood has a likelihood that is still 1 0 44 times smaller than the true likelihood in contrast our cpm method using three chains need 10 000 iterations per chain for convergence 6 conclusions we consider bayesian mcmc inversions inferring hyperparameters e g mean standard deviation and integral scales from hydrogeological or geophysical data to achieve this is particularly challenging in the non ergodic setting in which the data depend on the actual geostatistical field realization under consideration and not only on the hyperparameters to prevent errors arising when assuming homogeneity or ergodicity we rely on the correlated pseudo marginal method targeting the hyperparameters while integrating out the random effects of actual field realizations in the likelihood estimation this approach has the advantage of ensuring accurate posterior estimates of hyperparameters without having to infer thousands or more parameters as needed if the whole random field would be inferred to ensure efficiency the correlated pseudo marginal method employs importance sampling and correlation of the latent draws used in the proposed and current steps of the mcmc chain we assess the performance of this method through two synthetic test cases involving 1 diffusion based physics in a data poor setting targeting hydraulic properties using equivalent hydraulic conductivity data and 2 wave based physics in a more data rich example targeting a fracture aperture field using single hole ground penetrating radar gpr reflection data by using these two examples that are representative of a broad range of geophysical and hydrogeological problems we demonstrate that the correlated pseudo marginal method provides accurate estimation of the geostatistical mean in both ergodic and non ergodic settings furthermore for all considered hyperparameters we show that the correlated pseudo marginal method avoids over confident and biased posterior pdf estimates that plague inversion results obtained when assuming ergodicity or homogeneity estimating hyperparameters allows for a general description of property fields which is independent of the physics under consideration thereby allowing ultimately to use the estimated posterior pdfs to make predictions for other types of physics or experimental set ups this is demonstrated by transforming the fracture properties inferred by gpr data into predictions of equivalent hydraulic transmissivity at the fracture scale credit authorship contribution statement lea friedli conceptualization methodology software visualization formal analysis validation investigation writing original draft niklas linde supervision conceptualization methodology formal analysis funding acquisition writing review editing david ginsbourger supervision methodology writing review editing alejandro fernandez visentini software writing review editing arnaud doucet methodology writing review editing declaration of competing interest the authors declare the following financial interests personal relationships which may be considered as potential competing interests lea friedli reports financial support was provided by swiss national science foundation acknowledgment this work was supported by the swiss national science foundation project number 184574 no new experimental data were generated or analyzed in support of this research appendix a importance sampling for cpm as emphasized in section 2 3 2 it is essential that the variance of the log likelihood ratio estimator is low to ensure efficient pm or cpm performance especially in settings with large data sets with high signal to noise ratios the integrand g θ y x in eq 7 is likely to have a peak in a region of x with very small probability under its prior pdf x f θ x sampling the latent variables using the prior distribution then leads to an inefficient algorithm one remedy to this is importance sampling where instead of the prior distribution a so called importance distribution given by the pdf x m θ x is employed the importance distribution is chosen such that it preferentially generates samples with high g θ y x f θ x while guaranteeing that all values x for which g θ y x f θ x 0 are included in its support owen and zhou 2000 it holds a 1 g θ y x f θ x d x g θ y x f θ x m θ x m θ x d x from which the unbiased importance sampling estimate of the likelihood function in eq 10 is derived to minimize the variance of the estimator x m θ x should be nearly proportional to x g θ y x f θ x as presented in owen and zhou 2000 referring to the results of kahn and marshall 1953 since it holds that p x θ y g θ y x f θ x we use for the importance density an approximation of x p x θ y in section 2 1 we specify y g x ɛ o with g r d 2 r t being the physical forward solver and ɛ o the observational noise if the forward solver is non linear there is no exact expression for p x θ y for this reason we approximate p x θ y by expressing the map x g x based on either an upscaling formula assuming an anisotropic ergodic setting test case 1 or a linearization of the forward solver test case 2 following friedli et al 2022 we use gaussian distributions and a lemma about marginal and conditional gaussians see for example bishop 2006 lemma 1 marginal and conditional gaussians assume a marginal gaussian distribution for x r d 2 and a conditional gaussian distribution for y r t given x in the form a 2 p x φ t x μ λ 1 a 3 p y x φ t y ax b l 1 with φ t μ k denoting the pdf of the t variate normal distribution with mean μ and covariance matrix k then the marginal distribution of y and the conditional distribution of x given y are given by a 4 p y φ t y a μ b l 1 a λ 1 a t a 5 p x y φ l x σ a t l y b λ μ σ where σ λ a t la 1 test case 1 hydraulic conductivity fields we are concerned with the latent log conductivity field x f θ x φ l x μ θ σ θ and to express the measurements as a linear function of the latent field we use the log transformed eqs 18 and 19 out of sanchez vila et al 2006 a 6 l o g k h x l o g 1 σ 2 1 2 1 1 λ a 7 l o g k v x l o g 1 σ 2 1 2 λ 1 λ then we denote y l o g y and write y j x b with j being a 2 d 2 dimensional matrix with constant entries of 1 d 2 and b b 1 b 2 where b 1 l o g 1 σ 2 1 2 1 1 λ and b 2 l o g 1 σ 2 1 2 λ 1 λ subsequently we approximate g θ y x with g θ y x φ t y j x b σ y where σ y i 2 0 1 2 with i 2 denoting the two by two identity matrix with this choice of σ y we transfer the observational error to the log space and artificially increase the uncertainty to account for the errors resulting from the ergodic assumption made to derive the is distribution to finally derive an approximation for p x θ y we use eq a 5 a 8 p x θ y φ l x μ is σ is with μ is σ is j t σ y 1 y b σ θ 1 μ θ σ is σ θ 1 j t σ y 1 j 1 test case 2 fracture aperture fields we target the fracture aperture field x f θ x φ l x μ θ σ θ and locally approximate p x θ y by expressing the map x g x based on a first order expansion around x l i n as friedli et al 2022 a 9 g x g x l i n x x l i n g x l i n j x l i n x x l i n here j x l i n refers to the sensitivity jacobian matrix of the forward solver corresponding to x l i n which is a homogeneous field with the currently proposed geostatistical mean μ θ θ 1 subsequently we approximate g θ y x with g θ y x φ t y g x l i n j x l i n x x l i n σ y again we derive an approximation for p x θ y by using eq a 5 a 10 p x θ y φ l x μ is σ is with μ is σ is j x l i n t σ y 1 y g x l i n j x l i n x l i n σ θ 1 μ θ σ is σ θ 1 j x l i n t σ y 1 j x l i n 1 since this expression is approximate due to the linearization step we multiply σ y with a factor following friedli et al 2022 we use 1 2 as this choice led to a satisfactory performance appendix b complementary figures concerning test case 1 here we present the additional hyperparameter plots of the posterior samples obtained for the first test case section 3 fig b 1 shows the results obtained for the ergodic data setting fig 2 a and fig b 2 those for the non ergodic setting fig 2 b in the ergodic setting the posteriors of the standard deviation σ obtained by cpm fig b 1a rs fig b 1d and the simplified mh fig b 1g are as wide as the prior pdfs with the mode of the distributions being located around the right value for all three approaches thereby the posterior obtained with the simplified mh is better defined than the ones of rs and cpm the integral scale is only inferred by cpm fig b 1b and rs fig b 1e with both methods generating posterior samples still distributed proportionally to the uniform prior pdf for the anisotropy factor λ the simplified mh clearly favors values above 1 fig b 1h and the same holds true for rs fig b 1f finally cpm fig b 1c samples close to the prior pdf employing the data generated with the non ergodic setting we obtain posteriors favoring correctly the horizontal layering of the field whereby the estimates of rs fig b 2f and the simplified mh fig b 2h are better defined than the one of cpm fig b 2c for i y we again obtain estimates close to the prior for both rs fig b 2e and cpm fig b 2b while cpm also samples σ close to the prior fig b 2a the rs realizations show a tendency for higher values fig b 2d finally the simplified mh samples values of σ fig b 2g having a high concentration at incorrect values 
53,we consider non linear bayesian inversion problems targeting the geostatistical hyperparameters of a random field describing hydrogeological or geophysical properties given hydrogeological or geophysical data this problem is of particular importance in the non ergodic setting as there are no analytical upscaling relationships linking the data to the hyperparameters such as mean standard deviation and integral scales full inversion of the hyperparameters and the local properties of the field typically involving many thousands of unknowns brings substantial computational challenges such that simplifying model assumptions e g homogeneity or ergodicity are typically made to prevent the errors resulting from such simplified assumptions while also circumventing the burden of high dimensional full inversions we use a pseudo marginal metropolis hastings algorithm that treats the random field as latent variables in this random effects model the intractable likelihood of observing the data given the hyperparameters is estimated by monte carlo averaging over realizations of the random field to increase the efficiency of the method low variance approximations of the likelihood ratio are obtained by using importance sampling and by correlating the samples used in the proposed and current steps of the markov chain we assess the performance of this correlated pseudo marginal method by considering two representative inversion problems involving diffusion based and wave based physics respectively in which we infer the hyperparameters of 1 hydraulic conductivity fields using apparent hydraulic conductivity data in a data poor setting and 2 fracture aperture fields using borehole ground penetrating radar gpr reflection data in a more data rich setting for the first test case we find that the correlated pseudo marginal method generates similar estimates of the geostatistical mean as classical rejection sampling while an inversion assuming ergodicity provides biased estimates for the second test case we find that the correlated pseudo marginal method estimates the hyperparameters well while rejection sampling is computationally unfeasible and a simplified model assuming homogeneity leads to biased estimates graphical abstract keywords geostatistics hyperparameters bayesian inversion latent variable model likelihood estimation non ergodicity data availability data will be made available on request 1 introduction the scale dependence of most environmental processes poses significant challenges for hydrogeological and geophysical modeling e g klemeš 1983 blöschl and sivapalan 1995 the governing partial differential equations pdes traditionally employed to describe fluid flow chemical or electrical transport neuman and di federico 2003 are solved at some support volume scale assumed to be a representative elementary volume rev hill 1963 that is it is assumed that smaller scale heterogeneity averages out and can be represented with regard to the process under consideration by averaged physical or chemical properties in practice the conditions necessary for the existence of a rev are often not met because geological media exhibit heterogeneity over a wide range of scales neuman and di federico 2003 errors occurring when only partially accounting for or ignoring heterogeneity generally grow with the non linearity of the physical or chemical process under study and can result in misleading predictions e g dentz et al 2011 yu and michael 2021 for this reason it is essential to characterize and account for the statistical properties of small scale heterogeneity even when targeting mean properties we consider non linear inversion problems targeting geostatistical hyperparameters e g mean standard deviation integral scale and anisotropy factor of a random field describing hydrogeological or geophysical properties given indirect data this problem setting is applicable when the main properties of interest are the hyperparameters and not the local field properties the geostatistical literature is full of studies e g rehfeldt et al 1992 hess et al 1992 bohling et al 2016 focusing on hyperparameter estimation based on direct data e g permeability data along boreholes but much less work has considered indirect data e g pressure data tracer breakthrough data as in the present study in what follows we only discuss this latter case one of the first approaches considering unknown hyperparameters in such an inversion setting was the quasi linear geostatistical approach by kitanidis 1995 which optimizes the hyperparameters along with the spatial field another approach enabling joint inference of a gaussian random field and its variogram parameters relied on so called sequential gibbs sampling hansen et al 2012 hansen et al 2013a hansen et al 2013b zhao and luo 2021 applied an iterative approach based on principal components which is updating biased or unknown hyperparameters while solving a non linear inversion problem recently wang et al 2022 proposed an hierarchical bayesian inversion targeting first global variables such as hyperparameters but also physical variables and later the posterior of the whole field referred to as spatial variables note that none of these studies focus on inferring the hyperparameters only we rely on a bayesian framework and infer the hyperparameters posterior probability density function pdf given indirect hydrogeological or geophysical measurements to sample from the posterior we apply a markov chain monte carlo mcmc method building on the metropolis hastings algorithm mh hastings 1970 metropolis et al 1953 the basic procedure of the mh algorithm in this setting is to propose iteratively a new set of hyperparameters which are then accepted or rejected based on their prior probabilities and likelihoods we consider synthetic experimental setups in which the hydrogeological or geophysical data average over a random field realization that is either ergodic or non ergodic a random field must be stationary to be ergodic but not vice versa stationarity implies that the distribution does not change with position ergodicity on the other hand implies that the field realization is much larger than the characteristic scale of heterogeneity by the so called ergodic setting we consider data that average over a scale that is much larger than the field s scale of heterogeneity such that the effects of small scale fluctuations average out consequently the data do not depend on the local properties of a given random field realization but on the hyperparameters only by the non ergodic setting we refer to cases when the data averaging takes place over a scale that is smaller or comparable to the scale of heterogeneity this implies that the data depend not only on the hyperparameters but also on the random field realization on which measurements are made that is variations between field realizations in terms of magnitudes and locations of high and low property values lead to different data responses as the fluctuations do not average out broadly speaking such behavior is expected when the physical response is averaging over length scales that are less than some ten correlation lengths of the parameter field in the non ergodic setting there are no analytical upscaling relationships linking the data to the hyperparameters of interest if relationships assuming ergodicity or assumptions of homogeneity are employed in such a case bias is likely to occur in the inferred hyperparameters e g visentini et al 2020 shakas and linde 2017 we suggest that most measurements in hydrogeology and geophysics take place in such a non ergodic setting equivalent properties derived from measurements of one type of physics e g the equivalent aperture describing fluid flow generally do not represent the equivalent property for another type of physics e g the equivalent aperture of thermal transport e g tsang 1992 this disparity occurs as soon as the underlying physics is non linear implying for instance that equivalent mean properties do not correspond to arithmetic mean properties e g jougnot et al 2018 shakas and linde 2015 one solution to this problem that is pursued in the present study is to instead infer hyperparameters while accounting for small scale heterogeneity in this way it is possible to use estimates derived from one type of physics to make predictions for another type of physics in many ergodic settings upscaling theory provides relevant relationships between hyperparameters and equivalent properties e g renard and de marsily 1997 torquato and haslach 2002 sanchez vila et al 2006 while no such relationships are available in the non ergodic setting one way to infer hyperparameters in the non ergodic setting by mcmc methods is to parameterize the field by hyperparameters and white noise to describe the local properties as e g in laloy et al 2015 hunziker et al 2017 and xiao et al 2021 the corresponding full inversion problem involves typically many thousands of parameters for which either an efficient mh proposal scheme has to be designed e g xiao et al 2021 or dimensionality reduction arguments have to be invoked e g laloy et al 2015 rubin et al 2010 while the first approach is very challenging curse of dimensionality e g robert et al 2018 the second approach may lead to biased estimates laloy et al 2015 an example of the application of dimensionality reduction relevant to the current study is shakas et al 2018 who inferred fracture aperture distribution and geometry by combining gpr forward modeling with flow and transport simulations even if this study provided reasonable estimates of the statistical properties it was plagued by a low acceptance rate slow mixing of the chains and no formal convergence despite a large number of iterations instead of a full inversion we here target the hyperparameters of interest only since the local properties of the field influence the observations in the non ergodic setting the field is considered a latent unobservable variable due to the random effect the unobservable field has on the data we speak of a random effects model to implement a mh algorithm inferring the hyperparameters only we have to evaluate the likelihood of observing the data given the currently proposed set of hyperparameters in a random effects model this likelihood has generally no analytical form and is therefore referred to as intractable the pseudo marginal pm method introduced by beaumont 2003 and studied by andrieu and roberts 2009 relies on an unbiased estimator of this intractable likelihood function that is based on averaging over monte carlo samples of the latent variables this implies that after proposing a new set of hyperparameters different field realizations with the same hyperparameters are sampled then the likelihood of each field realization can be calculated and the intractable likelihood function is estimated by averaging over the obtained values beaumont 2003 demonstrates that using such a non negative and unbiased estimator of the likelihood within the mh algorithm results in an algorithm that draws samples from the same target distribution as when using the true likelihood in the pm method a high variance of the log likelihood ratio estimator has a very strong adverse impact on performance but achieving a low variance often comes at the price of using an excessive number of samples in the monte carlo averaging to obtain an efficient algorithm balancing these two aspects it has been shown that the standard deviation of the log likelihood estimator should be around 1 2 1 5 doucet et al 2015 this can be ensured by 1 properly choosing the number of samples used in the monte carlo averaging and by 2 applying importance sampling to draw the realizations of the latent variables in the context of state space models the number of samples has to increase linearly with the number of observations which is computationally impractical in data rich settings deligiannidis et al 2018 to address this problem the correlated pseudo marginal cpm by deligiannidis et al 2018 correlates the draws of latent variables between two subsequent iterations thereby reducing the number of monte carlo draws needed to ensure low variance log likelihood ratio approximations the pseudo marginal and correlated pseudo marginal methods have hardly been studied in hydrogeological and geophysical settings in friedli et al 2022 the cpm method was shown to outperform other competing approaches to lithological tomography bosch 1999 in which geophysical data are used to directly infer hydro geological properties of interest friedli et al 2022 considered a very high dimensionality of the target and latent variables under the assumption of known hyperparameters here the interest is instead placed on inferring few hyperparameters while accounting for the effects of thousands of latent variables this leads to a very different model setting and study objectives than friedli et al 2022 we assess the performance of the cpm method with two synthetic test cases in which we infer the hyperparameters describing 1 hydraulic property fields using equivalent apparent hydraulic conductivity data and 2 fracture aperture fields using borehole ground penetrating radar gpr reflection data the two test cases are chosen to be representative for transmission problems governed by diffusion e g groundwater flow heat transport electrical conduction and reflection problems governed by wave based physics e g gpr seismics and acoustics in the first test case we consider a very data poor setting and are mainly interested in the geostatistical mean of the field by comparing the cpm results with those of an mh algorithm that replaces the forward solver with an analytical upscaling relationship that assumes ergodicity we show that assuming a simplified model can lead to strongly biased estimates of the hyperparameters in the non ergodic setting we also demonstrate that the cpm results are in agreement with those obtained by rejection sampling which is computationally feasible for this very data poor example in the second test case we consider much more data and show that the cpm method provides accurate estimates of the geostatistical mean and other hyperparameters additionally we show how these hyperparameters describing aperture properties inferred from gpr data allow us to predict fracture transmissivity this paper is structured as follows section 2 introduces the cpm methodology in the considered context section 3 presents the first test case based on measurements across a hydraulic conductivity field and section 4 presents the second test case in which borehole gpr data are used to infer the hyperparameters of fracture aperture fields this is followed by a discussion in section 5 and conclusions in section 6 2 methodology the methodology section starts by presenting the considered random effects model and the chosen notation of gaussian random fields section 2 1 bayesian inference and mcmc algorithms are then described section 2 2 before introducing the correlated pseudo marginal method section 2 3 and giving a brief introduction into rejection sampling section 2 4 it ends with a description of the performance assessment metrics used to evaluate the results section 2 5 2 1 random effects model we are interested in a random field describing hydrogeological or geophysical property distributions a random field spatial stochastic process x d ω with ω ω is a family of random variables indexed by the spatial location d d r 2 chiles and delfiner 2009 for fixed ω ω 0 x ω 0 is a realization of the random field with ω referring to the randomness of the field for a fixed location d d 0 x d 0 is a real valued random variable for simplicity in the following we write x to indicate x ω the true hydrogeological or geophysical property field is considered a realization of the underlying random field we are interested in inferring the hyperparameters θ parameterizing the geostatistical distribution of the random field x we consider a gaussian random field grf x for which all finite dimensional distributions are multivariate gaussians chiles and delfiner 2009 its distribution is determined by the mean and the covariance function we assume the mean function μ θ to be constant even if it would be straightforward to employ a non stationary function for the covariance function c θ we apply the powered exponential expressed here in isotropic form 1 c θ b b σ 2 e x p b b i 2 h whereby b b t b denotes the euclidean norm σ the standard deviation i the integral scale and h the hurst exponent with 0 h 1 for h 0 5 the powered exponential covariance function reduces to the classical exponential covariance function and for h 1 to the gaussian squared exponential covariance function we also consider geometric anisotropy e g chiles and delfiner 2009 for which the covariance depends not only on the euclidean distance but also on the direction between the considered positions we assume a known anisotropy angle of 90 degrees and refer to the integral scale in the vertical direction as i y which multiplied by the anisotropy factor λ gives the integral scale in the horizontal direction i x to infer the p hyperparameters θ θ 1 θ 2 θ p we have access to t measurements y y 1 y 2 y t as generally there exists no upscaling relationship linking the hyperparameters to the measurements we formulate the problem with a random effects model using the latent random field x 2 x f θ y x g θ x for the latent random field x we use a discretized representation on a d d grid whereby we assume the grid cells to be representative elementary volumes rev for the governing physical process we consider a setting in which the number of target hyperparameters p is much smaller than the number of latent variables grid cells d 2 the measurements are described by the random variable y g x ɛ o with g r d 2 r t denoting the physical forward solver and ɛ o the observational noise while y refers to the random variable y denotes the true measurements considered to be a realization of y assuming the latent random field to be gaussian we write f θ x φ d 2 x μ θ σ θ with φ d 2 μ θ σ θ denoting the pdf of a d 2 variate normal distribution with mean vector μ θ μ θ b i 1 i d 2 and covariance matrix σ θ c θ b i b j 1 i j d 2 specified by the hyperparameters θ furthermore we assume the observational noise ɛ o to be gaussian such that y x g θ x is distributed with the pdf g θ y x φ t y g x σ y with σ y being a diagonal matrix with the variance of the observational noise on its diagonal to generate a realization of the d 2 dimensional grf x with mean vector μ θ and covariance matrix σ θ we rely on a pixel based parameterization 3 x μ θ σ θ 1 2 z with z denoting a d 2 dimensional random vector consisting of i i d standard normal distributed variables 2 2 bayesian inference with markov chain monte carlo bayes theorem specifies the posterior pdf p θ y of the model parameters θ conditioned on the measurements y as 4 p θ y p θ p y θ p y p θ p y θ where p θ denotes the prior pdf of the model parameters p y θ the likelihood function and p y the evidence assumed positive if there is no analytical form of the posterior pdf but it is possible to evaluate the unnormalized entity for some value of θ mcmc methods see e g robert and casella 2013 can be applied to generate realizations drawn proportionally from the posterior pdf the basic procedure behind mcmc algorithms is to propose new values for the target parameters which are then accepted or rejected with a given probability the metropolis hastings mh metropolis et al 1953 hastings 1970 method is a well known example at iteration j it proceeds as follows first new values for the target parameters θ j are proposed using the model proposal density q θ j 1 then the acceptance probability 5 α m h θ j 1 θ j min 1 q θ j 1 θ j p θ j y q θ j θ j 1 p θ j 1 y 6 min 1 q θ j 1 θ j p θ j p y θ j q θ j θ j 1 p θ j 1 p y θ j 1 is calculated and the proposed θ j is accepted if α m h θ j 1 θ j v or rejected if α m h θ j 1 θ j v on the basis of a draw of a uniformly distributed random variable v unif 0 1 if the proposed θ j is rejected the mcmc chain remains at the old position θ j θ j 1 in order to evaluate the acceptance probability in eq 6 the value of the likelihood function θ p y θ j has to be calculated in a random effects model see section 2 1 the likelihood function is given by 7 p y θ g θ y x f θ x d x this integral often does not admit an analytical form making the direct implementation of the mh algorithm impossible and specific algorithms such as the correlated pseudo marginal method are needed outlined in section 2 3 below 2 2 1 mcmc proposal scheme to achieve an efficient mcmc algorithm one needs a suitable proposal density q θ j 1 even in an inversion targeting only few parameters one has to choose the direction and size of the model proposal steps carefully too large steps lead to a low acceptance rate while too small steps lead to very slow exploration of the target space both of these situations lead to an algorithm needing an unnecessarily large number of iterations until convergence see section 2 5 below for the assessment of convergence to generate model proposals we apply the adaptive metropolis algorithm of haario et al 2001 in which the covariance matrix describing the gaussian proposal distribution is updated during the mcmc run despite the adaptation the algorithm is ensured to be ergodic although not markovian haario et al 2001 the gaussian proposal distribution at iteration j is expressed as q θ j θ 0 θ 1 θ j 1 φ d θ j 1 c j with 8 c j c 0 j j 0 s p c o v θ 0 θ 1 θ j 1 ϵ i p j j 0 denoting the evolving covariance matrix during the first j 0 iterations the method uses an initial covariance matrix c 0 selected according to available prior knowledge after this initial period the covariance matrix is updated with c j s p c o v θ 0 θ 1 θ j 1 ϵ i p where s p is a parameter depending on the dimension of the target space haario et al 2001 use s p 2 4 2 p as in gelman et al 1996 ϵ 0 is a small constant and i p denotes the identity matrix of dimension p to ensure an efficient calculation haario et al 2001 use the recursion formula 9 c j 1 j 1 j c j s p j j θ j 1 θ j 1 t j 1 θ j θ j t θ j θ j t ϵ i p with θ j 1 j 1 i 0 j θ i and θ i considered to be column vectors for a target parameter θ i with bounded support a b one has to make sure that the proposed value lies within the considered interval therefore we apply fold boundary handling implying that a proposal which passes one boundary of the support is re entered through the other boundary vrugt 2016 that is similar to periodic boundary conditions in numerical simulations 2 3 pseudo marginal and correlated pseudo marginal method in section 2 2 we explained that the considered random effects model has an intractable likelihood function the pseudo marginal and correlated pseudo marginal methods presented below provide a solution to this in the form of monte carlo estimations of the likelihood function to illustrate the presented concepts a flow chart describing the basic procedure of the correlated pseudo marginal method is depicted in fig 1 2 3 1 pseudo marginal method a mh algorithm employing a non negative unbiased estimator of the likelihood function samples realizations of the same target distribution as one using the true likelihood beaumont 2003 to exploit this remarkable property beaumont 2003 proposes a mh algorithm estimating at each iteration an intractable likelihood function using monte carlo averaging over samples of the latent variables this approach was termed the pseudo marginal pm method and analyzed theoretically by andrieu and roberts 2009 the efficiency of the pm method depends mainly on the variability of the likelihood estimator when only one brute force monte carlo sample of the latent variables is used to estimate the likelihood the algorithm is likely to suffer from a low acceptance rate caused by the high variability of the log likelihood estimator this happens when the likelihood estimator can take very different values for different realizations of the latent variables in our setting this is the case if different local properties of the latent random field x lead to very different data responses even if the hyperparameters of the fields are the same the variance of the log likelihood estimator can be reduced by 1 using many samples of the latent variables and 2 selecting a well working importance sampling is e g owen and zhou 2000 scheme to draw them from the pm method proposes the following unbiased estimator for the likelihood p y θ of eq 7 10 p ˆ n y θ 1 n n 1 n w θ y x n with w θ y x n g θ y x n f θ x n m θ x n where x n i i d m θ for n 1 2 n with m θ denoting the importance density function to derive the importance density x m θ we follow the approach of friedli et al 2022 therefore we choose a distribution which is nearly proportional to x g θ y x f θ x see e g owen and zhou 2000 referring to the results of kahn and marshall 1953 since it holds that p x θ y g θ y x f θ x we approximate the importance density with a gaussian expression of x p x θ y for details see appendix a 2 3 2 correlated pseudo marginal method the efficiency of the pm method depends strongly on the number of latent variable samples n used to estimate the likelihood function if this number is too low the variability of the log likelihood ratio estimator is likely to be high and the mh algorithm suffers from an impractically low acceptance rate beaumont 2003 in the context of state space models deligiannidis et al 2018 show that n needs to increase linearly with the number of data t thereby often implying prohibitively high computational costs for this reason deligiannidis et al 2018 adapted the pm method by correlating the draws of latent variables used in the current and proposed step of the mh algorithm the resulting correlated pseudo marginal method cpm method illustrated in fig 1 leads to a better performance as the variance of a ratio of estimators is reduced when positively correlating the estimators of the denominator and numerator koop 1972 for a standard normal distributed latent variable z the cpm method draws a correlated realization of the n th latent variable in iteration j by 11 z n j ρ z n j 1 1 ρ 2 ϵ with ρ 0 1 and ϵ ϵ 1 ϵ 2 ϵ l ϵ i i i d n 0 1 as numerous distributions can be obtained by transformations from standard normal variates the general applicability of the cpm method is not limited by the uncorrelated gaussian assumption e g chen et al 2018 for example in our two test cases that will follow we generate correlated gaussian latent variables x with mean μ θ and covariance matrix σ θ or μ is and σ is by transforming correlated standard normally distributed variables z using eq 3 we stress that the proposed latent variables z n j are only saved if θ j is accepted otherwise we keep z n j z n j 1 as for θ j θ j 1 in the mh algorithm the cpm method has two additional parameters compared to the standard mh algorithm the latent variable sample size n and the correlation parameter ρ deligiannidis et al 2018 propose to select n and ρ such that the variance of the log likelihood ratio estimator 12 w log p ˆ n j y θ log p ˆ n j 1 y θ takes values between 1 0 and 2 0 for θ fixed in a region of high posterior probability mass in practice decreasing the variance of the estimator requires 1 more samples of the latent field or 2 a higher correlation of the samples making the exploration of the latent space slower the range of 1 0 to 2 0 ensures a reasonable trade off between the variance of the estimator the exploration of the latent space which would be slowed down by high ρ and the computational cost increases with increasing n the region of θ with high posterior mass can be chosen based on an initial mcmc run with n and ρ selected according to available prior knowledge this choice can be inefficient but will anyway give some first information in practice we first fix the number of samples n such that it is smaller than the number of available parallel processors then we test a range of values for ρ and select one leading to v a r w being between 1 0 and 2 0 2 4 rejection sampling rejection sampling rs ripley 1987 is a basic monte carlo technique to generate independent samples from the posterior pdf while it often suffers from an unfeasibly low acceptance rate it is an exact sampling method e g robert and casella 2013 proceeding as follows 1 sample θ from its prior distribution p θ 2 sample u from a uniform distribution over 0 1 3 accept θ if u p y θ s l where s l is the supremum of the likelihood function for our random effects model section 2 1 we estimate the intractable likelihood p y θ by sampling one brute force realization x of the latent variable field x f θ with hyperparameters θ 13 p ˆ y θ g θ y x φ t y g x σ y det 2 π σ y 1 2 exp 1 2 y g x t σ y 1 y g x in practice an important challenge of rs methods is the need to estimate a tight bound s l for the likelihood function the most conservative choice is to assume a perfect data fit such that for our gaussian likelihood function above we get s l det 2 π σ y 1 2 but this will typically lead to an acceptance rate being close to zero if we assume the errors to be equal to the standard deviation of the observational noise we get s l det 2 π σ y 1 2 exp 1 2 t which might lead to some bias as some realizations are likely to have higher likelihoods one further possibility is to use the maximum likelihood value of the prior samples to achieve this rs is run by first saving all sampled prior realizations and their corresponding likelihood values from this database the maximum likelihood value is determined and all samples are assessed using this value to obtain some accepted prior samples of θ while ensuring an accurate estimate we combine the second and the third approach and use the maximum of those two values as the supremum s l 2 5 performance assessment to assess if the cpm algorithm has converged we use the r ˆ statistic of gelman and rubin 1992 comparing the within chain variance with the between chain variance of the second half of the mcmc chains we follow the convention that the r ˆ statistic has to be smaller or equal to 1 2 for all model parameters we also consider the acceptance rates ar which are aimed to be between 15 and 30 as proposed by vrugt 2016 we evaluate the amount of information gained by the inversion by comparing the marginal prior and posterior pdfs of the hyperparameters this is achieved using the kullback leibler divergence kl divergence kullback and leibler 1951 expressing the distance between two pdfs z p 1 z and z p 2 z assumed positive by 14 k l p 1 p 2 p 1 z log p 1 z p 2 z d z if k l p 1 p 2 0 this means that the two pdfs are equal almost everywhere while an increasing value indicates diverging distributions for example for a standard normal pdf p 2 a kl divergence k l p 1 p 2 0 1 is obtained by reducing the standard deviation within a centered standard normal p 1 to 0 7 and a kl divergence k l p 1 p 2 1 is obtained by reducing the standard deviation to 0 23 to approximate the posterior pdfs we apply kernel density estimation to the posterior samples with manually adapted bandwidth to assess the quality of the posterior estimates we use histograms to visually compare the marginal distributions with the true underlying values additionally we evaluate the accuracy of the obtained posterior samples for each hyperparameter θ i i 1 2 p numerically by applying a so called scoring rule krüger et al 2021 a scoring rule assesses the accuracy of a predictive pdf z p z with respect to a true value θ by accounting for both the statistical consistency between predictions and observations calibration and the sharpness of the prediction gneiting and raftery 2007 for our test cases we employ the logarithmic score logs good 1952 defined by 15 logs p θ log p θ that is related to the kullback leibler divergence gneiting and raftery 2007 if we compare two posterior estimates the one with the lower score is favored in practice as for the kl divergence we use a kernel density estimate of the posterior samples which depends on the choice of the kernel and the bandwidth of the kernel smoothing window we use a gaussian kernel with manually adapted bandwidth our testings show that the choice influences the specific score values but that the main results in terms of comparisons and conclusions are robust if the posterior samples do not include the true value of θ the density estimate of p θ can be numerically zero resulting in a logarithmic score of infinity the logarithmic score is also available for multivariate densities thereby allowing evaluation of the estimated joint posterior pdfs of the hyperparameters 3 test case 1 hydraulic conductivity field hydraulic conductivity is a key hydrogeological property particularly in contamination studies the spatial variation of hydraulic conductivity plays an important role as it has a major influence on solute movement 9 visentini et al 2020 rely on time lapse electrical resistance data during a tracer test to demonstrate that measurements of equivalent electrical properties at a given scale can be used to infer hyperparameters of the hydraulic conductivity field below this scale here we seek to infer the hyperparameters of a log hydraulic conductivity field in a data poor setting involving only horizontally and vertically averaged equivalent hydraulic conductivity data with such limited data it is tempting to ignore heterogeneity or rely on upscaling relations valid for ergodic fields as there is little hope that the data can constrain the field or its hyperparameters well this example is used to demonstrate that ignoring heterogeneity or assuming ergodicity leads to significant errors when estimating the geostatistical mean furthermore this data poor setting allows for comparisons with rejection sampling section 2 4 thereby demonstrating that the cpm method targets the right posterior of the hyperparameters 3 1 data and inversion setting we target a 1 m 1 m log hydraulic conductivity field distributed according to a gaussian random field g r f μ θ c θ with constant mean μ θ and exponential covariance function c θ eq 1 with h 0 5 we allow geometric anisotropy section 2 1 and denote the integral scale in the vertical direction depth as i y and the anisotropy factor as λ together with the mean and standard deviation of the log field this forms the hyperparameters θ μ σ i y λ although we are mainly interested in the mean we infer the other hyperparameters along with it thereby accounting for the possible non ergodicity of the field the log hydraulic conductivity field natural logarithm is generated on a 100 100 grid cell size is 1 cm using a pixel based approach section 2 1 3 1 1 synthetic data generation we generate noise contaminated synthetic data in both an ergodic and a non ergodic setting for the ergodic setting we create one true field realization from which we obtain noise contaminated data by assuming the field to be isotropic and use θ l n 1 0 4 0 5 0 03 m 1 and for the non ergodic anisotropic case we choose θ l n 1 0 4 1 5 0 1 m 3 the true log hydraulic conductivity fields are shown in fig 2 due to the discretization of the field chosen to limit the number of grid cells the ergodic field is only nearly ergodic implying that the generated data will vary somewhat when considering different field realizations with the true hyperparameters in what follows we will refer to it as ergodic except when a more specific designation is needed for the simulated measurements we impose a hydraulic pressure gradient along either the horizontal or the vertical direction of the target field and observe a flux across one boundary this information can then be used to calculate the equivalent horizontal and vertical hydraulic conductivities given by visentini et al 2020 16 k h 1 φ h γ h k x x φ h x d x 17 k v 1 φ v γ v k x y φ v x d x where k x denotes the hydraulic conductivity at position x with x x y t referring to the 2 d position vector furthermore φ h φ v 1 kpa denotes the constant hydraulic pressure difference imposed along the horizontal and vertical direction respectively and φ h x and φ v x the resulting hydraulic head finally γ h and γ v refer to integration paths separating the left and right and the top and bottom boundaries respectively for the ergodic and isotropic field fig 2 a we obtain equivalent hydraulic conductivities of k h k v 9 2 1 0 5 m s and for the non ergodic anisotropic field fig 2 b we get an equivalent horizontal hydraulic conductivity of k h 6 6 1 0 5 m s and an equivalent vertical hydraulic conductivity of k v 4 8 1 0 5 m s finally we add i i d relative errors ɛ o to the data pairs using a centered gaussian distribution with a standard deviation given by 3 of the corresponding values 3 1 2 inversion settings and prior assumptions the cpm method is implemented running three chains in parallel with adaptive proposals section 2 2 1 using an initialization period of j 0 100 where c 0 is a diagonal matrix with 0 008 0 008 0 002 0 2 along its diagonal for the prior pdfs of the first three hyperparameters we use uniform distributions for the mean μ we use the interval log 1 0 5 log 1 0 3 a range of standard deviation σ in between 0 2 and for the integral scale i y we assume 0 m 0 5 m to account for the anisotropy factor λ being asymmetric around one we employ a log uniform distribution with boundaries 0 1 10 to tune n and ρ in the cpm method section 2 3 2 we consider the variance of the log likelihood ratio estimator w eq 12 fig 3 depicts the dependence of the variance of w on the correlation ρ for ten and fifty samples n 10 50 of the latent variable x for both the ergodic and the non ergodic data setting to evaluate the variances we fix θ at values having high posterior probability and draw realizations of the field by both sampling from its prior pdf f θ x nois and using importance sampling is appendix a in the ergodic setting fig 3 a all considered cases lead to variances of w being close to the target range between 1 0 and 2 0 recommended by deligiannidis et al 2018 even for ρ 0 this is not surprising as in a purely ergodic setting the realization of the random field does not influence the data for the non ergodic setting fig 3 b the variance of w is up to 1 0 3 times higher and it is necessary to employ importance sampling of course sampling from the prior could lead to variances of w being within the desired range but the required values of n and ρ would lead to either excessively high computational costs at each iteration or very slow mixing in the draws of the latent variables in the limit of ρ 1 the variance of w is trivially equal to zero for all settings as we use the same latent variable samples in the first and second term of w but this would lead to biased results initial mcmc runs showed that very diverse values of σ i y and λ have high posterior probabilities in both the ergodic and non ergodic data settings as in both cases non ergodic field realizations are sampled frequently by the cpm method to ensure a controlled variance for all values θ with high posterior probability for both data settings we perform importance sampling and choose n 50 and ρ 0 975 as it is appropriate for the more challenging non ergodic settings for comparison purposes we also run rejection sampling rs see section 2 4 and a mh inversion assuming the parameter field to be ergodic referred to as simplified mh fig 4 for rs we use the same number of field samples with corresponding forward simulations as needed by the cpm method for convergence for the simplified mh we rely on equations presented by gelhar and axness 1983 for the equivalent hydraulic conductivities in a two dimensional anisotropic infinite domain ensuring ergodicity under mean uniform flow conditions 18 k h k g 1 σ 2 1 2 1 1 λ 19 k v k g 1 σ 2 1 2 λ 1 λ with k g denoting the geometric mean of the linear hydraulic conductivity field k exp x entry wise exponential which is the only parameter influencing the response for isotropic fields λ 1 it holds that k g exp x with x being the arithmetic mean of x 3 2 results we consider first the posterior pdf of the geostatistical mean μ obtained with the cpm method for the data generated with the ergodic setting fig 2 a only the samples obtained for the second half of the chains after convergence has been declared with respect to the r ˆ statistics table 1 are shown the posterior pdf of the mean value μ in the ergodic data setting is centered around the true geostatistical mean and is clearly distinguishable from the uniform prior pdf fig 5 a this is confirmed by the correspondingly low logarithmic score emphasizing the accuracy of the posterior samples and the high kl divergence with respect to the prior pdf table 1 comparison with the posterior samples obtained with rs fig 5 b shows that both methods generate similar results with comparable kl divergences to the prior and almost equal logarithmic scores table 1 for the posterior samples obtained by assuming ergodicity simplified mh fig 4 we note a more compactly defined posterior than with cpm and rs with values of the mean being close to the true value c f figs 5 a 5 c still the logarithmic score of the mean is much higher than the one obtained with cpm and rs table 1 indicating that the samples generated under ergodic assumptions are not centered around the true geostatistical mean and are overconfident this somewhat paradoxical result is a consequence of the data setting only being nearly ergodic demonstrating the risk of getting biased and overconfident results even when the assumption of ergodicity is nearly fulfilled the considered measurement scale is indeed 33 times larger than the integral scale for the non ergodic data setting fig 2 b the cpm derived posterior distribution of the mean value μ contains the true value while being shifted towards the observed equivalent properties log k h and log k v leading to a higher logarithmic score than in the ergodic setting fig 5 d and table 1 the posterior samples obtained with rs fig 5 e are spread slightly wider than the ones of cpm thereby capturing more frequently the true value and leading to a lower kl divergence and a lower logarithmic score we note that rs has an acceptance rate of 0 04 in this very data poor and non ergodic setting in the non ergodic setting the simplified mh method leads to important errors in the estimated mean value fig 5 f indeed the posterior samples are located around the log transformed observed equivalent properties k h and k v and are removed from the true value of the geostatistical mean this is reflected in a logarithmic score of infinity see table 1 importantly while the inversion assuming ergodicity solely samples mean values outside of the true value and has a very small posterior width the cpm method includes the true value in the posterior samples figs 5 d and 5 f for the other hyperparameters σ i y and λ inferred along with the mean μ we get less well resolved posterior estimates with both the cpm method and rs indicating that they are only weakly resolved by the available data the corresponding plots are depicted in appendix b 4 test case 2 fracture aperture fields rock fractures play an important role as conduits or barriers for flow and solute transport their properties have often a major influence on hydrogeologic and geotechnical processes national research council nrc 1996 but field characterization is inherently difficult the high contrast between the electrical properties of the filling of the fractures and the host rock e g a water filled fracture in granite host rock leads to a very strong thin bed response in ground penetrating radar gpr data quite remarkably even sub mm apertures yield measurable gpr responses even when the wavelength in the host rock may be on a metric scale imaging and characterization of fractures with gpr data has been studied extensively both from a theoretical perspective e g bradford and deeds 2006 deparis and garambois 2008 and in controlled experiments e g grégoire and hollender 2004 tsoflias et al 2015 in these studies it is typically either assumed that the aperture and material properties do not vary over the first fresnel zone or that the influence of heterogeneous aperture fields average arithmetically in the acquired data in a modeling study shakas and linde 2017 assess this latter simplification by exploring a deterministic inversion in which the actual aperture field is heterogeneous at small scales while it is assumed to be homogeneous when inferred for despite that the data can be fitted to the noise level they find that the estimated apertures offer only reliable approximations of the arithmetic mean of the aperture field when the correlation length of the aperture heterogeneity is larger than the first fresnel zone since fractures are known to be highly heterogeneous with self affine properties the study by shakas and linde 2017 suggest that many gpr based estimations of mean apertures are biased and unreliable they suggest that such heterogeneity needs to be explicitly accounted for but they do not propose a solution in this second data rich test case we will demonstrate how the cpm method can be used to obtain unbiased estimates of the mean aperture and statistics pertaining to the aperture field we will then show how this information can be used to predict the equivalent hydraulic transmissivity of the fractures 4 1 data and inversion setting we consider a 5 m 5 m fracture aperture field x described as an isotropic gaussian random field g r f μ θ c θ with constant mean μ θ and powered exponential covariance function c θ as specified in eq 1 with the cpm method we target the mean μ the standard deviation σ the integral scale i i x i y and the hurst exponent h the heterogeneous aperture field x is simulated using a pixel based approach section 2 1 on a 50 50 dimensional grid d 50 cells of 10 cm side lengths 4 1 1 synthetic data generation the fracture aperture field from which data are generated is depicted in fig 6 a the true hyperparameters are θ μ σ i h 0 5 cm 0 1 0 2 m 0 8 we only consider a single fracture in a model domain of 10 m 10 m 10 m fig 6 b the background rock matrix is assumed to be homogeneous with a relative electrical permittivity of 9 and an electrical conductivity of 0 001 s m for the fracture we assume a constant relative electrical permittivity of 81 and electrical conductivity of 0 1 s m to generate the synthetic gpr reflection data we rely on the effective dipole method of shakas and linde 2015 this modeling framework combines analytical solutions for radiation in the matrix domain and dipole elements corresponding to discretized sections of the fracture radiating as electric dipoles modulated by the thin bed reflection coefficients a simple schematic of the method is represented in fig 6 c adapted from fig 3 of shakas and linde 2017 we use two gpr reflection traces generated with sources and receivers located 5 m away from the fracture and with offsets of 0 m and 2 m fig 6 b the source signal is assumed to be vertically oriented with a source spectrum consisting of a ricker wavelet with dominant wavelength of 100 cm with a discretization of 10 cm of the aperture field this results in 10 elements per dominant wavelength for which highly accurate simulations are expected shakas and linde 2017 the responses are generated in the frequency domain using a frequency range from zero to 300 mhz with a sampling step size of 1 mhz as in practice the amplitude of the source wavelet is unknown shakas and linde 2017 normalize the response values in the data generation and inversion here we instead introduce an unknown factor c a by which the responses are multiplied this factor is equal to one for the true data and it is inferred within the inversion this extends the target variables to θ μ σ 2 l c h c a finally for each of the 300 complex valued numbers representing the electric field we add independent realizations of gaussian measurement noise ɛ o with a standard deviation of 3 of the maximal value the inversions are performed in the frequency domain but we present for visual purposes the two corresponding traces in the time domain fig 6 d for completeness we also show the smoother traces fig 6 e obtained by sampling over the same frequency range with a sampling step size of 0 1 mhz 4 1 2 inversion settings and prior assumptions as in the first test case we run an adaptive metropolis hastings version of the cpm method with three chains in parallel we specify j 0 500 and c 0 as a diagonal matrix with 0 001 on its diagonal furthermore to ensure a suitable acceptance rate we decrease the step size by 50 for the prior pdfs of the hyperparameters we use uniform distributions for the mean μ we use unif 0 cm 1 cm for the standard deviation σ we use unif 0 cm 0 5 cm for the integral scale l c we use unif 0 m 1 m for the hurst exponent h we use unif 0 1 1 and for the amplitude factor c a we use unif 0 5 2 the importance sampling mean μ is for the latent aperture field x when the proposed θ j is the true hyperparameters is depicted in fig 7 a see formulas in appendix a fig 7 b depicts the dependence of the variance of the log likelihood ratio estimator w eq 12 on n and ρ the importance sampling leads to a tremendous decrease of the variance of w e g for n 1 and ρ 0 the variance of w is reduced from 1 0 6 to 1 0 2 furthermore increasing the number of latent variable samples n and the correlation parameter ρ also reduces the variance of w strongly following fig 7 b we run the cpm algorithm with n 5 and ρ 0 975 in combination with importance sampling to place the results obtained with cpm into context we compare them to those obtained with an inversion assuming the aperture field to be homogeneous illustrated with a flow chart in fig 8 to achieve this we only infer the mean aperture μ and the amplitude factor c a which is broadly similar to the inversion setting considered by shakas and linde 2017 4 2 results the estimated marginal posterior pdfs of θ μ σ 2 l c h c a obtained with the cpm method are depicted in figs 9 a 9 e convergence is reached within 10 000 iterations with respect to the r ˆ statistic and we display the results for the second half of the chains the histograms depicting the posterior samples of the mean μ fig 9 a standard deviation σ fig 9 b and amplitude factor c a fig 9 e show the strongest concentration with respect to the prior and correspondingly high kl divergences table 2 the sample range for the integral scale i fig 9 c and the hurst exponent h fig 9 d is equally wide as the respective prior pdfs and the corresponding kl divergences are rather small nonetheless the integral scale is preferentially sampled in the region of the true value as the values of the logarithmic score table 2 can generally not be compared between hyperparameters different width of support they will become of interest only in the comparison with a competing method figs 9 f and 9 g show the histograms of the posterior samples for the mean μ and the amplitude factor c a obtained for the inversion assuming a homogeneous aperture fig 8 the range of the samples is very narrow with high kl divergences with respect to the prior pdf table 2 but located far from the true parameter values this results in infinite logarithmic scores table 2 as we have seen the cpm method accounting for heterogeneity leads to posterior samples of the mean and amplitude factor that cover a wider range including the true values used to generate the data as reflected in lower logarithmic scores table 2 the estimates of the mean aperture μ and the amplitude factor c a are highly correlated fig 9 h shows that under the assumption of knowing c a 1 the range of the samples obtained with cpm for the mean aperture would be more narrow and shifted towards the true value of 0 5 cm we further see that the homogeneous inversion only explores a small part and the wrong part of the joint posterior model space leading to a logarithmic score of infinity for the estimated joint posterior pdf table 2 for this second data rich test case rejection sampling is unfeasible as the acceptance rate is below 0 001 4 2 1 predictions of hydraulic transmissivity to complement the results obtained for this gpr test case and to strengthen the link to hydrogeology we use the aperture field estimates to derive equivalent hydraulic transmissivities first we use the inferred mean apertures obtained with the inversion assuming the field to be homogeneous fig 9 f these aperture field realizations are used to derive hydraulic transmissivities at the fracture scale using the classical parallel plate model tsang 1992 20 t 1 12 η μ 3 with η 8 9 1 0 4 pa s denoting the dynamic viscosity 25 degree c and μ being the inferred mean aperture values in meters the resulting horizontal equivalent log hydraulic transmissivities are shown in fig 10 light gray this result is now compared with the value obtained for the true aperture field under the assumption that the reynolds equation is valid implying that we can apply eq 20 locally to obtain a hydraulic transmissivity field and then solve numerically for the resulting effective transmissivity at the fracture scale the results show that the true effective hydraulic transmissivity is roughly one order of magnitude smaller and that the posterior pdf of the homogeneous inversion light gray is nowhere close to include this value this is reflected in a infinite logarithmic score we then sample field realizations using the posterior pdfs of the hyperparameters inferred with the cpm method the resulting equivalent log hydraulic transmissivity values are shown in fig 10 blue this distribution is much wider it includes the true value and the mean is clearly shifted towards the true value the corresponding logarithmic score is 0 23 5 discussion our two test cases presented in sections 3 and 4 demonstrate the ability of the correlated pseudo marginal method cpm method fig 1 to estimate the posterior pdf of the target field s hyperparameters e g mean standard deviation integral scale hurst exponent and anisotropy factor while accounting for the impact of small scale heterogeneity within the estimate of the likelihood function we further demonstrate that inversions invoking simplified assumption such as ergodicity or homogeneity lead to biased and overconfident results such that the inferred posteriors often do not include the true values compared to previous inversion approaches targeting hyperparameters e g laloy et al 2015 and xiao et al 2021 the cpm method infers the hyperparameters only thereby avoiding to infer the posterior pdf of the many thousands of latent variables the two presented test cases cover one data poor transmission problem governed by diffusion e g electrical conduction heat conduction or groundwater flow and one more data rich reflection problem governed by wave based physics e g gpr seismics acoustics the generality of these settings suggest that the cpm method has a wide applicability in hydrogeology and geophysics the first test case related to heterogeneous hydraulic conductivity fields concerns a very data poor setting in which only the horizontal and vertical equivalent hydraulic conductivities are used as data points to compare the performance of the cpm method with an inversion assuming ergodicity referred to as simplified mh fig 4 we consider a nearly ergodic and a non ergodic data setting in both settings the geostatistical mean of the model domain can be inferred from the equivalent conductivities using the cpm method in the ergodic setting both the cpm method and the simplified mh lead to reasonable estimates of the geostatistical mean with the posterior range of the cpm method being wider as its underlying assumptions are less restrictive figs 5 a and 5 c in the non ergodic data setting the simplified mh leads to important errors in the estimation of the geostatistical mean with a posterior range far from the true value fig 5 f for the cpm method the estimated posterior uncertainty is wider and the true value of the mean is included fig 5 d thereby the logarithmic score is reduced from infinity to 1 57 when applying cpm compared with the simplified mh table 1 we conclude that even in this extremely data poor setting the use of simplified model assumptions leads to a substantial bias in the mean estimate and an overconfident posterior bound for the other hyperparameters standard deviation integral scale and anisotropy factor we conclude that only little information can be gained in this data poor setting furthermore we demonstrate that the cpm results are in agreement with those obtained by rejection sampling in the second test case concerning fracture aperture fields we limit ourselves to a non ergodic data setting and compare the results obtained with cpm with those of an inversion assuming the aperture field to be homogeneous fig 8 we can consider this homogeneous inversion as either 1 an inversion inferring the geostatistical mean under simplified model assumptions or 2 an inversion targeting the equivalent gpr aperture we show that the homogeneous assumption leads to posterior samples being located far from the true geostatistical mean value fig 9 f demonstrating in accordance with shakas and linde 2017 1 that the geostatistical mean of the aperture field can be very different than the equivalent gpr aperture and 2 that inferring the geostatistical mean based on a too simple model description leads to biased estimates indeed in such an inversion one appears to get increasingly certain about the wrong parameter values as more data are added or the data noise level is decreased brynjarsdóttir and o hagan 2014 in contrast the cpm method accounting for non ergodicity and heterogeneity by inferring additionally for the standard deviation integral scale and hurst exponent leads to a wider posterior including the true value of the aperture mean fig 9 a for this second example employing the cpm method leads to a reduction of the logarithmic score from infinity to 0 60 for the posterior estimate of the mean in comparison with the homogeneous inversion table 2 additionally cpm enables to infer information about other hyperparameters standard deviation and integral scale of the field probabilistic inference of hyperparameters offers the possibility to translate from one type of equivalent property to another we demonstrate this by predicting the equivalent log hydraulic transmissivity at the fracture scale using the fracture aperture fields obtained in the second test case fig 10 the predicted values for the constant aperture field inversion are obtained by applying the equivalent gpr aperture in the cubic law when deriving hydraulic properties from these constant fields we assume that this equivalent gpr aperture is the same as the equivalent cubic law aperture in the sense of tsang 1992 which is the equivalent parallel plate aperture with respect to hydraulic flow properties these predictions are very different from those obtained from the true aperture field when applying the local cubic law fig 10 this visualizes clearly that the equivalent aperture for one type of physics cannot be assumed to be the same when considering another type of physics actually the equivalent aperture in a cubic law sense with respect to the hydraulic data of the true aperture field is 0 47 cm a value considerably diverging from the one inferred from the gpr data when assuming homogeneity about 0 9 cm using field realizations sampled with the posterior pdfs of the hyperparameters obtained by cpm lead to a wider and more accurate range of effective log hydraulic transmissivity values fig 10 while the logarithmic score for the transmissivity predictions obtained with the homogeneous inversion is infinity the one obtained with cpm is 0 23 this suggests that while equivalent properties always refer to one specific kind of physics the inference of hyperparameters enables a general description of the model domain the cpm method is well suited to achieve this by targeting only the hyperparameters of interest thereby enabling probabilistic forecasts for different types of physics this study expands further the range of applications that the cpm method can address in geoscientific settings while friedli et al 2022 used it to account for uncertainties in petrophysical relationships in the context of hydrogeophysics we provide here a very different problem setting in which the cpm method is used to account for non ergodicity and small scale heterogeneities when inferring hyperparameters in these examples we only consider heterogeneities in two dimensions in field applications the data are of course affected by heterogeneities outside the 2 d plane of measurements e g between boreholes or by outer space effects maurer and friedel 2006 to further improve the estimation and uncertainty quantification in such setups the cpm method could be employed to integrate out heterogeneities in three dimensions in the context of the present study or in the third out of plane dimension in the setting considered by friedli et al 2022 or in general 2 d inversions to avoid over confident and possibly biased estimates for the presented test cases we used a pixel based representation of the gaussian latent random field we stress that there exist many alternative ways to represent and generate a gaussian random field as for example the fast circulant embedding technique using a spectral representation by dietrich and newsam 1997 while such an approach offers an increased efficiency in the generation of the random field realizations careful consideration must be given on a case by case basis as to whether this could be integrated into a well working importance sampling strategy moreover in settings where the correlation length is of similar size as the model domain the embedding has to be extended and the efficiency is reduced we assume the latent random fields to be gaussian simplifying the derivation of the importance sampling density an important topic for future research would be to develop and assess suitable importance distributions in non gaussian settings the efficiency of the cpm method depends strongly on the variance of the log likelihood ratio estimator especially in settings with a high number of observations with a low signal to noise ratio one needs a well working importance density when sampling the latent variables the relevance of a well tuned importance sampling strategy becomes clear when comparing the number of samples needed to control the variance in the first and second test cases figs 3 and 7 b for the first test case the is density is of only moderate quality and many samples n 50 are needed even for this data poor setting for the second more data rich test case with a well defined is density only a few samples n 5 are sufficient if the determination of a well working is distribution is not feasible this can be detrimental to the applicability of the cpm method in such a scenario there is also the risk of poor exploration of the latent space namely if the likelihood estimator depends mainly on one or two latent variable samples with a particularly beneficial small scale structure one solution in such a scenario is to infer some additional main features of the latent field together with the hyperparameters and then to apply the cpm method to sample out the remaining randomness of the field this could be done using the main components of a dimensionality reduction approach and should reduce the importance of a well tuned is density we leave this idea for future research recently wang et al 2022 proposed an hierarchical bayesian inversion approach targeting first so called global variables such as hyperparameters but also physical variables and then estimating the posterior of the whole field for the estimation of the global variable s posterior in a non linear setting wang et al 2022 apply a machine learning based approach and train a neural network to output the global variables given a data realization followed by kernel density estimation of the results such a method relies on the ability to estimate the hyperparameters by brute force prior sampling and subsequent comparison of the resulting data with the true measurements in strongly non ergodic settings this can be computationally challenging as an unrealistically high number of prior samples would be needed to obtain reasonable estimates to illustrate this fig 11 shows the 100 highest log likelihood values sampled from 5000 prior samples of the aperture field in the second test case section 4 we note that no sample was generated with a likelihood close to the true one black horizontal line implying that an unfeasible large amount of samples would be needed to guarantee accurate hyperparameter estimates indeed even the highest sampled likelihood has a likelihood that is still 1 0 44 times smaller than the true likelihood in contrast our cpm method using three chains need 10 000 iterations per chain for convergence 6 conclusions we consider bayesian mcmc inversions inferring hyperparameters e g mean standard deviation and integral scales from hydrogeological or geophysical data to achieve this is particularly challenging in the non ergodic setting in which the data depend on the actual geostatistical field realization under consideration and not only on the hyperparameters to prevent errors arising when assuming homogeneity or ergodicity we rely on the correlated pseudo marginal method targeting the hyperparameters while integrating out the random effects of actual field realizations in the likelihood estimation this approach has the advantage of ensuring accurate posterior estimates of hyperparameters without having to infer thousands or more parameters as needed if the whole random field would be inferred to ensure efficiency the correlated pseudo marginal method employs importance sampling and correlation of the latent draws used in the proposed and current steps of the mcmc chain we assess the performance of this method through two synthetic test cases involving 1 diffusion based physics in a data poor setting targeting hydraulic properties using equivalent hydraulic conductivity data and 2 wave based physics in a more data rich example targeting a fracture aperture field using single hole ground penetrating radar gpr reflection data by using these two examples that are representative of a broad range of geophysical and hydrogeological problems we demonstrate that the correlated pseudo marginal method provides accurate estimation of the geostatistical mean in both ergodic and non ergodic settings furthermore for all considered hyperparameters we show that the correlated pseudo marginal method avoids over confident and biased posterior pdf estimates that plague inversion results obtained when assuming ergodicity or homogeneity estimating hyperparameters allows for a general description of property fields which is independent of the physics under consideration thereby allowing ultimately to use the estimated posterior pdfs to make predictions for other types of physics or experimental set ups this is demonstrated by transforming the fracture properties inferred by gpr data into predictions of equivalent hydraulic transmissivity at the fracture scale credit authorship contribution statement lea friedli conceptualization methodology software visualization formal analysis validation investigation writing original draft niklas linde supervision conceptualization methodology formal analysis funding acquisition writing review editing david ginsbourger supervision methodology writing review editing alejandro fernandez visentini software writing review editing arnaud doucet methodology writing review editing declaration of competing interest the authors declare the following financial interests personal relationships which may be considered as potential competing interests lea friedli reports financial support was provided by swiss national science foundation acknowledgment this work was supported by the swiss national science foundation project number 184574 no new experimental data were generated or analyzed in support of this research appendix a importance sampling for cpm as emphasized in section 2 3 2 it is essential that the variance of the log likelihood ratio estimator is low to ensure efficient pm or cpm performance especially in settings with large data sets with high signal to noise ratios the integrand g θ y x in eq 7 is likely to have a peak in a region of x with very small probability under its prior pdf x f θ x sampling the latent variables using the prior distribution then leads to an inefficient algorithm one remedy to this is importance sampling where instead of the prior distribution a so called importance distribution given by the pdf x m θ x is employed the importance distribution is chosen such that it preferentially generates samples with high g θ y x f θ x while guaranteeing that all values x for which g θ y x f θ x 0 are included in its support owen and zhou 2000 it holds a 1 g θ y x f θ x d x g θ y x f θ x m θ x m θ x d x from which the unbiased importance sampling estimate of the likelihood function in eq 10 is derived to minimize the variance of the estimator x m θ x should be nearly proportional to x g θ y x f θ x as presented in owen and zhou 2000 referring to the results of kahn and marshall 1953 since it holds that p x θ y g θ y x f θ x we use for the importance density an approximation of x p x θ y in section 2 1 we specify y g x ɛ o with g r d 2 r t being the physical forward solver and ɛ o the observational noise if the forward solver is non linear there is no exact expression for p x θ y for this reason we approximate p x θ y by expressing the map x g x based on either an upscaling formula assuming an anisotropic ergodic setting test case 1 or a linearization of the forward solver test case 2 following friedli et al 2022 we use gaussian distributions and a lemma about marginal and conditional gaussians see for example bishop 2006 lemma 1 marginal and conditional gaussians assume a marginal gaussian distribution for x r d 2 and a conditional gaussian distribution for y r t given x in the form a 2 p x φ t x μ λ 1 a 3 p y x φ t y ax b l 1 with φ t μ k denoting the pdf of the t variate normal distribution with mean μ and covariance matrix k then the marginal distribution of y and the conditional distribution of x given y are given by a 4 p y φ t y a μ b l 1 a λ 1 a t a 5 p x y φ l x σ a t l y b λ μ σ where σ λ a t la 1 test case 1 hydraulic conductivity fields we are concerned with the latent log conductivity field x f θ x φ l x μ θ σ θ and to express the measurements as a linear function of the latent field we use the log transformed eqs 18 and 19 out of sanchez vila et al 2006 a 6 l o g k h x l o g 1 σ 2 1 2 1 1 λ a 7 l o g k v x l o g 1 σ 2 1 2 λ 1 λ then we denote y l o g y and write y j x b with j being a 2 d 2 dimensional matrix with constant entries of 1 d 2 and b b 1 b 2 where b 1 l o g 1 σ 2 1 2 1 1 λ and b 2 l o g 1 σ 2 1 2 λ 1 λ subsequently we approximate g θ y x with g θ y x φ t y j x b σ y where σ y i 2 0 1 2 with i 2 denoting the two by two identity matrix with this choice of σ y we transfer the observational error to the log space and artificially increase the uncertainty to account for the errors resulting from the ergodic assumption made to derive the is distribution to finally derive an approximation for p x θ y we use eq a 5 a 8 p x θ y φ l x μ is σ is with μ is σ is j t σ y 1 y b σ θ 1 μ θ σ is σ θ 1 j t σ y 1 j 1 test case 2 fracture aperture fields we target the fracture aperture field x f θ x φ l x μ θ σ θ and locally approximate p x θ y by expressing the map x g x based on a first order expansion around x l i n as friedli et al 2022 a 9 g x g x l i n x x l i n g x l i n j x l i n x x l i n here j x l i n refers to the sensitivity jacobian matrix of the forward solver corresponding to x l i n which is a homogeneous field with the currently proposed geostatistical mean μ θ θ 1 subsequently we approximate g θ y x with g θ y x φ t y g x l i n j x l i n x x l i n σ y again we derive an approximation for p x θ y by using eq a 5 a 10 p x θ y φ l x μ is σ is with μ is σ is j x l i n t σ y 1 y g x l i n j x l i n x l i n σ θ 1 μ θ σ is σ θ 1 j x l i n t σ y 1 j x l i n 1 since this expression is approximate due to the linearization step we multiply σ y with a factor following friedli et al 2022 we use 1 2 as this choice led to a satisfactory performance appendix b complementary figures concerning test case 1 here we present the additional hyperparameter plots of the posterior samples obtained for the first test case section 3 fig b 1 shows the results obtained for the ergodic data setting fig 2 a and fig b 2 those for the non ergodic setting fig 2 b in the ergodic setting the posteriors of the standard deviation σ obtained by cpm fig b 1a rs fig b 1d and the simplified mh fig b 1g are as wide as the prior pdfs with the mode of the distributions being located around the right value for all three approaches thereby the posterior obtained with the simplified mh is better defined than the ones of rs and cpm the integral scale is only inferred by cpm fig b 1b and rs fig b 1e with both methods generating posterior samples still distributed proportionally to the uniform prior pdf for the anisotropy factor λ the simplified mh clearly favors values above 1 fig b 1h and the same holds true for rs fig b 1f finally cpm fig b 1c samples close to the prior pdf employing the data generated with the non ergodic setting we obtain posteriors favoring correctly the horizontal layering of the field whereby the estimates of rs fig b 2f and the simplified mh fig b 2h are better defined than the one of cpm fig b 2c for i y we again obtain estimates close to the prior for both rs fig b 2e and cpm fig b 2b while cpm also samples σ close to the prior fig b 2a the rs realizations show a tendency for higher values fig b 2d finally the simplified mh samples values of σ fig b 2g having a high concentration at incorrect values 
54,plant responses to water stress influence water and carbon cycles and can lead to feedbacks on climate yet characterizing these responses at ecosystem levels remains uncertain quantifying ecosystem level water use strategies is complex due to challenges of upscaling plant traits and disentangling confounding environmental factors ultimately limiting our ability to understand and anticipate global change in ecosystem dynamics and ecohydrological fluxes we reduce the dimensionality of this problem and quantify plant water use strategies by combining plant traits with soil and climate variables into parameter groups that synthesize key eco physiological tradeoffs using a parsimonious soil water balance framework we explore variations in plant water uptake capacity water stress responses and water use performance via these non dimensional parameter groups the group characterizing the synchronization of plant water transport and atmospheric water demand emerges as the primary axis of variation in water use strategies and interacts with the group representing plant hydraulic risk tolerance especially in arid conditions when plant water transport is limiting next we show that specific plant water use strategies maximize plant water uptake leading to carbon gain benefits weighted by risks of water stress leading to higher costs of water use a model data comparison demonstrates that these ecohydrologically optimal parameter groups capture observed soil moisture variability in 40 ecosystems and beyond aridity rainfall frequency is an important environmental control for plant water use strategies the emerging parsimonious link between ecohydrological performance and non dimensional parameters provides a tractable representation of plant water use strategies relevant to parameterize global models while accounting for ecological and evolutionary constraints on the water cycle keywords buckingham pi eco evolutionary optimality ecohydrology evapotranspiration hydraulic risk plant functional traits plant water stress soil water balance 1 introduction plant level characteristics that regulate water transport from the soil to the atmosphere and assimilation of atmospheric carbon determine tradeoffs between plant water use for growth versus water conservation for survival reich 2014 skelton et al 2015 they also shape species composition in competitive environments lu et al 2020 and ultimately influence ecosystem carbon and water fluxes despite increasingly available plant trait data kattge et al 2020 empirical and conceptual challenges limit our ability to exploit trait data effectively beyond the plant level to improve model process representations such as gas exchanges and drought responses at the ecosystem scale mencuccini et al 2019 for example variability in trait based plant water use strategies between and within ecosystems choat et al 2012 skelton et al 2015 are still poorly understood explaining variability in ecological constraints on the water cycle across global biomes requires a holistic theoretical basis for plant water use strategies that accounts for dynamic interactions with environmental conditions across scales feng et al 2019 2018 kannenberg et al 2022 plant functional traits vary across species and within plant functional types anderegg 2015 they exhibit global eco evolutionary patterns franklin et al 2020 and trends in response to changing water availability trugman et al 2020 while these traits are often coordinated manzoni et al 2013b mencuccini et al 2015 untangling confounding environmental effects and understanding global patterns in trait coordination at plant to ecosystem levels remain problematic lavergne et al 2019 notably performance of plants with similar traits varies in different climates and vice versa different traits can lead to similar performance under a given climate feng et al 2019 water use strategy definitions thus need to consider traits in combination with soil and climatic conditions at plant to ecosystem levels identifying combinations of traits and soil and climatic variables that best describe key eco physiological tradeoffs can be guided by a formal search for non dimensional parameter groups buckingham 1914 importantly diagnosing plant water use strategies with non dimensional numbers without units provides a universal description of the system at any organizational scale and offers avenues to test hypotheses in a lower dimensional context porporato 2022 furthermore ecohydrological coordination embedded in the non dimensional framework reduces equifinality and uncertainties inherent in characterizing trait based ecological functions at plant to ecosystem levels in a changing climate non dimensional groups have been previously used to classify plant drought responses feng et al 2018 but have yet to be implemented in a modeling framework to predict drought responses in different ecosystems as well as define which specific plant water use strategies are ecohydrologically successful specific strategies or plant functions emerging from trait coordination and interactions with environmental conditions can be estimated from eco evolutionary optimality franklin et al 2020 manzoni et al 2014 importantly theoretical optimality principles are applicable at both species and ecosystem levels and can improve upon empirical model formulations and reduce the number of required parameters harrison et al 2021 the ability of optimality principles to explain patterns in water use strategies of whole ecosystems still needs to be further confirmed by confronting their predictions with key measured hydrologic variables soil moisture integrates hydrologic fluxes soil plant traits and climatic conditions that are tightly linked to ecosystem functioning rodríguez iturbe and porporato 2005 soil moisture observations therefore encode plant water use patterns imposed by climatic and soil conditions and these patterns can be interrogated via ecohydrological approaches bassiouni et al 2020 2018 further ecohydrological approaches accounting for the stochasticity of rainfall can characterize the mean intensity duration and frequency of periods of soil water deficit to identify optimal environmental conditions for vegetation porporato et al 2001 nevertheless despite previous data driven bassiouni et al 2020 and theoretical manzoni et al 2014 analyses we lack tractable and transferable quantification of plant water use strategy patterns across biomes to inform parametrization of plant responses to drought and anticipate ecosystem vulnerabilities to global change we propose and test an ecohydrological optimality criterion to quantify plant water use strategies as a function of readily available environmental conditions this theoretical approach has the advantage of being more tractable and explainable than empirical parameterizations and does not require calibration to targets such as observations of evapotranspiration and gross primary productivity by combining ecohydrological optimality with the buckingham π theorem we address the challenge of quantifying the multiple dimensions of plant water use strategies and their tradeoffs especially at the ecosystem level specifically we first reduce the complexity of eco physiological controls on transpiration by combining plant traits with soil and climate parameters into non dimensional π groups we then define metrics of plant water use capacity sensitivity to water stress and water use performance linked to daily soil moisture dynamics and long term risks of plant water stress leveraging this framework and soil moisture data from 40 ecosystems we provide data driven and theoretical support for the hypothesis that plants adapt to long term growing season conditions by balancing maximization of water uptake leading to carbon gains and growth with minimization of risks of unfavorable water stressed conditions leading to higher costs or penalties of water use our approach extends the analytical value of non dimensional groups beyond summarizing how traits soil and climate co determine water use strategies by implementing non dimensional groups in an ecohydrological modeling framework to explain variability in ecological constraints on the water cycle further the framework incorporates traits into response based metrics of plant water use strategies and link them to ecohydrological performance accounting for cumulative impacts of water stress on plant function as well as their feedbacks this study offers a parsimonious but effective alternative to more complex models to investigate and parameterize water use strategies across wet to arid ecosystems exploiting ecohydrological optimality as a guiding principle 2 materials and methods our modeling framework is centered around a conceptual representation of the soil plant atmosphere continuum spac referred to as eco physiological model coupled to a stochastic soil water balance referred to as ecohydrological model the eco physiological model section 2 1 calculates transpiration as a function of soil saturation plant functional traits and plant hydraulic status fig 1 a which we simplify to express metrics of plant water uptake capacity as a function of non dimensional parameter groups fig 1b we then integrate the eco physiological model into the ecohydrological model section 2 2 to link plant controls on transpiration to soil and climatic conditions the coupled models quantify how biotic and abiotic components interact and ultimately determine long term plant water use water stress and water use performance fig 1c we apply this spac water balance framework section 2 3 first to explore water use strategies theoretically and then to infer plant water use strategies from data and verify an ecohydrological optimality criterion fig 1d model parameters and metrics characterizing plant water use strategies are summarized in tables 1 and 2 respectively 2 1 eco physiological model and reducing the dimensionality of plant water use strategies the daily rate of transpiration t m day 1 is bound by potential atmospheric water demand characterized here by potential evaporation e 0 m day 1 priestley and taylor 1972 and constrained by soil water supply within a depth z m characterized here by soil water saturation s unitless 0 s 1 we aim to simplify the description and exploration of plant water use strategies by expressing the ratio β t e 0 as a function of s and non dimensional parameters that define eco physiological tradeoffs fig 1a b further we derive four metrics of plant water uptake capacity and the sensitivity of plant uptake to hydraulic status resulting from e 0 and s together to summarize different plant water use strategies 2 1 1 water flux through the soil plant atmosphere continuum spac following conceptual plant hydraulics models feng et al 2017 manzoni et al 2013b we assume plant water storage is much smaller than transpiration at the daily time scale and equate water fluxes along different components of the spac fig 1a therefore t is equal to the rate of water supply from soil to roots water transport from roots to canopy and water flux from canopy to the atmosphere the rate of water supply from soil to canopy is driven by the difference between soil ψ s mpa and canopy ψ c mpa water potentials we neglected gravimetric potential and is controlled by the series of soil to root ksr m day 1 mpa 1 and plant xylem kp m day 1 mpa 1 conductances the water flux from canopy to atmosphere is equal to water vapor that diffuses through stomata driven by the difference in water vapor in the atmosphere and in the leaf d mol 1 and is regulated by canopy conductance gc m day 1 1 t β s e 0 k sr k p k sr k p ψ s ψ c g c d we assume that ksr decreases non linearly with decreasing ψ s from its maximum value k sr max at soil saturation ψ s s a t and that kp and gc decrease linearly with decreasing ψ c from their maximum values k p max and g c max respectively and with slopes determined by canopy water potentials at 50 xylem ψ x 50 mpa and stomatal ψ g 50 mpa conductance loss fig 1a we focus on the ecosystem as a whole and express all conductances per unit ground area they are functions of plant root stem and leaf level traits and soil water retention parameters table 1 such as root area index rai m2 m 2 leaf specific maximum xylem conductivity k x max kg m 1 mpa 1 s 1 canopy height hc m leaf area index lai m2 m 2 and saturated soil conductivity k s sat m day 1 see manzoni et al 2014 for details on this linearized spac parameterization and justifications for simplifications 2 1 2 non dimensional groups emerging from the spac eight parameters and state variables suffice to describe key aspects of water flux through the spac and its sensitivity to environmental conditions defined in the eco physiological model t varying with plant traits soil texture climate and water status e 0 varying here only with temperature and radiation priestley and taylor 1972 s the only state variable in our framework varying due to stochastic rainfall events affecting the soil water balance within a depth z and controlled by spac characteristics k sr max varying with soil texture and root structure and depth k p max varying with xylem conductivity and plant size ψ g 50 varying with stomatal sensitivity ψ x 50 varying with xylem vulnerability ψ s s a t varying with soil texture the dimensionality of the system can be reduced by combining these eight variables based on three primary dimensions length time and mass but only two primary units m day 1 and mpa into 8 2 6 non dimensional quantities buckingham 1914 that summarize key climate soil and eco physiological tradeoffs emerging from the spac β t e 0 reflects the degree of transpiration downregulation and varies temporally in response to plant water stress a value of 1 indicates transpiration is equal to potential atmospheric water demand and a value of 0 indicates transpiration has ceased s reflects soil water supply relative to soil saturation within a depth z and varies with the soil water balance driven by stochastic rainfall inputs and controlled by spac characteristics a value of 1 indicates all soil pores are filled with water and the minimum value is the hygroscopic point when water is bound to the soil π r ψ g 50 ψ x 50 reflects the degree of plant hydraulic risk tolerance a value close to 0 represents the most risk averse strategy with strict stomatal control to limit xylem damage and a value close to 1 represents the most risk tolerant strategy with more passive stomatal control to favor carbon assimilation feng et al 2018 skelton et al 2015 π f e 0 k p max ψ g 50 reflects the degree of plant water flux control a value close to 0 indicates that plant water supply is nearly unlimited compared to atmospheric demand a value close to 1 indicates synchronization of supply and demand and larger values point to a bottleneck in plant water transport relative to demand due to stomatal and or xylem limitations π t k sr max ψ g 50 e 0 reflects soil root water transport capacity values are generally high but lower values occur when water supply is limited by the soil root system for slow draining soils clay π s ψ g 50 ψ s s a t reflects soil suitability for plant water extraction values are generally high ψ s s a t tends to be small and highest values occur for high porosity soils sand applying the buckingham π theorem buckingham 1914 porporato 2022 by relating β to s and the four π groups fig 1b we can express plant water uptake at a given soil saturation without dimensions but accounting for spac environmental and plant characteristic that vary across ecosystems 2 β f s π r π f π t π s we note that the application of buckingham π theorem does not lead to a unique choice of non dimensional groups and results are specific to the system under consideration and the line of inquiry we obtain six groups for our simplified representation of the water flux through the spac and these groups have similarities to nine groups previously identified for describing plant hydraulic failure and carbon limitations due to drought stress feng et al 2018 we choose e 0 and ψ g 50 as key representative variables to non dimensionalize units of m s 1 and mpa respectively because we aim to interpret coordination of climate and stomatal sensitivity versus other spac characteristics a different selection of variables and their combinations would result in less compact approximations of β as a function of s and π groups eqs 3 5 below we also note that as a result of the assumption that the daily water flux through the xylem must be transpired through stomata canopy conductance is a redundant variable and hence does not appear in π groups this does not imply that a π group describing canopy conductance would be unimportant rather this implies that the spac depends on coordination between stomatal and xylem traits and therefore we can adopt a more parsimonious description of the system without canopy conductance and representing atmospheric water demand via only e 0 further ψ g 50 is regarded as an outcome of a specific response to plant stress rather than a prescribed trait because as we will show we infer ψ g 50 values from data driven and optimality criteria 2 1 3 metrics of plant water uptake capacity we approximate eq 2 mathematically to express key characteristics of plant water uptake capacity analytically as a function of π groups to do so similarly to previous work manzoni et al 2014 we solve the spac eco physiological model eq 1 for three shape parameters of a piece wise linear function that downregulates transpiration due to soil water stress feddes et al 1978 laio et al 2001 3 β s π 0 s s w s s w s s w f ww s w s s f ww s s where fww is the ratio of the well watered rate of transpiration to e 0 s and sw are soil saturation thresholds below which transpiration is downregulated from its well watered rate and when transpiration ceases respectively by solving eq 1 under well watered conditions ψ s 0 and assuming soil to root conductance ksr is not limiting we obtain an expression for fww as a function of climate and eco physiological variables embedded in the π groups 4 f w w 1 1 2 π r 1 π f 2 π f 2 1 2 2 π f π r by solving eq 1 for ψ s at which any arbitrary transpiration rate t β e 0 is achieved we can express s as a function of β and π groups 5 s β ψ s β ψ s sat 1 b π t 2 β π s 1 4 β π s 2 π t 2 1 β β π f 1 1 β π r 1 1 b where b unitless is a soil pore size parameter for converting ψ s to s brooks and corey 1964 the soil saturation thresholds for the piece wise linear function eq 3 are then defined by setting β 0 95fww for s and β 0 05fww for sw in eq 5 while evaluating eq 5 with β in the interval 0 1 reproduces a sigmoidal response fig 1c through their dependence on π groups eq 4 and 5 fww s and sw account for stomatal and hydraulic traits plant size and density as well as soil and climate characteristics as such these combined parameters lead to a certain realized water uptake capacity that reflects limitations to plant water transport along the spac beyond soil water availability in the rooting zone i e s or ψ s we define the index σ unitless as the overall plant water uptake capacity relative to a hypothetical maximum corresponding to no hydraulic or stomatal limitation we calculate σ by integrating β eq 3 over soil saturation states between the hygroscopic point sh and field capacity sfc and normalizing by the same integral when transpiration is equal to e 0 for all soil saturation states 6 σ f w w s f c s s w 2 s f c s h the shape of β s π therefore summarizes complex spac eco physiological mechanisms including interactions with environmental conditions and represents water use strategies ranging from stress averse σ close to 0 to stress tolerant σ close to 1 this spectrum includes for example intensive water use when soil saturation is high fww close to 1 and s much lower than sfc leading to high σ conservative water use when soil saturation is high fww much lower than 1 s close to sfc leading to low σ sensitive water use when stomata rapidly close at high saturation states sw close to s leading to low σ or extensive water use with the ability to partially open stomata at low saturation states sw much lower than s leading to high σ these four plant water use strategy characteristics fww s sw σ describing the shape of β s π span multiple levels of abstraction that can be useful for varying levels of inquiry about plant water uptake capacity due to its definition as an integral σ summarizes plant water use strategies from stress averse to stress tolerant with some equifinality therefore nuanced strategies still need to be interpreted from the ecohydrological parameters fww s sw defining water uptake capacity along the full range of soil saturation states at an even finer level of detail the role of plant traits ψ g 50 ψ x 50 k x max rai on these strategies needs to be assessed via eco physiological tradeoffs reflected in the π groups our plant water use strategy metrics can also be interpreted along the iso to anisohydric continuum or hydroscape fu and meinzer 2019 meinzer et al 2016 for example for the same value of plant water uptake capacity σ isohydric behavior can be associated with relatively higher fww s and sw higher plant conductance but more stringent stomatal regulation while anisohydric behavior can be associated with relatively lower fww s and sw lower plant conductance and higher stomatal resistance to drying soil we also note that definitions of fww s and sw parameters which are a function of traits soil and climate variables underline the need for cautious interpretation of isohydricity indexes with a plant s environmental conditions feng et al 2019 kannenberg et al 2022 2 2 ecohydrological model and parsimonious quantification of plant water use performance the capacity of plants to take up water determined by π groups and based on the eco physiological model section 2 1 influences the soil water balance and occurrence of water stress resulting in varying performances depending on local soil and hydro climatic conditions to quantify links between plant water use strategies and water use performance we integrate our novel formulation of β s π eqs 3 5 in a soil water balance fig 1c d thus constructing our ecohydrological model the soil water balance accounts for stochastic rainfall characteristics as well as water balance components interacting with transpiration soil water evaporation canopy interception runoff and infiltration we then obtain growing season soil saturation probability distributions p s eq 8 from which we can directly assess long term average plant water uptake t eq 9 risks of water stress θ eq 11 and water use performance ε eq 12 while performance in this study is focused on water as a limiting factor there are further avenues to additionally account for light and nutrient limitations or atmospheric co2 effects in π groups through for example more complex definitions of potential atmospheric demand instead of e 0 used here priestley and taylor 1972 2 2 1 stochastic soil water balance we consider a bucket model for a homogenous soil column with a depth z m and porosity n unitless in which water fluxes are interpreted at the daily time scale this lumped approach employs scale effective parameters bassiouni et al 2020 2018 manzoni et al 2014 and resulting fluxes represent the individual or whole ecosystem water balance depending on the organizational scale at which the model and its parameters are interpreted we assume that the dynamics of z and rooting zone evapotranspiration dynamics are synchronized dong et al 2022 therefore modeled soil water dynamics are representative of the ecosystem even if the soil column depth prescribed by observation depths table s1 may not exactly comprise the whole rooting zone this assumption is justified by our focus on the temporal dynamics of evapotranspiration and their relation to soil saturation instead of total ecosystem evapotranspiration volume the daily soil water change is the difference between the rate of rainfall and the rate of soil water losses including surface runoff infiltration below depth z and evapotranspiration we treat rainfall as a censored poisson distribution characterized by a mean event depth α m day 1 frequency λ day 1 and canopy interception threshold δ m day 1 excess rainfall relative to available soil storage is converted to surface runoff according to a saturation excess mechanism the rate of infiltration is both a stochastic process controlled by rainfall and a state dependent process and the rate of evapotranspiration is a state dependent process dependent on saturation and vegetation caylor et al 2006 laio et al 2001 we approximate δ empirically multiplying lai by a characteristic amount of interception per unit leaf area hi 2 10 4 m day 1 bastiaanssen et al 2012 the mean frequency of rainfall reaching the soil under the canopy is thus reduced to λ λ e h i l a i α we assume that vegetation canopies exponentially reduce potential energy available for soil water evaporation due to shading according to beer s law φ e klai where k 1 2 is an extinction coefficient ensuring that potential soil water evaporation becomes 0 05e 0 for closed canopies and relations between lai and our modeled long term fraction of transpiration to total evaporation fig s1 reflects observed patterns wang et al 2014 wei et al 2017 following caylor et al 2006 we partition total potential soil water losses from evapotranspiration per unit ground area bound by e 0 into maximum soil water evaporation φe 0 plus maximum plant water uptake 1 φ e 0 as such the total rate of soil water losses is a continuous piece wise function of soil saturation including vertical drainage for states above sfc plant water uptake which decreases linearly from fww 1 φ e 0 for states above s to 0 at sw eq 3 and soil water evaporation which decreases linearly from φe 0 for states above sfc to 0 at sh the complete deterministic soil water loss function standardized by nz denoted by ρ s is 7 ρ s η e η t m e a s s fc 1 s fc s 1 η e s s h s w s h η t s s s fc η e s s h s fc s h η t s s w s s w s w s s η e s s h s fc s h s h s s w 0 0 s s h where η e φ e 0 n z η t f w w 1 φ e 0 n z a 2b 4 m k s s a t n z e a 1 s f c 1 the soil saturation probability density function p s for the homogenous soil column with maximum water storage nz can be derived analytically given this stochastic soil water balance under the assumption of statistical steady state during the growing season we can thus calculate p s directly for given soil properties n k s sat b sfc sh average growing season climate e 0 α and λ vegetation cover lai as well as plant water use strategies π groups the solution for p s given by caylor et al 2006 and recast for our model variant is 8 p s c e γ s ρ s s w s h κ s s h s w s h η t s fc s h η e s w s h ω η e η t s fc s h η e s s h η t s fc s h κ e δ s fc s 1 s w s h κ s s h s w s h η t s fc s h η e s w s h ω η e s s h η t s fc s h η e s s h η t s fc s h κ s s s fc s w s h κ s s h s w s h η t s s w s fc s h η e s s w s w s h ω s w s s s s h κ s h s s w 0 0 s s h where 1 γ α n z κ λ s f c s h η e ω λ s f c s h s s w η e s s w η t s f c s h δ λ l n ρ s η e η t a s s f c a m η e η t c is a constant to ensure that the integral of p s over 0 s 1 is equal to 1 finally we calculate the long term mean growing season water balance components including precipitation p α λ soil water evaporation e plant transpiration t and canopy interception i as 9 e φ e 0 s fc s h s s h s fc s h p s ds φ e 0 1 s fc p s ds 10 t 1 φ f ww e 0 s s w s s w s s w p s ds 1 φ f ww e 0 1 s p s ds 11 i α λ 1 e h i lai α where integrals on the right hand side of eqs 9 and 10 represent mean e and t under water limited and well watered conditions respectively differently from previous contributions this water balance accounts for plant behavior ranging from stress averse to stress tolerant via water use strategies as a function of π groups eq 4 for fww and eq 5 for s and sw 2 2 2 risk of plant water stress we use dynamic plant water stress θ proposed in porporato et al 2001 to quantify long term risk of water stress using the stochastic soil water balance this metric accounts for the impact of stress stomatal closure and its likelihood occurrence of soil saturation states below s which are quantified via long term mean static plant stress ζ unitless as well as the number n unitless and duration t days of soil saturation crossings of the s threshold during the growing season 12 θ min ζ k t t gs 1 n 1 where ζ s h s w p s d s s w s s s s s w p s d s with integrals representing mean ζ when soil saturation is below and above sw respectively and assuming that ζ above s is zero tgs is mean growing season length days t p s ρ s p s p s is the cumulative soil saturation probability density function n tgs t and k is an index that can be interpreted as the ζ a plant can experience during the duration tgs without suffering from permanent damage leading to θ 1 in the absence of specific information we prescribe a fixed value k 2 3 which ensures that θ 1 for all study sites this probabilistic formulation of plant water stress is heuristic but translates complex links between soil water deficit and loss of photosynthesis including both temporal and permanent physiological damage to provide a parsimonious but realistic measure of long term cost of water stress for plant productivity and links to water use efficiency porporato et al 2001 2 2 3 plant water use performance we define plant water use performance ε unitless as stress weighted transpiration normalized by water availability bassiouni et al 2020 caylor et al 2006 13 ε 1 θ t p this metric of plant water use performance represents the tradeoff between water uptake leading to carbon gains and growth represented by t p and risks of unfavorable water stressed conditions during which the water penalty of opening stomata to fix carbon is greater and leads to high costs of water use represented by 1 θ in other words long term transpiration is linked to plant productivity through 1 θ which is defined to capture long term water use efficiency porporato et al 2001 with this approach water use performance is evaluated without directly estimating photosynthesis moreover by quantifying performance relative to available water ε is also a measure of water productivity which is a meaningful measure for comparisons between ecosystems in different climates next we assume that plant traits adapt to maximize water use performance eq 13 this approach is similar to optimality criteria adopted in stomatal optimization theories mencuccini et al 2019 wang et al 2020 but now using our minimalist ecohydrological framework while there is no consensus on the most appropriate formulations of optimality criteria and constraints for different spatial temporal or organization scales bassiouni and vico 2021 sabot et al 2022 leveraging dynamic plant water stress θ allows for the optimality formulation to account for cumulative impacts of soil moisture deficits on net carbon gain as opposed to typically assumed instantaneous performance maximization feng et al 2022 lu et al 2020 2 3 framework application we first explore the role of the π groups theoretically using baseline parameter values for a temperate broadleaf forest table 1 as a sample ecosystem we then apply the framework at 40 selected ecosystems using prescribed site specific soil texture vegetation structure and climate parameters derived from data and metadata table s1 and inferring the four unknown plant traits ψ g 50 ψ x 50 k x max rai through model inversion to quantify associated π groups and the shape parameters for β s π rooting depth plays an integral role in defining plant water use strategies via both k sr max and the soil water balance however here we focus on variations of other eco physiological traits and constrain z to site specific values consistent with available soil moisture data specifically we prescribe z as 1 5 times the soil moisture measurement depth table s1 which generally corresponds to the average rooting depth in the studied biomes as such we limit our analysis to π groups in the eco physiological model defining the shape of β s π section 2 1 rather than the ecohydrological model section 2 2 π groups for the ecohydrological model have been previously defined and studied for the partitioning of the soil water balance e g feng et al 2012 porporato et al 2004 as well as in the context of optimal z across climatic gradients guswa 2010 namely e 0 α λ the aridity index and s f c s w n z α the soil water storage index 2 3 1 data we use daily observations and site characteristics from 40 sites table s1 in the fluxnet2015 dataset pastorello et al 2020 as well as satellite lai estimates myneni et al 2015 we select sites and quality check records to best meet soil water balance model assumptions and only analyze growing season data see methods s1 and table s1 for details about data and site selection the model requires rainfall net radiation and air temperature climate data inputs we evaluate model results against soil moisture observations as well as independent not used in parameter inference total evapotranspiration and gross primary productivity measured by eddy covariance 2 3 2 parameter inference and evaluation for each site we infer two sets of parameters with i a data driven criterion maximizing the goodness of fit between empirical derived from data and theoretical eq 8 soil saturation probability distributions p s and ii the ecohydrological optimality criterion maximizing plant water use performance ε eq 12 we adapt a bayesian inference algorithm from previous work bassiouni et al 2020 2018 to this study s improved soil water balance which explicitly partitions evapotranspiration and is eco physiologically constrained by plant traits represented in π groups see methods s2 for details about parameter inference we compare parameter sets as well as metrics of plant water uptake capacity and water use performance emerging from both criteria and hypothesize that ecohydrological optimality explains plant water use strategies encoded in soil moisture observations to evaluate the predictive skill of our modeling approach at each site we calculate the theoretical p s applying both the data driven and optimality based parameter sets we then quantify goodness of fit compared to the empirical p s derived from soil moisture time series using a quantile level nash sutcliffe efficiency nse 1 indicates a perfect model nse 0 indicates that the model has less predictive skill than mean s previous studies using this metric considered nse 0 unacceptable and nse 0 5 a good match bassiouni et al 2020 2018 as an additional and independent measure of predictive skill we compare optimality based model results to record averaged growing season total evapotranspiration and gross primary productivity across the selected 40 ecosystems 3 results 3 1 plant water flux control is the primary axis of variation in water use strategies plant traits individually alter π groups and consequently plant water use strategies reflected in the shape of β s π however multiple combinations of individual traits can produce π groups of the same value and therefore lead to the same behavior in terms of plant water uptake capacity fww s sw and σ eqs 3 6 and same ecohydrological outcomes in terms of plant water use performance ε eq 13 further combinations of different π groups can also lead to similar results because π groups interact eqs 4 and 5 to determine water flux through the spac reflected in the shape of β s π plant water flux control π f and hydraulic risk tolerance π r affect all three β s π shape parameters while soil suitability π s and soil root water transport capacity π t only affect s and sw and do not influence fww eqs 4 and 5 we summarize and illustrate the role of the π groups theoretically figs 2 5 and figs s2 s5 varying baseline parameter values table 1 stomatal sensitivity ψ g 50 affects fww s sw and hence the shape of β s π fig 2a through its appearance in all four π groups fig 2e with more sensitive stomatal control less negative ψ g 50 and all else being equal fww decreases and s and sw increase towards wetter states consequently the overall index of plant water uptake capacity decreases leading to increasingly stress averse strategies decreasing σ moving from purple to yellow curves in fig 2b with decreasing σ and progressively downregulated transpiration soil saturation probability distributions p s shift to wetter states because plants conserve more water fig 2c additionally plant water use performance ε increases to a maximum and then declines as stomatal sensitivity increases fig 2d because stress tolerant plants very negative ψ g 50 are more likely to be water stressed due to less constrained and excessive water use while overly conservative strategies do not use available water effectively the other key spac variables can counterbalance effects of ψ g 50 in each individual π group leading to combinations of π groups that determine a wider spectrum of water uptake capacity than those exemplified in fig 2 variables that interact with ψ g 50 include xylem vulnerability ψ x 50 in π r plant size and hydraulic architecture that define k p max lai hc k x max in π f soil and root properties that define k sr max k s sat rai in π t and soil water holding capacity ψ s sat in π s however the extent to which water use strategies deviate from the general pattern imposed by ψ g 50 alone fig 2 is constrained by ranges of trait values documented in different biomes e g manzoni et al 2013a certain combinations of π groups and water use strategies can result from a large diversity of co existing traits while other strategies can only occur for more specific trait combinations due to constraints of atmospheric water demand e 0 and soil texture while soil and root properties can influence the shape of β s π we conclude that they do not considerably counterbalance effects of aboveground plant traits this is because differences in soil texture and root area index summarized in π s and π t result into negligible variations in relative plant water uptake capacity fig s2 s5 note that here we explore relative plant water uptake capacity for a given rooting zone to isolate from the strong controls of soil texture and rooting depth on available soil water through interacting with the total water balance decreasing plant water flux control and all else being equal decreasing π f moving from yellow to purple curves in fig 3 results in more stress tolerant strategies increasing σ by both increasing fww which enhances water uptake in wetter states and decreasing s and s w which increases water uptake in dry states for set plant traits π f decreases when atmospheric water demand e 0 decreases as a result of lower e 0 plant water transport becomes less limiting and σ accordingly increases increasing plant hydraulic risk tolerance and all else being equal increasing π r fig 4 decreases s and sw as well as fww which leads to more conservative water uptake at wetter states and little change to σ compared to decreasing π f hydraulic risk tolerance π r modulates the effect of plant water flux control because π r influences the sensitivity of the relation between π f and σ fig 5 for a fixed ψ g 50 but varying ψ x 50 and k p max the capacity to take up soil water decreases more steeply with increasing π f at high compared to low π r moving from purple to yellow curves in fig 5a because increasing π f also lowers water stress plant water use performance ε peaks at intermediate values of π f and the π f value at the peak increases with decreasing π r fig 5a this means that at low π f the value of π r has little effect on water use performance and that the combination of both high π f and π r leads to lowest performance high risk tolerance is thus not beneficial in combination with high plant limitations on water flux low k p max ψ g 50 increases π f or high atmospheric water demand high e 0 increases π f in summary plant water use strategies represented by the shape of β s π are primarily defined by plant water flux control π f therefore also influencing plant water uptake capacity and water use performance as well as their sensitivity to climate variability plant hydraulic risk tolerance π r has a smaller influence and interacts with water flux control especially when plant water transport is limiting high π f risk aversion versus tolerance low to high π r only affects water use performance when atmospheric water demand is much greater than plant water transport capacity higher values of π f and depends directly on climate in the definition of π f and indirectly on the timing and amount of rainfall interacting with π f via β s π in the water balance importantly the theoretical patterns suggest an optimal range of traits that maximize plant water use performance and not all possible combinations of plant traits and π groups may be viable depending on the degree of climate variability 3 2 optimal water use strategies maximize long term mean transpiration weighted by risks of water stress building on the theoretical results we apply our framework across the selected 40 ecosystems to test the ecohydrological optimality criterion maximizing eq 13 the median nash sutcliffe efficiency nse between empirical and theoretical soil saturation probability distributions p s is 0 9 using parameters that maximize the fit with soil moisture observations data driven criterion and 0 7 using parameters that maximize plant water use performance ε optimality criterion fig 6 a applying the model using the data driven and optimality based parameters explains 95 and 83 respectively of the variability in long term mean growing season soil saturation observed across the 40 ecosystems fig 6b therefore comparing predictive model skill using the optimality criterion with independent theoretically estimated parameters and the data driven criterion with empirically fitted parameters lends support to our parsimonious approach the posed metric of stress weighted transpiration ε eq 13 using optimality based parameters also explained 55 of the variability in long term average growing season gross primary productivity across the 40 ecosystems fig 7 a further the ecohydrological model using optimality based parameters explains 67 of the variability in long term average growing season total evapotranspiration fig 7b and reproduces patterns in long term water balance partitioning along the aridity axis fig 8 a as well as a mesic maximum in the transpiration fraction fig 8b consistent with other empirical and modeling studies budyko 1974 good et al 2017 paschalis et al 2018 porporato et al 2004 our comparison of data driven and optimality based parameter estimates fig 9 indicates that the shape of β s that best captures observed soil moisture variability is also ecohydrologically optimal in terms of maximizing water use performance ε eq 13 pearson s correlations between data driven and optimality based parameter estimates range from 0 9 for fww sw and π f to 0 41 for π r the biases between data driven and optimality based parameter estimates range from 5 for fww and π f to 32 for π r fig 9 the high correlations and low bias between data driven and optimality based estimates suggest that the shape of β s is well constrained despite some uncertainty regarding specific nuances in plant water use strategies for example the degree of plant hydraulic risk π r is not critical to define daily plant water uptake capacity in most biomes our findings therefore support the hypothesis that plant traits are adapted to growing season environmental conditions and maximize water use performance in terms of balancing long term mean transpiration and risks of water stress ε eq 13 the root mean square difference between water use performance ε resulting from the best fit models and maximum ε from the optimality based models is 0 08 and the bias indicates that ecosystems as characterized by soil moisture observations are on average within 9 of their maximum theoretical water use performance water use performance based only on static stress ζ leads to much greater differences between data driven and optimality based parameters and a bias towards more stress tolerant strategies fig s6 this demonstrates the importance of using of dynamic stress θ when defining water use performance and the need to account for the number and duration of periods with soil saturation below the threshold s during the growing season the comparison between ζ and θ also underlines that both the amount and timing of rainfall affect the long term cost of water use due to cumulative stress despite the coordination expected between water flux control π f and hydraulic risk tolerance π r given their dependence on stomatal sensitivity ψ g 50 in the analytical model pearson s correlation between optimal π f and π r values is weak fig s7 r 0 1 this means that these two π groups can be useful targets for parameter inference and represent two complementary aspects of water use strategies however π r is more difficult to infer from data especially in humid conditions and the goodness of fit between data driven and optimality based π r was poor fig 9e this is expected from the model theoretical behavior fig 5 showing that plant risk tolerance summarized by π r has a minor effect on plant water uptake capacity and performance when atmospheric water demand is lower than plant water transport capacity low π f and the negative correlation confirms that having both high π f and high π r is not ecohydrologically successful the inference algorithm converges to robust estimates of the lumped parameters fww s sw despite higher uncertainty in estimates of individual traits mean coefficient of variation of posteriori parameter estimates 0 05 versus between 0 1 and 1 therefore lumped parameters and π groups describing the spac rather than individual traits provide a more constrained and robust definition of β s π and the associated ecohydrological functions at the ecosystem level the water use strategies emerging from the optimal π group values do not vary consistently between plant functional types under the same growing season conditions both needle leaf forests and grasslands can have the same π group values resulting from different possible trait combinations the variability in water use strategies are primarily explained by aridity e 0 p fig 9 for example the most stress avoidant strategies high π f low π r low σ are found in mediterranean climates including needleleaf broadleaf and savanna ecosystems statistically significant correlation coefficients between e 0 p and σ π f and π r are 0 80 0 85 0 86 0 92 and 0 35 0 33 respectively for data driven and optimality based estimates table 3 however σ is more correlated with e 0 than rainfall characteristics π f is more correlated with rainfall frequency and π r is more correlated with rainfall intensity table 3 4 discussion we analyze soil moisture observations a key ecosystem variable to evaluate whether plants achieve efficient soil water use by coordinating spac biotic components as previously hypothesized manzoni et al 2013b mencuccini et al 2015 prentice et al 2014 reich 2014 we seek to improve understanding of ecosystem climate interactions beyond previous studies that explain variations in individual plant functional traits with average long term climate characteristics such as mean annual precipitation and temperature choat et al 2012 as well as improve empirical quantification of variability in ecosystem scale water stress responses with uncertain eco physiological underpinnings bassiouni et al 2020 fu et al 2022 yanlan liu et al 2021 we therefore take a holistic view and explain variations in plant water use strategies using non dimensional π groups within an ecohydrological model this framework combines plant traits soil and climatic conditions to link strategies to a dynamic metric of plant water use performance that accounts for feedbacks due to risk of plant water stress figs 2 5 we find that individual traits do not determine optimal plant water use strategies and water use performance because various combinations of trait values lead to similar ecohydrological outcomes importantly parameters defining plant water use strategies that maximize water use performance also capture temporal variability in soil moisture within ecosystems p s and spatial variability in long term growing season ecohydrological fluxes across wet to arid ecosystems figs 6 7 the ecohydrologically optimal plant water use strategies point to coordination in plant traits to meet atmospheric water demand and stochastic water availability that influence stress risk and cumulative drought impacts despite its parsimony this tractable quantification of plant water use strategies and ecohydrological performance offers promising avenues to parameterize and diagnose plant responses to water limitations under climate change further alternative optimality and coordination hypotheses can be tested by revisiting our framework with different or more complex performance criteria and π groups incorporating additional processes and tradeoffs 4 1 ecohydrological coordination reflected in π groups simplifies the description of plant water uptake non dimensional π groups summarizing key eco physiological tradeoffs capture simultaneously biotic and abiotic controls on plant water use strategies in a tractable model leading to an effective but parsimonious description of ecosystem climate interactions we focus on the shape of the relation between soil moisture and transpiration relative to potential atmospheric water demand β s π and identify non dimensional axes of variation that are not directly apparent when looking at individual traits due to covariations among plant traits and environmental conditions in which plants grow the dominant axis capturing variations in water use strategies is the plant water flux control π f which represents the ratio of atmospheric water demand over plant controlled water supply to the leaves the dominance of π f points to the importance of combined climatic and plant characteristics in defining plant water use strategy the plant risk tolerance axis π r capturing coordination of hydraulic and stomatal traits within a plant and contrasting stomatal versus xylem sensitivity to water status becomes influential when plant water transport is most limiting high π f in other words π f mainly drives variability in plant water uptake capacity σ and π r regulates nuances in the sensitivity of σ to variability in π f due to changes in atmospheric water demand e 0 or plant size and hydraulic architecture k p max the groups describing soil suitability π s and soil root transport capacity π t were less influential for a given rooting depth they had no effect on soil water uptake in well watered conditions fww and only negligible impact on thresholds of soil water uptake sw and s we demonstrate that π groups explain stress responses in a wide range of ecosystems thus expanding on a previous dimensional analysis of plant drought responses feng et al 2018 and taking the concept a step further by incorporating π groups in a modeling framework to improve understanding of the influence of plant traits in ecosystem climate interactions the two most influential axes represented by π f and π r are consistent with the fast slow plant economics spectrum reich 2014 slow trait strategies are associated with stress avoidance due to limited plant water transport high π f and or risk avoidance low π r however π f combines eco physiological and climatic variables leading to a generalized and more meaningful approach for capturing variations at ecosystem levels compared to existing metrics for water use strategies based solely on traits skelton et al 2015 π f is also related to sources of variation of previously identified major axes of ecosystem function in particular water use efficiency derived from exploratory data analyses díaz et al 2016 migliavacca et al 2021 the added benefit is that π groups have stronger mechanistic underpinnings and lead to a more transferrable and generalizable approach furthermore π groups combine different traits and reveal their coordination a single π group value can represent a wide range of possible individual traits characterizing a diversity of co existing species in an ecosystem that lead to similar long term water use performance the relation between water balance and π groups rather than single parameters has a practical implication because we show that calibrating traits in spac models will inevitably lead to multiple solutions our approach thus provides new avenues to reduce the complexity of quantifying ecosystem function and to increase model robustness prentice et al 2015 by focusing on π groups that embed ecologically meaningful mechanisms instead of individual parameters 4 2 ecohydrological optimality explains plant water use strategies beyond summarizing the spac in a small number of non dimensional groups our parsimonious approach predicts ecologically successful water use strategies optimality based estimates that are consistent with the long term water balance spanning wet to arid climates data driven estimates fig 9 as such this approach links and generalizes previous data driven bassiouni et al 2020 and theoretical studies feng et al 2018 manzoni et al 2014 optimal combinations of π groups defining β s explain observed soil moisture variability p s and encode combinations of plant traits that are most effective at using limited water resources accounting for the cost of water stress as captured by the water use performance ε this implies that at the ecosystem level plants are adapted to growing season conditions to maximize water use performance as a result our framework provides a method to understand and parameterize the sensitivity of transpiration to soil moisture and potential atmospheric demand based on few easily available environmental variables instead of prescribing or calibrating optimality costs or parameters as commonly done when modeling stomatal conductance mencuccini et al 2019 aridity primarily influences optimal water use strategies although these strategies vary among studied ecosystems and within plant functional types generally variability in metrics of plant water uptake capacity fww s sw and σ across biome and along the aridity axis are consistent with patterns and findings from previous empirical studies bassiouni et al 2020 fu et al 2022 further the theoretical framework optimal π f significantly increases with decreasing rainfall frequency water demand becomes more important during the longer dry spells while optimal π r increases with increasing rainfall intensity water stress is more acceptable in wetter climates our findings indicate that both the timing and amount of rainfall are key to quantify risks of water stress and resulting water use performance importantly the improved match between data driven and optimality based parameters using the dynamic water stress θ fig 9 versus static water stress ζ fig s6 points to long term eco evolutionary adaptation to stochastic water availability that influences the long term cost of water use and the need to avoid both temporal and irreversible impacts on productivity our results therefore provide novel evidence that optimality inferred from long term risks rather than instantaneous impacts feng et al 2022 lu et al 2020 is more consistent with ecohydrological data while most parameters estimated from the data and theory based approaches are very well correlated the correlations for π r are poor fig 9e this does not necessarily undermine the validity of the ecohydrological optimality criteria and the importance of accounting for risks of water stress to quantify plant water uptake capacity and its sensitivity to environmental conditions rather it points to some limitations of the long term water balance framework and daily data in being able to disentangle the complexity of plant hydraulic risk tolerance especially in humid environments optimal water use strategies explain fundamental patterns of rainfall partitioning into evapotranspiration and percolation or runoff and how the water balance is linked to plant drought responses ranging from stress tolerant to stress averse fig 8 furthermore transpiration weighted by water stress risks captures spatial variability in gross primary productivity and despite its parsimony proves a useful performance metric contrasting costs and benefits of water uptake under a wide variety of soil and climatic conditions fig 7a our optimality criteria to identify π groups complements previous ecohydrological models under stochastic rainfall and findings inferring grass tree distributions caylor et al 2006 optimal rooting depths guswa 2010 2008 coordination of stomatal and xylem vulnerability manzoni et al 2014 and stomatal responses lu et al 2016 different from approaches optimizing single traits quantifying π groups provides a more holistic view of eco evolutionary outcomes that accounts for expected co variations across plant organs and between traits and the environment furthermore while our framework is focused here on water use strategies in terms of the shape of β s it can be extended to also assess optimal rooting depths and further improve the inference of tradeoffs between eco physiological traits rooting strategies and vegetation distribution from ecosystem scale data yaling liu et al 2021 stocker et al 2023 that emerge as adaptations to water availability given known long term climate characteristics π groups summarize ranges of possible trait combinations that can achieve similar functions and co exist in an ecosystem the framework offers further avenues to assess the evolutionary stability of resulting water use strategies therefore π groups can be useful to explain relations between trait diversity and local water availability trugman et al 2020 the proposed optimality based inference of water use strategies provides opportunities to investigate broad spatial patterns of optimal π groups how they relate to distributions of global ecosystems and potential vulnerability or adaptation to climate change especially in ecosystems most vulnerable to increased water limitations 4 3 tractable quantification of plant water use strategies leveraging dimensional analysis and optimality theory we address the need for parsimonious and more transferable descriptions of water use strategies to bridge the gap between top down data driven approaches and bottom up trait based approaches scaling and aggregating individual plant traits to describe ecosystem level transpiration with a bottom up approach is complex and uncertain because tissue level traits have nonlinear dependencies on plant size and ecological performance and survival mechanisms shape community composition enquist et al 2015 mencuccini et al 2019 indirect inference approaches using flux tower and satellite data extend the representation of ecohydrological processes beyond plant level measurements and provide ecosystem scale parameters defining water use strategies globally bassiouni et al 2020 dralle et al 2020 fu et al 2022 konings and gentine 2017 liu et al 2020 yaling liu et al 2021 yanlan liu et al 2021 stocker et al 2023 however results from inverse modeling can be conflated by their many assumptions and are still constrained by the coverage uncertainty and quality of numerous data inputs we therefore take a step forward and propose a complementary dimensionless optimality framework to infer water use strategies using minimal but realistic assumptions grounded in eco physiological theory and requiring few readily available parameters soil texture mean growing season atmospheric water demand rainfall characteristics and leaf area index non dimensional π groups summarize water use strategies by collapsing variability in traits into a minimal number of parameters reducing the complexity of representing detailed spac hydraulics at the ecosystem level two non dimensional groups plant water flux control π f and hydraulic risk tolerance π r are key in determining the functional relation between transpiration soil moisture and atmospheric water demand this relation β s π uniquely determines our metrics of plant water uptake capacity fww s sw and σ therefore despite uncertainty in individual trait estimates metrics of plant water uptake capacity are well constrained robustly estimated and accurately describe water use strategies adapted to the given soil and climate the simplified eco physiological model explains key ecological information encoded in hydrological observations and complements the data driven approach parametrizing existing empirical relations such as β s π using optimality principles and π groups offers a promising avenue for next generation models to incorporate ecological mechanisms and principles of community ecology harrison et al 2021 scheiter et al 2013 without sacrificing model robustness or increasing complexity as advocated by prentice et al 2015 ecosystem scale relations between transpiration and soil moisture can potentially preserve their practical and parsimonious forms while approaching predictive capacity of full hydraulic models sloan et al 2021 optimality based approaches such as the one proposed here can also provide useful constraints to reduce the uncertainty and enhance the interpretation of future data driven including satellite based estimates of ecosystem functioning and sensitivity to climate 5 summary and conclusions improved characterization of trait based water use strategies is necessary as models shift from using coarse plant functional types toward incorporating plant traits to better represent vegetation climate feedbacks and ecological mechanisms in a changing climate matheny et al 2017 characterizing water use strategies remains uncertain especially when aiming at effectively capturing ecosystem scale water fluxes this uncertainty is both conceptual due to a lack of theoretical frameworks defining these strategies based on ecologically meaningful outcomes and operational because eco physiological models are complex and difficult to parameterize mencuccini et al 2019 we reduce the dimensionality of the problem by modeling long term average dynamics of water fluxes through the spac using non dimensional groups we therefore define water use strategies without specifying individual traits while still accounting for key eco physiological mechanisms these π groups combine traits with environmental variables thereby identifying fundamental axes of variation along which diverse trait environment combinations can lead to similar outcomes in terms of water uptake capacity and water use performance as such our approach generalizes current metrics for water use strategies based solely on traits and improve our ability to effectively capture ecosystem scale water fluxes furthermore a primary π group characterizing synchronization of plant water transport and atmospheric water demand defines water use strategies parameter estimates capturing observed soil moisture variability are consistent with those maximizing transpiration weighted by risks of water stress this result supports ecohydrological optimality as a parsimonious guiding principle to assess water use strategies we can thus infer water use strategies that are consistent with those encoded in soil moisture observations and with more mechanistic underpinnings compared to exploratory data analysis using π groups to link vegetation soil and climatic conditions to optimal plant water use performance we propose and validate a minimalist but transferable approach describing ecohydrological processes across climates and independently of scale author contributions mb sm and gv designed the research mb performed the analysis and wrote the paper sm and gv contributed to interpreting results editing and revising the paper data availability statement code to reproduce the analysis in this study is available at https doi org 10 5281 zenodo 5518546 and all necessary datasets are available at https fluxnet org data fluxnet2015 dataset and https lpdaac usgs gov products mcd15a3hv006 declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we thank xue feng trevor keenan benjamin blonder and several anonymous reviewers for feedback on earlier versions of the manuscript mb thanks stephen good and chad higgins for discussions that inspired the study mb and gv received funding from the european commission and swedish research council for sustainable development formas grant 2018 02787 in the frame of the international consortium iaqueduct financed under the 2018 joint call of the waterworks2017 era net cofund gv was also supported by formas grant 2018 01820 mb used computational resources provided by the swedish national infrastructure for computing at uppmax partially funded by the swedish research council grant 2018 05973 this work used data acquired and shared by the fluxnet community supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2023 104405 appendix supplementary materials supporting information image application 1 
54,plant responses to water stress influence water and carbon cycles and can lead to feedbacks on climate yet characterizing these responses at ecosystem levels remains uncertain quantifying ecosystem level water use strategies is complex due to challenges of upscaling plant traits and disentangling confounding environmental factors ultimately limiting our ability to understand and anticipate global change in ecosystem dynamics and ecohydrological fluxes we reduce the dimensionality of this problem and quantify plant water use strategies by combining plant traits with soil and climate variables into parameter groups that synthesize key eco physiological tradeoffs using a parsimonious soil water balance framework we explore variations in plant water uptake capacity water stress responses and water use performance via these non dimensional parameter groups the group characterizing the synchronization of plant water transport and atmospheric water demand emerges as the primary axis of variation in water use strategies and interacts with the group representing plant hydraulic risk tolerance especially in arid conditions when plant water transport is limiting next we show that specific plant water use strategies maximize plant water uptake leading to carbon gain benefits weighted by risks of water stress leading to higher costs of water use a model data comparison demonstrates that these ecohydrologically optimal parameter groups capture observed soil moisture variability in 40 ecosystems and beyond aridity rainfall frequency is an important environmental control for plant water use strategies the emerging parsimonious link between ecohydrological performance and non dimensional parameters provides a tractable representation of plant water use strategies relevant to parameterize global models while accounting for ecological and evolutionary constraints on the water cycle keywords buckingham pi eco evolutionary optimality ecohydrology evapotranspiration hydraulic risk plant functional traits plant water stress soil water balance 1 introduction plant level characteristics that regulate water transport from the soil to the atmosphere and assimilation of atmospheric carbon determine tradeoffs between plant water use for growth versus water conservation for survival reich 2014 skelton et al 2015 they also shape species composition in competitive environments lu et al 2020 and ultimately influence ecosystem carbon and water fluxes despite increasingly available plant trait data kattge et al 2020 empirical and conceptual challenges limit our ability to exploit trait data effectively beyond the plant level to improve model process representations such as gas exchanges and drought responses at the ecosystem scale mencuccini et al 2019 for example variability in trait based plant water use strategies between and within ecosystems choat et al 2012 skelton et al 2015 are still poorly understood explaining variability in ecological constraints on the water cycle across global biomes requires a holistic theoretical basis for plant water use strategies that accounts for dynamic interactions with environmental conditions across scales feng et al 2019 2018 kannenberg et al 2022 plant functional traits vary across species and within plant functional types anderegg 2015 they exhibit global eco evolutionary patterns franklin et al 2020 and trends in response to changing water availability trugman et al 2020 while these traits are often coordinated manzoni et al 2013b mencuccini et al 2015 untangling confounding environmental effects and understanding global patterns in trait coordination at plant to ecosystem levels remain problematic lavergne et al 2019 notably performance of plants with similar traits varies in different climates and vice versa different traits can lead to similar performance under a given climate feng et al 2019 water use strategy definitions thus need to consider traits in combination with soil and climatic conditions at plant to ecosystem levels identifying combinations of traits and soil and climatic variables that best describe key eco physiological tradeoffs can be guided by a formal search for non dimensional parameter groups buckingham 1914 importantly diagnosing plant water use strategies with non dimensional numbers without units provides a universal description of the system at any organizational scale and offers avenues to test hypotheses in a lower dimensional context porporato 2022 furthermore ecohydrological coordination embedded in the non dimensional framework reduces equifinality and uncertainties inherent in characterizing trait based ecological functions at plant to ecosystem levels in a changing climate non dimensional groups have been previously used to classify plant drought responses feng et al 2018 but have yet to be implemented in a modeling framework to predict drought responses in different ecosystems as well as define which specific plant water use strategies are ecohydrologically successful specific strategies or plant functions emerging from trait coordination and interactions with environmental conditions can be estimated from eco evolutionary optimality franklin et al 2020 manzoni et al 2014 importantly theoretical optimality principles are applicable at both species and ecosystem levels and can improve upon empirical model formulations and reduce the number of required parameters harrison et al 2021 the ability of optimality principles to explain patterns in water use strategies of whole ecosystems still needs to be further confirmed by confronting their predictions with key measured hydrologic variables soil moisture integrates hydrologic fluxes soil plant traits and climatic conditions that are tightly linked to ecosystem functioning rodríguez iturbe and porporato 2005 soil moisture observations therefore encode plant water use patterns imposed by climatic and soil conditions and these patterns can be interrogated via ecohydrological approaches bassiouni et al 2020 2018 further ecohydrological approaches accounting for the stochasticity of rainfall can characterize the mean intensity duration and frequency of periods of soil water deficit to identify optimal environmental conditions for vegetation porporato et al 2001 nevertheless despite previous data driven bassiouni et al 2020 and theoretical manzoni et al 2014 analyses we lack tractable and transferable quantification of plant water use strategy patterns across biomes to inform parametrization of plant responses to drought and anticipate ecosystem vulnerabilities to global change we propose and test an ecohydrological optimality criterion to quantify plant water use strategies as a function of readily available environmental conditions this theoretical approach has the advantage of being more tractable and explainable than empirical parameterizations and does not require calibration to targets such as observations of evapotranspiration and gross primary productivity by combining ecohydrological optimality with the buckingham π theorem we address the challenge of quantifying the multiple dimensions of plant water use strategies and their tradeoffs especially at the ecosystem level specifically we first reduce the complexity of eco physiological controls on transpiration by combining plant traits with soil and climate parameters into non dimensional π groups we then define metrics of plant water use capacity sensitivity to water stress and water use performance linked to daily soil moisture dynamics and long term risks of plant water stress leveraging this framework and soil moisture data from 40 ecosystems we provide data driven and theoretical support for the hypothesis that plants adapt to long term growing season conditions by balancing maximization of water uptake leading to carbon gains and growth with minimization of risks of unfavorable water stressed conditions leading to higher costs or penalties of water use our approach extends the analytical value of non dimensional groups beyond summarizing how traits soil and climate co determine water use strategies by implementing non dimensional groups in an ecohydrological modeling framework to explain variability in ecological constraints on the water cycle further the framework incorporates traits into response based metrics of plant water use strategies and link them to ecohydrological performance accounting for cumulative impacts of water stress on plant function as well as their feedbacks this study offers a parsimonious but effective alternative to more complex models to investigate and parameterize water use strategies across wet to arid ecosystems exploiting ecohydrological optimality as a guiding principle 2 materials and methods our modeling framework is centered around a conceptual representation of the soil plant atmosphere continuum spac referred to as eco physiological model coupled to a stochastic soil water balance referred to as ecohydrological model the eco physiological model section 2 1 calculates transpiration as a function of soil saturation plant functional traits and plant hydraulic status fig 1 a which we simplify to express metrics of plant water uptake capacity as a function of non dimensional parameter groups fig 1b we then integrate the eco physiological model into the ecohydrological model section 2 2 to link plant controls on transpiration to soil and climatic conditions the coupled models quantify how biotic and abiotic components interact and ultimately determine long term plant water use water stress and water use performance fig 1c we apply this spac water balance framework section 2 3 first to explore water use strategies theoretically and then to infer plant water use strategies from data and verify an ecohydrological optimality criterion fig 1d model parameters and metrics characterizing plant water use strategies are summarized in tables 1 and 2 respectively 2 1 eco physiological model and reducing the dimensionality of plant water use strategies the daily rate of transpiration t m day 1 is bound by potential atmospheric water demand characterized here by potential evaporation e 0 m day 1 priestley and taylor 1972 and constrained by soil water supply within a depth z m characterized here by soil water saturation s unitless 0 s 1 we aim to simplify the description and exploration of plant water use strategies by expressing the ratio β t e 0 as a function of s and non dimensional parameters that define eco physiological tradeoffs fig 1a b further we derive four metrics of plant water uptake capacity and the sensitivity of plant uptake to hydraulic status resulting from e 0 and s together to summarize different plant water use strategies 2 1 1 water flux through the soil plant atmosphere continuum spac following conceptual plant hydraulics models feng et al 2017 manzoni et al 2013b we assume plant water storage is much smaller than transpiration at the daily time scale and equate water fluxes along different components of the spac fig 1a therefore t is equal to the rate of water supply from soil to roots water transport from roots to canopy and water flux from canopy to the atmosphere the rate of water supply from soil to canopy is driven by the difference between soil ψ s mpa and canopy ψ c mpa water potentials we neglected gravimetric potential and is controlled by the series of soil to root ksr m day 1 mpa 1 and plant xylem kp m day 1 mpa 1 conductances the water flux from canopy to atmosphere is equal to water vapor that diffuses through stomata driven by the difference in water vapor in the atmosphere and in the leaf d mol 1 and is regulated by canopy conductance gc m day 1 1 t β s e 0 k sr k p k sr k p ψ s ψ c g c d we assume that ksr decreases non linearly with decreasing ψ s from its maximum value k sr max at soil saturation ψ s s a t and that kp and gc decrease linearly with decreasing ψ c from their maximum values k p max and g c max respectively and with slopes determined by canopy water potentials at 50 xylem ψ x 50 mpa and stomatal ψ g 50 mpa conductance loss fig 1a we focus on the ecosystem as a whole and express all conductances per unit ground area they are functions of plant root stem and leaf level traits and soil water retention parameters table 1 such as root area index rai m2 m 2 leaf specific maximum xylem conductivity k x max kg m 1 mpa 1 s 1 canopy height hc m leaf area index lai m2 m 2 and saturated soil conductivity k s sat m day 1 see manzoni et al 2014 for details on this linearized spac parameterization and justifications for simplifications 2 1 2 non dimensional groups emerging from the spac eight parameters and state variables suffice to describe key aspects of water flux through the spac and its sensitivity to environmental conditions defined in the eco physiological model t varying with plant traits soil texture climate and water status e 0 varying here only with temperature and radiation priestley and taylor 1972 s the only state variable in our framework varying due to stochastic rainfall events affecting the soil water balance within a depth z and controlled by spac characteristics k sr max varying with soil texture and root structure and depth k p max varying with xylem conductivity and plant size ψ g 50 varying with stomatal sensitivity ψ x 50 varying with xylem vulnerability ψ s s a t varying with soil texture the dimensionality of the system can be reduced by combining these eight variables based on three primary dimensions length time and mass but only two primary units m day 1 and mpa into 8 2 6 non dimensional quantities buckingham 1914 that summarize key climate soil and eco physiological tradeoffs emerging from the spac β t e 0 reflects the degree of transpiration downregulation and varies temporally in response to plant water stress a value of 1 indicates transpiration is equal to potential atmospheric water demand and a value of 0 indicates transpiration has ceased s reflects soil water supply relative to soil saturation within a depth z and varies with the soil water balance driven by stochastic rainfall inputs and controlled by spac characteristics a value of 1 indicates all soil pores are filled with water and the minimum value is the hygroscopic point when water is bound to the soil π r ψ g 50 ψ x 50 reflects the degree of plant hydraulic risk tolerance a value close to 0 represents the most risk averse strategy with strict stomatal control to limit xylem damage and a value close to 1 represents the most risk tolerant strategy with more passive stomatal control to favor carbon assimilation feng et al 2018 skelton et al 2015 π f e 0 k p max ψ g 50 reflects the degree of plant water flux control a value close to 0 indicates that plant water supply is nearly unlimited compared to atmospheric demand a value close to 1 indicates synchronization of supply and demand and larger values point to a bottleneck in plant water transport relative to demand due to stomatal and or xylem limitations π t k sr max ψ g 50 e 0 reflects soil root water transport capacity values are generally high but lower values occur when water supply is limited by the soil root system for slow draining soils clay π s ψ g 50 ψ s s a t reflects soil suitability for plant water extraction values are generally high ψ s s a t tends to be small and highest values occur for high porosity soils sand applying the buckingham π theorem buckingham 1914 porporato 2022 by relating β to s and the four π groups fig 1b we can express plant water uptake at a given soil saturation without dimensions but accounting for spac environmental and plant characteristic that vary across ecosystems 2 β f s π r π f π t π s we note that the application of buckingham π theorem does not lead to a unique choice of non dimensional groups and results are specific to the system under consideration and the line of inquiry we obtain six groups for our simplified representation of the water flux through the spac and these groups have similarities to nine groups previously identified for describing plant hydraulic failure and carbon limitations due to drought stress feng et al 2018 we choose e 0 and ψ g 50 as key representative variables to non dimensionalize units of m s 1 and mpa respectively because we aim to interpret coordination of climate and stomatal sensitivity versus other spac characteristics a different selection of variables and their combinations would result in less compact approximations of β as a function of s and π groups eqs 3 5 below we also note that as a result of the assumption that the daily water flux through the xylem must be transpired through stomata canopy conductance is a redundant variable and hence does not appear in π groups this does not imply that a π group describing canopy conductance would be unimportant rather this implies that the spac depends on coordination between stomatal and xylem traits and therefore we can adopt a more parsimonious description of the system without canopy conductance and representing atmospheric water demand via only e 0 further ψ g 50 is regarded as an outcome of a specific response to plant stress rather than a prescribed trait because as we will show we infer ψ g 50 values from data driven and optimality criteria 2 1 3 metrics of plant water uptake capacity we approximate eq 2 mathematically to express key characteristics of plant water uptake capacity analytically as a function of π groups to do so similarly to previous work manzoni et al 2014 we solve the spac eco physiological model eq 1 for three shape parameters of a piece wise linear function that downregulates transpiration due to soil water stress feddes et al 1978 laio et al 2001 3 β s π 0 s s w s s w s s w f ww s w s s f ww s s where fww is the ratio of the well watered rate of transpiration to e 0 s and sw are soil saturation thresholds below which transpiration is downregulated from its well watered rate and when transpiration ceases respectively by solving eq 1 under well watered conditions ψ s 0 and assuming soil to root conductance ksr is not limiting we obtain an expression for fww as a function of climate and eco physiological variables embedded in the π groups 4 f w w 1 1 2 π r 1 π f 2 π f 2 1 2 2 π f π r by solving eq 1 for ψ s at which any arbitrary transpiration rate t β e 0 is achieved we can express s as a function of β and π groups 5 s β ψ s β ψ s sat 1 b π t 2 β π s 1 4 β π s 2 π t 2 1 β β π f 1 1 β π r 1 1 b where b unitless is a soil pore size parameter for converting ψ s to s brooks and corey 1964 the soil saturation thresholds for the piece wise linear function eq 3 are then defined by setting β 0 95fww for s and β 0 05fww for sw in eq 5 while evaluating eq 5 with β in the interval 0 1 reproduces a sigmoidal response fig 1c through their dependence on π groups eq 4 and 5 fww s and sw account for stomatal and hydraulic traits plant size and density as well as soil and climate characteristics as such these combined parameters lead to a certain realized water uptake capacity that reflects limitations to plant water transport along the spac beyond soil water availability in the rooting zone i e s or ψ s we define the index σ unitless as the overall plant water uptake capacity relative to a hypothetical maximum corresponding to no hydraulic or stomatal limitation we calculate σ by integrating β eq 3 over soil saturation states between the hygroscopic point sh and field capacity sfc and normalizing by the same integral when transpiration is equal to e 0 for all soil saturation states 6 σ f w w s f c s s w 2 s f c s h the shape of β s π therefore summarizes complex spac eco physiological mechanisms including interactions with environmental conditions and represents water use strategies ranging from stress averse σ close to 0 to stress tolerant σ close to 1 this spectrum includes for example intensive water use when soil saturation is high fww close to 1 and s much lower than sfc leading to high σ conservative water use when soil saturation is high fww much lower than 1 s close to sfc leading to low σ sensitive water use when stomata rapidly close at high saturation states sw close to s leading to low σ or extensive water use with the ability to partially open stomata at low saturation states sw much lower than s leading to high σ these four plant water use strategy characteristics fww s sw σ describing the shape of β s π span multiple levels of abstraction that can be useful for varying levels of inquiry about plant water uptake capacity due to its definition as an integral σ summarizes plant water use strategies from stress averse to stress tolerant with some equifinality therefore nuanced strategies still need to be interpreted from the ecohydrological parameters fww s sw defining water uptake capacity along the full range of soil saturation states at an even finer level of detail the role of plant traits ψ g 50 ψ x 50 k x max rai on these strategies needs to be assessed via eco physiological tradeoffs reflected in the π groups our plant water use strategy metrics can also be interpreted along the iso to anisohydric continuum or hydroscape fu and meinzer 2019 meinzer et al 2016 for example for the same value of plant water uptake capacity σ isohydric behavior can be associated with relatively higher fww s and sw higher plant conductance but more stringent stomatal regulation while anisohydric behavior can be associated with relatively lower fww s and sw lower plant conductance and higher stomatal resistance to drying soil we also note that definitions of fww s and sw parameters which are a function of traits soil and climate variables underline the need for cautious interpretation of isohydricity indexes with a plant s environmental conditions feng et al 2019 kannenberg et al 2022 2 2 ecohydrological model and parsimonious quantification of plant water use performance the capacity of plants to take up water determined by π groups and based on the eco physiological model section 2 1 influences the soil water balance and occurrence of water stress resulting in varying performances depending on local soil and hydro climatic conditions to quantify links between plant water use strategies and water use performance we integrate our novel formulation of β s π eqs 3 5 in a soil water balance fig 1c d thus constructing our ecohydrological model the soil water balance accounts for stochastic rainfall characteristics as well as water balance components interacting with transpiration soil water evaporation canopy interception runoff and infiltration we then obtain growing season soil saturation probability distributions p s eq 8 from which we can directly assess long term average plant water uptake t eq 9 risks of water stress θ eq 11 and water use performance ε eq 12 while performance in this study is focused on water as a limiting factor there are further avenues to additionally account for light and nutrient limitations or atmospheric co2 effects in π groups through for example more complex definitions of potential atmospheric demand instead of e 0 used here priestley and taylor 1972 2 2 1 stochastic soil water balance we consider a bucket model for a homogenous soil column with a depth z m and porosity n unitless in which water fluxes are interpreted at the daily time scale this lumped approach employs scale effective parameters bassiouni et al 2020 2018 manzoni et al 2014 and resulting fluxes represent the individual or whole ecosystem water balance depending on the organizational scale at which the model and its parameters are interpreted we assume that the dynamics of z and rooting zone evapotranspiration dynamics are synchronized dong et al 2022 therefore modeled soil water dynamics are representative of the ecosystem even if the soil column depth prescribed by observation depths table s1 may not exactly comprise the whole rooting zone this assumption is justified by our focus on the temporal dynamics of evapotranspiration and their relation to soil saturation instead of total ecosystem evapotranspiration volume the daily soil water change is the difference between the rate of rainfall and the rate of soil water losses including surface runoff infiltration below depth z and evapotranspiration we treat rainfall as a censored poisson distribution characterized by a mean event depth α m day 1 frequency λ day 1 and canopy interception threshold δ m day 1 excess rainfall relative to available soil storage is converted to surface runoff according to a saturation excess mechanism the rate of infiltration is both a stochastic process controlled by rainfall and a state dependent process and the rate of evapotranspiration is a state dependent process dependent on saturation and vegetation caylor et al 2006 laio et al 2001 we approximate δ empirically multiplying lai by a characteristic amount of interception per unit leaf area hi 2 10 4 m day 1 bastiaanssen et al 2012 the mean frequency of rainfall reaching the soil under the canopy is thus reduced to λ λ e h i l a i α we assume that vegetation canopies exponentially reduce potential energy available for soil water evaporation due to shading according to beer s law φ e klai where k 1 2 is an extinction coefficient ensuring that potential soil water evaporation becomes 0 05e 0 for closed canopies and relations between lai and our modeled long term fraction of transpiration to total evaporation fig s1 reflects observed patterns wang et al 2014 wei et al 2017 following caylor et al 2006 we partition total potential soil water losses from evapotranspiration per unit ground area bound by e 0 into maximum soil water evaporation φe 0 plus maximum plant water uptake 1 φ e 0 as such the total rate of soil water losses is a continuous piece wise function of soil saturation including vertical drainage for states above sfc plant water uptake which decreases linearly from fww 1 φ e 0 for states above s to 0 at sw eq 3 and soil water evaporation which decreases linearly from φe 0 for states above sfc to 0 at sh the complete deterministic soil water loss function standardized by nz denoted by ρ s is 7 ρ s η e η t m e a s s fc 1 s fc s 1 η e s s h s w s h η t s s s fc η e s s h s fc s h η t s s w s s w s w s s η e s s h s fc s h s h s s w 0 0 s s h where η e φ e 0 n z η t f w w 1 φ e 0 n z a 2b 4 m k s s a t n z e a 1 s f c 1 the soil saturation probability density function p s for the homogenous soil column with maximum water storage nz can be derived analytically given this stochastic soil water balance under the assumption of statistical steady state during the growing season we can thus calculate p s directly for given soil properties n k s sat b sfc sh average growing season climate e 0 α and λ vegetation cover lai as well as plant water use strategies π groups the solution for p s given by caylor et al 2006 and recast for our model variant is 8 p s c e γ s ρ s s w s h κ s s h s w s h η t s fc s h η e s w s h ω η e η t s fc s h η e s s h η t s fc s h κ e δ s fc s 1 s w s h κ s s h s w s h η t s fc s h η e s w s h ω η e s s h η t s fc s h η e s s h η t s fc s h κ s s s fc s w s h κ s s h s w s h η t s s w s fc s h η e s s w s w s h ω s w s s s s h κ s h s s w 0 0 s s h where 1 γ α n z κ λ s f c s h η e ω λ s f c s h s s w η e s s w η t s f c s h δ λ l n ρ s η e η t a s s f c a m η e η t c is a constant to ensure that the integral of p s over 0 s 1 is equal to 1 finally we calculate the long term mean growing season water balance components including precipitation p α λ soil water evaporation e plant transpiration t and canopy interception i as 9 e φ e 0 s fc s h s s h s fc s h p s ds φ e 0 1 s fc p s ds 10 t 1 φ f ww e 0 s s w s s w s s w p s ds 1 φ f ww e 0 1 s p s ds 11 i α λ 1 e h i lai α where integrals on the right hand side of eqs 9 and 10 represent mean e and t under water limited and well watered conditions respectively differently from previous contributions this water balance accounts for plant behavior ranging from stress averse to stress tolerant via water use strategies as a function of π groups eq 4 for fww and eq 5 for s and sw 2 2 2 risk of plant water stress we use dynamic plant water stress θ proposed in porporato et al 2001 to quantify long term risk of water stress using the stochastic soil water balance this metric accounts for the impact of stress stomatal closure and its likelihood occurrence of soil saturation states below s which are quantified via long term mean static plant stress ζ unitless as well as the number n unitless and duration t days of soil saturation crossings of the s threshold during the growing season 12 θ min ζ k t t gs 1 n 1 where ζ s h s w p s d s s w s s s s s w p s d s with integrals representing mean ζ when soil saturation is below and above sw respectively and assuming that ζ above s is zero tgs is mean growing season length days t p s ρ s p s p s is the cumulative soil saturation probability density function n tgs t and k is an index that can be interpreted as the ζ a plant can experience during the duration tgs without suffering from permanent damage leading to θ 1 in the absence of specific information we prescribe a fixed value k 2 3 which ensures that θ 1 for all study sites this probabilistic formulation of plant water stress is heuristic but translates complex links between soil water deficit and loss of photosynthesis including both temporal and permanent physiological damage to provide a parsimonious but realistic measure of long term cost of water stress for plant productivity and links to water use efficiency porporato et al 2001 2 2 3 plant water use performance we define plant water use performance ε unitless as stress weighted transpiration normalized by water availability bassiouni et al 2020 caylor et al 2006 13 ε 1 θ t p this metric of plant water use performance represents the tradeoff between water uptake leading to carbon gains and growth represented by t p and risks of unfavorable water stressed conditions during which the water penalty of opening stomata to fix carbon is greater and leads to high costs of water use represented by 1 θ in other words long term transpiration is linked to plant productivity through 1 θ which is defined to capture long term water use efficiency porporato et al 2001 with this approach water use performance is evaluated without directly estimating photosynthesis moreover by quantifying performance relative to available water ε is also a measure of water productivity which is a meaningful measure for comparisons between ecosystems in different climates next we assume that plant traits adapt to maximize water use performance eq 13 this approach is similar to optimality criteria adopted in stomatal optimization theories mencuccini et al 2019 wang et al 2020 but now using our minimalist ecohydrological framework while there is no consensus on the most appropriate formulations of optimality criteria and constraints for different spatial temporal or organization scales bassiouni and vico 2021 sabot et al 2022 leveraging dynamic plant water stress θ allows for the optimality formulation to account for cumulative impacts of soil moisture deficits on net carbon gain as opposed to typically assumed instantaneous performance maximization feng et al 2022 lu et al 2020 2 3 framework application we first explore the role of the π groups theoretically using baseline parameter values for a temperate broadleaf forest table 1 as a sample ecosystem we then apply the framework at 40 selected ecosystems using prescribed site specific soil texture vegetation structure and climate parameters derived from data and metadata table s1 and inferring the four unknown plant traits ψ g 50 ψ x 50 k x max rai through model inversion to quantify associated π groups and the shape parameters for β s π rooting depth plays an integral role in defining plant water use strategies via both k sr max and the soil water balance however here we focus on variations of other eco physiological traits and constrain z to site specific values consistent with available soil moisture data specifically we prescribe z as 1 5 times the soil moisture measurement depth table s1 which generally corresponds to the average rooting depth in the studied biomes as such we limit our analysis to π groups in the eco physiological model defining the shape of β s π section 2 1 rather than the ecohydrological model section 2 2 π groups for the ecohydrological model have been previously defined and studied for the partitioning of the soil water balance e g feng et al 2012 porporato et al 2004 as well as in the context of optimal z across climatic gradients guswa 2010 namely e 0 α λ the aridity index and s f c s w n z α the soil water storage index 2 3 1 data we use daily observations and site characteristics from 40 sites table s1 in the fluxnet2015 dataset pastorello et al 2020 as well as satellite lai estimates myneni et al 2015 we select sites and quality check records to best meet soil water balance model assumptions and only analyze growing season data see methods s1 and table s1 for details about data and site selection the model requires rainfall net radiation and air temperature climate data inputs we evaluate model results against soil moisture observations as well as independent not used in parameter inference total evapotranspiration and gross primary productivity measured by eddy covariance 2 3 2 parameter inference and evaluation for each site we infer two sets of parameters with i a data driven criterion maximizing the goodness of fit between empirical derived from data and theoretical eq 8 soil saturation probability distributions p s and ii the ecohydrological optimality criterion maximizing plant water use performance ε eq 12 we adapt a bayesian inference algorithm from previous work bassiouni et al 2020 2018 to this study s improved soil water balance which explicitly partitions evapotranspiration and is eco physiologically constrained by plant traits represented in π groups see methods s2 for details about parameter inference we compare parameter sets as well as metrics of plant water uptake capacity and water use performance emerging from both criteria and hypothesize that ecohydrological optimality explains plant water use strategies encoded in soil moisture observations to evaluate the predictive skill of our modeling approach at each site we calculate the theoretical p s applying both the data driven and optimality based parameter sets we then quantify goodness of fit compared to the empirical p s derived from soil moisture time series using a quantile level nash sutcliffe efficiency nse 1 indicates a perfect model nse 0 indicates that the model has less predictive skill than mean s previous studies using this metric considered nse 0 unacceptable and nse 0 5 a good match bassiouni et al 2020 2018 as an additional and independent measure of predictive skill we compare optimality based model results to record averaged growing season total evapotranspiration and gross primary productivity across the selected 40 ecosystems 3 results 3 1 plant water flux control is the primary axis of variation in water use strategies plant traits individually alter π groups and consequently plant water use strategies reflected in the shape of β s π however multiple combinations of individual traits can produce π groups of the same value and therefore lead to the same behavior in terms of plant water uptake capacity fww s sw and σ eqs 3 6 and same ecohydrological outcomes in terms of plant water use performance ε eq 13 further combinations of different π groups can also lead to similar results because π groups interact eqs 4 and 5 to determine water flux through the spac reflected in the shape of β s π plant water flux control π f and hydraulic risk tolerance π r affect all three β s π shape parameters while soil suitability π s and soil root water transport capacity π t only affect s and sw and do not influence fww eqs 4 and 5 we summarize and illustrate the role of the π groups theoretically figs 2 5 and figs s2 s5 varying baseline parameter values table 1 stomatal sensitivity ψ g 50 affects fww s sw and hence the shape of β s π fig 2a through its appearance in all four π groups fig 2e with more sensitive stomatal control less negative ψ g 50 and all else being equal fww decreases and s and sw increase towards wetter states consequently the overall index of plant water uptake capacity decreases leading to increasingly stress averse strategies decreasing σ moving from purple to yellow curves in fig 2b with decreasing σ and progressively downregulated transpiration soil saturation probability distributions p s shift to wetter states because plants conserve more water fig 2c additionally plant water use performance ε increases to a maximum and then declines as stomatal sensitivity increases fig 2d because stress tolerant plants very negative ψ g 50 are more likely to be water stressed due to less constrained and excessive water use while overly conservative strategies do not use available water effectively the other key spac variables can counterbalance effects of ψ g 50 in each individual π group leading to combinations of π groups that determine a wider spectrum of water uptake capacity than those exemplified in fig 2 variables that interact with ψ g 50 include xylem vulnerability ψ x 50 in π r plant size and hydraulic architecture that define k p max lai hc k x max in π f soil and root properties that define k sr max k s sat rai in π t and soil water holding capacity ψ s sat in π s however the extent to which water use strategies deviate from the general pattern imposed by ψ g 50 alone fig 2 is constrained by ranges of trait values documented in different biomes e g manzoni et al 2013a certain combinations of π groups and water use strategies can result from a large diversity of co existing traits while other strategies can only occur for more specific trait combinations due to constraints of atmospheric water demand e 0 and soil texture while soil and root properties can influence the shape of β s π we conclude that they do not considerably counterbalance effects of aboveground plant traits this is because differences in soil texture and root area index summarized in π s and π t result into negligible variations in relative plant water uptake capacity fig s2 s5 note that here we explore relative plant water uptake capacity for a given rooting zone to isolate from the strong controls of soil texture and rooting depth on available soil water through interacting with the total water balance decreasing plant water flux control and all else being equal decreasing π f moving from yellow to purple curves in fig 3 results in more stress tolerant strategies increasing σ by both increasing fww which enhances water uptake in wetter states and decreasing s and s w which increases water uptake in dry states for set plant traits π f decreases when atmospheric water demand e 0 decreases as a result of lower e 0 plant water transport becomes less limiting and σ accordingly increases increasing plant hydraulic risk tolerance and all else being equal increasing π r fig 4 decreases s and sw as well as fww which leads to more conservative water uptake at wetter states and little change to σ compared to decreasing π f hydraulic risk tolerance π r modulates the effect of plant water flux control because π r influences the sensitivity of the relation between π f and σ fig 5 for a fixed ψ g 50 but varying ψ x 50 and k p max the capacity to take up soil water decreases more steeply with increasing π f at high compared to low π r moving from purple to yellow curves in fig 5a because increasing π f also lowers water stress plant water use performance ε peaks at intermediate values of π f and the π f value at the peak increases with decreasing π r fig 5a this means that at low π f the value of π r has little effect on water use performance and that the combination of both high π f and π r leads to lowest performance high risk tolerance is thus not beneficial in combination with high plant limitations on water flux low k p max ψ g 50 increases π f or high atmospheric water demand high e 0 increases π f in summary plant water use strategies represented by the shape of β s π are primarily defined by plant water flux control π f therefore also influencing plant water uptake capacity and water use performance as well as their sensitivity to climate variability plant hydraulic risk tolerance π r has a smaller influence and interacts with water flux control especially when plant water transport is limiting high π f risk aversion versus tolerance low to high π r only affects water use performance when atmospheric water demand is much greater than plant water transport capacity higher values of π f and depends directly on climate in the definition of π f and indirectly on the timing and amount of rainfall interacting with π f via β s π in the water balance importantly the theoretical patterns suggest an optimal range of traits that maximize plant water use performance and not all possible combinations of plant traits and π groups may be viable depending on the degree of climate variability 3 2 optimal water use strategies maximize long term mean transpiration weighted by risks of water stress building on the theoretical results we apply our framework across the selected 40 ecosystems to test the ecohydrological optimality criterion maximizing eq 13 the median nash sutcliffe efficiency nse between empirical and theoretical soil saturation probability distributions p s is 0 9 using parameters that maximize the fit with soil moisture observations data driven criterion and 0 7 using parameters that maximize plant water use performance ε optimality criterion fig 6 a applying the model using the data driven and optimality based parameters explains 95 and 83 respectively of the variability in long term mean growing season soil saturation observed across the 40 ecosystems fig 6b therefore comparing predictive model skill using the optimality criterion with independent theoretically estimated parameters and the data driven criterion with empirically fitted parameters lends support to our parsimonious approach the posed metric of stress weighted transpiration ε eq 13 using optimality based parameters also explained 55 of the variability in long term average growing season gross primary productivity across the 40 ecosystems fig 7 a further the ecohydrological model using optimality based parameters explains 67 of the variability in long term average growing season total evapotranspiration fig 7b and reproduces patterns in long term water balance partitioning along the aridity axis fig 8 a as well as a mesic maximum in the transpiration fraction fig 8b consistent with other empirical and modeling studies budyko 1974 good et al 2017 paschalis et al 2018 porporato et al 2004 our comparison of data driven and optimality based parameter estimates fig 9 indicates that the shape of β s that best captures observed soil moisture variability is also ecohydrologically optimal in terms of maximizing water use performance ε eq 13 pearson s correlations between data driven and optimality based parameter estimates range from 0 9 for fww sw and π f to 0 41 for π r the biases between data driven and optimality based parameter estimates range from 5 for fww and π f to 32 for π r fig 9 the high correlations and low bias between data driven and optimality based estimates suggest that the shape of β s is well constrained despite some uncertainty regarding specific nuances in plant water use strategies for example the degree of plant hydraulic risk π r is not critical to define daily plant water uptake capacity in most biomes our findings therefore support the hypothesis that plant traits are adapted to growing season environmental conditions and maximize water use performance in terms of balancing long term mean transpiration and risks of water stress ε eq 13 the root mean square difference between water use performance ε resulting from the best fit models and maximum ε from the optimality based models is 0 08 and the bias indicates that ecosystems as characterized by soil moisture observations are on average within 9 of their maximum theoretical water use performance water use performance based only on static stress ζ leads to much greater differences between data driven and optimality based parameters and a bias towards more stress tolerant strategies fig s6 this demonstrates the importance of using of dynamic stress θ when defining water use performance and the need to account for the number and duration of periods with soil saturation below the threshold s during the growing season the comparison between ζ and θ also underlines that both the amount and timing of rainfall affect the long term cost of water use due to cumulative stress despite the coordination expected between water flux control π f and hydraulic risk tolerance π r given their dependence on stomatal sensitivity ψ g 50 in the analytical model pearson s correlation between optimal π f and π r values is weak fig s7 r 0 1 this means that these two π groups can be useful targets for parameter inference and represent two complementary aspects of water use strategies however π r is more difficult to infer from data especially in humid conditions and the goodness of fit between data driven and optimality based π r was poor fig 9e this is expected from the model theoretical behavior fig 5 showing that plant risk tolerance summarized by π r has a minor effect on plant water uptake capacity and performance when atmospheric water demand is lower than plant water transport capacity low π f and the negative correlation confirms that having both high π f and high π r is not ecohydrologically successful the inference algorithm converges to robust estimates of the lumped parameters fww s sw despite higher uncertainty in estimates of individual traits mean coefficient of variation of posteriori parameter estimates 0 05 versus between 0 1 and 1 therefore lumped parameters and π groups describing the spac rather than individual traits provide a more constrained and robust definition of β s π and the associated ecohydrological functions at the ecosystem level the water use strategies emerging from the optimal π group values do not vary consistently between plant functional types under the same growing season conditions both needle leaf forests and grasslands can have the same π group values resulting from different possible trait combinations the variability in water use strategies are primarily explained by aridity e 0 p fig 9 for example the most stress avoidant strategies high π f low π r low σ are found in mediterranean climates including needleleaf broadleaf and savanna ecosystems statistically significant correlation coefficients between e 0 p and σ π f and π r are 0 80 0 85 0 86 0 92 and 0 35 0 33 respectively for data driven and optimality based estimates table 3 however σ is more correlated with e 0 than rainfall characteristics π f is more correlated with rainfall frequency and π r is more correlated with rainfall intensity table 3 4 discussion we analyze soil moisture observations a key ecosystem variable to evaluate whether plants achieve efficient soil water use by coordinating spac biotic components as previously hypothesized manzoni et al 2013b mencuccini et al 2015 prentice et al 2014 reich 2014 we seek to improve understanding of ecosystem climate interactions beyond previous studies that explain variations in individual plant functional traits with average long term climate characteristics such as mean annual precipitation and temperature choat et al 2012 as well as improve empirical quantification of variability in ecosystem scale water stress responses with uncertain eco physiological underpinnings bassiouni et al 2020 fu et al 2022 yanlan liu et al 2021 we therefore take a holistic view and explain variations in plant water use strategies using non dimensional π groups within an ecohydrological model this framework combines plant traits soil and climatic conditions to link strategies to a dynamic metric of plant water use performance that accounts for feedbacks due to risk of plant water stress figs 2 5 we find that individual traits do not determine optimal plant water use strategies and water use performance because various combinations of trait values lead to similar ecohydrological outcomes importantly parameters defining plant water use strategies that maximize water use performance also capture temporal variability in soil moisture within ecosystems p s and spatial variability in long term growing season ecohydrological fluxes across wet to arid ecosystems figs 6 7 the ecohydrologically optimal plant water use strategies point to coordination in plant traits to meet atmospheric water demand and stochastic water availability that influence stress risk and cumulative drought impacts despite its parsimony this tractable quantification of plant water use strategies and ecohydrological performance offers promising avenues to parameterize and diagnose plant responses to water limitations under climate change further alternative optimality and coordination hypotheses can be tested by revisiting our framework with different or more complex performance criteria and π groups incorporating additional processes and tradeoffs 4 1 ecohydrological coordination reflected in π groups simplifies the description of plant water uptake non dimensional π groups summarizing key eco physiological tradeoffs capture simultaneously biotic and abiotic controls on plant water use strategies in a tractable model leading to an effective but parsimonious description of ecosystem climate interactions we focus on the shape of the relation between soil moisture and transpiration relative to potential atmospheric water demand β s π and identify non dimensional axes of variation that are not directly apparent when looking at individual traits due to covariations among plant traits and environmental conditions in which plants grow the dominant axis capturing variations in water use strategies is the plant water flux control π f which represents the ratio of atmospheric water demand over plant controlled water supply to the leaves the dominance of π f points to the importance of combined climatic and plant characteristics in defining plant water use strategy the plant risk tolerance axis π r capturing coordination of hydraulic and stomatal traits within a plant and contrasting stomatal versus xylem sensitivity to water status becomes influential when plant water transport is most limiting high π f in other words π f mainly drives variability in plant water uptake capacity σ and π r regulates nuances in the sensitivity of σ to variability in π f due to changes in atmospheric water demand e 0 or plant size and hydraulic architecture k p max the groups describing soil suitability π s and soil root transport capacity π t were less influential for a given rooting depth they had no effect on soil water uptake in well watered conditions fww and only negligible impact on thresholds of soil water uptake sw and s we demonstrate that π groups explain stress responses in a wide range of ecosystems thus expanding on a previous dimensional analysis of plant drought responses feng et al 2018 and taking the concept a step further by incorporating π groups in a modeling framework to improve understanding of the influence of plant traits in ecosystem climate interactions the two most influential axes represented by π f and π r are consistent with the fast slow plant economics spectrum reich 2014 slow trait strategies are associated with stress avoidance due to limited plant water transport high π f and or risk avoidance low π r however π f combines eco physiological and climatic variables leading to a generalized and more meaningful approach for capturing variations at ecosystem levels compared to existing metrics for water use strategies based solely on traits skelton et al 2015 π f is also related to sources of variation of previously identified major axes of ecosystem function in particular water use efficiency derived from exploratory data analyses díaz et al 2016 migliavacca et al 2021 the added benefit is that π groups have stronger mechanistic underpinnings and lead to a more transferrable and generalizable approach furthermore π groups combine different traits and reveal their coordination a single π group value can represent a wide range of possible individual traits characterizing a diversity of co existing species in an ecosystem that lead to similar long term water use performance the relation between water balance and π groups rather than single parameters has a practical implication because we show that calibrating traits in spac models will inevitably lead to multiple solutions our approach thus provides new avenues to reduce the complexity of quantifying ecosystem function and to increase model robustness prentice et al 2015 by focusing on π groups that embed ecologically meaningful mechanisms instead of individual parameters 4 2 ecohydrological optimality explains plant water use strategies beyond summarizing the spac in a small number of non dimensional groups our parsimonious approach predicts ecologically successful water use strategies optimality based estimates that are consistent with the long term water balance spanning wet to arid climates data driven estimates fig 9 as such this approach links and generalizes previous data driven bassiouni et al 2020 and theoretical studies feng et al 2018 manzoni et al 2014 optimal combinations of π groups defining β s explain observed soil moisture variability p s and encode combinations of plant traits that are most effective at using limited water resources accounting for the cost of water stress as captured by the water use performance ε this implies that at the ecosystem level plants are adapted to growing season conditions to maximize water use performance as a result our framework provides a method to understand and parameterize the sensitivity of transpiration to soil moisture and potential atmospheric demand based on few easily available environmental variables instead of prescribing or calibrating optimality costs or parameters as commonly done when modeling stomatal conductance mencuccini et al 2019 aridity primarily influences optimal water use strategies although these strategies vary among studied ecosystems and within plant functional types generally variability in metrics of plant water uptake capacity fww s sw and σ across biome and along the aridity axis are consistent with patterns and findings from previous empirical studies bassiouni et al 2020 fu et al 2022 further the theoretical framework optimal π f significantly increases with decreasing rainfall frequency water demand becomes more important during the longer dry spells while optimal π r increases with increasing rainfall intensity water stress is more acceptable in wetter climates our findings indicate that both the timing and amount of rainfall are key to quantify risks of water stress and resulting water use performance importantly the improved match between data driven and optimality based parameters using the dynamic water stress θ fig 9 versus static water stress ζ fig s6 points to long term eco evolutionary adaptation to stochastic water availability that influences the long term cost of water use and the need to avoid both temporal and irreversible impacts on productivity our results therefore provide novel evidence that optimality inferred from long term risks rather than instantaneous impacts feng et al 2022 lu et al 2020 is more consistent with ecohydrological data while most parameters estimated from the data and theory based approaches are very well correlated the correlations for π r are poor fig 9e this does not necessarily undermine the validity of the ecohydrological optimality criteria and the importance of accounting for risks of water stress to quantify plant water uptake capacity and its sensitivity to environmental conditions rather it points to some limitations of the long term water balance framework and daily data in being able to disentangle the complexity of plant hydraulic risk tolerance especially in humid environments optimal water use strategies explain fundamental patterns of rainfall partitioning into evapotranspiration and percolation or runoff and how the water balance is linked to plant drought responses ranging from stress tolerant to stress averse fig 8 furthermore transpiration weighted by water stress risks captures spatial variability in gross primary productivity and despite its parsimony proves a useful performance metric contrasting costs and benefits of water uptake under a wide variety of soil and climatic conditions fig 7a our optimality criteria to identify π groups complements previous ecohydrological models under stochastic rainfall and findings inferring grass tree distributions caylor et al 2006 optimal rooting depths guswa 2010 2008 coordination of stomatal and xylem vulnerability manzoni et al 2014 and stomatal responses lu et al 2016 different from approaches optimizing single traits quantifying π groups provides a more holistic view of eco evolutionary outcomes that accounts for expected co variations across plant organs and between traits and the environment furthermore while our framework is focused here on water use strategies in terms of the shape of β s it can be extended to also assess optimal rooting depths and further improve the inference of tradeoffs between eco physiological traits rooting strategies and vegetation distribution from ecosystem scale data yaling liu et al 2021 stocker et al 2023 that emerge as adaptations to water availability given known long term climate characteristics π groups summarize ranges of possible trait combinations that can achieve similar functions and co exist in an ecosystem the framework offers further avenues to assess the evolutionary stability of resulting water use strategies therefore π groups can be useful to explain relations between trait diversity and local water availability trugman et al 2020 the proposed optimality based inference of water use strategies provides opportunities to investigate broad spatial patterns of optimal π groups how they relate to distributions of global ecosystems and potential vulnerability or adaptation to climate change especially in ecosystems most vulnerable to increased water limitations 4 3 tractable quantification of plant water use strategies leveraging dimensional analysis and optimality theory we address the need for parsimonious and more transferable descriptions of water use strategies to bridge the gap between top down data driven approaches and bottom up trait based approaches scaling and aggregating individual plant traits to describe ecosystem level transpiration with a bottom up approach is complex and uncertain because tissue level traits have nonlinear dependencies on plant size and ecological performance and survival mechanisms shape community composition enquist et al 2015 mencuccini et al 2019 indirect inference approaches using flux tower and satellite data extend the representation of ecohydrological processes beyond plant level measurements and provide ecosystem scale parameters defining water use strategies globally bassiouni et al 2020 dralle et al 2020 fu et al 2022 konings and gentine 2017 liu et al 2020 yaling liu et al 2021 yanlan liu et al 2021 stocker et al 2023 however results from inverse modeling can be conflated by their many assumptions and are still constrained by the coverage uncertainty and quality of numerous data inputs we therefore take a step forward and propose a complementary dimensionless optimality framework to infer water use strategies using minimal but realistic assumptions grounded in eco physiological theory and requiring few readily available parameters soil texture mean growing season atmospheric water demand rainfall characteristics and leaf area index non dimensional π groups summarize water use strategies by collapsing variability in traits into a minimal number of parameters reducing the complexity of representing detailed spac hydraulics at the ecosystem level two non dimensional groups plant water flux control π f and hydraulic risk tolerance π r are key in determining the functional relation between transpiration soil moisture and atmospheric water demand this relation β s π uniquely determines our metrics of plant water uptake capacity fww s sw and σ therefore despite uncertainty in individual trait estimates metrics of plant water uptake capacity are well constrained robustly estimated and accurately describe water use strategies adapted to the given soil and climate the simplified eco physiological model explains key ecological information encoded in hydrological observations and complements the data driven approach parametrizing existing empirical relations such as β s π using optimality principles and π groups offers a promising avenue for next generation models to incorporate ecological mechanisms and principles of community ecology harrison et al 2021 scheiter et al 2013 without sacrificing model robustness or increasing complexity as advocated by prentice et al 2015 ecosystem scale relations between transpiration and soil moisture can potentially preserve their practical and parsimonious forms while approaching predictive capacity of full hydraulic models sloan et al 2021 optimality based approaches such as the one proposed here can also provide useful constraints to reduce the uncertainty and enhance the interpretation of future data driven including satellite based estimates of ecosystem functioning and sensitivity to climate 5 summary and conclusions improved characterization of trait based water use strategies is necessary as models shift from using coarse plant functional types toward incorporating plant traits to better represent vegetation climate feedbacks and ecological mechanisms in a changing climate matheny et al 2017 characterizing water use strategies remains uncertain especially when aiming at effectively capturing ecosystem scale water fluxes this uncertainty is both conceptual due to a lack of theoretical frameworks defining these strategies based on ecologically meaningful outcomes and operational because eco physiological models are complex and difficult to parameterize mencuccini et al 2019 we reduce the dimensionality of the problem by modeling long term average dynamics of water fluxes through the spac using non dimensional groups we therefore define water use strategies without specifying individual traits while still accounting for key eco physiological mechanisms these π groups combine traits with environmental variables thereby identifying fundamental axes of variation along which diverse trait environment combinations can lead to similar outcomes in terms of water uptake capacity and water use performance as such our approach generalizes current metrics for water use strategies based solely on traits and improve our ability to effectively capture ecosystem scale water fluxes furthermore a primary π group characterizing synchronization of plant water transport and atmospheric water demand defines water use strategies parameter estimates capturing observed soil moisture variability are consistent with those maximizing transpiration weighted by risks of water stress this result supports ecohydrological optimality as a parsimonious guiding principle to assess water use strategies we can thus infer water use strategies that are consistent with those encoded in soil moisture observations and with more mechanistic underpinnings compared to exploratory data analysis using π groups to link vegetation soil and climatic conditions to optimal plant water use performance we propose and validate a minimalist but transferable approach describing ecohydrological processes across climates and independently of scale author contributions mb sm and gv designed the research mb performed the analysis and wrote the paper sm and gv contributed to interpreting results editing and revising the paper data availability statement code to reproduce the analysis in this study is available at https doi org 10 5281 zenodo 5518546 and all necessary datasets are available at https fluxnet org data fluxnet2015 dataset and https lpdaac usgs gov products mcd15a3hv006 declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we thank xue feng trevor keenan benjamin blonder and several anonymous reviewers for feedback on earlier versions of the manuscript mb thanks stephen good and chad higgins for discussions that inspired the study mb and gv received funding from the european commission and swedish research council for sustainable development formas grant 2018 02787 in the frame of the international consortium iaqueduct financed under the 2018 joint call of the waterworks2017 era net cofund gv was also supported by formas grant 2018 01820 mb used computational resources provided by the swedish national infrastructure for computing at uppmax partially funded by the swedish research council grant 2018 05973 this work used data acquired and shared by the fluxnet community supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2023 104405 appendix supplementary materials supporting information image application 1 
