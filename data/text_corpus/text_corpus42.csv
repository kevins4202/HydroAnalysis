index,text
210,watershed delineation and flow direction representation are the foundations of streamflow routing in spatially distributed hydrologic modeling a recent study showed that hexagon based watershed discretization has several advantages compared to the traditional cartesian latitude longitude discretization such as uniform connectivity and compatibility with other earth system model components based on unstructured mesh systems e g oceanic models despite these advantages hexagon based discretization has not been widely adopted by the current generation of hydrologic models one major reason is that there is no existing model that can delineate hexagon based watersheds while maintaining accurate representations of flow direction across various spatial resolutions in this study we explored approaches such as spatial resampling and hybrid breaching filling stream burning techniques to improve watershed delineation and flow direction representation using a newly developed hexagonal mesh watershed delineation model hexwatershed we applied these improvements to the columbia river basin and performed 16 simulations with different configurations the results show that 1 spatial resampling modulates flow direction around headwaters and provides an opportunity to extract subgrid information and 2 stream burning corrects the flow directions in mountainous areas with complex terrain features keywords watershed delineation unstructured mesh stream burning flow routing 1 introduction flow direction and watershed delineation are the foundations of runoff and streamflow routing in spatially distributed hydrologic modeling neitsch et al 2011 li et al 2013 markstrom et al 2015 liao and zhuang 2017 liao et al 2019 however one must first perform spatial discretization to calculate flow directions to date most existing flow direction methods have been developed based on cartesian grid discretization freeman 1991 quinn et al 1991 holmgren 1994 tarboton 1997 pilesjo et al 1998 orlandini et al 2003 seibert and mcglynn 2007 orlandini and moretti 2009 peckham 2013 wilson et al 2008 they are thus subject to several limitations liao et al 2020 1 the cartesian grid cannot represent adjacency uniformly in a cartesian system each rectangular cell has two types of neighbors direct face and diagonal vertex neighbors as a result hydrologic models need to consider the differences in the travel path of these types of neighbors fig 1 2 because of the diagonal travel path in the d8 scheme esri 2020 an island may be created and cause numerical issues in a coupled surface subsurface hydrology model fig 1 fan et al 2007 camporese et al 2010 3 the cartesian grid cannot provide spherical coverage without significant spatial distortions especially at high latitude regions 4 earth system model components e g atmospheric and oceanic models commonly use sophisticated grid structures cubed sphere icosahedron unstructured mesh to address the convergence of meridians toward the poles because of that cartesian grid based hydrologic models cannot be coupled to these components seamlessly and often require a spatial interpolation for flux exchange in contrast spatial interpolation will be significantly reduced or removed in a unified mesh framework the use of fully unstructured model components e g the model for prediction across scales mpas ringler et al 2013 skamarock et al 2012 and the finite volume sea ice ocean model fesom danilov et al 2017 is an area of growing interest in coupled earth system modeling triangular irregular network tin based methods are also very popular due to the advantages of tin mesh discretization tin can capture terrain variation with fewer samples on the digital elevation model dem than traditional mesh at higher resolution tin can also resolve the spherical coverage limitation however tin based methods are still subject to other limitations 1 in a tin mesh each triangle still has two types of neighbors face neighbors and vertex neighbors section 6 1 figure s1 most tin based hydrologic models use face edge for flux exchange and represent the stream network using tin edges ivanov et al 2004a b paniconi and putti 2015 marsh et al 2020 2 tin is commonly adopted in regional hydrologic models without depression filling and stream burning although it can be extrapolated to a global scale it will not perform well without these capabilities because of the scale differences between mesh resolution and river networks davies and bell 2009 3 although regional scale oceanic models use triangle mesh in the finite volume method fvm or finite element method fem global scale oceanic models also use hexagonal like c grids to address issues including the horizontal divergence oscillations on unstructured triangular c grids thuburn et al 2009 weller et al 2012 wolfram and fringer 2013 therefore the different mesh systems must still be resolved hexagon mesh based discretization can resolve the aforementioned limitations based on its geometrical properties 1 it has only one type of neighbor i e face neighbor 2 because of the uniform face connectivity it directly eliminates the island effect 3 it can cover spheres with flexibility similar to tin with some relaxation a hexagon mesh can be turned into a fully unstructured variable resolution mesh 4 a hydrologic model based on the hexagon mesh can be seamlessly coupled with an oceanic model as a result it can be used to produce high quality flow directions especially for coupled land river and ocean modeling liao et al 2020 despite these advantages hexagon mesh based flow directions have not been widely adopted by current hydrologic models one major reason is the limited access to models that can delineate watersheds on hexagon mesh while maintaining accurate flow directions at various spatial resolutions as the first step in this direction we developed a hexagon mesh based watershed delineation model hexwatershed 1 0 which has shown great potential in improving stream network representations liao et al 2020 however challenges still remain in applying it to the current generation of hydrologic models such as accurately delineating watersheds and stream networks at relatively coarse spatial resolution the performance of watershed delineation tends to decrease for any type of mesh as spatial resolution decreases goulden et al 2014 buakhao and kangrang 2016 liao et al 2020 fundamentally poor representation of terrain elevation dem in coarse spatial resolutions leads to poor representation of the flow direction and incorrect stream networks due to the resolution mismatch to date there are several approaches to mitigate this issue in the geographic information system gis and hydrology communities these approaches can be used either individually or in conjunction with each other the first approach involves the use of advanced spatial resampling methods to improve dem representation studied extensively in the gis literature weber and englund 1992 longley et al 1999 arun 2013 the second approach uses advanced data structures to improve dem quality for example tin based dems have been widely used because they can follow terrain with variable spatial resolutions providing a good balance between spatial resolution and performance francipane et al 2012 the third approach is stream burning a common practice in hydrology for adjusting surface elevation near stream channels so that water always converges into observed stream channels hellweger and maidment 2005 lindsay 2016 finally some studies have attempted to define coarse spatial resolution flow direction using fine scale hydrography datasets wu et al 2011 yamazaki et al 2009 in addition flow direction determination issues can be exacerbated by processes in which depression filling algorithms are used to remove local depressions within a dem which would otherwise trap water this approach is exemplified by the priority flood algorithm which is widely used in many hydrological applications barnes et al 2014 liao et al 2020 in practice the foregoing approaches are often used together to best represent watershed and stream networks in cartesian grid systems winchell et al 2007 lidberg et al 2017 however the quality of the final outputs depends on many factors including the order in which the operations are conducted esri water resources team 2011 to date less attention has been paid to hexagon mesh based watershed delineation models and their corresponding stream network representations especially when used at coarse spatial resolutions in this study we introduce hexwatershed 2 0 which incorporates the above mentioned techniques to improve upon hexwatershed 1 0 we then compare the results from hexwatershed 1 0 2 0 and a cartesian grid based flow direction model i e the dominant river tracing drt model wu et al 2011 in the columbia river basin last we discuss the limitations of hexwatershed 2 0 and the next steps to continue improving model performance 2 methods 2 1 hexwatershed 1 0 the stream burning feature is not available in hexwatershed 1 0 and the nearest neighbor resampling method was used to assign the elevation of each hexagon from the high spatial resolution dem yellow dot in fig 2 in detail the model obtains elevation in the following steps 1 obtain the center location of each mesh cell 2 calculate the image coordinates row and column index from the dem data based on the location 3 read the elevation value using the index the nearest neighbor resampling method is the easiest and most straightforward method but may introduce large bias in areas with large elevation variations 2 2 new features in hexwatershed 2 0 2 2 1 zonal mean spatial resampling in hexwatershed 2 0 we provided an additional resampling method the zonal mean resampling method to improve elevation representation the zonal mean elevation of a mesh cell is estimated with high resolution dem see an example in fig 2 to guarantee there are enough high resolution dem values within each hexagon the ratio of resolutions between the target hexagon mesh and dem should be larger than 3 the definition of hexagon mesh resolution is provided in section 3 2 this process was implemented using the geospatial data abstraction library gdal to identify all the high resolution dem cells inside a given coarse resolution cell gdal ogr 2019 the zonal mean resampling approach also provides the capability to calculate the elevation profile and variations within each polygon mesh cell important information required by earth system models esms li et al 2013 2 2 2 stream burning we developed a stream burning algorithm based on several earlier studies lindsay 2016 a stream burning also often referred to as dem reconditioning is a technique to manipulate flow direction by lowering the elevations within and near the stream channels so that water always flows into prescribed channels a longstanding challenge in watershed delineation models is that depression filling and stream burning may interfere with each other because both algorithms modify the surface elevations lidberg et al 2017 to address this in hexwatershed 2 0 we developed a hybrid algorithm that combines depression filling and stream burning specifically stream burning was implemented within the priority flood algorithm seamlessly in a way that elevation will be modified only once priority flood is an efficient algorithm that fills dem depressions by sequentially flooding the domain from a boundary inward to adjust elevations to assure surface drainage barnes et al 2014 to further simplify the process the stream burning algorithm only modifies surface elevations in the immediate riparian zone which is a single mesh cell buffer zone on both sides of the stream channels the supplementary information provides more details section 6 3 after obtaining all the necessary information dem hexagon mesh with stream tag etc the modified stream burning priority flood algorithm operates via the following steps 1 define the initial priority flood queue as the domain boundary 2 find the node with the lowest mesh cell elevation in the priority flood queue 3 check whether this node is a stream mesh cell or not if it is a stream mesh cell find its upstream mesh cells and modify stream elevation if the upstream elevation is lower or equal then go to step 3a if it is not a stream mesh cell process as a normal priority flood node then go to step 3b a adjust node elevations in stream mesh cell buffer zones b adjust node elevations if they are lower than the center node 4 mark a mesh cell as processed if its elevation is visited 5 push out processed nodes and push their neighbors into the priority flood queue 6 go to step 2 unless the priority flood queue is empty the priority flood algorithm liao et al 2020 and additional stream burning algorithm are explained and illustrated in our earlier study as well as figs 3 and 4 unlike the original priority flood algorithm in hexwatershed 1 0 which only increases the elevation upstream when needed the modified stream burning priority flood algorithm does both breaching and filling when modifying stream and land elevations figs 4d and 5 this strategy was developed to minimize modification to the land mesh cell surface elevations lindsay 2016 a user provided threshold parameter is employed to control the breaching and filling options in traditional stream burning the stream mesh cell elevation is decreased by a threshold value such as 100 m serving as a large drop to enforce flow direction in hexwatershed 2 0 we only modify the outlet elevation and use a threshold value like 10 m to adjust stream mesh cell elevation from outlet to headwater recursively in order to generate a smooth gradient we enforce the max drop between neighboring upstream and downstream mesh cells for example if the elevation differences between upstream and downstream exceed 10 m the upstream elevation is lowered the stream burning algorithm can be turned on or off through newly added model configurations section 6 2 table s1 addition capabilities were also added to support advanced data management and visualization lorensen 2020 section 6 4 and 6 5 hexwatershed 2 0 also supports multiple flow directions as a result the total number of upslope and downslope mesh cells is a constant of 6 the downslope flow direction with the steepest slope is defined as the dominant flow direction by default both stream segment indices and order strahler were calculated using the method introduced in our earlier study usgs 2013 liao et al 2020 the stream segment is defined as an individual stream channel connecting either headwater outlet with its immediate confluence or between two confluences each segment is assigned a unique id ascending from headwater to outlet 3 application 3 1 study area to test the performance of hexwatershed 2 0 we applied the model to the columbia river basin crb crb is the drainage basin of the columbia river in the pacific northwest region of north america the drainage area of the crb is approximately 6 7 1 0 5 km 2 based on the watershed boundary dataset wbd usda nrcs 2017 its surface elevation ranges from 40 m to more than 4000 m above north american vertical datum of 1988 navd 88 it contains both relatively high and low surface slopes in different areas fig 6 the largest tributary of the columbia river the snake river flows from the southeast towards the west and joins the columbia river at the center of the basin 3 2 data we collected raster dem from the united states national elevation dataset ned and canada natural resources 90 m resolution 15000 16600 gesch et al 2002 nrc 2015 we also obtained the stream networks and watershed boundary from the united states national hydrography dataset nhd and watershed boundary dataset wbd usgs 2013 the hexagon mesh can be generated using the qgis mmqgis tool minn 2018 or a python script in the following steps 1 retrieve the spatial reference map projection and extent of the dem 2 set the lower left corner as the origin 3 calculate the number of rows and columns based on the desired resolution and spatial extent 4 calculate the vertex coordinates for each hexagon 5 export the hexagons using the same spatial reference to maintain consistency between different meshes we define the hexagon mesh resolution r h e x using the equivalent resolution which is the root square of its area eq 1 1 r h e x 3 3 2 l 2 where l is hexagon mesh cell edge length km additionally we tagged high order streams strahler stream order higher than 7 into the mesh using the qgis intersection tool detailed instructions for input data preparation are provided in the supplementary information section 6 6 all input information is specified within the model configuration file table s1 3 3 model setup updated model configurations including parameters for the stream burning feature are listed in table s1 to evaluate the sensitivity of hexwatershed 2 0 to spatial resolution and new features we ran the model with different configurations with case indices used for illustrations table 1 these resolutions were selected to match up with a flow direction dataset introduced in section 4 wu et al 2012 3 4 results and analysis similar to version 1 0 hexwatershed 2 0 calculates most watershed delineation variables flow direction flow accumulation river network etc although the new algorithms affect numerous results tied to these variables we only present flow direction and stream networks as they are often used in hydrologic models graphical results with the same index layout are presented in table 1 additional information is provided in the supplementary information section 6 7 and 6 8 to maintain consistency we only present final results that belong to the delineated watershed for example if the modeled flow direction is not within the delineated watershed it is excluded even though it lies within the wbd based watershed boundary case 3 is such an example nhd flowlines are used to evaluate and compare both flow direction and stream networks but they are only plotted in fig 8 to provide better visualizations 3 4 1 flow direction the spatial distributions of flow direction for all 16 cases are illustrated in fig 7 the results show that 1 in general model performance on flow direction decreases as spatial resolution decreases for example at high resolution 5 km and 10 km case 1 4 and 5 8 the spatial coverage of modeled flow directions is close to the watershed boundary level in contrast at coarse resolution 40 km case 13 16 the spatial coverage of modeled flow directions is much smaller due to the missing portions e g upper right in case 13 and lower right in case 15 this is because the model is more likely to produce incorrect flow direction at some critical locations at coarse resolution which results in these missing portions there is no guarantee that the model will produce better flow direction even at finer spatial resolutions for example a portion in the upper right was captured in case 7 10 km but not in case 3 5 km 2 when stream burning is disabled columns 1 and 3 in fig 7 zonal mean resampling may produce a larger bias in spatial coverage than the nearest resample method e g case 15 neither resampling method can reproduce the flow direction along the stream networks 3 when stream burning is enabled columns 2 and 4 in fig 7 the stream burning algorithm leads to the same flow direction near stream channels even though the corresponding elevations are different resampling method induced differences in flow direction are only visible in areas far away from the stream channels e g case 14 and 16 4 regardless of the resampling method the stream burning algorithm significantly improves the flow direction near the stream channels especially at coarse resolutions e g columns 2 and 4 compared with columns 1 and 3 3 4 2 stream networks similar to the flow direction the spatial distributions of stream segments of all 16 cases are illustrated in fig 8 the results show that 1 similar to flow direction model performance on stream segments decreases as resolution decreases for example at 5 km resolution modeled stream segments from case 2 and 4 almost overlap with the nhd flowlines in contrast at 40 km resolution modeled stream segments cannot preserve the spatial details 2 when stream burning is disabled columns 1 and 3 in fig 8 all cases failed to reproduce the nhd stream networks in flat areas e g case 1 and 3 3 when stream burning is enabled columns 2 and 4 in fig 8 modeled stream segments are close to nhd flowlines the major differences are near river confluences such as the snake river columbia river confluence e g case 14 and 16 the impacts of the resample method on stream segment are near low order streams such as headwaters e g case 10 and 12 4 even with the same accumulation threshold the total number of stream segments differ due to differences in flow accumulation e g case 9 12 similar to our earlier study liao et al 2020 we calculated the enclosed area of differences between the modeled stream segments and nhd flowlines we then used the data to evaluate the closeness of the modeled stream networks to the actual river networks in this method we used area to represent line feature discrepancy and closeness if two or more line features intersect with each other the intersected segments can be used to create enclosed polygons in general the smaller the total polygon area is the closer these line features are an illustration of this method is provided in section 6 10 figure s8 the comparison shows that at 40 km resolution when stream burning is enabled the enclosed area of difference is much smaller 2 8 1 0 4 km 2 than when stream burning is disabled 7 1 1 0 4 km 2 fig 9 3 4 3 drainage area we compared modeled drainage area at columbia river and snake river outlets fig 10 the analysis shows that as spatial resolution decreases variations in modeled drainage area increase when stream burning is disabled both nearest blue and zonal mean purple resampling methods produce a large bias in the drainage area 30 0 increase or decrease when stream burning is enabled green and orange the differences between modeled drainage area and the wbd dataset are less than 8 0 increase or decrease and the impacts from resampling methods are also less than 5 0 4 comparison with drt to evaluate the performance of hexwatershed 2 0 we compared the model outputs to another flow direction model the dominant river tracing drt model wu et al 2011 drt is a multi scale flow direction model and has been used to generate flow direction maps for large scale river routing models including the model for scale adaptive river transport mosart and variable infiltration capacity vic li et al 2013 wu et al 2011 to address the stream networks representation issue raised at coarse resolutions drt uses both fine resolution river networks and flow accumulation instead of coarse resolution dem to define flow directions like most large scale flow direction models drt was developed based on the cartesian latitude longitude grids and defines flow direction north northeast east southeast south southwest west and northwest using the d8 flow direction scheme wu et al 2011 esri 2020 this introduces large biases in the high latitudes due to spatial distortion sood and smakhtin 2015 currently drt has been used to generate flow direction maps at several resolutions e g 1 2 1 4 1 8 and 1 16 degrees we mainly focus on the comparison at coarse resolutions because both models generally perform well at fine resolutions section 6 9 although both hexwatershed and drt produce many products we only focus on flow direction and drainage area given their widespread use by spatially distributed hydrologic models because of mesh differences we compared hexwatershed with drt using an equivalent resolution approach table 2 specifically because the actual resolution of latitude longitude grids varies with latitude the equivalent resolution r d r t is defined using the average latitude eq 2 2 r d r t r e a r t h sin 90 l a t 180 π 2 π r l o n 360 where r e a r t h is the average radius of earth km l a t is the average latitude of crb degree and r l o n is the mosart resolution degree strictly speaking any geometry especially at coarse resolutions on earth s surface is distorted because earth is an imperfect sphere fowler et al 1990 therefore the aforementioned area and resolution are only approximations the comparisons show that the spatial patterns of flow direction from both models are similar when stream burning is enabled figs 11 and 7 both hexwatershed and drt produced similar drainage areas at the basin outlet and snake river columbia river confluence fig 10 5 discussion simulation results show common patterns which were also observed in traditional watershed delineation processes figs 7 and 8 callow et al 2007 goulden et al 2014 this occurs because the mesh only affects the connectivity of the underlying data the overall spatial patterns and the influences of algorithms on data are the same because of the differences in meshes there are also some unique features and challenges 5 1 spatial resampling spatial resampling is important because it is the first step in watershed delineation and can affect several remaining steps for flow direction its impacts mainly manifest near the headwaters it also affects the average slope between mesh cells compared with the nearest resampling zonal mean resampling produces smoother average elevation and consequently milder slopes however there is no evidence that the zonal mean resampling method produces better flow direction advanced spatial resampling methods such as zonal mean provide an opportunity for more detailed geostatistical analysis elevation variations etc 5 2 stream burning the stream burning algorithm has a dominant impact on the delineated stream networks and overall model performance figs 8 and 10 when this feature is enabled it directly defines the flow direction near stream channels and produces final stream segments that are most consistent with provided flowlines the impact of spatial resampling on flow direction is thus negligible near stream channels because of the extensive manipulation by stream burning over the average elevation in the mesh however the performance of stream burning is also subject to several factors including the quality of user provided flowline datasets in our study we only used high order stream channels to simplify the simulation process low order streams can be included to further improve the model performance when stream burning is disabled flow direction and stream networks are defined based on the dem resampling results while the delineated stream networks in our study deviate from the nhd flowlines especially in the eastern washington area they actually represent the natural flow path formed by ice age glacial outburst floods well fig 8 bretz et al 1956 nrwg survey 2018 5 3 spatial resolution the spatial resolutions of input datasets play an important role in flow direction modeling first the spatial resolution of the raster dem affects the performance of dem resampling and the remaining steps ideally the spatial resolution should always be finer than the desired hexagon mesh resolution in our earlier study liao et al 2020 we used much finer resolution hexagon meshes 30 m 90 m and 100 m causing the model to perform reasonably well even without stream burning however this is not applicable to this study in all 16 simulation cases the modeled flow direction contains large biases in many areas if stream burning is disabled because the hexagon resolutions are much higher more than 5 km this is consistent with other traditional watershed delineation methods this also highlights the importance of stream burning especially at coarse spatial resolutions besides resolution the quality of the dem dataset is an important factor as it affects the resampling operation in our study we mainly use the ned dataset other dem datasets might be used yamazaki et al 2019 although user provided vector flowlines do not have resolution their level of detail can be viewed as resolution and should be considered together with the hexagon mesh resolution when the resolution of the hexagon mesh is coarse only high order streams are important because low order streams may be mapped onto the same hexagon mesh cells along with the high order ones when the resolution of the hexagon mesh is high then datasets with low order streams e g high resolution nhd flowlines should be used 5 4 hybrid breaching filling algorithm the newly developed hybrid breaching filling algorithm performs reasonably well figs 7 and 8 because it combines the strengths of both depression filling and stream burning this enables the model to produce the correct flow direction while minimizing its modification to surface elevations however the modifications to stream channel elevations may be extensive which can be problematic for river geometry e g river bed slope definition in this study the threshold parameters used to choose filling or breaching and the adjustment to the stream elevation are critical for the stream elevation calculation more tests or other advanced methods are needed to improve or even replace this parameter 5 5 limitations there are a few limitations to the method work presented in this study 1 the zonal mean resampling method may not perform well when hexagon mesh resolution is close to the source dem resolution also the zonal mean resampling method may not perform well if the hexagon mesh is partially covered by dem at the boundary to address these issues an area weighted zonal mean method should be used especially at coarse resolutions ullrich and taylor 2015 2 the current stream burning method does not make use of stream order information as a result when a stream mesh cell is also a stream confluence the breaching filling algorithm does not prioritize the stream channel with higher order this limitation can be addressed by adding the stream order information into the mesh 3 the current breaching filling algorithm modifies stream mesh cell elevations extensively which may cause issues if stream channel geometry such as riverbed slope is desired to address this an improved approach e g automated parameter adjustment should be used to minimize the modification to the stream mesh cell elevations lindsay 2016 lindsay et al 2019 to achieve this stream topology information is required to allow the breaching algorithm to operate on the desired downstream mesh cell near the confluences 4 currently lakes regardless of size are considered local depressions because they often have lower elevations than their surroundings as a result lakes are filled during depression filling which results in incorrect flow directions this becomes an issue in areas where the lake plays an important role in hydrology a fill spill merge approach should be used to consider lakes especially endorheic lakes barnes et al 2020 liu et al 2020 yamazaki et al 2009 6 conclusions based on our analysis and comparisons we conclude that the hexagon mesh based flow direction method could resolve several limitations in existing cartesian grid based methods through the addition of zonal mean resampling and stream burning capabilities the hexwatershed 2 0 model significantly improves watershed delineation model performance compared to hexwatershed 1 0 especially at coarse resolutions hexwatershed 2 0 improves the flow direction both near and away from stream networks through stream burning and zonal mean resampling techniques because of that the model is robust even in flat areas at coarse resolutions with these new capabilities hexwatershed can be applied to regional and large scale hydrologic models as well as coupled earth system models for land river ocean simulations credit authorship contribution statement chang liao conceptualization methodology software visualization writing original draft writing review editing tian zhou methodology funding acquisition project administration writing review editing donghui xu visualization investigation writing review editing richard barnes writing review editing gautam bisht methodology investigation hong yi li methodology data curation zeli tan writing review editing teklu tesfa writing review editing resources zhuoran duan writing review editing darren engwirda conceptualization methodology l ruby leung writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was supported by the earth system model development program areas of the u s department of energy office of science office of biological and environmental research as part of the multi program collaborative integrated coastal modeling icom project the data used for model simulations are listed in the tables and all input data and model outputs are archived on the computers at pnnl and will be available by contacting chang liao chang liao pnnl gov the hexwatershed program can be accessed through the github website https github com pnnl hexwatershed a portion of this research was performed using pnnl research computing at pacific northwest national laboratory pnnl is operated for doe by battelle memorial institute united states under contract de ac05 76rl01830 appendix a supplementary data supplementary material related to this article can be found online at https doi org 10 1016 j advwatres 2021 104099 appendix a supplementary data the following is the supplementary material related to this article mmc s1 supplementary materials for the advances in hexagon mesh based flow direction modeling 
210,watershed delineation and flow direction representation are the foundations of streamflow routing in spatially distributed hydrologic modeling a recent study showed that hexagon based watershed discretization has several advantages compared to the traditional cartesian latitude longitude discretization such as uniform connectivity and compatibility with other earth system model components based on unstructured mesh systems e g oceanic models despite these advantages hexagon based discretization has not been widely adopted by the current generation of hydrologic models one major reason is that there is no existing model that can delineate hexagon based watersheds while maintaining accurate representations of flow direction across various spatial resolutions in this study we explored approaches such as spatial resampling and hybrid breaching filling stream burning techniques to improve watershed delineation and flow direction representation using a newly developed hexagonal mesh watershed delineation model hexwatershed we applied these improvements to the columbia river basin and performed 16 simulations with different configurations the results show that 1 spatial resampling modulates flow direction around headwaters and provides an opportunity to extract subgrid information and 2 stream burning corrects the flow directions in mountainous areas with complex terrain features keywords watershed delineation unstructured mesh stream burning flow routing 1 introduction flow direction and watershed delineation are the foundations of runoff and streamflow routing in spatially distributed hydrologic modeling neitsch et al 2011 li et al 2013 markstrom et al 2015 liao and zhuang 2017 liao et al 2019 however one must first perform spatial discretization to calculate flow directions to date most existing flow direction methods have been developed based on cartesian grid discretization freeman 1991 quinn et al 1991 holmgren 1994 tarboton 1997 pilesjo et al 1998 orlandini et al 2003 seibert and mcglynn 2007 orlandini and moretti 2009 peckham 2013 wilson et al 2008 they are thus subject to several limitations liao et al 2020 1 the cartesian grid cannot represent adjacency uniformly in a cartesian system each rectangular cell has two types of neighbors direct face and diagonal vertex neighbors as a result hydrologic models need to consider the differences in the travel path of these types of neighbors fig 1 2 because of the diagonal travel path in the d8 scheme esri 2020 an island may be created and cause numerical issues in a coupled surface subsurface hydrology model fig 1 fan et al 2007 camporese et al 2010 3 the cartesian grid cannot provide spherical coverage without significant spatial distortions especially at high latitude regions 4 earth system model components e g atmospheric and oceanic models commonly use sophisticated grid structures cubed sphere icosahedron unstructured mesh to address the convergence of meridians toward the poles because of that cartesian grid based hydrologic models cannot be coupled to these components seamlessly and often require a spatial interpolation for flux exchange in contrast spatial interpolation will be significantly reduced or removed in a unified mesh framework the use of fully unstructured model components e g the model for prediction across scales mpas ringler et al 2013 skamarock et al 2012 and the finite volume sea ice ocean model fesom danilov et al 2017 is an area of growing interest in coupled earth system modeling triangular irregular network tin based methods are also very popular due to the advantages of tin mesh discretization tin can capture terrain variation with fewer samples on the digital elevation model dem than traditional mesh at higher resolution tin can also resolve the spherical coverage limitation however tin based methods are still subject to other limitations 1 in a tin mesh each triangle still has two types of neighbors face neighbors and vertex neighbors section 6 1 figure s1 most tin based hydrologic models use face edge for flux exchange and represent the stream network using tin edges ivanov et al 2004a b paniconi and putti 2015 marsh et al 2020 2 tin is commonly adopted in regional hydrologic models without depression filling and stream burning although it can be extrapolated to a global scale it will not perform well without these capabilities because of the scale differences between mesh resolution and river networks davies and bell 2009 3 although regional scale oceanic models use triangle mesh in the finite volume method fvm or finite element method fem global scale oceanic models also use hexagonal like c grids to address issues including the horizontal divergence oscillations on unstructured triangular c grids thuburn et al 2009 weller et al 2012 wolfram and fringer 2013 therefore the different mesh systems must still be resolved hexagon mesh based discretization can resolve the aforementioned limitations based on its geometrical properties 1 it has only one type of neighbor i e face neighbor 2 because of the uniform face connectivity it directly eliminates the island effect 3 it can cover spheres with flexibility similar to tin with some relaxation a hexagon mesh can be turned into a fully unstructured variable resolution mesh 4 a hydrologic model based on the hexagon mesh can be seamlessly coupled with an oceanic model as a result it can be used to produce high quality flow directions especially for coupled land river and ocean modeling liao et al 2020 despite these advantages hexagon mesh based flow directions have not been widely adopted by current hydrologic models one major reason is the limited access to models that can delineate watersheds on hexagon mesh while maintaining accurate flow directions at various spatial resolutions as the first step in this direction we developed a hexagon mesh based watershed delineation model hexwatershed 1 0 which has shown great potential in improving stream network representations liao et al 2020 however challenges still remain in applying it to the current generation of hydrologic models such as accurately delineating watersheds and stream networks at relatively coarse spatial resolution the performance of watershed delineation tends to decrease for any type of mesh as spatial resolution decreases goulden et al 2014 buakhao and kangrang 2016 liao et al 2020 fundamentally poor representation of terrain elevation dem in coarse spatial resolutions leads to poor representation of the flow direction and incorrect stream networks due to the resolution mismatch to date there are several approaches to mitigate this issue in the geographic information system gis and hydrology communities these approaches can be used either individually or in conjunction with each other the first approach involves the use of advanced spatial resampling methods to improve dem representation studied extensively in the gis literature weber and englund 1992 longley et al 1999 arun 2013 the second approach uses advanced data structures to improve dem quality for example tin based dems have been widely used because they can follow terrain with variable spatial resolutions providing a good balance between spatial resolution and performance francipane et al 2012 the third approach is stream burning a common practice in hydrology for adjusting surface elevation near stream channels so that water always converges into observed stream channels hellweger and maidment 2005 lindsay 2016 finally some studies have attempted to define coarse spatial resolution flow direction using fine scale hydrography datasets wu et al 2011 yamazaki et al 2009 in addition flow direction determination issues can be exacerbated by processes in which depression filling algorithms are used to remove local depressions within a dem which would otherwise trap water this approach is exemplified by the priority flood algorithm which is widely used in many hydrological applications barnes et al 2014 liao et al 2020 in practice the foregoing approaches are often used together to best represent watershed and stream networks in cartesian grid systems winchell et al 2007 lidberg et al 2017 however the quality of the final outputs depends on many factors including the order in which the operations are conducted esri water resources team 2011 to date less attention has been paid to hexagon mesh based watershed delineation models and their corresponding stream network representations especially when used at coarse spatial resolutions in this study we introduce hexwatershed 2 0 which incorporates the above mentioned techniques to improve upon hexwatershed 1 0 we then compare the results from hexwatershed 1 0 2 0 and a cartesian grid based flow direction model i e the dominant river tracing drt model wu et al 2011 in the columbia river basin last we discuss the limitations of hexwatershed 2 0 and the next steps to continue improving model performance 2 methods 2 1 hexwatershed 1 0 the stream burning feature is not available in hexwatershed 1 0 and the nearest neighbor resampling method was used to assign the elevation of each hexagon from the high spatial resolution dem yellow dot in fig 2 in detail the model obtains elevation in the following steps 1 obtain the center location of each mesh cell 2 calculate the image coordinates row and column index from the dem data based on the location 3 read the elevation value using the index the nearest neighbor resampling method is the easiest and most straightforward method but may introduce large bias in areas with large elevation variations 2 2 new features in hexwatershed 2 0 2 2 1 zonal mean spatial resampling in hexwatershed 2 0 we provided an additional resampling method the zonal mean resampling method to improve elevation representation the zonal mean elevation of a mesh cell is estimated with high resolution dem see an example in fig 2 to guarantee there are enough high resolution dem values within each hexagon the ratio of resolutions between the target hexagon mesh and dem should be larger than 3 the definition of hexagon mesh resolution is provided in section 3 2 this process was implemented using the geospatial data abstraction library gdal to identify all the high resolution dem cells inside a given coarse resolution cell gdal ogr 2019 the zonal mean resampling approach also provides the capability to calculate the elevation profile and variations within each polygon mesh cell important information required by earth system models esms li et al 2013 2 2 2 stream burning we developed a stream burning algorithm based on several earlier studies lindsay 2016 a stream burning also often referred to as dem reconditioning is a technique to manipulate flow direction by lowering the elevations within and near the stream channels so that water always flows into prescribed channels a longstanding challenge in watershed delineation models is that depression filling and stream burning may interfere with each other because both algorithms modify the surface elevations lidberg et al 2017 to address this in hexwatershed 2 0 we developed a hybrid algorithm that combines depression filling and stream burning specifically stream burning was implemented within the priority flood algorithm seamlessly in a way that elevation will be modified only once priority flood is an efficient algorithm that fills dem depressions by sequentially flooding the domain from a boundary inward to adjust elevations to assure surface drainage barnes et al 2014 to further simplify the process the stream burning algorithm only modifies surface elevations in the immediate riparian zone which is a single mesh cell buffer zone on both sides of the stream channels the supplementary information provides more details section 6 3 after obtaining all the necessary information dem hexagon mesh with stream tag etc the modified stream burning priority flood algorithm operates via the following steps 1 define the initial priority flood queue as the domain boundary 2 find the node with the lowest mesh cell elevation in the priority flood queue 3 check whether this node is a stream mesh cell or not if it is a stream mesh cell find its upstream mesh cells and modify stream elevation if the upstream elevation is lower or equal then go to step 3a if it is not a stream mesh cell process as a normal priority flood node then go to step 3b a adjust node elevations in stream mesh cell buffer zones b adjust node elevations if they are lower than the center node 4 mark a mesh cell as processed if its elevation is visited 5 push out processed nodes and push their neighbors into the priority flood queue 6 go to step 2 unless the priority flood queue is empty the priority flood algorithm liao et al 2020 and additional stream burning algorithm are explained and illustrated in our earlier study as well as figs 3 and 4 unlike the original priority flood algorithm in hexwatershed 1 0 which only increases the elevation upstream when needed the modified stream burning priority flood algorithm does both breaching and filling when modifying stream and land elevations figs 4d and 5 this strategy was developed to minimize modification to the land mesh cell surface elevations lindsay 2016 a user provided threshold parameter is employed to control the breaching and filling options in traditional stream burning the stream mesh cell elevation is decreased by a threshold value such as 100 m serving as a large drop to enforce flow direction in hexwatershed 2 0 we only modify the outlet elevation and use a threshold value like 10 m to adjust stream mesh cell elevation from outlet to headwater recursively in order to generate a smooth gradient we enforce the max drop between neighboring upstream and downstream mesh cells for example if the elevation differences between upstream and downstream exceed 10 m the upstream elevation is lowered the stream burning algorithm can be turned on or off through newly added model configurations section 6 2 table s1 addition capabilities were also added to support advanced data management and visualization lorensen 2020 section 6 4 and 6 5 hexwatershed 2 0 also supports multiple flow directions as a result the total number of upslope and downslope mesh cells is a constant of 6 the downslope flow direction with the steepest slope is defined as the dominant flow direction by default both stream segment indices and order strahler were calculated using the method introduced in our earlier study usgs 2013 liao et al 2020 the stream segment is defined as an individual stream channel connecting either headwater outlet with its immediate confluence or between two confluences each segment is assigned a unique id ascending from headwater to outlet 3 application 3 1 study area to test the performance of hexwatershed 2 0 we applied the model to the columbia river basin crb crb is the drainage basin of the columbia river in the pacific northwest region of north america the drainage area of the crb is approximately 6 7 1 0 5 km 2 based on the watershed boundary dataset wbd usda nrcs 2017 its surface elevation ranges from 40 m to more than 4000 m above north american vertical datum of 1988 navd 88 it contains both relatively high and low surface slopes in different areas fig 6 the largest tributary of the columbia river the snake river flows from the southeast towards the west and joins the columbia river at the center of the basin 3 2 data we collected raster dem from the united states national elevation dataset ned and canada natural resources 90 m resolution 15000 16600 gesch et al 2002 nrc 2015 we also obtained the stream networks and watershed boundary from the united states national hydrography dataset nhd and watershed boundary dataset wbd usgs 2013 the hexagon mesh can be generated using the qgis mmqgis tool minn 2018 or a python script in the following steps 1 retrieve the spatial reference map projection and extent of the dem 2 set the lower left corner as the origin 3 calculate the number of rows and columns based on the desired resolution and spatial extent 4 calculate the vertex coordinates for each hexagon 5 export the hexagons using the same spatial reference to maintain consistency between different meshes we define the hexagon mesh resolution r h e x using the equivalent resolution which is the root square of its area eq 1 1 r h e x 3 3 2 l 2 where l is hexagon mesh cell edge length km additionally we tagged high order streams strahler stream order higher than 7 into the mesh using the qgis intersection tool detailed instructions for input data preparation are provided in the supplementary information section 6 6 all input information is specified within the model configuration file table s1 3 3 model setup updated model configurations including parameters for the stream burning feature are listed in table s1 to evaluate the sensitivity of hexwatershed 2 0 to spatial resolution and new features we ran the model with different configurations with case indices used for illustrations table 1 these resolutions were selected to match up with a flow direction dataset introduced in section 4 wu et al 2012 3 4 results and analysis similar to version 1 0 hexwatershed 2 0 calculates most watershed delineation variables flow direction flow accumulation river network etc although the new algorithms affect numerous results tied to these variables we only present flow direction and stream networks as they are often used in hydrologic models graphical results with the same index layout are presented in table 1 additional information is provided in the supplementary information section 6 7 and 6 8 to maintain consistency we only present final results that belong to the delineated watershed for example if the modeled flow direction is not within the delineated watershed it is excluded even though it lies within the wbd based watershed boundary case 3 is such an example nhd flowlines are used to evaluate and compare both flow direction and stream networks but they are only plotted in fig 8 to provide better visualizations 3 4 1 flow direction the spatial distributions of flow direction for all 16 cases are illustrated in fig 7 the results show that 1 in general model performance on flow direction decreases as spatial resolution decreases for example at high resolution 5 km and 10 km case 1 4 and 5 8 the spatial coverage of modeled flow directions is close to the watershed boundary level in contrast at coarse resolution 40 km case 13 16 the spatial coverage of modeled flow directions is much smaller due to the missing portions e g upper right in case 13 and lower right in case 15 this is because the model is more likely to produce incorrect flow direction at some critical locations at coarse resolution which results in these missing portions there is no guarantee that the model will produce better flow direction even at finer spatial resolutions for example a portion in the upper right was captured in case 7 10 km but not in case 3 5 km 2 when stream burning is disabled columns 1 and 3 in fig 7 zonal mean resampling may produce a larger bias in spatial coverage than the nearest resample method e g case 15 neither resampling method can reproduce the flow direction along the stream networks 3 when stream burning is enabled columns 2 and 4 in fig 7 the stream burning algorithm leads to the same flow direction near stream channels even though the corresponding elevations are different resampling method induced differences in flow direction are only visible in areas far away from the stream channels e g case 14 and 16 4 regardless of the resampling method the stream burning algorithm significantly improves the flow direction near the stream channels especially at coarse resolutions e g columns 2 and 4 compared with columns 1 and 3 3 4 2 stream networks similar to the flow direction the spatial distributions of stream segments of all 16 cases are illustrated in fig 8 the results show that 1 similar to flow direction model performance on stream segments decreases as resolution decreases for example at 5 km resolution modeled stream segments from case 2 and 4 almost overlap with the nhd flowlines in contrast at 40 km resolution modeled stream segments cannot preserve the spatial details 2 when stream burning is disabled columns 1 and 3 in fig 8 all cases failed to reproduce the nhd stream networks in flat areas e g case 1 and 3 3 when stream burning is enabled columns 2 and 4 in fig 8 modeled stream segments are close to nhd flowlines the major differences are near river confluences such as the snake river columbia river confluence e g case 14 and 16 the impacts of the resample method on stream segment are near low order streams such as headwaters e g case 10 and 12 4 even with the same accumulation threshold the total number of stream segments differ due to differences in flow accumulation e g case 9 12 similar to our earlier study liao et al 2020 we calculated the enclosed area of differences between the modeled stream segments and nhd flowlines we then used the data to evaluate the closeness of the modeled stream networks to the actual river networks in this method we used area to represent line feature discrepancy and closeness if two or more line features intersect with each other the intersected segments can be used to create enclosed polygons in general the smaller the total polygon area is the closer these line features are an illustration of this method is provided in section 6 10 figure s8 the comparison shows that at 40 km resolution when stream burning is enabled the enclosed area of difference is much smaller 2 8 1 0 4 km 2 than when stream burning is disabled 7 1 1 0 4 km 2 fig 9 3 4 3 drainage area we compared modeled drainage area at columbia river and snake river outlets fig 10 the analysis shows that as spatial resolution decreases variations in modeled drainage area increase when stream burning is disabled both nearest blue and zonal mean purple resampling methods produce a large bias in the drainage area 30 0 increase or decrease when stream burning is enabled green and orange the differences between modeled drainage area and the wbd dataset are less than 8 0 increase or decrease and the impacts from resampling methods are also less than 5 0 4 comparison with drt to evaluate the performance of hexwatershed 2 0 we compared the model outputs to another flow direction model the dominant river tracing drt model wu et al 2011 drt is a multi scale flow direction model and has been used to generate flow direction maps for large scale river routing models including the model for scale adaptive river transport mosart and variable infiltration capacity vic li et al 2013 wu et al 2011 to address the stream networks representation issue raised at coarse resolutions drt uses both fine resolution river networks and flow accumulation instead of coarse resolution dem to define flow directions like most large scale flow direction models drt was developed based on the cartesian latitude longitude grids and defines flow direction north northeast east southeast south southwest west and northwest using the d8 flow direction scheme wu et al 2011 esri 2020 this introduces large biases in the high latitudes due to spatial distortion sood and smakhtin 2015 currently drt has been used to generate flow direction maps at several resolutions e g 1 2 1 4 1 8 and 1 16 degrees we mainly focus on the comparison at coarse resolutions because both models generally perform well at fine resolutions section 6 9 although both hexwatershed and drt produce many products we only focus on flow direction and drainage area given their widespread use by spatially distributed hydrologic models because of mesh differences we compared hexwatershed with drt using an equivalent resolution approach table 2 specifically because the actual resolution of latitude longitude grids varies with latitude the equivalent resolution r d r t is defined using the average latitude eq 2 2 r d r t r e a r t h sin 90 l a t 180 π 2 π r l o n 360 where r e a r t h is the average radius of earth km l a t is the average latitude of crb degree and r l o n is the mosart resolution degree strictly speaking any geometry especially at coarse resolutions on earth s surface is distorted because earth is an imperfect sphere fowler et al 1990 therefore the aforementioned area and resolution are only approximations the comparisons show that the spatial patterns of flow direction from both models are similar when stream burning is enabled figs 11 and 7 both hexwatershed and drt produced similar drainage areas at the basin outlet and snake river columbia river confluence fig 10 5 discussion simulation results show common patterns which were also observed in traditional watershed delineation processes figs 7 and 8 callow et al 2007 goulden et al 2014 this occurs because the mesh only affects the connectivity of the underlying data the overall spatial patterns and the influences of algorithms on data are the same because of the differences in meshes there are also some unique features and challenges 5 1 spatial resampling spatial resampling is important because it is the first step in watershed delineation and can affect several remaining steps for flow direction its impacts mainly manifest near the headwaters it also affects the average slope between mesh cells compared with the nearest resampling zonal mean resampling produces smoother average elevation and consequently milder slopes however there is no evidence that the zonal mean resampling method produces better flow direction advanced spatial resampling methods such as zonal mean provide an opportunity for more detailed geostatistical analysis elevation variations etc 5 2 stream burning the stream burning algorithm has a dominant impact on the delineated stream networks and overall model performance figs 8 and 10 when this feature is enabled it directly defines the flow direction near stream channels and produces final stream segments that are most consistent with provided flowlines the impact of spatial resampling on flow direction is thus negligible near stream channels because of the extensive manipulation by stream burning over the average elevation in the mesh however the performance of stream burning is also subject to several factors including the quality of user provided flowline datasets in our study we only used high order stream channels to simplify the simulation process low order streams can be included to further improve the model performance when stream burning is disabled flow direction and stream networks are defined based on the dem resampling results while the delineated stream networks in our study deviate from the nhd flowlines especially in the eastern washington area they actually represent the natural flow path formed by ice age glacial outburst floods well fig 8 bretz et al 1956 nrwg survey 2018 5 3 spatial resolution the spatial resolutions of input datasets play an important role in flow direction modeling first the spatial resolution of the raster dem affects the performance of dem resampling and the remaining steps ideally the spatial resolution should always be finer than the desired hexagon mesh resolution in our earlier study liao et al 2020 we used much finer resolution hexagon meshes 30 m 90 m and 100 m causing the model to perform reasonably well even without stream burning however this is not applicable to this study in all 16 simulation cases the modeled flow direction contains large biases in many areas if stream burning is disabled because the hexagon resolutions are much higher more than 5 km this is consistent with other traditional watershed delineation methods this also highlights the importance of stream burning especially at coarse spatial resolutions besides resolution the quality of the dem dataset is an important factor as it affects the resampling operation in our study we mainly use the ned dataset other dem datasets might be used yamazaki et al 2019 although user provided vector flowlines do not have resolution their level of detail can be viewed as resolution and should be considered together with the hexagon mesh resolution when the resolution of the hexagon mesh is coarse only high order streams are important because low order streams may be mapped onto the same hexagon mesh cells along with the high order ones when the resolution of the hexagon mesh is high then datasets with low order streams e g high resolution nhd flowlines should be used 5 4 hybrid breaching filling algorithm the newly developed hybrid breaching filling algorithm performs reasonably well figs 7 and 8 because it combines the strengths of both depression filling and stream burning this enables the model to produce the correct flow direction while minimizing its modification to surface elevations however the modifications to stream channel elevations may be extensive which can be problematic for river geometry e g river bed slope definition in this study the threshold parameters used to choose filling or breaching and the adjustment to the stream elevation are critical for the stream elevation calculation more tests or other advanced methods are needed to improve or even replace this parameter 5 5 limitations there are a few limitations to the method work presented in this study 1 the zonal mean resampling method may not perform well when hexagon mesh resolution is close to the source dem resolution also the zonal mean resampling method may not perform well if the hexagon mesh is partially covered by dem at the boundary to address these issues an area weighted zonal mean method should be used especially at coarse resolutions ullrich and taylor 2015 2 the current stream burning method does not make use of stream order information as a result when a stream mesh cell is also a stream confluence the breaching filling algorithm does not prioritize the stream channel with higher order this limitation can be addressed by adding the stream order information into the mesh 3 the current breaching filling algorithm modifies stream mesh cell elevations extensively which may cause issues if stream channel geometry such as riverbed slope is desired to address this an improved approach e g automated parameter adjustment should be used to minimize the modification to the stream mesh cell elevations lindsay 2016 lindsay et al 2019 to achieve this stream topology information is required to allow the breaching algorithm to operate on the desired downstream mesh cell near the confluences 4 currently lakes regardless of size are considered local depressions because they often have lower elevations than their surroundings as a result lakes are filled during depression filling which results in incorrect flow directions this becomes an issue in areas where the lake plays an important role in hydrology a fill spill merge approach should be used to consider lakes especially endorheic lakes barnes et al 2020 liu et al 2020 yamazaki et al 2009 6 conclusions based on our analysis and comparisons we conclude that the hexagon mesh based flow direction method could resolve several limitations in existing cartesian grid based methods through the addition of zonal mean resampling and stream burning capabilities the hexwatershed 2 0 model significantly improves watershed delineation model performance compared to hexwatershed 1 0 especially at coarse resolutions hexwatershed 2 0 improves the flow direction both near and away from stream networks through stream burning and zonal mean resampling techniques because of that the model is robust even in flat areas at coarse resolutions with these new capabilities hexwatershed can be applied to regional and large scale hydrologic models as well as coupled earth system models for land river ocean simulations credit authorship contribution statement chang liao conceptualization methodology software visualization writing original draft writing review editing tian zhou methodology funding acquisition project administration writing review editing donghui xu visualization investigation writing review editing richard barnes writing review editing gautam bisht methodology investigation hong yi li methodology data curation zeli tan writing review editing teklu tesfa writing review editing resources zhuoran duan writing review editing darren engwirda conceptualization methodology l ruby leung writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was supported by the earth system model development program areas of the u s department of energy office of science office of biological and environmental research as part of the multi program collaborative integrated coastal modeling icom project the data used for model simulations are listed in the tables and all input data and model outputs are archived on the computers at pnnl and will be available by contacting chang liao chang liao pnnl gov the hexwatershed program can be accessed through the github website https github com pnnl hexwatershed a portion of this research was performed using pnnl research computing at pacific northwest national laboratory pnnl is operated for doe by battelle memorial institute united states under contract de ac05 76rl01830 appendix a supplementary data supplementary material related to this article can be found online at https doi org 10 1016 j advwatres 2021 104099 appendix a supplementary data the following is the supplementary material related to this article mmc s1 supplementary materials for the advances in hexagon mesh based flow direction modeling 
211,predicting baseflow dynamics protecting aquatic habitat and managing legacy contaminants requires explicit characterization and prediction of groundwater discharge patterns throughout river networks using handheld thermal infrared tir cameras we surveyed 47 km of stream length across the farmington river watershed 1 570 km2 ct and ma usa mapping locations of bank and waterline groundwater discharges based on their thermal signature using the observed groundwater discharge locations and predicted groundwater discharge rates from 6 variations of a numerical groundwater flow model modflow nwt we compared 1 predicted groundwater discharge rates in areas with and without observed groundwater discharge 2 spatial patterns of observed and predicted groundwater discharge locations and 3 density of observed groundwater discharge locations with predicted discharge rates five of six models reasonably predicted the spatial patterns of discharge locations along the 5th order mainstem but fewer models predicted groundwater discharge patterns in smaller streams our results highlight 1 the feasibility of using tir observations to evaluate groundwater models 2 model parameters that influence discharge prediction accuracy riverbed sediment and bedrock hydraulic conductivity and river aquifer connections and 3 current strengths and future opportunities for improved modeling of groundwater discharge patterns keywords groundwater discharge seepage thermal infrared modflow model evaluation 1 introduction model predictions of spatially explicit groundwater discharge patterns along stream networks are not often evaluated using field observations however accurate prediction regarding the spatial distribution and other physical characteristics of groundwater discharge to streams and rivers is critical for protecting aquatic habitat and managing contaminant inputs to streams briggs and hare 2018 dent et al 2001 torgersen et al 2012 for example identifying the locations and source depth of groundwater discharge is essential to predicting the occurrence of thermal refuges and refugia in the face of climate change hare et al 2021 johnson et al 2020 similarly groundwater flowpath depth and discharge location are important for understanding nitrogen loads to river systems kolbe et al 2019 wherry et al 2021 accurate prediction of groundwater discharge across river networks however remains challenging due to gaps in model evaluation and a lack of field data at model relevant spatial extents and resolutions barclay et al 2020a groundwater models are commonly implemented at the river network scale drainage areas 103 km2 and simulate groundwater discharge to streams and rivers at the model cell resolution model specific typically hundreds of meters befus et al 2017 feinstein et al 2010 masterson et al 2016 sanford et al 2012 this suggests that groundwater models can simulate sub reach heterogeneity in groundwater discharge at the spatial extent of river networks yet the accuracy of simulated discharge patterns has not been assessed at this scale recently barclay et al 2020a demonstrated that groundwater models modflow nwt n 11 with identical recharge inputs but differing parameterization resulted in similar fit to observed water levels but 1 differences of 50 in the fraction of groundwater discharge directed to 1st order streams 2 three fold differences in simulated source groundwater flowpath depth and 3 seven fold differences in subsurface travel times among models differences of this magnitude in simulated flow distribution could have consequential implications for maintaining environmental flows including stream temperature managing contaminant legacies or understanding nutrient processing barlow and leake 2012 barnes et al 2018 chen et al 2018 kolbe et al 2019 kurylyk et al 2015 this lack of precision regarding critical physical characteristics of groundwater discharge across a river network highlights the need for new approaches to evaluate and refine simulated patterns of discharge such as the position along the river network calibration or evaluation data for groundwater flow models commonly include groundwater head stream elevation stream discharge in sub basins and occasionally age tracer data sanford 2011 starn and brown 2007 information on spatial patterning of groundwater discharge seepage to streams is typically not included although discharge rates from individual groundwater discharge zones vaccaro 2011 yager et al 2008 2007 and discharge patterns in small watersheds 50 km2 ala aho et al 2015 danielescu et al 2009 glaser et al 2016 jeannot et al 2019 have been used in a few instances studies that explicitly assess sub reach hundreds of meters spatial patterns of simulated groundwater discharge across larger watersheds 103 km2 are lacking this absence of assessment is due in part to a lack of empirical data that can be meaningfully compared to modeled discharge patterns and a lack of approaches for incorporating new types of field data into the modeling process existing empirical approaches typically identify and quantify groundwater discharge at the point to reach scale discrete lengths of river typically hundreds of meters to a few kilometers but neither point measurement nor reach scale aggregations of groundwater discharge are straightforward to compare to model outputs due to mismatches in measurement and model resolution at discrete points seepage meters and temperature profilers can be robust for quantifying groundwater discharge below the waterline under favorable conditions caissie and luce 2017 irvine et al 2016 rosenberry 2008 but measuring the total groundwater discharge for a single model cell using physical point measurements would require many time consuming individual measurements as extreme heterogeneity precludes interpolation this is impractical over spatial extents comparable to most predictive models spanning the reach and point scale fiber optic distributed temperature sensing fo dts can identify spatial patterns of groundwater discharge along linear cables at sub meter resolution as well as high frequency 15 min intervals temporal variation in groundwater discharge hare et al 2015 matheswaran et al 2014 groundwater discharge observations made with fo dts can be easily aggregated to the model resolution but deploying and managing the cables requires at least a week per 2 3 km length of river making them impractical for river network scale applications at the reach scale hundreds of meters chemical tracers and differential gaging allow calculation of aggregate groundwater discharge assuming conservation of mass kalbus et al 2006 kilpatrick and cobb 1985 mccallum et al 2012 xie et al 2016 but net groundwater inflow along the measurement reach must be relatively large compared to streamflow for groundwater inputs to be captured with confidence and spatially explicit discharge information is lost network scale groundwater discharge analysis conducted using baseflow separation techniques are useful in testing net groundwater exchange as baseflow predictions cartwright and miller 2021 miller et al 2017 but as with tracer injections specific discharge zone information is not preserved newly refined remote sensing and geophysical based methodologies offer promise in better aligning the scales of discharge specific field data collection and watershed groundwater flow model resolution briggs and hare 2018 toran et al 2015 in particular thermal infrared imagery tir e g ala aho et al 2015 briggs et al 2016 schuetz and weiler 2011 which greatly enhances potential spatial coverage while preserving high spatial resolution of discharge zone mapping briggs and hare 2018 may be an ideal empirical method for integrating with river network scale groundwater models tir provides a time specific map of water surface and bank temperatures along contiguous surveys this surface temperature map can be used to identify zones or areas of preferential groundwater discharge at times of year with contrasting groundwater and surface water or stream bank temperatures torgersen et al 2001 preferential groundwater discharge differs from spatially diffuse discharge in that groundwater emerges at a relatively high flux rate in discrete patches such that source groundwater temperature signatures are preserved allowing identification via heat tracing briggs and hare 2018 generally groundwater discharge observed with tir at or above the water line on riverbanks occurs as discrete points at the sub meter scale or when multiple discharge points occur in close proximity over more extensive tens of meters bank areas as preferential discharge faces mundy et al 2017 drone based tir has recently been applied to the evaluation of groundwater discharge based large wetland restoration design harvey et al 2019 validation of discharge patterns from integrated hydrologic models in small 5 km2 watersheds using handheld instruments glaser et al 2016 jeannot et al 2019 and mapping potential thermal refugia zones based on the occurrence of discharge faces along higher order rivers across hundreds of kilometers using airborne platforms ala aho et al 2015 dugdale et al 2015 field surveys conducted with tir have the potential to provide field observations at a spatial extent and resolution that can be meaningfully compared with river network scale groundwater flow models tir is more efficient to implement than other empirical methods e g seepage meters differential gaging chemical tracers though unlike several such methods tir cannot be used to determine groundwater discharge flux rates except potentially under highly specific circumstances such as frozen discharge faces pandey et al 2013 warm weather riverbank discharge plume size and temperature is governed by a range of localized hydrodynamic factors and relatively cold discharge water tends to plunge downward into the water column out of the view of tir hampering efforts to directly infer discharge rates from tir images however tir can be used to quickly identify discharge areas or zones across contiguous space in perhaps a more complete manner than any other current groundwater surface water exchange processes methodology the mapped locations of observed preferential groundwater discharge particularly when they occur along more extensive discharge faces could potentially be used to evaluate spatial patterns of groundwater discharge predicted by river network scale flow models as the development of discharge faces is likely driven by geologic and hydraulic factors more similar to model scales than singular discharge points our primary objective in this study was to test the utility of tir based field measurements of preferential groundwater discharge points and faces for evaluating model cell scale spatial patterns of groundwater discharge predicted by a river network scale groundwater model this is a substantial step towards resolving the disparate scales of detailed stream reach field studies and coarse river network scale simulations in this project we characterized spatial patterns of groundwater discharge at the river network scale using extensive tir field surveys and then evaluated six groundwater models for a 5th order watershed representing different spatial patterns of groundwater discharge but similar model fit metrics to groundwater levels barclay et al 2020a against the field observations ultimately this study demonstrates an approach to field verifying the predicted spatial patterns of groundwater discharge from river network scale groundwater models thereby highlighting areas for future improvement in our ability to simulate groundwater discharge at the river network scale 2 methods briefly we characterized spatial patterns of preferential groundwater discharge across a river network using spatially extensive ground based tir field surveys then compared these empirical results to river network scale groundwater flow models we surveyed 47 km of total stream length across stream orders with tir imagery to map areas of groundwater discharge across headwater areas 3rd order tributaries and the mainstem of a 5th order watershed we then selected six meaningful physical variations of a previously published groundwater flow model barclay et al 2020a 2020b with similar calibration fit metrics but differing predicted spatial patterns of groundwater discharge we used the field mapped spatial distributions of groundwater discharge locations to evaluate predicted patterns of groundwater discharge from the calibrated models this independent evaluation of the models with observed spatial patterns of discharge is not typical for groundwater models and is a unique strength of our approach details of our methods are given in the following sections 2 1 site description the study site was the farmington river watershed ma and ct usa fig 1 the farmington river drains an area of 1570 km2 and is a 5th order tributary of the connecticut river glacial till overlies crystalline bedrock over most of the watershed with areas of stratified glacial sediments over sedimentary rock in the river valleys olcott 1995 soller et al 2012 previous geophysical mapping has indicated that groundwater discharge patterns may be driven in part by near surface bedrock type in addition to the unconsolidated surficial geology lane et al 2020 land cover is predominantly forest particularly in the central and northern regions of the watershed developed land is focused along the eastern river valley homer et al 2015 in the uplands the stream channels were predominantly cobbled with some areas of exposed bedrock and the canopies were typically closed in the eastern river valley the stream gradients were lower bed sediment was primarily coarse or fine sand and the canopy was open particularly along the 5th order section of the farmington river further description of the site is given in barclay et al 2020a 2 2 field surveys to map locations of groundwater discharge along stream banks we surveyed 47 km of non contiguous stream reaches within the farmington river watershed using tir due to practical considerations we surveyed small streams by wading walking along banks and larger rivers by canoe from the center of the channel we waded eight 1st order stream sites 4 7 km total 6 km of a 2nd order stream and three 3rd order stream sites 1 6 km total we paddled 2 7 km of a 3rd order stream and 32 km of the main stem of the farmington river 5th order table 1 we conducted the surveys over 13 days between july 6 and october 5 2017 and 7 days between august 2 and september 22 2019 streams were surveyed once though some reaches required multiple days during the surveys we scanned the banks using one of four flir cameras t640 t620 e8 and i7 flir systems www flir com with instrument emissivities set consistent with fresh water in summer 0 96 0 98 handcock et al 2012 and viewfinder temperature ranges set for the t640 t620 and e8 cameras to span stream and groundwater temperatures in areas with apparent colder thermal anomalies of multiple degrees on the banks and along waterline we collected tir images noted the latitude and longitude using a hand held gps unit garmin colorado 400t or garmin gpsmap 64 s www garmin com and recorded the subsurface 11 cm depth temperature using a precise hand held digital thermometer https www traceable com 4000 traceable digital thermometer html absolute temperatures calculated from tir images can be affected by reflected radiation baker et al 2019 handcock et al 2012 therefore we identified groundwater discharge based on multiple lines of evidence thermal anomalies in the surface temperature subsurface temperatures consistent with discharging groundwater and qualitative indicators of groundwater discharge such as wet soil or flowing water above the water line because the tir images were used for mapping the locations of cold thermal anomalies attributable to groundwater discharge and not for quantitative analysis of the absolute temperatures we did not post process the images or apply corrections to the calculated temperatures we delineated the approximate linear discharge zone length along the bank we categorized two types of preferential groundwater discharge observed along streambanks 1 preferential groundwater discharge points one or more individual sub meter scale zones of preferential discharge and 2 discharge faces extensive lengths tens to hundreds of meters long of grouped cold anomalies along the bank fig 2 in this study we use the term discharge zones to refer to all areas of groundwater discharge regardless of spatial extent and discharge point and discharge face to distinguish between spatially limited and spatially extensive areas of groundwater discharge as defined above images from the tir surveys are available in barclay et al 2019 and moore et al 2020 2 3 groundwater flow model we selected a subset n 6 of previously implemented groundwater flow models for our study site that had similar fit to groundwater level and stream elevation calibration data but varied in their predictions of spatial patterns flowpath depth and travel time of groundwater discharge barclay et al 2020a similarities across models are described here differences are discussed in the next paragraph the models were developed in modflow nwt niswonger et al 2011 and they simulate flow under steady state conditions with a uniform horizontal grid and 4 vertical layers the unconsolidated surficial materials are split vertically into three layers with decreasing horizontal hydraulic conductivity with depth the lowest layer is a bedrock layer the horizontal hydraulic conductivity was calibrated using pest welter et al 2015 mean head measurements from 990 wells and water levels from 1st order streams in flat areas land surface slope 2 and a grid of pilot points pilot points are preselected points at which hydraulic conductivity is calibrated hydraulic conductivity at all other locations is interpolated from the pilot points simulated water levels were compared to head measurements from 984 wells and 525 stream water levels with root mean squared errors rmse ranging from 9 8 to 11 6 m table 2 the models were also evaluated using an overallerror metric defined as the percent of flooded terrestrial cells incorrectly simulated as flooded plus the percent of dry river cells incorrectly simulated as dry plus a penalty for excessive losing river reaches in excess of 5 percent of recharge the overallerror metric is based on the work of starn and belitz 2018 the selected models differ in the zonation of pilot points degree of variation in bedrock and riverbed hydraulic conductivity allowed directionality of river aquifer exchange and horizontal grid resolution table 2 the initial model was developed based on readily available data and common simplifying assumptions it has a 300 m horizontal grid uniform riverbed hydraulic conductivity 0 1 m d 1 literature based bedrock hydraulic conductivity domenico and schwartz 1997 u s geological survey 2007 and a 4000 m grid of pilot points streams were simulated using the riv package which allows stream reaches to be net gaining or losing at the model cell resolution harbaugh 2005 in surfmatzone the pilot points are assigned to one of four zones based on surficial material type glacial till coarse stratified sediments fine stratified sediments and open water and a finer grid 1000 m was used for the pilot points in the coarse sediments fine sediments and open water zones because these zones occupied a smaller area where the 4000 m spacing was impractical 442 pilot points total vs 102 with the initial model riverbedk is identical to the initial model except that the riverbed hydraulic conductivity is spatially varying and assigned as 0 01 times the hydraulic conductivity of the surrounding surficial material rivk bedk is similar to riverbedk except that the hydraulic conductivity in the bedrock is calibrated on a 4000 m grid of pilot points rather than being based on literature values highres is identical to rivk bedk except that the grid cell size is reduced to 100 m finally rivk bedk drn is similar to rivk bedk except that rivers are represented using the drn package in modflow which allows flow only from aquifer to river streams are all gaining or disconnected instead of the riv package harbaugh 2005 further details of model development are available in barclay et al 2020a and the model input and output files are available in barclay et al 2020b despite the similarity in model fit as indicated by the rmse and the overallerror metrics the models had substantial differences in groundwater flowpath characteristics table 2 and fig 3 for example the fraction of groundwater discharge directed to small 1st order streams ranged by a factor of 1 4 from 29 40 the median travel time ranged by a factor of 3 8 from 1 1 to 4 2 years and the median flowpath depth ranged by a factor of 2 6 from 6 8 to 17 9 m table 2 similar differences in simulated discharge characteristics were seen in the subset of reaches included in the field surveys of this study fig 3 for example mean groundwater discharge rates to 1st order streams ranged by a factor of 4 from 0 4 to 1 2 m3m 1d 1 with a mean of 0 8 m3m 1d 1 in this paper simulated discharge rates are expressed as a volume of discharge per length of stream per day 2 4 comparing locations of modeled and observed groundwater discharge to evaluate the simulated spatial patterns of groundwater discharge we compared the simulated discharge predictions with our field observations of preferential discharge points and faces first we quantitatively compared simulated groundwater discharge rates in sections with and without observed groundwater discharge locations based on our field observations model cells were classified into two groups by the presence or absence of observed areas of groundwater discharge regardless of the number or spatial extent of the observed discharge and we analyzed statistical differences in mean modeled discharge rate between the two groups models with statistically significant differences at the p 0 05 level were considered strongly distinguishing and at the 0 05 p 0 1 level were considered weakly distinguishing all other models were considered poorly performing we considered the stream sections by stream order due to differences in simulated discharge rate and survey length we analyzed all data at the model cell resolution and also aggregated the observations and simulated discharge rates to stream lengths of approximately 500 m for the 5th order river observations were not aggregated in the small streams due to short survey lengths we determined statistically significant differences using a comparison of means that does not require normality equal variance or equal sample size herberich et al 2010 all statistical analyses were completed in r r core team 2019 finally we qualitatively and semi quantitatively compared the observed and simulated spatial patterns of groundwater discharge across models and within and across sites for each stream order to semi quantitatively analyze the spatial patterns of groundwater discharge we calculated the correlations between the simulated discharge rate and the observed discharge density number of locations per length of stream faces were counted once for every 10 m of length for each stream order we calculated the correlations at the model cell resolution and for the 1st 3rd order surveys across sites sub sites and for the 5th order survey at aggregated lengths of approximately 500 m 1 km and 2 km because the survey lengths varied substantially among 1st 3rd order stream sites sites with long survey lengths were subdivided into subsites with lengths similar to the median for the stream order we compared the discharge location density to the simulated discharge rate using a parametric correlation pearson s r for normally distributed model survey pairings and a non parametric correlation spearman s rho for the other pairings models with statistically significant p 0 05 correlations between observed discharge location density and simulated discharge were considered better performing models 3 results we observed preferential groundwater discharge at or above the waterline in all mapped stream sections but discharge points and faces were not evenly distributed along sections and varied in occurrence between sections further some discharge zones were clearly higher flux based on visible bank surface flow fig 2b colder groundwater with discharge temperature approaching the annual surface mean 6 9 10 5 c prism climate group 2012 while other zones of presumed lower flux based on the absence of visible flow discharge were of warmer temperatures discharge faces in the 5th order river tended to be longer in length e g fig 2a than discharge faces in the smaller streams though there was substantial variation also some discharge zones in the 5th order river had flow channels visible in the infrared note the dark blue flow lines in fig 2a or visible color images without infrared temperatures in the observed groundwater discharge zones were consistent with groundwater temperatures in our study area interquartile range 10 0 13 0 c mean 11 5 c u s geological survey 2020 fig 4 bank surface temperatures from the tir images ranged from 7 1 to 16 6 c and subsurface 11 cm depth temperatures ranged from 7 9 to 16 0 c with most groundwater discharge zones between 10 and 15 c on both the surface and in the subsurface even at similar elevation groundwater can be expected to show a range of temperatures in summer based on the depth of the contributing flowpath briggs et al 2018 most of the coldest discharge zones surface temperature 9 5 c or subsurface temperature 11 0 c were in the 5th order survey though they were typically separated by warmer discharge zones and hundreds of meters of inactive banks groundwater discharge zones were not uniformly distributed along stream reaches in both the larger river and smaller streams groundwater discharge points tended to cluster figs 4 and 5 so that some stream sections contained multiple discharge points and others were relatively inactive the grouping of discharge faces is even more pronounced fig 5 in the upstream 10 km of the larger river survey we observed no discharge faces but in the next 12 km we observed 12 distinct discharge faces covering approximately 1 5 km of river length during the 1st to 3rd order stream surveys we only observed discharge faces at 7 out of 16 sites salmon brook sites 9 10 13 14 and 15 morgan brook site 4 and the tributary to scott swamp brook site 8 most of the discharge faces found in 1st to 3rd order streams are tens of meters in extent 3 1 model evaluation 3 1 1 predicted groundwater discharge in areas with and without observed discharge zones in the 5th order river most models predicted significantly higher rates of groundwater discharge in areas where we observed groundwater discharge than in areas without observed discharge zones when the observations and simulated rates were aggregated to stream lengths of approximately 500 m p 0 05 fig 6 bottom row the one model that did not predict a statistically significant difference between areas with and without observed discharge zones in the larger river was surfmatzone where the pilot points were assigned to zones based on the surrounding surficial material the source of this misfit in the larger river with the surfmatzone model may be anomalously high calibrated hydraulic conductivity values in coarse stratified sediments median for surfmatzone 243 m d 1 vs 39 44 m d 1 for all other models when the observations and simulated discharge rates were compared at the model cell resolution 100 m for highres 300 m for all other models only the highres model weakly predicted higher rates of groundwater discharge in areas where we observed groundwater discharge than in areas without observed groundwater discharge zones p 0 10 in contrast in the smaller streams and rivers 1st 3rd order fig 6 rows 1 through 3 fewer models aligned with observed discharge patterns i e predicted significantly higher rates of groundwater discharge in areas with tir observed discharge zones p 0 05 fig 6 rows 1 through 3 with greater agreement in 3rd order rivers than in 1st and 2nd order streams the best performing model across 1st 2nd and 3rd order streams was surfmatzone where calibration is by surficial deposit zones this is in contrast to the larger river where surfmatzone performed poorly the differences in mean simulated discharge rates between areas with and without observed discharge zones was smaller for 1st and 2nd order streams differences of 0 18 m3d 1 and 0 87 m3d 1 respectively across all models the negatives indicate that some models predicted higher discharge rates where we observed no discharge than where we observed discharge than for 3rd order rivers mean difference of 1 77 m3d 1 suggesting that the models better simulated observed discharge zones in 3rd order streams than in smaller 1st and 2nd order streams 3 1 2 location comparison of modeled and observed groundwater discharge in the 5th order river all models reflected the general spatial patterns of discharge we observed fig 5d consistent with the above quantitative analysis fig 6a all models predicted relatively constant discharge from km 1 to km 10 a section where we saw little evidence of preferential bank groundwater discharge and all models predicted the apparent increase in discharge that we observed from km 11 21 none of the models predicted the increased discharge we observed in km 21 22 and only surfmatzone predicted the greater discharge we observed at km 30 32 but surfmatzone predicted discharge we did not observe along the banks at km 35 36 in the 1st 3rd order streams most models simulated similar magnitude discharge across the sites fig 5 a c notable exceptions occurred in the 1st order survey at sites 7 and 4 and in the 3rd order survey at sites 11 13 and 14 at site 7 in the 1st order survey fig 5a 3 models riverbedk highres and rivk bedk predicted substantial flow from the stream to the aquifer across the entire site while the remaining 3 models simulated near zero net discharge these models riverbedk highres and rivk bedk have spatially varying riverbed hydraulic conductivity and simulate streams using the riv package which allows net gains or losses to the stream a combination that can result in unrealistically high flows from river to aquifer although the simulation results might suggest predominantly losing conditions at site 7 this is unlikely stream temperatures at site 7 suggest substantial groundwater exchange and net gaining conditions and the lack of a stream network upstream of the site suggests streamflow is sourced locally likely from groundwater discharge more likely the groundwater models are unable to simulate the near surface water table needed to generate gaining conditions possibly due to the coarse model resolution and headwaters location at site 4 in the 1st order survey the three models with calibrated hydraulic conductivity in the bedrock highres rivk bedk and rivk bedk drn simulated no flow or slight losses from stream to aquifer while the other 3 models simulated gaining conditions throughout the site at site 11 in the 3rd order survey the higher resolution model highres simulated slightly different locations for the higher discharge peaks than the remaining models this could be a consequence of differing model resolutions that led to differing locations of breaks and gradients in the hydraulic conductivity at sites 13 and 14 in the 3rd order survey fig 5c surfmatzone in which hydraulic conductivity was calibrated by zones of surficial material type simulated higher rates of discharge over portions of the survey than the other models zonation of the hydraulic conductivity results in sharper breaks in the spatial patterns of the calibrated values which likely caused differing patterns of simulated discharge in the 2nd order survey all models simulated similar spatial patterns and all models simulated higher rates of discharge in the downstream end of site 10 as compared with the upstream end consistent with the increased aerial extent of observed discharge at the downstream end in summary across all stream orders the spatial alignment between simulated and observed river bank discharge patterns varied in some locations such as km 12 in the 5th order river fig 5d peaks in simulated discharge align spatially with peaks in the spatial extent of observed discharge in other locations peaks in simulated discharge occur upstream or downstream of peaks in the spatial extent of observed discharge for example in site 14 of the 3rd order river fig 5c a peak in simulated discharge occurs slightly upstream of an extensive area of observed groundwater discharge misalignment in simulated and observed discharge locations is more likely due to lack of precision in the simulated location than to errors in the mapped location of the observed discharge observed discharge was aggregated to the model cell resolution 300 m or 150 m for the highres model making it unlikely that observed discharge would be mapped to the incorrect model cell except when the discharge occurred near the cell boundary the groundwater models were based on relatively coarse datasets with hydraulic conductivity for individual cells determined by interpolation together this makes it more likely that simulated locations of high discharge will be less accurate than field mapped locations though our field mapping technique is not expected to capture direct riverbed discharge which may be substantial in some areas 3 1 3 discharge location density and simulated groundwater discharge in the 5th order survey the observed discharge density and simulated discharge were correlated for one model when the results were aggregated to 500 m lengths highres rho 0 26 n 61 p 0 05 and weakly correlated for five model aggregation pairs rivk bedk rho 0 21 500 m lengths n 61 rivk bedk drn rho 0 24 500 m lengths n 61 highres rho 0 34 1 km lengths n 33 rivk bedk r 0 46 1 km lengths n 17 rivk bedk drn r 0 48 2 km lengths n 17 p 0 10 in the 3rd order survey the density of observed discharge locations observations per length of stream was strongly correlated with the simulated groundwater discharge rate for three models rivk bedk r 0 73 rivk bedk drn r 0 71 surfmatzone r 0 71 p 0 05 when the results were compared across sites sub sites subdivisions of longer length surveys shown with vertical bars on the x axis in fig 5c n 8 and weakly correlated for two models surfmatzone rho 0 90 model cell resolution n 22 riverbedk r 0 67 site sub site aggregation n 8 p 0 10 in the 1st and 2nd order surveys the observed discharge location density was not significantly correlated with the simulated groundwater discharge 4 discussion accurate simulation of spatially explicit groundwater discharge characteristics at the river network scale requires an approach that links together models and empirical methods at comparable spatial resolutions we demonstrate an approach to integrating empirical tir observations of preferential groundwater discharge occurrence and river network scale groundwater flow modeling to our knowledge this is one of the most spatially extensive high resolution sets of observed groundwater discharge locations that includes small streams to date and represents a first attempt to use the spatial patterns of discharge locations to evaluate a river network scale groundwater flow model at the grid cell scale 4 1 cross scale integration of groundwater discharge physical drivers observations and simulations simulation and assessment of groundwater discharge patterns at the river network scale involves a complex cross scale integration of physical drivers of groundwater discharge empirical observation methods and groundwater models although tir provides spatially extensive observations at relevant spatial resolutions our findings suggest that scale integration challenges remain in particular we found that the river network scale models worked well in the 3rd and 5th order river reaches where the stream channels cut through a thicker sand and gravel aquifer along the 2nd order reach which also overlaid sand and gravel deposits the models accurately predicted more discharge at the end of site 10 fig 5b where extensive seep faces were also found within 1st order stream reaches where bedrock was often near surface and there was prevalence of low permeability glacial till the models did not reflect observed variation in discharge 4 1 1 the scale of physical drivers of groundwater discharge groundwater discharge is driven by three dimensional patterns of hydraulic conductivity and hydraulic head freeze and witherspoon 1967 which are driven by a complex array of patterns in groundwater recharge surficial material properties type layering thickness etc bedrock properties type layering fracture patterns etc and geomorphology slope sinuosity confinement etc haitjema and mitchell bruker 2005 winter et al 1998 these drivers operate at nested scales ranging from centimeters to tens of kilometers freeze and witherspoon 1967 rosenberry and pitlick 2009 the importance of each scale varies by network position with local drivers dominating in headwaters areas and regional drivers dominating in larger rivers but even in larger rivers fine scale patterns are important rosenberry and pitlick 2009 4 1 2 the scale of tir observations tir observation spatial resolution is a function of the temperature differential between groundwater and surface materials as well as the survey speed and distance from the discharge points by paddling down the center of the 5th order river we were able to survey multiple kilometers a day but faster travel at a longer distance from the banks resulted in a coarse resolution survey we noted the larger areas of groundwater discharge but likely not every small point in contrast slower travel while wading along small narrow streams resulted in a finer level of detail in the smaller stream surveys compared to the large river surveys even where we paddled the 3rd order river the narrower channel and lower water levels resulted in slower travel and consequently in a finer resolution survey than in the 5th order river the observed temperature differentials also differed by stream size likely due to different thermal regimes in the smaller versus larger rivers in the 5th order river reaches during late summer and early fall the temperature of the stream channel was consistently 20 c and the observed groundwater discharge zones on the banks were 15 c some below 11 c this large difference made the thermal contrast between the stream banks and groundwater discharge relatively obvious in contrast the channel temperatures in the 1st order streams tended to be lower some as cold as 15 c with the result that the thermal contrast of groundwater discharge along the stream banks were less apparent with tir and the viable survey season was shorter channel temperatures approached groundwater temperatures earlier in the fall and remained lower later in the spring cooler stream channels in the small streams are likely a combination of land cover the small streams were predominantly in forested areas with closed canopies whereas the paddled section had an open canopy and were bordered by agricultural and developed land elevation and overall groundwater dominance of streamflow in summer the smaller temperature differentials finer survey resolution and shorter survey lengths in the small streams made it more difficult to distinguish river sections with a varying density of groundwater discharge areas as compared to the larger river 4 1 3 the scale of simulated groundwater discharge the resolution of simulated groundwater discharge is a function of the model resolution the resolution of the input data and the available calibration data most input data for river network scale groundwater models is of a coarser resolution than the model cell for example important drivers of groundwater discharge including the thickness and permeability of surficial materials and bedrock as well as groundwater recharge rates are generally known only at a resolution much coarser than the model grid in addition local scale heterogeneity in calibrated hydraulic conductivity patterns is constrained by both the spacing of the pilot points and the available calibration data increasing the density of pilot points without a corresponding density of observation data however will not increase heterogeneity in calibrated values because in the absence of data hydraulic conductivity values will reflect default values 4 1 4 integration insights in the 3rd and 5th order rivers the resolution of the model groundwater discharge drivers and survey method matched well the model resolution is relatively coarse 300 m or 100 m and is expected to reflect the general coarse scale patterns the 3rd and 5th order rivers traverse a large area of relatively high hydraulic conductivity sediments coarse and fine grained stratified sediments creating large areas of groundwater discharge that were easily observed and modeled in the 5th order river we were able to paddle extensive distances 3 5 km per day and the combination of longer survey lengths and larger discharges allowed us to identify spatial patterns of groundwater discharge at a similar coarse resolution as the model resolution likewise the 3rd order survey lengths were long enough to distinguish between areas of higher and lower discharge location density in both the 3rd and 5th order rivers the better performing models distinguished gradients of observed discharge location density not only the difference between areas with and without observed discharge locations in contrast within the 1st and 2nd order stream sites the resolution of the model groundwater discharge drivers and survey method did not match the model resolution was the same 300 m or 100 m relatively coarse as in the larger river in 1st and 2nd order streams discharge is more strongly controlled by local scale topography preferential flow paths and surficial material patterns than by regional features it is likely that the resulting spatial patterns of groundwater discharge were below the resolution of the coarse scale model even when we reduced the resolution to 100 m for example the complex near surface geology that is common in headwaters areas such as near surface or scoured to bedrock dynamics and the prevalence of low permeability till that inhibits discharge even where predicted based on water table elevations is not well represented in the groundwater models in addition the survey resolution was fine which may have matched well with the resolution of the drivers of groundwater discharge but not with the groundwater flow model 4 2 using tir at the river network scale for groundwater model evaluation use of tir at the river network scale requires multiple survey methods river size and morphology determine how each stream or river can be accessed and surveyed in this study wading would have been impractical or unsafe in the larger river and paddling impossible in the smaller streams we were unable to survey high gradient or high velocity streams due to practical and safety considerations the use of airborne tir on unmanned aerial systems could allow surveys in these otherwise inaccessible reaches harvey et al 2019 but cannot be used in small forested settings with a closed canopy and likely would result in coarser resolution than our paddled surveys due to faster travel compared to paddling different tir survey methods as demonstrated in this study have differing spatial resolutions that must be acknowledged and addressed in investigations across stream and river sizes one aspect of addressing the differing spatial resolutions could be analyzing data from different tir survey types separately as well as developing consistent survey metrics to classify observed discharge locations it is also important to ensure sufficient survey lengths to adequately distinguish between river lengths with higher and lower densities of groundwater discharge zones we found this challenging in the small streams but easy in the larger river finally it will be important to consider the optimum comparison metric for tir and simulated discharge we used two metrics 1 a binary presence absence metric which is simple but does not capture variation in observed discharge and 2 a correlation of observed discharge location density and simulated groundwater discharge particularly in the small streams where wading results in high resolution surveys metrics that capture the extent of discharge and not simply the presence absence are needed other possibilities include a qualitative metric based on site observations e g presence of visible flow or channels in the sediment simulated discharge from groundwater models includes both discharge above the waterline and submerged seeps another possible limitation of tir is that it assumes the majority of the discharge occurs above the waterline i e bank seeps so submerged discharge zones in deeper faster water may be missed in river systems however discharge is typically weighted toward the water line due to expected highest hydraulic gradients and generally decreases with distance from shore exponentially in homogeneous sediments anibas et al 2011 also fines tend to accumulate in deeper water forming a low k cap that inhibits discharge while fines are actively scoured by wave action along the water line rosenberry et al 2015 we conducted one survey during an extensive reservoir draw down that exposed the majority of the streambed and the seeps we observed were at the pre draw down water line together these suggest that submerged discharge zones are a relatively minor component of the total groundwater discharge and will not substantially limit the use of tir for mapping areas of groundwater discharge or evaluating groundwater flow models in systems similar to our study watershed across all stream sizes the models predicted groundwater discharge in most model cells with rivers including where we did not observe preferential bank discharge zones with tir fig 5 the presence of modeled discharge in areas without tir observed discharge zones could be a result of both the limitations of tir imaging and model deficiencies which we cannot distinguish here higher predicted rates in areas without visible preferential groundwater discharge could reflect widespread spatially diffuse discharge and or discharge below the water surface that is not adequately mapped with tir imaging since it is based on strong thermal anomalies and does not penetrate the water surface conversely the higher rates could indicate areas where the models do not accurately represent the processes driving groundwater discharge for example areas with greater local scale heterogeneity in hydraulic conductivity values and variable depth to bedrock may not be well modeled 4 3 implications for modeling groundwater discharge at the river network scale we found that a common approach to modeling groundwater successfully predicted broad patterns of groundwater discharge but failed to predict local patterns within headwaters sites in the 3rd and 5th order rivers discharge patterns were robust across model variations within 1st order streams only 1 model surfmatzone weakly distinguished between areas with and without observed discharge locations and no model predicted the observed patterns in the 2nd order stream this work suggests several important implications for improved modeling of groundwater discharge at the river network scale first modeling efforts should focus on improving predicted discharge patterns in smaller reaches particularly in areas of glacial till and near surface bedrock this might involve finer resolution data on surficial material type and thickness calibrating by zones based on stream order as was the case for the surfmatzone model or better representing the bi directional nature of river aquifer exchange in headwaters areas geophysical methods could be used to better map the thickness and character of sediments in stream corridors auken et al 2017 mclachlan et al 2017 second bedrock hydraulic conductivity values should be calibrated not based on established literature values although this increased the computational requirements of calibration and requires data on groundwater heads in bedrock we found that it improved the accuracy of predicted discharge patterns third careful attention should be paid to the conceptualization of river aquifer exchange this is particularly true in the smaller streams where bi directional exchange between groundwater and surface water can be particularly complex payn et al 2009 varying the magnitude of the riverbed hydraulic conductivity improved the model fit in some instances but created unreasonably large fluxes from river to aquifer in other locations eliminating losing reaches limiting river aquifer exchange to discharge improved the model fit in some cases but prevents accurate representation of losing reaches 4 4 next steps this work takes an important step in evaluating spatial patterns of groundwater discharge at the river network scale and demonstrating the viability of comparing groundwater flow model predictions to observed groundwater discharge zone spatial clustering improving this approach will involve more spatially expansive field surveys that better cover the extensive headwater stream lengths for example at most of the waded non boatable sites the survey length was less than 800 m longer surveys in these sites may have highlighted more within site variation in this project we were limited to stream reaches that were accessible through wading or paddling recent advances in remote sensing of groundwater discharge using tir and unmanned aerial surveys offer a potential methodology to survey reaches through steep or wetland areas that were inaccessible in our work briggs et al 2019 harvey et al 2019 though forested headwater streams will remain challenging for aerial surveys extensive spatial surveys have the potential to be used as a numerical calibration target if a method is developed to convert predicted discharge rates to a probability of observing discharge in the field possibly incorporating channel and landscape geomorphology e g dugdale et al 2015 in addition although tir provides an easy method of identifying groundwater discharge zones it does not enable quantification of discharge rates or identification of losing reaches using tir in combination with a toolbox of quantification approaches flow tracers weirs vertical temperature profilers differential gaging etc may provide the best evaluation of groundwater discharge patterns for this study we compared model results to general spatial patterns of observed groundwater discharge zones the use of additional field methodology beyond tir will also allow comparison to discharge rate presuming field measured fluxes can be aggregated at the model grid cell scale 5 conclusions we demonstrate an approach to using tir to assess model cell scale groundwater discharge patterns predicted by river network scale groundwater flow models the spatial patterns of discharge identified by tir provided a way to differentiate between the performance of the models and to evaluate the modeled patterns in the larger 3rd and 5th order rivers spatial patterns of discharge were relatively well represented by most models particularly those where the bedrock hydraulic conductivity was calibrated instead of based on literature values in smaller streams 1st and 2nd order most models did not simulate the observed groundwater discharge patterns more spatially extensive surveys including remotely sensed tir mapping combined with a toolbox of discharge quantification methods can further refine this work and provide a spatially distributed groundwater discharge target for numerical calibration in addition new approaches are needed for simulating groundwater discharge in headwater streams and may necessitate refined geologic data credit authorship contribution statement j r barclay conceptualization methodology investigation data curation formal analysis writing original draft visualization m a briggs conceptualization methodology investigation writing review editing e m moore investigation data curation j j starn conceptualization methodology software a e h hanson investigation a m helton conceptualization methodology investigation writing review editing supervision funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments and data we would like to thank katie skalak usgs and the anonymous reviewers who gave helpful feedback on an early version of this manuscript we would also like to thank adam haynes kevin jackson and numerous students at the university of connecticut and interns at the usgs for assistance in the field surveys this research was supported by agriculture and food research initiative competitive grant no 2014 38420 21802 from the usda national institute of food and agriculture national science foundation division of earth sciences award 1824820 usda national institute of food and agriculture hatch projects cons00938 and 1016783 connecticut institute for water resources 104b grant 2017ct306b the us geological survey toxic substances hydrology program the us geological survey 2017 cooperative summer training program a geological society of america graduate student research grant 2017 and student travel grants 2016 and 2018 three pre doctoral fellowships from the university of connecticut 2016 2017 and 2018 and a scholarship from the new england outdoor writers association tir images and model results are available in barclay et al 2019 https doi org 10 5066 p9eiv8l5 moore et al 2020 https doi org 10 5066 p915e8jy and barclay et al 2020b https doi org 10 5066 p960rskm any use of trade firm or product names is for descriptive purposes only and does not imply endorsement by the u s government 
211,predicting baseflow dynamics protecting aquatic habitat and managing legacy contaminants requires explicit characterization and prediction of groundwater discharge patterns throughout river networks using handheld thermal infrared tir cameras we surveyed 47 km of stream length across the farmington river watershed 1 570 km2 ct and ma usa mapping locations of bank and waterline groundwater discharges based on their thermal signature using the observed groundwater discharge locations and predicted groundwater discharge rates from 6 variations of a numerical groundwater flow model modflow nwt we compared 1 predicted groundwater discharge rates in areas with and without observed groundwater discharge 2 spatial patterns of observed and predicted groundwater discharge locations and 3 density of observed groundwater discharge locations with predicted discharge rates five of six models reasonably predicted the spatial patterns of discharge locations along the 5th order mainstem but fewer models predicted groundwater discharge patterns in smaller streams our results highlight 1 the feasibility of using tir observations to evaluate groundwater models 2 model parameters that influence discharge prediction accuracy riverbed sediment and bedrock hydraulic conductivity and river aquifer connections and 3 current strengths and future opportunities for improved modeling of groundwater discharge patterns keywords groundwater discharge seepage thermal infrared modflow model evaluation 1 introduction model predictions of spatially explicit groundwater discharge patterns along stream networks are not often evaluated using field observations however accurate prediction regarding the spatial distribution and other physical characteristics of groundwater discharge to streams and rivers is critical for protecting aquatic habitat and managing contaminant inputs to streams briggs and hare 2018 dent et al 2001 torgersen et al 2012 for example identifying the locations and source depth of groundwater discharge is essential to predicting the occurrence of thermal refuges and refugia in the face of climate change hare et al 2021 johnson et al 2020 similarly groundwater flowpath depth and discharge location are important for understanding nitrogen loads to river systems kolbe et al 2019 wherry et al 2021 accurate prediction of groundwater discharge across river networks however remains challenging due to gaps in model evaluation and a lack of field data at model relevant spatial extents and resolutions barclay et al 2020a groundwater models are commonly implemented at the river network scale drainage areas 103 km2 and simulate groundwater discharge to streams and rivers at the model cell resolution model specific typically hundreds of meters befus et al 2017 feinstein et al 2010 masterson et al 2016 sanford et al 2012 this suggests that groundwater models can simulate sub reach heterogeneity in groundwater discharge at the spatial extent of river networks yet the accuracy of simulated discharge patterns has not been assessed at this scale recently barclay et al 2020a demonstrated that groundwater models modflow nwt n 11 with identical recharge inputs but differing parameterization resulted in similar fit to observed water levels but 1 differences of 50 in the fraction of groundwater discharge directed to 1st order streams 2 three fold differences in simulated source groundwater flowpath depth and 3 seven fold differences in subsurface travel times among models differences of this magnitude in simulated flow distribution could have consequential implications for maintaining environmental flows including stream temperature managing contaminant legacies or understanding nutrient processing barlow and leake 2012 barnes et al 2018 chen et al 2018 kolbe et al 2019 kurylyk et al 2015 this lack of precision regarding critical physical characteristics of groundwater discharge across a river network highlights the need for new approaches to evaluate and refine simulated patterns of discharge such as the position along the river network calibration or evaluation data for groundwater flow models commonly include groundwater head stream elevation stream discharge in sub basins and occasionally age tracer data sanford 2011 starn and brown 2007 information on spatial patterning of groundwater discharge seepage to streams is typically not included although discharge rates from individual groundwater discharge zones vaccaro 2011 yager et al 2008 2007 and discharge patterns in small watersheds 50 km2 ala aho et al 2015 danielescu et al 2009 glaser et al 2016 jeannot et al 2019 have been used in a few instances studies that explicitly assess sub reach hundreds of meters spatial patterns of simulated groundwater discharge across larger watersheds 103 km2 are lacking this absence of assessment is due in part to a lack of empirical data that can be meaningfully compared to modeled discharge patterns and a lack of approaches for incorporating new types of field data into the modeling process existing empirical approaches typically identify and quantify groundwater discharge at the point to reach scale discrete lengths of river typically hundreds of meters to a few kilometers but neither point measurement nor reach scale aggregations of groundwater discharge are straightforward to compare to model outputs due to mismatches in measurement and model resolution at discrete points seepage meters and temperature profilers can be robust for quantifying groundwater discharge below the waterline under favorable conditions caissie and luce 2017 irvine et al 2016 rosenberry 2008 but measuring the total groundwater discharge for a single model cell using physical point measurements would require many time consuming individual measurements as extreme heterogeneity precludes interpolation this is impractical over spatial extents comparable to most predictive models spanning the reach and point scale fiber optic distributed temperature sensing fo dts can identify spatial patterns of groundwater discharge along linear cables at sub meter resolution as well as high frequency 15 min intervals temporal variation in groundwater discharge hare et al 2015 matheswaran et al 2014 groundwater discharge observations made with fo dts can be easily aggregated to the model resolution but deploying and managing the cables requires at least a week per 2 3 km length of river making them impractical for river network scale applications at the reach scale hundreds of meters chemical tracers and differential gaging allow calculation of aggregate groundwater discharge assuming conservation of mass kalbus et al 2006 kilpatrick and cobb 1985 mccallum et al 2012 xie et al 2016 but net groundwater inflow along the measurement reach must be relatively large compared to streamflow for groundwater inputs to be captured with confidence and spatially explicit discharge information is lost network scale groundwater discharge analysis conducted using baseflow separation techniques are useful in testing net groundwater exchange as baseflow predictions cartwright and miller 2021 miller et al 2017 but as with tracer injections specific discharge zone information is not preserved newly refined remote sensing and geophysical based methodologies offer promise in better aligning the scales of discharge specific field data collection and watershed groundwater flow model resolution briggs and hare 2018 toran et al 2015 in particular thermal infrared imagery tir e g ala aho et al 2015 briggs et al 2016 schuetz and weiler 2011 which greatly enhances potential spatial coverage while preserving high spatial resolution of discharge zone mapping briggs and hare 2018 may be an ideal empirical method for integrating with river network scale groundwater models tir provides a time specific map of water surface and bank temperatures along contiguous surveys this surface temperature map can be used to identify zones or areas of preferential groundwater discharge at times of year with contrasting groundwater and surface water or stream bank temperatures torgersen et al 2001 preferential groundwater discharge differs from spatially diffuse discharge in that groundwater emerges at a relatively high flux rate in discrete patches such that source groundwater temperature signatures are preserved allowing identification via heat tracing briggs and hare 2018 generally groundwater discharge observed with tir at or above the water line on riverbanks occurs as discrete points at the sub meter scale or when multiple discharge points occur in close proximity over more extensive tens of meters bank areas as preferential discharge faces mundy et al 2017 drone based tir has recently been applied to the evaluation of groundwater discharge based large wetland restoration design harvey et al 2019 validation of discharge patterns from integrated hydrologic models in small 5 km2 watersheds using handheld instruments glaser et al 2016 jeannot et al 2019 and mapping potential thermal refugia zones based on the occurrence of discharge faces along higher order rivers across hundreds of kilometers using airborne platforms ala aho et al 2015 dugdale et al 2015 field surveys conducted with tir have the potential to provide field observations at a spatial extent and resolution that can be meaningfully compared with river network scale groundwater flow models tir is more efficient to implement than other empirical methods e g seepage meters differential gaging chemical tracers though unlike several such methods tir cannot be used to determine groundwater discharge flux rates except potentially under highly specific circumstances such as frozen discharge faces pandey et al 2013 warm weather riverbank discharge plume size and temperature is governed by a range of localized hydrodynamic factors and relatively cold discharge water tends to plunge downward into the water column out of the view of tir hampering efforts to directly infer discharge rates from tir images however tir can be used to quickly identify discharge areas or zones across contiguous space in perhaps a more complete manner than any other current groundwater surface water exchange processes methodology the mapped locations of observed preferential groundwater discharge particularly when they occur along more extensive discharge faces could potentially be used to evaluate spatial patterns of groundwater discharge predicted by river network scale flow models as the development of discharge faces is likely driven by geologic and hydraulic factors more similar to model scales than singular discharge points our primary objective in this study was to test the utility of tir based field measurements of preferential groundwater discharge points and faces for evaluating model cell scale spatial patterns of groundwater discharge predicted by a river network scale groundwater model this is a substantial step towards resolving the disparate scales of detailed stream reach field studies and coarse river network scale simulations in this project we characterized spatial patterns of groundwater discharge at the river network scale using extensive tir field surveys and then evaluated six groundwater models for a 5th order watershed representing different spatial patterns of groundwater discharge but similar model fit metrics to groundwater levels barclay et al 2020a against the field observations ultimately this study demonstrates an approach to field verifying the predicted spatial patterns of groundwater discharge from river network scale groundwater models thereby highlighting areas for future improvement in our ability to simulate groundwater discharge at the river network scale 2 methods briefly we characterized spatial patterns of preferential groundwater discharge across a river network using spatially extensive ground based tir field surveys then compared these empirical results to river network scale groundwater flow models we surveyed 47 km of total stream length across stream orders with tir imagery to map areas of groundwater discharge across headwater areas 3rd order tributaries and the mainstem of a 5th order watershed we then selected six meaningful physical variations of a previously published groundwater flow model barclay et al 2020a 2020b with similar calibration fit metrics but differing predicted spatial patterns of groundwater discharge we used the field mapped spatial distributions of groundwater discharge locations to evaluate predicted patterns of groundwater discharge from the calibrated models this independent evaluation of the models with observed spatial patterns of discharge is not typical for groundwater models and is a unique strength of our approach details of our methods are given in the following sections 2 1 site description the study site was the farmington river watershed ma and ct usa fig 1 the farmington river drains an area of 1570 km2 and is a 5th order tributary of the connecticut river glacial till overlies crystalline bedrock over most of the watershed with areas of stratified glacial sediments over sedimentary rock in the river valleys olcott 1995 soller et al 2012 previous geophysical mapping has indicated that groundwater discharge patterns may be driven in part by near surface bedrock type in addition to the unconsolidated surficial geology lane et al 2020 land cover is predominantly forest particularly in the central and northern regions of the watershed developed land is focused along the eastern river valley homer et al 2015 in the uplands the stream channels were predominantly cobbled with some areas of exposed bedrock and the canopies were typically closed in the eastern river valley the stream gradients were lower bed sediment was primarily coarse or fine sand and the canopy was open particularly along the 5th order section of the farmington river further description of the site is given in barclay et al 2020a 2 2 field surveys to map locations of groundwater discharge along stream banks we surveyed 47 km of non contiguous stream reaches within the farmington river watershed using tir due to practical considerations we surveyed small streams by wading walking along banks and larger rivers by canoe from the center of the channel we waded eight 1st order stream sites 4 7 km total 6 km of a 2nd order stream and three 3rd order stream sites 1 6 km total we paddled 2 7 km of a 3rd order stream and 32 km of the main stem of the farmington river 5th order table 1 we conducted the surveys over 13 days between july 6 and october 5 2017 and 7 days between august 2 and september 22 2019 streams were surveyed once though some reaches required multiple days during the surveys we scanned the banks using one of four flir cameras t640 t620 e8 and i7 flir systems www flir com with instrument emissivities set consistent with fresh water in summer 0 96 0 98 handcock et al 2012 and viewfinder temperature ranges set for the t640 t620 and e8 cameras to span stream and groundwater temperatures in areas with apparent colder thermal anomalies of multiple degrees on the banks and along waterline we collected tir images noted the latitude and longitude using a hand held gps unit garmin colorado 400t or garmin gpsmap 64 s www garmin com and recorded the subsurface 11 cm depth temperature using a precise hand held digital thermometer https www traceable com 4000 traceable digital thermometer html absolute temperatures calculated from tir images can be affected by reflected radiation baker et al 2019 handcock et al 2012 therefore we identified groundwater discharge based on multiple lines of evidence thermal anomalies in the surface temperature subsurface temperatures consistent with discharging groundwater and qualitative indicators of groundwater discharge such as wet soil or flowing water above the water line because the tir images were used for mapping the locations of cold thermal anomalies attributable to groundwater discharge and not for quantitative analysis of the absolute temperatures we did not post process the images or apply corrections to the calculated temperatures we delineated the approximate linear discharge zone length along the bank we categorized two types of preferential groundwater discharge observed along streambanks 1 preferential groundwater discharge points one or more individual sub meter scale zones of preferential discharge and 2 discharge faces extensive lengths tens to hundreds of meters long of grouped cold anomalies along the bank fig 2 in this study we use the term discharge zones to refer to all areas of groundwater discharge regardless of spatial extent and discharge point and discharge face to distinguish between spatially limited and spatially extensive areas of groundwater discharge as defined above images from the tir surveys are available in barclay et al 2019 and moore et al 2020 2 3 groundwater flow model we selected a subset n 6 of previously implemented groundwater flow models for our study site that had similar fit to groundwater level and stream elevation calibration data but varied in their predictions of spatial patterns flowpath depth and travel time of groundwater discharge barclay et al 2020a similarities across models are described here differences are discussed in the next paragraph the models were developed in modflow nwt niswonger et al 2011 and they simulate flow under steady state conditions with a uniform horizontal grid and 4 vertical layers the unconsolidated surficial materials are split vertically into three layers with decreasing horizontal hydraulic conductivity with depth the lowest layer is a bedrock layer the horizontal hydraulic conductivity was calibrated using pest welter et al 2015 mean head measurements from 990 wells and water levels from 1st order streams in flat areas land surface slope 2 and a grid of pilot points pilot points are preselected points at which hydraulic conductivity is calibrated hydraulic conductivity at all other locations is interpolated from the pilot points simulated water levels were compared to head measurements from 984 wells and 525 stream water levels with root mean squared errors rmse ranging from 9 8 to 11 6 m table 2 the models were also evaluated using an overallerror metric defined as the percent of flooded terrestrial cells incorrectly simulated as flooded plus the percent of dry river cells incorrectly simulated as dry plus a penalty for excessive losing river reaches in excess of 5 percent of recharge the overallerror metric is based on the work of starn and belitz 2018 the selected models differ in the zonation of pilot points degree of variation in bedrock and riverbed hydraulic conductivity allowed directionality of river aquifer exchange and horizontal grid resolution table 2 the initial model was developed based on readily available data and common simplifying assumptions it has a 300 m horizontal grid uniform riverbed hydraulic conductivity 0 1 m d 1 literature based bedrock hydraulic conductivity domenico and schwartz 1997 u s geological survey 2007 and a 4000 m grid of pilot points streams were simulated using the riv package which allows stream reaches to be net gaining or losing at the model cell resolution harbaugh 2005 in surfmatzone the pilot points are assigned to one of four zones based on surficial material type glacial till coarse stratified sediments fine stratified sediments and open water and a finer grid 1000 m was used for the pilot points in the coarse sediments fine sediments and open water zones because these zones occupied a smaller area where the 4000 m spacing was impractical 442 pilot points total vs 102 with the initial model riverbedk is identical to the initial model except that the riverbed hydraulic conductivity is spatially varying and assigned as 0 01 times the hydraulic conductivity of the surrounding surficial material rivk bedk is similar to riverbedk except that the hydraulic conductivity in the bedrock is calibrated on a 4000 m grid of pilot points rather than being based on literature values highres is identical to rivk bedk except that the grid cell size is reduced to 100 m finally rivk bedk drn is similar to rivk bedk except that rivers are represented using the drn package in modflow which allows flow only from aquifer to river streams are all gaining or disconnected instead of the riv package harbaugh 2005 further details of model development are available in barclay et al 2020a and the model input and output files are available in barclay et al 2020b despite the similarity in model fit as indicated by the rmse and the overallerror metrics the models had substantial differences in groundwater flowpath characteristics table 2 and fig 3 for example the fraction of groundwater discharge directed to small 1st order streams ranged by a factor of 1 4 from 29 40 the median travel time ranged by a factor of 3 8 from 1 1 to 4 2 years and the median flowpath depth ranged by a factor of 2 6 from 6 8 to 17 9 m table 2 similar differences in simulated discharge characteristics were seen in the subset of reaches included in the field surveys of this study fig 3 for example mean groundwater discharge rates to 1st order streams ranged by a factor of 4 from 0 4 to 1 2 m3m 1d 1 with a mean of 0 8 m3m 1d 1 in this paper simulated discharge rates are expressed as a volume of discharge per length of stream per day 2 4 comparing locations of modeled and observed groundwater discharge to evaluate the simulated spatial patterns of groundwater discharge we compared the simulated discharge predictions with our field observations of preferential discharge points and faces first we quantitatively compared simulated groundwater discharge rates in sections with and without observed groundwater discharge locations based on our field observations model cells were classified into two groups by the presence or absence of observed areas of groundwater discharge regardless of the number or spatial extent of the observed discharge and we analyzed statistical differences in mean modeled discharge rate between the two groups models with statistically significant differences at the p 0 05 level were considered strongly distinguishing and at the 0 05 p 0 1 level were considered weakly distinguishing all other models were considered poorly performing we considered the stream sections by stream order due to differences in simulated discharge rate and survey length we analyzed all data at the model cell resolution and also aggregated the observations and simulated discharge rates to stream lengths of approximately 500 m for the 5th order river observations were not aggregated in the small streams due to short survey lengths we determined statistically significant differences using a comparison of means that does not require normality equal variance or equal sample size herberich et al 2010 all statistical analyses were completed in r r core team 2019 finally we qualitatively and semi quantitatively compared the observed and simulated spatial patterns of groundwater discharge across models and within and across sites for each stream order to semi quantitatively analyze the spatial patterns of groundwater discharge we calculated the correlations between the simulated discharge rate and the observed discharge density number of locations per length of stream faces were counted once for every 10 m of length for each stream order we calculated the correlations at the model cell resolution and for the 1st 3rd order surveys across sites sub sites and for the 5th order survey at aggregated lengths of approximately 500 m 1 km and 2 km because the survey lengths varied substantially among 1st 3rd order stream sites sites with long survey lengths were subdivided into subsites with lengths similar to the median for the stream order we compared the discharge location density to the simulated discharge rate using a parametric correlation pearson s r for normally distributed model survey pairings and a non parametric correlation spearman s rho for the other pairings models with statistically significant p 0 05 correlations between observed discharge location density and simulated discharge were considered better performing models 3 results we observed preferential groundwater discharge at or above the waterline in all mapped stream sections but discharge points and faces were not evenly distributed along sections and varied in occurrence between sections further some discharge zones were clearly higher flux based on visible bank surface flow fig 2b colder groundwater with discharge temperature approaching the annual surface mean 6 9 10 5 c prism climate group 2012 while other zones of presumed lower flux based on the absence of visible flow discharge were of warmer temperatures discharge faces in the 5th order river tended to be longer in length e g fig 2a than discharge faces in the smaller streams though there was substantial variation also some discharge zones in the 5th order river had flow channels visible in the infrared note the dark blue flow lines in fig 2a or visible color images without infrared temperatures in the observed groundwater discharge zones were consistent with groundwater temperatures in our study area interquartile range 10 0 13 0 c mean 11 5 c u s geological survey 2020 fig 4 bank surface temperatures from the tir images ranged from 7 1 to 16 6 c and subsurface 11 cm depth temperatures ranged from 7 9 to 16 0 c with most groundwater discharge zones between 10 and 15 c on both the surface and in the subsurface even at similar elevation groundwater can be expected to show a range of temperatures in summer based on the depth of the contributing flowpath briggs et al 2018 most of the coldest discharge zones surface temperature 9 5 c or subsurface temperature 11 0 c were in the 5th order survey though they were typically separated by warmer discharge zones and hundreds of meters of inactive banks groundwater discharge zones were not uniformly distributed along stream reaches in both the larger river and smaller streams groundwater discharge points tended to cluster figs 4 and 5 so that some stream sections contained multiple discharge points and others were relatively inactive the grouping of discharge faces is even more pronounced fig 5 in the upstream 10 km of the larger river survey we observed no discharge faces but in the next 12 km we observed 12 distinct discharge faces covering approximately 1 5 km of river length during the 1st to 3rd order stream surveys we only observed discharge faces at 7 out of 16 sites salmon brook sites 9 10 13 14 and 15 morgan brook site 4 and the tributary to scott swamp brook site 8 most of the discharge faces found in 1st to 3rd order streams are tens of meters in extent 3 1 model evaluation 3 1 1 predicted groundwater discharge in areas with and without observed discharge zones in the 5th order river most models predicted significantly higher rates of groundwater discharge in areas where we observed groundwater discharge than in areas without observed discharge zones when the observations and simulated rates were aggregated to stream lengths of approximately 500 m p 0 05 fig 6 bottom row the one model that did not predict a statistically significant difference between areas with and without observed discharge zones in the larger river was surfmatzone where the pilot points were assigned to zones based on the surrounding surficial material the source of this misfit in the larger river with the surfmatzone model may be anomalously high calibrated hydraulic conductivity values in coarse stratified sediments median for surfmatzone 243 m d 1 vs 39 44 m d 1 for all other models when the observations and simulated discharge rates were compared at the model cell resolution 100 m for highres 300 m for all other models only the highres model weakly predicted higher rates of groundwater discharge in areas where we observed groundwater discharge than in areas without observed groundwater discharge zones p 0 10 in contrast in the smaller streams and rivers 1st 3rd order fig 6 rows 1 through 3 fewer models aligned with observed discharge patterns i e predicted significantly higher rates of groundwater discharge in areas with tir observed discharge zones p 0 05 fig 6 rows 1 through 3 with greater agreement in 3rd order rivers than in 1st and 2nd order streams the best performing model across 1st 2nd and 3rd order streams was surfmatzone where calibration is by surficial deposit zones this is in contrast to the larger river where surfmatzone performed poorly the differences in mean simulated discharge rates between areas with and without observed discharge zones was smaller for 1st and 2nd order streams differences of 0 18 m3d 1 and 0 87 m3d 1 respectively across all models the negatives indicate that some models predicted higher discharge rates where we observed no discharge than where we observed discharge than for 3rd order rivers mean difference of 1 77 m3d 1 suggesting that the models better simulated observed discharge zones in 3rd order streams than in smaller 1st and 2nd order streams 3 1 2 location comparison of modeled and observed groundwater discharge in the 5th order river all models reflected the general spatial patterns of discharge we observed fig 5d consistent with the above quantitative analysis fig 6a all models predicted relatively constant discharge from km 1 to km 10 a section where we saw little evidence of preferential bank groundwater discharge and all models predicted the apparent increase in discharge that we observed from km 11 21 none of the models predicted the increased discharge we observed in km 21 22 and only surfmatzone predicted the greater discharge we observed at km 30 32 but surfmatzone predicted discharge we did not observe along the banks at km 35 36 in the 1st 3rd order streams most models simulated similar magnitude discharge across the sites fig 5 a c notable exceptions occurred in the 1st order survey at sites 7 and 4 and in the 3rd order survey at sites 11 13 and 14 at site 7 in the 1st order survey fig 5a 3 models riverbedk highres and rivk bedk predicted substantial flow from the stream to the aquifer across the entire site while the remaining 3 models simulated near zero net discharge these models riverbedk highres and rivk bedk have spatially varying riverbed hydraulic conductivity and simulate streams using the riv package which allows net gains or losses to the stream a combination that can result in unrealistically high flows from river to aquifer although the simulation results might suggest predominantly losing conditions at site 7 this is unlikely stream temperatures at site 7 suggest substantial groundwater exchange and net gaining conditions and the lack of a stream network upstream of the site suggests streamflow is sourced locally likely from groundwater discharge more likely the groundwater models are unable to simulate the near surface water table needed to generate gaining conditions possibly due to the coarse model resolution and headwaters location at site 4 in the 1st order survey the three models with calibrated hydraulic conductivity in the bedrock highres rivk bedk and rivk bedk drn simulated no flow or slight losses from stream to aquifer while the other 3 models simulated gaining conditions throughout the site at site 11 in the 3rd order survey the higher resolution model highres simulated slightly different locations for the higher discharge peaks than the remaining models this could be a consequence of differing model resolutions that led to differing locations of breaks and gradients in the hydraulic conductivity at sites 13 and 14 in the 3rd order survey fig 5c surfmatzone in which hydraulic conductivity was calibrated by zones of surficial material type simulated higher rates of discharge over portions of the survey than the other models zonation of the hydraulic conductivity results in sharper breaks in the spatial patterns of the calibrated values which likely caused differing patterns of simulated discharge in the 2nd order survey all models simulated similar spatial patterns and all models simulated higher rates of discharge in the downstream end of site 10 as compared with the upstream end consistent with the increased aerial extent of observed discharge at the downstream end in summary across all stream orders the spatial alignment between simulated and observed river bank discharge patterns varied in some locations such as km 12 in the 5th order river fig 5d peaks in simulated discharge align spatially with peaks in the spatial extent of observed discharge in other locations peaks in simulated discharge occur upstream or downstream of peaks in the spatial extent of observed discharge for example in site 14 of the 3rd order river fig 5c a peak in simulated discharge occurs slightly upstream of an extensive area of observed groundwater discharge misalignment in simulated and observed discharge locations is more likely due to lack of precision in the simulated location than to errors in the mapped location of the observed discharge observed discharge was aggregated to the model cell resolution 300 m or 150 m for the highres model making it unlikely that observed discharge would be mapped to the incorrect model cell except when the discharge occurred near the cell boundary the groundwater models were based on relatively coarse datasets with hydraulic conductivity for individual cells determined by interpolation together this makes it more likely that simulated locations of high discharge will be less accurate than field mapped locations though our field mapping technique is not expected to capture direct riverbed discharge which may be substantial in some areas 3 1 3 discharge location density and simulated groundwater discharge in the 5th order survey the observed discharge density and simulated discharge were correlated for one model when the results were aggregated to 500 m lengths highres rho 0 26 n 61 p 0 05 and weakly correlated for five model aggregation pairs rivk bedk rho 0 21 500 m lengths n 61 rivk bedk drn rho 0 24 500 m lengths n 61 highres rho 0 34 1 km lengths n 33 rivk bedk r 0 46 1 km lengths n 17 rivk bedk drn r 0 48 2 km lengths n 17 p 0 10 in the 3rd order survey the density of observed discharge locations observations per length of stream was strongly correlated with the simulated groundwater discharge rate for three models rivk bedk r 0 73 rivk bedk drn r 0 71 surfmatzone r 0 71 p 0 05 when the results were compared across sites sub sites subdivisions of longer length surveys shown with vertical bars on the x axis in fig 5c n 8 and weakly correlated for two models surfmatzone rho 0 90 model cell resolution n 22 riverbedk r 0 67 site sub site aggregation n 8 p 0 10 in the 1st and 2nd order surveys the observed discharge location density was not significantly correlated with the simulated groundwater discharge 4 discussion accurate simulation of spatially explicit groundwater discharge characteristics at the river network scale requires an approach that links together models and empirical methods at comparable spatial resolutions we demonstrate an approach to integrating empirical tir observations of preferential groundwater discharge occurrence and river network scale groundwater flow modeling to our knowledge this is one of the most spatially extensive high resolution sets of observed groundwater discharge locations that includes small streams to date and represents a first attempt to use the spatial patterns of discharge locations to evaluate a river network scale groundwater flow model at the grid cell scale 4 1 cross scale integration of groundwater discharge physical drivers observations and simulations simulation and assessment of groundwater discharge patterns at the river network scale involves a complex cross scale integration of physical drivers of groundwater discharge empirical observation methods and groundwater models although tir provides spatially extensive observations at relevant spatial resolutions our findings suggest that scale integration challenges remain in particular we found that the river network scale models worked well in the 3rd and 5th order river reaches where the stream channels cut through a thicker sand and gravel aquifer along the 2nd order reach which also overlaid sand and gravel deposits the models accurately predicted more discharge at the end of site 10 fig 5b where extensive seep faces were also found within 1st order stream reaches where bedrock was often near surface and there was prevalence of low permeability glacial till the models did not reflect observed variation in discharge 4 1 1 the scale of physical drivers of groundwater discharge groundwater discharge is driven by three dimensional patterns of hydraulic conductivity and hydraulic head freeze and witherspoon 1967 which are driven by a complex array of patterns in groundwater recharge surficial material properties type layering thickness etc bedrock properties type layering fracture patterns etc and geomorphology slope sinuosity confinement etc haitjema and mitchell bruker 2005 winter et al 1998 these drivers operate at nested scales ranging from centimeters to tens of kilometers freeze and witherspoon 1967 rosenberry and pitlick 2009 the importance of each scale varies by network position with local drivers dominating in headwaters areas and regional drivers dominating in larger rivers but even in larger rivers fine scale patterns are important rosenberry and pitlick 2009 4 1 2 the scale of tir observations tir observation spatial resolution is a function of the temperature differential between groundwater and surface materials as well as the survey speed and distance from the discharge points by paddling down the center of the 5th order river we were able to survey multiple kilometers a day but faster travel at a longer distance from the banks resulted in a coarse resolution survey we noted the larger areas of groundwater discharge but likely not every small point in contrast slower travel while wading along small narrow streams resulted in a finer level of detail in the smaller stream surveys compared to the large river surveys even where we paddled the 3rd order river the narrower channel and lower water levels resulted in slower travel and consequently in a finer resolution survey than in the 5th order river the observed temperature differentials also differed by stream size likely due to different thermal regimes in the smaller versus larger rivers in the 5th order river reaches during late summer and early fall the temperature of the stream channel was consistently 20 c and the observed groundwater discharge zones on the banks were 15 c some below 11 c this large difference made the thermal contrast between the stream banks and groundwater discharge relatively obvious in contrast the channel temperatures in the 1st order streams tended to be lower some as cold as 15 c with the result that the thermal contrast of groundwater discharge along the stream banks were less apparent with tir and the viable survey season was shorter channel temperatures approached groundwater temperatures earlier in the fall and remained lower later in the spring cooler stream channels in the small streams are likely a combination of land cover the small streams were predominantly in forested areas with closed canopies whereas the paddled section had an open canopy and were bordered by agricultural and developed land elevation and overall groundwater dominance of streamflow in summer the smaller temperature differentials finer survey resolution and shorter survey lengths in the small streams made it more difficult to distinguish river sections with a varying density of groundwater discharge areas as compared to the larger river 4 1 3 the scale of simulated groundwater discharge the resolution of simulated groundwater discharge is a function of the model resolution the resolution of the input data and the available calibration data most input data for river network scale groundwater models is of a coarser resolution than the model cell for example important drivers of groundwater discharge including the thickness and permeability of surficial materials and bedrock as well as groundwater recharge rates are generally known only at a resolution much coarser than the model grid in addition local scale heterogeneity in calibrated hydraulic conductivity patterns is constrained by both the spacing of the pilot points and the available calibration data increasing the density of pilot points without a corresponding density of observation data however will not increase heterogeneity in calibrated values because in the absence of data hydraulic conductivity values will reflect default values 4 1 4 integration insights in the 3rd and 5th order rivers the resolution of the model groundwater discharge drivers and survey method matched well the model resolution is relatively coarse 300 m or 100 m and is expected to reflect the general coarse scale patterns the 3rd and 5th order rivers traverse a large area of relatively high hydraulic conductivity sediments coarse and fine grained stratified sediments creating large areas of groundwater discharge that were easily observed and modeled in the 5th order river we were able to paddle extensive distances 3 5 km per day and the combination of longer survey lengths and larger discharges allowed us to identify spatial patterns of groundwater discharge at a similar coarse resolution as the model resolution likewise the 3rd order survey lengths were long enough to distinguish between areas of higher and lower discharge location density in both the 3rd and 5th order rivers the better performing models distinguished gradients of observed discharge location density not only the difference between areas with and without observed discharge locations in contrast within the 1st and 2nd order stream sites the resolution of the model groundwater discharge drivers and survey method did not match the model resolution was the same 300 m or 100 m relatively coarse as in the larger river in 1st and 2nd order streams discharge is more strongly controlled by local scale topography preferential flow paths and surficial material patterns than by regional features it is likely that the resulting spatial patterns of groundwater discharge were below the resolution of the coarse scale model even when we reduced the resolution to 100 m for example the complex near surface geology that is common in headwaters areas such as near surface or scoured to bedrock dynamics and the prevalence of low permeability till that inhibits discharge even where predicted based on water table elevations is not well represented in the groundwater models in addition the survey resolution was fine which may have matched well with the resolution of the drivers of groundwater discharge but not with the groundwater flow model 4 2 using tir at the river network scale for groundwater model evaluation use of tir at the river network scale requires multiple survey methods river size and morphology determine how each stream or river can be accessed and surveyed in this study wading would have been impractical or unsafe in the larger river and paddling impossible in the smaller streams we were unable to survey high gradient or high velocity streams due to practical and safety considerations the use of airborne tir on unmanned aerial systems could allow surveys in these otherwise inaccessible reaches harvey et al 2019 but cannot be used in small forested settings with a closed canopy and likely would result in coarser resolution than our paddled surveys due to faster travel compared to paddling different tir survey methods as demonstrated in this study have differing spatial resolutions that must be acknowledged and addressed in investigations across stream and river sizes one aspect of addressing the differing spatial resolutions could be analyzing data from different tir survey types separately as well as developing consistent survey metrics to classify observed discharge locations it is also important to ensure sufficient survey lengths to adequately distinguish between river lengths with higher and lower densities of groundwater discharge zones we found this challenging in the small streams but easy in the larger river finally it will be important to consider the optimum comparison metric for tir and simulated discharge we used two metrics 1 a binary presence absence metric which is simple but does not capture variation in observed discharge and 2 a correlation of observed discharge location density and simulated groundwater discharge particularly in the small streams where wading results in high resolution surveys metrics that capture the extent of discharge and not simply the presence absence are needed other possibilities include a qualitative metric based on site observations e g presence of visible flow or channels in the sediment simulated discharge from groundwater models includes both discharge above the waterline and submerged seeps another possible limitation of tir is that it assumes the majority of the discharge occurs above the waterline i e bank seeps so submerged discharge zones in deeper faster water may be missed in river systems however discharge is typically weighted toward the water line due to expected highest hydraulic gradients and generally decreases with distance from shore exponentially in homogeneous sediments anibas et al 2011 also fines tend to accumulate in deeper water forming a low k cap that inhibits discharge while fines are actively scoured by wave action along the water line rosenberry et al 2015 we conducted one survey during an extensive reservoir draw down that exposed the majority of the streambed and the seeps we observed were at the pre draw down water line together these suggest that submerged discharge zones are a relatively minor component of the total groundwater discharge and will not substantially limit the use of tir for mapping areas of groundwater discharge or evaluating groundwater flow models in systems similar to our study watershed across all stream sizes the models predicted groundwater discharge in most model cells with rivers including where we did not observe preferential bank discharge zones with tir fig 5 the presence of modeled discharge in areas without tir observed discharge zones could be a result of both the limitations of tir imaging and model deficiencies which we cannot distinguish here higher predicted rates in areas without visible preferential groundwater discharge could reflect widespread spatially diffuse discharge and or discharge below the water surface that is not adequately mapped with tir imaging since it is based on strong thermal anomalies and does not penetrate the water surface conversely the higher rates could indicate areas where the models do not accurately represent the processes driving groundwater discharge for example areas with greater local scale heterogeneity in hydraulic conductivity values and variable depth to bedrock may not be well modeled 4 3 implications for modeling groundwater discharge at the river network scale we found that a common approach to modeling groundwater successfully predicted broad patterns of groundwater discharge but failed to predict local patterns within headwaters sites in the 3rd and 5th order rivers discharge patterns were robust across model variations within 1st order streams only 1 model surfmatzone weakly distinguished between areas with and without observed discharge locations and no model predicted the observed patterns in the 2nd order stream this work suggests several important implications for improved modeling of groundwater discharge at the river network scale first modeling efforts should focus on improving predicted discharge patterns in smaller reaches particularly in areas of glacial till and near surface bedrock this might involve finer resolution data on surficial material type and thickness calibrating by zones based on stream order as was the case for the surfmatzone model or better representing the bi directional nature of river aquifer exchange in headwaters areas geophysical methods could be used to better map the thickness and character of sediments in stream corridors auken et al 2017 mclachlan et al 2017 second bedrock hydraulic conductivity values should be calibrated not based on established literature values although this increased the computational requirements of calibration and requires data on groundwater heads in bedrock we found that it improved the accuracy of predicted discharge patterns third careful attention should be paid to the conceptualization of river aquifer exchange this is particularly true in the smaller streams where bi directional exchange between groundwater and surface water can be particularly complex payn et al 2009 varying the magnitude of the riverbed hydraulic conductivity improved the model fit in some instances but created unreasonably large fluxes from river to aquifer in other locations eliminating losing reaches limiting river aquifer exchange to discharge improved the model fit in some cases but prevents accurate representation of losing reaches 4 4 next steps this work takes an important step in evaluating spatial patterns of groundwater discharge at the river network scale and demonstrating the viability of comparing groundwater flow model predictions to observed groundwater discharge zone spatial clustering improving this approach will involve more spatially expansive field surveys that better cover the extensive headwater stream lengths for example at most of the waded non boatable sites the survey length was less than 800 m longer surveys in these sites may have highlighted more within site variation in this project we were limited to stream reaches that were accessible through wading or paddling recent advances in remote sensing of groundwater discharge using tir and unmanned aerial surveys offer a potential methodology to survey reaches through steep or wetland areas that were inaccessible in our work briggs et al 2019 harvey et al 2019 though forested headwater streams will remain challenging for aerial surveys extensive spatial surveys have the potential to be used as a numerical calibration target if a method is developed to convert predicted discharge rates to a probability of observing discharge in the field possibly incorporating channel and landscape geomorphology e g dugdale et al 2015 in addition although tir provides an easy method of identifying groundwater discharge zones it does not enable quantification of discharge rates or identification of losing reaches using tir in combination with a toolbox of quantification approaches flow tracers weirs vertical temperature profilers differential gaging etc may provide the best evaluation of groundwater discharge patterns for this study we compared model results to general spatial patterns of observed groundwater discharge zones the use of additional field methodology beyond tir will also allow comparison to discharge rate presuming field measured fluxes can be aggregated at the model grid cell scale 5 conclusions we demonstrate an approach to using tir to assess model cell scale groundwater discharge patterns predicted by river network scale groundwater flow models the spatial patterns of discharge identified by tir provided a way to differentiate between the performance of the models and to evaluate the modeled patterns in the larger 3rd and 5th order rivers spatial patterns of discharge were relatively well represented by most models particularly those where the bedrock hydraulic conductivity was calibrated instead of based on literature values in smaller streams 1st and 2nd order most models did not simulate the observed groundwater discharge patterns more spatially extensive surveys including remotely sensed tir mapping combined with a toolbox of discharge quantification methods can further refine this work and provide a spatially distributed groundwater discharge target for numerical calibration in addition new approaches are needed for simulating groundwater discharge in headwater streams and may necessitate refined geologic data credit authorship contribution statement j r barclay conceptualization methodology investigation data curation formal analysis writing original draft visualization m a briggs conceptualization methodology investigation writing review editing e m moore investigation data curation j j starn conceptualization methodology software a e h hanson investigation a m helton conceptualization methodology investigation writing review editing supervision funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments and data we would like to thank katie skalak usgs and the anonymous reviewers who gave helpful feedback on an early version of this manuscript we would also like to thank adam haynes kevin jackson and numerous students at the university of connecticut and interns at the usgs for assistance in the field surveys this research was supported by agriculture and food research initiative competitive grant no 2014 38420 21802 from the usda national institute of food and agriculture national science foundation division of earth sciences award 1824820 usda national institute of food and agriculture hatch projects cons00938 and 1016783 connecticut institute for water resources 104b grant 2017ct306b the us geological survey toxic substances hydrology program the us geological survey 2017 cooperative summer training program a geological society of america graduate student research grant 2017 and student travel grants 2016 and 2018 three pre doctoral fellowships from the university of connecticut 2016 2017 and 2018 and a scholarship from the new england outdoor writers association tir images and model results are available in barclay et al 2019 https doi org 10 5066 p9eiv8l5 moore et al 2020 https doi org 10 5066 p915e8jy and barclay et al 2020b https doi org 10 5066 p960rskm any use of trade firm or product names is for descriptive purposes only and does not imply endorsement by the u s government 
212,the numerical modelling of ionic diffusive transport through a charged thin film of electrolyte is mathematically and computationally complex due to the strongly coupled hydrodynamics and electrochemical interactions generally simulations are performed by solving the poisson equation together with the nernst planck flux formula to model electrochemical processes in electro diffusion problems one important application of these system of equations to study the interaction of ionic diffusion and thin film hydrodynamics in petroleum engineering however due to the highly nonlinear and coupled equations the computational costs are heavy and very often limited to simulations in two dimensional geometries in this article we have developed an equivalent one dimensional electro diffusive transport model based on mathematical averaging of 2d equations to reduce the computational time doing so the computational time is improved substantially and simulation of much larger domain sizes which are required to study and interpret the experimental results is shown to be feasible we have shown the high accuracy of the developed model by comparing the electric potential and concentration profiles of the developed model against the original 2d simulations the developed approach reduces the computational effort by over 200 times without losing accuracy keywords thin film hydrodynamics electrochemical potential charged surface coupled process poisson nernst planck equations 1 introduction poisson nernst planck pnp equations are widely used to describe transport of ions in various applications including chemistry physics biology and engineering suopaiarvi 2015 bazant et al 2009 eisenberg 1998 kurnikova et al 1999 selberherr 1984 poisson equation is used to describe the electrical potential and the nernst planck equation is applied to include the electric double layer effects in the transport of ions through a thin layer of electrolyte applying pnp equations in numerical modelling with application to membrane electrochemistry dates back to 1975 in the work of cohen and cooley and that of brumleve and buck cohen and cooley 1965 brumleve and buck 1978 use of pnp equations allows the computation of the space charge density near an interface which may represent a solution electrode or solution ion exchange membrane interface uzdenova et al 2018 in addition pnp equations are also known as the drift diffusion equations and are used for simulating ion diffusion in semiconductor devices markowich 1986 rouston 1990 newman 1991 in these systems the diffusion of ions is affected by the excess chemical potential produced by the mobile ions another application of pnp equations is in biological membrane channels ardenas et al 2000 hollerbach et al 2000 coalson and kurnikova 2005 where the underlying mechanisms for ion transport through such channels are studied to understand the cellular activities of the living cells eisenman and dani 1987 hille 1978 moreover the pnp equations have been applied for solving ion transport in general nano to macro scale charged porous media pivonka et al 2009 mohajeri et al 2010 they can be also applied for describing special mechanisms behind the flow and transport behaviors in unconventional reservoirs in these systems the widespread nanopores are often considered as the main cause of significant capillary and confinement effects zhang et al 2020 designed a digital twin platform by which they combined several promising numerical models and multiscale algorithms their model approach covered all the effects of capillarity sorption and salinity to simulate and illustrate the effect of these mechanisms on flow and transport phenomena and the production of unconventional reservoirs they mentioned water salinity as one of the key factors affecting injection and fracturing performance for the two directly relevant processes to salinity they used multicomponent ion exchange equation and dlvo theory to represent the electrical interaction process and the double layer expansion respectively the poisson boltzmann equation was used to model electrostatic double layer force and the effect of dynamic sorption was represented by the nernst planck equation moreover numerous studies on unconventional oil and gas production indicate that under confinement the fluid behavior deviates from its bulk behavior alharthy et al 2013 chen et al 2013 du and chu 2012 thus phase behavior modelling becomes significant as the change of reservoir fluid properties could affect the flow mechanisms and displacement processes since the nano scale pore yields a large capillary pressure capillary effect should be considered in modelling phase behaviors in unconventional reservoirs sun 2019 in this regard a well developed flash calculation scheme which is stablished at fixed chemical composition n volume v and temperature t known as nvt flash was established by zhang et al 2020 their trained model was capable of accurately estimating the phase behavior of complex reservoir fluids under a wide range of environmental conditions in the presence of capillary pressure for electrically charged nano porous materials such as electrodes the formation of electrical double layer edl considerably influences the transport and electro sorption of ions inside the nanopores this phenomenon leads to changes in pore accessibility zhang and tartakovsky 2017 damiani et al 2021 developed a reactive transport model based on the pnp to simulate diffusion of ions through a charged constricted pore their work contributed to the understanding of electrochemical migration of ions caused by changes in electric fields under various chemically reactive conditions such as those related to the swelling of clay minerals the complex composition of mineral surfaces in geological media either chemical heterogeneity or pore property poses challenges in accurate description of ionic transport in porous media naidu et al 1994 norde and lyklema 1978 for example in simulation of electrokinetic processes in fluid saturated porous materials ζ potential is a fundamental property for charged surfaces that represents approximately the electrical potential at the mineral fluid interface pride 1994 revil and pezard 1999 considered a silica dominated porous material filled with a binary symmetric 1 1 electrolyte such as nacl they developed analytical expressions for ζ potential and the specific surface conductance and predicted the variation of these parameters with the pore fluid salinity temperature and ph in the field of particle transport trefalt et al 2016 discussed the effect of charge regulation in electrical double layer edl on the interaction between colloids and interfaces by using the classical poisson boltzmann theory several researchers have proposed theories to explain the impact of interfacial properties on macroscopic transport alizadeh et al 2019 liu et al 2020 yet an accurate simulation of electrochemical processes in the presence of dynamic changes in electrical potential and ionic concentration induced by the alteration of solid charged surfaces and the surrounding electrolyte remains a challenging task considering clayey soil as a notable example of charged porous media different studies worked on flow ion and chemical transport and deformation in these systems kirby 2010 mahani 2015 niasar and mahani 2016 mahani 2015 used a model system for sandstone rock consisting of clay minerals deposited at the glass substrate and oil droplets which were attached to clay patches separately their study was under the assumption of hydrodynamic equilibrium between the oil phase and the surrounding water they studied ion diffusion and transport when the system is exposed to two different brine solutions having low and high salinity values later they studied the dlvo intermolecular forces by considering electrostatic forces and including osmotic pressure to understand the dynamics of disjoining pressure inside a thin film of electrolyte niasar and mahani 2016 they coupled the nernst planck ionic transport and poisson equations with navier stokes equation in order to describe the disjoining pressure and investigate its impact on the transport of ions within the thin film they found that the nonlinear behaviour in the pressure field which is caused by multidirectional and asymmetric ions transport is strongly affected by the diffusion length and the overlapping of edl while the coupled pnp model provides quantitative prediction of ion transport problem in many areas it has its own limitations such as neglecting the finite size effect of ion particles and correlation effect i e self energy which may become important in very confined channels jung et al 2009 concerning model limitations such as ion ion interactions and steric effects some recent theoretical modifications have been proposed for example corry et al 2003 demonstrated that if a specific self energy term is included in the np equation qualitative improvements could be made in the computational results kilic et al 2007 proposed a simple modification of the widely used pnp equations through including the steric effect due to ion transport they reported that some limitations confronted in specific applications such as those related to ionic channels can be sufficiently improved by adjusting the diffusion coefficients or by considering additional force terms in the ion flux formula of the np equation zheng and wei 2011 on the other hand one of the challenges in the application of pnp to model ion transport in electrode and membrane system is the implementation of certain boundary conditions that make models mathematically complex for example this is encountered in 2d modelling of ion and water transfer to describe electrochemical processes in membranes pismensky et al 2012 and electrodes in galvanostatic mode mareev et al 2016 on the basis of local electroneutrality this required applying an integral boundary condition for the electric current density which caused high computational demands uzdenova et al 2018 proposed a 1d model based on pnp equations for the galvanostatic mode their model eliminated the need for an additional interface for the time integral calculations they specified the electric potential gradient as an explicit function of the total current density at the outer edge of the diffusion layer of ion exchange membrane solution interface instead of the time derivative of the electric potential gradient at this boundary their model eliminated the need for an additional coupling due to the time integral calculations other importance of simplifying the numerical models based on pnp equations is related to the fact that they are computationally very complex for example to improve the computational efficiency in the study of ion transport in a multilayer graphene membrane one approach would be to reduce the dimensionality of the nanochannel doing so the computational cost of the problem without significant loss of accuracy are significantly reduced jiang et al 2014 have developed an equivalent one dimensional ion transport model for the tortuous nano slit systems embedded in a multi layered graphene membrane they concluded that the equivalent 1d model should provide a framework to interpret and rationalize the experimental results of ion transport in the cascading nano slit systems it may provide a simple yet quantitative model to design 2d materials based membranes for various applications such as energy storage electrode design ion separation water desalination or treatment the aim of this study is to enhance the computational efficiency needed to simulate ion transport in charged media we have first developed a 2d axi symmetric model to investigate the ion transport within a film of water underlying an oil droplet with negatively charged surfaces on its top and bottom boundaries the liquid film is initially composed of a high salinity electrolyte and afterwards it is exposed through its lateral sides to a bulk fluid with a lower salinity this contact initiates a dynamic process with diffusion of ions and the subsequent evolution of the electric field over time across the liquid film our 2d model was developed based on the model proposed by mahani et al 2016 in which the interaction of ionic diffusion and thin film hydrodynamic was studied in simulations using the developed 2d model only very small domain size could be considered as otherwise the very large domain aspect ratio could cause numerical problems considering the assumptions of fixed and rigid boundaries and incompressible water phase in the 2d model there is no net inflow of water into the domain there could be flow circulation within the domain which is expected to be very small in a next step in order to reduce the complexity and the computational effort we have derived and developed an averaged one dimensional coupled poisson nernst plank model to simulate electro diffusion in the same system to do so we have integrated the governing differential equations along the channel height this strategy allowed us to solve the equations for a much larger realistic domain size relative to that used in the 2d model the comsol multiphysics software was used to solve the coupled pnp equations in our 1d and 2d models our results using the 1d model showed exact agreement with the results from the 2d model but with significantly less computational time and modelling complexity 2 theory in this section we will describe the electrical double layer edl and the general form of the equations used in this study to simulate the electric field and ion transport within the channel 2 1 edl as you can see in fig 1 an edl has a structure of two parallel layers of charges appearing at the surface of a material when exposed to an ionic solution the first layer called stern layer consists of either positive or negative ions adsorbed onto the surface due to chemical interactions the second layer is formed by ions attracted to the surface charge via the coulomb force shear plane and free ions moving in the fluid under the influence of electric attraction and thermal motion diffuse layer typically the electric double layer may be of interest when modelling very thin layers of electrolyte such as that studied here to model the behaviour of the diffuse double layer one should solve nernst plank equations for all ions in combination with the poisson equation for the electrical potential 2 2 electric field to simulate the electric field we use the coupled poisson nernst plank pnp equations the electro osmotic flow occurs through the film because electric double layers are developed at the top and bottom interfaces and overlap with each other under these conditions there is no thermodynamic equilibrium and thus poisson boltzmann equations cannot be used for the simulation of ionic distribution instead the nernst planck equation should be used to find the distribution of ions within the electric double layer park et al 2007 under dynamic non equilibrium condition to model the electrical potential the poisson equation is used as 1 2 ψ ρ e ε where ε is the permittivity of the medium and ρ e is the charge density due to ion concentrations the latter can be described as 2 ρ e e z i n a c i where ci represents concentrations of two ions of opposite charge zi na and e denote the valence of the ion i 1 1 avogadro number and elementary charge respectively 2 3 ion transport to solve for the concentrations ci of two ions in an electrolyte solution we can use the nernst planck equation the molar flux of ions ji are described as follow 3 j i c i v d i c i u m i z i f c i ψ where di is the diffusion coefficient v is advective velocity u m i is the mobility f is faraday s constant and ψ is the electrical potential the conservation of ions in a medium provides c i t j i r i 0 assuming no chemical reactions ri 0 in the electrolyte for the two species under equilibrium and dynamic condition we obtain respectively 4 j i 0 5 c i t j i 0 3 numerical modelling 3 1 modelling approach and model configurations in this study we assumed that a thin layer of high salinity electrolyte solution is squeezed between an oil droplet and a clay platelet and is initially under thermodynamically equilibrium condition then we exposed the lateral boundaries of the domain with a solution having lower salinity this initiates the diffusion of ions and evolution of electric field through the film such a thin layer can be conceptualized as a disc with axis symmetrical properties mahani 2015 to simulate electric field and ions transport within this thin layer we first developed a 2d model due to the coupling between highly complex and nonlinear equations this model had relatively heavy computational costs which limits its usage for larger realistic domain sizes because of the high aspect ratio this problem together with the dominant flow and transport in the horizontal direction motivates developing an equivalent 1d model to reduce the computational efforts and do the simulation for larger domain which is comparable to the experiment 3 2 2d model 3 2 1 initial and boundary conditions in the 2d model in the following a 2d simulation domain and schematic overview of the relevant boundary conditions are presented as shown in fig 2 the 2d system is modelled as axisymmetric geometry with an axial coordinate z and a radial coordinate r respectively in finite element method using an appropriate mesh for the system is important we have tested several mesh sizes to find an optimum mesh size that provides stable solutions in the 2d model within debye lengths of top and bottom boundaries the minimum element size was set to λ d h 6 and the maximum element size was set to λ d h 4 to ensure sufficient resolution for the electric double layer here λ d h is the debye length for the system under high salinity initial condition and is determined using λ d h ε k b t e 2 n a z i 2 c b h 0 5 given the domain geometry we have used structured meshes that provided accurate and computationally efficient results compared to the unstructured triangular mesh as shown in fig 2 in order to compare our results with those of mahani et al we considered a similar film size with a radius of 20 nm and a height of 4 nm i e l 20 nm and h 4 nm on the left boundary of the domain i e the symmetry axis of the cylindrical domain a no flux boundary condition was imposed at the right boundary being exposed to the low salinity bulk solution the electrical potential was set to zero and the concentrations of the cation and anion species cp and cm mol m3 were set to a constant value cb i e the concentration of low salinity solution in the bulk region the top and bottom boundaries represent the interfaces of the electrolyte with oil and clay respectively which are negatively charged surfaces and carry constant surface charge density σ c m2 and a no flux n d ci 0 boundary conditions for nernst planck equation we specified a space charge density of ρ e e na cp cm c m3 on the entire domain we assumed that initially the system is in equilibrium with residing high salinity bulk solution to solve for the corresponding initial distribution of electrical potential ψ r z and concentration field of the cation and the anion ci r z for our 2d model we solved eq 1 and eq 4 respectively as the domain is closed with fix boundaries and water is considered incompressible the flow into the domain is zero and there is no need to simulate fluid flow 3 2 2 2d cylindrical form of the governing equations under dynamic condition in this section we provide the governing equations for electrical potential ψ r z and concentration field of cation and anion ci r z in a cylindrical coordinate for our 2d model under dynamic condition as we exposed the right boundary to the low salinity bulk solution the diffusion of ions and evolution of electric field occurs through the film in poisson equation to calculate the electrical potential ψ r z eqs 1 and 2 can be written for axi symmetric conditions as 6 2 ψ z 2 1 r r r ψ r e n a z i c i ε for ions transport under dynamic condition and excluding the convection term eqs 5 and 3 provide 7 c i t d i k b t n a e z i z c i ψ z 1 r r c i r ψ r d i 2 c i z 2 1 r r r c i r 0 3 3 1d model 3 3 1 1d domain and boundary conditions the 1d model has a length of 20 nm long representing the extent of the electrolyte between oil and clay in this model the left boundary is axi symmetric and the right boundary applies a zero electric potential and a fixed concentration of bulk solution for poisson and nernst planck equations respectively 3 3 2 derivation of the 1d form of the governing equations in the radial coordinate in order to derive the 1d equations we integrate all terms along the height of the film first we define the averaged electrical potential ψ r and averaged ion concentrations c i r as 8 ψ r 1 h 0 h ψ r z d z 9 c i r 1 h 0 h c i r z d z table 1 provides the integrated forms of each term in the poisson and nernst planck equations for some terms we have used the top and bottom boundary conditions of the 2d model based on the information provided in table 1 the final form of the pnp equations in a one dimensional space may be written as 17 1 r r r ψ h r 2 σ ε h e n a z i c i ε 18 c i h t d i n a e z i k b t 1 r r r c i ψ h r 2 c i σ ε d i r r r c i h r 0 in 1d model the effect of surface charge density should be taken into account to do so the second term in the left hand side of eq 17 i e 2 σ ε is defined as a source term this term originates from integrating the first term of poisson equation along the height of the aqueous film eq 10 considering eqs 17 and 1 we have defined the charge density in the one dimensional space as 19 ρ e 2 h σ e n a c p c m we have first solved these equations for the initial equilibrium condition and after that we solved them for dynamic condition when we expose the domain to the low salinity bulk fluid 3 4 model parameter values parameters values considered for our simulations are given in table 2 in the nernst planck equation only migration term and the existence of two ion species cp and cm with valences1 0 and 1 0 were included to better present the modelling results some dimensionless variables are used as defined in table 3 here λ d h is the debye length for the system under high salinity initial condition determined using λ d h ε k b t e 2 n a z i 2 c b h 0 5 4 simulation results and discussion in this section we provide the results obtained from the numerical simulation of coupled pnp equations we will first describe the results for electrical potential and ion concentrations under initial equilibrium condition obtained from our 1d mode afterwards we compare the dynamic results of this 1d model with those of 2d model to verify our model to show the efficiency of the developed model the computational time ratio between the 1d model and the 2d model is provided for different domain lengths including r 1000 5000 and 10000 nm the analysis showed that the 1d model can solve the equations 180 220 times faster than the 2d model after verification we use the developed efficient model to perform simulation for a much longer domain size r 0 5 mm which is not feasible to be simulated using the original 2d model due to its computational demands 4 1 initial equilibrium condition for the 1d model initially the domain is filled with high salinity bulk solution which is under equilibrium condition we performed a simulation for r 2 and z 0 4 with a constant surface charge density σ 0 017 c m 2 fig 3 shows the profile of the electrical potential field along the film radius it is shown that moving horizontally away from the centre of the domain r 2 the electrical field becomes weaker since the interfaces are negatively charged the concentration of cation is higher compared to the anion concentration and by getting closer to the outlet the difference between concentrations become smaller and finally at the outlet the ion concentrations reach to their bulck value this behaviour is clear in fig 4 a and b showing the concentration profiles for the anion and cation respectively to verify the simulation results for electrical potential and ion concentrations we compared the results with those obtained using the corresponding 2d model for r 2 and z 0 4 that are shown by markers in the following figures 4 2 1d model verification under dynamic conditions to study the system behaviour under dynamic conditions we performed simulations by including the unsteady time dependent terms to verify the simulation results for electrical potential and ion concentrations we compared the results with those obtained using the corresponding 2d model for r 2 and z 0 4 fig 5 shows this comparison for electrical potential evolution over time in radial direction for thin film scenarios the solid line and the triangular markers show the results that are obtained from 1d and 2d models respectively the blue curve shows the results for the first time step and the red curve shows the final i e equilibrium solution balanced with the low salinity bulk solution the simulation run was 10 6 seconds and the graphs are equally distributed between the beginning of the simulation and the end time of the simulation fig 6 a and b show dynamics of anion and cation concentration for thin film respectively again the solid lines represent the results obtaining from the 1d model and the triangular markers represent those of the 2d models it is shown that after we reduce the concentration of surrounding bulk solution inside the film ions start diffuseing out of the high salinity solution of the film to the surrounding environment the diffusion time is estimated by dividing the squared length of the domain by the diffusion coefficient of ion species we considered the ions with similar absolute valence and diffusion coefficient but by comparing fig 6a and b you can see the outward diffusion rate of cation is lower compared to anion due to the presence of negative electrical charges on the top and bottom boundaries the above figures show exact agreements between the results for electrical potential and ions concentration from both models the 1d model however allows reducing the computational time for over 180 220 times without losing accuracy fig 7 provides the acquired computational benefit using the 1d model for simulations using different film lengths as demonstrated the computational benefit becomes much larger for bigger film lengths where the 1d model becomes significantly faster than the 2d model 4 3 1d simulation results for more realistic domain length we performed simulation using the 1d model for more realistic domain length r 0 5 mm i e 25000 times larger than simualtions used for model verifications which was not possible to simulate using the 2d model due to the highly computational cost the results for the electric potential and the anion and cation concentration profile obtained from the 1d model are provided in fig 8 and fig 9 a b respectively the computational time for this large 1d model was 8 min fig 8 represents the evolution of electric field along the radial direction for this large 1d model the blue curve shows initial equilibrium condition under high salinity bulk solution and the red curve shows the final equilibrium condition under lower salinity bulk solution the choice of time steps as shown in the figure legend was in some way to better show the evolution of the electrical potential in this large 1d model the negatively charged system was initially under the thermodynamically equilibrium condition for high salinity bulk solution as we exposed the right boundary to the lower salinity solution this initial equilibrium condition is disturbed and the diffusion of ions initiates between high salinity and low salinity bulk solution since a field of electrical potential gradient is imposed on the concentration gradient as explained in section 3 3 1 the ionic diffusion becomes more limited and due to the presence of negatively electrical charges the mobility of cations is strongly affected and they mostly remain inside the system therefore as shown in fig 9a we could see the diffusion of anion over time while fig 9b shows that all the graphs for cation concentration profiles are overlapping each other 5 application and future work similar to other researchers we have assumed that the thin film has fixed and rigid boundaries and contains incompressible water as a result of these assumption the film thickness remains constant and no water would flow into or out of the domain in future works flow equations should be added to the effective 1d model in order to investigate the spatial and temporal evolution of film thickness due to the coupled effects of electroosmosis and water flow and potential detachment of the oil phase from the solid surface in scales comparable with the experimental observations mahani 2015 moreover the electrostatic interface condition in modelling of the solid fluid interaction is critical as it controls the transport of ions and evolution of disjoining pressure in a recent study pourakaberian et al 2021 investigated the evolution of hydrodynamic pressure and the electric potential under the effect of ionic strength gradient for different symmetric and asymmetric electrical boundary conditions our developed 1d model is valid for symmetric electrical boundary condition of constant charge density as well as in the presence of multi component solutions and highly overlapping electric double layers however for other types of boundary conditions such as constant potential charge regulation model and asymmetric boundary conditions appropriate 1d average equations should be derived 6 conclusion in this work we have developed an effective one dimensional model to simulate electro diffusion inside a thin layer of electrolyte located between two charged surfaces this model has been used to simulate the evolution of electrical potential and ion concentrations distribution along the thin film of electrolyte simulations showed that because of the negatively charged surfaces the mobility of the cations was severely affected by the electric charges and these ions had lower outward diffusion rate compared to flux of anions the developed model could significantly reduce the computational time by a factor of 180 220 compared to simulation using a 2d model the equivalent 1d model enables solving the nonlinear governing equations for much larger domain lengths providing unique opportunity to simulate experimental results of ion transport in thin films where the very large height to length ratio prevents use of 2d simulations declaration of competing interest none acknowledgements the authors wish to thank dr joost de graaf for helpful discussions the second author gratefully acknowledges the support from china scholarship council no 201609120013 the third author wishes to thank the german research foundation dfg for supporting this work by funding exc2075 390740016 under germany s excellence strategy and acknowledge the support by the stuttgart center for simulation science simtech 
212,the numerical modelling of ionic diffusive transport through a charged thin film of electrolyte is mathematically and computationally complex due to the strongly coupled hydrodynamics and electrochemical interactions generally simulations are performed by solving the poisson equation together with the nernst planck flux formula to model electrochemical processes in electro diffusion problems one important application of these system of equations to study the interaction of ionic diffusion and thin film hydrodynamics in petroleum engineering however due to the highly nonlinear and coupled equations the computational costs are heavy and very often limited to simulations in two dimensional geometries in this article we have developed an equivalent one dimensional electro diffusive transport model based on mathematical averaging of 2d equations to reduce the computational time doing so the computational time is improved substantially and simulation of much larger domain sizes which are required to study and interpret the experimental results is shown to be feasible we have shown the high accuracy of the developed model by comparing the electric potential and concentration profiles of the developed model against the original 2d simulations the developed approach reduces the computational effort by over 200 times without losing accuracy keywords thin film hydrodynamics electrochemical potential charged surface coupled process poisson nernst planck equations 1 introduction poisson nernst planck pnp equations are widely used to describe transport of ions in various applications including chemistry physics biology and engineering suopaiarvi 2015 bazant et al 2009 eisenberg 1998 kurnikova et al 1999 selberherr 1984 poisson equation is used to describe the electrical potential and the nernst planck equation is applied to include the electric double layer effects in the transport of ions through a thin layer of electrolyte applying pnp equations in numerical modelling with application to membrane electrochemistry dates back to 1975 in the work of cohen and cooley and that of brumleve and buck cohen and cooley 1965 brumleve and buck 1978 use of pnp equations allows the computation of the space charge density near an interface which may represent a solution electrode or solution ion exchange membrane interface uzdenova et al 2018 in addition pnp equations are also known as the drift diffusion equations and are used for simulating ion diffusion in semiconductor devices markowich 1986 rouston 1990 newman 1991 in these systems the diffusion of ions is affected by the excess chemical potential produced by the mobile ions another application of pnp equations is in biological membrane channels ardenas et al 2000 hollerbach et al 2000 coalson and kurnikova 2005 where the underlying mechanisms for ion transport through such channels are studied to understand the cellular activities of the living cells eisenman and dani 1987 hille 1978 moreover the pnp equations have been applied for solving ion transport in general nano to macro scale charged porous media pivonka et al 2009 mohajeri et al 2010 they can be also applied for describing special mechanisms behind the flow and transport behaviors in unconventional reservoirs in these systems the widespread nanopores are often considered as the main cause of significant capillary and confinement effects zhang et al 2020 designed a digital twin platform by which they combined several promising numerical models and multiscale algorithms their model approach covered all the effects of capillarity sorption and salinity to simulate and illustrate the effect of these mechanisms on flow and transport phenomena and the production of unconventional reservoirs they mentioned water salinity as one of the key factors affecting injection and fracturing performance for the two directly relevant processes to salinity they used multicomponent ion exchange equation and dlvo theory to represent the electrical interaction process and the double layer expansion respectively the poisson boltzmann equation was used to model electrostatic double layer force and the effect of dynamic sorption was represented by the nernst planck equation moreover numerous studies on unconventional oil and gas production indicate that under confinement the fluid behavior deviates from its bulk behavior alharthy et al 2013 chen et al 2013 du and chu 2012 thus phase behavior modelling becomes significant as the change of reservoir fluid properties could affect the flow mechanisms and displacement processes since the nano scale pore yields a large capillary pressure capillary effect should be considered in modelling phase behaviors in unconventional reservoirs sun 2019 in this regard a well developed flash calculation scheme which is stablished at fixed chemical composition n volume v and temperature t known as nvt flash was established by zhang et al 2020 their trained model was capable of accurately estimating the phase behavior of complex reservoir fluids under a wide range of environmental conditions in the presence of capillary pressure for electrically charged nano porous materials such as electrodes the formation of electrical double layer edl considerably influences the transport and electro sorption of ions inside the nanopores this phenomenon leads to changes in pore accessibility zhang and tartakovsky 2017 damiani et al 2021 developed a reactive transport model based on the pnp to simulate diffusion of ions through a charged constricted pore their work contributed to the understanding of electrochemical migration of ions caused by changes in electric fields under various chemically reactive conditions such as those related to the swelling of clay minerals the complex composition of mineral surfaces in geological media either chemical heterogeneity or pore property poses challenges in accurate description of ionic transport in porous media naidu et al 1994 norde and lyklema 1978 for example in simulation of electrokinetic processes in fluid saturated porous materials ζ potential is a fundamental property for charged surfaces that represents approximately the electrical potential at the mineral fluid interface pride 1994 revil and pezard 1999 considered a silica dominated porous material filled with a binary symmetric 1 1 electrolyte such as nacl they developed analytical expressions for ζ potential and the specific surface conductance and predicted the variation of these parameters with the pore fluid salinity temperature and ph in the field of particle transport trefalt et al 2016 discussed the effect of charge regulation in electrical double layer edl on the interaction between colloids and interfaces by using the classical poisson boltzmann theory several researchers have proposed theories to explain the impact of interfacial properties on macroscopic transport alizadeh et al 2019 liu et al 2020 yet an accurate simulation of electrochemical processes in the presence of dynamic changes in electrical potential and ionic concentration induced by the alteration of solid charged surfaces and the surrounding electrolyte remains a challenging task considering clayey soil as a notable example of charged porous media different studies worked on flow ion and chemical transport and deformation in these systems kirby 2010 mahani 2015 niasar and mahani 2016 mahani 2015 used a model system for sandstone rock consisting of clay minerals deposited at the glass substrate and oil droplets which were attached to clay patches separately their study was under the assumption of hydrodynamic equilibrium between the oil phase and the surrounding water they studied ion diffusion and transport when the system is exposed to two different brine solutions having low and high salinity values later they studied the dlvo intermolecular forces by considering electrostatic forces and including osmotic pressure to understand the dynamics of disjoining pressure inside a thin film of electrolyte niasar and mahani 2016 they coupled the nernst planck ionic transport and poisson equations with navier stokes equation in order to describe the disjoining pressure and investigate its impact on the transport of ions within the thin film they found that the nonlinear behaviour in the pressure field which is caused by multidirectional and asymmetric ions transport is strongly affected by the diffusion length and the overlapping of edl while the coupled pnp model provides quantitative prediction of ion transport problem in many areas it has its own limitations such as neglecting the finite size effect of ion particles and correlation effect i e self energy which may become important in very confined channels jung et al 2009 concerning model limitations such as ion ion interactions and steric effects some recent theoretical modifications have been proposed for example corry et al 2003 demonstrated that if a specific self energy term is included in the np equation qualitative improvements could be made in the computational results kilic et al 2007 proposed a simple modification of the widely used pnp equations through including the steric effect due to ion transport they reported that some limitations confronted in specific applications such as those related to ionic channels can be sufficiently improved by adjusting the diffusion coefficients or by considering additional force terms in the ion flux formula of the np equation zheng and wei 2011 on the other hand one of the challenges in the application of pnp to model ion transport in electrode and membrane system is the implementation of certain boundary conditions that make models mathematically complex for example this is encountered in 2d modelling of ion and water transfer to describe electrochemical processes in membranes pismensky et al 2012 and electrodes in galvanostatic mode mareev et al 2016 on the basis of local electroneutrality this required applying an integral boundary condition for the electric current density which caused high computational demands uzdenova et al 2018 proposed a 1d model based on pnp equations for the galvanostatic mode their model eliminated the need for an additional interface for the time integral calculations they specified the electric potential gradient as an explicit function of the total current density at the outer edge of the diffusion layer of ion exchange membrane solution interface instead of the time derivative of the electric potential gradient at this boundary their model eliminated the need for an additional coupling due to the time integral calculations other importance of simplifying the numerical models based on pnp equations is related to the fact that they are computationally very complex for example to improve the computational efficiency in the study of ion transport in a multilayer graphene membrane one approach would be to reduce the dimensionality of the nanochannel doing so the computational cost of the problem without significant loss of accuracy are significantly reduced jiang et al 2014 have developed an equivalent one dimensional ion transport model for the tortuous nano slit systems embedded in a multi layered graphene membrane they concluded that the equivalent 1d model should provide a framework to interpret and rationalize the experimental results of ion transport in the cascading nano slit systems it may provide a simple yet quantitative model to design 2d materials based membranes for various applications such as energy storage electrode design ion separation water desalination or treatment the aim of this study is to enhance the computational efficiency needed to simulate ion transport in charged media we have first developed a 2d axi symmetric model to investigate the ion transport within a film of water underlying an oil droplet with negatively charged surfaces on its top and bottom boundaries the liquid film is initially composed of a high salinity electrolyte and afterwards it is exposed through its lateral sides to a bulk fluid with a lower salinity this contact initiates a dynamic process with diffusion of ions and the subsequent evolution of the electric field over time across the liquid film our 2d model was developed based on the model proposed by mahani et al 2016 in which the interaction of ionic diffusion and thin film hydrodynamic was studied in simulations using the developed 2d model only very small domain size could be considered as otherwise the very large domain aspect ratio could cause numerical problems considering the assumptions of fixed and rigid boundaries and incompressible water phase in the 2d model there is no net inflow of water into the domain there could be flow circulation within the domain which is expected to be very small in a next step in order to reduce the complexity and the computational effort we have derived and developed an averaged one dimensional coupled poisson nernst plank model to simulate electro diffusion in the same system to do so we have integrated the governing differential equations along the channel height this strategy allowed us to solve the equations for a much larger realistic domain size relative to that used in the 2d model the comsol multiphysics software was used to solve the coupled pnp equations in our 1d and 2d models our results using the 1d model showed exact agreement with the results from the 2d model but with significantly less computational time and modelling complexity 2 theory in this section we will describe the electrical double layer edl and the general form of the equations used in this study to simulate the electric field and ion transport within the channel 2 1 edl as you can see in fig 1 an edl has a structure of two parallel layers of charges appearing at the surface of a material when exposed to an ionic solution the first layer called stern layer consists of either positive or negative ions adsorbed onto the surface due to chemical interactions the second layer is formed by ions attracted to the surface charge via the coulomb force shear plane and free ions moving in the fluid under the influence of electric attraction and thermal motion diffuse layer typically the electric double layer may be of interest when modelling very thin layers of electrolyte such as that studied here to model the behaviour of the diffuse double layer one should solve nernst plank equations for all ions in combination with the poisson equation for the electrical potential 2 2 electric field to simulate the electric field we use the coupled poisson nernst plank pnp equations the electro osmotic flow occurs through the film because electric double layers are developed at the top and bottom interfaces and overlap with each other under these conditions there is no thermodynamic equilibrium and thus poisson boltzmann equations cannot be used for the simulation of ionic distribution instead the nernst planck equation should be used to find the distribution of ions within the electric double layer park et al 2007 under dynamic non equilibrium condition to model the electrical potential the poisson equation is used as 1 2 ψ ρ e ε where ε is the permittivity of the medium and ρ e is the charge density due to ion concentrations the latter can be described as 2 ρ e e z i n a c i where ci represents concentrations of two ions of opposite charge zi na and e denote the valence of the ion i 1 1 avogadro number and elementary charge respectively 2 3 ion transport to solve for the concentrations ci of two ions in an electrolyte solution we can use the nernst planck equation the molar flux of ions ji are described as follow 3 j i c i v d i c i u m i z i f c i ψ where di is the diffusion coefficient v is advective velocity u m i is the mobility f is faraday s constant and ψ is the electrical potential the conservation of ions in a medium provides c i t j i r i 0 assuming no chemical reactions ri 0 in the electrolyte for the two species under equilibrium and dynamic condition we obtain respectively 4 j i 0 5 c i t j i 0 3 numerical modelling 3 1 modelling approach and model configurations in this study we assumed that a thin layer of high salinity electrolyte solution is squeezed between an oil droplet and a clay platelet and is initially under thermodynamically equilibrium condition then we exposed the lateral boundaries of the domain with a solution having lower salinity this initiates the diffusion of ions and evolution of electric field through the film such a thin layer can be conceptualized as a disc with axis symmetrical properties mahani 2015 to simulate electric field and ions transport within this thin layer we first developed a 2d model due to the coupling between highly complex and nonlinear equations this model had relatively heavy computational costs which limits its usage for larger realistic domain sizes because of the high aspect ratio this problem together with the dominant flow and transport in the horizontal direction motivates developing an equivalent 1d model to reduce the computational efforts and do the simulation for larger domain which is comparable to the experiment 3 2 2d model 3 2 1 initial and boundary conditions in the 2d model in the following a 2d simulation domain and schematic overview of the relevant boundary conditions are presented as shown in fig 2 the 2d system is modelled as axisymmetric geometry with an axial coordinate z and a radial coordinate r respectively in finite element method using an appropriate mesh for the system is important we have tested several mesh sizes to find an optimum mesh size that provides stable solutions in the 2d model within debye lengths of top and bottom boundaries the minimum element size was set to λ d h 6 and the maximum element size was set to λ d h 4 to ensure sufficient resolution for the electric double layer here λ d h is the debye length for the system under high salinity initial condition and is determined using λ d h ε k b t e 2 n a z i 2 c b h 0 5 given the domain geometry we have used structured meshes that provided accurate and computationally efficient results compared to the unstructured triangular mesh as shown in fig 2 in order to compare our results with those of mahani et al we considered a similar film size with a radius of 20 nm and a height of 4 nm i e l 20 nm and h 4 nm on the left boundary of the domain i e the symmetry axis of the cylindrical domain a no flux boundary condition was imposed at the right boundary being exposed to the low salinity bulk solution the electrical potential was set to zero and the concentrations of the cation and anion species cp and cm mol m3 were set to a constant value cb i e the concentration of low salinity solution in the bulk region the top and bottom boundaries represent the interfaces of the electrolyte with oil and clay respectively which are negatively charged surfaces and carry constant surface charge density σ c m2 and a no flux n d ci 0 boundary conditions for nernst planck equation we specified a space charge density of ρ e e na cp cm c m3 on the entire domain we assumed that initially the system is in equilibrium with residing high salinity bulk solution to solve for the corresponding initial distribution of electrical potential ψ r z and concentration field of the cation and the anion ci r z for our 2d model we solved eq 1 and eq 4 respectively as the domain is closed with fix boundaries and water is considered incompressible the flow into the domain is zero and there is no need to simulate fluid flow 3 2 2 2d cylindrical form of the governing equations under dynamic condition in this section we provide the governing equations for electrical potential ψ r z and concentration field of cation and anion ci r z in a cylindrical coordinate for our 2d model under dynamic condition as we exposed the right boundary to the low salinity bulk solution the diffusion of ions and evolution of electric field occurs through the film in poisson equation to calculate the electrical potential ψ r z eqs 1 and 2 can be written for axi symmetric conditions as 6 2 ψ z 2 1 r r r ψ r e n a z i c i ε for ions transport under dynamic condition and excluding the convection term eqs 5 and 3 provide 7 c i t d i k b t n a e z i z c i ψ z 1 r r c i r ψ r d i 2 c i z 2 1 r r r c i r 0 3 3 1d model 3 3 1 1d domain and boundary conditions the 1d model has a length of 20 nm long representing the extent of the electrolyte between oil and clay in this model the left boundary is axi symmetric and the right boundary applies a zero electric potential and a fixed concentration of bulk solution for poisson and nernst planck equations respectively 3 3 2 derivation of the 1d form of the governing equations in the radial coordinate in order to derive the 1d equations we integrate all terms along the height of the film first we define the averaged electrical potential ψ r and averaged ion concentrations c i r as 8 ψ r 1 h 0 h ψ r z d z 9 c i r 1 h 0 h c i r z d z table 1 provides the integrated forms of each term in the poisson and nernst planck equations for some terms we have used the top and bottom boundary conditions of the 2d model based on the information provided in table 1 the final form of the pnp equations in a one dimensional space may be written as 17 1 r r r ψ h r 2 σ ε h e n a z i c i ε 18 c i h t d i n a e z i k b t 1 r r r c i ψ h r 2 c i σ ε d i r r r c i h r 0 in 1d model the effect of surface charge density should be taken into account to do so the second term in the left hand side of eq 17 i e 2 σ ε is defined as a source term this term originates from integrating the first term of poisson equation along the height of the aqueous film eq 10 considering eqs 17 and 1 we have defined the charge density in the one dimensional space as 19 ρ e 2 h σ e n a c p c m we have first solved these equations for the initial equilibrium condition and after that we solved them for dynamic condition when we expose the domain to the low salinity bulk fluid 3 4 model parameter values parameters values considered for our simulations are given in table 2 in the nernst planck equation only migration term and the existence of two ion species cp and cm with valences1 0 and 1 0 were included to better present the modelling results some dimensionless variables are used as defined in table 3 here λ d h is the debye length for the system under high salinity initial condition determined using λ d h ε k b t e 2 n a z i 2 c b h 0 5 4 simulation results and discussion in this section we provide the results obtained from the numerical simulation of coupled pnp equations we will first describe the results for electrical potential and ion concentrations under initial equilibrium condition obtained from our 1d mode afterwards we compare the dynamic results of this 1d model with those of 2d model to verify our model to show the efficiency of the developed model the computational time ratio between the 1d model and the 2d model is provided for different domain lengths including r 1000 5000 and 10000 nm the analysis showed that the 1d model can solve the equations 180 220 times faster than the 2d model after verification we use the developed efficient model to perform simulation for a much longer domain size r 0 5 mm which is not feasible to be simulated using the original 2d model due to its computational demands 4 1 initial equilibrium condition for the 1d model initially the domain is filled with high salinity bulk solution which is under equilibrium condition we performed a simulation for r 2 and z 0 4 with a constant surface charge density σ 0 017 c m 2 fig 3 shows the profile of the electrical potential field along the film radius it is shown that moving horizontally away from the centre of the domain r 2 the electrical field becomes weaker since the interfaces are negatively charged the concentration of cation is higher compared to the anion concentration and by getting closer to the outlet the difference between concentrations become smaller and finally at the outlet the ion concentrations reach to their bulck value this behaviour is clear in fig 4 a and b showing the concentration profiles for the anion and cation respectively to verify the simulation results for electrical potential and ion concentrations we compared the results with those obtained using the corresponding 2d model for r 2 and z 0 4 that are shown by markers in the following figures 4 2 1d model verification under dynamic conditions to study the system behaviour under dynamic conditions we performed simulations by including the unsteady time dependent terms to verify the simulation results for electrical potential and ion concentrations we compared the results with those obtained using the corresponding 2d model for r 2 and z 0 4 fig 5 shows this comparison for electrical potential evolution over time in radial direction for thin film scenarios the solid line and the triangular markers show the results that are obtained from 1d and 2d models respectively the blue curve shows the results for the first time step and the red curve shows the final i e equilibrium solution balanced with the low salinity bulk solution the simulation run was 10 6 seconds and the graphs are equally distributed between the beginning of the simulation and the end time of the simulation fig 6 a and b show dynamics of anion and cation concentration for thin film respectively again the solid lines represent the results obtaining from the 1d model and the triangular markers represent those of the 2d models it is shown that after we reduce the concentration of surrounding bulk solution inside the film ions start diffuseing out of the high salinity solution of the film to the surrounding environment the diffusion time is estimated by dividing the squared length of the domain by the diffusion coefficient of ion species we considered the ions with similar absolute valence and diffusion coefficient but by comparing fig 6a and b you can see the outward diffusion rate of cation is lower compared to anion due to the presence of negative electrical charges on the top and bottom boundaries the above figures show exact agreements between the results for electrical potential and ions concentration from both models the 1d model however allows reducing the computational time for over 180 220 times without losing accuracy fig 7 provides the acquired computational benefit using the 1d model for simulations using different film lengths as demonstrated the computational benefit becomes much larger for bigger film lengths where the 1d model becomes significantly faster than the 2d model 4 3 1d simulation results for more realistic domain length we performed simulation using the 1d model for more realistic domain length r 0 5 mm i e 25000 times larger than simualtions used for model verifications which was not possible to simulate using the 2d model due to the highly computational cost the results for the electric potential and the anion and cation concentration profile obtained from the 1d model are provided in fig 8 and fig 9 a b respectively the computational time for this large 1d model was 8 min fig 8 represents the evolution of electric field along the radial direction for this large 1d model the blue curve shows initial equilibrium condition under high salinity bulk solution and the red curve shows the final equilibrium condition under lower salinity bulk solution the choice of time steps as shown in the figure legend was in some way to better show the evolution of the electrical potential in this large 1d model the negatively charged system was initially under the thermodynamically equilibrium condition for high salinity bulk solution as we exposed the right boundary to the lower salinity solution this initial equilibrium condition is disturbed and the diffusion of ions initiates between high salinity and low salinity bulk solution since a field of electrical potential gradient is imposed on the concentration gradient as explained in section 3 3 1 the ionic diffusion becomes more limited and due to the presence of negatively electrical charges the mobility of cations is strongly affected and they mostly remain inside the system therefore as shown in fig 9a we could see the diffusion of anion over time while fig 9b shows that all the graphs for cation concentration profiles are overlapping each other 5 application and future work similar to other researchers we have assumed that the thin film has fixed and rigid boundaries and contains incompressible water as a result of these assumption the film thickness remains constant and no water would flow into or out of the domain in future works flow equations should be added to the effective 1d model in order to investigate the spatial and temporal evolution of film thickness due to the coupled effects of electroosmosis and water flow and potential detachment of the oil phase from the solid surface in scales comparable with the experimental observations mahani 2015 moreover the electrostatic interface condition in modelling of the solid fluid interaction is critical as it controls the transport of ions and evolution of disjoining pressure in a recent study pourakaberian et al 2021 investigated the evolution of hydrodynamic pressure and the electric potential under the effect of ionic strength gradient for different symmetric and asymmetric electrical boundary conditions our developed 1d model is valid for symmetric electrical boundary condition of constant charge density as well as in the presence of multi component solutions and highly overlapping electric double layers however for other types of boundary conditions such as constant potential charge regulation model and asymmetric boundary conditions appropriate 1d average equations should be derived 6 conclusion in this work we have developed an effective one dimensional model to simulate electro diffusion inside a thin layer of electrolyte located between two charged surfaces this model has been used to simulate the evolution of electrical potential and ion concentrations distribution along the thin film of electrolyte simulations showed that because of the negatively charged surfaces the mobility of the cations was severely affected by the electric charges and these ions had lower outward diffusion rate compared to flux of anions the developed model could significantly reduce the computational time by a factor of 180 220 compared to simulation using a 2d model the equivalent 1d model enables solving the nonlinear governing equations for much larger domain lengths providing unique opportunity to simulate experimental results of ion transport in thin films where the very large height to length ratio prevents use of 2d simulations declaration of competing interest none acknowledgements the authors wish to thank dr joost de graaf for helpful discussions the second author gratefully acknowledges the support from china scholarship council no 201609120013 the third author wishes to thank the german research foundation dfg for supporting this work by funding exc2075 390740016 under germany s excellence strategy and acknowledge the support by the stuttgart center for simulation science simtech 
213,co2 injection into deep saline aquifers has shown to be a feasible option as for their large storage capacity under safe operational conditions previous studies have revealed that co2 can be trapped in the subsurface by several mechanisms despite the major advances in studying these trapping mechanisms their dynamic interactions in different periods of a full cycle process have not been well understood i e they are studied independently at their so called separate time scales of importance these mechanisms however are dynamically interconnected and influence each other even outside of their main time scale of importance besides previous studies on field scale simulations often choose grid cells which are too coarse to capture flow dynamics especially in post injection period to this end we develop a comprehensive framework to analyze the flow dynamics and the associated hydrodynamic trapping process in which the co2 injection migration and post migration period are all considered in a unified manner through illustrative models with sufficient grid resolution we quantify the impact of different trapping mechanisms and uncertain reservoir properties through a full cycle process we demonstrate that the time scale associated with each trapping mechanism indeed varies yet their dynamic interplay needs to be considered for accurate and reliable predictions results reveal that residual trapping is governed by the advective transport in the injection period and its contribution to the overall trapped amount becomes more significant in systems with lower permeability dissolution trapping operates under varying driving forces at different stages in the injection period the dissolution process is controlled by advective transport and later enhanced by the gravity induced convection in the post injection period such convective transport diminishes the contribution from residual trapping our study sheds light on the impact of the coupled reservoir and fluid time dependent interactions in estimation of the securely trapped co2 in saline aquifers keywords geologic carbon storage multiphase flow in porous media compositional simulation multiphysics interaction 1 introduction carbon dioxide capture and storage ccs has been identified as a promising strategy to mitigate climate change due to anthropogenic co2 emissions given the urgency with respect to limiting global warming recent decades have witnessed a remarkable increase of research interest around co2 storage in subsurface systems bui et al 2018 of the geological media being considered hydrocarbon oil and gas reservoirs and deep saline aquifers have shown to be successful at pilot and commercial scales orr jr 2009 szulczewski et al 2012 bachu 2015 storing co2 in hydrocarbon reservoirs is relatively straightforward because the geological structures in which buoyant hydrocarbons were retained for quite a long time have proved to be safe in addition the storage capacity could be estimated based on the volume of produced oil gas assuming hydrocarbons will be completely replaced by co2 bachu et al 2007 the storage can become more economically attractive by being combined with enhanced oil recovery eor dai et al 2014 ampomah et al 2017 or geothermal energy production randolph and saar 2011 on the other hand for co2 storage in saline aquifers the flowing fluids are primarily composed of co2 and brine due to their distinct mobility contrast and geological heterogeneities such a displacement process is unstable moreover various trapping mechanisms operating on different time scales add to the complexity in understanding such a dynamic process mechanisms by which co2 can be retained in saline aquifers have been classified rubin and de coninck 2005 and include the following a structural and stratigraphic trapping b residual trapping c dissolution trapping and d mineral trapping a structural and stratigraphic trapping this refers to the process of upward migration of buoyant co2 being inhibited by an overlying impermeable or low permeable cap rock in such a case the risk of leakage is not eliminated because the accumulated co2 under the sealing rock is mobile in practice injection operations may overpressurize the reservoir leading to activation of faults and fractures from which mobile co2 is likely to escape rutqvist 2012 zoback and gorelick 2012 rinaldi et al 2014 white et al 2014 espinoza and santamarina 2017 zappone et al 2021 this coupled process of fluid flow and geomechanics associated with ccs has attracted growing attention from both numerical and experimental perspectives which is out of the scope of this work b residual trapping co2 is generally the non wetting phase in many sedimentary rocks consequently brine as the wetting phase tends to imbibe into co2 plume at the trailing edge after injection stops juanes et al 2006 such imbibition leaves co2 behind as disconnected immobile bubbles and ganglia hunt et al 1988 this process is referred to as residual trapping it originates from hysteresis which occurs when the rock exhibits strong wettability preference to a specific phase experimental investigations have revealed the hysteretic behavior of co2 brine system by measuring relative permeability akbarabadi and piri 2013 ruprecht et al 2014 and capillary pressure wang and tokunaga 2015 pini and benson 2017 as functions of saturation these physical measurements demonstrate that constitutive relations rely on the history of saturation as a consequence the residual saturation of nonwetting phase is closely related to the history as well to describe the trapping characteristics several mathematical models have been developed prominent examples include the land equation land 1968 and the more recently proposed linear model steffy et al 1997 c dissolution trapping dissolution occurs as co2 contacts the undersaturated brine brine with dissolved co2 becomes more dense and tends to sink rather than rising up so the dissolved co2 is less susceptible to leakage the amount of co2 which can dissolve into brine depends on several physical parameters including pressure temperature and salinity of brine the co2 brine or co2 h2o equilibrium phenomenon has been studied extensively from experimental perspective the solubility of co2 in brine or h2o is measured across a wide range of temperatures and pressures as summarized in literature diamond and akinfiev 2003 duan and sun 2003 spycher et al 2003 these experimental data served as benchmarks for developing correlations or modifying the equation of state such that mathematical models are capable of representing physical observations enick and klara 1990 battistelli et al 1997 spycher et al 2003 li et al 2011a note that transport of dissolved co2 is governed not only by convection but also by hydrodynamic dispersion bear 2013 the latter one is composed of molecular diffusion and mechanical dispersion molecular diffusion is driven by the concentration gradient which is independent of the fluid flow for a typical co2 diffusivity 1 0 9 m s the characteristic diffusion length is relatively small compared to the co2 plume dimension hence molecular diffusion is usually not considered in field scale simulations doughty 2010 on the other hand mechanical dispersion is induced by local velocity variations due to microscopic heterogeneity of the porous medium saffman 1959 bachmat and bear 1964 as such this process is controlled by both fluid velocity and rock properties e g porosity and tortuosity the effect of hydrodynamic dispersion on convection is recently studied using high resolution numerical simulations wen et al 2018 de paoli 2021 results reveal that the relative importance of the role played by molecular diffusion and mechanical dispersion leads to a different dissolution rate nevertheless the macroscopic darcy scale description of hydrodynamic dispersion is still not clear which is a subject of ongoing investigation dentz et al 2018 liang et al 2018 d mineral trapping this trapping occurs when dissolved co2 reacts with minerals of the reservoir rock co2 could combine with h2o in liquid phase to form acid i e carbonic acid h2co3 which leads to ph reduction and induces the dissolution precipitation of minerals in the rock dai et al 2020 through chemical reactions co2 is trapped as a mineral phase which can be retained for a long period of time matter and kelemen 2009 despite its security these interactions are affected by mineral compositions and requires a detailed characterization of the mineral phases in the rock besides owing to their extremely slow reaction rates it may take thousands of years for reactions to reach equilibrium gaus 2010 as a result it poses significant challenges to model mineral trapping accurately different trapping mechanisms operate on varying time scales to clarify we use the injection period as a reference in general structural and stratigraphic trapping as well as residual trapping occur within the time scale close to the injection period because they are controlled by advective transport dissolution trapping comes into play during the injection period as well however this trapping occurs over much longer time scale and is considered to be the dominant trapping mechanism in the post injection period mineral trapping is retarded by slow reaction kinetics its time scale may even be an order of magnitude larger than the dissolution trapping juanes et al 2006 in addition redsaline aquifers are often found in sandstone which is a siliciclastic rock consisting of high percentage of quartz this mineral makes an insignificant contribution to geochemical reactions through the trapping process gunter et al 2000 therefore we will look into the first three trapping mechanisms in the following work they are collectively referred to as hydrodynamic trapping bachu et al 1994 although mineral trapping is not considered the time scale over which the other three trappings contribute still varies jiang 2011 moreover integrating hydrodynamic trapping into a unique platform is a nontrivial task challenges include but are not limited to the aspects of a accurate description of thermodynamic properties of co2 brine system especially in presence of impurities this directly affects the rate of co2 dissolution b robust algorithms to model hysteresis and its evolution in large scale flow models as to quantify residual trapping and c development of efficient discretization methods and solvers that help to improve the numerical performance class et al 2009 celia et al 2015 bui et al 2018 major advances in numerical modeling of co2 brine systems have featured in a simplified models with appropriate assumptions such that the computational complexity is reduced and b fully coupled models that include multiphase multicomponent flow and transport the vertical equilibrium model is a prominent example of the simplified ones nordbotten et al 2005 hesse et al 2008 dentz and tartakovsky 2009 gasda et al 2009 guo et al 2014 tao et al 2019 in this model the pressure distribution is assumed to be in equilibrium in the vertical direction orthogonal to the top and bottom boundaries and phase segregation occurs quickly as a result profiles of the variables in the vertical dimension are constructed using the solutions obtained in other dimension s this leads to the reduction of the problem size by one dimension on the other side the fully coupled model relaxes these assumptions albeit at a larger computational expense in solving the coupled equations one may investigate under which conditions a simplified model produces results that agree with such a fully coupled one at a lower computational cost and choose an effective simplified model to conduct more practical applications for more information and discussion about different modeling approaches readers are referred to celia et al 2015 bandilla et al 2015 this work focuses on the fully coupled model in this scenario depending on the purpose of each study the trapping mechanism is often studied in an isolated manner examples include investigations of residual trapping juanes et al 2006 ide et al 2007 gershenzon et al 2017 yang et al 2020 and dissolution trapping hassanzadeh et al 2007 deng et al 2012 sathaye et al 2014 note that hydrodynamic trapping has been included together in few research grade or commercial simulators e g tough2 pruess et al 1999 and cmg gem group 2020 these simulators are employed to study co2 storage in large field scale saline aquifers impacts of various physical properties of rocks and fluids including permeability wettability residual saturation constitutive relations as well as operational strategies on the amount to be trapped have been discussed extensively in literature doughty 2010 han et al 2011 li et al 2011b wriedt et al 2014 manceau and rohmer 2016 rasmusson et al 2016 al khdheeawi et al 2017 jayne et al 2019 ershadnia et al 2021 these investigations lend insight into determining the governing parameters under different situations however they suffer from two main limitations first due to a relatively coarse mesh size used in the studies the gravity induced convective transport which plays an essential role in post injection period may not be fully captured this could lead to an inaccurate assessment of the trapped amount especially for dissolution trapping secondly such sensitivity uncertainty analysis are often conducted based on the trapped amount obtained at a single point in time end of the simulation as a consequence the dynamic behavior of fluid flow in a highly unstable multiphase system and its impact on different trapping mechanisms remain relatively unexplored it is worth mentioning that several studies have been conducted to compare modeling results from different research teams class et al 2009 nordbotten et al 2012 they identified possible sources of differences observed in the results and highlighted several aspects which merit attention a a grid convergence study is of importance to minimize the grid induced errors b a step wise analysis should be conducted to investigate how model predictions react to different assumptions and simplifications and c meaningful predictions may only be possible with real time monitoring and history matching techniques driven by these limitations and learnings from previous studies in this work we analyze the dynamics of such multicomponent multiphase flow and the associated interactions between different hydrodynamic trapping mechanisms in a full cycle period the aforementioned model comparison studies have demonstrated that different assumptions lead to deviating prediction results whereas the causes behind such deviations may not be well understood to address this we develop a numerical simulator to allow for the studying of the interactions of different trapping mechanisms in a fully coupled system the underlying physics of different trapping mechanisms are modeled in one workflow in the remainder of this paper we first present governing equations and essential physical models involved in co2 storage in saline aquifers details of the physics associated with residual and dissolution trapping are addressed we then validate the developed simulator against a theoretical model reported in literature followed by a grid convergence test next we discuss the results obtained from different scenarios time lapsed gas saturation and solution co2 brine ratio profiles are visualized at representative points in time in addition contributions from different trapping mechanisms are quantified and analyzed we close with the key findings of this work 2 physical models and methods 2 1 governing equations we employ generalized mass conservation equations to describe the multicomponent multiphase system specifically two phases are present i e gas and liquid which are composed of two components co2 and brine brine consists of h2o and dissolved salt the governing equations are given by 2 1 t ϕ α x c α ρ α s α α x c α ρ α u α α x c α q α 0 where the subscripts α and c denote the phases l and g for liquid and gas and components co2 and brine respectively ϕ is the porosity of porous medium ρ α s α and q α are density saturation and source term of phase α x c α is the mole mass fraction of component c in phase α u α is darcy velocity expressed as 2 2 u α k k r α μ α ψ α where k is rock permeability k r α μ α and ψ α are relative permeability viscosity and potential of phase α ψ α is given by 2 3 ψ α p α ρ α g h where g is gravitational acceleration and h is depth phase pressures are related to each other by capillary pressure p c the overall composition variable set is used voskov and tchelepi 2012 cusini et al 2018 in general for a system of m components this formulation uses one phase pressure e g pressure of the wetting phase denoted by p w and m 1 total mole fractions z c as primary variables the residuals of m governing equations are linearized with respect to primary variables given by 2 4 r c ν 1 r c ν r c p w ν δ p w ν 1 i 1 m 1 r c z i ν δ z i ν 1 0 where ν and ν 1 are iteration steps here we have two components and two phases in which the liquid phase pressure p l and co2 mole fraction z co 2 serve as primary variables the coupled system is solved using a fully implicit scheme aziz 1979 cusini et al 2018 2 2 dissolution trapping the amount of co2 present in the liquid phase is quantified via the solution co2 brine ratio r s defined as the volume of co2 which dissolves into unit volume of brine at a given condition based on the measured co2 solubility across various conditions thermodynamic models tailored to the co2 brine system have been developed in literature we follow the thermodynamic model based on equating chemical potentials to predict the solubility of co2 at a given temperature and salinity spycher et al 2003 for detailed procedures readers are referred to appendix the resulting relation between r s and x co 2 l is given by hassanzadeh et al 2008 2 5 r s ρ b stc x co 2 l ρ co 2 stc 1 x co 2 l where the subscript b is short for brine the superscript stc denotes a property at standard conditions to verify our implementation the calculated molality curves of co2 in liquid phase at 6 0 c are compared with the data reported in literature spycher and pruess 2005 as shown in fig 1a predictions from the module agree well with the reference data across various salinity values which are typical in saline aquifers the molality data are then converted into solution co2 brine ratios using eq 2 5 and results are presented in fig 1b we observe that at the given temperature and salinity r s depends on pressure only these curves are eventually translated into lookup tables in the flow simulation physically speaking in each cell the amount of co2 that can dissolve into brine cannot exceed the available co2 therefore it is important to identify the number of existing phases hajibeygi and tchelepi 2014 to do that a stability check is performed after updating primary variables in each iteration step for this two phase isothermal system the fluid of a cell is in a single liquid phase if 2 6 c z c k c 1 0 is satisfied danesh 1998 where k c is the equilibrium ratio known as k v a l u e s expressed as 2 7 k c x c g x c l for the fluid model considered in this work k v a l u e s for co2 and brine are given by 2 8 k co 2 ρ co 2 stc r s ρ b stc ρ co 2 stc r s and k b 0 if the current cell is in two phase state the amount of dissolved co2 is obtained from solution co2 brine ratio curve which is generated in an offline stage the solution ratio curve is calculated using an independent i e offline module before the simulation starts on the other hand if the cell is in undersaturated state i e only the liquid phase exists r s is calculated based on mole fractions of the co2 component 2 9 r s ρ b stc z co 2 ρ co 2 stc 1 z co 2 in both scenarios the governing equation is well posed and the workflow associated with calculation of dissolved co2 is summarized in fig 2 2 3 residual trapping here we discuss the hysteretic behavior of the constitutive relations which are critical for secure co2 trapping after injection ceases in general relative permeability and capillary pressure functions are known as constitutive relations they govern the interactions between wetting liquid and nonwetting gas phases and also reflect the transport property of the matrix the non hysteretic model takes constitutive relations as functions of current local saturation only whereas the hysteretic model depends on not only current local saturation but also the history of saturation to illustrate figs 3a and 3b show constitutive relations used in the simulation the relative permeability curves approximate the experimental data reported in literature oak et al 1990 using a van genuchten equation van genuchten 1980 the experiment was conducted using berea sandstone which is strongly water wet and therefore we observe that the hysteresis effect is pronounced for the nonwetting gas phase whereas the wetting phase follows almost the same curve in both drainage and imbibition processes capillary pressure curves are given in the form of the leverett j function these curves of constitutive relations are believed to be representative of a co2 brine system ruprecht et al 2014 kuo and benson 2015 abdoulghafour et al 2020 note that predictions of such dynamic process are affected by the choice of models describing constitutive relations court et al 2012 oostrom et al 2016 their impacts are beyond the scope of this work to mimic the initial conditions we assume the gas saturation is at its minimum i e s g 0 as co2 starts being pumped into the reservoir constitutive relations follow the primary drainage curves until s g researches the maximum gas saturation s g max if s g starts decreasing after reaching this point constitutive relations will travel along the primary imbibition curve until s g reduces to the residual gas saturation s g r s g max however if drainage is interrupted before s g reaches s g max which is often the case the process is then transitioned from drainage to imbibition along the scanning curve which is created to ensure the transition is continuous killough 1976 carlson 1981 plohr et al 2001 the scanning curve is obtained based on the primary drainage and imbibition curves referred to as bounding curves killough 1976 the point where the transition occurs is named turning point s g t and its corresponding residual saturation s g r s g t is determined using a linear trapping model steffy et al 1997 2 10 s g r f r s g t where f r is a constant fraction this relation indicates that the trapped gas saturation increases along with the turning point saturation it is worth mentioning that when flow occurs along a scanning curve i e s g r s g t s g s g t any alternation of the flow processes will not produce a new scanning curve for the sake of numerical stability the main steps of computing the hysteretic constitutive relations are presented in algorithm 1 with a focus on the situation in which the transition happens as shown this algorithm entails a comparison of gas saturation s g at previous two time steps i e n and n 1 along with a boolean parameter l s c here l s c is nonzero if the flow process follows a scanning curve otherwise its value is zero it is used to keep track of the history of flow process in addition this algorithm requires the turning point at time step n s g t n in order to determine when the process leaves a scanning curve and returns to the drainage bounding curve l s c is updated whenever a transition occurs because each cell has its own saturation history the turning point differs from cell to cell this leads to different scanning curves as shown in figs 3b and 4b 2 4 simulator validation setup 2 4 1 validation we first validate the developed simulator against the solution of a theoretical model we consider the instantaneous release of buoyant fluid with fixed amount into a horizontal aquifer in a two dimensional domain macminn et al 2012 the buoyant fluid initially fills a small portion on the left side of the aquifer and the ambient fluid with higher density occupies the rest pore volume capillary pressure and dissolution are excluded in the model the spreading of buoyant fluid can be described using the following equation bear 2013 2 11 h t u x 1 f h h x 0 where h x t is the depth of the buoyant current at a given location x and time t u is the characteristic buoyancy velocity given by 2 12 u δ ρ g k ϕ μ l where δ ρ ρ h ρ l which denotes the density difference between ambient heavy fluid and buoyant light fluid subscripts h and l are short for heavy and light fluid respectively the function f is given by 2 13 f m h m 1 h h where m μ h μ l is the mobility ratio and h is the height of the aquifer the parameters used in the validation case is summarized in table 1 fig 5a presents the saturation maps of buoyant fluid at four moments in each map prediction of the depth of the buoyant current obtained from the theoretical model i e eq 2 11 is delineated by the dashed line as shown simulation results capture the spreading of buoyant fluid predicted by the theoretical model in addition we compare the leading position of the buoyant current shown in fig 5b simulation results follow the forecast of the theoretical model satisfactorily 2 4 2 setup from a geological perspective saline aquifers often have a dominating length in the longitudinal direction compared to their cross sectional width in such a case a 2d representation may be sensible in order to study interactions of different trapping mechanisms here simulations are performed in a two dimensional vertical cross section of a saline aquifer the length and height of the aquifer are 100 m and 50 m respectively which is discretized by 100 50 cells a grid convergence test is performed in the following subsection co2 is injected at a constant rate 8 1 0 5 pore volume per day through the bottom 10 m of the domain on the left side a production well penetrating the entire depth is placed on the right side the injection lasts 600 days followed by shut in of both wells we first consider a homogeneous permeability field k 40 md and investigate the dynamic interactions of different trapping mechanisms this case is referred to as the base case and the physical parameters used in the simulation are presented in table 2 values of these physical parameters including pressure temperature and brine salinity are taken from the work conducted by ide et al 2007 they are believed to be typical for the sequestration of co2 being a supercritical fluid in deep 2500 m saline aquifers such settings however do not apply for shallow aquifers where co2 is in the gaseous phase note that with the given physical parameters and the simulation settings the resulting capillary number range away from well bore is approximately 0 to 10 7 which is in line with the range reported by ni et al 2021 for field scale scenarios as a result flow tends to fall in the capillary dominated regime lenormand et al 1988 zhang et al 2011 guo and aryana 2019 in which the validity of the classical model multiphase extension of darcy s law i e eq 2 2 can be challenged alternatively non equilibrium models can be considered as discussed in the literature hassanizadeh and gray 1993 barenblatt et al 2002 joekar niasar et al 2010 wang et al 2019 however despite being widely used it is not yet trivial to confirm whether or not the equilibrium based model selected for this study is representative enough consideration of the impact of non equilibrium physics stays outside the scope of this work and can be performed in future research to demonstrate the relative significance of incorporating hysteresis capillary pressure and dissolution into the model simulations are also conducted in the absence of these physics followed by that we look into the impacts of spatial heterogeneity by imposing nonhomogeneous permeability fields in particular we consider two cases modified from the top and bottom layer of spe10 comparative test case christie and blunt 2001 they are labeled as mspe10top and mspe10bottom respectively in both cases the permeability field is scaled such that the average permeability is the same as the permeability in the homogeneous case all simulation cases discussed in the next section are summarized in table 3 in which the difference of each case compared to the base one is commented upon 2 4 3 grid convergence a grid convergence test is performed using physical parameters and simulation settings presented in table 2 for simplicity hysteresis is not considered in this test as aforementioned the gravity induced convection in post injection period triggers the development of sinking fingers from the top saturated layer for this reason capturing the evolution of descending fingers is essential for quantifying the amount of dissolution simulations are performed at different resolutions with the grid size given by 5 m 2 m 1 m and 0 5 m in each direction fig 6a shows the solution co2 brine ratio equivalent to co2 concentration at the end of simulation it is observed that as the mesh becomes finer more details of the convention front are resolved number of fingers increases in the map with a higher resolution the time lapsed behavior of trapping fraction defined as the ratio of the trapped co2 over the total amount of injection is presented in fig 6b as shown the result obtained when δ x 5 m has relatively pronounced differences compared to the other curves moreover the prediction from the case of δ x 1 m agrees with that obtained when δ x 0 5 m except at intermediate times it should be noted that to fully resolve flow instability the grid size is usually set to be below the critical wavelength riaz and tchelepi 2006 berg and ott 2012 fu et al 2013 hewitt et al 2013 green and ennis king 2014 wang et al 2020 pirozzoli et al 2021 however such resolution may not be practical for field scale applications here the maps of the solution co2 brine ratio do exhibit differing fingering behavior in cases when δ x 1 m and δ x 0 5 m nevertheless the time lapsed dissolution rates seem to converge at the end of the simulation period the difference of the dissolved amount between the two cases is around 2 this indicates that capturing each individual finger may not be necessary for the convergence of trapping quantities elenius et al 2015 to balance the accuracy and computational cost we use the grid size of δ x 1 m in the following study this grid resolution is also reported to be sufficient for relatively large scale models in literature yamamoto and doughty 2011 oostrom et al 2016 elenius et al 2015 wen and benson 2019 lyu et al 2021 3 results and discussion our main results exhibit the dynamics of interactions between co2 and brine in a full cycle process including co2 injection migration and post migration periods to provide quantitative comparisons in each simulated case we record the amount of co2 trapped by dissolution and residual trapping which are considered to be secure in hydrodynamic trapping they are calculated based on the solution co2 brine ratio and gas phase saturation maps respectively the overall trapped amount is the summation of these two types in the following discussion the nondimensionalized elapsed time t defined as the ratio of the elapsed time over the duration of the injection period is used this indicates the injection period is 0 t 1 and injection ceases right at t 1 the injected volume of co2 is 3 of the aquifer pore volume in each case the profile of s g and r s are visualized at five moments one during injection period t 0 5 0 8 years one at the end of injection t 1 1 6 years and the remaining three in the post injection period t 20 40 60 32 9 65 7 98 6 years our results provide insight into the interplay of these trapping mechanisms and the underlying physics that were previously unexplored 3 1 temporal multiscale nature the saturation and dissolution ratio profiles shown in fig 7 clearly reveal the variety of time scales in which different trapping mechanisms operate take the base case as an example shown in fig 7a during the injection period the evolution of saturation distribution is obvious co2 flows upwards as soon as it is injected from the bottom layer due to strong buoyancy forces after flow arrives at the top boundary it develops in the horizontal direction underneath the sealing layer in the post injection period however differences between saturation maps are insignificant the saturation maps partially reveal the fraction of trapped co2 due to residual trapping as shown in fig 8b the solid curve in red increases immediately after the injection ceases reaching the maximum level in a short period of time t 2 after that the fraction curve starts to decrease which is not revealed in saturation maps this is resulting from the interplay between different trapping mechanisms which will be discussed in the following subsection as for r s we look into the solution ratio maps of the base case for illustration as well during the injection period dissolution occurs along with the invasion of co2 the contact interface in the profile of r s evolves with that in the s g map simultaneously at this stage the amount of dissolved co2 is controlled by the advective transport after the injection period the co2 saturated region can be classified into two regions with different behaviors the first region is formed by the vertical migration of co2 and the second one is created by the lateral spreading underneath the top boundary in the first region the co2 rich brine slumps away from the source region and propagates along the bottom layer a transition zone is developed between the gravity current and the overriding brine meanwhile in the second region since the top saturated layer is more dense than the underlying intact brine it is unstable and creates descending fingers rooted along the contact interface note that despite the mechanism of dissolution trapping varies temporally during and after the injection period its contribution seems to be equally important as shown in fig 8a this implies that ignoring the dissolution trapping during the injection period may lead to an underestimate of the overall trapping amount to illustrate the impact of model scale on the dynamic behavior of trapping we perform a sensitivity analysis by changing the length of the aquifer two additional cases are considered with length of 50 m and 200 m physical parameters and well treatment are identical to that of the base case time lapsed behaviors of different trapping mechanisms are presented in fig 9 as shown fraction curves obtained from different model scale follow similar patterns specifically dissolution trapping has an observable growth during the injection period its growth rate slows down after injection ceases and increases again at late time transitions of different stages are depicted by straight lines shown in fig 9a as for residual trapping its fraction increases rapidly right after the cease of injection followed by decline at a relatively small rate note that despite contributions from the two trapping mechanisms varying for models with different scales the underlying physics which govern their interactions through the investigated period are equivalent in other words the trapping rates obtained from cases with varying aquifer length follow a similar pattern as depicted by solid gray lines in figs 9a and 9b we will therefore focus our discussions on the model with the same size to that of base case 3 2 interplay of hysteresis and dissolution trapping if hysteresis is not considered in the model the constitutive relations are evaluated based on primary drainage imbibition curves shown in fig 3 in this case residual saturation of gas phase becomes zero and therefore residual trapping is zero at all times shown in fig 8b as aforementioned advective transport plays a major role during the injection period and therefore gas saturation increases monotonically in most if not all of the swept cells under such a process the impact of hysteresis is trivial we observe that the s g and r s profiles in these two cases with without hysteresis are almost identical and their fraction curves for dissolved co2 are overlapping shown in fig 8a after injection ceases co2 that remained near the injection well moves upwards and accumulates near the top of the aquifer this leads to a thicker saturated layer compared to the base case followed by the development of sinking fingers we note that the interaction of fingers becomes more pronounced without hysteresis the number of fingers is reduced observably near the production well from t 20 to t 40 small scale fingers tend to merge at the finger root and develop into large scale fingers now that all free co2 migrates upward less will travel laterally with the gravity current as dissolved co2 such a reduction in dissolved co2 seems to be partially offset by a stronger fingering behavior which enhances the dissolution as a result the amount of dissolved co2 without hysteresis is close to that of the base case throughout the full cycle process next we exclude dissolution by assuming co2 exists in gas phase only the resulting system becomes immiscible and dissolution trapping vanishes accordingly as shown in fig 7d the front position of co2 plume propagates further compared to that of the base case during the injection period this is because the amount of free co2 increases in the absence of dissolution we also observe that the amount of trapped co2 due to residual trapping remains unchanged once it reaches the maximum value shown in fig 8b this differs from what we have seen in the base case it can be inferred that the convective transport driven by dissolution during the post injection period leads to a shifting of constitutive relations i e from scanning curves back to the primary drainage curve in the region near sealing layer as a result the trapped gas turns into free gas and the trapped amount due to residual trapping decreases 3 3 role of capillary pressure intuitively one would expect that exclusion of capillary pressure sharpens the co2 brine interfaces which are observed in saturation profiles without capillary pressure see fig 7c in consequence gas phase tends to have higher saturation values in the invading zone this leads to a smaller swept area when injection ceases resulting in reductions of dissolved co2 compared to that of the base case moreover such a reduction near the top layer undermines the convective transport in the post injection period sinking fingers are less active compared with the base case as shown in fig 8a the amount of dissolved co2 without capillarity starts to deviate from the base case after t 0 1 and the deviation becomes more pronounced as time elapses the saturation profiles from the post injection period without capillarity fig 7c exhibit that gas saturation reaches its maximum value 0 8 in the layer underneath the top boundary consequently a substantial amount of gas on the top layer is mobile which may be subject to leakage from the cap rock on the other hand the maximum gas saturation in the base case throughout the process is 0 57 which is certainly smaller than 0 8 it can be inferred that capillary pressure helps the brine imbibe into the top layer reverses the flow process before the saturation reaches its maximum value and thus facilitates the residual trapping plug and bruining 2007 wang and tokunaga 2015 alyafei and blunt 2018 fig 8c shows that the amount of overall trapping in the absence of capillarity is reduced significantly compared to that of the base case 3 4 impact of absolute permeability we have so far concentrated on the physics associated with fluids in this subsection we study the impact of permeability on the trapping process we first alter the absolute permeability in the homogeneous case and then examine heterogeneous permeability fields 3 4 1 homogeneous field we consider two more permeability values one is lower than that of the base i e k 20 md and the other one is higher note that a higher permeability leads to an earlier breakthrough to ensure all injected co2 remains in the aquifer we set the higher one to be k 72 md changing absolute permeability affects the relative significance of the viscous force and gravity force as indicated by the gravity number n gv which is proportional to the vertical permeability in the homogeneous case the permeability field is isotropic i e k x k z k so that an aquifer with a lower k results in a smaller n gv a larger smaller n gv indicates the gravity viscous force is more dominant respectively as shown in fig 10a in the case of k 72 md the co2 plume forms a stronger gravity tongue compared to that of the base case the displacement front has propagated to the right boundary when injection stops t 1 this is because injected co2 readily rises towards the top due to the predominant gravity force on the contrary fig 10b shows that for displacement with a low n gv gas saturation maps exhibit a distinct horizontal migration of the injected co2 in post injection period a higher k facilitates the gravity induced convective transport thereby expediting the growth of sinking fingers the associated dynamic behavior of different trapping mechanisms are presented in fig 11 as shown in fig 11a differences of the dissolved amount during the injection period are insignificant meanwhile different values of k lead to different flow configurations which are clearly depicted in solution co2 brine ratio profiles note that during the injection period most of the swept cells are in a saturated state the solution co2 brine ratio profiles exhibit little variation in color for this reason each swept cell dissolves same amount of co2 approximately and the total dissolved amount could be estimated by the swept area in view of the minor differences of fraction curves shown in fig 11a at t 1 we can infer that at the end of injection the swept areas in the studied cases of differing k are close fig 11b shows the fraction of residual trapping for the three investigated cases a smaller k results in a larger trapped amount maximum value before decline occurs this is due to the fact that in the case of low k swept cells that participate in residual trapping have a higher free gas saturation prior to the cease of injection and a higher free gas saturation is transitioned into a larger residual gas saturation following the linear trapping model moreover the gravity induced convective transport is suppressed in such a low k case as a result we observe that in the post injection period the decline for k 20 md is negligible whereas the fraction curves obtained from the remaining two cases exhibit pronounced reductions in the end the residual trapping amount differs significantly and it plays the major role in determining the overall trapped amount see fig 11c 3 4 2 heterogeneous field here two heterogeneous permeability fields are investigated with varying spatial correlations mspe10top and mspe10bottom exhibit patchy and channeling patterns respectively as shown in the gas phase saturation maps in fig 12 during the injection period free co2 mainly accumulates in areas a underneath the top boundary and b near the injection well such physical processes have been identified in the study of homogeneous fields similar to what we have seen in the case of k 20 md in which free co2 tends to migrate in the horizontal direction here we observe that some co2 migrates laterally in the low permeability region near the injection well such movement is initiated by the viscous force which overwhelms the gravity forces locally this lateral movement increases the swept area so that it benefits dissolution trapping in addition free gas accumulates in the low permeability region and therefore such movement favors residual trapping as well after the injection ceases solution ratio maps in figs 12a and 12b show that the propagation of sinking fingers from the top saturated layer is impacted by the permeability distribution significantly originated from different locations along the interface these fingers tend to invade in high permeability zones which results in complex configurations in the end the overall trapped amount in heterogeneous cases is greater than that in the base case see fig 13c it is noted that another trapping mechanism referred to as local capillary trapping occurs when the buoyant co2 encounters a region in which the local capillary entry pressure is greater than the average pressure of gas phase in this case co2 tends to accumulate or migrate beneath such a region saadatpoor et al 2010 jackson and krevor 2020 here we assume a relatively negligible capillary entry pressure as a result this trapping mechanism is not accounted for in cases with heterogeneous permeability fields which deserves future investigation 4 conclusions we have systematically investigated co2 storage in saline aquifers in a full cycle period via the recently developed unified numerical framework our model represents the hysteretic characteristics of the constitutive relations i e relative permeability and capillary pressure in a robust manner moreover we employ a compositional formulation to capture the dissolution trapping in which the co2 brine ratio is calculated based on an accurate thermodynamic model through visualization of saturation and solution ratio profiles at different stages we have provided numerical evidence that the residual and dissolution trapping have their own time scales of importance in particular residual trapping comes into effect mainly after the injection ceases whereas dissolution trapping has played a significant role from the beginning of injection residual trapping is affected by the swept area in which flow processes will be reversed and the associated free gas saturation when injection ceases in post injection period the convective transport triggered by the density difference due to dissolution trapping reactivates a certain amount of immobile gas resulting in a reduction of the trapped amount from residual trapping such a reduction becomes less pronounced in the case of a homogeneous aquifer with a lower permeability furthermore we show that contribution from residual trapping regarding the overall trapped amount increases for a system with a lower permeability therefore it is critical to characterize the hysteresis behavior in such systems accurately on the other side the solution co2 brine ratio profiles reveal that the dissolution trapping operates under varying mechanisms at different stages during injection period dissolution occurs in the swept area in this stage both trapping mechanisms are controlled by advective flow dynamics different flow configurations due to differing driving forces may give comparable swept areas and result in similar trapped amounts the existence of spatial heterogeneity i e heterogeneous permeability field enlarges the swept area and therefore enhances the dissolution trapping after injection ceases dissolution continues across the subsequent interface via gravity induced convective transport the dissolution rate becomes relatively small because it takes time for the sinking fingers to generate and grow after this transition period the rate has an observable increase indicating the sinking fingers have fully developed these findings highlight the significance of capturing co2 plume migration during the early injection time which is strongly connected to the assessment of trapped co2 in post injection period our results reveal the inherent multiscale nature of co2 storage in saline aquifers understanding the interplay between different trapping mechanisms is essential for an accurate assessment of trapped co2 in a full cycle period this study lays the foundation for interpretation of physical observations optimal design of field operations and further investigation of co2 storage in faulted and fractured systems credit authorship contribution statement yuhang wang conceptualization methodology software writing original draft cornelis vuik writing editing hadi hajibeygi conceptualization methodology writing editing grant acquiring declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments hadi hajibeygi was sponsored by the dutch national science foundation nwo under vidi talent program project admire project number 17509 we thank the admire user committee for allowing us publish this paper groups members of darsim delft advanced reservoir simulation and admire adaptive dynamic multiscale integrated reservoir earth are acknowledged for fruitful discussions during the development of this work the source code developed for this research is openly accessible via https gitlab com darsim address appendix solubility of co2 here we present detailed workflow for calculating the solubility of co2 at given temperature and salinity first we consider an equilibrium system which is composed of co2 and h2o the equilibrium constants are given by a 1 κ h 2 o f h 2 o g a h 2 o l and a 2 κ co 2 f co 2 g a co 2 l where a c is the activity coefficient of component c in liquid phase f c is the fugacity of component c in gas phase defined as a 3 f c φ c x c g p where φ c is the fugacity coefficient and p is total pressure the equilibrium constant at given temperature and pressure is expressed as spycher et al 2003 a 4 κ c t p κ c 0 t p 0 exp p p 0 v c r t where r is gas constant p 0 is reference pressure 1 bar v c is the average partial molar volume of the condensed component c over the pressure interval p 0 to p to calculate the mole fraction of co2 in liquid phase x co 2 l eqs a 1 to a 4 are recast by setting spycher et al 2003 a 5 a κ h 2 o 0 φ h 2 o p exp p p 0 v h 2 o r t and a 6 b φ co 2 p 55 508 κ co 2 0 exp p p 0 v co 2 r t such that a 7 x co 2 l b 1 x h 2 o g where x h 2 o g 1 b 1 a b the fugacity coefficients in eqs a 5 and a 6 are derived using the redlich kwong equation of state rk eos redlich and kwong 1949 a 8 p r t v b a t 0 5 v v b where v is molar volume a and b are parameters associated with attractive and repulsive interactions respectively in the binary mixture system of h2o and co2 a and b are calculated by the following mixing rules prausnitz et al 1998 a 9 a m x h 2 o g 2 a h 2 o 2 x h 2 o g x co 2 g a h 2 o co 2 x co 2 g 2 a co 2 and a 10 b m x h 2 o g b h 2 o x co 2 g b co 2 the fugacity coefficient of a component c φ c is then calculated based on these mixing rules and rk eos prausnitz et al 1998 a 11 ln φ c ln v v b m b c v b m 2 i n c x i g a i c r t 1 5 b m ln v b m v a m b c r t 1 5 b m 2 ln v b m v b m v b m ln p v r t to facilitate the implementation we assume co2 exists in both liquid and gas phases whereas h2o exists in liquid phase only this assumption implies x h 2 o g 0 and x co 2 g 1 as a result a m and b m in eqs a 9 and a 10 are simplified to a co 2 and b co 2 respectively now that x co 2 l is obtained the co2 molality in h2o can be calculated given by a 12 m co 2 0 55 508 x co 2 g 1 x co 2 g we have focused on co2 h2o mixtures so far to connect co2 molality in pure water to that in brine the co2 activity coefficient is used a 13 m co 2 m co 2 0 γ co 2 using the co2 molality in brine the mole fraction of co2 in liquid phase can be calculated by a 14 x co 2 l m co 2 m co 2 55 508 n i m s where n i is the stoichiometric number of ions in the salt and m s is salt molality at last the solution co2 brine ratio is obtained by a 15 r s ρ b stc x co 2 l ρ co 2 stc 1 x co 2 l eq a 15 holds for cells in saturated state 
213,co2 injection into deep saline aquifers has shown to be a feasible option as for their large storage capacity under safe operational conditions previous studies have revealed that co2 can be trapped in the subsurface by several mechanisms despite the major advances in studying these trapping mechanisms their dynamic interactions in different periods of a full cycle process have not been well understood i e they are studied independently at their so called separate time scales of importance these mechanisms however are dynamically interconnected and influence each other even outside of their main time scale of importance besides previous studies on field scale simulations often choose grid cells which are too coarse to capture flow dynamics especially in post injection period to this end we develop a comprehensive framework to analyze the flow dynamics and the associated hydrodynamic trapping process in which the co2 injection migration and post migration period are all considered in a unified manner through illustrative models with sufficient grid resolution we quantify the impact of different trapping mechanisms and uncertain reservoir properties through a full cycle process we demonstrate that the time scale associated with each trapping mechanism indeed varies yet their dynamic interplay needs to be considered for accurate and reliable predictions results reveal that residual trapping is governed by the advective transport in the injection period and its contribution to the overall trapped amount becomes more significant in systems with lower permeability dissolution trapping operates under varying driving forces at different stages in the injection period the dissolution process is controlled by advective transport and later enhanced by the gravity induced convection in the post injection period such convective transport diminishes the contribution from residual trapping our study sheds light on the impact of the coupled reservoir and fluid time dependent interactions in estimation of the securely trapped co2 in saline aquifers keywords geologic carbon storage multiphase flow in porous media compositional simulation multiphysics interaction 1 introduction carbon dioxide capture and storage ccs has been identified as a promising strategy to mitigate climate change due to anthropogenic co2 emissions given the urgency with respect to limiting global warming recent decades have witnessed a remarkable increase of research interest around co2 storage in subsurface systems bui et al 2018 of the geological media being considered hydrocarbon oil and gas reservoirs and deep saline aquifers have shown to be successful at pilot and commercial scales orr jr 2009 szulczewski et al 2012 bachu 2015 storing co2 in hydrocarbon reservoirs is relatively straightforward because the geological structures in which buoyant hydrocarbons were retained for quite a long time have proved to be safe in addition the storage capacity could be estimated based on the volume of produced oil gas assuming hydrocarbons will be completely replaced by co2 bachu et al 2007 the storage can become more economically attractive by being combined with enhanced oil recovery eor dai et al 2014 ampomah et al 2017 or geothermal energy production randolph and saar 2011 on the other hand for co2 storage in saline aquifers the flowing fluids are primarily composed of co2 and brine due to their distinct mobility contrast and geological heterogeneities such a displacement process is unstable moreover various trapping mechanisms operating on different time scales add to the complexity in understanding such a dynamic process mechanisms by which co2 can be retained in saline aquifers have been classified rubin and de coninck 2005 and include the following a structural and stratigraphic trapping b residual trapping c dissolution trapping and d mineral trapping a structural and stratigraphic trapping this refers to the process of upward migration of buoyant co2 being inhibited by an overlying impermeable or low permeable cap rock in such a case the risk of leakage is not eliminated because the accumulated co2 under the sealing rock is mobile in practice injection operations may overpressurize the reservoir leading to activation of faults and fractures from which mobile co2 is likely to escape rutqvist 2012 zoback and gorelick 2012 rinaldi et al 2014 white et al 2014 espinoza and santamarina 2017 zappone et al 2021 this coupled process of fluid flow and geomechanics associated with ccs has attracted growing attention from both numerical and experimental perspectives which is out of the scope of this work b residual trapping co2 is generally the non wetting phase in many sedimentary rocks consequently brine as the wetting phase tends to imbibe into co2 plume at the trailing edge after injection stops juanes et al 2006 such imbibition leaves co2 behind as disconnected immobile bubbles and ganglia hunt et al 1988 this process is referred to as residual trapping it originates from hysteresis which occurs when the rock exhibits strong wettability preference to a specific phase experimental investigations have revealed the hysteretic behavior of co2 brine system by measuring relative permeability akbarabadi and piri 2013 ruprecht et al 2014 and capillary pressure wang and tokunaga 2015 pini and benson 2017 as functions of saturation these physical measurements demonstrate that constitutive relations rely on the history of saturation as a consequence the residual saturation of nonwetting phase is closely related to the history as well to describe the trapping characteristics several mathematical models have been developed prominent examples include the land equation land 1968 and the more recently proposed linear model steffy et al 1997 c dissolution trapping dissolution occurs as co2 contacts the undersaturated brine brine with dissolved co2 becomes more dense and tends to sink rather than rising up so the dissolved co2 is less susceptible to leakage the amount of co2 which can dissolve into brine depends on several physical parameters including pressure temperature and salinity of brine the co2 brine or co2 h2o equilibrium phenomenon has been studied extensively from experimental perspective the solubility of co2 in brine or h2o is measured across a wide range of temperatures and pressures as summarized in literature diamond and akinfiev 2003 duan and sun 2003 spycher et al 2003 these experimental data served as benchmarks for developing correlations or modifying the equation of state such that mathematical models are capable of representing physical observations enick and klara 1990 battistelli et al 1997 spycher et al 2003 li et al 2011a note that transport of dissolved co2 is governed not only by convection but also by hydrodynamic dispersion bear 2013 the latter one is composed of molecular diffusion and mechanical dispersion molecular diffusion is driven by the concentration gradient which is independent of the fluid flow for a typical co2 diffusivity 1 0 9 m s the characteristic diffusion length is relatively small compared to the co2 plume dimension hence molecular diffusion is usually not considered in field scale simulations doughty 2010 on the other hand mechanical dispersion is induced by local velocity variations due to microscopic heterogeneity of the porous medium saffman 1959 bachmat and bear 1964 as such this process is controlled by both fluid velocity and rock properties e g porosity and tortuosity the effect of hydrodynamic dispersion on convection is recently studied using high resolution numerical simulations wen et al 2018 de paoli 2021 results reveal that the relative importance of the role played by molecular diffusion and mechanical dispersion leads to a different dissolution rate nevertheless the macroscopic darcy scale description of hydrodynamic dispersion is still not clear which is a subject of ongoing investigation dentz et al 2018 liang et al 2018 d mineral trapping this trapping occurs when dissolved co2 reacts with minerals of the reservoir rock co2 could combine with h2o in liquid phase to form acid i e carbonic acid h2co3 which leads to ph reduction and induces the dissolution precipitation of minerals in the rock dai et al 2020 through chemical reactions co2 is trapped as a mineral phase which can be retained for a long period of time matter and kelemen 2009 despite its security these interactions are affected by mineral compositions and requires a detailed characterization of the mineral phases in the rock besides owing to their extremely slow reaction rates it may take thousands of years for reactions to reach equilibrium gaus 2010 as a result it poses significant challenges to model mineral trapping accurately different trapping mechanisms operate on varying time scales to clarify we use the injection period as a reference in general structural and stratigraphic trapping as well as residual trapping occur within the time scale close to the injection period because they are controlled by advective transport dissolution trapping comes into play during the injection period as well however this trapping occurs over much longer time scale and is considered to be the dominant trapping mechanism in the post injection period mineral trapping is retarded by slow reaction kinetics its time scale may even be an order of magnitude larger than the dissolution trapping juanes et al 2006 in addition redsaline aquifers are often found in sandstone which is a siliciclastic rock consisting of high percentage of quartz this mineral makes an insignificant contribution to geochemical reactions through the trapping process gunter et al 2000 therefore we will look into the first three trapping mechanisms in the following work they are collectively referred to as hydrodynamic trapping bachu et al 1994 although mineral trapping is not considered the time scale over which the other three trappings contribute still varies jiang 2011 moreover integrating hydrodynamic trapping into a unique platform is a nontrivial task challenges include but are not limited to the aspects of a accurate description of thermodynamic properties of co2 brine system especially in presence of impurities this directly affects the rate of co2 dissolution b robust algorithms to model hysteresis and its evolution in large scale flow models as to quantify residual trapping and c development of efficient discretization methods and solvers that help to improve the numerical performance class et al 2009 celia et al 2015 bui et al 2018 major advances in numerical modeling of co2 brine systems have featured in a simplified models with appropriate assumptions such that the computational complexity is reduced and b fully coupled models that include multiphase multicomponent flow and transport the vertical equilibrium model is a prominent example of the simplified ones nordbotten et al 2005 hesse et al 2008 dentz and tartakovsky 2009 gasda et al 2009 guo et al 2014 tao et al 2019 in this model the pressure distribution is assumed to be in equilibrium in the vertical direction orthogonal to the top and bottom boundaries and phase segregation occurs quickly as a result profiles of the variables in the vertical dimension are constructed using the solutions obtained in other dimension s this leads to the reduction of the problem size by one dimension on the other side the fully coupled model relaxes these assumptions albeit at a larger computational expense in solving the coupled equations one may investigate under which conditions a simplified model produces results that agree with such a fully coupled one at a lower computational cost and choose an effective simplified model to conduct more practical applications for more information and discussion about different modeling approaches readers are referred to celia et al 2015 bandilla et al 2015 this work focuses on the fully coupled model in this scenario depending on the purpose of each study the trapping mechanism is often studied in an isolated manner examples include investigations of residual trapping juanes et al 2006 ide et al 2007 gershenzon et al 2017 yang et al 2020 and dissolution trapping hassanzadeh et al 2007 deng et al 2012 sathaye et al 2014 note that hydrodynamic trapping has been included together in few research grade or commercial simulators e g tough2 pruess et al 1999 and cmg gem group 2020 these simulators are employed to study co2 storage in large field scale saline aquifers impacts of various physical properties of rocks and fluids including permeability wettability residual saturation constitutive relations as well as operational strategies on the amount to be trapped have been discussed extensively in literature doughty 2010 han et al 2011 li et al 2011b wriedt et al 2014 manceau and rohmer 2016 rasmusson et al 2016 al khdheeawi et al 2017 jayne et al 2019 ershadnia et al 2021 these investigations lend insight into determining the governing parameters under different situations however they suffer from two main limitations first due to a relatively coarse mesh size used in the studies the gravity induced convective transport which plays an essential role in post injection period may not be fully captured this could lead to an inaccurate assessment of the trapped amount especially for dissolution trapping secondly such sensitivity uncertainty analysis are often conducted based on the trapped amount obtained at a single point in time end of the simulation as a consequence the dynamic behavior of fluid flow in a highly unstable multiphase system and its impact on different trapping mechanisms remain relatively unexplored it is worth mentioning that several studies have been conducted to compare modeling results from different research teams class et al 2009 nordbotten et al 2012 they identified possible sources of differences observed in the results and highlighted several aspects which merit attention a a grid convergence study is of importance to minimize the grid induced errors b a step wise analysis should be conducted to investigate how model predictions react to different assumptions and simplifications and c meaningful predictions may only be possible with real time monitoring and history matching techniques driven by these limitations and learnings from previous studies in this work we analyze the dynamics of such multicomponent multiphase flow and the associated interactions between different hydrodynamic trapping mechanisms in a full cycle period the aforementioned model comparison studies have demonstrated that different assumptions lead to deviating prediction results whereas the causes behind such deviations may not be well understood to address this we develop a numerical simulator to allow for the studying of the interactions of different trapping mechanisms in a fully coupled system the underlying physics of different trapping mechanisms are modeled in one workflow in the remainder of this paper we first present governing equations and essential physical models involved in co2 storage in saline aquifers details of the physics associated with residual and dissolution trapping are addressed we then validate the developed simulator against a theoretical model reported in literature followed by a grid convergence test next we discuss the results obtained from different scenarios time lapsed gas saturation and solution co2 brine ratio profiles are visualized at representative points in time in addition contributions from different trapping mechanisms are quantified and analyzed we close with the key findings of this work 2 physical models and methods 2 1 governing equations we employ generalized mass conservation equations to describe the multicomponent multiphase system specifically two phases are present i e gas and liquid which are composed of two components co2 and brine brine consists of h2o and dissolved salt the governing equations are given by 2 1 t ϕ α x c α ρ α s α α x c α ρ α u α α x c α q α 0 where the subscripts α and c denote the phases l and g for liquid and gas and components co2 and brine respectively ϕ is the porosity of porous medium ρ α s α and q α are density saturation and source term of phase α x c α is the mole mass fraction of component c in phase α u α is darcy velocity expressed as 2 2 u α k k r α μ α ψ α where k is rock permeability k r α μ α and ψ α are relative permeability viscosity and potential of phase α ψ α is given by 2 3 ψ α p α ρ α g h where g is gravitational acceleration and h is depth phase pressures are related to each other by capillary pressure p c the overall composition variable set is used voskov and tchelepi 2012 cusini et al 2018 in general for a system of m components this formulation uses one phase pressure e g pressure of the wetting phase denoted by p w and m 1 total mole fractions z c as primary variables the residuals of m governing equations are linearized with respect to primary variables given by 2 4 r c ν 1 r c ν r c p w ν δ p w ν 1 i 1 m 1 r c z i ν δ z i ν 1 0 where ν and ν 1 are iteration steps here we have two components and two phases in which the liquid phase pressure p l and co2 mole fraction z co 2 serve as primary variables the coupled system is solved using a fully implicit scheme aziz 1979 cusini et al 2018 2 2 dissolution trapping the amount of co2 present in the liquid phase is quantified via the solution co2 brine ratio r s defined as the volume of co2 which dissolves into unit volume of brine at a given condition based on the measured co2 solubility across various conditions thermodynamic models tailored to the co2 brine system have been developed in literature we follow the thermodynamic model based on equating chemical potentials to predict the solubility of co2 at a given temperature and salinity spycher et al 2003 for detailed procedures readers are referred to appendix the resulting relation between r s and x co 2 l is given by hassanzadeh et al 2008 2 5 r s ρ b stc x co 2 l ρ co 2 stc 1 x co 2 l where the subscript b is short for brine the superscript stc denotes a property at standard conditions to verify our implementation the calculated molality curves of co2 in liquid phase at 6 0 c are compared with the data reported in literature spycher and pruess 2005 as shown in fig 1a predictions from the module agree well with the reference data across various salinity values which are typical in saline aquifers the molality data are then converted into solution co2 brine ratios using eq 2 5 and results are presented in fig 1b we observe that at the given temperature and salinity r s depends on pressure only these curves are eventually translated into lookup tables in the flow simulation physically speaking in each cell the amount of co2 that can dissolve into brine cannot exceed the available co2 therefore it is important to identify the number of existing phases hajibeygi and tchelepi 2014 to do that a stability check is performed after updating primary variables in each iteration step for this two phase isothermal system the fluid of a cell is in a single liquid phase if 2 6 c z c k c 1 0 is satisfied danesh 1998 where k c is the equilibrium ratio known as k v a l u e s expressed as 2 7 k c x c g x c l for the fluid model considered in this work k v a l u e s for co2 and brine are given by 2 8 k co 2 ρ co 2 stc r s ρ b stc ρ co 2 stc r s and k b 0 if the current cell is in two phase state the amount of dissolved co2 is obtained from solution co2 brine ratio curve which is generated in an offline stage the solution ratio curve is calculated using an independent i e offline module before the simulation starts on the other hand if the cell is in undersaturated state i e only the liquid phase exists r s is calculated based on mole fractions of the co2 component 2 9 r s ρ b stc z co 2 ρ co 2 stc 1 z co 2 in both scenarios the governing equation is well posed and the workflow associated with calculation of dissolved co2 is summarized in fig 2 2 3 residual trapping here we discuss the hysteretic behavior of the constitutive relations which are critical for secure co2 trapping after injection ceases in general relative permeability and capillary pressure functions are known as constitutive relations they govern the interactions between wetting liquid and nonwetting gas phases and also reflect the transport property of the matrix the non hysteretic model takes constitutive relations as functions of current local saturation only whereas the hysteretic model depends on not only current local saturation but also the history of saturation to illustrate figs 3a and 3b show constitutive relations used in the simulation the relative permeability curves approximate the experimental data reported in literature oak et al 1990 using a van genuchten equation van genuchten 1980 the experiment was conducted using berea sandstone which is strongly water wet and therefore we observe that the hysteresis effect is pronounced for the nonwetting gas phase whereas the wetting phase follows almost the same curve in both drainage and imbibition processes capillary pressure curves are given in the form of the leverett j function these curves of constitutive relations are believed to be representative of a co2 brine system ruprecht et al 2014 kuo and benson 2015 abdoulghafour et al 2020 note that predictions of such dynamic process are affected by the choice of models describing constitutive relations court et al 2012 oostrom et al 2016 their impacts are beyond the scope of this work to mimic the initial conditions we assume the gas saturation is at its minimum i e s g 0 as co2 starts being pumped into the reservoir constitutive relations follow the primary drainage curves until s g researches the maximum gas saturation s g max if s g starts decreasing after reaching this point constitutive relations will travel along the primary imbibition curve until s g reduces to the residual gas saturation s g r s g max however if drainage is interrupted before s g reaches s g max which is often the case the process is then transitioned from drainage to imbibition along the scanning curve which is created to ensure the transition is continuous killough 1976 carlson 1981 plohr et al 2001 the scanning curve is obtained based on the primary drainage and imbibition curves referred to as bounding curves killough 1976 the point where the transition occurs is named turning point s g t and its corresponding residual saturation s g r s g t is determined using a linear trapping model steffy et al 1997 2 10 s g r f r s g t where f r is a constant fraction this relation indicates that the trapped gas saturation increases along with the turning point saturation it is worth mentioning that when flow occurs along a scanning curve i e s g r s g t s g s g t any alternation of the flow processes will not produce a new scanning curve for the sake of numerical stability the main steps of computing the hysteretic constitutive relations are presented in algorithm 1 with a focus on the situation in which the transition happens as shown this algorithm entails a comparison of gas saturation s g at previous two time steps i e n and n 1 along with a boolean parameter l s c here l s c is nonzero if the flow process follows a scanning curve otherwise its value is zero it is used to keep track of the history of flow process in addition this algorithm requires the turning point at time step n s g t n in order to determine when the process leaves a scanning curve and returns to the drainage bounding curve l s c is updated whenever a transition occurs because each cell has its own saturation history the turning point differs from cell to cell this leads to different scanning curves as shown in figs 3b and 4b 2 4 simulator validation setup 2 4 1 validation we first validate the developed simulator against the solution of a theoretical model we consider the instantaneous release of buoyant fluid with fixed amount into a horizontal aquifer in a two dimensional domain macminn et al 2012 the buoyant fluid initially fills a small portion on the left side of the aquifer and the ambient fluid with higher density occupies the rest pore volume capillary pressure and dissolution are excluded in the model the spreading of buoyant fluid can be described using the following equation bear 2013 2 11 h t u x 1 f h h x 0 where h x t is the depth of the buoyant current at a given location x and time t u is the characteristic buoyancy velocity given by 2 12 u δ ρ g k ϕ μ l where δ ρ ρ h ρ l which denotes the density difference between ambient heavy fluid and buoyant light fluid subscripts h and l are short for heavy and light fluid respectively the function f is given by 2 13 f m h m 1 h h where m μ h μ l is the mobility ratio and h is the height of the aquifer the parameters used in the validation case is summarized in table 1 fig 5a presents the saturation maps of buoyant fluid at four moments in each map prediction of the depth of the buoyant current obtained from the theoretical model i e eq 2 11 is delineated by the dashed line as shown simulation results capture the spreading of buoyant fluid predicted by the theoretical model in addition we compare the leading position of the buoyant current shown in fig 5b simulation results follow the forecast of the theoretical model satisfactorily 2 4 2 setup from a geological perspective saline aquifers often have a dominating length in the longitudinal direction compared to their cross sectional width in such a case a 2d representation may be sensible in order to study interactions of different trapping mechanisms here simulations are performed in a two dimensional vertical cross section of a saline aquifer the length and height of the aquifer are 100 m and 50 m respectively which is discretized by 100 50 cells a grid convergence test is performed in the following subsection co2 is injected at a constant rate 8 1 0 5 pore volume per day through the bottom 10 m of the domain on the left side a production well penetrating the entire depth is placed on the right side the injection lasts 600 days followed by shut in of both wells we first consider a homogeneous permeability field k 40 md and investigate the dynamic interactions of different trapping mechanisms this case is referred to as the base case and the physical parameters used in the simulation are presented in table 2 values of these physical parameters including pressure temperature and brine salinity are taken from the work conducted by ide et al 2007 they are believed to be typical for the sequestration of co2 being a supercritical fluid in deep 2500 m saline aquifers such settings however do not apply for shallow aquifers where co2 is in the gaseous phase note that with the given physical parameters and the simulation settings the resulting capillary number range away from well bore is approximately 0 to 10 7 which is in line with the range reported by ni et al 2021 for field scale scenarios as a result flow tends to fall in the capillary dominated regime lenormand et al 1988 zhang et al 2011 guo and aryana 2019 in which the validity of the classical model multiphase extension of darcy s law i e eq 2 2 can be challenged alternatively non equilibrium models can be considered as discussed in the literature hassanizadeh and gray 1993 barenblatt et al 2002 joekar niasar et al 2010 wang et al 2019 however despite being widely used it is not yet trivial to confirm whether or not the equilibrium based model selected for this study is representative enough consideration of the impact of non equilibrium physics stays outside the scope of this work and can be performed in future research to demonstrate the relative significance of incorporating hysteresis capillary pressure and dissolution into the model simulations are also conducted in the absence of these physics followed by that we look into the impacts of spatial heterogeneity by imposing nonhomogeneous permeability fields in particular we consider two cases modified from the top and bottom layer of spe10 comparative test case christie and blunt 2001 they are labeled as mspe10top and mspe10bottom respectively in both cases the permeability field is scaled such that the average permeability is the same as the permeability in the homogeneous case all simulation cases discussed in the next section are summarized in table 3 in which the difference of each case compared to the base one is commented upon 2 4 3 grid convergence a grid convergence test is performed using physical parameters and simulation settings presented in table 2 for simplicity hysteresis is not considered in this test as aforementioned the gravity induced convection in post injection period triggers the development of sinking fingers from the top saturated layer for this reason capturing the evolution of descending fingers is essential for quantifying the amount of dissolution simulations are performed at different resolutions with the grid size given by 5 m 2 m 1 m and 0 5 m in each direction fig 6a shows the solution co2 brine ratio equivalent to co2 concentration at the end of simulation it is observed that as the mesh becomes finer more details of the convention front are resolved number of fingers increases in the map with a higher resolution the time lapsed behavior of trapping fraction defined as the ratio of the trapped co2 over the total amount of injection is presented in fig 6b as shown the result obtained when δ x 5 m has relatively pronounced differences compared to the other curves moreover the prediction from the case of δ x 1 m agrees with that obtained when δ x 0 5 m except at intermediate times it should be noted that to fully resolve flow instability the grid size is usually set to be below the critical wavelength riaz and tchelepi 2006 berg and ott 2012 fu et al 2013 hewitt et al 2013 green and ennis king 2014 wang et al 2020 pirozzoli et al 2021 however such resolution may not be practical for field scale applications here the maps of the solution co2 brine ratio do exhibit differing fingering behavior in cases when δ x 1 m and δ x 0 5 m nevertheless the time lapsed dissolution rates seem to converge at the end of the simulation period the difference of the dissolved amount between the two cases is around 2 this indicates that capturing each individual finger may not be necessary for the convergence of trapping quantities elenius et al 2015 to balance the accuracy and computational cost we use the grid size of δ x 1 m in the following study this grid resolution is also reported to be sufficient for relatively large scale models in literature yamamoto and doughty 2011 oostrom et al 2016 elenius et al 2015 wen and benson 2019 lyu et al 2021 3 results and discussion our main results exhibit the dynamics of interactions between co2 and brine in a full cycle process including co2 injection migration and post migration periods to provide quantitative comparisons in each simulated case we record the amount of co2 trapped by dissolution and residual trapping which are considered to be secure in hydrodynamic trapping they are calculated based on the solution co2 brine ratio and gas phase saturation maps respectively the overall trapped amount is the summation of these two types in the following discussion the nondimensionalized elapsed time t defined as the ratio of the elapsed time over the duration of the injection period is used this indicates the injection period is 0 t 1 and injection ceases right at t 1 the injected volume of co2 is 3 of the aquifer pore volume in each case the profile of s g and r s are visualized at five moments one during injection period t 0 5 0 8 years one at the end of injection t 1 1 6 years and the remaining three in the post injection period t 20 40 60 32 9 65 7 98 6 years our results provide insight into the interplay of these trapping mechanisms and the underlying physics that were previously unexplored 3 1 temporal multiscale nature the saturation and dissolution ratio profiles shown in fig 7 clearly reveal the variety of time scales in which different trapping mechanisms operate take the base case as an example shown in fig 7a during the injection period the evolution of saturation distribution is obvious co2 flows upwards as soon as it is injected from the bottom layer due to strong buoyancy forces after flow arrives at the top boundary it develops in the horizontal direction underneath the sealing layer in the post injection period however differences between saturation maps are insignificant the saturation maps partially reveal the fraction of trapped co2 due to residual trapping as shown in fig 8b the solid curve in red increases immediately after the injection ceases reaching the maximum level in a short period of time t 2 after that the fraction curve starts to decrease which is not revealed in saturation maps this is resulting from the interplay between different trapping mechanisms which will be discussed in the following subsection as for r s we look into the solution ratio maps of the base case for illustration as well during the injection period dissolution occurs along with the invasion of co2 the contact interface in the profile of r s evolves with that in the s g map simultaneously at this stage the amount of dissolved co2 is controlled by the advective transport after the injection period the co2 saturated region can be classified into two regions with different behaviors the first region is formed by the vertical migration of co2 and the second one is created by the lateral spreading underneath the top boundary in the first region the co2 rich brine slumps away from the source region and propagates along the bottom layer a transition zone is developed between the gravity current and the overriding brine meanwhile in the second region since the top saturated layer is more dense than the underlying intact brine it is unstable and creates descending fingers rooted along the contact interface note that despite the mechanism of dissolution trapping varies temporally during and after the injection period its contribution seems to be equally important as shown in fig 8a this implies that ignoring the dissolution trapping during the injection period may lead to an underestimate of the overall trapping amount to illustrate the impact of model scale on the dynamic behavior of trapping we perform a sensitivity analysis by changing the length of the aquifer two additional cases are considered with length of 50 m and 200 m physical parameters and well treatment are identical to that of the base case time lapsed behaviors of different trapping mechanisms are presented in fig 9 as shown fraction curves obtained from different model scale follow similar patterns specifically dissolution trapping has an observable growth during the injection period its growth rate slows down after injection ceases and increases again at late time transitions of different stages are depicted by straight lines shown in fig 9a as for residual trapping its fraction increases rapidly right after the cease of injection followed by decline at a relatively small rate note that despite contributions from the two trapping mechanisms varying for models with different scales the underlying physics which govern their interactions through the investigated period are equivalent in other words the trapping rates obtained from cases with varying aquifer length follow a similar pattern as depicted by solid gray lines in figs 9a and 9b we will therefore focus our discussions on the model with the same size to that of base case 3 2 interplay of hysteresis and dissolution trapping if hysteresis is not considered in the model the constitutive relations are evaluated based on primary drainage imbibition curves shown in fig 3 in this case residual saturation of gas phase becomes zero and therefore residual trapping is zero at all times shown in fig 8b as aforementioned advective transport plays a major role during the injection period and therefore gas saturation increases monotonically in most if not all of the swept cells under such a process the impact of hysteresis is trivial we observe that the s g and r s profiles in these two cases with without hysteresis are almost identical and their fraction curves for dissolved co2 are overlapping shown in fig 8a after injection ceases co2 that remained near the injection well moves upwards and accumulates near the top of the aquifer this leads to a thicker saturated layer compared to the base case followed by the development of sinking fingers we note that the interaction of fingers becomes more pronounced without hysteresis the number of fingers is reduced observably near the production well from t 20 to t 40 small scale fingers tend to merge at the finger root and develop into large scale fingers now that all free co2 migrates upward less will travel laterally with the gravity current as dissolved co2 such a reduction in dissolved co2 seems to be partially offset by a stronger fingering behavior which enhances the dissolution as a result the amount of dissolved co2 without hysteresis is close to that of the base case throughout the full cycle process next we exclude dissolution by assuming co2 exists in gas phase only the resulting system becomes immiscible and dissolution trapping vanishes accordingly as shown in fig 7d the front position of co2 plume propagates further compared to that of the base case during the injection period this is because the amount of free co2 increases in the absence of dissolution we also observe that the amount of trapped co2 due to residual trapping remains unchanged once it reaches the maximum value shown in fig 8b this differs from what we have seen in the base case it can be inferred that the convective transport driven by dissolution during the post injection period leads to a shifting of constitutive relations i e from scanning curves back to the primary drainage curve in the region near sealing layer as a result the trapped gas turns into free gas and the trapped amount due to residual trapping decreases 3 3 role of capillary pressure intuitively one would expect that exclusion of capillary pressure sharpens the co2 brine interfaces which are observed in saturation profiles without capillary pressure see fig 7c in consequence gas phase tends to have higher saturation values in the invading zone this leads to a smaller swept area when injection ceases resulting in reductions of dissolved co2 compared to that of the base case moreover such a reduction near the top layer undermines the convective transport in the post injection period sinking fingers are less active compared with the base case as shown in fig 8a the amount of dissolved co2 without capillarity starts to deviate from the base case after t 0 1 and the deviation becomes more pronounced as time elapses the saturation profiles from the post injection period without capillarity fig 7c exhibit that gas saturation reaches its maximum value 0 8 in the layer underneath the top boundary consequently a substantial amount of gas on the top layer is mobile which may be subject to leakage from the cap rock on the other hand the maximum gas saturation in the base case throughout the process is 0 57 which is certainly smaller than 0 8 it can be inferred that capillary pressure helps the brine imbibe into the top layer reverses the flow process before the saturation reaches its maximum value and thus facilitates the residual trapping plug and bruining 2007 wang and tokunaga 2015 alyafei and blunt 2018 fig 8c shows that the amount of overall trapping in the absence of capillarity is reduced significantly compared to that of the base case 3 4 impact of absolute permeability we have so far concentrated on the physics associated with fluids in this subsection we study the impact of permeability on the trapping process we first alter the absolute permeability in the homogeneous case and then examine heterogeneous permeability fields 3 4 1 homogeneous field we consider two more permeability values one is lower than that of the base i e k 20 md and the other one is higher note that a higher permeability leads to an earlier breakthrough to ensure all injected co2 remains in the aquifer we set the higher one to be k 72 md changing absolute permeability affects the relative significance of the viscous force and gravity force as indicated by the gravity number n gv which is proportional to the vertical permeability in the homogeneous case the permeability field is isotropic i e k x k z k so that an aquifer with a lower k results in a smaller n gv a larger smaller n gv indicates the gravity viscous force is more dominant respectively as shown in fig 10a in the case of k 72 md the co2 plume forms a stronger gravity tongue compared to that of the base case the displacement front has propagated to the right boundary when injection stops t 1 this is because injected co2 readily rises towards the top due to the predominant gravity force on the contrary fig 10b shows that for displacement with a low n gv gas saturation maps exhibit a distinct horizontal migration of the injected co2 in post injection period a higher k facilitates the gravity induced convective transport thereby expediting the growth of sinking fingers the associated dynamic behavior of different trapping mechanisms are presented in fig 11 as shown in fig 11a differences of the dissolved amount during the injection period are insignificant meanwhile different values of k lead to different flow configurations which are clearly depicted in solution co2 brine ratio profiles note that during the injection period most of the swept cells are in a saturated state the solution co2 brine ratio profiles exhibit little variation in color for this reason each swept cell dissolves same amount of co2 approximately and the total dissolved amount could be estimated by the swept area in view of the minor differences of fraction curves shown in fig 11a at t 1 we can infer that at the end of injection the swept areas in the studied cases of differing k are close fig 11b shows the fraction of residual trapping for the three investigated cases a smaller k results in a larger trapped amount maximum value before decline occurs this is due to the fact that in the case of low k swept cells that participate in residual trapping have a higher free gas saturation prior to the cease of injection and a higher free gas saturation is transitioned into a larger residual gas saturation following the linear trapping model moreover the gravity induced convective transport is suppressed in such a low k case as a result we observe that in the post injection period the decline for k 20 md is negligible whereas the fraction curves obtained from the remaining two cases exhibit pronounced reductions in the end the residual trapping amount differs significantly and it plays the major role in determining the overall trapped amount see fig 11c 3 4 2 heterogeneous field here two heterogeneous permeability fields are investigated with varying spatial correlations mspe10top and mspe10bottom exhibit patchy and channeling patterns respectively as shown in the gas phase saturation maps in fig 12 during the injection period free co2 mainly accumulates in areas a underneath the top boundary and b near the injection well such physical processes have been identified in the study of homogeneous fields similar to what we have seen in the case of k 20 md in which free co2 tends to migrate in the horizontal direction here we observe that some co2 migrates laterally in the low permeability region near the injection well such movement is initiated by the viscous force which overwhelms the gravity forces locally this lateral movement increases the swept area so that it benefits dissolution trapping in addition free gas accumulates in the low permeability region and therefore such movement favors residual trapping as well after the injection ceases solution ratio maps in figs 12a and 12b show that the propagation of sinking fingers from the top saturated layer is impacted by the permeability distribution significantly originated from different locations along the interface these fingers tend to invade in high permeability zones which results in complex configurations in the end the overall trapped amount in heterogeneous cases is greater than that in the base case see fig 13c it is noted that another trapping mechanism referred to as local capillary trapping occurs when the buoyant co2 encounters a region in which the local capillary entry pressure is greater than the average pressure of gas phase in this case co2 tends to accumulate or migrate beneath such a region saadatpoor et al 2010 jackson and krevor 2020 here we assume a relatively negligible capillary entry pressure as a result this trapping mechanism is not accounted for in cases with heterogeneous permeability fields which deserves future investigation 4 conclusions we have systematically investigated co2 storage in saline aquifers in a full cycle period via the recently developed unified numerical framework our model represents the hysteretic characteristics of the constitutive relations i e relative permeability and capillary pressure in a robust manner moreover we employ a compositional formulation to capture the dissolution trapping in which the co2 brine ratio is calculated based on an accurate thermodynamic model through visualization of saturation and solution ratio profiles at different stages we have provided numerical evidence that the residual and dissolution trapping have their own time scales of importance in particular residual trapping comes into effect mainly after the injection ceases whereas dissolution trapping has played a significant role from the beginning of injection residual trapping is affected by the swept area in which flow processes will be reversed and the associated free gas saturation when injection ceases in post injection period the convective transport triggered by the density difference due to dissolution trapping reactivates a certain amount of immobile gas resulting in a reduction of the trapped amount from residual trapping such a reduction becomes less pronounced in the case of a homogeneous aquifer with a lower permeability furthermore we show that contribution from residual trapping regarding the overall trapped amount increases for a system with a lower permeability therefore it is critical to characterize the hysteresis behavior in such systems accurately on the other side the solution co2 brine ratio profiles reveal that the dissolution trapping operates under varying mechanisms at different stages during injection period dissolution occurs in the swept area in this stage both trapping mechanisms are controlled by advective flow dynamics different flow configurations due to differing driving forces may give comparable swept areas and result in similar trapped amounts the existence of spatial heterogeneity i e heterogeneous permeability field enlarges the swept area and therefore enhances the dissolution trapping after injection ceases dissolution continues across the subsequent interface via gravity induced convective transport the dissolution rate becomes relatively small because it takes time for the sinking fingers to generate and grow after this transition period the rate has an observable increase indicating the sinking fingers have fully developed these findings highlight the significance of capturing co2 plume migration during the early injection time which is strongly connected to the assessment of trapped co2 in post injection period our results reveal the inherent multiscale nature of co2 storage in saline aquifers understanding the interplay between different trapping mechanisms is essential for an accurate assessment of trapped co2 in a full cycle period this study lays the foundation for interpretation of physical observations optimal design of field operations and further investigation of co2 storage in faulted and fractured systems credit authorship contribution statement yuhang wang conceptualization methodology software writing original draft cornelis vuik writing editing hadi hajibeygi conceptualization methodology writing editing grant acquiring declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments hadi hajibeygi was sponsored by the dutch national science foundation nwo under vidi talent program project admire project number 17509 we thank the admire user committee for allowing us publish this paper groups members of darsim delft advanced reservoir simulation and admire adaptive dynamic multiscale integrated reservoir earth are acknowledged for fruitful discussions during the development of this work the source code developed for this research is openly accessible via https gitlab com darsim address appendix solubility of co2 here we present detailed workflow for calculating the solubility of co2 at given temperature and salinity first we consider an equilibrium system which is composed of co2 and h2o the equilibrium constants are given by a 1 κ h 2 o f h 2 o g a h 2 o l and a 2 κ co 2 f co 2 g a co 2 l where a c is the activity coefficient of component c in liquid phase f c is the fugacity of component c in gas phase defined as a 3 f c φ c x c g p where φ c is the fugacity coefficient and p is total pressure the equilibrium constant at given temperature and pressure is expressed as spycher et al 2003 a 4 κ c t p κ c 0 t p 0 exp p p 0 v c r t where r is gas constant p 0 is reference pressure 1 bar v c is the average partial molar volume of the condensed component c over the pressure interval p 0 to p to calculate the mole fraction of co2 in liquid phase x co 2 l eqs a 1 to a 4 are recast by setting spycher et al 2003 a 5 a κ h 2 o 0 φ h 2 o p exp p p 0 v h 2 o r t and a 6 b φ co 2 p 55 508 κ co 2 0 exp p p 0 v co 2 r t such that a 7 x co 2 l b 1 x h 2 o g where x h 2 o g 1 b 1 a b the fugacity coefficients in eqs a 5 and a 6 are derived using the redlich kwong equation of state rk eos redlich and kwong 1949 a 8 p r t v b a t 0 5 v v b where v is molar volume a and b are parameters associated with attractive and repulsive interactions respectively in the binary mixture system of h2o and co2 a and b are calculated by the following mixing rules prausnitz et al 1998 a 9 a m x h 2 o g 2 a h 2 o 2 x h 2 o g x co 2 g a h 2 o co 2 x co 2 g 2 a co 2 and a 10 b m x h 2 o g b h 2 o x co 2 g b co 2 the fugacity coefficient of a component c φ c is then calculated based on these mixing rules and rk eos prausnitz et al 1998 a 11 ln φ c ln v v b m b c v b m 2 i n c x i g a i c r t 1 5 b m ln v b m v a m b c r t 1 5 b m 2 ln v b m v b m v b m ln p v r t to facilitate the implementation we assume co2 exists in both liquid and gas phases whereas h2o exists in liquid phase only this assumption implies x h 2 o g 0 and x co 2 g 1 as a result a m and b m in eqs a 9 and a 10 are simplified to a co 2 and b co 2 respectively now that x co 2 l is obtained the co2 molality in h2o can be calculated given by a 12 m co 2 0 55 508 x co 2 g 1 x co 2 g we have focused on co2 h2o mixtures so far to connect co2 molality in pure water to that in brine the co2 activity coefficient is used a 13 m co 2 m co 2 0 γ co 2 using the co2 molality in brine the mole fraction of co2 in liquid phase can be calculated by a 14 x co 2 l m co 2 m co 2 55 508 n i m s where n i is the stoichiometric number of ions in the salt and m s is salt molality at last the solution co2 brine ratio is obtained by a 15 r s ρ b stc x co 2 l ρ co 2 stc 1 x co 2 l eq a 15 holds for cells in saturated state 
214,we present a splitting method for the one dimensional saint venant exner equations used for describing the bed evolution in shallow water systems we adapt the flux vector splitting approach of toro and vázquez cendón 2012 and identify one subsystem of conservative equations advection system and one of non conservative equations pressure system both having a very simple eigenstructure compared to the full system the final numerical scheme is constructed using a godunov type path conservative scheme for the pressure system and a simple conservative godunov method for the advection system and solved following a coupled solution strategy the resulting first order accurate method is extended to second order of accuracy in space and time via the ader approach together with an aeno reconstruction technique accuracy robustness and well balanced properties of the resulting scheme are assessed through a carefully selected suite of testcases the scheme is exceedingly simple accurate and robust as the sophisticated godunov methods a distinctive feature of the novel scheme is its flexibility in the choice of the sediment transport closure formula which makes it particularly attractive for scientific and engineering applications keywords numerical morphodynamics saint venant exner model flux splitting finite volume methods sediment transport ader method 1 introduction nowadays numerical morphodynamic models are used for different purposes from answering questions about basic morphodynamic research to tackling complex engineering problems shimizu et al 2020 siviglia and crosato 2016 a wide variety of river siviglia et al 2008 duró et al 2016 le et al 2018 and near shore engineering problems kelly and dodd 2010 postacchini et al 2012 are modelled using the shallow water approach in this context morphodynamic investigations are often conducted using the shallow water equations for hydrodynamics saint venant equations de saint venant 1871 coupled to the equation for the bed evolution exner equation exner 1925 both components define a coupled system of partial differential equations pdes for which a conservative form does not exist i e the saint venant exner sve model the numerical solution of the sve model can be obtained following two different strategies namely decoupled and coupled in the decoupled approach the solution is obtained assuming a fixed bed configuration first are solved the hydrodynamic equations and then the exner equation by using the new hydrodynamic variables cunge and perdreau 1973 defina 2003 krishnappan 1985 wu et al 2004 a clear advantage of this approach is that the governing equations are hyperbolic and can be expressed in conservative form despite its simplicity the decoupled approach has some numerical shortcomings kelly and dodd 2010 demonstrated that using a decoupled approach when simulating bore driven sediment transport may lead to a large overestimation of the net off shore transport in the swash zone and postacchini et al 2012 show that the erosion of the bed can be significantly larger when a swash forced by a dam break is considered cordier et al 2011 conducted numerical experiments demonstrating that the decoupled approach may fail producing unphysical instabilities even using a robust and well balanced numerical scheme for shallow water system from a physical point of view the decoupled approach is justified when the bed weakly interacts with the hydrodynamic waves a condition that holds only for situations far from critical conditions carraro et al 2018 de vries 1965 lyn and altinakar 2002 i e when the froude number f r 1 or 1 on the contrary the coupled approach can be applied in all conditions at the price of having a governing system of pdes written in non conservative form e g hudson and sweby 2005 which requires a special numerical treatment in the context of systems in conservative form the riemann invariants and the rankine hugoniot conditions provide all the necessary information to derive exact or approximate solutions of the associated riemann problem when dealing with system containing non conservative products the classical rankine hugoniot conditions across shock waves must be replaced by integral shock conditions in this case the problem is often solved using the theory developed by dal maso et al 1995 that allows one to set the jump conditions and thus the concept of weak solution in terms of a given family of paths the degree of freedom in the choice of the family of paths is eliminated following the approach proposed by parés 2006 who introduced the family of path conservative or path consistent methods to properly handle non conservative pdes these approaches have experienced a great increase of popularity in the last decade and many path conservative finite volume methods have been proposed for solving the sve model following either a centred approach thus not using the eigenstructure of the problem caleffi et al 2007 canestrelli et al 2009 hudson and sweby 2005 or an upwind approach which requires a detailed knowledge of the eigenstructure e g carraro et al 2018 castro et al 2008 in this paper we present a splitting scheme for the non conservative sve system of equations which is solved following a coupled solution strategy our starting point is the flux vector splitting approach of toro and vázquez cendón 2012 tv first put forward for the conservative one dimensional euler equations recently the tv splitting has been successfully applied to the three dimensional euler equations with general equation of state toro et al 2015 to the equations of magnetohydrodynamics balsara et al 2016 and to the baernunziato equations of compressible two phase flow tokareva and toro 2017 our splitting identifies two separate subsystem of pdes the advection and the pressure systems it differs from the original tv splitting in two respects namely i the advection contained in the continuity equation of the saint venant equations is placed in the pressure system and ii the pressure system is non conservative the wave pattern of the pressure system is always subcritical and the solution of the associated riemann problem can be easily found using riemann invariants this provides all the items required for the evaluation of the fluctuations to be used in the update formula using the godunov type path conservative method theoretically introduced in muñoz ruiz and parés 2007 this method is here used for the first time in numerical applications the advection system is hyperbolic and the numerical fluxes are obtained using a simple advection method an attractive feature of the present method is that the sediment fluxes are contained in the advection system and are evaluated as they are described by the sediment transport formula this means that there is no need of any differentiation as is required when the entire coefficient matrix of the sve equations is employed for the numerical simulations carraro et al 2018 canestrelli et al 2009 castro et al 2008 extension to second order is obtained through application of the ader methodology first introduced in toro et al 2001 and further developed in toro and titarev 2002 titarev and toro 2002 dumbser et al 2008 ader has also been applied to problems governed by the non conservative sve equations canestrelli et al 2009 2010 siviglia et al 2013 polynomial reconstruction is performed employing the aeno reconstruction procedure an averaged variant of the popular eno method harten et al 1987 recently proposed by toro et al 2021 the paper is structured as follows section 2 briefly reviews the governing equations and the closure relationship for the sediment transport and in section 3 we apply the flux splitting framework to the sve equations and introduce the corresponding advection and pressure systems in section 4 we present our splitting numerical method in first order mode and in section 5 we extend it to second order of accuracy in section 6 we present numerical results for a range of carefully selected test problems to assess both the robustness and accuracy of the schemes proposed in this paper conclusions are drawn in section 7 2 the saint venant exner model we consider the one dimensional morphodynamic saint venant exner model which describes the flow evolution over an erodible bed the bed is composed of uniform sediments which are transported by the flow as bedload in this section we recall the governing equations introduce the closure relationship adopted for its solution and then we write the system in quasi linear form 2 1 the governing equations and bedload closure relationship the governing equations are obtained under shallow water conditions and includes equations for the conservation of water mass continuity equation 1 t h x q 0 and momentum of the water phase 2 t q x q 2 h 1 2 g h 2 g h x z b g h s f the bed evolution is described by the sediment continuity or exner equation 3 t z b x q b 0 where t s is time x m is the streamwise coordinate and g 9 806 m s 2 is the acceleration due to gravity the quantities involved are illustrated in fig 1 here h m is the flow depth z b m is the bed level and u m s 1 is depth averaged flow velocity the flow discharge per unit width is defined as q u h m 2 s 1 q b m 2 s 1 is the bedload sediment flux per unit width divided by 1 λ p where λ p is the bed porosity and s f is the friction slope both to be specified by an appropriate closure relationship for the sake of simplicity we model bedload sediment flux per unit width q b in a simple form in which q b q b u only such that grass 1981 4 q b a g u m where a g m 2 m s m 1 and m 1 are two constant parameters we remark that the proposed framework can work with any closure relationship for the bedload flux 2 2 quasi linear form of the governing equations the sve model 1 3 is a non conservative system canestrelli et al 2009 castro et al 2008 and can be written as follows 5 t q x f q b q x q s q where 6 q h q z b f q 1 2 g h 2 q 2 h q b b 0 0 0 0 0 g h 0 0 0 s 0 g h s f 0 the sve model can also be written in quasi linear form as 7 q t a q q x s where a is the coefficient matrix given as 8 a q 0 1 0 c 2 u 2 2 u c 2 u ψ ψ 0 in the coefficient matrix c g h is the celerity and 9 ψ q b q is a measure of the intensity of total bedload in the flow usually in the range 0 ψ ξ of order o 10 2 de vries 1965 lyn and altinakar 2002 ψ is obtained from differentiating the sediment transport formula and thus depends on the bedload closure relationship adopted in this work from equation 4 we obtain 10 ψ m q b q the characteristic polynomial of the coefficient matrix a is obtained by setting a λ i 0 where i is the 3 3 identity matrix 11 λ 3 2 u λ 2 u 2 g h ψ 1 g h λ u g h ψ 0 if a power law formula for the solid transport is used as that adopted in 4 the three eigenvalues λ 1 λ 2 λ 3 are always real thus the governing system is always hyperbolic cordier et al 2011 it is worth remarking that under different flow conditions either subcritical f r 1 f r u g h or supercritical f r 1 there are always two positive and one negative eigenvalues from a physical point of view under sub or supercritical conditions f r 1 or f r 1 the bed interacts only weakly with the water surface and small bottom perturbations propagate at a slower pace compared with the hydrodynamic waves whereas under near critical conditions f r 1 the interactions between the bed and hydrodynamic waves are quite strong for background on the hyperbolicity of the sve the eigenvalues behavior and the physical behavior of small bed perturbations see cordier et al 2011 lyn and altinakar 2002 for example in this paper we are primarily interested in the principal part of 5 and therefore we restrict ourselves to the homogeneous case s q 0 3 splitting framework in this section we propose a splitting method for systems written in non conservative form following the framework of toro and vázquez cendón 2012 we remark that this novel formulation is valid either under sub or supercritical conditions f r 1 or f r 1 or under near critical conditions f r 1 3 1 the framework consider now the homogeneous sve equations 12 t q x f q b q x q 0 with 13 q h q z b f q q 1 2 g h 2 q 2 h q b b q 0 0 0 0 0 g h 0 0 0 first we identify the conservative part and express the conservative flux as the sum of advection and pressure fluxes as follows 14 f q 0 q 2 h q b q 1 2 g h 2 0 with the corresponding advection and pressure fluxes defined as 15 f a q q 0 q h q b q and f p q q 1 2 g h 2 0 then we consider two subsystems t q x f a q 0 16 t q x f p q b q x q 0 17 called respectively the advection system 16 and the pressure system 17 we note however that here the pressure system would be augmented by the non conservative term present in the sve equations the final goal of this procedure is to obtain the numerical solution of the full sve system of equations the tv flux splitting approach consists of approximating the numerical fluxes for the pressure system and advection system separately and constructing the numerical fluctuations for the full system based on these to this end the analysis of the eigenstructure and the study of the riemann problem for the pressure system are necessary 3 1 1 the pressure system the pressure system 17 is non conservative because of the presence of the non conservative term g h x z b appearing in the momentum equation 2 it can be written in quasi linear form as 18 t q p q x q 0 with 19 p j p b 0 1 0 c 2 0 0 0 0 0 0 0 0 0 0 c 2 0 0 0 0 1 0 c 2 0 c 2 0 0 0 where j p is the jacobian matrix of the pressure fluxes f p in 15 the eigenvalues of matrix p are 20 λ 1 p c λ 2 p 0 λ 3 p c the eigenvalues are always real and λ 1 p λ 2 p 0 λ 3 p and thus the system is always subcritical as illustrated in fig 2 the right eigenvectors corresponding to the three eigenvalues 20 are 21 r 1 p 1 c 0 r 2 p 1 0 1 r 3 p 1 c 0 3 1 2 the advection system the advection system in conservative form is 22 t q x f a q 0 where q h q z b t and f a as in 15 the quasi linear form is given by 23 t q j a q x q 0 where 24 j a 0 0 0 u 2 2 u 0 u ψ ψ 0 is the jacobian of matrix f a simple analysis shows that the eigenvalues of matrix 24 are λ 1 a 0 and λ 2 a λ 3 a u and that there are only two linearly independent right eigenvectors given by 25 r 1 a α 1 0 0 1 r 2 a α 2 1 u 0 thus the advection system is weakly hyperbolic it is easy to show that the λ 1 a field is linearly degenerate while the λ 2 a and λ 3 a are genuinely non linear if α 2 0 and u 0 we note that the weakly hyperbolic nature of the advection system does not have a bearing on its numerical approximation 4 numerical solution direct integration of 12 in the space time control volume v i x i 1 2 x i 1 2 t n t n 1 gives the following update numerical formula to solve 12 26 q i n 1 q i n δ t δ x d i 1 2 d i 1 2 f i 1 2 a f i 1 2 a q i n 1 and q i n are the cell averaged values of the vector q at time t n 1 and t n δ t is the time step derived from the standard cfl stability condition and δ x is the grid size here for simplicity assumed having a constant size d i 1 2 and d i 1 2 are fluctuations or increments associated to the pressure system which are obtained using path conservative schemes parés 2006 while f i 1 2 a and f i 1 2 a are the numerical fluxes of the advection system obtained using simple advection methods in order to compute the fluctuations d i 1 2 and d i 1 2 and the advection fluxes f i 1 2 a and f i 1 2 a to be used in 26 we consider the riemann problem for each system we start with the pressure system 4 1 the pressure system in order to calculate the fluctuations d i 1 2 and d i 1 2 at the interface x i 1 2 we consider the riemann problem for the pressure system in conservative variables 27 t q p q x q 0 x r t 0 q x 0 q l q i n if x 0 q r q i 1 n if x 0 the structure of the solution of 27 at the fixed interface position x i 1 2 or x 0 in local coordinates is illustrated in fig 2 the wave pattern is always subcritical and composed by three wave families the left family is associated with the eigenvalue λ 1 p the middle family is superimposed onto the t axis and is associated with λ 2 p and the right family is associated with λ 3 p the waves associated with the genuinely non linear characteristic fields λ 1 p and λ 3 p are either shocks discontinuous solutions or rarefactions smooth solutions while the wave associated with the linearly degenerate characteristic field λ 2 p is a stationary contact discontinuity the entire solution consists of four constant states namely q l h l q l z b l t data q l h l q l z b l t q r h r q r z b r t and q r h r q r z b r t data separated by the three distinct waves the unknown states to be found in the star region are q l left of x 0 and q r right of x 0 we apply riemann invariants to find these solutions across the stationary contact discontinuity with right eigenvectors 21 the generalized riemann invariants are solutions of the following two ordinary differential equations odes 28 stationary contact d h 1 d q 0 d z b 1 which can be obviously rewritten as a system of odes d h 1 d q 0 29 d h 1 d z b 1 30 integration of the 29 in the phase space gives q c o n s t across the wave and thus q l q r q while integration of 30 gives 31 h l z b l h r z b r h this latter equation states that the free surface remain constant across the stationary contact across the left and right waves we have 32 left wave d h 1 d q c d z b 0 33 right wave d h 1 d q c d z b 0 the third odes in eqs 32 and 33 imply that z b remains constant across the left i e z b l z b l and right wave i e z b r z b r exact integration of the first odes in eqs 32 and 33 respectively gives that 2 3 g h 3 2 q c o n s t across the left wave 34 2 3 g h 3 2 q c o n s t across the right wave 35 after simple algebraic manipulations of eqs 31 34 and 35 we obtain the following non linear system h l 3 2 h r 3 2 k 36 h l h r δ z b 37 q 1 2 q l q r g 3 h l 3 2 h r 3 2 h l 3 2 h r 3 2 38 where 39 k 3 2 g q l q r h l 3 2 h r 3 2 and δ z b z b r z b l iterative solution of 36 and 37 gives the sought values h l and h r substitution of such values in 38 provides q we can improve the efficiency of our method by finding an approximate solution of 36 in closed form a possible way to avoid the iterations is the following we assume that δ z b 0 and solve 37 that gives h l h r h then solving 36 we obtain a closed form solution for h i e 40 h 3 4 g q l q r 1 2 h l 3 2 h r 3 2 2 3 at this stage we linearize 36 which together with 37 gives the following linear system 41 h l h h r h k h l h r δ z b that gives 42 h l 1 2 k h δ z b finally we obtain the following system that can be directly solved 43 h l 1 2 k h δ z b h r h l δ z b q 1 2 q l q r g 3 h l 3 2 h r 3 2 h l 3 2 h r 3 2 once the solution in the star region is known the fluctuations d i 1 2 and d i 1 2 are obtained using a godunov type path conservative method as in muñoz ruiz and parés 2007 44 d i 1 2 1 δ t 0 δ t 0 1 p ψ s q i n q r s ψ s q i n q r d s d t d i 1 2 1 δ t 0 δ t 0 1 p ψ s q l q i 1 n s ψ s q l q i 1 n d s d t we remark that in the riemann problem associated with the pressure system we have two star regions one on the left of x 0 whose solution is q l and one on the right whose solution is q r the presence of these two regions is taken into account integrating the left fluctuation d i 1 2 between q i n and q r and the right fluctuation d i 1 2 between q l and q i 1 n we verified numerically that the fluctuations calculated as in 44 satisfy the compatibility condition 45 d i 1 2 d i 1 2 1 δ t 0 δ t 0 1 p ψ s q i n q i 1 n s ψ s q i n q i 1 n d s for all numerical test cases presented in this paper we always use the simple segment paths given by 46 ψ s q i n q r q i n s q r q i n ψ s q l q i 1 n q l s q i 1 n q l then from 44 we have 47 d i 1 2 p i 1 2 q r q i n d i 1 2 p i 1 2 q i 1 n q l where 48 p i 1 2 1 δ t 0 δ t 0 1 p ψ s q i n q r d s d t p i 1 2 1 δ t 0 δ t 0 1 p ψ s q l q i 1 n d s d t given a n g p point gaussian quadrature rule with weights ω j and positions s j distributed in the unit interval 0 1 a very accurate numerical approximation of the matrices p i 1 2 and p i 1 2 is given by 49 p i 1 2 j 1 n g p ω j p ψ s j q i q r p i 1 2 j 1 n g p ω j p ψ s j q l q i 1 all simulations employing our splitting method in this work are performed using n g p 1 this is enough to ensure the achievement of second order of accuracy 4 2 the advection system recall that in our splitting 15 the advection operator is written as 50 f a q 0 q 2 h a g q h m the algorithm we propose for constructing the numerical flux f i 1 2 a to be used in the update formula 26 is 51 f i 1 2 a q 0 u i n a g u i n m 1 h i n if q 0 q 0 u i 1 n a g u i 1 n m 1 h i 1 n if q 0 where q is the solution 38 emerging from the riemann problem of the pressure system 4 3 summary of the proposed scheme in order to compute the fluctuations d i 1 2 and d i 1 2 and advection fluxes f i 1 2 a and f i 1 2 a to be used in the update formula 26 we proceed as follows pressure fluctuations at each interface evaluate the solution of the riemann problem q l h l q z b l t and q r h r q z b r t using eqs 42 37 and 38 then calculate d i 1 2 and d i 1 2 as in 47 evaluating the approximated matrices 49 using one gaussian point advection flux evaluate the advection fluxes f i 1 2 a as described in 51 5 second order extension extension to second order is obtained using the ader methodology by toro et al 2001 the procedure to achieve second order contains two ingredients i a first order non linear spatial reconstruction of the gradient of the solution in each cell and 2 the solution of the generalized riemann problem grp at the interface of each cell for background on ader see chapters 19 and 20 of toro 2013 and references therein here we consider second order accurate ader schemes based on the heoc solver of harten et al 1987 see also castro and toro 2008 for the grp 5 1 nonlinear reconstruction technique first we deal with the reconstruction problem we adopt the aeno reconstruction procedure an averaged variant of the popular eno method harten et al 1987 recently proposed by toro et al 2021 to achieve second order of accuracy we need to construct first degree polynomials p i in each cell i i at time t n from the given cell averages q i n of the form 52 p i q i n x x i δ i where δ i is the slope vector and x i x i 1 2 x i 1 2 2 recall that in order to circumvent godunovs theorem godunov 1959 the reconstruction must be non linear see chapter 20 of toro 2013 for background here the non linearity of the scheme is ensured by taking the polynomial slope as 53 δ i 1 2 1 β δ i 1 2 1 2 1 β δ i 1 2 with β 1 where 54 β r 1 r ϵ 2 r 1 2 with r δ i 1 2 δ i 1 2 t o l and 55 δ i 1 2 q i n q i 1 n δ x δ i 1 2 q i 1 n q i n δ x the parameter ϵ is a positive constant while t o l is a small positive tolerance to avoid division by zero 5 2 second order ader with the heoc solver for the grp the result of the reconstruction procedure is a non oscillatory linear polynomial p i defined at time t n inside each spatial element i i we are interested in the left and right limiting values of the reconstruction polynomials often called boundary extrapolated values let us first consider cell i i with cell boundaries x i 1 2 and x i 1 2 and define 56 q i l p i x i 1 2 q x i 1 2 0 q i r p i x i 1 2 q x i 1 2 0 we now evolve these limiting values in time using the time taylor series expansion 57 q i l τ q x i 1 2 0 τ t q x i 1 2 0 q i r τ q x i 1 2 0 τ t q x i 1 2 0 after adopting notation 56 and using the cauchy kovalevskaya procedure in the case of our splitting the time derivatives above can be expressed as 58 t q x i 1 2 0 x f a p i x i 1 2 p p i x i 1 2 x q x i 1 2 0 t q x i 1 2 0 x f a p i x i 1 2 p p i x i 1 2 x q x i 1 2 0 the advection flux gradient to second order can be approximated as follows 59 x f a p i x i 1 2 x f a p i x i 1 2 f a q i r f a q i l δ x and the pressure non conservative term as 60 p p i x i 1 2 x q x i 1 2 0 p q i l δ i p p i x i 1 2 x q x i 1 2 0 p q i r δ i finally the evolved boundary values in cell i i at time τ 1 2 δ t after using 57 59 and 60 become 61 q i l q i l 1 2 δ t f a q i r f a q i l δ x 1 2 δ t p q i l δ i q i r q i r 1 2 δ t f a q i r f a q i l δ x 1 2 δ t p q i r δ i the time evolution is obtained in a splitting mode making use of the advection fluxes f a and the pressure coefficient matrix p we remark that we do not make use of the coefficient matrix of the full system a 8 5 3 the fully discrete second order accurate one step scheme exact integration of the system 12 over a space time control volume v i x i 1 2 x i 1 2 t n t n 1 see castro et al 2006 and parés 2006 for details gives the following update formula 62 q i n 1 q i n δ t δ x d i 1 2 d i 1 2 f i 1 2 a f i 1 2 a δ t h i where 63 h i 1 δ t t n t n 1 x i 1 2 x i 1 2 p q x i 1 2 δ t x q x i 1 2 δ t d x d t the term h i integrates the smooth part of the non conservative product within each cell excluding the jumps at the boundaries and vanishes for a first order scheme where we have h i 0 this term will be defined shortly now the required solution of the generalized riemann problem at the interface x i 1 2 is given by the solution of the following conventional piece wise constant data homogeneous riemann problem see fig 3 64 t q p q x q 0 x r t 0 q x 0 q i r if x 0 q i 1 l if x 0 the solutions of the grp 64 are obtained solving the non linear system 36 38 as described in section 4 1 with initial data q i r q i 1 l let us denote the similarity solution of 64 as q l h l q z b l t and q r h r q z b r t then the fluctuations d i 1 2 and d i 1 2 are calculated as 65 d i 1 2 1 δ t 0 δ t 0 1 p ψ s q i r q r s ψ s q i r q r d s d t d i 1 2 1 δ t 0 δ t 0 1 p ψ s q l q i 1 l s ψ s q l q i 1 l d s d t here the paths considered are 66 ψ s q i r q r q i r s q r q i r ψ s q l q i 1 l q l s q i 1 l q l following the same approach as for the first order problem see eq 51 the numerical flux f i 1 2 a are obtained as 67 f i 1 2 a q 0 u l a g u l m 1 h l if q 0 q 0 u i 1 a g u r m 1 h r if q 0 finally to compute h i we first approximate the spatial derivative as 68 x q x i 1 2 δ t q i r q i l δ x substitution into eq 63 and integrating we obtain 69 h i p q x i 1 2 δ t q i r q i l δ x where 70 q x i 1 2 δ t q i n 1 2 δ t p q i n δ i in the following we briefly summarize the entire second order one step algorithm 1 perform the aeno reconstruction described in section 5 1 in order to obtain the slope δ i 53 for each cell 2 extrapolate values at cell boundaries x i 1 2 and x i 1 2 56 and then evolve these limiting values in time using the time taylor series expansion 57 3 solve the grp 64 of the pressure system through the solution of the non linear system 36 38 with initial data q i r q i 1 l this step gives the star region solutions q l h l q z b l t and q r h r q z b r t 4 at each interface use q i r q i 1 l and q l q r to compute the fluctuations 65 using the paths 66 5 at each interface use q i r q i 1 l and q l q r to calculate the fluxes 67 6 at each cell center use q i r q i 1 l and time evolution of the center cell values 70 to calculate h i 69 7 finally use the fully discrete scheme 62 and perform the update of the cell averages 6 numerical results here we assess the proposed splitting method on a carefully selected suite of test problems for all tests the numerical stability is imposed by the courant friedrichs lewy condition and the integration time step is evaluated as 71 δ t c f l min 1 i m δ x λ h i where m is the total number of cells and λ h i q i h i g h i is the maximum eigenvalue for the fixed bed case saint venant equations to take into account the small differences between λ h i and the maximum eigenvalue of the coupled sve model see lyn and altinakar 2002 for details we set the c f l number to 0 9 for all numerical runs numerical fluctuations 44 are evaluated using the linearized solution 42 as numerical reference schemes we use i the dumbser osher toro dot solver dumbser and toro 2011 which is an all purpose universal godunov upwind method that can be applied to any hyperbolic system as long as the full eigenstructure is available ii the price c scheme canestrelli et al 2009 which is a method of the centred type which requires a minimum knowledge about the eigenstructure i e an estimate of the fastest eigenvalue to be used in the cfl condition 6 1 verification of the c property a desirable feature of numerical methods for shallow water systems with variable bottom is the satisfaction of the so called c property as introduced by bermudez and vazquez 1994 let us consider a quiescent flow q 0 m 2 s 1 over any submerged bed profile under these conditions the initial water surface h h z b is constant and should remain constant in time this is numerically achieved if the solution does not change in time and thus q i n 1 q i n in 26 therefore we have to prove that 72 d i 1 2 d i 1 2 f i 1 2 a f i 1 2 a 0 first we consider the flux f i 1 2 a computed as in 51 under quiescent flow conditions q l q r 0 and consequently from 39 we obtain k h l 3 2 h r 3 2 substitution of this result in 36 gives 73 h l 3 2 h r 3 2 h l 3 2 h r 3 2 0 and thus we have from 38 q 0 inserting q 0 into 51 leads to f i 1 2 a 0 analogous conclusions can be drawn for f i 1 2 a second we focus on the fluctuations d i 1 2 the numerical evaluation of such fluctuation through 47 gives 74 d i 1 2 p i 1 2 q i 1 n q l 0 1 0 g h 0 g h 0 0 0 h r h l 0 z b r z b l 0 g h h r z b r h l z b l 0 with h 0 1 h s d s 0 1 h l s h r h l d s if q 0 then 34 gives that h l h l and thus the second element of d i 1 2 becomes 75 g h h r z b r h l z b l g h h r z b r h l z b l g h h r h l since h is constant also h l h r h and therefore the second element of d i 1 2 is zero thus we obtain that d i 1 2 0 the proof that d i 1 2 0 is found in an entirely analogous way therefore all four terms in 72 are identically zero and this demonstrates that our first order splitting scheme is exactly well balanced finally we remark that numerical tests conducted with our second order extension of the splitting method demonstrate that the scheme we propose is also well balanced results not shown 6 2 numerical convergence study here we verify the accuracy of our numerical scheme by studying empirical convergence rates for the assessment we compare the exact solutions against the numerical solutions employing aeno and eno reconstruction we omit the presentation of eno reconstruction as the reader can consult chapter 20 of toro 2013 we use the exact solutions presented in canestrelli et al 2009 and proceed as follows we consider the frictionless sve equations 76 t h x q 0 t q x q u 1 2 g h 2 g h x z b 0 t z b x q b 0 and prescribe three smooth functions for h x t q x t and z b x t which satisfy exactly 76 these functions are 77 h x t h 0 c 0 sin k x ω t q x t ω k h 0 c 0 ω k sin k x ω t z b x t h x t q b x t q x t with k 2 π l w and ω 2 π t p results are presented in terms of standard norms l 1 l and relative convergence rates for variables q and z b and given in tables 1 and 2 as expected from the settings of this test the results for the variable h are similar to those of z b and are not reported here the aeno method reached the expected rate in all norms being suboptimal in l norm for z b similarly to what obtained in toro et al 2021 in their application on blood flows although converging to the correct solution the eno method did not reach the expected rate in all norms from the comparison of the cpu time the aeno and eno reconstructions are comparable it is worth remarking that we run the convergence test computing numerical fluctuations 44 using both the iterative solution of the non linear system 36 38 and the linearized solution 42 in both cases results give the very same norms presented in table 1 we therefore recommend the linearized solution 42 for practical applications 6 3 riemann problem tests with movable and fixed bed here we assess the methods as applied to four riemann problem tests with exact solution three with movable bed test 1 test 2 and test 3 and one with fixed bed the initial discontinuity is at x 0 and initial data to the left and right are given in table 3 for test 1 murillo and garcía navarro 2010 the splitting numerical solutions are compared with respect to the price c and dot at first order of accuracy and to dot with aeno reconstruction in conjunction with ader at second order fig 4 shows results for the first order and demonstrate as in spite of its simplicity results with our splitting are comparable with that of the more sophisticated upwind dot scheme the solution is composed by two external rarefaction waves and a central slowly moving shock our splitting method structure well describe the shock both in terms of strength and position in all variables providing very similar results to the dot scheme also for the two rarefaction waves as expected the price c method considerably diffuses the central shock wave results at second order of accuracy in fig 5 show as all three schemes give good results for this test problem in which the central shock wave moves very slowly test 2 has been recently proposed by zhu and dodd 2019 the solution is composed of a left rarefaction a central shock and a fast moving shock on the right the presence of the fast moving shock shock froude number 8 46 makes numerical simulations particularly challenging the splitting numerical solutions are compared with respect to dot at first order of accuracy and to dot with aeno reconstruction in conjunction with ader at second order fig 6 shows results for the first order and demonstrate as results with dot scheme require the use of three gaussian points in the integration of fluctuations 49 while with our splitting method the right shock is well predicted using only one gaussian point the dot with three gaussian points accurately describe both the central shock wave and the left rarefaction our splitting method overshoots in the vicinity of the right shock fig 6 at second order of accuracy this produces spurious oscillations just behind the right shock for z b fig 7 these oscillations disappear when the cfl number is reduced to 0 5 the dot scheme with 3 gaussian points also experiences some problems in the description of the right shock in fact the numerical solution converges to a slower right shock with a reduced strength test 3 has also been recently proposed by zhu and dodd 2018 the numerical solution contains a semi characteristic shock on the left a central shock and a right rarefaction results at second order of accuracy in fig 8 show as the dot scheme with 3 gaussian points predicts a wrong shock strength and propagation speed while the method we proposed accurately converges to the correct solution in fig 9 we computed second order results for test 3 using very fine meshes and courant number c f l 0 5 the left frame shows results from the dot based scheme while those on the right hand side show results from the newly proposed splitting scheme also in second order mode the right facing shock is captured correctly by the present split scheme but dot converges to the wrong solution with slower propagation speed and reduced post shock state the results of fig 9 obtained from two second order non linear methods clearly illustrate the fact that in general numerical computation of non conservative systems may result in computed shocks with the wrong post shock states and wrong speed of propagation such difficulties are not obvious when coarse meshes are used very fine meshes and careful analysis are required to identify the problem and to clearly identify the actual converged numerical solutions this phenomenon will affect all numerical methods in one way or another the root of the problem being in the equations themselves the numerical methods cannot be conservative if the equations are not however there are differences amongst numerical methods as is clearly illustrated in the fig 9 according to castro et al 2008 and beljadid et al 2017 the key feature in understanding the alluded numerical difficulty lies in the inherent numerical viscosity which is present in most numerical methods exceptions are shock fitting methods dafermos and dafermos 2005 and the random choice method of glimm 1965 the results for the fixed bed case are displayed in fig 10 they demonstrate an important feature of the proposed splitting method that is our method converges to the solution of the hydrodynamic saint venant equations when the flow does not transport sediments this is a desirable feature that makes the proposed method particularly suitable for engineering applications 6 4 evolution of a sediment hump this test case simulates the long term evolution of an erodible bed hump immersed into a quasi steady frictionless flow johnson and zyserman 2002 hudson et al 2005 long et al 2008 the initial bed shape is described as 78 z b x 0 z b 0 2 e β x x c 2 with z b 0 6m β 0 01 m 2 and x c 150m as the center of the gaussian hump flow discharge is kept constant at the inflow boundary and set equal to q x 0 t 10 m 2 s 1 while a constant water depth h 0 1m is set at the downstream end of the domain the above quantities are specified according to similar settings in hudson et al 2005 long et al 2008 transmissive downstream boundary conditions are set for the bed initial conditions correspond to the backwater profile obtained with these two boundary conditions the comparison is made for both 1st and 2nd order solutions results displayed in fig 11 demonstrate that the proposed scheme describes the hump evolution with good accuracy very similar to the one of the more sophisticated dot method this latter feature is particularly important when long term bed evolution must be studied 6 5 short term propagation of a small sediment hump with this test we aim to reproduce bed movement under different flow conditions each characterized by a different froude number we consider a one dimensional flat channel with a small hump on the bed described as 78 for this test case the sediment transport formula is 79 q b a g max u u c r 0 m with u c r u ψ u h 0 m a g 1 m 1 where u c r is the fluid velocity critical value that must be exceeded for bedload transport to occur and ψ u is a small constant parameter we then consider two different flow conditions namely near critical with f r 0 99 and supercritical with f r 1 2 and choose as reference water depth h 1m given f r and h we can calculate the value of the discharge per unit width q which is kept always constant at the inlet thus the initial condition h x 0 and q x 0 are obtained running the code under fixed bed conditions we consider a very small hump and set z b max 10 5 m we then find the solution by application of a linearized analytical solver which is suitable for studying the propagation of small amplitude waves see details in lyn and altinakar 2002 and canestrelli et al 2009 numerical results are compared with the linearized solutions in fig 12 in all cases they are in good agreement and converge to the linearized solution in the supercritical case the numerical solution correctly predicts upstream propagation of the small hump in the near critical case the two bed waves one erosional propagating upstream and one depositional propagating downstream are also correctly described 7 concluding remarks in this paper we have proposed a splitting scheme for the sve model we have studied the associated two systems of differential equations after a careful study of the resulting two systems of pdes we proposed a methodology for their numerical solution in the framework of godunov methods we then extend the method up to the second order of accuracy finally we assess the robustness of our splitting method considering different test cases results show that solutions have the correct empirical converge rate in space and time satisfy the well balanced property and are accurate when compared with existing techniques our splitting method constitutes a building block for the construction of high order numerical methods and can easily include source terms at high order with the ader approach furthermore it gives the possibility of future extension to multiple space dimensions the present approach also offers a simple way to incorporate sediment transport formulas for the quantification of sediment fluxes these features are very attractive and makes the splitting scheme a viable alternative to existing approaches to be used for the solution of river and near shore engineering morphodynamic problems credit authorship contribution statement a siviglia conceptualization methodology software formal analysis writing original draft visualization d vanzo conceptualization methodology software writing review editing e f toro conceptualization formal analysis writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments we are grateful to fangfang zhu and nicholas dodd for sharing the exact solution data of tests 2 and 3 as acknowledges financial support from the italian ministry of education university and research miur via the departments of excellence initiative 2018 2022 attributed to dicam of the university of trento grant l 232 2016 
214,we present a splitting method for the one dimensional saint venant exner equations used for describing the bed evolution in shallow water systems we adapt the flux vector splitting approach of toro and vázquez cendón 2012 and identify one subsystem of conservative equations advection system and one of non conservative equations pressure system both having a very simple eigenstructure compared to the full system the final numerical scheme is constructed using a godunov type path conservative scheme for the pressure system and a simple conservative godunov method for the advection system and solved following a coupled solution strategy the resulting first order accurate method is extended to second order of accuracy in space and time via the ader approach together with an aeno reconstruction technique accuracy robustness and well balanced properties of the resulting scheme are assessed through a carefully selected suite of testcases the scheme is exceedingly simple accurate and robust as the sophisticated godunov methods a distinctive feature of the novel scheme is its flexibility in the choice of the sediment transport closure formula which makes it particularly attractive for scientific and engineering applications keywords numerical morphodynamics saint venant exner model flux splitting finite volume methods sediment transport ader method 1 introduction nowadays numerical morphodynamic models are used for different purposes from answering questions about basic morphodynamic research to tackling complex engineering problems shimizu et al 2020 siviglia and crosato 2016 a wide variety of river siviglia et al 2008 duró et al 2016 le et al 2018 and near shore engineering problems kelly and dodd 2010 postacchini et al 2012 are modelled using the shallow water approach in this context morphodynamic investigations are often conducted using the shallow water equations for hydrodynamics saint venant equations de saint venant 1871 coupled to the equation for the bed evolution exner equation exner 1925 both components define a coupled system of partial differential equations pdes for which a conservative form does not exist i e the saint venant exner sve model the numerical solution of the sve model can be obtained following two different strategies namely decoupled and coupled in the decoupled approach the solution is obtained assuming a fixed bed configuration first are solved the hydrodynamic equations and then the exner equation by using the new hydrodynamic variables cunge and perdreau 1973 defina 2003 krishnappan 1985 wu et al 2004 a clear advantage of this approach is that the governing equations are hyperbolic and can be expressed in conservative form despite its simplicity the decoupled approach has some numerical shortcomings kelly and dodd 2010 demonstrated that using a decoupled approach when simulating bore driven sediment transport may lead to a large overestimation of the net off shore transport in the swash zone and postacchini et al 2012 show that the erosion of the bed can be significantly larger when a swash forced by a dam break is considered cordier et al 2011 conducted numerical experiments demonstrating that the decoupled approach may fail producing unphysical instabilities even using a robust and well balanced numerical scheme for shallow water system from a physical point of view the decoupled approach is justified when the bed weakly interacts with the hydrodynamic waves a condition that holds only for situations far from critical conditions carraro et al 2018 de vries 1965 lyn and altinakar 2002 i e when the froude number f r 1 or 1 on the contrary the coupled approach can be applied in all conditions at the price of having a governing system of pdes written in non conservative form e g hudson and sweby 2005 which requires a special numerical treatment in the context of systems in conservative form the riemann invariants and the rankine hugoniot conditions provide all the necessary information to derive exact or approximate solutions of the associated riemann problem when dealing with system containing non conservative products the classical rankine hugoniot conditions across shock waves must be replaced by integral shock conditions in this case the problem is often solved using the theory developed by dal maso et al 1995 that allows one to set the jump conditions and thus the concept of weak solution in terms of a given family of paths the degree of freedom in the choice of the family of paths is eliminated following the approach proposed by parés 2006 who introduced the family of path conservative or path consistent methods to properly handle non conservative pdes these approaches have experienced a great increase of popularity in the last decade and many path conservative finite volume methods have been proposed for solving the sve model following either a centred approach thus not using the eigenstructure of the problem caleffi et al 2007 canestrelli et al 2009 hudson and sweby 2005 or an upwind approach which requires a detailed knowledge of the eigenstructure e g carraro et al 2018 castro et al 2008 in this paper we present a splitting scheme for the non conservative sve system of equations which is solved following a coupled solution strategy our starting point is the flux vector splitting approach of toro and vázquez cendón 2012 tv first put forward for the conservative one dimensional euler equations recently the tv splitting has been successfully applied to the three dimensional euler equations with general equation of state toro et al 2015 to the equations of magnetohydrodynamics balsara et al 2016 and to the baernunziato equations of compressible two phase flow tokareva and toro 2017 our splitting identifies two separate subsystem of pdes the advection and the pressure systems it differs from the original tv splitting in two respects namely i the advection contained in the continuity equation of the saint venant equations is placed in the pressure system and ii the pressure system is non conservative the wave pattern of the pressure system is always subcritical and the solution of the associated riemann problem can be easily found using riemann invariants this provides all the items required for the evaluation of the fluctuations to be used in the update formula using the godunov type path conservative method theoretically introduced in muñoz ruiz and parés 2007 this method is here used for the first time in numerical applications the advection system is hyperbolic and the numerical fluxes are obtained using a simple advection method an attractive feature of the present method is that the sediment fluxes are contained in the advection system and are evaluated as they are described by the sediment transport formula this means that there is no need of any differentiation as is required when the entire coefficient matrix of the sve equations is employed for the numerical simulations carraro et al 2018 canestrelli et al 2009 castro et al 2008 extension to second order is obtained through application of the ader methodology first introduced in toro et al 2001 and further developed in toro and titarev 2002 titarev and toro 2002 dumbser et al 2008 ader has also been applied to problems governed by the non conservative sve equations canestrelli et al 2009 2010 siviglia et al 2013 polynomial reconstruction is performed employing the aeno reconstruction procedure an averaged variant of the popular eno method harten et al 1987 recently proposed by toro et al 2021 the paper is structured as follows section 2 briefly reviews the governing equations and the closure relationship for the sediment transport and in section 3 we apply the flux splitting framework to the sve equations and introduce the corresponding advection and pressure systems in section 4 we present our splitting numerical method in first order mode and in section 5 we extend it to second order of accuracy in section 6 we present numerical results for a range of carefully selected test problems to assess both the robustness and accuracy of the schemes proposed in this paper conclusions are drawn in section 7 2 the saint venant exner model we consider the one dimensional morphodynamic saint venant exner model which describes the flow evolution over an erodible bed the bed is composed of uniform sediments which are transported by the flow as bedload in this section we recall the governing equations introduce the closure relationship adopted for its solution and then we write the system in quasi linear form 2 1 the governing equations and bedload closure relationship the governing equations are obtained under shallow water conditions and includes equations for the conservation of water mass continuity equation 1 t h x q 0 and momentum of the water phase 2 t q x q 2 h 1 2 g h 2 g h x z b g h s f the bed evolution is described by the sediment continuity or exner equation 3 t z b x q b 0 where t s is time x m is the streamwise coordinate and g 9 806 m s 2 is the acceleration due to gravity the quantities involved are illustrated in fig 1 here h m is the flow depth z b m is the bed level and u m s 1 is depth averaged flow velocity the flow discharge per unit width is defined as q u h m 2 s 1 q b m 2 s 1 is the bedload sediment flux per unit width divided by 1 λ p where λ p is the bed porosity and s f is the friction slope both to be specified by an appropriate closure relationship for the sake of simplicity we model bedload sediment flux per unit width q b in a simple form in which q b q b u only such that grass 1981 4 q b a g u m where a g m 2 m s m 1 and m 1 are two constant parameters we remark that the proposed framework can work with any closure relationship for the bedload flux 2 2 quasi linear form of the governing equations the sve model 1 3 is a non conservative system canestrelli et al 2009 castro et al 2008 and can be written as follows 5 t q x f q b q x q s q where 6 q h q z b f q 1 2 g h 2 q 2 h q b b 0 0 0 0 0 g h 0 0 0 s 0 g h s f 0 the sve model can also be written in quasi linear form as 7 q t a q q x s where a is the coefficient matrix given as 8 a q 0 1 0 c 2 u 2 2 u c 2 u ψ ψ 0 in the coefficient matrix c g h is the celerity and 9 ψ q b q is a measure of the intensity of total bedload in the flow usually in the range 0 ψ ξ of order o 10 2 de vries 1965 lyn and altinakar 2002 ψ is obtained from differentiating the sediment transport formula and thus depends on the bedload closure relationship adopted in this work from equation 4 we obtain 10 ψ m q b q the characteristic polynomial of the coefficient matrix a is obtained by setting a λ i 0 where i is the 3 3 identity matrix 11 λ 3 2 u λ 2 u 2 g h ψ 1 g h λ u g h ψ 0 if a power law formula for the solid transport is used as that adopted in 4 the three eigenvalues λ 1 λ 2 λ 3 are always real thus the governing system is always hyperbolic cordier et al 2011 it is worth remarking that under different flow conditions either subcritical f r 1 f r u g h or supercritical f r 1 there are always two positive and one negative eigenvalues from a physical point of view under sub or supercritical conditions f r 1 or f r 1 the bed interacts only weakly with the water surface and small bottom perturbations propagate at a slower pace compared with the hydrodynamic waves whereas under near critical conditions f r 1 the interactions between the bed and hydrodynamic waves are quite strong for background on the hyperbolicity of the sve the eigenvalues behavior and the physical behavior of small bed perturbations see cordier et al 2011 lyn and altinakar 2002 for example in this paper we are primarily interested in the principal part of 5 and therefore we restrict ourselves to the homogeneous case s q 0 3 splitting framework in this section we propose a splitting method for systems written in non conservative form following the framework of toro and vázquez cendón 2012 we remark that this novel formulation is valid either under sub or supercritical conditions f r 1 or f r 1 or under near critical conditions f r 1 3 1 the framework consider now the homogeneous sve equations 12 t q x f q b q x q 0 with 13 q h q z b f q q 1 2 g h 2 q 2 h q b b q 0 0 0 0 0 g h 0 0 0 first we identify the conservative part and express the conservative flux as the sum of advection and pressure fluxes as follows 14 f q 0 q 2 h q b q 1 2 g h 2 0 with the corresponding advection and pressure fluxes defined as 15 f a q q 0 q h q b q and f p q q 1 2 g h 2 0 then we consider two subsystems t q x f a q 0 16 t q x f p q b q x q 0 17 called respectively the advection system 16 and the pressure system 17 we note however that here the pressure system would be augmented by the non conservative term present in the sve equations the final goal of this procedure is to obtain the numerical solution of the full sve system of equations the tv flux splitting approach consists of approximating the numerical fluxes for the pressure system and advection system separately and constructing the numerical fluctuations for the full system based on these to this end the analysis of the eigenstructure and the study of the riemann problem for the pressure system are necessary 3 1 1 the pressure system the pressure system 17 is non conservative because of the presence of the non conservative term g h x z b appearing in the momentum equation 2 it can be written in quasi linear form as 18 t q p q x q 0 with 19 p j p b 0 1 0 c 2 0 0 0 0 0 0 0 0 0 0 c 2 0 0 0 0 1 0 c 2 0 c 2 0 0 0 where j p is the jacobian matrix of the pressure fluxes f p in 15 the eigenvalues of matrix p are 20 λ 1 p c λ 2 p 0 λ 3 p c the eigenvalues are always real and λ 1 p λ 2 p 0 λ 3 p and thus the system is always subcritical as illustrated in fig 2 the right eigenvectors corresponding to the three eigenvalues 20 are 21 r 1 p 1 c 0 r 2 p 1 0 1 r 3 p 1 c 0 3 1 2 the advection system the advection system in conservative form is 22 t q x f a q 0 where q h q z b t and f a as in 15 the quasi linear form is given by 23 t q j a q x q 0 where 24 j a 0 0 0 u 2 2 u 0 u ψ ψ 0 is the jacobian of matrix f a simple analysis shows that the eigenvalues of matrix 24 are λ 1 a 0 and λ 2 a λ 3 a u and that there are only two linearly independent right eigenvectors given by 25 r 1 a α 1 0 0 1 r 2 a α 2 1 u 0 thus the advection system is weakly hyperbolic it is easy to show that the λ 1 a field is linearly degenerate while the λ 2 a and λ 3 a are genuinely non linear if α 2 0 and u 0 we note that the weakly hyperbolic nature of the advection system does not have a bearing on its numerical approximation 4 numerical solution direct integration of 12 in the space time control volume v i x i 1 2 x i 1 2 t n t n 1 gives the following update numerical formula to solve 12 26 q i n 1 q i n δ t δ x d i 1 2 d i 1 2 f i 1 2 a f i 1 2 a q i n 1 and q i n are the cell averaged values of the vector q at time t n 1 and t n δ t is the time step derived from the standard cfl stability condition and δ x is the grid size here for simplicity assumed having a constant size d i 1 2 and d i 1 2 are fluctuations or increments associated to the pressure system which are obtained using path conservative schemes parés 2006 while f i 1 2 a and f i 1 2 a are the numerical fluxes of the advection system obtained using simple advection methods in order to compute the fluctuations d i 1 2 and d i 1 2 and the advection fluxes f i 1 2 a and f i 1 2 a to be used in 26 we consider the riemann problem for each system we start with the pressure system 4 1 the pressure system in order to calculate the fluctuations d i 1 2 and d i 1 2 at the interface x i 1 2 we consider the riemann problem for the pressure system in conservative variables 27 t q p q x q 0 x r t 0 q x 0 q l q i n if x 0 q r q i 1 n if x 0 the structure of the solution of 27 at the fixed interface position x i 1 2 or x 0 in local coordinates is illustrated in fig 2 the wave pattern is always subcritical and composed by three wave families the left family is associated with the eigenvalue λ 1 p the middle family is superimposed onto the t axis and is associated with λ 2 p and the right family is associated with λ 3 p the waves associated with the genuinely non linear characteristic fields λ 1 p and λ 3 p are either shocks discontinuous solutions or rarefactions smooth solutions while the wave associated with the linearly degenerate characteristic field λ 2 p is a stationary contact discontinuity the entire solution consists of four constant states namely q l h l q l z b l t data q l h l q l z b l t q r h r q r z b r t and q r h r q r z b r t data separated by the three distinct waves the unknown states to be found in the star region are q l left of x 0 and q r right of x 0 we apply riemann invariants to find these solutions across the stationary contact discontinuity with right eigenvectors 21 the generalized riemann invariants are solutions of the following two ordinary differential equations odes 28 stationary contact d h 1 d q 0 d z b 1 which can be obviously rewritten as a system of odes d h 1 d q 0 29 d h 1 d z b 1 30 integration of the 29 in the phase space gives q c o n s t across the wave and thus q l q r q while integration of 30 gives 31 h l z b l h r z b r h this latter equation states that the free surface remain constant across the stationary contact across the left and right waves we have 32 left wave d h 1 d q c d z b 0 33 right wave d h 1 d q c d z b 0 the third odes in eqs 32 and 33 imply that z b remains constant across the left i e z b l z b l and right wave i e z b r z b r exact integration of the first odes in eqs 32 and 33 respectively gives that 2 3 g h 3 2 q c o n s t across the left wave 34 2 3 g h 3 2 q c o n s t across the right wave 35 after simple algebraic manipulations of eqs 31 34 and 35 we obtain the following non linear system h l 3 2 h r 3 2 k 36 h l h r δ z b 37 q 1 2 q l q r g 3 h l 3 2 h r 3 2 h l 3 2 h r 3 2 38 where 39 k 3 2 g q l q r h l 3 2 h r 3 2 and δ z b z b r z b l iterative solution of 36 and 37 gives the sought values h l and h r substitution of such values in 38 provides q we can improve the efficiency of our method by finding an approximate solution of 36 in closed form a possible way to avoid the iterations is the following we assume that δ z b 0 and solve 37 that gives h l h r h then solving 36 we obtain a closed form solution for h i e 40 h 3 4 g q l q r 1 2 h l 3 2 h r 3 2 2 3 at this stage we linearize 36 which together with 37 gives the following linear system 41 h l h h r h k h l h r δ z b that gives 42 h l 1 2 k h δ z b finally we obtain the following system that can be directly solved 43 h l 1 2 k h δ z b h r h l δ z b q 1 2 q l q r g 3 h l 3 2 h r 3 2 h l 3 2 h r 3 2 once the solution in the star region is known the fluctuations d i 1 2 and d i 1 2 are obtained using a godunov type path conservative method as in muñoz ruiz and parés 2007 44 d i 1 2 1 δ t 0 δ t 0 1 p ψ s q i n q r s ψ s q i n q r d s d t d i 1 2 1 δ t 0 δ t 0 1 p ψ s q l q i 1 n s ψ s q l q i 1 n d s d t we remark that in the riemann problem associated with the pressure system we have two star regions one on the left of x 0 whose solution is q l and one on the right whose solution is q r the presence of these two regions is taken into account integrating the left fluctuation d i 1 2 between q i n and q r and the right fluctuation d i 1 2 between q l and q i 1 n we verified numerically that the fluctuations calculated as in 44 satisfy the compatibility condition 45 d i 1 2 d i 1 2 1 δ t 0 δ t 0 1 p ψ s q i n q i 1 n s ψ s q i n q i 1 n d s for all numerical test cases presented in this paper we always use the simple segment paths given by 46 ψ s q i n q r q i n s q r q i n ψ s q l q i 1 n q l s q i 1 n q l then from 44 we have 47 d i 1 2 p i 1 2 q r q i n d i 1 2 p i 1 2 q i 1 n q l where 48 p i 1 2 1 δ t 0 δ t 0 1 p ψ s q i n q r d s d t p i 1 2 1 δ t 0 δ t 0 1 p ψ s q l q i 1 n d s d t given a n g p point gaussian quadrature rule with weights ω j and positions s j distributed in the unit interval 0 1 a very accurate numerical approximation of the matrices p i 1 2 and p i 1 2 is given by 49 p i 1 2 j 1 n g p ω j p ψ s j q i q r p i 1 2 j 1 n g p ω j p ψ s j q l q i 1 all simulations employing our splitting method in this work are performed using n g p 1 this is enough to ensure the achievement of second order of accuracy 4 2 the advection system recall that in our splitting 15 the advection operator is written as 50 f a q 0 q 2 h a g q h m the algorithm we propose for constructing the numerical flux f i 1 2 a to be used in the update formula 26 is 51 f i 1 2 a q 0 u i n a g u i n m 1 h i n if q 0 q 0 u i 1 n a g u i 1 n m 1 h i 1 n if q 0 where q is the solution 38 emerging from the riemann problem of the pressure system 4 3 summary of the proposed scheme in order to compute the fluctuations d i 1 2 and d i 1 2 and advection fluxes f i 1 2 a and f i 1 2 a to be used in the update formula 26 we proceed as follows pressure fluctuations at each interface evaluate the solution of the riemann problem q l h l q z b l t and q r h r q z b r t using eqs 42 37 and 38 then calculate d i 1 2 and d i 1 2 as in 47 evaluating the approximated matrices 49 using one gaussian point advection flux evaluate the advection fluxes f i 1 2 a as described in 51 5 second order extension extension to second order is obtained using the ader methodology by toro et al 2001 the procedure to achieve second order contains two ingredients i a first order non linear spatial reconstruction of the gradient of the solution in each cell and 2 the solution of the generalized riemann problem grp at the interface of each cell for background on ader see chapters 19 and 20 of toro 2013 and references therein here we consider second order accurate ader schemes based on the heoc solver of harten et al 1987 see also castro and toro 2008 for the grp 5 1 nonlinear reconstruction technique first we deal with the reconstruction problem we adopt the aeno reconstruction procedure an averaged variant of the popular eno method harten et al 1987 recently proposed by toro et al 2021 to achieve second order of accuracy we need to construct first degree polynomials p i in each cell i i at time t n from the given cell averages q i n of the form 52 p i q i n x x i δ i where δ i is the slope vector and x i x i 1 2 x i 1 2 2 recall that in order to circumvent godunovs theorem godunov 1959 the reconstruction must be non linear see chapter 20 of toro 2013 for background here the non linearity of the scheme is ensured by taking the polynomial slope as 53 δ i 1 2 1 β δ i 1 2 1 2 1 β δ i 1 2 with β 1 where 54 β r 1 r ϵ 2 r 1 2 with r δ i 1 2 δ i 1 2 t o l and 55 δ i 1 2 q i n q i 1 n δ x δ i 1 2 q i 1 n q i n δ x the parameter ϵ is a positive constant while t o l is a small positive tolerance to avoid division by zero 5 2 second order ader with the heoc solver for the grp the result of the reconstruction procedure is a non oscillatory linear polynomial p i defined at time t n inside each spatial element i i we are interested in the left and right limiting values of the reconstruction polynomials often called boundary extrapolated values let us first consider cell i i with cell boundaries x i 1 2 and x i 1 2 and define 56 q i l p i x i 1 2 q x i 1 2 0 q i r p i x i 1 2 q x i 1 2 0 we now evolve these limiting values in time using the time taylor series expansion 57 q i l τ q x i 1 2 0 τ t q x i 1 2 0 q i r τ q x i 1 2 0 τ t q x i 1 2 0 after adopting notation 56 and using the cauchy kovalevskaya procedure in the case of our splitting the time derivatives above can be expressed as 58 t q x i 1 2 0 x f a p i x i 1 2 p p i x i 1 2 x q x i 1 2 0 t q x i 1 2 0 x f a p i x i 1 2 p p i x i 1 2 x q x i 1 2 0 the advection flux gradient to second order can be approximated as follows 59 x f a p i x i 1 2 x f a p i x i 1 2 f a q i r f a q i l δ x and the pressure non conservative term as 60 p p i x i 1 2 x q x i 1 2 0 p q i l δ i p p i x i 1 2 x q x i 1 2 0 p q i r δ i finally the evolved boundary values in cell i i at time τ 1 2 δ t after using 57 59 and 60 become 61 q i l q i l 1 2 δ t f a q i r f a q i l δ x 1 2 δ t p q i l δ i q i r q i r 1 2 δ t f a q i r f a q i l δ x 1 2 δ t p q i r δ i the time evolution is obtained in a splitting mode making use of the advection fluxes f a and the pressure coefficient matrix p we remark that we do not make use of the coefficient matrix of the full system a 8 5 3 the fully discrete second order accurate one step scheme exact integration of the system 12 over a space time control volume v i x i 1 2 x i 1 2 t n t n 1 see castro et al 2006 and parés 2006 for details gives the following update formula 62 q i n 1 q i n δ t δ x d i 1 2 d i 1 2 f i 1 2 a f i 1 2 a δ t h i where 63 h i 1 δ t t n t n 1 x i 1 2 x i 1 2 p q x i 1 2 δ t x q x i 1 2 δ t d x d t the term h i integrates the smooth part of the non conservative product within each cell excluding the jumps at the boundaries and vanishes for a first order scheme where we have h i 0 this term will be defined shortly now the required solution of the generalized riemann problem at the interface x i 1 2 is given by the solution of the following conventional piece wise constant data homogeneous riemann problem see fig 3 64 t q p q x q 0 x r t 0 q x 0 q i r if x 0 q i 1 l if x 0 the solutions of the grp 64 are obtained solving the non linear system 36 38 as described in section 4 1 with initial data q i r q i 1 l let us denote the similarity solution of 64 as q l h l q z b l t and q r h r q z b r t then the fluctuations d i 1 2 and d i 1 2 are calculated as 65 d i 1 2 1 δ t 0 δ t 0 1 p ψ s q i r q r s ψ s q i r q r d s d t d i 1 2 1 δ t 0 δ t 0 1 p ψ s q l q i 1 l s ψ s q l q i 1 l d s d t here the paths considered are 66 ψ s q i r q r q i r s q r q i r ψ s q l q i 1 l q l s q i 1 l q l following the same approach as for the first order problem see eq 51 the numerical flux f i 1 2 a are obtained as 67 f i 1 2 a q 0 u l a g u l m 1 h l if q 0 q 0 u i 1 a g u r m 1 h r if q 0 finally to compute h i we first approximate the spatial derivative as 68 x q x i 1 2 δ t q i r q i l δ x substitution into eq 63 and integrating we obtain 69 h i p q x i 1 2 δ t q i r q i l δ x where 70 q x i 1 2 δ t q i n 1 2 δ t p q i n δ i in the following we briefly summarize the entire second order one step algorithm 1 perform the aeno reconstruction described in section 5 1 in order to obtain the slope δ i 53 for each cell 2 extrapolate values at cell boundaries x i 1 2 and x i 1 2 56 and then evolve these limiting values in time using the time taylor series expansion 57 3 solve the grp 64 of the pressure system through the solution of the non linear system 36 38 with initial data q i r q i 1 l this step gives the star region solutions q l h l q z b l t and q r h r q z b r t 4 at each interface use q i r q i 1 l and q l q r to compute the fluctuations 65 using the paths 66 5 at each interface use q i r q i 1 l and q l q r to calculate the fluxes 67 6 at each cell center use q i r q i 1 l and time evolution of the center cell values 70 to calculate h i 69 7 finally use the fully discrete scheme 62 and perform the update of the cell averages 6 numerical results here we assess the proposed splitting method on a carefully selected suite of test problems for all tests the numerical stability is imposed by the courant friedrichs lewy condition and the integration time step is evaluated as 71 δ t c f l min 1 i m δ x λ h i where m is the total number of cells and λ h i q i h i g h i is the maximum eigenvalue for the fixed bed case saint venant equations to take into account the small differences between λ h i and the maximum eigenvalue of the coupled sve model see lyn and altinakar 2002 for details we set the c f l number to 0 9 for all numerical runs numerical fluctuations 44 are evaluated using the linearized solution 42 as numerical reference schemes we use i the dumbser osher toro dot solver dumbser and toro 2011 which is an all purpose universal godunov upwind method that can be applied to any hyperbolic system as long as the full eigenstructure is available ii the price c scheme canestrelli et al 2009 which is a method of the centred type which requires a minimum knowledge about the eigenstructure i e an estimate of the fastest eigenvalue to be used in the cfl condition 6 1 verification of the c property a desirable feature of numerical methods for shallow water systems with variable bottom is the satisfaction of the so called c property as introduced by bermudez and vazquez 1994 let us consider a quiescent flow q 0 m 2 s 1 over any submerged bed profile under these conditions the initial water surface h h z b is constant and should remain constant in time this is numerically achieved if the solution does not change in time and thus q i n 1 q i n in 26 therefore we have to prove that 72 d i 1 2 d i 1 2 f i 1 2 a f i 1 2 a 0 first we consider the flux f i 1 2 a computed as in 51 under quiescent flow conditions q l q r 0 and consequently from 39 we obtain k h l 3 2 h r 3 2 substitution of this result in 36 gives 73 h l 3 2 h r 3 2 h l 3 2 h r 3 2 0 and thus we have from 38 q 0 inserting q 0 into 51 leads to f i 1 2 a 0 analogous conclusions can be drawn for f i 1 2 a second we focus on the fluctuations d i 1 2 the numerical evaluation of such fluctuation through 47 gives 74 d i 1 2 p i 1 2 q i 1 n q l 0 1 0 g h 0 g h 0 0 0 h r h l 0 z b r z b l 0 g h h r z b r h l z b l 0 with h 0 1 h s d s 0 1 h l s h r h l d s if q 0 then 34 gives that h l h l and thus the second element of d i 1 2 becomes 75 g h h r z b r h l z b l g h h r z b r h l z b l g h h r h l since h is constant also h l h r h and therefore the second element of d i 1 2 is zero thus we obtain that d i 1 2 0 the proof that d i 1 2 0 is found in an entirely analogous way therefore all four terms in 72 are identically zero and this demonstrates that our first order splitting scheme is exactly well balanced finally we remark that numerical tests conducted with our second order extension of the splitting method demonstrate that the scheme we propose is also well balanced results not shown 6 2 numerical convergence study here we verify the accuracy of our numerical scheme by studying empirical convergence rates for the assessment we compare the exact solutions against the numerical solutions employing aeno and eno reconstruction we omit the presentation of eno reconstruction as the reader can consult chapter 20 of toro 2013 we use the exact solutions presented in canestrelli et al 2009 and proceed as follows we consider the frictionless sve equations 76 t h x q 0 t q x q u 1 2 g h 2 g h x z b 0 t z b x q b 0 and prescribe three smooth functions for h x t q x t and z b x t which satisfy exactly 76 these functions are 77 h x t h 0 c 0 sin k x ω t q x t ω k h 0 c 0 ω k sin k x ω t z b x t h x t q b x t q x t with k 2 π l w and ω 2 π t p results are presented in terms of standard norms l 1 l and relative convergence rates for variables q and z b and given in tables 1 and 2 as expected from the settings of this test the results for the variable h are similar to those of z b and are not reported here the aeno method reached the expected rate in all norms being suboptimal in l norm for z b similarly to what obtained in toro et al 2021 in their application on blood flows although converging to the correct solution the eno method did not reach the expected rate in all norms from the comparison of the cpu time the aeno and eno reconstructions are comparable it is worth remarking that we run the convergence test computing numerical fluctuations 44 using both the iterative solution of the non linear system 36 38 and the linearized solution 42 in both cases results give the very same norms presented in table 1 we therefore recommend the linearized solution 42 for practical applications 6 3 riemann problem tests with movable and fixed bed here we assess the methods as applied to four riemann problem tests with exact solution three with movable bed test 1 test 2 and test 3 and one with fixed bed the initial discontinuity is at x 0 and initial data to the left and right are given in table 3 for test 1 murillo and garcía navarro 2010 the splitting numerical solutions are compared with respect to the price c and dot at first order of accuracy and to dot with aeno reconstruction in conjunction with ader at second order fig 4 shows results for the first order and demonstrate as in spite of its simplicity results with our splitting are comparable with that of the more sophisticated upwind dot scheme the solution is composed by two external rarefaction waves and a central slowly moving shock our splitting method structure well describe the shock both in terms of strength and position in all variables providing very similar results to the dot scheme also for the two rarefaction waves as expected the price c method considerably diffuses the central shock wave results at second order of accuracy in fig 5 show as all three schemes give good results for this test problem in which the central shock wave moves very slowly test 2 has been recently proposed by zhu and dodd 2019 the solution is composed of a left rarefaction a central shock and a fast moving shock on the right the presence of the fast moving shock shock froude number 8 46 makes numerical simulations particularly challenging the splitting numerical solutions are compared with respect to dot at first order of accuracy and to dot with aeno reconstruction in conjunction with ader at second order fig 6 shows results for the first order and demonstrate as results with dot scheme require the use of three gaussian points in the integration of fluctuations 49 while with our splitting method the right shock is well predicted using only one gaussian point the dot with three gaussian points accurately describe both the central shock wave and the left rarefaction our splitting method overshoots in the vicinity of the right shock fig 6 at second order of accuracy this produces spurious oscillations just behind the right shock for z b fig 7 these oscillations disappear when the cfl number is reduced to 0 5 the dot scheme with 3 gaussian points also experiences some problems in the description of the right shock in fact the numerical solution converges to a slower right shock with a reduced strength test 3 has also been recently proposed by zhu and dodd 2018 the numerical solution contains a semi characteristic shock on the left a central shock and a right rarefaction results at second order of accuracy in fig 8 show as the dot scheme with 3 gaussian points predicts a wrong shock strength and propagation speed while the method we proposed accurately converges to the correct solution in fig 9 we computed second order results for test 3 using very fine meshes and courant number c f l 0 5 the left frame shows results from the dot based scheme while those on the right hand side show results from the newly proposed splitting scheme also in second order mode the right facing shock is captured correctly by the present split scheme but dot converges to the wrong solution with slower propagation speed and reduced post shock state the results of fig 9 obtained from two second order non linear methods clearly illustrate the fact that in general numerical computation of non conservative systems may result in computed shocks with the wrong post shock states and wrong speed of propagation such difficulties are not obvious when coarse meshes are used very fine meshes and careful analysis are required to identify the problem and to clearly identify the actual converged numerical solutions this phenomenon will affect all numerical methods in one way or another the root of the problem being in the equations themselves the numerical methods cannot be conservative if the equations are not however there are differences amongst numerical methods as is clearly illustrated in the fig 9 according to castro et al 2008 and beljadid et al 2017 the key feature in understanding the alluded numerical difficulty lies in the inherent numerical viscosity which is present in most numerical methods exceptions are shock fitting methods dafermos and dafermos 2005 and the random choice method of glimm 1965 the results for the fixed bed case are displayed in fig 10 they demonstrate an important feature of the proposed splitting method that is our method converges to the solution of the hydrodynamic saint venant equations when the flow does not transport sediments this is a desirable feature that makes the proposed method particularly suitable for engineering applications 6 4 evolution of a sediment hump this test case simulates the long term evolution of an erodible bed hump immersed into a quasi steady frictionless flow johnson and zyserman 2002 hudson et al 2005 long et al 2008 the initial bed shape is described as 78 z b x 0 z b 0 2 e β x x c 2 with z b 0 6m β 0 01 m 2 and x c 150m as the center of the gaussian hump flow discharge is kept constant at the inflow boundary and set equal to q x 0 t 10 m 2 s 1 while a constant water depth h 0 1m is set at the downstream end of the domain the above quantities are specified according to similar settings in hudson et al 2005 long et al 2008 transmissive downstream boundary conditions are set for the bed initial conditions correspond to the backwater profile obtained with these two boundary conditions the comparison is made for both 1st and 2nd order solutions results displayed in fig 11 demonstrate that the proposed scheme describes the hump evolution with good accuracy very similar to the one of the more sophisticated dot method this latter feature is particularly important when long term bed evolution must be studied 6 5 short term propagation of a small sediment hump with this test we aim to reproduce bed movement under different flow conditions each characterized by a different froude number we consider a one dimensional flat channel with a small hump on the bed described as 78 for this test case the sediment transport formula is 79 q b a g max u u c r 0 m with u c r u ψ u h 0 m a g 1 m 1 where u c r is the fluid velocity critical value that must be exceeded for bedload transport to occur and ψ u is a small constant parameter we then consider two different flow conditions namely near critical with f r 0 99 and supercritical with f r 1 2 and choose as reference water depth h 1m given f r and h we can calculate the value of the discharge per unit width q which is kept always constant at the inlet thus the initial condition h x 0 and q x 0 are obtained running the code under fixed bed conditions we consider a very small hump and set z b max 10 5 m we then find the solution by application of a linearized analytical solver which is suitable for studying the propagation of small amplitude waves see details in lyn and altinakar 2002 and canestrelli et al 2009 numerical results are compared with the linearized solutions in fig 12 in all cases they are in good agreement and converge to the linearized solution in the supercritical case the numerical solution correctly predicts upstream propagation of the small hump in the near critical case the two bed waves one erosional propagating upstream and one depositional propagating downstream are also correctly described 7 concluding remarks in this paper we have proposed a splitting scheme for the sve model we have studied the associated two systems of differential equations after a careful study of the resulting two systems of pdes we proposed a methodology for their numerical solution in the framework of godunov methods we then extend the method up to the second order of accuracy finally we assess the robustness of our splitting method considering different test cases results show that solutions have the correct empirical converge rate in space and time satisfy the well balanced property and are accurate when compared with existing techniques our splitting method constitutes a building block for the construction of high order numerical methods and can easily include source terms at high order with the ader approach furthermore it gives the possibility of future extension to multiple space dimensions the present approach also offers a simple way to incorporate sediment transport formulas for the quantification of sediment fluxes these features are very attractive and makes the splitting scheme a viable alternative to existing approaches to be used for the solution of river and near shore engineering morphodynamic problems credit authorship contribution statement a siviglia conceptualization methodology software formal analysis writing original draft visualization d vanzo conceptualization methodology software writing review editing e f toro conceptualization formal analysis writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments we are grateful to fangfang zhu and nicholas dodd for sharing the exact solution data of tests 2 and 3 as acknowledges financial support from the italian ministry of education university and research miur via the departments of excellence initiative 2018 2022 attributed to dicam of the university of trento grant l 232 2016 
