index,text
4110,biochar is an efficient sorbent for polycyclic aromatic hydrocarbons pahs however little is known about pahs sorption kinetics and the effect on the mobility of biochar colloids in saturated porous media in this study naphthalene nap and phenanthrene phe were chosen as typical pahs in different stages different sorption sites of pahs on biochar played a distinct role in affecting the transport of biochar colloids in saturated porous media the biochar colloids showed less negative surface charge as the contact time between biochar colloids and pahs increased from 0 017 h to 96 h which led to the mobility of biochar colloids decreasing over time but after 168 h contact time the surface charge of biochar colloids became more negative again and the inhibition effect of pahs on biochar colloid transport was weakened this was related to the sorption kinetics of pahs on biochar colloids 1 pahs sorption onto outer biochar surface and 2 adsorbed pahs diffusion into internal biochar pores pahs sorption onto the outer biochar surface shielded the negative surface charge and then decreased the mobility of biochar colloids and then the adsorbed pahs diffusion into internal biochar pores increased their mobility again our results suggested that porous colloids facilitated pahs transport in porous media might be highly related to interaction time between pahs and porous colloids keywords biochar colloids transport kinetic sorption naphthalene phenanthrene 1 introduction polycyclic aromatic hydrocarbons pahs are a ubiquitous group of organic contaminants which consist of multiple aromatic rings and are produced by the incomplete combustion of carbon containing materials naphthalene nap and phenanthrene phe are two typical pahs soltani et al 2015 li et al 2019 the content of pahs in aquatic soil and sedimentary environments is increasing due to human activities because of their strong aromaticity and high hydrophobicity pahs mainly sorb onto geo sorbents i e soil sediment and black carbon cornelissen et al 2006 an et al 2017 the hydrophobicity of pahs increases with the number of aromatic rings han et al 2014 yang et al 2018 zhu et al 2018 due to their high carcinogenicity bioaccumulation and poor degradation in the environment pahs have been listed as priority pollutants by the united states environmental protection agency usepa zhu et al 2018 ye et al 2019 biochar was considered as an adsorbent for pahs because of its high aromaticity rich porous structure and high specific surface area wang et al 2006 chen et al 2008 yargicoglu et al 2015 wang et al 2017a the immobilization of pahs by biochar decreases their bioavailability beesley et al 2010 khan et al 2015 besides biochar enhances pahs degradation by increasing microbial activity anyika et al 2015 rein et al 2016 sigmund et al 2018 yang et al 2018 therefore biochar can be used as a remediation agent in pahs contaminated soil anyika et al 2015 biochar produced by high temperature pyrolysis 400 c has more condensed aromatic clusters and shows a strong affinity for pahs through π π electron donor acceptor interaction zhu and pignatello 2005 wang et al 2016 wang et al 2017a high temperature biochar generally has a large porosity with well developed nano or micro pores which are accessible for sorption of low molecular weight pahs lmw pahs chen et al 2012 thus pore filling is one of the dominant mechanisms for lmw pahs sorption on biochar chen et al 2008 biochar can be used as a passivant to remediate pahs contaminated soil biochar in the soil is always subject to aging mia et al 2017 physical aging is the most critical degradation pathway for biochar spokas et al 2014 which leads to biochar breakdown byrne and nagle 1997 gao and wu 2014 and become micro and nano sized fragments wang et al 2013a which was called as biochar colloids these biochar colloids can vertically migrate through the soil profile with flowing water obia et al 2017 in recent years a few studies in the laboratory focused on the movement of biochar colloids in saturated sand columns zhang et al 2010 wang et al 2013a wang et al 2013b yang et al 2017a yang et al 2019a feedstock pyrolysis temperature and particle size of biochar as well as ionic strength and ph conditions of background solution highly affect the transport of biochar colloids in saturated porous media zhang et al 2010 wang et al 2013a wang et al 2013b moreover organic compounds have a distinct influence on the transport of biochar colloids in saturated porous media wang et al 2013b yang et al 2017a yang et al 2019a because of the strong affinity of biochar for organic pollutants chen et al 2008 liu et al 2017 biochar colloids may serve as a carrier for the organic contaminants facilitate their transport and induce secondary pollution in the environment zhang et al 2010 the presence of nap could reduce the transport of biochar colloids because nap was strongly sorbed to biochar and reduced the negative surface charge of the biochar colloids through charge shielding yang et al 2017a yang et al 2017b castan et al 2019 sulfamethazine an antibiotic could decrease the mobility of biochar colloids in quartz sand column under acidic and neutral ph conditions and increase their mobility under alkaline conditions since sulfamethazine sorption changed the surface properties of biochar colloids yang et al 2020 hameed et al 2021 have demonstrated that the mobilities of three typical organic contaminants phe atrazine and oxytetracycline were very low but significantly increased by their co transport with biochar colloids in the soil column this suggested that the sorption process of organic contaminants on biochar colloids played an important role in the mobility and fate of biochar colloids in pahs polluted soil the adsorption of pahs on biochar is a dynamic process previous studies have shown that rapid sorption occurs at the beginning of the interaction between biochar and pahs in solution conditions and slow adsorption is followed which is limited by diffusion of lmw pahs into the internal pores of biochar chen et al 2012 liu et al 2017 for pahs adsorption on biochar the time to reach the equilibrium of pahs to biochar can range from hours 4 7 h for nap to days 1 18 days for phe chen et al 2012 yakout et al 2013 kang et al 2017 for most antibiotics like lincomycin liu et al 2016 sulfamethoxazole lian et al 2014 tetracycline wang et al 2017b and ciprofloxacin shang et al 2016 sorption equilibration time with biochar also varied from hours to days in some experiments pore diffusion could not be estimated due to short period in this study the effect of pahs sorption kinetics on the transport of biochar colloids in saturated sand columns was investigated two typical pahs nap and phe were selected in our study due to their common presence in the polluted soil and wastewater cao et al 2019 wu et al 2019 the adsorption and desorption characteristics of pahs on biochar were quantified using batch experiments to estimate the surface property change of biochar colloids with pahs sorption kinetics over time the electrophoretic mobility and infra red spectrum characteristics of biochar colloids were measured at different contact time between biochar and pahs column experiments were carried out to assess the mobility of biochar colloids in the presence of pahs during different kinetic sorption stages the objectives of this study were to 1 study the influence of pahs sorption kinetics on the surface physicochemical properties of biochar colloids 2 explore the mechanism of kinetic sorption affecting the transport of biochar colloids in the presence of pahs over time under saturated flow conditions 2 materials and methods 2 1 biochar colloids biochar was produced by filling wheat straw zhengzhou henan province china into a stainless steel tank in a muffle furnace chamber purged with nitrogen the temperature was increased by 20 c min 1 and maintained at 600 c for 1 h yang et al 2017a yang et al 2019a biochar colloids were obtained by repeated ball milling until the particle size was less than 500 nm the grounded biochar powder was suspended in ultrapure water at a concentration of 50 mg l 1 and then sonicated for 10 min before use the hydrodynamic diameter distribution of biochar colloidal suspensions was determined through dynamic light scattering dls method using a zetasizer nano zs90 malvern uk the particle size and morphology of the grounded biochar colloids were measured by scanning electron microscope sem nova nanosem430 fei usa the surface area and pore size distribution of the biochar colloids were characterized by the brunauer emmett teller bet and barrett joyner halenda bjh methods asap2020 micromeritics instrument usa the elemental content ash content static contact angles and functional groups of this biochar were reported previously yang et al 2017a yang et al 2017b yang et al 2019a yang et al 2020 the elemental composition of biochar colloids was also analyzed by x ray photoelectron spectroscopy xps escalab 250xi thermo fisher scientific usa and the xps spectra were deconvoluted using a gaussian lorentzian curve fitting program xpspeak 4 1 2 2 naphthalene and phenanthrene nap 99 585711 j k scientific ltd beijing china and phe 98 24898161 sigma aldrich us stock solutions with the concentration of 1 g l 1 were prepared with 99 5 ethanol yang et al 2017a yang et al 2017b pahs stock solutions were placed in a 10 ml amber glass vial with a teflon lined screw cap at 4 c in the dark and filled to the top to avoid the volatilization of pahs and ethanol 2 3 adsorption and desorption experiments the adsorption and desorption experiments were carried out in 20 ml amber glass vials with teflon lined caps sorption experiments were conducted using 500 mg l 1 biochar and nap phe with different concentrations 1 12 mg l 1 in 1 mm nacl solution ph 7 for 24 h shaking for kinetic sorption experiments the initial concentrations for nap and phe were fixed at 3 and 10 mg l 1 respectively the suspensions were shaken for different periods from 0 017 h to 168 h every sample in the sorption experiments was repeated in triplicate after adsorption the suspensions were filtrated through 0 1 μm ptfe membranes jvwp04700 milliporesigma us to separate biochar and non sorbed pahs in the suspension the nap filtrates were measured by uv vis spectrophotometry tu 1900 persee china at a wavelength of 220 nm yang et al 2019a and the phe concentrations were measured by fluorescence spectrophotometry f97pro lengguang technology china at 275 nm excitation and 366 nm emission wavelengths the calibration curves of nap and phe are provided in fig s1 the adsorption isotherms were analyzed with langmuir and freundlich models the kinetic experiments were analyzed with pseudo first order pseudo second order and intraparticle diffusion kinetic models in section s1 of the supporting information si in the desorption experiments section s2 in si the pahs sorbed biochars were added into 20 ml of 99 5 ethyl acetate and then ultrasonicated for 2 5 min de jesus et al 2017 the obtained samples were filtered again and the nap phe concentration in the solution was diluted and measured as described as above the samples in the desorption experiments were measured in duplicate 2 4 characterization of pahs sorbed biochar colloids nap or phe stock solution 8 μl was spiked into the 20 mg l 1 biochar colloidal suspension in 200 ml amber glass vials with a teflon screw cap the glass vials were orbitally shaken at 120 rpm for different contact time between biochar colloids and pahs from 0 017 h 1 min to 168 h after shaking the biochar suspensions were sonicated in a bath sonicator for 30 s the zeta potentials ζ and hydrodynamic diameters of these biochar colloidal suspensions were measured with at least three independent measurements using a zetasizer the surface functional groups of biochar colloids were characterized by attenuated total internal reflectance fourier transform infrared atr ftir spectroscopy vertex 70 bruker germany and more details are given in section s3 si 2 5 transport experiments transport experiments were carried out in a stainless steel column with a diameter of 2 5 cm and a length of 12 cm which was wet packed with quartz sand 425 to 600 μm the sand was cleaned by stirring in 2 m hcl for 24 h at 90 c and thoroughly rinsed with ultrapure water before use sharma et al 2008 the bulk densities of the packed columns ranged from 1 38 to 1 42 g cm 3 to determine the ζ potential of the quartz sand the sand was ground into powder and then suspended in 1 mm nacl solution after 2 hour sedimentation the suspended colloidal sand particles were used for ζ potential measurements transport experiments were conducted using a peristaltic pump to supply suspensions from bottom to top at a constant pore water velocity of 0 44 cm min 1 the column was initially equilibrated by injecting 5 pore volumes pv of 1 mm nacl background solution followed by 3 pvs of biochar colloid suspensions in the presence of pahs the biochar colloid suspensions 50 mg l 1 with 0 1 mg l 1 nap or phe at different contact time 0 017 24 96 and 168 h between biochar colloids were prepared in 1 mm nacl solution then several pvs of biochar free background solutions were introduced into the column until no biochar could be detected in the effluent the effluent was collected every 5 min using a fraction collector bsz 100 huxi china and the biochar concentrations in the effluent were measured using a uv vis spectrophotometer at a wavelength of 790 nm all the column experiments were conducted in duplicate after transport experiments the concentration of the biochar colloids in each column was determined by dividing the sand column into twelve increments and the divided sands were then transferred into 50 ml conical flasks with 20 ml of ultrapure water and shaken at room temperature for 4 h to detach biochar colloids from the sand surface the concentration of the biochar colloids in the suspensions was then measured by uv vis spectrophotometry the one dimensional colloid transport model using the convective dispersive equation with two kinetic retention sites in the hydrus 1d software šimunek et al 1998 bradford et al 2003 was used to simulate the transport and retention of biochar colloids in the porous media section s4 in si 2 6 xdlvo theory according to the extended derjaguin landau verwey overbeek xdlvo theory the interaction between biochar colloids and sand surface φ total can be calculated as the sum of the van der waals interaction φ lw the electrostatic double layer interaction φ edl and the acid base interactions φ ab the detailed interaction calculations can be found in our previous study yang et al 2017b because the surface area of biochar which was shielded by nap or phe was very small compared with the whole surface the effect of pahs on the hamaker constant and hydrophobicity of biochar colloids was negligible in the presence of pahs the change of φ total mainly came from the φ edl which was calculated by the zeta potentials of biochar colloids and sand in different experimental conditions 2 7 experimental attachment efficiency of biochar colloids to quartz sand to quantitatively interpret the effect of pahs sorption kinetics on the transport of biochar colloids the experimental attachment efficiency α was calculated by the ratio of the rate of colloid deposition on a collector to the rate of collisions with that collector lecoanet and wiesner 2004 1 α 2 3 d c 1 ε l η 0 ln c c 0 where dc is the diameter of the quartz sand ε is the porosity of the packed sand l is the length of the column c c 0 is the ratio of colloids concentration in the effluent to that in the influent and can be obtained from the plateau of breakthrough curves η 0 is the single collector efficiency detailed calculation information can be found in section s5 si 3 results and discussion 3 1 properties of biochar and biochar colloids the physicochemical characteristics of the biochar are summarized in table 1 the c1s xps spectrum fig s2 was deconvoluted into four peaks including c c c h aromatic c 284 8 ev c o of phenolic hydroxyl or ether group 286 2 ev co of ketone group 287 3 ev and coo of the carboxylic group 289 0 ev jin et al 2017 liu et al 2017 luo et al 2017 which was in good agreement with the analysis of the ftir spectra table 1 fig 1 a biochar contained alkyl groups and aromatic c contributing to the hydrophobicity of biochar surface kinney et al 2012 liao et al 2012 for high temperature biochar 500 700 c high aromaticity may be linked to strong pahs sorption affinity because of large electron accepting capacity xiao et al 2014 the presence of the o containing functional groups resulted in a negative surface charge of the biochar in suspensions under ph 4 conditions yang et al 2019b so the isoelectric points iep of biochars in solution were often less than 4 liu et al 2016 batista et al 2018 song et al 2019 according to sem analysis the biochar colloids showed an irregular granular shape fig 1b and the hydrodynamic particle size distribution of the colloids ranged from 255 to 615 nm and the mean size was 422 82 nm fig s3 the pore volume of the biochar colloids was 0 04 cm3 g 1 and the average pore diameter was 5 9 nm table 1 the pore volumes of wheat straw biochar 600 c in literature ranged from 0 0092 to 0 11 cm3 g 1 tang et al 2015 břendová et al 2017 leng et al 2021 the difference in the pore volumes of biochar might be caused by different pyrolysis procedures of biochar production the pore size distribution analysis showed a peak at a diameter of about 1 7 1 9 nm and a tail after 10 nm fig s4 this pore size distribution indicated that there were a large number of micropores and mesopores on the biochar in which the micropores were dominant 3 2 kinetic adsorption and desorption of pahs on biochar the adsorption isotherms of nap and phe on biochar were well fitted by the langmuir and freundlich models fig 2 table s2 the adsorption isotherms were nonlinear indicating that there were heterogeneous and limited sorption sites on biochar surfaces the value of 1 n in the freundlich isotherm was between 0 1 and 0 5 demonstrating that the adsorption of pahs on biochar was favorable liu et al 2016 according to the langmuir model the maximum adsorption capacities of biochar for nap and phe were 5 89 and 19 18 mg g 1 respectively which meant that the biochar showed a stronger sorption affinity for phe oleszczuk et al 2012 and chan et al 2020 also found that phe adsorption by biochar in drinking water and sewage sludge was higher than that of nap the reason might be that more phe could be sorbed onto biochar due to strong π donor interaction than nap zhu and pignatello 2005 the stronger adsorption affinity for phe than for nap had also been found in other materials such as activated carbons bu et al 2011 yakout et al 2013 xiao et al 2015 eeshwarasinghe et al 2018 graphene and graphene oxide nanosheets wang et al 2014 and organoclay yin et al 2019 sorption kinetics of both nap and phe onto biochar showed rapid initial sorption followed by slow sorption fig s5 compared with the pseudo first order model the pseudo second order model shows a better regression fitting table s3 and similar findings have been reported in the previous studies tang et al 2015 zhang et al 2015 liu et al 2017 qiao et al 2018 the theoretical q e values obtained from the pseudo second order model are similar to the q m values based on langmuir models table s2 according to the simulation results using the intraparticle diffusion model eq s5 si pahs adsorption on biochar could be divided into three stages and the sorption data were well fitted in each stage fig 3 a and table s3 the first stage 0 0 17 h for nap and 0 4 h for phe represented the rapid sorption of pahs onto the external surfaces of biochar the second stage 0 17 100 h for nap and 4 120 h for phe was characterized by both pahs adsorption onto external biochar surfaces and externally sorbed pahs diffusion into biochar micropores wang et al 2017a zhu et al 2018 in the third stage 100 168 h for nap and 120 168 h for phe the sorption was dominated by pahs intraparticle diffusion and the sorption finally obtained equilibrium at 168 h the sorption of other organic chemicals such as methylene blue tetracycline doxycycline and ciprofloxacin wang et al 2018 que et al 2018 zeng et al 2018 onto biochar also showed similar three stage sorption kinetic characteristics the mechanisms of controlling pahs sorption on biochar could be attributed to π π electron donor acceptor interaction and pore filling cornelissen and gustafsson 2005 wang et al 2016 guo et al 2017 wang et al 2017a the desorption of pahs from biochar varied as a function of sorption time fig 3b after 96 h of adsorption most of the nap and phe about 87 and 93 respectively could be desorbed because most of the pahs were sorbed onto the external surface of biochar particles and only a small amount of pahs was retained in the internal pores of biochar particles however at 168 h contact time only 57 of nap and 69 of phe could be desorbed suggesting that the pahs could not be easily desorbed from biochar after pahs diffused into biochar internal pores pahs slow desorption from the biochar and other carbonaceous materials were highly related to intraparticle sorption yang et al 2008 kang et al 2019 sigmund et al 2017 found that pahs could diffuse into the small pores of the biochar leading to less accessibility for pahs degradation liu et al 2019 also showed that the desorbed lincomycin from biochar pyrolyzed from rice hull bedding at 600 c was decreased from 62 4 to 8 8 as sorption time increased from 1 to 30 d 3 3 effect of kinetic sorption on surface properties of biochar colloids the ζ potential and hydrodynamic diameter of the biochar colloids in the absence of pahs were around 44 6 1 2 mv and 422 12 nm and remained constant within 168 h fig 4 after the immediate sorption 0 017 h of nap phe onto biochar colloids i e pahs were mixed and shaken with biochar colloidal suspension for 0 017 h the ζ potentials of the biochar colloids in the presence of pahs were 43 8 1 2 mv for nap and 42 0 0 3 mv for phe respectively this was because after pahs were added into biochar colloid suspension a small amount of pahs adsorbed on the external surface of the colloids immediately and shielded the parts of the negative surface charge yang et al 2017a yang et al 2017b compared with nap the charge shielding effect was more pronounced for phe because phe was strongly adsorbed by biochar fig 2 with the increase of contact time between biochar colloids and pahs from 0 017 h to 120 h more pahs were sorbed onto biochar colloids and the ζ potential of biochar colloids in the presence of pahs decreased to 31 8 4 1 mv for nap and 28 5 1 0 mv for phe as the contact time increased from 120 h to 168 h the ζ potential of biochar colloids in the presence of pahs decreased over time 36 9 0 4 mv for nap and 32 6 2 8 mv for phe at 168 h the reason might be that less un sorbed pahs in the solution can be sorbed onto biochar surface at 168 h and the pahs which were sorbed to the external surface of biochar diffused into the intraparticle pores of biochar wang et al 2017a zhu et al 2018 this caused some negatively charged external surfaces of the biochar colloids to re appear which were previously shielded by pahs the hydrodynamic diameter of biochar colloids was not affected by sorption which meant that pahs sorption had no effect on the aggregation of biochar colloids in this case our results showed that after pahs were added into biochar colloidal suspension the hydrodynamic diameter of biochar colloids was almost constant and the negative surface charge changed with the pahs sorption on biochar over time due to charge shielding effect and intrapore diffusion the atr ftir spectra of the biochar colloids in the presence of pahs at different contact time periods also showed that the surface functional groups of biochar colloids changed with sorption kinetics fig 5 after pahs were sorbed to the colloids the peaks around 1530 cm 1 cc stretching of aromatic skeletal c and 800 600 cm 1 aromatic c h wagging vibrations increased jia et al 2018 zhang et al 2018 and the carboxylic peaks including1667 cm 1 of aliphatic co and 1336 cm 1 of carboxylic oh decreased chen et al 2008 gray et al 2014 indicating pahs were sorbed onto the surface of biochar and shielded parts of the o containing functional groups the effect of pahs sorption on the biochar functional groups increased with increasing contact time from 0 017 h to 96 h as the contact time increased from 96 h to 168 h the absorbance of all the functional groups on pahs sorbed biochar decreased due to the intraparticle diffusion of pahs on the biochar 3 4 effect of kinetic adsorption on biochar colloid transport the breakthrough curves and retention profiles of the biochar colloids in the presence of pahs at different contact time periods are shown in fig 6 and the parameters of each column are listed in table s4 the breakthrough curves showed the normalized biochar colloid concentration c c 0 in the effluent as a function of the pore volume the experimental attachment efficiencies α were calculated from the breakthrough curves of biochar colloids using eq 1 the retention profile showed the ratio n n i of retained biochar colloids quality on the sand surface n to the quality of biochar colloids injected to the column n i as a function of dimensionless distance from the column inlet once 0 1 mg l 1 nap or phe was mixed with the biochar suspension for 0 017 h the c c 0 at the plateau of the breakthrough curves of biochar colloids decreased from 0 57 to 0 48 or 0 46 and the retained percentage of colloids in the column increased from 39 to 45 or 48 respectively figs s6 6 and table s4 our previous studies also showed that the mobility of biochar colloids was inhibited with increasing nap concentration yang et al 2017a yang et al 2017b this was because the sorbed nap or phe shielded the negative surface charge on the biochar colloids table 2 leading to a reduced electrostatic double layer repulsion between biochar colloids and sand surface at different contact time between pahs and biochar colloids the breakthrough curves of biochar colloids showed different plateaus fig 6a and b the shaking time of bare biochar colloidal suspensions had no effect on biochar colloid transport in saturated sand column fig s6 with the contact time between biochar colloids and pahs increasing from 0 017 h to 24 h and then to 96 h the decrease of m eff and the increase of the m ret shown in table s4 indicated that less biochar colloids were found in the effluents and more colloids were retained in porous media as more nap or phe adsorbed over time the biochar colloids showed less negative surface charge fig 4a the less negative ζ potentials resulted in a smaller primary energy barrier and a deeper secondary energy minimum between biochar colloids and quartz sand fig s7 table 2 which led to more colloid attachment on sand surfaces however when the contact time reached 168 h the mobility of biochar colloids increased again and fewer colloids were retained on the surface of the porous media fig 6 and table s4 to exhibit the effect of pahs sorption kinetics on the mobility of biochar colloids in porous media directly the α values of biochar colloids at different contact time periods were calculated based on the c c0 of the breakthrough curves fig 7 as the contact time increased from 0 017 h to 96 h the α values of biochar colloids were increased about 25 for nap and 34 for phe when the contact time increased to 168 h the α values of biochar colloids in the presence of pahs decreased the breakthrough curves and retention profiles of biochar colloids in the presence of pahs could be well simulated by the two site kinetic retention model table s5 the values of the first order attachment coefficient k 1 on reversible kinetic retention site site 1 became larger as pahs sorbed onto biochar colloids and increased with increasing contact time from 0 017 h to 96 h but decreased during 96 168 h this indicated that the increase in pahs sorbing onto the external surface of biochar resulted in an increase of colloid retention the values of the first order detachment coefficient k 1d on site 1 were one order of magnitude smaller than the attachment coefficient k 1 the values of the first order attachment coefficients k 2 on the irreversible kinetic retention site site 2 were similar in every column experiment implying that the retention of colloids on site 2 was mainly caused by colloid straining rather than attachment therefore the impact of pahs on the deposition of biochar colloid on quartz sand mainly occurred on the reversible kinetic retention site nonpolar nap and phe can be effectively sorbed onto biochar surface through π π electron donor acceptor interactions the pahs can sorb on both the external and internal surfaces of the biochar and the external sorption is fast followed by a rate limited intraparticle diffusion li et al 2014 wang et al 2017a zhu et al 2018 as intraparticle diffusion plays the dominant role the externally sorbed pahs on the outer biochar surface decreased with contact time fig 8 at this stage the sorption of pahs on biochar changed the surface charge non monotonically and the mobility of biochar colloids was consequently affected to prove the effect of pahs kinetic sorption on the mobility of biochar colloids similar transport experiments were conducted in another rough sand figs s8 s9 which confirmed that the mobility of biochar colloids was affected by pahs kinetic sorption the xdlvo energies between sand and biochar colloids and the fitted parameters of breakthrough curves are listed in tables s6 s8 the breakthrough curves in fig s9 show more pronounced attachment and straining because the rough surface of the quartz sand provided more attachment sites for biochar colloid retention the same non monotonic retention behavior of biochar colloids as a function of pahs sorption time was similar to the case in the smooth quartz sand fig 6c and d 4 conclusion biochar strongly adsorbs organic contaminants and shows a broad potential for the remediation of soils contaminated by organic compounds after being applied to the field biochar can be broken down into nano sized and colloidal particles due to physical chemical and biological aging nano sized and colloidal biochar might leach down with irrigation and rainfall from topsoil to subsoil because biochar can strongly adsorb organic contaminants nano sized and colloidal biochar might facilitate the migration of organic pollutants in the polluted soil and exhibit long term environmental risk for groundwater in addition to biochar other porous adsorbent materials such as activated carbon and fullerene can effectively sequestrate contaminants from the environment our study indicated that the fate and mobility of porous colloids and nanoparticles might be affected by kinetic sorption of organic pollutants due to their large internal pores to estimate the environmental fate of porous colloids and nanoparticles in pahs polluted soil or groundwater it is vital to consider the impact of pahs sorption kinetics on the fate and transport of porous colloids and nanoparticles credit authorship contribution statement wen yang conceptualization methodology software validation formal analysis investigation resources writing original draft writing review editing visualization ting qu validation investigation markus flury writing review editing xin zhang validation investigation sigmund gabriel writing review editing jianying shang conceptualization methodology writing original draft writing review editing supervision project administration funding acquisition baoguo li writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was supported by the national natural science foundation of china 41771255 the usda nifa hatch project 1014527 the national key research and development program 2017yfd0801503 and the 1000 talents plan for young researchers appendix a supplementary data details about the sorption models pahs sorbed biochar preparation single collector efficiency sem images and atr ftir spectra of the biochar colloids and xdlvo interaction between the colloids and sand supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 126839 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
4110,biochar is an efficient sorbent for polycyclic aromatic hydrocarbons pahs however little is known about pahs sorption kinetics and the effect on the mobility of biochar colloids in saturated porous media in this study naphthalene nap and phenanthrene phe were chosen as typical pahs in different stages different sorption sites of pahs on biochar played a distinct role in affecting the transport of biochar colloids in saturated porous media the biochar colloids showed less negative surface charge as the contact time between biochar colloids and pahs increased from 0 017 h to 96 h which led to the mobility of biochar colloids decreasing over time but after 168 h contact time the surface charge of biochar colloids became more negative again and the inhibition effect of pahs on biochar colloid transport was weakened this was related to the sorption kinetics of pahs on biochar colloids 1 pahs sorption onto outer biochar surface and 2 adsorbed pahs diffusion into internal biochar pores pahs sorption onto the outer biochar surface shielded the negative surface charge and then decreased the mobility of biochar colloids and then the adsorbed pahs diffusion into internal biochar pores increased their mobility again our results suggested that porous colloids facilitated pahs transport in porous media might be highly related to interaction time between pahs and porous colloids keywords biochar colloids transport kinetic sorption naphthalene phenanthrene 1 introduction polycyclic aromatic hydrocarbons pahs are a ubiquitous group of organic contaminants which consist of multiple aromatic rings and are produced by the incomplete combustion of carbon containing materials naphthalene nap and phenanthrene phe are two typical pahs soltani et al 2015 li et al 2019 the content of pahs in aquatic soil and sedimentary environments is increasing due to human activities because of their strong aromaticity and high hydrophobicity pahs mainly sorb onto geo sorbents i e soil sediment and black carbon cornelissen et al 2006 an et al 2017 the hydrophobicity of pahs increases with the number of aromatic rings han et al 2014 yang et al 2018 zhu et al 2018 due to their high carcinogenicity bioaccumulation and poor degradation in the environment pahs have been listed as priority pollutants by the united states environmental protection agency usepa zhu et al 2018 ye et al 2019 biochar was considered as an adsorbent for pahs because of its high aromaticity rich porous structure and high specific surface area wang et al 2006 chen et al 2008 yargicoglu et al 2015 wang et al 2017a the immobilization of pahs by biochar decreases their bioavailability beesley et al 2010 khan et al 2015 besides biochar enhances pahs degradation by increasing microbial activity anyika et al 2015 rein et al 2016 sigmund et al 2018 yang et al 2018 therefore biochar can be used as a remediation agent in pahs contaminated soil anyika et al 2015 biochar produced by high temperature pyrolysis 400 c has more condensed aromatic clusters and shows a strong affinity for pahs through π π electron donor acceptor interaction zhu and pignatello 2005 wang et al 2016 wang et al 2017a high temperature biochar generally has a large porosity with well developed nano or micro pores which are accessible for sorption of low molecular weight pahs lmw pahs chen et al 2012 thus pore filling is one of the dominant mechanisms for lmw pahs sorption on biochar chen et al 2008 biochar can be used as a passivant to remediate pahs contaminated soil biochar in the soil is always subject to aging mia et al 2017 physical aging is the most critical degradation pathway for biochar spokas et al 2014 which leads to biochar breakdown byrne and nagle 1997 gao and wu 2014 and become micro and nano sized fragments wang et al 2013a which was called as biochar colloids these biochar colloids can vertically migrate through the soil profile with flowing water obia et al 2017 in recent years a few studies in the laboratory focused on the movement of biochar colloids in saturated sand columns zhang et al 2010 wang et al 2013a wang et al 2013b yang et al 2017a yang et al 2019a feedstock pyrolysis temperature and particle size of biochar as well as ionic strength and ph conditions of background solution highly affect the transport of biochar colloids in saturated porous media zhang et al 2010 wang et al 2013a wang et al 2013b moreover organic compounds have a distinct influence on the transport of biochar colloids in saturated porous media wang et al 2013b yang et al 2017a yang et al 2019a because of the strong affinity of biochar for organic pollutants chen et al 2008 liu et al 2017 biochar colloids may serve as a carrier for the organic contaminants facilitate their transport and induce secondary pollution in the environment zhang et al 2010 the presence of nap could reduce the transport of biochar colloids because nap was strongly sorbed to biochar and reduced the negative surface charge of the biochar colloids through charge shielding yang et al 2017a yang et al 2017b castan et al 2019 sulfamethazine an antibiotic could decrease the mobility of biochar colloids in quartz sand column under acidic and neutral ph conditions and increase their mobility under alkaline conditions since sulfamethazine sorption changed the surface properties of biochar colloids yang et al 2020 hameed et al 2021 have demonstrated that the mobilities of three typical organic contaminants phe atrazine and oxytetracycline were very low but significantly increased by their co transport with biochar colloids in the soil column this suggested that the sorption process of organic contaminants on biochar colloids played an important role in the mobility and fate of biochar colloids in pahs polluted soil the adsorption of pahs on biochar is a dynamic process previous studies have shown that rapid sorption occurs at the beginning of the interaction between biochar and pahs in solution conditions and slow adsorption is followed which is limited by diffusion of lmw pahs into the internal pores of biochar chen et al 2012 liu et al 2017 for pahs adsorption on biochar the time to reach the equilibrium of pahs to biochar can range from hours 4 7 h for nap to days 1 18 days for phe chen et al 2012 yakout et al 2013 kang et al 2017 for most antibiotics like lincomycin liu et al 2016 sulfamethoxazole lian et al 2014 tetracycline wang et al 2017b and ciprofloxacin shang et al 2016 sorption equilibration time with biochar also varied from hours to days in some experiments pore diffusion could not be estimated due to short period in this study the effect of pahs sorption kinetics on the transport of biochar colloids in saturated sand columns was investigated two typical pahs nap and phe were selected in our study due to their common presence in the polluted soil and wastewater cao et al 2019 wu et al 2019 the adsorption and desorption characteristics of pahs on biochar were quantified using batch experiments to estimate the surface property change of biochar colloids with pahs sorption kinetics over time the electrophoretic mobility and infra red spectrum characteristics of biochar colloids were measured at different contact time between biochar and pahs column experiments were carried out to assess the mobility of biochar colloids in the presence of pahs during different kinetic sorption stages the objectives of this study were to 1 study the influence of pahs sorption kinetics on the surface physicochemical properties of biochar colloids 2 explore the mechanism of kinetic sorption affecting the transport of biochar colloids in the presence of pahs over time under saturated flow conditions 2 materials and methods 2 1 biochar colloids biochar was produced by filling wheat straw zhengzhou henan province china into a stainless steel tank in a muffle furnace chamber purged with nitrogen the temperature was increased by 20 c min 1 and maintained at 600 c for 1 h yang et al 2017a yang et al 2019a biochar colloids were obtained by repeated ball milling until the particle size was less than 500 nm the grounded biochar powder was suspended in ultrapure water at a concentration of 50 mg l 1 and then sonicated for 10 min before use the hydrodynamic diameter distribution of biochar colloidal suspensions was determined through dynamic light scattering dls method using a zetasizer nano zs90 malvern uk the particle size and morphology of the grounded biochar colloids were measured by scanning electron microscope sem nova nanosem430 fei usa the surface area and pore size distribution of the biochar colloids were characterized by the brunauer emmett teller bet and barrett joyner halenda bjh methods asap2020 micromeritics instrument usa the elemental content ash content static contact angles and functional groups of this biochar were reported previously yang et al 2017a yang et al 2017b yang et al 2019a yang et al 2020 the elemental composition of biochar colloids was also analyzed by x ray photoelectron spectroscopy xps escalab 250xi thermo fisher scientific usa and the xps spectra were deconvoluted using a gaussian lorentzian curve fitting program xpspeak 4 1 2 2 naphthalene and phenanthrene nap 99 585711 j k scientific ltd beijing china and phe 98 24898161 sigma aldrich us stock solutions with the concentration of 1 g l 1 were prepared with 99 5 ethanol yang et al 2017a yang et al 2017b pahs stock solutions were placed in a 10 ml amber glass vial with a teflon lined screw cap at 4 c in the dark and filled to the top to avoid the volatilization of pahs and ethanol 2 3 adsorption and desorption experiments the adsorption and desorption experiments were carried out in 20 ml amber glass vials with teflon lined caps sorption experiments were conducted using 500 mg l 1 biochar and nap phe with different concentrations 1 12 mg l 1 in 1 mm nacl solution ph 7 for 24 h shaking for kinetic sorption experiments the initial concentrations for nap and phe were fixed at 3 and 10 mg l 1 respectively the suspensions were shaken for different periods from 0 017 h to 168 h every sample in the sorption experiments was repeated in triplicate after adsorption the suspensions were filtrated through 0 1 μm ptfe membranes jvwp04700 milliporesigma us to separate biochar and non sorbed pahs in the suspension the nap filtrates were measured by uv vis spectrophotometry tu 1900 persee china at a wavelength of 220 nm yang et al 2019a and the phe concentrations were measured by fluorescence spectrophotometry f97pro lengguang technology china at 275 nm excitation and 366 nm emission wavelengths the calibration curves of nap and phe are provided in fig s1 the adsorption isotherms were analyzed with langmuir and freundlich models the kinetic experiments were analyzed with pseudo first order pseudo second order and intraparticle diffusion kinetic models in section s1 of the supporting information si in the desorption experiments section s2 in si the pahs sorbed biochars were added into 20 ml of 99 5 ethyl acetate and then ultrasonicated for 2 5 min de jesus et al 2017 the obtained samples were filtered again and the nap phe concentration in the solution was diluted and measured as described as above the samples in the desorption experiments were measured in duplicate 2 4 characterization of pahs sorbed biochar colloids nap or phe stock solution 8 μl was spiked into the 20 mg l 1 biochar colloidal suspension in 200 ml amber glass vials with a teflon screw cap the glass vials were orbitally shaken at 120 rpm for different contact time between biochar colloids and pahs from 0 017 h 1 min to 168 h after shaking the biochar suspensions were sonicated in a bath sonicator for 30 s the zeta potentials ζ and hydrodynamic diameters of these biochar colloidal suspensions were measured with at least three independent measurements using a zetasizer the surface functional groups of biochar colloids were characterized by attenuated total internal reflectance fourier transform infrared atr ftir spectroscopy vertex 70 bruker germany and more details are given in section s3 si 2 5 transport experiments transport experiments were carried out in a stainless steel column with a diameter of 2 5 cm and a length of 12 cm which was wet packed with quartz sand 425 to 600 μm the sand was cleaned by stirring in 2 m hcl for 24 h at 90 c and thoroughly rinsed with ultrapure water before use sharma et al 2008 the bulk densities of the packed columns ranged from 1 38 to 1 42 g cm 3 to determine the ζ potential of the quartz sand the sand was ground into powder and then suspended in 1 mm nacl solution after 2 hour sedimentation the suspended colloidal sand particles were used for ζ potential measurements transport experiments were conducted using a peristaltic pump to supply suspensions from bottom to top at a constant pore water velocity of 0 44 cm min 1 the column was initially equilibrated by injecting 5 pore volumes pv of 1 mm nacl background solution followed by 3 pvs of biochar colloid suspensions in the presence of pahs the biochar colloid suspensions 50 mg l 1 with 0 1 mg l 1 nap or phe at different contact time 0 017 24 96 and 168 h between biochar colloids were prepared in 1 mm nacl solution then several pvs of biochar free background solutions were introduced into the column until no biochar could be detected in the effluent the effluent was collected every 5 min using a fraction collector bsz 100 huxi china and the biochar concentrations in the effluent were measured using a uv vis spectrophotometer at a wavelength of 790 nm all the column experiments were conducted in duplicate after transport experiments the concentration of the biochar colloids in each column was determined by dividing the sand column into twelve increments and the divided sands were then transferred into 50 ml conical flasks with 20 ml of ultrapure water and shaken at room temperature for 4 h to detach biochar colloids from the sand surface the concentration of the biochar colloids in the suspensions was then measured by uv vis spectrophotometry the one dimensional colloid transport model using the convective dispersive equation with two kinetic retention sites in the hydrus 1d software šimunek et al 1998 bradford et al 2003 was used to simulate the transport and retention of biochar colloids in the porous media section s4 in si 2 6 xdlvo theory according to the extended derjaguin landau verwey overbeek xdlvo theory the interaction between biochar colloids and sand surface φ total can be calculated as the sum of the van der waals interaction φ lw the electrostatic double layer interaction φ edl and the acid base interactions φ ab the detailed interaction calculations can be found in our previous study yang et al 2017b because the surface area of biochar which was shielded by nap or phe was very small compared with the whole surface the effect of pahs on the hamaker constant and hydrophobicity of biochar colloids was negligible in the presence of pahs the change of φ total mainly came from the φ edl which was calculated by the zeta potentials of biochar colloids and sand in different experimental conditions 2 7 experimental attachment efficiency of biochar colloids to quartz sand to quantitatively interpret the effect of pahs sorption kinetics on the transport of biochar colloids the experimental attachment efficiency α was calculated by the ratio of the rate of colloid deposition on a collector to the rate of collisions with that collector lecoanet and wiesner 2004 1 α 2 3 d c 1 ε l η 0 ln c c 0 where dc is the diameter of the quartz sand ε is the porosity of the packed sand l is the length of the column c c 0 is the ratio of colloids concentration in the effluent to that in the influent and can be obtained from the plateau of breakthrough curves η 0 is the single collector efficiency detailed calculation information can be found in section s5 si 3 results and discussion 3 1 properties of biochar and biochar colloids the physicochemical characteristics of the biochar are summarized in table 1 the c1s xps spectrum fig s2 was deconvoluted into four peaks including c c c h aromatic c 284 8 ev c o of phenolic hydroxyl or ether group 286 2 ev co of ketone group 287 3 ev and coo of the carboxylic group 289 0 ev jin et al 2017 liu et al 2017 luo et al 2017 which was in good agreement with the analysis of the ftir spectra table 1 fig 1 a biochar contained alkyl groups and aromatic c contributing to the hydrophobicity of biochar surface kinney et al 2012 liao et al 2012 for high temperature biochar 500 700 c high aromaticity may be linked to strong pahs sorption affinity because of large electron accepting capacity xiao et al 2014 the presence of the o containing functional groups resulted in a negative surface charge of the biochar in suspensions under ph 4 conditions yang et al 2019b so the isoelectric points iep of biochars in solution were often less than 4 liu et al 2016 batista et al 2018 song et al 2019 according to sem analysis the biochar colloids showed an irregular granular shape fig 1b and the hydrodynamic particle size distribution of the colloids ranged from 255 to 615 nm and the mean size was 422 82 nm fig s3 the pore volume of the biochar colloids was 0 04 cm3 g 1 and the average pore diameter was 5 9 nm table 1 the pore volumes of wheat straw biochar 600 c in literature ranged from 0 0092 to 0 11 cm3 g 1 tang et al 2015 břendová et al 2017 leng et al 2021 the difference in the pore volumes of biochar might be caused by different pyrolysis procedures of biochar production the pore size distribution analysis showed a peak at a diameter of about 1 7 1 9 nm and a tail after 10 nm fig s4 this pore size distribution indicated that there were a large number of micropores and mesopores on the biochar in which the micropores were dominant 3 2 kinetic adsorption and desorption of pahs on biochar the adsorption isotherms of nap and phe on biochar were well fitted by the langmuir and freundlich models fig 2 table s2 the adsorption isotherms were nonlinear indicating that there were heterogeneous and limited sorption sites on biochar surfaces the value of 1 n in the freundlich isotherm was between 0 1 and 0 5 demonstrating that the adsorption of pahs on biochar was favorable liu et al 2016 according to the langmuir model the maximum adsorption capacities of biochar for nap and phe were 5 89 and 19 18 mg g 1 respectively which meant that the biochar showed a stronger sorption affinity for phe oleszczuk et al 2012 and chan et al 2020 also found that phe adsorption by biochar in drinking water and sewage sludge was higher than that of nap the reason might be that more phe could be sorbed onto biochar due to strong π donor interaction than nap zhu and pignatello 2005 the stronger adsorption affinity for phe than for nap had also been found in other materials such as activated carbons bu et al 2011 yakout et al 2013 xiao et al 2015 eeshwarasinghe et al 2018 graphene and graphene oxide nanosheets wang et al 2014 and organoclay yin et al 2019 sorption kinetics of both nap and phe onto biochar showed rapid initial sorption followed by slow sorption fig s5 compared with the pseudo first order model the pseudo second order model shows a better regression fitting table s3 and similar findings have been reported in the previous studies tang et al 2015 zhang et al 2015 liu et al 2017 qiao et al 2018 the theoretical q e values obtained from the pseudo second order model are similar to the q m values based on langmuir models table s2 according to the simulation results using the intraparticle diffusion model eq s5 si pahs adsorption on biochar could be divided into three stages and the sorption data were well fitted in each stage fig 3 a and table s3 the first stage 0 0 17 h for nap and 0 4 h for phe represented the rapid sorption of pahs onto the external surfaces of biochar the second stage 0 17 100 h for nap and 4 120 h for phe was characterized by both pahs adsorption onto external biochar surfaces and externally sorbed pahs diffusion into biochar micropores wang et al 2017a zhu et al 2018 in the third stage 100 168 h for nap and 120 168 h for phe the sorption was dominated by pahs intraparticle diffusion and the sorption finally obtained equilibrium at 168 h the sorption of other organic chemicals such as methylene blue tetracycline doxycycline and ciprofloxacin wang et al 2018 que et al 2018 zeng et al 2018 onto biochar also showed similar three stage sorption kinetic characteristics the mechanisms of controlling pahs sorption on biochar could be attributed to π π electron donor acceptor interaction and pore filling cornelissen and gustafsson 2005 wang et al 2016 guo et al 2017 wang et al 2017a the desorption of pahs from biochar varied as a function of sorption time fig 3b after 96 h of adsorption most of the nap and phe about 87 and 93 respectively could be desorbed because most of the pahs were sorbed onto the external surface of biochar particles and only a small amount of pahs was retained in the internal pores of biochar particles however at 168 h contact time only 57 of nap and 69 of phe could be desorbed suggesting that the pahs could not be easily desorbed from biochar after pahs diffused into biochar internal pores pahs slow desorption from the biochar and other carbonaceous materials were highly related to intraparticle sorption yang et al 2008 kang et al 2019 sigmund et al 2017 found that pahs could diffuse into the small pores of the biochar leading to less accessibility for pahs degradation liu et al 2019 also showed that the desorbed lincomycin from biochar pyrolyzed from rice hull bedding at 600 c was decreased from 62 4 to 8 8 as sorption time increased from 1 to 30 d 3 3 effect of kinetic sorption on surface properties of biochar colloids the ζ potential and hydrodynamic diameter of the biochar colloids in the absence of pahs were around 44 6 1 2 mv and 422 12 nm and remained constant within 168 h fig 4 after the immediate sorption 0 017 h of nap phe onto biochar colloids i e pahs were mixed and shaken with biochar colloidal suspension for 0 017 h the ζ potentials of the biochar colloids in the presence of pahs were 43 8 1 2 mv for nap and 42 0 0 3 mv for phe respectively this was because after pahs were added into biochar colloid suspension a small amount of pahs adsorbed on the external surface of the colloids immediately and shielded the parts of the negative surface charge yang et al 2017a yang et al 2017b compared with nap the charge shielding effect was more pronounced for phe because phe was strongly adsorbed by biochar fig 2 with the increase of contact time between biochar colloids and pahs from 0 017 h to 120 h more pahs were sorbed onto biochar colloids and the ζ potential of biochar colloids in the presence of pahs decreased to 31 8 4 1 mv for nap and 28 5 1 0 mv for phe as the contact time increased from 120 h to 168 h the ζ potential of biochar colloids in the presence of pahs decreased over time 36 9 0 4 mv for nap and 32 6 2 8 mv for phe at 168 h the reason might be that less un sorbed pahs in the solution can be sorbed onto biochar surface at 168 h and the pahs which were sorbed to the external surface of biochar diffused into the intraparticle pores of biochar wang et al 2017a zhu et al 2018 this caused some negatively charged external surfaces of the biochar colloids to re appear which were previously shielded by pahs the hydrodynamic diameter of biochar colloids was not affected by sorption which meant that pahs sorption had no effect on the aggregation of biochar colloids in this case our results showed that after pahs were added into biochar colloidal suspension the hydrodynamic diameter of biochar colloids was almost constant and the negative surface charge changed with the pahs sorption on biochar over time due to charge shielding effect and intrapore diffusion the atr ftir spectra of the biochar colloids in the presence of pahs at different contact time periods also showed that the surface functional groups of biochar colloids changed with sorption kinetics fig 5 after pahs were sorbed to the colloids the peaks around 1530 cm 1 cc stretching of aromatic skeletal c and 800 600 cm 1 aromatic c h wagging vibrations increased jia et al 2018 zhang et al 2018 and the carboxylic peaks including1667 cm 1 of aliphatic co and 1336 cm 1 of carboxylic oh decreased chen et al 2008 gray et al 2014 indicating pahs were sorbed onto the surface of biochar and shielded parts of the o containing functional groups the effect of pahs sorption on the biochar functional groups increased with increasing contact time from 0 017 h to 96 h as the contact time increased from 96 h to 168 h the absorbance of all the functional groups on pahs sorbed biochar decreased due to the intraparticle diffusion of pahs on the biochar 3 4 effect of kinetic adsorption on biochar colloid transport the breakthrough curves and retention profiles of the biochar colloids in the presence of pahs at different contact time periods are shown in fig 6 and the parameters of each column are listed in table s4 the breakthrough curves showed the normalized biochar colloid concentration c c 0 in the effluent as a function of the pore volume the experimental attachment efficiencies α were calculated from the breakthrough curves of biochar colloids using eq 1 the retention profile showed the ratio n n i of retained biochar colloids quality on the sand surface n to the quality of biochar colloids injected to the column n i as a function of dimensionless distance from the column inlet once 0 1 mg l 1 nap or phe was mixed with the biochar suspension for 0 017 h the c c 0 at the plateau of the breakthrough curves of biochar colloids decreased from 0 57 to 0 48 or 0 46 and the retained percentage of colloids in the column increased from 39 to 45 or 48 respectively figs s6 6 and table s4 our previous studies also showed that the mobility of biochar colloids was inhibited with increasing nap concentration yang et al 2017a yang et al 2017b this was because the sorbed nap or phe shielded the negative surface charge on the biochar colloids table 2 leading to a reduced electrostatic double layer repulsion between biochar colloids and sand surface at different contact time between pahs and biochar colloids the breakthrough curves of biochar colloids showed different plateaus fig 6a and b the shaking time of bare biochar colloidal suspensions had no effect on biochar colloid transport in saturated sand column fig s6 with the contact time between biochar colloids and pahs increasing from 0 017 h to 24 h and then to 96 h the decrease of m eff and the increase of the m ret shown in table s4 indicated that less biochar colloids were found in the effluents and more colloids were retained in porous media as more nap or phe adsorbed over time the biochar colloids showed less negative surface charge fig 4a the less negative ζ potentials resulted in a smaller primary energy barrier and a deeper secondary energy minimum between biochar colloids and quartz sand fig s7 table 2 which led to more colloid attachment on sand surfaces however when the contact time reached 168 h the mobility of biochar colloids increased again and fewer colloids were retained on the surface of the porous media fig 6 and table s4 to exhibit the effect of pahs sorption kinetics on the mobility of biochar colloids in porous media directly the α values of biochar colloids at different contact time periods were calculated based on the c c0 of the breakthrough curves fig 7 as the contact time increased from 0 017 h to 96 h the α values of biochar colloids were increased about 25 for nap and 34 for phe when the contact time increased to 168 h the α values of biochar colloids in the presence of pahs decreased the breakthrough curves and retention profiles of biochar colloids in the presence of pahs could be well simulated by the two site kinetic retention model table s5 the values of the first order attachment coefficient k 1 on reversible kinetic retention site site 1 became larger as pahs sorbed onto biochar colloids and increased with increasing contact time from 0 017 h to 96 h but decreased during 96 168 h this indicated that the increase in pahs sorbing onto the external surface of biochar resulted in an increase of colloid retention the values of the first order detachment coefficient k 1d on site 1 were one order of magnitude smaller than the attachment coefficient k 1 the values of the first order attachment coefficients k 2 on the irreversible kinetic retention site site 2 were similar in every column experiment implying that the retention of colloids on site 2 was mainly caused by colloid straining rather than attachment therefore the impact of pahs on the deposition of biochar colloid on quartz sand mainly occurred on the reversible kinetic retention site nonpolar nap and phe can be effectively sorbed onto biochar surface through π π electron donor acceptor interactions the pahs can sorb on both the external and internal surfaces of the biochar and the external sorption is fast followed by a rate limited intraparticle diffusion li et al 2014 wang et al 2017a zhu et al 2018 as intraparticle diffusion plays the dominant role the externally sorbed pahs on the outer biochar surface decreased with contact time fig 8 at this stage the sorption of pahs on biochar changed the surface charge non monotonically and the mobility of biochar colloids was consequently affected to prove the effect of pahs kinetic sorption on the mobility of biochar colloids similar transport experiments were conducted in another rough sand figs s8 s9 which confirmed that the mobility of biochar colloids was affected by pahs kinetic sorption the xdlvo energies between sand and biochar colloids and the fitted parameters of breakthrough curves are listed in tables s6 s8 the breakthrough curves in fig s9 show more pronounced attachment and straining because the rough surface of the quartz sand provided more attachment sites for biochar colloid retention the same non monotonic retention behavior of biochar colloids as a function of pahs sorption time was similar to the case in the smooth quartz sand fig 6c and d 4 conclusion biochar strongly adsorbs organic contaminants and shows a broad potential for the remediation of soils contaminated by organic compounds after being applied to the field biochar can be broken down into nano sized and colloidal particles due to physical chemical and biological aging nano sized and colloidal biochar might leach down with irrigation and rainfall from topsoil to subsoil because biochar can strongly adsorb organic contaminants nano sized and colloidal biochar might facilitate the migration of organic pollutants in the polluted soil and exhibit long term environmental risk for groundwater in addition to biochar other porous adsorbent materials such as activated carbon and fullerene can effectively sequestrate contaminants from the environment our study indicated that the fate and mobility of porous colloids and nanoparticles might be affected by kinetic sorption of organic pollutants due to their large internal pores to estimate the environmental fate of porous colloids and nanoparticles in pahs polluted soil or groundwater it is vital to consider the impact of pahs sorption kinetics on the fate and transport of porous colloids and nanoparticles credit authorship contribution statement wen yang conceptualization methodology software validation formal analysis investigation resources writing original draft writing review editing visualization ting qu validation investigation markus flury writing review editing xin zhang validation investigation sigmund gabriel writing review editing jianying shang conceptualization methodology writing original draft writing review editing supervision project administration funding acquisition baoguo li writing review editing supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was supported by the national natural science foundation of china 41771255 the usda nifa hatch project 1014527 the national key research and development program 2017yfd0801503 and the 1000 talents plan for young researchers appendix a supplementary data details about the sorption models pahs sorbed biochar preparation single collector efficiency sem images and atr ftir spectra of the biochar colloids and xdlvo interaction between the colloids and sand supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 126839 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
4111,soil water content swc is a vital variable in the hydrological cycle while simulation of it often relies on resolving the soil water flow equation to cope with the unavailability or poor quality of physical models various nonparametric data assimilation da schemes have been established however there tends to be two significant common challenges in such methods 1 the difficulty in capturing locally changing behaviors of time series especially the peaks and troughs and 2 poor statistical interpolation capability in time and space these two challenges are no doubt attributed to the complete renunciation of physical constraints unlike previous physics informed approaches that incorporated physical governing equations and engineering control into the loss functions this study attempts to introduce additional physical constraints from data gradient into the model free da framework as a follow up study of wang et al 2021 a gradient enhanced version of nonparametric da schemes i e ge enkfgp is proposed the temporal daily and spatial vertical gradients of the swc are merged into the construction of the unsaturated flow dynamical models based on the gaussian process gp while the kalman update formulation is used to reconcile real time observations with the aid of a series of real world cases the performance of the ge enkfgp was compared with the original enkfgp and its gradient based version gb enkfgp where the temporal gradients of the swc were used as the proxy for the swc as the gp output the results showed that the enhancement of the gradient information in the ge enkfgp led to a better estimation than the initial enkfgp due to its more accurate identification of multiple local extrema this should be attributed to the mass conservation constraint hidden within the temporal gradients and the implicit constraint of the driving force or upper boundary from the spatial gradients spatial gradients of the swc outperformed temporal ones under various application scenarios the gb enkfgp and ge enkfgp exhibited superior performances in retrieving surface swc than that in the deeper layer hence an enhancement scheme using only the temporal gradients of the surface layer was recommended in the context of spatial extrapolation the assistance of spatial gradients yielded an improved estimate of the deeper swc quite robustly through gp training and assimilation of easy to access surface data however the implementation of the gb enkfgp and temporal gradient enhanced enkfgp i e ge enkfgp t run the risk of triggering a performance collapse due to the delayed response of swc profiles to rainfall events keywords nonparametric data assimilation temporal and spatial gradients soil moisture statistical extrapolation 1 introduction the reconstruction of the spatiotemporal dynamics of soil moisture from noisy or partial observations is a significant issue in unsaturated flow problems variational reichle et al 2001 tian et al 2009 and stochastic data assimilation da shi et al 2015 zhu et al 2017 schemes are the two primary categories of methods considered to address this issue a vital feature of these da schemes is that they rely on repeated forward integrations of an explicitly known dynamical model tandeo et al 2015 when a physical model is available parametric forecasting methods can be used for noise filtering prediction and control of systems however when a physical model is not available or the available models are poor the application of this classical da can be limited several fully data driven nonparametric techniques within the da framework primarily including the kalman takens filter hamilton et al 2016 hamilton et al 2017 khaki et al 2018 and analog data assimilation anda fablet et al 2018 lguensat et al 2017 lopez radcenco et al 2018 have successfully been used extensively in different fields in the past two decades machine learning based data assimilation methods such as the gaussian process gp bishop 2006 rasmussen 2003 and support vector machines svms kashif gill et al 2007 were gaining popularity for reconstructing hydrogeological dynamics in hydrology for instance ju et al 2018 proposed an adaptive gp based iterative ensemble smoother gpies to estimate the heterogeneous conductivity in saturated and unsaturated flow recently wang et al 2021 developed a new model free da scheme i e kalman gp or enkfgp when a physical model of the soil moisture dynamics is unavailable this nonparametric da scheme replaced the physical model with the gp constructed directly from available historical multiple source data and observations of state variables of interest while using the kalman update formulation to reconcile real time observations notwithstanding the success of these model free da strategies built on machine learning in hydrology essential caveats and limitations have hampered their wider adoption and impact first their learning accuracy in retrieving peaks and troughs of time series data is prone to deterioration li et al 2020 wang et al 2021 when guessing a dynamical system with locally changing behaviors from a sparse set of observations the traditional regression techniques relying only on the function values will tend to dampen local fluctuations laurent et al 2019 however the soil water content peaks and troughs in relation to the field capacity and the wilting coefficient are key early warning indicators in agricultural water management guiding the drainage and irrigation of farmland furr and reeve 1945 ghorbani et al 2017 one critical approach to address this issue is to enlarge the training dataset as much as possible to capture multiple local extrema of the unknown response function during testing validation prediction deng et al 2020 jo et al 2014 lockwood and anitescu 2012 unfortunately the amount of data required to infer nonlinear relationships in unsaturated flow problems may be even more overwhelming hughes 1968 to this end surrogate modelling that incorporates all the cheaply available auxiliary information such as gradients dwight and han 2009 ulaganathan et al 2015 zimmermann 2013 hessian data rumpfkeil 2013 yamazaki et al 2010 multi fidelity data deng et al 2020 and prior knowledge is increasingly popular as alternative strategies in particular accounting for gradients is a way to recover some of the meaningful local fluctuations laurent et al 2019 another major limitation of the nonparametric da scheme is its poor spatio temporal extrapolation capability such as when estimating profile soil moisture using remotely sensed surface moisture data in unsaturated flow problems entekhabi et al 1994 heathman et al 2003 zeng et al 2019 as also has been demonstrated in wang et al 2021 the estimated deep soil moisture from the model free filter enkfgp suffered apparent degradation due to a lack of physical constraints in the vertical direction this has prompted researchers to incorporate physical knowledge or constraints within the fully data driven framework i e physics informed approaches yang et al 2018 and yang et al 2019a proposed the physics informed kriging phik and cokriging cophik that leveraged realizations generated by physical models as training data to incorporate partial physical knowledge nevertheless the main drawback of such methods is that they revert to a high reliance on physical models and are not informed by data once the physical model is incorrect the convergence of phik to the true solution is instead slower than in the data driven gp regression another increasingly common physics informed approach the physics informed neural network pinn raissi et al 2019 attempted to incorporate constraint terms from the physical governing equations into the training of neural networks in the form of loss functions since its initial proposal by raissi et al 2017 variants of the pinn have been widely applied for a variety of forward and inverse problems in many fields karpatne et al 2017 chen et al 2020a mao et al 2020 pang et al 2019 yang et al 2021 yang et al 2019b table 1 summarizes the key papers and corresponding innovations of these methods for example wang et al 2020a proposed the theory guided neural network tgnn framework which further incorporated practical engineering theories engineering controls expert knowledge into the loss functions however most of such approaches have defined the loss function based on this strong form of conservation laws via partial differential equations pdes which are computationally expensive and poorly resistant to noise from data to tackle these difficulties xu et al 2020 further developed a weak form tgnn tgnn wf that incorporated the weak form formulation of the pde into the loss function in the weak form high order derivatives in the pde can be transferred to the test functions by performing integration by parts to achieve more relaxed constraints on the physical equations while reducing computational costs in summary however such pinn based strong form or weak form methods are fundamentally limited to multiple improvements of the loss function kharazmi et al 2019 xu et al 2020 their mining for decoding the physical interpretability of massive multi source data itself is far from adequate therefore one more provocative scientific question arises is it feasible to introduce additional physical constraints into the existing nonparametric da framework directly from the data itself rather than from the physical governing equations or engineering theories typically in unsaturated flow problems does the mapping from the forcing terms such as daily precipitation and evaporation inflow minus outflow of the soil column to the gradient values of soil moisture with respect to time i e the amount of change in the water content of the soil column provide an implicit functional representation of the law of conservation of mass via statistical learning to compensate for these deficiencies the primary contribution of this paper is to propose a gradient enhanced version of the sequential nonparametric da scheme i e ge enkfgp based on the enkfgp method in wang et al 2021 the idea of incorporating derivatives or gradients to optimize the bayesian prediction proposed by morris et al 1993 has been widely investigated in areas such as computational fluid dynamics laurenceau et al 2010 such methods can be typically divided into two categories i e direct and indirect approaches the former uses the gradient information via an augmented covariance matrix i e including the correlation between the data and the gradients forrester and keane 2009 han et al 2013 laurenceau and sagaut 2008 while the latter estimates additional function values using the gradients available in a close neighborhood to the sample point chung and alonso 2002a zimmermann 2013 for indirect gradient enhanced methods sampling points close to each other are prone to lead to quasi linearly dependent columns in the correlation matrix bouhlel and martins 2019 subsequently the ill conditioned correlation matrix makes the corresponding linear problem difficult to solve therefore within the proposed ge enkfgp framework in this paper the gradient information of the soil water content is incorporated into the construction of gp based soil moisture dynamical models in a direct manner as a follow up study of wang et al 2021 the purpose of this paper is not only to modify the model free da method to improve its estimation accuracy but more importantly to provide deeper insight into the physical characteristics of the temporal and spatial vertical gradient information in soil moisture dynamics in this work the efficiency applicability and limitations of the proposed ge enkfgp will be tested with the aid of real world datasets from ten typical stations with different climate regimes by comparing with existing works we aim to shed light on the following questions 1 how much improvement in the nonparametric soil moisture dynamical model s accuracy can be achieved with the enhancement of the temporal and spatial gradient information 2 how are the additional physical constraints hidden in the temporal and spatial gradient values of soil moisture formulated respectively within the model free da framework and 3 how does the enhancement effect of the temporal and spatial gradients vary in different application scenarios in the remainder of this manuscript section 2 presents the principles of the conventional and gradient enhanced gp the ensemble kalman filter and the proposed ge enkfgp method the experimental data and model setup are also summarized in this section section 3 presents the results and more details are discussed in section 4 finally conclusions are drawn in section 5 2 data and methods 2 1 data sources and site description to test the performance of the modified ge enkfgp under different soil types and climatic regimes in situ observations at ten different sites were downloaded from the international soil moisture network ismn https ismn geo tuwien ac at en including the dahra cape charles ene hereafter referred to as cape falkenberg boissy elgin 5 s mb10 necedah 5 wnw hereafter referred to as necedah spickard upperbethlehem and weslaco fig 1 depicts the spatial locations of these sites table 2 summarizes more detailed descriptions regarding these ten stations the temporal changes of soil moisture at various depths and the corresponding daily precipitation at all sites are shown in fig 2 while considering the limited available data i e the fractions of sand silt and clay the neural network prediction module of hydrus 1d rosetta lite version 1 1 schaap et al 2001 was used to estimate the values of the saturated hydraulic conductivity ks as has been demonstrated in wang et al 2020b and wang et al 2021 some regular meteorological observations were able to significantly improve the reconstruction accuracy of the soil moisture dynamics by roughly characterizing the time varying processes of soil evaporation in a purely data driven manner hence apart from the daily precipitation the air temperature at a two meter height at was also collected from the nasa prediction of worldwide energy resources nasa power https power larc nasa gov as a representative as shown in fig 2 2 2 models and methodology as outlined in section 1 a gradient enhanced version of the sequential nonparametric da scheme i e ge enkfgp is proposed based on the strength of the enkfgp method in wang et al 2021 in this modified version the quantity of interest qoi i e soil water content in this study and its gradients with respect to each direction of gp input can be used simultaneously to construct gp based dynamical models 2 2 1 conventional gaussian process model a brief review of the gp method adopted from rasmussen 2003 and wang et al 2021 is presented the input of n training datasets is denoted as x x i i 1 n and the corresponding observed values of the qoi are denoted as y y 1 y 2 y n t it should be noted that input may consist of any relevant information in addition to the time and location of qoi wang et al 2020b xu and valocchi 2015 here is a d dimensional input vector a gaussian process is fully defined with the specification of the mean function μ x and the covariance function k x x in this study a linear mean function and an anisotropic squared exponent covariance function zhang et al 2019 are specified as 1 μ x β t x 2 k x x σ 2 exp l 1 d x l x l 2 λ l 2 where β is the linear coefficient σ 2 controls the marginal variance of the output and λ 1 λ 2 λ d control the dependence strength in each of the component directions of x according to rasmussen 2003 and williams and rasmussen 2006 the above parameters of mean and covariance functions of gp models σ λ β are collectively called hyperparameters however it is worth noting that unlike other machine learning methods where the hyperparameters are fixed a priori during the training process the hyperparameters of the gp model can be inferred in the light of training data x y by maximizing the log marginal likelihood ki williams 2006 3 l log p y x 1 2 y μ t σ 1 y μ 1 2 log σ n 2 log 2 π where μ μ x represents the prior mean of y and the covariance matrix σ is calculated using the specified covariance function in eq 2 and can be expressed as 4 σ k x 1 x 1 k x 1 x n k x n x 1 k x n x n in this study the gp inference was implemented using the gpml matlab toolbox version 4 2 http gaussianprocess org gpml code matlab doc once the hyperparameters of gp are determined the posterior mean y with respect to any new input x can be predicted as follows 5 y μ σ t σ 1 y μ where μ represents the prior mean of μ x and σ is calculated as σ i j k x i x j 2 2 2 gradient enhanced gaussian process in the direct gradient enhanced method forrester and keane 2009 the column vector of the observed data is augmented to include the gradient information at sample points in the form of partial derivatives here we abbreviate the gradient of the i th training data points y i with respect to the j th input dimension y i x j as y j i i 1 2 n j 1 2 d then the definition of y in section 2 2 1 changes to the following 6 y y 1 y 2 y n y 1 1 y d 1 y 1 2 y d 2 y d n t r n d 1 in addition the size of the correlation matrix in eq 4 increases from n n to n d 1 n d 1 it contains four blocks including the correlation between data σ 11 σ between data and gradients σ 21 between gradients and data σ 12 and between gradients σ 22 by denoting the gradient enhanced correlation matrix by σ ge the following can be derived 7 σ ge σ 11 σ 12 σ 21 σ 22 where 8 σ 11 σ k x 1 x 1 k x 1 x n k x n x 1 k x n x n σ 21 k x 1 x 1 x 1 k x 1 x n x 1 k x 1 x 1 x d k x 1 x n x d k x n x 1 x 1 k x n x n x 1 k x n x 1 x d k x n x n x d σ 12 σ 21 t σ 22 φ 11 φ 1 n φ n 1 φ nn φ pq 2 k x p x q x 1 x 1 2 k x p x q x 1 x d 2 k x p x q x d x 1 2 k x p x q x d x d p q 1 2 n similarly once the hyperparameters are estimated the gradient enhanced predictor for any untried x is given by 9 y μ σ ge t σ ge 1 y 1 μ where 10 σ ge σ σ σ k x x 1 k x x n σ k x x 1 x 1 k x x 1 x d k x x n x 1 k x x n x d 1 1 1 1 0 0 0 where 1 contains n ones and n d zeros it should be emphasized that as a sequential da scheme the training dataset of this gp model is continuously augmented as time advances for the current time t k the training data contains all available observations from t 1 to t k 1 in other words the number of training data at t k n is equal to k 1 n obs assuming that the number of observations at each time is fixed to be n obs accordingly the amount of gradient data will also increase proportionally over time additionally to serve the proposed enkf framework an ensemble of gp models with the size of n e are constructed at each time step hence the resultant forecasted state vector y k f at the current time t k can be expressed as the following 11 y k f y k 1 y k 2 y k n e where y k i represents the qoi forecasted by the i th gp model i 1 2 n e at t k and the superscript f refers to forecast in this study the dimension of y k i ny is the total number of all nodes in the vertical soil profile 2 2 3 kalman update in the ensemble kalman filter enkf the ensemble kalman filter firstly developed by evensen 1994 moves sequentially from one measurement time to the next and performs a forecast step and an update or analysis step reichle et al 2002 since the forecasted state vector y k f has been obtained via the gp models in section 2 2 2 this section will focus on detailing the analysis step when real time observations are available the states of qoi are updated according to a comparison of the gp model predictions and the observed variables via the following 12 y k a y k f k k d k obs h y k f where d k obs is the observational data at time step k y k a is the posterior estimates for the ensemble of the state vector conditioned on the observed data at t k the superscripts a refers to analysis h is the observation operator that maps the states to the observation space here h is a n obs n y matrix in which the elements corresponding to the locations of available observations are 1 and 0 otherwise the kalman gain k k is given by 13 k k c k f h t h c k f h t r k 1 where r k e ε k ε k t is the covariance matrix of the observation error ε k and c k f is the covariance matrix of the state vector that can be estimated by 14 c k f 1 n e 1 i 1 n e y k i f y k f y k i f y k f t where y k i f is equivalent to y k i in eq 11 and y k f denotes the ensemble mean of y k f 2 2 4 gradient enhanced and gradient based versions of the enkfgp ge enkfgp and gb enkfgp this section primarily describes the procedure of how to construct a gradient enhanced gp dynamical model and subsequently integrate it into the enkf framework a synopsis of the various steps involved is detailed as follows step 1 the observed time series from t 1 to t t is the total duration of the simulation period are corrupted by the prescribed input and output noises satisfying the gaussian distribution to generate n e sets of training data for each training data set the gradient values of qoi w r t all or some input dimensions are enforced and augmented according to eq 6 step 2 at the time t k 1 k t n e gradient enhanced gp models are constructed in the light of n e sets of augmented training data i e x 1 k 1 y 1 k 1 1 x 1 k 1 y 1 k 1 2 x 1 k 1 y 1 k 1 n e here x 1 k 1 y 1 k 1 represents the all available data points from t 1 to k 1 the hyperparameters can be identified by maximizing the log marginal likelihood in eq 3 step 3 after determining n dynamical gp models the state vector y k f at t k for any untried x can be forecasted with the aid of the augmented correlation matrix σ ge via eqs 7 11 step 4 the forecasted state vector y k f can be updated to obtain an improved estimate of the qoi i e y k f by assimilating the current available observation d k obs using eqs 12 14 step 5 repeat steps 2 4 until all historical observed data points are assimilated as stated above the gradient enhanced version of enkfgp i e ge enkfgp combines qoi and its gradients for joint training while in the original enkfgp only qoi participates in gp training to reinforce the understanding of the respective roles of qoi and its gradients in statistical learning a fully gradient based version of the enkfgp gb enkfgp where only the gradients of qoi are considered is also executed it should be emphasized that the gradient information here refers only to the temporal gradient values of qoi i e daily increment of swc in this paper the input and output of n training datasets in gb enkfgp change to x i i 1 n and y i t i 1 n respectively y i t represents the temporal gradient of y i similarly n gp models can be constructed via eqs 1 4 after the hyperparameters have been identified the temporal increment of the qoi at t k can be forecasted y k f t or δ y k f δ t and then compensated to the posterior estimates at t k 1 i e y k f y k 1 a δ y k f δ t δ t the subsequent process of kalman update is identical to the other two methods thus it is not repeated here 2 3 model simulation setup the key parameters of this study are listed in table 3 while focusing on the vertical soil water flow each station was represented using a one dimensional soil column the height of these soil columns was 1 00 m and they were discretized into 2 cm grids at some observed depths of individual sites they were locally refined to 1 cm at each time step n e 50 gp or gradient enhanced gp models were constructed to describe the soil moisture dynamics in a sequential manner as new data were recorded similar to wang et al 2021 the driving data of the gp models included monitoring time day depth daily precipitation p and air temperature at a two meter height at in all three da strategies i e enkfgp gb enkfgp and ge enkfgp unlike previous studies that assumed noise free input points in the standard gp regression mchutchon and rasmussen 2011 the input noises were considered in this study the noise levels of rainfall and air temperature were arbitrarily set to 30 and 10 respectively however further investigation figures not presented demonstrated that the gradient enhanced method performed consistently better under different noise levels in addition the observation error of the soil water content was set at 0 02 m3 m3 moreover only the temporal and spatial gradients of swc were integrated into the ge enkfgp in this study while the gradients of daily precipitation and air temperature were not considered there are two reasons 1 as the most commonly used physical governing equation of soil water flow the richards equation provides important guidance for purely data driven modeling of soil moisture dynamics richards 1931 zha et al 2019 unlike the temporal θ t and spatial θ z gradients of swc which are key terms in the richards equation the gradients of p and at with respect to swc θ p and θ a t have no clear physical meaning 2 it is not feasible to calculate θ p for the daily precipitation data since they are normally discrete data series with no continuous change for comparison the simulation settings of the gp models during the three da strategies including enkfgp gb enkfgp and ge enkfgp are summarized as follows enkfgp the setup of this method was nearly identical to that of wang et al 2021 except that the covariance function was changed from the isotropic to anisotropic squared exponential covariance function here the output of the gp models was the swc gb enkfgp the output of the gradient based gp models was the temporal gradient of the swc i e θ k θ k 1 t k t k 1 θ k represented the observed swc at the time step t k considering that this study focused on the daily variability of the swc it can be further simplified to θ k θ k 1 since this forecasted daily increment of the swc requires compensation to the posterior estimate of the preceding time step in the gb enkfgp the initial value of y was required based on sparse actual observations the initial swc of all the nodes was obtained using linear interpolation the measurement error of the initial swc was also set at 0 022 and thus an initial ensemble with n e 50 realizations were generated ge enkfgp as noted earlier the input term of this gradient enhanced gp model was identical to the other two methods while the time series in the gp output was augmented with the temporal and spatial gradient values of the swc respectively the corresponding gradient enhanced versions of the ge enkfgp were labeled as ge enkfgp t and ge enkfgp s respectively it should be noted that the spatial gradient here refers specifically to the vertical gradient values of the swc in the present one dimensional unsaturated flow problems assuming that the observations of the swc from the surface downward were θ 1 θ 2 θ n obs at the corresponding depths of h 1 h 2 h n obs respectively the vertical gradient of θ i at z h i was the following 15 θ 2 θ 1 h 2 h 1 i 1 θ i 1 θ i 1 h i 1 h i 1 1 i n obs θ n obs θ n obs 1 h n obs h n obs 1 i n obs in addition the temporal or vertical gradients of all the data points within the training datasets were utilized for gp model enhancement unless otherwise specified 2 4 case design to test the performance of the proposed approaches in the context of different application scenarios a suite of real world cases was designed in general three primary application scenarios as were considered as1 temporal extrapolation in this scenario historical data on the soil water content at the location of interest were available for example the swc at z 0 05 m on the 11th day at the dahra was estimated using the gp model trained with the swc at z 0 05 m 0 10 m 0 50 m and 1 00 m from the 1st to 10th day a performance comparison between the ten sites was designed to investigate the effect of different soil textures and climatic regimes on the ability of various gradient information to improve the temporal extrapolation of the soil moisture dynamics as2 spatial vertical interpolation due to cost constraints researchers tend to place sensors in the vertical direction relatively sparsely sometimes even focusing only on the average soil moisture of the entire soil profile however soil moisture profiles at fine spatial resolutions are required in many practical applications spatial interpolation from sparse observation data is one way to obtain a detailed soil moisture profile the performance of the proposed ge enkfgp in spatial interpolation was examined in this scenario in addition to the constraints from observation data themselves whether the hidden information introduced by their temporal or spatial gradients could provide further constraints for the statistical interpolation was investigated the swc at the two depths of the surface and middle layer were trained and assimilated to estimate the swc values within these two depth ranges for example the swc at z 0 05 m and 0 50 m were used to estimate the swc at z 0 10 m at falkenberg while the swc values at z 0 15 m and 0 35 m at boissy were estimated with the observed data at z 0 05 m and 0 55 m as3 spatial vertical extrapolation compared to the spatial interpolation in as2 the spatial extrapolation in statistical learning techniques is fraught with more potential difficulties malone et al 2016 in particular the rapid advancements in techniques for identifying surface soil moisture mapping information using satellite based remote sensing dubois et al 1995 weidong et al 2002 wigneron et al 2003 zhao and li 2013 has greatly facilitated the idea of utilizing such low cost large scale surface data to infer the entire soil moisture profile however most of these studies have been limited in that they characterize soil moisture in a rather shallow layer normally between 2 and 20 cm deep chen et al 2011 jackson and schmugge 1989 turning to physical models seems to have become the only way to improve vertical extrapolation wang et al 2018 in this scenario the collaborative training of the surface swc and its spatio temporal gradients with the proposed ge enkfgp attempted to provide a fully data driven way to improve the estimation of deep swcs to be specific only the swc at two depths on the surface were trained and assimilated to estimate the deeper swc values for example the swc values at z 0 30 m and 0 45 m were estimated with the observed data at z 0 08 m and 0 15 m at falkenberg in this work the error in the model variable i e soil moisture here was quantified by the time averaged root mean square error rmse 16 rmse 1 t k 1 t î k f î k 2 where î k f represents the mean of n e 50 forecasted soil moisture samples at time k in addition to compare the uncertainty in the soil moisture estimation using different da strategies the standard deviation sd of n e 50 estimated soil moisture samples at time k was also calculated 17 sd 1 n e 1 m 1 n e î k f î k m 2 where m is the ensemble number index in addition to quantify the similarity of any two sets of time series data a a i i 1 n b b i i 1 n the cosine similarity cs was introduced chowdhury 2010 18 cs i 1 n a i b i i 1 n a i 2 i 1 n b i 2 the cs between the two datasets was within the values of 1 and 1 the similarity between these two increased as cs increased 3 results 3 1 application scenario 1 as1 3 1 1 enkfgp vs gb enkfgp vs ge enkfgp fig 3 shows the time averaged rmses between the observed and estimated swcs at various depths at all ten sites overall both the gb enkfgp and ge enkfgp led to lower rmses suggesting that the introduction of gradient information effectively improved the soil moisture estimation accuracy compared with the original enkfgp to be specific the gb enkfgp method exhibited superior performance than the ge enkfgp moreover fig 4 also takes the dahra site as an example to further present the time series of the observed and estimated soil moistures achieved by the enkfgp gb enkfgp and ge enkfgp methods respectively it can be seen that the auxiliary of the gradient information obviously resulted in a more accurate estimation of the peaks and troughs of the soil moisture time series as expected these results demonstrated the advantage of capturing multiple local extrema of the unknown response function using the gradient data in the proposed ge enkfgp chung and alonso 2002b laurent et al 2019 3 1 2 surface vs deep layers fig 3 also reveals that the response of the surface and deep swc estimates differed significantly for such gradient related approaches at some sites the gb enkfgp and ge enkfgp especially ge enkfgp s still performed well in the deep layer at dahra and necedah while at the cape falkenberg boissy and weslaco the fusion of the gradient information improved the deep soil water content retrievals only marginally and even may have worsened its estimation accuracy e g at z 1 00 m this discrepancy may be due to the fact that the temporal variability of swc between the surface and deep layers varied differently as depicted in fig 2 b c d and r fig 5 further shows the temporal daily and spatial vertical gradients of swc at various depths at falkenberg unfortunately a comparison of fig 2 c and fig 5 reveals that the gradient information only further amplified this difference between the surface and deep layers to quantify this amplification effect the cosine similarity cs of the swc as well as its temporal and spatial gradients between the surface layer z 0 08 m and other depths z 0 15 m 0 30 m 0 45 m 0 60 m and 0 90 m at falkenberg were also calculated as listed in table 4 it can be observed that the cs values of the temporal and spatial gradients were always smaller than those of the raw swc time series and this gap widened dramatically with increasing depth for example the cs between the swc time series at z 0 08 m and z 0 90 m was 0 9477 and was much larger than that associated with the temporal and spatial gradients these being equal to 0 0293 and 0 1503 respectively this indicated an increasingly weak similarity between the surface and deep layers if the gradient values of the surface and deep layers were still jointly fused to estimate the soil moisture profile the dramatic temporal variability in the surface swc might instead have disrupted the statistical interpolation of the deeper swc ultimately the enhancement of the gradients failed to reduce the rmse of the deeper swcs to circumvent this drawback one more case was designed where only the surface temporal gradient information was fused into the construction of the gp models and this was labelled as ge enkfgp t cust fig 6 compares the rmse between the observed and estimated swc at the deeper layer using the enkfgp ge enkfgp t and ge enkfgp t cust respectively only the results at three typical sites including falkenberg boissy and weslaco are presented although there was no visible improvement in the performance over the enkfgp the selective utilization of the gradient information in the ge enkfgp t cust indeed substantially reduced the rmse of the deeper swc compared to the ge enkfgp t this largely boosted the robustness of the gradient enhanced approaches for estimating the vertical soil moisture profile 3 1 3 temporal daily vs spatial vertical gradients according to fig 3 there is also an evident difference in the enhancement effect of the temporal and spatial gradients of the swc which essentially depended on their intrinsic physical characteristics in the reconstruction of the soil moisture dynamics fig 7 shows scatterplots between the daily precipitation and the corresponding predicted increments of the soil water in the entire one meter soil column using the enkfgp gb enkfgp and ge enkfgp t here only the scatterplots at the cape are presented the result showed that the values of r 2 with the methods that used the temporal daily gradients were significantly higher than that of the enkfgp r 2 0 293 additionally the slope of the fitted curve for the former was also nearer to one especially for the ge enkfgp t these results indicated that the introduction of temporal gradients of the soil water content was able to render the fully data driven gp models to implicitly obey the law of conservation of mass to some extent through the straightforward mapping from external forcing terms such as rainfall to the daily increments of the soil moisture furthermore a comparison of fig 5 a and 5b also shows that the temporal gradients had significantly more substantial variability in the vertical direction than the spatial gradients as shown in table 4 the temporal gradient between the surface layer and z 0 90 m caused a more pronounced amplification effect with cs 0 0293 compared to the vertical gradient cs 0 1503 which also accounts for the inferior robustness of ge enkfgp t compared to ge enkfgp s for example as depicted in fig 3 c the rmses of the ge enkfgp s at z 0 60 m and 0 90 m were not unacceptably larger than that of the ge enkfgp t at falkenberg 3 2 application scenario 2 as2 fig 8 shows the time averaged rmses between the observed and predicted soil moistures at the depths of interest in as2 with the enkfgp gb enkfgp and ge enkfgp respectively the corresponding time series of swc are also depicted in fig 9 only the results at six sites presented here to avoid too many figures similar to as1 overall the enhancement of the gradient information especially ge enkfgp s produced a better estimation of the swc with smaller rmses than the original enkfgp method in this spatial interpolation scenario however the opposite result occurred at the upperbethlehem as depicted in fig 8 i slightly larger rmse values with the ge enkfgp t and ge enkfgp s than those with enkfgp can be observed at z 0 10 m and 0 20 m at this site furthermore the gradient data were still able to successfully capture the locally changing behaviors of the soil moisture dynamics in as2 fig 9 this was particularly pronounced in the retrievals of the extremes and troughs as highlighted in the black dashed rectangular boxes in fig 9 b and 9d however unlike in as1 the gb enkfgp that utilized only the daily gradients exhibited a considerably less robust performance in as2 for example its rmse values at z 0 20 m for the cape and z 0 15 m for falkenberg were much greater than those found using the enkfgp 3 3 application scenario 3 as3 fig 10 and fig 11 present the time averaged rmses between the observed and predicted soil moisture at the deeper layer and the corresponding time series in as3 using the enkfgp gb enkfgp and ge enkfgp respectively it can be seen that the vertical gradient enhanced method i e ge enkfgp s maintained a relatively stable improvement performance in as3 although the extent of this rmse reduction gradually diminished with increasing depth of interest as shown in fig 10 c the rmse at z 0 30 m for falkenberg decreased from 0 034 with the enkfgp to 0 026 with the ge enkfgp s while both methods produced almost the same rmses at z 0 45 m inferior to the ge enkfgp s the robustness of the ge enkfgp t deteriorated even in the shallower layer e g at z 0 20 m for the cape fig 10 b and weslaco fig 10 j nevertheless it is worth noting that despite an increase in the time averaged rmse its reproduction for some key points e g peaks was still quite promising as highlighted in the black dashed rectangular boxes in fig 11 b in contrast the gb enkfgp performed the worst under this scenario of spatial extrapolation in addition to the above analysis for estimation accuracy figs s1 s3 also depict the spatio temporal patterns of standard deviations sd of n e 50 estimated ensemble members of the swc at all nodes using various nonparametric da schemes in the as as2 and as3 respectively only the results in six typical sites are presented in summary the retrieved soil moisture profile from the gb enkfgp suffered from the highest uncertainty in all three application scenarios 4 discussions 4 1 application scenario 1 as1 the optimal performance of gb enkfgp in the temporal extrapolation scenario as1 was likely because the forecasted variables i e daily increments of swc in the gb enkfgp were not used directly for assimilation as in the ge enkfgp but instead first compensated to the posterior estimate of the previous time step this reliance on previous estimates vastly reduced the potential risk of performance collapse due to unreasonable temporal extrapolation in the face of unknown future scenarios however this also implied that its predictive uncertainty of the swc not only stemmed from the n e 50 gp models but also included the uncertainty of the previous moment s posterior estimates hence the highest uncertainty of the soil moisture estimation with the gb enkfgp was observed in the second column of fig s1 the introduction of temporal gradients of the swc in the ge enkfgp t was able to render the fully data driven gp models to implicitly obey the law of conservation of mass to some extent as for the vertical gradient assuming that the soil column was homogeneous the vertical gradient of the swc at any two nodes was equivalent to the hydraulic gradient between these two which provided the driving force for the vertical infiltration of water into the soil more precisely stated the vertical gradient of the swc between the two nodes imposed a physical upper boundary constraint on the soil they controlled this implicit constraint mechanically enabled the spatial gradient to enhance the accuracy of the swc estimation within the nonparametric da framework moreover the discrepancy between surface and deep layers was most likely associated with the delayed response of the swc profiles to rainfall events the strength of this delay is often controlled by various complex factors such as soil texture rainfall intensity antecedent swc etcetera unlike the dahra with the fraction of sand up to 90 and ks 3 22 m d and necedah with the fraction of sand up to 83 and ks 1 24 m d the cape ks 0 10 m d boissy ks 0 14 m d and weslaco ks 0 15 m d sites had a clayey soil texture resulting in a significantly weaker soil infiltration capacity for the falkenberg although its ks is as high as 0 63 m d the overall low rainfall intensity also made its deep swc z 0 60 m and 1 00 m almost unresponsive to rainfall ultimately this inconsistent response of surface and deep swc to rainfall events led to poor performance of gradient enhanced especially ge enkfgp t in the deep layer these results demonstrated the promising feasibility of the proposed gradient related approaches in sandy soils while alerting to the challenges of their applications in clayey soils or more precisely in areas with long rainfall infiltration delays to alleviate this adverse effect of this delay effect as described above the most straightforward strategy is to only fuse the surface gradient information with strong temporal variability into the gp system furthermore another possible way to mitigate this time delay effect is to introduce the idea of recurrent neural networks rnns in long short term memory lstm to explore the memory response of deeper swc to antecedent rainfall events many previous studies have shown that lstm can solve complex long time lag problems chen et al 2020b hochreiter and schmidhuber 1997 kratzert et al 2018 the influences of multiple factors such as soil texture as well as rainfall frequency and intensity on the determination of the lag time step in our soil water flow problems are fascinating but complex the gradient enhanced nonparametric da scheme guided by this idea will be investigated in future studies 4 2 application scenario 2 as2 and application scenario 3 as3 unlike in as1 the gb enkfgp method faced a considerable risk of performance collapse in both as2 and as3 scenarios for the swcs at depths of interest their posterior estimates tended to have poor accuracy due to the absence of any training and assimilation of historical data at those depths the bias caused by the scarcity of training data at the beginning of the simulation may have accumulated over time finally the predicted time series curves deviated far from the actual observations during the later stages of the simulation especially at z 0 20 m for the cape fig 9 b and 9d and z 0 35 m and 0 55 m for the boissy fig 11 f and 11i this substantially offsets the benefits derived from the posterior estimates at the previous moment in the gb enkfgp the still apparent superiority of the ge enkfgp s over the original enkfgp in as2 and as3 was naturally attributed to the mass conservation constraint hidden within the temporal gradient and the implicit upper boundary constraint from the spatial gradient the anomaly in as2 at upperbethlehem may be due to distinct soil stratification in the 0 00 0 50 m depth range and the infiltration capacity of the lower soil layer was much lower than that of the upper soil layer this resulted in a much higher swc at z 0 10 m and 0 20 m depths than at z 0 05 m and 0 50 m fig 2 q throughout the simulation period under this circumstance it is almost impossible to interpolate and estimate the middle swc in a purely data driven manner using only surface and deep swc data this is not only a defect of our proposed gradient enhanced nonparametric da scheme but also an insurmountable challenge for purely data driven algorithms in addition the weakness of ge enkfgp t relative to ge enkfgp s was enlarged in as3 this inferiority was particularly evident at those sites with longer delayed responses of swc profiles to rainfall events e g falkenberg cape and weslaco this recalls that in as1 the temporal gradient enhanced method had poorer robustness than the spatial one due to the weaker similarity of the surface and deeper swc fig 5 and table 4 in the vertical extrapolation scenario of as3 where only the surface swc was trained and assimilated this gap was inevitably exposed again and intensified as the depth of interest increased 5 conclusions in this study the gradient enhanced version of the nonparametric data assimilation scheme ge enkfgp was proposed to exploit the auxiliary worth of spatio temporal gradients of the soil water content in the reconstruction of soil moisture dynamics unlike previous physics informed approaches this study attempted to introduce additional physical constraints into the proposed nonparametric da framework directly from the data itself via a gradient enhanced gp regression within the proposed ge enkfgp framework the causal relationship hidden in the mapping from the gp input terms e g daily precipitation to the temporal daily gradients of the soil water content preserved the constraint of the law of mass conservation to some extent more simply and straightforwardly in addition the spatial vertical gradients between any two nodes enhanced the soil moisture profile retrievals by implicitly providing the driving force or upper boundary of dynamic systems to reinforce our understanding of the contributions of raw soil moisture data as well as its spatial and temporal gradients in soil moisture dynamics multiple versions of the model free da schemes i e the original enkfgp gb enkfgp and ge enkfgp were compared their performances in the three most typical application scenarios including as1 temporal extrapolation as2 spatial interpolation and as3 extrapolation were also tested the following conclusions were drawn 1 when historical data on the soil water content at the depths of interest are available the introduction of gradient information in the gb enkfgp and ge enkfgp methods led to better estimation than the initial enkfgp due to their more accurate identification of multiple local extrema the gb enkfgp which solely used the spatial gradients of the swc to construct the gp models resulted in the optimal swc retrievals but also had the largest uncertainty the enhancement effect of the spatial gradient information was more robust than the temporal gradients subject to the delayed response of the soil moisture profiles to rainfall events such gradient related algorithms exhibited superior performance in the estimation of surface soil water content than that in the deeper layer therefore in order to enhance their robustness one modified algorithm where only surface gradient information was augmented into the construction of the gp models was recommended 2 the hidden information in the gradient data within the ge enkfgp framework was effective in improving the accuracy of the vertical interpolation to produce soil moisture profiles at finer spatial resolutions in contrast the gb enkfgp method in as2 tended to degrade possibly due to the scarcity of available swc historical data at the depths of interest 3 in as3 where the deeper soil water content was inferred using easy to access surface data the spatial gradient enhanced nonparametric da scheme i e ge enkfgp s was overall relatively robust in yielding the optimal deeper swc estimates however the implementation of gb enkfgp and ge enkfgp t ran the risk of triggering a performance collapse this robustness difference depended primarily on the soil texture and the spatial distance between the depth of interest and the available observation depth the more clayed the soil texture was the farther the depth of interest was from the surface layer the less robust the gradient related algorithms were under the scenario of statistical extrapolation credit authorship contribution statement yakun wang methodology software writing original draft liangsheng shi writing review editing supervision qiuru zhang methodology han qiao writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was supported by the national natural science foundation of china grants 51861125202 and 51979200 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 126857 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
4111,soil water content swc is a vital variable in the hydrological cycle while simulation of it often relies on resolving the soil water flow equation to cope with the unavailability or poor quality of physical models various nonparametric data assimilation da schemes have been established however there tends to be two significant common challenges in such methods 1 the difficulty in capturing locally changing behaviors of time series especially the peaks and troughs and 2 poor statistical interpolation capability in time and space these two challenges are no doubt attributed to the complete renunciation of physical constraints unlike previous physics informed approaches that incorporated physical governing equations and engineering control into the loss functions this study attempts to introduce additional physical constraints from data gradient into the model free da framework as a follow up study of wang et al 2021 a gradient enhanced version of nonparametric da schemes i e ge enkfgp is proposed the temporal daily and spatial vertical gradients of the swc are merged into the construction of the unsaturated flow dynamical models based on the gaussian process gp while the kalman update formulation is used to reconcile real time observations with the aid of a series of real world cases the performance of the ge enkfgp was compared with the original enkfgp and its gradient based version gb enkfgp where the temporal gradients of the swc were used as the proxy for the swc as the gp output the results showed that the enhancement of the gradient information in the ge enkfgp led to a better estimation than the initial enkfgp due to its more accurate identification of multiple local extrema this should be attributed to the mass conservation constraint hidden within the temporal gradients and the implicit constraint of the driving force or upper boundary from the spatial gradients spatial gradients of the swc outperformed temporal ones under various application scenarios the gb enkfgp and ge enkfgp exhibited superior performances in retrieving surface swc than that in the deeper layer hence an enhancement scheme using only the temporal gradients of the surface layer was recommended in the context of spatial extrapolation the assistance of spatial gradients yielded an improved estimate of the deeper swc quite robustly through gp training and assimilation of easy to access surface data however the implementation of the gb enkfgp and temporal gradient enhanced enkfgp i e ge enkfgp t run the risk of triggering a performance collapse due to the delayed response of swc profiles to rainfall events keywords nonparametric data assimilation temporal and spatial gradients soil moisture statistical extrapolation 1 introduction the reconstruction of the spatiotemporal dynamics of soil moisture from noisy or partial observations is a significant issue in unsaturated flow problems variational reichle et al 2001 tian et al 2009 and stochastic data assimilation da shi et al 2015 zhu et al 2017 schemes are the two primary categories of methods considered to address this issue a vital feature of these da schemes is that they rely on repeated forward integrations of an explicitly known dynamical model tandeo et al 2015 when a physical model is available parametric forecasting methods can be used for noise filtering prediction and control of systems however when a physical model is not available or the available models are poor the application of this classical da can be limited several fully data driven nonparametric techniques within the da framework primarily including the kalman takens filter hamilton et al 2016 hamilton et al 2017 khaki et al 2018 and analog data assimilation anda fablet et al 2018 lguensat et al 2017 lopez radcenco et al 2018 have successfully been used extensively in different fields in the past two decades machine learning based data assimilation methods such as the gaussian process gp bishop 2006 rasmussen 2003 and support vector machines svms kashif gill et al 2007 were gaining popularity for reconstructing hydrogeological dynamics in hydrology for instance ju et al 2018 proposed an adaptive gp based iterative ensemble smoother gpies to estimate the heterogeneous conductivity in saturated and unsaturated flow recently wang et al 2021 developed a new model free da scheme i e kalman gp or enkfgp when a physical model of the soil moisture dynamics is unavailable this nonparametric da scheme replaced the physical model with the gp constructed directly from available historical multiple source data and observations of state variables of interest while using the kalman update formulation to reconcile real time observations notwithstanding the success of these model free da strategies built on machine learning in hydrology essential caveats and limitations have hampered their wider adoption and impact first their learning accuracy in retrieving peaks and troughs of time series data is prone to deterioration li et al 2020 wang et al 2021 when guessing a dynamical system with locally changing behaviors from a sparse set of observations the traditional regression techniques relying only on the function values will tend to dampen local fluctuations laurent et al 2019 however the soil water content peaks and troughs in relation to the field capacity and the wilting coefficient are key early warning indicators in agricultural water management guiding the drainage and irrigation of farmland furr and reeve 1945 ghorbani et al 2017 one critical approach to address this issue is to enlarge the training dataset as much as possible to capture multiple local extrema of the unknown response function during testing validation prediction deng et al 2020 jo et al 2014 lockwood and anitescu 2012 unfortunately the amount of data required to infer nonlinear relationships in unsaturated flow problems may be even more overwhelming hughes 1968 to this end surrogate modelling that incorporates all the cheaply available auxiliary information such as gradients dwight and han 2009 ulaganathan et al 2015 zimmermann 2013 hessian data rumpfkeil 2013 yamazaki et al 2010 multi fidelity data deng et al 2020 and prior knowledge is increasingly popular as alternative strategies in particular accounting for gradients is a way to recover some of the meaningful local fluctuations laurent et al 2019 another major limitation of the nonparametric da scheme is its poor spatio temporal extrapolation capability such as when estimating profile soil moisture using remotely sensed surface moisture data in unsaturated flow problems entekhabi et al 1994 heathman et al 2003 zeng et al 2019 as also has been demonstrated in wang et al 2021 the estimated deep soil moisture from the model free filter enkfgp suffered apparent degradation due to a lack of physical constraints in the vertical direction this has prompted researchers to incorporate physical knowledge or constraints within the fully data driven framework i e physics informed approaches yang et al 2018 and yang et al 2019a proposed the physics informed kriging phik and cokriging cophik that leveraged realizations generated by physical models as training data to incorporate partial physical knowledge nevertheless the main drawback of such methods is that they revert to a high reliance on physical models and are not informed by data once the physical model is incorrect the convergence of phik to the true solution is instead slower than in the data driven gp regression another increasingly common physics informed approach the physics informed neural network pinn raissi et al 2019 attempted to incorporate constraint terms from the physical governing equations into the training of neural networks in the form of loss functions since its initial proposal by raissi et al 2017 variants of the pinn have been widely applied for a variety of forward and inverse problems in many fields karpatne et al 2017 chen et al 2020a mao et al 2020 pang et al 2019 yang et al 2021 yang et al 2019b table 1 summarizes the key papers and corresponding innovations of these methods for example wang et al 2020a proposed the theory guided neural network tgnn framework which further incorporated practical engineering theories engineering controls expert knowledge into the loss functions however most of such approaches have defined the loss function based on this strong form of conservation laws via partial differential equations pdes which are computationally expensive and poorly resistant to noise from data to tackle these difficulties xu et al 2020 further developed a weak form tgnn tgnn wf that incorporated the weak form formulation of the pde into the loss function in the weak form high order derivatives in the pde can be transferred to the test functions by performing integration by parts to achieve more relaxed constraints on the physical equations while reducing computational costs in summary however such pinn based strong form or weak form methods are fundamentally limited to multiple improvements of the loss function kharazmi et al 2019 xu et al 2020 their mining for decoding the physical interpretability of massive multi source data itself is far from adequate therefore one more provocative scientific question arises is it feasible to introduce additional physical constraints into the existing nonparametric da framework directly from the data itself rather than from the physical governing equations or engineering theories typically in unsaturated flow problems does the mapping from the forcing terms such as daily precipitation and evaporation inflow minus outflow of the soil column to the gradient values of soil moisture with respect to time i e the amount of change in the water content of the soil column provide an implicit functional representation of the law of conservation of mass via statistical learning to compensate for these deficiencies the primary contribution of this paper is to propose a gradient enhanced version of the sequential nonparametric da scheme i e ge enkfgp based on the enkfgp method in wang et al 2021 the idea of incorporating derivatives or gradients to optimize the bayesian prediction proposed by morris et al 1993 has been widely investigated in areas such as computational fluid dynamics laurenceau et al 2010 such methods can be typically divided into two categories i e direct and indirect approaches the former uses the gradient information via an augmented covariance matrix i e including the correlation between the data and the gradients forrester and keane 2009 han et al 2013 laurenceau and sagaut 2008 while the latter estimates additional function values using the gradients available in a close neighborhood to the sample point chung and alonso 2002a zimmermann 2013 for indirect gradient enhanced methods sampling points close to each other are prone to lead to quasi linearly dependent columns in the correlation matrix bouhlel and martins 2019 subsequently the ill conditioned correlation matrix makes the corresponding linear problem difficult to solve therefore within the proposed ge enkfgp framework in this paper the gradient information of the soil water content is incorporated into the construction of gp based soil moisture dynamical models in a direct manner as a follow up study of wang et al 2021 the purpose of this paper is not only to modify the model free da method to improve its estimation accuracy but more importantly to provide deeper insight into the physical characteristics of the temporal and spatial vertical gradient information in soil moisture dynamics in this work the efficiency applicability and limitations of the proposed ge enkfgp will be tested with the aid of real world datasets from ten typical stations with different climate regimes by comparing with existing works we aim to shed light on the following questions 1 how much improvement in the nonparametric soil moisture dynamical model s accuracy can be achieved with the enhancement of the temporal and spatial gradient information 2 how are the additional physical constraints hidden in the temporal and spatial gradient values of soil moisture formulated respectively within the model free da framework and 3 how does the enhancement effect of the temporal and spatial gradients vary in different application scenarios in the remainder of this manuscript section 2 presents the principles of the conventional and gradient enhanced gp the ensemble kalman filter and the proposed ge enkfgp method the experimental data and model setup are also summarized in this section section 3 presents the results and more details are discussed in section 4 finally conclusions are drawn in section 5 2 data and methods 2 1 data sources and site description to test the performance of the modified ge enkfgp under different soil types and climatic regimes in situ observations at ten different sites were downloaded from the international soil moisture network ismn https ismn geo tuwien ac at en including the dahra cape charles ene hereafter referred to as cape falkenberg boissy elgin 5 s mb10 necedah 5 wnw hereafter referred to as necedah spickard upperbethlehem and weslaco fig 1 depicts the spatial locations of these sites table 2 summarizes more detailed descriptions regarding these ten stations the temporal changes of soil moisture at various depths and the corresponding daily precipitation at all sites are shown in fig 2 while considering the limited available data i e the fractions of sand silt and clay the neural network prediction module of hydrus 1d rosetta lite version 1 1 schaap et al 2001 was used to estimate the values of the saturated hydraulic conductivity ks as has been demonstrated in wang et al 2020b and wang et al 2021 some regular meteorological observations were able to significantly improve the reconstruction accuracy of the soil moisture dynamics by roughly characterizing the time varying processes of soil evaporation in a purely data driven manner hence apart from the daily precipitation the air temperature at a two meter height at was also collected from the nasa prediction of worldwide energy resources nasa power https power larc nasa gov as a representative as shown in fig 2 2 2 models and methodology as outlined in section 1 a gradient enhanced version of the sequential nonparametric da scheme i e ge enkfgp is proposed based on the strength of the enkfgp method in wang et al 2021 in this modified version the quantity of interest qoi i e soil water content in this study and its gradients with respect to each direction of gp input can be used simultaneously to construct gp based dynamical models 2 2 1 conventional gaussian process model a brief review of the gp method adopted from rasmussen 2003 and wang et al 2021 is presented the input of n training datasets is denoted as x x i i 1 n and the corresponding observed values of the qoi are denoted as y y 1 y 2 y n t it should be noted that input may consist of any relevant information in addition to the time and location of qoi wang et al 2020b xu and valocchi 2015 here is a d dimensional input vector a gaussian process is fully defined with the specification of the mean function μ x and the covariance function k x x in this study a linear mean function and an anisotropic squared exponent covariance function zhang et al 2019 are specified as 1 μ x β t x 2 k x x σ 2 exp l 1 d x l x l 2 λ l 2 where β is the linear coefficient σ 2 controls the marginal variance of the output and λ 1 λ 2 λ d control the dependence strength in each of the component directions of x according to rasmussen 2003 and williams and rasmussen 2006 the above parameters of mean and covariance functions of gp models σ λ β are collectively called hyperparameters however it is worth noting that unlike other machine learning methods where the hyperparameters are fixed a priori during the training process the hyperparameters of the gp model can be inferred in the light of training data x y by maximizing the log marginal likelihood ki williams 2006 3 l log p y x 1 2 y μ t σ 1 y μ 1 2 log σ n 2 log 2 π where μ μ x represents the prior mean of y and the covariance matrix σ is calculated using the specified covariance function in eq 2 and can be expressed as 4 σ k x 1 x 1 k x 1 x n k x n x 1 k x n x n in this study the gp inference was implemented using the gpml matlab toolbox version 4 2 http gaussianprocess org gpml code matlab doc once the hyperparameters of gp are determined the posterior mean y with respect to any new input x can be predicted as follows 5 y μ σ t σ 1 y μ where μ represents the prior mean of μ x and σ is calculated as σ i j k x i x j 2 2 2 gradient enhanced gaussian process in the direct gradient enhanced method forrester and keane 2009 the column vector of the observed data is augmented to include the gradient information at sample points in the form of partial derivatives here we abbreviate the gradient of the i th training data points y i with respect to the j th input dimension y i x j as y j i i 1 2 n j 1 2 d then the definition of y in section 2 2 1 changes to the following 6 y y 1 y 2 y n y 1 1 y d 1 y 1 2 y d 2 y d n t r n d 1 in addition the size of the correlation matrix in eq 4 increases from n n to n d 1 n d 1 it contains four blocks including the correlation between data σ 11 σ between data and gradients σ 21 between gradients and data σ 12 and between gradients σ 22 by denoting the gradient enhanced correlation matrix by σ ge the following can be derived 7 σ ge σ 11 σ 12 σ 21 σ 22 where 8 σ 11 σ k x 1 x 1 k x 1 x n k x n x 1 k x n x n σ 21 k x 1 x 1 x 1 k x 1 x n x 1 k x 1 x 1 x d k x 1 x n x d k x n x 1 x 1 k x n x n x 1 k x n x 1 x d k x n x n x d σ 12 σ 21 t σ 22 φ 11 φ 1 n φ n 1 φ nn φ pq 2 k x p x q x 1 x 1 2 k x p x q x 1 x d 2 k x p x q x d x 1 2 k x p x q x d x d p q 1 2 n similarly once the hyperparameters are estimated the gradient enhanced predictor for any untried x is given by 9 y μ σ ge t σ ge 1 y 1 μ where 10 σ ge σ σ σ k x x 1 k x x n σ k x x 1 x 1 k x x 1 x d k x x n x 1 k x x n x d 1 1 1 1 0 0 0 where 1 contains n ones and n d zeros it should be emphasized that as a sequential da scheme the training dataset of this gp model is continuously augmented as time advances for the current time t k the training data contains all available observations from t 1 to t k 1 in other words the number of training data at t k n is equal to k 1 n obs assuming that the number of observations at each time is fixed to be n obs accordingly the amount of gradient data will also increase proportionally over time additionally to serve the proposed enkf framework an ensemble of gp models with the size of n e are constructed at each time step hence the resultant forecasted state vector y k f at the current time t k can be expressed as the following 11 y k f y k 1 y k 2 y k n e where y k i represents the qoi forecasted by the i th gp model i 1 2 n e at t k and the superscript f refers to forecast in this study the dimension of y k i ny is the total number of all nodes in the vertical soil profile 2 2 3 kalman update in the ensemble kalman filter enkf the ensemble kalman filter firstly developed by evensen 1994 moves sequentially from one measurement time to the next and performs a forecast step and an update or analysis step reichle et al 2002 since the forecasted state vector y k f has been obtained via the gp models in section 2 2 2 this section will focus on detailing the analysis step when real time observations are available the states of qoi are updated according to a comparison of the gp model predictions and the observed variables via the following 12 y k a y k f k k d k obs h y k f where d k obs is the observational data at time step k y k a is the posterior estimates for the ensemble of the state vector conditioned on the observed data at t k the superscripts a refers to analysis h is the observation operator that maps the states to the observation space here h is a n obs n y matrix in which the elements corresponding to the locations of available observations are 1 and 0 otherwise the kalman gain k k is given by 13 k k c k f h t h c k f h t r k 1 where r k e ε k ε k t is the covariance matrix of the observation error ε k and c k f is the covariance matrix of the state vector that can be estimated by 14 c k f 1 n e 1 i 1 n e y k i f y k f y k i f y k f t where y k i f is equivalent to y k i in eq 11 and y k f denotes the ensemble mean of y k f 2 2 4 gradient enhanced and gradient based versions of the enkfgp ge enkfgp and gb enkfgp this section primarily describes the procedure of how to construct a gradient enhanced gp dynamical model and subsequently integrate it into the enkf framework a synopsis of the various steps involved is detailed as follows step 1 the observed time series from t 1 to t t is the total duration of the simulation period are corrupted by the prescribed input and output noises satisfying the gaussian distribution to generate n e sets of training data for each training data set the gradient values of qoi w r t all or some input dimensions are enforced and augmented according to eq 6 step 2 at the time t k 1 k t n e gradient enhanced gp models are constructed in the light of n e sets of augmented training data i e x 1 k 1 y 1 k 1 1 x 1 k 1 y 1 k 1 2 x 1 k 1 y 1 k 1 n e here x 1 k 1 y 1 k 1 represents the all available data points from t 1 to k 1 the hyperparameters can be identified by maximizing the log marginal likelihood in eq 3 step 3 after determining n dynamical gp models the state vector y k f at t k for any untried x can be forecasted with the aid of the augmented correlation matrix σ ge via eqs 7 11 step 4 the forecasted state vector y k f can be updated to obtain an improved estimate of the qoi i e y k f by assimilating the current available observation d k obs using eqs 12 14 step 5 repeat steps 2 4 until all historical observed data points are assimilated as stated above the gradient enhanced version of enkfgp i e ge enkfgp combines qoi and its gradients for joint training while in the original enkfgp only qoi participates in gp training to reinforce the understanding of the respective roles of qoi and its gradients in statistical learning a fully gradient based version of the enkfgp gb enkfgp where only the gradients of qoi are considered is also executed it should be emphasized that the gradient information here refers only to the temporal gradient values of qoi i e daily increment of swc in this paper the input and output of n training datasets in gb enkfgp change to x i i 1 n and y i t i 1 n respectively y i t represents the temporal gradient of y i similarly n gp models can be constructed via eqs 1 4 after the hyperparameters have been identified the temporal increment of the qoi at t k can be forecasted y k f t or δ y k f δ t and then compensated to the posterior estimates at t k 1 i e y k f y k 1 a δ y k f δ t δ t the subsequent process of kalman update is identical to the other two methods thus it is not repeated here 2 3 model simulation setup the key parameters of this study are listed in table 3 while focusing on the vertical soil water flow each station was represented using a one dimensional soil column the height of these soil columns was 1 00 m and they were discretized into 2 cm grids at some observed depths of individual sites they were locally refined to 1 cm at each time step n e 50 gp or gradient enhanced gp models were constructed to describe the soil moisture dynamics in a sequential manner as new data were recorded similar to wang et al 2021 the driving data of the gp models included monitoring time day depth daily precipitation p and air temperature at a two meter height at in all three da strategies i e enkfgp gb enkfgp and ge enkfgp unlike previous studies that assumed noise free input points in the standard gp regression mchutchon and rasmussen 2011 the input noises were considered in this study the noise levels of rainfall and air temperature were arbitrarily set to 30 and 10 respectively however further investigation figures not presented demonstrated that the gradient enhanced method performed consistently better under different noise levels in addition the observation error of the soil water content was set at 0 02 m3 m3 moreover only the temporal and spatial gradients of swc were integrated into the ge enkfgp in this study while the gradients of daily precipitation and air temperature were not considered there are two reasons 1 as the most commonly used physical governing equation of soil water flow the richards equation provides important guidance for purely data driven modeling of soil moisture dynamics richards 1931 zha et al 2019 unlike the temporal θ t and spatial θ z gradients of swc which are key terms in the richards equation the gradients of p and at with respect to swc θ p and θ a t have no clear physical meaning 2 it is not feasible to calculate θ p for the daily precipitation data since they are normally discrete data series with no continuous change for comparison the simulation settings of the gp models during the three da strategies including enkfgp gb enkfgp and ge enkfgp are summarized as follows enkfgp the setup of this method was nearly identical to that of wang et al 2021 except that the covariance function was changed from the isotropic to anisotropic squared exponential covariance function here the output of the gp models was the swc gb enkfgp the output of the gradient based gp models was the temporal gradient of the swc i e θ k θ k 1 t k t k 1 θ k represented the observed swc at the time step t k considering that this study focused on the daily variability of the swc it can be further simplified to θ k θ k 1 since this forecasted daily increment of the swc requires compensation to the posterior estimate of the preceding time step in the gb enkfgp the initial value of y was required based on sparse actual observations the initial swc of all the nodes was obtained using linear interpolation the measurement error of the initial swc was also set at 0 022 and thus an initial ensemble with n e 50 realizations were generated ge enkfgp as noted earlier the input term of this gradient enhanced gp model was identical to the other two methods while the time series in the gp output was augmented with the temporal and spatial gradient values of the swc respectively the corresponding gradient enhanced versions of the ge enkfgp were labeled as ge enkfgp t and ge enkfgp s respectively it should be noted that the spatial gradient here refers specifically to the vertical gradient values of the swc in the present one dimensional unsaturated flow problems assuming that the observations of the swc from the surface downward were θ 1 θ 2 θ n obs at the corresponding depths of h 1 h 2 h n obs respectively the vertical gradient of θ i at z h i was the following 15 θ 2 θ 1 h 2 h 1 i 1 θ i 1 θ i 1 h i 1 h i 1 1 i n obs θ n obs θ n obs 1 h n obs h n obs 1 i n obs in addition the temporal or vertical gradients of all the data points within the training datasets were utilized for gp model enhancement unless otherwise specified 2 4 case design to test the performance of the proposed approaches in the context of different application scenarios a suite of real world cases was designed in general three primary application scenarios as were considered as1 temporal extrapolation in this scenario historical data on the soil water content at the location of interest were available for example the swc at z 0 05 m on the 11th day at the dahra was estimated using the gp model trained with the swc at z 0 05 m 0 10 m 0 50 m and 1 00 m from the 1st to 10th day a performance comparison between the ten sites was designed to investigate the effect of different soil textures and climatic regimes on the ability of various gradient information to improve the temporal extrapolation of the soil moisture dynamics as2 spatial vertical interpolation due to cost constraints researchers tend to place sensors in the vertical direction relatively sparsely sometimes even focusing only on the average soil moisture of the entire soil profile however soil moisture profiles at fine spatial resolutions are required in many practical applications spatial interpolation from sparse observation data is one way to obtain a detailed soil moisture profile the performance of the proposed ge enkfgp in spatial interpolation was examined in this scenario in addition to the constraints from observation data themselves whether the hidden information introduced by their temporal or spatial gradients could provide further constraints for the statistical interpolation was investigated the swc at the two depths of the surface and middle layer were trained and assimilated to estimate the swc values within these two depth ranges for example the swc at z 0 05 m and 0 50 m were used to estimate the swc at z 0 10 m at falkenberg while the swc values at z 0 15 m and 0 35 m at boissy were estimated with the observed data at z 0 05 m and 0 55 m as3 spatial vertical extrapolation compared to the spatial interpolation in as2 the spatial extrapolation in statistical learning techniques is fraught with more potential difficulties malone et al 2016 in particular the rapid advancements in techniques for identifying surface soil moisture mapping information using satellite based remote sensing dubois et al 1995 weidong et al 2002 wigneron et al 2003 zhao and li 2013 has greatly facilitated the idea of utilizing such low cost large scale surface data to infer the entire soil moisture profile however most of these studies have been limited in that they characterize soil moisture in a rather shallow layer normally between 2 and 20 cm deep chen et al 2011 jackson and schmugge 1989 turning to physical models seems to have become the only way to improve vertical extrapolation wang et al 2018 in this scenario the collaborative training of the surface swc and its spatio temporal gradients with the proposed ge enkfgp attempted to provide a fully data driven way to improve the estimation of deep swcs to be specific only the swc at two depths on the surface were trained and assimilated to estimate the deeper swc values for example the swc values at z 0 30 m and 0 45 m were estimated with the observed data at z 0 08 m and 0 15 m at falkenberg in this work the error in the model variable i e soil moisture here was quantified by the time averaged root mean square error rmse 16 rmse 1 t k 1 t î k f î k 2 where î k f represents the mean of n e 50 forecasted soil moisture samples at time k in addition to compare the uncertainty in the soil moisture estimation using different da strategies the standard deviation sd of n e 50 estimated soil moisture samples at time k was also calculated 17 sd 1 n e 1 m 1 n e î k f î k m 2 where m is the ensemble number index in addition to quantify the similarity of any two sets of time series data a a i i 1 n b b i i 1 n the cosine similarity cs was introduced chowdhury 2010 18 cs i 1 n a i b i i 1 n a i 2 i 1 n b i 2 the cs between the two datasets was within the values of 1 and 1 the similarity between these two increased as cs increased 3 results 3 1 application scenario 1 as1 3 1 1 enkfgp vs gb enkfgp vs ge enkfgp fig 3 shows the time averaged rmses between the observed and estimated swcs at various depths at all ten sites overall both the gb enkfgp and ge enkfgp led to lower rmses suggesting that the introduction of gradient information effectively improved the soil moisture estimation accuracy compared with the original enkfgp to be specific the gb enkfgp method exhibited superior performance than the ge enkfgp moreover fig 4 also takes the dahra site as an example to further present the time series of the observed and estimated soil moistures achieved by the enkfgp gb enkfgp and ge enkfgp methods respectively it can be seen that the auxiliary of the gradient information obviously resulted in a more accurate estimation of the peaks and troughs of the soil moisture time series as expected these results demonstrated the advantage of capturing multiple local extrema of the unknown response function using the gradient data in the proposed ge enkfgp chung and alonso 2002b laurent et al 2019 3 1 2 surface vs deep layers fig 3 also reveals that the response of the surface and deep swc estimates differed significantly for such gradient related approaches at some sites the gb enkfgp and ge enkfgp especially ge enkfgp s still performed well in the deep layer at dahra and necedah while at the cape falkenberg boissy and weslaco the fusion of the gradient information improved the deep soil water content retrievals only marginally and even may have worsened its estimation accuracy e g at z 1 00 m this discrepancy may be due to the fact that the temporal variability of swc between the surface and deep layers varied differently as depicted in fig 2 b c d and r fig 5 further shows the temporal daily and spatial vertical gradients of swc at various depths at falkenberg unfortunately a comparison of fig 2 c and fig 5 reveals that the gradient information only further amplified this difference between the surface and deep layers to quantify this amplification effect the cosine similarity cs of the swc as well as its temporal and spatial gradients between the surface layer z 0 08 m and other depths z 0 15 m 0 30 m 0 45 m 0 60 m and 0 90 m at falkenberg were also calculated as listed in table 4 it can be observed that the cs values of the temporal and spatial gradients were always smaller than those of the raw swc time series and this gap widened dramatically with increasing depth for example the cs between the swc time series at z 0 08 m and z 0 90 m was 0 9477 and was much larger than that associated with the temporal and spatial gradients these being equal to 0 0293 and 0 1503 respectively this indicated an increasingly weak similarity between the surface and deep layers if the gradient values of the surface and deep layers were still jointly fused to estimate the soil moisture profile the dramatic temporal variability in the surface swc might instead have disrupted the statistical interpolation of the deeper swc ultimately the enhancement of the gradients failed to reduce the rmse of the deeper swcs to circumvent this drawback one more case was designed where only the surface temporal gradient information was fused into the construction of the gp models and this was labelled as ge enkfgp t cust fig 6 compares the rmse between the observed and estimated swc at the deeper layer using the enkfgp ge enkfgp t and ge enkfgp t cust respectively only the results at three typical sites including falkenberg boissy and weslaco are presented although there was no visible improvement in the performance over the enkfgp the selective utilization of the gradient information in the ge enkfgp t cust indeed substantially reduced the rmse of the deeper swc compared to the ge enkfgp t this largely boosted the robustness of the gradient enhanced approaches for estimating the vertical soil moisture profile 3 1 3 temporal daily vs spatial vertical gradients according to fig 3 there is also an evident difference in the enhancement effect of the temporal and spatial gradients of the swc which essentially depended on their intrinsic physical characteristics in the reconstruction of the soil moisture dynamics fig 7 shows scatterplots between the daily precipitation and the corresponding predicted increments of the soil water in the entire one meter soil column using the enkfgp gb enkfgp and ge enkfgp t here only the scatterplots at the cape are presented the result showed that the values of r 2 with the methods that used the temporal daily gradients were significantly higher than that of the enkfgp r 2 0 293 additionally the slope of the fitted curve for the former was also nearer to one especially for the ge enkfgp t these results indicated that the introduction of temporal gradients of the soil water content was able to render the fully data driven gp models to implicitly obey the law of conservation of mass to some extent through the straightforward mapping from external forcing terms such as rainfall to the daily increments of the soil moisture furthermore a comparison of fig 5 a and 5b also shows that the temporal gradients had significantly more substantial variability in the vertical direction than the spatial gradients as shown in table 4 the temporal gradient between the surface layer and z 0 90 m caused a more pronounced amplification effect with cs 0 0293 compared to the vertical gradient cs 0 1503 which also accounts for the inferior robustness of ge enkfgp t compared to ge enkfgp s for example as depicted in fig 3 c the rmses of the ge enkfgp s at z 0 60 m and 0 90 m were not unacceptably larger than that of the ge enkfgp t at falkenberg 3 2 application scenario 2 as2 fig 8 shows the time averaged rmses between the observed and predicted soil moistures at the depths of interest in as2 with the enkfgp gb enkfgp and ge enkfgp respectively the corresponding time series of swc are also depicted in fig 9 only the results at six sites presented here to avoid too many figures similar to as1 overall the enhancement of the gradient information especially ge enkfgp s produced a better estimation of the swc with smaller rmses than the original enkfgp method in this spatial interpolation scenario however the opposite result occurred at the upperbethlehem as depicted in fig 8 i slightly larger rmse values with the ge enkfgp t and ge enkfgp s than those with enkfgp can be observed at z 0 10 m and 0 20 m at this site furthermore the gradient data were still able to successfully capture the locally changing behaviors of the soil moisture dynamics in as2 fig 9 this was particularly pronounced in the retrievals of the extremes and troughs as highlighted in the black dashed rectangular boxes in fig 9 b and 9d however unlike in as1 the gb enkfgp that utilized only the daily gradients exhibited a considerably less robust performance in as2 for example its rmse values at z 0 20 m for the cape and z 0 15 m for falkenberg were much greater than those found using the enkfgp 3 3 application scenario 3 as3 fig 10 and fig 11 present the time averaged rmses between the observed and predicted soil moisture at the deeper layer and the corresponding time series in as3 using the enkfgp gb enkfgp and ge enkfgp respectively it can be seen that the vertical gradient enhanced method i e ge enkfgp s maintained a relatively stable improvement performance in as3 although the extent of this rmse reduction gradually diminished with increasing depth of interest as shown in fig 10 c the rmse at z 0 30 m for falkenberg decreased from 0 034 with the enkfgp to 0 026 with the ge enkfgp s while both methods produced almost the same rmses at z 0 45 m inferior to the ge enkfgp s the robustness of the ge enkfgp t deteriorated even in the shallower layer e g at z 0 20 m for the cape fig 10 b and weslaco fig 10 j nevertheless it is worth noting that despite an increase in the time averaged rmse its reproduction for some key points e g peaks was still quite promising as highlighted in the black dashed rectangular boxes in fig 11 b in contrast the gb enkfgp performed the worst under this scenario of spatial extrapolation in addition to the above analysis for estimation accuracy figs s1 s3 also depict the spatio temporal patterns of standard deviations sd of n e 50 estimated ensemble members of the swc at all nodes using various nonparametric da schemes in the as as2 and as3 respectively only the results in six typical sites are presented in summary the retrieved soil moisture profile from the gb enkfgp suffered from the highest uncertainty in all three application scenarios 4 discussions 4 1 application scenario 1 as1 the optimal performance of gb enkfgp in the temporal extrapolation scenario as1 was likely because the forecasted variables i e daily increments of swc in the gb enkfgp were not used directly for assimilation as in the ge enkfgp but instead first compensated to the posterior estimate of the previous time step this reliance on previous estimates vastly reduced the potential risk of performance collapse due to unreasonable temporal extrapolation in the face of unknown future scenarios however this also implied that its predictive uncertainty of the swc not only stemmed from the n e 50 gp models but also included the uncertainty of the previous moment s posterior estimates hence the highest uncertainty of the soil moisture estimation with the gb enkfgp was observed in the second column of fig s1 the introduction of temporal gradients of the swc in the ge enkfgp t was able to render the fully data driven gp models to implicitly obey the law of conservation of mass to some extent as for the vertical gradient assuming that the soil column was homogeneous the vertical gradient of the swc at any two nodes was equivalent to the hydraulic gradient between these two which provided the driving force for the vertical infiltration of water into the soil more precisely stated the vertical gradient of the swc between the two nodes imposed a physical upper boundary constraint on the soil they controlled this implicit constraint mechanically enabled the spatial gradient to enhance the accuracy of the swc estimation within the nonparametric da framework moreover the discrepancy between surface and deep layers was most likely associated with the delayed response of the swc profiles to rainfall events the strength of this delay is often controlled by various complex factors such as soil texture rainfall intensity antecedent swc etcetera unlike the dahra with the fraction of sand up to 90 and ks 3 22 m d and necedah with the fraction of sand up to 83 and ks 1 24 m d the cape ks 0 10 m d boissy ks 0 14 m d and weslaco ks 0 15 m d sites had a clayey soil texture resulting in a significantly weaker soil infiltration capacity for the falkenberg although its ks is as high as 0 63 m d the overall low rainfall intensity also made its deep swc z 0 60 m and 1 00 m almost unresponsive to rainfall ultimately this inconsistent response of surface and deep swc to rainfall events led to poor performance of gradient enhanced especially ge enkfgp t in the deep layer these results demonstrated the promising feasibility of the proposed gradient related approaches in sandy soils while alerting to the challenges of their applications in clayey soils or more precisely in areas with long rainfall infiltration delays to alleviate this adverse effect of this delay effect as described above the most straightforward strategy is to only fuse the surface gradient information with strong temporal variability into the gp system furthermore another possible way to mitigate this time delay effect is to introduce the idea of recurrent neural networks rnns in long short term memory lstm to explore the memory response of deeper swc to antecedent rainfall events many previous studies have shown that lstm can solve complex long time lag problems chen et al 2020b hochreiter and schmidhuber 1997 kratzert et al 2018 the influences of multiple factors such as soil texture as well as rainfall frequency and intensity on the determination of the lag time step in our soil water flow problems are fascinating but complex the gradient enhanced nonparametric da scheme guided by this idea will be investigated in future studies 4 2 application scenario 2 as2 and application scenario 3 as3 unlike in as1 the gb enkfgp method faced a considerable risk of performance collapse in both as2 and as3 scenarios for the swcs at depths of interest their posterior estimates tended to have poor accuracy due to the absence of any training and assimilation of historical data at those depths the bias caused by the scarcity of training data at the beginning of the simulation may have accumulated over time finally the predicted time series curves deviated far from the actual observations during the later stages of the simulation especially at z 0 20 m for the cape fig 9 b and 9d and z 0 35 m and 0 55 m for the boissy fig 11 f and 11i this substantially offsets the benefits derived from the posterior estimates at the previous moment in the gb enkfgp the still apparent superiority of the ge enkfgp s over the original enkfgp in as2 and as3 was naturally attributed to the mass conservation constraint hidden within the temporal gradient and the implicit upper boundary constraint from the spatial gradient the anomaly in as2 at upperbethlehem may be due to distinct soil stratification in the 0 00 0 50 m depth range and the infiltration capacity of the lower soil layer was much lower than that of the upper soil layer this resulted in a much higher swc at z 0 10 m and 0 20 m depths than at z 0 05 m and 0 50 m fig 2 q throughout the simulation period under this circumstance it is almost impossible to interpolate and estimate the middle swc in a purely data driven manner using only surface and deep swc data this is not only a defect of our proposed gradient enhanced nonparametric da scheme but also an insurmountable challenge for purely data driven algorithms in addition the weakness of ge enkfgp t relative to ge enkfgp s was enlarged in as3 this inferiority was particularly evident at those sites with longer delayed responses of swc profiles to rainfall events e g falkenberg cape and weslaco this recalls that in as1 the temporal gradient enhanced method had poorer robustness than the spatial one due to the weaker similarity of the surface and deeper swc fig 5 and table 4 in the vertical extrapolation scenario of as3 where only the surface swc was trained and assimilated this gap was inevitably exposed again and intensified as the depth of interest increased 5 conclusions in this study the gradient enhanced version of the nonparametric data assimilation scheme ge enkfgp was proposed to exploit the auxiliary worth of spatio temporal gradients of the soil water content in the reconstruction of soil moisture dynamics unlike previous physics informed approaches this study attempted to introduce additional physical constraints into the proposed nonparametric da framework directly from the data itself via a gradient enhanced gp regression within the proposed ge enkfgp framework the causal relationship hidden in the mapping from the gp input terms e g daily precipitation to the temporal daily gradients of the soil water content preserved the constraint of the law of mass conservation to some extent more simply and straightforwardly in addition the spatial vertical gradients between any two nodes enhanced the soil moisture profile retrievals by implicitly providing the driving force or upper boundary of dynamic systems to reinforce our understanding of the contributions of raw soil moisture data as well as its spatial and temporal gradients in soil moisture dynamics multiple versions of the model free da schemes i e the original enkfgp gb enkfgp and ge enkfgp were compared their performances in the three most typical application scenarios including as1 temporal extrapolation as2 spatial interpolation and as3 extrapolation were also tested the following conclusions were drawn 1 when historical data on the soil water content at the depths of interest are available the introduction of gradient information in the gb enkfgp and ge enkfgp methods led to better estimation than the initial enkfgp due to their more accurate identification of multiple local extrema the gb enkfgp which solely used the spatial gradients of the swc to construct the gp models resulted in the optimal swc retrievals but also had the largest uncertainty the enhancement effect of the spatial gradient information was more robust than the temporal gradients subject to the delayed response of the soil moisture profiles to rainfall events such gradient related algorithms exhibited superior performance in the estimation of surface soil water content than that in the deeper layer therefore in order to enhance their robustness one modified algorithm where only surface gradient information was augmented into the construction of the gp models was recommended 2 the hidden information in the gradient data within the ge enkfgp framework was effective in improving the accuracy of the vertical interpolation to produce soil moisture profiles at finer spatial resolutions in contrast the gb enkfgp method in as2 tended to degrade possibly due to the scarcity of available swc historical data at the depths of interest 3 in as3 where the deeper soil water content was inferred using easy to access surface data the spatial gradient enhanced nonparametric da scheme i e ge enkfgp s was overall relatively robust in yielding the optimal deeper swc estimates however the implementation of gb enkfgp and ge enkfgp t ran the risk of triggering a performance collapse this robustness difference depended primarily on the soil texture and the spatial distance between the depth of interest and the available observation depth the more clayed the soil texture was the farther the depth of interest was from the surface layer the less robust the gradient related algorithms were under the scenario of statistical extrapolation credit authorship contribution statement yakun wang methodology software writing original draft liangsheng shi writing review editing supervision qiuru zhang methodology han qiao writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work was supported by the national natural science foundation of china grants 51861125202 and 51979200 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2021 126857 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
4112,identifying groundwater dependent ecosystems is the first step towards their protection this paper presents a machine learning approach that maps groundwater dependent ecosystems by extrapolating from the characteristics of a small sample of known wetland and non wetland areas to find other areas with similar geological hydrological and biotic markers explanatory variables for wetland occurrence include topographic elevation lithology vegetation vigor and slope related variables among others supervised classification algorithms are trained based on the ground truth sample and their outcomes are checked against an official inventory of groundwater dependent ecosystems for calibration this method is illustrated through its application to a unesco biosphere reserve in central spain support vector machines tree based classifiers logistic regression and k neighbors classification predicted the presence of groundwater dependent ecosystems adequately 96 test and auc scores the ensemble mean of the best five classifiers rendered a 90 success rate when computed per surface area this method can optimize fieldwork during the characterization stage of groundwater dependent ecosystems thus contributing to integrate wetland protection in land use planning keywords machine learning wetland protection groundwater dependent ecosystems wetland management big data mancha occidental aquifer 1 introduction wetlands comprise some of the most productive ecosystems of the world and provide a wide range of environmental services to humans mea 2005 these include but are not restricted to flood control groundwater replenishment shoreline stabilization in coastal areas nutrient cycling water purification and support to fauna and flora as well as important cultural and recreational values despite their environmental and economic significance the world s wetlands are slowly disappearing the ramsar convention estimates that two thirds have been lost since 1900 rcw 2015 this problem is particularly acute in the case of inland ecosystems as well as in the asian and european continents take for instance the case of spain whose total wetland surface has shrunk by 60 in the last decades de la hera et al 2011 causes should be found in historical factors such as disease prevention campaigns and the need for new arable lands but also in major changes in land use and water diversion through dams and canals and intensive groundwater pumping revenga et al 2000 martínez santos et al 2018 despite growing awareness about the intrinsic value of wetlands economic development continues to be favored over environmental conservation this is largely because wetlands and their ecosystem services often are not well quantified and are therefore difficult to incorporate into decision making and conservation planning chen et al 2014 wetland protection is most effective when coordinated with water and land use policies in this context the role of ecosystem services remains in need of wider recognition and there is still room to improve the strategies that integrate them in land management mitsch et al 2015 aristizábal and martínez santos 2019 furthermore it is important to acknowledge that wetland functioning is controlled by factors that occur at different temporal and spatial scales which makes ecosystem management and protection all the more complex de la hera et al 2016 this research is specifically concerned with the development of tools to facilitate the conservation of groundwater dependent ecosystems gdes that is those natural ecosystems that require access to groundwater to meet some or all of their water requirements on a permanent or intermittent basis nwc 2011 the concept of groundwater dependent ecosystem takes into account the physical chemical and biological linkages between aquifers and associated subterranean and surface water bodies rohde et al 2017 cantonati et al 2020 while also giving due importance to the need to maintain plant and animal communities ecosystem processes and ecosystem services a common point to groundwater dependent ecosystems is the emergence or near emergence of the water table above the topographic surface ec 2011 usfs 2012 when groundwater arises at a point location it typically results in a spring or seep wetlands are similar except that groundwater discharge takes place in a diffuse manner across a larger area in certain classifications groundwater dependent ecosystems also include underground environments such as caves springer and stevens 2009 the first step in protecting a groundwater dependent ecosystem is to identify its very existence establishing whether a wetland is dependent on groundwater can be difficult partly because there can be a continuum between groundwater dependent ecosystems and those ecosystems dependent on other water sources and partly because human intervention may have desiccated the wetlands a long time ago ec 2011 these factors can be even more difficult to assess in the case of crypto wetlands i e wetlands underpinned by a shallow water table that do not have a standing water table but that present permanent or semipermanent phreatophyte vegetation unesco 2019 while the local scale dependency of ecological communities on groundwater can be established based on hydrological geomorphological physico chemical and biological methods approaches that rely on a combination of expert criteria remote sensing and other sources have proven efficient over large regions doody et al 2017 flooded surfaces and flood prone areas can be readily identified from remote sensing products degiorgis et al 2012 maxwell et al 2016 chignell et al 2018 these allow for the delineation of water bodies with a high degree of confidence however satellite images do not necessarily provide a univocal answer when dealing with crypto wetlands furthermore widespread irrigation may detract from the effectiveness of vegetation based indicators in semiarid regions it is in these context where alternative approaches are required to identify groundwater dependent ecosystems that may otherwise pass unnoticed the goal of this paper is to present and validate a machine learning approach to map groundwater dependent ecosystems based on a set of ground truth examples the method relies on several supervised classification algorithms which are applied to identify those variables that better explain the presence of groundwater dependent wetlands machine learning furthers the capabilities of natural resources mapping which traditionally relied on expert criteria simple addition analytical hierarchical processes and or geospatial interpolation the use of machine learning algorithms is becoming increasingly common in the environmental literature li et al 2017 walsh et al 2017 naghibi et al 2017 ceh et al 2018 díaz alcaide and martínez santos 2019a supervised classification is a type of machine learning technique that consists of developing estimates for a target variable based on a series of known examples and explanatory variables supervised classification has been used to map vegetation communities ohmann and gregory 2002 von wehrden et al 2009 mineral resources schetselaar et al 2008 groundwater potential areas chen et al 2018 díaz alcaide and martínez santos 2019a fecal contamination in domestic wells díaz alcaide and martínez santos 2019b and landslide susceptibility pham et al 2016 among other spatially distributed variables using machine learning approaches to map groundwater dependent ecosystems is perceived as a methodological contribution in several ways for one while machine learning has been used in the past for spring mapping ozdemir 2011a naghibi et al 2015 the literature showcases very few precedents in the context of the protection of wetlands and other types of aquatic ecosystems furthermore this technique represents a complement to traditional expert based approaches and may provide additional insight in environmental management practices by harnessing the potential of big data approaches to delineate ecosystems dependent on groundwater whose presence might otherwise pass unnoticed from a site specific perspective the outcomes are meaningful enough to inform regional land use policy 2 methods 2 1 study site the machine learning approach is illustrated through a well known set of groundwater dependent wetlands located in central spain fig 1 these are all part of the mancha húmeda unesco biosphere reserve unesco 1980 the largest one las tablas de daimiel is listed under the ramsar convention it is also a national park since 1973 de la hera and villarroya 2013 the study area has been described from the hydrogeological perspective by several authors martínez santos et al 2018 it is best described as a vast plain that slopes gently over 150 km from sw 600 m a s l to ne 730 m a s l the region presents a continental semiarid climate where short wet periods alternate with long dry spells the long term average rainfall 1904 2014 is 405 mm yr with a yearly maximum in excess of 700 mm 1969 and 2010 and global minima of about 170 mm 1938 and 2005 average monthly temperatures range between 5 c in january and 26 c in july the mean standing at 15 c the drainage network is poorly defined thus favoring surface groundwater interactions the region s wetlands are fed by the mancha occidental aquifer system a groundwater body which spans 6100 km2 under its current administrative boundaries and whose thickness exceeds 400 m in some areas fig 2 the mancha occidental system comprises four major hydrogeological units the upper aquifer is made up of unconfined highly transmissive miocene materials these overlay a low permeability marly aquitard which partially separates the miocene unit from the semi confined limestone aquifer found immediately below the impervious basement is made up of triassic and paleozoic materials the ensemble of both permeable units the aquifer hereon presents excellent conditions for groundwater development transmissivity exceeds 20 000 m2 d in some areas while the mean specific yield is 2 5 igme 2004 this explains why the region is subject to intensive pumping since the early 1970s groundwater irrigated agriculture grew six fold between 1975 and 2006 from 30 000 ha to 180 000 ha martínez santos et al 2018 for years pumping nearly doubled the long term replenishment rate of the aquifer this caused the water table to drop by a rate of 1 2 m yr during that interval igme 2004 mejías moreno et al 2012 changes in groundwater flow patterns took place as a result triggering major alterations in the water balance local subsidence collapses and the spontaneous combustion of peatlands llamas and fornes 2004 castaño castaño et al 2008 moreno et al 2011 most importantly however most groundwater dependent wetlands as well as rivers guadiana záncara cigüela and azuer dried up llamas 1988 llamas et al 1992 castaño castaño et al 2008 martínez santos et al 2008 an exceptionally wet period 2006 2010 resulted in a major recovery of the aquifer martínez santos et al 2018 the water table rose significantly up to 20 m in some areas fig 3 around 2011 2012 some of the main groundwater dependent ecosystems including las tablas de daimiel national park and the ojos del guadiana springs experienced aquifer discharge for the first time since the mid 1980s this trend continued for several years thus allowing for the study of ecosystem dynamics and long term changes in wetland water quality castaño castaño et al 2018 de la hera 1998 carried out a thorough assessment of the region s groundwater dependent ecosystems based on the national inventory of wetlands dgoh 1991 this author defined two major wetland areas in the mancha occidental aquifer one towards the northern part of the system zancara area and another one towards the west daimiel area fig 1 both presented some degree of degradation at the time of that study due to intensive pumping about 42 had completely dried up in the zancara area and 69 in daimiel these findings together with some wetlands of minor importance identified means of satellite imaging constitute the baseline inventory for the ensuing analyses de la hera 1998 2 2 predictive mapping software this research uses mlmapper 2 0 this is the first evolution of mlmapper 1 0 a qgis 3 2 plugin coded in python 3 6 that performs multilayer pattern recognition to develop predictive maps based on point source ground truth martínez santos and renard 2019 aside from all the functionalities of its previous version the software now incorporates a number of new automated routines these include collinearity checks recursive feature elimination feature number optimization randomized search parameter fitting and k fold cross validation mlmapper integrates seven new supervised classification algorithms of the scikit learn 0 24 1 toolbox pedregosa et al 2011 which brings the software s total number algorithms up to twenty this large number of classifiers provides the user with a wide array of computational alternatives as well as the possibility of performing ensemble mapping automatically the underlying principle is to apply as many algorithms as possible to a given problem and then perform an ensemble of the results of those which exceed a suitable performance score those algorithms that perform poorly on the input dataset are discarded mlmapper currently includes support vector machines svm linear vector machines lvm logistic regression lrg decision tree classifier crt random forest classifier rfc k neighbour classification knn linear discriminant analysis lda gaussian naïve bayes classification nba multilayer perceptron neural network mlp ada boost classifier abc quadratic discriminant analysis qda gradient boosting classification gbc gaussian process classifier gpc ridge classifier rid stochastic gradient descent linear classifier sgd perceptron prc nearest centroid classifier ncc multinomial naive bayes classifier mnb complement naive bayes classifier cnb and extra trees classifier ext the underlying principles of each of these algorithms have been thoroughly discussed in the literature kotsiantis 2007 hastie et al 2009 pedregosa et al 2011 2 3 conceptual model target and explanatory variables mlmapper follows a classic machine learning workflow characterized by the sequential application of data input feature correlation and selection data split feature optimization recursive feature elimination parameter optimization and prediction fig 4 in this case the latter step consists in spatial extrapolation of the results into a map for the purpose of the ensuing sections the target variable is a binary outcome that defines the presence or absence of gdes at each location of the study site explanatory variables or model features are those elements expected to constrain the presence or absence of gdes to some extent a key assumption of this research is that the occurrence of groundwater dependent ecosystems may be inferred from a combination of geological geomorphological hydrogeological and biological variables cantonati et al 2020 point out that from the hydrogeological standpoint wetland classifications rely on a number spatially distributed variables among others these include parent rock geology lithology stratigraphy structural geology of the groundwater basin discharge driving forces gravity pressure or density temperature dominated discharge groundwater quality and the geomorphology around the outlet with that in mind fig 5 and table 1 present the spatial distribution and the reclassification values of the explanatory variables considered in this study these include lithology water table elevation ndvi flow accumulation potential slope topographic wetness index soil type and permeability their importance will be discussed in the following paragraphs geology plays an important role in gde dynamics lateral lithological changes result in local permeability contrasts that favor the rise of shallow groundwater to the surface in certain cases the density and orientation of faults and fractures may constrain groundwater flow defining preferential paths that lead to the accumulation of water at the surface this may also create a moist environment that allows for the development of certain soil features while also providing adequate living conditions for fauna and flora gdes typically occur in valleys and depressions where the water table intersects the topographic surface this implies that both topography and the elevation of the water table are likely predictors for gde occurrence slope and slope related parameters steepness curvature topographic wetness index can also be expected to behave as explanatory variables as these control the accumulation of water above the surface changes in slope may also prove relevant in marking the edges of a wetland satellite surveillance reveals potentially important information about the presence of wetlands particularly in arid and semiarid climates this is typically captured by vegetation related indices like the ratio vegetation index the vegetation index number the differenced vegetation index and the normalized difference vegetation index ndvi bannari et al 1995 xie et al 2008 the latter is widely used due to its ease of calculation and to its sensitivity to changes in vegetation patterns xue and su 2017 it is also useful for the identification of flooded areas because exposed water surfaces typically present low and uniform ndvi values moreover in the absence of irrigation patches of vigorous vegetation at the end of the dry season can be interpreted as a proxy for permanent springs or a shallow water table 2 4 algorithm training and testing two databases must be prepared prior to running mlmapper the first one contains ground truth data and is used to train and test the machine learning algorithms the ground truth database comprises a suitably large number of points with the coordinates of each point the known outcome of the target variable and the pixel score for each gis layer explanatory variables the second database is a list of all pixel values for all layers also with coordinates this second database is used to extrapolate the results and build the gde map mlmapper first carries out a collinearity test for the entire input dataset collinearity occurs when two or more explanatory variables present a high degree of correlation and represents a problem because the regression coefficients of certain algorithms mat not be uniquely determined variables found to be redundant are eliminated prior to running the models mlmapper then splits the ground truth database into independent training and testing datasets training is the process whereby algorithms learn the patterns of explanatory variables that lead to the presence or absence of gde at each pixel at this stage each algorithm has access to the target outcome so that it can establish the combinations that lead to a positive or negative outcome the training score refers to how successfully each algorithm is able to explain such patterns the test phase is where the algorithms are prompted to predict the outcome of a given combination of explanatory variables during this part of the process the outcome is no longer known to the algorithms these must estimate it correctly based on what they learned during the training phase the test score is obtained by comparing estimates to the actual outcomes it thus represents the predictive accuracy of each algorithm on a scale of 0 to 1 where 0 means that all predictions made by the algorithm were wrong and 1 that the predictions where 100 accurate a 0 5 score suggests that the predictions are no better than a random choice the proportion of the ground truth database used for training and testing typically ranges between 50 50 and 80 20 train test this split is randomized but remains roughly proportional to the number of target classes in the input dataset in the case of a binary problem such as the one at hand it is convenient to work with a similar number of positive and negative outcomes in order to minimize bias in test scores the ground truth database comprises 150 entries out of which 75 are known wetland points distributed among a sample of six major wetlands and 75 are known non wetland points distributed randomly all over the aquifer fig 1 in practice this means that 6 of the 20 wetland polygons in the zancara area and 3 out of the 12 in the daimiel area are used to train the algorithms the latter are then required to identify the remaining 23 polygons as wetlands based on the associations that were developed during training since each algorithm relies on different mathematical principles a range of algorithm performances can be expected for a given input dataset due to the intrinsic complexity of machine learning models it is difficult to predict which one will be more suitable in each case mlmapper tackles this issue by using a large number of classifiers and then picking the ones that render the best results algorithm performance is typically assessed based on a set of user specified metrics typically test score and area under the receiver operating characteristic curve auc a simple ensemble mean of the best performing classifiers is developed subsequently in order to show the degree of agreement among them the outcome can also be interpreted as a proxy for uncertainty certain algorithms allow for recursive feature elimination variables that turn out to be either indifferent or counterproductive are eliminated from the conceptual model this process also allows for the optimization of the number of input features during this process mlmapper uses automated parameter tuning to optimize algorithm performance for this it picks the best result out of running grid search and randomized search parameter fitting routines on each algorithm both these routines incorporate 10 fold cross validation finally mlmapper gives the user a choice as to whether to extrapolate the results to produce a predictive map individual maps are developed for all classifiers based on what the algorithms learned during the training and testing processes this is an optional feature because the process of building the map can be time consuming 2 5 simple subtraction map in theory a map representing simple subtraction of the water table elevation from the digital elevation model would render an accurate depiction of the flooded areas this approach could contribute to the identification of ecosystems underpinned by a shallow water table if a suitable degree of tolerance were applied thus several simple subtraction maps were developed for comparison purposes these were computed by taking away the elevation of the water table in september 1974 earliest on record from the 5 m mdt50 series of the high resolution national dem provided by the geographical institute of spain tolerances of zero to five meters below the surface were defined to allow for the representation of crypto wetlands 3 results feature collinearity is evaluated by means of pair wise correlations between explanatory variables a discrimination threshold of 0 70 is commonly used although values between 0 40 and 0 85 can be acceptable depending on the circumstances dormann et al 2013 fig 6 shows the correlation matrix results are expressed by means of a colour scale where a value of 1 0 represents a perfect inverse correlation and a value of 1 0 represents a perfect direct correlation direct correlation between explanatory variables were found to range between 0 7 and 0 7 in all cases thus no explanatory variable was excluded from the conceptual model table 2 presents standard performance metrics for all algorithms a wide range of classifier families yielded test scores in excess of 0 90 these include tree based classifiers support vector machines logistic regression and k neighbours classifiers among others tree based classification proved particularly adept at predicting the occurrence of groundwater dependent ecosystems as all three tree based algorithms rfc ext crt made it into the top six performers conversely sgd prc and lvm rendered a very low predictive potential 0 51 in terms of test score there is a clear break between the best six classifiers all of which exceeded 0 96 and the seventh one lda which scored 0 91 therefore a discrimination threshold of 0 96 was defined this means that all algorithms rendering a lower test score were discarded for the purpose of ensemble mapping crt was also left out to simplify the ensuing discussion as this classifier is essentially a less sophisticated version of ext and rfc parameter descriptions for each of the top five algorithms and their optimized values are presented in table 3 fig 7 displays the outcomes of recursive feature elimination optimized tree based classifiers rfc ext maximized their outcome when relying exclusively on four out of the nine explanatory variables namely dem lithology permeability and water table elevation in contrast lrg and svm attributed some importance to all variables except for the topographic wetness index knn uses an approach based on the distance between input points and similitude among possible outcomes this does not allow for recursive feature elimination or computing feature importance which means that knn was dealt with separately fig 8 presents feature importance for the tree based classifiers feature importance is computed both in terms of weighted importance the sum of all variable weights equals one and in terms of permutation feature importance the main difference between the two classifiers is the relative importance of lithology and water table elevation as ext places a greater emphasis on the former while rfc stresses the latter topographic elevation and permeability are the most and least important features in each case respectively svm and lrg present feature importance results in terms of coefficients table 4 both attribute the greatest importance to ndvi and rely heavily on lithology there is an inverse consideration to the second most important parameter svm uses slope preferentially and attributes little weight to soil whereas lrg does the exact opposite dem flow accumulation permeability and elevation of the water table are relatively unimportant in both cases in the case of knn feature importance was calculated by means of feature subtraction that is by removing one explanatory variable at a time and evaluating the effect on test score knn relies chiefly on the dem the water table elevation slope lithology and permeability flow accumulation and topographic wetness index had a negligible effect on the results soil and ndvi were found to be counterproductive i e the overall test score dropped by taking each of these variables under consideration figs 9 and 10 present the map outcomes for each of the five classifiers as well as for the simple ensemble mean in the case of individual classifiers blue pixels represent areas labelled as gde whereas red pixels mean non gde the ensemble mean is the arithmetic mean of all five algorithms for each pixel colors therefore represent the degree of agreement among classifiers blue pixels mean that all classifiers agreed on a positive outcome 1 whereas red means that all classifiers labelled the pixel as negative 0 green orange and yellow reflect different degrees of agreement disagreement thus providing a measure of uncertainty there seems to be a good spatial correlation between the machine learning classifiers and the existing inventory of wetlands local inaccuracies are however observed these could be partly attributed to the regional nature of this study as well as to imprecisions in input data more specifically an important input variable for most classifiers the water table map presents some known shortcomings that stem from its reliance on old data records the elevation of the natural water table mid 1970s is based on a sample of about 100 wells which represents a density of one reading in 60 km2 while this is sufficient to define the main groundwater flow patterns at the aquifer scale further detail could be needed to depict local conditions furthermore the piezometric dataset is not entirely consistent as there is a spread of several weeks in the dates in which the original field measurements were collected finally it must be borne in mind that the 1974 conditions respond to the oldest available records which are the closest to a natural state it is however known that the aquifer was already subject to some degree of groundwater extraction in the late 19th century and that some of the most fragile wetlands had been lost by the 1970s martínez cortina 2003 de la hera 2003 these factors could all explain why the algorithms fail to detect the smaller wetlands in the zancara area martínez santos et al 2021 show that standard machine learning metrics do not necessarily provide an unequivocal measure of algorithm performance and contend that case specific indicators could provide additional insights a suitable additional benchmark in this case could be the total surface area correctly identified as groundwater dependent when appraising the results in these terms the rfc classifier identified 93 3 of the wetland area in the official inventory ext 86 5 svm 86 1 lrg 85 8 knn 84 1 and the ensemble mean 90 3 table 5 an important consideration is that some wetland boundaries in the official inventory exceed the actual boundaries of gdes attaining a value of 100 per surface area would therefore be unrealistic besides the official inventory includes some wetlands that not experiencing direct groundwater recharge are the result from the accumulation of upstream spring flows this could well explain why most classifiers fail to identify the alcahozo chico navalengua and melgarejo lagoons table 5 this is consistent with the fact that most classifiers identify groundwater discharge areas immediately upstream the official inventory is a suitable benchmark for comparison in the sense that it provides much needed ground truth however the list of springs and wetlands is not necessarily comprehensive the fact that the total surface labelled as gde by all five classifiers is larger than that in the inventory suggests that there are many other areas whose characteristics would justify the existence of ecosystems underpinned by shallow water tables fig 11 all five classifiers in fig 9 depict a highly likely spatial distribution of gdes blue regions highlight the areas of the aquifer which have been identified as gde prone these have traditionally been considered natural discharge areas knn provides the sole exception with a blue sw ne band that runs along the southern sector of the system this seems to be associated with the lithology layer based on the elevation of the water table this is unrealistic which is the reason why knn is removed from the mapping ensemble in fig 10 on a final note simple subtraction identified correctly 80 9 of the actual wetland area which is considerably less than all five machine learning classifiers this leads to the conclusion that machine learning provides a more robust approach than simple subtraction by incorporating additional variables as explained above a comparatively worse performance on the part of the simple subtraction method possibly stems from the absence of a sufficiently precise representation of the quasi natural water table this can be problematic to obtain in regions with few observation wells or in heavily modified aquifer systems such as the one at hand where old data records are needed to recreate pristine conditions 4 discussion wetland characterization has often been conducted on the basis of soil water and vegetation factors corwardin 1979 brinson mark 1993 but there is no international consensus as to the methods that should be applied at different spatial scales to a large extent this is because the knowledge base in each site is different and often controlled by the domain in which researchers have worked preferentially furthermore a frequent problem at the regional scale is the imbalance of information while the better known wetlands such as las tablas de daimiel national park in the case at hand can be well characterized from multiple perspectives basic data may be lacking for many other groundwater dependent ecosystems in this context wetland surface area under pristine conditions is a key element in environmental protection efforts for it allows us to delineate wetland influence areas retrospectively as well as to estimate the degree of degradation each ecosystem has experienced over time in intensively exploited aquifers where wetlands disappeared long ago estimating the natural wetland surface area requires innovative techniques this is where supervised classification algorithms may provide an added value a major difference between the approach presented in this paper and the standard supervised classification tools that usually come with gis platforms is that mlmapper uses several variables simultaneously in order to determine whether a given pixel should be labeled gde or non gde in other words multi layer classification allows us to take into account several gis layers simultaneously overall the resulting area of gde occurrence is noticeably larger than the field inventory figs 9 and 10 this is because the existing inventory only caters to springs and wetlands but not so much to crypto wetlands or gaining river reaches in this context the results imply that the area where groundwater underpins surface ecosystems could be ten times larger than the surface currently delineated as wetlands in this regard the machine learning approach is best described as an aprioristic method that allows us to identify zones where shallow water tables may be of environmental significance this finding could be used to inform land use planning and the delineation of wetland protection buffers as well as to locate areas where wetlands dried up in the past due to intensive pumping additionally an approach such as this one could optimize the costs associated with fieldwork in remote or scarcely known areas in relation to the explanatory variables the importance of the topographic elevation in predictive spring mapping is consistent with the literature for instance martínez santos et al 2021 applied random forests and support vector machines to delineate aquatic ecosystems in a tropical colombian catchment characterized by the coexistence of abrupt and flat areas these authors found the presence of aquatic ecosystems to be constrained by landforms water table depth slope and slope related indices topographic wetness index stream power index they also stressed the importance of using a high resolution digital elevation model naghibi et al 2015 applied tree based methods including random forests to predict spring occurrence in a karst basin of iran topography drainage density and the presence of faults were found to be adequate predictors while land use plan curvature and profile curvature were less important the work by dadgar et al 2017 in a different region of the same country suggests that topography and slope could be the major factors determining spring occurrence while geology stream density and lineaments had relatively little weight on the results finally chen et al 2018 combined weights of evidence logistic regression and functional tree models to predict spring occurrence in a catchment of northern china they found distance to streams altitude and lithology to be the key variables explaining spring presence whereas land use ndvi and plan curvature ranked among the least important most of the studies mentioned above deal specifically with spring occurrence their findings are relevant in the context of this work because springs like groundwater dependent wetlands are points of aquifer discharge however springs may take place in steep slopes and other places where wetlands are unlikely this means that some degree of variability can be expected in terms of the explanatory variables they used and the ones we considered in our research take for instance the elevation of the water table while this parameter is relatively uncommon in spring potential studies it is crucial for wetland identification conversely major landforms faults and fractures may be important to identify wetlands in mountain catchments but perhaps not so relevant in large plains such as the mancha occidental aquifer much like it happens with the classification of springs which typically escapes standardization springer and stevens 2009 this all suggests that the preferred set of explanatory variables to map wetland potential should be picked based on case specific considerations in this sense it is acknowledged that a potential indicators of gdes are vegetation communities gdes can have unique vegetation communities and the presence or absence of these vegetation communities or indicator species could potentially help identify gdes that have become degraded vegetation data particularly older vegetation maps potentially could be used as training and verification data to help identify other gdes in our case however such data was unavailable a similar reasoning applies to classification algorithms ozdemir 2011a and ozdemir 2011b found frequency ratio and weight of evidence approaches to outperform logistic regression at identifying springs in a basin in southern turkey similarly naghibi et al 2015 found the decision tree classifier to be more accurate than the rfc in mapping groundwater potential in iran along the same lines our research shows that different algorithms can render very different test scores on an identical dataset this implies that including a large number of classifiers from the outset like we propose in this research could contribute to optimize the outcomes in a wide range of circumstances in the case at hand tree based algorithms were observed to outperform most other supervised classification families both in terms of raw test score surface area and number of explanatory variables required for mapping this suggests that the tree based algorithms may be particularly efficient at mapping gdes by taking permeability and lithology under consideration they actually improved the outcomes obtained by simple subtraction when computing the results in terms of the total surface area correctly identified as gdes 5 conclusions adequate characterization is a prerequisite for the protection of groundwater dependent ecosystems particularly in regions where springs and wetlands are at risk of disappearing due to anthropogenic factors attempts to delineate protection buffers should always take into account the fact that a significant part of the environmental value of groundwater is hidden beneath the surface and that ecosystems underpinned by shallow water tables may extend across much larger expanses of land than flooded surfaces land use policies should take this into consideration in order to safeguard these vulnerable environmental assets this research used twenty multi layer supervised classification algorithms to map groundwater dependent ecosystems in the mancha húmeda unesco biosphere reserve spain self validated by design supervised machine learning opens up a whole new dimension to the characterization and protection of groundwater dependent ecosystems this research shows that tree based classifiers random forests and extra trees classification logistic regression support vector machines and k neighbour classification may all be well suited to delineate groundwater dependent ecosystems even with a limited number of explanatory variables and a small wetland dataset to rely upon the ensemble mean approach though simple predicts the presence of groundwater dependent ecosystems with an accuracy in excess of 90 per surface area this represents a benefit over the individual classifiers by providing a measurement of uncertainty the methodology presented in this paper is versatile enough to be exported to any setting where spatially distributed sets of explanatory and target variables may be available results reveal that the extent of groundwater dependent ecosystems in the region is most likely underestimated indeed the existence of a large surface area with similar hydrogeological geographical and biotic markers to the official inventory of springs and wetlands implies that environmental services could extend well beyond the official delineation of these ecosystems credit authorship contribution statement p martínez santos conceptualization writing supervision s diaz alcaide formal analysis conceptualization a de la hera portillo investigation supervision víctor gómez escalonilla methodology declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work has been funded under grant rti2018 099394 b i00 of the ministerio de ciencia innovación y universidades the first author received a salvador de madariaga grant prx18 00235 from spain s ministerio de educación cultura y deporte to carry out a 3 month research stay at the université de neuchâtel switzerland where the software used to prepare this paper was developed 
4112,identifying groundwater dependent ecosystems is the first step towards their protection this paper presents a machine learning approach that maps groundwater dependent ecosystems by extrapolating from the characteristics of a small sample of known wetland and non wetland areas to find other areas with similar geological hydrological and biotic markers explanatory variables for wetland occurrence include topographic elevation lithology vegetation vigor and slope related variables among others supervised classification algorithms are trained based on the ground truth sample and their outcomes are checked against an official inventory of groundwater dependent ecosystems for calibration this method is illustrated through its application to a unesco biosphere reserve in central spain support vector machines tree based classifiers logistic regression and k neighbors classification predicted the presence of groundwater dependent ecosystems adequately 96 test and auc scores the ensemble mean of the best five classifiers rendered a 90 success rate when computed per surface area this method can optimize fieldwork during the characterization stage of groundwater dependent ecosystems thus contributing to integrate wetland protection in land use planning keywords machine learning wetland protection groundwater dependent ecosystems wetland management big data mancha occidental aquifer 1 introduction wetlands comprise some of the most productive ecosystems of the world and provide a wide range of environmental services to humans mea 2005 these include but are not restricted to flood control groundwater replenishment shoreline stabilization in coastal areas nutrient cycling water purification and support to fauna and flora as well as important cultural and recreational values despite their environmental and economic significance the world s wetlands are slowly disappearing the ramsar convention estimates that two thirds have been lost since 1900 rcw 2015 this problem is particularly acute in the case of inland ecosystems as well as in the asian and european continents take for instance the case of spain whose total wetland surface has shrunk by 60 in the last decades de la hera et al 2011 causes should be found in historical factors such as disease prevention campaigns and the need for new arable lands but also in major changes in land use and water diversion through dams and canals and intensive groundwater pumping revenga et al 2000 martínez santos et al 2018 despite growing awareness about the intrinsic value of wetlands economic development continues to be favored over environmental conservation this is largely because wetlands and their ecosystem services often are not well quantified and are therefore difficult to incorporate into decision making and conservation planning chen et al 2014 wetland protection is most effective when coordinated with water and land use policies in this context the role of ecosystem services remains in need of wider recognition and there is still room to improve the strategies that integrate them in land management mitsch et al 2015 aristizábal and martínez santos 2019 furthermore it is important to acknowledge that wetland functioning is controlled by factors that occur at different temporal and spatial scales which makes ecosystem management and protection all the more complex de la hera et al 2016 this research is specifically concerned with the development of tools to facilitate the conservation of groundwater dependent ecosystems gdes that is those natural ecosystems that require access to groundwater to meet some or all of their water requirements on a permanent or intermittent basis nwc 2011 the concept of groundwater dependent ecosystem takes into account the physical chemical and biological linkages between aquifers and associated subterranean and surface water bodies rohde et al 2017 cantonati et al 2020 while also giving due importance to the need to maintain plant and animal communities ecosystem processes and ecosystem services a common point to groundwater dependent ecosystems is the emergence or near emergence of the water table above the topographic surface ec 2011 usfs 2012 when groundwater arises at a point location it typically results in a spring or seep wetlands are similar except that groundwater discharge takes place in a diffuse manner across a larger area in certain classifications groundwater dependent ecosystems also include underground environments such as caves springer and stevens 2009 the first step in protecting a groundwater dependent ecosystem is to identify its very existence establishing whether a wetland is dependent on groundwater can be difficult partly because there can be a continuum between groundwater dependent ecosystems and those ecosystems dependent on other water sources and partly because human intervention may have desiccated the wetlands a long time ago ec 2011 these factors can be even more difficult to assess in the case of crypto wetlands i e wetlands underpinned by a shallow water table that do not have a standing water table but that present permanent or semipermanent phreatophyte vegetation unesco 2019 while the local scale dependency of ecological communities on groundwater can be established based on hydrological geomorphological physico chemical and biological methods approaches that rely on a combination of expert criteria remote sensing and other sources have proven efficient over large regions doody et al 2017 flooded surfaces and flood prone areas can be readily identified from remote sensing products degiorgis et al 2012 maxwell et al 2016 chignell et al 2018 these allow for the delineation of water bodies with a high degree of confidence however satellite images do not necessarily provide a univocal answer when dealing with crypto wetlands furthermore widespread irrigation may detract from the effectiveness of vegetation based indicators in semiarid regions it is in these context where alternative approaches are required to identify groundwater dependent ecosystems that may otherwise pass unnoticed the goal of this paper is to present and validate a machine learning approach to map groundwater dependent ecosystems based on a set of ground truth examples the method relies on several supervised classification algorithms which are applied to identify those variables that better explain the presence of groundwater dependent wetlands machine learning furthers the capabilities of natural resources mapping which traditionally relied on expert criteria simple addition analytical hierarchical processes and or geospatial interpolation the use of machine learning algorithms is becoming increasingly common in the environmental literature li et al 2017 walsh et al 2017 naghibi et al 2017 ceh et al 2018 díaz alcaide and martínez santos 2019a supervised classification is a type of machine learning technique that consists of developing estimates for a target variable based on a series of known examples and explanatory variables supervised classification has been used to map vegetation communities ohmann and gregory 2002 von wehrden et al 2009 mineral resources schetselaar et al 2008 groundwater potential areas chen et al 2018 díaz alcaide and martínez santos 2019a fecal contamination in domestic wells díaz alcaide and martínez santos 2019b and landslide susceptibility pham et al 2016 among other spatially distributed variables using machine learning approaches to map groundwater dependent ecosystems is perceived as a methodological contribution in several ways for one while machine learning has been used in the past for spring mapping ozdemir 2011a naghibi et al 2015 the literature showcases very few precedents in the context of the protection of wetlands and other types of aquatic ecosystems furthermore this technique represents a complement to traditional expert based approaches and may provide additional insight in environmental management practices by harnessing the potential of big data approaches to delineate ecosystems dependent on groundwater whose presence might otherwise pass unnoticed from a site specific perspective the outcomes are meaningful enough to inform regional land use policy 2 methods 2 1 study site the machine learning approach is illustrated through a well known set of groundwater dependent wetlands located in central spain fig 1 these are all part of the mancha húmeda unesco biosphere reserve unesco 1980 the largest one las tablas de daimiel is listed under the ramsar convention it is also a national park since 1973 de la hera and villarroya 2013 the study area has been described from the hydrogeological perspective by several authors martínez santos et al 2018 it is best described as a vast plain that slopes gently over 150 km from sw 600 m a s l to ne 730 m a s l the region presents a continental semiarid climate where short wet periods alternate with long dry spells the long term average rainfall 1904 2014 is 405 mm yr with a yearly maximum in excess of 700 mm 1969 and 2010 and global minima of about 170 mm 1938 and 2005 average monthly temperatures range between 5 c in january and 26 c in july the mean standing at 15 c the drainage network is poorly defined thus favoring surface groundwater interactions the region s wetlands are fed by the mancha occidental aquifer system a groundwater body which spans 6100 km2 under its current administrative boundaries and whose thickness exceeds 400 m in some areas fig 2 the mancha occidental system comprises four major hydrogeological units the upper aquifer is made up of unconfined highly transmissive miocene materials these overlay a low permeability marly aquitard which partially separates the miocene unit from the semi confined limestone aquifer found immediately below the impervious basement is made up of triassic and paleozoic materials the ensemble of both permeable units the aquifer hereon presents excellent conditions for groundwater development transmissivity exceeds 20 000 m2 d in some areas while the mean specific yield is 2 5 igme 2004 this explains why the region is subject to intensive pumping since the early 1970s groundwater irrigated agriculture grew six fold between 1975 and 2006 from 30 000 ha to 180 000 ha martínez santos et al 2018 for years pumping nearly doubled the long term replenishment rate of the aquifer this caused the water table to drop by a rate of 1 2 m yr during that interval igme 2004 mejías moreno et al 2012 changes in groundwater flow patterns took place as a result triggering major alterations in the water balance local subsidence collapses and the spontaneous combustion of peatlands llamas and fornes 2004 castaño castaño et al 2008 moreno et al 2011 most importantly however most groundwater dependent wetlands as well as rivers guadiana záncara cigüela and azuer dried up llamas 1988 llamas et al 1992 castaño castaño et al 2008 martínez santos et al 2008 an exceptionally wet period 2006 2010 resulted in a major recovery of the aquifer martínez santos et al 2018 the water table rose significantly up to 20 m in some areas fig 3 around 2011 2012 some of the main groundwater dependent ecosystems including las tablas de daimiel national park and the ojos del guadiana springs experienced aquifer discharge for the first time since the mid 1980s this trend continued for several years thus allowing for the study of ecosystem dynamics and long term changes in wetland water quality castaño castaño et al 2018 de la hera 1998 carried out a thorough assessment of the region s groundwater dependent ecosystems based on the national inventory of wetlands dgoh 1991 this author defined two major wetland areas in the mancha occidental aquifer one towards the northern part of the system zancara area and another one towards the west daimiel area fig 1 both presented some degree of degradation at the time of that study due to intensive pumping about 42 had completely dried up in the zancara area and 69 in daimiel these findings together with some wetlands of minor importance identified means of satellite imaging constitute the baseline inventory for the ensuing analyses de la hera 1998 2 2 predictive mapping software this research uses mlmapper 2 0 this is the first evolution of mlmapper 1 0 a qgis 3 2 plugin coded in python 3 6 that performs multilayer pattern recognition to develop predictive maps based on point source ground truth martínez santos and renard 2019 aside from all the functionalities of its previous version the software now incorporates a number of new automated routines these include collinearity checks recursive feature elimination feature number optimization randomized search parameter fitting and k fold cross validation mlmapper integrates seven new supervised classification algorithms of the scikit learn 0 24 1 toolbox pedregosa et al 2011 which brings the software s total number algorithms up to twenty this large number of classifiers provides the user with a wide array of computational alternatives as well as the possibility of performing ensemble mapping automatically the underlying principle is to apply as many algorithms as possible to a given problem and then perform an ensemble of the results of those which exceed a suitable performance score those algorithms that perform poorly on the input dataset are discarded mlmapper currently includes support vector machines svm linear vector machines lvm logistic regression lrg decision tree classifier crt random forest classifier rfc k neighbour classification knn linear discriminant analysis lda gaussian naïve bayes classification nba multilayer perceptron neural network mlp ada boost classifier abc quadratic discriminant analysis qda gradient boosting classification gbc gaussian process classifier gpc ridge classifier rid stochastic gradient descent linear classifier sgd perceptron prc nearest centroid classifier ncc multinomial naive bayes classifier mnb complement naive bayes classifier cnb and extra trees classifier ext the underlying principles of each of these algorithms have been thoroughly discussed in the literature kotsiantis 2007 hastie et al 2009 pedregosa et al 2011 2 3 conceptual model target and explanatory variables mlmapper follows a classic machine learning workflow characterized by the sequential application of data input feature correlation and selection data split feature optimization recursive feature elimination parameter optimization and prediction fig 4 in this case the latter step consists in spatial extrapolation of the results into a map for the purpose of the ensuing sections the target variable is a binary outcome that defines the presence or absence of gdes at each location of the study site explanatory variables or model features are those elements expected to constrain the presence or absence of gdes to some extent a key assumption of this research is that the occurrence of groundwater dependent ecosystems may be inferred from a combination of geological geomorphological hydrogeological and biological variables cantonati et al 2020 point out that from the hydrogeological standpoint wetland classifications rely on a number spatially distributed variables among others these include parent rock geology lithology stratigraphy structural geology of the groundwater basin discharge driving forces gravity pressure or density temperature dominated discharge groundwater quality and the geomorphology around the outlet with that in mind fig 5 and table 1 present the spatial distribution and the reclassification values of the explanatory variables considered in this study these include lithology water table elevation ndvi flow accumulation potential slope topographic wetness index soil type and permeability their importance will be discussed in the following paragraphs geology plays an important role in gde dynamics lateral lithological changes result in local permeability contrasts that favor the rise of shallow groundwater to the surface in certain cases the density and orientation of faults and fractures may constrain groundwater flow defining preferential paths that lead to the accumulation of water at the surface this may also create a moist environment that allows for the development of certain soil features while also providing adequate living conditions for fauna and flora gdes typically occur in valleys and depressions where the water table intersects the topographic surface this implies that both topography and the elevation of the water table are likely predictors for gde occurrence slope and slope related parameters steepness curvature topographic wetness index can also be expected to behave as explanatory variables as these control the accumulation of water above the surface changes in slope may also prove relevant in marking the edges of a wetland satellite surveillance reveals potentially important information about the presence of wetlands particularly in arid and semiarid climates this is typically captured by vegetation related indices like the ratio vegetation index the vegetation index number the differenced vegetation index and the normalized difference vegetation index ndvi bannari et al 1995 xie et al 2008 the latter is widely used due to its ease of calculation and to its sensitivity to changes in vegetation patterns xue and su 2017 it is also useful for the identification of flooded areas because exposed water surfaces typically present low and uniform ndvi values moreover in the absence of irrigation patches of vigorous vegetation at the end of the dry season can be interpreted as a proxy for permanent springs or a shallow water table 2 4 algorithm training and testing two databases must be prepared prior to running mlmapper the first one contains ground truth data and is used to train and test the machine learning algorithms the ground truth database comprises a suitably large number of points with the coordinates of each point the known outcome of the target variable and the pixel score for each gis layer explanatory variables the second database is a list of all pixel values for all layers also with coordinates this second database is used to extrapolate the results and build the gde map mlmapper first carries out a collinearity test for the entire input dataset collinearity occurs when two or more explanatory variables present a high degree of correlation and represents a problem because the regression coefficients of certain algorithms mat not be uniquely determined variables found to be redundant are eliminated prior to running the models mlmapper then splits the ground truth database into independent training and testing datasets training is the process whereby algorithms learn the patterns of explanatory variables that lead to the presence or absence of gde at each pixel at this stage each algorithm has access to the target outcome so that it can establish the combinations that lead to a positive or negative outcome the training score refers to how successfully each algorithm is able to explain such patterns the test phase is where the algorithms are prompted to predict the outcome of a given combination of explanatory variables during this part of the process the outcome is no longer known to the algorithms these must estimate it correctly based on what they learned during the training phase the test score is obtained by comparing estimates to the actual outcomes it thus represents the predictive accuracy of each algorithm on a scale of 0 to 1 where 0 means that all predictions made by the algorithm were wrong and 1 that the predictions where 100 accurate a 0 5 score suggests that the predictions are no better than a random choice the proportion of the ground truth database used for training and testing typically ranges between 50 50 and 80 20 train test this split is randomized but remains roughly proportional to the number of target classes in the input dataset in the case of a binary problem such as the one at hand it is convenient to work with a similar number of positive and negative outcomes in order to minimize bias in test scores the ground truth database comprises 150 entries out of which 75 are known wetland points distributed among a sample of six major wetlands and 75 are known non wetland points distributed randomly all over the aquifer fig 1 in practice this means that 6 of the 20 wetland polygons in the zancara area and 3 out of the 12 in the daimiel area are used to train the algorithms the latter are then required to identify the remaining 23 polygons as wetlands based on the associations that were developed during training since each algorithm relies on different mathematical principles a range of algorithm performances can be expected for a given input dataset due to the intrinsic complexity of machine learning models it is difficult to predict which one will be more suitable in each case mlmapper tackles this issue by using a large number of classifiers and then picking the ones that render the best results algorithm performance is typically assessed based on a set of user specified metrics typically test score and area under the receiver operating characteristic curve auc a simple ensemble mean of the best performing classifiers is developed subsequently in order to show the degree of agreement among them the outcome can also be interpreted as a proxy for uncertainty certain algorithms allow for recursive feature elimination variables that turn out to be either indifferent or counterproductive are eliminated from the conceptual model this process also allows for the optimization of the number of input features during this process mlmapper uses automated parameter tuning to optimize algorithm performance for this it picks the best result out of running grid search and randomized search parameter fitting routines on each algorithm both these routines incorporate 10 fold cross validation finally mlmapper gives the user a choice as to whether to extrapolate the results to produce a predictive map individual maps are developed for all classifiers based on what the algorithms learned during the training and testing processes this is an optional feature because the process of building the map can be time consuming 2 5 simple subtraction map in theory a map representing simple subtraction of the water table elevation from the digital elevation model would render an accurate depiction of the flooded areas this approach could contribute to the identification of ecosystems underpinned by a shallow water table if a suitable degree of tolerance were applied thus several simple subtraction maps were developed for comparison purposes these were computed by taking away the elevation of the water table in september 1974 earliest on record from the 5 m mdt50 series of the high resolution national dem provided by the geographical institute of spain tolerances of zero to five meters below the surface were defined to allow for the representation of crypto wetlands 3 results feature collinearity is evaluated by means of pair wise correlations between explanatory variables a discrimination threshold of 0 70 is commonly used although values between 0 40 and 0 85 can be acceptable depending on the circumstances dormann et al 2013 fig 6 shows the correlation matrix results are expressed by means of a colour scale where a value of 1 0 represents a perfect inverse correlation and a value of 1 0 represents a perfect direct correlation direct correlation between explanatory variables were found to range between 0 7 and 0 7 in all cases thus no explanatory variable was excluded from the conceptual model table 2 presents standard performance metrics for all algorithms a wide range of classifier families yielded test scores in excess of 0 90 these include tree based classifiers support vector machines logistic regression and k neighbours classifiers among others tree based classification proved particularly adept at predicting the occurrence of groundwater dependent ecosystems as all three tree based algorithms rfc ext crt made it into the top six performers conversely sgd prc and lvm rendered a very low predictive potential 0 51 in terms of test score there is a clear break between the best six classifiers all of which exceeded 0 96 and the seventh one lda which scored 0 91 therefore a discrimination threshold of 0 96 was defined this means that all algorithms rendering a lower test score were discarded for the purpose of ensemble mapping crt was also left out to simplify the ensuing discussion as this classifier is essentially a less sophisticated version of ext and rfc parameter descriptions for each of the top five algorithms and their optimized values are presented in table 3 fig 7 displays the outcomes of recursive feature elimination optimized tree based classifiers rfc ext maximized their outcome when relying exclusively on four out of the nine explanatory variables namely dem lithology permeability and water table elevation in contrast lrg and svm attributed some importance to all variables except for the topographic wetness index knn uses an approach based on the distance between input points and similitude among possible outcomes this does not allow for recursive feature elimination or computing feature importance which means that knn was dealt with separately fig 8 presents feature importance for the tree based classifiers feature importance is computed both in terms of weighted importance the sum of all variable weights equals one and in terms of permutation feature importance the main difference between the two classifiers is the relative importance of lithology and water table elevation as ext places a greater emphasis on the former while rfc stresses the latter topographic elevation and permeability are the most and least important features in each case respectively svm and lrg present feature importance results in terms of coefficients table 4 both attribute the greatest importance to ndvi and rely heavily on lithology there is an inverse consideration to the second most important parameter svm uses slope preferentially and attributes little weight to soil whereas lrg does the exact opposite dem flow accumulation permeability and elevation of the water table are relatively unimportant in both cases in the case of knn feature importance was calculated by means of feature subtraction that is by removing one explanatory variable at a time and evaluating the effect on test score knn relies chiefly on the dem the water table elevation slope lithology and permeability flow accumulation and topographic wetness index had a negligible effect on the results soil and ndvi were found to be counterproductive i e the overall test score dropped by taking each of these variables under consideration figs 9 and 10 present the map outcomes for each of the five classifiers as well as for the simple ensemble mean in the case of individual classifiers blue pixels represent areas labelled as gde whereas red pixels mean non gde the ensemble mean is the arithmetic mean of all five algorithms for each pixel colors therefore represent the degree of agreement among classifiers blue pixels mean that all classifiers agreed on a positive outcome 1 whereas red means that all classifiers labelled the pixel as negative 0 green orange and yellow reflect different degrees of agreement disagreement thus providing a measure of uncertainty there seems to be a good spatial correlation between the machine learning classifiers and the existing inventory of wetlands local inaccuracies are however observed these could be partly attributed to the regional nature of this study as well as to imprecisions in input data more specifically an important input variable for most classifiers the water table map presents some known shortcomings that stem from its reliance on old data records the elevation of the natural water table mid 1970s is based on a sample of about 100 wells which represents a density of one reading in 60 km2 while this is sufficient to define the main groundwater flow patterns at the aquifer scale further detail could be needed to depict local conditions furthermore the piezometric dataset is not entirely consistent as there is a spread of several weeks in the dates in which the original field measurements were collected finally it must be borne in mind that the 1974 conditions respond to the oldest available records which are the closest to a natural state it is however known that the aquifer was already subject to some degree of groundwater extraction in the late 19th century and that some of the most fragile wetlands had been lost by the 1970s martínez cortina 2003 de la hera 2003 these factors could all explain why the algorithms fail to detect the smaller wetlands in the zancara area martínez santos et al 2021 show that standard machine learning metrics do not necessarily provide an unequivocal measure of algorithm performance and contend that case specific indicators could provide additional insights a suitable additional benchmark in this case could be the total surface area correctly identified as groundwater dependent when appraising the results in these terms the rfc classifier identified 93 3 of the wetland area in the official inventory ext 86 5 svm 86 1 lrg 85 8 knn 84 1 and the ensemble mean 90 3 table 5 an important consideration is that some wetland boundaries in the official inventory exceed the actual boundaries of gdes attaining a value of 100 per surface area would therefore be unrealistic besides the official inventory includes some wetlands that not experiencing direct groundwater recharge are the result from the accumulation of upstream spring flows this could well explain why most classifiers fail to identify the alcahozo chico navalengua and melgarejo lagoons table 5 this is consistent with the fact that most classifiers identify groundwater discharge areas immediately upstream the official inventory is a suitable benchmark for comparison in the sense that it provides much needed ground truth however the list of springs and wetlands is not necessarily comprehensive the fact that the total surface labelled as gde by all five classifiers is larger than that in the inventory suggests that there are many other areas whose characteristics would justify the existence of ecosystems underpinned by shallow water tables fig 11 all five classifiers in fig 9 depict a highly likely spatial distribution of gdes blue regions highlight the areas of the aquifer which have been identified as gde prone these have traditionally been considered natural discharge areas knn provides the sole exception with a blue sw ne band that runs along the southern sector of the system this seems to be associated with the lithology layer based on the elevation of the water table this is unrealistic which is the reason why knn is removed from the mapping ensemble in fig 10 on a final note simple subtraction identified correctly 80 9 of the actual wetland area which is considerably less than all five machine learning classifiers this leads to the conclusion that machine learning provides a more robust approach than simple subtraction by incorporating additional variables as explained above a comparatively worse performance on the part of the simple subtraction method possibly stems from the absence of a sufficiently precise representation of the quasi natural water table this can be problematic to obtain in regions with few observation wells or in heavily modified aquifer systems such as the one at hand where old data records are needed to recreate pristine conditions 4 discussion wetland characterization has often been conducted on the basis of soil water and vegetation factors corwardin 1979 brinson mark 1993 but there is no international consensus as to the methods that should be applied at different spatial scales to a large extent this is because the knowledge base in each site is different and often controlled by the domain in which researchers have worked preferentially furthermore a frequent problem at the regional scale is the imbalance of information while the better known wetlands such as las tablas de daimiel national park in the case at hand can be well characterized from multiple perspectives basic data may be lacking for many other groundwater dependent ecosystems in this context wetland surface area under pristine conditions is a key element in environmental protection efforts for it allows us to delineate wetland influence areas retrospectively as well as to estimate the degree of degradation each ecosystem has experienced over time in intensively exploited aquifers where wetlands disappeared long ago estimating the natural wetland surface area requires innovative techniques this is where supervised classification algorithms may provide an added value a major difference between the approach presented in this paper and the standard supervised classification tools that usually come with gis platforms is that mlmapper uses several variables simultaneously in order to determine whether a given pixel should be labeled gde or non gde in other words multi layer classification allows us to take into account several gis layers simultaneously overall the resulting area of gde occurrence is noticeably larger than the field inventory figs 9 and 10 this is because the existing inventory only caters to springs and wetlands but not so much to crypto wetlands or gaining river reaches in this context the results imply that the area where groundwater underpins surface ecosystems could be ten times larger than the surface currently delineated as wetlands in this regard the machine learning approach is best described as an aprioristic method that allows us to identify zones where shallow water tables may be of environmental significance this finding could be used to inform land use planning and the delineation of wetland protection buffers as well as to locate areas where wetlands dried up in the past due to intensive pumping additionally an approach such as this one could optimize the costs associated with fieldwork in remote or scarcely known areas in relation to the explanatory variables the importance of the topographic elevation in predictive spring mapping is consistent with the literature for instance martínez santos et al 2021 applied random forests and support vector machines to delineate aquatic ecosystems in a tropical colombian catchment characterized by the coexistence of abrupt and flat areas these authors found the presence of aquatic ecosystems to be constrained by landforms water table depth slope and slope related indices topographic wetness index stream power index they also stressed the importance of using a high resolution digital elevation model naghibi et al 2015 applied tree based methods including random forests to predict spring occurrence in a karst basin of iran topography drainage density and the presence of faults were found to be adequate predictors while land use plan curvature and profile curvature were less important the work by dadgar et al 2017 in a different region of the same country suggests that topography and slope could be the major factors determining spring occurrence while geology stream density and lineaments had relatively little weight on the results finally chen et al 2018 combined weights of evidence logistic regression and functional tree models to predict spring occurrence in a catchment of northern china they found distance to streams altitude and lithology to be the key variables explaining spring presence whereas land use ndvi and plan curvature ranked among the least important most of the studies mentioned above deal specifically with spring occurrence their findings are relevant in the context of this work because springs like groundwater dependent wetlands are points of aquifer discharge however springs may take place in steep slopes and other places where wetlands are unlikely this means that some degree of variability can be expected in terms of the explanatory variables they used and the ones we considered in our research take for instance the elevation of the water table while this parameter is relatively uncommon in spring potential studies it is crucial for wetland identification conversely major landforms faults and fractures may be important to identify wetlands in mountain catchments but perhaps not so relevant in large plains such as the mancha occidental aquifer much like it happens with the classification of springs which typically escapes standardization springer and stevens 2009 this all suggests that the preferred set of explanatory variables to map wetland potential should be picked based on case specific considerations in this sense it is acknowledged that a potential indicators of gdes are vegetation communities gdes can have unique vegetation communities and the presence or absence of these vegetation communities or indicator species could potentially help identify gdes that have become degraded vegetation data particularly older vegetation maps potentially could be used as training and verification data to help identify other gdes in our case however such data was unavailable a similar reasoning applies to classification algorithms ozdemir 2011a and ozdemir 2011b found frequency ratio and weight of evidence approaches to outperform logistic regression at identifying springs in a basin in southern turkey similarly naghibi et al 2015 found the decision tree classifier to be more accurate than the rfc in mapping groundwater potential in iran along the same lines our research shows that different algorithms can render very different test scores on an identical dataset this implies that including a large number of classifiers from the outset like we propose in this research could contribute to optimize the outcomes in a wide range of circumstances in the case at hand tree based algorithms were observed to outperform most other supervised classification families both in terms of raw test score surface area and number of explanatory variables required for mapping this suggests that the tree based algorithms may be particularly efficient at mapping gdes by taking permeability and lithology under consideration they actually improved the outcomes obtained by simple subtraction when computing the results in terms of the total surface area correctly identified as gdes 5 conclusions adequate characterization is a prerequisite for the protection of groundwater dependent ecosystems particularly in regions where springs and wetlands are at risk of disappearing due to anthropogenic factors attempts to delineate protection buffers should always take into account the fact that a significant part of the environmental value of groundwater is hidden beneath the surface and that ecosystems underpinned by shallow water tables may extend across much larger expanses of land than flooded surfaces land use policies should take this into consideration in order to safeguard these vulnerable environmental assets this research used twenty multi layer supervised classification algorithms to map groundwater dependent ecosystems in the mancha húmeda unesco biosphere reserve spain self validated by design supervised machine learning opens up a whole new dimension to the characterization and protection of groundwater dependent ecosystems this research shows that tree based classifiers random forests and extra trees classification logistic regression support vector machines and k neighbour classification may all be well suited to delineate groundwater dependent ecosystems even with a limited number of explanatory variables and a small wetland dataset to rely upon the ensemble mean approach though simple predicts the presence of groundwater dependent ecosystems with an accuracy in excess of 90 per surface area this represents a benefit over the individual classifiers by providing a measurement of uncertainty the methodology presented in this paper is versatile enough to be exported to any setting where spatially distributed sets of explanatory and target variables may be available results reveal that the extent of groundwater dependent ecosystems in the region is most likely underestimated indeed the existence of a large surface area with similar hydrogeological geographical and biotic markers to the official inventory of springs and wetlands implies that environmental services could extend well beyond the official delineation of these ecosystems credit authorship contribution statement p martínez santos conceptualization writing supervision s diaz alcaide formal analysis conceptualization a de la hera portillo investigation supervision víctor gómez escalonilla methodology declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work has been funded under grant rti2018 099394 b i00 of the ministerio de ciencia innovación y universidades the first author received a salvador de madariaga grant prx18 00235 from spain s ministerio de educación cultura y deporte to carry out a 3 month research stay at the université de neuchâtel switzerland where the software used to prepare this paper was developed 
4113,the resolution of nation scale hydrological models is often considered a limitation with respect to providing useful management information on local scale issues use of these coarse scale models to inform both the structure and parameterisation of local scale models could potentially enhance their utility and in some cases provide initial estimates to local scale water resource issues such as nitrate transport this study explores whether a finer resolution model whose conceptualization and parameterisation are based upon a nation scale model can replicate local scale water balance observations and in this way expand the utility of large scale models we use the danish national water resources model dk model as a template to model a small 5 km2 subcatchment in denmark and compare the flows at four transect locations to those observed in a previous field investigation the resolution of the dk model is 500 m and this model was refined to create four additional models of the subcatchment with 100 m 50 m 20 m and 10 m resolutions results suggest that none of the refined models could accurately capture the daily overland and groundwater flow conditions however for the finer resolution models 10 m and 20 m the annual overland and groundwater flows agreed well with the observed flows keywords dynamical downscaling nation scale local scale modelling nitrate overland flow riparian areas flow partitioning 1 introduction more and more national and regional scale 10 000 km2 hydrological models are being developed and applied for water management barthel and banzhaf 2016 this development has been possible due to an increasing availability and accessibility of data and due to computational efficiency improvements this opens up possibilities to explore hydrological issues at a larger scale which can provide insight and aid decision makers on policy and appropriate management options consequently considerable resources are being spent on developing national scale de lange et al 2014 refsgaard et al 2010 sutanudjaja et al 2014 and regional scale models chen et al 2020 maxwell et al 2015 michael and voss 2009 xu et al 2021 yang et al 2020 the accuracy of such large scale models is among other things related to the availability of data and computational power plûmacher and kinzelbach 2000 because coarse spatial resolution prevents a model to accurately simulate smaller scale processes and therefore limits the model applicability there is often a wish to apply as small a grid size as practically possible the computational demands of a hydrological model are a function of the size number of active cells of the model model calibration and uncertainty assessments typically requiring numerous model runs taking days to weeks to complete in practice define the limits for how small grid sizes can be used therefore considerations of both the available computational capacity and the grid resolution are necessary much of the information used to construct and calibrate these models comes in a wide range of scales e g point scale groundwater head data cm to hundreds of m scale remote sensing data subcatchment catchment scale stream discharge data local to national scale geological models and continental scale grace data landerer and swenson 2012 these data require various degrees of down or up scaling prior to use in regional scale models blöschl 2001 cushman 1986 wood 2009 the methods used to scale the data inevitably lead to some degree of information loss and need to account for the heterogeneity which the model can represent wen and gómez hernández 1996 one approach is to use numerous stochastic realisations of aquifer properties dagan 1997 zinn and harvey 2003 another approach is to recognise the limitations of the models to accurately replicate reality by exploring multiple conceptual models enemark et al 2019 although both approaches aim to reduce uncertainty in the simulations model calibration still involves the use of data e g point groundwater head data whose resolution is substantially finer than the simulation beckie 1996 carrera et al 2005 hunt et al 2020 often the resolution of these models constrains our ability to quantify the hydrological response at smaller scales unless hydraulic responses are considered homogenous within the grid it is not possible to quantify them at a scale smaller than the grid resolution for instance using a model whose grid resolution is 1 km by 1 km to understand the hydrological response e g hydraulic head or flows taking place in an area of 100 m by 100 m is questionable other studies suggested that models generally only have predictive capability at spatial scales larger than the model grid scale wood et al 1988 refsgaard et al 2016 consequently it is commonly assumed that accurate simulation of local hydrogeological responses requires a high resolution local scale model whose parameters are optimised to the processes and observations at that scale e g hansen et al 2018 in the following we use the term downscaling for a process whereby a coarse scale model is used to construct a model with a finer spatial resolution the two main classes of downscaling statistical and dynamical downscaling are frequently used in climate research dessai and hulme 2007 fowler et al 2007 holman et al 2009 quintana seguí et al 2010 wilby et al 1998 in statistical downscaling relationships are derived between the coarse scale model data and the fine scale target variable in addition to classical statistical techniques machine learning techniques have recently been utilised as a powerful tool to combine coarse scale model data with other data sources available at finer scale koch et al 2019 dynamical downscaling uses the coarse scale model data as boundary conditions to force a finer resolution model in climate modelling global models gcms are dynamically downscaled to continental models rcms wilby et al 2004 a spatially distributed hydrological model is typically parameterised in terms of structural elements e g geological units soil types vegetation classes with different spatial representations and effective parameter values assumed to simulate average conditions within each of the structural elements refsgaard 1997 in dynamical downscaling the structural elements and the parameter values can either be assumed to be identical in the coarse scale and the fine scale models or the spatial representation of structural elements can be modified using available fine scale data we denote those two approaches for homogeneous downscaling and heterogeneous downscaling respectively while several studies have tested the performance of upscaling fine resolution hydrological models to coarse resolution models cushman et al 2002 farmer 2002 refsgaard 1997 vermeulen et al 2006 few studies have explored the possibility of downscaling a coarse resolution model to a fine resolution model using the same parameterization in doing so several assumptions are made regarding the representativeness of both the structural elements and the calibrated parameter values of the large scale model in terms of groundwater flow such parameter transfers would typically assume that the sub grid heterogeneity is negligible refsgaard et al 2016 wang et al 2002 and that the calibrated regional hydraulic conductivities are also representative of those at the small scale and independent of the grid scale without further time intensive calibration would this downscaling strategy be effective at replicating local scale observations the present study is part of an attempt to enhance the existing national nitrogen model nnm højberg et al 2015 where one of the recognised weaknesses is an inability to accurately assess nitrate reduction in riparian lowlands previous studies have suggested that nitrate reduction in lowlands can be estimated if the flows from the upland to the stream through the riparian lowland can be separated into overland flow and subsurface flow dahl et al 2007 petersen et al 2020b petersen et al 2020a for example the likelihood of nitrate reduction within a riparian lowland dominated by surface runoff is low because the nitrate remains in an oxic environment conversely if groundwater flow dominates the likelihood of nitrate reduction is higher because the nitrate is transported through an organic rich anoxic environment the nnm relies on the flow patterns in the danish national water resources model dk model to simulate the subsurface transport to aquatic ecosystems a substantial number of riparian lowlands are smaller than the model grid size 500 m in the dk model as a result flow partitioning volume of overland flow or groundwater flow relative to the inflow within a riparian lowland cannot be resolved from the coarse resolution national model it is therefore relevant to examine whether a high resolution version of the national model applied to a small catchment will be able to reproduce local field measurements of flow partitioning in particular overland flow and groundwater flow the objectives of this study are to test 1 how the simulated local scale flow partitioning at the field scale is affected by the spatial resolution of the computational grid and 2 whether a high resolution model whose structure and parameterisation is based on a lower resolution calibrated model can replicate the observed flow partitioning at the field scale in this study we use the danish national water resources model dk model as an example of a large scale national model with a 500 m resolution observed water balance data are available for four transects within a small subcatchment of the norsminde catchment jutland denmark petersen et al 2020a 2 methodology 2 1 field site this study focusses on the 5 km2 fensholt headwater subcatchment of the norsminde catchment in eastern jutland denmark the subcatchment contains a small riparian lowland approx 1 5 km in length in an undulating clay till landscape this site has been the focus of numerous studies investigating the water and nutrient balance geology and tile drain efficacy de schepper et al 2017 hansen et al 2019a hansen et al 2019b petersen et al 2020b petersen et al 2020a prinds et al 2020 prinds et al 2019 the catchment is 77 agricultural land the vast majority of which has a dense tile drain network draining groundwater into a small stream located within the riparian lowland surface geology is dominated by clay with a small localised area of sand adjacent to the riparian lowland the riparian lowland sits on top of an organic rich peat deposit underlain by gyttja tile drainage is present in the upland area whilst the riparian lowland is largely undrained but there are areas where remnant tile drains still function geomorphology of the catchment is characterised by steep slopes bounding a flat lowland area in the upland area the slope ranges from 0 002 to 62 6 with an average of 6 6 for the entire upland area whilst the riparian lowland has a mean and median slope of 8 5 and 7 4 respectively average annual precipitation between 2000 and 2018 at the catchment is 624 mm y streamflow is perennial with low baseflow during summer and quick responses to rainfall events during winter petersen et al 2020a established four 2d transects t31 t34 within the riparian lowland to investigate the variation in water balance and local flow partitioning each transect was assigned an area as shown in fig 1 ranging from 1130 m2 to 11700 m2 for t32 and t33 respectively the transects were located where tile drains had been cut off at the edge of the riparian lowland resulting in overland flow on the riparian lowland at each transect flow meters were installed at the outlet of the cut off drains to monitor drain flow and piezometer nests running perpendicular to the stream to monitor the groundwater level across the transects reference is made to petersen et al 2020a for more details on the instrumental setup and the water balance model used to support the data interpretation the results of petersen et al 2020a water balance model provides a detailed dataset which can be compared with our simulated water balances these data are henceforth referred to as observations obs 2 2 model setup we used the danish national water resources model dk model as base model from which the fensholt model was extracted the dk model uses the mike she code refsgaard and storm 1995 dhi 2019 a 3d physically based fully distributed integrated catchment model abbott et al 1986 butts and graham 2005 of particular importance in this study is mike she s capacity to simulate the major terrestrial processes of the hydrological cycle and their interaction including precipitation surface runoff groundwater recharge groundwater flow and river flow butts and graham 2005 henriksen et al 2003 højberg et al 2015 stisen et al 2012 calibration of the dk model s hydraulic conductivity values uses groundwater head and river discharge data for in depth information regarding the setup and calibration of the dk model references are made to henriksen et al 2003 højberg et al 2013 højberg et al 2015 and stisen et al 2019 the dk model simulation provided the boundary conditions for the fensholt model the time varying groundwater head boundary conditions for the period of 1990 2018 and the same meteorological data were used for surface boundary inputs i e precipitation reference evapotranspiration and air temperature stisen et al 2019 the stream is simulated using mike hydro which couples to mike she dhi 2017 tile drainage was present in the upland areas located at 0 9 m below ground level for further information refer to hansen et al 2019a and hansen et al 2019b the lowland soil classification was used to delineate the riparian lowland and no tile drainage was simulated in this zone petersen et al 2020a identified t31 as having some tile drains present while no tile drains were found in the other transects the overland flow resulting from the cut off tile drains was simulated by adding the cut off tile drain discharge to the precipitation in the appropriate cells i e those containing a cut off drain for each transect a spin up approach was used to initialise the groundwater levels and surface water within the model the simulation period 1990 2018 was repeated until a quasi steady state condition was reached which took approx 38 years this was evaluated based on temporal trends in the simulated groundwater head compared to observed data from the subcatchment 2 3 downscaling approaches five grid resolutions were selected for comparison to the observed transect flow partitioning namely 500 m f500 100 m f100 50 m f50 20 m f20 and 10 m f10 grid table 1 each model represents a sub model of the dk model in that the model s conceptualisation and construction is consistent with that of the dk model the same input data were used in the models structure and parameterisation in general the heterogenous downscaling approach used to process the input data for each fensholt model was straight forward some of the raw input data used in the dk model is at a finer resolution than that used in the large scale model see table 2 for data source information therefore the processing of these data followed the same approach but with a smaller target resolution categorical data available as gis shapefiles or raster files e g surface geology and land use were processed into georeferenced grid data based on the dominant category present at the target scale fig 2 continuous data were processed into georeferenced grid data based on the mean value at the target scale the hydraulic parameterisation from the calibrated dk model was homogenously downscaled such that the horizontal and vertical hydraulic conductivity values for each model layer in the dk model were assumed to be representative at the finer scale the hydro stratigraphic model was converted into georeferenced grid data for the top and bottom of each unit 100 m scale for the dk model henriksen et al 2003 stisen et al 2019 the homogenous downscaling required the gridded data for each unit to be linearly downscaled to the required grid resolution this prevented incongruities in the model and ensured internal consistency meteorological data were homogenously downscaled using a bilinear interpolation tool built into mike she the input data for the stream cross sections connections and thalweg were identical for all models however mike she places the stream along the edges of the grid cells therefore grid resolution impacts the streams position within the model this also affects the placement of the transects and the associated extraction of flows visual inspection of the grid and transect polygons was used to delineate the transect areas and boundaries as closely as possible for each grid resolution fig 1 the distribution of the soil transfer functions børgesen et al 2009 used in the unsaturated zone parameterisation was not scaled 2 4 performance indicators 2 4 1 water balance overall model accuracy was evaluated based on the catchment scale water balance we extracted the water balance for each model for the period of sep 2016 aug 2017 and quantified the numerical error if the numerical error is large the simulation is not trustworthy and has a large uncertainty in the simulated output in addition to the catchment scale water balance we also extracted the water balance for each transect we assume that if the transect water balance errors are small then the internal flows are reasonably well simulated 2 4 2 flow partitioning to evaluate the impacts of grid refinement on the flows for each transect we chose three variables to compare the flow observations from petersen et al 2020a and the simulation results from the models namely 1 the simulated overland flow out of the transects 2 the total fraction of overland groundwater flow out relative to the total inputs into the transects 3d analysis and 3 the downstream fraction of overland groundwater flow out of the transect relative to the total input 2d analysis table 3 for clarity the terms gross net total downstream are defined as follows gross flow refers only to the amount of in or out flow along a specific transect boundary net flow is defined as the difference between the gross inflow and gross outflow along a specific transect boundary total is used when all gross boundary outflows are used in the calculation and downstream refers to the gross outflows of the boundary identified as the main transect outflow boundary note that the term water balance is used when all inflow outflow and storage components are included whereas flow partitioning is used when referring to either overland or groundwater flow out relative to the total inflows the daily overland flow out oo dwn of the transects required extracting the overland flow flux from cells along the boundary of the transects overland flow direction was determined based on the transect orientation the annual entire simulation period and daily total fraction of overland flow f oo tot and groundwater flow f go tot out of the transects relative to the inputs into each transect was used to compare the simulated 3d flow partitioning to the downstream 2 dimensional 2d transect partitioning from petersen et al 2020a in table 3 f qo tot is the total fraction of outflow of either overland flow or groundwater flow for time period t for the annual timeframe t a represents flows from sep 2016 to sep 2017 and for the daily timeframe t d is the daily flows between sep 2016 to sep 2017 pi t is precipitation mm y or mm d di t is cut off drain flow in mm y or mm d gi t is groundwater inflow mm y or mm d oi t is overland inflow mm y or mm d x o t is the sum of the gross out flows overland or groundwater from the northern x on t southern x os t eastern x oe t and western x ow t boundaries of the transect mm y or mm d all fluxes were normalised to the area of the transect the downstream flow partitioning q dwn t was based on the primary assumption of 2d flow made in petersen et al 2020a that the transect orientations are in the dominant groundwater and overland flow direction therefore all out flows occur across this downstream boundary thus the annual and daily fraction of overland flow f oo dwn and groundwater flow f go dwn for the downstream flow partitioning 2d analysis only used the gross flow out of the downstream transect boundary in the calculation while all boundary inflows via overland and groundwater flows were included in the inflows the downstream boundary for t31 t32 and t33 is the southern transect boundary due to their locations north of the stream conversely the northern transect boundary is used for t34 which is located south of the stream these variables are based on the simulated groundwater flows and surface overland flows into and out of the transect boundaries north south east and west extracted for the period sep 2016 aug 2017 from each model for the same timeframe drain flow out et precipitation and vertical groundwater flows were extracted from all cells within each transect groundwater flows were extracted for the upper model layers where there was direct simulated exchange between the groundwater and stream the performance of the simulated daily overland flows and annual overland flow partitioning table 3 were assessed by comparing to observations the metrics used to evaluate overland flows are the root mean squared error rmse and the nash sutcliffe coefficient n s while mean error me and rmse were used to evaluate the overland flow partitioning 3 results 3 1 numerical accuracy of the models the numerical accuracy of the simulations was assessed using calculated water balance errors as indicators water balance errors were calculated for the entire catchment as well as for the four transects the water balance errors for the entire catchment are 1 9 0 2 0 1 0 1 and 0 2 for f10 f20 f50 f100 and f500 respectively this indicates that the results from all models can be considered sufficiently accurate for further analyses while the f10 simulation comprises areas with inaccurate simulations water balance errors for the four transects in f10 reveal that f10 t31 has a water balance error of 23 while the water balance errors for the other three transects are below 9 the shallow slope and presence of localised depressions in t31 see fig 1a were more accurately represented in the finer grid resolution this resulted in the presence of stagnant ponded water leading to numerical instability therefore f10 t31 had to be excluded from further analysis results from the other three transects for f10 and for all four transects for f20 f50 f100 and f500 have been included in the further analyses 3 2 2d versus 3d analysis to evaluate the assumption made by petersen et al 2020a that the annual flows are 2d and that the third dimension can be neglected in the flow partitioning we have extracted the simulated annual flows using all three dimensions for all transect simulations fig 3 shows the overland vectors and groundwater flow patterns contours in the transects fig 4 shows the gross in and outflows for the f20 model the inflows from the cut off tile drains are point sources but for ease of comparison converted to mm year over the respective transect areas in fig 4 the cut off drainage flow is much smaller in t31 than in the other three transects the opportunity for infiltration and evapotranspiration of the cut off drainage flow is therefore greater in t31 with the result that neither groundwater flow nor overland flow are dominant outflow pathways rather et and drainage flow are the largest outflow pathways which is consistent with the response in petersen et al 2020a t33 and to some extent t32 are examples where the dominant overland flow directions are perpendicular to the transects downslope southern boundary fig 4 the slope within these transects exerts a greater influence upon the overland flow than it does on the groundwater flow out of the transects see fig 3 nevertheless all models simulate a lateral component to the groundwater and overland flow out of these transects in the overland flow for t32 there is considerable flow across the western boundary while for t33 flow occurs across both the western and eastern boundaries for t33 in f10 the lateral flows are dominated by both inflow o iw a of 3500 mm y and outflow o ow a of 3585 mm y along the western boundary the outflow along the western boundary in f10 t33 remains less than the downstream boundary o os a of 4431 mm y this exchange in and out flow along the western boundary is only simulated in f10 f20 f500 only simulate inflow along this boundary all models simulate overland flow out along the eastern boundary for t33 for f50 f500 this flow exceeds the downstream outflow this indicates that the 2d assumption only remains reasonable for t32 and t33 for models f10 and f20 whereas for models f50 f500 the lateral overland flow component exceeds the overland flow out of the southern boundary the water balance errors for t32 and t33 for all models are acceptable see section 3 1 the flow patterns within t34 are such that the dominant outflows occur along the western and northern transect boundaries fig 3 this flow pattern is replicated in all the models f10 f500 for t34 in the case of f20 there is a considerable amount of groundwater and overland flow out of the western boundary this deviation in outflow direction can be attributed to a slight misalignment of the transect to the slope such that the northern boundary is not parallel with the topographic contours the result is that outflow along the downstream boundary includes part of the western boundary fig 4 therefore from this point onward the downstream boundary for t34 will include flows out of both the northern and western boundaries due to inclusion of both the northern and western boundaries in the outflow calculation for t34 we are unable to draw any conclusions regarding the 2d versus 3d flows 3 3 model performance with respect to flow partitioning 3 3 1 daily flow partitioning figs 5 and 6 show simulated daily flow values for downstream overland flow oo dwn and the downstream fraction of overland flow out f oo dwn from the four transects respectively performance metrics are shown in table 4 the observed oo dwn from petersen et al 2020a differs considerably among the transects ranging from 0 to 23 mm d in t31 to 0 270 mm d in t32 in general the observed overland flow is characterised by large episodic winter outflow events which reduce during summer the magnitude of the cut off drain inflow strongly influences the overland flow out for t32 t34 whereas overland flow out of t31 is small by comparison for t31 none of the simulations could replicate the temporal response in oo dwn fig 5a to any degree of accuracy table 4 fig 3 shows that t31 has a low hydraulic gradient in comparison to the other transects when coupled with the shallowest topographic slope results in a dominance of groundwater outflow rather than overland outflow the majority of the observed events are underestimated by the simulated oo dwn in t32 fig 5b the ability of the simulated oo dwn improves as the models grid resolution decreases which is reflected in the reduction in rmse and increase of n s from f500 to f10 in table 4 t33 follows roughly the same relationship simulated oo dwn and model resolution however f20 is outperformed by f50 this relationship between simulated oo dwn and model resolution is not repeated in t34 fig 5d the simulation results for t34 show that f20 performs the best followed by f50 whilst f10 performed worse the poor performance of f10 is caused by the large overestimation of overland flow out on the 26 oct 2016 in general table 4 shows that for oo dwn f500 performs poorly for all transects with high rmse values and low n s when comparing the results from t32 t33 the statistical performance of f100 f50 f20 and f10 are reasonably consistent such that in general the finer models f10 and f20 outperform the coarser models for t34 f20 outperforms the other model resolutions overall f20 performs best at reproducing the downslope overland flow out and tends to have the lowest rmse and highest n s fig 6 shows that the simulated downstream fraction of overland f oo dwn for all models is generally smaller than the observed f oo dwn from petersen et al 2020a the inability of any of the models to capture the oo dwn response in t31 fig 5a translates to an equally poor performance in f oo dwn fig 6a fig 6b shows that for t32 the f oo dwn remains above zero the entire year in both f10 and f20 due to the continuously simulated oo dwn fig 5b table 3 indicates that for f oo dwn in t32 f20 performs best followed closely by f10 no overland flow out is simulated in f500 for t32 and therefore f oo dwn remains at zero for this model the f oo dwn in t33 follows the same trend as in oo dwn whereby f50 has the lowest rmse 0 4 followed by f20 0 45 table 3 all models have negative n s values f500 and f10 perform the poorest for t33 conversely in t34 the finer resolution models outperform the coarser models excluding f10 the tendency for f10 t34 to overestimate overland flow out fig 5 corresponds to peaks in the f oo dwn 1 generally none of the models perform well in simulating the daily observed f oo dwn the variability in the performance for the different models across all four transects means that no particular model resolution consistently outperforms the other models 3 3 2 annual flow partitioning in general the observed fraction of groundwater flow f go out of each transect is smaller 0 3 than the observed fraction of overland flow f oo fig 7 however the errors bars for the observed f go in fig 7a are larger than those for f oo fig 7b the small f go tot relative to f oo tot in the flow partitioning is replicated by most of the models with the exceptions of f500 and f100 for t32 and t34 f500 and f100 simulate the opposite response to the observed flow partitioning for these transects where the f go tot is greater than f oo tot this is primarily a consequence of the models grid scale relative to the transect area the point source flow from the cut off tile drains was distributed across a model cell significantly larger than the intended area the consequences of this drain flow distribution are most notable where the transect dimensions are significantly smaller than the grid cell area for transects whose areas are close to or greater than the grid scale e g t31 and t33 whose areas are 11500 m2 and 11700 m2 respectively groundwater dominance is not simulated i e for models whose grid resolution is 100 m fig 7 shows that the flow partitioning in t31 is poor across all models with a highly variable estimation of the f go tot and an underestimation of the f oo tot the models perform reasonably well with regard to f go tot t32 t33 and t34 for f oo tot only f10 f20 and f50 simulate overland flow out which approaches the observations for f oo tot transects t32 and t34 show that a refinement in grid scale increases the simulated f oo tot fig 7b the improvement in the estimated f oo tot relative to the observed f oo tot is clearer for t34 than for t32 this grid scale relationship is not observed for f oo tot in t33 where most models perform similarly by overestimating the f oo tot fig 7b shows that there are differences in the 3d f oo tot and 2d f oo dwn in most transects the most notable differences between f oo dwn and f oo tot are in t32 and t33 indicating a substantial lateral overland outflow component see 3 2 2d versus 3d flow patterns for t32 these lateral components constitute 2 35 of the total overland flow out for models f10 f50 and 10 100 for t33 for all models as previously discussed most models simulate lateral overland outflows for t33 resulting in a substantial reduction between 3d f oo tot and 2d f oo dwn notably although f20 t33 figs 3 and 4 does simulate this lateral exchange it is dominated by overland inflow rather than outflow at the eastern and western boundaries which therefore has minimal impact on the 3d f oo dwn calculation as previously discussed section 3 2 for t34 the inclusion of the western boundary in the calculation f oo dwn and the minimal of gross oo from the southern and eastern boundaries means that f oo tot and f oo dwn are approximately equal fig 7 from f50 to f10 grid refinement in this transect results in an increase in both f oo tot and f oo dwn in general the largest difference between 3d f go tot and 2d f go dwn was small 0 03 the one exception to this is f50 t34 where the difference is 0 12 this indicates that the transects are roughly orientated in the dominant groundwater flow direction with minimal lateral groundwater flow occurring fig 6a in general the annual total flow partitioning for overland f oo tot and groundwater flow f go tot in each transect indicates the models f10 and f20 perform the best particularly for f oo tot for t32 t33 t34 fig 7 this is also indicated by the mean statistical behaviour of the models across all transects shown in table 5 which clearly shows that the mean flow partitioning behaviour in f10 and f20 are more consistent with the observed flow partitioning and tend to have the lowest rmse and me fig 7 also shows a noticeable difference between the simulated total and downslope statistics for overland flow this suggests that the 3d flow fractions provide a better match to the 2d flow observations from petersen et al 2020a this may be a consequence of transect alignment such that petersen et al 2020a had the flexibility to orient the transects parallel to the main flow which can be challenging in an orthogonal finite difference grid used by mike she generally the annual statistical behaviour in f20 appears to be more consistent between the total and downslope fractions of both groundwater and overland flow in comparison to f10 4 discussion 4 1 downscaling results in this study 2d versus 3d flow the simulation results indicate that both overland flow and groundwater flow to a large extent are unidirectional for transects t31 t32 and t33 deviations from this flow orientation in t34 can be explained by the transects alignment to the orthogonal model grid section 3 2 modification of the boundaries in t34 was required when extracting the flow components used in the calculation of the downslope flows where there is a lateral exchange of flows in the transects the net exchanges are small relative to the flows parallel to the transect alignment this lateral exchange was greatest in t33 e g for f50 f100 and f500 it exceeded the overland flow out of the downstream boundary in the evaluation of our models we also need to consider that there are uncertainties both in our models and in the petersen et al 2020a observed data which as previously noted have been processed using a simple water balance model therefore a pertinent question is how well should our models perform for them to be considered a good fit when compared to those by petersen et al 2020a the uncertainty on the recorded annual total inflows and outflows into the transects of petersen et al 2020a was between 5 26 in this context the numerical inaccuracies 9 transect annual water balance errors in our model simulations can be of relatively small importance for our study in addition to this there is uncertainty in the observed data due to the 2d assumption made by petersen et al 2020a the effect of which has not been quantified in petersen et al 2020a in this respect the difference in our model simulations of total and downslope f oo can be considered a measure of the uncertainty caused by the 2d assumption but due to the flexibility of petersen et al 2020a to align transects compared to our rigid grids this measure is likely to represent an upper end of this uncertainty hence the total uncertainty of the observed field data in combination with the 2d assumption would be larger than the 5 26 range assuming these components are independent we can therefore consider those of our model simulations having errors less than this to perform satisfactorily on this basis the f10 t32 t34 and f20 all models can be considered as useful models for simulation of total annual flow partitioning whereas f50 have a lower accuracy 4 2 impacts of grid refinement the results of this downscaling experiment clearly indicate that the grid refinement results in an improved estimation of the annual flow partitioning the ability to simulate annual flow partitioning is considered adequate for water management purposes of this study the degree of this improvement is affected by the target area in question in two of the transects grid refinement correlated well with the models ability to simulate the observed fraction of overland and groundwater flow out of the transect namely t32 and t34 for t33 there appears to be a similar trend in the annual fraction of groundwater flow out while this is not observed in the annual fraction of overland flow out this suggests that considerable improvement in annual flow partitioning is gained through model refinement but that there are additional factors at play resulting in a spatially variable improvement within the models in contrast none of the models consistently performed well at reproducing the daily fraction of overland flow out this difference between the daily and annual fraction of overland flow out suggests that even though replicating the daily temporal response is challenging the overall behaviour is consistent with the observed response the tendency to underestimate the daily fraction of overland flow indicates that all models simulate a higher daily inflow into the transects in particular via overland and groundwater inflows compared to the observed daily inflows in petersen et al 2020a the chosen variables f oo tot and f oo dwn rely on the total inflows rather than the net inflows into the transect therefore the lateral overland and groundwater flow inputs will contribute to the total inflows potentially skewing the results grid refinement and its resulting impact on the structure of the model may be a contributing factor to the simulated difference in both f go and f oo and the observed data scaling of the topography to the relevant grid resolution results in different slope characteristics within the transects across the models for example the mean slope for t32 is 9 3 in f10 6 7 in f50 and 0 6 in f500 even at the smallest resolution small scale topographic features such as channels and depression which will impact overland flow patterns are removed likewise the modification of the layer geometries lower and upper boundaries also results in changes in the vertical structure of the subsurface shown in fig 2 p t as a consequence the geometries of the model layers are slightly different these differences in geological geometry are minor for the models whose resolution is less than or equal to the original scale of the layer data 100 m see table 2 however for f500 the upscaling of the geological layer geometry has a considerable effect on the subsurface structure fig 2p this will contribute to the uncertainty in the groundwater flow in f500 4 3 geological conceptualisation the groundwater flow partitioning performed poorly in comparison to the overland flow partitioning this is likely a difference between the geological models used in petersen et al 2020a and our simulations the geological model used in the dk model is based on a national hydro stratigraphical mapping aimed at representing the dominant large scale hydrogeological features in a simplified and spatially consistent form stisen et al 2019 therefore it does not include the site specific data used by petersen et al 2020a to delineate the subsurface structure beneath the transects this limitation is also applicable to all other riparian lowlands across denmark petersen et al 2020a used local borehole profiles to delineate geological layers and piezometer data to estimate groundwater in and outflow and to estimate the storage capacity beneath the transects based on this data the morphology of the subsurface layers varies considerably between the transects fig 3 in petersen et al 2020a the depth to the clay till specified as the geological base of the transect is inclined towards the stream but reasonably consistent in t32 and t33 ranging from approx 5 15 m the subsurface structures in t31 and t34 consist of localised depressions in the clay of up to 10 m deeper than the surrounding clay elevation filled with sand and gyttja whereas our approach was to only include those model computational layers with a direct connection to the river the top four model layers the top layer represents 2 m of peat subsequent layers are dominated by clay and the total thickness of these four layers ranges from 14 m t33 to 26 m t31 the degree of variability in thickness observed by petersen et al 2020a is not replicated in the geological model and consequently the models computational layers this will likely contribute to the fact that we are only able to reproduce the groundwater flow conditions with a limited degree of accuracy 4 4 scaling input data data on many structural elements were available in fine spatial resolution table 2 allowing heterogeneous downscaling to be used whereby the spatial representation differs between the f10 f20 f50 f100 f500 models while the associated effective parameter values do not vary in contrast to this meteorological data were only available at 10 20 km grid and geological data at 100 m grid requiring a homogeneous downscaling of meteorological data while geological data were heterogeneously downscaled from 500 m to 100 m and homogeneously downscaled from 100 m to 10 m for meteorological data a more site specific heterogeneously downscaling algorithm which uses e g topography wind direction and vegetation fang et al 2013 could have been used for the fensholt subcatchment such an approach might have altered the precipitation temperature and et inputs to the model however we chose to rely upon the same climatic boundary conditions applied to the large scale model and apply a simple bilinear interpolation to obtain local climate conditions petersen et al 2020a installed a precipitation gauge in the fensholt subcatchment we have compared the point data from the gauge to the modelled precipitation and found that on an annual basis the simulated precipitation is within 3 of the local observed precipitation this suggests that use of the national precipitation data only contributes a little to uncertainties in annually simulated flows similarly the climate data used has allowed the models to produce the correct flow dynamics e g fig 4 t32 which suggests that the poor daily modelled performance can mainly be attributed to poor flux partitioning rather than climate uncertainties regarding the downscaling of the geological model we assumed that the effects of sub grid scale heterogeneity on the flow field are negligible the calibrated hydraulic conductivities from the dk model represent effective model parameters for the different model layers across the entire model domain in the order of 100 km while effective model parameters capture the mean properties at that length scale the not accounted for geological heterogeneity poses uncertainty in simulated heads and flows at smaller spatial scales such as the four transects in fensholt de marsily et al 2005 sanchez vila et al 2006 wen and gómez hernández 1996 zech et al 2012 generally the uncertainty due to geological heterogeneity increases with decreasing length scale refsgaard et al 2016 in our specific case the non accounted for geological heterogeneity apparently does not generate so large uncertainty at the transect scale that our downscaled models become non behavioural 4 5 limitations it should be noted that our results have not been documented as generically applicable but are dependent on the hydrogeological setting and type of model used the transects in this study were all located in the same till dominated hydrogeological setting which is characterized by shallow flow with limited direct interaction with regional aquifers therefore the exact description of the regional geology may be less important and groundwater flow is controlled by other mechanisms previous research has highlighted the importance of the river valley hydrogeological setting on the response of riparian lowlands dahl et al 2007 hill et al 2014 vidon and hill 2004 whether comparable results would be achieved in different hydrogeological settings such as alluvial sandy unconfined aquifers is not certain in addition use of a different hydrological model than the dk model with its specific conceptualisations might have shown quite different results in this study we have only explored the downscaling impacts on flow partitioning at the field scale therefore the conclusions drawn from this study can only apply to the water balance components should an investigation be interested in other observation types such as groundwater head and or stream discharge further modelling investigations and potentially calibration may be required also given that simulation of local scale flow components are typically more uncertain than simulation of groundwater heads and total river discharge refsgaard et al 2012 we expect that the conclusions on the potential of downscaling large scale models may apply also for other water balance components 4 6 novelty and perspective small riparian lowlands play a significant role in the danish landscape by removing nitrate on its route from the agricultural fields towards the coastal waters the fate of nitrogen in riparian lowlands depends on whether water flows on the surface in oxidised environments or as subsurface flow in geochemically reduced conditions the motivation for our study was that our national hydrological model due to its relatively coarse spatial discretisation 500 m is unable to simulate flow partitioning in small riparian lowlands most of which are at the same size or smaller than the model grid size our study has demonstrated that a downscaling into finer spatial resolution enables 10 m and 20 m models without calibration against local data to simulate annual flow partitioning with an accuracy corresponding to the uncertainty of local field data while such results from our study cannot be expected to be generic and the suitability of downscaling therefore needs to be tested for specific applicability from case to case our findings are encouraging and open a road towards utilizing national scale models for studies of local scale phenomena occurring at spatial scales smaller than the grid scale of the original model our findings indicate that the groundwater and overland flow patterns produced by refining the grid resolution of a large scale coarse resolution model are consistent with local scale observations on an annual basis this suggests that it may be possible to construct and parameterise a fine resolution model based upon a regional model and obtain reasonably accurate advective flow patterns which in turn may be used to simulate solute transport for ungauged catchments with some degree of accuracy note that this work focusses on downscaling a national scale model to reproduce local scale flow patterns rather than using it for contaminant transport behaviours as discussed in guo et al 2019 the novelty of our study is that we have shown for a specific catchment and a specific model application that a coarse resolution model can be downscaled and preserve some of its applicability at spatial scales that are more than one order of magnitude smaller than the original model grid size contrary to this other studies have shown that spatially distributed models generally do not have predictive capability at the grid scale but only at larger spatial scales refsgaard et al 2016 wood et al 1988 this illustrates that no statements on adequacy of modelling concepts will have universal validity and it is well in line with the coherent philosophy for modelling of the environment proposed by beven 2002 where he argues that it is required to be able to define those areas of the model space where behavioural models occur 5 conclusions this study explored the potential to downscale a large scale national model using the same conceptualisation model code and parameter set to enable the simulation of local scale flow partitioning we explored the efficacy of different grid scales to reproduce observation data at four transects within the fensholt subcatchment at the subcatchment scale the water balance errors of the models decreased with increasing grid resolution with the 100 m model performing best and the 10 m model performing worst this increase in water balance error can be attributed to numerical instabilities in the simulation of overland flow for models whose topography closer approximate the actual complex topography in general the ability to accurately estimate the overland flow partitioning is of importance to our ability to estimate the potential for nitrate reduction within riparian lowlands our results indicate that the simulated annual flow partitioning approaches the observed flow partitioning as grid scale decreases although this is not uniform across the four transects used in the comparison the variable response between transects may have resulted from the misalignment of the orthogonal grids to the transects which became more challenging with the large grid resolutions also the use of gross outflow rather than net flows in quantifying the target metrics may contribute to the variable response between transects for the three sites whose dominant outflow was via overland flow the finer resolution models provided the highest predictive accuracy this is possible because some of the underlying data such as topography and vegetation were available at spatial scales below 500 m all models were unable to simulate daily flow partitioning accurately however the high resolution fine models can be claimed to have predictive capability for annual simulations the results also indicate that a high resolution model whose structure and parameterisation is based on a lower resolution calibrated model can reproduce the observed annual flow partitioning at the field scale with a reasonable degree of accuracy our results also suggest that the optimal grid scale for cases similar to the observed transects is between 10 m and 20 m it should be emphasised that this should be seen as a potential that needs to be tested before specific applications to practical water management support credit authorship contribution statement s l noorduijn conceptualization methodology writing original draft j c refsgaard writing original draft writing review editing r j petersen resources writing review editing a l højberg conceptualization writing review editing funding acquisition supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was supported by future cropping innovation fund denmark project no 5107 00002b https futurecropping dk and t rex gudp project nr 34009 18 1453 projects the field data was collected as part of the trends project innovation fund denmark project no 4106 00027b trends nitrat dk cut off drain flow data was provided by the idraen project gudp project no 3405 10 0142 https idraen dk we gratefully acknowledge raphael schneider and simon stisen for the valuable discussions and comments to earlier versions of the manuscript thanks to w j de lange and an anonymous reviewer for providing valuable feedback on this work 
4113,the resolution of nation scale hydrological models is often considered a limitation with respect to providing useful management information on local scale issues use of these coarse scale models to inform both the structure and parameterisation of local scale models could potentially enhance their utility and in some cases provide initial estimates to local scale water resource issues such as nitrate transport this study explores whether a finer resolution model whose conceptualization and parameterisation are based upon a nation scale model can replicate local scale water balance observations and in this way expand the utility of large scale models we use the danish national water resources model dk model as a template to model a small 5 km2 subcatchment in denmark and compare the flows at four transect locations to those observed in a previous field investigation the resolution of the dk model is 500 m and this model was refined to create four additional models of the subcatchment with 100 m 50 m 20 m and 10 m resolutions results suggest that none of the refined models could accurately capture the daily overland and groundwater flow conditions however for the finer resolution models 10 m and 20 m the annual overland and groundwater flows agreed well with the observed flows keywords dynamical downscaling nation scale local scale modelling nitrate overland flow riparian areas flow partitioning 1 introduction more and more national and regional scale 10 000 km2 hydrological models are being developed and applied for water management barthel and banzhaf 2016 this development has been possible due to an increasing availability and accessibility of data and due to computational efficiency improvements this opens up possibilities to explore hydrological issues at a larger scale which can provide insight and aid decision makers on policy and appropriate management options consequently considerable resources are being spent on developing national scale de lange et al 2014 refsgaard et al 2010 sutanudjaja et al 2014 and regional scale models chen et al 2020 maxwell et al 2015 michael and voss 2009 xu et al 2021 yang et al 2020 the accuracy of such large scale models is among other things related to the availability of data and computational power plûmacher and kinzelbach 2000 because coarse spatial resolution prevents a model to accurately simulate smaller scale processes and therefore limits the model applicability there is often a wish to apply as small a grid size as practically possible the computational demands of a hydrological model are a function of the size number of active cells of the model model calibration and uncertainty assessments typically requiring numerous model runs taking days to weeks to complete in practice define the limits for how small grid sizes can be used therefore considerations of both the available computational capacity and the grid resolution are necessary much of the information used to construct and calibrate these models comes in a wide range of scales e g point scale groundwater head data cm to hundreds of m scale remote sensing data subcatchment catchment scale stream discharge data local to national scale geological models and continental scale grace data landerer and swenson 2012 these data require various degrees of down or up scaling prior to use in regional scale models blöschl 2001 cushman 1986 wood 2009 the methods used to scale the data inevitably lead to some degree of information loss and need to account for the heterogeneity which the model can represent wen and gómez hernández 1996 one approach is to use numerous stochastic realisations of aquifer properties dagan 1997 zinn and harvey 2003 another approach is to recognise the limitations of the models to accurately replicate reality by exploring multiple conceptual models enemark et al 2019 although both approaches aim to reduce uncertainty in the simulations model calibration still involves the use of data e g point groundwater head data whose resolution is substantially finer than the simulation beckie 1996 carrera et al 2005 hunt et al 2020 often the resolution of these models constrains our ability to quantify the hydrological response at smaller scales unless hydraulic responses are considered homogenous within the grid it is not possible to quantify them at a scale smaller than the grid resolution for instance using a model whose grid resolution is 1 km by 1 km to understand the hydrological response e g hydraulic head or flows taking place in an area of 100 m by 100 m is questionable other studies suggested that models generally only have predictive capability at spatial scales larger than the model grid scale wood et al 1988 refsgaard et al 2016 consequently it is commonly assumed that accurate simulation of local hydrogeological responses requires a high resolution local scale model whose parameters are optimised to the processes and observations at that scale e g hansen et al 2018 in the following we use the term downscaling for a process whereby a coarse scale model is used to construct a model with a finer spatial resolution the two main classes of downscaling statistical and dynamical downscaling are frequently used in climate research dessai and hulme 2007 fowler et al 2007 holman et al 2009 quintana seguí et al 2010 wilby et al 1998 in statistical downscaling relationships are derived between the coarse scale model data and the fine scale target variable in addition to classical statistical techniques machine learning techniques have recently been utilised as a powerful tool to combine coarse scale model data with other data sources available at finer scale koch et al 2019 dynamical downscaling uses the coarse scale model data as boundary conditions to force a finer resolution model in climate modelling global models gcms are dynamically downscaled to continental models rcms wilby et al 2004 a spatially distributed hydrological model is typically parameterised in terms of structural elements e g geological units soil types vegetation classes with different spatial representations and effective parameter values assumed to simulate average conditions within each of the structural elements refsgaard 1997 in dynamical downscaling the structural elements and the parameter values can either be assumed to be identical in the coarse scale and the fine scale models or the spatial representation of structural elements can be modified using available fine scale data we denote those two approaches for homogeneous downscaling and heterogeneous downscaling respectively while several studies have tested the performance of upscaling fine resolution hydrological models to coarse resolution models cushman et al 2002 farmer 2002 refsgaard 1997 vermeulen et al 2006 few studies have explored the possibility of downscaling a coarse resolution model to a fine resolution model using the same parameterization in doing so several assumptions are made regarding the representativeness of both the structural elements and the calibrated parameter values of the large scale model in terms of groundwater flow such parameter transfers would typically assume that the sub grid heterogeneity is negligible refsgaard et al 2016 wang et al 2002 and that the calibrated regional hydraulic conductivities are also representative of those at the small scale and independent of the grid scale without further time intensive calibration would this downscaling strategy be effective at replicating local scale observations the present study is part of an attempt to enhance the existing national nitrogen model nnm højberg et al 2015 where one of the recognised weaknesses is an inability to accurately assess nitrate reduction in riparian lowlands previous studies have suggested that nitrate reduction in lowlands can be estimated if the flows from the upland to the stream through the riparian lowland can be separated into overland flow and subsurface flow dahl et al 2007 petersen et al 2020b petersen et al 2020a for example the likelihood of nitrate reduction within a riparian lowland dominated by surface runoff is low because the nitrate remains in an oxic environment conversely if groundwater flow dominates the likelihood of nitrate reduction is higher because the nitrate is transported through an organic rich anoxic environment the nnm relies on the flow patterns in the danish national water resources model dk model to simulate the subsurface transport to aquatic ecosystems a substantial number of riparian lowlands are smaller than the model grid size 500 m in the dk model as a result flow partitioning volume of overland flow or groundwater flow relative to the inflow within a riparian lowland cannot be resolved from the coarse resolution national model it is therefore relevant to examine whether a high resolution version of the national model applied to a small catchment will be able to reproduce local field measurements of flow partitioning in particular overland flow and groundwater flow the objectives of this study are to test 1 how the simulated local scale flow partitioning at the field scale is affected by the spatial resolution of the computational grid and 2 whether a high resolution model whose structure and parameterisation is based on a lower resolution calibrated model can replicate the observed flow partitioning at the field scale in this study we use the danish national water resources model dk model as an example of a large scale national model with a 500 m resolution observed water balance data are available for four transects within a small subcatchment of the norsminde catchment jutland denmark petersen et al 2020a 2 methodology 2 1 field site this study focusses on the 5 km2 fensholt headwater subcatchment of the norsminde catchment in eastern jutland denmark the subcatchment contains a small riparian lowland approx 1 5 km in length in an undulating clay till landscape this site has been the focus of numerous studies investigating the water and nutrient balance geology and tile drain efficacy de schepper et al 2017 hansen et al 2019a hansen et al 2019b petersen et al 2020b petersen et al 2020a prinds et al 2020 prinds et al 2019 the catchment is 77 agricultural land the vast majority of which has a dense tile drain network draining groundwater into a small stream located within the riparian lowland surface geology is dominated by clay with a small localised area of sand adjacent to the riparian lowland the riparian lowland sits on top of an organic rich peat deposit underlain by gyttja tile drainage is present in the upland area whilst the riparian lowland is largely undrained but there are areas where remnant tile drains still function geomorphology of the catchment is characterised by steep slopes bounding a flat lowland area in the upland area the slope ranges from 0 002 to 62 6 with an average of 6 6 for the entire upland area whilst the riparian lowland has a mean and median slope of 8 5 and 7 4 respectively average annual precipitation between 2000 and 2018 at the catchment is 624 mm y streamflow is perennial with low baseflow during summer and quick responses to rainfall events during winter petersen et al 2020a established four 2d transects t31 t34 within the riparian lowland to investigate the variation in water balance and local flow partitioning each transect was assigned an area as shown in fig 1 ranging from 1130 m2 to 11700 m2 for t32 and t33 respectively the transects were located where tile drains had been cut off at the edge of the riparian lowland resulting in overland flow on the riparian lowland at each transect flow meters were installed at the outlet of the cut off drains to monitor drain flow and piezometer nests running perpendicular to the stream to monitor the groundwater level across the transects reference is made to petersen et al 2020a for more details on the instrumental setup and the water balance model used to support the data interpretation the results of petersen et al 2020a water balance model provides a detailed dataset which can be compared with our simulated water balances these data are henceforth referred to as observations obs 2 2 model setup we used the danish national water resources model dk model as base model from which the fensholt model was extracted the dk model uses the mike she code refsgaard and storm 1995 dhi 2019 a 3d physically based fully distributed integrated catchment model abbott et al 1986 butts and graham 2005 of particular importance in this study is mike she s capacity to simulate the major terrestrial processes of the hydrological cycle and their interaction including precipitation surface runoff groundwater recharge groundwater flow and river flow butts and graham 2005 henriksen et al 2003 højberg et al 2015 stisen et al 2012 calibration of the dk model s hydraulic conductivity values uses groundwater head and river discharge data for in depth information regarding the setup and calibration of the dk model references are made to henriksen et al 2003 højberg et al 2013 højberg et al 2015 and stisen et al 2019 the dk model simulation provided the boundary conditions for the fensholt model the time varying groundwater head boundary conditions for the period of 1990 2018 and the same meteorological data were used for surface boundary inputs i e precipitation reference evapotranspiration and air temperature stisen et al 2019 the stream is simulated using mike hydro which couples to mike she dhi 2017 tile drainage was present in the upland areas located at 0 9 m below ground level for further information refer to hansen et al 2019a and hansen et al 2019b the lowland soil classification was used to delineate the riparian lowland and no tile drainage was simulated in this zone petersen et al 2020a identified t31 as having some tile drains present while no tile drains were found in the other transects the overland flow resulting from the cut off tile drains was simulated by adding the cut off tile drain discharge to the precipitation in the appropriate cells i e those containing a cut off drain for each transect a spin up approach was used to initialise the groundwater levels and surface water within the model the simulation period 1990 2018 was repeated until a quasi steady state condition was reached which took approx 38 years this was evaluated based on temporal trends in the simulated groundwater head compared to observed data from the subcatchment 2 3 downscaling approaches five grid resolutions were selected for comparison to the observed transect flow partitioning namely 500 m f500 100 m f100 50 m f50 20 m f20 and 10 m f10 grid table 1 each model represents a sub model of the dk model in that the model s conceptualisation and construction is consistent with that of the dk model the same input data were used in the models structure and parameterisation in general the heterogenous downscaling approach used to process the input data for each fensholt model was straight forward some of the raw input data used in the dk model is at a finer resolution than that used in the large scale model see table 2 for data source information therefore the processing of these data followed the same approach but with a smaller target resolution categorical data available as gis shapefiles or raster files e g surface geology and land use were processed into georeferenced grid data based on the dominant category present at the target scale fig 2 continuous data were processed into georeferenced grid data based on the mean value at the target scale the hydraulic parameterisation from the calibrated dk model was homogenously downscaled such that the horizontal and vertical hydraulic conductivity values for each model layer in the dk model were assumed to be representative at the finer scale the hydro stratigraphic model was converted into georeferenced grid data for the top and bottom of each unit 100 m scale for the dk model henriksen et al 2003 stisen et al 2019 the homogenous downscaling required the gridded data for each unit to be linearly downscaled to the required grid resolution this prevented incongruities in the model and ensured internal consistency meteorological data were homogenously downscaled using a bilinear interpolation tool built into mike she the input data for the stream cross sections connections and thalweg were identical for all models however mike she places the stream along the edges of the grid cells therefore grid resolution impacts the streams position within the model this also affects the placement of the transects and the associated extraction of flows visual inspection of the grid and transect polygons was used to delineate the transect areas and boundaries as closely as possible for each grid resolution fig 1 the distribution of the soil transfer functions børgesen et al 2009 used in the unsaturated zone parameterisation was not scaled 2 4 performance indicators 2 4 1 water balance overall model accuracy was evaluated based on the catchment scale water balance we extracted the water balance for each model for the period of sep 2016 aug 2017 and quantified the numerical error if the numerical error is large the simulation is not trustworthy and has a large uncertainty in the simulated output in addition to the catchment scale water balance we also extracted the water balance for each transect we assume that if the transect water balance errors are small then the internal flows are reasonably well simulated 2 4 2 flow partitioning to evaluate the impacts of grid refinement on the flows for each transect we chose three variables to compare the flow observations from petersen et al 2020a and the simulation results from the models namely 1 the simulated overland flow out of the transects 2 the total fraction of overland groundwater flow out relative to the total inputs into the transects 3d analysis and 3 the downstream fraction of overland groundwater flow out of the transect relative to the total input 2d analysis table 3 for clarity the terms gross net total downstream are defined as follows gross flow refers only to the amount of in or out flow along a specific transect boundary net flow is defined as the difference between the gross inflow and gross outflow along a specific transect boundary total is used when all gross boundary outflows are used in the calculation and downstream refers to the gross outflows of the boundary identified as the main transect outflow boundary note that the term water balance is used when all inflow outflow and storage components are included whereas flow partitioning is used when referring to either overland or groundwater flow out relative to the total inflows the daily overland flow out oo dwn of the transects required extracting the overland flow flux from cells along the boundary of the transects overland flow direction was determined based on the transect orientation the annual entire simulation period and daily total fraction of overland flow f oo tot and groundwater flow f go tot out of the transects relative to the inputs into each transect was used to compare the simulated 3d flow partitioning to the downstream 2 dimensional 2d transect partitioning from petersen et al 2020a in table 3 f qo tot is the total fraction of outflow of either overland flow or groundwater flow for time period t for the annual timeframe t a represents flows from sep 2016 to sep 2017 and for the daily timeframe t d is the daily flows between sep 2016 to sep 2017 pi t is precipitation mm y or mm d di t is cut off drain flow in mm y or mm d gi t is groundwater inflow mm y or mm d oi t is overland inflow mm y or mm d x o t is the sum of the gross out flows overland or groundwater from the northern x on t southern x os t eastern x oe t and western x ow t boundaries of the transect mm y or mm d all fluxes were normalised to the area of the transect the downstream flow partitioning q dwn t was based on the primary assumption of 2d flow made in petersen et al 2020a that the transect orientations are in the dominant groundwater and overland flow direction therefore all out flows occur across this downstream boundary thus the annual and daily fraction of overland flow f oo dwn and groundwater flow f go dwn for the downstream flow partitioning 2d analysis only used the gross flow out of the downstream transect boundary in the calculation while all boundary inflows via overland and groundwater flows were included in the inflows the downstream boundary for t31 t32 and t33 is the southern transect boundary due to their locations north of the stream conversely the northern transect boundary is used for t34 which is located south of the stream these variables are based on the simulated groundwater flows and surface overland flows into and out of the transect boundaries north south east and west extracted for the period sep 2016 aug 2017 from each model for the same timeframe drain flow out et precipitation and vertical groundwater flows were extracted from all cells within each transect groundwater flows were extracted for the upper model layers where there was direct simulated exchange between the groundwater and stream the performance of the simulated daily overland flows and annual overland flow partitioning table 3 were assessed by comparing to observations the metrics used to evaluate overland flows are the root mean squared error rmse and the nash sutcliffe coefficient n s while mean error me and rmse were used to evaluate the overland flow partitioning 3 results 3 1 numerical accuracy of the models the numerical accuracy of the simulations was assessed using calculated water balance errors as indicators water balance errors were calculated for the entire catchment as well as for the four transects the water balance errors for the entire catchment are 1 9 0 2 0 1 0 1 and 0 2 for f10 f20 f50 f100 and f500 respectively this indicates that the results from all models can be considered sufficiently accurate for further analyses while the f10 simulation comprises areas with inaccurate simulations water balance errors for the four transects in f10 reveal that f10 t31 has a water balance error of 23 while the water balance errors for the other three transects are below 9 the shallow slope and presence of localised depressions in t31 see fig 1a were more accurately represented in the finer grid resolution this resulted in the presence of stagnant ponded water leading to numerical instability therefore f10 t31 had to be excluded from further analysis results from the other three transects for f10 and for all four transects for f20 f50 f100 and f500 have been included in the further analyses 3 2 2d versus 3d analysis to evaluate the assumption made by petersen et al 2020a that the annual flows are 2d and that the third dimension can be neglected in the flow partitioning we have extracted the simulated annual flows using all three dimensions for all transect simulations fig 3 shows the overland vectors and groundwater flow patterns contours in the transects fig 4 shows the gross in and outflows for the f20 model the inflows from the cut off tile drains are point sources but for ease of comparison converted to mm year over the respective transect areas in fig 4 the cut off drainage flow is much smaller in t31 than in the other three transects the opportunity for infiltration and evapotranspiration of the cut off drainage flow is therefore greater in t31 with the result that neither groundwater flow nor overland flow are dominant outflow pathways rather et and drainage flow are the largest outflow pathways which is consistent with the response in petersen et al 2020a t33 and to some extent t32 are examples where the dominant overland flow directions are perpendicular to the transects downslope southern boundary fig 4 the slope within these transects exerts a greater influence upon the overland flow than it does on the groundwater flow out of the transects see fig 3 nevertheless all models simulate a lateral component to the groundwater and overland flow out of these transects in the overland flow for t32 there is considerable flow across the western boundary while for t33 flow occurs across both the western and eastern boundaries for t33 in f10 the lateral flows are dominated by both inflow o iw a of 3500 mm y and outflow o ow a of 3585 mm y along the western boundary the outflow along the western boundary in f10 t33 remains less than the downstream boundary o os a of 4431 mm y this exchange in and out flow along the western boundary is only simulated in f10 f20 f500 only simulate inflow along this boundary all models simulate overland flow out along the eastern boundary for t33 for f50 f500 this flow exceeds the downstream outflow this indicates that the 2d assumption only remains reasonable for t32 and t33 for models f10 and f20 whereas for models f50 f500 the lateral overland flow component exceeds the overland flow out of the southern boundary the water balance errors for t32 and t33 for all models are acceptable see section 3 1 the flow patterns within t34 are such that the dominant outflows occur along the western and northern transect boundaries fig 3 this flow pattern is replicated in all the models f10 f500 for t34 in the case of f20 there is a considerable amount of groundwater and overland flow out of the western boundary this deviation in outflow direction can be attributed to a slight misalignment of the transect to the slope such that the northern boundary is not parallel with the topographic contours the result is that outflow along the downstream boundary includes part of the western boundary fig 4 therefore from this point onward the downstream boundary for t34 will include flows out of both the northern and western boundaries due to inclusion of both the northern and western boundaries in the outflow calculation for t34 we are unable to draw any conclusions regarding the 2d versus 3d flows 3 3 model performance with respect to flow partitioning 3 3 1 daily flow partitioning figs 5 and 6 show simulated daily flow values for downstream overland flow oo dwn and the downstream fraction of overland flow out f oo dwn from the four transects respectively performance metrics are shown in table 4 the observed oo dwn from petersen et al 2020a differs considerably among the transects ranging from 0 to 23 mm d in t31 to 0 270 mm d in t32 in general the observed overland flow is characterised by large episodic winter outflow events which reduce during summer the magnitude of the cut off drain inflow strongly influences the overland flow out for t32 t34 whereas overland flow out of t31 is small by comparison for t31 none of the simulations could replicate the temporal response in oo dwn fig 5a to any degree of accuracy table 4 fig 3 shows that t31 has a low hydraulic gradient in comparison to the other transects when coupled with the shallowest topographic slope results in a dominance of groundwater outflow rather than overland outflow the majority of the observed events are underestimated by the simulated oo dwn in t32 fig 5b the ability of the simulated oo dwn improves as the models grid resolution decreases which is reflected in the reduction in rmse and increase of n s from f500 to f10 in table 4 t33 follows roughly the same relationship simulated oo dwn and model resolution however f20 is outperformed by f50 this relationship between simulated oo dwn and model resolution is not repeated in t34 fig 5d the simulation results for t34 show that f20 performs the best followed by f50 whilst f10 performed worse the poor performance of f10 is caused by the large overestimation of overland flow out on the 26 oct 2016 in general table 4 shows that for oo dwn f500 performs poorly for all transects with high rmse values and low n s when comparing the results from t32 t33 the statistical performance of f100 f50 f20 and f10 are reasonably consistent such that in general the finer models f10 and f20 outperform the coarser models for t34 f20 outperforms the other model resolutions overall f20 performs best at reproducing the downslope overland flow out and tends to have the lowest rmse and highest n s fig 6 shows that the simulated downstream fraction of overland f oo dwn for all models is generally smaller than the observed f oo dwn from petersen et al 2020a the inability of any of the models to capture the oo dwn response in t31 fig 5a translates to an equally poor performance in f oo dwn fig 6a fig 6b shows that for t32 the f oo dwn remains above zero the entire year in both f10 and f20 due to the continuously simulated oo dwn fig 5b table 3 indicates that for f oo dwn in t32 f20 performs best followed closely by f10 no overland flow out is simulated in f500 for t32 and therefore f oo dwn remains at zero for this model the f oo dwn in t33 follows the same trend as in oo dwn whereby f50 has the lowest rmse 0 4 followed by f20 0 45 table 3 all models have negative n s values f500 and f10 perform the poorest for t33 conversely in t34 the finer resolution models outperform the coarser models excluding f10 the tendency for f10 t34 to overestimate overland flow out fig 5 corresponds to peaks in the f oo dwn 1 generally none of the models perform well in simulating the daily observed f oo dwn the variability in the performance for the different models across all four transects means that no particular model resolution consistently outperforms the other models 3 3 2 annual flow partitioning in general the observed fraction of groundwater flow f go out of each transect is smaller 0 3 than the observed fraction of overland flow f oo fig 7 however the errors bars for the observed f go in fig 7a are larger than those for f oo fig 7b the small f go tot relative to f oo tot in the flow partitioning is replicated by most of the models with the exceptions of f500 and f100 for t32 and t34 f500 and f100 simulate the opposite response to the observed flow partitioning for these transects where the f go tot is greater than f oo tot this is primarily a consequence of the models grid scale relative to the transect area the point source flow from the cut off tile drains was distributed across a model cell significantly larger than the intended area the consequences of this drain flow distribution are most notable where the transect dimensions are significantly smaller than the grid cell area for transects whose areas are close to or greater than the grid scale e g t31 and t33 whose areas are 11500 m2 and 11700 m2 respectively groundwater dominance is not simulated i e for models whose grid resolution is 100 m fig 7 shows that the flow partitioning in t31 is poor across all models with a highly variable estimation of the f go tot and an underestimation of the f oo tot the models perform reasonably well with regard to f go tot t32 t33 and t34 for f oo tot only f10 f20 and f50 simulate overland flow out which approaches the observations for f oo tot transects t32 and t34 show that a refinement in grid scale increases the simulated f oo tot fig 7b the improvement in the estimated f oo tot relative to the observed f oo tot is clearer for t34 than for t32 this grid scale relationship is not observed for f oo tot in t33 where most models perform similarly by overestimating the f oo tot fig 7b shows that there are differences in the 3d f oo tot and 2d f oo dwn in most transects the most notable differences between f oo dwn and f oo tot are in t32 and t33 indicating a substantial lateral overland outflow component see 3 2 2d versus 3d flow patterns for t32 these lateral components constitute 2 35 of the total overland flow out for models f10 f50 and 10 100 for t33 for all models as previously discussed most models simulate lateral overland outflows for t33 resulting in a substantial reduction between 3d f oo tot and 2d f oo dwn notably although f20 t33 figs 3 and 4 does simulate this lateral exchange it is dominated by overland inflow rather than outflow at the eastern and western boundaries which therefore has minimal impact on the 3d f oo dwn calculation as previously discussed section 3 2 for t34 the inclusion of the western boundary in the calculation f oo dwn and the minimal of gross oo from the southern and eastern boundaries means that f oo tot and f oo dwn are approximately equal fig 7 from f50 to f10 grid refinement in this transect results in an increase in both f oo tot and f oo dwn in general the largest difference between 3d f go tot and 2d f go dwn was small 0 03 the one exception to this is f50 t34 where the difference is 0 12 this indicates that the transects are roughly orientated in the dominant groundwater flow direction with minimal lateral groundwater flow occurring fig 6a in general the annual total flow partitioning for overland f oo tot and groundwater flow f go tot in each transect indicates the models f10 and f20 perform the best particularly for f oo tot for t32 t33 t34 fig 7 this is also indicated by the mean statistical behaviour of the models across all transects shown in table 5 which clearly shows that the mean flow partitioning behaviour in f10 and f20 are more consistent with the observed flow partitioning and tend to have the lowest rmse and me fig 7 also shows a noticeable difference between the simulated total and downslope statistics for overland flow this suggests that the 3d flow fractions provide a better match to the 2d flow observations from petersen et al 2020a this may be a consequence of transect alignment such that petersen et al 2020a had the flexibility to orient the transects parallel to the main flow which can be challenging in an orthogonal finite difference grid used by mike she generally the annual statistical behaviour in f20 appears to be more consistent between the total and downslope fractions of both groundwater and overland flow in comparison to f10 4 discussion 4 1 downscaling results in this study 2d versus 3d flow the simulation results indicate that both overland flow and groundwater flow to a large extent are unidirectional for transects t31 t32 and t33 deviations from this flow orientation in t34 can be explained by the transects alignment to the orthogonal model grid section 3 2 modification of the boundaries in t34 was required when extracting the flow components used in the calculation of the downslope flows where there is a lateral exchange of flows in the transects the net exchanges are small relative to the flows parallel to the transect alignment this lateral exchange was greatest in t33 e g for f50 f100 and f500 it exceeded the overland flow out of the downstream boundary in the evaluation of our models we also need to consider that there are uncertainties both in our models and in the petersen et al 2020a observed data which as previously noted have been processed using a simple water balance model therefore a pertinent question is how well should our models perform for them to be considered a good fit when compared to those by petersen et al 2020a the uncertainty on the recorded annual total inflows and outflows into the transects of petersen et al 2020a was between 5 26 in this context the numerical inaccuracies 9 transect annual water balance errors in our model simulations can be of relatively small importance for our study in addition to this there is uncertainty in the observed data due to the 2d assumption made by petersen et al 2020a the effect of which has not been quantified in petersen et al 2020a in this respect the difference in our model simulations of total and downslope f oo can be considered a measure of the uncertainty caused by the 2d assumption but due to the flexibility of petersen et al 2020a to align transects compared to our rigid grids this measure is likely to represent an upper end of this uncertainty hence the total uncertainty of the observed field data in combination with the 2d assumption would be larger than the 5 26 range assuming these components are independent we can therefore consider those of our model simulations having errors less than this to perform satisfactorily on this basis the f10 t32 t34 and f20 all models can be considered as useful models for simulation of total annual flow partitioning whereas f50 have a lower accuracy 4 2 impacts of grid refinement the results of this downscaling experiment clearly indicate that the grid refinement results in an improved estimation of the annual flow partitioning the ability to simulate annual flow partitioning is considered adequate for water management purposes of this study the degree of this improvement is affected by the target area in question in two of the transects grid refinement correlated well with the models ability to simulate the observed fraction of overland and groundwater flow out of the transect namely t32 and t34 for t33 there appears to be a similar trend in the annual fraction of groundwater flow out while this is not observed in the annual fraction of overland flow out this suggests that considerable improvement in annual flow partitioning is gained through model refinement but that there are additional factors at play resulting in a spatially variable improvement within the models in contrast none of the models consistently performed well at reproducing the daily fraction of overland flow out this difference between the daily and annual fraction of overland flow out suggests that even though replicating the daily temporal response is challenging the overall behaviour is consistent with the observed response the tendency to underestimate the daily fraction of overland flow indicates that all models simulate a higher daily inflow into the transects in particular via overland and groundwater inflows compared to the observed daily inflows in petersen et al 2020a the chosen variables f oo tot and f oo dwn rely on the total inflows rather than the net inflows into the transect therefore the lateral overland and groundwater flow inputs will contribute to the total inflows potentially skewing the results grid refinement and its resulting impact on the structure of the model may be a contributing factor to the simulated difference in both f go and f oo and the observed data scaling of the topography to the relevant grid resolution results in different slope characteristics within the transects across the models for example the mean slope for t32 is 9 3 in f10 6 7 in f50 and 0 6 in f500 even at the smallest resolution small scale topographic features such as channels and depression which will impact overland flow patterns are removed likewise the modification of the layer geometries lower and upper boundaries also results in changes in the vertical structure of the subsurface shown in fig 2 p t as a consequence the geometries of the model layers are slightly different these differences in geological geometry are minor for the models whose resolution is less than or equal to the original scale of the layer data 100 m see table 2 however for f500 the upscaling of the geological layer geometry has a considerable effect on the subsurface structure fig 2p this will contribute to the uncertainty in the groundwater flow in f500 4 3 geological conceptualisation the groundwater flow partitioning performed poorly in comparison to the overland flow partitioning this is likely a difference between the geological models used in petersen et al 2020a and our simulations the geological model used in the dk model is based on a national hydro stratigraphical mapping aimed at representing the dominant large scale hydrogeological features in a simplified and spatially consistent form stisen et al 2019 therefore it does not include the site specific data used by petersen et al 2020a to delineate the subsurface structure beneath the transects this limitation is also applicable to all other riparian lowlands across denmark petersen et al 2020a used local borehole profiles to delineate geological layers and piezometer data to estimate groundwater in and outflow and to estimate the storage capacity beneath the transects based on this data the morphology of the subsurface layers varies considerably between the transects fig 3 in petersen et al 2020a the depth to the clay till specified as the geological base of the transect is inclined towards the stream but reasonably consistent in t32 and t33 ranging from approx 5 15 m the subsurface structures in t31 and t34 consist of localised depressions in the clay of up to 10 m deeper than the surrounding clay elevation filled with sand and gyttja whereas our approach was to only include those model computational layers with a direct connection to the river the top four model layers the top layer represents 2 m of peat subsequent layers are dominated by clay and the total thickness of these four layers ranges from 14 m t33 to 26 m t31 the degree of variability in thickness observed by petersen et al 2020a is not replicated in the geological model and consequently the models computational layers this will likely contribute to the fact that we are only able to reproduce the groundwater flow conditions with a limited degree of accuracy 4 4 scaling input data data on many structural elements were available in fine spatial resolution table 2 allowing heterogeneous downscaling to be used whereby the spatial representation differs between the f10 f20 f50 f100 f500 models while the associated effective parameter values do not vary in contrast to this meteorological data were only available at 10 20 km grid and geological data at 100 m grid requiring a homogeneous downscaling of meteorological data while geological data were heterogeneously downscaled from 500 m to 100 m and homogeneously downscaled from 100 m to 10 m for meteorological data a more site specific heterogeneously downscaling algorithm which uses e g topography wind direction and vegetation fang et al 2013 could have been used for the fensholt subcatchment such an approach might have altered the precipitation temperature and et inputs to the model however we chose to rely upon the same climatic boundary conditions applied to the large scale model and apply a simple bilinear interpolation to obtain local climate conditions petersen et al 2020a installed a precipitation gauge in the fensholt subcatchment we have compared the point data from the gauge to the modelled precipitation and found that on an annual basis the simulated precipitation is within 3 of the local observed precipitation this suggests that use of the national precipitation data only contributes a little to uncertainties in annually simulated flows similarly the climate data used has allowed the models to produce the correct flow dynamics e g fig 4 t32 which suggests that the poor daily modelled performance can mainly be attributed to poor flux partitioning rather than climate uncertainties regarding the downscaling of the geological model we assumed that the effects of sub grid scale heterogeneity on the flow field are negligible the calibrated hydraulic conductivities from the dk model represent effective model parameters for the different model layers across the entire model domain in the order of 100 km while effective model parameters capture the mean properties at that length scale the not accounted for geological heterogeneity poses uncertainty in simulated heads and flows at smaller spatial scales such as the four transects in fensholt de marsily et al 2005 sanchez vila et al 2006 wen and gómez hernández 1996 zech et al 2012 generally the uncertainty due to geological heterogeneity increases with decreasing length scale refsgaard et al 2016 in our specific case the non accounted for geological heterogeneity apparently does not generate so large uncertainty at the transect scale that our downscaled models become non behavioural 4 5 limitations it should be noted that our results have not been documented as generically applicable but are dependent on the hydrogeological setting and type of model used the transects in this study were all located in the same till dominated hydrogeological setting which is characterized by shallow flow with limited direct interaction with regional aquifers therefore the exact description of the regional geology may be less important and groundwater flow is controlled by other mechanisms previous research has highlighted the importance of the river valley hydrogeological setting on the response of riparian lowlands dahl et al 2007 hill et al 2014 vidon and hill 2004 whether comparable results would be achieved in different hydrogeological settings such as alluvial sandy unconfined aquifers is not certain in addition use of a different hydrological model than the dk model with its specific conceptualisations might have shown quite different results in this study we have only explored the downscaling impacts on flow partitioning at the field scale therefore the conclusions drawn from this study can only apply to the water balance components should an investigation be interested in other observation types such as groundwater head and or stream discharge further modelling investigations and potentially calibration may be required also given that simulation of local scale flow components are typically more uncertain than simulation of groundwater heads and total river discharge refsgaard et al 2012 we expect that the conclusions on the potential of downscaling large scale models may apply also for other water balance components 4 6 novelty and perspective small riparian lowlands play a significant role in the danish landscape by removing nitrate on its route from the agricultural fields towards the coastal waters the fate of nitrogen in riparian lowlands depends on whether water flows on the surface in oxidised environments or as subsurface flow in geochemically reduced conditions the motivation for our study was that our national hydrological model due to its relatively coarse spatial discretisation 500 m is unable to simulate flow partitioning in small riparian lowlands most of which are at the same size or smaller than the model grid size our study has demonstrated that a downscaling into finer spatial resolution enables 10 m and 20 m models without calibration against local data to simulate annual flow partitioning with an accuracy corresponding to the uncertainty of local field data while such results from our study cannot be expected to be generic and the suitability of downscaling therefore needs to be tested for specific applicability from case to case our findings are encouraging and open a road towards utilizing national scale models for studies of local scale phenomena occurring at spatial scales smaller than the grid scale of the original model our findings indicate that the groundwater and overland flow patterns produced by refining the grid resolution of a large scale coarse resolution model are consistent with local scale observations on an annual basis this suggests that it may be possible to construct and parameterise a fine resolution model based upon a regional model and obtain reasonably accurate advective flow patterns which in turn may be used to simulate solute transport for ungauged catchments with some degree of accuracy note that this work focusses on downscaling a national scale model to reproduce local scale flow patterns rather than using it for contaminant transport behaviours as discussed in guo et al 2019 the novelty of our study is that we have shown for a specific catchment and a specific model application that a coarse resolution model can be downscaled and preserve some of its applicability at spatial scales that are more than one order of magnitude smaller than the original model grid size contrary to this other studies have shown that spatially distributed models generally do not have predictive capability at the grid scale but only at larger spatial scales refsgaard et al 2016 wood et al 1988 this illustrates that no statements on adequacy of modelling concepts will have universal validity and it is well in line with the coherent philosophy for modelling of the environment proposed by beven 2002 where he argues that it is required to be able to define those areas of the model space where behavioural models occur 5 conclusions this study explored the potential to downscale a large scale national model using the same conceptualisation model code and parameter set to enable the simulation of local scale flow partitioning we explored the efficacy of different grid scales to reproduce observation data at four transects within the fensholt subcatchment at the subcatchment scale the water balance errors of the models decreased with increasing grid resolution with the 100 m model performing best and the 10 m model performing worst this increase in water balance error can be attributed to numerical instabilities in the simulation of overland flow for models whose topography closer approximate the actual complex topography in general the ability to accurately estimate the overland flow partitioning is of importance to our ability to estimate the potential for nitrate reduction within riparian lowlands our results indicate that the simulated annual flow partitioning approaches the observed flow partitioning as grid scale decreases although this is not uniform across the four transects used in the comparison the variable response between transects may have resulted from the misalignment of the orthogonal grids to the transects which became more challenging with the large grid resolutions also the use of gross outflow rather than net flows in quantifying the target metrics may contribute to the variable response between transects for the three sites whose dominant outflow was via overland flow the finer resolution models provided the highest predictive accuracy this is possible because some of the underlying data such as topography and vegetation were available at spatial scales below 500 m all models were unable to simulate daily flow partitioning accurately however the high resolution fine models can be claimed to have predictive capability for annual simulations the results also indicate that a high resolution model whose structure and parameterisation is based on a lower resolution calibrated model can reproduce the observed annual flow partitioning at the field scale with a reasonable degree of accuracy our results also suggest that the optimal grid scale for cases similar to the observed transects is between 10 m and 20 m it should be emphasised that this should be seen as a potential that needs to be tested before specific applications to practical water management support credit authorship contribution statement s l noorduijn conceptualization methodology writing original draft j c refsgaard writing original draft writing review editing r j petersen resources writing review editing a l højberg conceptualization writing review editing funding acquisition supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was supported by future cropping innovation fund denmark project no 5107 00002b https futurecropping dk and t rex gudp project nr 34009 18 1453 projects the field data was collected as part of the trends project innovation fund denmark project no 4106 00027b trends nitrat dk cut off drain flow data was provided by the idraen project gudp project no 3405 10 0142 https idraen dk we gratefully acknowledge raphael schneider and simon stisen for the valuable discussions and comments to earlier versions of the manuscript thanks to w j de lange and an anonymous reviewer for providing valuable feedback on this work 
4114,the channel impulse response function derived from the linearized saint venant equations has been widely applied to predict the streamflow discharge huang and lee 2020 indicated that the distribution type of the impulse response function proposed by dooge et al 1987a was restricted because of the constant reference parameters therefore they introduced the time varying reference parameters according to the upstream inflow condition to reinforce the flexibility of adjusting the impulse response function however this model called channel hydrological response function charfu was merely applicable to a channel under the assumption of a downstream open boundary this study intended to apply the other impulse response function which was derived from the downstream disturbance and combine this function with the one derived from the upstream input to extend the model applicability in various channel states to consider the temporal change of the downstream boundary condition the time varying reference parameters were also introduced in the function according to the tidal level at the estuary a routing procedure that explained the integration of the two impulse responses for both upstream and downstream inputs was proposed as well for the runoff simulation of the entire river basin a series of tests showed that the proposed model could even yield similar hydrographs with the comparative cases that applied the numerical model based on the saint venant equations owing to the revision of reference parameters a practical case of a river basin was also provided to demonstrate the effectiveness of the proposed model to reflect the influence of the downstream tidal level on the simulated hydrograph although the proposed linear channel routing method still can not be applied to simulate a channel reach with flow transitions such as a sharp change of water surface elevation due to the assumption of gradually varied flow in the linearized governing equations it can be more stable than a finite difference model and avoids the latter s occasional numerical oscillations especially when applied to a shallow channel with an irregular bed keywords impulse response function linear channel routing saint venant equations downstream boundary condition 1 introduction the downstream boundary condition is necessary for performing the computations of open channel flow with a sub critical state the open boundary denotes the downstream end is assumed as uniform flow and can be simplified by the steady state resistance equation hec ras 2016 this type of condition allows waves to pass out of the region without reflection khare et al 2019 it is also known as the normal depth boundary and advocates using manning s equation to give a stage considered to be normal depth if uniform flow conditions exist in the downstream section fenton 2014 indicated that information coming from upstream is dominant if the downstream open boundary condition is given as the waves that are input at the upstream boundary progress downstream however in some cases the perturbation coming from the downstream end cannot be ignored during flood simulations such as the tidal effect or the situation in which the recorded gauge data is available for calibration a tidal reach is defined as a section of a larger river whose flow and level are influenced by tides it has been indicated that the tidal reach is generally possessed of relatively low discharge rates but high overall discharge which implies a shallow river with a large coastal mouth moftakhari et al 2013 hoitink and jay 2016 the change of tidal level at the estuary can induce the backwater effect of an open channel the backwater effect can be deemed as a response to energy losses it usually occurs when the water surface elevation at a downstream location increases castelltort et al 2020 it has been denoted that the extension of the backwater affected area and the increase in water surface elevation are highly dependent on the river morphology floodplain characteristics and may induce upstream flooding brandimarte and woldeyes 2012 to bypass any problem about instability and oscillation in numerical schemes the linearized channel flow routing lcr has been a well known alternative for flood wave simulations by applying the convolution integral dooge and harley 1967 dooge et al 1987a 1987b dooge and harley 1967 derived the earlier instantaneous hydrologic response function of the wide rectangular channel based on the linearized saint venant equations in their model the linear accumulation of unit impulse response functions is the fundamental approach to present the convolution integral and produce the discharge hydrograph to take into account any shape of channel cross section and any type of friction law dooge et al 1987a further modified the analytical solution of the channel impulse response proposed in 1967 therefore the applicability of this model was significantly improved it should be noted that by applying the laplace transform they proposed the solution anywhere in the channel in terms of one convolution with a boundary condition at the upstream end and another convolution with the boundary condition at the downstream end to reinforce the flexibility of adjusting the shape of the impulse response huang and lee 2020 introduced the time varying hydraulic parameters which are determined by the inflow condition and channel topography in the convolution with the upstream boundary condition therefore a superior similarity of simulated results with the numerical outcomes based on the full type of saint venant equations could be found overall the solutions generated by this model were reliable for streamflow predictions since the physical significance and the temporal change of the reference parameters were emphasized to describe the hydrological process during floods nevertheless it has been indicated that their modified model currently was merely applicable to the situation in which the downstream boundary condition is assumed as normal depth namely the open boundary huang and lee 2020 the focus of this study is to include the convolution with the downstream boundary condition into the previous model proposed by huang and lee 2020 the modified model can therefore consider the influence of tidal level at the estuary on the streamflow prediction given the laplace transform of the linear channel response for a downstream input was proposed by dooge et al 1987a this study further converts this formulation to the time domain to derive the solution of the impulse response for a downstream input moreover the time varying hydraulic parameters affected by the downstream boundary condition and the channel topography are also introduced in the proposed impulse response function in this way the two types of impulse response functions separately derived from an upstream input and a downstream disturbance can be combined to expand the model applicability in various channel states to evaluate the outcome of this modified linear channel model the numerical solution of an implicit finite difference scheme based on the nonlinear saint venant equations is provided in this study moreover a practical case study applied to the tou cian river basin is performed to assess the accuracy of flood prediction and manifest the applicability of the proposed channel response system 2 modified channel impulse response model dooge et al 1987a derived a useful impulse response function for the linear channel routing which can apply to an irregular cross section however the flexibility of adjusting the shape of the channel impulse response is constrained since the reference parameters adopted in their model are assumed as constant coefficients in this study the upstream inflow and downstream boundary conditions are simultaneously applied to determine time varying reference parameters for altering the distribution of impulse response functions during floods moreover to allow the spatial variability of hydraulic characteristics the main channel of a watershed is divided into several segments to link with their respective lateral flow areas and upstream contributing areas this routing concept was originally proposed by huang and lee 2020 with the assumption of a downstream open boundary in this study this model is further revised to consider the downstream disturbance of the tidal effect the following sub sections sequentially provide four parts of explanations about the channel response system 1 the theoretical basis of the linear channel model 2 the analytical solution channel impulse response function derived form of the linearized governing equation 3 the introduction of time varying reference parameters 4 the procedure for the continuous routing of the channel response system 2 1 theory of the linearized momentum equation the one dimensional saint venant equations are widely applied to simulate the gradually varied flow in an open channel to consider the irregular channel bed the discharge q x t and the cross sectional area a x t are used as the dependent hydraulic variables so the momentum equation can be expressed as cunge et al 1980 1 1 f 2 g y a x 2 q a q x q t g a s o s f where f is the froude number y is the hydraulic mean water depth s o is the bottom slope and s f is the friction slope since the momentum equation shown in eq 1 is nonlinear no analytical solution is available one alternative was proposed to find a satisfactory approximate solution by using the linearization of the nonlinear equation dooge et al 1987a adopted eq 1 to derive a linearized formula as 2 1 f o 2 g y o 2 q x 2 2 v o 2 q x t 2 q t 2 g a o s f q q t s f a q x where q can be assumed as the flow perturbation while f 0 y 0 and v 0 denote the froude number the mean water depth and the mean flow velocity for reference condition respectively eq 2 is based on the assumptions that the unsteady flow is deemed as a perturbation from a steady flow condition and the higher order terms of flow are neglected under these assumptions the discharge can be expressed as 3 q x t q 0 q x t where q 0 is the reference condition of steady flow q is the first order increment of flow it has been indicated that eq 2 can adapt to the irregular channel and any friction law when any form of flow transitions can be neglected dooge et al 1987a 2 2 channel impulse response functions the unit flow response of a uniform channel can be described by two types of impulse response functions that are separately derived from an upstream input and a perturbation from the downstream end dooge et al 1987a indicated that the laplace transform of the impulse response for an upstream and a downstream input is separately given by 4 q u x s exp exs f x x a s 2 b s c 5 q d x s exp e l x s f l x l x a s 2 b s c in which q u is the impulse response resulted from an upstream input q d is the impulse response resulted from a downstream disturbance l is the total length of the channel a b c d e f are the parameters related to the hydraulic variables and given by the following relationship 6a a 1 g y o 1 f 0 2 2 6b b 2 s 0 v 0 y 0 1 m 1 f 0 2 1 f 0 2 2 6c c m 2 s 0 y 0 2 1 1 f 0 2 2 6d d b 2 4 a c 6e e 1 g y 0 0 5 f 0 1 f 0 2 6f f m s 0 y 0 1 f 0 2 by converting eq 4 to the time domain the solution of the linear channel response for an upstream input can be expressed as two distinct parts dooge et al 1987a 7 q u x t ψ 1 a x t ψ 1 b x t in which ψ 1 a consists of a delta function and is given by 8 ψ 1 a x t δ t x c 1 exp p u x where δ is a dirac delta function c 1 is the downstream characteristic celerity and is given by 9 c 1 1 a e v 0 g y 0 the parameter pu characterizing the rate of the wave attenuation is given by 10 p u b 2 a f s 0 i y 0 i 1 f 0 m 1 f 0 i 1 f 0 i where m denotes the ratio of wave speed to the reference velocity and is given by 11 m dq d a q 0 a 0 the magnitude of m depends on the channel shape and the cross sectional area in eq 7 ψ 1 b is given by 12 ψ 1 b x t exp r t o x h x c 1 x c 2 i 1 2 h t x c 1 t x c 2 0 5 t x c 1 t x c 2 1 2 u t x c 1 where c 2 is the upstream characteristic celerity and is given by 13 c 2 1 a e v 0 g y 0 and the other parameters r o h are given by 14a r b 2 a s 0 v 0 y 0 1 m 1 f 0 2 f 0 2 14b o f be 2 a m 1 s 0 y 0 14c h d 2 a s 0 v 0 y 0 1 f 0 2 1 m 1 2 f 0 2 0 5 2 f 0 2 where i 1 is a first order modified bessel function u is the unit step function taking a value of 1 for positive arguments and 0 otherwise the main contribution of this study is to analyze the other channel impulse response function derived from the downstream boundary condition to consider the tidal effect following the same procedure to convert eq 5 to the time domain the solution of the linear channel response for a downstream perturbation can be expressed as 15 q d x t ψ 2 a x t ψ 2 b x t where ψ 2 a and ψ 2 b can be derived as 16 ψ 2 a x t δ t l x c 2 exp p d l x 17 ψ 2 b x t exp r t o l x h l x c 2 l x c 1 i 1 2 h t l x c 2 t l x c 1 0 5 t l x c 2 t l x c 1 1 2 u t l x c 2 where the parameter pd is given by 18 p d b 2 a f s 0 i y 0 i 1 f 0 m 1 f 0 i 1 f 0 i 2 3 time varying reference parameters in the original concept of the linear channel routing developed by dooge et al 1987a all parameters such as the discharge q 0 mean flow depth y 0 and mean flow velocity v 0 for the reference condition are constant coefficients which are only associated with the initial state of the channel flow such an assumption results in a fixed distribution of the channel impulse response for an upstream input or a downstream disturbance therefore this study intends to revise the channel impulse response to be adjustable according to both the present inflow condition and the downstream boundary condition in this regard we advocate using the time varying reference discharge denoted as q 0 t according to the boundary conditions hence the reference discharge adopted in the impulse response function for an upstream input can be expressed as 19 q 0 t q in t where q in t is the inflow discharge at time t the remaining reference parameters of the channel y 0 t and v 0 t are required to be re calculated after deriving the updated reference discharge q 0 t manning s equation is subsequently applied to obtain the corresponding cross sectional area a 0 t and mean flow depth y 0 t and it can be written as 20 q 0 t 1 n a 0 t r 0 t 2 3 s 0 where r 0 t is the reference hydraulic radius at time t n is the manning roughness coefficient of a channel reach similarly for a downstream disturbance the time varying reference mean flow depth is given by 21 y 0 t y end t where y end t is the mean flow depth at the downstream end at time t and it can be obtained from the sea level time series or downstream boundary condition the remaining reference parameters of the channel a 0 t q 0 t v 0 t for a downstream disturbance can be derived by using a flow depth curve at the downstream end in this study an approximation jones formula 1915 was adopted to estimate downstream discharge based on a given stage measurement 22 q end t q s 1 1 c k s 0 y end t 1 2 where q s is the steady flow discharge c k is the wave celerity a variety of flow depth relation formulations have been developed to consider the downstream hysteresis effect dottori et al 2009 so the type of formulation can be optional 2 4 procedure for continuous routing the channel flow response at a designated location can be simultaneously influenced by the upstream inputs downstream disturbance and the lateral flow inputs along the main channel as shown by the schematic diagram in fig 1 the impulse response at node i caused by a unit of flow entering at the downstream end x l can be expressed as 23 u di t q di x i t where 24 x i k 1 i δ l k in which δli is the length of channel reach i therefore the flow response induced by the downstream disturbance can be derived by convolution integral as follows 25 o di t 0 l i q end τ u di t τ d τ where 26 q end t a end t v end t in which a end t is the cross sectional area at the downstream end and it can be converted from the downstream flow depth or sea level time series by using the cross section data v end t is the mean flow velocity at the downstream end the impulse response at node i caused by a unit of flow entering at the upstream node can be expressed as 27 u ui t q ui δ l i t therefore the outflow response for an upstream input can be given by 28 o ui t 0 l i q ini τ u ui t τ d τ in which q ini is the inflow discharge of channel reach i the impulse response caused by the lateral flow from the right bank left bank along the main channel is given by 29 u rij t q ui y j t 30 u lij t q ui y j t where y j is the distance from the central point of interval j to the outlet of channel reach i as shown in fig 1 thus it can be written as 31 y j 0 5 δ l j k 1 j 1 δ l k in which δ l j is the length of interval j in a channel reach the outflow response for the lateral flow input from the left right bank can be derived by 32 o ri t j 1 j 0 t q rij τ δ l j u rij t τ d τ 33 o li t j 1 j 0 t q lij τ δ l j u lij t τ d τ where j is the total number of intervals divided in the channel reach i q lij q rij is the average lateral flow discharge per unit width from left right bank in the interval j of channel reach i for the application in an entire river basin the sum of outflow discharge at the end of every channel reach can be derived by 34 q outi t o ui t o di t o ri t o li t it should be noted that each lateral area contributing to the left or right side of a channel interval was partitioned by using the digital elevation model based on the topographic data the central point of each interval δ l j is assumed as the single location of flow input collected from the same zone of the lateral flow area as for the calculation of lateral flow any type of rainfall runoff model such as the linear reservoir model or kinematic wave based giuh model can be a solution to derive the flow inputs along the main channel 3 model tests in the following sub sections the modified channel response model is examined by comparing it with the numerical model based on the full one dimensional saint venant equations and the typical channel response model proposed by dooge et al 1987a under different downstream boundary conditions the variation of the impulse response functions caused by the upstream and downstream boundary conditions is subsequently investigated additionally the applicabilities of the typical and the modified channel response models in different cross sectional shapes are discussed in the last part 3 1 model verification in this study the numerical model developed by applying the nonlinear saint venant equations and the implicit four point preissmann scheme 1961 was performed to demonstrate the calculated accuracy of the modified channel response model the numerical solutions were obtained by executing a reliable river analysis system hec ras 2016 the time and space weighting coefficients for the preissmann scheme were set as 0 6 in all the simulation cases of this study the solution of the typical channel response model proposed by dooge et al 1987a was also provided for comparative study as shown in the upper graph of fig 2 a wide rectangular channel with a total length of 4 4 km and a uniform bed slope of 0 0005 was assigned in the three types of models the simulated results at the location of point a which is only 4 km from the downstream end were extracted to investigate the differences of hydrograph shape under different downstream boundary conditions two test cases with the same upstream inflow condition and various downstream boundary conditions normal depth and tide level approximately represented by a sine function as shown in the lower graph of fig 2 were designed to examine the model outcomes the simulated results at point a under the conditions of these two cases are shown in fig 3 in which the result of the typical channel model proposed by dooge et al 1987a is denoted as typical dooge the result of the modified channel model proposed in this study is denoted as modified dooge the manning roughness coefficient assigned in the numerical model was 0 02 to obtain the most similar results to the theoretically numerical solutions the optimal value of the manning roughness coefficient was set as 0 022 in the modified channel response model and it had to be set as 0 009 in the typical channel response model it should be noted that the difference in the manning roughness coefficient is inevitable since these models are based on different structures and mechanisms the n value for the proposed linear channel routing model is just a parameter that needs to be calibrated and should not be pre selected for example from published values based only on channel shape form and vegetation since the n value incorporates not only the effect of local channel frictional resistance but also a variety of forms of frictional losses and the effect of modelling simplifications as informed by the left graph of fig 3 showing the results of case 1 in which the downstream boundary condition is assumed as normal depth open boundary the hydrograph yielded from the numerical model was favorably similar to that generated from the modified channel response model in terms of the overall hydrograph shape and the magnitude of peak discharge by marginally adjusting the manning s roughness from 0 02 to 0 022 relatively the simulated hydrograph yielded from the typical channel response model performed a significant difference in hydrograph shape when it was compared to that generated from the numerical model even though the optimal manning s roughness coefficient had been greatly adjusted to 0 009 huang and lee 2020 have indicated that the modified channel response model could be comparable to the numerical model when it was applied to a channel that possessed a downstream open boundary as for the results of case 2 as shown by the right graph of fig 3 in which the downstream depth is described by a sine wave to represent the time series of tide level the hydrograph yielded from the modified channel response model showed satisfactory fit with the numerical solution as well owing to the consideration of time varying impulse response that depended on the change of the tide level however the hydrograph yielded from the typical channel response model showed significant omission in describing the hydrograph profile because of a lack of a mechanism in the typical model to reflect the disturbance from the downstream end the above results could confirm the simulated accuracy of the modified channel response model proposed in this study and illustrate the importance of replacing the constant reference parameters used in the typical model with the time varying reference parameters used in the modified model for a better simulation in various boundary conditions 3 2 investigation of channel impulse responses the main contribution of this study is to revise the impulse response functions to be varied with time and space by using time varying hydraulic parameters during the channel simulation the distributions of two impulse response functions separately affected by the upstream boundary and the downstream boundary conditions were analyzed by a test in which the channel settings were the same as the previous test with the boundary conditions of case 2 as shown in fig 4 channel impulse responses at different times were displayed to see the change of the function distribution with flood movement it can be found that for the modified impulse response function resulted from the upstream input the peak of response became higher accompanied by an earlier time to peak and a more concentrated distribution during the flood rising stage and then the impulse response returned to a more distracted distribution with a lower peak and a later time to peak during the flood falling stage this time varying alternation of impulse response gave the flexibility to adjust the shape of the hydrograph to be more similar to the theoretical solution of the numerical scheme as shown in fig 3 as for the modified impulse response function resulted from the downstream disturbance as shown on the right side of fig 4 the response function was found to possess both positive and inverted distribution with the rise and fall of the downstream water level this conversion in function distribution therefore could characterize the simulated hydrograph a cumulative result showing an appearance with swinging up and down as shown by the result in the right graph of fig 3 however as shown in the lowest graph of fig 4 the typical channel response model developed by dooge et al 1987a could only generate one type of distribution of impulse response function because of the constant reference parameters during flood simulation therefore the hydrograph shape could not be modified effectively even though the optimal value of manning s roughness coefficient had been assigned the above results explained the structure and feature inherent in the modified channel response model to yield a better approximation to the theoretical solution based on the numerical model 3 3 investigation of channel geometric characteristics to demonstrate the applicability of the modified channel response model in different shapes of cross section three example sections separately in rectangular trapezoidal and compound shape as shown in the upper graphs of fig 5 were designed to evaluate the performance of respectively applying the typical and modified channel response models the numerical solutions were adopted as the reference benchmark in this test the channel settings were the same as the previous one displayed in fig 2 separately with the boundary conditions of case 1 and case 2 but given with different channel cross sections fig 5 showed the simulated hydrographs in each of the three types of cross sections separately under the downstream normal depth and sine wave tide level conditions case 1 and case 2 settings for the results of assigning case 1 conditions the modified channel response model could produce a discharge hydrograph approximating to the numerical solution even in a compound channel with a sudden expansion of the cross section owing to the time varying feature of the channel impulse response however the typical channel response model showed its obvious defect of describing the profile of hydrograph for either one of the three types of channel as for the results of assigning case 2 conditions in which the impulse response function resulted from the downstream disturbance was included in the calculation the modified channel response model also presented a satisfactory simulation that favorably fitted with the numerical solution moreover it can be found that the typical channel response model showed a significant omission of describing the hydrograph shape because the effect induced by the rise and fall of the downstream tide level could not be considered in the model mechanism the above results explained the importance of including the time varying impulse response function derived from the downstream boundary in the channel model to reflect the perturbation of the downstream water level the adequateness of applying the modified channel response model for flood simulations with different channel geometric conditions has been demonstrated above 4 practical application a real case applied in the tou cian river basin was performed to express the practicality of the modified channel response model and to demonstrate its precision for flood simulations the environmental conditions of the studied watershed model settings and rainfall infiltration estimation were sequentially explained in the following content these explanations were followed by an overall evaluation of the predicted accuracy by conducting a series of flood event simulations 4 1 description of studied watershed and model settings as shown in fig 6 the tou cian river basin located in northwestern taiwan consists of two upstream branches yulo river and shangping river and a downstream main channel toucian river the total drainage area of this watershed is 544 km2 over which the altitude above the mean sea level ranges from 0 to 2920 m the average slope of the downstream main channel is approximately 0 0008 the mainstream of this watershed possesses a total length of 63 km originating from the xueshan mountain range and flows westward to the taiwan strait at the nanliao harbor in the hsinchu city the primary land cover in this watershed comprises forests bushes and cultivated fields the land use condition is the reference information used to determine the roughness coefficients on the land surface for runoff simulations during the summer and autumn periods between may and october typhoon often invades taiwan and brings torrential rain which could result in severe flooding or related natural disasters as reported by the water resources department ministry of economic affairs taiwan a total of 4 rain gauges within this area has been installed to monitor the observed rainfall data every hour since 1990 the horizontal resolution of the raster based topographic dataset adopted in this study was 40 m as shown in fig 7 the main channel of the tou cian river basin was partitioned into 9 segments with a total of 10 channel nodes for the successive simulation of channel flow it should be noted that the last two segments connecting to the watershed outlet have been recognized as the tidal reach whose flow and level are influenced by tides in this study discharge records separately measured by 4 flow gauges at nodes 1 2 6 and 9 were collected for the model verification and the tide level at the estuary node 10 was available flow records of storm events at nodes 1 and 2 located in the upstream branches were adopted as the upstream boundary conditions table 1 separately shows the geomorphological information of each channel link including the segmental length average slope and lateral flow area the upstream drainage area at each channel node and the nodes provided with flow records were also indicated in table 1 the right side of fig 7 shows the cross sectional profile of each channel segment provided by the water resources department of taiwan in this studied case the base flow discharges measured at upstream nodes 1 and 2 were assigned as the initial reference discharges of segments a and b for deriving the upstream impulse responses the tidal height at each time step measured at the downstream end node 10 was adopted as the reference mean flow depth for deriving the downstream impulse response 4 2 rainfall infiltration estimation as shown in fig 7 the lateral flow inputs from both sides of the riparian area along the mainstream were required to perform the successive routing of the integrated channel response model the excessive rainfall caused by the storm event was the necessary input to conduct the lateral flow overland flow simulation in this study the green ampt method green and ampt 1911 was adopted to estimate infiltration amounts from the observed precipitation data this method is based on the assumption that a sharp wetting front can be formed when flow infiltrates into a relatively dry soil layer from the land surface the soil characteristics and moisture content dominate the infiltration rate the equation of infiltration rate is given by 34 f t k s k s ψ f θ s θ i f for t t p 35 f t p for t t p where k s is the saturated hydraulic conductivity cm h ψ f is the suction head at the wetting front cm θ s is the saturated moisture content θ i is the initial moisture content f is the cumulative amount of infiltrated water cm t p is the time of ponding p is the rainfall rate cm h as for the case applied to the tou cian river basin k s was set as 1 2 cm h ψ f was set as 8 7 cm θ s was set as 0 45 these coefficients adopted in the green ampt infiltration model were determined by performing a sensitivity analysis to obtain the best fitting values 4 3 flood event simulations the observed flow records time series of tidal stage and rainfall data of several flood events measured in the studied watershed were adopted to investigate the performances of the typical channel response model proposed by the dooge et al in 1987 and the modified channel response model proposed in this study the theoretically numerical model based on the applications of the nonlinear saint venant equations and the implicit four point preissmann scheme was also executed for the comparative study table 2 shows the optimal values of the manning roughness coefficients of each channel link applied in different types of models these values of roughness coefficients were determined by the calibration work of 12 flood events by applying the least squares function approximation it should be noted that the optimal values of manning s roughness for the original linear model shown in table 2 were based on the constant reference parameters under the initial condition it should be noted that the division of a channel network into multiple links was to reflect the spatial difference of geomorphological characteristics on the distribution of the channel impulse response in this study three indicators were adopted to evaluate and quantify the accuracy of the simulated hydrographs the first one of indexes is the mean relative error denoted as mre which was given by 36 mre 1 n p t 1 n p q et q ot q ot where qe is the estimated discharge qo is the observed discharge np is the total number of data points used to describe a hydrograph the other two indicators were applied to quantify the deviations in aspects of the peak discharge and the time to flow peak as follows 37 d q p q pe q po q po 38 d t p t pe t po t po where dqp is the deviation of peak discharge qpe is the peak discharge of the estimated hydrograph qpo is the peak discharge of the observed hydrograph dtp is the deviation of time to flow peak tpe is the time to flow peak of the estimated hydrograph tpo is the time to flow peak of the observed hydrograph fig 8 shows the upstream boundary conditions observed discharges at nodes 1 and 2 and the time series of the measured tidal height at the downstream outlet of 4 flood events these conditions were sequentially assigned in each of the three models to assess the differences of hydrographs among each other the simulated hydrographs of 4 flood events generated by different models together with the discharge records separately at nodes 6 and 9 were displayed in fig 9 it can be found that the modified channel response model proposed method performed superior result than the typical channel response model to fit with the flow records at both locations because the time varying reference parameters were considered to convert the distribution of the unit impulse response as well as to adjust the hydrograph shape the performance of the modified channel response model could be comparable to the numerical solutions even in the downstream channel reach where the tidal effect was inevitable however the typical channel response model revealed its shortcoming of adequately describing the profile of the hydrograph even though the time to flow peak could be shifted by tuning the manning roughness coefficient moreover the values of mre quantified dq and dt between the observed and estimated hydrographs of these 4 flood events were shown in table 3 to further support the above summaries of research findings these results could confirm that the channel impulse response function is necessary to be modified to achieve better performance of the flood wave simulation 5 conclusions to more precisely describe the channel flow response the impulse response functions applied in the channel response model were revised in two aspects the consideration of the downstream tidal effect and the temporal variation of reference parameters the two types of channel impulse response functions separately induced by the upstream input and the downstream disturbance were derived and combined in this study to extend the scope of practical applications the novelty of this study is to convert the distribution of the unit impulse response function during a flood by adopting the time varying reference parameters the boundary conditions and the geomorphological characteristics of the channel can influence the hydrograph shape the experimental results of some example channels showed that the accuracy of the simulated hydrographs generated from the modified channel response model could be comparable to that of the theoretically numerical solutions even in a tidal reach possessing the irregular channel cross section as long as the two aforementioned modifications to the impulse response functions were carried out the results of a case study in the tou cian river basin further showed that the modified channel response model proposed method could yield significantly better simulation to approximate the observed discharges than the typical channel response model the typical channel response model was restricted by the constant reference parameters so that the time varying flow conditions could not be effectively reflected on the overall hydrograph shape the findings of this study demonstrated the applicability of the modified channel response model and also showed the reliability to replace the numerical scheme with the proposed method based on the linearized saint venant equations since the hydrograph oscillation often occurs in irregular channels with very shallow depth when applying numerical schemes this modified linear channel model is promising to be an alternative for practical applications to avoid this kind of problem induced by numerical instability declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments financial support provided by the ministry of science and technology taiwan under grants most 110 2625 m 019 001 and most 109 2625 m 019 003 my2 is sincerely acknowledged 
4114,the channel impulse response function derived from the linearized saint venant equations has been widely applied to predict the streamflow discharge huang and lee 2020 indicated that the distribution type of the impulse response function proposed by dooge et al 1987a was restricted because of the constant reference parameters therefore they introduced the time varying reference parameters according to the upstream inflow condition to reinforce the flexibility of adjusting the impulse response function however this model called channel hydrological response function charfu was merely applicable to a channel under the assumption of a downstream open boundary this study intended to apply the other impulse response function which was derived from the downstream disturbance and combine this function with the one derived from the upstream input to extend the model applicability in various channel states to consider the temporal change of the downstream boundary condition the time varying reference parameters were also introduced in the function according to the tidal level at the estuary a routing procedure that explained the integration of the two impulse responses for both upstream and downstream inputs was proposed as well for the runoff simulation of the entire river basin a series of tests showed that the proposed model could even yield similar hydrographs with the comparative cases that applied the numerical model based on the saint venant equations owing to the revision of reference parameters a practical case of a river basin was also provided to demonstrate the effectiveness of the proposed model to reflect the influence of the downstream tidal level on the simulated hydrograph although the proposed linear channel routing method still can not be applied to simulate a channel reach with flow transitions such as a sharp change of water surface elevation due to the assumption of gradually varied flow in the linearized governing equations it can be more stable than a finite difference model and avoids the latter s occasional numerical oscillations especially when applied to a shallow channel with an irregular bed keywords impulse response function linear channel routing saint venant equations downstream boundary condition 1 introduction the downstream boundary condition is necessary for performing the computations of open channel flow with a sub critical state the open boundary denotes the downstream end is assumed as uniform flow and can be simplified by the steady state resistance equation hec ras 2016 this type of condition allows waves to pass out of the region without reflection khare et al 2019 it is also known as the normal depth boundary and advocates using manning s equation to give a stage considered to be normal depth if uniform flow conditions exist in the downstream section fenton 2014 indicated that information coming from upstream is dominant if the downstream open boundary condition is given as the waves that are input at the upstream boundary progress downstream however in some cases the perturbation coming from the downstream end cannot be ignored during flood simulations such as the tidal effect or the situation in which the recorded gauge data is available for calibration a tidal reach is defined as a section of a larger river whose flow and level are influenced by tides it has been indicated that the tidal reach is generally possessed of relatively low discharge rates but high overall discharge which implies a shallow river with a large coastal mouth moftakhari et al 2013 hoitink and jay 2016 the change of tidal level at the estuary can induce the backwater effect of an open channel the backwater effect can be deemed as a response to energy losses it usually occurs when the water surface elevation at a downstream location increases castelltort et al 2020 it has been denoted that the extension of the backwater affected area and the increase in water surface elevation are highly dependent on the river morphology floodplain characteristics and may induce upstream flooding brandimarte and woldeyes 2012 to bypass any problem about instability and oscillation in numerical schemes the linearized channel flow routing lcr has been a well known alternative for flood wave simulations by applying the convolution integral dooge and harley 1967 dooge et al 1987a 1987b dooge and harley 1967 derived the earlier instantaneous hydrologic response function of the wide rectangular channel based on the linearized saint venant equations in their model the linear accumulation of unit impulse response functions is the fundamental approach to present the convolution integral and produce the discharge hydrograph to take into account any shape of channel cross section and any type of friction law dooge et al 1987a further modified the analytical solution of the channel impulse response proposed in 1967 therefore the applicability of this model was significantly improved it should be noted that by applying the laplace transform they proposed the solution anywhere in the channel in terms of one convolution with a boundary condition at the upstream end and another convolution with the boundary condition at the downstream end to reinforce the flexibility of adjusting the shape of the impulse response huang and lee 2020 introduced the time varying hydraulic parameters which are determined by the inflow condition and channel topography in the convolution with the upstream boundary condition therefore a superior similarity of simulated results with the numerical outcomes based on the full type of saint venant equations could be found overall the solutions generated by this model were reliable for streamflow predictions since the physical significance and the temporal change of the reference parameters were emphasized to describe the hydrological process during floods nevertheless it has been indicated that their modified model currently was merely applicable to the situation in which the downstream boundary condition is assumed as normal depth namely the open boundary huang and lee 2020 the focus of this study is to include the convolution with the downstream boundary condition into the previous model proposed by huang and lee 2020 the modified model can therefore consider the influence of tidal level at the estuary on the streamflow prediction given the laplace transform of the linear channel response for a downstream input was proposed by dooge et al 1987a this study further converts this formulation to the time domain to derive the solution of the impulse response for a downstream input moreover the time varying hydraulic parameters affected by the downstream boundary condition and the channel topography are also introduced in the proposed impulse response function in this way the two types of impulse response functions separately derived from an upstream input and a downstream disturbance can be combined to expand the model applicability in various channel states to evaluate the outcome of this modified linear channel model the numerical solution of an implicit finite difference scheme based on the nonlinear saint venant equations is provided in this study moreover a practical case study applied to the tou cian river basin is performed to assess the accuracy of flood prediction and manifest the applicability of the proposed channel response system 2 modified channel impulse response model dooge et al 1987a derived a useful impulse response function for the linear channel routing which can apply to an irregular cross section however the flexibility of adjusting the shape of the channel impulse response is constrained since the reference parameters adopted in their model are assumed as constant coefficients in this study the upstream inflow and downstream boundary conditions are simultaneously applied to determine time varying reference parameters for altering the distribution of impulse response functions during floods moreover to allow the spatial variability of hydraulic characteristics the main channel of a watershed is divided into several segments to link with their respective lateral flow areas and upstream contributing areas this routing concept was originally proposed by huang and lee 2020 with the assumption of a downstream open boundary in this study this model is further revised to consider the downstream disturbance of the tidal effect the following sub sections sequentially provide four parts of explanations about the channel response system 1 the theoretical basis of the linear channel model 2 the analytical solution channel impulse response function derived form of the linearized governing equation 3 the introduction of time varying reference parameters 4 the procedure for the continuous routing of the channel response system 2 1 theory of the linearized momentum equation the one dimensional saint venant equations are widely applied to simulate the gradually varied flow in an open channel to consider the irregular channel bed the discharge q x t and the cross sectional area a x t are used as the dependent hydraulic variables so the momentum equation can be expressed as cunge et al 1980 1 1 f 2 g y a x 2 q a q x q t g a s o s f where f is the froude number y is the hydraulic mean water depth s o is the bottom slope and s f is the friction slope since the momentum equation shown in eq 1 is nonlinear no analytical solution is available one alternative was proposed to find a satisfactory approximate solution by using the linearization of the nonlinear equation dooge et al 1987a adopted eq 1 to derive a linearized formula as 2 1 f o 2 g y o 2 q x 2 2 v o 2 q x t 2 q t 2 g a o s f q q t s f a q x where q can be assumed as the flow perturbation while f 0 y 0 and v 0 denote the froude number the mean water depth and the mean flow velocity for reference condition respectively eq 2 is based on the assumptions that the unsteady flow is deemed as a perturbation from a steady flow condition and the higher order terms of flow are neglected under these assumptions the discharge can be expressed as 3 q x t q 0 q x t where q 0 is the reference condition of steady flow q is the first order increment of flow it has been indicated that eq 2 can adapt to the irregular channel and any friction law when any form of flow transitions can be neglected dooge et al 1987a 2 2 channel impulse response functions the unit flow response of a uniform channel can be described by two types of impulse response functions that are separately derived from an upstream input and a perturbation from the downstream end dooge et al 1987a indicated that the laplace transform of the impulse response for an upstream and a downstream input is separately given by 4 q u x s exp exs f x x a s 2 b s c 5 q d x s exp e l x s f l x l x a s 2 b s c in which q u is the impulse response resulted from an upstream input q d is the impulse response resulted from a downstream disturbance l is the total length of the channel a b c d e f are the parameters related to the hydraulic variables and given by the following relationship 6a a 1 g y o 1 f 0 2 2 6b b 2 s 0 v 0 y 0 1 m 1 f 0 2 1 f 0 2 2 6c c m 2 s 0 y 0 2 1 1 f 0 2 2 6d d b 2 4 a c 6e e 1 g y 0 0 5 f 0 1 f 0 2 6f f m s 0 y 0 1 f 0 2 by converting eq 4 to the time domain the solution of the linear channel response for an upstream input can be expressed as two distinct parts dooge et al 1987a 7 q u x t ψ 1 a x t ψ 1 b x t in which ψ 1 a consists of a delta function and is given by 8 ψ 1 a x t δ t x c 1 exp p u x where δ is a dirac delta function c 1 is the downstream characteristic celerity and is given by 9 c 1 1 a e v 0 g y 0 the parameter pu characterizing the rate of the wave attenuation is given by 10 p u b 2 a f s 0 i y 0 i 1 f 0 m 1 f 0 i 1 f 0 i where m denotes the ratio of wave speed to the reference velocity and is given by 11 m dq d a q 0 a 0 the magnitude of m depends on the channel shape and the cross sectional area in eq 7 ψ 1 b is given by 12 ψ 1 b x t exp r t o x h x c 1 x c 2 i 1 2 h t x c 1 t x c 2 0 5 t x c 1 t x c 2 1 2 u t x c 1 where c 2 is the upstream characteristic celerity and is given by 13 c 2 1 a e v 0 g y 0 and the other parameters r o h are given by 14a r b 2 a s 0 v 0 y 0 1 m 1 f 0 2 f 0 2 14b o f be 2 a m 1 s 0 y 0 14c h d 2 a s 0 v 0 y 0 1 f 0 2 1 m 1 2 f 0 2 0 5 2 f 0 2 where i 1 is a first order modified bessel function u is the unit step function taking a value of 1 for positive arguments and 0 otherwise the main contribution of this study is to analyze the other channel impulse response function derived from the downstream boundary condition to consider the tidal effect following the same procedure to convert eq 5 to the time domain the solution of the linear channel response for a downstream perturbation can be expressed as 15 q d x t ψ 2 a x t ψ 2 b x t where ψ 2 a and ψ 2 b can be derived as 16 ψ 2 a x t δ t l x c 2 exp p d l x 17 ψ 2 b x t exp r t o l x h l x c 2 l x c 1 i 1 2 h t l x c 2 t l x c 1 0 5 t l x c 2 t l x c 1 1 2 u t l x c 2 where the parameter pd is given by 18 p d b 2 a f s 0 i y 0 i 1 f 0 m 1 f 0 i 1 f 0 i 2 3 time varying reference parameters in the original concept of the linear channel routing developed by dooge et al 1987a all parameters such as the discharge q 0 mean flow depth y 0 and mean flow velocity v 0 for the reference condition are constant coefficients which are only associated with the initial state of the channel flow such an assumption results in a fixed distribution of the channel impulse response for an upstream input or a downstream disturbance therefore this study intends to revise the channel impulse response to be adjustable according to both the present inflow condition and the downstream boundary condition in this regard we advocate using the time varying reference discharge denoted as q 0 t according to the boundary conditions hence the reference discharge adopted in the impulse response function for an upstream input can be expressed as 19 q 0 t q in t where q in t is the inflow discharge at time t the remaining reference parameters of the channel y 0 t and v 0 t are required to be re calculated after deriving the updated reference discharge q 0 t manning s equation is subsequently applied to obtain the corresponding cross sectional area a 0 t and mean flow depth y 0 t and it can be written as 20 q 0 t 1 n a 0 t r 0 t 2 3 s 0 where r 0 t is the reference hydraulic radius at time t n is the manning roughness coefficient of a channel reach similarly for a downstream disturbance the time varying reference mean flow depth is given by 21 y 0 t y end t where y end t is the mean flow depth at the downstream end at time t and it can be obtained from the sea level time series or downstream boundary condition the remaining reference parameters of the channel a 0 t q 0 t v 0 t for a downstream disturbance can be derived by using a flow depth curve at the downstream end in this study an approximation jones formula 1915 was adopted to estimate downstream discharge based on a given stage measurement 22 q end t q s 1 1 c k s 0 y end t 1 2 where q s is the steady flow discharge c k is the wave celerity a variety of flow depth relation formulations have been developed to consider the downstream hysteresis effect dottori et al 2009 so the type of formulation can be optional 2 4 procedure for continuous routing the channel flow response at a designated location can be simultaneously influenced by the upstream inputs downstream disturbance and the lateral flow inputs along the main channel as shown by the schematic diagram in fig 1 the impulse response at node i caused by a unit of flow entering at the downstream end x l can be expressed as 23 u di t q di x i t where 24 x i k 1 i δ l k in which δli is the length of channel reach i therefore the flow response induced by the downstream disturbance can be derived by convolution integral as follows 25 o di t 0 l i q end τ u di t τ d τ where 26 q end t a end t v end t in which a end t is the cross sectional area at the downstream end and it can be converted from the downstream flow depth or sea level time series by using the cross section data v end t is the mean flow velocity at the downstream end the impulse response at node i caused by a unit of flow entering at the upstream node can be expressed as 27 u ui t q ui δ l i t therefore the outflow response for an upstream input can be given by 28 o ui t 0 l i q ini τ u ui t τ d τ in which q ini is the inflow discharge of channel reach i the impulse response caused by the lateral flow from the right bank left bank along the main channel is given by 29 u rij t q ui y j t 30 u lij t q ui y j t where y j is the distance from the central point of interval j to the outlet of channel reach i as shown in fig 1 thus it can be written as 31 y j 0 5 δ l j k 1 j 1 δ l k in which δ l j is the length of interval j in a channel reach the outflow response for the lateral flow input from the left right bank can be derived by 32 o ri t j 1 j 0 t q rij τ δ l j u rij t τ d τ 33 o li t j 1 j 0 t q lij τ δ l j u lij t τ d τ where j is the total number of intervals divided in the channel reach i q lij q rij is the average lateral flow discharge per unit width from left right bank in the interval j of channel reach i for the application in an entire river basin the sum of outflow discharge at the end of every channel reach can be derived by 34 q outi t o ui t o di t o ri t o li t it should be noted that each lateral area contributing to the left or right side of a channel interval was partitioned by using the digital elevation model based on the topographic data the central point of each interval δ l j is assumed as the single location of flow input collected from the same zone of the lateral flow area as for the calculation of lateral flow any type of rainfall runoff model such as the linear reservoir model or kinematic wave based giuh model can be a solution to derive the flow inputs along the main channel 3 model tests in the following sub sections the modified channel response model is examined by comparing it with the numerical model based on the full one dimensional saint venant equations and the typical channel response model proposed by dooge et al 1987a under different downstream boundary conditions the variation of the impulse response functions caused by the upstream and downstream boundary conditions is subsequently investigated additionally the applicabilities of the typical and the modified channel response models in different cross sectional shapes are discussed in the last part 3 1 model verification in this study the numerical model developed by applying the nonlinear saint venant equations and the implicit four point preissmann scheme 1961 was performed to demonstrate the calculated accuracy of the modified channel response model the numerical solutions were obtained by executing a reliable river analysis system hec ras 2016 the time and space weighting coefficients for the preissmann scheme were set as 0 6 in all the simulation cases of this study the solution of the typical channel response model proposed by dooge et al 1987a was also provided for comparative study as shown in the upper graph of fig 2 a wide rectangular channel with a total length of 4 4 km and a uniform bed slope of 0 0005 was assigned in the three types of models the simulated results at the location of point a which is only 4 km from the downstream end were extracted to investigate the differences of hydrograph shape under different downstream boundary conditions two test cases with the same upstream inflow condition and various downstream boundary conditions normal depth and tide level approximately represented by a sine function as shown in the lower graph of fig 2 were designed to examine the model outcomes the simulated results at point a under the conditions of these two cases are shown in fig 3 in which the result of the typical channel model proposed by dooge et al 1987a is denoted as typical dooge the result of the modified channel model proposed in this study is denoted as modified dooge the manning roughness coefficient assigned in the numerical model was 0 02 to obtain the most similar results to the theoretically numerical solutions the optimal value of the manning roughness coefficient was set as 0 022 in the modified channel response model and it had to be set as 0 009 in the typical channel response model it should be noted that the difference in the manning roughness coefficient is inevitable since these models are based on different structures and mechanisms the n value for the proposed linear channel routing model is just a parameter that needs to be calibrated and should not be pre selected for example from published values based only on channel shape form and vegetation since the n value incorporates not only the effect of local channel frictional resistance but also a variety of forms of frictional losses and the effect of modelling simplifications as informed by the left graph of fig 3 showing the results of case 1 in which the downstream boundary condition is assumed as normal depth open boundary the hydrograph yielded from the numerical model was favorably similar to that generated from the modified channel response model in terms of the overall hydrograph shape and the magnitude of peak discharge by marginally adjusting the manning s roughness from 0 02 to 0 022 relatively the simulated hydrograph yielded from the typical channel response model performed a significant difference in hydrograph shape when it was compared to that generated from the numerical model even though the optimal manning s roughness coefficient had been greatly adjusted to 0 009 huang and lee 2020 have indicated that the modified channel response model could be comparable to the numerical model when it was applied to a channel that possessed a downstream open boundary as for the results of case 2 as shown by the right graph of fig 3 in which the downstream depth is described by a sine wave to represent the time series of tide level the hydrograph yielded from the modified channel response model showed satisfactory fit with the numerical solution as well owing to the consideration of time varying impulse response that depended on the change of the tide level however the hydrograph yielded from the typical channel response model showed significant omission in describing the hydrograph profile because of a lack of a mechanism in the typical model to reflect the disturbance from the downstream end the above results could confirm the simulated accuracy of the modified channel response model proposed in this study and illustrate the importance of replacing the constant reference parameters used in the typical model with the time varying reference parameters used in the modified model for a better simulation in various boundary conditions 3 2 investigation of channel impulse responses the main contribution of this study is to revise the impulse response functions to be varied with time and space by using time varying hydraulic parameters during the channel simulation the distributions of two impulse response functions separately affected by the upstream boundary and the downstream boundary conditions were analyzed by a test in which the channel settings were the same as the previous test with the boundary conditions of case 2 as shown in fig 4 channel impulse responses at different times were displayed to see the change of the function distribution with flood movement it can be found that for the modified impulse response function resulted from the upstream input the peak of response became higher accompanied by an earlier time to peak and a more concentrated distribution during the flood rising stage and then the impulse response returned to a more distracted distribution with a lower peak and a later time to peak during the flood falling stage this time varying alternation of impulse response gave the flexibility to adjust the shape of the hydrograph to be more similar to the theoretical solution of the numerical scheme as shown in fig 3 as for the modified impulse response function resulted from the downstream disturbance as shown on the right side of fig 4 the response function was found to possess both positive and inverted distribution with the rise and fall of the downstream water level this conversion in function distribution therefore could characterize the simulated hydrograph a cumulative result showing an appearance with swinging up and down as shown by the result in the right graph of fig 3 however as shown in the lowest graph of fig 4 the typical channel response model developed by dooge et al 1987a could only generate one type of distribution of impulse response function because of the constant reference parameters during flood simulation therefore the hydrograph shape could not be modified effectively even though the optimal value of manning s roughness coefficient had been assigned the above results explained the structure and feature inherent in the modified channel response model to yield a better approximation to the theoretical solution based on the numerical model 3 3 investigation of channel geometric characteristics to demonstrate the applicability of the modified channel response model in different shapes of cross section three example sections separately in rectangular trapezoidal and compound shape as shown in the upper graphs of fig 5 were designed to evaluate the performance of respectively applying the typical and modified channel response models the numerical solutions were adopted as the reference benchmark in this test the channel settings were the same as the previous one displayed in fig 2 separately with the boundary conditions of case 1 and case 2 but given with different channel cross sections fig 5 showed the simulated hydrographs in each of the three types of cross sections separately under the downstream normal depth and sine wave tide level conditions case 1 and case 2 settings for the results of assigning case 1 conditions the modified channel response model could produce a discharge hydrograph approximating to the numerical solution even in a compound channel with a sudden expansion of the cross section owing to the time varying feature of the channel impulse response however the typical channel response model showed its obvious defect of describing the profile of hydrograph for either one of the three types of channel as for the results of assigning case 2 conditions in which the impulse response function resulted from the downstream disturbance was included in the calculation the modified channel response model also presented a satisfactory simulation that favorably fitted with the numerical solution moreover it can be found that the typical channel response model showed a significant omission of describing the hydrograph shape because the effect induced by the rise and fall of the downstream tide level could not be considered in the model mechanism the above results explained the importance of including the time varying impulse response function derived from the downstream boundary in the channel model to reflect the perturbation of the downstream water level the adequateness of applying the modified channel response model for flood simulations with different channel geometric conditions has been demonstrated above 4 practical application a real case applied in the tou cian river basin was performed to express the practicality of the modified channel response model and to demonstrate its precision for flood simulations the environmental conditions of the studied watershed model settings and rainfall infiltration estimation were sequentially explained in the following content these explanations were followed by an overall evaluation of the predicted accuracy by conducting a series of flood event simulations 4 1 description of studied watershed and model settings as shown in fig 6 the tou cian river basin located in northwestern taiwan consists of two upstream branches yulo river and shangping river and a downstream main channel toucian river the total drainage area of this watershed is 544 km2 over which the altitude above the mean sea level ranges from 0 to 2920 m the average slope of the downstream main channel is approximately 0 0008 the mainstream of this watershed possesses a total length of 63 km originating from the xueshan mountain range and flows westward to the taiwan strait at the nanliao harbor in the hsinchu city the primary land cover in this watershed comprises forests bushes and cultivated fields the land use condition is the reference information used to determine the roughness coefficients on the land surface for runoff simulations during the summer and autumn periods between may and october typhoon often invades taiwan and brings torrential rain which could result in severe flooding or related natural disasters as reported by the water resources department ministry of economic affairs taiwan a total of 4 rain gauges within this area has been installed to monitor the observed rainfall data every hour since 1990 the horizontal resolution of the raster based topographic dataset adopted in this study was 40 m as shown in fig 7 the main channel of the tou cian river basin was partitioned into 9 segments with a total of 10 channel nodes for the successive simulation of channel flow it should be noted that the last two segments connecting to the watershed outlet have been recognized as the tidal reach whose flow and level are influenced by tides in this study discharge records separately measured by 4 flow gauges at nodes 1 2 6 and 9 were collected for the model verification and the tide level at the estuary node 10 was available flow records of storm events at nodes 1 and 2 located in the upstream branches were adopted as the upstream boundary conditions table 1 separately shows the geomorphological information of each channel link including the segmental length average slope and lateral flow area the upstream drainage area at each channel node and the nodes provided with flow records were also indicated in table 1 the right side of fig 7 shows the cross sectional profile of each channel segment provided by the water resources department of taiwan in this studied case the base flow discharges measured at upstream nodes 1 and 2 were assigned as the initial reference discharges of segments a and b for deriving the upstream impulse responses the tidal height at each time step measured at the downstream end node 10 was adopted as the reference mean flow depth for deriving the downstream impulse response 4 2 rainfall infiltration estimation as shown in fig 7 the lateral flow inputs from both sides of the riparian area along the mainstream were required to perform the successive routing of the integrated channel response model the excessive rainfall caused by the storm event was the necessary input to conduct the lateral flow overland flow simulation in this study the green ampt method green and ampt 1911 was adopted to estimate infiltration amounts from the observed precipitation data this method is based on the assumption that a sharp wetting front can be formed when flow infiltrates into a relatively dry soil layer from the land surface the soil characteristics and moisture content dominate the infiltration rate the equation of infiltration rate is given by 34 f t k s k s ψ f θ s θ i f for t t p 35 f t p for t t p where k s is the saturated hydraulic conductivity cm h ψ f is the suction head at the wetting front cm θ s is the saturated moisture content θ i is the initial moisture content f is the cumulative amount of infiltrated water cm t p is the time of ponding p is the rainfall rate cm h as for the case applied to the tou cian river basin k s was set as 1 2 cm h ψ f was set as 8 7 cm θ s was set as 0 45 these coefficients adopted in the green ampt infiltration model were determined by performing a sensitivity analysis to obtain the best fitting values 4 3 flood event simulations the observed flow records time series of tidal stage and rainfall data of several flood events measured in the studied watershed were adopted to investigate the performances of the typical channel response model proposed by the dooge et al in 1987 and the modified channel response model proposed in this study the theoretically numerical model based on the applications of the nonlinear saint venant equations and the implicit four point preissmann scheme was also executed for the comparative study table 2 shows the optimal values of the manning roughness coefficients of each channel link applied in different types of models these values of roughness coefficients were determined by the calibration work of 12 flood events by applying the least squares function approximation it should be noted that the optimal values of manning s roughness for the original linear model shown in table 2 were based on the constant reference parameters under the initial condition it should be noted that the division of a channel network into multiple links was to reflect the spatial difference of geomorphological characteristics on the distribution of the channel impulse response in this study three indicators were adopted to evaluate and quantify the accuracy of the simulated hydrographs the first one of indexes is the mean relative error denoted as mre which was given by 36 mre 1 n p t 1 n p q et q ot q ot where qe is the estimated discharge qo is the observed discharge np is the total number of data points used to describe a hydrograph the other two indicators were applied to quantify the deviations in aspects of the peak discharge and the time to flow peak as follows 37 d q p q pe q po q po 38 d t p t pe t po t po where dqp is the deviation of peak discharge qpe is the peak discharge of the estimated hydrograph qpo is the peak discharge of the observed hydrograph dtp is the deviation of time to flow peak tpe is the time to flow peak of the estimated hydrograph tpo is the time to flow peak of the observed hydrograph fig 8 shows the upstream boundary conditions observed discharges at nodes 1 and 2 and the time series of the measured tidal height at the downstream outlet of 4 flood events these conditions were sequentially assigned in each of the three models to assess the differences of hydrographs among each other the simulated hydrographs of 4 flood events generated by different models together with the discharge records separately at nodes 6 and 9 were displayed in fig 9 it can be found that the modified channel response model proposed method performed superior result than the typical channel response model to fit with the flow records at both locations because the time varying reference parameters were considered to convert the distribution of the unit impulse response as well as to adjust the hydrograph shape the performance of the modified channel response model could be comparable to the numerical solutions even in the downstream channel reach where the tidal effect was inevitable however the typical channel response model revealed its shortcoming of adequately describing the profile of the hydrograph even though the time to flow peak could be shifted by tuning the manning roughness coefficient moreover the values of mre quantified dq and dt between the observed and estimated hydrographs of these 4 flood events were shown in table 3 to further support the above summaries of research findings these results could confirm that the channel impulse response function is necessary to be modified to achieve better performance of the flood wave simulation 5 conclusions to more precisely describe the channel flow response the impulse response functions applied in the channel response model were revised in two aspects the consideration of the downstream tidal effect and the temporal variation of reference parameters the two types of channel impulse response functions separately induced by the upstream input and the downstream disturbance were derived and combined in this study to extend the scope of practical applications the novelty of this study is to convert the distribution of the unit impulse response function during a flood by adopting the time varying reference parameters the boundary conditions and the geomorphological characteristics of the channel can influence the hydrograph shape the experimental results of some example channels showed that the accuracy of the simulated hydrographs generated from the modified channel response model could be comparable to that of the theoretically numerical solutions even in a tidal reach possessing the irregular channel cross section as long as the two aforementioned modifications to the impulse response functions were carried out the results of a case study in the tou cian river basin further showed that the modified channel response model proposed method could yield significantly better simulation to approximate the observed discharges than the typical channel response model the typical channel response model was restricted by the constant reference parameters so that the time varying flow conditions could not be effectively reflected on the overall hydrograph shape the findings of this study demonstrated the applicability of the modified channel response model and also showed the reliability to replace the numerical scheme with the proposed method based on the linearized saint venant equations since the hydrograph oscillation often occurs in irregular channels with very shallow depth when applying numerical schemes this modified linear channel model is promising to be an alternative for practical applications to avoid this kind of problem induced by numerical instability declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments financial support provided by the ministry of science and technology taiwan under grants most 110 2625 m 019 001 and most 109 2625 m 019 003 my2 is sincerely acknowledged 
