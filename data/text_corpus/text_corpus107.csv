index,text
535,the global warming effects put in danger global water availability and make necessary to decrease water wastage e g by monitoring global irrigation despite this global irrigation information is scarce due to the absence of a solid estimation technique in this study we applied an innovative approach to retrieve irrigation water from high spatial and temporal resolution soil moisture sm data obtained from an advanced sensor based on proximal gamma ray pgr spectroscopy in a field located in emilia romagna italy the results show that sm is a key variable to obtain information about the amount of water applied to plants with pearson correlation between observed and estimated daily irrigation data ranges from 0 88 to 0 91 by using different calibration methodology with the aim of reproducing the working conditions of satellites measuring soil moisture we sub sampled sm hourly time series at larger time steps the results demonstrated that the methodology is still capable to perform the daily weekly irrigation estimation with pearson correlation around 0 6 0 7 if the time step is not greater than 36 48 hours keywords sm2rain irrigation soil moisture proximal gamma ray method 1 introduction irrigation is one of the greatest human intervention on water cycle and it accounts for more than 70 of global freshwater withdrawals fao 2006 foley et al 2011 nowadays around 20 of the world s cultivated area is irrigated and it supplies over 40 of the world s food droogers et al 2010 global warming and the intensification of the hydrological cycle with the increased occurrence of droughts and floods will threaten the natural availability of water enhancing the need of irrigation allan and soden 2008 kummu et al 2016 rockström et al 2012 vörösmarty et al 2000 the projected population growth will aggravate this already complicated panorama due to the consequent increase of food demand the knowledge of irrigated lands and the water used is hence of primary importance to prevent water wastage to avoid illegal withdrawals and to ensure food and water security siebert et al 2010 taylor et al 2013 monitoring irrigation is also fundamental for other applications i to understand the consequences of irrigation water cycle modifications ii to investigate the impact of irrigation on local and regional climate conditions and iii to develop hydrological and climate models that account for irrigation sacks et al 2009 despite its importance a global dataset of irrigation water use over long periods is still missing available time series of irrigation amount are mostly based on statistical surveys this kind of information does not take into account the illegal pumping and is potentially affected by large errors because of self reporting bias spatial inconsistency and low temporal resolution and coverage e g the u s geological survey publishes a report on water use every 5 years deines et al 2017 their quality is hence variable over different states and regions as inferred by siebert et al 2005 who developed a global dataset of area equipped for irrigation by combining sub national irrigation statistics a different approach consists in modeling water requirements for crop irrigation rather than actual water used for irrigation doll and siebert 2002 wada et al 2014 but the existence of vast under and over irrigated areas with respect to water requirements foley et al 2011 represents a large source of errors for this methodology that limits its applicability in this context a new source of irrigation information is emerging i e the use of soil moisture sm observations for decades sm has been widely used by farmers to efficiently schedule irrigation campbell and campbell 1982 khan et al 1996 aguilar et al 2015 its knowledge helps to determine the crop stress conditions and then assists the farmer to decide when and how much water must be applied for improving the efficiency and the quality of the production recently sm has been also employed to directly quantify the amount of water used for irrigation brocca et al 2018 li et al 2019 zaussinger et al 2019 for instance li et al 2019 used in situ sm data to estimate soil water budget components including irrigation the results show that sm potentially can identify irrigation amounts and frequencies zaussinger et al 2019 and brocca et al 2018 used remote sensing derived sm data zaussinger et al 2019 developed a methodology to estimate irrigation water use by comparing satellite and modelled sm which does not include irrigation information over the contiguous united states they validated the estimated irrigation amount against the 2013 farm and ranch irrigation survey usda 2014 despite the good results obtained the validation of the estimated irrigation in different terrains and different climate conditions appears difficult due to the different period of time of the benchmark dataset they considered the 2013 growing season against the satellite data from 2013 to 2017 and its state level aggregation a different approach to estimate irrigation amount from sm has been developed by brocca et al 2018 through a modified version of sm2rain algorithm brocca et al 2014 they demonstrated that two consecutive satellite soil moisture measurements in addition to ancillary rainfall data can be used to obtain irrigation estimates at daily time scale the algorithm is based on an inversion of soil water balance equation to derive the total amount of water entering into the soil in practice from sm measurements the irrigation estimation is possible by subtracting the measured rainfall fraction from the total water estimated by the algorithm which inherently includes irrigation in brocca et al 2018 a preliminary synthetic study to demonstrate the feasibility of the approach and a subsequent investigation in nine pilot sites over the world has been performed due to the lack of in situ irrigation data only qualitative assessment was carried out showing relatively good agreement of irrigation estimates by different satellite sm products over regions characterized by long dry periods and in which satellite soil moisture products perform reasonably well the method has also been tested by using satellite sm data in two sites respectively in nebraska and iran brocca et al 2017 jalilvand et al 2019 where irrigation data were available the work of brocca et al 2018 and zaussinger et al 2019 highlighted some important limitations mainly related to low spatial and temporal resolution of current available satellite soil moisture observations indeed most of them have a spatial resolution larger than 20 km while an irrigated field can range from few thousands of meters to few squared kilometers as a result the irrigation signal is usually masked out from the presence of other features contained in the coarse scale satellite pixel moreover a low irrigation signal has a high risk of being indistinguishable from the inherent noise in the satellite derived sm signal su et al 2015 massari et al 2017b the use of higher spatial resolution sm observations as those derived from synthetic aperture radar instruments like sentinel 1 bauer marschallinger et al 2018 could solve this problem for fields with an area similar to the one of the satellite s pixel in this case 1 km but their limited temporal resolution one observation every 1 5 4 days over europe when the two sentinel 1 satellites are considered could be inappropriate to detect irrigation applications occurring in few hours in summary three main issues have limited an objective understanding of whether satellite sm measurements can provide useful information on irrigation estimation namely the coarse spatial support of satellite sm observations their relatively low temporal resolution with respect to the scales of the irrigation practices and the absence of a reliable benchmark for testing the validity of the approaches developed so far to estimate irrigation volumes from space the purpose of this study is to demonstrate that sm is a valuable source of information for assessing irrigation fluxes and to clarify the effects of spatial and temporal resolution on such estimates specifically this manuscript aims to answer the following two questions 1 is sm a reliable source for retrieving irrigation fluxes 2 can the proposed approach be used with high spatial and low temporal resolution remote sensing data can its accuracy be considered sufficient for estimating irrigation to reach the objectives we applied the method of brocca et al 2018 in a controlled irrigated experimental field by using an innovative sm dataset inferred from proximal gamma ray spectroscopy measurements characterized by high accuracy competitive footprint and higher temporal resolution with respect to satellite sm data de groot et al 2009 bogena et al 2015 strati et al 2018 baldoncini et al 2018 2019 a proximal gamma ray pgr and an agro meteorological station have been installed in an experimental field located in north italy for a seven month period the 40k gamma signal detected by the pgr spectrometer installed at a few meters above the ground is inversely correlated with soil water content and it is not affected by variations in cosmic radiation and soil chemical composition strati et al 2018 the station is able to sense sm at field scale baldoncini et al 2018 from 103 to 104 m2 and it is therefore in between point and satellite measurements 108 m2 optimal for agricultural application it is also characterized by high temporal resolution 1 h hence it is able to track sm variations induced by irrigation the paper is organized as follows section 2 presents the description of the experimental site and setup section 3 synthesizes how sm can be inferred from pgr spectroscopy measurements and the basic principles of the proposed algorithm for irrigation estimation the results the discussion and the test at lower temporal resolution are illustrated in section 4 lastly conclusions are drawn in section 5 2 experimental site and setup the experimental site is a 40 108 m2 tomato test field 44 57 n 11 53 e 16 m above sea level belonging to a research center of the emiliano romagnolo canal cer irrigation district in the emilia romagna region italy fig 1 a according to the köppen geiger climate classification peel et al 2007 this geographical area is classified as cfa temperate climate without dry season and with hot summer emilia romagna is the italian region having the largest land surface cultivated with tomatoes one of the most water demanding crops among vegetables and it contributes for about one third of the tomato national production istat 2017 the experimental setup is composed of a proximal gamma ray pgr station equipped with a 1 l nai tl detector placed at 2 25 m above the ground and a commercial agro meteorological station meteosense 2 0 netsens see fig 1a strati et al 2018 during the data taking period from 4 april to 2 november 2017 the minimum temperature tmin ranged from 1 3 c to 22 7 c and the maximum temperature tmax ranged from 13 5 to 39 3 fig 1b the short wave incoming radiation swir varied from 34 7 to 257 3 w m2 fig 1c the evapotranspiration et0 fig 1c is calculated on the basis of the hargreaves method hargreaves and samani 1985 by using weather data recorded by the agro meteorological station tomato plants were transplanted on 23 may with a plant density of 3 5 plants m2 and harvested on 14 september the crop phenological growth stages of anthesis the time of flowering and maturity together with the dates of planting and harvesting are indicated in fig 1b irrigation water was delivered by a sprinkler system according to a schedule provided by the irrinet decision support tool munaretto and battilani 2014 the irrigation measurements refer to the water pumped to the sprinkler system in order to account the losses due to leakage wind drift spray droplet evaporation and evaporation from leaf surfaces a scaling factor of 0 9 is applied to each measurement as indicated from the field managers the soil has a loamy texture characterized by 45 of sand 40 of silt and 15 of clay soil bunk density is 1345 kg m3 and the organic matter content is 1 26 the hydraulic properties in terms of wilting point 0 09 m3 m3 field capacity 0 32 m3 m3 and saturation 0 48 m3 m3 were inferred from the water retention curve reported in strati et al 2018 3 methods 3 1 field scale soil moisture monitoring with gamma ray spectroscopy nuclear non invasive and non contact techniques have been developed for filling the gap between punctual m2 and satellite coarse resolution scale 105 m2 sm data the cosmic ray neutron and proximal gamma ray pgr methods demonstrated to effectively probe sm with a field scale footprint 104 m2 up to a depth of 30 cm limiting costs and manpower and using real time and wireless sensors andreasen et al 2017 baldoncini et al 2018 strati et al 2018 zreda et al 2008 in particular the pgr method consists in the quantification of sm by measuring gamma signals emitted in the decay of 40k naturally present and typically homogeneously distributed in the agricultural soil a gamma ray spectroscopy measurement is extremely sensitive to different soil water contents as water is much more effective in attenuating gamma rays with respect to minerals typically present in the soil indeed the measured 40k gamma signal s t counts per second at time t is inversely proportional to the volumetric soil water content sm m3 m3 baldoncini et al 2019 strati et al 2018 1 sm t a t s t 0 903 ρ with 2 a t s c a l λ t w c a l 0 903 where λ t is the adimensional time dependent biomass water content correction factor baldoncini et al 2019 and ρ is the soil bulk dry density kg m3 scal is the 40k gamma signal recorded at calibration time when the gravimetric soil water content wcal kg kg was determined on soil samples indeed the horizontal and vertical horizons of pgr spectroscopy can be defined according to the probability law governing the survival of photons when traversing a material as in feng et al 2009 given a fixed detector at 2 m height and a typical 1 3 103 kg m3 soil density it can be estimated that 95 of the unscattered gamma photon flux reaching the spectrometer comes from an area with a radius of 25 m fig 2 and from a depth of 30 cm fig 1 of baldoncini et al 2018 3 2 quantifying irrigation by the inversion of the water balance equation the idea to invert the soil water balance equation was initially developed to retrieve rainfall from in situ and satellite sm data brocca et al 2015 2016 2017 ciabatta et al 2017 koster et al 2016 massari et al 2017a here a similar approach is applied following the work done by brocca et al 2018 specifically the soil water balance equation for a layer depth z can be described by the following equation 3 z n dsm t d t r t i t g t s r t e t where z mm is the soil layer depth n m3 m3 is the soil porosity sm t is the relative saturation of soil t days is the time r t mm days is the rainfall rate i t mm days is the irrigation rate g t mm days is the drainage deep percolation plus subsurface runoff rate sr t mm days is the surface runoff and e t mm days is the actual evapotranspiration drainage can be expressed by 4 g t a sm t b where a mm days and b are two parameters expressing the nonlinearity between drainage rate and sm brocca et al 2014 sr t can be considered negligible since the irrigation through sprinkler system should avoid the formation of surface runoff if carried out optimally there is still the possibility that very intense or frequent water application rainfall or irrigation could saturate the soil and could lead to surface runoff the resulting underestimation is a residual error to be accepted since sm cannot keep trace of the runoff finally actual evapotranspiration is assumed linearly related to reference evapotranspiration 5 e t et 0 sm t therefore eq 3 can be simplified into 6 r t i t z dsm t d t a sm t b et 0 sm t where z is z n one of the main issues associated with this approach is that the direct inversion of eq 6 inherently leads to false irrigation estimates if the soil moisture signal is highly noisy to prevent this problem a semi empirical exponential filter wagner et al 1999 was applied to sm data which depends on a single parameter representing the characteristic time scale of sm variation t once denoised the sm signal can be used in eq 6 to estimate the sum of irrigation and rainfall rate the calibration of the three parameters z a and b was carried out by minimizing the root mean square error rmse between observed and estimated rainfall plus irrigation data in this perspective the limited availability of irrigation observation could pose severe limits on the application of the method two different calibration procedures were therefore used to test the actual need of irrigation observed data the first calibration rain irr from here onward is performed for the entire period using both rainfall and irrigation data whereas the second one rain is performed by using only rainfall data for the latter assuming that no irrigation is applied when rainfall occurs the calibration is performed only on days where r t 0 this is a fundamental hypothesis because during days in which both rainfall and irrigation occur the algorithm will force the total water infiltrated into the soil at the value of the rainfall only leading to an underestimation error the rationale is that if the two calibration procedures provide similar results in terms of irrigation estimation the method can be confidently applied with no restrictions beside the hypothesis above once the parameters calibration is performed the irrigation rate can be calculated by simply subtracting the observed rainfall rate from the outcomes of eq 6 4 results and discussion this section describes the estimation of sm from pgr spectra and the estimation of the irrigation through the application of above presented algorithm estimated rainfall and irrigation are then compared against true rainfall and irrigation fluxes by using two performances indices the pearson correlation coefficient r and the root mean square error rmse finally the role of sm data temporal resolution is investigated 4 1 soil moisture estimation through proximal gamma ray spectroscopy soil moisture was determined with hourly temporal resolution on the basis of pgr measurements for almost the entire 7 months data taking period fig 2 the pgr measurement is sensitive to more than half experimental field and therefore well represents the mean soil moisture of the field the gamma and agro meteorological stations installed at the tomato experimental field were operative for a 94 8 overlapping duty cycle and a 260 gb global amount of uncompressed data was recorded as both stations were equipped with a gprs connection it was possible to remotely process the data in real time pgr 40k signal fig 2a and sm fig 2b continuous time series show a strong correlation with rainfall and or irrigation events also in cases of low amounts of distributed water pgr measurements are indeed able to provide high frequency sm estimations sensitive to transient soil water content levels consistently with physical hydrological soil properties the reliability of the method was tested against validation gravimetric measurements on soil samples resulting in a 2 average discrepancy and against 3 different soil crop hydrological models strati et al 2018 provided a calibration of sm through direct measurements on soil samples and a correction accounting for the biomass shielding effect pgr spectroscopy performed with a permanent station can be considered an effective non stop and non invasive sm monitoring method 4 2 from soil moisture to irrigation pgr sm data were processed through the irrigation estimation algorithm to verify the feasibility to estimate rainfall and irrigation amounts from sm an hourly linear interpolation was applied to estimate sm values during the shutdown periods of the pgr station if no value was found within a maximum interpolation gap of 5 h the corresponding sm was excluded from the analysis the semi empirical exponential filter was applied to the resulting sm data with 1 h temporal resolution t parameter was fixed at 0 16 days around 4 h after the calibration of the algorithm the denoised sm data were then sampled every 24 h at 00 00 utc to obtain a daily series of sm used as input of eq 6 to predict daily rainfall and irrigation rates fig 3 shows the filtered sm data and the results of the sampling for the full observation period between april and november 2017 the data between the 13th and the 14th of september were masked out due to the presence of harvesting machines in the field that interfered with the measurements then the three parameters of the algorithm z a and b were calibrated through an iterative process by setting their initial values to the minimum plus 10 of the selected range of variation table 1 the outcomes of the algorithm were finally iteratively compared with the observed rainfall plus irrigation rates rain irr calibration or with the observed rainfall rates rain calibration until the rmse is minimized the optimized values of the parameters are shown in table 1 for rain irr and rain calibration procedures the z parameter value is particularly significant the pgr station is able to sense sm until 300 mm of soil fig 1 of baldoncini et al 2018 but the gamma contribution is not uniform with sensing depth around 55 of the contribution is derived from the first 50 mm of soil rising to 70 80 for the first 100 cm of soil considering this and an average porosity around 0 4 0 5 we expected a value of z around 50 as it is obtained from the calibration of the algorithm the variation observed on the parameter values are ascribed to the different calibration period indeed rain calibration performs the parameters estimation only in days when rainfall occurs nevertheless the four parameters maintain the same order of magnitude and the obtained results present just minor differences the similarities of the two calibration outcomes are also visible in figs 4 and 5 where the rainfall and irrigation time series at daily resolution derived on the basis of the two calibration procedures are shown globally irrigation and rainfall events are successfully detected by the proposed algorithm for both calibration procedures however the algorithm is not able to well reproduce large rainfall irrigation events particularly if the calibration is carried out with rainfall data only the irrigation time series are calculated by subtracting the observed rainfall from the algorithm outcomes this procedure leads to negative values in correspondence with rainfall underestimation e g during the months of may and september therefore those values have been set to zero since they are not related to the irrigation estimation for both the calibration procedures the total amount of rainfall and irrigation together with the two indices r and rmse are calculated to evaluate the performance of the proposed algorithm in the estimation of the irrigation series and the rainfall plus irrigation series with respect to the observed data see table 2 the two datasets show very good performances in both the estimation of rainfall plus irrigation and irrigation with r greater than 0 88 in each case the rmse is around 3 mm day when considering just irrigation series and 4 mm day when considering rainfall plus irrigation series in fact when the irrigation is estimated from rainfall plus irrigation series negative values are obtained when rainfall is underestimated those values have no physical meanings and are not related to irrigation therefore they are set to 0 the error component relative to rainfall underestimation is hence eliminated and the overall error decreases this is also demonstrated by the differences between irrigation and rainfall plus irrigation total error for each calibration the irrigation amount is always overestimated whereas the rainfall plus irrigation amount is underestimated the suppression of the negative impact of rainfall underestimation is responsible of this effect finally the larger underestimation of the outcomes calibrated with just rainfall with respect to the ones calibrated with both rainfall and irrigation is confirmed by the comparison of the two calibrations rmse and total water estimated results as expected globally rain irr calibration provides better estimates of irrigation with respect to the rain calibration because even if the overall overestimation is greater this is only due to the common rainfall overestimation i e false irrigation events the first calibration is better in terms of real estimation of irrigation based on the previous analysis we can answer the first research question the results show that pgr sm is indeed a reliable information to perform irrigation estimations the global lack of irrigation information for calibration is not a limit for this methodology as the decrease of performance when the parameters are calibrated with only rainfall data is very limited and it can be imputed to the smaller number of calibration data i e the increase of rmse in estimating rainfall plus irrigation irrigation by using rain calibration rather than rain irr calibration is around 2 75 4 8 while the decrease in pearson correlation is around 0 01 0 02 hence the applicability of this methodology is constrained by the quality of the sm dataset and its spatial and temporal resolution 4 3 testing satellite temporal resolution the application of the proposed algorithm to pgr sm data demonstrated the potential of using sm to derive irrigation the good results obtained support the use of sm with high spatial resolution in view of the increased spatial resolution of recent satellite missions for remote sm sensing it is necessary to test the effect of a lower temporal resolution specifically synthetic sm time series were created by down sampling pgr sm data at 24 36 48 72 and 120 h in order to reproduce the lower temporal resolution of different remote sensing sm data e g 36 to 144 h for smos smap and sentinel 1 then in order to apply the algorithm for irrigation estimation the series were linearly interpolated at daily scale to obtain daily time series of sm from which daily rainfall and irrigation are computed as in the previous analysis the observed rainfall was then subtracted from the algorithm outcomes to obtain irrigation a further analysis was carried out by considering the rainfall plus irrigation time series aggregated at 168 h one week to average the results in a longer period i e less affected by the interpolation approximations indeed the estimation of irrigation at weekly time scale is still useful for agricultural water management the performances indices of irrigation series for daily and weekly analysis are shown in fig 6 as expected the irrigation estimation becomes less accurate as the sm sampling time increases nevertheless the performance drop of daily time series shown in fig 6a and c is clearly worse than that obtained with weekly time series fig 6b and d at daily time scale the interpolated values deviate from the observed values but this effect can be averaged by analyzing a longer period still the tendency of decreasing performance remains probably due to aliasing problem generated from the sampling procedure i e the missing of some event due to excessive time step fig 6b in fact shows that the performance of the weekly product decreases when sm sampling times greater than 48 h are considered moreover the performance for rain calibration is always lower than that for rain irr calibration and the discrepancies generally increase with decreasing temporal resolution the hypothesis in the rain calibration procedure of absence of irrigation when rainfall occurs is probably the main responsible of this behavior based on the previous results we can answer to the second research question a temporal resolution lower than one day can be an issue for daily irrigation estimation still the outcomes can be acceptable if the temporal resolution is not much greater than 24 h a pearson correlation coefficient of around 0 6 was obtained for the products derived from 36 h sampled sm or if the objective is moved from the estimation of daily to weekly irrigation series in the latter case we obtained good results r 0 7 for sm time sampling up to 48 h a larger sm sampling time is probably too large to correctly follow the natural variation of sm and the performance indices get worse 5 conclusions in this study sm data inferred from pgr spectroscopy measurements were used as input for a water balance algorithm with the objective to quantify irrigation amount on the basis of the obtained results the following conclusions can be drawn pgr spectroscopy proved to be efficient to measure sm at field scale pgr data with hourly frequency are highly sensitive to transient sm levels and are well correlated with irrigation and rainfall events nevertheless sm data are quite noisy and needed to be filtered the proposed algorithm to estimate irrigation shows good performances with pearson correlation coefficient between observed and estimated daily irrigation greater than 0 88 both when the algorithm is calibrated with daily rainfall and irrigation data and with just daily rainfall data in particular even if the rainfall plus irrigation calibration performs better the pearson correlation between observed and estimated irrigation rainfall plus irrigation decreases by less than 0 02 0 01 and the rmse increases by of 4 8 2 75 if the rain calibration is applied showing that the methodology is applicable also when irrigation data are absent the analysis of data sampled at different time steps reproducing the lower temporal resolution of high spatial resolution sm remote sensing data shows that the methodology is potentially applicable also in this case if sm sampling times shorter than 48hare considered this is the consequence of the drop in performance observed at lower temporal resolution due to daily interpolation problems and aliasing effect the impact of the interpolation can be partially avoided if an aggregation of the results is carried out at weekly scale the analysis enabled to address the two research questions above proposed in particular 1 sm is a reliable source of information for retrieving irrigation amounts and the proposed algorithm is effective in doing so even in the case in which only rainfall data are used to calibrate the algorithm 2 the algorithm performs relatively well with daily data a lower temporal resolution can be accepted if the sm sampling time is not greater than 48 h or when the objective is to obtain irrigation estimates on a time scale longer than one day e g on a weekly time scale the main purpose of this study was to assess the capabilities of sm to estimate irrigation water and the potential application of the proposed methodology to hr remote sensing data this would permit to quantify irrigation over large regions e g continental scale without the need of in situ stations while accepting a probable decrease in performance due to the lower spatial and temporal resolution and lower accuracy further developments in this direction e g the application of the methodology directly to hr sm remote sensing measurements are currently being studied and will be the object of future works declaration of competing interest none acknowledgments we would like to acknowledge the support of european space agency through the project wacmos irrigation esa expro rfp 3 14680 16 i nb we would like to acknowledge the support of european space agency through the project wacmos irrigation esa expro rfp 3 14680 16 i nb this research is partially funded by national institute of nuclear physics infn through the italian radioactivity project italrad and by the university of ferrara far 2019 and project protocolli operativi scalabili per l agricoltura di precisione positive cup d41f18000080009 the authors thank the staff of geoexplorer impresa sociale s r l for their support and stefano anconelli marica baldoncini marco bittelli carlo bottardi enrico chiarelli giovanni fiorentini domenico solimando for enlightening discussions and valuable comments the authors thank the university of ferrara and infn ferrara for the access to the coka gpu cluster 
535,the global warming effects put in danger global water availability and make necessary to decrease water wastage e g by monitoring global irrigation despite this global irrigation information is scarce due to the absence of a solid estimation technique in this study we applied an innovative approach to retrieve irrigation water from high spatial and temporal resolution soil moisture sm data obtained from an advanced sensor based on proximal gamma ray pgr spectroscopy in a field located in emilia romagna italy the results show that sm is a key variable to obtain information about the amount of water applied to plants with pearson correlation between observed and estimated daily irrigation data ranges from 0 88 to 0 91 by using different calibration methodology with the aim of reproducing the working conditions of satellites measuring soil moisture we sub sampled sm hourly time series at larger time steps the results demonstrated that the methodology is still capable to perform the daily weekly irrigation estimation with pearson correlation around 0 6 0 7 if the time step is not greater than 36 48 hours keywords sm2rain irrigation soil moisture proximal gamma ray method 1 introduction irrigation is one of the greatest human intervention on water cycle and it accounts for more than 70 of global freshwater withdrawals fao 2006 foley et al 2011 nowadays around 20 of the world s cultivated area is irrigated and it supplies over 40 of the world s food droogers et al 2010 global warming and the intensification of the hydrological cycle with the increased occurrence of droughts and floods will threaten the natural availability of water enhancing the need of irrigation allan and soden 2008 kummu et al 2016 rockström et al 2012 vörösmarty et al 2000 the projected population growth will aggravate this already complicated panorama due to the consequent increase of food demand the knowledge of irrigated lands and the water used is hence of primary importance to prevent water wastage to avoid illegal withdrawals and to ensure food and water security siebert et al 2010 taylor et al 2013 monitoring irrigation is also fundamental for other applications i to understand the consequences of irrigation water cycle modifications ii to investigate the impact of irrigation on local and regional climate conditions and iii to develop hydrological and climate models that account for irrigation sacks et al 2009 despite its importance a global dataset of irrigation water use over long periods is still missing available time series of irrigation amount are mostly based on statistical surveys this kind of information does not take into account the illegal pumping and is potentially affected by large errors because of self reporting bias spatial inconsistency and low temporal resolution and coverage e g the u s geological survey publishes a report on water use every 5 years deines et al 2017 their quality is hence variable over different states and regions as inferred by siebert et al 2005 who developed a global dataset of area equipped for irrigation by combining sub national irrigation statistics a different approach consists in modeling water requirements for crop irrigation rather than actual water used for irrigation doll and siebert 2002 wada et al 2014 but the existence of vast under and over irrigated areas with respect to water requirements foley et al 2011 represents a large source of errors for this methodology that limits its applicability in this context a new source of irrigation information is emerging i e the use of soil moisture sm observations for decades sm has been widely used by farmers to efficiently schedule irrigation campbell and campbell 1982 khan et al 1996 aguilar et al 2015 its knowledge helps to determine the crop stress conditions and then assists the farmer to decide when and how much water must be applied for improving the efficiency and the quality of the production recently sm has been also employed to directly quantify the amount of water used for irrigation brocca et al 2018 li et al 2019 zaussinger et al 2019 for instance li et al 2019 used in situ sm data to estimate soil water budget components including irrigation the results show that sm potentially can identify irrigation amounts and frequencies zaussinger et al 2019 and brocca et al 2018 used remote sensing derived sm data zaussinger et al 2019 developed a methodology to estimate irrigation water use by comparing satellite and modelled sm which does not include irrigation information over the contiguous united states they validated the estimated irrigation amount against the 2013 farm and ranch irrigation survey usda 2014 despite the good results obtained the validation of the estimated irrigation in different terrains and different climate conditions appears difficult due to the different period of time of the benchmark dataset they considered the 2013 growing season against the satellite data from 2013 to 2017 and its state level aggregation a different approach to estimate irrigation amount from sm has been developed by brocca et al 2018 through a modified version of sm2rain algorithm brocca et al 2014 they demonstrated that two consecutive satellite soil moisture measurements in addition to ancillary rainfall data can be used to obtain irrigation estimates at daily time scale the algorithm is based on an inversion of soil water balance equation to derive the total amount of water entering into the soil in practice from sm measurements the irrigation estimation is possible by subtracting the measured rainfall fraction from the total water estimated by the algorithm which inherently includes irrigation in brocca et al 2018 a preliminary synthetic study to demonstrate the feasibility of the approach and a subsequent investigation in nine pilot sites over the world has been performed due to the lack of in situ irrigation data only qualitative assessment was carried out showing relatively good agreement of irrigation estimates by different satellite sm products over regions characterized by long dry periods and in which satellite soil moisture products perform reasonably well the method has also been tested by using satellite sm data in two sites respectively in nebraska and iran brocca et al 2017 jalilvand et al 2019 where irrigation data were available the work of brocca et al 2018 and zaussinger et al 2019 highlighted some important limitations mainly related to low spatial and temporal resolution of current available satellite soil moisture observations indeed most of them have a spatial resolution larger than 20 km while an irrigated field can range from few thousands of meters to few squared kilometers as a result the irrigation signal is usually masked out from the presence of other features contained in the coarse scale satellite pixel moreover a low irrigation signal has a high risk of being indistinguishable from the inherent noise in the satellite derived sm signal su et al 2015 massari et al 2017b the use of higher spatial resolution sm observations as those derived from synthetic aperture radar instruments like sentinel 1 bauer marschallinger et al 2018 could solve this problem for fields with an area similar to the one of the satellite s pixel in this case 1 km but their limited temporal resolution one observation every 1 5 4 days over europe when the two sentinel 1 satellites are considered could be inappropriate to detect irrigation applications occurring in few hours in summary three main issues have limited an objective understanding of whether satellite sm measurements can provide useful information on irrigation estimation namely the coarse spatial support of satellite sm observations their relatively low temporal resolution with respect to the scales of the irrigation practices and the absence of a reliable benchmark for testing the validity of the approaches developed so far to estimate irrigation volumes from space the purpose of this study is to demonstrate that sm is a valuable source of information for assessing irrigation fluxes and to clarify the effects of spatial and temporal resolution on such estimates specifically this manuscript aims to answer the following two questions 1 is sm a reliable source for retrieving irrigation fluxes 2 can the proposed approach be used with high spatial and low temporal resolution remote sensing data can its accuracy be considered sufficient for estimating irrigation to reach the objectives we applied the method of brocca et al 2018 in a controlled irrigated experimental field by using an innovative sm dataset inferred from proximal gamma ray spectroscopy measurements characterized by high accuracy competitive footprint and higher temporal resolution with respect to satellite sm data de groot et al 2009 bogena et al 2015 strati et al 2018 baldoncini et al 2018 2019 a proximal gamma ray pgr and an agro meteorological station have been installed in an experimental field located in north italy for a seven month period the 40k gamma signal detected by the pgr spectrometer installed at a few meters above the ground is inversely correlated with soil water content and it is not affected by variations in cosmic radiation and soil chemical composition strati et al 2018 the station is able to sense sm at field scale baldoncini et al 2018 from 103 to 104 m2 and it is therefore in between point and satellite measurements 108 m2 optimal for agricultural application it is also characterized by high temporal resolution 1 h hence it is able to track sm variations induced by irrigation the paper is organized as follows section 2 presents the description of the experimental site and setup section 3 synthesizes how sm can be inferred from pgr spectroscopy measurements and the basic principles of the proposed algorithm for irrigation estimation the results the discussion and the test at lower temporal resolution are illustrated in section 4 lastly conclusions are drawn in section 5 2 experimental site and setup the experimental site is a 40 108 m2 tomato test field 44 57 n 11 53 e 16 m above sea level belonging to a research center of the emiliano romagnolo canal cer irrigation district in the emilia romagna region italy fig 1 a according to the köppen geiger climate classification peel et al 2007 this geographical area is classified as cfa temperate climate without dry season and with hot summer emilia romagna is the italian region having the largest land surface cultivated with tomatoes one of the most water demanding crops among vegetables and it contributes for about one third of the tomato national production istat 2017 the experimental setup is composed of a proximal gamma ray pgr station equipped with a 1 l nai tl detector placed at 2 25 m above the ground and a commercial agro meteorological station meteosense 2 0 netsens see fig 1a strati et al 2018 during the data taking period from 4 april to 2 november 2017 the minimum temperature tmin ranged from 1 3 c to 22 7 c and the maximum temperature tmax ranged from 13 5 to 39 3 fig 1b the short wave incoming radiation swir varied from 34 7 to 257 3 w m2 fig 1c the evapotranspiration et0 fig 1c is calculated on the basis of the hargreaves method hargreaves and samani 1985 by using weather data recorded by the agro meteorological station tomato plants were transplanted on 23 may with a plant density of 3 5 plants m2 and harvested on 14 september the crop phenological growth stages of anthesis the time of flowering and maturity together with the dates of planting and harvesting are indicated in fig 1b irrigation water was delivered by a sprinkler system according to a schedule provided by the irrinet decision support tool munaretto and battilani 2014 the irrigation measurements refer to the water pumped to the sprinkler system in order to account the losses due to leakage wind drift spray droplet evaporation and evaporation from leaf surfaces a scaling factor of 0 9 is applied to each measurement as indicated from the field managers the soil has a loamy texture characterized by 45 of sand 40 of silt and 15 of clay soil bunk density is 1345 kg m3 and the organic matter content is 1 26 the hydraulic properties in terms of wilting point 0 09 m3 m3 field capacity 0 32 m3 m3 and saturation 0 48 m3 m3 were inferred from the water retention curve reported in strati et al 2018 3 methods 3 1 field scale soil moisture monitoring with gamma ray spectroscopy nuclear non invasive and non contact techniques have been developed for filling the gap between punctual m2 and satellite coarse resolution scale 105 m2 sm data the cosmic ray neutron and proximal gamma ray pgr methods demonstrated to effectively probe sm with a field scale footprint 104 m2 up to a depth of 30 cm limiting costs and manpower and using real time and wireless sensors andreasen et al 2017 baldoncini et al 2018 strati et al 2018 zreda et al 2008 in particular the pgr method consists in the quantification of sm by measuring gamma signals emitted in the decay of 40k naturally present and typically homogeneously distributed in the agricultural soil a gamma ray spectroscopy measurement is extremely sensitive to different soil water contents as water is much more effective in attenuating gamma rays with respect to minerals typically present in the soil indeed the measured 40k gamma signal s t counts per second at time t is inversely proportional to the volumetric soil water content sm m3 m3 baldoncini et al 2019 strati et al 2018 1 sm t a t s t 0 903 ρ with 2 a t s c a l λ t w c a l 0 903 where λ t is the adimensional time dependent biomass water content correction factor baldoncini et al 2019 and ρ is the soil bulk dry density kg m3 scal is the 40k gamma signal recorded at calibration time when the gravimetric soil water content wcal kg kg was determined on soil samples indeed the horizontal and vertical horizons of pgr spectroscopy can be defined according to the probability law governing the survival of photons when traversing a material as in feng et al 2009 given a fixed detector at 2 m height and a typical 1 3 103 kg m3 soil density it can be estimated that 95 of the unscattered gamma photon flux reaching the spectrometer comes from an area with a radius of 25 m fig 2 and from a depth of 30 cm fig 1 of baldoncini et al 2018 3 2 quantifying irrigation by the inversion of the water balance equation the idea to invert the soil water balance equation was initially developed to retrieve rainfall from in situ and satellite sm data brocca et al 2015 2016 2017 ciabatta et al 2017 koster et al 2016 massari et al 2017a here a similar approach is applied following the work done by brocca et al 2018 specifically the soil water balance equation for a layer depth z can be described by the following equation 3 z n dsm t d t r t i t g t s r t e t where z mm is the soil layer depth n m3 m3 is the soil porosity sm t is the relative saturation of soil t days is the time r t mm days is the rainfall rate i t mm days is the irrigation rate g t mm days is the drainage deep percolation plus subsurface runoff rate sr t mm days is the surface runoff and e t mm days is the actual evapotranspiration drainage can be expressed by 4 g t a sm t b where a mm days and b are two parameters expressing the nonlinearity between drainage rate and sm brocca et al 2014 sr t can be considered negligible since the irrigation through sprinkler system should avoid the formation of surface runoff if carried out optimally there is still the possibility that very intense or frequent water application rainfall or irrigation could saturate the soil and could lead to surface runoff the resulting underestimation is a residual error to be accepted since sm cannot keep trace of the runoff finally actual evapotranspiration is assumed linearly related to reference evapotranspiration 5 e t et 0 sm t therefore eq 3 can be simplified into 6 r t i t z dsm t d t a sm t b et 0 sm t where z is z n one of the main issues associated with this approach is that the direct inversion of eq 6 inherently leads to false irrigation estimates if the soil moisture signal is highly noisy to prevent this problem a semi empirical exponential filter wagner et al 1999 was applied to sm data which depends on a single parameter representing the characteristic time scale of sm variation t once denoised the sm signal can be used in eq 6 to estimate the sum of irrigation and rainfall rate the calibration of the three parameters z a and b was carried out by minimizing the root mean square error rmse between observed and estimated rainfall plus irrigation data in this perspective the limited availability of irrigation observation could pose severe limits on the application of the method two different calibration procedures were therefore used to test the actual need of irrigation observed data the first calibration rain irr from here onward is performed for the entire period using both rainfall and irrigation data whereas the second one rain is performed by using only rainfall data for the latter assuming that no irrigation is applied when rainfall occurs the calibration is performed only on days where r t 0 this is a fundamental hypothesis because during days in which both rainfall and irrigation occur the algorithm will force the total water infiltrated into the soil at the value of the rainfall only leading to an underestimation error the rationale is that if the two calibration procedures provide similar results in terms of irrigation estimation the method can be confidently applied with no restrictions beside the hypothesis above once the parameters calibration is performed the irrigation rate can be calculated by simply subtracting the observed rainfall rate from the outcomes of eq 6 4 results and discussion this section describes the estimation of sm from pgr spectra and the estimation of the irrigation through the application of above presented algorithm estimated rainfall and irrigation are then compared against true rainfall and irrigation fluxes by using two performances indices the pearson correlation coefficient r and the root mean square error rmse finally the role of sm data temporal resolution is investigated 4 1 soil moisture estimation through proximal gamma ray spectroscopy soil moisture was determined with hourly temporal resolution on the basis of pgr measurements for almost the entire 7 months data taking period fig 2 the pgr measurement is sensitive to more than half experimental field and therefore well represents the mean soil moisture of the field the gamma and agro meteorological stations installed at the tomato experimental field were operative for a 94 8 overlapping duty cycle and a 260 gb global amount of uncompressed data was recorded as both stations were equipped with a gprs connection it was possible to remotely process the data in real time pgr 40k signal fig 2a and sm fig 2b continuous time series show a strong correlation with rainfall and or irrigation events also in cases of low amounts of distributed water pgr measurements are indeed able to provide high frequency sm estimations sensitive to transient soil water content levels consistently with physical hydrological soil properties the reliability of the method was tested against validation gravimetric measurements on soil samples resulting in a 2 average discrepancy and against 3 different soil crop hydrological models strati et al 2018 provided a calibration of sm through direct measurements on soil samples and a correction accounting for the biomass shielding effect pgr spectroscopy performed with a permanent station can be considered an effective non stop and non invasive sm monitoring method 4 2 from soil moisture to irrigation pgr sm data were processed through the irrigation estimation algorithm to verify the feasibility to estimate rainfall and irrigation amounts from sm an hourly linear interpolation was applied to estimate sm values during the shutdown periods of the pgr station if no value was found within a maximum interpolation gap of 5 h the corresponding sm was excluded from the analysis the semi empirical exponential filter was applied to the resulting sm data with 1 h temporal resolution t parameter was fixed at 0 16 days around 4 h after the calibration of the algorithm the denoised sm data were then sampled every 24 h at 00 00 utc to obtain a daily series of sm used as input of eq 6 to predict daily rainfall and irrigation rates fig 3 shows the filtered sm data and the results of the sampling for the full observation period between april and november 2017 the data between the 13th and the 14th of september were masked out due to the presence of harvesting machines in the field that interfered with the measurements then the three parameters of the algorithm z a and b were calibrated through an iterative process by setting their initial values to the minimum plus 10 of the selected range of variation table 1 the outcomes of the algorithm were finally iteratively compared with the observed rainfall plus irrigation rates rain irr calibration or with the observed rainfall rates rain calibration until the rmse is minimized the optimized values of the parameters are shown in table 1 for rain irr and rain calibration procedures the z parameter value is particularly significant the pgr station is able to sense sm until 300 mm of soil fig 1 of baldoncini et al 2018 but the gamma contribution is not uniform with sensing depth around 55 of the contribution is derived from the first 50 mm of soil rising to 70 80 for the first 100 cm of soil considering this and an average porosity around 0 4 0 5 we expected a value of z around 50 as it is obtained from the calibration of the algorithm the variation observed on the parameter values are ascribed to the different calibration period indeed rain calibration performs the parameters estimation only in days when rainfall occurs nevertheless the four parameters maintain the same order of magnitude and the obtained results present just minor differences the similarities of the two calibration outcomes are also visible in figs 4 and 5 where the rainfall and irrigation time series at daily resolution derived on the basis of the two calibration procedures are shown globally irrigation and rainfall events are successfully detected by the proposed algorithm for both calibration procedures however the algorithm is not able to well reproduce large rainfall irrigation events particularly if the calibration is carried out with rainfall data only the irrigation time series are calculated by subtracting the observed rainfall from the algorithm outcomes this procedure leads to negative values in correspondence with rainfall underestimation e g during the months of may and september therefore those values have been set to zero since they are not related to the irrigation estimation for both the calibration procedures the total amount of rainfall and irrigation together with the two indices r and rmse are calculated to evaluate the performance of the proposed algorithm in the estimation of the irrigation series and the rainfall plus irrigation series with respect to the observed data see table 2 the two datasets show very good performances in both the estimation of rainfall plus irrigation and irrigation with r greater than 0 88 in each case the rmse is around 3 mm day when considering just irrigation series and 4 mm day when considering rainfall plus irrigation series in fact when the irrigation is estimated from rainfall plus irrigation series negative values are obtained when rainfall is underestimated those values have no physical meanings and are not related to irrigation therefore they are set to 0 the error component relative to rainfall underestimation is hence eliminated and the overall error decreases this is also demonstrated by the differences between irrigation and rainfall plus irrigation total error for each calibration the irrigation amount is always overestimated whereas the rainfall plus irrigation amount is underestimated the suppression of the negative impact of rainfall underestimation is responsible of this effect finally the larger underestimation of the outcomes calibrated with just rainfall with respect to the ones calibrated with both rainfall and irrigation is confirmed by the comparison of the two calibrations rmse and total water estimated results as expected globally rain irr calibration provides better estimates of irrigation with respect to the rain calibration because even if the overall overestimation is greater this is only due to the common rainfall overestimation i e false irrigation events the first calibration is better in terms of real estimation of irrigation based on the previous analysis we can answer the first research question the results show that pgr sm is indeed a reliable information to perform irrigation estimations the global lack of irrigation information for calibration is not a limit for this methodology as the decrease of performance when the parameters are calibrated with only rainfall data is very limited and it can be imputed to the smaller number of calibration data i e the increase of rmse in estimating rainfall plus irrigation irrigation by using rain calibration rather than rain irr calibration is around 2 75 4 8 while the decrease in pearson correlation is around 0 01 0 02 hence the applicability of this methodology is constrained by the quality of the sm dataset and its spatial and temporal resolution 4 3 testing satellite temporal resolution the application of the proposed algorithm to pgr sm data demonstrated the potential of using sm to derive irrigation the good results obtained support the use of sm with high spatial resolution in view of the increased spatial resolution of recent satellite missions for remote sm sensing it is necessary to test the effect of a lower temporal resolution specifically synthetic sm time series were created by down sampling pgr sm data at 24 36 48 72 and 120 h in order to reproduce the lower temporal resolution of different remote sensing sm data e g 36 to 144 h for smos smap and sentinel 1 then in order to apply the algorithm for irrigation estimation the series were linearly interpolated at daily scale to obtain daily time series of sm from which daily rainfall and irrigation are computed as in the previous analysis the observed rainfall was then subtracted from the algorithm outcomes to obtain irrigation a further analysis was carried out by considering the rainfall plus irrigation time series aggregated at 168 h one week to average the results in a longer period i e less affected by the interpolation approximations indeed the estimation of irrigation at weekly time scale is still useful for agricultural water management the performances indices of irrigation series for daily and weekly analysis are shown in fig 6 as expected the irrigation estimation becomes less accurate as the sm sampling time increases nevertheless the performance drop of daily time series shown in fig 6a and c is clearly worse than that obtained with weekly time series fig 6b and d at daily time scale the interpolated values deviate from the observed values but this effect can be averaged by analyzing a longer period still the tendency of decreasing performance remains probably due to aliasing problem generated from the sampling procedure i e the missing of some event due to excessive time step fig 6b in fact shows that the performance of the weekly product decreases when sm sampling times greater than 48 h are considered moreover the performance for rain calibration is always lower than that for rain irr calibration and the discrepancies generally increase with decreasing temporal resolution the hypothesis in the rain calibration procedure of absence of irrigation when rainfall occurs is probably the main responsible of this behavior based on the previous results we can answer to the second research question a temporal resolution lower than one day can be an issue for daily irrigation estimation still the outcomes can be acceptable if the temporal resolution is not much greater than 24 h a pearson correlation coefficient of around 0 6 was obtained for the products derived from 36 h sampled sm or if the objective is moved from the estimation of daily to weekly irrigation series in the latter case we obtained good results r 0 7 for sm time sampling up to 48 h a larger sm sampling time is probably too large to correctly follow the natural variation of sm and the performance indices get worse 5 conclusions in this study sm data inferred from pgr spectroscopy measurements were used as input for a water balance algorithm with the objective to quantify irrigation amount on the basis of the obtained results the following conclusions can be drawn pgr spectroscopy proved to be efficient to measure sm at field scale pgr data with hourly frequency are highly sensitive to transient sm levels and are well correlated with irrigation and rainfall events nevertheless sm data are quite noisy and needed to be filtered the proposed algorithm to estimate irrigation shows good performances with pearson correlation coefficient between observed and estimated daily irrigation greater than 0 88 both when the algorithm is calibrated with daily rainfall and irrigation data and with just daily rainfall data in particular even if the rainfall plus irrigation calibration performs better the pearson correlation between observed and estimated irrigation rainfall plus irrigation decreases by less than 0 02 0 01 and the rmse increases by of 4 8 2 75 if the rain calibration is applied showing that the methodology is applicable also when irrigation data are absent the analysis of data sampled at different time steps reproducing the lower temporal resolution of high spatial resolution sm remote sensing data shows that the methodology is potentially applicable also in this case if sm sampling times shorter than 48hare considered this is the consequence of the drop in performance observed at lower temporal resolution due to daily interpolation problems and aliasing effect the impact of the interpolation can be partially avoided if an aggregation of the results is carried out at weekly scale the analysis enabled to address the two research questions above proposed in particular 1 sm is a reliable source of information for retrieving irrigation amounts and the proposed algorithm is effective in doing so even in the case in which only rainfall data are used to calibrate the algorithm 2 the algorithm performs relatively well with daily data a lower temporal resolution can be accepted if the sm sampling time is not greater than 48 h or when the objective is to obtain irrigation estimates on a time scale longer than one day e g on a weekly time scale the main purpose of this study was to assess the capabilities of sm to estimate irrigation water and the potential application of the proposed methodology to hr remote sensing data this would permit to quantify irrigation over large regions e g continental scale without the need of in situ stations while accepting a probable decrease in performance due to the lower spatial and temporal resolution and lower accuracy further developments in this direction e g the application of the methodology directly to hr sm remote sensing measurements are currently being studied and will be the object of future works declaration of competing interest none acknowledgments we would like to acknowledge the support of european space agency through the project wacmos irrigation esa expro rfp 3 14680 16 i nb we would like to acknowledge the support of european space agency through the project wacmos irrigation esa expro rfp 3 14680 16 i nb this research is partially funded by national institute of nuclear physics infn through the italian radioactivity project italrad and by the university of ferrara far 2019 and project protocolli operativi scalabili per l agricoltura di precisione positive cup d41f18000080009 the authors thank the staff of geoexplorer impresa sociale s r l for their support and stefano anconelli marica baldoncini marco bittelli carlo bottardi enrico chiarelli giovanni fiorentini domenico solimando for enlightening discussions and valuable comments the authors thank the university of ferrara and infn ferrara for the access to the coka gpu cluster 
536,in coastal regions accurate prediction of the inundation risks posed by tropical cyclones and other severe weather is key to mitigating disaster impacts predictions of these risks are often provided by numerical models however these models also frequently do not consider inundation due to wind sea wave run up neglecting such effects may be misleading for evaluating the risks posed to areas protected by flood defense systems such as levees and dykes to effectively evaluate the flooding risks posed by storm waves accurate wind sea modeling should be undertaken in parallel with storm surge modeling and accurate wave overtopping flow rates at flood barriers must be prescribed based on the modeled sea conditions and structure geometries to this end we present development of a loosely coupled finite element based shallow water equations and parametric spectral wave model wave overtopping flow rates are computed by formulas provided in the guidance of the eurotop manual we demonstrate that the parametric spectral wave modeling approach is sufficiently accurate for modeling of wave overtopping events despite its simplifying assumptions such as those based on deep water e g discounting foreshore effects such as wave shoaling and breaking and disregarding internal forces due to wave breaking and turbulence as opposed to more commonly used discrete third generation spectral wave models which provide more detailed descriptions of wave fields but are much more computationally expensive comparisons of numerically modeled wave overtopping flow rates with measurements from the clash database show good agreement by linear regression slope 0 9911 r 2 0 9584 for more than 90 of the test cases considered where for the relatively few outlier cases the model performs poorly due to either uncertainties in the eurotop guidance or the lack of foreshore effects in the wave model keywords discontinuous galerkin methods shallow water equations wind driven water waves wave overtopping flood control 1 introduction tropical weather systems frequently generate hazardous seas due to strong winds as these systems approach the shore they pose risks to coastal communities and infrastructure and the failure of flood defense structures such as levees embankments and dikes can cause catastrophic loss emergency managers require comprehensive and reliable predictions of the extent of the risks posed to coastal areas during the threat of an impending tropical weather event to this end computational models are frequently applied to forecast these risks models for storm surge often contain features for modeling flood barrier overtopping during instances in which the mean water level on either side of a barrier exceeds that structure s crest height westerink et al 2001 dawson et al 2011 however many flood defense structures may be more commonly susceptible to wave overtopping flows particularly near coasts wave overtopping when energetic storm waves run up and over a flood barrier structure may occur even at times when both the maximum wave heights and mean water levels are below the barrier crest height which often leads to inundation of the protected area reliable modeling of overtopping mechanisms requires an accurate description of the wind sea waves in addition to the storm surge however the modeling of wave overtopping in conjunction with storm surge inundation is not currently done in standard practice primarily due to the additional computational demand introduced by wave modeling thus some coastal areas not forecasted as susceptible to storm surge flooding may still be susceptible to flooding by waves this gap in skill emphasizes the intrinsic demand for an efficient modeling approach to forecast storm surge in conjunction with wave overtopping some research successfully applied the empirical wave overtopping formulas shown by the eurotop manual for guidance on wave overtopping of coastal structures eurotop 2016 by using results from the coupling of a finite element based shallow water equations swe model known as adcirc and a discrete spectral wave model known as swan dietrich et al 2012 to simulate wave overtopping flows observed during typhoons in korea lee and suh 2016 suh and kim 2018 the swan model is known to exhibit significant computational demand due to its detailed description of the wave field which provides more information than necessary for wave overtopping predictions on structures more recent research applied a chained modeling approach to simulate wave run up inundation of beaches in italy by a storm with a 2 years return period postacchini et al 2019 here results from three different models were used as inputs to one another with a 3d finite element hydrodynamic model coupled to a spectral wave model providing predictions of offshore sea states a phased averaged model in the form of an ocean circulation model roms coupled to a wave propagation model swan providing predictions of nearshore sea states and a phase resolving non linear swe model providing predictions of wave run up onshore this chained approach is demonstrated to be highly reliable however model set up is not straightforward due to the interaction between the three very different models and the individual models themselves may exhibit considerable computational demand in this study we pursue developing an approach specifically geared towards risk assessment for flood defense structures that is straightforward in model set up and that exhibits far less computational demand than the aforementioned approaches even if the description of the sea state is reduced spectral wave models provide a statistical description of the wind sea state and are more computationally efficient than phase resolving models though some spectral models still exhibit considerable computational demand e g swan booij et al 1999 spectral wave models typically may be classified as either parametric spectral models or discrete spectral models discrete spectral models such as swan frequently must compute many parameters for each gridpoint in the discretized computational domain owed to their discretizations of the so called action balance equation in both frequency space and direction a parametric wave model on the other hand assumes a generally valid form of the variance density spectrum and solves a coupled set of transport equations for a relatively small number of parameters at each grid point this results in a significant reduction in computational effort but at the cost of a reduced description of the wave field however the eurotop formulas only require minimal input on the state of the wind sea e g just significant wave heights and spectral wave periods therefore in this paper we propose a return to the parametric wave modeling approach to show that despite its deficiencies it presents an efficient approach towards the modeling of wave overtopping during forecasting of extreme weather events specifically we seek to couple finite element based swe and parametric wave models to evaluate their effective applications for modeling of wave overtopping wherein the swe component of the model resolves the mean sea level rise i e change in freeboard attributed to the storm surge near the barrier structure the overtopping flow rates over the structure and the subsequent inundation of protected areas while the wave component resolves significant wave heights and wave periods by including the current structure freeboard and current wave conditions reported by the coupled model as inputs into the eurotop empirical wave overtopping formulas wave overtopping flow rates over barrier structures may be prescribed in a similar way to that of weir type overtopping flow rates which are prescribed in the swe model based solely on a structure s crest height and the difference in mean water level on each side of the structure dawson et al 2011 we apply the discontinuous galerkin dg method as the finite element discretization for both the swe and wave components of the model in particular we couple two previously developed models that have been verified and validated independently the swe model dg swem has been verified for analytical test cases kubatko et al 2006 2009 and validated for storm surge propagation with respect to measurements as well as the well established swe model adcirc dawson et al 2011 the parametric dg wave model was previously verified against an empirical formula for fetch limited waves and was validated for hindcasts over lake erie with respect to buoy measurements and results from swan conroy et al 2018 motivations for applying the dg method include its ability to effectively handle numerical difficulties associated with wave propagation and the advective process that are frequently encountered during modeling of the swe kubatko et al 2006 additionally dg methods are locally conservative allow for the use of unstructured computational meshes and are amenable to dynamic mesh h and polynomial p refinement cockburn and shu 2001 in this paper we apply and validate this new coupled model with the goal of demonstrating that the parametric wave modeling approach is sufficient for modeling of wave overtopping flows despite its reduced description of the wave field as compared to discrete wave models and therefore that this approach presents a more computationally efficient means for generating predictions of wave overtopping risks we show that wave overtopping flow rates are resolved accurately for storm waves on simple barrier structures by comparison to a database of test cases with measurements steendam et al 2005 the proceeding sections of the manuscript are organized as follows section 2 details the formulations of the parametric wave model and the swe model as well as the nature of the coupling between the two models section 3 outlines the formulation of the dg discretization method this section also discusses the application of a sub grid scale approach and analytical and or empirical formulas for computing overtopping rates for barrier structures section 4 provides detail on the eurotop guidance and the empirical wave overtopping formulas section 5 presents numerical results and discusses comparisons of numerically simulated wave overtopping flow rates to measurements shown for test cases in the clash database steendam et al 2005 finally section 6 concludes the discussion and includes remarks on subjects for future work 2 mathematical formulation 2 1 wave momentum formulation where many wave models solve an energy balance equation more accurately termed an action balance equation in the presence of ambient current flows the model applied for this study chooses instead to solve a wave momentum balance equation of the form 1 m t t τ w ρ w g where m m x m y t is the wave momentum vector t is the wave momentum flux tensor τ w is the vector of wind stresses ρ w is the density of water and g is gravitational acceleration this formulation is based on work by donelan and schwab for the great lakes environmental research laboratory glerl modeling of wind wave generation in lake erie schwab et al 1984 the primary advantage of solving this momentum balance equation over an action balance equation is that this equation requires a source term as a function of only one variable the friction due to wind whereas an action balance equation requires a source term that is in general a function of atmospheric input nonlinear wave wave interactions and dissipation conroy et al 2018 following the work by schwab et al 1984 the assumption of equipartition of kinetic and potential energy in the wave field leads to 2 m x 0 0 2 π f f θ c p f c o s θ d θ d f 3 m y 0 0 2 π f f θ c p f s i n θ d θ d f where cp is the wave phase speed and f is the two dimensional wave spectrum in frequency f and direction θ space we relate the phase speed cp to the peak frequency fp by the linear deep water wave relation 4 c p g 2 π f p the components of the momentum flux tensor are written as 5 t x x 1 2 0 0 2 π f f θ c o s 2 θ d θ d f 6 t x y t y x 1 2 0 0 2 π f f θ s i n θ c o s θ d θ d f 7 t y y 1 2 0 0 2 π f f θ s i n 2 θ d θ d f continuing on we assume that the wave spectrum is completely separable in frequency and directional space i e f f θ e f d f θ where e f is the energy distribution in frequency typically given by the so called jonswap spectrum hasselmann et al 1973 and the directional distribution d f θ is given by 8 d f θ d θ s p c o s 2 θ θ 0 i f θ θ 0 π 2 0 o t h e r w i s e where sp is the so called spread parameter an empirical parameter that scales the directional distribution of waves about the mean wind direction and θ 0 t a n 1 m y m x is the mean wave direction for more details such as the form of wind drag used and how wave momentum is related to the significant wave height we refer to work by conroy et al 2018 2 2 shallow water formulation and coupling the wave model outlined in the previous subsection is coupled to a swe based hydro dynamic model in order to resolve the key hydrodynamics related to the wave overtopping phenomenon specifically the change of mean sea level near a barrier structure as a response to tides and or storm surge which corresponds to a change in freeboard for the structure the rates of overtopping flow over the barrier structure and the subsequent inundation and potential overland flows in the protected areas we apply the two dimensional swe consisting of the depth averaged continuity equation and the equations of horizontal momentum written in conservative form as 9 ζ t x h u y h v 0 10 t h u x h u 2 1 2 g h 2 h 2 y h u v g ζ h x h u τ f f x 11 t h v x h u v y h v 2 1 2 g h 2 h 2 g ζ h y h v τ f f y where ζ is the free surface elevation measured from the geoid h is the bathymetric depth measured from the geoid h ζ h is the total depth of the water column u and v are the horizontal depth averaged velocities in x and y directions respectively τf quantifies bottom friction manning s n friction and fx and fy correspond to additional source terms due to external forcings such as internal tides the coriolis force generally only applicable for large scale ocean basin simulations and not used in the wave flume tests in this study and wind stress garratt drag law for ease of discussion we restrict our focus here to cartesian space though for applications to large scale ocean basins such as for modeling of hurricane storm surge the computational domain is typically defined in terms of degrees longitude and latitude for such occasions the above equations are suitably transformed into spherical coordinates dawson et al 2011 to couple the swe component of our model with the wave component we write a system of equations based on observation that eqs 1 and 9 11 are all written in so called divergence form i e each equation takes the form 12 w i t f i w s i w for i 1 2 3 4 5 here wi is the ith component of the vector of conserved variables 13 w ζ h u h v m x m y t f i corresponds to the ith row of the so called flux function matrix wherein the columns of the matrix are the flux function vectors in either horizontal direction i e 14 f f x f y h u h v h u 2 1 2 g h 2 h 2 h u v h u v h v 2 1 2 g h 2 h 2 t x x t x y t y x t y y finally si is the ith component of the vector of source terms 15 s 0 g ζ h x h u τ f f x g ζ h y h v τ f f y τ x w ρ w g τ y w ρ w g t the entire system can then be written concisely as 16 w t f x x f y y s we note that this style of coupling does not actually pass any information between the wave momentum and mean water level momentum equations since the formulation of the wave model does not depend upon water levels or currents and since no forcing due to waves is provided to the swe e g in the form of radiation stresses and the current model disregards internal forces due to wave breaking and turbulence for now no consistent two way coupling exists that captures all first order effects in terms of the interactions between momentum and vorticity so determining the most appropriate means for establishing the connection between both types of momentum equations in our models is a task relegated to future work for this reason we also do not perform any validation of the coupled models here except for wave overtopping rates since we anticipate each model to retain the accuracy established by previous studies currently the only interaction between the models occurs at the locations of flood barriers where information from both is used to compute wave overtopping rates which then inform the cross barrier flux that occurs within the context of the swe the swe model may also inform the wave model of the presence of wetting and drying fronts wherein if a dry area becomes inundated according to the swe model then the wave model can be made aware of this change so that it will begin computing wave propagation in the newly wetted area of course this also works in reverse when the swe govern that a previously wetted area should become dried though it would be possible to use heterogeneous meshes for the spatial discretization in each model if wetting and drying fronts are present then this implies that each model should be solved on the same grid so that their wetting and drying fronts may be consistent without interpolation using homogenous meshes also implies that both models have the same uncertainty in the input wind field which significantly influences the uncertainty in predictions by both models both the wave model and the swe model are courant limited since each model uses explicit solutions see section 3 2 however the conditions on their stability are very different where the wave model is often stable for much larger time steps than the swe model especially when wetting and drying fronts are present whose propagation speeds directly limit the swe model the implication here is that a coupling interval between the two models may be established which may also correspond to the time step for the wave model for example in hindcast studies the swe model is typically stable for time steps on the order of one 1 second whereas the wave model is often stable for time steps on the order of ten 10 seconds for the same mesh resolution and input conditions the larger time step is used as the coupling interval where the swe model simply uses the wave conditions from the most recent coupling interval in its computation of cross barrier flow rates due to wave overtopping and the wave model is updated on changes in wetted versus dried elements at each coupling interval all the above discussion implies that the cost of this coupling is simply the cost of the swe model plus the cost of the wave model and the cost of computing wave overtopping rates of which the latter two are very low compared to the former this low cost coupling is the primary motivation for formulating this coupled model and we seek to demonstrate later section 5 that despite its simplicity its performance is sufficient for evaluation of wave overtopping risks 3 discontinuous galerkin method the swe model dg swem was formulated with a dg spatial discretization primarily motivated by the fact that dg methods are robust for modeling advective processes which typically dominate in storm surge flow for the wave model dg methods are simply a convenient choice since its mathematical structure allows it to be recast into a weak form that is advantageous for dg discretization this choice is also convenient in that it simplifies the set up for the coupled models since the same basis functions quadrature rules and time integration methods can be applied for the computations in each and this also implies that the same input files from dg swem can be used as inputs to the coupled models where the only changes are the addition of the coupling interval to the configuration file and perhaps the addition of more information on barrier structures to the mesh input file such as slope angles although the latter changes are required by the overtopping guidance and not the wave model itself other advantages offered by the dg method are that its stencil does not increase with the order of its spatial discretization only requiring information from immediately adjacent elements no matter the order chosen in contrast to most traditional finite volume methods boundary conditions are simple to enforce within the method s framework its local stencil makes the method highly scalable for parallel computing and its finite element structure allows for using unstructured meshes cockburn and shu 2001 3 1 numerical flux the dg method requires computing a so called numerical flux at element boundaries because the weak form permits discontinuities here for the numerical flux computation we handle the swe and the wind wave momentum flux components separately this approach is taken in interest of simplifying the computation as well as considering the vastly different mechanics at work in each component of the model begin by writing 17 f a t and w h c h m h where 18 a h u h v h u 2 1 2 g h 2 h 2 h u v h u v h v 2 1 2 g h 2 h 2 and t t x x t x y t y x t y y and where 19 c h ζ h h u h h v h t and m h m x h m y h t here the subscript h indicates a function of the dg polynomial space 20 v h m v v ω e p m ω e ω e t h where t h refers to the non overlapping finite element discretization of the domain ω r 2 and ω e refers to the domain of a given element e such that ω e t h the form of the numerical flux may be any consistent locally lipschitz conservative entropy flux dawson et al 2011 for the numerical flux of the swe component a we apply the local lax friedrichs llf flux as 21 a 1 2 a c h i n t n a c h e x t n λ c h i n t c h e x t where the superscript int indicates the value of a function along the boundary δω e taken as a limit approaching δω e from the interior of an element e and where ext indicates this value taken as a limit approaching from the exterior of this element also λ is an estimate for the largest eigenvalue of the jacobian of the flux a for the numerical flux of the wind wave component t we use a slightly modified form of the llf flux 22 t 1 2 t m h i n t n t m h e x t n λ m a x m h i n t m h e x t where λ m a x is the maximum wave speed of the system taken as the peak phase speed cp putting all of the numerical fluxes together we obtain the total numerical flux 23 f a t 3 2 semidiscrete dg equations altogether the dg spatial discretization reduces our problem to a system of ordinary differential equations odes which may be written concisely as 24 d w h d t l h w h where lh represents the so called dg spatial operator integrals are evaluated by quadrature rules of sufficiently high degree corresponding to the degree of dg space chosen then the system of odes shown above is discretized in time by explicit so called strong stability preserving ssp runge kutta rk methods of exactly one order higher than the degree of the dg spatial discretization for more details on either procedure refer to previous work by kubatko et al 2006 2007 3 3 boundary conditions and overtopping flows boundary conditions within the dg model are weakly enforced through the numerical flux by specifying the exterior values of solution variables along boundary edges such that the prescribed flux and or water surface elevation boundary conditions are achieved on these boundaries see previous work by kubatko et al 2006 and dawson et al 2011 some element boundaries may correspond to parts of internal barriers e g levees embankments and dikes these features are handled on the sub grid scale by aligning element edges with them and spacing the neighboring elements on either side of the barrier by the barrier s finite width for example see fig 1 the barrier is partitioned into segments by identifying pairs of edges of approximately equal lengths positioned across from one another where one side is arbitrarily specified as the front and the other as the back for each individual barrier segment values of the solution variables external to the barrier boundary are specified to enforce one of six types of flow based upon the height of the mean free surface elevation relative to the barrier crest height dawson et al 2011 and the non dimensional significant wave height h m0 rc where rc is the barrier freeboard case 1 on both sides of the barrier segment the mean free surface elevation is less than the barrier crest height and the non dimensional significant wave height h m0 rc is less than some specified tolerance close to but greater than zero here the barrier acts as a solid boundary where no flow may occur across it i e external variables are specified on each side such that no normal flow q n 0 is enforced case 2 the mean free surface elevation is greater than the barrier crest height and is the same on both sides of the barrier here there is no special treatment and water may flow freely over the barrier case 3 on the front side of the barrier the mean free surface elevation is greater than the barrier crest height as well as the free surface on the back side here overtopping flow occurs from the front of the barrier segment to the back flow may be either supercritical or subcritical depending upon how much greater the front elevation is than the back elevation the flow rates are prescribed by standard weir formula such as those shown by chow 1959 case 4 similar to case 3 but the mean free surface elevation is greater on the back side of the barrier so overtopping occurs from the back to the front again overtopping rates are prescribed based on weir formula case 5 the mean free surface elevation is less than the barrier crest height on both sides of the barrier but the non dimensional significant wave height h m0 rc is greater than some specified tolerance close to but greater than zero on the front side of the barrier and the wind blows from the front side to the back side this case is when wave overtopping may occur from the front of the barrier segment to the back and overflow rates are prescribed based upon the guidance provided by the eurotop manual eurotop 2016 see the next section for details on the wave overtopping guidance case 6 similar to case 6 but here h m0 rc is greater than the specified tolerance on the back side of the barrier and the wind blows from the back side to the front side here wave overtopping occurs from back to front and again overflow rates are prescribed based upon the eurotop guidance 4 wave overtopping discharge 4 1 sloped structures the eurotop manual eurotop 2016 guidance provides the general formulas for average wave overtopping discharge on a sloped structure e g dike levee embankment as 25 q g h m 0 3 0 023 tan α γ b ξ m 1 0 exp 2 7 r c ξ m 1 0 h m 0 γ b γ f γ β γ ν 1 3 26 with a maximum of q g h m 0 3 0 09 exp 1 5 r c h m 0 γ f γ β γ 1 3 where q is the average overtopping discharge per unit width m3 s m the eurotop formulas feature many more facets than typical weir overtopping formulas e g those from chow 1959 whereas weir overtopping flow rates are solely guided by the difference in mean water surface elevations at the front and back sides of the structure the eurotop guidance is based upon the structure s slope angle α and freeboard rc some statistical wave parameters as measured at the structure s toe the wave breaker parameter ξ m 1 0 and significant wave height h m0 and a number of influence factors γ described below γb influence factor for structure berm γf influence due to surface roughness on slope γβ influence of oblique wave attack γv influence of vertical wall atop slope γ combined influence of various possible geometrical features e g promenade storm wall with bullnose etc the eurotop manual provides detailed guidance for prescribing values for the various γ factors in specific applications this guidance typically entails the application of further empirically derived formulas or the retrieval of values from tabulated entries the introduction of the wave breaker parameter ξ m 1 0 also introduces dependence on a statistical aspect of the wave field that is known to be poorly modeled by our approach specifically the spectral wave period t m 1 0 m 1 m 0 we correct for this in our approach by using a different empirical relation here 4 2 wave breaker parameter the breaker parameter otherwise known as the surf similarity or iribarren number is written as 27 ξ m 1 0 tan α h m 0 l m 1 0 where 28 l m 1 0 g t m 1 0 2 2 π where l m 1 0 is the deep water wave length our wave model approximates the peak wave period tp and the eurotop guidance uses t p 1 1 t m 1 0 to relate peak wave period to the spectral wave period however previous authors have noted that the use of the jonswap spectrum in the parametric wave model tends to cause significant underestimation of wave periods due to over enhancement of the spectrum near the peak period schwab et al 1984 we instead use a relation for peak wave period based on the following rule of thumb for storm waves prescribed by dhi shoreline management guidelines mangor et al 2017 t p 5 3 h m 0 since the ultimate application goal for our wave model is the reliable approximation of wave overtopping caused by tropical storms and since the accuracies of the wave heights approximated by our model are well established we note that by using this relation we restrict the usefulness of our model to the regime of storm waves for computation of wave overtopping rates this relation also implies that the wave breaker parameter is characterized only by the structure s slope i e ξ m 1 0 tan α 2 42 π 28 09 g 4 3 vertical structures for vertical structures i e cot α 0 guidance for computing wave overtopping rates consists of several steps to determine which formula is most applicable given the surrounding sea state step 1 determine whether structure foreshore influences overtopping a shallow foreshore in front of a vertical wall can significantly affect overtopping rates by inducing shoaling and wave breaking the eurotop manual provides a practical definition of an influencing foreshore as shallow to intermediate depth water i e not deep water at the structure toe and a foreshore slope steeper than 1 50 where the foreshore is regarded as the bathymetry up to a distance of at least one wavelength from the structure toe and deep water is defined as h h m0 4 where h is the water depth at the toe eurotop 2016 for this study we regard only the relative depth at the structure toe to determine whether or not the foreshore influences overtopping rates if there is no foreshore influence then wave overtopping rates can be computed by 29 q g h m 0 3 0 047 exp 2 35 r c h m 0 1 3 otherwise proceed to step 2 we should note here that the guidance provided by eq 29 does not include dependence upon the wave period just the wave height so our model may be applied for conditions unlike storm waves in this case step 2 determine the possibility of impulsive wave overtopping conditions impulsive wave overtopping conditions occur when waves are large compared to the local water depths e g due to shoaling these waves violently break against the structure and the overtopping discharge is characterized by a violently up rushing jet on the other hand non impulsive wave overtopping conditions exert more smoothly varying loads and overtopping rates also are more gradual by the guidance of eurotop the following condition can be used to determine whether impulsive conditions are possible 30 h 2 h m 0 l m 1 0 0 23 if the above condition is not met then non impulsive wave conditions prevail and overtopping rates are computed by 31 q g h m 0 3 0 05 exp 2 78 r c h m 0 otherwise impulsive conditions are possible and we proceed onward to step 3 here we should note the similarity of the guidance provided by eq 31 to that provided by eq 29 however in this case we must still restrict our model to storm wave overtopping since the condition specified by inequality 30 depends upon the wave period through its dependence upon the wavelength see eq 28 step 3 determine whether relative freeboard is large or small eurotop defines the relative freeboard as rc h m0 and for very high relative freeboards significant overtopping may still be possible due to impulsive wave conditions in these cases the exponential decay form used in the formulas prescribed for overtopping guidance up until this point is not appropriate instead a power law formula is prescribed for this regime by the eurotop guidance a large relative freeboard occurs for rc h m0 1 35 and in this case overtopping rates are computed by 32 q g h m 0 3 0 0014 h m 0 h s m 1 0 0 5 r c h m 0 3 for a small relative freeboard i e 0 rc h m0 1 35 overtopping rates are computed by 33 q g h m 0 3 0 011 h m 0 h s m 1 0 0 5 exp 2 2 r c h m 0 in both cases the wave steepness s m 1 0 h m 0 l m 1 0 enters into the guidance we note that our earlier assumption of storm wave periods by the dhi rule of thumb t p 5 3 h m 0 implies a constant wave steepness s m 1 0 0 0276 this wave steepness lies somewhere between the steepness of swell s m 1 0 0 01 and the steepness of wind waves s m 1 0 0 06 we also note that in our above discussion of the steps for determining wave overtopping rates for vertical structures we skip a step from the eurotop guidance which concerns the treatment of composite vertical structures in other words vertical structures with a rubble mound or similar structure placed at the toe we exclude this step here for the sake of brevity in the current discussion interested readers may refer to ch 7 in the eurotop manual for details eurotop 2016 as well as because we do not include any such cases in our validation studies in the proceeding section primarily because these types of structures tend to be poorly represented in the database of measurements we refer to i e clash 5 results the test cases for this study are derived from those shown by the database produced by the eu project known as clash crest level assessment of coastal structures by full scale monitoring neural network prediction and hazard analysis on permissible wave overtopping the clash database provides measurements and approximations for over 10 000 wave overtopping cases some of which are from prototype measurements on full scale structures while most results are for model tests performed in wave flumes or wave basins the clash database reduces its description of the test cases to a total of 31 parameters three 3 general parameters 11 hydraulic parameters and 17 structural parameters steendam et al 2005 van der meer et al 2009 relevant hydraulic parameters include significant wave heights h m0 peak wave periods tp and spectral wave periods t m 1 0 measured at deep water as well as at the structure toe angle of wave attack β and the mean wave overtopping discharge measured per second per meter width q relevant structural parameters include crest freeboard rc slope armor crest freeboard ac berm width b if one exists water depth at structure toe h structure roughness permeability factor γf and cotangent of the slope angle cot α or slope angles in the case of composite slope or berm structures cot α d cot α u see fig 2 for an illustration of some of these parameters the general parameters include two parameters that are useful for assessing the database s capacity for accurately describing each test case the reliability factor rf and the complexity factor cf both the rf and cf range as integer values from 1 to 4 when rf is equal to 1 this value indicates that all measurements for that test case are reliable and any value of rf greater than 1 indicates that either uncertainty exists in the measurements or some approximations and or calculations had to be made for one or more parameters rf greater than 2 indicates a greater degree of uncertainty or less confidence in the existing approximations see hadewych 2003 for more details likewise cf indicates how well the structural parameters describe the physical structure geometry of the barrier section with cf equals 1 indicating almost perfect correspondence and cf of any value greater than 1 indicating some complexity that is not fully described by the 17 structural parameters again see hadewych 2003 for more details to account for the volume of the clash database as well as to simplify our analysis we apply filters based upon a number of the aforementioned parameters first we filter for rf and cf both equal to 1 since we desire both reliable measurements rf 1 and well represented geometries cf 1 for validation of our model next we filter for directly impinging wave fronts β 0 and smooth single sloped or otherwise completely vertical structures γ f 1 cot α d cot α u and b 0 finally since we restrict the wave overtopping capability of our coupled dg models to that from storm waves by using the relation t p 5 3 h m 0 see section 4 we also filter test cases in clash based upon their agreement with this relation the dhi shoreline management guidelines mangor et al 2017 prescribe this relationship as a rule of thumb so we set a wide tolerance of within 10 of this relationship to consider the test case as featuring storm waves we apply a filter based upon a 10 relative error between tp and 5 3 h m 0 as reported by the clash database except for the specific cases with vertical wall structures where the parameter tp does not influence wave overtopping rates i e regimes where the overtopping is described by eq 29 after applying these filters we obtain 207 candidate test cases for our validation study for validating these test cases we discretize a computational domain that is akin to a large scale wave flume as shown in a plan view in fig 3 the domain is discretized by 216 two dimensional triangular elements built from a mesh of 134 nodes the entire domain is prescribed a uniform depth corresponding to h which is adjusted corresponding to the value reported in the clash database for each test case and wind forcing is applied only on the wave flume 42 500 m 7500 m the magnitude of the wind forcing is uniform over the entire expanse of the flume blowing from left to right directly towards the flood barrier boundary the forcing is adjusted until the significant wave height h m0 from clash is obtained at the toe of the barrier structure i e at x 42 500 m in the domain space in this process we actually look to match the deep water value shown by the clash database since our wave model operates on many deep water based assumptions of course this means that our model disregards any foreshore effects that occur between the deep water and the structure toe so in cases where h m0 reported at the structure toe differs significantly from h m0 in deep water we can expect our model to produce less accurate results which is a phenomenon we observe also note that this approach requires turning off the wind stress source terms for the swe component of the model in order to avoid water piling up at the flood barrier once the prescribed h m0 is obtained we measure the wave overtopping by recording the change in the water surface elevation within the overtopping basin 2500 m 7500 m over time by computing the change in volume within the basin we obtain a measurement of the mean wave overtopping discharge q computed by the model which we compare to the measured discharge in clash for our validation studies we apply a time step of one 1 second for both models which also implies that the coupling interval here is at every time step we demonstrate the results of this comparison for all 207 test cases in a series of figures all results are with first degree dg discretizations and second order rk time stepping a regression plot for measured versus modeled overtopping rates is shown in fig 4 here we note that the slope of the regression line is rather low at 0 784 and we also note that the correlation does not seem good r 2 0 5241 however we can identify a number of cases that appear to be outliers which can be seen from observing the errors in the model overtopping rates see fig 5 since we anticipate a considerable degree of spread in the model error due to the simplifying assumptions made within e g those made by the parametric wave model and the use of dhi guidelines for computing wave periods from wave heights we define the outlier cases as any cases which deviate more than ten 10 interquartile ranges from the upper and lower quartiles from this analysis we identify 18 total outlier cases and we investigate these cases further to determine why the model performance is especially bad there by discounting these outliers we obtain a much improved regression line where the slope is 0 9911 and the correlation is very good with r 2 0 9584 fig 6 for all of the outlier cases where the model excessively underestimates the overtopping rates i e the three 3 cases below the bottom dashed line in fig 5 we may notice some similarities in all of these cases h m0 rc or h m0 rc we may also see that the overtopping rates provided by the eurotop guidance itself q eurotop are not reliable where in one case 103 112 the eurotop guidance exceeds the measured value by roughly 30 see table 1 agreement between the eurotop guidance and our model s guidance does not appear to be reliable here either since for the aforementioned case the model significantly underestimates the overtopping rate by roughly 45 this analysis suggests that within this regime where h m0 rc the eurotop guidance may exhibit some significant degree of uncertainty the cases for which the model produces excessively overestimated overtopping rates i e the 15 cases above the upper dashed line in fig 5 also share a common thread in that all of these cases report significantly reduced significant wave heights at the structure toe relative to those at deep water as shown by fig 7 the relative reductions in wave height range from roughly 54 to roughly 23 since our model uses the deep water h m0 for computing overtopping rates and since the deep water h m0 is greater than that at the toe for all of these cases our model computes overtopping rates that are far too high these are cases in which we anticipate our model to perform poorly without the introduction of further approximations in order to account for the foreshore effects that cause h m0 to decrease between the deep water and structure toe therefore since we have yet to introduce such approximations into the model we should discount theses cases in our current model validation the authors consider the above analysis as a fitting validation of the mean behavior of the proposed model since the model agrees well with measurements for more than 90 of the 207 overtopping test cases considered here the only existing caveats are that different approximations may need to be pursued for cases wherein significant wave heights are near to or greater than the crest freeboard as well as for cases wherein foreshore effects cause the significant wave height to differ significantly at the structure toe from that at deep water despite these caveats the successful validation of the model for these cases motivates further studies validating this approach for more realistic test cases 6 conclusion this study resulted in an effective validation of the mean behavior of a physical modeling framework applied to simulating the overtopping of coastal flood barrier structures by storm waves the modeling framework is based upon a loosely coupled swe and parametric spectral wave model the model uses dg finite element discretizations resulting in a model that is amenable to unstructured grids and local polynomial and mesh refinement we validate the model by comparing numerical wave overtopping discharge rates to measurements recorded in the clash database steendam et al 2005 van der meer et al 2009 for test cases featuring storm waves overtopping smooth single sloped or vertical structures discharge rates due to wave overtopping are computed using the guidance of the eurotop manual eurotop 2016 and the definition of storm waves is derived from a rule of thumb prescribed by dhi shoreline management guidelines mangor et al 2017 that relates the peak wave period tp to the significant wave height h m0 we demonstrate that the model performs remarkably well on average for resolving wave overtopping on simple structures although after sorting for outliers where either the eurotop guidance exhibits significant uncertainty for example when h m0 rc or where neglecting foreshore effects in our wave model causes overestimates of significant wave heights at the structure toe however we also show that such outlier cases are relatively few in number whereby we demonstrate very good results by linear regression using more than 90 of the test cases considered slope 0 9911 r 2 0 9584 this result is highly motivating towards further development of this model for application to full scale storm events since the wave component of this model is known to be far more efficient than more commonly used discrete spectral third generation wave models conroy et al 2018 meaning that further development could result in a reliable and more efficient means for probabilistic assessment of wave overtopping risks however there are several more avenues for future work that should be pursued before this overarching goal may be realized the most immediate future work would be validating the model for using it with other aspects of the eurotop guidance such as those shown for oblique wave attacks slope roughnesses and composite structures we should also introduce some approximations that account for changes in wave heights between the deep water and the structure toe due to foreshore effects the current model also disregards internal forces due to wave breaking and turbulence so including these forces could improve results also the parametric wave model used here was developed with many empiricisms intended to be applicable towards large lake bodies specifically the us great lakes so the model will require some reworking to be fully applicable to coastal ocean settings this wave model also currently does not account for the presence of swell which may be a significant contribution to the wave field in the case of a large scale storm in an ocean basin so swell should be implemented into the wave model work on the latter two topics is currently underway finally work should be done to determine an appropriate means for two way coupling between the wave momentum and mean water level momentum equations so that the swe component and wave component of the coupled model may better inform one another at locations other than internal barrier boundaries credit authorship contribution statement dylan wood conceptualization methodology software investigation writing original draft ethan j kubatko writing review editing supervision methodology software mehrzad rahimi writing review editing abdollah shafieezadeh writing review editing supervision project administration funding acquisition colton j conroy methodology software declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment the authors acknowledge support by national science foundation grant cmmi 1563372 we also acknowledge that the high performance computing resources used to conduct this research were provided by the ohio supercomputer center ohio supercomputer 1987 supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 103501 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
536,in coastal regions accurate prediction of the inundation risks posed by tropical cyclones and other severe weather is key to mitigating disaster impacts predictions of these risks are often provided by numerical models however these models also frequently do not consider inundation due to wind sea wave run up neglecting such effects may be misleading for evaluating the risks posed to areas protected by flood defense systems such as levees and dykes to effectively evaluate the flooding risks posed by storm waves accurate wind sea modeling should be undertaken in parallel with storm surge modeling and accurate wave overtopping flow rates at flood barriers must be prescribed based on the modeled sea conditions and structure geometries to this end we present development of a loosely coupled finite element based shallow water equations and parametric spectral wave model wave overtopping flow rates are computed by formulas provided in the guidance of the eurotop manual we demonstrate that the parametric spectral wave modeling approach is sufficiently accurate for modeling of wave overtopping events despite its simplifying assumptions such as those based on deep water e g discounting foreshore effects such as wave shoaling and breaking and disregarding internal forces due to wave breaking and turbulence as opposed to more commonly used discrete third generation spectral wave models which provide more detailed descriptions of wave fields but are much more computationally expensive comparisons of numerically modeled wave overtopping flow rates with measurements from the clash database show good agreement by linear regression slope 0 9911 r 2 0 9584 for more than 90 of the test cases considered where for the relatively few outlier cases the model performs poorly due to either uncertainties in the eurotop guidance or the lack of foreshore effects in the wave model keywords discontinuous galerkin methods shallow water equations wind driven water waves wave overtopping flood control 1 introduction tropical weather systems frequently generate hazardous seas due to strong winds as these systems approach the shore they pose risks to coastal communities and infrastructure and the failure of flood defense structures such as levees embankments and dikes can cause catastrophic loss emergency managers require comprehensive and reliable predictions of the extent of the risks posed to coastal areas during the threat of an impending tropical weather event to this end computational models are frequently applied to forecast these risks models for storm surge often contain features for modeling flood barrier overtopping during instances in which the mean water level on either side of a barrier exceeds that structure s crest height westerink et al 2001 dawson et al 2011 however many flood defense structures may be more commonly susceptible to wave overtopping flows particularly near coasts wave overtopping when energetic storm waves run up and over a flood barrier structure may occur even at times when both the maximum wave heights and mean water levels are below the barrier crest height which often leads to inundation of the protected area reliable modeling of overtopping mechanisms requires an accurate description of the wind sea waves in addition to the storm surge however the modeling of wave overtopping in conjunction with storm surge inundation is not currently done in standard practice primarily due to the additional computational demand introduced by wave modeling thus some coastal areas not forecasted as susceptible to storm surge flooding may still be susceptible to flooding by waves this gap in skill emphasizes the intrinsic demand for an efficient modeling approach to forecast storm surge in conjunction with wave overtopping some research successfully applied the empirical wave overtopping formulas shown by the eurotop manual for guidance on wave overtopping of coastal structures eurotop 2016 by using results from the coupling of a finite element based shallow water equations swe model known as adcirc and a discrete spectral wave model known as swan dietrich et al 2012 to simulate wave overtopping flows observed during typhoons in korea lee and suh 2016 suh and kim 2018 the swan model is known to exhibit significant computational demand due to its detailed description of the wave field which provides more information than necessary for wave overtopping predictions on structures more recent research applied a chained modeling approach to simulate wave run up inundation of beaches in italy by a storm with a 2 years return period postacchini et al 2019 here results from three different models were used as inputs to one another with a 3d finite element hydrodynamic model coupled to a spectral wave model providing predictions of offshore sea states a phased averaged model in the form of an ocean circulation model roms coupled to a wave propagation model swan providing predictions of nearshore sea states and a phase resolving non linear swe model providing predictions of wave run up onshore this chained approach is demonstrated to be highly reliable however model set up is not straightforward due to the interaction between the three very different models and the individual models themselves may exhibit considerable computational demand in this study we pursue developing an approach specifically geared towards risk assessment for flood defense structures that is straightforward in model set up and that exhibits far less computational demand than the aforementioned approaches even if the description of the sea state is reduced spectral wave models provide a statistical description of the wind sea state and are more computationally efficient than phase resolving models though some spectral models still exhibit considerable computational demand e g swan booij et al 1999 spectral wave models typically may be classified as either parametric spectral models or discrete spectral models discrete spectral models such as swan frequently must compute many parameters for each gridpoint in the discretized computational domain owed to their discretizations of the so called action balance equation in both frequency space and direction a parametric wave model on the other hand assumes a generally valid form of the variance density spectrum and solves a coupled set of transport equations for a relatively small number of parameters at each grid point this results in a significant reduction in computational effort but at the cost of a reduced description of the wave field however the eurotop formulas only require minimal input on the state of the wind sea e g just significant wave heights and spectral wave periods therefore in this paper we propose a return to the parametric wave modeling approach to show that despite its deficiencies it presents an efficient approach towards the modeling of wave overtopping during forecasting of extreme weather events specifically we seek to couple finite element based swe and parametric wave models to evaluate their effective applications for modeling of wave overtopping wherein the swe component of the model resolves the mean sea level rise i e change in freeboard attributed to the storm surge near the barrier structure the overtopping flow rates over the structure and the subsequent inundation of protected areas while the wave component resolves significant wave heights and wave periods by including the current structure freeboard and current wave conditions reported by the coupled model as inputs into the eurotop empirical wave overtopping formulas wave overtopping flow rates over barrier structures may be prescribed in a similar way to that of weir type overtopping flow rates which are prescribed in the swe model based solely on a structure s crest height and the difference in mean water level on each side of the structure dawson et al 2011 we apply the discontinuous galerkin dg method as the finite element discretization for both the swe and wave components of the model in particular we couple two previously developed models that have been verified and validated independently the swe model dg swem has been verified for analytical test cases kubatko et al 2006 2009 and validated for storm surge propagation with respect to measurements as well as the well established swe model adcirc dawson et al 2011 the parametric dg wave model was previously verified against an empirical formula for fetch limited waves and was validated for hindcasts over lake erie with respect to buoy measurements and results from swan conroy et al 2018 motivations for applying the dg method include its ability to effectively handle numerical difficulties associated with wave propagation and the advective process that are frequently encountered during modeling of the swe kubatko et al 2006 additionally dg methods are locally conservative allow for the use of unstructured computational meshes and are amenable to dynamic mesh h and polynomial p refinement cockburn and shu 2001 in this paper we apply and validate this new coupled model with the goal of demonstrating that the parametric wave modeling approach is sufficient for modeling of wave overtopping flows despite its reduced description of the wave field as compared to discrete wave models and therefore that this approach presents a more computationally efficient means for generating predictions of wave overtopping risks we show that wave overtopping flow rates are resolved accurately for storm waves on simple barrier structures by comparison to a database of test cases with measurements steendam et al 2005 the proceeding sections of the manuscript are organized as follows section 2 details the formulations of the parametric wave model and the swe model as well as the nature of the coupling between the two models section 3 outlines the formulation of the dg discretization method this section also discusses the application of a sub grid scale approach and analytical and or empirical formulas for computing overtopping rates for barrier structures section 4 provides detail on the eurotop guidance and the empirical wave overtopping formulas section 5 presents numerical results and discusses comparisons of numerically simulated wave overtopping flow rates to measurements shown for test cases in the clash database steendam et al 2005 finally section 6 concludes the discussion and includes remarks on subjects for future work 2 mathematical formulation 2 1 wave momentum formulation where many wave models solve an energy balance equation more accurately termed an action balance equation in the presence of ambient current flows the model applied for this study chooses instead to solve a wave momentum balance equation of the form 1 m t t τ w ρ w g where m m x m y t is the wave momentum vector t is the wave momentum flux tensor τ w is the vector of wind stresses ρ w is the density of water and g is gravitational acceleration this formulation is based on work by donelan and schwab for the great lakes environmental research laboratory glerl modeling of wind wave generation in lake erie schwab et al 1984 the primary advantage of solving this momentum balance equation over an action balance equation is that this equation requires a source term as a function of only one variable the friction due to wind whereas an action balance equation requires a source term that is in general a function of atmospheric input nonlinear wave wave interactions and dissipation conroy et al 2018 following the work by schwab et al 1984 the assumption of equipartition of kinetic and potential energy in the wave field leads to 2 m x 0 0 2 π f f θ c p f c o s θ d θ d f 3 m y 0 0 2 π f f θ c p f s i n θ d θ d f where cp is the wave phase speed and f is the two dimensional wave spectrum in frequency f and direction θ space we relate the phase speed cp to the peak frequency fp by the linear deep water wave relation 4 c p g 2 π f p the components of the momentum flux tensor are written as 5 t x x 1 2 0 0 2 π f f θ c o s 2 θ d θ d f 6 t x y t y x 1 2 0 0 2 π f f θ s i n θ c o s θ d θ d f 7 t y y 1 2 0 0 2 π f f θ s i n 2 θ d θ d f continuing on we assume that the wave spectrum is completely separable in frequency and directional space i e f f θ e f d f θ where e f is the energy distribution in frequency typically given by the so called jonswap spectrum hasselmann et al 1973 and the directional distribution d f θ is given by 8 d f θ d θ s p c o s 2 θ θ 0 i f θ θ 0 π 2 0 o t h e r w i s e where sp is the so called spread parameter an empirical parameter that scales the directional distribution of waves about the mean wind direction and θ 0 t a n 1 m y m x is the mean wave direction for more details such as the form of wind drag used and how wave momentum is related to the significant wave height we refer to work by conroy et al 2018 2 2 shallow water formulation and coupling the wave model outlined in the previous subsection is coupled to a swe based hydro dynamic model in order to resolve the key hydrodynamics related to the wave overtopping phenomenon specifically the change of mean sea level near a barrier structure as a response to tides and or storm surge which corresponds to a change in freeboard for the structure the rates of overtopping flow over the barrier structure and the subsequent inundation and potential overland flows in the protected areas we apply the two dimensional swe consisting of the depth averaged continuity equation and the equations of horizontal momentum written in conservative form as 9 ζ t x h u y h v 0 10 t h u x h u 2 1 2 g h 2 h 2 y h u v g ζ h x h u τ f f x 11 t h v x h u v y h v 2 1 2 g h 2 h 2 g ζ h y h v τ f f y where ζ is the free surface elevation measured from the geoid h is the bathymetric depth measured from the geoid h ζ h is the total depth of the water column u and v are the horizontal depth averaged velocities in x and y directions respectively τf quantifies bottom friction manning s n friction and fx and fy correspond to additional source terms due to external forcings such as internal tides the coriolis force generally only applicable for large scale ocean basin simulations and not used in the wave flume tests in this study and wind stress garratt drag law for ease of discussion we restrict our focus here to cartesian space though for applications to large scale ocean basins such as for modeling of hurricane storm surge the computational domain is typically defined in terms of degrees longitude and latitude for such occasions the above equations are suitably transformed into spherical coordinates dawson et al 2011 to couple the swe component of our model with the wave component we write a system of equations based on observation that eqs 1 and 9 11 are all written in so called divergence form i e each equation takes the form 12 w i t f i w s i w for i 1 2 3 4 5 here wi is the ith component of the vector of conserved variables 13 w ζ h u h v m x m y t f i corresponds to the ith row of the so called flux function matrix wherein the columns of the matrix are the flux function vectors in either horizontal direction i e 14 f f x f y h u h v h u 2 1 2 g h 2 h 2 h u v h u v h v 2 1 2 g h 2 h 2 t x x t x y t y x t y y finally si is the ith component of the vector of source terms 15 s 0 g ζ h x h u τ f f x g ζ h y h v τ f f y τ x w ρ w g τ y w ρ w g t the entire system can then be written concisely as 16 w t f x x f y y s we note that this style of coupling does not actually pass any information between the wave momentum and mean water level momentum equations since the formulation of the wave model does not depend upon water levels or currents and since no forcing due to waves is provided to the swe e g in the form of radiation stresses and the current model disregards internal forces due to wave breaking and turbulence for now no consistent two way coupling exists that captures all first order effects in terms of the interactions between momentum and vorticity so determining the most appropriate means for establishing the connection between both types of momentum equations in our models is a task relegated to future work for this reason we also do not perform any validation of the coupled models here except for wave overtopping rates since we anticipate each model to retain the accuracy established by previous studies currently the only interaction between the models occurs at the locations of flood barriers where information from both is used to compute wave overtopping rates which then inform the cross barrier flux that occurs within the context of the swe the swe model may also inform the wave model of the presence of wetting and drying fronts wherein if a dry area becomes inundated according to the swe model then the wave model can be made aware of this change so that it will begin computing wave propagation in the newly wetted area of course this also works in reverse when the swe govern that a previously wetted area should become dried though it would be possible to use heterogeneous meshes for the spatial discretization in each model if wetting and drying fronts are present then this implies that each model should be solved on the same grid so that their wetting and drying fronts may be consistent without interpolation using homogenous meshes also implies that both models have the same uncertainty in the input wind field which significantly influences the uncertainty in predictions by both models both the wave model and the swe model are courant limited since each model uses explicit solutions see section 3 2 however the conditions on their stability are very different where the wave model is often stable for much larger time steps than the swe model especially when wetting and drying fronts are present whose propagation speeds directly limit the swe model the implication here is that a coupling interval between the two models may be established which may also correspond to the time step for the wave model for example in hindcast studies the swe model is typically stable for time steps on the order of one 1 second whereas the wave model is often stable for time steps on the order of ten 10 seconds for the same mesh resolution and input conditions the larger time step is used as the coupling interval where the swe model simply uses the wave conditions from the most recent coupling interval in its computation of cross barrier flow rates due to wave overtopping and the wave model is updated on changes in wetted versus dried elements at each coupling interval all the above discussion implies that the cost of this coupling is simply the cost of the swe model plus the cost of the wave model and the cost of computing wave overtopping rates of which the latter two are very low compared to the former this low cost coupling is the primary motivation for formulating this coupled model and we seek to demonstrate later section 5 that despite its simplicity its performance is sufficient for evaluation of wave overtopping risks 3 discontinuous galerkin method the swe model dg swem was formulated with a dg spatial discretization primarily motivated by the fact that dg methods are robust for modeling advective processes which typically dominate in storm surge flow for the wave model dg methods are simply a convenient choice since its mathematical structure allows it to be recast into a weak form that is advantageous for dg discretization this choice is also convenient in that it simplifies the set up for the coupled models since the same basis functions quadrature rules and time integration methods can be applied for the computations in each and this also implies that the same input files from dg swem can be used as inputs to the coupled models where the only changes are the addition of the coupling interval to the configuration file and perhaps the addition of more information on barrier structures to the mesh input file such as slope angles although the latter changes are required by the overtopping guidance and not the wave model itself other advantages offered by the dg method are that its stencil does not increase with the order of its spatial discretization only requiring information from immediately adjacent elements no matter the order chosen in contrast to most traditional finite volume methods boundary conditions are simple to enforce within the method s framework its local stencil makes the method highly scalable for parallel computing and its finite element structure allows for using unstructured meshes cockburn and shu 2001 3 1 numerical flux the dg method requires computing a so called numerical flux at element boundaries because the weak form permits discontinuities here for the numerical flux computation we handle the swe and the wind wave momentum flux components separately this approach is taken in interest of simplifying the computation as well as considering the vastly different mechanics at work in each component of the model begin by writing 17 f a t and w h c h m h where 18 a h u h v h u 2 1 2 g h 2 h 2 h u v h u v h v 2 1 2 g h 2 h 2 and t t x x t x y t y x t y y and where 19 c h ζ h h u h h v h t and m h m x h m y h t here the subscript h indicates a function of the dg polynomial space 20 v h m v v ω e p m ω e ω e t h where t h refers to the non overlapping finite element discretization of the domain ω r 2 and ω e refers to the domain of a given element e such that ω e t h the form of the numerical flux may be any consistent locally lipschitz conservative entropy flux dawson et al 2011 for the numerical flux of the swe component a we apply the local lax friedrichs llf flux as 21 a 1 2 a c h i n t n a c h e x t n λ c h i n t c h e x t where the superscript int indicates the value of a function along the boundary δω e taken as a limit approaching δω e from the interior of an element e and where ext indicates this value taken as a limit approaching from the exterior of this element also λ is an estimate for the largest eigenvalue of the jacobian of the flux a for the numerical flux of the wind wave component t we use a slightly modified form of the llf flux 22 t 1 2 t m h i n t n t m h e x t n λ m a x m h i n t m h e x t where λ m a x is the maximum wave speed of the system taken as the peak phase speed cp putting all of the numerical fluxes together we obtain the total numerical flux 23 f a t 3 2 semidiscrete dg equations altogether the dg spatial discretization reduces our problem to a system of ordinary differential equations odes which may be written concisely as 24 d w h d t l h w h where lh represents the so called dg spatial operator integrals are evaluated by quadrature rules of sufficiently high degree corresponding to the degree of dg space chosen then the system of odes shown above is discretized in time by explicit so called strong stability preserving ssp runge kutta rk methods of exactly one order higher than the degree of the dg spatial discretization for more details on either procedure refer to previous work by kubatko et al 2006 2007 3 3 boundary conditions and overtopping flows boundary conditions within the dg model are weakly enforced through the numerical flux by specifying the exterior values of solution variables along boundary edges such that the prescribed flux and or water surface elevation boundary conditions are achieved on these boundaries see previous work by kubatko et al 2006 and dawson et al 2011 some element boundaries may correspond to parts of internal barriers e g levees embankments and dikes these features are handled on the sub grid scale by aligning element edges with them and spacing the neighboring elements on either side of the barrier by the barrier s finite width for example see fig 1 the barrier is partitioned into segments by identifying pairs of edges of approximately equal lengths positioned across from one another where one side is arbitrarily specified as the front and the other as the back for each individual barrier segment values of the solution variables external to the barrier boundary are specified to enforce one of six types of flow based upon the height of the mean free surface elevation relative to the barrier crest height dawson et al 2011 and the non dimensional significant wave height h m0 rc where rc is the barrier freeboard case 1 on both sides of the barrier segment the mean free surface elevation is less than the barrier crest height and the non dimensional significant wave height h m0 rc is less than some specified tolerance close to but greater than zero here the barrier acts as a solid boundary where no flow may occur across it i e external variables are specified on each side such that no normal flow q n 0 is enforced case 2 the mean free surface elevation is greater than the barrier crest height and is the same on both sides of the barrier here there is no special treatment and water may flow freely over the barrier case 3 on the front side of the barrier the mean free surface elevation is greater than the barrier crest height as well as the free surface on the back side here overtopping flow occurs from the front of the barrier segment to the back flow may be either supercritical or subcritical depending upon how much greater the front elevation is than the back elevation the flow rates are prescribed by standard weir formula such as those shown by chow 1959 case 4 similar to case 3 but the mean free surface elevation is greater on the back side of the barrier so overtopping occurs from the back to the front again overtopping rates are prescribed based on weir formula case 5 the mean free surface elevation is less than the barrier crest height on both sides of the barrier but the non dimensional significant wave height h m0 rc is greater than some specified tolerance close to but greater than zero on the front side of the barrier and the wind blows from the front side to the back side this case is when wave overtopping may occur from the front of the barrier segment to the back and overflow rates are prescribed based upon the guidance provided by the eurotop manual eurotop 2016 see the next section for details on the wave overtopping guidance case 6 similar to case 6 but here h m0 rc is greater than the specified tolerance on the back side of the barrier and the wind blows from the back side to the front side here wave overtopping occurs from back to front and again overflow rates are prescribed based upon the eurotop guidance 4 wave overtopping discharge 4 1 sloped structures the eurotop manual eurotop 2016 guidance provides the general formulas for average wave overtopping discharge on a sloped structure e g dike levee embankment as 25 q g h m 0 3 0 023 tan α γ b ξ m 1 0 exp 2 7 r c ξ m 1 0 h m 0 γ b γ f γ β γ ν 1 3 26 with a maximum of q g h m 0 3 0 09 exp 1 5 r c h m 0 γ f γ β γ 1 3 where q is the average overtopping discharge per unit width m3 s m the eurotop formulas feature many more facets than typical weir overtopping formulas e g those from chow 1959 whereas weir overtopping flow rates are solely guided by the difference in mean water surface elevations at the front and back sides of the structure the eurotop guidance is based upon the structure s slope angle α and freeboard rc some statistical wave parameters as measured at the structure s toe the wave breaker parameter ξ m 1 0 and significant wave height h m0 and a number of influence factors γ described below γb influence factor for structure berm γf influence due to surface roughness on slope γβ influence of oblique wave attack γv influence of vertical wall atop slope γ combined influence of various possible geometrical features e g promenade storm wall with bullnose etc the eurotop manual provides detailed guidance for prescribing values for the various γ factors in specific applications this guidance typically entails the application of further empirically derived formulas or the retrieval of values from tabulated entries the introduction of the wave breaker parameter ξ m 1 0 also introduces dependence on a statistical aspect of the wave field that is known to be poorly modeled by our approach specifically the spectral wave period t m 1 0 m 1 m 0 we correct for this in our approach by using a different empirical relation here 4 2 wave breaker parameter the breaker parameter otherwise known as the surf similarity or iribarren number is written as 27 ξ m 1 0 tan α h m 0 l m 1 0 where 28 l m 1 0 g t m 1 0 2 2 π where l m 1 0 is the deep water wave length our wave model approximates the peak wave period tp and the eurotop guidance uses t p 1 1 t m 1 0 to relate peak wave period to the spectral wave period however previous authors have noted that the use of the jonswap spectrum in the parametric wave model tends to cause significant underestimation of wave periods due to over enhancement of the spectrum near the peak period schwab et al 1984 we instead use a relation for peak wave period based on the following rule of thumb for storm waves prescribed by dhi shoreline management guidelines mangor et al 2017 t p 5 3 h m 0 since the ultimate application goal for our wave model is the reliable approximation of wave overtopping caused by tropical storms and since the accuracies of the wave heights approximated by our model are well established we note that by using this relation we restrict the usefulness of our model to the regime of storm waves for computation of wave overtopping rates this relation also implies that the wave breaker parameter is characterized only by the structure s slope i e ξ m 1 0 tan α 2 42 π 28 09 g 4 3 vertical structures for vertical structures i e cot α 0 guidance for computing wave overtopping rates consists of several steps to determine which formula is most applicable given the surrounding sea state step 1 determine whether structure foreshore influences overtopping a shallow foreshore in front of a vertical wall can significantly affect overtopping rates by inducing shoaling and wave breaking the eurotop manual provides a practical definition of an influencing foreshore as shallow to intermediate depth water i e not deep water at the structure toe and a foreshore slope steeper than 1 50 where the foreshore is regarded as the bathymetry up to a distance of at least one wavelength from the structure toe and deep water is defined as h h m0 4 where h is the water depth at the toe eurotop 2016 for this study we regard only the relative depth at the structure toe to determine whether or not the foreshore influences overtopping rates if there is no foreshore influence then wave overtopping rates can be computed by 29 q g h m 0 3 0 047 exp 2 35 r c h m 0 1 3 otherwise proceed to step 2 we should note here that the guidance provided by eq 29 does not include dependence upon the wave period just the wave height so our model may be applied for conditions unlike storm waves in this case step 2 determine the possibility of impulsive wave overtopping conditions impulsive wave overtopping conditions occur when waves are large compared to the local water depths e g due to shoaling these waves violently break against the structure and the overtopping discharge is characterized by a violently up rushing jet on the other hand non impulsive wave overtopping conditions exert more smoothly varying loads and overtopping rates also are more gradual by the guidance of eurotop the following condition can be used to determine whether impulsive conditions are possible 30 h 2 h m 0 l m 1 0 0 23 if the above condition is not met then non impulsive wave conditions prevail and overtopping rates are computed by 31 q g h m 0 3 0 05 exp 2 78 r c h m 0 otherwise impulsive conditions are possible and we proceed onward to step 3 here we should note the similarity of the guidance provided by eq 31 to that provided by eq 29 however in this case we must still restrict our model to storm wave overtopping since the condition specified by inequality 30 depends upon the wave period through its dependence upon the wavelength see eq 28 step 3 determine whether relative freeboard is large or small eurotop defines the relative freeboard as rc h m0 and for very high relative freeboards significant overtopping may still be possible due to impulsive wave conditions in these cases the exponential decay form used in the formulas prescribed for overtopping guidance up until this point is not appropriate instead a power law formula is prescribed for this regime by the eurotop guidance a large relative freeboard occurs for rc h m0 1 35 and in this case overtopping rates are computed by 32 q g h m 0 3 0 0014 h m 0 h s m 1 0 0 5 r c h m 0 3 for a small relative freeboard i e 0 rc h m0 1 35 overtopping rates are computed by 33 q g h m 0 3 0 011 h m 0 h s m 1 0 0 5 exp 2 2 r c h m 0 in both cases the wave steepness s m 1 0 h m 0 l m 1 0 enters into the guidance we note that our earlier assumption of storm wave periods by the dhi rule of thumb t p 5 3 h m 0 implies a constant wave steepness s m 1 0 0 0276 this wave steepness lies somewhere between the steepness of swell s m 1 0 0 01 and the steepness of wind waves s m 1 0 0 06 we also note that in our above discussion of the steps for determining wave overtopping rates for vertical structures we skip a step from the eurotop guidance which concerns the treatment of composite vertical structures in other words vertical structures with a rubble mound or similar structure placed at the toe we exclude this step here for the sake of brevity in the current discussion interested readers may refer to ch 7 in the eurotop manual for details eurotop 2016 as well as because we do not include any such cases in our validation studies in the proceeding section primarily because these types of structures tend to be poorly represented in the database of measurements we refer to i e clash 5 results the test cases for this study are derived from those shown by the database produced by the eu project known as clash crest level assessment of coastal structures by full scale monitoring neural network prediction and hazard analysis on permissible wave overtopping the clash database provides measurements and approximations for over 10 000 wave overtopping cases some of which are from prototype measurements on full scale structures while most results are for model tests performed in wave flumes or wave basins the clash database reduces its description of the test cases to a total of 31 parameters three 3 general parameters 11 hydraulic parameters and 17 structural parameters steendam et al 2005 van der meer et al 2009 relevant hydraulic parameters include significant wave heights h m0 peak wave periods tp and spectral wave periods t m 1 0 measured at deep water as well as at the structure toe angle of wave attack β and the mean wave overtopping discharge measured per second per meter width q relevant structural parameters include crest freeboard rc slope armor crest freeboard ac berm width b if one exists water depth at structure toe h structure roughness permeability factor γf and cotangent of the slope angle cot α or slope angles in the case of composite slope or berm structures cot α d cot α u see fig 2 for an illustration of some of these parameters the general parameters include two parameters that are useful for assessing the database s capacity for accurately describing each test case the reliability factor rf and the complexity factor cf both the rf and cf range as integer values from 1 to 4 when rf is equal to 1 this value indicates that all measurements for that test case are reliable and any value of rf greater than 1 indicates that either uncertainty exists in the measurements or some approximations and or calculations had to be made for one or more parameters rf greater than 2 indicates a greater degree of uncertainty or less confidence in the existing approximations see hadewych 2003 for more details likewise cf indicates how well the structural parameters describe the physical structure geometry of the barrier section with cf equals 1 indicating almost perfect correspondence and cf of any value greater than 1 indicating some complexity that is not fully described by the 17 structural parameters again see hadewych 2003 for more details to account for the volume of the clash database as well as to simplify our analysis we apply filters based upon a number of the aforementioned parameters first we filter for rf and cf both equal to 1 since we desire both reliable measurements rf 1 and well represented geometries cf 1 for validation of our model next we filter for directly impinging wave fronts β 0 and smooth single sloped or otherwise completely vertical structures γ f 1 cot α d cot α u and b 0 finally since we restrict the wave overtopping capability of our coupled dg models to that from storm waves by using the relation t p 5 3 h m 0 see section 4 we also filter test cases in clash based upon their agreement with this relation the dhi shoreline management guidelines mangor et al 2017 prescribe this relationship as a rule of thumb so we set a wide tolerance of within 10 of this relationship to consider the test case as featuring storm waves we apply a filter based upon a 10 relative error between tp and 5 3 h m 0 as reported by the clash database except for the specific cases with vertical wall structures where the parameter tp does not influence wave overtopping rates i e regimes where the overtopping is described by eq 29 after applying these filters we obtain 207 candidate test cases for our validation study for validating these test cases we discretize a computational domain that is akin to a large scale wave flume as shown in a plan view in fig 3 the domain is discretized by 216 two dimensional triangular elements built from a mesh of 134 nodes the entire domain is prescribed a uniform depth corresponding to h which is adjusted corresponding to the value reported in the clash database for each test case and wind forcing is applied only on the wave flume 42 500 m 7500 m the magnitude of the wind forcing is uniform over the entire expanse of the flume blowing from left to right directly towards the flood barrier boundary the forcing is adjusted until the significant wave height h m0 from clash is obtained at the toe of the barrier structure i e at x 42 500 m in the domain space in this process we actually look to match the deep water value shown by the clash database since our wave model operates on many deep water based assumptions of course this means that our model disregards any foreshore effects that occur between the deep water and the structure toe so in cases where h m0 reported at the structure toe differs significantly from h m0 in deep water we can expect our model to produce less accurate results which is a phenomenon we observe also note that this approach requires turning off the wind stress source terms for the swe component of the model in order to avoid water piling up at the flood barrier once the prescribed h m0 is obtained we measure the wave overtopping by recording the change in the water surface elevation within the overtopping basin 2500 m 7500 m over time by computing the change in volume within the basin we obtain a measurement of the mean wave overtopping discharge q computed by the model which we compare to the measured discharge in clash for our validation studies we apply a time step of one 1 second for both models which also implies that the coupling interval here is at every time step we demonstrate the results of this comparison for all 207 test cases in a series of figures all results are with first degree dg discretizations and second order rk time stepping a regression plot for measured versus modeled overtopping rates is shown in fig 4 here we note that the slope of the regression line is rather low at 0 784 and we also note that the correlation does not seem good r 2 0 5241 however we can identify a number of cases that appear to be outliers which can be seen from observing the errors in the model overtopping rates see fig 5 since we anticipate a considerable degree of spread in the model error due to the simplifying assumptions made within e g those made by the parametric wave model and the use of dhi guidelines for computing wave periods from wave heights we define the outlier cases as any cases which deviate more than ten 10 interquartile ranges from the upper and lower quartiles from this analysis we identify 18 total outlier cases and we investigate these cases further to determine why the model performance is especially bad there by discounting these outliers we obtain a much improved regression line where the slope is 0 9911 and the correlation is very good with r 2 0 9584 fig 6 for all of the outlier cases where the model excessively underestimates the overtopping rates i e the three 3 cases below the bottom dashed line in fig 5 we may notice some similarities in all of these cases h m0 rc or h m0 rc we may also see that the overtopping rates provided by the eurotop guidance itself q eurotop are not reliable where in one case 103 112 the eurotop guidance exceeds the measured value by roughly 30 see table 1 agreement between the eurotop guidance and our model s guidance does not appear to be reliable here either since for the aforementioned case the model significantly underestimates the overtopping rate by roughly 45 this analysis suggests that within this regime where h m0 rc the eurotop guidance may exhibit some significant degree of uncertainty the cases for which the model produces excessively overestimated overtopping rates i e the 15 cases above the upper dashed line in fig 5 also share a common thread in that all of these cases report significantly reduced significant wave heights at the structure toe relative to those at deep water as shown by fig 7 the relative reductions in wave height range from roughly 54 to roughly 23 since our model uses the deep water h m0 for computing overtopping rates and since the deep water h m0 is greater than that at the toe for all of these cases our model computes overtopping rates that are far too high these are cases in which we anticipate our model to perform poorly without the introduction of further approximations in order to account for the foreshore effects that cause h m0 to decrease between the deep water and structure toe therefore since we have yet to introduce such approximations into the model we should discount theses cases in our current model validation the authors consider the above analysis as a fitting validation of the mean behavior of the proposed model since the model agrees well with measurements for more than 90 of the 207 overtopping test cases considered here the only existing caveats are that different approximations may need to be pursued for cases wherein significant wave heights are near to or greater than the crest freeboard as well as for cases wherein foreshore effects cause the significant wave height to differ significantly at the structure toe from that at deep water despite these caveats the successful validation of the model for these cases motivates further studies validating this approach for more realistic test cases 6 conclusion this study resulted in an effective validation of the mean behavior of a physical modeling framework applied to simulating the overtopping of coastal flood barrier structures by storm waves the modeling framework is based upon a loosely coupled swe and parametric spectral wave model the model uses dg finite element discretizations resulting in a model that is amenable to unstructured grids and local polynomial and mesh refinement we validate the model by comparing numerical wave overtopping discharge rates to measurements recorded in the clash database steendam et al 2005 van der meer et al 2009 for test cases featuring storm waves overtopping smooth single sloped or vertical structures discharge rates due to wave overtopping are computed using the guidance of the eurotop manual eurotop 2016 and the definition of storm waves is derived from a rule of thumb prescribed by dhi shoreline management guidelines mangor et al 2017 that relates the peak wave period tp to the significant wave height h m0 we demonstrate that the model performs remarkably well on average for resolving wave overtopping on simple structures although after sorting for outliers where either the eurotop guidance exhibits significant uncertainty for example when h m0 rc or where neglecting foreshore effects in our wave model causes overestimates of significant wave heights at the structure toe however we also show that such outlier cases are relatively few in number whereby we demonstrate very good results by linear regression using more than 90 of the test cases considered slope 0 9911 r 2 0 9584 this result is highly motivating towards further development of this model for application to full scale storm events since the wave component of this model is known to be far more efficient than more commonly used discrete spectral third generation wave models conroy et al 2018 meaning that further development could result in a reliable and more efficient means for probabilistic assessment of wave overtopping risks however there are several more avenues for future work that should be pursued before this overarching goal may be realized the most immediate future work would be validating the model for using it with other aspects of the eurotop guidance such as those shown for oblique wave attacks slope roughnesses and composite structures we should also introduce some approximations that account for changes in wave heights between the deep water and the structure toe due to foreshore effects the current model also disregards internal forces due to wave breaking and turbulence so including these forces could improve results also the parametric wave model used here was developed with many empiricisms intended to be applicable towards large lake bodies specifically the us great lakes so the model will require some reworking to be fully applicable to coastal ocean settings this wave model also currently does not account for the presence of swell which may be a significant contribution to the wave field in the case of a large scale storm in an ocean basin so swell should be implemented into the wave model work on the latter two topics is currently underway finally work should be done to determine an appropriate means for two way coupling between the wave momentum and mean water level momentum equations so that the swe component and wave component of the coupled model may better inform one another at locations other than internal barrier boundaries credit authorship contribution statement dylan wood conceptualization methodology software investigation writing original draft ethan j kubatko writing review editing supervision methodology software mehrzad rahimi writing review editing abdollah shafieezadeh writing review editing supervision project administration funding acquisition colton j conroy methodology software declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment the authors acknowledge support by national science foundation grant cmmi 1563372 we also acknowledge that the high performance computing resources used to conduct this research were provided by the ohio supercomputer center ohio supercomputer 1987 supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 103501 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
537,channels are widely used for conveying natural flash floods or managed aquifer recharge mar released treated wastewater adequate models are needed for describing the interaction between hydraulics of surface flow downslope the channel and vertical seepage into a porous bed for evaluation of the depth of water and the length to which surface water jet propagates over a porous bed experiments with surface jets consumed by bed infiltration are compared with numerical and analytical modeling of these coupled flows in the field al hail site oman at a pedestal and slope of a dune two rectangular trenches had a sand bed and a mild and steep slope s 3 and 25 correspondingly after applying constant discharges at the inlet of the trenches the length l of the water jets propagating until complete extinction has been measured the wetting front into the subjacent sand has been detected by measuring the volumetric soil moisture content at different depths in an excavation immediately after termination of discharging the surface water analytically by the hodograph method 2 d steady phreatic seepage flow from a rectangular channel was examined as a special case of vedernikov s solution for a soil without capillarity since the depth of water was small the riesenkampf analytical solution involving capillarity in the tension saturated flanks of the channel has been also utilized numerically richard s equation has been solved by a finite element method hydrus2d for arbitrary soils the boundary condition was a hydrostatic pressure head along the wetted perimeters of the channels with water depth gradually dropping downslope coupling of surface and subsurface flows has been done by the kinematic waves approximation with manning s friction slope equal to s in the ode for conservation of mass the sink term infiltration was computed by either hydrus or analytical solution the corresponding boundary value problem was solved by computer algebra routines keywords coupled surface subsurface flow 2 d seepage with phreatic surfaces richards equation hydrus2d simulations vedernikov s analytical solution abbreviations ta air temperature c lx length of the water jet cm w width of the trench bed cm s topographic slope q surface flow rate m3 hr θv volumetric water content cm3 cm3 h0 initial water depth cm h x depth of tapering free water body in the channel cm f x free board cm φ velocity potential cm hr hf piezometric head cm ω complex potential cm ψ stream function α van genuchten capillarity parameter 1 cm n van genuchten capillarity parameter 1 introduction in arid regions the estimation of natural aquifer recharge through the beds of wadis ephemeral and intermittent streams is essential for a sustainable water resources management maliva and missimer 2012 especially in gulf countries where no perennial streams exist and wadis are key linear sources strack 1989 of infiltration assessment of transmission losses the vernacular of surface hydrologists requires modelling of coupled surface subsurface flows lloyd 1986 de vries and simmers 2002 lange 2005 dvory et al 2018 similar mathematical conjugation of two flows but for smaller size channels is done in furrow irrigation applications wöhling et al 2006 warrick et al 2007 banti et al 2011 bautista et al 2016 brunetti et al 2018 nowadays managed aquifer recharge mar with surface water impoundments infiltration trenches is considered for replenishing unconfined aquifers maliva and missimer 2012 gale 2005 by gravity only unlike mar by injection wells see maliva 2020 pp 568 575 in oman reusing of treated wastewater tww for mar is currently contemplated on a national scale with lagoons and channels tested for their potential impact on groundwater kacimov et al 2016 that is compared with mar wells shammas 2008 the daily amount of ttw produced by the national haya company is already nearly 150 000 m3 day and this quantity is rapidly increasing zekri et al 2014 several desert areas across oman e g dune fields are investigated for discharging ttw in natural interdunal wadis dry most of the time or smaller scale channels constructed in the consolidated sandy beds covered by a thin layer of loose sand of these wadis the infiltrated ttw if mixed in the aquifer with groundwater of good quality can be abstracted by wells drilled nearby to these dunal wadis channels reusing of tww or harvested stormwater via mar infiltration from the surface sources is practiced in arid zones of usa sheng 2005 spain cazurra 2008 jordan el rawy et al 2016 israel idelovitch 1978 schwarz et al 2016 and saudi arabia lopez et al 2014 to the best of our knowledge a common assumption in all mar infiltration models is that surface water in the ponds is static several methods are reported in the literature to address the surface subsurface flow interaction in arid regions shanafield et al 2014 and below we mention only few relevant papers for example lane et al 1971 predicted the transmission losses from an ephemeral channel by comparing the inflow and outflow hydrographs freyberg 1983 modeled the effect of wetted perimeter on infiltration through these channels field experiments and numerical modeling were used to study the relationship between the infiltration rate and stage of an ephemeral stream batlle aguilar and cook 2012 carried out direct measurements of transmission losses in short distances along the surface flow the infiltration rate was estimated by measuring the amount of discharged water to maintain a constant depth of water in the channel noorduijn et al 2014 studied the change in seepage losses along 1387 m of an artificial sandy channel by using numerical solutions based on a developed diffusion wave model rau et al 2017 indirectly estimated the surface subsurface interaction by using thermometry at different depths along ephemeral streams alsmadi and abdelal 2018 estimated the transmission losses by determining the differences in inflow tww effluent and outflow downstream dam basin in a 48 km stream segment schreiner mcgraw and vivoni 2019 studied the effect of climate change on the transmission losses from arid streams overall with the increase of the magnitude of floods in desert ephemeral streams the transmission losses increase abdulrazzak 1995 lange 2005 heidbüchel 2007 dahan et al 2008 morin et al 2009 schreiner mcgraw and vivoni 2018 empirical relationships between the channel bed geometry wetted perimeter width stage of the surface current hydraulic conductivity of the bed and infiltration rates have been developed from field data and utilized in mathematical models predicting the wadi stages and discharges during flash floods e g abdulrazzak 1995 calver 2001 bautista and schlegel 2017 ganot et al 2017 recently al shukaili and kacimov 2019 analytically and numerically modelled and optimized a coupled surface flow seepage in from triangular soil channels in this manuscript we extend the work to rectangular channels we present experimental results section 2 an analytical section 3 and numerical section 4 models of subsurface flow and its conjugation with a quasi normal surface flow section 5 2 experimental jets in dune trenches on january 14th 17th 2019 experiments were conducted at the al hail beach oman 23 38 34 n 58 14 36 e near a dune made of a coarse sand air temperature and relative humidity were ta 27 c and rh 70 correspondingly first water was splashed on a mild slope at the pedestal of the dune to moisten stabilize the loose sand then by a shovel trench 1 fig 1 c was dug a constant discharge of water q0 0 306 m3 h was applied at the upstream hydraulically commanding end of the trench the discharged water even at such small q0 eroded the sand and a single layer of gravel was laid at the trench bed to stabilize it upon quenching the erosion we monitored how a steady state surface flow was attained such that all discharged water vanished in the sand the corresponding length l 230 cm fig 1 of a surface water jet was measured the slope s width w and water depth h0 of trench 1 were 3 15 cm and 1 cm correspondingly the hydraulic radius and area varying with the longitudinal coordinate x are r w h w 2h and a w h trench 2 was dug at a steep slope s 25 of the dune fig 2 sand erosion was stronger when water was hosed at the trench inlet a constant flow rate q0 0 306 m3 h was kept for 3 days the eroded sand re settled in the trench bed forming ripples rivulets and braided mini channels that prevented formation of what we targeted and attained in trench 1 viz a straight trench and a steady surface flow jet devoured by seepage adding gravel did not stabilize the bed in trench 2 then a green mesh with millimeter size openings was used to cover the bed after 2 h the shape of trench 2 stabilized and we measured the triad l w h0 100 10 1 5 cm after that the surface water supply was stopped and the volumetric soil moisture content θv was immediately measured in the sand subjacent adjacent to the trench fig 2c theta probe readings were taken along the trench bed fig 2d to measure θ v on the left l right r banks and in the middle m of the wet bed after that a 50 cm excavation in the trench bed was made fig 2d the purpose was to detect the wet bulb formed in the soil due to vertical seepage θ v measured at the depths of 0 10 20 30 40 and 50 cm counted from the soil surface in the bed in the excavation is presented in fig 3 b immediately after the water supply was stopped the soil moisture content under an excavated trench bed where θv increased with depth and reached 24 5 at the bottom of excavation 50 cm that tracked the sinking pulse of infiltrated water at the two banks of the trench with flowing surface water θv was also measured and showed the values of about 15 fig 3a overall measured θv were less than θs 42 unfortunately we did not measure θv in the banks during steady state surface flow if θv at this stage were close to θs this would corroborate the riesenkampf model of two wings of banks tension saturated zones kacimov 2006 we collected soil samples from the sites of trenches 1 and 2 and in the lab measured a saturated hydraulic conductivity ks we used a constant head permeameter and obtained ks1 85 5 cm h and ks2 208 3 cm h for the beds of two trenches it is well known that the ks increases from pedestals to the crests of sand dunes 3 analytical solution for potential seepage with phreatic surfaces experiments reported in section 2 evidenced that seepage has an essential impact on surface flows in trenches of relatively small sizes provided the bed has high permeability in this section we present an analytical solution to a steady state 2 d potential flow from an arbitrary rectangular channel in soils without capillarity fig 4 a sketches 3 d surface flow downslope along the ox axis in a trench of a width w and initial water depth h0 seepage reduces the surface flow rate q x and depth h x of a vertical wetted cross section bcc1mb1b i e 0 q qo 0 h ho at 0 x l the free surface ot of surface water flow is shown in an axial cross section of the trench fig 4b the tip t of the free water jet is distance l from the inlet a vertical cross section o1xy in fig 4c illustrates the seepage flow a free board of the channel is f x vedernikov 1939 see also polubarinova kochina 1977 hereafter abbreviated as pk 77 analytically solved a general problem of a phreatic seepage from a trapezoidal channel the case of the rectangle in fig 4a is a singular limit of vedernikov s solution not elaborated in his book and outlined below in each vertical cross section parallel to one in fig 4c fixed longitudinal coordinate x we assume that seepage is 2d and laterally bounded by phreatic curves ab and cd fig 4c fig 3b illustrates that even after termination of discharge at x 0 the subjacent sand remains very wet for a while although the saturated wet bulb descends when surface flow in the channels stops we use the hodograph method pk 77 strack 1989 strack et al 2019 hunt 2016 we introduce a complex physical variable z x i y fig 4c velocity potential φ kshf where hf x y is the piezometric head the complex potential is ω φ i ψ where ψ is a stream function which is conjugated with φ via the cauchy riemann conditions point m in the middle of the channel bed fig 4c is fiducial ω m 0 φ b b 1 c 1 c 0 then the complex potential domain g ω corresponding to the flow domain gz is a half strip shown in fig 5 a the phreatic surfaces cd and ba correspond toψ qi 2 the seepage flow rate from the whole channel is qi at the corner points c1 and b1 the stream function is ψ qb 2 where qb is the portion of flowing through the flat bed segment b1c1 the domain corresponding to gz in the plane of a holomorphic function dω dz is shown in fig 5b this domain is the upper half plane with a semi infinite vertical cut and a discarded disk of a radius ks 2 the domain gh in the plane of a holomorphic function dz dω is a half strip with a vertical cut fig 5c we notice that our gh is a degenerate limit of a finite triangle with a cut shown in vedernikov 1939 as his fig 5 and 4c for a trapezoidal channel the values of qi and qb as well as the darcian velocity at point m vm are to be found we use the schwarz christoffel formula and map g ω onto the upper half plane gζ of a reference variable ζ ξ i η fig 5d by the function 1 ω i q i π arcsin ζ the affix β fig 5d of this mapping is to be found similarly we map gh onto gζ 2 d z d ω a 0 ζ τ d τ 1 τ 2 β 2 τ 2 i v m the constant of integration a in eq 2 is determined from the condition dz dω 0 at ζ β the branch of the radical β 2 ζ 2 is defined to be positive at ζ β 3 a i i 1 v m i 1 1 1 β 2 arctan β 1 β 2 the ζ plane was cut along the line joining the two branch points ζ β and passing through the infinite point next we use the condition dz dω i vm at ζ we integrate in eq 2 along the imaginary axis of the reference plane i e along the ray ma points a and d coincide on the riemann sphere that gives 4 v m k s i 1 i 2 i 1 i 2 0 τ d τ 1 τ 2 β 2 τ 2 1 1 β 2 π 2 arcsin β obviously i 1 i 2 π 2 1 β 2 then eq 2 becomes 5 d z d ω 2 i k s π arctan β 2 ζ 2 1 β 2 we differentiate eq 1 and from eq 5 obtain 6 d z d ζ d z d ω d ω d ζ 2 q k s π 2 1 1 ζ 2 arctan β 2 ζ 2 1 β 2 at infinity points a m1 d in fig 4c the complex potential behaves as ω iksz at the corner points b1 c1 the complex potential is obviously finite and dω dz has a singularity of the order dω dz z z b1 1 3 z z c1 1 3 correspondingly we integrate eq 6 as 7 z ζ 2 q k s π 2 0 ζ 1 1 t 2 arctan β 2 t 2 1 β 2 d t i h we use the condition z ih w 2 at ζ β point b1 then from eq 7 we get an equation 8 w 2 2 q i k s π 2 j 1 j 1 β 0 β 1 1 t 2 arctan β 2 t 2 1 β 2 d t next we use the condition z w 2 at ζ 1 point b then from eq 7 we obtain 9 h 2 q i k s π 2 j 2 j 2 β β 1 1 1 t 2 arctanh t 2 β 2 1 β 2 d t first we eliminate qi from eqs 8 and 9 and arrive at the following nonlinear equation with respect to β 10 h w j 2 2 j 1 we solved eq 10 by the findroot routine of mathematica wolfram 1991 with integrals in j 1 j 2 evaluated by the nintegrate routine after determining β we put it back into eq 8 and computed qi we introduce dimensionless quantities q i q i k s w a a w 2 h l r z x p h l r z x iy x p w q q ksw 2 fig 6 a shows qi and the morel seytoux factor μ q k s a as functions of h a curves 1 and 2 respectively curve μ h has a global minimum of 0 407 attained at h 0 407 that concurs with kacimov 1992 viz a channel having minimal qi at a given a curve 3 in fig 6a i e the graph qi h does not extend to h 0 because at small trench depths the size of finite elements has to be smaller than h the analytical solution can be also used to get the pressure head distribution inside the flow domain of fig 4c for example along the line of symmetry mm1 we assume ζ iη in the reference plane fig 5d then from eq 1 the distribution of the velocity potential along this ray here we keep dimensional quantities is ω φ q π arcsinh η 0 η along the same ray from eqn 7 we get z i y η 2 q k s π 2 0 η 1 1 t 2 arctan β 2 t 2 1 β 2 d t i h 0 η we combine these two equations and get a parametric equation for the pressure head p ϕ ks y y η 2 q k s π 2 0 η 1 1 t 2 arctan β 2 t 2 1 β 2 dt h p η y η q π arcsinh η 0 η we note that the pressure head along abcd is assumed to be zero i e we deal with the gage pressure a dimensionless p y plotted by the parametricplot routine of mathematica is shown in fig 6b for dimensionless h 0 15 curve 1 4 hydrus2d simulations of saturated unsaturated flow in this section trenches 1 and 2 section 2 are simulated in hydrus2d šimůnek et al 2016 by focusing on the steady limits of a transient seepage governed by richards equation which unlike the laplace equation in section 3 does not involve free boundaries the geometry of the corresponding vertical cross sections is presented in fig 7 a and b as in section 3 we assume that in each cross section of fig 4c soil water moves in a vertical plane generally seepage is 3 d including the ox direction in fig 4a see submitted we assume zero free boards in each cross section of fig 4c that presumably only mildly reduces qi the octagonal domains aebb1c1cfd in fig 7 were discretized into 360 and 19536 of 1d 2d elements respectively for trench 1 for trench 2 the discretization was 360 of 1d and 19324 of 2d elements a homogeneous vg sand see the hydrus soil catalogue had ks 29 7 cm h and its capillary parameters were α 0 145 1 cm n 2 68 at t0 0 we assumed that the octagons are very dry at a pressure head p0 100 cm this initial condition was in agreement with field measurements by a theta probe at the al hail site prior to the soil wetting a hydrostatic head along the wetted perimeters of the channels segments bb1mc1c in fig 7 was maintained at t 0 a free drainage condition was ascribed along the lower boundaries ad four other sides of the octagons in fig 7 were impermeable i e evaporation from the soil surface eb and cf was ignored the maximum number of hydrus iterations was 10 and the water content tolerance was 0 001 after three hours simulations reached a steady state seepage the bottom outlet was selected to illustrate the qi0 at a steady rate of seepage in both trenches table 1 it is noteworthy that an inverted water table p 0 fig 7b emerges under the channel bed a saturated positive pressure bulb hangs in the ambient unsaturated zone see e g warrick and zhang 1987 and sophocleous 2002 curve 2 in fig 6b represents the hydrus computations of p y i e converted to the same dimensionless quantities as in the analytical solution presented as curve 1 in this figure capillarity in richards equation makes an inverted water table with its deepest point at y 0 64 in the analytical solution without capillarity there are only two regular water table branches p 0 free surfaces and everywhere in the flow domain the pressure head is positive 5 coupling of surface and subsurface flows if qi is relatively large as compared with q as in our field experiments then seepage and surface flows have to be coupled furman 2008 the simplest conjugation of surface and subsurface flows for shallow channels small h0 w is via the following mass balance equation 11 q i a l q 0 where qia is the seepage rate averaged over the interval 0 x l in our experiments section 2 we can assume h h 0 0 and therefore for a capillarity free seepage qia0 ksw and l q0 ksw however for small w like in section 2 capillarity even in sandy soils significantly increases qia as compared with qia0 we recall riesenkampf s see pk 77 kacimov 2006 kacimov et al 2019 analytical solution for a zero depth channel in terms of the vedernikov bouwer model of 2 d tension saturated phreatic flow in this model a constant hc is the capillary pressure at the free boundary of a capillary fringe pk 77 a step wise water retention curve and relative permeability are assumed such that water spreads along horizontal segments bbh and cch with phreatic surfaces chd and bha fig 8 we simulated in hydrus 1 1 for the sake of brevity we drop here the details of the corresponding hydrus project such a shallow channel having w 10 cm and h0 1 5 cm and the results are in excellent agreement with the riesenkampf analytical solution in fig 8 we plot the isobars spanning from 6 cm that can be considered as a contour corresponding to riesenkampf s free boundary to 1 5 cm the horizontal segment of the channel bed moreover experimental data in fig 2a confirm that during steady seepage a tension saturated zone spreads on the left and right banks of trench 1 according to riesenkampf s predictions and hydrus simulations segments bbh and cch in fig 8 the tension saturated zone in the riesankampf solution is a fair approximation to account for water in the unsaturated zone that is just below θs in the more accurate richards equation characteristic functions pressure and piezometric heads stream function do not satisfy the laplace equation because the darcian hydraulic conductivity k varies with pressure head see e g philip 1990 riesenkampf see pk 77 her eq 4 9 p 179 and youngs 1972 gave the following implicit relation for determination of q i a c q i a c k s w 12 q i a c π 2 8 j 1 exp 2 j 1 π h c q i a c 2 j 1 2 h c h c w the nonlinear eq 12 is easily solved by the findroot routine of mathematica the key parameter of hc can be obtained by a experiments the height of capillary rise in a vertical column b tabulated data from the literature e g pk 77 reports 50 100 cm for sandy soils c theoretical comparisons with the vg and other richards equation based models guarracino 2007 smagin 2012 as an example we use the method by smagin 2012 p 158 he selected the inflection point of the vg water retention curve as a limit of tension saturation smagin along with a relation hc 1 α suggested to use hcc hc m1 m where m is the vg constant if we assume the vg sand from the hydrus soil catalogue section 4 then hc 6 9 cm and hcc 5 9 cm next from eq 12 q i a c 2 69 and 2 51 and from eq 11 l 3 83 and 3 59 m for w 10 cm and ks 0 3 cm h if we take hc 50 cm pk 77 her table 5 then q i 8 25 and l 1 25 m a mathematically more involved conjugation of surface hydraulics and 2 d seepage requires the following from the conservation of mass we have an ordinary differential equation ode 13 d q x d x q i x q 0 q 0 q l 0 where evaporation losses from open channel surface are ignored the second governing equation for a shallow flow in the channel we select from the kinematic waves approximation of the saint venant theory see e g eq 3 of furman 2006 14 s s f where sf is a constant manning s friction slope 15 q x s f a x r 2 3 x n m and nm is a constant bed s roughness s m1 3 surface flow obeying eq 15 is gradually varying chow 1959 quasi normal i e locally at each x it obeys the manning equation but the normal depth h decreases gently with x if no seepage all quantities in eq 15 would be constant and flow is normal as we mentioned in section 1 in models of coupled surface subsurface flows the infiltration qi x in eq 13 is commonly assumed to be an empiric function of the geometry of the wetted contour or is postulated as a transient loss term which assumes 1d or quasi 1d seepage from the channel to the best of our knowledge a 2 d vedernikovian 1939 seepage as in fig 4c has not been previously involved in models of coupled flows below we follow vedernikov 1939 and assume that qi depends on the triad w h ks for the analytical model of section 3 or on this triad and additionally on the vg tetrad α n θr θs in the capillary soils of section 4 we differentiate q x for a rectangular channel in eq 15 use the dimensionless quantities introduced in section 3 and put the results into the lhs of eq 13 16 d d x h 1 2 h 2 3 q i x e h 0 h 0 h l 0 e w 2 3 s k s n eq 16 is a boundary value problem for a non linear ordinary 1 st order ode with respect to h the front position l is a part of the solution 5 1 surface flow coupled with analytical infiltration in this subsection we use the exact analytical formula for seepage flow rate in the rhs of ode 14 17 q i x π 2 4 j 1 β h x where j1 is given in eq 8 we solved bvp 16 with its rhs from eq 17 as a cauchy problem we used the ndsolve routine of mathematica the results are shown in fig 9 for a rectangular channel having w 0 1 m and h0 0 01 m laid with a topographic slope s 0 01 in sand having manning s roughness nm 0 02 s m1 3 and the vg hydrus conductivity ks 7 m day therefore in eq 16 e 13108 fig 9 shows h x in particular l 1164 7 or returning to dimensional quantities l 116 5 m 5 2 surface flow coupled with numerical infiltration in this subsection we use hydrus computed qi h as rhs in the ode of bvp 16 in hydrus simulations we selected w 10 cm and varied h from 1 5 cm to 11 cm table 2 below presents the results for sand from the hydrus soil catalogue we used the interpolation routine of mathematica to approximate the results in table 2 the corresponding function converted to dimensionless quantities is shown in fig 6a as curve 3 apparently curves 1 and 3 in fig 6a for a given w and soil both the hydrus and analytical functions qi h are almost linear consequently we use a linear regression to approximate the hydrus infiltration 18 q i h c 1 c 2 h for example for the hydrus case presented in table 2 and curve 3 in fig 6a the regression coefficients are c1 2 61 and c1 3 43 then we put the linear function 18 into the rhs of ode 16 and separate the variables 19 x e h 0 h 1 10 3 u c 1 c 2 u 1 2 u 1 3 d u the integral in eq 19 is evaluated by either the integrate or nintegrate routine of mathematica in fig 9 curve 2 presents h x computed by eq 19 for the same parameters as in section 5 1 this curve shows that for the vg capillary sand in this example l 53 6 m i e more than twice less than for sand of the same ks but without capillarity 6 concluding remarks in our experiments and mathematical models we considered a special type of conjugation of surface and subsurface flows steady state regimes having a finite length l of a free surface jet which propagates along the bed of a rectangular channel dwindling of the channel water level and eventually extinction of the jet is due to seepage into a porous channel bed hydraulic conductivity and capillary properties of the bed impact the visible shape of free surface and l vedernikov s and riesenkampf s theory for 2 d capillarity free and tension saturated seepage with two phreatic surfaces is favourably compared with hydrus simulations both solution methods analytic and fem are applied to a 2d vertical cross section fig 4c that neglects darcy s flow in the ox direction fig 4a generally the depth of free water in the channel decreases down the slope fig 4b in accordance with manning s equation and kinematic wave approximation the lost water depth in the channel is transferred to the soil as a boundary condition for the darcy flow in fig 4c we neglected the ox component of darcy s flux considered seepage in the o1 xy plane only fig 4c that is an approximation recently we studied also by conformal mappings and fem a darcian flow in the o x y plane fig 4 generated by a constant pressure head boundary condition along a wadi bed duddd in fig 4b surface water in which is at a normal manning s flow if both surface and subsurface flows are 3 d then their conjugation seems to be amenable to numerical modelling only gravity and capillarity are facilitators while the soil is a resistor to water motion downstream a topographic slope and downward through the vadose zone which staudinger et al 2019 identified as as a no man s land from the view point of hydrologists and hydrogeologists these three physical factors are amalgamated in a single dimensionless coefficient e which involves the topographic slope channel s width and the darcian manningian frictions are quantifiers of resistance the obtained l can be used for planning mar operations furrow irrigation and assessments of flood waves spreading in long wadis after rainfalls of low intensity when the surface water vanishes somewhere in the middle of the wadi credit authorship contribution statement a al shukaili investigation writing original draft software data curation h al busaidi resources methodology a r kacimov supervision conceptualization writing review editing validation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the research received funding from sultan qaboos university squ ig cams swae 18 01 in addition a al shukaili appreciates the phd scholarship fund from sultan qaboos university helpful comments by three anonymous referees are highly appreciated 
537,channels are widely used for conveying natural flash floods or managed aquifer recharge mar released treated wastewater adequate models are needed for describing the interaction between hydraulics of surface flow downslope the channel and vertical seepage into a porous bed for evaluation of the depth of water and the length to which surface water jet propagates over a porous bed experiments with surface jets consumed by bed infiltration are compared with numerical and analytical modeling of these coupled flows in the field al hail site oman at a pedestal and slope of a dune two rectangular trenches had a sand bed and a mild and steep slope s 3 and 25 correspondingly after applying constant discharges at the inlet of the trenches the length l of the water jets propagating until complete extinction has been measured the wetting front into the subjacent sand has been detected by measuring the volumetric soil moisture content at different depths in an excavation immediately after termination of discharging the surface water analytically by the hodograph method 2 d steady phreatic seepage flow from a rectangular channel was examined as a special case of vedernikov s solution for a soil without capillarity since the depth of water was small the riesenkampf analytical solution involving capillarity in the tension saturated flanks of the channel has been also utilized numerically richard s equation has been solved by a finite element method hydrus2d for arbitrary soils the boundary condition was a hydrostatic pressure head along the wetted perimeters of the channels with water depth gradually dropping downslope coupling of surface and subsurface flows has been done by the kinematic waves approximation with manning s friction slope equal to s in the ode for conservation of mass the sink term infiltration was computed by either hydrus or analytical solution the corresponding boundary value problem was solved by computer algebra routines keywords coupled surface subsurface flow 2 d seepage with phreatic surfaces richards equation hydrus2d simulations vedernikov s analytical solution abbreviations ta air temperature c lx length of the water jet cm w width of the trench bed cm s topographic slope q surface flow rate m3 hr θv volumetric water content cm3 cm3 h0 initial water depth cm h x depth of tapering free water body in the channel cm f x free board cm φ velocity potential cm hr hf piezometric head cm ω complex potential cm ψ stream function α van genuchten capillarity parameter 1 cm n van genuchten capillarity parameter 1 introduction in arid regions the estimation of natural aquifer recharge through the beds of wadis ephemeral and intermittent streams is essential for a sustainable water resources management maliva and missimer 2012 especially in gulf countries where no perennial streams exist and wadis are key linear sources strack 1989 of infiltration assessment of transmission losses the vernacular of surface hydrologists requires modelling of coupled surface subsurface flows lloyd 1986 de vries and simmers 2002 lange 2005 dvory et al 2018 similar mathematical conjugation of two flows but for smaller size channels is done in furrow irrigation applications wöhling et al 2006 warrick et al 2007 banti et al 2011 bautista et al 2016 brunetti et al 2018 nowadays managed aquifer recharge mar with surface water impoundments infiltration trenches is considered for replenishing unconfined aquifers maliva and missimer 2012 gale 2005 by gravity only unlike mar by injection wells see maliva 2020 pp 568 575 in oman reusing of treated wastewater tww for mar is currently contemplated on a national scale with lagoons and channels tested for their potential impact on groundwater kacimov et al 2016 that is compared with mar wells shammas 2008 the daily amount of ttw produced by the national haya company is already nearly 150 000 m3 day and this quantity is rapidly increasing zekri et al 2014 several desert areas across oman e g dune fields are investigated for discharging ttw in natural interdunal wadis dry most of the time or smaller scale channels constructed in the consolidated sandy beds covered by a thin layer of loose sand of these wadis the infiltrated ttw if mixed in the aquifer with groundwater of good quality can be abstracted by wells drilled nearby to these dunal wadis channels reusing of tww or harvested stormwater via mar infiltration from the surface sources is practiced in arid zones of usa sheng 2005 spain cazurra 2008 jordan el rawy et al 2016 israel idelovitch 1978 schwarz et al 2016 and saudi arabia lopez et al 2014 to the best of our knowledge a common assumption in all mar infiltration models is that surface water in the ponds is static several methods are reported in the literature to address the surface subsurface flow interaction in arid regions shanafield et al 2014 and below we mention only few relevant papers for example lane et al 1971 predicted the transmission losses from an ephemeral channel by comparing the inflow and outflow hydrographs freyberg 1983 modeled the effect of wetted perimeter on infiltration through these channels field experiments and numerical modeling were used to study the relationship between the infiltration rate and stage of an ephemeral stream batlle aguilar and cook 2012 carried out direct measurements of transmission losses in short distances along the surface flow the infiltration rate was estimated by measuring the amount of discharged water to maintain a constant depth of water in the channel noorduijn et al 2014 studied the change in seepage losses along 1387 m of an artificial sandy channel by using numerical solutions based on a developed diffusion wave model rau et al 2017 indirectly estimated the surface subsurface interaction by using thermometry at different depths along ephemeral streams alsmadi and abdelal 2018 estimated the transmission losses by determining the differences in inflow tww effluent and outflow downstream dam basin in a 48 km stream segment schreiner mcgraw and vivoni 2019 studied the effect of climate change on the transmission losses from arid streams overall with the increase of the magnitude of floods in desert ephemeral streams the transmission losses increase abdulrazzak 1995 lange 2005 heidbüchel 2007 dahan et al 2008 morin et al 2009 schreiner mcgraw and vivoni 2018 empirical relationships between the channel bed geometry wetted perimeter width stage of the surface current hydraulic conductivity of the bed and infiltration rates have been developed from field data and utilized in mathematical models predicting the wadi stages and discharges during flash floods e g abdulrazzak 1995 calver 2001 bautista and schlegel 2017 ganot et al 2017 recently al shukaili and kacimov 2019 analytically and numerically modelled and optimized a coupled surface flow seepage in from triangular soil channels in this manuscript we extend the work to rectangular channels we present experimental results section 2 an analytical section 3 and numerical section 4 models of subsurface flow and its conjugation with a quasi normal surface flow section 5 2 experimental jets in dune trenches on january 14th 17th 2019 experiments were conducted at the al hail beach oman 23 38 34 n 58 14 36 e near a dune made of a coarse sand air temperature and relative humidity were ta 27 c and rh 70 correspondingly first water was splashed on a mild slope at the pedestal of the dune to moisten stabilize the loose sand then by a shovel trench 1 fig 1 c was dug a constant discharge of water q0 0 306 m3 h was applied at the upstream hydraulically commanding end of the trench the discharged water even at such small q0 eroded the sand and a single layer of gravel was laid at the trench bed to stabilize it upon quenching the erosion we monitored how a steady state surface flow was attained such that all discharged water vanished in the sand the corresponding length l 230 cm fig 1 of a surface water jet was measured the slope s width w and water depth h0 of trench 1 were 3 15 cm and 1 cm correspondingly the hydraulic radius and area varying with the longitudinal coordinate x are r w h w 2h and a w h trench 2 was dug at a steep slope s 25 of the dune fig 2 sand erosion was stronger when water was hosed at the trench inlet a constant flow rate q0 0 306 m3 h was kept for 3 days the eroded sand re settled in the trench bed forming ripples rivulets and braided mini channels that prevented formation of what we targeted and attained in trench 1 viz a straight trench and a steady surface flow jet devoured by seepage adding gravel did not stabilize the bed in trench 2 then a green mesh with millimeter size openings was used to cover the bed after 2 h the shape of trench 2 stabilized and we measured the triad l w h0 100 10 1 5 cm after that the surface water supply was stopped and the volumetric soil moisture content θv was immediately measured in the sand subjacent adjacent to the trench fig 2c theta probe readings were taken along the trench bed fig 2d to measure θ v on the left l right r banks and in the middle m of the wet bed after that a 50 cm excavation in the trench bed was made fig 2d the purpose was to detect the wet bulb formed in the soil due to vertical seepage θ v measured at the depths of 0 10 20 30 40 and 50 cm counted from the soil surface in the bed in the excavation is presented in fig 3 b immediately after the water supply was stopped the soil moisture content under an excavated trench bed where θv increased with depth and reached 24 5 at the bottom of excavation 50 cm that tracked the sinking pulse of infiltrated water at the two banks of the trench with flowing surface water θv was also measured and showed the values of about 15 fig 3a overall measured θv were less than θs 42 unfortunately we did not measure θv in the banks during steady state surface flow if θv at this stage were close to θs this would corroborate the riesenkampf model of two wings of banks tension saturated zones kacimov 2006 we collected soil samples from the sites of trenches 1 and 2 and in the lab measured a saturated hydraulic conductivity ks we used a constant head permeameter and obtained ks1 85 5 cm h and ks2 208 3 cm h for the beds of two trenches it is well known that the ks increases from pedestals to the crests of sand dunes 3 analytical solution for potential seepage with phreatic surfaces experiments reported in section 2 evidenced that seepage has an essential impact on surface flows in trenches of relatively small sizes provided the bed has high permeability in this section we present an analytical solution to a steady state 2 d potential flow from an arbitrary rectangular channel in soils without capillarity fig 4 a sketches 3 d surface flow downslope along the ox axis in a trench of a width w and initial water depth h0 seepage reduces the surface flow rate q x and depth h x of a vertical wetted cross section bcc1mb1b i e 0 q qo 0 h ho at 0 x l the free surface ot of surface water flow is shown in an axial cross section of the trench fig 4b the tip t of the free water jet is distance l from the inlet a vertical cross section o1xy in fig 4c illustrates the seepage flow a free board of the channel is f x vedernikov 1939 see also polubarinova kochina 1977 hereafter abbreviated as pk 77 analytically solved a general problem of a phreatic seepage from a trapezoidal channel the case of the rectangle in fig 4a is a singular limit of vedernikov s solution not elaborated in his book and outlined below in each vertical cross section parallel to one in fig 4c fixed longitudinal coordinate x we assume that seepage is 2d and laterally bounded by phreatic curves ab and cd fig 4c fig 3b illustrates that even after termination of discharge at x 0 the subjacent sand remains very wet for a while although the saturated wet bulb descends when surface flow in the channels stops we use the hodograph method pk 77 strack 1989 strack et al 2019 hunt 2016 we introduce a complex physical variable z x i y fig 4c velocity potential φ kshf where hf x y is the piezometric head the complex potential is ω φ i ψ where ψ is a stream function which is conjugated with φ via the cauchy riemann conditions point m in the middle of the channel bed fig 4c is fiducial ω m 0 φ b b 1 c 1 c 0 then the complex potential domain g ω corresponding to the flow domain gz is a half strip shown in fig 5 a the phreatic surfaces cd and ba correspond toψ qi 2 the seepage flow rate from the whole channel is qi at the corner points c1 and b1 the stream function is ψ qb 2 where qb is the portion of flowing through the flat bed segment b1c1 the domain corresponding to gz in the plane of a holomorphic function dω dz is shown in fig 5b this domain is the upper half plane with a semi infinite vertical cut and a discarded disk of a radius ks 2 the domain gh in the plane of a holomorphic function dz dω is a half strip with a vertical cut fig 5c we notice that our gh is a degenerate limit of a finite triangle with a cut shown in vedernikov 1939 as his fig 5 and 4c for a trapezoidal channel the values of qi and qb as well as the darcian velocity at point m vm are to be found we use the schwarz christoffel formula and map g ω onto the upper half plane gζ of a reference variable ζ ξ i η fig 5d by the function 1 ω i q i π arcsin ζ the affix β fig 5d of this mapping is to be found similarly we map gh onto gζ 2 d z d ω a 0 ζ τ d τ 1 τ 2 β 2 τ 2 i v m the constant of integration a in eq 2 is determined from the condition dz dω 0 at ζ β the branch of the radical β 2 ζ 2 is defined to be positive at ζ β 3 a i i 1 v m i 1 1 1 β 2 arctan β 1 β 2 the ζ plane was cut along the line joining the two branch points ζ β and passing through the infinite point next we use the condition dz dω i vm at ζ we integrate in eq 2 along the imaginary axis of the reference plane i e along the ray ma points a and d coincide on the riemann sphere that gives 4 v m k s i 1 i 2 i 1 i 2 0 τ d τ 1 τ 2 β 2 τ 2 1 1 β 2 π 2 arcsin β obviously i 1 i 2 π 2 1 β 2 then eq 2 becomes 5 d z d ω 2 i k s π arctan β 2 ζ 2 1 β 2 we differentiate eq 1 and from eq 5 obtain 6 d z d ζ d z d ω d ω d ζ 2 q k s π 2 1 1 ζ 2 arctan β 2 ζ 2 1 β 2 at infinity points a m1 d in fig 4c the complex potential behaves as ω iksz at the corner points b1 c1 the complex potential is obviously finite and dω dz has a singularity of the order dω dz z z b1 1 3 z z c1 1 3 correspondingly we integrate eq 6 as 7 z ζ 2 q k s π 2 0 ζ 1 1 t 2 arctan β 2 t 2 1 β 2 d t i h we use the condition z ih w 2 at ζ β point b1 then from eq 7 we get an equation 8 w 2 2 q i k s π 2 j 1 j 1 β 0 β 1 1 t 2 arctan β 2 t 2 1 β 2 d t next we use the condition z w 2 at ζ 1 point b then from eq 7 we obtain 9 h 2 q i k s π 2 j 2 j 2 β β 1 1 1 t 2 arctanh t 2 β 2 1 β 2 d t first we eliminate qi from eqs 8 and 9 and arrive at the following nonlinear equation with respect to β 10 h w j 2 2 j 1 we solved eq 10 by the findroot routine of mathematica wolfram 1991 with integrals in j 1 j 2 evaluated by the nintegrate routine after determining β we put it back into eq 8 and computed qi we introduce dimensionless quantities q i q i k s w a a w 2 h l r z x p h l r z x iy x p w q q ksw 2 fig 6 a shows qi and the morel seytoux factor μ q k s a as functions of h a curves 1 and 2 respectively curve μ h has a global minimum of 0 407 attained at h 0 407 that concurs with kacimov 1992 viz a channel having minimal qi at a given a curve 3 in fig 6a i e the graph qi h does not extend to h 0 because at small trench depths the size of finite elements has to be smaller than h the analytical solution can be also used to get the pressure head distribution inside the flow domain of fig 4c for example along the line of symmetry mm1 we assume ζ iη in the reference plane fig 5d then from eq 1 the distribution of the velocity potential along this ray here we keep dimensional quantities is ω φ q π arcsinh η 0 η along the same ray from eqn 7 we get z i y η 2 q k s π 2 0 η 1 1 t 2 arctan β 2 t 2 1 β 2 d t i h 0 η we combine these two equations and get a parametric equation for the pressure head p ϕ ks y y η 2 q k s π 2 0 η 1 1 t 2 arctan β 2 t 2 1 β 2 dt h p η y η q π arcsinh η 0 η we note that the pressure head along abcd is assumed to be zero i e we deal with the gage pressure a dimensionless p y plotted by the parametricplot routine of mathematica is shown in fig 6b for dimensionless h 0 15 curve 1 4 hydrus2d simulations of saturated unsaturated flow in this section trenches 1 and 2 section 2 are simulated in hydrus2d šimůnek et al 2016 by focusing on the steady limits of a transient seepage governed by richards equation which unlike the laplace equation in section 3 does not involve free boundaries the geometry of the corresponding vertical cross sections is presented in fig 7 a and b as in section 3 we assume that in each cross section of fig 4c soil water moves in a vertical plane generally seepage is 3 d including the ox direction in fig 4a see submitted we assume zero free boards in each cross section of fig 4c that presumably only mildly reduces qi the octagonal domains aebb1c1cfd in fig 7 were discretized into 360 and 19536 of 1d 2d elements respectively for trench 1 for trench 2 the discretization was 360 of 1d and 19324 of 2d elements a homogeneous vg sand see the hydrus soil catalogue had ks 29 7 cm h and its capillary parameters were α 0 145 1 cm n 2 68 at t0 0 we assumed that the octagons are very dry at a pressure head p0 100 cm this initial condition was in agreement with field measurements by a theta probe at the al hail site prior to the soil wetting a hydrostatic head along the wetted perimeters of the channels segments bb1mc1c in fig 7 was maintained at t 0 a free drainage condition was ascribed along the lower boundaries ad four other sides of the octagons in fig 7 were impermeable i e evaporation from the soil surface eb and cf was ignored the maximum number of hydrus iterations was 10 and the water content tolerance was 0 001 after three hours simulations reached a steady state seepage the bottom outlet was selected to illustrate the qi0 at a steady rate of seepage in both trenches table 1 it is noteworthy that an inverted water table p 0 fig 7b emerges under the channel bed a saturated positive pressure bulb hangs in the ambient unsaturated zone see e g warrick and zhang 1987 and sophocleous 2002 curve 2 in fig 6b represents the hydrus computations of p y i e converted to the same dimensionless quantities as in the analytical solution presented as curve 1 in this figure capillarity in richards equation makes an inverted water table with its deepest point at y 0 64 in the analytical solution without capillarity there are only two regular water table branches p 0 free surfaces and everywhere in the flow domain the pressure head is positive 5 coupling of surface and subsurface flows if qi is relatively large as compared with q as in our field experiments then seepage and surface flows have to be coupled furman 2008 the simplest conjugation of surface and subsurface flows for shallow channels small h0 w is via the following mass balance equation 11 q i a l q 0 where qia is the seepage rate averaged over the interval 0 x l in our experiments section 2 we can assume h h 0 0 and therefore for a capillarity free seepage qia0 ksw and l q0 ksw however for small w like in section 2 capillarity even in sandy soils significantly increases qia as compared with qia0 we recall riesenkampf s see pk 77 kacimov 2006 kacimov et al 2019 analytical solution for a zero depth channel in terms of the vedernikov bouwer model of 2 d tension saturated phreatic flow in this model a constant hc is the capillary pressure at the free boundary of a capillary fringe pk 77 a step wise water retention curve and relative permeability are assumed such that water spreads along horizontal segments bbh and cch with phreatic surfaces chd and bha fig 8 we simulated in hydrus 1 1 for the sake of brevity we drop here the details of the corresponding hydrus project such a shallow channel having w 10 cm and h0 1 5 cm and the results are in excellent agreement with the riesenkampf analytical solution in fig 8 we plot the isobars spanning from 6 cm that can be considered as a contour corresponding to riesenkampf s free boundary to 1 5 cm the horizontal segment of the channel bed moreover experimental data in fig 2a confirm that during steady seepage a tension saturated zone spreads on the left and right banks of trench 1 according to riesenkampf s predictions and hydrus simulations segments bbh and cch in fig 8 the tension saturated zone in the riesankampf solution is a fair approximation to account for water in the unsaturated zone that is just below θs in the more accurate richards equation characteristic functions pressure and piezometric heads stream function do not satisfy the laplace equation because the darcian hydraulic conductivity k varies with pressure head see e g philip 1990 riesenkampf see pk 77 her eq 4 9 p 179 and youngs 1972 gave the following implicit relation for determination of q i a c q i a c k s w 12 q i a c π 2 8 j 1 exp 2 j 1 π h c q i a c 2 j 1 2 h c h c w the nonlinear eq 12 is easily solved by the findroot routine of mathematica the key parameter of hc can be obtained by a experiments the height of capillary rise in a vertical column b tabulated data from the literature e g pk 77 reports 50 100 cm for sandy soils c theoretical comparisons with the vg and other richards equation based models guarracino 2007 smagin 2012 as an example we use the method by smagin 2012 p 158 he selected the inflection point of the vg water retention curve as a limit of tension saturation smagin along with a relation hc 1 α suggested to use hcc hc m1 m where m is the vg constant if we assume the vg sand from the hydrus soil catalogue section 4 then hc 6 9 cm and hcc 5 9 cm next from eq 12 q i a c 2 69 and 2 51 and from eq 11 l 3 83 and 3 59 m for w 10 cm and ks 0 3 cm h if we take hc 50 cm pk 77 her table 5 then q i 8 25 and l 1 25 m a mathematically more involved conjugation of surface hydraulics and 2 d seepage requires the following from the conservation of mass we have an ordinary differential equation ode 13 d q x d x q i x q 0 q 0 q l 0 where evaporation losses from open channel surface are ignored the second governing equation for a shallow flow in the channel we select from the kinematic waves approximation of the saint venant theory see e g eq 3 of furman 2006 14 s s f where sf is a constant manning s friction slope 15 q x s f a x r 2 3 x n m and nm is a constant bed s roughness s m1 3 surface flow obeying eq 15 is gradually varying chow 1959 quasi normal i e locally at each x it obeys the manning equation but the normal depth h decreases gently with x if no seepage all quantities in eq 15 would be constant and flow is normal as we mentioned in section 1 in models of coupled surface subsurface flows the infiltration qi x in eq 13 is commonly assumed to be an empiric function of the geometry of the wetted contour or is postulated as a transient loss term which assumes 1d or quasi 1d seepage from the channel to the best of our knowledge a 2 d vedernikovian 1939 seepage as in fig 4c has not been previously involved in models of coupled flows below we follow vedernikov 1939 and assume that qi depends on the triad w h ks for the analytical model of section 3 or on this triad and additionally on the vg tetrad α n θr θs in the capillary soils of section 4 we differentiate q x for a rectangular channel in eq 15 use the dimensionless quantities introduced in section 3 and put the results into the lhs of eq 13 16 d d x h 1 2 h 2 3 q i x e h 0 h 0 h l 0 e w 2 3 s k s n eq 16 is a boundary value problem for a non linear ordinary 1 st order ode with respect to h the front position l is a part of the solution 5 1 surface flow coupled with analytical infiltration in this subsection we use the exact analytical formula for seepage flow rate in the rhs of ode 14 17 q i x π 2 4 j 1 β h x where j1 is given in eq 8 we solved bvp 16 with its rhs from eq 17 as a cauchy problem we used the ndsolve routine of mathematica the results are shown in fig 9 for a rectangular channel having w 0 1 m and h0 0 01 m laid with a topographic slope s 0 01 in sand having manning s roughness nm 0 02 s m1 3 and the vg hydrus conductivity ks 7 m day therefore in eq 16 e 13108 fig 9 shows h x in particular l 1164 7 or returning to dimensional quantities l 116 5 m 5 2 surface flow coupled with numerical infiltration in this subsection we use hydrus computed qi h as rhs in the ode of bvp 16 in hydrus simulations we selected w 10 cm and varied h from 1 5 cm to 11 cm table 2 below presents the results for sand from the hydrus soil catalogue we used the interpolation routine of mathematica to approximate the results in table 2 the corresponding function converted to dimensionless quantities is shown in fig 6a as curve 3 apparently curves 1 and 3 in fig 6a for a given w and soil both the hydrus and analytical functions qi h are almost linear consequently we use a linear regression to approximate the hydrus infiltration 18 q i h c 1 c 2 h for example for the hydrus case presented in table 2 and curve 3 in fig 6a the regression coefficients are c1 2 61 and c1 3 43 then we put the linear function 18 into the rhs of ode 16 and separate the variables 19 x e h 0 h 1 10 3 u c 1 c 2 u 1 2 u 1 3 d u the integral in eq 19 is evaluated by either the integrate or nintegrate routine of mathematica in fig 9 curve 2 presents h x computed by eq 19 for the same parameters as in section 5 1 this curve shows that for the vg capillary sand in this example l 53 6 m i e more than twice less than for sand of the same ks but without capillarity 6 concluding remarks in our experiments and mathematical models we considered a special type of conjugation of surface and subsurface flows steady state regimes having a finite length l of a free surface jet which propagates along the bed of a rectangular channel dwindling of the channel water level and eventually extinction of the jet is due to seepage into a porous channel bed hydraulic conductivity and capillary properties of the bed impact the visible shape of free surface and l vedernikov s and riesenkampf s theory for 2 d capillarity free and tension saturated seepage with two phreatic surfaces is favourably compared with hydrus simulations both solution methods analytic and fem are applied to a 2d vertical cross section fig 4c that neglects darcy s flow in the ox direction fig 4a generally the depth of free water in the channel decreases down the slope fig 4b in accordance with manning s equation and kinematic wave approximation the lost water depth in the channel is transferred to the soil as a boundary condition for the darcy flow in fig 4c we neglected the ox component of darcy s flux considered seepage in the o1 xy plane only fig 4c that is an approximation recently we studied also by conformal mappings and fem a darcian flow in the o x y plane fig 4 generated by a constant pressure head boundary condition along a wadi bed duddd in fig 4b surface water in which is at a normal manning s flow if both surface and subsurface flows are 3 d then their conjugation seems to be amenable to numerical modelling only gravity and capillarity are facilitators while the soil is a resistor to water motion downstream a topographic slope and downward through the vadose zone which staudinger et al 2019 identified as as a no man s land from the view point of hydrologists and hydrogeologists these three physical factors are amalgamated in a single dimensionless coefficient e which involves the topographic slope channel s width and the darcian manningian frictions are quantifiers of resistance the obtained l can be used for planning mar operations furrow irrigation and assessments of flood waves spreading in long wadis after rainfalls of low intensity when the surface water vanishes somewhere in the middle of the wadi credit authorship contribution statement a al shukaili investigation writing original draft software data curation h al busaidi resources methodology a r kacimov supervision conceptualization writing review editing validation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the research received funding from sultan qaboos university squ ig cams swae 18 01 in addition a al shukaili appreciates the phd scholarship fund from sultan qaboos university helpful comments by three anonymous referees are highly appreciated 
538,in this paper a numerical model is developed based on the x fem technique to simulate the transport of dense solute in a single fluid phase through the fractured porous media the governing equation is based on the mass conservation law which is applied to the fluid phase and the solute in both matrix and fracture domain the integral governing equations of the mass exchange between the fracture and the surrounding matrix is derived the extended finite element method x fem is applied by employing appropriate enrichment functions to model the fractured porous domain the superiority of the x fem is that the fe mesh is not necessary to be conformed to the fracture geometry so the regular mesh is utilized independent of the position of the fracture finally several numerical examples of dense brine transport in a water aquifer are studied to validate the proposed computational algorithm moreover the effects of various parameters of the fracture such as the aperture and interconnectivity as well as the matrix medium such as the permeability and diffusion are investigated it is shown that the proposed computational model provides an accurate prediction of subsurface hydrology for a field scale closed desert basin keywords density driven flow fractured porous media extended fem closed desert basin 1 introduction the variable density groundwater flow process plays an important role in various areas of sub surface contaminant hydrology geo physics oceanography reservoir geo mechanics and waste disposals the discontinuity such as the fracture affects the heterogeneity of the domain and has a major effect on the transport of dense solutes the density driven flow and solute transport is a crucial issue within the fractured porous media in predicting the flow around subsurface waste storages dense contaminant plumes seawater intrusion and other subsurface problems the density driven flow process in porous media has been studied by many researchers during the last three decades however the subject in the field of fractured porous media is still an open area of research the majority of previous research studies have been devoted to simulation of the density driven flow in the absence of fractures in an inclusive review article diersch and kolditz 2002 presented an extensive application of variable density flow phenomena in groundwater hydrology they introduced the governing equations phenomenological laws and numerical methods for the solution of nonlinear problems considering the heterogeneous porous domain simmons et al 2001 demonstrated that the type of heterogeneity in the porous medium significantly affects the propagation of dense plumes pau et al 2010 investigated the effect of heterogeneity on the solute transport process in which a randomly distributed permeability was assumed in porous media an innovative study was performed by shikaze et al 1998 for simulation of the variable density flow and transport in discretely fractured media they indicated that the dense solute plumes can be developed in an irregular pattern however the technique was tremendously a complex task nevertheless their studies were restricted to the regular fracture network including merely vertical and horizontal fractures graf and therrien 2005 2007 2008 studied the variable density groundwater flow and solute transport in porous media containing discrete fractures to take into account the mass exchange between the fracture and porous matrix they applied a set of common nodes between the fracture faces and matrix blocks along the fracture walls within the frac3dvs software moreover the oberbeck boussinesq approximation was applied into the model that considers the density effect only in the buoyancy term of the darcy equation and neglects the density in the mass conservation equations to spatially discretize the governing equations a control volume finite element approach was applied where the geometry of fractures was conformed to the mesh in addition the solution of governing equations was performed by taking the advection molecular diffusion and mechanical dispersion into account in both the fractures and the matrix graf and simmons 2009 modeled the convective fluid flow in fractured porous media and studied the effect of density contrast on the flow pattern tang et al 1981 derived a density invariant analytical solution which was applicable to the source of solute at early time period grillo et al 2010 proposed the density driven flow in the fractured porous domain in which the fracture was assumed as a thin region filled with the porous material whose property was different from the porous medium in their approach two different assumptions were assumed firstly the fractures have the same dimension as the porous matrix and secondly the fractures have low dimensional manifolds accordingly the governing equations were obtained by taking the averaged over the fracture width raad and hassanzadeh 2018 studied the onset of density driven convection in fractured aquifers and investigated the effects of physical properties of the fracture network on the stability of diffusive fronts inside the fractured porous media using the dual porosity concept sebben et al 2015 proposed a numerical model to investigate the influence of fracture orientation location and density on the migration of seawater in a conceptual aquifer they studied the applicability of the equivalent porous media epm model in a simple fracture network under steady state condition it was revealed that the epm model is not sufficient to predict the salinity distribution in the most fractured problems nevertheless the epm method is appropriate for orthogonal fracture network if the fracture density has a high value the aim of this research is to develop a computational model to simulate the transport of dense solute in a single fluid phase through the fractured porous media the presence of fracture in a domain imposes the discontinuity in the field variables or their gradients e g the fluid pressure and mass concentration across the fracture the standard finite element method basically has some difficulties in simulation of fractured domains as the finite element mesh should conform to the fracture geometry and the position of the fracture generally controls the pattern of the mesh in the extended finite element method x fem the discontinuities can be modeled by enriching the conventional finite element approximation with additional functions through the concept of the partition of unity which was introduced in the pioneering work of melenk and babuska 1996 the x fem technique has been employed in modeling of various physical phenomena in last three decades a comprehensive review on the applications of the x fem can be found in khoei 2015 the x fem was proposed by réthoré et al 2007 2008 in simulation of the fracture propagation in saturated and unsaturated porous media considering the passive and active gas phase the implementation of x fem in modeling of fractured porous saturated domain with two fluid phases was developed further by barani et al 2011 mohammadnejad and khoei 2013a 2013b fumagalli and scotti 2013 recently khoei et al 2016 presented that the x fem technique can be successfully employed in modeling the two phase fluid flow in fractured porous media with different capillary saturation functions at the fracture interface in fact the capillary pressure field is continuous across the fracture while the degree of saturation is discontinuous and may take different values at two sides of the fracture as the fracture permeability is higher than the surrounding porous medium in density driven flows the solute concentration and pressure are continuous variables on the fractures but have discontinuous gradients in the normal direction to the interfaces even though the x fem technique has been mostly applied to 2d fluid flows the extension of the technique to 3d problems is straightforward and has its inherent advantages over the standard fem the aim of this study is to model the 2d variable density flow and solute transport in the fractured porous medium using the x fem technique for discretizing the discontinuous domain there are basically two approaches proposed for simulation of the fractured porous domain i e the explicit and implicit methods in explicit method a relatively small domain with a small number of well defined fractures is considered while in the implicit method the equivalent continuum model has been used in the field scale studies in which the effective properties are obtained for a representative equivalent volume rev in the implicit method a boundary value problem is solved for each rev by determination of the equivalent properties such as the permeability matrix in the present study an explicit approach is employed in which the fracture and surrounding porous matrix perform as separate identities and their mutual interaction is carried out using the interface balance condition the governing equations are derived based on the mass conservation law which is applied to the fluid phase and the solute in both matrix and fracture domain furthermore the integral equations of the mass exchange between the fracture and the surrounding matrix is derived and the extended finite element method is applied by employing appropriate enrichment functions to model the fractured porous domain the paper is organized as follows in section 2 the governing equations of the density driven flow in a fractured porous medium are presented the governing equations include the mass conservation equations for the fluid phase and solute together with equations of state and constitutive laws in section 3 the weak form of the governing equations is derived in spatial domain using the extended finite element method and the euler scheme is utilized for the time discretization finally several numerical examples of solute migration are solved in section 4 using the advection and diffusion processes in the two dimensional fractured water aquifers to demonstrate the accuracy and efficiency of the proposed computational algorithm the influence of the density dependent fluids on the flow pattern around the fractures is discussed moreover the effects of fracture properties such as the orientation and aperture as well as the matrix properties such as the permeability and diffusion in field scale problems are investigated 2 physical model 2 1 the strong form consider the domain ω r 2 with the external boundary γ r 1 as depicted in fig 1 in which the domain consists of the porous matrix medium ω m r 2 and the fracture medium ω f h f γ f r 2 it is assumed that the fluid phase contains two components of water and solute that saturates the pores of the medium moreover it is supposed that the flow and transport in the fracture and porous medium are identical the developed 2d density driven model is an approximation of the real 3d problem in which the effects of convection flows inside the fracture medium are ignored the governing equations of the density driven flow are based on the mass conservation laws in the macroscopic continuum the mass conservation law must be applied for each component of the transport process the mass conservation equations for the fluid phase and the solute can be written by neglecting the mass exchange between the fluid and solid phases as 1 t ϕ m ρ ω ρ u m 0 on ω m t ϕ m ρ ω ρ ω u m j m 0 on ω m in which the subscript m stands for the matrix porous medium in these equations ϕm represents the matrix porosity ρ is designated as the fluid density ω is assigned as the mass fraction of the solute j m is the vector of non advective flux accounting for dispersive and diffusive transport and u m is the darcy velocity vector in the matrix medium the fluid velocity vector can be written by neglecting the inertia forces based on the darcy law as 2 u m k m μ p ρ g b in which km is the intrinsic permeability matrix μ is the fluid viscosity p is the pressure of the fluid phase g is the gravity acceleration and b is the unit vector in the direction of body force it is assumed that the fluid viscosity is not a function of the solute mass fraction however the fluid density can be defined as a function of the mass fraction and pressure i e ρ ρ ω p the equation of state eos for the fluid density is linearly approximated as diersch and kolditz 2002 3 ρ ω p ρ 0 1 γ w p p 0 β ω ω 0 where γ w ρ p is the fluid compressibility β ρ ω is the solute expansion coefficient and ρ0 is a reference value for the fluid density at the reference pressure p 0 and reference mass fraction ω0 the non advective mass fluxes of the solute can be commonly expressed according to the fick law as 4 j m ρ d m ω where d m is the hydrodynamic dispersion tensor which is a function of the velocity u m described by the following relationship for the matrix medium as scheidegger 1961 5 d m ϕ m τ d m i α l α t u m u m u m α t u m i where dm is the molecular diffusion coefficient of the matrix τ is the tortuosity of the porous medium i is the identity tensor and α l and α t are the longitudinal and transverse dispersivity lengths respectively hence the governing eq 1 can be rewritten by some manipulations in the convective form over ω m as 6 l m p ω ϕ m β ω ρ γ p ρ k m μ p ρ g b 0 ϕ m ϑ ω ϑ u m ω ρ d m ω 0 where γ ϕ m γ w 1 ϕ m γ ϕ with γw and γϕ denoting the fluid and bulk compressibility respectively and ϑ ωβ ρ note that the time differentiation is represented by mean of the dot symbol similar equations can be derived for the fracture medium the mass conservation equations in the fracture can be written in the coordinate along the fracture x γ as 7 t ϕ f ρ γ ρ u f 0 on ω f t ϕ f ρ ω γ ρ ω u f γ j f 0 on ω f in which the subscript f stands for the fracture medium in above γ is the tangential operator along the fracture ϕf is the fracture porosity equal to unity for the fracture jf is a non advective flux along the fracture and uf is the fluid velocity in the fracture which can be obtained as 8 u f k f μ γ p ρ g b γ k f μ t γ f p ρ g t γ f b where kf is the intrinsic permeability of the fracture that can be obtained for a laminar poiseuille flow using the cubic law by kf hf 2 12 the parameter hf is the aperture of the fracture t γ f is the tangential unit vector in direction of the fracture and b γ is the component of the vector b in direction of the fracture the non advective flux in the fracture can be written as 9 j f ρ d f γ ω ρ d f t γ f ω where d f is defined as d f ϕ f d f α l f u f with df denoting the molecular diffusion in the fracture and α lf indicating the dispersion length along the fracture substituting the constitutive eqs 8 and 9 in governing eq 7 the following convective form can be obtained for the mass conservation equations in the fracture over ω f as 10 l f p ω ϕ f β ω ϕ f ρ γ w p γ ρ k f μ γ p ρ g b γ 0 ϕ f ϑ ω ϑ u f γ ω γ ρ d f γ ω 0 2 2 the weak form the mass conservation laws are derived in eqs 6 and 10 for the matrix and fracture domains to constitute a nonlinear coupled set of initial value partial differentiation equations in which the primary unknowns are the fluid pressure p x t and the mass fraction of the solute ω x t in order to solve the couple governing equations appropriate boundary conditions must be applied on the external boundary γ and the whole domain ω to derive the weak form of the governing equations a weighted residual method is applied as follows 11 ω m w x t l m p ω d ω h f γ f w x t l f p ω d γ 0 in which ω m and γ f represent the matrix medium and fracture boundary respectively and w x t is an arbitrary weight function integrating the above equation over the domain and applying the divergence theorem the weak form of the governing equations can be written as 12 ω m w ϕ m β ω d ω ω m w ρ γ p d ω ω m w ρ k m μ p d ω γ f w h f ϕ f β ω d γ γ f w h f ϕ f ρ γ w p d γ γ f γ ω h f ρ k f μ γ p d γ ω m w ρ 2 g k m μ b d ω γ f γ ω h f ρ 2 g k f μ b γ d γ γ q t w q t d γ ω m w ϕ m ϑ ω d ω ω m w ϑ u m ω d ω ω m w ρ d m ω d ω γ f w h f ϕ f ϑ ω d γ γ f w h f ϑ u f γ ω d γ γ f γ ω h f ρ d f γ ω d γ γ q ω w q ω d γ in which two initial conditions for the pressure and mass fraction fields must be specified in the domain ω as p x t 0 p 0 x and ω x t 0 ω0 x where p 0 x and ω0 x are known values of initial distribution of pressure and mass fraction at the initial time t 0 respectively the essential boundary conditions dirichlet type are prescribed as the values of pressure p x t p t on γ p and mass fraction ω x t ω t on γω the natural boundary conditions neumann type consist of the total mass flux of the fluid phase prescribed as ρ u m n γ q t t on γ q t and the dispersive flux of the solute prescribed as j m n γ q ω t on γ q ω where n γ is the outward directed unit normal vector on the external boundary the external boundary γ is divided into the essential and natural boundaries so that γ ω γ q ω γ p γ q t γ and γ ω γ q ω γ p γ q t 2 3 the x fem discretization the spatial discretization of the weak form is obtained by employing the extended finite element method and the time discretization using the explicit euler method the pressure and mass fraction are continuous over the entire domain however the gradients of both pressure and mass fraction are discontinuous at the normal direction to the fracture as the total fluid flux and dispersive flux of the solute change across the fracture the presence of fracture imposes the so called weak discontinuity in the field of primary unknowns to take this discontinuity into account in the approximation of primary unknowns the standard finite element space must be enriched for the pressure and mass fraction fields by the means of appropriate enrichment function a modified level set function is chosen as the enrichment function which enforces a jump in the gradient of the primary unknown fields across the fracture in fig 2 various types of elements including the standard ridge enriched and junction enriched elements together with the corresponding degrees of freedom are shown the set of all nodes in the domain is defined as n s t d the set of ridge enriched nodes for the elements cut by one fracture is defined as n r i d and the set of junction enriched nodes for the elements cut by two fractures is defined as n j u n thus the approximation of the pressure and mass fraction fields can be defined as a linear combination of the standard and enriched shape functions as follows 13 p x t i n s t d n i x p i t i n r i d n i x ψ x p i t i n j u n n i x j x p i t ω x t i n s t d n i x ω i t i n r i d n i x ψ x ω i t i n j u n n i x j x ω i t in which ni x denotes the standard finite element shape function for node i ψ x is the enriched shape function associated with the modified level set function and j x is the enriched shape function associated with the junction function the degrees of freedom for the primary unknowns are defined as pi t and ω i t corresponding to the set of standard nodes n s t d and p i t and ω i t corresponding to the set of ridge enriched nodes n r i d and p i t and ω i t corresponding to the set of junction enriched nodes n j u n the enriched shape function on the basis of modified level set function the so called ridge function ψ x is defined as khoei 2015 14 ψ x i n r i d n i x φ i i n r i d n i x φ i in which φ i is the nodal value of the signed distance function defined as the signed distance of the node i n r i d from the fracture interface this enrichment function has a ridge centered on the interpolated discontinuity and vanishes in the elements not containing the fracture in order to enrich the elements cut by two fractures the ridged junction function j x is employed consider the primary fracture is denoted by p and the secondary fracture by s the enrichment function j x is defined as khoei 2015 15 j x ψ p x ψ s x in which ψ p x and ψ s x are the ridge functions associated with the primary and secondary fractures respectively this function represents the continuity in the pressure and mass fraction fields while it imposes discontinuity in their derivatives across the primary and secondary fractures the x fem approximation of the enriched primary unknowns in eq 13 can be written in a vector form as 16 p x t n s t d x p t n r i d x p t n j u n x p t n s t d x n r i d x n j u n x p t p t p t t n p ω x t n s t d x ω t n r i d x ω t n j u n x ω t n s t d x n r i d x n j u n x ω t ω t ω t t n w where n std x is the vector of standard shape functions n rid x is the vector of enriched shape functions associated with the ridge function and n jun x is the vector of enriched shape functions associated with the junction function moreover p t and ω t are the vectors of the standard degrees of freedom pi t and ω i t and p t and ω t are the vectors of the enriched degrees of freedom associated with the ridge enriched nodes p i t and ω i t and p t and ω t are the vectors of the enriched degrees of freedom associated with the junction enriched nodes p i t and ω i t in above p p t p t p t t and w ω t ω t ω t t are the complete set of the standard and enriched degrees of freedom for the primary unknowns of pressure and mass fraction respectively in eq 11 the weight function w x t is required to satisfy all essential boundary conditions and to be smooth enough to define the derivatives of equations the weight function is defined in the same approximation space to have the properties of shape functions based on the bubnov galerkin method the finite element shape functions are used as the weighting functions thus the discretized form of the governing equations can be obtained by substituting the x fem approximations 16 into the integral eq 12 as 17 a w b p c p f p d w e w f w where the matrices a through e and the external force vectors f p and f w are defined as follows 18 a ω m n t ϕ m β n d ω γ f n t h f ϕ f β n d γ b ω m n t ρ γ n d ω γ f n t h f ϕ f ρ γ w n d γ c ω m n t ρ k m μ n d ω γ f n t t γ f h f ρ k f μ t γ f t n d γ d ω m n t ϕ m ϑ n d ω γ f n t h f ϕ f ϑ n d γ e ω m n t ϑ u m t n d ω ω m n t ρ d m n d ω γ f n t h f ϑ u f t γ f t n d γ γ f n t t γ f h f ρ d f t γ f t n d γ f p ω m n t ρ 2 g k m μ b d ω γ f n t t γ f h f ρ 2 g k f μ t γ f t b d γ γ q t n t q t d γ f w γ q ω n t q ω d γ to advance the solution over the time the link between the successive values of the unknown field variables at time t n 1 and the known field variables at time tn is established by applying the euler method as follows 19 w n 1 w n 1 w n δ t p n 1 p n 1 p n δ t in which δt t n 1 tn is the time step w n 1 and p n 1 denote the unknown nodal values of pressure and mass fraction at time t n 1 and w n and p n denote the known nodal values of pressure and mass fraction at time tn substituting relations 19 into the spatial discrete eq 17 the following nonlinear equations can be achieved as 20 a δ t w n 1 b δ t c p n 1 f p a δ t w n b δ t p n d δ t e w n 1 f w d δ t w n the set of nonlinear eq 20 can be solved for the primary unknowns w n 1 and p n 1 at each time step using an appropriate approach such as the newton raphson iterative algorithm which linearizes the nonlinear system of equations the related fluid properties i e the density should be updated when the mass fraction and pressure fields are obtained at each iteration 3 numerical simulation results in order to illustrate the accuracy and versatility of the proposed computational algorithm three numerical examples are analyzed in which the density driven transport of the dense solute is investigated in the water aquifer in the first example the salt intrusion at a conceptual fractured porous medium called as the fractured henry problem is modeled to validate the results of the proposed computational model with those reported in the literature in the second example a porous medium containing the network of fractures is modeled where the effects of fracture properties such as the orientation and aperture as well as the matrix properties such as the diffusion and permeability together with the density contrast and different convection regimes are investigated on the pattern of the solute transport the last example is chosen to demonstrate the efficiency of the proposed computational algorithm in simulation of the solute transport in a field scale conceptual model of the naturally fractured closed desert basin where different convention phenomena can be occurred based on the climate conditions 3 1 the density driven flow in a porous medium with fractures the fractured henry problem in order to demonstrate the effects of fracture properties on the flow pattern a modified version of the henry problem is solved considering various patterns of the fracture the domain is a rectangular shape of 2 1 m2 with different positions of the facture on the right boundary the zero flux is imposed on the top and bottom boundaries with ω n 0 and p n 0 the dirichlet boundary condition is assumed for the solute by employing the zero mass fraction on the left edge and the unity mass fraction on the right boundary the pressure on the right edge is assumed as the hydrostatic condition and an inward constant flux is applied on the left boundary the domain is initially considered in the static pressure equilibrium and zero mass fraction the geometry and boundary conditions are shown in fig 3 and the material parameters used for the computational model are listed in table 1 the constant time step of 6 sec is applied and the domain is discretized into 0 02 0 02 m2 quadrilateral elements it is assumed that the flow in the fracture does not obey the cubic law so the fracture behaves like a high permeable region and water tends to spread along the fracture consequently the presence of fluid phase alters the velocity field in the domain in order to investigate the influence of the fracture geometry on the flow pattern the four fracture positions are considered including the case a with the horizontal fracture at the endpoints of 1 m 0 875 m and 2 m 0 875 m the case b with the horizontal fracture at the endpoints of 1 m 0 125 m and 2 m 0 125 m the case c with an inclined fracture at the endpoints of 1 m 0 7 m and 2 m 0 5 m and the case d with two inclined fractures where the first fracture is at the endpoints of 1 m 0 25 m and 2 m 0 75 m and the second one is at the endpoints of 1 m 0 75 m and 2 m 0 25 m in fig 4 the mass fraction distributions and the velocity vector directions are presented at the specific time step for each case study in all cases the entrance of freshwater into the fracture from the left edge hinders the spreading of the brine that enters from the right edge into the domain since the incoming brine is heavier than the water it tends to fall down and occupies the lower parts of the domain in fig 5 the variations of the mass fraction and pressure with time are plotted at x 1 5 m along the fracture for the case study a also potted in fig 6 is the variation of the mass fraction with time for the case study c an excellent agreement is achieved between the results of the proposed x fem model and those reported by grillo et al 2010 using a different approach for the fracture analysis 3 2 the density driven flow in a porous medium containing a network of fractures in the next example the density driven flow in a porous medium of 30 10 m2 containing a network of regularly spaced fractures is investigated the influence of various parameters of the matrix and fracture is assessed on migration of the solute and formation of convection cells the geometry and boundary conditions of this example for the flow and transport equations are depicted in fig 7 to examine the effects of fracture interconnectivity two different networks are considered including a network of horizontal and vertical fractures and a network of inclined fractures with the angle of 45 the horizontal and vertical fractures spacing at both networks are assumed as 1 m and the fractures have a constant aperture of 50 μm the dirichlet type boundary conditions are imposed for the flow equation on the top edge in which the upstream condition is specified from x 0 to 10 m and the downstream condition from x 20 to 30 m the imposed hydraulic gradient determines the flow regime and development of convection cells while the pressure is set to the constant value of p down ρ w g at the downstream boundary three different values of pressure are specified at the upstream boundary including 1 the forced convection with p up 5ρ w g 2 the mixed convection with p up 2ρ w g and 3 the free convection with p up ρ w g all remaining boundaries for the flow are considered as impermeable for the transport of the solute the upstream boundary is specified as the dirichlet boundary condition with the mass fraction equal to unity which corresponds to the brine density and all other boundaries for the solute transport are set to zero dispersive flux boundaries the pressure is initially assumed as the hydrostatic throughout the domain and the initial mass fraction of the solute is set to zero the domain is discretized spatially to a uniform mesh containing 30 000 four noded quadrilateral elements with the dimension of 0 1 m this spatial discretization is obtained from the successive grid refinement until the simulated contours remained unchanged the list of physical properties of the porous medium fluid and fractures are summarized in table 2 these parameters are held constant throughout all simulations unless otherwise stated 3 2 1 the effect of density contrast the first case study is aimed to investigate the effect of density contrast on the solute transport at different flow regimes and different fracture networks in fig 8 the mass fraction distributions and the corresponding streamlines are presented for the vertical and horizontal fracture network using β 200 at t 5 years for three different pressure cases at the upstream boundary i e the forced convection the mixed convection and the free convection also shown in fig 8 are the mass fraction distributions for the vertical and horizontal fracture network using β 0 at t 5 years obviously fig 8 represents the transport of the dense brine while fig 9 illustrates the transport of the neutral density brine a comparison between figs 8 and 9 reveals that the transport of the dense brine is greater than the neutral density brine for different flow regimes in both downward and lateral directions however the similarity between figs 8 a and 9 a is due to the fact that when the imposed hydraulic gradient is greatly high the forced convection is more dominant mechanism of the solute transport comparing to the free convection condition induced by the solute density gradient moreover there are no obvious convection cells in the streamlines for the forced convection regime in addition the transport of the neutral density brine is not significant in comparison to the dense solute by decreasing the hydraulic gradient over the domain accordingly the importance of the density contrast can be revealed hence the free convection plays an important role in the transport of solute as the hydraulic gradient reduces clearly the overall depth of penetration of the dense plume is higher than that of the neutral density furthermore some local convection cells can be observed in the matrix blocks for the mixed convection flow regime it can be highlighted that if the hydraulic gradient is not imposed the only mechanism for solute transport is the free convection due to density gradient thus the minimum transport can be occurred by the molecular diffusion at neutral density case however several oversized convection cells are developed in the case of dense solute whereby the solute front penetrates deeply in fact the dense solute transfers downward in some fractures while it enforces the freshwater to migrate upward in other adjacent fractures the convection cells at the free convection regime is greater than those of mixed convection regime and its circulation path includes several matrix blocks and the total depth of the domain similar results can be observed for the inclined fracture network as shown in fig 10 in this figure the distributions of mass fraction and the corresponding streamlines are presented using β 200 at t 5 years for three different pressure cases at the upstream boundary i e the forced convection the mixed convection and the free convection 3 2 2 the effects of diffusion permeability and fracture aperture in order to assess the impact of crucial parameters such as the diffusion permeability and fracture aperture on the variable density flow several numerical simulations are performed for two fracture networks and the results are compared with the original case discussed in preceding section all simulations are examined by variation of one parameter while other parameters remain unchanged at their base value only the mixed convection regime is considered in this section the material parameters are chosen as stated in table 3 for all numerical simulations in figs 11 and 12 the contours of mass fraction distribution are presented for two values of diffusion permeability and fracture aperture after 5 years using two fracture networks the numerical simulations indicate that the large diffusion coefficient small fracture aperture and low matrix permeability hinder the solute transport at the fractured medium it can be seen that the diffusion rate of the solute from the factures into the surrounding porous matrix directly depends on the molecular diffusion coefficient on the other hand the high diffusion rate leads to the lower solute transport within the fractures however a low diffusion rate causes the concentration of solute in the fractures and leads to the high density dependent transport within the fractures hence the solute migrates deeper into the aquifers with the low diffusion coefficient this behavior can be seen in the case studies a and b in figs 11 and 12 moreover it must be noted that the flow velocity in aquifer is dependent on both fracture aperture and matrix permeability in fact the high matrix permeability and large fracture aperture are preferred in a variable density flow and improve the solute transport furthermore the rapid flow in the matrix causes the generation of rapid flow in the opposite direction within the fractures that leads to a complete convection cell as a result the magnitude of the flow velocity in the porous matrix controls the transport rate in the fractures 3 3 the density driven flow in a naturally fractured closed desert basin in the last example the performance of the proposed computational algorithm is presented in simulation of the solute transport in a field scale problem of the naturally fractured closed desert basin the cross section of a half desert basin which is surrounded by mountains on the left side and by the playa on the right side is shown in fig 13 as precipitation occurs it pours on the mountains and penetrates into the groundwater then drains into the playa from the hinge area this flow path is defined as the forced convention flow another type of convection path can occur as the evaporation concentrates the lake solution the dense brine flows into the underlying freshwater and extends to the left side after mixing with the freshwater in the forced convection path it reverts to the playa surface this convection path is shown in fig 13 as the free convection flow in fig 14 the rectangular domain is shown as an approximation of the cross section of a half closed basin aquifer the field is defined as the vertical two dimensional flow in the homogenous isotropic porous medium with the thickness of 1 3 km and horizontal length of 13 km the length of recharge zone σ is 0 74 of the total length and half length of ephemeral salt lake η is assumed to be 0 06 of the total length the bottom and sides of the domain are considered to be impermeable to both water and solute the geological parameters of the basin are summarized in table 3 these data and external boundary conditions on the top side of the domain are chosen according to the field data of the pilot valley located in western utah which was reported by duffy and al hassan 1988 and fan et al 1997 in order to avoid the difficulties of locating the water table and handling the unsaturated area the mountain section is excluded from the flow domain at the upper left side a net influx is specified on the boundary of freshwater infiltration recharge boundary which is labeled as σ in fig 14 the spatial distribution of the recharge rate is specified by an empirical relation q x σ q 0 1 l x σ a b in which l x σ a b is an incomplete beta function with parameters a 0 561 and b 1 254 for the pilot valley conditions and q 0 is the recharge rate at divide point of x 0 the mass fraction of salt at recharge boundary is assumed to be zero corresponding to the freshwater the atmospheric pressure is specified as p 0 on the surface of the playa discharge boundary in the ephemeral salt lake boundary η the mass fraction is maintained at the maximum mass fraction which corresponds to the brine ω 0 265 representing the mass fraction of the evaporating solution the model domain is discretized into rectangular four noded elements constructed of 80 20 elements the numerical simulation is first carried out for the case that there is no accumulation of salts in the playa ephemeral lake region i e β 0 and ω 0 the steady state pressure field obtained from this case is used as an initial condition for the next numerical simulations which are conducted to investigate the effect of basin scale heterogeneity in solute transport depth the results indicate that the heterogeneity changes the pattern of flow by creating new convection cells in fig 15 the mass fraction distributions and corresponding streamlines are presented after 10 000 years for the closed desert basin with different horizontal fracture layers including no fracture one layer three layers and nine layers of horizontal fracture fig 15 a shows a homogeneous basin with the permeability of km 10 14 m2 the velocity field and salinity contours both indicate that a salt nose has been developed and migrated a distance of 1 2 km beneath the hinge the position of the salt nose provides a measure of the balance between the recharge velocity and the velocity of the density driven flow fig 15 b demonstrates that the result of basin with a single horizontal fracture layer stretches along the basin at mid height obviously the presence of the fracture disturbs the streamlines and the fracture layer behaves like a storage channel below the playa side when the solute front reaches the fracture it accumulates inside the fracture moves horizontally whereas it diffuses into the matrix below the fracture layer thus some additional convection cells are developed in this region on the other side the fresh water enters the fracture layer moves horizontally toward the playa and exits from the fracture layer near the hinge area in figs 15 c and 15 d the number of fracture layers is increased to three and nine layers respectively in order to investigate the effect of density of fracture layers on the convection patterns in the basin in these cases the salt nose completely penetrates the basin and freshwater zone in confined to a thin wedge in these cases the brine completely fills the substance reservoir so the shallow groundwater is saline the solute paths between the fracture layers become completely vertical and the lowest fracture layer is the main conduit which transports the solute horizontally toward the divide side while the topmost fracture layer collects the fresh water from the recharge boundary as well as the water from the lower layers and transfers them toward the hinge area below the lowest fracture layer there is no severe horizontal velocity and the lowest fracture acts like a solute storage from which brine can slowly diffuse into the matrix below the fracture layer thus several local convection cells are developed below the lowest fracture layer 4 conclusion in the present paper a numerical technique was developed based on the framework of the x fem to simulate the density driven fluid flow through the fractured porous media containing fractures the extended finite element method allows for an explicit and accurate representation of fractures by enriching the standard shape functions with appropriate discontinuous functions the discontinuity in the gradient of the pressure and mass fraction across the fracture is taken into account by adding a modified level set function to the standard approximation of the fields several numerical examples of the dense brine transport in a water aquifer were investigated to demonstrate the robustness and accuracy of the proposed computational algorithm the effects of fracture matrix and fluid properties as well as boundary conditions on the pattern of the solute transport were investigated in the proposed case studies the numerical results of these case studies illustrated that when the forced convection is dominant mechanism of the solute transport the solute transport induced by the density contrast is negligible and there is no evident convection cell in the streamlines in the case study with a network of fractures it was revealed that the high diffusion rate causes that the fractures become empty of the solute leading to the lower density driven solute transport within the fractures finally the numerical results of all case studies indicated that the large diffusion coefficient small fracture aperture and low matrix permeability hinder the solute migration at a fractured medium however it must be noted that these conclusions have been observed in the case studies proposed here and may not be extended generally to all density driven flows moreover it is shown that the developed computational model provides a correct prediction of the solute transport in a field scale naturally fractured closed desert basin where different convention regimes can be occurred declaration of competing interest none supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 103453 appendix supplementary materials image application 1 
538,in this paper a numerical model is developed based on the x fem technique to simulate the transport of dense solute in a single fluid phase through the fractured porous media the governing equation is based on the mass conservation law which is applied to the fluid phase and the solute in both matrix and fracture domain the integral governing equations of the mass exchange between the fracture and the surrounding matrix is derived the extended finite element method x fem is applied by employing appropriate enrichment functions to model the fractured porous domain the superiority of the x fem is that the fe mesh is not necessary to be conformed to the fracture geometry so the regular mesh is utilized independent of the position of the fracture finally several numerical examples of dense brine transport in a water aquifer are studied to validate the proposed computational algorithm moreover the effects of various parameters of the fracture such as the aperture and interconnectivity as well as the matrix medium such as the permeability and diffusion are investigated it is shown that the proposed computational model provides an accurate prediction of subsurface hydrology for a field scale closed desert basin keywords density driven flow fractured porous media extended fem closed desert basin 1 introduction the variable density groundwater flow process plays an important role in various areas of sub surface contaminant hydrology geo physics oceanography reservoir geo mechanics and waste disposals the discontinuity such as the fracture affects the heterogeneity of the domain and has a major effect on the transport of dense solutes the density driven flow and solute transport is a crucial issue within the fractured porous media in predicting the flow around subsurface waste storages dense contaminant plumes seawater intrusion and other subsurface problems the density driven flow process in porous media has been studied by many researchers during the last three decades however the subject in the field of fractured porous media is still an open area of research the majority of previous research studies have been devoted to simulation of the density driven flow in the absence of fractures in an inclusive review article diersch and kolditz 2002 presented an extensive application of variable density flow phenomena in groundwater hydrology they introduced the governing equations phenomenological laws and numerical methods for the solution of nonlinear problems considering the heterogeneous porous domain simmons et al 2001 demonstrated that the type of heterogeneity in the porous medium significantly affects the propagation of dense plumes pau et al 2010 investigated the effect of heterogeneity on the solute transport process in which a randomly distributed permeability was assumed in porous media an innovative study was performed by shikaze et al 1998 for simulation of the variable density flow and transport in discretely fractured media they indicated that the dense solute plumes can be developed in an irregular pattern however the technique was tremendously a complex task nevertheless their studies were restricted to the regular fracture network including merely vertical and horizontal fractures graf and therrien 2005 2007 2008 studied the variable density groundwater flow and solute transport in porous media containing discrete fractures to take into account the mass exchange between the fracture and porous matrix they applied a set of common nodes between the fracture faces and matrix blocks along the fracture walls within the frac3dvs software moreover the oberbeck boussinesq approximation was applied into the model that considers the density effect only in the buoyancy term of the darcy equation and neglects the density in the mass conservation equations to spatially discretize the governing equations a control volume finite element approach was applied where the geometry of fractures was conformed to the mesh in addition the solution of governing equations was performed by taking the advection molecular diffusion and mechanical dispersion into account in both the fractures and the matrix graf and simmons 2009 modeled the convective fluid flow in fractured porous media and studied the effect of density contrast on the flow pattern tang et al 1981 derived a density invariant analytical solution which was applicable to the source of solute at early time period grillo et al 2010 proposed the density driven flow in the fractured porous domain in which the fracture was assumed as a thin region filled with the porous material whose property was different from the porous medium in their approach two different assumptions were assumed firstly the fractures have the same dimension as the porous matrix and secondly the fractures have low dimensional manifolds accordingly the governing equations were obtained by taking the averaged over the fracture width raad and hassanzadeh 2018 studied the onset of density driven convection in fractured aquifers and investigated the effects of physical properties of the fracture network on the stability of diffusive fronts inside the fractured porous media using the dual porosity concept sebben et al 2015 proposed a numerical model to investigate the influence of fracture orientation location and density on the migration of seawater in a conceptual aquifer they studied the applicability of the equivalent porous media epm model in a simple fracture network under steady state condition it was revealed that the epm model is not sufficient to predict the salinity distribution in the most fractured problems nevertheless the epm method is appropriate for orthogonal fracture network if the fracture density has a high value the aim of this research is to develop a computational model to simulate the transport of dense solute in a single fluid phase through the fractured porous media the presence of fracture in a domain imposes the discontinuity in the field variables or their gradients e g the fluid pressure and mass concentration across the fracture the standard finite element method basically has some difficulties in simulation of fractured domains as the finite element mesh should conform to the fracture geometry and the position of the fracture generally controls the pattern of the mesh in the extended finite element method x fem the discontinuities can be modeled by enriching the conventional finite element approximation with additional functions through the concept of the partition of unity which was introduced in the pioneering work of melenk and babuska 1996 the x fem technique has been employed in modeling of various physical phenomena in last three decades a comprehensive review on the applications of the x fem can be found in khoei 2015 the x fem was proposed by réthoré et al 2007 2008 in simulation of the fracture propagation in saturated and unsaturated porous media considering the passive and active gas phase the implementation of x fem in modeling of fractured porous saturated domain with two fluid phases was developed further by barani et al 2011 mohammadnejad and khoei 2013a 2013b fumagalli and scotti 2013 recently khoei et al 2016 presented that the x fem technique can be successfully employed in modeling the two phase fluid flow in fractured porous media with different capillary saturation functions at the fracture interface in fact the capillary pressure field is continuous across the fracture while the degree of saturation is discontinuous and may take different values at two sides of the fracture as the fracture permeability is higher than the surrounding porous medium in density driven flows the solute concentration and pressure are continuous variables on the fractures but have discontinuous gradients in the normal direction to the interfaces even though the x fem technique has been mostly applied to 2d fluid flows the extension of the technique to 3d problems is straightforward and has its inherent advantages over the standard fem the aim of this study is to model the 2d variable density flow and solute transport in the fractured porous medium using the x fem technique for discretizing the discontinuous domain there are basically two approaches proposed for simulation of the fractured porous domain i e the explicit and implicit methods in explicit method a relatively small domain with a small number of well defined fractures is considered while in the implicit method the equivalent continuum model has been used in the field scale studies in which the effective properties are obtained for a representative equivalent volume rev in the implicit method a boundary value problem is solved for each rev by determination of the equivalent properties such as the permeability matrix in the present study an explicit approach is employed in which the fracture and surrounding porous matrix perform as separate identities and their mutual interaction is carried out using the interface balance condition the governing equations are derived based on the mass conservation law which is applied to the fluid phase and the solute in both matrix and fracture domain furthermore the integral equations of the mass exchange between the fracture and the surrounding matrix is derived and the extended finite element method is applied by employing appropriate enrichment functions to model the fractured porous domain the paper is organized as follows in section 2 the governing equations of the density driven flow in a fractured porous medium are presented the governing equations include the mass conservation equations for the fluid phase and solute together with equations of state and constitutive laws in section 3 the weak form of the governing equations is derived in spatial domain using the extended finite element method and the euler scheme is utilized for the time discretization finally several numerical examples of solute migration are solved in section 4 using the advection and diffusion processes in the two dimensional fractured water aquifers to demonstrate the accuracy and efficiency of the proposed computational algorithm the influence of the density dependent fluids on the flow pattern around the fractures is discussed moreover the effects of fracture properties such as the orientation and aperture as well as the matrix properties such as the permeability and diffusion in field scale problems are investigated 2 physical model 2 1 the strong form consider the domain ω r 2 with the external boundary γ r 1 as depicted in fig 1 in which the domain consists of the porous matrix medium ω m r 2 and the fracture medium ω f h f γ f r 2 it is assumed that the fluid phase contains two components of water and solute that saturates the pores of the medium moreover it is supposed that the flow and transport in the fracture and porous medium are identical the developed 2d density driven model is an approximation of the real 3d problem in which the effects of convection flows inside the fracture medium are ignored the governing equations of the density driven flow are based on the mass conservation laws in the macroscopic continuum the mass conservation law must be applied for each component of the transport process the mass conservation equations for the fluid phase and the solute can be written by neglecting the mass exchange between the fluid and solid phases as 1 t ϕ m ρ ω ρ u m 0 on ω m t ϕ m ρ ω ρ ω u m j m 0 on ω m in which the subscript m stands for the matrix porous medium in these equations ϕm represents the matrix porosity ρ is designated as the fluid density ω is assigned as the mass fraction of the solute j m is the vector of non advective flux accounting for dispersive and diffusive transport and u m is the darcy velocity vector in the matrix medium the fluid velocity vector can be written by neglecting the inertia forces based on the darcy law as 2 u m k m μ p ρ g b in which km is the intrinsic permeability matrix μ is the fluid viscosity p is the pressure of the fluid phase g is the gravity acceleration and b is the unit vector in the direction of body force it is assumed that the fluid viscosity is not a function of the solute mass fraction however the fluid density can be defined as a function of the mass fraction and pressure i e ρ ρ ω p the equation of state eos for the fluid density is linearly approximated as diersch and kolditz 2002 3 ρ ω p ρ 0 1 γ w p p 0 β ω ω 0 where γ w ρ p is the fluid compressibility β ρ ω is the solute expansion coefficient and ρ0 is a reference value for the fluid density at the reference pressure p 0 and reference mass fraction ω0 the non advective mass fluxes of the solute can be commonly expressed according to the fick law as 4 j m ρ d m ω where d m is the hydrodynamic dispersion tensor which is a function of the velocity u m described by the following relationship for the matrix medium as scheidegger 1961 5 d m ϕ m τ d m i α l α t u m u m u m α t u m i where dm is the molecular diffusion coefficient of the matrix τ is the tortuosity of the porous medium i is the identity tensor and α l and α t are the longitudinal and transverse dispersivity lengths respectively hence the governing eq 1 can be rewritten by some manipulations in the convective form over ω m as 6 l m p ω ϕ m β ω ρ γ p ρ k m μ p ρ g b 0 ϕ m ϑ ω ϑ u m ω ρ d m ω 0 where γ ϕ m γ w 1 ϕ m γ ϕ with γw and γϕ denoting the fluid and bulk compressibility respectively and ϑ ωβ ρ note that the time differentiation is represented by mean of the dot symbol similar equations can be derived for the fracture medium the mass conservation equations in the fracture can be written in the coordinate along the fracture x γ as 7 t ϕ f ρ γ ρ u f 0 on ω f t ϕ f ρ ω γ ρ ω u f γ j f 0 on ω f in which the subscript f stands for the fracture medium in above γ is the tangential operator along the fracture ϕf is the fracture porosity equal to unity for the fracture jf is a non advective flux along the fracture and uf is the fluid velocity in the fracture which can be obtained as 8 u f k f μ γ p ρ g b γ k f μ t γ f p ρ g t γ f b where kf is the intrinsic permeability of the fracture that can be obtained for a laminar poiseuille flow using the cubic law by kf hf 2 12 the parameter hf is the aperture of the fracture t γ f is the tangential unit vector in direction of the fracture and b γ is the component of the vector b in direction of the fracture the non advective flux in the fracture can be written as 9 j f ρ d f γ ω ρ d f t γ f ω where d f is defined as d f ϕ f d f α l f u f with df denoting the molecular diffusion in the fracture and α lf indicating the dispersion length along the fracture substituting the constitutive eqs 8 and 9 in governing eq 7 the following convective form can be obtained for the mass conservation equations in the fracture over ω f as 10 l f p ω ϕ f β ω ϕ f ρ γ w p γ ρ k f μ γ p ρ g b γ 0 ϕ f ϑ ω ϑ u f γ ω γ ρ d f γ ω 0 2 2 the weak form the mass conservation laws are derived in eqs 6 and 10 for the matrix and fracture domains to constitute a nonlinear coupled set of initial value partial differentiation equations in which the primary unknowns are the fluid pressure p x t and the mass fraction of the solute ω x t in order to solve the couple governing equations appropriate boundary conditions must be applied on the external boundary γ and the whole domain ω to derive the weak form of the governing equations a weighted residual method is applied as follows 11 ω m w x t l m p ω d ω h f γ f w x t l f p ω d γ 0 in which ω m and γ f represent the matrix medium and fracture boundary respectively and w x t is an arbitrary weight function integrating the above equation over the domain and applying the divergence theorem the weak form of the governing equations can be written as 12 ω m w ϕ m β ω d ω ω m w ρ γ p d ω ω m w ρ k m μ p d ω γ f w h f ϕ f β ω d γ γ f w h f ϕ f ρ γ w p d γ γ f γ ω h f ρ k f μ γ p d γ ω m w ρ 2 g k m μ b d ω γ f γ ω h f ρ 2 g k f μ b γ d γ γ q t w q t d γ ω m w ϕ m ϑ ω d ω ω m w ϑ u m ω d ω ω m w ρ d m ω d ω γ f w h f ϕ f ϑ ω d γ γ f w h f ϑ u f γ ω d γ γ f γ ω h f ρ d f γ ω d γ γ q ω w q ω d γ in which two initial conditions for the pressure and mass fraction fields must be specified in the domain ω as p x t 0 p 0 x and ω x t 0 ω0 x where p 0 x and ω0 x are known values of initial distribution of pressure and mass fraction at the initial time t 0 respectively the essential boundary conditions dirichlet type are prescribed as the values of pressure p x t p t on γ p and mass fraction ω x t ω t on γω the natural boundary conditions neumann type consist of the total mass flux of the fluid phase prescribed as ρ u m n γ q t t on γ q t and the dispersive flux of the solute prescribed as j m n γ q ω t on γ q ω where n γ is the outward directed unit normal vector on the external boundary the external boundary γ is divided into the essential and natural boundaries so that γ ω γ q ω γ p γ q t γ and γ ω γ q ω γ p γ q t 2 3 the x fem discretization the spatial discretization of the weak form is obtained by employing the extended finite element method and the time discretization using the explicit euler method the pressure and mass fraction are continuous over the entire domain however the gradients of both pressure and mass fraction are discontinuous at the normal direction to the fracture as the total fluid flux and dispersive flux of the solute change across the fracture the presence of fracture imposes the so called weak discontinuity in the field of primary unknowns to take this discontinuity into account in the approximation of primary unknowns the standard finite element space must be enriched for the pressure and mass fraction fields by the means of appropriate enrichment function a modified level set function is chosen as the enrichment function which enforces a jump in the gradient of the primary unknown fields across the fracture in fig 2 various types of elements including the standard ridge enriched and junction enriched elements together with the corresponding degrees of freedom are shown the set of all nodes in the domain is defined as n s t d the set of ridge enriched nodes for the elements cut by one fracture is defined as n r i d and the set of junction enriched nodes for the elements cut by two fractures is defined as n j u n thus the approximation of the pressure and mass fraction fields can be defined as a linear combination of the standard and enriched shape functions as follows 13 p x t i n s t d n i x p i t i n r i d n i x ψ x p i t i n j u n n i x j x p i t ω x t i n s t d n i x ω i t i n r i d n i x ψ x ω i t i n j u n n i x j x ω i t in which ni x denotes the standard finite element shape function for node i ψ x is the enriched shape function associated with the modified level set function and j x is the enriched shape function associated with the junction function the degrees of freedom for the primary unknowns are defined as pi t and ω i t corresponding to the set of standard nodes n s t d and p i t and ω i t corresponding to the set of ridge enriched nodes n r i d and p i t and ω i t corresponding to the set of junction enriched nodes n j u n the enriched shape function on the basis of modified level set function the so called ridge function ψ x is defined as khoei 2015 14 ψ x i n r i d n i x φ i i n r i d n i x φ i in which φ i is the nodal value of the signed distance function defined as the signed distance of the node i n r i d from the fracture interface this enrichment function has a ridge centered on the interpolated discontinuity and vanishes in the elements not containing the fracture in order to enrich the elements cut by two fractures the ridged junction function j x is employed consider the primary fracture is denoted by p and the secondary fracture by s the enrichment function j x is defined as khoei 2015 15 j x ψ p x ψ s x in which ψ p x and ψ s x are the ridge functions associated with the primary and secondary fractures respectively this function represents the continuity in the pressure and mass fraction fields while it imposes discontinuity in their derivatives across the primary and secondary fractures the x fem approximation of the enriched primary unknowns in eq 13 can be written in a vector form as 16 p x t n s t d x p t n r i d x p t n j u n x p t n s t d x n r i d x n j u n x p t p t p t t n p ω x t n s t d x ω t n r i d x ω t n j u n x ω t n s t d x n r i d x n j u n x ω t ω t ω t t n w where n std x is the vector of standard shape functions n rid x is the vector of enriched shape functions associated with the ridge function and n jun x is the vector of enriched shape functions associated with the junction function moreover p t and ω t are the vectors of the standard degrees of freedom pi t and ω i t and p t and ω t are the vectors of the enriched degrees of freedom associated with the ridge enriched nodes p i t and ω i t and p t and ω t are the vectors of the enriched degrees of freedom associated with the junction enriched nodes p i t and ω i t in above p p t p t p t t and w ω t ω t ω t t are the complete set of the standard and enriched degrees of freedom for the primary unknowns of pressure and mass fraction respectively in eq 11 the weight function w x t is required to satisfy all essential boundary conditions and to be smooth enough to define the derivatives of equations the weight function is defined in the same approximation space to have the properties of shape functions based on the bubnov galerkin method the finite element shape functions are used as the weighting functions thus the discretized form of the governing equations can be obtained by substituting the x fem approximations 16 into the integral eq 12 as 17 a w b p c p f p d w e w f w where the matrices a through e and the external force vectors f p and f w are defined as follows 18 a ω m n t ϕ m β n d ω γ f n t h f ϕ f β n d γ b ω m n t ρ γ n d ω γ f n t h f ϕ f ρ γ w n d γ c ω m n t ρ k m μ n d ω γ f n t t γ f h f ρ k f μ t γ f t n d γ d ω m n t ϕ m ϑ n d ω γ f n t h f ϕ f ϑ n d γ e ω m n t ϑ u m t n d ω ω m n t ρ d m n d ω γ f n t h f ϑ u f t γ f t n d γ γ f n t t γ f h f ρ d f t γ f t n d γ f p ω m n t ρ 2 g k m μ b d ω γ f n t t γ f h f ρ 2 g k f μ t γ f t b d γ γ q t n t q t d γ f w γ q ω n t q ω d γ to advance the solution over the time the link between the successive values of the unknown field variables at time t n 1 and the known field variables at time tn is established by applying the euler method as follows 19 w n 1 w n 1 w n δ t p n 1 p n 1 p n δ t in which δt t n 1 tn is the time step w n 1 and p n 1 denote the unknown nodal values of pressure and mass fraction at time t n 1 and w n and p n denote the known nodal values of pressure and mass fraction at time tn substituting relations 19 into the spatial discrete eq 17 the following nonlinear equations can be achieved as 20 a δ t w n 1 b δ t c p n 1 f p a δ t w n b δ t p n d δ t e w n 1 f w d δ t w n the set of nonlinear eq 20 can be solved for the primary unknowns w n 1 and p n 1 at each time step using an appropriate approach such as the newton raphson iterative algorithm which linearizes the nonlinear system of equations the related fluid properties i e the density should be updated when the mass fraction and pressure fields are obtained at each iteration 3 numerical simulation results in order to illustrate the accuracy and versatility of the proposed computational algorithm three numerical examples are analyzed in which the density driven transport of the dense solute is investigated in the water aquifer in the first example the salt intrusion at a conceptual fractured porous medium called as the fractured henry problem is modeled to validate the results of the proposed computational model with those reported in the literature in the second example a porous medium containing the network of fractures is modeled where the effects of fracture properties such as the orientation and aperture as well as the matrix properties such as the diffusion and permeability together with the density contrast and different convection regimes are investigated on the pattern of the solute transport the last example is chosen to demonstrate the efficiency of the proposed computational algorithm in simulation of the solute transport in a field scale conceptual model of the naturally fractured closed desert basin where different convention phenomena can be occurred based on the climate conditions 3 1 the density driven flow in a porous medium with fractures the fractured henry problem in order to demonstrate the effects of fracture properties on the flow pattern a modified version of the henry problem is solved considering various patterns of the fracture the domain is a rectangular shape of 2 1 m2 with different positions of the facture on the right boundary the zero flux is imposed on the top and bottom boundaries with ω n 0 and p n 0 the dirichlet boundary condition is assumed for the solute by employing the zero mass fraction on the left edge and the unity mass fraction on the right boundary the pressure on the right edge is assumed as the hydrostatic condition and an inward constant flux is applied on the left boundary the domain is initially considered in the static pressure equilibrium and zero mass fraction the geometry and boundary conditions are shown in fig 3 and the material parameters used for the computational model are listed in table 1 the constant time step of 6 sec is applied and the domain is discretized into 0 02 0 02 m2 quadrilateral elements it is assumed that the flow in the fracture does not obey the cubic law so the fracture behaves like a high permeable region and water tends to spread along the fracture consequently the presence of fluid phase alters the velocity field in the domain in order to investigate the influence of the fracture geometry on the flow pattern the four fracture positions are considered including the case a with the horizontal fracture at the endpoints of 1 m 0 875 m and 2 m 0 875 m the case b with the horizontal fracture at the endpoints of 1 m 0 125 m and 2 m 0 125 m the case c with an inclined fracture at the endpoints of 1 m 0 7 m and 2 m 0 5 m and the case d with two inclined fractures where the first fracture is at the endpoints of 1 m 0 25 m and 2 m 0 75 m and the second one is at the endpoints of 1 m 0 75 m and 2 m 0 25 m in fig 4 the mass fraction distributions and the velocity vector directions are presented at the specific time step for each case study in all cases the entrance of freshwater into the fracture from the left edge hinders the spreading of the brine that enters from the right edge into the domain since the incoming brine is heavier than the water it tends to fall down and occupies the lower parts of the domain in fig 5 the variations of the mass fraction and pressure with time are plotted at x 1 5 m along the fracture for the case study a also potted in fig 6 is the variation of the mass fraction with time for the case study c an excellent agreement is achieved between the results of the proposed x fem model and those reported by grillo et al 2010 using a different approach for the fracture analysis 3 2 the density driven flow in a porous medium containing a network of fractures in the next example the density driven flow in a porous medium of 30 10 m2 containing a network of regularly spaced fractures is investigated the influence of various parameters of the matrix and fracture is assessed on migration of the solute and formation of convection cells the geometry and boundary conditions of this example for the flow and transport equations are depicted in fig 7 to examine the effects of fracture interconnectivity two different networks are considered including a network of horizontal and vertical fractures and a network of inclined fractures with the angle of 45 the horizontal and vertical fractures spacing at both networks are assumed as 1 m and the fractures have a constant aperture of 50 μm the dirichlet type boundary conditions are imposed for the flow equation on the top edge in which the upstream condition is specified from x 0 to 10 m and the downstream condition from x 20 to 30 m the imposed hydraulic gradient determines the flow regime and development of convection cells while the pressure is set to the constant value of p down ρ w g at the downstream boundary three different values of pressure are specified at the upstream boundary including 1 the forced convection with p up 5ρ w g 2 the mixed convection with p up 2ρ w g and 3 the free convection with p up ρ w g all remaining boundaries for the flow are considered as impermeable for the transport of the solute the upstream boundary is specified as the dirichlet boundary condition with the mass fraction equal to unity which corresponds to the brine density and all other boundaries for the solute transport are set to zero dispersive flux boundaries the pressure is initially assumed as the hydrostatic throughout the domain and the initial mass fraction of the solute is set to zero the domain is discretized spatially to a uniform mesh containing 30 000 four noded quadrilateral elements with the dimension of 0 1 m this spatial discretization is obtained from the successive grid refinement until the simulated contours remained unchanged the list of physical properties of the porous medium fluid and fractures are summarized in table 2 these parameters are held constant throughout all simulations unless otherwise stated 3 2 1 the effect of density contrast the first case study is aimed to investigate the effect of density contrast on the solute transport at different flow regimes and different fracture networks in fig 8 the mass fraction distributions and the corresponding streamlines are presented for the vertical and horizontal fracture network using β 200 at t 5 years for three different pressure cases at the upstream boundary i e the forced convection the mixed convection and the free convection also shown in fig 8 are the mass fraction distributions for the vertical and horizontal fracture network using β 0 at t 5 years obviously fig 8 represents the transport of the dense brine while fig 9 illustrates the transport of the neutral density brine a comparison between figs 8 and 9 reveals that the transport of the dense brine is greater than the neutral density brine for different flow regimes in both downward and lateral directions however the similarity between figs 8 a and 9 a is due to the fact that when the imposed hydraulic gradient is greatly high the forced convection is more dominant mechanism of the solute transport comparing to the free convection condition induced by the solute density gradient moreover there are no obvious convection cells in the streamlines for the forced convection regime in addition the transport of the neutral density brine is not significant in comparison to the dense solute by decreasing the hydraulic gradient over the domain accordingly the importance of the density contrast can be revealed hence the free convection plays an important role in the transport of solute as the hydraulic gradient reduces clearly the overall depth of penetration of the dense plume is higher than that of the neutral density furthermore some local convection cells can be observed in the matrix blocks for the mixed convection flow regime it can be highlighted that if the hydraulic gradient is not imposed the only mechanism for solute transport is the free convection due to density gradient thus the minimum transport can be occurred by the molecular diffusion at neutral density case however several oversized convection cells are developed in the case of dense solute whereby the solute front penetrates deeply in fact the dense solute transfers downward in some fractures while it enforces the freshwater to migrate upward in other adjacent fractures the convection cells at the free convection regime is greater than those of mixed convection regime and its circulation path includes several matrix blocks and the total depth of the domain similar results can be observed for the inclined fracture network as shown in fig 10 in this figure the distributions of mass fraction and the corresponding streamlines are presented using β 200 at t 5 years for three different pressure cases at the upstream boundary i e the forced convection the mixed convection and the free convection 3 2 2 the effects of diffusion permeability and fracture aperture in order to assess the impact of crucial parameters such as the diffusion permeability and fracture aperture on the variable density flow several numerical simulations are performed for two fracture networks and the results are compared with the original case discussed in preceding section all simulations are examined by variation of one parameter while other parameters remain unchanged at their base value only the mixed convection regime is considered in this section the material parameters are chosen as stated in table 3 for all numerical simulations in figs 11 and 12 the contours of mass fraction distribution are presented for two values of diffusion permeability and fracture aperture after 5 years using two fracture networks the numerical simulations indicate that the large diffusion coefficient small fracture aperture and low matrix permeability hinder the solute transport at the fractured medium it can be seen that the diffusion rate of the solute from the factures into the surrounding porous matrix directly depends on the molecular diffusion coefficient on the other hand the high diffusion rate leads to the lower solute transport within the fractures however a low diffusion rate causes the concentration of solute in the fractures and leads to the high density dependent transport within the fractures hence the solute migrates deeper into the aquifers with the low diffusion coefficient this behavior can be seen in the case studies a and b in figs 11 and 12 moreover it must be noted that the flow velocity in aquifer is dependent on both fracture aperture and matrix permeability in fact the high matrix permeability and large fracture aperture are preferred in a variable density flow and improve the solute transport furthermore the rapid flow in the matrix causes the generation of rapid flow in the opposite direction within the fractures that leads to a complete convection cell as a result the magnitude of the flow velocity in the porous matrix controls the transport rate in the fractures 3 3 the density driven flow in a naturally fractured closed desert basin in the last example the performance of the proposed computational algorithm is presented in simulation of the solute transport in a field scale problem of the naturally fractured closed desert basin the cross section of a half desert basin which is surrounded by mountains on the left side and by the playa on the right side is shown in fig 13 as precipitation occurs it pours on the mountains and penetrates into the groundwater then drains into the playa from the hinge area this flow path is defined as the forced convention flow another type of convection path can occur as the evaporation concentrates the lake solution the dense brine flows into the underlying freshwater and extends to the left side after mixing with the freshwater in the forced convection path it reverts to the playa surface this convection path is shown in fig 13 as the free convection flow in fig 14 the rectangular domain is shown as an approximation of the cross section of a half closed basin aquifer the field is defined as the vertical two dimensional flow in the homogenous isotropic porous medium with the thickness of 1 3 km and horizontal length of 13 km the length of recharge zone σ is 0 74 of the total length and half length of ephemeral salt lake η is assumed to be 0 06 of the total length the bottom and sides of the domain are considered to be impermeable to both water and solute the geological parameters of the basin are summarized in table 3 these data and external boundary conditions on the top side of the domain are chosen according to the field data of the pilot valley located in western utah which was reported by duffy and al hassan 1988 and fan et al 1997 in order to avoid the difficulties of locating the water table and handling the unsaturated area the mountain section is excluded from the flow domain at the upper left side a net influx is specified on the boundary of freshwater infiltration recharge boundary which is labeled as σ in fig 14 the spatial distribution of the recharge rate is specified by an empirical relation q x σ q 0 1 l x σ a b in which l x σ a b is an incomplete beta function with parameters a 0 561 and b 1 254 for the pilot valley conditions and q 0 is the recharge rate at divide point of x 0 the mass fraction of salt at recharge boundary is assumed to be zero corresponding to the freshwater the atmospheric pressure is specified as p 0 on the surface of the playa discharge boundary in the ephemeral salt lake boundary η the mass fraction is maintained at the maximum mass fraction which corresponds to the brine ω 0 265 representing the mass fraction of the evaporating solution the model domain is discretized into rectangular four noded elements constructed of 80 20 elements the numerical simulation is first carried out for the case that there is no accumulation of salts in the playa ephemeral lake region i e β 0 and ω 0 the steady state pressure field obtained from this case is used as an initial condition for the next numerical simulations which are conducted to investigate the effect of basin scale heterogeneity in solute transport depth the results indicate that the heterogeneity changes the pattern of flow by creating new convection cells in fig 15 the mass fraction distributions and corresponding streamlines are presented after 10 000 years for the closed desert basin with different horizontal fracture layers including no fracture one layer three layers and nine layers of horizontal fracture fig 15 a shows a homogeneous basin with the permeability of km 10 14 m2 the velocity field and salinity contours both indicate that a salt nose has been developed and migrated a distance of 1 2 km beneath the hinge the position of the salt nose provides a measure of the balance between the recharge velocity and the velocity of the density driven flow fig 15 b demonstrates that the result of basin with a single horizontal fracture layer stretches along the basin at mid height obviously the presence of the fracture disturbs the streamlines and the fracture layer behaves like a storage channel below the playa side when the solute front reaches the fracture it accumulates inside the fracture moves horizontally whereas it diffuses into the matrix below the fracture layer thus some additional convection cells are developed in this region on the other side the fresh water enters the fracture layer moves horizontally toward the playa and exits from the fracture layer near the hinge area in figs 15 c and 15 d the number of fracture layers is increased to three and nine layers respectively in order to investigate the effect of density of fracture layers on the convection patterns in the basin in these cases the salt nose completely penetrates the basin and freshwater zone in confined to a thin wedge in these cases the brine completely fills the substance reservoir so the shallow groundwater is saline the solute paths between the fracture layers become completely vertical and the lowest fracture layer is the main conduit which transports the solute horizontally toward the divide side while the topmost fracture layer collects the fresh water from the recharge boundary as well as the water from the lower layers and transfers them toward the hinge area below the lowest fracture layer there is no severe horizontal velocity and the lowest fracture acts like a solute storage from which brine can slowly diffuse into the matrix below the fracture layer thus several local convection cells are developed below the lowest fracture layer 4 conclusion in the present paper a numerical technique was developed based on the framework of the x fem to simulate the density driven fluid flow through the fractured porous media containing fractures the extended finite element method allows for an explicit and accurate representation of fractures by enriching the standard shape functions with appropriate discontinuous functions the discontinuity in the gradient of the pressure and mass fraction across the fracture is taken into account by adding a modified level set function to the standard approximation of the fields several numerical examples of the dense brine transport in a water aquifer were investigated to demonstrate the robustness and accuracy of the proposed computational algorithm the effects of fracture matrix and fluid properties as well as boundary conditions on the pattern of the solute transport were investigated in the proposed case studies the numerical results of these case studies illustrated that when the forced convection is dominant mechanism of the solute transport the solute transport induced by the density contrast is negligible and there is no evident convection cell in the streamlines in the case study with a network of fractures it was revealed that the high diffusion rate causes that the fractures become empty of the solute leading to the lower density driven solute transport within the fractures finally the numerical results of all case studies indicated that the large diffusion coefficient small fracture aperture and low matrix permeability hinder the solute migration at a fractured medium however it must be noted that these conclusions have been observed in the case studies proposed here and may not be extended generally to all density driven flows moreover it is shown that the developed computational model provides a correct prediction of the solute transport in a field scale naturally fractured closed desert basin where different convention regimes can be occurred declaration of competing interest none supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2019 103453 appendix supplementary materials image application 1 
539,a novel differential porosity model for urban flooding namely the binary single porosity model bsp is proposed in the present paper the bsp model which is derived from the single porosity sp model by constraining the porosity to attain only the values zero inside the buildings and one in the voids among the buildings is local and independent on the existence of a representative elementary volume rev the bsp model satisfies the galilean invariance while the corresponding wave speeds are identical to those of the shallow water equations model and its integral formulation coincides with the original integral model by sanders et al 2008 the structure of the bsp model implies that the solution of the sp riemann problem is the numerical building block for the construction of the corresponding finite volume schemes this observation prompts a further study of the sp model and its solutions demonstrating that the exact sp riemann problem solution has the potential to take into account the transient energy losses due to wave reflections through the urban fabric in bsp models nonetheless a further comparison with the two dimensional swe results demonstrates that additional stationary energy dissipations must be accurately taken into account through porosity reductions in the case of supercritical flow the numerical experiments show that available approximate sp riemann solvers may cause a systematic underestimation of the energy dissipation through the urban fabric and an overestimation of the flood celerity the improvement of sp riemann solvers could limit the resort to additional drag and momentum dissipation terms that are frequently added in numerical models finally the investigation of the differential porosity models where different definitions are used for storage and conveyance porosity shows that these models suffer from a fundamental lack of physical congruence implying that they cannot be used for the analysis of flood wave propagation through the urban fabric keywords porous shallow water equations integral porosity shallow water model urban flooding differential equations 1 introduction the urban environment is characterised by numerous obstacles and buildings that must be taken into account because they strongly influence the flow propagation characteristics larocque et al 2013 bazin et al 2017 in particular laboratory experiments testa et al 2007 soares frazão and zech 2008 guinot et al 2018b have shown that obstacles are able to reduce the flood propagation celerity through the urban fabric this effect is attributed to the presence of wave reflections which are able to reduce the flood volume transmitted through the urban layout and to local energy dissipation phenomena guinot et al 2017 guinot et al 2018a the two dimensional shallow water equations swe are commonly used to model urban flooding events mignot et al 2006 gallegos et al 2009 from the mathematical point of view the presence of obstacles can be introduced by excluding the buildings from the physical domain and imposing solid wall boundary conditions along the obstacle perimeter the numerical counterpart of this approach is called building hole method in the nomenclature by schubert and sanders 2012 in the corresponding numerical framework the computational mesh is constructed along the streets where the swe are discretized while wall boundary conditions are imposed along the perimeter of mesh holes the numerical solution of the swe soares frazão et al 2008 guinot 2012 özgen et al 2016a b guinot et al 2017 has been proven effective in simulating the reduction of flood propagation speed through the urban fabric but its computational burden is not negligible in fact it is well known that the explicit resolution of obstacles in numerical models is computationally expensive because very refined meshes are required to represent the streets with sufficient accuracy kim et al 2015 in order to reduce the computational burden solid obstacles and buildings can be incorporated into the mathematical model itself following an integral approach sanders et al 2008 or a differential approach defina 2000 lhomme 2006 guinot and soares frazão 2006 guinot 2012 velickovic 2012 these mathematical models are discretized on coarser meshes where the obstacles and the streets are merged using the concept of porosity in order the represent the obstacle density it is commonly believed that due to the urban texture irregularities only the integral flow equations ife see eqs 1 and 2 in sanders et al 2008 may supply meaningful information at the scale of interest meters or tens of meters while the differential porosity models are considered meaningless at the same scales guinot et al 2017 the numerical discretization of ife is usually conducted in the framework of the finite volume method and two examples available in the literature are the integral porosity ip shallow water model by sanders et al 2008 and the dual integral porosity dip shallow water model by guinot et al 2017 a feature of these numerical models is the possibility of separately defining the local fraction φ of unit surface area available for water storage storage porosity and the local fraction ψ of the frontal area that is free to the passage of water conveyance porosity despite the encouraging results sanders et al 2008 schubert and sanders 2012 özgen et al 2016b guinot et al 2017 the energy dissipation is underestimated in these numerical models for this reason empirical drag and momentum dissipation terms which are not present in the original mathematical formulation of the integral porous equations have been introduced in the literature sanders et al 2008 özgen et al 2016b guinot et al 2017 guinot 2017 bruwier et al 2017 özgen et al 2017 guinot et al 2018b in contrast with the integral formulation many researchers have proposed models where the mass and the momentum conservation principles are written in differential form lhomme 2006 guinot and soares frazão 2006 velickovic 2012 guinot and delenne 2014 guinot et al 2017 obtaining the porous shallow water equations pswe in the differential model by lhomme 2006 hereinafter abbreviated lh distinct definitions were used for the storage and the conveyance porosity the lh model inspired the introduction of a differential porosity model hereinafter abbreviated diff ip which guinot and delenne 2014 assumed as a differential analogue of the discrete ip model by sanders et al 2008 while guinot et al 2017 introduced a differential porosity model hereinafter abbreviated diff dip as a differential analogue of their dip model the single porosity sp model guinot and soares frazão 2006 velickovic 2012 which is obtained under the assumption that a representative elementary volume rev exists such that the continuum approach to multicomponent fluids is devisable bear 1988 drew and passman 1999 differs from the preceding differential porosity models because a unique definition is used for storage and conveyance porosity the numerical experiments by guinot 2012 have shown that the size of a typical rev in urban environments with periodic geometry is one or two orders of magnitude greater than the distance between buildings or streets and this implies that the storage porosity φ should vary on a characteristic length of kilometers on the other hand the structure of many built up areas in real world urban environments is fractal thomas et al 2007 and the definition of a rev of any dimension seems impossible on such a strongly irregular pattern bruwier et al 2014 for this reason the storage porosity φ has been often taken uniform and defined as the ratio between non built areas and total urban area guinot and soares frazão 2006 soares frazão et al 2008 cea and vázquez cendón 2010 guinot 2012 benkhaldoun et al 2015 guinot et al 2017 viero 2019 ferrari et al 2019 while drag terms have been often added in order to take into account the obstacles distribution guinot and soares frazão et al 2006 soares frazão et al 2008 cea and vázquez cendón 2010 velickovic et al 2010 özgen et al 2017 velickovic et al 2017 soares frazão et al 2018 ferrari et al 2019 in this framework the sp model by velickovic 2012 differs from the other porosity differential models because drag and dispersive terms arise very naturally during the averaging process in the rev and are not empirically added in contradiction to the conceptual problems raised by the difficulty of defining a rev the practical applications have demonstrated the viability of finite volume schemes for the solution of the sp model where a local storage porosity is defined at the level of computational cell velickovic et al 2010 özgen et al 2017 soares frazão et al 2018 the use of variable porosity on a cell by cell basis without reference to the actual rev dimensions reminds the integral approach and it poses the question if this similarity is merely an accident or if it is theoretically possible to build a differential porosity model where the geometric characteristics are genuinely local and the concept itself of rev is omitted current finite volume schemes for the approximate solution of the sp model with variable porosity are based on the ability of solving an sp riemann problem at the interface between the cells where porosity and flow characteristics are discontinuous of course little is known about the exact solution of this riemann problem and few systematic studies are available ostapenko 2012 cozzolino et al 2017 cozzolino et al 2018a b pepe et al 2019 among the other results available an interesting finding by cozzolino et al 2018a shows that there are initial conditions leading to multiple solutions of the sp riemann problem this fact has subtle implications on the numerical solution of the porosity models because it poses the question about which of the alternative riemann solutions is physically meaningful and how numerical methods can be constructed in order to approximate this solution the present paper which is inspired by the seminal works by defina 2000 guinot and soares frazão 2006 and sanders et al 2008 aims at answering the theoretical questions raised in the preceding paragraphs and at discussing some issues related to the simulation of urban flooding in particular a novel differential model namely the binary single porosity model bsp is proposed and analysed the bsp model which coincides with the sp model where the porosity is constrained to the values zero inside the buildings and one in the voids among the buildings is local and independent on the existence of a rev the ife formulation by sanders et al 2008 is immediately recovered from bsp after a simple integration in space stating the identity between the two models due to the hyperbolicity of the bsp model the sp plane riemann problem is the building block for constructing the corresponding classic bsp finite volume schemes the comparison with the two dimensional swe results demonstrates that at least in the case of simplified geometries the solution of the sp plane riemann problem has the potential to take into account the transient energy losses due to wave reflections through the urban fabric limiting the resort to momentum dissipation coefficients further analysis of two dimensional swe results shows that intense energy dissipations never discussed before in the literature of porosity models must be taken into account when supercritical flows pass through porosity reductions finally the analysis of numerical solutions to sp riemann problems demonstrates that current sp riemann solvers may cause systematic underestimation of the energy dissipation through the urban fabric and the overestimation of the flood celerity the paper is organized as follows in section 2 the bsp model is constructed starting from the swe model and the identity between bsp and ife model is demonstrated the eigenstructure of sp and bsp models is discussed in section 3 together with the structure of the corresponding riemann problem and the cases of riemann problem multiple solutions are recalled in section 4 the structure of two dimensional bsp finite volume scheme is presented showing that the solution of the sp riemann problem is the main ingredient for the numerical approximation of the bsp model in the same section it is shown that existing schemes for the approximate solution of the ife model such as ip and dip are particular cases of the general bsp numerical framework in section 5 the sp riemann problem exact solutions are compared with the results of a two dimensional swe model demonstrating the limits and the merits of sp riemann problem exact solutions in the same section the results of two existing sp riemann solvers are compared with the two dimensional swe results highlighting the issues of current numerical approaches the findings presented in the sections 5 and 6 are discussed in section 7 with reference to the influence of the urban fabric on the flooding celerity and the corresponding dissipation mechanisms finally the paper is closed by a conclusions section 2 the binary single porosity model the single porosity sp model by guinot and soares frazão 2006 is particularly interesting because it retains mathematical properties of the swe model such as hyperbolicity rotational invariance and celerity of small disturbances guinot and soares frazão 2006 castro et al 2007 ferrari et al 2017 cozzolino et al 2018b if the bed slope and source terms such as building drag and bed friction are neglected the sp model takes the form 1 φ h t φ h u x φ h v y 0 φ h u t x φ g h 2 2 φ h u 2 φ h u v y g h 2 2 φ x φ h v t φ h u v x y φ g h 2 2 φ h v 2 g h 2 2 φ y in eq 1 the symbols have the following meaning x and y are the space independent variables of the inertial reference frame oxy while t is the time variable h x y t is the flow depth u x y t and v x y t are the vertically averaged components of the flow velocity along x and y respectively φ x y is the porosity which may attain values in the interval 0 1 and g is the gravity acceleration g 9 81 m s2 is assumed in the remainder of the paper in the model of eq 1 the variables h u and v must be intended as space averages the use of eq 1 is limited by the necessity of considering a rev where the averaging process that defines the porosity and the averaged quantities is devisable in order to consider a pswe model independent on the concept of rev the binary single porosity bsp model 2 i h t i h u x i h v y 0 i h u t x i g h 2 2 i h u 2 i h u v y g h 2 2 i x i h v t i h u v x y i g h 2 2 i h v 2 g h 2 2 i y is presented and discussed here in eq 2 i x y is an indicator function see fig 1 such that i x y 0 if the point x y falls on a building while i x y 1 if x y falls in a void among buildings sanders et al 2008 the comparison of eqs 1 and 2 shows that the bsp model is the restriction of eq 1 to the case ϕ x y i x y and this implies that the bsp model inherits all the mathematical properties of the sp model besides the similarities the bsp differs from the sp model because it does not require any space averaging for its definition while the variables h u and v are intended as point values and not as space averaged values in eq 2 the function i x y is isotropic because its local values do not depend on the direction and it behaves as a two dimensional heaviside step which passes abruptly from 0 to 1 through building walls the corresponding derivative is a two dimensional dirac s delta function which is null everywhere with the exception of the building walls position from the mathematical point of view the discontinuous nature of i x y is not an issue since the classic swe model itself admits solutions travelling shocks standing hydraulic jumps contact discontinuities where h u and v are discontinuous of course the derivatives must be intended in the sense of generalized functions leveque 1992 due to the presence of flow and geometric discontinuities in the present section it will be shown that the bsp model of eq 2 is consistent with the swe model in the sense that if u x y t h h u h v t where t is the matrix transpose symbol is the solution of the swe model it also satisfies the bsp model and vice versa in addition it will be shown that the bsp model coincides with the integral model by sanders et al 2008 here named integral flow equations ife this result implies that swe bsp and ife constitute a class of equivalent models see table 1 where this relationship is explicated admitting the same solution u x y t 2 1 construction of bsp from the swe model it is possible to construct the bsp model of eq 2 from the swe model without loss of generality for the objectives of the present work bed elevation variability bed resistance effects and reynolds stresses are neglected in the following to focus on the analysis of obstacle effects under these assumptions the following homogeneous form of the two dimensional swe toro 2001 3 h t h u x h v y 0 h u t x g h 2 2 h u 2 h u v y 0 h v t h u v x y g h 2 2 h v 2 0 is considered the first of eq 3 represents the mass conservation principle while the remaining equations represent the components along x and y respectively of the second principle of newton s dynamics the classic procedure for introducing obstacles effects into the swe model consists in using internal wall boundary conditions represented by the additional equation 4 v t m 0 x x b x b ω v b where v u v t is the velocity vector m m x m y t is the normal unit vector outward with respect to the fluid mass along the obstacle perimeter ω v b see fig 1a x x y t is the position vector in the plane x y while x b xb yb t is the generic position along ω v b according to eq 4 the flow velocity component orthogonal to the obstacle perimeter is null free slip boundary condition the swe model is valid among the obstacles where the binary function is i x y 1 but not inside obstacles where i x y 0 the multiplication of eq 3 by i x y which supplies 5 i h t h u x h v y 0 i h u t x g h 2 2 h u 2 h u v y 0 i h v t h u v x y g h 2 2 h v 2 0 is meaningful among the buildings and it is identically null inside the obstacles as expected the model of eq 5 which correctly picks up the swe model where its validity is guaranteed is not complete because the internal boundary condition of eq 4 must be imposed at building boundaries i e along the discontinuity of i x y in order to introduce the internal wall boundary condition into the mathematical model a smoothed version ρ x y of the binary indicator function i x y will be used first in order to allow usual derivative computations for this reason consider the function ρ x y that surrogates i x y as follows leveque 1992 i ρ x y 1 in the voids among obstacles excluding a thin strip of width ε around the buildings ii ρ x y passes smoothly and monotonically from 0 to 1 in the strip of width ε around the buildings iii ρ x y 0 inside the buildings if the swe model eq 3 is multiplied by ρ x y some calculation see appendix a allows writing 6 ρ h t ρ h u x ρ h v y h v t ρ ρ h u t x ρ g h 2 2 ρ h u 2 ρ h u v y g h 2 2 ρ x h u v t ρ ρ h v t ρ h u v x y ρ g h 2 2 ρ h v 2 g h 2 2 ρ y h v v t ρ by construction eqs 6 and 3 are consistent in the sense that the solution u x y t h h u h v t of eq 3 is also the solution of eq 6 and vice versa from the definition of ρ x y it is evident that the smooth function ρ x y tends to i x y and ρ tends to i in the limit ε 0 recalling that i mδ x x b where δ x x b is the two dimensional dirac s delta centred in the points x b drew and passman 1999 defina 2000 brocchini and peregrine 2001 eq 6 can be rewritten for ε 0 as 7 i h t i h u x i h v y h v t m δ x x b i h u t x i g h 2 2 i h u 2 i h u v y g h 2 2 i x h u v t m δ x x b i h v t i h u v x y i g h 2 2 i h v 2 g h 2 2 i y h v v t m δ x x b the solid boundary condition prescribes v t m 0 for x x b see eq 4 while the condition δ x x b 0 for x x b is a property of the dirac s delta function this implies that the terms v t m δ x x b at the right hand side of eq 7 are identically null and that the bsp model of eq 2 is recovered the construction evidences that the bsp model of eq 2 coincides with the swe model where obstacles have been directly incorporated into the model by means of eq 4 in particular if u x y t is a solution of the bsp model it is also solution of the swe model and vice versa the non conservative products 0 5gh 2 i x and 0 5gh 2 i y which cannot be recast in divergence form are identically null where i x y is uniform in the voids among the building and inside the buildings while they act through the building boundaries only for this reason the non conservative products in eq 2 take into account the interaction between the fluid and the solid boundaries no averaging process was used to obtain the model of eq 2 and this states the independence on a rev definition in other words the bsp and the swe models are equivalent at every scale even if a rev is not defined 2 2 identity between bsp and ife if reynolds stresses bed slope and friction are omitted congruently with the swe model of eq 3 the ife model of eqs 1 and 2 in sanders et al 2008 can be written as 8 d d t ω i h d ω ω i h v t n d s 0 d d t ω i h v d ω ω i h v v t n d s ω i g h 2 2 n d s ω v b g h 2 2 m d s 0 where ω is an arbitrary two dimensional control volume see fig 1a ω is the boundary of ω with outward normal unit vector n n x n y t and i x y is the isotropic binary indicator function interestingly the ife model of eq 8 can be easily obtained by integrating in space the swe of eq 3 complemented by the boundary conditions of eq 4 as shown in appendix b this result states the consistency between swe and ife models in the sense that the solution u x y t of the swe satisfies the ife model and vice versa leveque 1992 remark 1 the derivation of bsp and ife from the swe model of eq 3 implies that no drag or momentum dissipation coefficient appears in the models of eqs 2 and 8 congruently the numerical approximation of the bsp model or equivalently the ife model should be tackled without resorting to these additional terms the identity between bsp and ife models is immediately proven by showing that the integration in space of bsp supplies the ife model if the first of eq 2 is integrated over the arbitrary fixed control volume ω fig 1a the following equation 9 ω i h t d ω ω i h u x i h v y d ω 0 is obtained the application of the divergence theorem to the second integral of eq 9 supplies 10 d d t ω i h d ω ω i h v t n d s 0 where n n x n y t is the unit outward vector along ω the eq 10 where the time derivative has been moved out of the first integral because the control volume ω does not depend on time coincides with the first of eq 8 as expected similarly if the second of eq 2 is integrated over the control volume ω and the divergence theorem is applied the following equation is obtained 11 0 ω i h u t i h u 2 x i h u v y x g i h 2 2 g h 2 2 i x d ω d d t ω i h u d ω ω i h u v t n d s ω i g h 2 2 n x d s ω g h 2 2 i x d ω recalling that i mδ x x b the sifting property of the two dimensional delta function gel fand and shilov 1964 brocchini and peregrine 2001 allows picking up the obstacle boundary ω v b inside the control volume ω and converting the area integral into a line integral this supplies 12 ω g h 2 2 i x d ω ω g h 2 2 m x δ x x b d ω ω v b g h 2 2 m x d s the substitution of eq 12 into eq 11 finally leads to 13 d d t ω i h u d ω ω i h u v t n d s ω i g h 2 2 n x d s ω v b g h 2 2 m x d s 0 similar manipulations can be conducted on the third of eq 2 obtaining 14 d d t ω i h v d ω ω i h v v t n d s ω i g h 2 2 n y d s ω v b g h 2 2 m y d s 0 the scalar eqs 13 and 14 can be written in vector form as 15 d d t ω i h v d ω ω i h v v t n d s ω i g h 2 2 n d s ω v b g h 2 2 m d s 0 which coincides with the second of eq 8 as expected in conclusion the bsp model is the differential counterpart of the ife model by sanders et al 2008 because a simple integration of the bsp model on an arbitrary control volume leads to the ife model in particular if u x y t is the point solution of the bsp model it is also solution of the ife model and vice versa without any reference to the existence of a rev from the derivation it is clear that no other differential isotropic or anisotropic model shares this property the ife model has a priority sanders et al 2008 from the historical point of view but its bsp differential form is more convenient for numerous reasons i checking if u x y t is the solution of the ife model requires verifying that eq 8 holds for an arbitrary control volume ω leveque 1992 which is not feasible conversely the differential form is more easily checked after that u x y t is substituted into eq 2 in the regions where the flow is smooth while the rankine hugoniot is checked where the solution is discontinuous ii the integral form makes the study of ife mathematical properties difficult while the same investigation is easily accomplished in its bsp differential form see section 3 iii the differential form makes transparent the nature of the riemann problem to be solved at interfaces between cells in finite volume schemes see section 4 having demonstrated the identity between bsp and ife models only the bsp model will be considered in the following while the ife model by sanders et al 2008 will be retained as a synonym of integral form of bsp 3 the mathematical structure of the bsp model the mathematical structure of the bsp model must be investigated in the framework of the sp model by guinot and soares frazão 2006 and there are two reasons that motivate this first the bsp model is the formal restriction of eq 1 to the case φ x y i x y and this implies that the bsp model shares with the sp model important mathematical properties such as the hyperbolicity the rotational invariance the eigenstructure and the structure of the riemann problem solution the second reason is that similarly to the porosity function φ x y 0 1 the finite volume representation of the binary indicator function i x y inevitably takes values in the entire interval 0 1 because of the cell averaging process this implies that the solution of the sp riemann problem is the building block of bsp and ife finite volume numerical schemes in the present section some results guinot and soares frazão 2006 castro et al 2007 ferrari et al 2017 cozzolino et al 2018a b pepe et al 2019 absolutely necessary for understanding the additional discussion and the numerical developments contained in the rest of the paper are reported in particular the eigenstructure of the sp model and the definition of the standing porosity discontinuity are recalled the riemann problem is defined and a case of multiple riemann solutions which affects the practical computations is considered 3 1 eigenstructure in order to study the eigenstructure of the sp model it is convenient to treat the porosity as an ordinary conserved variable by adding the trivial equation φ t 0 ferrari et al 2017 to the system of eq 1 the corresponding plane system along x godlewski and raviart 1996 where the derivatives with respect to y are null is 16 φ u t φ f u x h x u φ x 0 φ t 0 in eq 16 u x y t h h u h v t is the vector of the conserved variables in the two dimensional swe f u h u h u 2 0 5 g h 2 h u v t is the vector of the fluxes along x in the two dimensional swe while h x u is a matrix defined as 17 h x u 0 0 0 0 0 0 5 g h 2 0 0 0 the non conservative product 0 5gh 2 φ x which deserves a special treatment because it cannot be put in divergence form is included in eq 16 because it is a constitutive part of the hyperbolic model and not a source term the system of eq 16 is hyperbolic and the corresponding eigenvectors are castro et al 2007 ferrari et al 2017 cozzolino et al 2018b 18 λ 0 0 λ 1 u g h λ 2 u λ 3 u g h the eigenvalues λ 0 and λ 1 coincide for u g h while λ 0 and λ 3 superpose for u g h and this makes the system non strictly hyperbolic in this case multiple solutions of the riemann problem are expected warnecke and andrianov 2004 lefloch and thanh 2011 han et al 2013 the eigenvalues λ 1 and λ 3 are connected to two genuinely non linear characteristic fields that may contain either shocks or rarefactions while the eigenvalue λ 2 is connected to a linearly degenerate characteristic field that may contain only ordinary contact discontinuities these eigenvalues and the speed of the corresponding elementary waves coincide with those of the swe model because the porosity parameters do not appear in the expressions of eq 18 the characteristic fields connected to the eigenvalues λi i 1 2 3 are characterized by uniform porosity through the elementary wave the additional eigenvalue λ 0 0 is connected to the porosity jumps which allow the representation of urban fabric irregularities through the non conservative product 0 5gh 2 φ x unfortunately the term 0 5gh 2 φ x is not well defined at porosity discontinuities because the product of a heaviside function the discontinuous representation of h 2 by a delta function the discontinuous representation of the derivative φ x has no meaning castro et al 2007 ion et al 2016 cozzolino et al 2018b for this reason the classic rankine hugoniot condition is not valid at porosity jumps and the generalized rankine hugoniot grh condition must be introduced lefloch 1989 dal maso et al 1995 the peculiarities connected to porosity discontinuities and their relevance for the solution of porous shallow flow models deserve additional discussion that is presented in the following sub section remark 2 if the transverse velocity v is null the system of eq 16 formally coincides with the one dimensional swe model with variable width φ and horizontal bed guinot and soares frazão 2006 sanders et al 2008 this formal analogy will be exploited in the rest of the paper 3 2 definition of the standing contact discontinuity the grh condition for the discontinuities connected to the eigenvalue λ 0 0 is cozzolino et al 2018b 19 φ r f u 2 φ l f u 1 0 s γ φ l φ r u 1 u 2 0 t where u 1 h 1 h 1 u 1 h 1 v 1 t and u 2 h 2 h 2 u 2 h 2 v 2 t are the vectors of the conserved variables immediately to the left and right of the standing porosity discontinuity respectively φ l and φ r are the corresponding left and right porosities and s γ φ l φ r u 1 u 2 is a localized term taking into account the effect of the non conservative product 0 5gh 2 φ x through the standing discontinuity the inspection of eq 19 shows that the unit width discharge φhu and the transverse velocity v are invariant through the standing discontinuity the term s γ φ l φ r u 1 u 2 is mathematically defined as lefloch 1989 dal maso et al 1995 20 s γ φ l φ r u 1 u 2 0 1 g 2 γ h s u 1 u 2 2 γ φ s s u 1 u 2 d s where γ h s u 1 u 2 and γφ s u 1 u 2 with s 0 1 are appropriate parameterizations of the variables h and φ through the discontinuity the physical meaning of eq 19 is obvious because it states that the force s γ exerted on the flow by the rapid porosity transition must be equal to the difference of the total forces to the left and to the right of porosity discontinuities nonetheless the mathematical expression of the function s γ φ l φ r u 1 u 2 is not determined into the sp model itself and different choices of the parameterizations γ h s u 1 u 2 and γφ s u 1 u 2 lead to a different relationship between the couples φ l u 1 and φ r u 2 in eq 19 this implies that the hydraulic modeler is free of introducing a description of the discontinuity internal structure that is appropriate for the problem at hand by defining γ h s u 1 u 2 and γφ s u 1 u 2 lefloch 1989 dal maso et al 1995 3 2 1 structure of the porosity variation the parameterization γφ s u 1 u 2 of the porosity variation through the discontinuity can be monotonic or non monotonic the case of monotonic porosity variation which is implicitly assumed in many classic sp numerical models guinot and soares frazão 2006 soares frazão et al 2008 cea and vázquez cendón 2010 finaud guyot et al 2010 ferrari et al 2017 cozzolino et al 2018a b is characterized by min φ l φ r γφ s u 1 u 2 max φ l φ r for each s 0 1 conversely the case of non monotonic porosity variation which is explicitly assumed in the ip and dip numerical models sanders et al 2008 özgen et al 2016b özgen et al 2017 guinot et al 2017 is characterized by min s γ φ s u 1 u 2 min φ l φ r the choice of the parameterization γφ s u 1 u 2 has considerable influence on the form of the sp riemann problem solution in fact critical flow conditions are possible only at the inlet or at the outlet of geometric transitions with monotonic porosity variation cozzolino et al 2018b while critical flow conditions are possible only inside the geometric discontinuity in the case of non monotonic variation cozzolino et al 2017 pepe et al 2019 if the formal analogy between one dimensional sp model and variable width one dimensional swe model is exploited see remark 2 of section 3 1 it becomes evident that monotonic porosity variations formally correspond to rapid monotonic width variations such as contractions and expansions while non monotonic porosity variations correspond to rapid non monotonic width variations such as venturi flumes and bridge piles this geometric analogue suggests that the choice of γφ s u 1 u 2 should be made at each porosity discontinuity based on the underlying urban geometry remark 3 the channel analogue interpretation is physically meaningful independent on the monotonicity of the channel width this implies that the choice of γφ s u 1 u 2 is always physically meaningful independent of its monotonicity properties this observation is confirmed by the availability of both monotonic and non monotonic discontinuous porosity schemes that are stable and well behaved for the sake of simplicity only monotonic porosity variation through the discontinuity will be considered in the following 3 2 2 head balance formulation the choice of the parameterization γ h s u 1 u 2 is far less obvious than the choice of γφ s u 1 u 2 because it cannot be easily related to the underlying urban geometry nonetheless this difficulty is circumvented by observing that the function s γ φ l φ r u 1 u 2 in eq 19 is implicitly defined by a relationship between the couples φ l u 1 and φ r u 2 the assumption that steady flow weak solutions of eq 16 supply the relationship between φ l u 1 and φ r u 2 has been best studied from a mathematical point of view cozzolino et al 2017 cozzolino et al 2018a b pepe et al 2019 the steady flow solution of eq 16 reduces to 21 φ r h 1 u 1 φ l h 2 u 2 δ h h 1 u 1 2 2 g h 2 u 2 2 2 g v 1 v 2 where the three equations represent the invariance of discharge the balance of hydraulic head and the invariance of the transverse velocity respectively the quantity δh is null in the case of smooth flow through the discontinuity while it is different from zero in the case that a hydraulic jump is present interestingly the sp model allows the introduction of δh 0 through a hydraulic jump even if viscous terms are not present in eq 16 because a force balance takes globally into account the eddies effect through the vanishing length region where the flow characteristics variation is rapid it is possible to generalize the meaning of eq 21 by recalling the formal analogy between one dimensional sp model and one dimensional swe with width variations this analogy suggests that concentrated head loss expressions in the form of eq 21 are congruent with the usual internal boundary conditions cunge et al 1980 used in saint venant equations for modeling channel width discontinuities such as sudden expansions formica 1955 venturi flumes dufresne and vazquez 2013 and bridge piles yarnell 1934 in analogy with the hydraulic jump head loss it is evident that the arbitrariness of γ h s u 1 u 2 makes these formulations viable even if viscous terms are not present in eq 16 of course the physical congruency requires that δh is non negative when u 1 0 flow directed from left to right and negative in the case u 1 0 flow directed from right to left the standing wave definition of eq 21 will be extensively used in the remainder of the paper 3 3 plane sp riemann problem and multiple solutions the plane sp riemann problem is the initial value problem where the system of eq 16 is solved with the following discontinuous initial conditions 22 u x y 0 u l x 0 u r x 0 complemented by the discontinuous porosity distribution 23 φ x y φ l x 0 φ r x 0 after that an appropriate definition of standing porosity discontinuity has been chosen the quantities u q h q h q u q h q v q t and φ q with q l r are the uniform flow state and the uniform porosity value respectively to the left l and to the right r of the initial discontinuity the solution u x y t of the riemann problem ferrari et al 2017 cozzolino et al 2018b is self similar and it consists of constant states that are separated by elementary waves the standing wave definition applies through the porosity discontinuity in x 0 while the moving waves corresponding to the swe are valid to the left and to the right of the initial discontinuity where the porosity is uniform under the assumption that steady flow weak solutions of eq 16 link the states u 1 and u 2 and that the porosity variation between φl and φr is monotonic it is possible to show that the exact solution of the sp riemann problem on dry bed always exists cozzolino et al 2018a this special riemann problem significant for the simulation of flood propagation through urban districts may admit multiple exact solutions when the flow impinging the sudden porosity reduction is supercritical an example of this phenomenon is the riemann problem with initial conditions φl 1 φr 0 6 u l 1 9 40 0 t and u r 0 0 0 t which admits three distinct solution configurations these solution configurations whose flow depth h is represented at t 5 s in fig 2 are described in the following s1 the supercritical flow is chocked by the sudden porosity reduction and it is reverted to subcritical flow by a moving shock radiated from the geometric discontinuity fig 2a the flow rate through the discontinuity is less than that corresponding to the impinging flow while the backward moving shock introduces energy dissipation into the flow field but not through the porosity discontinuity δh 0 in eq 21 s2 the impinging supercritical flow is reverted to outlet critical flow through the geometric discontinuity by a standing hydraulic jump located inside the geometric transition itself fig 2b the flow rate through the discontinuity is equal to the upstream flow rate δh 0 in eq 21 s3 the supercritical flow passes freely through the porosity reduction fig 2c with constant discharge and energy δh 0 in eq 21 the sp model does not embed the information necessary to make a correct choice among the alternatives the appearance of multiple solutions which is connected to the presence of geometric non conservative products is due to a loss of physical information caused by the adoption of a one dimensional model instead of a two or three dimensional model warnecke and andrianov 2004 this observation suggests using higher dimensions models to pick up a physically relevant solution among the alternatives this line of reasoning which has been frequently followed in the literature warnecke and andrianov 2004 han et al 2013 guides the approach used in the remainder of the present paper 4 finite volume numerical discretization of the porous shallow water models in the present section it is shown that the solution of the sp riemann problem presented in section 3 is the building block for the construction of bsp finite volume schemes in addition it is demonstrated that the existing ife numerical models ip by sanders et al 2008 dip by guinot et al 2017 are particular cases of the bsp numerical framework 4 1 finite volume discretization of the bsp model from eq 2 it is clear that the following cell averages 24 φ i 1 ω i ω i i x y d ω u i n 1 φ i ω i ω i i x y u x y t n d ω must be used to approximate the problem variables in bsp finite volume numerical schemes in eq 24 the meaning of the symbols is as follows ω i is the area of the ith control volume ω i the superscript n refers to the nth time level tn φi 0 1 is the approximation of i x y in ω i and it coincides by definition with the storage porosity in the ife schemes sanders et al 2008 guinot et al 2017 finally u i n h i n h i n u i n h i n v i n t is the vector of the swe cell averaged conserved variables from eq 24 it is clear that the numerical variables representation is discontinous through cell edges eq 8 states that the evolution of the cell averaged variables in the bsp model is driven by the fluxes through the cell interfaces and by the non conservative products the interface terms can be approximated by solving a local plane bsp riemann problem as usual for hyperbolic systems where the variables are discontinuous through the cell edges of course the binary indicator function i x y is approximated in the ith cell by means of the average φi of eq 24 which ranges in the interval 0 1 just like the porosity variable φ in the sp model due to the common structure of eqs 1 and 2 this implies that the solution of the interface bsp riemann problem reduces to the solution of an sp riemann problem following these considerations the first order finite volume solution of bsp and ife models can be written in the following form 25 φ i ω i u i n 1 φ i ω i u i n δ t j n i e i j φ s p φ i φ j u i u j n i j δ t j n i e i j s s p φ i φ j u i u j n i j where the explicit euler algorithm is used for advancing in time in eq 25 the meaning of the symbols is as follows δ t t n 1 t n is the length of the time step n i is the set of indices j such that ω j is a neighbor of ω i eij is the length of the edge e ij between ωi and ωj n i j n i j x n i j y t is the normal to the edge e ij orientated from ωi to ωj and such that n ij n ji φ sp φ i φ j u i u j n ij is the flux exact or approximate corresponding to the plane sp riemann problem along n ij where an appropriate definition of the standing porosity discontinuity is taken into account finally the term s sp φ i φ j u i u j n ij takes into account the effect on ω i of the non conservative products 0 5gh 2 i x and 0 5gh 2 i y through the interface e ij the porosity φi can be calculated in each computational cell after that the distribution of i x y is available from digital terrain models or aerial imagery sanders et al 2008 this implies that the results may be dependent on the computational mesh grid size orientation due to the irregularity of the obstacles distribution sanders et al 2008 guinot et al 2017 remark 4 in eq 25 the in cell contribution of the terms 0 5gh 2 i x and 0 5gh 2 i y is null this standard treatment is congruent with the first order approximation because the corresponding numerical representation φi of the variable i is constant into a cell implying that the in cell derivatives i x and i y are null of course it is possible to evaluate the in cell contribution of 0 5gh 2 i x and 0 5gh 2 i y by means of appropriate quadrature formulas when the variables h and i are reconstructed for second or higher order approximation compare with audusse et al 2004 and audusse and bristeau 2005 where such a treatment is discussed with reference to the swe model with variable bed elevation remark 5 formally the eq 25 coincides with a finite volume scheme for the solution of the sp model of eq 1 if the variables definition 26 φ i 1 ω i ω i φ x y d ω u i n 1 φ i ω i ω i φ x y u x y t n d ω is used all the sp finite volume schemes available in the literature can be written in the form of eq 25 and this implies that the same numerical schemes can be regarded as bsp numerical schemes when φi and u i are interpreted in the sense of eq 24 this formal identity explains the success of sp models where the porosity varies from a cell to another without reference to the rev definition velickovic et al 2010 özgen et al 2017 soares frazão et al 2018 4 2 a special class of bsp finite volume schemes castro et al 2007 presented a class of finite volume numerical schemes designed for the approximate solution of hyperbolic systems with non conservative products connected to standing discontinuities in these schemes which generalize the concept of hydrostatic reconstruction by audusse et al 2004 the non conservative products are taken into account through an appropriate reconstruction of the conserved variables at cell interfaces while the fluxes are calculated using a classic approximate or exact riemann solver for the homogeneous hyperbolic system in the framework by castro et al 2007 the first order bsp finite volume scheme of eq 25 can be rewritten as 27 φ i ω i u i n 1 φ i ω i u i n δ t j n i e i j ψ i j g u i j u i j n i j δ t j n i e i j s φ i ψ i j u i n u i j n i j in eq 27 ψ ij is an estimate of the edge averaged value of i through e ij g u i j u i j n i j is a numerical flux corresponding to the plane classic swe riemann problem u i j h i j h i j u i j h i j v i j t and u i j h i j h i j u i j h i j v i j t are the conserved variables reconstructed to the left and to the right of the edge e ij s φ i ψ i j u i n u i j n i j takes into account the effect on ω i of the non conservative products through the interface e ij the quantities ψ ij u i j and u i j are appropriately chosen in order to approximate the sp flux and non conservative products in the form 28 φ sp φ i φ j u i u j n ij ψ ij g u ij u ij n ij s sp φ i φ j u i u j n ij s φ i ψ ij u i n u ij n ij the first position of eq 28 is easily justified recalling that the fluxes of the mathematical sp model are equal to the product of the porosity by the fluxes of the swe model see remark 2 in section 3 1 this approach which does not require the explicit availability of an exact or approximate sp riemann solver has been used in the sp finite volume schemes by cea and vázquez cendón 2010 and cozzolino et al 2018b under the assumption 29 ψ i j min φ i φ j max φ i φ j which corresponds to a monotonic definition of porosity variation through the standing discontinuity a similar scheme has been used by castro et al 2007 for the approximate solution of the one dimensional swe model with variable width remark 6 note that the edge porosity ψ ij arises very naturally as a consequence of having adopted a simplified form of the sp riemann flux see eq 28 in other words the porosity coefficient ψ ij is not part of the bsp or ife mathematical models but it is a useful numerical device in view of the corresponding approximate solution having demonstrated that the bsp model is the differential version of ife it is expected that existing ife finite volume numerical schemes are nothing but bsp finite volume schemes under the assumption of negligible drag bed slope and friction the ip numerical scheme by sanders et al 2008 coincides with eq 27 with the following positions 30 ψ i j 1 e i j e i j i x y d s 31 ψ i j min φ i φ j 32 s i j ψ i j φ i g h i 2 2 0 n i j x n i j y t 33 u i j u i u i j u j the constraint of eq 31 reveals the assumption of non monotonic variation of the porosity through the standing discontinuity in the ip numerical model simulating the presence of local constrictions at interfaces in the same manner the dip numerical model by guinot et al 2017 coincides with the eq 27 where the positions of eqs 30 32 are made while the following reconstructed variables 34 u i j h i φ i h i u i ψ i j φ i h i v i ψ i j t u i j h j φ j h j u j ψ i j φ j h j v j ψ i j t are assumed for the calculation of the fluxes 5 the sp riemann problem and the wave propagation through geometric discontinuities in the bsp and ife models the solution of the sp plane riemann problem is the building block for constructing porosity finite volume models for this reason it is interesting to verify at which extent the sp riemann problem can reproduce the typical wave reflection and energy dissipation phenomena produced during the flood propagation through the urban fabric in the literature this study has been accomplished by considering the flood propagation through a domain consisting of a single street with periodic contractions and expansions and comparing the corresponding bsp and swe numerical solutions guinot 2012 özgen et al 2016b guinot et al 2017 bruwier et al 2017 guinot et al 2018b this approach exhibits two issues first the interaction between reflected and transmitted waves that radiate from two consecutive geometric discontinuities may hide their distinct contribution to the flooding wave propagation second the use of two dimensional bsp numerical models unfortunately moves the focus from the structure of the sp riemann problem exact solution to numerical modelling details these observations prompt a closer study of isolated geometric discontinuities where the sp riemann problem exact solutions are compared with the reference solutions supplied by a two dimensional swe numerical model for the same initial conditions a fair comparison requires that the isolated geometric discontinuities considered in the swe model are symmetrical because the flow variables and the porosity are uniform along the transverse direction in the sp plane riemann problem the approach is limited here to the case of monotonic porosity variation through the discontinuity while the non monotonic case will be tackled in future research in order to demonstrate the deficiencies of available approximate sp riemann solvers the same study is repeated by means of a one dimensional sp numerical scheme where two different variables reconstructions from the literature guinot et al 2017 cozzolino et al 2018b are used 5 1 description of the case studies it is considered an idealized urban layout consisting of a street l 200 m long with a single width discontinuity the street see fig 3 where a distorted layout is represented consists of a western reach whose width is bl 1 m and an eastern reach whose width is br 0 6 m a linear contraction which is located at the centre of the street where x 0 m connects the western reach to the eastern one by means of two straight walls that are inclined by 45 with respect to the street axis the linear contraction which is lc 0 20 m long is sufficiently short with respect to the street length to be considered a true geometric discontinuity the northern and the southern boundaries of the street are free slip walls while the western and the eastern boundaries are open ends given the street physical domain a two dimensional finite volume swe numerical model on unstructured triangular grid see the description in cozzolino et al 2017 is used to produce a set of benchmark case studies these case studies consist of six rapid transients that start from the discontinuous initial conditions 35 u x y 0 u l x 0 u r x 0 where the left and right initial states u l h l h l u l h l v l t and u r h r h r u r h r v r t are specified in table 2 together with the corresponding unit width discharge q hu and froude number f u g h the unstrucured triangular mesh used is non uniform with average side δs 0 50 m at the ends of the channel and δs 0 05 m in the vicinity of the geometric transition the inspection of table 2 shows that the case studies from cs1 to cs4 correspond to a flow directed from left to right that impinges a street contraction with dry right bed conversely the case studies cs5 and cs6 correspond to a flow directed from right to left that encounters a street expansion with dry left bed in fig 4 the free surface elevation supplied at time t 5 s by the two dimensional swe numerical model for the case studies from cs1 to cs6 table 2 is projected onto a longitudinal vertical plane and plotted with dots case study cs1 for this case study characterized by left froude number fl 0 60 the criterion by yarnell 1934 predicts flow chocking because the flow energy is insufficient to make the entire unit width discharge q l 1 88 m2 s pass freely this is confirmed by the corresponding two dimensional swe solution fig 4a where a left moving shock contained into the first characteristic field increases the flow depth immediately to the left of the geometric discontinuity but reduces the discharge through x 0 m the two dimensional swe solution is completed by a rarefaction wave contained into the first characteristic field which starts from the critical conditions immediately to the right of the porosity discontinuity and propagates on the dry bed case study cs2 the case study cs2 is very similar to the case study cs1 but the left state u l is now supercritical with froude number fl 1 50 again the energy of the state u l is not sufficient to make the unit width discharge q l 4 70 m2 s pass through the geometric discontinuity causing the chocking of the flow with the formation of a shock that moves towards left dots in fig 4b case study cs3 for this test case with fl 3 the criterion by yarnell 1934 predicts that the flow energy is sufficient to make the entire unit width discharge q l 9 40 m2 s pass through the geometric discontinuity but the inspection of the two dimensional swe numerical solution in fig 4c dots shows that the flow is chocked by a shock moving towards left this behavior which may look unexpected at first sight is justified recalling that the solution of the corresponding sp riemann problem with discontinuous porosity is not unique and that the chocked flow configuration s1 is one of the alternative solutions see section 3 3 and fig 2 case study cs4 this case study is characterized by a high froude number fl 4 5 with unit width discharge q l 14 09 m2 s the inspection of the corresponding two dimensional swe numerical solution dots in fig 4d shows that the supercritical flow impinging the geometric discontinuity remains supercritical without chocking the dots with high elevation in fig 4d are not an instability symptom because they correspond to a significant interaction between the flow and the channel contraction walls with the formation of standing shocks contained into the rapid width transition in order to explore this condition the corresponding two dimensional swe simulation is repeated on a triangular grid with side δs 0 01 m in the vicinities of the geometric transition the flow depth contours at the geometric transition between abscissas x 1 m and x 2 m which are plotted in fig 5 exhibit a very characteristic shock pattern with incident shocks i reflected shocks r and a mach stem m which meet at two symmetric triple points defina and viero 2010 significant head losses are connected to the presence of this system of standing shocks where the flow energy is dissipated with the same mechanism of the hydraulic jump the interested reader may compare fig 5 with fig 3 in akers and bokhove 2008 where the incident waves i and the mach stem m produced by a supercritical flow through a linear convergent channel are evidenced in a small scale laboratory experiment case study cs5 this case study is characterized by a right subcritical flow fr 0 6 with unit width discharge q r 1 88 m2 s encountering a rapid width increase which induces the formation of the critical state immediately to the right of the geometric discontinuity and the propagation of a rarefaction towards right dots in fig 4e the flow to the left of the initial discontinuity is supercritical case study cs6 this case study is characterized by a right supercritical flow fr 1 5 with q r 4 70 m2 s which flows through a sudden expansion and remains supercritical dots in fig 4f the expansion causes an acceleration of the flow and reducing the flow depth 5 2 sp riemann problem exact solution with no headloss added given the analogy between one dimensional sp model and one dimensional swe model with width variations remark 2 of sub section 3 1 the six rapid transients of table 2 are modelled as sp riemann problems and compared with the two dimensional swe reference solutions of fig 4 for this reason the purely one dimensional sp model 36 φ u t φ f u x 0 0 5 g h 2 t φ x 0 where u x t h h u t and f u h u 0 5 g h 2 h u 2 t is solved with initial conditions and discontinuous geometry 37 u x 0 u l x 0 u r x 0 φ x φ l x 0 φ r x 0 the left and right initial states u l h l h l u l t and u r h r h r u r t are contained in table 2 while the porosities φl and φr are defined as φ l b l b max 1 and φ r b r b max 0 6 respectively with bmax bl the internal structure of the rapid street width variation suggests that a porosity monotonic variation must be assumed for the definition of the porosity standing discontinuity the construction of the exact sp riemann problem solutions for the case studies of table 2 is depicted in appendix c where the eq 21 with δh 0 is assumed no headloss added the corresponding states u 1 h 1 h 1 u 1 t and u 2 h 2 h 2 u 2 t respectively to the left and to the right of the porosity discontinuity are reported in table 3 together with the corresponding unit width discharge hu and discharge φhu the effects of the porosity discontinuities can be easily appreciated by comparing the solution of the discontinuous porosity sp riemann problem with the results of the uniform porosity sp model for this reason the exact solution of the uniform porosity sp riemann problem φ 1 for the case studies of table 2 is compared in fig 4 with the results of the two dimensional swe model and with the discontinuous porosity sp riemann problem case study cs1 the results of the two dimensional swe numerical model dots and the exact solution of the discontinuous porosity sp riemann problem thin continuous line are compared in fig 4a showing that the exact sp solution is very close to the two dimensional swe numerical solution in particular the left initial flow u l is connected to the state u 1 by a shock while the state u 2 is critical it is immediate to see that the unit width discharge q 1 h 1 u 1 1 50 m2 s corresponding to the state u 1 see table 3 is 20 minor than the unit width discharge q l 1 88 m2 s corresponding to the state u l see table 2 and this confirms that porosity sudden reductions may cause a reduction of the discharge through the abscissa x 0 m in the case of subcritical flow additional inspection of fig 4a shows that the celerity of the wetting front predicted by the exact sp riemann solution almost coincides with that supplied by the two dimensional swe model the exercise is repeated by solving the uniform porosity sp riemann problem the corresponding solution dashed line in fig 4a consists of a single rarefaction wave that connects the state u l to the dry bed for the present case the unit width discharge through the geometric discontinuity is equal to q 1 2 04 m2 s and it is 8 5 greater than ql contrary to what expected the leading wave celerity i e the celerity of the wetting front supplied by the uniform porosity sp riemann problem is slower than the corresponding wave celerity supplied by the two dimensional swe model with channel contraction and by the discontinuous porosity sp exact solution this aspect will be reconsidered in the discussion section case study cs2 similarly to the preceding case the inspection of fig 4b shows that the exact solution of the discontinuous porosity sp riemann problem thin continuous line is very close to the two dimensional swe results the unit width discharge q 1 3 51 m2 s corresponding to the state u 1 see table 3 is 25 minor than the unit width discharge q l 4 70 m2 s corresponding to the state u l table 2 confirming that the blockage effect due to the porosity discontinuity is well reproduced by the sp model with geometric discontinuity in particular the celerity of the wetting front predicted by the exact sp riemann solution almost coincides with that supplied by the two dimensional swe model the results of the uniform porosity sp riemann problem dashed line in fig 4b show that the absence of geometric discontinuity makes the left moving shock disappear again the leading wave celerities supplied by the two dimensional swe model and the sp exact solution with geometric discontinuity are greater than the corresponding wave celerity in the uniform porosity sp riemann problem case study cs3 the sp riemann problem with porosity discontinuity is underdetermined for this test case three alternative solutions see section 3 3 but the results of the two dimensional swe model supply a guide for picking up the sp solution configuration s1 that is congruent with the two dimensional results warnecke and andrianov 2004 han et al 2013 the inspection of fig 4c thin continuous line where the s1 configuration is plotted confirms that there is a good agreement between the sp riemann problem solution and the two dimensional numerical simulation the effect of the flow chocking is again evident because the unit width discharge q 1 8 62 m2 s table 3 is 9 minor than the unit width discharge q l 9 40 m2 s table 2 the celerity of the leading wave supplied by the discontinuous porosity sp riemann problem is very close to that supplied by the two dimensional swe model the solution of the uniform porosity sp riemann problem is also plotted in fig 4c dashed line from the inspection of the figure it is evident that the omission of the porosity discontinuity leaves the flow through x 0 m unaffected in the present case the comparison with the two dimensional swe solution and with the discontinuous porosity sp riemann solution shows that the celerity of the leading rarefaction wave is only moderately influenced by the absence of the geometric discontinuity case study cs4 for this case study the structure of the sp riemann problem solution with porosity discontinuity thin continuous line in fig 4d is the same of the two dimensional swe numerical model dots because the upstream flow remains supercritical through the discontinuity u 1 u l compare tables 2 and 3 nonetheless the exact sp riemann solution does not exhibit energy dissipation through the geometric discontinuity and this implies the underestimation of the flow depth at the exit of the porosity discontinuity and the overestimation of the leading wave celerity similarly to the preceding cases the leading wave celerity of the uniform porosity sp riemann problem dashed line in fig 4d is less than the corresponding celerity in the discontinuous porosity sp solution thin continuous line case study cs5 for this case the structure of the sp riemann problem solution with porosity discontinuity thin continuous line is very close to that of the two dimensional swe numerical model see fig 4e in particular the geometric discontinuity induces the formation of a right rarefaction that accelerates the flow towards the critical state this is confirmed by the unit width discharge q 2 2 04 m2 s table 3 which is greater than the unit width discharge q r 1 88 m2 s table 2 nonetheless the two dimensional swe numerical solution dots in fig 4e exhibits a headloss through x 0 m which causes the increase of the supercritical flow depth immediately to the left of the geometric transition and a corresponding reduction of the velocity with respect to the exact sp riemann solution also in this case the celerity of the leading rarefaction wave supplied by the two dimensional swe model is very similar to that of the sp model with porosity discontinuity the results supplied by the one dimensional sp model with uniform porosity are plotted in fig 4e with a dashed line the comparison with the other two models shows that the celerity of the left leading wave and the flow depth are largely overestimated if the geometric discontinuity is neglected case study cs6 the solution of the exact sp riemann problem with porosity discontinuity is very similar to that of the swe model see fig 4f because the right flow remains supercritical through the expansion u 2 u r compare tables 2 and 3 of course the energy dissipation produced by the two dimensional swe model in the vicinity of x 0 m causes the increase of the supercritical flow depth with respect to that supplied by the sp model with porosity discontinuity the comparison with the two other models shows that the one dimensional sp model with uniform porosity dashed line overestimates the celerity of the right rarefaction and the corresponding flow depth 5 3 sp riemann problem exact solution with the added headloss low order numerical schemes for the approximate solution of the shallow water equations dissipate energy with a mechanism numerical dissipation due to the numerical viscosity that is similar to the physical mechanism of the eddy viscosity tadmor and zhong 2008 of course this effect is more severe where the gradients of the numerical solution are higher this observation explains why the two dimensional swe numerical solutions of the study cases from cs1 to cs6 in fig 4 with the exclusion of cs4 exhibit energy dissipation through the channel width variation the same dissipation effects are observed through geometric discontinuities in real flows where the eddy viscosity is non negligible yarnell 1934 formica 1955 cunge et al 1980 dufresne and vazquez 2013 in this framework the case cs4 of fig 4d is special because standing shocks through the channel contraction produce an additional loss of energy in the literature of porosity models the dissipative effects have been often taken into account by introducing additional drag terms that change the structure of the original mathematical models guinot and soares frazão 2006 sanders et al 2008 guinot et al 2018a it is interesting to verify if the local dissipation effects independent of their physical or numerical nature can be taken into account through the standing wave definition of eq 21 without any change of the porosity model structure for this reason the methods of appendix c are used again to compute the exact discontinuous porosity sp riemann problem solution for the case studies from cs1 to cs6 where the head unbalance values δ h h 1 u 1 2 2 g h 2 u 2 2 2 g of table 4 are used in eq 21 the values of δh are those that best fit the two dimensional swe numerical solution at time t 5 s after a simple trial and error procedure in the table 4 the flow depth longitudinal velocity unit width discharge and discharge φhu corresponding to the exact solution states u 1 and u 2 are also reported in fig 6 the exact solutions to the riemann problem with added headloss are compared with the two dimensional swe numerical results the inspection of the figure shows that the flow depths and the wave celerities of the sp riemann exact solutions correspond nicely with the two dimensional results this suggests that an adjustment of the headloss through the porosity discontinuity may lead to an improvement of the agreement between the results of two dimensional swe model and sp riemann problem exact solution this is especially needed in the case study cs4 where the introduction of the headloss generated by the standing waves system through the geometric discontinuity leads to an impressive improvement of the exact sp riemann problem solution compare figs 4d and 6d notably the energy dissipation contributes to an additional reduction of the discharge through the geometric discontinuity in sub critical conditions together with the reduction of the leading wave celerity this can be inferred from the comparison of the columns q 1 in the tables 3 and 4 for the cases cs1 cs2 cs3 and cs5 and from the comparison between figs 4 and 6 conversely there is no influence of the energy dissipation on the transmitted discharge in the cases of supercritical flow through the geometrical transition while the leading wave celerity only is affected case studies cs4 and cs6 5 4 sp riemann problem numerical solution the six rapid transients of table 2 are simulated by means of a one dimensional sp numerical model where the position of eq 28 is used to approximate the sp flux while the mpws monotonic porosity weak solution by cozzolino et al 2018b and dip guinot et al 2017 approaches are used for the reconstruction of the variables 5 4 1 one dimensional sp numerical model the solution of the one dimensional sp system of eq 36 is approximated in a channel with length l 200 m by means of the finite volume scheme cozzolino et al 2018b 38 φ i u i n 1 φ i u i n δ t δ x ψ i 1 2 g u i 1 2 u i 1 2 ψ i 1 2 g u i 1 2 u i 1 2 δ t δ x s i 1 2 s i 1 2 where δ x x i 1 2 x i 1 2 is the length of the cell c i x i 1 2 x i 1 2 with centre x i 0 5 x i 1 2 x i 1 2 while 39 φ i 1 δ x c i φ x d x u i n h i h i u i t 1 φ i δ x c i φ x u x t n d x are the cell averaged values of the porosity φ x and of the conserved variables vector u x t respectively the other symbols in eq 38 are defined as follows ψ i 1 2 is the numerical porosity at the interface i 1 2 between ci and ci 1 g u v is a numerical flux corresponding to the one dimensional swe model u i 1 2 h i 1 2 h i 1 2 u i 1 2 t and u i 1 2 h i 1 2 h i 1 2 u i 1 2 t are the variables reconstructed to the left and to the right of the interface between the cells ci and ci 1 respectively finally s i 1 2 and s i 1 2 are the contributions to ci of the non conservative products through the interfaces in xi 1 2 and xi 1 2 respectively the initial conditions and the geometry are discontinuous and defined by 40 u i 0 u l x i 0 u r x i 0 φ i φ l x i 0 φ r x i 0 where the parameters u l u r φl and φr coincide with the corresponding parameters of sub section 5 2 while x 0 m corresponds to the channel centre in eq 38 the space step δx 0 10 m and the time step δt 0 0001 s are used in all the simulations while the numerical flux g u v is approximated by means of the hlle cozzolino et al 2014 approximate riemann solver two different reconstructions are used in the following in the mpws approach by cozzolino et al 2018b the position ψ i 1 2 min φ i φ i 1 is made when the flow energy is sufficient to pass through the porosity discontinuity while the reconstructed variables are defined as 41 u i 1 2 h i 1 2 φ i h i u i ψ i 1 2 t u i 1 2 h i 1 2 φ i 1 h i 1 u i 1 ψ i 1 2 t in eq 41 the reconstructed values h i 1 2 and h i 1 2 of the flow depth are solutions of 42 h i 1 2 φ i h i u i 2 2 g ψ i 1 2 h i 1 2 2 h i u i 2 2 g h i 1 2 φ i 1 h i 1 u i 1 2 2 g ψ i 1 2 h i 1 2 2 h i 1 u i 1 2 2 g which is the discrete version of eq 21 with δh 0 it is evident that the variables reconstruction of eqs 41 and 42 aims at preserving the discharge and the head of the flow through the geometric discontinuity congruently with the mathematical definition of standing discontinuity in eq 19 the non conservative product terms are approximated in the mpws approach as 43 s i 1 2 φ i f u i ψ i 1 2 f u i 1 2 s i 1 2 ψ i 1 2 f u i 1 2 φ i f u i when the head of the flow is not sufficient or when a rarefaction wave is attached to the geometric transition a more complicated procedure must be used and the interested reader is addressed to the original work by cozzolino et al 2018b in the one dimensional dip approach the reconstructed variables are defined as 44 u i 1 2 h i φ i h i u i ψ i 1 2 t u i 1 2 h i 1 φ i 1 h i 1 u i 1 ψ i 1 2 t where ψ i 1 2 min φ i φ i 1 while the non conservative products terms are defined as 45 s i 1 2 ψ i 1 2 φ i g h i 2 2 0 1 t s i 1 2 ψ i 1 2 φ i g h i 2 2 0 1 t due to the monotonicity of the porosity variation through x 0 the dip edge porosity is assumed as ψ i 1 2 min φ i φ i 1 in the following numerical computations this assumption satisfies the constraint of eq 31 5 4 2 one dimensional sp numerical results the sp numerical results are compared in fig 7 with the two dimensional swe results while the numerical states u 1 and u 2 in the computational cells immediately to the left and to the right of the abscissa x 0 m are reported in table 5 mpws reconstruction and table 6 dip reconstruction respectively in the same tables the corresponding unit width discharge hu discharge φhu and head unbalance δ h h 1 u 1 2 2 g h 2 u 2 2 2 g through the geometric transition are reported in the dip scheme the solution at some distance from the porosity discontinuity may be quite different from the values u 1 and u 2 in the case studies cs1 and cs2 the two dimensional swe flow is chocked because the state u l does not satisfies the limit criterion by yarnell 1934 the inspection of fig 7a and b shows that both the mpws and dip reconstructions reproduce this condition with sufficient accuracy supplying numerical results that are very similar to those of the two dimensional swe model the comparison between tables 3 and 5 shows that the mpws reconstruction captures nicely the exact solution of the sp riemann problem with invariant head through the geometric transition conversely the inspection of table 6 evidences a major discrepancy exhibited by the dip reconstruction namely an increase of flow head δh 0 with u 0 through the porosity abrupt reduction this dip issue which has been numerically verified here was first theoretically addressed in cozzolino et al 2018b there is an another evident issue in the dip calculations for the case studies cs1 and cs2 namely the discharge unbalance through the geometric discontinuity as evidenced by the fact that φlh 1 u 1 φrh 2 u 2 this additional issue which is not present in mpws calculations explains why the dip numerical results for the cases cs1 and cs2 seem closer than the mpws results to the two dimensional swe results despite the unphysical increase of energy through the porosity discontinuity the case study cs3 is characterized by initial conditions that admit three distinct exact sp riemann problem solutions see sub section 3 3 in contrast with the two dimensional swe numerical solution both the dip and mpws reconstructions supply a solution see fig 7c that corresponds to the configuration s3 of fig 3c where the flow remains supercritical through the geometric transition in particular the dip and mpws reconstructions do not reproduce the receding shock and both the models overestimate the discharge transmitted through the geometric discontinuity compare q 2 in table 3 with q 2 in tables 5 and 6 together with the celerity of the leading rarefaction the inspection of tables 5 and 6 shows that the mpws reconstruction preserves the energy also in the case of supercritical flow through the geometric transition while the dip reconstruction exhibits an unphysical head increase δh 2 00 m with u 0 in the case study cs4 fig 7d the solution produced by the two dimensional numerical scheme corresponds to a supercritical flow passing through the geometric transition where an evident headloss is present the numerical solutions supplied by the dip and mpws reconstructions correctly exhibit this configuration but the mpws model dissipates no energy table 5 while the dip model severely increases the flow head through the geometric transition δh 5 82 m with u 0 see table 6 the discrepancy between sp numerical results and swe numerical solutions is particularly evident in this case because the sp numerical results strongly overestimate the celerity of the propagating wave the cases cs5 fig 7e and cs6 fig 7f are characterized by a subcritical and a supercritical flow that encounter an abrupt porosity increase respectively the numerical solutions supplied by the dip and mpws reconstructions are quite similar to those of the two dimensional swe numerical scheme with flow depth at the left of the geometric discontinuity that is slightly underestimated the comparison between tables 3 and 5 shows that the mpws reconstructions captures the sp riemann problem exact solution with sufficient fidelity conserving the energy through the geometric transition conversely the inspection of table 6 shows that the dip model dissipates energy at the porosity increase δh 0 with u 0 by means of a purely numerical mechanism the inspection of the numerical results supplied by two different approaches mpws and dip for the approximate solution of sp riemann problems allows drawing some conclusion first it is evident that existing numerical approaches for interface flux calculation are not equipped with a mechanism that allows picking up the moving shock exhibited by the two dimensional swe model in the cases where multiple sp riemann solutions are possible see fig 7c second it is evident fig 7d that existing numerical schemes are not equipped with a mechanism able to add the required amount of energy dissipation when a system of standing waves is located through the geometric discontinuity in both the cases the overall effect is a systematic underestimation of the dissipated energy and an overestimation of the propagating wave celerity these observations suggest that deficiencies of current approximate sp riemann solvers is maybe one of the reasons explaining why additional drag sanders et al 2008 and transient momentum dissipation terms guinot et al 2017 which are not present in the original mathematical models of eqs 2 and 8 are often introduced in numerical models interestingly the inspection of columns φlq 1 φrq 2 and δh in table 5 shows that the mpws approach is efficient in preserving the invariance of discharge and head through the porosity discontinuity this success is attributed not only to the variables reconstruction of eqs 41 and 42 but also to the use of eq 43 for the computation of non conservative products contribution at interfaces which mimics the mathematical definition of eq 19 it is evident that an appropriate choice of the variables reconstruction could be used to introduce the correct amount of interface head loss where required 6 alternative porous differential models in the bsp model the geometric parameter i x y is isotropic and non homogeneous nonetheless in section 4 it has been shown that interface porosities ψ ij distinct from the cell averaged porosities φ i very naturally arise in bsp finite volume numerical schemes see remark 6 in section 4 2 as interface approximations of i x y in spite of the purely numeric nature of ψ ij many differential porosity models admitting a distinction between storage and conveyance porosities have been proposed in the literature for the analysis of numerical solutions behavior lh by lhomme 2006 diff ip by guinot and delenne 2014 diff dip by guinot et al 2017 these differential porosity models can be collectively rewritten as 46 φ h t ψ 1 h u x ψ 2 h v y 0 φ h u t x ψ 3 g h 2 2 ψ 4 h u 2 ψ 5 h u v y g h 2 2 ψ 3 x φ h v t ψ 4 h u v x y ψ 3 g h 2 2 ψ 5 h v 2 g h 2 2 ψ 3 y where the values of the porosity coefficients ψ 1 ψ 2 ψ 3 ψ 4 ψ 5 and φ fall in the interval 0 1 in eq 46 the symbols are as follows φ is the storage porosity ψ 1 and ψ 4 are the conveyance porosity coefficients related to the fluxes of mass and momentum respectively along x analogously the conveyance porosity coefficients ψ 2 and ψ 5 are related to the fluxes of mass and momentum respectively along y finally the porosity coefficient ψ 3 denotes the fraction of the frontal area on which the obstacles do not exert pressure forces the table 7 reports the correspondence between the symbols of eq 46 and the symbols used in the literature with the equations numbering that corresponds to the papers where the models are first discussed the laws of fluid mechanics must be invariant with respect to the galilean transformations landau and lifshitz 1987 and the porous shallow water models cannot constitute an exception to this fundamental constraint in this section it is demonstrated that the use of different definitions for storage and conveyance porosity coefficients in porosity differential models violates the galilean invariance in particular it is proven that swe sp and bsp model are invariant with respect to the galilean transformations while lh lhomme 2006 diff ip guinot and delenne 2014 guinot et al 2017 and diff dip guinot et al 2017 do not satisfy this property this implies that the use of different definitions for storage and conveyance porosity coefficients in porosity differential models is not physically meaningful and that these models cannot be used for the analysis of flood wave propagation through urban fabric for the sake of simplicity only the uniform motion of the reference frame with velocity u 0 along the x axis is considered in this case the relation between the time and space coordinates in the fixed inertial reference frame oxy and in the inertial moving reference frame o xy is 47 x x u 0 t y y τ t where x and y are the space variables parallel to x and y respectively in the moving reference while τ is the time variable in the moving reference recalling that the values of the physical quantity f x y τ in the moving reference frame are related to the corresponding values f x y t in the fixed reference by 48 f x y t f x x y t y x y t τ t the application of the derivatives chain rule supplies 49 f x f x f y f y f t f τ u 0 f x if u and v are the components of the velocity vector expressed with respect to the translating reference o xy it follows from eq 47 that 50 u u u 0 v v the application of eqs 48 50 to the eq 46 leads to 51 φ h τ ψ 1 h u x ψ 2 h v y δ 1 φ h u τ x ψ 3 g h 2 2 ψ 4 h u 2 ψ 5 h u v y g h 2 2 ψ 3 x δ 2 φ h v τ ψ 4 h u v x y ψ 3 g h 2 2 ψ 5 h v 2 g h 2 2 ψ 3 y δ 3 where 52 δ 1 ψ 1 φ h u 0 x δ 2 ψ 4 φ h u 0 u x ψ 4 ψ 1 h u 0 2 x ψ 4 ψ 1 h u 0 u x ψ 5 ψ 2 h u 0 v y δ 3 ψ 4 φ h u 0 v x the comparison between the eqs 46 and 51 shows that the uniform motion of the reference frame along the x axis gives rise to the terms δ 1 δ 2 and δ 3 in particular the first of eq 52 can be interpreted as a violation of mass conservation and it is clearly unphysical while the terms δ 2 and δ 3 can be interpreted as spurious forces that alter the force balance in eq 46 the inspection of eq 52 shows that independent of the flow field the galilean invariance along the x axis is restored if ψ1 ψ4 φ and ψ2 ψ5 because these positions make the unbalancing terms δ 1 δ 2 and δ 3 disappear in a similar fashion it is possible to consider the uniform motion of the reference frame along the y axis showing that the galilean invariance is restored if ψ2 ψ5 φ and ψ1 ψ4 the two systems of conditions imply that the complete galilean invariance is recovered if ψ1 ψ2 ψ4 ψ5 φ leading to the following corrected system 53 φ h t φ h u x φ h v y 0 φ h u t x ψ 3 g h 2 2 φ h u 2 φ h u v y g h 2 2 ψ 3 x φ h v t φ h u v x y ψ 3 g h 2 2 φ h v 2 g h 2 2 ψ 3 y the structure of eq 53 excludes lh diff ip and diff dip where the conveyance porosity differs from the storage porosity while admits swe sp and bsp in particular the swe model coincides with eq 53 where φ ψ 3 1 while the sp model coincides with eq 53 where ψ 3 φ finally the bsp model inherits the galilean invariance property from the sp model because it coincides with the restriction of sp to the case φ i in section 2 it has been demonstrated that bsp is the differential counterpart of ife implying that there is no grounded connection between ife and diff ip or diff dip for this reason diff ip and diff dip should not be used to deduce the wave propagation characteristics through the urban fabric this observation which is confirmed by the lack of galilean invariance in diff ip and diff dip is coherent with the remark 6 of section 4 2 the conveyance porosity which arises very naturally during numerical modelling as averaged value of i through cell interfaces cannot be introduced into mathematical models finally it has been shown in section 4 that ip by sanders et al 2008 and dip by guinot et al 2017 are two admissible numerical models for the approximate solution of the bsp model this implies that diff ip and diff dip should not be used to deduce the numerical stability properties of ip and dip 7 discussion in the present section the influence of obstacles on the flood celerity propagation is investigated by comparing the results of the discontinuous porosity sp riemann problem with the corresponding uniform porosity sp results 7 1 influence of urban porosity discontinuities on celerity propagation in the present sub section the analysis of the signal speed modifications induced by the geometric discontinuities is limited to the sp riemann problem exact solution with δh 0 m but analogous observations which are not reported here for the sake of brevity can be made for the solutions with added headloss the exact solution of the discontinuous porosity riemann problem for the test case cs1 is plotted in fig 4a while the corresponding states u 1 and u 2 are reported in table 3 it is immediate to see that the fastest signal celerity corresponding to the right rarefaction toe is c t o e u 2 2 g h 2 8 72 m s notably the celerity of the right rarefaction toe reduces to the value c t o e u l 2 g h l 8 14 m s in the case of uniform porosity unexpectedly this proves that a porosity reduction may cause an increase of the fastest signal celerity contrarily to what intuitively expected the signal celerity increase through the porosity reduction is not an sp artifact because it captures well the behavior of the two dimensional swe through the width reduction see fig 4a despite the signal speed increase this case study results show that the porosity reduction causes a discharge decrease through the abscissa x 0 m reducing the volume available for the flooding of new areas analogous observations can be made for the case studies cs2 and cs3 fig 4b c in the case study cs4 fig 4d the supercritical flow from the left impinges on a sudden porosity reduction but the discontinuous porosity sp solution does not predict a reflected shock and the impinging flow passes entirely through the geometric discontinuity also in this case the comparison with the uniform porosity sp solution shows that the porosity reduction causes an increase of the fastest signal celerity the inspection of the fig 4d shows that the two dimensional swes signal celerity is minor than the signal celerity in the sp model with porous discontinuity due to the strong energy dissipations through the standing wave and this implies that the headloss through the geometric discontinuity may have a role in the flooding celerity reduction this is confirmed by fig 6d where the introduction of the energy dissipation through the standing wave in the exact sp riemann problem solution allows reproducing with good fidelity the two dimensional swe results in the case study cs6 fig 4f the supercritical flow from the right encounters a porosity increase and the discharge through x 0 m is not altered the fastest signal celerity for the discontinuous porosity sp riemann problem results in table 3 is c t o e u 1 2 g h 1 10 08 m s while the corresponding celerity for the uniform porosity sp riemann problem is c t o e u r 2 g h r 10 96 m s it is evident that the porosity increase causes a reduction of the fastest signal speed with respect to the case of uniform porosity contrarily to what expected as above the signal celerity modification is not an sp model artifact because the swe model exhibits a similar behavior see fig 4f notably the discharge through x 0 m is distributed on a larger area when the porosity increases causing a flow depth decrease similar observations can be made for the case study cs5 where a subcritical flow encounters a porosity increase fig 4e from the examples presented it is evident that the modification of the flooding wave characteristics caused by the urban fabric should be understood as follows a in case of subcritical flow through porosity reductions case studies cs1 cs2 and cs3 the fastest sp signal celerity is greater than the uniform porosity case but only a fraction of the impinging discharge is transmitted through the geometric discontinuity b in case of supercritical flow through a porosity reduction case study cs4 the fastest sp signal celerity is greeater than the uniform porosity case but the discharge is entirely transmitted additional dissipations are needed in order to reproduce the reduction of the fastest signal speed exhibited by the two dimensional swe results c at porosity increases the sp signal speed is always smaller than the corresponding uniform porosity case because the discharge is distributed on a larger area case studies cs5 and cs6 with reduction of the flow depth the combination of all these effects contributes to explain the slowing down of the flood through urbanized areas in the literature differential models with different definitions for the storage and conveyance porosity such as diff ip and diff dip have been used to describe the alterations of the flood wave celerity produced by the urban fabric guinot et al 2017 in these models it is prescribed that the conveyance porosity is minor than the storage porosity in order to reduce the flood celerity propagation with respect to the case of isotropic porosity unfortunately the examples presented here demonstrate that the influence of porosity variations may be reverse to what expected because the fastest signal speed may increase when the porosity reduces case studies cs1 cs2 cs3 and cs4 while it may reduce when the porosity increases case studies cs5 and cs6 this observation which is in agreement with the physical inconsistency of diff ip and diff dip demonstrated in section 6 implies that diff ip and diff dip are not good differential models for the description of flood wave propagation through the urban fabric conversely the results of sections 5 2 and 5 3 show that the discontinuous porosity sp riemann problem supplies wave celerities that are congruent with the two dimensional swe model at least in nearly one dimensional problems 7 2 energy dissipation mechanisms the exact and numerical solutions in section 5 show that energy dissipations have a role in reducing the flood wave celerity through the urban fabric two alternative swe energy dissipation mechanisms are considered in guinot et al 2017 namely a transient dissipation mechanism due to wave reflection against the obstacles and a steady additional mechanism due to the obstacles drag an additional dissipative mechanism due to the presence of standing waves through the geometric discontinuity has been individuated in the present paper transient dissipation mechanism the case studies cs1 cs2 and cs3 show that the moving shock waves in the exact sp riemann problem solutions have the potential to reproduce at least in nearly one dimensional cases the energy dissipations introduced by the reflection of swe through the urban fabric limiting the resort to momentum dissipation coefficients this is confirmed by the good superposition between sp exact solution and two dimensional swe numerical solution in fig 4a b c where both strength and position of the shocks is captured with good approximation approximate sp riemann solvers are expected to capture the moving shock solutions generated by the impact of the flow on a porosity reduction unfortunately the numerical results obtained in section 5 4 with two different approximate sp riemann solvers namely mpws and dip show that these numerical models are not able to reproduce the moving shock see fig 7c in the case study cs3 where the exact sp riemann problem admits multiple solutions it follows that there is an entire class of flow conditions where numerical models may introduce a systematic lack of energy dissipation interestingly no meaningful energy dissipation mechanism acting through the porosity discontinuity such as those proposed by guinot et al 2017 can surrogate in a transparent way the transient dissipation mechanism activated by moving shocks that develop far from the geometric discontinuity from the present discussion it is clear that approximate riemann solvers should be improved in order to capture moving shocks when these are present in the exact riemann solution instead of resorting to empirical momentum dissipation coefficients guinot et al 2017 obstacles drag in real flows energy dissipation through geometric discontinuities is mainly attributed to vortices around geometric irregularities guinot et al 2018a in two dimensional numerical models analogous energy dissipations are activated by numerical viscosities with a mechanism similar to that of physical eddy viscosities despite the physical or numerical origin of the energy dissipations the discussion of sub section 5 3 shows that it is possible to introduce interface headloss by appropriately defining the standing wave of eq 19 the inspection of fig 6 demonstrates that this makes the exact sp riemann solution superpose well with the two dimensional swe model solution in all the numerical examples the introduction of interface headloss through the standing wave definition has the advantage of leaving the structure of the mathematical model unchanged without resorting to empirical drag mechanisms sanders et al 2008 guinot et al 2017 that are not present in the original bsp and ife models and it could be very naturally used to take into account the drag forces through the urban fabric in fact the structure of eq 19 demonstrates that the choice of a relationship between the states u 1 and u 2 immediately to the left and to the right of the discontinuity respectively is equivalent to the choice of the walls reaction sγ unfortunately the relationship between energy dissipations and characteristics of the geometric transitions is far from being easy to be found and an in depth discussion of this topic is left to future research standing waves dissipation an exception to the preceding energy dissipation mechanism is the case study cs4 which is characterized by supercritical flow through a porosity reduction in section 5 1 it has been demonstrated that this condition which has been individuated here for the first time in the context of porous models is connected to the formation of a system of standing waves through the geometric discontinuity that originates additional energy dissipation the inspection of table 4 shows that this energy dissipation is one order of magnitude greater than the dissipations of the other case studies despite the different nature of the energy dissipation mechanism the inspection of fig 6d demonstrates that an appropriate definition of the standing wave definition of eq 19 makes the exact sp riemann solution superpose well to the two dimensional swe model solution also in the case study cs4 the further discussion of this energy dissipation mechanism and its relationship with the characteristics of geometry discontinuities is left to future research 8 conclusions in the present work which is inspired by the seminal papers by defina 2000 guinot and soares frazão 2006 and sanders et al 2008 integral and differential forms of porosity models for urban flooding simulations have been considered from both theoretical and numerical points of view the binary single porosity bsp model which is the restriction of the single porosity model sp guinot and soares frazão 2006 to the case where the porosity coincides with the binary indicator function has been proposed here for the first time the bsp model is derived from the two dimensional shallow water equations swe by introducing the obstacles into the mathematical model and it exhibits non conservative products that take into account the thrust exerted by the flow on the solid walls similarly to the original integral flow equations ife by sanders et al 2008 the bsp differential model is fully local and it does not depend on the existence of a representative elementary volume the ife model itself is recovered through space integration of the bsp model and this states the identity between the two formulations showing that no other differential model can be used in order to investigate the ife model and its numerical discretizations the identity between ife and bsp is reflected into the computations implying that the corresponding finite volume numerical discretizations coincide in these numerical schemes a bsp riemann problem must be solved at cell interfaces for the calculation of numerical fluxes and non conservative products actually the bsp riemann problem reduces to a sp riemann problem because the finite volume representation of the binary indicator function in the generic cell coincides with the cell storage porosity which ranges between zero and one existing ife numerical models such as the integral porosity ip model sanders et al 2008 and the dual integral porosity dip model guinot et al 2017 are particular cases of bsp numerical models where the sp riemann problem is solved in a simplified manner interestingly bsp finite volume schemes formally coincide with sp schemes and this explains the success of sp models where the porosity varies from a cell to another without reference to the rev definition the relevance of the sp riemann problem solution for bsp finite volume schemes has prompted the comparison of the sp exact solution with the solution of the two dimensional swe in six representative test cases this comparison shows that the sp riemann problem has the potential to take into account the energy dissipations caused by wave reflections at obstacles limiting the resort to interface momentum dissipation coefficients unfortunately there are initial conditions where current approximate sp riemann solvers are not able to capture the structure of the swe solution and this leads to a systematic underestimation of the dissipated energy in numerical models it is evident that approximate sp riemann solvers should be improved in order to capture moving shocks when these are present in the exact riemann solution instead of resorting to empirical transient momentum dissipation coefficients the two dimensional swe numerical experiments show that energy dissipations are intense in the case that a supercritical flow passes through a contraction because a system of standing shock waves may establish through the geometric discontinuity in the present paper it has been shown that the exact sp riemann solution is able to accurately capture the two dimensional swe solution if the correct amount of headloss is considered through the porosity discontinuity in the examples presented this energy dissipation has been embedded into the non conservative product definition instead of adding additional drag coefficients that alter the mathematical model structure the comparison between the numerical results of the swe model and the sp riemann problem solution with added headloss seems encouraging the sp and bsp models have been compared with alternative differential models from the literature these models which aim to describe the alterations of the flood wave celerity produced by the urban fabric adopt different definitions for storage and conveyance porosity in the present paper it is demonstrated that these differential models which are physically inconsistent because they violate the galilean invariance do not predict the influence of porosity variations on the signal celerity in fact the swe numerical experiments show that the fastest signal speed may increase when the porosity reduces while it may reduce when the porosity increases this behaviour is opposite to what predicted by these alternative differential models while it is well reproduced by the sp riemann problem solution the investigation of integral and differential porous shallow water models has revealed an unsuspected link between these two classes of models namely the sp riemann problem and many tasks are left to future research among these the most important are finding the general solution of the sp riemann problem and constructing an approximate sp riemann solver able to capture the structure of the swe solution independent of initial conditions acknowledgments the writers want to warmly thank the three anonymous reviewers for having improved the quality of the paper with their comments and suggestions also the last author wants to thank dr eng vittorio pasquino for fruitful discussions and beers this research was partially funded by the university of naples parthenope through the funding programs sostegno alla ricerca individuale 2015 2017 and ricerca competitiva triennio 2016 2018 appendix a obtaining the eq 6 if the first of eq 3 is multiplied by the smooth function ρ x y the following equation is obtained a 1 ρ h t ρ h u x ρ h v y 0 recalling that a 2 ρ h u x ρ h v y ρ h u x ρ h v y h u ρ x h v ρ y ρ h u x ρ h v y h v t ρ the eq a 1 can be rewritten as a 3 ρ h t ρ h u x ρ h v y h v t ρ finally the first of eq 6 is obtained recalling that ρ does not depend on t and that it is possible to write ρ h t ρ h t the manipulations for the second and the third of eq 6 are very similar and they are not reported here for the sake of brevity appendix b consistency of swe and ife model the ife model is obtained in sanders et al 2008 by direct application of mass and momentum conservation principles in the present section the same model is obtained by integrating the swe of eq 3 in the space with the introduction of free slip solid boundary conditions of eq 4 at the building perimeter b 1 conservation of mass consider the connected two dimensional control volume ω which can be subdivided into the non superposing control volumes ω b and ω v the control volume ω b consists of the points that are occupied by buildings while ω v consists of the voids streets squares among the buildings fig 1a it is evident that the indicator function takes the value i x y 1 on ω v and the value i x y 0 on ω b the boundary ω of ω can be subdivided into a portion ω f that is free of buildings where i x y 1 and into a portion ω b that is immersed into buildings where i x y 0 in addition let the boundary ω v of ω v be subdivided into a portion ω v f that is free of buildings and into a portion ω v b that lies along the buildings perimeter and which is immersed in ω fig 1b it is evident that ω f coincides with ω v f compare fig 1a and 1b let the first of eq 3 be integrated on ω v obtaining b 1 0 ω v h t h u x h v y d ω d d t ω v h d ω ω v h v t m d s where m m x m y t is the unit outward vector along ω v v u v t is the velocity vector and t is the matrix transpose symbol the eq b 1 follows from the fact that the divergence theorem allows writing b 2 ω v h u x h v y d ω ω v h v t m d s recalling the boundary condition of eq 4 the solid boundaries can be now introduced in the integral form b 3 ω v b h v t m d s 0 obtaining b 4 d d t ω v h d ω ω v f h v t m d s 0 it is easy to see that the eq b 4 can be rewritten as the first of eq 8 this result is obtained recalling that b 5 ω v h d ω ω v i h d ω ω v i h d ω ω b i h d ω ω i h d ω ω v f h v t m d s ω f h v t n d s ω f i h v t n d s ω f i h v t n d s ω b i h v t n d s ω i h v t n d s because m non ω v f ω f see fig 1 the eq b 4 coincides with the eq 1 in sanders et al 2008 and with the first of eq 8 in the present work b 2 conservation of momentum the second of eq 3 is now integrated on ω v obtaining b 6 0 ω v h u t h u 2 x h u v y x g h 2 2 d ω d d t ω v h u d ω ω v h u v t m d s ω v g h 2 2 m x d s if the boundary condition v t m 0 along ω v b is introduced the following equation b 7 d d t ω v h u d ω ω v f h u v t m d s ω v f g h 2 2 m x d s ω v b g h 2 2 m x d s 0 is obtained finally the eq b 7 can be rewritten as b 8 d d t ω i h u d ω ω i h u v t n d s ω i g h 2 2 n x d s ω v b g h 2 2 m x d s 0 similar manipulations can be conducted on the third of eq 3 if the integral form of the second and the third of eq 3 are united in vector form the second of eq 8 is obtained the last equation coincides with eq 2 in sanders et al 2008 appendix c exact solution of the sp riemann problems in the present appendix the exact solution of the sp riemann problems considered in the section 5 is presented this solution reduces to writing the system of equations that allows finding the states u 1 and u 2 the case studies cs1 cs2 and cs3 are characterized by a shock connecting the state u l to the state u 1 while a rarefaction connects the critical state u 2 to the dry bed for this reason the solution of the riemann problem is immediately found by solving the system c 1 u 1 u l h 1 h l g 1 h 1 1 h l 2 φ l h 1 u 1 φ r h 2 u 2 h 1 u 1 2 2 g h 2 u 2 2 2 g δ h u 2 g h 2 where δh 0 in eq c 1 the first equation represents a shock contained into the first characteristic field that connects the state u l to the state u 1 while the second and the third equations represent the discharge invariance and the head relationship through the geometric discontinuity respectively compare with eq 21 finally the last equation expresses the fact that the state u 2 is critical the case study cs4 is characterized by supercritical flow through the geometric discontinuity with u 1 u l the solution of the riemann problem reduces to finding the supercritical state u 2 by means of c 2 φ l h l u l φ r h 2 u 2 h l u l 2 2 g h 2 u 2 2 2 g δ h where δh 0 the case study cs5 is characterized by a rarefaction connecting the state u r to the critical state u 2 while a rarefaction connects the supercritical state u 1 to the dry bed for this reason the solution of the riemann problem is immediately found by solving the system c 3 u 2 2 g h 2 u r 2 g h r u 2 g h 2 φ l h 1 u 1 φ r h 2 u 2 h 1 u 1 2 2 g h 2 u 2 2 2 g δ h where δh 0 in the system of eq c 3 the first equation represents a rarefaction contained into the second characteristic field that connects the state u r to the state u 2 while the second equation represents the condition that u 2 is critical finally the third and the fourth equations represent the discharge invariance and the head relationship through the geometric discontinuity the case study cs6 is characterized by a supercritical flow that remains supercritical through the geometric discontinuity with u 2 u r the solution of the riemann problem reduces to finding the supercritical state u 1 by means of c 4 φ l h l u 1 φ r h r u r h 1 u 1 2 2 g h r u r 2 2 g δ h where δh 0 
539,a novel differential porosity model for urban flooding namely the binary single porosity model bsp is proposed in the present paper the bsp model which is derived from the single porosity sp model by constraining the porosity to attain only the values zero inside the buildings and one in the voids among the buildings is local and independent on the existence of a representative elementary volume rev the bsp model satisfies the galilean invariance while the corresponding wave speeds are identical to those of the shallow water equations model and its integral formulation coincides with the original integral model by sanders et al 2008 the structure of the bsp model implies that the solution of the sp riemann problem is the numerical building block for the construction of the corresponding finite volume schemes this observation prompts a further study of the sp model and its solutions demonstrating that the exact sp riemann problem solution has the potential to take into account the transient energy losses due to wave reflections through the urban fabric in bsp models nonetheless a further comparison with the two dimensional swe results demonstrates that additional stationary energy dissipations must be accurately taken into account through porosity reductions in the case of supercritical flow the numerical experiments show that available approximate sp riemann solvers may cause a systematic underestimation of the energy dissipation through the urban fabric and an overestimation of the flood celerity the improvement of sp riemann solvers could limit the resort to additional drag and momentum dissipation terms that are frequently added in numerical models finally the investigation of the differential porosity models where different definitions are used for storage and conveyance porosity shows that these models suffer from a fundamental lack of physical congruence implying that they cannot be used for the analysis of flood wave propagation through the urban fabric keywords porous shallow water equations integral porosity shallow water model urban flooding differential equations 1 introduction the urban environment is characterised by numerous obstacles and buildings that must be taken into account because they strongly influence the flow propagation characteristics larocque et al 2013 bazin et al 2017 in particular laboratory experiments testa et al 2007 soares frazão and zech 2008 guinot et al 2018b have shown that obstacles are able to reduce the flood propagation celerity through the urban fabric this effect is attributed to the presence of wave reflections which are able to reduce the flood volume transmitted through the urban layout and to local energy dissipation phenomena guinot et al 2017 guinot et al 2018a the two dimensional shallow water equations swe are commonly used to model urban flooding events mignot et al 2006 gallegos et al 2009 from the mathematical point of view the presence of obstacles can be introduced by excluding the buildings from the physical domain and imposing solid wall boundary conditions along the obstacle perimeter the numerical counterpart of this approach is called building hole method in the nomenclature by schubert and sanders 2012 in the corresponding numerical framework the computational mesh is constructed along the streets where the swe are discretized while wall boundary conditions are imposed along the perimeter of mesh holes the numerical solution of the swe soares frazão et al 2008 guinot 2012 özgen et al 2016a b guinot et al 2017 has been proven effective in simulating the reduction of flood propagation speed through the urban fabric but its computational burden is not negligible in fact it is well known that the explicit resolution of obstacles in numerical models is computationally expensive because very refined meshes are required to represent the streets with sufficient accuracy kim et al 2015 in order to reduce the computational burden solid obstacles and buildings can be incorporated into the mathematical model itself following an integral approach sanders et al 2008 or a differential approach defina 2000 lhomme 2006 guinot and soares frazão 2006 guinot 2012 velickovic 2012 these mathematical models are discretized on coarser meshes where the obstacles and the streets are merged using the concept of porosity in order the represent the obstacle density it is commonly believed that due to the urban texture irregularities only the integral flow equations ife see eqs 1 and 2 in sanders et al 2008 may supply meaningful information at the scale of interest meters or tens of meters while the differential porosity models are considered meaningless at the same scales guinot et al 2017 the numerical discretization of ife is usually conducted in the framework of the finite volume method and two examples available in the literature are the integral porosity ip shallow water model by sanders et al 2008 and the dual integral porosity dip shallow water model by guinot et al 2017 a feature of these numerical models is the possibility of separately defining the local fraction φ of unit surface area available for water storage storage porosity and the local fraction ψ of the frontal area that is free to the passage of water conveyance porosity despite the encouraging results sanders et al 2008 schubert and sanders 2012 özgen et al 2016b guinot et al 2017 the energy dissipation is underestimated in these numerical models for this reason empirical drag and momentum dissipation terms which are not present in the original mathematical formulation of the integral porous equations have been introduced in the literature sanders et al 2008 özgen et al 2016b guinot et al 2017 guinot 2017 bruwier et al 2017 özgen et al 2017 guinot et al 2018b in contrast with the integral formulation many researchers have proposed models where the mass and the momentum conservation principles are written in differential form lhomme 2006 guinot and soares frazão 2006 velickovic 2012 guinot and delenne 2014 guinot et al 2017 obtaining the porous shallow water equations pswe in the differential model by lhomme 2006 hereinafter abbreviated lh distinct definitions were used for the storage and the conveyance porosity the lh model inspired the introduction of a differential porosity model hereinafter abbreviated diff ip which guinot and delenne 2014 assumed as a differential analogue of the discrete ip model by sanders et al 2008 while guinot et al 2017 introduced a differential porosity model hereinafter abbreviated diff dip as a differential analogue of their dip model the single porosity sp model guinot and soares frazão 2006 velickovic 2012 which is obtained under the assumption that a representative elementary volume rev exists such that the continuum approach to multicomponent fluids is devisable bear 1988 drew and passman 1999 differs from the preceding differential porosity models because a unique definition is used for storage and conveyance porosity the numerical experiments by guinot 2012 have shown that the size of a typical rev in urban environments with periodic geometry is one or two orders of magnitude greater than the distance between buildings or streets and this implies that the storage porosity φ should vary on a characteristic length of kilometers on the other hand the structure of many built up areas in real world urban environments is fractal thomas et al 2007 and the definition of a rev of any dimension seems impossible on such a strongly irregular pattern bruwier et al 2014 for this reason the storage porosity φ has been often taken uniform and defined as the ratio between non built areas and total urban area guinot and soares frazão 2006 soares frazão et al 2008 cea and vázquez cendón 2010 guinot 2012 benkhaldoun et al 2015 guinot et al 2017 viero 2019 ferrari et al 2019 while drag terms have been often added in order to take into account the obstacles distribution guinot and soares frazão et al 2006 soares frazão et al 2008 cea and vázquez cendón 2010 velickovic et al 2010 özgen et al 2017 velickovic et al 2017 soares frazão et al 2018 ferrari et al 2019 in this framework the sp model by velickovic 2012 differs from the other porosity differential models because drag and dispersive terms arise very naturally during the averaging process in the rev and are not empirically added in contradiction to the conceptual problems raised by the difficulty of defining a rev the practical applications have demonstrated the viability of finite volume schemes for the solution of the sp model where a local storage porosity is defined at the level of computational cell velickovic et al 2010 özgen et al 2017 soares frazão et al 2018 the use of variable porosity on a cell by cell basis without reference to the actual rev dimensions reminds the integral approach and it poses the question if this similarity is merely an accident or if it is theoretically possible to build a differential porosity model where the geometric characteristics are genuinely local and the concept itself of rev is omitted current finite volume schemes for the approximate solution of the sp model with variable porosity are based on the ability of solving an sp riemann problem at the interface between the cells where porosity and flow characteristics are discontinuous of course little is known about the exact solution of this riemann problem and few systematic studies are available ostapenko 2012 cozzolino et al 2017 cozzolino et al 2018a b pepe et al 2019 among the other results available an interesting finding by cozzolino et al 2018a shows that there are initial conditions leading to multiple solutions of the sp riemann problem this fact has subtle implications on the numerical solution of the porosity models because it poses the question about which of the alternative riemann solutions is physically meaningful and how numerical methods can be constructed in order to approximate this solution the present paper which is inspired by the seminal works by defina 2000 guinot and soares frazão 2006 and sanders et al 2008 aims at answering the theoretical questions raised in the preceding paragraphs and at discussing some issues related to the simulation of urban flooding in particular a novel differential model namely the binary single porosity model bsp is proposed and analysed the bsp model which coincides with the sp model where the porosity is constrained to the values zero inside the buildings and one in the voids among the buildings is local and independent on the existence of a rev the ife formulation by sanders et al 2008 is immediately recovered from bsp after a simple integration in space stating the identity between the two models due to the hyperbolicity of the bsp model the sp plane riemann problem is the building block for constructing the corresponding classic bsp finite volume schemes the comparison with the two dimensional swe results demonstrates that at least in the case of simplified geometries the solution of the sp plane riemann problem has the potential to take into account the transient energy losses due to wave reflections through the urban fabric limiting the resort to momentum dissipation coefficients further analysis of two dimensional swe results shows that intense energy dissipations never discussed before in the literature of porosity models must be taken into account when supercritical flows pass through porosity reductions finally the analysis of numerical solutions to sp riemann problems demonstrates that current sp riemann solvers may cause systematic underestimation of the energy dissipation through the urban fabric and the overestimation of the flood celerity the paper is organized as follows in section 2 the bsp model is constructed starting from the swe model and the identity between bsp and ife model is demonstrated the eigenstructure of sp and bsp models is discussed in section 3 together with the structure of the corresponding riemann problem and the cases of riemann problem multiple solutions are recalled in section 4 the structure of two dimensional bsp finite volume scheme is presented showing that the solution of the sp riemann problem is the main ingredient for the numerical approximation of the bsp model in the same section it is shown that existing schemes for the approximate solution of the ife model such as ip and dip are particular cases of the general bsp numerical framework in section 5 the sp riemann problem exact solutions are compared with the results of a two dimensional swe model demonstrating the limits and the merits of sp riemann problem exact solutions in the same section the results of two existing sp riemann solvers are compared with the two dimensional swe results highlighting the issues of current numerical approaches the findings presented in the sections 5 and 6 are discussed in section 7 with reference to the influence of the urban fabric on the flooding celerity and the corresponding dissipation mechanisms finally the paper is closed by a conclusions section 2 the binary single porosity model the single porosity sp model by guinot and soares frazão 2006 is particularly interesting because it retains mathematical properties of the swe model such as hyperbolicity rotational invariance and celerity of small disturbances guinot and soares frazão 2006 castro et al 2007 ferrari et al 2017 cozzolino et al 2018b if the bed slope and source terms such as building drag and bed friction are neglected the sp model takes the form 1 φ h t φ h u x φ h v y 0 φ h u t x φ g h 2 2 φ h u 2 φ h u v y g h 2 2 φ x φ h v t φ h u v x y φ g h 2 2 φ h v 2 g h 2 2 φ y in eq 1 the symbols have the following meaning x and y are the space independent variables of the inertial reference frame oxy while t is the time variable h x y t is the flow depth u x y t and v x y t are the vertically averaged components of the flow velocity along x and y respectively φ x y is the porosity which may attain values in the interval 0 1 and g is the gravity acceleration g 9 81 m s2 is assumed in the remainder of the paper in the model of eq 1 the variables h u and v must be intended as space averages the use of eq 1 is limited by the necessity of considering a rev where the averaging process that defines the porosity and the averaged quantities is devisable in order to consider a pswe model independent on the concept of rev the binary single porosity bsp model 2 i h t i h u x i h v y 0 i h u t x i g h 2 2 i h u 2 i h u v y g h 2 2 i x i h v t i h u v x y i g h 2 2 i h v 2 g h 2 2 i y is presented and discussed here in eq 2 i x y is an indicator function see fig 1 such that i x y 0 if the point x y falls on a building while i x y 1 if x y falls in a void among buildings sanders et al 2008 the comparison of eqs 1 and 2 shows that the bsp model is the restriction of eq 1 to the case ϕ x y i x y and this implies that the bsp model inherits all the mathematical properties of the sp model besides the similarities the bsp differs from the sp model because it does not require any space averaging for its definition while the variables h u and v are intended as point values and not as space averaged values in eq 2 the function i x y is isotropic because its local values do not depend on the direction and it behaves as a two dimensional heaviside step which passes abruptly from 0 to 1 through building walls the corresponding derivative is a two dimensional dirac s delta function which is null everywhere with the exception of the building walls position from the mathematical point of view the discontinuous nature of i x y is not an issue since the classic swe model itself admits solutions travelling shocks standing hydraulic jumps contact discontinuities where h u and v are discontinuous of course the derivatives must be intended in the sense of generalized functions leveque 1992 due to the presence of flow and geometric discontinuities in the present section it will be shown that the bsp model of eq 2 is consistent with the swe model in the sense that if u x y t h h u h v t where t is the matrix transpose symbol is the solution of the swe model it also satisfies the bsp model and vice versa in addition it will be shown that the bsp model coincides with the integral model by sanders et al 2008 here named integral flow equations ife this result implies that swe bsp and ife constitute a class of equivalent models see table 1 where this relationship is explicated admitting the same solution u x y t 2 1 construction of bsp from the swe model it is possible to construct the bsp model of eq 2 from the swe model without loss of generality for the objectives of the present work bed elevation variability bed resistance effects and reynolds stresses are neglected in the following to focus on the analysis of obstacle effects under these assumptions the following homogeneous form of the two dimensional swe toro 2001 3 h t h u x h v y 0 h u t x g h 2 2 h u 2 h u v y 0 h v t h u v x y g h 2 2 h v 2 0 is considered the first of eq 3 represents the mass conservation principle while the remaining equations represent the components along x and y respectively of the second principle of newton s dynamics the classic procedure for introducing obstacles effects into the swe model consists in using internal wall boundary conditions represented by the additional equation 4 v t m 0 x x b x b ω v b where v u v t is the velocity vector m m x m y t is the normal unit vector outward with respect to the fluid mass along the obstacle perimeter ω v b see fig 1a x x y t is the position vector in the plane x y while x b xb yb t is the generic position along ω v b according to eq 4 the flow velocity component orthogonal to the obstacle perimeter is null free slip boundary condition the swe model is valid among the obstacles where the binary function is i x y 1 but not inside obstacles where i x y 0 the multiplication of eq 3 by i x y which supplies 5 i h t h u x h v y 0 i h u t x g h 2 2 h u 2 h u v y 0 i h v t h u v x y g h 2 2 h v 2 0 is meaningful among the buildings and it is identically null inside the obstacles as expected the model of eq 5 which correctly picks up the swe model where its validity is guaranteed is not complete because the internal boundary condition of eq 4 must be imposed at building boundaries i e along the discontinuity of i x y in order to introduce the internal wall boundary condition into the mathematical model a smoothed version ρ x y of the binary indicator function i x y will be used first in order to allow usual derivative computations for this reason consider the function ρ x y that surrogates i x y as follows leveque 1992 i ρ x y 1 in the voids among obstacles excluding a thin strip of width ε around the buildings ii ρ x y passes smoothly and monotonically from 0 to 1 in the strip of width ε around the buildings iii ρ x y 0 inside the buildings if the swe model eq 3 is multiplied by ρ x y some calculation see appendix a allows writing 6 ρ h t ρ h u x ρ h v y h v t ρ ρ h u t x ρ g h 2 2 ρ h u 2 ρ h u v y g h 2 2 ρ x h u v t ρ ρ h v t ρ h u v x y ρ g h 2 2 ρ h v 2 g h 2 2 ρ y h v v t ρ by construction eqs 6 and 3 are consistent in the sense that the solution u x y t h h u h v t of eq 3 is also the solution of eq 6 and vice versa from the definition of ρ x y it is evident that the smooth function ρ x y tends to i x y and ρ tends to i in the limit ε 0 recalling that i mδ x x b where δ x x b is the two dimensional dirac s delta centred in the points x b drew and passman 1999 defina 2000 brocchini and peregrine 2001 eq 6 can be rewritten for ε 0 as 7 i h t i h u x i h v y h v t m δ x x b i h u t x i g h 2 2 i h u 2 i h u v y g h 2 2 i x h u v t m δ x x b i h v t i h u v x y i g h 2 2 i h v 2 g h 2 2 i y h v v t m δ x x b the solid boundary condition prescribes v t m 0 for x x b see eq 4 while the condition δ x x b 0 for x x b is a property of the dirac s delta function this implies that the terms v t m δ x x b at the right hand side of eq 7 are identically null and that the bsp model of eq 2 is recovered the construction evidences that the bsp model of eq 2 coincides with the swe model where obstacles have been directly incorporated into the model by means of eq 4 in particular if u x y t is a solution of the bsp model it is also solution of the swe model and vice versa the non conservative products 0 5gh 2 i x and 0 5gh 2 i y which cannot be recast in divergence form are identically null where i x y is uniform in the voids among the building and inside the buildings while they act through the building boundaries only for this reason the non conservative products in eq 2 take into account the interaction between the fluid and the solid boundaries no averaging process was used to obtain the model of eq 2 and this states the independence on a rev definition in other words the bsp and the swe models are equivalent at every scale even if a rev is not defined 2 2 identity between bsp and ife if reynolds stresses bed slope and friction are omitted congruently with the swe model of eq 3 the ife model of eqs 1 and 2 in sanders et al 2008 can be written as 8 d d t ω i h d ω ω i h v t n d s 0 d d t ω i h v d ω ω i h v v t n d s ω i g h 2 2 n d s ω v b g h 2 2 m d s 0 where ω is an arbitrary two dimensional control volume see fig 1a ω is the boundary of ω with outward normal unit vector n n x n y t and i x y is the isotropic binary indicator function interestingly the ife model of eq 8 can be easily obtained by integrating in space the swe of eq 3 complemented by the boundary conditions of eq 4 as shown in appendix b this result states the consistency between swe and ife models in the sense that the solution u x y t of the swe satisfies the ife model and vice versa leveque 1992 remark 1 the derivation of bsp and ife from the swe model of eq 3 implies that no drag or momentum dissipation coefficient appears in the models of eqs 2 and 8 congruently the numerical approximation of the bsp model or equivalently the ife model should be tackled without resorting to these additional terms the identity between bsp and ife models is immediately proven by showing that the integration in space of bsp supplies the ife model if the first of eq 2 is integrated over the arbitrary fixed control volume ω fig 1a the following equation 9 ω i h t d ω ω i h u x i h v y d ω 0 is obtained the application of the divergence theorem to the second integral of eq 9 supplies 10 d d t ω i h d ω ω i h v t n d s 0 where n n x n y t is the unit outward vector along ω the eq 10 where the time derivative has been moved out of the first integral because the control volume ω does not depend on time coincides with the first of eq 8 as expected similarly if the second of eq 2 is integrated over the control volume ω and the divergence theorem is applied the following equation is obtained 11 0 ω i h u t i h u 2 x i h u v y x g i h 2 2 g h 2 2 i x d ω d d t ω i h u d ω ω i h u v t n d s ω i g h 2 2 n x d s ω g h 2 2 i x d ω recalling that i mδ x x b the sifting property of the two dimensional delta function gel fand and shilov 1964 brocchini and peregrine 2001 allows picking up the obstacle boundary ω v b inside the control volume ω and converting the area integral into a line integral this supplies 12 ω g h 2 2 i x d ω ω g h 2 2 m x δ x x b d ω ω v b g h 2 2 m x d s the substitution of eq 12 into eq 11 finally leads to 13 d d t ω i h u d ω ω i h u v t n d s ω i g h 2 2 n x d s ω v b g h 2 2 m x d s 0 similar manipulations can be conducted on the third of eq 2 obtaining 14 d d t ω i h v d ω ω i h v v t n d s ω i g h 2 2 n y d s ω v b g h 2 2 m y d s 0 the scalar eqs 13 and 14 can be written in vector form as 15 d d t ω i h v d ω ω i h v v t n d s ω i g h 2 2 n d s ω v b g h 2 2 m d s 0 which coincides with the second of eq 8 as expected in conclusion the bsp model is the differential counterpart of the ife model by sanders et al 2008 because a simple integration of the bsp model on an arbitrary control volume leads to the ife model in particular if u x y t is the point solution of the bsp model it is also solution of the ife model and vice versa without any reference to the existence of a rev from the derivation it is clear that no other differential isotropic or anisotropic model shares this property the ife model has a priority sanders et al 2008 from the historical point of view but its bsp differential form is more convenient for numerous reasons i checking if u x y t is the solution of the ife model requires verifying that eq 8 holds for an arbitrary control volume ω leveque 1992 which is not feasible conversely the differential form is more easily checked after that u x y t is substituted into eq 2 in the regions where the flow is smooth while the rankine hugoniot is checked where the solution is discontinuous ii the integral form makes the study of ife mathematical properties difficult while the same investigation is easily accomplished in its bsp differential form see section 3 iii the differential form makes transparent the nature of the riemann problem to be solved at interfaces between cells in finite volume schemes see section 4 having demonstrated the identity between bsp and ife models only the bsp model will be considered in the following while the ife model by sanders et al 2008 will be retained as a synonym of integral form of bsp 3 the mathematical structure of the bsp model the mathematical structure of the bsp model must be investigated in the framework of the sp model by guinot and soares frazão 2006 and there are two reasons that motivate this first the bsp model is the formal restriction of eq 1 to the case φ x y i x y and this implies that the bsp model shares with the sp model important mathematical properties such as the hyperbolicity the rotational invariance the eigenstructure and the structure of the riemann problem solution the second reason is that similarly to the porosity function φ x y 0 1 the finite volume representation of the binary indicator function i x y inevitably takes values in the entire interval 0 1 because of the cell averaging process this implies that the solution of the sp riemann problem is the building block of bsp and ife finite volume numerical schemes in the present section some results guinot and soares frazão 2006 castro et al 2007 ferrari et al 2017 cozzolino et al 2018a b pepe et al 2019 absolutely necessary for understanding the additional discussion and the numerical developments contained in the rest of the paper are reported in particular the eigenstructure of the sp model and the definition of the standing porosity discontinuity are recalled the riemann problem is defined and a case of multiple riemann solutions which affects the practical computations is considered 3 1 eigenstructure in order to study the eigenstructure of the sp model it is convenient to treat the porosity as an ordinary conserved variable by adding the trivial equation φ t 0 ferrari et al 2017 to the system of eq 1 the corresponding plane system along x godlewski and raviart 1996 where the derivatives with respect to y are null is 16 φ u t φ f u x h x u φ x 0 φ t 0 in eq 16 u x y t h h u h v t is the vector of the conserved variables in the two dimensional swe f u h u h u 2 0 5 g h 2 h u v t is the vector of the fluxes along x in the two dimensional swe while h x u is a matrix defined as 17 h x u 0 0 0 0 0 0 5 g h 2 0 0 0 the non conservative product 0 5gh 2 φ x which deserves a special treatment because it cannot be put in divergence form is included in eq 16 because it is a constitutive part of the hyperbolic model and not a source term the system of eq 16 is hyperbolic and the corresponding eigenvectors are castro et al 2007 ferrari et al 2017 cozzolino et al 2018b 18 λ 0 0 λ 1 u g h λ 2 u λ 3 u g h the eigenvalues λ 0 and λ 1 coincide for u g h while λ 0 and λ 3 superpose for u g h and this makes the system non strictly hyperbolic in this case multiple solutions of the riemann problem are expected warnecke and andrianov 2004 lefloch and thanh 2011 han et al 2013 the eigenvalues λ 1 and λ 3 are connected to two genuinely non linear characteristic fields that may contain either shocks or rarefactions while the eigenvalue λ 2 is connected to a linearly degenerate characteristic field that may contain only ordinary contact discontinuities these eigenvalues and the speed of the corresponding elementary waves coincide with those of the swe model because the porosity parameters do not appear in the expressions of eq 18 the characteristic fields connected to the eigenvalues λi i 1 2 3 are characterized by uniform porosity through the elementary wave the additional eigenvalue λ 0 0 is connected to the porosity jumps which allow the representation of urban fabric irregularities through the non conservative product 0 5gh 2 φ x unfortunately the term 0 5gh 2 φ x is not well defined at porosity discontinuities because the product of a heaviside function the discontinuous representation of h 2 by a delta function the discontinuous representation of the derivative φ x has no meaning castro et al 2007 ion et al 2016 cozzolino et al 2018b for this reason the classic rankine hugoniot condition is not valid at porosity jumps and the generalized rankine hugoniot grh condition must be introduced lefloch 1989 dal maso et al 1995 the peculiarities connected to porosity discontinuities and their relevance for the solution of porous shallow flow models deserve additional discussion that is presented in the following sub section remark 2 if the transverse velocity v is null the system of eq 16 formally coincides with the one dimensional swe model with variable width φ and horizontal bed guinot and soares frazão 2006 sanders et al 2008 this formal analogy will be exploited in the rest of the paper 3 2 definition of the standing contact discontinuity the grh condition for the discontinuities connected to the eigenvalue λ 0 0 is cozzolino et al 2018b 19 φ r f u 2 φ l f u 1 0 s γ φ l φ r u 1 u 2 0 t where u 1 h 1 h 1 u 1 h 1 v 1 t and u 2 h 2 h 2 u 2 h 2 v 2 t are the vectors of the conserved variables immediately to the left and right of the standing porosity discontinuity respectively φ l and φ r are the corresponding left and right porosities and s γ φ l φ r u 1 u 2 is a localized term taking into account the effect of the non conservative product 0 5gh 2 φ x through the standing discontinuity the inspection of eq 19 shows that the unit width discharge φhu and the transverse velocity v are invariant through the standing discontinuity the term s γ φ l φ r u 1 u 2 is mathematically defined as lefloch 1989 dal maso et al 1995 20 s γ φ l φ r u 1 u 2 0 1 g 2 γ h s u 1 u 2 2 γ φ s s u 1 u 2 d s where γ h s u 1 u 2 and γφ s u 1 u 2 with s 0 1 are appropriate parameterizations of the variables h and φ through the discontinuity the physical meaning of eq 19 is obvious because it states that the force s γ exerted on the flow by the rapid porosity transition must be equal to the difference of the total forces to the left and to the right of porosity discontinuities nonetheless the mathematical expression of the function s γ φ l φ r u 1 u 2 is not determined into the sp model itself and different choices of the parameterizations γ h s u 1 u 2 and γφ s u 1 u 2 lead to a different relationship between the couples φ l u 1 and φ r u 2 in eq 19 this implies that the hydraulic modeler is free of introducing a description of the discontinuity internal structure that is appropriate for the problem at hand by defining γ h s u 1 u 2 and γφ s u 1 u 2 lefloch 1989 dal maso et al 1995 3 2 1 structure of the porosity variation the parameterization γφ s u 1 u 2 of the porosity variation through the discontinuity can be monotonic or non monotonic the case of monotonic porosity variation which is implicitly assumed in many classic sp numerical models guinot and soares frazão 2006 soares frazão et al 2008 cea and vázquez cendón 2010 finaud guyot et al 2010 ferrari et al 2017 cozzolino et al 2018a b is characterized by min φ l φ r γφ s u 1 u 2 max φ l φ r for each s 0 1 conversely the case of non monotonic porosity variation which is explicitly assumed in the ip and dip numerical models sanders et al 2008 özgen et al 2016b özgen et al 2017 guinot et al 2017 is characterized by min s γ φ s u 1 u 2 min φ l φ r the choice of the parameterization γφ s u 1 u 2 has considerable influence on the form of the sp riemann problem solution in fact critical flow conditions are possible only at the inlet or at the outlet of geometric transitions with monotonic porosity variation cozzolino et al 2018b while critical flow conditions are possible only inside the geometric discontinuity in the case of non monotonic variation cozzolino et al 2017 pepe et al 2019 if the formal analogy between one dimensional sp model and variable width one dimensional swe model is exploited see remark 2 of section 3 1 it becomes evident that monotonic porosity variations formally correspond to rapid monotonic width variations such as contractions and expansions while non monotonic porosity variations correspond to rapid non monotonic width variations such as venturi flumes and bridge piles this geometric analogue suggests that the choice of γφ s u 1 u 2 should be made at each porosity discontinuity based on the underlying urban geometry remark 3 the channel analogue interpretation is physically meaningful independent on the monotonicity of the channel width this implies that the choice of γφ s u 1 u 2 is always physically meaningful independent of its monotonicity properties this observation is confirmed by the availability of both monotonic and non monotonic discontinuous porosity schemes that are stable and well behaved for the sake of simplicity only monotonic porosity variation through the discontinuity will be considered in the following 3 2 2 head balance formulation the choice of the parameterization γ h s u 1 u 2 is far less obvious than the choice of γφ s u 1 u 2 because it cannot be easily related to the underlying urban geometry nonetheless this difficulty is circumvented by observing that the function s γ φ l φ r u 1 u 2 in eq 19 is implicitly defined by a relationship between the couples φ l u 1 and φ r u 2 the assumption that steady flow weak solutions of eq 16 supply the relationship between φ l u 1 and φ r u 2 has been best studied from a mathematical point of view cozzolino et al 2017 cozzolino et al 2018a b pepe et al 2019 the steady flow solution of eq 16 reduces to 21 φ r h 1 u 1 φ l h 2 u 2 δ h h 1 u 1 2 2 g h 2 u 2 2 2 g v 1 v 2 where the three equations represent the invariance of discharge the balance of hydraulic head and the invariance of the transverse velocity respectively the quantity δh is null in the case of smooth flow through the discontinuity while it is different from zero in the case that a hydraulic jump is present interestingly the sp model allows the introduction of δh 0 through a hydraulic jump even if viscous terms are not present in eq 16 because a force balance takes globally into account the eddies effect through the vanishing length region where the flow characteristics variation is rapid it is possible to generalize the meaning of eq 21 by recalling the formal analogy between one dimensional sp model and one dimensional swe with width variations this analogy suggests that concentrated head loss expressions in the form of eq 21 are congruent with the usual internal boundary conditions cunge et al 1980 used in saint venant equations for modeling channel width discontinuities such as sudden expansions formica 1955 venturi flumes dufresne and vazquez 2013 and bridge piles yarnell 1934 in analogy with the hydraulic jump head loss it is evident that the arbitrariness of γ h s u 1 u 2 makes these formulations viable even if viscous terms are not present in eq 16 of course the physical congruency requires that δh is non negative when u 1 0 flow directed from left to right and negative in the case u 1 0 flow directed from right to left the standing wave definition of eq 21 will be extensively used in the remainder of the paper 3 3 plane sp riemann problem and multiple solutions the plane sp riemann problem is the initial value problem where the system of eq 16 is solved with the following discontinuous initial conditions 22 u x y 0 u l x 0 u r x 0 complemented by the discontinuous porosity distribution 23 φ x y φ l x 0 φ r x 0 after that an appropriate definition of standing porosity discontinuity has been chosen the quantities u q h q h q u q h q v q t and φ q with q l r are the uniform flow state and the uniform porosity value respectively to the left l and to the right r of the initial discontinuity the solution u x y t of the riemann problem ferrari et al 2017 cozzolino et al 2018b is self similar and it consists of constant states that are separated by elementary waves the standing wave definition applies through the porosity discontinuity in x 0 while the moving waves corresponding to the swe are valid to the left and to the right of the initial discontinuity where the porosity is uniform under the assumption that steady flow weak solutions of eq 16 link the states u 1 and u 2 and that the porosity variation between φl and φr is monotonic it is possible to show that the exact solution of the sp riemann problem on dry bed always exists cozzolino et al 2018a this special riemann problem significant for the simulation of flood propagation through urban districts may admit multiple exact solutions when the flow impinging the sudden porosity reduction is supercritical an example of this phenomenon is the riemann problem with initial conditions φl 1 φr 0 6 u l 1 9 40 0 t and u r 0 0 0 t which admits three distinct solution configurations these solution configurations whose flow depth h is represented at t 5 s in fig 2 are described in the following s1 the supercritical flow is chocked by the sudden porosity reduction and it is reverted to subcritical flow by a moving shock radiated from the geometric discontinuity fig 2a the flow rate through the discontinuity is less than that corresponding to the impinging flow while the backward moving shock introduces energy dissipation into the flow field but not through the porosity discontinuity δh 0 in eq 21 s2 the impinging supercritical flow is reverted to outlet critical flow through the geometric discontinuity by a standing hydraulic jump located inside the geometric transition itself fig 2b the flow rate through the discontinuity is equal to the upstream flow rate δh 0 in eq 21 s3 the supercritical flow passes freely through the porosity reduction fig 2c with constant discharge and energy δh 0 in eq 21 the sp model does not embed the information necessary to make a correct choice among the alternatives the appearance of multiple solutions which is connected to the presence of geometric non conservative products is due to a loss of physical information caused by the adoption of a one dimensional model instead of a two or three dimensional model warnecke and andrianov 2004 this observation suggests using higher dimensions models to pick up a physically relevant solution among the alternatives this line of reasoning which has been frequently followed in the literature warnecke and andrianov 2004 han et al 2013 guides the approach used in the remainder of the present paper 4 finite volume numerical discretization of the porous shallow water models in the present section it is shown that the solution of the sp riemann problem presented in section 3 is the building block for the construction of bsp finite volume schemes in addition it is demonstrated that the existing ife numerical models ip by sanders et al 2008 dip by guinot et al 2017 are particular cases of the bsp numerical framework 4 1 finite volume discretization of the bsp model from eq 2 it is clear that the following cell averages 24 φ i 1 ω i ω i i x y d ω u i n 1 φ i ω i ω i i x y u x y t n d ω must be used to approximate the problem variables in bsp finite volume numerical schemes in eq 24 the meaning of the symbols is as follows ω i is the area of the ith control volume ω i the superscript n refers to the nth time level tn φi 0 1 is the approximation of i x y in ω i and it coincides by definition with the storage porosity in the ife schemes sanders et al 2008 guinot et al 2017 finally u i n h i n h i n u i n h i n v i n t is the vector of the swe cell averaged conserved variables from eq 24 it is clear that the numerical variables representation is discontinous through cell edges eq 8 states that the evolution of the cell averaged variables in the bsp model is driven by the fluxes through the cell interfaces and by the non conservative products the interface terms can be approximated by solving a local plane bsp riemann problem as usual for hyperbolic systems where the variables are discontinuous through the cell edges of course the binary indicator function i x y is approximated in the ith cell by means of the average φi of eq 24 which ranges in the interval 0 1 just like the porosity variable φ in the sp model due to the common structure of eqs 1 and 2 this implies that the solution of the interface bsp riemann problem reduces to the solution of an sp riemann problem following these considerations the first order finite volume solution of bsp and ife models can be written in the following form 25 φ i ω i u i n 1 φ i ω i u i n δ t j n i e i j φ s p φ i φ j u i u j n i j δ t j n i e i j s s p φ i φ j u i u j n i j where the explicit euler algorithm is used for advancing in time in eq 25 the meaning of the symbols is as follows δ t t n 1 t n is the length of the time step n i is the set of indices j such that ω j is a neighbor of ω i eij is the length of the edge e ij between ωi and ωj n i j n i j x n i j y t is the normal to the edge e ij orientated from ωi to ωj and such that n ij n ji φ sp φ i φ j u i u j n ij is the flux exact or approximate corresponding to the plane sp riemann problem along n ij where an appropriate definition of the standing porosity discontinuity is taken into account finally the term s sp φ i φ j u i u j n ij takes into account the effect on ω i of the non conservative products 0 5gh 2 i x and 0 5gh 2 i y through the interface e ij the porosity φi can be calculated in each computational cell after that the distribution of i x y is available from digital terrain models or aerial imagery sanders et al 2008 this implies that the results may be dependent on the computational mesh grid size orientation due to the irregularity of the obstacles distribution sanders et al 2008 guinot et al 2017 remark 4 in eq 25 the in cell contribution of the terms 0 5gh 2 i x and 0 5gh 2 i y is null this standard treatment is congruent with the first order approximation because the corresponding numerical representation φi of the variable i is constant into a cell implying that the in cell derivatives i x and i y are null of course it is possible to evaluate the in cell contribution of 0 5gh 2 i x and 0 5gh 2 i y by means of appropriate quadrature formulas when the variables h and i are reconstructed for second or higher order approximation compare with audusse et al 2004 and audusse and bristeau 2005 where such a treatment is discussed with reference to the swe model with variable bed elevation remark 5 formally the eq 25 coincides with a finite volume scheme for the solution of the sp model of eq 1 if the variables definition 26 φ i 1 ω i ω i φ x y d ω u i n 1 φ i ω i ω i φ x y u x y t n d ω is used all the sp finite volume schemes available in the literature can be written in the form of eq 25 and this implies that the same numerical schemes can be regarded as bsp numerical schemes when φi and u i are interpreted in the sense of eq 24 this formal identity explains the success of sp models where the porosity varies from a cell to another without reference to the rev definition velickovic et al 2010 özgen et al 2017 soares frazão et al 2018 4 2 a special class of bsp finite volume schemes castro et al 2007 presented a class of finite volume numerical schemes designed for the approximate solution of hyperbolic systems with non conservative products connected to standing discontinuities in these schemes which generalize the concept of hydrostatic reconstruction by audusse et al 2004 the non conservative products are taken into account through an appropriate reconstruction of the conserved variables at cell interfaces while the fluxes are calculated using a classic approximate or exact riemann solver for the homogeneous hyperbolic system in the framework by castro et al 2007 the first order bsp finite volume scheme of eq 25 can be rewritten as 27 φ i ω i u i n 1 φ i ω i u i n δ t j n i e i j ψ i j g u i j u i j n i j δ t j n i e i j s φ i ψ i j u i n u i j n i j in eq 27 ψ ij is an estimate of the edge averaged value of i through e ij g u i j u i j n i j is a numerical flux corresponding to the plane classic swe riemann problem u i j h i j h i j u i j h i j v i j t and u i j h i j h i j u i j h i j v i j t are the conserved variables reconstructed to the left and to the right of the edge e ij s φ i ψ i j u i n u i j n i j takes into account the effect on ω i of the non conservative products through the interface e ij the quantities ψ ij u i j and u i j are appropriately chosen in order to approximate the sp flux and non conservative products in the form 28 φ sp φ i φ j u i u j n ij ψ ij g u ij u ij n ij s sp φ i φ j u i u j n ij s φ i ψ ij u i n u ij n ij the first position of eq 28 is easily justified recalling that the fluxes of the mathematical sp model are equal to the product of the porosity by the fluxes of the swe model see remark 2 in section 3 1 this approach which does not require the explicit availability of an exact or approximate sp riemann solver has been used in the sp finite volume schemes by cea and vázquez cendón 2010 and cozzolino et al 2018b under the assumption 29 ψ i j min φ i φ j max φ i φ j which corresponds to a monotonic definition of porosity variation through the standing discontinuity a similar scheme has been used by castro et al 2007 for the approximate solution of the one dimensional swe model with variable width remark 6 note that the edge porosity ψ ij arises very naturally as a consequence of having adopted a simplified form of the sp riemann flux see eq 28 in other words the porosity coefficient ψ ij is not part of the bsp or ife mathematical models but it is a useful numerical device in view of the corresponding approximate solution having demonstrated that the bsp model is the differential version of ife it is expected that existing ife finite volume numerical schemes are nothing but bsp finite volume schemes under the assumption of negligible drag bed slope and friction the ip numerical scheme by sanders et al 2008 coincides with eq 27 with the following positions 30 ψ i j 1 e i j e i j i x y d s 31 ψ i j min φ i φ j 32 s i j ψ i j φ i g h i 2 2 0 n i j x n i j y t 33 u i j u i u i j u j the constraint of eq 31 reveals the assumption of non monotonic variation of the porosity through the standing discontinuity in the ip numerical model simulating the presence of local constrictions at interfaces in the same manner the dip numerical model by guinot et al 2017 coincides with the eq 27 where the positions of eqs 30 32 are made while the following reconstructed variables 34 u i j h i φ i h i u i ψ i j φ i h i v i ψ i j t u i j h j φ j h j u j ψ i j φ j h j v j ψ i j t are assumed for the calculation of the fluxes 5 the sp riemann problem and the wave propagation through geometric discontinuities in the bsp and ife models the solution of the sp plane riemann problem is the building block for constructing porosity finite volume models for this reason it is interesting to verify at which extent the sp riemann problem can reproduce the typical wave reflection and energy dissipation phenomena produced during the flood propagation through the urban fabric in the literature this study has been accomplished by considering the flood propagation through a domain consisting of a single street with periodic contractions and expansions and comparing the corresponding bsp and swe numerical solutions guinot 2012 özgen et al 2016b guinot et al 2017 bruwier et al 2017 guinot et al 2018b this approach exhibits two issues first the interaction between reflected and transmitted waves that radiate from two consecutive geometric discontinuities may hide their distinct contribution to the flooding wave propagation second the use of two dimensional bsp numerical models unfortunately moves the focus from the structure of the sp riemann problem exact solution to numerical modelling details these observations prompt a closer study of isolated geometric discontinuities where the sp riemann problem exact solutions are compared with the reference solutions supplied by a two dimensional swe numerical model for the same initial conditions a fair comparison requires that the isolated geometric discontinuities considered in the swe model are symmetrical because the flow variables and the porosity are uniform along the transverse direction in the sp plane riemann problem the approach is limited here to the case of monotonic porosity variation through the discontinuity while the non monotonic case will be tackled in future research in order to demonstrate the deficiencies of available approximate sp riemann solvers the same study is repeated by means of a one dimensional sp numerical scheme where two different variables reconstructions from the literature guinot et al 2017 cozzolino et al 2018b are used 5 1 description of the case studies it is considered an idealized urban layout consisting of a street l 200 m long with a single width discontinuity the street see fig 3 where a distorted layout is represented consists of a western reach whose width is bl 1 m and an eastern reach whose width is br 0 6 m a linear contraction which is located at the centre of the street where x 0 m connects the western reach to the eastern one by means of two straight walls that are inclined by 45 with respect to the street axis the linear contraction which is lc 0 20 m long is sufficiently short with respect to the street length to be considered a true geometric discontinuity the northern and the southern boundaries of the street are free slip walls while the western and the eastern boundaries are open ends given the street physical domain a two dimensional finite volume swe numerical model on unstructured triangular grid see the description in cozzolino et al 2017 is used to produce a set of benchmark case studies these case studies consist of six rapid transients that start from the discontinuous initial conditions 35 u x y 0 u l x 0 u r x 0 where the left and right initial states u l h l h l u l h l v l t and u r h r h r u r h r v r t are specified in table 2 together with the corresponding unit width discharge q hu and froude number f u g h the unstrucured triangular mesh used is non uniform with average side δs 0 50 m at the ends of the channel and δs 0 05 m in the vicinity of the geometric transition the inspection of table 2 shows that the case studies from cs1 to cs4 correspond to a flow directed from left to right that impinges a street contraction with dry right bed conversely the case studies cs5 and cs6 correspond to a flow directed from right to left that encounters a street expansion with dry left bed in fig 4 the free surface elevation supplied at time t 5 s by the two dimensional swe numerical model for the case studies from cs1 to cs6 table 2 is projected onto a longitudinal vertical plane and plotted with dots case study cs1 for this case study characterized by left froude number fl 0 60 the criterion by yarnell 1934 predicts flow chocking because the flow energy is insufficient to make the entire unit width discharge q l 1 88 m2 s pass freely this is confirmed by the corresponding two dimensional swe solution fig 4a where a left moving shock contained into the first characteristic field increases the flow depth immediately to the left of the geometric discontinuity but reduces the discharge through x 0 m the two dimensional swe solution is completed by a rarefaction wave contained into the first characteristic field which starts from the critical conditions immediately to the right of the porosity discontinuity and propagates on the dry bed case study cs2 the case study cs2 is very similar to the case study cs1 but the left state u l is now supercritical with froude number fl 1 50 again the energy of the state u l is not sufficient to make the unit width discharge q l 4 70 m2 s pass through the geometric discontinuity causing the chocking of the flow with the formation of a shock that moves towards left dots in fig 4b case study cs3 for this test case with fl 3 the criterion by yarnell 1934 predicts that the flow energy is sufficient to make the entire unit width discharge q l 9 40 m2 s pass through the geometric discontinuity but the inspection of the two dimensional swe numerical solution in fig 4c dots shows that the flow is chocked by a shock moving towards left this behavior which may look unexpected at first sight is justified recalling that the solution of the corresponding sp riemann problem with discontinuous porosity is not unique and that the chocked flow configuration s1 is one of the alternative solutions see section 3 3 and fig 2 case study cs4 this case study is characterized by a high froude number fl 4 5 with unit width discharge q l 14 09 m2 s the inspection of the corresponding two dimensional swe numerical solution dots in fig 4d shows that the supercritical flow impinging the geometric discontinuity remains supercritical without chocking the dots with high elevation in fig 4d are not an instability symptom because they correspond to a significant interaction between the flow and the channel contraction walls with the formation of standing shocks contained into the rapid width transition in order to explore this condition the corresponding two dimensional swe simulation is repeated on a triangular grid with side δs 0 01 m in the vicinities of the geometric transition the flow depth contours at the geometric transition between abscissas x 1 m and x 2 m which are plotted in fig 5 exhibit a very characteristic shock pattern with incident shocks i reflected shocks r and a mach stem m which meet at two symmetric triple points defina and viero 2010 significant head losses are connected to the presence of this system of standing shocks where the flow energy is dissipated with the same mechanism of the hydraulic jump the interested reader may compare fig 5 with fig 3 in akers and bokhove 2008 where the incident waves i and the mach stem m produced by a supercritical flow through a linear convergent channel are evidenced in a small scale laboratory experiment case study cs5 this case study is characterized by a right subcritical flow fr 0 6 with unit width discharge q r 1 88 m2 s encountering a rapid width increase which induces the formation of the critical state immediately to the right of the geometric discontinuity and the propagation of a rarefaction towards right dots in fig 4e the flow to the left of the initial discontinuity is supercritical case study cs6 this case study is characterized by a right supercritical flow fr 1 5 with q r 4 70 m2 s which flows through a sudden expansion and remains supercritical dots in fig 4f the expansion causes an acceleration of the flow and reducing the flow depth 5 2 sp riemann problem exact solution with no headloss added given the analogy between one dimensional sp model and one dimensional swe model with width variations remark 2 of sub section 3 1 the six rapid transients of table 2 are modelled as sp riemann problems and compared with the two dimensional swe reference solutions of fig 4 for this reason the purely one dimensional sp model 36 φ u t φ f u x 0 0 5 g h 2 t φ x 0 where u x t h h u t and f u h u 0 5 g h 2 h u 2 t is solved with initial conditions and discontinuous geometry 37 u x 0 u l x 0 u r x 0 φ x φ l x 0 φ r x 0 the left and right initial states u l h l h l u l t and u r h r h r u r t are contained in table 2 while the porosities φl and φr are defined as φ l b l b max 1 and φ r b r b max 0 6 respectively with bmax bl the internal structure of the rapid street width variation suggests that a porosity monotonic variation must be assumed for the definition of the porosity standing discontinuity the construction of the exact sp riemann problem solutions for the case studies of table 2 is depicted in appendix c where the eq 21 with δh 0 is assumed no headloss added the corresponding states u 1 h 1 h 1 u 1 t and u 2 h 2 h 2 u 2 t respectively to the left and to the right of the porosity discontinuity are reported in table 3 together with the corresponding unit width discharge hu and discharge φhu the effects of the porosity discontinuities can be easily appreciated by comparing the solution of the discontinuous porosity sp riemann problem with the results of the uniform porosity sp model for this reason the exact solution of the uniform porosity sp riemann problem φ 1 for the case studies of table 2 is compared in fig 4 with the results of the two dimensional swe model and with the discontinuous porosity sp riemann problem case study cs1 the results of the two dimensional swe numerical model dots and the exact solution of the discontinuous porosity sp riemann problem thin continuous line are compared in fig 4a showing that the exact sp solution is very close to the two dimensional swe numerical solution in particular the left initial flow u l is connected to the state u 1 by a shock while the state u 2 is critical it is immediate to see that the unit width discharge q 1 h 1 u 1 1 50 m2 s corresponding to the state u 1 see table 3 is 20 minor than the unit width discharge q l 1 88 m2 s corresponding to the state u l see table 2 and this confirms that porosity sudden reductions may cause a reduction of the discharge through the abscissa x 0 m in the case of subcritical flow additional inspection of fig 4a shows that the celerity of the wetting front predicted by the exact sp riemann solution almost coincides with that supplied by the two dimensional swe model the exercise is repeated by solving the uniform porosity sp riemann problem the corresponding solution dashed line in fig 4a consists of a single rarefaction wave that connects the state u l to the dry bed for the present case the unit width discharge through the geometric discontinuity is equal to q 1 2 04 m2 s and it is 8 5 greater than ql contrary to what expected the leading wave celerity i e the celerity of the wetting front supplied by the uniform porosity sp riemann problem is slower than the corresponding wave celerity supplied by the two dimensional swe model with channel contraction and by the discontinuous porosity sp exact solution this aspect will be reconsidered in the discussion section case study cs2 similarly to the preceding case the inspection of fig 4b shows that the exact solution of the discontinuous porosity sp riemann problem thin continuous line is very close to the two dimensional swe results the unit width discharge q 1 3 51 m2 s corresponding to the state u 1 see table 3 is 25 minor than the unit width discharge q l 4 70 m2 s corresponding to the state u l table 2 confirming that the blockage effect due to the porosity discontinuity is well reproduced by the sp model with geometric discontinuity in particular the celerity of the wetting front predicted by the exact sp riemann solution almost coincides with that supplied by the two dimensional swe model the results of the uniform porosity sp riemann problem dashed line in fig 4b show that the absence of geometric discontinuity makes the left moving shock disappear again the leading wave celerities supplied by the two dimensional swe model and the sp exact solution with geometric discontinuity are greater than the corresponding wave celerity in the uniform porosity sp riemann problem case study cs3 the sp riemann problem with porosity discontinuity is underdetermined for this test case three alternative solutions see section 3 3 but the results of the two dimensional swe model supply a guide for picking up the sp solution configuration s1 that is congruent with the two dimensional results warnecke and andrianov 2004 han et al 2013 the inspection of fig 4c thin continuous line where the s1 configuration is plotted confirms that there is a good agreement between the sp riemann problem solution and the two dimensional numerical simulation the effect of the flow chocking is again evident because the unit width discharge q 1 8 62 m2 s table 3 is 9 minor than the unit width discharge q l 9 40 m2 s table 2 the celerity of the leading wave supplied by the discontinuous porosity sp riemann problem is very close to that supplied by the two dimensional swe model the solution of the uniform porosity sp riemann problem is also plotted in fig 4c dashed line from the inspection of the figure it is evident that the omission of the porosity discontinuity leaves the flow through x 0 m unaffected in the present case the comparison with the two dimensional swe solution and with the discontinuous porosity sp riemann solution shows that the celerity of the leading rarefaction wave is only moderately influenced by the absence of the geometric discontinuity case study cs4 for this case study the structure of the sp riemann problem solution with porosity discontinuity thin continuous line in fig 4d is the same of the two dimensional swe numerical model dots because the upstream flow remains supercritical through the discontinuity u 1 u l compare tables 2 and 3 nonetheless the exact sp riemann solution does not exhibit energy dissipation through the geometric discontinuity and this implies the underestimation of the flow depth at the exit of the porosity discontinuity and the overestimation of the leading wave celerity similarly to the preceding cases the leading wave celerity of the uniform porosity sp riemann problem dashed line in fig 4d is less than the corresponding celerity in the discontinuous porosity sp solution thin continuous line case study cs5 for this case the structure of the sp riemann problem solution with porosity discontinuity thin continuous line is very close to that of the two dimensional swe numerical model see fig 4e in particular the geometric discontinuity induces the formation of a right rarefaction that accelerates the flow towards the critical state this is confirmed by the unit width discharge q 2 2 04 m2 s table 3 which is greater than the unit width discharge q r 1 88 m2 s table 2 nonetheless the two dimensional swe numerical solution dots in fig 4e exhibits a headloss through x 0 m which causes the increase of the supercritical flow depth immediately to the left of the geometric transition and a corresponding reduction of the velocity with respect to the exact sp riemann solution also in this case the celerity of the leading rarefaction wave supplied by the two dimensional swe model is very similar to that of the sp model with porosity discontinuity the results supplied by the one dimensional sp model with uniform porosity are plotted in fig 4e with a dashed line the comparison with the other two models shows that the celerity of the left leading wave and the flow depth are largely overestimated if the geometric discontinuity is neglected case study cs6 the solution of the exact sp riemann problem with porosity discontinuity is very similar to that of the swe model see fig 4f because the right flow remains supercritical through the expansion u 2 u r compare tables 2 and 3 of course the energy dissipation produced by the two dimensional swe model in the vicinity of x 0 m causes the increase of the supercritical flow depth with respect to that supplied by the sp model with porosity discontinuity the comparison with the two other models shows that the one dimensional sp model with uniform porosity dashed line overestimates the celerity of the right rarefaction and the corresponding flow depth 5 3 sp riemann problem exact solution with the added headloss low order numerical schemes for the approximate solution of the shallow water equations dissipate energy with a mechanism numerical dissipation due to the numerical viscosity that is similar to the physical mechanism of the eddy viscosity tadmor and zhong 2008 of course this effect is more severe where the gradients of the numerical solution are higher this observation explains why the two dimensional swe numerical solutions of the study cases from cs1 to cs6 in fig 4 with the exclusion of cs4 exhibit energy dissipation through the channel width variation the same dissipation effects are observed through geometric discontinuities in real flows where the eddy viscosity is non negligible yarnell 1934 formica 1955 cunge et al 1980 dufresne and vazquez 2013 in this framework the case cs4 of fig 4d is special because standing shocks through the channel contraction produce an additional loss of energy in the literature of porosity models the dissipative effects have been often taken into account by introducing additional drag terms that change the structure of the original mathematical models guinot and soares frazão 2006 sanders et al 2008 guinot et al 2018a it is interesting to verify if the local dissipation effects independent of their physical or numerical nature can be taken into account through the standing wave definition of eq 21 without any change of the porosity model structure for this reason the methods of appendix c are used again to compute the exact discontinuous porosity sp riemann problem solution for the case studies from cs1 to cs6 where the head unbalance values δ h h 1 u 1 2 2 g h 2 u 2 2 2 g of table 4 are used in eq 21 the values of δh are those that best fit the two dimensional swe numerical solution at time t 5 s after a simple trial and error procedure in the table 4 the flow depth longitudinal velocity unit width discharge and discharge φhu corresponding to the exact solution states u 1 and u 2 are also reported in fig 6 the exact solutions to the riemann problem with added headloss are compared with the two dimensional swe numerical results the inspection of the figure shows that the flow depths and the wave celerities of the sp riemann exact solutions correspond nicely with the two dimensional results this suggests that an adjustment of the headloss through the porosity discontinuity may lead to an improvement of the agreement between the results of two dimensional swe model and sp riemann problem exact solution this is especially needed in the case study cs4 where the introduction of the headloss generated by the standing waves system through the geometric discontinuity leads to an impressive improvement of the exact sp riemann problem solution compare figs 4d and 6d notably the energy dissipation contributes to an additional reduction of the discharge through the geometric discontinuity in sub critical conditions together with the reduction of the leading wave celerity this can be inferred from the comparison of the columns q 1 in the tables 3 and 4 for the cases cs1 cs2 cs3 and cs5 and from the comparison between figs 4 and 6 conversely there is no influence of the energy dissipation on the transmitted discharge in the cases of supercritical flow through the geometrical transition while the leading wave celerity only is affected case studies cs4 and cs6 5 4 sp riemann problem numerical solution the six rapid transients of table 2 are simulated by means of a one dimensional sp numerical model where the position of eq 28 is used to approximate the sp flux while the mpws monotonic porosity weak solution by cozzolino et al 2018b and dip guinot et al 2017 approaches are used for the reconstruction of the variables 5 4 1 one dimensional sp numerical model the solution of the one dimensional sp system of eq 36 is approximated in a channel with length l 200 m by means of the finite volume scheme cozzolino et al 2018b 38 φ i u i n 1 φ i u i n δ t δ x ψ i 1 2 g u i 1 2 u i 1 2 ψ i 1 2 g u i 1 2 u i 1 2 δ t δ x s i 1 2 s i 1 2 where δ x x i 1 2 x i 1 2 is the length of the cell c i x i 1 2 x i 1 2 with centre x i 0 5 x i 1 2 x i 1 2 while 39 φ i 1 δ x c i φ x d x u i n h i h i u i t 1 φ i δ x c i φ x u x t n d x are the cell averaged values of the porosity φ x and of the conserved variables vector u x t respectively the other symbols in eq 38 are defined as follows ψ i 1 2 is the numerical porosity at the interface i 1 2 between ci and ci 1 g u v is a numerical flux corresponding to the one dimensional swe model u i 1 2 h i 1 2 h i 1 2 u i 1 2 t and u i 1 2 h i 1 2 h i 1 2 u i 1 2 t are the variables reconstructed to the left and to the right of the interface between the cells ci and ci 1 respectively finally s i 1 2 and s i 1 2 are the contributions to ci of the non conservative products through the interfaces in xi 1 2 and xi 1 2 respectively the initial conditions and the geometry are discontinuous and defined by 40 u i 0 u l x i 0 u r x i 0 φ i φ l x i 0 φ r x i 0 where the parameters u l u r φl and φr coincide with the corresponding parameters of sub section 5 2 while x 0 m corresponds to the channel centre in eq 38 the space step δx 0 10 m and the time step δt 0 0001 s are used in all the simulations while the numerical flux g u v is approximated by means of the hlle cozzolino et al 2014 approximate riemann solver two different reconstructions are used in the following in the mpws approach by cozzolino et al 2018b the position ψ i 1 2 min φ i φ i 1 is made when the flow energy is sufficient to pass through the porosity discontinuity while the reconstructed variables are defined as 41 u i 1 2 h i 1 2 φ i h i u i ψ i 1 2 t u i 1 2 h i 1 2 φ i 1 h i 1 u i 1 ψ i 1 2 t in eq 41 the reconstructed values h i 1 2 and h i 1 2 of the flow depth are solutions of 42 h i 1 2 φ i h i u i 2 2 g ψ i 1 2 h i 1 2 2 h i u i 2 2 g h i 1 2 φ i 1 h i 1 u i 1 2 2 g ψ i 1 2 h i 1 2 2 h i 1 u i 1 2 2 g which is the discrete version of eq 21 with δh 0 it is evident that the variables reconstruction of eqs 41 and 42 aims at preserving the discharge and the head of the flow through the geometric discontinuity congruently with the mathematical definition of standing discontinuity in eq 19 the non conservative product terms are approximated in the mpws approach as 43 s i 1 2 φ i f u i ψ i 1 2 f u i 1 2 s i 1 2 ψ i 1 2 f u i 1 2 φ i f u i when the head of the flow is not sufficient or when a rarefaction wave is attached to the geometric transition a more complicated procedure must be used and the interested reader is addressed to the original work by cozzolino et al 2018b in the one dimensional dip approach the reconstructed variables are defined as 44 u i 1 2 h i φ i h i u i ψ i 1 2 t u i 1 2 h i 1 φ i 1 h i 1 u i 1 ψ i 1 2 t where ψ i 1 2 min φ i φ i 1 while the non conservative products terms are defined as 45 s i 1 2 ψ i 1 2 φ i g h i 2 2 0 1 t s i 1 2 ψ i 1 2 φ i g h i 2 2 0 1 t due to the monotonicity of the porosity variation through x 0 the dip edge porosity is assumed as ψ i 1 2 min φ i φ i 1 in the following numerical computations this assumption satisfies the constraint of eq 31 5 4 2 one dimensional sp numerical results the sp numerical results are compared in fig 7 with the two dimensional swe results while the numerical states u 1 and u 2 in the computational cells immediately to the left and to the right of the abscissa x 0 m are reported in table 5 mpws reconstruction and table 6 dip reconstruction respectively in the same tables the corresponding unit width discharge hu discharge φhu and head unbalance δ h h 1 u 1 2 2 g h 2 u 2 2 2 g through the geometric transition are reported in the dip scheme the solution at some distance from the porosity discontinuity may be quite different from the values u 1 and u 2 in the case studies cs1 and cs2 the two dimensional swe flow is chocked because the state u l does not satisfies the limit criterion by yarnell 1934 the inspection of fig 7a and b shows that both the mpws and dip reconstructions reproduce this condition with sufficient accuracy supplying numerical results that are very similar to those of the two dimensional swe model the comparison between tables 3 and 5 shows that the mpws reconstruction captures nicely the exact solution of the sp riemann problem with invariant head through the geometric transition conversely the inspection of table 6 evidences a major discrepancy exhibited by the dip reconstruction namely an increase of flow head δh 0 with u 0 through the porosity abrupt reduction this dip issue which has been numerically verified here was first theoretically addressed in cozzolino et al 2018b there is an another evident issue in the dip calculations for the case studies cs1 and cs2 namely the discharge unbalance through the geometric discontinuity as evidenced by the fact that φlh 1 u 1 φrh 2 u 2 this additional issue which is not present in mpws calculations explains why the dip numerical results for the cases cs1 and cs2 seem closer than the mpws results to the two dimensional swe results despite the unphysical increase of energy through the porosity discontinuity the case study cs3 is characterized by initial conditions that admit three distinct exact sp riemann problem solutions see sub section 3 3 in contrast with the two dimensional swe numerical solution both the dip and mpws reconstructions supply a solution see fig 7c that corresponds to the configuration s3 of fig 3c where the flow remains supercritical through the geometric transition in particular the dip and mpws reconstructions do not reproduce the receding shock and both the models overestimate the discharge transmitted through the geometric discontinuity compare q 2 in table 3 with q 2 in tables 5 and 6 together with the celerity of the leading rarefaction the inspection of tables 5 and 6 shows that the mpws reconstruction preserves the energy also in the case of supercritical flow through the geometric transition while the dip reconstruction exhibits an unphysical head increase δh 2 00 m with u 0 in the case study cs4 fig 7d the solution produced by the two dimensional numerical scheme corresponds to a supercritical flow passing through the geometric transition where an evident headloss is present the numerical solutions supplied by the dip and mpws reconstructions correctly exhibit this configuration but the mpws model dissipates no energy table 5 while the dip model severely increases the flow head through the geometric transition δh 5 82 m with u 0 see table 6 the discrepancy between sp numerical results and swe numerical solutions is particularly evident in this case because the sp numerical results strongly overestimate the celerity of the propagating wave the cases cs5 fig 7e and cs6 fig 7f are characterized by a subcritical and a supercritical flow that encounter an abrupt porosity increase respectively the numerical solutions supplied by the dip and mpws reconstructions are quite similar to those of the two dimensional swe numerical scheme with flow depth at the left of the geometric discontinuity that is slightly underestimated the comparison between tables 3 and 5 shows that the mpws reconstructions captures the sp riemann problem exact solution with sufficient fidelity conserving the energy through the geometric transition conversely the inspection of table 6 shows that the dip model dissipates energy at the porosity increase δh 0 with u 0 by means of a purely numerical mechanism the inspection of the numerical results supplied by two different approaches mpws and dip for the approximate solution of sp riemann problems allows drawing some conclusion first it is evident that existing numerical approaches for interface flux calculation are not equipped with a mechanism that allows picking up the moving shock exhibited by the two dimensional swe model in the cases where multiple sp riemann solutions are possible see fig 7c second it is evident fig 7d that existing numerical schemes are not equipped with a mechanism able to add the required amount of energy dissipation when a system of standing waves is located through the geometric discontinuity in both the cases the overall effect is a systematic underestimation of the dissipated energy and an overestimation of the propagating wave celerity these observations suggest that deficiencies of current approximate sp riemann solvers is maybe one of the reasons explaining why additional drag sanders et al 2008 and transient momentum dissipation terms guinot et al 2017 which are not present in the original mathematical models of eqs 2 and 8 are often introduced in numerical models interestingly the inspection of columns φlq 1 φrq 2 and δh in table 5 shows that the mpws approach is efficient in preserving the invariance of discharge and head through the porosity discontinuity this success is attributed not only to the variables reconstruction of eqs 41 and 42 but also to the use of eq 43 for the computation of non conservative products contribution at interfaces which mimics the mathematical definition of eq 19 it is evident that an appropriate choice of the variables reconstruction could be used to introduce the correct amount of interface head loss where required 6 alternative porous differential models in the bsp model the geometric parameter i x y is isotropic and non homogeneous nonetheless in section 4 it has been shown that interface porosities ψ ij distinct from the cell averaged porosities φ i very naturally arise in bsp finite volume numerical schemes see remark 6 in section 4 2 as interface approximations of i x y in spite of the purely numeric nature of ψ ij many differential porosity models admitting a distinction between storage and conveyance porosities have been proposed in the literature for the analysis of numerical solutions behavior lh by lhomme 2006 diff ip by guinot and delenne 2014 diff dip by guinot et al 2017 these differential porosity models can be collectively rewritten as 46 φ h t ψ 1 h u x ψ 2 h v y 0 φ h u t x ψ 3 g h 2 2 ψ 4 h u 2 ψ 5 h u v y g h 2 2 ψ 3 x φ h v t ψ 4 h u v x y ψ 3 g h 2 2 ψ 5 h v 2 g h 2 2 ψ 3 y where the values of the porosity coefficients ψ 1 ψ 2 ψ 3 ψ 4 ψ 5 and φ fall in the interval 0 1 in eq 46 the symbols are as follows φ is the storage porosity ψ 1 and ψ 4 are the conveyance porosity coefficients related to the fluxes of mass and momentum respectively along x analogously the conveyance porosity coefficients ψ 2 and ψ 5 are related to the fluxes of mass and momentum respectively along y finally the porosity coefficient ψ 3 denotes the fraction of the frontal area on which the obstacles do not exert pressure forces the table 7 reports the correspondence between the symbols of eq 46 and the symbols used in the literature with the equations numbering that corresponds to the papers where the models are first discussed the laws of fluid mechanics must be invariant with respect to the galilean transformations landau and lifshitz 1987 and the porous shallow water models cannot constitute an exception to this fundamental constraint in this section it is demonstrated that the use of different definitions for storage and conveyance porosity coefficients in porosity differential models violates the galilean invariance in particular it is proven that swe sp and bsp model are invariant with respect to the galilean transformations while lh lhomme 2006 diff ip guinot and delenne 2014 guinot et al 2017 and diff dip guinot et al 2017 do not satisfy this property this implies that the use of different definitions for storage and conveyance porosity coefficients in porosity differential models is not physically meaningful and that these models cannot be used for the analysis of flood wave propagation through urban fabric for the sake of simplicity only the uniform motion of the reference frame with velocity u 0 along the x axis is considered in this case the relation between the time and space coordinates in the fixed inertial reference frame oxy and in the inertial moving reference frame o xy is 47 x x u 0 t y y τ t where x and y are the space variables parallel to x and y respectively in the moving reference while τ is the time variable in the moving reference recalling that the values of the physical quantity f x y τ in the moving reference frame are related to the corresponding values f x y t in the fixed reference by 48 f x y t f x x y t y x y t τ t the application of the derivatives chain rule supplies 49 f x f x f y f y f t f τ u 0 f x if u and v are the components of the velocity vector expressed with respect to the translating reference o xy it follows from eq 47 that 50 u u u 0 v v the application of eqs 48 50 to the eq 46 leads to 51 φ h τ ψ 1 h u x ψ 2 h v y δ 1 φ h u τ x ψ 3 g h 2 2 ψ 4 h u 2 ψ 5 h u v y g h 2 2 ψ 3 x δ 2 φ h v τ ψ 4 h u v x y ψ 3 g h 2 2 ψ 5 h v 2 g h 2 2 ψ 3 y δ 3 where 52 δ 1 ψ 1 φ h u 0 x δ 2 ψ 4 φ h u 0 u x ψ 4 ψ 1 h u 0 2 x ψ 4 ψ 1 h u 0 u x ψ 5 ψ 2 h u 0 v y δ 3 ψ 4 φ h u 0 v x the comparison between the eqs 46 and 51 shows that the uniform motion of the reference frame along the x axis gives rise to the terms δ 1 δ 2 and δ 3 in particular the first of eq 52 can be interpreted as a violation of mass conservation and it is clearly unphysical while the terms δ 2 and δ 3 can be interpreted as spurious forces that alter the force balance in eq 46 the inspection of eq 52 shows that independent of the flow field the galilean invariance along the x axis is restored if ψ1 ψ4 φ and ψ2 ψ5 because these positions make the unbalancing terms δ 1 δ 2 and δ 3 disappear in a similar fashion it is possible to consider the uniform motion of the reference frame along the y axis showing that the galilean invariance is restored if ψ2 ψ5 φ and ψ1 ψ4 the two systems of conditions imply that the complete galilean invariance is recovered if ψ1 ψ2 ψ4 ψ5 φ leading to the following corrected system 53 φ h t φ h u x φ h v y 0 φ h u t x ψ 3 g h 2 2 φ h u 2 φ h u v y g h 2 2 ψ 3 x φ h v t φ h u v x y ψ 3 g h 2 2 φ h v 2 g h 2 2 ψ 3 y the structure of eq 53 excludes lh diff ip and diff dip where the conveyance porosity differs from the storage porosity while admits swe sp and bsp in particular the swe model coincides with eq 53 where φ ψ 3 1 while the sp model coincides with eq 53 where ψ 3 φ finally the bsp model inherits the galilean invariance property from the sp model because it coincides with the restriction of sp to the case φ i in section 2 it has been demonstrated that bsp is the differential counterpart of ife implying that there is no grounded connection between ife and diff ip or diff dip for this reason diff ip and diff dip should not be used to deduce the wave propagation characteristics through the urban fabric this observation which is confirmed by the lack of galilean invariance in diff ip and diff dip is coherent with the remark 6 of section 4 2 the conveyance porosity which arises very naturally during numerical modelling as averaged value of i through cell interfaces cannot be introduced into mathematical models finally it has been shown in section 4 that ip by sanders et al 2008 and dip by guinot et al 2017 are two admissible numerical models for the approximate solution of the bsp model this implies that diff ip and diff dip should not be used to deduce the numerical stability properties of ip and dip 7 discussion in the present section the influence of obstacles on the flood celerity propagation is investigated by comparing the results of the discontinuous porosity sp riemann problem with the corresponding uniform porosity sp results 7 1 influence of urban porosity discontinuities on celerity propagation in the present sub section the analysis of the signal speed modifications induced by the geometric discontinuities is limited to the sp riemann problem exact solution with δh 0 m but analogous observations which are not reported here for the sake of brevity can be made for the solutions with added headloss the exact solution of the discontinuous porosity riemann problem for the test case cs1 is plotted in fig 4a while the corresponding states u 1 and u 2 are reported in table 3 it is immediate to see that the fastest signal celerity corresponding to the right rarefaction toe is c t o e u 2 2 g h 2 8 72 m s notably the celerity of the right rarefaction toe reduces to the value c t o e u l 2 g h l 8 14 m s in the case of uniform porosity unexpectedly this proves that a porosity reduction may cause an increase of the fastest signal celerity contrarily to what intuitively expected the signal celerity increase through the porosity reduction is not an sp artifact because it captures well the behavior of the two dimensional swe through the width reduction see fig 4a despite the signal speed increase this case study results show that the porosity reduction causes a discharge decrease through the abscissa x 0 m reducing the volume available for the flooding of new areas analogous observations can be made for the case studies cs2 and cs3 fig 4b c in the case study cs4 fig 4d the supercritical flow from the left impinges on a sudden porosity reduction but the discontinuous porosity sp solution does not predict a reflected shock and the impinging flow passes entirely through the geometric discontinuity also in this case the comparison with the uniform porosity sp solution shows that the porosity reduction causes an increase of the fastest signal celerity the inspection of the fig 4d shows that the two dimensional swes signal celerity is minor than the signal celerity in the sp model with porous discontinuity due to the strong energy dissipations through the standing wave and this implies that the headloss through the geometric discontinuity may have a role in the flooding celerity reduction this is confirmed by fig 6d where the introduction of the energy dissipation through the standing wave in the exact sp riemann problem solution allows reproducing with good fidelity the two dimensional swe results in the case study cs6 fig 4f the supercritical flow from the right encounters a porosity increase and the discharge through x 0 m is not altered the fastest signal celerity for the discontinuous porosity sp riemann problem results in table 3 is c t o e u 1 2 g h 1 10 08 m s while the corresponding celerity for the uniform porosity sp riemann problem is c t o e u r 2 g h r 10 96 m s it is evident that the porosity increase causes a reduction of the fastest signal speed with respect to the case of uniform porosity contrarily to what expected as above the signal celerity modification is not an sp model artifact because the swe model exhibits a similar behavior see fig 4f notably the discharge through x 0 m is distributed on a larger area when the porosity increases causing a flow depth decrease similar observations can be made for the case study cs5 where a subcritical flow encounters a porosity increase fig 4e from the examples presented it is evident that the modification of the flooding wave characteristics caused by the urban fabric should be understood as follows a in case of subcritical flow through porosity reductions case studies cs1 cs2 and cs3 the fastest sp signal celerity is greater than the uniform porosity case but only a fraction of the impinging discharge is transmitted through the geometric discontinuity b in case of supercritical flow through a porosity reduction case study cs4 the fastest sp signal celerity is greeater than the uniform porosity case but the discharge is entirely transmitted additional dissipations are needed in order to reproduce the reduction of the fastest signal speed exhibited by the two dimensional swe results c at porosity increases the sp signal speed is always smaller than the corresponding uniform porosity case because the discharge is distributed on a larger area case studies cs5 and cs6 with reduction of the flow depth the combination of all these effects contributes to explain the slowing down of the flood through urbanized areas in the literature differential models with different definitions for the storage and conveyance porosity such as diff ip and diff dip have been used to describe the alterations of the flood wave celerity produced by the urban fabric guinot et al 2017 in these models it is prescribed that the conveyance porosity is minor than the storage porosity in order to reduce the flood celerity propagation with respect to the case of isotropic porosity unfortunately the examples presented here demonstrate that the influence of porosity variations may be reverse to what expected because the fastest signal speed may increase when the porosity reduces case studies cs1 cs2 cs3 and cs4 while it may reduce when the porosity increases case studies cs5 and cs6 this observation which is in agreement with the physical inconsistency of diff ip and diff dip demonstrated in section 6 implies that diff ip and diff dip are not good differential models for the description of flood wave propagation through the urban fabric conversely the results of sections 5 2 and 5 3 show that the discontinuous porosity sp riemann problem supplies wave celerities that are congruent with the two dimensional swe model at least in nearly one dimensional problems 7 2 energy dissipation mechanisms the exact and numerical solutions in section 5 show that energy dissipations have a role in reducing the flood wave celerity through the urban fabric two alternative swe energy dissipation mechanisms are considered in guinot et al 2017 namely a transient dissipation mechanism due to wave reflection against the obstacles and a steady additional mechanism due to the obstacles drag an additional dissipative mechanism due to the presence of standing waves through the geometric discontinuity has been individuated in the present paper transient dissipation mechanism the case studies cs1 cs2 and cs3 show that the moving shock waves in the exact sp riemann problem solutions have the potential to reproduce at least in nearly one dimensional cases the energy dissipations introduced by the reflection of swe through the urban fabric limiting the resort to momentum dissipation coefficients this is confirmed by the good superposition between sp exact solution and two dimensional swe numerical solution in fig 4a b c where both strength and position of the shocks is captured with good approximation approximate sp riemann solvers are expected to capture the moving shock solutions generated by the impact of the flow on a porosity reduction unfortunately the numerical results obtained in section 5 4 with two different approximate sp riemann solvers namely mpws and dip show that these numerical models are not able to reproduce the moving shock see fig 7c in the case study cs3 where the exact sp riemann problem admits multiple solutions it follows that there is an entire class of flow conditions where numerical models may introduce a systematic lack of energy dissipation interestingly no meaningful energy dissipation mechanism acting through the porosity discontinuity such as those proposed by guinot et al 2017 can surrogate in a transparent way the transient dissipation mechanism activated by moving shocks that develop far from the geometric discontinuity from the present discussion it is clear that approximate riemann solvers should be improved in order to capture moving shocks when these are present in the exact riemann solution instead of resorting to empirical momentum dissipation coefficients guinot et al 2017 obstacles drag in real flows energy dissipation through geometric discontinuities is mainly attributed to vortices around geometric irregularities guinot et al 2018a in two dimensional numerical models analogous energy dissipations are activated by numerical viscosities with a mechanism similar to that of physical eddy viscosities despite the physical or numerical origin of the energy dissipations the discussion of sub section 5 3 shows that it is possible to introduce interface headloss by appropriately defining the standing wave of eq 19 the inspection of fig 6 demonstrates that this makes the exact sp riemann solution superpose well with the two dimensional swe model solution in all the numerical examples the introduction of interface headloss through the standing wave definition has the advantage of leaving the structure of the mathematical model unchanged without resorting to empirical drag mechanisms sanders et al 2008 guinot et al 2017 that are not present in the original bsp and ife models and it could be very naturally used to take into account the drag forces through the urban fabric in fact the structure of eq 19 demonstrates that the choice of a relationship between the states u 1 and u 2 immediately to the left and to the right of the discontinuity respectively is equivalent to the choice of the walls reaction sγ unfortunately the relationship between energy dissipations and characteristics of the geometric transitions is far from being easy to be found and an in depth discussion of this topic is left to future research standing waves dissipation an exception to the preceding energy dissipation mechanism is the case study cs4 which is characterized by supercritical flow through a porosity reduction in section 5 1 it has been demonstrated that this condition which has been individuated here for the first time in the context of porous models is connected to the formation of a system of standing waves through the geometric discontinuity that originates additional energy dissipation the inspection of table 4 shows that this energy dissipation is one order of magnitude greater than the dissipations of the other case studies despite the different nature of the energy dissipation mechanism the inspection of fig 6d demonstrates that an appropriate definition of the standing wave definition of eq 19 makes the exact sp riemann solution superpose well to the two dimensional swe model solution also in the case study cs4 the further discussion of this energy dissipation mechanism and its relationship with the characteristics of geometry discontinuities is left to future research 8 conclusions in the present work which is inspired by the seminal papers by defina 2000 guinot and soares frazão 2006 and sanders et al 2008 integral and differential forms of porosity models for urban flooding simulations have been considered from both theoretical and numerical points of view the binary single porosity bsp model which is the restriction of the single porosity model sp guinot and soares frazão 2006 to the case where the porosity coincides with the binary indicator function has been proposed here for the first time the bsp model is derived from the two dimensional shallow water equations swe by introducing the obstacles into the mathematical model and it exhibits non conservative products that take into account the thrust exerted by the flow on the solid walls similarly to the original integral flow equations ife by sanders et al 2008 the bsp differential model is fully local and it does not depend on the existence of a representative elementary volume the ife model itself is recovered through space integration of the bsp model and this states the identity between the two formulations showing that no other differential model can be used in order to investigate the ife model and its numerical discretizations the identity between ife and bsp is reflected into the computations implying that the corresponding finite volume numerical discretizations coincide in these numerical schemes a bsp riemann problem must be solved at cell interfaces for the calculation of numerical fluxes and non conservative products actually the bsp riemann problem reduces to a sp riemann problem because the finite volume representation of the binary indicator function in the generic cell coincides with the cell storage porosity which ranges between zero and one existing ife numerical models such as the integral porosity ip model sanders et al 2008 and the dual integral porosity dip model guinot et al 2017 are particular cases of bsp numerical models where the sp riemann problem is solved in a simplified manner interestingly bsp finite volume schemes formally coincide with sp schemes and this explains the success of sp models where the porosity varies from a cell to another without reference to the rev definition the relevance of the sp riemann problem solution for bsp finite volume schemes has prompted the comparison of the sp exact solution with the solution of the two dimensional swe in six representative test cases this comparison shows that the sp riemann problem has the potential to take into account the energy dissipations caused by wave reflections at obstacles limiting the resort to interface momentum dissipation coefficients unfortunately there are initial conditions where current approximate sp riemann solvers are not able to capture the structure of the swe solution and this leads to a systematic underestimation of the dissipated energy in numerical models it is evident that approximate sp riemann solvers should be improved in order to capture moving shocks when these are present in the exact riemann solution instead of resorting to empirical transient momentum dissipation coefficients the two dimensional swe numerical experiments show that energy dissipations are intense in the case that a supercritical flow passes through a contraction because a system of standing shock waves may establish through the geometric discontinuity in the present paper it has been shown that the exact sp riemann solution is able to accurately capture the two dimensional swe solution if the correct amount of headloss is considered through the porosity discontinuity in the examples presented this energy dissipation has been embedded into the non conservative product definition instead of adding additional drag coefficients that alter the mathematical model structure the comparison between the numerical results of the swe model and the sp riemann problem solution with added headloss seems encouraging the sp and bsp models have been compared with alternative differential models from the literature these models which aim to describe the alterations of the flood wave celerity produced by the urban fabric adopt different definitions for storage and conveyance porosity in the present paper it is demonstrated that these differential models which are physically inconsistent because they violate the galilean invariance do not predict the influence of porosity variations on the signal celerity in fact the swe numerical experiments show that the fastest signal speed may increase when the porosity reduces while it may reduce when the porosity increases this behaviour is opposite to what predicted by these alternative differential models while it is well reproduced by the sp riemann problem solution the investigation of integral and differential porous shallow water models has revealed an unsuspected link between these two classes of models namely the sp riemann problem and many tasks are left to future research among these the most important are finding the general solution of the sp riemann problem and constructing an approximate sp riemann solver able to capture the structure of the swe solution independent of initial conditions acknowledgments the writers want to warmly thank the three anonymous reviewers for having improved the quality of the paper with their comments and suggestions also the last author wants to thank dr eng vittorio pasquino for fruitful discussions and beers this research was partially funded by the university of naples parthenope through the funding programs sostegno alla ricerca individuale 2015 2017 and ricerca competitiva triennio 2016 2018 appendix a obtaining the eq 6 if the first of eq 3 is multiplied by the smooth function ρ x y the following equation is obtained a 1 ρ h t ρ h u x ρ h v y 0 recalling that a 2 ρ h u x ρ h v y ρ h u x ρ h v y h u ρ x h v ρ y ρ h u x ρ h v y h v t ρ the eq a 1 can be rewritten as a 3 ρ h t ρ h u x ρ h v y h v t ρ finally the first of eq 6 is obtained recalling that ρ does not depend on t and that it is possible to write ρ h t ρ h t the manipulations for the second and the third of eq 6 are very similar and they are not reported here for the sake of brevity appendix b consistency of swe and ife model the ife model is obtained in sanders et al 2008 by direct application of mass and momentum conservation principles in the present section the same model is obtained by integrating the swe of eq 3 in the space with the introduction of free slip solid boundary conditions of eq 4 at the building perimeter b 1 conservation of mass consider the connected two dimensional control volume ω which can be subdivided into the non superposing control volumes ω b and ω v the control volume ω b consists of the points that are occupied by buildings while ω v consists of the voids streets squares among the buildings fig 1a it is evident that the indicator function takes the value i x y 1 on ω v and the value i x y 0 on ω b the boundary ω of ω can be subdivided into a portion ω f that is free of buildings where i x y 1 and into a portion ω b that is immersed into buildings where i x y 0 in addition let the boundary ω v of ω v be subdivided into a portion ω v f that is free of buildings and into a portion ω v b that lies along the buildings perimeter and which is immersed in ω fig 1b it is evident that ω f coincides with ω v f compare fig 1a and 1b let the first of eq 3 be integrated on ω v obtaining b 1 0 ω v h t h u x h v y d ω d d t ω v h d ω ω v h v t m d s where m m x m y t is the unit outward vector along ω v v u v t is the velocity vector and t is the matrix transpose symbol the eq b 1 follows from the fact that the divergence theorem allows writing b 2 ω v h u x h v y d ω ω v h v t m d s recalling the boundary condition of eq 4 the solid boundaries can be now introduced in the integral form b 3 ω v b h v t m d s 0 obtaining b 4 d d t ω v h d ω ω v f h v t m d s 0 it is easy to see that the eq b 4 can be rewritten as the first of eq 8 this result is obtained recalling that b 5 ω v h d ω ω v i h d ω ω v i h d ω ω b i h d ω ω i h d ω ω v f h v t m d s ω f h v t n d s ω f i h v t n d s ω f i h v t n d s ω b i h v t n d s ω i h v t n d s because m non ω v f ω f see fig 1 the eq b 4 coincides with the eq 1 in sanders et al 2008 and with the first of eq 8 in the present work b 2 conservation of momentum the second of eq 3 is now integrated on ω v obtaining b 6 0 ω v h u t h u 2 x h u v y x g h 2 2 d ω d d t ω v h u d ω ω v h u v t m d s ω v g h 2 2 m x d s if the boundary condition v t m 0 along ω v b is introduced the following equation b 7 d d t ω v h u d ω ω v f h u v t m d s ω v f g h 2 2 m x d s ω v b g h 2 2 m x d s 0 is obtained finally the eq b 7 can be rewritten as b 8 d d t ω i h u d ω ω i h u v t n d s ω i g h 2 2 n x d s ω v b g h 2 2 m x d s 0 similar manipulations can be conducted on the third of eq 3 if the integral form of the second and the third of eq 3 are united in vector form the second of eq 8 is obtained the last equation coincides with eq 2 in sanders et al 2008 appendix c exact solution of the sp riemann problems in the present appendix the exact solution of the sp riemann problems considered in the section 5 is presented this solution reduces to writing the system of equations that allows finding the states u 1 and u 2 the case studies cs1 cs2 and cs3 are characterized by a shock connecting the state u l to the state u 1 while a rarefaction connects the critical state u 2 to the dry bed for this reason the solution of the riemann problem is immediately found by solving the system c 1 u 1 u l h 1 h l g 1 h 1 1 h l 2 φ l h 1 u 1 φ r h 2 u 2 h 1 u 1 2 2 g h 2 u 2 2 2 g δ h u 2 g h 2 where δh 0 in eq c 1 the first equation represents a shock contained into the first characteristic field that connects the state u l to the state u 1 while the second and the third equations represent the discharge invariance and the head relationship through the geometric discontinuity respectively compare with eq 21 finally the last equation expresses the fact that the state u 2 is critical the case study cs4 is characterized by supercritical flow through the geometric discontinuity with u 1 u l the solution of the riemann problem reduces to finding the supercritical state u 2 by means of c 2 φ l h l u l φ r h 2 u 2 h l u l 2 2 g h 2 u 2 2 2 g δ h where δh 0 the case study cs5 is characterized by a rarefaction connecting the state u r to the critical state u 2 while a rarefaction connects the supercritical state u 1 to the dry bed for this reason the solution of the riemann problem is immediately found by solving the system c 3 u 2 2 g h 2 u r 2 g h r u 2 g h 2 φ l h 1 u 1 φ r h 2 u 2 h 1 u 1 2 2 g h 2 u 2 2 2 g δ h where δh 0 in the system of eq c 3 the first equation represents a rarefaction contained into the second characteristic field that connects the state u r to the state u 2 while the second equation represents the condition that u 2 is critical finally the third and the fourth equations represent the discharge invariance and the head relationship through the geometric discontinuity the case study cs6 is characterized by a supercritical flow that remains supercritical through the geometric discontinuity with u 2 u r the solution of the riemann problem reduces to finding the supercritical state u 1 by means of c 4 φ l h l u 1 φ r h r u r h 1 u 1 2 2 g h r u r 2 2 g δ h where δh 0 
