index,text
24580,permafrost degradation due to climate warming would potentially increase the release of previously frozen soil carbon and change the carbon budget of the cold region ecosystem the underlying permafrost degradation would be effectively mediated by soil surface freezing thawing ft processes aboveground vegetation can regulate soil ft processes however its effects on ground thermal transfer have not been well represented by ecosystem models in this study we improved the hydrothermal module of the boreal ecosystem productivity simulator beps through more careful parameterization of snowpack density puddled water soil organic matter and super cooled soil water the impacts of vegetation on the soil surface ft processes have also been investigated using the improved beps model and the measured soil temperature data at forest and grassland sites on the southern edge of permafrost region in mongolia and northeastern china the improved beps model performs better than the original model in simulations of soil temperature and soil ft processes smaller amplitudes of soil diurnal ft cycles were found in forest sites compared to grassland sites forest sites have delayed soil thaw timing and similar soil freezing time compared to grassland sites differences in snow depths and soil organic matter content due to distinct vegetation community structures have considerable influences on the disparity in soil ft processes thus it is important to improve the simulation of the impacts of vegetation on soil surface ft processes for better forecasting the permafrost degradation keywords freeze thaw vegetation model improvement soil temperature 1 introduction permafrost the ground that remains below 0 c for at least two consecutive years underlies approximately 23 9 of the exposed land surface of the northern hemisphere and it contains twice as much carbon as the atmosphere grosse et al 2016 schädel et al 2016 the large quantities of carbon stored in the frozen soil could be released into the atmosphere due to permafrost degradation caused by climatic warming this degradation would potentially change the global carbon budget and accelerate global climate warming chaudhary et al 2020 hollesen et al 2011 the most dramatic permafrost degradation mainly occurs at the southern edge of permafrost area due to the significant poleward movement of permafrost caused by climate warming guo et al 2018 yue et al 2020 the soil surface freezing thawing ft processes which are measured by the amplitude and duration of the diurnal soil ft cycle as well as seasonal ft timing would effectively mediate the underlying permafrost degradation guo et al 2018 the soil ft processes during the transition period from cold to warm or warm to cold seasons can last from a few days to a few weeks and they are susceptible to change because of the rapid climate warming bao et al 2021 pachauri et al 2014 there have been many researches investigating the soil ft processes in response to climatic warming mainly using near surface soil temperature data from in situ measurements bao et al 2021 cao et al 2020 wang et al 2020 yoshikawa et al 2020 land surface temperature data from satellites baltzer et al 2014 kim et al 2014 as well as ecosystem model simulations foster et al 2019 guo and wang 2014 however there are still uncertainties in these studies due to the sparse and short term field measurements tao et al 2017 coarse resolution of the available remote sensing data grosse et al 2016 tao et al 2017 or the poor representation of soil ft processes in ecosystem models barman and jain 2016 jan et al 2020 nitzbon et al 2020 to better understand the pattern and drivers of the soil ft processes at regional scale the more realistic representation and parameterizations of soil ft processes are needed to be incorporated into ecosystem models the impacts of vegetation on soil ft processes have been examined by many studies field measurements in south siberia hu et al 2013 zhangbei county of hebei province china chen et al 2020 and qinghai tibetan plateau hu et al 2020a found that vegetation could exert buffer effect on soil temperature and consequently affect the soil ft processes guo et al 2018 found that soil ft cycles would be larger in amplitude and longer in duration at steppe sites than at forest sites soils in the forest sites and steppe sites froze almost simultaneously but experience a delay in thawing for forest sites guo et al 2018 in addition the hydrologic and thermal regimes of soil surface and soil ft processes could be affected by vegetation through intercepting snowfall and solar radiation chang et al 2015 french 2007 karjalainen et al 2019 and through buffer effect of litter layer chaudhary et al 2020 lawrence and slater 2008 thus it is essential to improve the ecosystem model for better simulating the impacts of vegetation on soil ft processes three forest sites and two grassland sites investigated in this study were located along a vast latitudinal around 10 and longitudinal around 20 gradient at the south edge of the permafrost region of mongolia and northeastern china soil temperature and meteorological data were recorded at these sites during 2003 to 2014 the soil vegetation thermal and hydraulic modules of the boreal ecosystems productivity simulator beps have been improved and tested at the studied sites using the measured soil temperature data and those simulated by the beps model we investigated the impacts of vegetation types on soil ft processes 2 materials and methods 2 1 site description three forest sites and two grassland sites at the southern edge of a permafrost region in mongolia and northeastern china were investigated in this study fig 1 and table 1 three sites skt dxf and kbu are in the permafrost region and two sites chb and cng belong to the region of seasonally frozen ground these sites were selected fulfilling the following conditions in data quality and availability 1 soil data including soil texture and soil organic carbon soc content are available 2 two or more years of continuous hourly measurements of soil temperature and meteorological variables including air temperature downward shortwave radiation relative humidity precipitation and wind speed are available 3 ground measurements of leaf area index lai and clumping index are available table s1 shows the detailed information about these observational items containing the types and placement heights depths of the instruments the southern khentei taiga skt forest site is located in a siberian larch forest on a southwest facing gently sloping hill with a maximum slope of about 5 li et al 2005b the soil at the site is spodosol seasonal cryosol with coarse texture its total carbon content at the top 40 cm soil layer is 2 21 0 50 on average after removal of roots by sieving the understory was dense and formed a distinct layer of grasses and scattered shrubs li et al 2005b the temperate mixed forest site of changbai mountain chb is located in northeastern china guan et al 2006 zhang et al 2016 elevational permafrost may occur in the upper part and on the top of the changbai mountain wei et al 2011 the daxing anling forest ecosystem research station dxf lies in a continuous permafrost region within northeastern china wei et al 2011 the larch forest and frozen soil maintain the cold and wet environmental conditions of cold temperate coniferous forests tian et al 2018 the annual frozen period is over 210 days and the snow cover exists from late september to early may chen and li 2008 the kherlenbayan ulaan kbu steppe site is located in northeastern mongolia it is fairly open and flat with terrain slopes less than 0 5 in all directions li et al 2005a the soil is classified as chestnut soil kastanozem and is well drained with low moisture holding capacity li et al 2008 its bulk density overall porosity and hydraulic conductivity in the top 30 cm layer are 1 45 g cm 3 45 and 0 01 0 08 mm s 1 respectively li et al 2006 the changling temperate meadow steppe station cng is situated in the southern songnen plain there is 1 5 soil organic matter in the top soil layer dong et al 2011 the frost free period was about 130 165 days and the growing season was limited to late april to september the vertical profile of soil organic carbon density and bulk density were derived from the soilgrids dataset that covers the top 2 m of soil column with seven layers 0 5 15 30 60 100 and 200 cm hengl et al 2017 the soilgrids dataset with 250 m spatial resolution is interpolated to the five layers of soil column in the beps model using the linear interpolation method 2 2 the description of beps model the beps model a process based diagnostic model was initially developed for canadian boreal ecosystems liu et al 1997 and has been adapted for other ecosystems over the globe it is commonly used in stimulating photosynthesis vegetation productivity and soil biogeochemical processes at hourly time steps chen et al 2016 j m chen et al 2019 s zhang et al 2018 beps includes a two leaf canopy stratification scheme that treats vegetation canopy as two groups of leaves sunlit and shaded ones b chen et al 2019 the soil profile is divided into five layers and the thickness of soil layers increases exponentially from the top layer to the deepest layer equals to 0 05 0 1 0 2 0 4 and 1 25 m respectively each soil layer is considered as a mixture of mineral soil organic matter and water fig 2 the beps model is driven by vegetation parameters including leaf area index clumping index and land cover type as well as meteorological and soil data beps includes modules to calculate the thermal dynamics of soil profile which are determined using a one dimensional vertical direction heat diffusion equation chen et al 2007 1 c s l t s l t z λ t l t s l z s s l where c s l j m 3 k 1 is the volumetric heat capacity of soil layer l t s l c is the soil temperature at depth z and time t s s l w m 3 is the source or sink term for freezing or thawing of moisture occurred at soil layer l λ t l w m 1 k 1 is the soil thermal conductivity which is determined as a function of soil texture and soil moisture content kumar and kaleita 2003 2 λ t l λ s l 1 θ s a t l λ l i q θ w l 1 f i c e l λ i c e θ w l f i c e l 0 15 θ w l θ s a t l 0 15 where λ s l λ l i q and λ i c e are the thermal conductivity of the constituents including soil solids decided by soil texture liquid water 0 61 w m 1 k 1 and ice 2 2 w m 1 k 1 θ s a t l is the saturated soil moisture the soil organic matter som was not considered in the calculation of λ calculation of other properties and heat transfer processes of soil profile are shown in appendix a 2 3 model improvements 2 3 1 snowpack density snowpack controls the thermal transmission through the atmosphere soil interface during winter and early spring wu et al 2016 in the original beps model the snow density ρ s n o w is calculated simply as 3 ρ s n o w 67 9 51 3 e t a 2 6 where ta is air temperature the effects of canopy and wind speed on ρ s n o w was not considered in the improved beps model the snow accumulation is correlated closely with the canopy characteristics for the windy grassland sites ρ s n o w is calculated as helfricht et al 2018 4 ρ s n o w 500 1 0 951 e 1 4 5 t a 1 15 0 008 u 1 7 13 c t a 2 5 c 500 1 0 904 e 0 008 u 1 7 t a 13 c where t a c is air temperature u is the wind speed in m s 2 3 2 puddled water in the case that the surface water supply e g rainfall snowmelt or irrigation exceeds the actual infiltration rate from the surface into the soil the beps model assumes that a puddle occurs chen et al 2007 the puddled water has large specific heat and it can buffer the variation of ground temperature the hydro dynamics of surface water supply and infiltration were implemented in the original beps model chen et al 2007 however the influences of surface water on surface thermal transmission have not been considered yet in the improved beps model the thermal regime of the puddle is distinguished from that of underneath soil the puddle is modeled as part of the profile for heat conduction within the snowpack module puddle and snowpack or surface ice can be converted into each other at freezing point 0 c the amount of meltwater and freezing water is estimated based on the available energy similarly to the calculation of snowpack temperature chen et al 2007 the temperature of puddled water is first calculated using eq 1 without considering the thawing freezing effects and this is apparent temperature t s if t s 0 c energy would be released from water freezing t s is then reset to 0 c 2 3 3 soil organic matter in the original beps model soil organic matter was not considered in the calculation of some soil thermal hydraulic parameters such as soil thermal conductivity the saturated soil water potential the clapp and hornberger empirical parameter and the saturated hydraulic conductivity the som usually has high heat capacity and low heat conductivity due to its high porosity with a majority of pores filled with water and air neglecting som in the calculation of soil thermal hydraulic parameters would cause large uncertainties in simulating soil thermal dynamics in the improved beps model we replaced the default parameterization of soil thermal conductivity λ l with that of tian et al 2016 as 5 λ l λ l i q l θ l i q l w i c e l λ i c e θ i c e l w a l λ a θ a l w s l λ s l θ s l w s o c l λ s o c l θ s c l θ l i q l w ice l θ i c e l w a l θ a l w s l θ s l w s o c l θ s o c l where the subscript α denotes the air component subscript s o c denotes the soil organic carbon θ is the volumetric fraction and w is the weighting factor unitless appendix b1 the calculations of other soil thermal hydraulic parameters were also improved to incorporate the effects of som and they are expressed as lawrence and slater 2008 6 α l 1 f s o c l α m i n i f s o c l α s o c where the subscripts s o c and m i n represent the soil organic carbon and mineral material f s o c l is the volume fraction of soil organic carbon in soil layer l α is any hydrologic or thermal parameter in the improved beps model the thermal conductivity of som λ s o c is set as 0 25 w m 1 k 1 farouki 1981 the saturated soil water potential of som ψ s a t s o c is set as 10 3 mm the clapp and hornberger empirical parameter of som b is set as 2 7 and the saturated hydraulic conductivity of som k s a t s o c is set as 0 10 m s 1 10 3 letts et al 2000 2 3 4 super cooled soil water the original beps model did not consider the super cooled soil water which can exist in frozen soils through the capillary and absorptive forces exerted by soil particles melton et al 2019 this liquid water content changes drastically near 0 c and decreases with decreasing temperature its amount has important implications for the simulation of thermal dynamics in frozen soils hu et al 2020b zhang et al 2008 in the improved beps model we set the upper limit of the liquid water content for subfreezing temperature as niu and yang 2006 7 θ l i q m a x θ s a t 10 3 l f t t f r z g t ψ s a t 1 b where θ s a t is the porosity of soil l f is the latent heat of fusion j kg 1 t and t f r z are soil temperature and freezing point c t f r z 0 c respectively fuchs et al 1978 g is the gravitational acceleration m s 2 ψ s a t is the saturated soil matric potential depending on the soil texture mm and b is the clapp and hornberger empirical parameter clapp and hornberger 1978 this equation calculates the maximum liquid water content at a soil temperature below the freezing point appendix b2 2 4 estimation of soil freeze thaw parameters the periods of soil thawing and freezing are determined by soil temperature a soil ft cycle occurs when the daily maximum soil temperature exceeds 0 c and the daily minimum soil temperature is below 0 c which means the soil thaws during the day and is frozen during the night the duration of the diurnal soil ft cycles is calculated as the number of days with the diurnal soil ft cycle the amplitude of the diurnal soil ft cycles is calculated using the difference between the daily maximum and minimum soil temperature when the diurnal soil ft cycle occurs thaw freeze day is defined as the onset date of soil thawing freezing 3 results 3 1 simulation of soil temperature the hourly soil temperature simulated by the original and improved beps model were compared with measured data to evaluate the performance of the original and improved beps model in simulating soil temperature at the studied sites supplementary materials fig s1 the regression statistics are summarized in table 2 the original and improved beps models are both able to explain 90 of the variance in soil temperature the root mean square error rmse of soil temperature simulated by the original beps model ranges from 2 33 to 6 01 c and that simulated by the improved beps model ranges from 1 79 to 3 31 c table 2 the improved beps model shows smaller rmses higher r2 and slopes closer to one performed better than the original beps model in simulating soil temperature at the studied sites simulated seasonal soil temperature from both the original and improved beps model were also compared with the observed soil temperature for all the studied sites fig 3 in general both the original and improved beps models were able to capture the seasonal variations in soil temperature for the studied sites and the improved beps model performed better than the original one in simulating ensemble mean soil temperate in all four seasons fig 3 in spring mar to may the observed ensemble mean soil temperature was 1 94 6 84 c while the simulated soil temperature from the original and the improved beps model were 0 57 8 26 c and 1 19 6 30 c respectively fig 3 on average the improved beps model underestimated the observed soil temperature by 38 7 in spring this negative bias is much smaller than that of the original beps model which is as large as 70 6 in summer the observed ensemble mean soil temperature was 16 97 3 36 c while the simulated soil temperature from the original and the improved beps model were 17 37 3 26 c and 16 67 2 74 c respectively fig 3 on average the improved beps model underestimated the observed soil temperature by 1 8 while the original beps model overestimated observed soil temperature by 2 4 in summer in autumn the observed ensemble mean soil temperature was 4 59 6 70 c while the simulated soil temperature from the original and the improved beps model were 2 49 7 50 c and 4 44 6 08 c respectively fig 3 on average the improved beps model underestimated the observed soil temperature by 3 4 in autumn this negative bias is much smaller than that of the original beps model which is as large as 45 8 in winter the observed ensemble mean soil temperature was 9 41 2 39 c while the simulated soil temperature from the original and the improved beps model were 15 33 3 87 c and 10 47 3 36 c respectively fig 3 on average the improved beps model underestimated the observed soil temperature by 11 3 in winter this negative bias is much smaller than that of the original beps model which is as large as 62 9 3 2 simulation of diurnal soil ft cycles of different vegetation types mean amplitudes of diurnal soil ft cycles simulated by the original and improved beps model are compared with those from the observations at the studied forest and grassland sites for thawing and freezing periods respectively fig 4 the observed mean amplitudes of soil diurnal ft cycles during the thawing period are 2 32 1 06 c at forest sites and 5 01 2 35 c at grassland sites fig 4a the simulated mean amplitudes of soil diurnal ft cycles from the original and improved beps model during the thawing period are 1 80 1 91 c and 2 31 2 68 c respectively at forest sites and they are 1 03 1 38 c and 6 21 2 91 c respectively at grassland sites fig 4a the results from the improved beps model are closer to the observations compared to those from the original beps model during freezing period the observed mean amplitudes of diurnal soil ft cycles are 1 20 0 92 c at forest sites and 5 91 3 84 c at grassland sites fig 4b the simulated mean amplitudes of diurnal soil ft cycles from original and improved beps model during the freezing period are 0 32 0 79 c and 1 10 1 30 c respectively at forest sites and they are 1 28 1 15 c and 5 73 2 97 c respectively at grassland sites fig 4b the results from the improved beps model are closer to the observations compared to those from the original beps model the mean amplitudes of diurnal soil ft cycles are larger at grassland sites than forest sites for both thawing and freezing periods fig 4 through the conventional double tailed t tests the differences in amplitudes of ft cycles between forest and grassland sites for both thawing and freezing periods are all statistically significant at p 0 1 meaning that the vegetation effect for either thawing period or freezing period is highly significant mean durations of diurnal soil ft cycles simulated by the original and improved beps model are also compared with those from the observations at the studied forest and grassland sites for thawing and freezing periods respectively fig 5 the observed mean durations of diurnal soil ft cycles during the thawing period are 14 5 days at forest sites and 11 6 days at grassland sites fig 5a the simulated mean durations of diurnal soil ft cycles from the original and improved beps model during the thawing period are 2 2 days and 9 5 days respectively at forest sites and they are 1 2 days and 8 5 days respectively at grassland sites fig 5a the results from the improved beps model are closer to the observations compared to those from the original beps model during the freezing period the observed mean durations of diurnal soil ft cycles are 8 6 days at forest sites and 10 9 days at grassland sites fig 5b the simulated mean durations of diurnal soil ft cycles from the original and improved beps model during the freezing period are 1 1 days and 6 5 days respectively at forest sites and they are 2 2 days and 8 6 days respectively at grassland sites fig 5b the results from the improved beps model are closer to the observations compared to those from the original beps model 3 3 simulation of seasonal soil ft timing for different vegetation types mean thaw days simulated by the original and improved beps model are compared with those from the observations at the studied forest and grassland sites respectively fig 6 a the observed mean thaw days are doy 98 14 at forest sites and doy 85 8 at grassland sites fig 6a the simulated mean thaw day from the original and improved beps model are doy 93 18 and doy 98 13 respectively at forest sites and they are doy 79 6 and doy 85 9 respectively at grassland sites fig 6a the results from the improved beps model are closer to the observations compared to those from the original beps model the soil of forest sites thawed later than grassland sites through the conventional double tailed t tests the differences of thaw day between forest and grassland sites are statistically significant at p 0 1 based on the observation and the simulated results of the improved beps model fig 6a mean freeze days simulated by the original and improved beps model are also compared with those from the observations at the studied forest and grassland sites respectively fig 6b the observed mean freeze days are doy 291 23 at forest sites and doy 298 18 at grassland sites fig 6b the simulated mean freeze days from the original and improved beps model are doy 265 15 and doy 282 19 respectively at forest sites and they are doy 283 22 and doy 299 21 respectively at grassland sites fig 6b the results from the improved beps model are closer to the observations compared to those from the original beps model through the conventional double tailed t tests the differences of freeze days between forest and grassland sites are not statistically significant at p 0 1 based on the observation and the simulated results of the improved beps model fig 6b 4 discussion 4 1 the impacts of different improvement schemes on the simulations of soil temperature the gaussian kernel density estimation kde of the differences between the simulated soil temperatures from the experimental model runs and the observations of the five studied sites was conducted to compare the contribution of the four modifications of beps model in simulating soil temperature considering the impacts of canopy and wind speed on the snowpack density reduces the mae of simulated soil temperature from 3 23 to 2 90 c fig 7 the incorporation of puddled water into the simulation of soil thermal dynamics reduces the mae of simulated soil temperature from 3 23 to 2 54 c fig 7 the incorporation of soil organic matter into the calculations of soil thermal hydraulic parameters reduces the mae of simulated soil temperature from 3 23 to 3 04 c fig 7 the inclusion of unfrozen water in frozen soils did not change mae of simulated soil temperature significantly fig 7 totally the integrated improvements to the beps model reduce the mae of simulated soil temperature from 3 23 to 2 29 c fig 7 the simulations of soil temperature from the improved beps model perform much better than those of the original beps model due to more careful treatments of the impacts of a thermal buffer zone i e snowpack puddled water and som on subsurface heat transfer snow is an insulator and is a leading factor in preventing the ground from heat loss in winter especially at the high latitudes where stable snow cover lasts from a few weeks to several months zhang 2005 as an aquitard the frozen soil layer drastically weakens hydraulic connectivity and downward water infiltration and benefits the existence of puddled water jin et al 2020 the puddled water layers act as a buffer that modulates the heat exchange between the overlying air and the underlying soil layer som would also modulate the transfer of heat between soil and atmosphere typically leading to a smaller daily difference in soil temperature lawrence and slater 2008 thus it is essential to incorporate a realistic buffer zone between the atmospheric forcing and soil thermal processes ju et al 2006 kim et al 2016 tao et al 2017 4 2 vegetation types affected diurnal soil ft cycles and seasonal soil ft timing different vegetation types have distinct community structures and consequently differ in litter cover snow accumulation patterns and canopy interception of solar radiation guo et al 2018 wang et al 2002 plant litter is a major source of near surface som and the accumulation of litter was affected by plant species novara et al 2015 compared to grassland the forest usually has more aboveground biomass thicker litter layer and more som supplementary materials fig s7 thus litter insulation is higher in forest sites producing a lower amplitude of diurnal soil ft cycles compared to grassland sites fig 8 it has been recognized that snow accumulation differs substantially between forested and grassland because of the difference in canopy interception of snow snow sublimation and wind redistribution chang et al 2015 foster et al 2019 the mean snow depth is positively correlated with the thaw day fig 9 b because the depth dependent snowpack insulation could regulate the thermal transmission between the atmosphere and the soil and consequently slow down soil thawing also the soc content is positively correlated with the thaw day fig 9d because som also buffers soil thermal transmission and more soil surface soc would slow down soil thawing during the thawing period forest sites have thicker snow depth and more soil surface soc than grassland sites and these are the reasons why the thaw days of forest sites are later than those of grassland sites fig 9 5 conclusions in this study the beps model has been improved through more careful treatments of the impacts of thermal buffer zone i e snowpack puddled water and som on subsurface heat transfer the different patterns of soil surface ft processes between forest and grassland and the regulation of vegetation to soil ft processes were analyzed based on the measured soil temperature data and those simulated by the beps model the major conclusions are drawn as follows 1 compared to the original beps model the improved beps model has smaller rmses higher r2 and slopes closer to one and performs better in simulating soil temperate in all four seasons 2 the simulated diurnal soil ft cycles and seasonal soil ft timing from the improved beps model are closer to the observations compared to those from the original beps model 3 forest sites have smaller amplitudes of diurnal soil ft cycles and delayed timing of soil thaw compared to grassland sites credit zhenhai liu conceptualization software writing original draft preparation bin chen conceptualization methodology writing review and editing shaoqiang wang writing review and editing supervision project administration qinyi wang validation data curation jinghua chen software weibo shi software xiaobo wang software yuanyuan liu visualization yongkai tu visualization mei huang supervision junbang wang supervision zhaosheng wang supervision hui li data curation tongtong zhu data curation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors sincerely appreciate prof jingming chen for sharing the codes of the beps model this study used eddy covariance data acquired and shared by chinaflux asiaflux and fluxnet the globmap v2 lai datasets and soilgrids dataset are provided by yang liu and tomislav hengl we greatly offer our profound appreciation to all the providers of the freely available data this research was supported by the science and technology strategic pilot of the chinese academy of sciences xda20030203 supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j ecolmodel 2021 109663 appendix c supplementary materials image application 1 appendix a thermal dynamics of the soil profile in the original beps model the soil volumetric heat capacity c s l is equal to the sum of the specific heat capacities of the soil constituents water ice soil minerals and organic matter multiplied by their respective volumetric fraction a1 c s l 2 0 10 3 ρ s l 2 65 c w 1 f i c e l c i c e f i c e l θ w l c s s o c f s o c l where ρ s l g cm 3 is the soil bulk density of layer l c w 4 2 103 j kg 1 k 1 c i c e 2 09 103 j kg 1 k 1 c s s o c 2 5 103 j kg 1 k 1 are the specific heat of water ice and soil organic matter respectively θ w l is the soil moisture in the l th soil layer f i c e l and f s o c l are the volume fractions of ice and organic matter in soil layer l respectively 2 65 g cm 3 is the typical soil particle density of mineral soils 2 0 103 j kg 1 k 1 is the specific heat of mineral soils the net energy flux at the ground surface under canopy and snow g 0 is assumed to be transmitted into soil layers as the boundary condition a2 0 g 0 r n g h g λ e g a3 c s l δ t s l δ t g l 1 l g l l 1 z l s s l l 1 2 3 n 1 a4 g l 1 l g 0 1 g 0 l 1 a5 g l 1 l 0 5 k t l 1 0 5 k t l t s l 1 t s l 0 5 z l 1 0 5 z l l 2 3 4 n where r n g w m 2 is the net absorbed radiation by a canopy h g w m 2 is the sensible heat flux from the ground to the canopy and through it λ j kg 1 is the latent heat of vaporization e g kg m 2 s 1 is the evaporation from the ground surface g l 1 l w m 2 is the conductive heat fluxes between soil layers l 1 and l the snowpack is modeled as a part of the profile for heat conduction below the reference plane of surface temperature the same equation for heat dynamics in the soil profile is used in the snowpack thermal module the amount of snow is the balance of snowfall and snowmelt which is estimated based on the available energy the thickness of the snowpack is updated every time step based on the amount of snow water equivalent and its density profile when the thickness of the snowpack covering the ground is less than 2 cm the snowpack and ground surface is considered as one layer when the thickness is more than 2 cm but less than 5 cm the snowpack as an independent layer on the ground is proportionally distributed with bare ground when the thickness is greater than 5 cm the snowpack is regarded as three layers 0 2 cm 2 5 cm and 5 cm appendix b description of improved parameterizations b1 soil organic matter the parameterization of soil thermal conductivity is based upon the weighting factor w of different components to calculate the λ the w is given as tian et al 2016 b1 w s l 1 3 2 1 0 125 λ s l λ l i q l 1 1 1 0 75 λ s l λ l i q l 1 b2 w a l 1 3 2 1 g a λ a λ l i q l 1 1 1 1 2 g a λ a λ l i q l 1 where g a represents a unitless empirical air pore shape factor b3 g a 0 333 1 θ a l θ s a t l the shape of ice crystal in soil pores develop similarly to those of air voids therefore g for ice is given by the following equation b4 g ice 0 333 1 θ i c e l θ s a t l the thermal conductivity of air 0 025 w m 1 k 1 the heat capacity c s l of a soil layer l is calculated through updated formula as lawrence and slater 2008 b5 c s l c s l 1 θ s a t l c w 1 f i c e c i c e f i c e θ l w c a i r θ s a t l θ w l b6 c s l c s m i n l 1 f s o c l c s s o c f s o c l where c a i r 1 0 103 j kg 1 k 1 is the specific heat of air in soil layers de vries 1963 c s m i n l is the specific heat of mineral soil and is computed as the percent of sand and clay for soil layer l the soil organic carbon fraction f s o c l for a particular soil layer as f s o c l ρ s o c l ρ s o c m a x the ρ s o c l is the soil carbon density for soil layer l and ρ s o c m a x 130 kg m 3 is the maximum soil carbon density equivalent to a standard bulk density of peat farouki 1981 the specific heat capacity of soil layer l is the weighted sum of the specific heat of soil solid and water b2 unfrozen water content in frozen soil the upper limit of the liquid water content for subfreezing temperature is calculated by eq 7 based on θ l i q m a x the content of liquid water in frozen soils for the next time step n 1 is calculated as follows b7 θ l i q n 1 min θ l i q m a x θ n where θ n θ l i q θ i c e is the total volumetric soil moisture at time step n θ i c e is the ice content the θ i c e for the next time step is defined as b8 θ i c e n 1 min θ i c e n r f m δ t θ n where δ t is the time step r f m is the conservation of the partial volume of ice b9 θ i c e t r f m and r f m is defined as b10 r f m h f m ρ i c e l f δ z where ρ i c e 917 kg m 3 is the density of ice h f m in the unit of w m 2 is assessed from the energy excess or deficit needed to change soil temperature to the freezing point t f r z and it is calculated as b11 h f m c s δ z t f r z t n 1 δ t where t n 1 is the soil layer temperature resulting from all the other processes except for phase changes the soil hydraulic conductivity k m s 1 can be calculated via the clapp and hornberger 1978 equation as b12 k f i c e k s a t θ l i q θ s a t 2 b 3 where k s a t is the soil hydraulic conductivity at saturation f i c e is the fraction of ice to soil pore volume and it is calculated as b13 f i c e 1 m i n 1 θ i c e θ s a t 2 
24580,permafrost degradation due to climate warming would potentially increase the release of previously frozen soil carbon and change the carbon budget of the cold region ecosystem the underlying permafrost degradation would be effectively mediated by soil surface freezing thawing ft processes aboveground vegetation can regulate soil ft processes however its effects on ground thermal transfer have not been well represented by ecosystem models in this study we improved the hydrothermal module of the boreal ecosystem productivity simulator beps through more careful parameterization of snowpack density puddled water soil organic matter and super cooled soil water the impacts of vegetation on the soil surface ft processes have also been investigated using the improved beps model and the measured soil temperature data at forest and grassland sites on the southern edge of permafrost region in mongolia and northeastern china the improved beps model performs better than the original model in simulations of soil temperature and soil ft processes smaller amplitudes of soil diurnal ft cycles were found in forest sites compared to grassland sites forest sites have delayed soil thaw timing and similar soil freezing time compared to grassland sites differences in snow depths and soil organic matter content due to distinct vegetation community structures have considerable influences on the disparity in soil ft processes thus it is important to improve the simulation of the impacts of vegetation on soil surface ft processes for better forecasting the permafrost degradation keywords freeze thaw vegetation model improvement soil temperature 1 introduction permafrost the ground that remains below 0 c for at least two consecutive years underlies approximately 23 9 of the exposed land surface of the northern hemisphere and it contains twice as much carbon as the atmosphere grosse et al 2016 schädel et al 2016 the large quantities of carbon stored in the frozen soil could be released into the atmosphere due to permafrost degradation caused by climatic warming this degradation would potentially change the global carbon budget and accelerate global climate warming chaudhary et al 2020 hollesen et al 2011 the most dramatic permafrost degradation mainly occurs at the southern edge of permafrost area due to the significant poleward movement of permafrost caused by climate warming guo et al 2018 yue et al 2020 the soil surface freezing thawing ft processes which are measured by the amplitude and duration of the diurnal soil ft cycle as well as seasonal ft timing would effectively mediate the underlying permafrost degradation guo et al 2018 the soil ft processes during the transition period from cold to warm or warm to cold seasons can last from a few days to a few weeks and they are susceptible to change because of the rapid climate warming bao et al 2021 pachauri et al 2014 there have been many researches investigating the soil ft processes in response to climatic warming mainly using near surface soil temperature data from in situ measurements bao et al 2021 cao et al 2020 wang et al 2020 yoshikawa et al 2020 land surface temperature data from satellites baltzer et al 2014 kim et al 2014 as well as ecosystem model simulations foster et al 2019 guo and wang 2014 however there are still uncertainties in these studies due to the sparse and short term field measurements tao et al 2017 coarse resolution of the available remote sensing data grosse et al 2016 tao et al 2017 or the poor representation of soil ft processes in ecosystem models barman and jain 2016 jan et al 2020 nitzbon et al 2020 to better understand the pattern and drivers of the soil ft processes at regional scale the more realistic representation and parameterizations of soil ft processes are needed to be incorporated into ecosystem models the impacts of vegetation on soil ft processes have been examined by many studies field measurements in south siberia hu et al 2013 zhangbei county of hebei province china chen et al 2020 and qinghai tibetan plateau hu et al 2020a found that vegetation could exert buffer effect on soil temperature and consequently affect the soil ft processes guo et al 2018 found that soil ft cycles would be larger in amplitude and longer in duration at steppe sites than at forest sites soils in the forest sites and steppe sites froze almost simultaneously but experience a delay in thawing for forest sites guo et al 2018 in addition the hydrologic and thermal regimes of soil surface and soil ft processes could be affected by vegetation through intercepting snowfall and solar radiation chang et al 2015 french 2007 karjalainen et al 2019 and through buffer effect of litter layer chaudhary et al 2020 lawrence and slater 2008 thus it is essential to improve the ecosystem model for better simulating the impacts of vegetation on soil ft processes three forest sites and two grassland sites investigated in this study were located along a vast latitudinal around 10 and longitudinal around 20 gradient at the south edge of the permafrost region of mongolia and northeastern china soil temperature and meteorological data were recorded at these sites during 2003 to 2014 the soil vegetation thermal and hydraulic modules of the boreal ecosystems productivity simulator beps have been improved and tested at the studied sites using the measured soil temperature data and those simulated by the beps model we investigated the impacts of vegetation types on soil ft processes 2 materials and methods 2 1 site description three forest sites and two grassland sites at the southern edge of a permafrost region in mongolia and northeastern china were investigated in this study fig 1 and table 1 three sites skt dxf and kbu are in the permafrost region and two sites chb and cng belong to the region of seasonally frozen ground these sites were selected fulfilling the following conditions in data quality and availability 1 soil data including soil texture and soil organic carbon soc content are available 2 two or more years of continuous hourly measurements of soil temperature and meteorological variables including air temperature downward shortwave radiation relative humidity precipitation and wind speed are available 3 ground measurements of leaf area index lai and clumping index are available table s1 shows the detailed information about these observational items containing the types and placement heights depths of the instruments the southern khentei taiga skt forest site is located in a siberian larch forest on a southwest facing gently sloping hill with a maximum slope of about 5 li et al 2005b the soil at the site is spodosol seasonal cryosol with coarse texture its total carbon content at the top 40 cm soil layer is 2 21 0 50 on average after removal of roots by sieving the understory was dense and formed a distinct layer of grasses and scattered shrubs li et al 2005b the temperate mixed forest site of changbai mountain chb is located in northeastern china guan et al 2006 zhang et al 2016 elevational permafrost may occur in the upper part and on the top of the changbai mountain wei et al 2011 the daxing anling forest ecosystem research station dxf lies in a continuous permafrost region within northeastern china wei et al 2011 the larch forest and frozen soil maintain the cold and wet environmental conditions of cold temperate coniferous forests tian et al 2018 the annual frozen period is over 210 days and the snow cover exists from late september to early may chen and li 2008 the kherlenbayan ulaan kbu steppe site is located in northeastern mongolia it is fairly open and flat with terrain slopes less than 0 5 in all directions li et al 2005a the soil is classified as chestnut soil kastanozem and is well drained with low moisture holding capacity li et al 2008 its bulk density overall porosity and hydraulic conductivity in the top 30 cm layer are 1 45 g cm 3 45 and 0 01 0 08 mm s 1 respectively li et al 2006 the changling temperate meadow steppe station cng is situated in the southern songnen plain there is 1 5 soil organic matter in the top soil layer dong et al 2011 the frost free period was about 130 165 days and the growing season was limited to late april to september the vertical profile of soil organic carbon density and bulk density were derived from the soilgrids dataset that covers the top 2 m of soil column with seven layers 0 5 15 30 60 100 and 200 cm hengl et al 2017 the soilgrids dataset with 250 m spatial resolution is interpolated to the five layers of soil column in the beps model using the linear interpolation method 2 2 the description of beps model the beps model a process based diagnostic model was initially developed for canadian boreal ecosystems liu et al 1997 and has been adapted for other ecosystems over the globe it is commonly used in stimulating photosynthesis vegetation productivity and soil biogeochemical processes at hourly time steps chen et al 2016 j m chen et al 2019 s zhang et al 2018 beps includes a two leaf canopy stratification scheme that treats vegetation canopy as two groups of leaves sunlit and shaded ones b chen et al 2019 the soil profile is divided into five layers and the thickness of soil layers increases exponentially from the top layer to the deepest layer equals to 0 05 0 1 0 2 0 4 and 1 25 m respectively each soil layer is considered as a mixture of mineral soil organic matter and water fig 2 the beps model is driven by vegetation parameters including leaf area index clumping index and land cover type as well as meteorological and soil data beps includes modules to calculate the thermal dynamics of soil profile which are determined using a one dimensional vertical direction heat diffusion equation chen et al 2007 1 c s l t s l t z λ t l t s l z s s l where c s l j m 3 k 1 is the volumetric heat capacity of soil layer l t s l c is the soil temperature at depth z and time t s s l w m 3 is the source or sink term for freezing or thawing of moisture occurred at soil layer l λ t l w m 1 k 1 is the soil thermal conductivity which is determined as a function of soil texture and soil moisture content kumar and kaleita 2003 2 λ t l λ s l 1 θ s a t l λ l i q θ w l 1 f i c e l λ i c e θ w l f i c e l 0 15 θ w l θ s a t l 0 15 where λ s l λ l i q and λ i c e are the thermal conductivity of the constituents including soil solids decided by soil texture liquid water 0 61 w m 1 k 1 and ice 2 2 w m 1 k 1 θ s a t l is the saturated soil moisture the soil organic matter som was not considered in the calculation of λ calculation of other properties and heat transfer processes of soil profile are shown in appendix a 2 3 model improvements 2 3 1 snowpack density snowpack controls the thermal transmission through the atmosphere soil interface during winter and early spring wu et al 2016 in the original beps model the snow density ρ s n o w is calculated simply as 3 ρ s n o w 67 9 51 3 e t a 2 6 where ta is air temperature the effects of canopy and wind speed on ρ s n o w was not considered in the improved beps model the snow accumulation is correlated closely with the canopy characteristics for the windy grassland sites ρ s n o w is calculated as helfricht et al 2018 4 ρ s n o w 500 1 0 951 e 1 4 5 t a 1 15 0 008 u 1 7 13 c t a 2 5 c 500 1 0 904 e 0 008 u 1 7 t a 13 c where t a c is air temperature u is the wind speed in m s 2 3 2 puddled water in the case that the surface water supply e g rainfall snowmelt or irrigation exceeds the actual infiltration rate from the surface into the soil the beps model assumes that a puddle occurs chen et al 2007 the puddled water has large specific heat and it can buffer the variation of ground temperature the hydro dynamics of surface water supply and infiltration were implemented in the original beps model chen et al 2007 however the influences of surface water on surface thermal transmission have not been considered yet in the improved beps model the thermal regime of the puddle is distinguished from that of underneath soil the puddle is modeled as part of the profile for heat conduction within the snowpack module puddle and snowpack or surface ice can be converted into each other at freezing point 0 c the amount of meltwater and freezing water is estimated based on the available energy similarly to the calculation of snowpack temperature chen et al 2007 the temperature of puddled water is first calculated using eq 1 without considering the thawing freezing effects and this is apparent temperature t s if t s 0 c energy would be released from water freezing t s is then reset to 0 c 2 3 3 soil organic matter in the original beps model soil organic matter was not considered in the calculation of some soil thermal hydraulic parameters such as soil thermal conductivity the saturated soil water potential the clapp and hornberger empirical parameter and the saturated hydraulic conductivity the som usually has high heat capacity and low heat conductivity due to its high porosity with a majority of pores filled with water and air neglecting som in the calculation of soil thermal hydraulic parameters would cause large uncertainties in simulating soil thermal dynamics in the improved beps model we replaced the default parameterization of soil thermal conductivity λ l with that of tian et al 2016 as 5 λ l λ l i q l θ l i q l w i c e l λ i c e θ i c e l w a l λ a θ a l w s l λ s l θ s l w s o c l λ s o c l θ s c l θ l i q l w ice l θ i c e l w a l θ a l w s l θ s l w s o c l θ s o c l where the subscript α denotes the air component subscript s o c denotes the soil organic carbon θ is the volumetric fraction and w is the weighting factor unitless appendix b1 the calculations of other soil thermal hydraulic parameters were also improved to incorporate the effects of som and they are expressed as lawrence and slater 2008 6 α l 1 f s o c l α m i n i f s o c l α s o c where the subscripts s o c and m i n represent the soil organic carbon and mineral material f s o c l is the volume fraction of soil organic carbon in soil layer l α is any hydrologic or thermal parameter in the improved beps model the thermal conductivity of som λ s o c is set as 0 25 w m 1 k 1 farouki 1981 the saturated soil water potential of som ψ s a t s o c is set as 10 3 mm the clapp and hornberger empirical parameter of som b is set as 2 7 and the saturated hydraulic conductivity of som k s a t s o c is set as 0 10 m s 1 10 3 letts et al 2000 2 3 4 super cooled soil water the original beps model did not consider the super cooled soil water which can exist in frozen soils through the capillary and absorptive forces exerted by soil particles melton et al 2019 this liquid water content changes drastically near 0 c and decreases with decreasing temperature its amount has important implications for the simulation of thermal dynamics in frozen soils hu et al 2020b zhang et al 2008 in the improved beps model we set the upper limit of the liquid water content for subfreezing temperature as niu and yang 2006 7 θ l i q m a x θ s a t 10 3 l f t t f r z g t ψ s a t 1 b where θ s a t is the porosity of soil l f is the latent heat of fusion j kg 1 t and t f r z are soil temperature and freezing point c t f r z 0 c respectively fuchs et al 1978 g is the gravitational acceleration m s 2 ψ s a t is the saturated soil matric potential depending on the soil texture mm and b is the clapp and hornberger empirical parameter clapp and hornberger 1978 this equation calculates the maximum liquid water content at a soil temperature below the freezing point appendix b2 2 4 estimation of soil freeze thaw parameters the periods of soil thawing and freezing are determined by soil temperature a soil ft cycle occurs when the daily maximum soil temperature exceeds 0 c and the daily minimum soil temperature is below 0 c which means the soil thaws during the day and is frozen during the night the duration of the diurnal soil ft cycles is calculated as the number of days with the diurnal soil ft cycle the amplitude of the diurnal soil ft cycles is calculated using the difference between the daily maximum and minimum soil temperature when the diurnal soil ft cycle occurs thaw freeze day is defined as the onset date of soil thawing freezing 3 results 3 1 simulation of soil temperature the hourly soil temperature simulated by the original and improved beps model were compared with measured data to evaluate the performance of the original and improved beps model in simulating soil temperature at the studied sites supplementary materials fig s1 the regression statistics are summarized in table 2 the original and improved beps models are both able to explain 90 of the variance in soil temperature the root mean square error rmse of soil temperature simulated by the original beps model ranges from 2 33 to 6 01 c and that simulated by the improved beps model ranges from 1 79 to 3 31 c table 2 the improved beps model shows smaller rmses higher r2 and slopes closer to one performed better than the original beps model in simulating soil temperature at the studied sites simulated seasonal soil temperature from both the original and improved beps model were also compared with the observed soil temperature for all the studied sites fig 3 in general both the original and improved beps models were able to capture the seasonal variations in soil temperature for the studied sites and the improved beps model performed better than the original one in simulating ensemble mean soil temperate in all four seasons fig 3 in spring mar to may the observed ensemble mean soil temperature was 1 94 6 84 c while the simulated soil temperature from the original and the improved beps model were 0 57 8 26 c and 1 19 6 30 c respectively fig 3 on average the improved beps model underestimated the observed soil temperature by 38 7 in spring this negative bias is much smaller than that of the original beps model which is as large as 70 6 in summer the observed ensemble mean soil temperature was 16 97 3 36 c while the simulated soil temperature from the original and the improved beps model were 17 37 3 26 c and 16 67 2 74 c respectively fig 3 on average the improved beps model underestimated the observed soil temperature by 1 8 while the original beps model overestimated observed soil temperature by 2 4 in summer in autumn the observed ensemble mean soil temperature was 4 59 6 70 c while the simulated soil temperature from the original and the improved beps model were 2 49 7 50 c and 4 44 6 08 c respectively fig 3 on average the improved beps model underestimated the observed soil temperature by 3 4 in autumn this negative bias is much smaller than that of the original beps model which is as large as 45 8 in winter the observed ensemble mean soil temperature was 9 41 2 39 c while the simulated soil temperature from the original and the improved beps model were 15 33 3 87 c and 10 47 3 36 c respectively fig 3 on average the improved beps model underestimated the observed soil temperature by 11 3 in winter this negative bias is much smaller than that of the original beps model which is as large as 62 9 3 2 simulation of diurnal soil ft cycles of different vegetation types mean amplitudes of diurnal soil ft cycles simulated by the original and improved beps model are compared with those from the observations at the studied forest and grassland sites for thawing and freezing periods respectively fig 4 the observed mean amplitudes of soil diurnal ft cycles during the thawing period are 2 32 1 06 c at forest sites and 5 01 2 35 c at grassland sites fig 4a the simulated mean amplitudes of soil diurnal ft cycles from the original and improved beps model during the thawing period are 1 80 1 91 c and 2 31 2 68 c respectively at forest sites and they are 1 03 1 38 c and 6 21 2 91 c respectively at grassland sites fig 4a the results from the improved beps model are closer to the observations compared to those from the original beps model during freezing period the observed mean amplitudes of diurnal soil ft cycles are 1 20 0 92 c at forest sites and 5 91 3 84 c at grassland sites fig 4b the simulated mean amplitudes of diurnal soil ft cycles from original and improved beps model during the freezing period are 0 32 0 79 c and 1 10 1 30 c respectively at forest sites and they are 1 28 1 15 c and 5 73 2 97 c respectively at grassland sites fig 4b the results from the improved beps model are closer to the observations compared to those from the original beps model the mean amplitudes of diurnal soil ft cycles are larger at grassland sites than forest sites for both thawing and freezing periods fig 4 through the conventional double tailed t tests the differences in amplitudes of ft cycles between forest and grassland sites for both thawing and freezing periods are all statistically significant at p 0 1 meaning that the vegetation effect for either thawing period or freezing period is highly significant mean durations of diurnal soil ft cycles simulated by the original and improved beps model are also compared with those from the observations at the studied forest and grassland sites for thawing and freezing periods respectively fig 5 the observed mean durations of diurnal soil ft cycles during the thawing period are 14 5 days at forest sites and 11 6 days at grassland sites fig 5a the simulated mean durations of diurnal soil ft cycles from the original and improved beps model during the thawing period are 2 2 days and 9 5 days respectively at forest sites and they are 1 2 days and 8 5 days respectively at grassland sites fig 5a the results from the improved beps model are closer to the observations compared to those from the original beps model during the freezing period the observed mean durations of diurnal soil ft cycles are 8 6 days at forest sites and 10 9 days at grassland sites fig 5b the simulated mean durations of diurnal soil ft cycles from the original and improved beps model during the freezing period are 1 1 days and 6 5 days respectively at forest sites and they are 2 2 days and 8 6 days respectively at grassland sites fig 5b the results from the improved beps model are closer to the observations compared to those from the original beps model 3 3 simulation of seasonal soil ft timing for different vegetation types mean thaw days simulated by the original and improved beps model are compared with those from the observations at the studied forest and grassland sites respectively fig 6 a the observed mean thaw days are doy 98 14 at forest sites and doy 85 8 at grassland sites fig 6a the simulated mean thaw day from the original and improved beps model are doy 93 18 and doy 98 13 respectively at forest sites and they are doy 79 6 and doy 85 9 respectively at grassland sites fig 6a the results from the improved beps model are closer to the observations compared to those from the original beps model the soil of forest sites thawed later than grassland sites through the conventional double tailed t tests the differences of thaw day between forest and grassland sites are statistically significant at p 0 1 based on the observation and the simulated results of the improved beps model fig 6a mean freeze days simulated by the original and improved beps model are also compared with those from the observations at the studied forest and grassland sites respectively fig 6b the observed mean freeze days are doy 291 23 at forest sites and doy 298 18 at grassland sites fig 6b the simulated mean freeze days from the original and improved beps model are doy 265 15 and doy 282 19 respectively at forest sites and they are doy 283 22 and doy 299 21 respectively at grassland sites fig 6b the results from the improved beps model are closer to the observations compared to those from the original beps model through the conventional double tailed t tests the differences of freeze days between forest and grassland sites are not statistically significant at p 0 1 based on the observation and the simulated results of the improved beps model fig 6b 4 discussion 4 1 the impacts of different improvement schemes on the simulations of soil temperature the gaussian kernel density estimation kde of the differences between the simulated soil temperatures from the experimental model runs and the observations of the five studied sites was conducted to compare the contribution of the four modifications of beps model in simulating soil temperature considering the impacts of canopy and wind speed on the snowpack density reduces the mae of simulated soil temperature from 3 23 to 2 90 c fig 7 the incorporation of puddled water into the simulation of soil thermal dynamics reduces the mae of simulated soil temperature from 3 23 to 2 54 c fig 7 the incorporation of soil organic matter into the calculations of soil thermal hydraulic parameters reduces the mae of simulated soil temperature from 3 23 to 3 04 c fig 7 the inclusion of unfrozen water in frozen soils did not change mae of simulated soil temperature significantly fig 7 totally the integrated improvements to the beps model reduce the mae of simulated soil temperature from 3 23 to 2 29 c fig 7 the simulations of soil temperature from the improved beps model perform much better than those of the original beps model due to more careful treatments of the impacts of a thermal buffer zone i e snowpack puddled water and som on subsurface heat transfer snow is an insulator and is a leading factor in preventing the ground from heat loss in winter especially at the high latitudes where stable snow cover lasts from a few weeks to several months zhang 2005 as an aquitard the frozen soil layer drastically weakens hydraulic connectivity and downward water infiltration and benefits the existence of puddled water jin et al 2020 the puddled water layers act as a buffer that modulates the heat exchange between the overlying air and the underlying soil layer som would also modulate the transfer of heat between soil and atmosphere typically leading to a smaller daily difference in soil temperature lawrence and slater 2008 thus it is essential to incorporate a realistic buffer zone between the atmospheric forcing and soil thermal processes ju et al 2006 kim et al 2016 tao et al 2017 4 2 vegetation types affected diurnal soil ft cycles and seasonal soil ft timing different vegetation types have distinct community structures and consequently differ in litter cover snow accumulation patterns and canopy interception of solar radiation guo et al 2018 wang et al 2002 plant litter is a major source of near surface som and the accumulation of litter was affected by plant species novara et al 2015 compared to grassland the forest usually has more aboveground biomass thicker litter layer and more som supplementary materials fig s7 thus litter insulation is higher in forest sites producing a lower amplitude of diurnal soil ft cycles compared to grassland sites fig 8 it has been recognized that snow accumulation differs substantially between forested and grassland because of the difference in canopy interception of snow snow sublimation and wind redistribution chang et al 2015 foster et al 2019 the mean snow depth is positively correlated with the thaw day fig 9 b because the depth dependent snowpack insulation could regulate the thermal transmission between the atmosphere and the soil and consequently slow down soil thawing also the soc content is positively correlated with the thaw day fig 9d because som also buffers soil thermal transmission and more soil surface soc would slow down soil thawing during the thawing period forest sites have thicker snow depth and more soil surface soc than grassland sites and these are the reasons why the thaw days of forest sites are later than those of grassland sites fig 9 5 conclusions in this study the beps model has been improved through more careful treatments of the impacts of thermal buffer zone i e snowpack puddled water and som on subsurface heat transfer the different patterns of soil surface ft processes between forest and grassland and the regulation of vegetation to soil ft processes were analyzed based on the measured soil temperature data and those simulated by the beps model the major conclusions are drawn as follows 1 compared to the original beps model the improved beps model has smaller rmses higher r2 and slopes closer to one and performs better in simulating soil temperate in all four seasons 2 the simulated diurnal soil ft cycles and seasonal soil ft timing from the improved beps model are closer to the observations compared to those from the original beps model 3 forest sites have smaller amplitudes of diurnal soil ft cycles and delayed timing of soil thaw compared to grassland sites credit zhenhai liu conceptualization software writing original draft preparation bin chen conceptualization methodology writing review and editing shaoqiang wang writing review and editing supervision project administration qinyi wang validation data curation jinghua chen software weibo shi software xiaobo wang software yuanyuan liu visualization yongkai tu visualization mei huang supervision junbang wang supervision zhaosheng wang supervision hui li data curation tongtong zhu data curation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors sincerely appreciate prof jingming chen for sharing the codes of the beps model this study used eddy covariance data acquired and shared by chinaflux asiaflux and fluxnet the globmap v2 lai datasets and soilgrids dataset are provided by yang liu and tomislav hengl we greatly offer our profound appreciation to all the providers of the freely available data this research was supported by the science and technology strategic pilot of the chinese academy of sciences xda20030203 supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j ecolmodel 2021 109663 appendix c supplementary materials image application 1 appendix a thermal dynamics of the soil profile in the original beps model the soil volumetric heat capacity c s l is equal to the sum of the specific heat capacities of the soil constituents water ice soil minerals and organic matter multiplied by their respective volumetric fraction a1 c s l 2 0 10 3 ρ s l 2 65 c w 1 f i c e l c i c e f i c e l θ w l c s s o c f s o c l where ρ s l g cm 3 is the soil bulk density of layer l c w 4 2 103 j kg 1 k 1 c i c e 2 09 103 j kg 1 k 1 c s s o c 2 5 103 j kg 1 k 1 are the specific heat of water ice and soil organic matter respectively θ w l is the soil moisture in the l th soil layer f i c e l and f s o c l are the volume fractions of ice and organic matter in soil layer l respectively 2 65 g cm 3 is the typical soil particle density of mineral soils 2 0 103 j kg 1 k 1 is the specific heat of mineral soils the net energy flux at the ground surface under canopy and snow g 0 is assumed to be transmitted into soil layers as the boundary condition a2 0 g 0 r n g h g λ e g a3 c s l δ t s l δ t g l 1 l g l l 1 z l s s l l 1 2 3 n 1 a4 g l 1 l g 0 1 g 0 l 1 a5 g l 1 l 0 5 k t l 1 0 5 k t l t s l 1 t s l 0 5 z l 1 0 5 z l l 2 3 4 n where r n g w m 2 is the net absorbed radiation by a canopy h g w m 2 is the sensible heat flux from the ground to the canopy and through it λ j kg 1 is the latent heat of vaporization e g kg m 2 s 1 is the evaporation from the ground surface g l 1 l w m 2 is the conductive heat fluxes between soil layers l 1 and l the snowpack is modeled as a part of the profile for heat conduction below the reference plane of surface temperature the same equation for heat dynamics in the soil profile is used in the snowpack thermal module the amount of snow is the balance of snowfall and snowmelt which is estimated based on the available energy the thickness of the snowpack is updated every time step based on the amount of snow water equivalent and its density profile when the thickness of the snowpack covering the ground is less than 2 cm the snowpack and ground surface is considered as one layer when the thickness is more than 2 cm but less than 5 cm the snowpack as an independent layer on the ground is proportionally distributed with bare ground when the thickness is greater than 5 cm the snowpack is regarded as three layers 0 2 cm 2 5 cm and 5 cm appendix b description of improved parameterizations b1 soil organic matter the parameterization of soil thermal conductivity is based upon the weighting factor w of different components to calculate the λ the w is given as tian et al 2016 b1 w s l 1 3 2 1 0 125 λ s l λ l i q l 1 1 1 0 75 λ s l λ l i q l 1 b2 w a l 1 3 2 1 g a λ a λ l i q l 1 1 1 1 2 g a λ a λ l i q l 1 where g a represents a unitless empirical air pore shape factor b3 g a 0 333 1 θ a l θ s a t l the shape of ice crystal in soil pores develop similarly to those of air voids therefore g for ice is given by the following equation b4 g ice 0 333 1 θ i c e l θ s a t l the thermal conductivity of air 0 025 w m 1 k 1 the heat capacity c s l of a soil layer l is calculated through updated formula as lawrence and slater 2008 b5 c s l c s l 1 θ s a t l c w 1 f i c e c i c e f i c e θ l w c a i r θ s a t l θ w l b6 c s l c s m i n l 1 f s o c l c s s o c f s o c l where c a i r 1 0 103 j kg 1 k 1 is the specific heat of air in soil layers de vries 1963 c s m i n l is the specific heat of mineral soil and is computed as the percent of sand and clay for soil layer l the soil organic carbon fraction f s o c l for a particular soil layer as f s o c l ρ s o c l ρ s o c m a x the ρ s o c l is the soil carbon density for soil layer l and ρ s o c m a x 130 kg m 3 is the maximum soil carbon density equivalent to a standard bulk density of peat farouki 1981 the specific heat capacity of soil layer l is the weighted sum of the specific heat of soil solid and water b2 unfrozen water content in frozen soil the upper limit of the liquid water content for subfreezing temperature is calculated by eq 7 based on θ l i q m a x the content of liquid water in frozen soils for the next time step n 1 is calculated as follows b7 θ l i q n 1 min θ l i q m a x θ n where θ n θ l i q θ i c e is the total volumetric soil moisture at time step n θ i c e is the ice content the θ i c e for the next time step is defined as b8 θ i c e n 1 min θ i c e n r f m δ t θ n where δ t is the time step r f m is the conservation of the partial volume of ice b9 θ i c e t r f m and r f m is defined as b10 r f m h f m ρ i c e l f δ z where ρ i c e 917 kg m 3 is the density of ice h f m in the unit of w m 2 is assessed from the energy excess or deficit needed to change soil temperature to the freezing point t f r z and it is calculated as b11 h f m c s δ z t f r z t n 1 δ t where t n 1 is the soil layer temperature resulting from all the other processes except for phase changes the soil hydraulic conductivity k m s 1 can be calculated via the clapp and hornberger 1978 equation as b12 k f i c e k s a t θ l i q θ s a t 2 b 3 where k s a t is the soil hydraulic conductivity at saturation f i c e is the fraction of ice to soil pore volume and it is calculated as b13 f i c e 1 m i n 1 θ i c e θ s a t 2 
24581,the primary prey of humpback whales in the southwestern gulf of maine is sand lance despite this established relationship we lack models to further understand the influence of sand lance on humpback whales or to predict humpback abundance or distribution in response to climate related changes in sand lance abundance or distribution we used a subset of long term standardized survey data 2013 2019 from stellwagen bank national marine sanctuary and a bayesian hierarchical modeling approach to explore the influence of sand lance on humpback whales at multiple spatial and temporal scales while accounting for sampling variability and propagating uncertainty we developed zero inflated poisson mixed effects models for both sand lance and humpbacks using modelled sand lance abundance as a predictor in the whale model results showed a statistically clear positive correlation between sand lance and humpback whales regional mean abundances of both species increased from north to south though site level variation within regions showed more variability results suggest annual variation in abundance of both species with potentially different influences we demonstrate one management application of our method by examining entanglement risk for humpback whales whale aggregations were more likely to occur in a high density area of fixed fishing gear that overlaps with an area of higher sand lance abundance our work suggests that humpback whale distribution in the larger gulf of maine may be impacted by climate related fluctuations in sand lance abundance predicting future distributions of humpback whales is important for ecosystem based management including mitigation of human impacts and our work serves as a foundation for further model development keywords forage fish predator prey gulf of maine bayesian stellwagen bank habitat use spatial overlap 1 introduction in the southwestern gulf of maine gom the preferred prey of humpback whales megaptera novaeangliae is sand lance ammodytes spp shifts in the abundance and distribution of humpbacks into and out of the southwestern gom have been linked with fluctuations in the abundance of sand lance during several time periods since the late 1970s steady increases in humpback whale densities from 1978 to 1982 correlated with increased sand lance densities payne et al 1986 fluctuations in humpback whale abundance followed fluctuations in sand lance abundance from 1982 to 1988 payne et al 1990 and a decline in humpback whale abundance on stellwagen bank from 1988 to 1994 was concurrent with a decline in presumed sand lance density and an increase in humpback abundance on nearby jeffrey s ledge where humpbacks feed predominately on herring weinrich et al 1997 while the link between humpbacks and sand lance in the southwestern gom is clear current evidence is limited to linear correlations we lack statistical models to further understand the strength of this relationship over time and space or to predict changes in the abundance and distribution of either species in response to climate change here we aimed to advance our understanding of the sand lance humpback relationship by using a bayesian hierarchical modeling approach to account for spatial and temporal variability uncertainty in the association of humpback abundance with latent abundance of sand lance and the observation process we fit zero inflated poisson mixed effects models to a subset of a unique long term dataset of humpback whale and sand lance counts from seasonal standardized surveys in stellwagen bank national marine sanctuary a federal marine protected area in the southwestern gom the sanctuary is a critical foraging area for humpbacks and in some years hosts the highest sand lance densities in the gom richardson et al 2014 providing an ideal location to further explore the relationship between these species and to work toward building a predictive modeling framework 2 methods 2 1 data collection field work was described in silva et al 2020 briefly 13 seasonal surveys for sand lance and humpback whales were conducted from 2013 2019 fall september november n 5 spring april june n 6 summer july n 2 in stellwagen bank national marine sanctuary the survey included 44 sites 1 km apart in most areas in 3 blocks north central south across stellwagen bank designed to sample all potential sand lance habitat fig 1 a sand lance are a benthopelagic species that spend time both in the water column and in the sediment robbards 2000 we sampled sand lance in the sediment using the u s geological survey seabed observation and sampling system seaboss blackwood and parolski 2001 equipped with a modified van veen benthic grab sampler 0 1m2 at each site the seaboss was deployed to the sea floor to sample sediment and the number of sand lance in each sample was recorded we assumed the number of sand lance recorded in each grab sample was representative of the total number of sand lance at each site water column sediment during each seaboss deployment trained observers typically 1 on either side of the vessel recorded the number of humpback whales in an 800 m radius around the vessel for 10 min we chose the sampling distance and observation period based on our ability to reliably identify species and to limit the possibility of double counting individuals based on typical humpback dive durations of 5 min wiley unpublished data distances were estimated using a hand held fixed interval range finder calibrated using laser range finders and a buoy at known distance in relation to the horizon heinemann 1981 some cruises resulted in no observations of sand lance or whales or very small total species counts two individuals we excluded these data from analysis we also excluded summer data since there were only two cruises here we used data from five cruises n 164 with sampling effort spread over four years and fairly equally across seasons and sites table 1 table s1 2 2 modeling 2 2 1 model structure count data for sand lance and humpback whales contained mostly zeroes fig 1b c and preliminary models using poisson and negative binomial distributions fit poorly we implemented a zero inflated poisson mixed effects model using a bayesian hierarchical framework several aspects of our study make it well suited for this approach first our study design includes simple categorical covariates that are nested within several spatial and temporal scales inviting a hierarchical structure as well as random effects hobbs and hooten 2015 second this framework allows us to incorporate sampling variability which we believe is important given our data collection method pavanato et al 2017 third we can propagate uncertainty throughout prey and predator models lastly bayesian methods allow for inference using true probability statements which better represent ecological data and are more useful for managers making decisions wade 2000 2 2 2 sand lance sub model we modeled sand lance counts s l i j k at site i in block j in year k using a zero inflated mixture model s l i j k 0 p o i s s o n λ i j k s l i f z i j k s l 0 i f z i j k s l 1 where λ i j k s l is the mean number of sand lance per sediment sample at site i in block j in year k z i j k s l is a random variable describing seasonal zero inflation in sand lance availability z i j k s l b e r n o u l l i φ m i j k s l φ m i j k s l u 0 1 where φ m i j k s l is the probability of success sand lance captured for season m and 1 φ m i j k s l is the probability of zero inflation sand lance in stellwagen bank national marine sanctuary exhibit seasonal differences in behavior in fall sand lance spend more time on or in the sediment in estivation prior to spawning suca et al 2021 we hypothesized that these seasonal differences in bottom time would influence the chance of sand lance capture in sediment grabs if z 0 the mean number of sand lance equaled zero if z 1 the number of sand lance in the count was distributed as a poisson random variable with mean λ i j k s l fig 2 we described λ i j k s l as a log linear function of block site and year ln λ i j k s l β j b β i s β k y β j b n 0 10 β i s n 0 σ s l 2 β k y n 0 τ s l 2 1 σ s l 2 g a m m a 0 01 0 01 1 τ s l 2 g a m m a 0 01 0 02 data exploration suggested that sand lance counts differed substantially by block fig 1b c our model structure assumed that each block had an overall mean number of sand lance with site and annual specific effects site and year were treated as random effects to capture spatial and temporal variation in expected sand lance counts we had no existing knowledge to inform choice of priors therefore we used vague priors on all parameters for site and year level variance we used the conjugate gamma prior on the precision of normal distributions after initial model runs we chose to increase the precision decrease variance for 1 τ s l 2 to 0 02 in order to decrease initial autocorrelation in mcmc chains 2 2 3 humpback whale sub model the humpback whale sub model was similar to the sand lance model we modeled humpback whale counts w i j k at site i in year k using a zero inflated mixture model w i j k 0 p o i s s o n λ i j k w i f z i j k w 0 i f z i j k w 1 where z i j k w is a random variable describing if whales were observed z 1 or not z 0 and λ i j k w is the mean number of whales at site i in year k fig 2 we used a bernoulli distribution with a uniform prior for z z i j k w b e r n o u l l i φ m i j k w φ m i j k w u 0 1 where φ m i j k w in season m represents the probability of success whales observed and 1 φ m i j k w is the probability of zero inflation the annual migratory cycle of humpback whales consists of arrival on higher latitude feeding grounds including the sanctuary in spring and departure from feeding grounds to lower latitude breeding grounds in fall clapham et al 1993 we hypothesized that whale presence in sbnms and therefore sampling variability may be influenced by their migratory cycle if z 1 the number of whales was distributed as a poisson random variable with a mean λ i j k w if z 0 the number of whales equaled zero based on the established correlations between sand lance and humpbacks payne et al 1986 payne et al 1990 we hypothesized that humpback whale counts were correlated with sand lance abundance and included expected sand lance abundance as a covariate in the humpback model we described λ i j k w for each data point as a log linear function of expected sand lance abundance site and year fig 2 ln λ i j k w α s l ln λ i j k s l θ i s θ k y where α s l n 0 10 θ i s n 0 σ w 2 θ k y n 0 τ w 2 1 σ w 2 g a m m a 0 01 0 01 1 τ w 2 g a m m a 0 01 0 02 since we assumed humpback counts were correlated with sand lance counts and the mean number of sand lance was assumed to vary by block we did not include block as a covariate in the whale model we included site and year as random effects to capture spatial and temporal variation in whale counts that may not be attributable to sand lance we had no existing knowledge to inform choice of priors therefore we used vague priors on all parameters as in the sand lance sub model 2 3 model fitting and analysis models were implemented using markov chain monte carlo mcmc algorithms in jags just another gibbs sampler plummer 2003 called from r using the package rjags plummer 2011 we ran four chains with 1 million iterations a burn in of 50 000 adaptation period of 50 000 and a thinning parameter of 1 1000 to account for high autocorrelation in the chains the total sample size consisted of 3800 draws 4 chains 1 million iterations 50 000 burn in 1000 we assessed convergence by inspecting trace plots to ensure well mixed chains hobbs and hooten 2015 and calculating gelman rubin statistics rhat gelman and rubin 1992 for all parameters using the mcmcvis package youngflesh 2018 rhat values close to 1 indicate convergence with values less than 1 2 acceptable gelman 1996 zuur et al 2012 we assessed model fit using posterior predictive checks which evaluate the ability of a model to generate new observations that resemble our observed data we simulated new data for sand lance and whale counts based on the posterior predictive distributions for the mean number of sand lance and whales we defined the mean variance and proportion of zeroes in our simulated datasets as test statistics goodness of fit was evaluated using bayesian p values pb the probability that the test statistic calculated from our simulated data is more extreme than the test statistic calculated from observed data very large or very small pb 0 1 or 0 9 indicate poor model fit we conducted posterior predictive checks for each species and also summarized results by block season and year 2 4 applications we used model results to examine two applications that could have potential management implications locating sand lance hot spots and exploring entanglement risk to humpback whales we used posterior probability distributions for the site parameter to find the probability that a site had a greater than block average number of sand lance to explore entanglement risk we estimated the probability of a whale aggregation at each site and examined overlap between sites and fixed fishing gear locations to estimate site probabilities of whale aggregations we used the new counts of whales generated for posterior predictive checks and found the proportion of those values that were greater than our arbitrarily chosen aggregation size n 5 we explored potential overlap between whale aggregations and fixed fishing gear by creating a density map of trap pot gear locations from 2014 to 2016 from vessel trip report vtr data noaa fisheries using the spatstat package baddeley et al 2015 3 results 3 1 sand lance sub model trace plots and gelman rubin statistics confirmed convergence of most parameters twelve λ i j k s l values had rhat values between 1 2 and 1 3 these values correspond to sites that never had sand lance observations suggesting the model could not separate true vs false zeroes for these data points two z i j k s l values also had rhat 1 2 1 3 for all fixed effects and variance components rhat values were 1 1 and effective sample sizes n eff were 3200 overall posterior predictive checks for the mean variance and proportion of zeroes for sand lance showed no evidence of lack of fit bayesian p values mean 0 53 variance 0 73 proportion of zeroes 0 79 fig s2 posterior predictive checks summarized by block bayesian p value range 0 52 0 84 year bayesian p value range 0 38 0 90 and season bayesian p value range 0 50 0 82 also showed no obvious lack of fit figs s3 s5 predicted sand lance abundance varied by block and increased from north to south with median estimates of 0 07 sand lance block north 0 73 sand lance block central and 3 74 sand lance block south fig 3 a table 2 some annual differences in abundance were observed credible intervals overlapped in most years with the largest fluctuations in abundance occurring in the south median sand lance estimates for the south in most years 2014 2015 2016 was greater than average while median estimates for the central block were at or below average in these years highest abundances in all blocks occurred in 2016 abundance estimates for the north showed little to no difference by year with median annual estimates essentially the same as the near zero block average fig 3a in the south and central blocks median abundance estimates were below average in 2018 fig 3a parameter values suggested site level variation in sand lance abundance fig 4 a table 2 above average sand lance abundance was predicted for one northern site two central sites and one southern site fig 4a the 95 credible intervals of the marginal posterior for three additional sites one northern 2 southern were almost entirely above zero southern and central blocks had mixtures of sites with median estimates above and below average expected abundance while all but three northern median estimates were predicted to have below average abundance fig 4a which was not surprising given that sand lance were only observed at 2 sites in the northern block throughout the study period fig s1 the probability of sand lance availability was slightly greater in the fall median 0 42 95 ci 0 29 0 59 than the spring median 0 33 95 ci 0 17 0 56 table 2 though overlapping credible intervals suggest little difference between seasons 3 2 humpback whale sub model trace plots and gelman rubin statistics confirmed convergence of most parameters one λ i j k w value and seven z i j k w values had rhat values between 1 2 and 1 3 for all fixed effects and variance components rhat values were 1 1 and effective sample sizes n eff were 3200 overall posterior predictive checks for the mean variance and proportion of zeroes for humpbacks showed no evidence of lack of fit bayesian p values mean 0 51 variance 0 78 proportion of zeroes 0 71 fig s2 posterior predictive checks summarized by block bayesian p value range 0 27 0 86 year bayesian p value range 0 31 0 90 and season bayesian p value range 0 48 0 91 also showed no obvious lack of fit figs s3 s5 humpback whales showed a statistically clear positive correlation with sand lance median 0 35 95 credible interval 0 05 0 70 fig 4c table 2 using this relationship estimated humpback abundance also increased from north to south with highest expected abundances in every year occurring in the south fig 4b some annual differences in humpback abundance were observed but year to year variation differed from sand lance median values for predicted humpback abundance in all sites alternated from below average in 2014 and 2016 to at or above average in 2015 and 2018 respectively fig 4b the posteriors for the parameter values suggested site level variation in humpback abundance fig 4b above average humpback abundance was predicted for two central sites and three southern site fig 4b the range of 95 credible intervals for three additional sites one central two southern were almost entirely above zero no northern sites showed clear differences in humpback abundance though median and 50 bayesian credible intervals were above average for two northern sites southern and central blocks had mixtures of sites with median estimates above and below average fig 4b only one site c6 showed clear above average estimates for both humpbacks and sand lance fig 4a b the probability of humpback availability was slightly greater in the fall median 0 53 95 credible interval 0 36 0 71 than the spring median 0 47 95 credible interval 0 3 0 66 table 2 though overlapping credible intervals suggests little difference between seasons the median probability of observing whales was greater than the probability of observing sand lance in both seasons table 2 3 3 applications sites that were likely to have greater than average sand lance abundance or sand lance hot spots were identified in all blocks fig 5 the probability that a site had greater than block average sand lance abundance was 0 75 for two northern sites four central sites and five southern sites fig 5 probabilities of at least 5 whales at a site ranged from 0 0 34 with whale aggregations being most likely in the southern block at site s11 fig 6 the three s10 s11 s14 sites with the highest probabilities of whale aggregations overlapped with a high density area of trap pot gear on the sw corner of stellwagen bank the probability of 3 whales at sites was greater with sites s11 and s14 having probabilities of whale aggregations 0 5 4 discussion 4 1 ecology we demonstrated a statistically clear positive correlation between sand lance and humpback whales supporting findings from previous work and confirming persistence of this relationship over time payne et al 1986 payne et al 1990 weinrich et al 1998 while prior studies linked shifts in humpback distributions with fluctuations in sand lance abundance at broad scales across large feeding areas we showed relationships at an intermediate block scale within a single feeding area this result is consistent with silva et al 2020 that applied spatial metrics to the same dataset and found high spatial collocation between humpbacks and sand lance in southern stellwagen bank the clear relationship between humpbacks and sand lance suggests that relative effects of sites and year would vary similarly for both species but this was not the case only one site c6 had a positive effect on both sand lance and humpback abundance differences in site effects for sand lance and humpbacks are likely due to a combination of scale mismatch and habitat selection by sand lance correlations between predators and prey are often scale dependent rose and legget 1990 fauchald et al 2000 our site level observations of sand lance and humpbacks are collected at very different spatial scales 0 1 m2 for sand lance and an 800 m radius for humpbacks further sand lance benthic distributions are highly patchy ranging from 0 to 44 fish in a single grab sample table s1 humpback counts within 800 m are likely not reflective of sand lance counts in 0 1 m2 which may be further complicated by the patchy benthic distribution of sand lance while benthic habitat selection by sand lance is likely based on preferred sediment grain size coarse grain sand and sufficient oxygen flow meyer et al 1979 robards 2000 the average patch size of sand lance on the bottom is unknown identifying correlations between predators and prey at the scale of prey patches would likely require observations at the scale of an individual humpback whale redfern et al 2006 hazen et al 2009 and kirchner et al 2018 associated humpback foraging with individual pelagic sand lance schools using data from 3d motion sensor tags on individual whales and prey data from echosounders alternatively conducting multiple sand lance grabs at a site within an 800 m radius may show better agreement between site effects for sand lance and humpbacks the complex behavior of sand lance could also contribute to differences in site parameter estimates we assumed that the number of sand lance in each grab sample reflects the relative total number of fish at a site water column sediment which may not be true sand lance are generally thought to spend daytime periods feeding in the water column and to return to the bottom at night during periods of low light during estivation and or in response to predators robards 2000 while our findings of sand lance in the sediment during the day provide evidence that diel behavior of sand lance is actually more complex it is likely that pelagic sand lance abundance is greater than benthic sand lance abundance during the day this may lead to observations of whales at a site but not of sand lance even though sand lance may be present in the water column sampling pelagic sand lance abundance may improve correlations at the site level nevertheless the site level variation in abundance of humpbacks and sand lance shown here suggest that scale considerations in future modeling or management actions could be important differences in year effects between species could reflect challenges with sampling but may also suggest true differences driven by different environmental factors our sampling is conducted once per season in any year capturing a small snapshot of animal abundance counts used here and resulting parameter estimates may not be representative of actual annual trends in abundance for example opportunistic sightings data collected from whale watching and research cruises in the sanctuary during this time period show that humpback whale abundance was relatively high in 2016 robbins unpublished data concurrent with the highest sand lance abundance in our study it is possible that whales were not present at the time of our survey or that they were present but were outside our 800 m observation radius however different year effects between species could also reflect true differences in animal abundance predicted sand lance abundance was lowest in 2018 when predicted humpback abundance was highest it is possible that humpbacks were targeting other prey during this time humpbacks in the gom also eat herring and mackerel hain et al 1982 geraci et al 1989 without direct observations of surface feeding it is not possible to determine what whales were targeting as prey or if they were foraging at all during our surveys more frequent surveys or sampling for additional forage fish species may better explain yearly differences we clarify here that because site and year were treated as random effects it is a common approach to interpret differences between sites and years using only the magnitude of their variance components and not the individual random effects however it is also common for the values for the random effects themselves to be of interest and our estimation approach allows us to quantify the uncertainty associated with their estimates via their credibility intervals however because the block specific means vary the relative effect of the same magnitude site effect on the sand lance and whale densities will vary by block we also fit a model with block specific variances for site effects this had minimal influence on the results but did lead to decreased precision in site parameter estimates particularly for n sites where few sand lance and whales were observed we emphasize that the site comparisons we do make particularly in the identification of sand lance hot spots in the application below are relative to block specific mean abundances and are only relevant within their respective blocks not across blocks we also note that based on the current model and our approach to use random site effect values to identify hot spots there is little reason to believe that these same sites will persist as hot spots in the future 4 2 modelling our model performed well in predicting the overall mean counts of whales and sand lance from our dataset but tended to underestimate both the proportion of zeroes and the variance in counts for each species posterior predictive checks figs s2 s5 the underestimate of variance may be due to underestimation of zeroes this may be partially driven by fewer observations in the north or some northern sites with no sand lance observations leading to an overestimate of the mean in the northern block while underestimating the variance and proportion of zeroes a preliminary zero inflated negative binomial model performed slightly better in estimating the proportion of zeroes and variance for both sand lance and humpbacks bayesian p value range 0 35 0 54 but performed slightly poorer in estimation of mean abundance bayesian p values 0 43 0 45 results from the zero inflated negative binomial were similar to those presented here and given a marginally better performance we chose to present the simpler zero inflated poisson model we attempted to account for zero inflation due to seasonal sampling variability by including season as a covariate in the zero inflation portion of the model successful observation whale presence of whales and capture of sand lance was more likely in the fall though overlapping credible intervals and the tendency of the model to underestimate zero inflation suggests that additional factors may influence zero inflation 4 3 further model developments and extensions the current model structure is specific to stellwagen bank national marine sanctuary our survey design and sampling method is neither directly applicable to other geographic areas or methodologies nor suited for future prediction or forecasting however the current model demonstrates value in using simple geographic covariates to gain understanding of species distributions and the utility of a bayesian hierarchical framework for representing ecological relationships model results here provide insight into variation in abundance and distribution over several spatial and temporal scales that can inform selection of environmental covariates to further model development we first discuss potential ways to extend the model for sbnms based on our results and then briefly mention additional factors known to influence sand lance and humpback abundance on broader scales that should be considered for model expansion to larger new geographic areas while we demonstrate a clear relationship between humpbacks and sand lance in the sanctuary data on the availability of alternative prey sources is necessary to fully understand variation in humpback abundance and distribution and the threshold abundance of various prey species that influence humpback movements into and out of areas there may years where sand lance abundance is low such as 2018 here but alternative prey is able to support a small number of humpbacks the site level variation in sand lance abundance seen here is likely partially driven by preferred sediment grain sizes the usgs has produced extensive fine scale sediment data for sbnms valentine 2019 our survey sampled multiple sand types very coarse to medium sand but grain size data suggest that fewer northern sites are classified as coarse grain sand 0 5 1 mm the preferred sediment size of sand lance which may contribute to decreased benthic sand lance abundance in the northern block robards et al 2000 grain size should be incorporated into future models given the seasonal behavioral changes exhibited by sand lance grain size may be more important for sand lance in the fall as they spend more time in the sediment suggesting a need for an interaction between season and grain size further the distribution of sand lance likely reflects a balance between suitable benthic habitat and prey availability van der kooij et al 2008 copepods primarily of the genus calanus primarily compose sand lance diets where they have been studied meyers et al 1979 danielsen et al 2016 staudinger et al 2020 suca et al 2021 on stellwagen bank calanus finmarchichus was primary prey of sand lance during most months when feeding occurs suca et al 2021 sand lance abundance across the northeast shelf was also correlated with lagged calanus finmarchicus abundance suca et al 2021 including calanus abundance in future models may help explain both site level and block level variation in sand lance abundance year to year and block level variation in sand lance abundance suggests that additional dynamic environmental covariates should be included in future models one potential factor is the strength of the western maine coastal current a current driven by fresh water runoff and local wind forcing that flows southwestward around the gulf of maine with peak inputs during the spring bigelow 1927 geyer et al 1992 the western maine coastal current is an important source of calanus to massachusetts bay and inter annual variability in transport combined with local wind forcing can impact both primary productivity and zooplankton abundance jiang et al 2007 mcmanus et al 2014 suca et al 2021 metrics related to the strength of the western maine coastal current may help explain changes in sand lance abundance in addition to prey abundance hydrology and predation influence sand lance abundance on broad scales suca et al 2021 in the northwest atlantic sand lance abundance oscillates out of phase with the abundance of herring and mackerel which are known to prey on larval sand lance staudinger et al 2020 suca et al 2021 lagged herring abundance and the proportion of warm slope water were linked to declines in sand lance abundance suca et al 2021 other studies have found correlations between sand lance and oceanographic variables such as bottom temperature and salinity van der kooij et al 2008 model adaptation for areas larger should consider these variables one limitation to further study of sand lance abundance in general is lack of data sand lance data collected in the gulf of maine are sparse richardson et al 2014 and to our knowledge no data exists at a scale as fine as our survey given the importance of sand lance to humpbacks as well as commercial fishes and seabirds staudinger et al 2020 collecting additional sand lance data throughout the gulf of maine should be a priority particularly given the push towards ecosystem based management koehn et al 2020 4 4 application we applied our results to examine overlap between humpback whale aggregations and fixed gear to demonstrate one potential management application over 75 of gom humpbacks show scarring consistent with entanglement robbins 2012 and entanglement remains a serious threat including within the sanctuary u s department of commerce 2010 we show that sites more likely to have whale aggregations overlap with an area of high density trap pot gear on southern stellwagen bank wiley et al 2003 used standardized survey data to show that whales had the highest risk of interaction with fixed fishing gear in the same location southern stellwagen bank our results show that the location of highest entanglement risk for humpbacks has remained consistent for almost two decades but also provides tangible probabilities that whale aggregations are present in areas of high risk further our hierarchical model structure shows two potential spatial scales for management options regional block and small scale 1 km based on a clear relationship between humpbacks and sand lance and identification of both sand lance hotspots where whales could be and whale aggregation sites 5 conclusion we fit a bayesian hierarchical model to a unique dataset to advance our understanding of the sand lance humpback whale relationship in the southwestern gulf of maine our work explored this predator prey relationship with a novel approach extending our knowledge past simple correlations and providing new insight into the abundance and distribution of sand lance and humpbacks over multiple spatial and temporal scales that can inform further model developments models to predict both sand lance and humpback abundance in sbnms and beyond will become crucial for understanding potential changes to predator prey dynamics and ecosystem structure due to climate change sand lance appear especially vulnerable to increasing temperatures and ocean acidification hare et al 2016 murray et al 2019 suca et al 2021 declines in sand lance abundance and serious changes to the ne us forage fish complex are predicted under current carbon emissions suca et al 2021 climate induced shifts in the abundance and distribution of sand lance will likely lead to shifts in the abundance and distribution of humpbacks understanding how humpback whales will respond to fluctuations in forage fish abundance is critical for predicting and mitigating human impacts like those from entanglement 6 data accessibility statement all data and code are available on github https github com tammylsilva sand lance humpback bayesian model authors contributions field research design funding acquisition dw data collection dw ts model conceptualization analysis ts gf writing original draft ts writing review editing ts dw gf declaration of competing interest the authors have no conflicts of interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we thank p valentine and d blackwood for their invaluable contributions to this work including time expertise and equipment thanks to michael thompson peter hong and justin suca for their instrumental efforts with field work and logistics we are grateful to captains d slocum a meloski and the r v auk crew for their efforts on this project we thank the many sbnms volunteers and observers who helped collect these data thanks to les kaufman joel llopiz and hannes baumann for their support and involvement this work was supported by the bureau of ocean energy management ia agreement m17pg0019 noaa stellwagen bank national marine sanctuary u s geological survey and the volgenau foundation we thank two anonymous reviewers for their thoughtful comments that greatly improved this manuscript the scientific results and conclusions as well as any views or opinions expressed herein are those of the authors and do not necessarily reflect the views of the office of national marine sanctuaries noaa or the department of commerce supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j ecolmodel 2021 109662 appendix supplementary materials image application 1 
24581,the primary prey of humpback whales in the southwestern gulf of maine is sand lance despite this established relationship we lack models to further understand the influence of sand lance on humpback whales or to predict humpback abundance or distribution in response to climate related changes in sand lance abundance or distribution we used a subset of long term standardized survey data 2013 2019 from stellwagen bank national marine sanctuary and a bayesian hierarchical modeling approach to explore the influence of sand lance on humpback whales at multiple spatial and temporal scales while accounting for sampling variability and propagating uncertainty we developed zero inflated poisson mixed effects models for both sand lance and humpbacks using modelled sand lance abundance as a predictor in the whale model results showed a statistically clear positive correlation between sand lance and humpback whales regional mean abundances of both species increased from north to south though site level variation within regions showed more variability results suggest annual variation in abundance of both species with potentially different influences we demonstrate one management application of our method by examining entanglement risk for humpback whales whale aggregations were more likely to occur in a high density area of fixed fishing gear that overlaps with an area of higher sand lance abundance our work suggests that humpback whale distribution in the larger gulf of maine may be impacted by climate related fluctuations in sand lance abundance predicting future distributions of humpback whales is important for ecosystem based management including mitigation of human impacts and our work serves as a foundation for further model development keywords forage fish predator prey gulf of maine bayesian stellwagen bank habitat use spatial overlap 1 introduction in the southwestern gulf of maine gom the preferred prey of humpback whales megaptera novaeangliae is sand lance ammodytes spp shifts in the abundance and distribution of humpbacks into and out of the southwestern gom have been linked with fluctuations in the abundance of sand lance during several time periods since the late 1970s steady increases in humpback whale densities from 1978 to 1982 correlated with increased sand lance densities payne et al 1986 fluctuations in humpback whale abundance followed fluctuations in sand lance abundance from 1982 to 1988 payne et al 1990 and a decline in humpback whale abundance on stellwagen bank from 1988 to 1994 was concurrent with a decline in presumed sand lance density and an increase in humpback abundance on nearby jeffrey s ledge where humpbacks feed predominately on herring weinrich et al 1997 while the link between humpbacks and sand lance in the southwestern gom is clear current evidence is limited to linear correlations we lack statistical models to further understand the strength of this relationship over time and space or to predict changes in the abundance and distribution of either species in response to climate change here we aimed to advance our understanding of the sand lance humpback relationship by using a bayesian hierarchical modeling approach to account for spatial and temporal variability uncertainty in the association of humpback abundance with latent abundance of sand lance and the observation process we fit zero inflated poisson mixed effects models to a subset of a unique long term dataset of humpback whale and sand lance counts from seasonal standardized surveys in stellwagen bank national marine sanctuary a federal marine protected area in the southwestern gom the sanctuary is a critical foraging area for humpbacks and in some years hosts the highest sand lance densities in the gom richardson et al 2014 providing an ideal location to further explore the relationship between these species and to work toward building a predictive modeling framework 2 methods 2 1 data collection field work was described in silva et al 2020 briefly 13 seasonal surveys for sand lance and humpback whales were conducted from 2013 2019 fall september november n 5 spring april june n 6 summer july n 2 in stellwagen bank national marine sanctuary the survey included 44 sites 1 km apart in most areas in 3 blocks north central south across stellwagen bank designed to sample all potential sand lance habitat fig 1 a sand lance are a benthopelagic species that spend time both in the water column and in the sediment robbards 2000 we sampled sand lance in the sediment using the u s geological survey seabed observation and sampling system seaboss blackwood and parolski 2001 equipped with a modified van veen benthic grab sampler 0 1m2 at each site the seaboss was deployed to the sea floor to sample sediment and the number of sand lance in each sample was recorded we assumed the number of sand lance recorded in each grab sample was representative of the total number of sand lance at each site water column sediment during each seaboss deployment trained observers typically 1 on either side of the vessel recorded the number of humpback whales in an 800 m radius around the vessel for 10 min we chose the sampling distance and observation period based on our ability to reliably identify species and to limit the possibility of double counting individuals based on typical humpback dive durations of 5 min wiley unpublished data distances were estimated using a hand held fixed interval range finder calibrated using laser range finders and a buoy at known distance in relation to the horizon heinemann 1981 some cruises resulted in no observations of sand lance or whales or very small total species counts two individuals we excluded these data from analysis we also excluded summer data since there were only two cruises here we used data from five cruises n 164 with sampling effort spread over four years and fairly equally across seasons and sites table 1 table s1 2 2 modeling 2 2 1 model structure count data for sand lance and humpback whales contained mostly zeroes fig 1b c and preliminary models using poisson and negative binomial distributions fit poorly we implemented a zero inflated poisson mixed effects model using a bayesian hierarchical framework several aspects of our study make it well suited for this approach first our study design includes simple categorical covariates that are nested within several spatial and temporal scales inviting a hierarchical structure as well as random effects hobbs and hooten 2015 second this framework allows us to incorporate sampling variability which we believe is important given our data collection method pavanato et al 2017 third we can propagate uncertainty throughout prey and predator models lastly bayesian methods allow for inference using true probability statements which better represent ecological data and are more useful for managers making decisions wade 2000 2 2 2 sand lance sub model we modeled sand lance counts s l i j k at site i in block j in year k using a zero inflated mixture model s l i j k 0 p o i s s o n λ i j k s l i f z i j k s l 0 i f z i j k s l 1 where λ i j k s l is the mean number of sand lance per sediment sample at site i in block j in year k z i j k s l is a random variable describing seasonal zero inflation in sand lance availability z i j k s l b e r n o u l l i φ m i j k s l φ m i j k s l u 0 1 where φ m i j k s l is the probability of success sand lance captured for season m and 1 φ m i j k s l is the probability of zero inflation sand lance in stellwagen bank national marine sanctuary exhibit seasonal differences in behavior in fall sand lance spend more time on or in the sediment in estivation prior to spawning suca et al 2021 we hypothesized that these seasonal differences in bottom time would influence the chance of sand lance capture in sediment grabs if z 0 the mean number of sand lance equaled zero if z 1 the number of sand lance in the count was distributed as a poisson random variable with mean λ i j k s l fig 2 we described λ i j k s l as a log linear function of block site and year ln λ i j k s l β j b β i s β k y β j b n 0 10 β i s n 0 σ s l 2 β k y n 0 τ s l 2 1 σ s l 2 g a m m a 0 01 0 01 1 τ s l 2 g a m m a 0 01 0 02 data exploration suggested that sand lance counts differed substantially by block fig 1b c our model structure assumed that each block had an overall mean number of sand lance with site and annual specific effects site and year were treated as random effects to capture spatial and temporal variation in expected sand lance counts we had no existing knowledge to inform choice of priors therefore we used vague priors on all parameters for site and year level variance we used the conjugate gamma prior on the precision of normal distributions after initial model runs we chose to increase the precision decrease variance for 1 τ s l 2 to 0 02 in order to decrease initial autocorrelation in mcmc chains 2 2 3 humpback whale sub model the humpback whale sub model was similar to the sand lance model we modeled humpback whale counts w i j k at site i in year k using a zero inflated mixture model w i j k 0 p o i s s o n λ i j k w i f z i j k w 0 i f z i j k w 1 where z i j k w is a random variable describing if whales were observed z 1 or not z 0 and λ i j k w is the mean number of whales at site i in year k fig 2 we used a bernoulli distribution with a uniform prior for z z i j k w b e r n o u l l i φ m i j k w φ m i j k w u 0 1 where φ m i j k w in season m represents the probability of success whales observed and 1 φ m i j k w is the probability of zero inflation the annual migratory cycle of humpback whales consists of arrival on higher latitude feeding grounds including the sanctuary in spring and departure from feeding grounds to lower latitude breeding grounds in fall clapham et al 1993 we hypothesized that whale presence in sbnms and therefore sampling variability may be influenced by their migratory cycle if z 1 the number of whales was distributed as a poisson random variable with a mean λ i j k w if z 0 the number of whales equaled zero based on the established correlations between sand lance and humpbacks payne et al 1986 payne et al 1990 we hypothesized that humpback whale counts were correlated with sand lance abundance and included expected sand lance abundance as a covariate in the humpback model we described λ i j k w for each data point as a log linear function of expected sand lance abundance site and year fig 2 ln λ i j k w α s l ln λ i j k s l θ i s θ k y where α s l n 0 10 θ i s n 0 σ w 2 θ k y n 0 τ w 2 1 σ w 2 g a m m a 0 01 0 01 1 τ w 2 g a m m a 0 01 0 02 since we assumed humpback counts were correlated with sand lance counts and the mean number of sand lance was assumed to vary by block we did not include block as a covariate in the whale model we included site and year as random effects to capture spatial and temporal variation in whale counts that may not be attributable to sand lance we had no existing knowledge to inform choice of priors therefore we used vague priors on all parameters as in the sand lance sub model 2 3 model fitting and analysis models were implemented using markov chain monte carlo mcmc algorithms in jags just another gibbs sampler plummer 2003 called from r using the package rjags plummer 2011 we ran four chains with 1 million iterations a burn in of 50 000 adaptation period of 50 000 and a thinning parameter of 1 1000 to account for high autocorrelation in the chains the total sample size consisted of 3800 draws 4 chains 1 million iterations 50 000 burn in 1000 we assessed convergence by inspecting trace plots to ensure well mixed chains hobbs and hooten 2015 and calculating gelman rubin statistics rhat gelman and rubin 1992 for all parameters using the mcmcvis package youngflesh 2018 rhat values close to 1 indicate convergence with values less than 1 2 acceptable gelman 1996 zuur et al 2012 we assessed model fit using posterior predictive checks which evaluate the ability of a model to generate new observations that resemble our observed data we simulated new data for sand lance and whale counts based on the posterior predictive distributions for the mean number of sand lance and whales we defined the mean variance and proportion of zeroes in our simulated datasets as test statistics goodness of fit was evaluated using bayesian p values pb the probability that the test statistic calculated from our simulated data is more extreme than the test statistic calculated from observed data very large or very small pb 0 1 or 0 9 indicate poor model fit we conducted posterior predictive checks for each species and also summarized results by block season and year 2 4 applications we used model results to examine two applications that could have potential management implications locating sand lance hot spots and exploring entanglement risk to humpback whales we used posterior probability distributions for the site parameter to find the probability that a site had a greater than block average number of sand lance to explore entanglement risk we estimated the probability of a whale aggregation at each site and examined overlap between sites and fixed fishing gear locations to estimate site probabilities of whale aggregations we used the new counts of whales generated for posterior predictive checks and found the proportion of those values that were greater than our arbitrarily chosen aggregation size n 5 we explored potential overlap between whale aggregations and fixed fishing gear by creating a density map of trap pot gear locations from 2014 to 2016 from vessel trip report vtr data noaa fisheries using the spatstat package baddeley et al 2015 3 results 3 1 sand lance sub model trace plots and gelman rubin statistics confirmed convergence of most parameters twelve λ i j k s l values had rhat values between 1 2 and 1 3 these values correspond to sites that never had sand lance observations suggesting the model could not separate true vs false zeroes for these data points two z i j k s l values also had rhat 1 2 1 3 for all fixed effects and variance components rhat values were 1 1 and effective sample sizes n eff were 3200 overall posterior predictive checks for the mean variance and proportion of zeroes for sand lance showed no evidence of lack of fit bayesian p values mean 0 53 variance 0 73 proportion of zeroes 0 79 fig s2 posterior predictive checks summarized by block bayesian p value range 0 52 0 84 year bayesian p value range 0 38 0 90 and season bayesian p value range 0 50 0 82 also showed no obvious lack of fit figs s3 s5 predicted sand lance abundance varied by block and increased from north to south with median estimates of 0 07 sand lance block north 0 73 sand lance block central and 3 74 sand lance block south fig 3 a table 2 some annual differences in abundance were observed credible intervals overlapped in most years with the largest fluctuations in abundance occurring in the south median sand lance estimates for the south in most years 2014 2015 2016 was greater than average while median estimates for the central block were at or below average in these years highest abundances in all blocks occurred in 2016 abundance estimates for the north showed little to no difference by year with median annual estimates essentially the same as the near zero block average fig 3a in the south and central blocks median abundance estimates were below average in 2018 fig 3a parameter values suggested site level variation in sand lance abundance fig 4 a table 2 above average sand lance abundance was predicted for one northern site two central sites and one southern site fig 4a the 95 credible intervals of the marginal posterior for three additional sites one northern 2 southern were almost entirely above zero southern and central blocks had mixtures of sites with median estimates above and below average expected abundance while all but three northern median estimates were predicted to have below average abundance fig 4a which was not surprising given that sand lance were only observed at 2 sites in the northern block throughout the study period fig s1 the probability of sand lance availability was slightly greater in the fall median 0 42 95 ci 0 29 0 59 than the spring median 0 33 95 ci 0 17 0 56 table 2 though overlapping credible intervals suggest little difference between seasons 3 2 humpback whale sub model trace plots and gelman rubin statistics confirmed convergence of most parameters one λ i j k w value and seven z i j k w values had rhat values between 1 2 and 1 3 for all fixed effects and variance components rhat values were 1 1 and effective sample sizes n eff were 3200 overall posterior predictive checks for the mean variance and proportion of zeroes for humpbacks showed no evidence of lack of fit bayesian p values mean 0 51 variance 0 78 proportion of zeroes 0 71 fig s2 posterior predictive checks summarized by block bayesian p value range 0 27 0 86 year bayesian p value range 0 31 0 90 and season bayesian p value range 0 48 0 91 also showed no obvious lack of fit figs s3 s5 humpback whales showed a statistically clear positive correlation with sand lance median 0 35 95 credible interval 0 05 0 70 fig 4c table 2 using this relationship estimated humpback abundance also increased from north to south with highest expected abundances in every year occurring in the south fig 4b some annual differences in humpback abundance were observed but year to year variation differed from sand lance median values for predicted humpback abundance in all sites alternated from below average in 2014 and 2016 to at or above average in 2015 and 2018 respectively fig 4b the posteriors for the parameter values suggested site level variation in humpback abundance fig 4b above average humpback abundance was predicted for two central sites and three southern site fig 4b the range of 95 credible intervals for three additional sites one central two southern were almost entirely above zero no northern sites showed clear differences in humpback abundance though median and 50 bayesian credible intervals were above average for two northern sites southern and central blocks had mixtures of sites with median estimates above and below average fig 4b only one site c6 showed clear above average estimates for both humpbacks and sand lance fig 4a b the probability of humpback availability was slightly greater in the fall median 0 53 95 credible interval 0 36 0 71 than the spring median 0 47 95 credible interval 0 3 0 66 table 2 though overlapping credible intervals suggests little difference between seasons the median probability of observing whales was greater than the probability of observing sand lance in both seasons table 2 3 3 applications sites that were likely to have greater than average sand lance abundance or sand lance hot spots were identified in all blocks fig 5 the probability that a site had greater than block average sand lance abundance was 0 75 for two northern sites four central sites and five southern sites fig 5 probabilities of at least 5 whales at a site ranged from 0 0 34 with whale aggregations being most likely in the southern block at site s11 fig 6 the three s10 s11 s14 sites with the highest probabilities of whale aggregations overlapped with a high density area of trap pot gear on the sw corner of stellwagen bank the probability of 3 whales at sites was greater with sites s11 and s14 having probabilities of whale aggregations 0 5 4 discussion 4 1 ecology we demonstrated a statistically clear positive correlation between sand lance and humpback whales supporting findings from previous work and confirming persistence of this relationship over time payne et al 1986 payne et al 1990 weinrich et al 1998 while prior studies linked shifts in humpback distributions with fluctuations in sand lance abundance at broad scales across large feeding areas we showed relationships at an intermediate block scale within a single feeding area this result is consistent with silva et al 2020 that applied spatial metrics to the same dataset and found high spatial collocation between humpbacks and sand lance in southern stellwagen bank the clear relationship between humpbacks and sand lance suggests that relative effects of sites and year would vary similarly for both species but this was not the case only one site c6 had a positive effect on both sand lance and humpback abundance differences in site effects for sand lance and humpbacks are likely due to a combination of scale mismatch and habitat selection by sand lance correlations between predators and prey are often scale dependent rose and legget 1990 fauchald et al 2000 our site level observations of sand lance and humpbacks are collected at very different spatial scales 0 1 m2 for sand lance and an 800 m radius for humpbacks further sand lance benthic distributions are highly patchy ranging from 0 to 44 fish in a single grab sample table s1 humpback counts within 800 m are likely not reflective of sand lance counts in 0 1 m2 which may be further complicated by the patchy benthic distribution of sand lance while benthic habitat selection by sand lance is likely based on preferred sediment grain size coarse grain sand and sufficient oxygen flow meyer et al 1979 robards 2000 the average patch size of sand lance on the bottom is unknown identifying correlations between predators and prey at the scale of prey patches would likely require observations at the scale of an individual humpback whale redfern et al 2006 hazen et al 2009 and kirchner et al 2018 associated humpback foraging with individual pelagic sand lance schools using data from 3d motion sensor tags on individual whales and prey data from echosounders alternatively conducting multiple sand lance grabs at a site within an 800 m radius may show better agreement between site effects for sand lance and humpbacks the complex behavior of sand lance could also contribute to differences in site parameter estimates we assumed that the number of sand lance in each grab sample reflects the relative total number of fish at a site water column sediment which may not be true sand lance are generally thought to spend daytime periods feeding in the water column and to return to the bottom at night during periods of low light during estivation and or in response to predators robards 2000 while our findings of sand lance in the sediment during the day provide evidence that diel behavior of sand lance is actually more complex it is likely that pelagic sand lance abundance is greater than benthic sand lance abundance during the day this may lead to observations of whales at a site but not of sand lance even though sand lance may be present in the water column sampling pelagic sand lance abundance may improve correlations at the site level nevertheless the site level variation in abundance of humpbacks and sand lance shown here suggest that scale considerations in future modeling or management actions could be important differences in year effects between species could reflect challenges with sampling but may also suggest true differences driven by different environmental factors our sampling is conducted once per season in any year capturing a small snapshot of animal abundance counts used here and resulting parameter estimates may not be representative of actual annual trends in abundance for example opportunistic sightings data collected from whale watching and research cruises in the sanctuary during this time period show that humpback whale abundance was relatively high in 2016 robbins unpublished data concurrent with the highest sand lance abundance in our study it is possible that whales were not present at the time of our survey or that they were present but were outside our 800 m observation radius however different year effects between species could also reflect true differences in animal abundance predicted sand lance abundance was lowest in 2018 when predicted humpback abundance was highest it is possible that humpbacks were targeting other prey during this time humpbacks in the gom also eat herring and mackerel hain et al 1982 geraci et al 1989 without direct observations of surface feeding it is not possible to determine what whales were targeting as prey or if they were foraging at all during our surveys more frequent surveys or sampling for additional forage fish species may better explain yearly differences we clarify here that because site and year were treated as random effects it is a common approach to interpret differences between sites and years using only the magnitude of their variance components and not the individual random effects however it is also common for the values for the random effects themselves to be of interest and our estimation approach allows us to quantify the uncertainty associated with their estimates via their credibility intervals however because the block specific means vary the relative effect of the same magnitude site effect on the sand lance and whale densities will vary by block we also fit a model with block specific variances for site effects this had minimal influence on the results but did lead to decreased precision in site parameter estimates particularly for n sites where few sand lance and whales were observed we emphasize that the site comparisons we do make particularly in the identification of sand lance hot spots in the application below are relative to block specific mean abundances and are only relevant within their respective blocks not across blocks we also note that based on the current model and our approach to use random site effect values to identify hot spots there is little reason to believe that these same sites will persist as hot spots in the future 4 2 modelling our model performed well in predicting the overall mean counts of whales and sand lance from our dataset but tended to underestimate both the proportion of zeroes and the variance in counts for each species posterior predictive checks figs s2 s5 the underestimate of variance may be due to underestimation of zeroes this may be partially driven by fewer observations in the north or some northern sites with no sand lance observations leading to an overestimate of the mean in the northern block while underestimating the variance and proportion of zeroes a preliminary zero inflated negative binomial model performed slightly better in estimating the proportion of zeroes and variance for both sand lance and humpbacks bayesian p value range 0 35 0 54 but performed slightly poorer in estimation of mean abundance bayesian p values 0 43 0 45 results from the zero inflated negative binomial were similar to those presented here and given a marginally better performance we chose to present the simpler zero inflated poisson model we attempted to account for zero inflation due to seasonal sampling variability by including season as a covariate in the zero inflation portion of the model successful observation whale presence of whales and capture of sand lance was more likely in the fall though overlapping credible intervals and the tendency of the model to underestimate zero inflation suggests that additional factors may influence zero inflation 4 3 further model developments and extensions the current model structure is specific to stellwagen bank national marine sanctuary our survey design and sampling method is neither directly applicable to other geographic areas or methodologies nor suited for future prediction or forecasting however the current model demonstrates value in using simple geographic covariates to gain understanding of species distributions and the utility of a bayesian hierarchical framework for representing ecological relationships model results here provide insight into variation in abundance and distribution over several spatial and temporal scales that can inform selection of environmental covariates to further model development we first discuss potential ways to extend the model for sbnms based on our results and then briefly mention additional factors known to influence sand lance and humpback abundance on broader scales that should be considered for model expansion to larger new geographic areas while we demonstrate a clear relationship between humpbacks and sand lance in the sanctuary data on the availability of alternative prey sources is necessary to fully understand variation in humpback abundance and distribution and the threshold abundance of various prey species that influence humpback movements into and out of areas there may years where sand lance abundance is low such as 2018 here but alternative prey is able to support a small number of humpbacks the site level variation in sand lance abundance seen here is likely partially driven by preferred sediment grain sizes the usgs has produced extensive fine scale sediment data for sbnms valentine 2019 our survey sampled multiple sand types very coarse to medium sand but grain size data suggest that fewer northern sites are classified as coarse grain sand 0 5 1 mm the preferred sediment size of sand lance which may contribute to decreased benthic sand lance abundance in the northern block robards et al 2000 grain size should be incorporated into future models given the seasonal behavioral changes exhibited by sand lance grain size may be more important for sand lance in the fall as they spend more time in the sediment suggesting a need for an interaction between season and grain size further the distribution of sand lance likely reflects a balance between suitable benthic habitat and prey availability van der kooij et al 2008 copepods primarily of the genus calanus primarily compose sand lance diets where they have been studied meyers et al 1979 danielsen et al 2016 staudinger et al 2020 suca et al 2021 on stellwagen bank calanus finmarchichus was primary prey of sand lance during most months when feeding occurs suca et al 2021 sand lance abundance across the northeast shelf was also correlated with lagged calanus finmarchicus abundance suca et al 2021 including calanus abundance in future models may help explain both site level and block level variation in sand lance abundance year to year and block level variation in sand lance abundance suggests that additional dynamic environmental covariates should be included in future models one potential factor is the strength of the western maine coastal current a current driven by fresh water runoff and local wind forcing that flows southwestward around the gulf of maine with peak inputs during the spring bigelow 1927 geyer et al 1992 the western maine coastal current is an important source of calanus to massachusetts bay and inter annual variability in transport combined with local wind forcing can impact both primary productivity and zooplankton abundance jiang et al 2007 mcmanus et al 2014 suca et al 2021 metrics related to the strength of the western maine coastal current may help explain changes in sand lance abundance in addition to prey abundance hydrology and predation influence sand lance abundance on broad scales suca et al 2021 in the northwest atlantic sand lance abundance oscillates out of phase with the abundance of herring and mackerel which are known to prey on larval sand lance staudinger et al 2020 suca et al 2021 lagged herring abundance and the proportion of warm slope water were linked to declines in sand lance abundance suca et al 2021 other studies have found correlations between sand lance and oceanographic variables such as bottom temperature and salinity van der kooij et al 2008 model adaptation for areas larger should consider these variables one limitation to further study of sand lance abundance in general is lack of data sand lance data collected in the gulf of maine are sparse richardson et al 2014 and to our knowledge no data exists at a scale as fine as our survey given the importance of sand lance to humpbacks as well as commercial fishes and seabirds staudinger et al 2020 collecting additional sand lance data throughout the gulf of maine should be a priority particularly given the push towards ecosystem based management koehn et al 2020 4 4 application we applied our results to examine overlap between humpback whale aggregations and fixed gear to demonstrate one potential management application over 75 of gom humpbacks show scarring consistent with entanglement robbins 2012 and entanglement remains a serious threat including within the sanctuary u s department of commerce 2010 we show that sites more likely to have whale aggregations overlap with an area of high density trap pot gear on southern stellwagen bank wiley et al 2003 used standardized survey data to show that whales had the highest risk of interaction with fixed fishing gear in the same location southern stellwagen bank our results show that the location of highest entanglement risk for humpbacks has remained consistent for almost two decades but also provides tangible probabilities that whale aggregations are present in areas of high risk further our hierarchical model structure shows two potential spatial scales for management options regional block and small scale 1 km based on a clear relationship between humpbacks and sand lance and identification of both sand lance hotspots where whales could be and whale aggregation sites 5 conclusion we fit a bayesian hierarchical model to a unique dataset to advance our understanding of the sand lance humpback whale relationship in the southwestern gulf of maine our work explored this predator prey relationship with a novel approach extending our knowledge past simple correlations and providing new insight into the abundance and distribution of sand lance and humpbacks over multiple spatial and temporal scales that can inform further model developments models to predict both sand lance and humpback abundance in sbnms and beyond will become crucial for understanding potential changes to predator prey dynamics and ecosystem structure due to climate change sand lance appear especially vulnerable to increasing temperatures and ocean acidification hare et al 2016 murray et al 2019 suca et al 2021 declines in sand lance abundance and serious changes to the ne us forage fish complex are predicted under current carbon emissions suca et al 2021 climate induced shifts in the abundance and distribution of sand lance will likely lead to shifts in the abundance and distribution of humpbacks understanding how humpback whales will respond to fluctuations in forage fish abundance is critical for predicting and mitigating human impacts like those from entanglement 6 data accessibility statement all data and code are available on github https github com tammylsilva sand lance humpback bayesian model authors contributions field research design funding acquisition dw data collection dw ts model conceptualization analysis ts gf writing original draft ts writing review editing ts dw gf declaration of competing interest the authors have no conflicts of interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we thank p valentine and d blackwood for their invaluable contributions to this work including time expertise and equipment thanks to michael thompson peter hong and justin suca for their instrumental efforts with field work and logistics we are grateful to captains d slocum a meloski and the r v auk crew for their efforts on this project we thank the many sbnms volunteers and observers who helped collect these data thanks to les kaufman joel llopiz and hannes baumann for their support and involvement this work was supported by the bureau of ocean energy management ia agreement m17pg0019 noaa stellwagen bank national marine sanctuary u s geological survey and the volgenau foundation we thank two anonymous reviewers for their thoughtful comments that greatly improved this manuscript the scientific results and conclusions as well as any views or opinions expressed herein are those of the authors and do not necessarily reflect the views of the office of national marine sanctuaries noaa or the department of commerce supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j ecolmodel 2021 109662 appendix supplementary materials image application 1 
24582,this paper introduces a novel general model based on ordinary differential equations odes which is able to describe the population dynamics of a large class of insect pests the proposed model is a physiologically inspired generalization of a number of ad hoc models presented through the years in the literature its main feature is that it allows the systematic generation of a population model for a species by simply defining its key features namely the sex ratio and the development fertility and mortality rates the first part of the paper provides a detailed description of the model and shows that most ode based models existing in literature can be obtained as a special case of the proposed model the second part of the paper shows an application of the model to the spotted wing drosophila drosophila suzukii which is a highly relevant pest in agriculture the biological features of this species i e the sex ratio and the various rates were retrieved from the existing scientific literature the obtained model was validated using data from a three year survey conducted in two experimental fields results show that the model describes faithfully the experimental populations although the simulations were performed completely in open loop and without any adaptation of the parameters extracted from the existing literature keywords integrated pest management physiologically based models linear time varying systems alien species crop protection 1 introduction in recent years thanks to the growing availability of different technologies we are experiencing what is often defined as the fourth agricultural revolution barrett and rose 2020 the key concept of such revolution is the so called precision agriculture pierpaoli et al 2013 precision agriculture is a concept that incorporates a series of technological and philosophical changes in the way agriculture is conceived the key feature of precision agriculture is that it aims at using the inputs e g water and agrochemicals only when and where they are actually needed stafford 2015 the scientific community is investing a considerable amount of effort to make this vision become a reality a large number of activities on the subject are currently ongoing at different levels rupnik et al 2019 to progress towards the precision agriculture paradigm particular attention must be focused on plant protection against pests and diseases in fact a large portion of the agrochemicals is used to control insect pests and pathogens such as bacteria fungi or nematodes and it is well known that an indiscriminate use of these substances is highly dangerous for the ecosystems partel et al 2019 accordingly to use agrochemicals in a more selective way would dramatically reduce the environmental footprint of farming several authors potamitis et al 2017 lucchi et al 2018 pointed out that to do so the development of technologies for the automated semi automated detection of pests and diseases is fundamental however technology alone is not enough this is due to at least two reasons i in agriculture measuring is economically expensive and for many crops it will likely never be realistic to perform a continuous monitoring of all plants ii in order to plan effective treatments it is important not only to measure the current status of the farm but also to predict the future evolution of the infestations accordingly in parallel with the technological research it is fundamental to develop mathematical models able to describe and predict the evolution of the infestations lessio and alma 2021 many scientists around the world are currently working on the mathematical modelling of insect pests population dynamics lessio and alma 2021 banks et al 2019 gilioli et al 2016 schaub et al 2017 pest population models are particularly important when pest management is performed through the release of natural enemies the use of which is rapidly growing among farmers and is one of the core aspects of the so called integrated pest management ipm framework in fact the effectiveness of ipm control strategies is strongly related to the pest life cycles and to when the peak of the individuals belonging to the most susceptible stages occurs which to be determined requires the use of sufficiently reliable mathematical models orlandini et al 2018 insects like most ectotherms progress through their life stages with development speeds that are highly dependent on the environmental parameters temperature mainly harcourt 1969 this concept is well known by entomologists lessio and alma 2021 at the point that several authors estimated mathematical expressions to describe the development rate as a function of the temperature see quinn 2017 mirhosseini et al 2017 shi et al 2017 and references therein the proliferation of mathematical expressions describing the relationship between ectotherms and environmental parameters such as temperature laid the foundations for the so called physiologically based models conceptually a physiologically based model can be defined as the union between phenological models and population dynamics models which means that they describe the development of ectotherm populations over time while considering the stage development driven by environmental factors most of the physiologically based models are formulated using ordinary manetsch 1976 nance et al 2018 vansickle 1977b banks et al 2019 otero et al 2006 and partial vansickle 1977a rossini et al 2019a 2020d deangelis and huston 1987 von foerster 1959 ainseba and sebastian 2001 he and ainseba 2014 differential equations odes and pdes respectively note that although most existing models present similarities they are ad hoc models each developed for specific insect species the aim of this work is to propose a general model able to describe the life cycle of most insect species of agricultural interest the proposed model is a generalization of several existing models presented in the literature such as manetsch 1976 nance et al 2018 vansickle 1977b banks et al 2019 and otero et al 2006 this means that all these models can be seen as special embodiments of the general model presented in this paper the proposed model formulation considers both a detailed description of the biological mechanisms of the ectotherms populations development and a description of their age structure in terms of identifiable life stages contrary to other species such as mammals insects have well defined and identifiable life stages accordingly a natural way to represent their life cycle in mathematical form is through a system of coupled odes where each equation describes a clear and well identifiable part of the life cycle although some pde based models have been presented in the literature odes are a much more natural way to describe the development of insect populations and moreover are much simpler to handle and simulate in the model we propose in this work the transitions between the various stages are summarized in terms of development fertility and mortality rates which as mentioned before are commonly studied in the entomological literature ikemoto and kiritani 2019 quinn 2017 pasquali et al 2019 and that are typically a function of the temperature and possibly of other external phenomena such as food availability parker 1974 gutierrez et al 1994 1984 and photo period baumgärtner et al 2012 we believe that the model proposed in this study provides a general framework that will allow the community to describe and simulate in a systematic and standardized way many insect populations indeed to develop a model for a given insect species it is enough to recover the development fertility and mortality rate functions specific to a species and plug them in our framework to obtain a new model to show the effectiveness and the flexibility of the proposed model we will show that several models proposed in the literature for specific species can be actually seen as special cases for our model furthermore we propose a new and highly relevant by itself case study concerning the modelling of an invasive insect pest the spotted wing drosophila drosophila suzukii matsumura diptera drosophilidae for this insect the general model presented in this paper has been particularized using the development fertility and mortality rate functions and parameters available in the literature the simulations are then compared with data coming from a three years data collection campaign on two different fields part of the used data were already published in rossini et al 2020a and part is published here for the first time interestingly the open loop simulations of the obtained model faithfully predict the measured data without any adaptation of the parameters 2 materials and methods 2 1 model overview and assumptions in order to describe the main mechanisms of insects development the ectotherms life cycle is divided into discrete age classes each representing an identifiable life stage as shown in fig 1 we consider an egg stage a variable number of larval instars and up to two adult stages note that adult stages are divided by sex which is a highly important feature to describe insects where the two sexes have different characteristics to each stage it is associated a scalar state x i t i e l 1 l n a m a f 1 a f 2 which represents the number of individuals in the population that at time t are in the stage i similarly to what is presented in other studies in the literature rossini et al 2019a 2020d the flow of individuals entering and leaving each life stage is regulated by specific rate functions which are i specific for each species and ii relate the development mortality and fertility rates to the environmental parameters e g temperature relative humidity photo period food availability etc and optionally to one or more states of the system as we will detail in the next subsections this naturally leads to model the population development as a system of odes as already mentioned to capture the specificities of certain insects the adult stages in fig 1 are divided by sex and moreover the possibility that females can be in two different states representing e g non mated and mated or younger and older females is taken into account note that in line of principle even more adult stages could be considered however to the best of our knowledge no model using more than two adult stages has been presented so far in the literature nor we are aware of species for which more than 2 stages are necessary to describe the life of adult females we believe that this two sexes two female stages modelling is particularly important to represent multivoltine species i e species having multiple generations in a single year or in a single growing season and allows to model as special cases a number of specific situations including thelytokous parthenogenetic species where populations are composed only by females in this case s r 1 and no equations describing males are present species where it is convenient to use the two female substages to distinguish between non mated and mated females in this case β 2 0 note that it is also possible to model i females that mate and lay eggs multiple times in their life cycle g 1 2 0 or ii females that mate only once in their life cycle g 1 2 0 species where it is convenient to divide the life of a female in two different stages with different fertility and mortality rates in this case β 1 0 β 2 0 g 1 2 0 in the rest of the text we will describe the odes for each stage of the proposed model note that in the literature the rate functions between stages are often characterized as functions of the temperature only estay et al 2014 rebaudo and rabhi 2018 orlandini et al 2018 quinn 2017 ikemoto and kiritani 2019 but there are cases where corrections to take into account other factors e g relative humidity or rain are used nance et al 2018 in this work we have chosen to write them as functions of the time to highlight that in line of principle they can be functions not only of the temperature but also of other environmental factors which in turn depend on time for the sake of completeness we have also to mention that some of these rates e g mortality rates and fertility rates may also depend on some of the states of the population to model for instance that overpopulation increases the mortality rate see e g otero et al 2006 for the sake of notation compactness the potential dependence of the rate functions on the population states will not be explicitly reported in the rest of the this paper unless explicitly needed 2 2 model formulation following the assumptions summarized in the above general overview we hereby introduce the general equations of our model we wish to remind the reader that being a general model not all possible development paths that the model is able to describe make sense for all insects but that depending on the species some of the development fertility rates must be put to zero as usually done in the ecological literature all over this paper we assume the time measurement unit to be d a y s and the rate functions to be expressed in o f i n d i v i d u a l s d a y egg stage we denote by x e t the number of individuals in the egg stage at time t the variation of x e t over time depends on i the number of new eggs produced by adult females which is a function of the number of adult females in the two stages denoted by x a f i t i 1 2 of the fertility rates β i t i 1 2 and the development rates g a f i t i 1 2 ii the number of eggs which moves to the first larval instar stage given by the current population and the development rate function g e t at time t and iii the number of eggs which leaves the stage due to mortality which is based on the mortality rate function m e t accordingly the egg stage can be expressed by the following ode 1 d d t x e t g a f 1 t β 1 t x a f 1 t g a f 2 t β 2 t x a f 2 t g e t x e t m e t x e t note that in the most accurate models the mortality rate within equation 1 may explicitly depend on the state since overpopulation in the breeding sites is a common phenomenon in many species see e g otero et al 2006 in this case the mortality rate will be in the form m e t x e t instead of m e t accordingly although for notational simplicity the notation m e t will be maintained throughout the text we remark that in line of principle this rate can also be a function of the state larval stages larval stages are usually composed by a series of identifiable instars whose number varies from species to species although in many models all larval instars are mathematically represented by a single stage di cola et al 1989 picart and ainseba 2011 nance et al 2018 the proposed model allow to generalize to an arbitrary number of instars in general we believe that if the larval instars are identifiable each of them should be treated as a single stage thus contrary to previous works in this work the larval stage is described by n chained equations corresponding to the number of larval instars we denote by x l i t the number of individuals belonging to the i th larval instar at time t the variation of x l i t over time depends on i the number of individuals coming from the previous stage which is a function of the populations of the stage x l i 1 x e t for the first larval instar and the development rate function g l i 1 t g e t for the first larval instar ii the number of individuals that after maturation moves towards the next stage which depends on the corresponding development rate function g l i t at time t and iii the number of individuals that leave the stage due to mortality given by the current number of individuals x l i t and the mortality rate function m l i t mathematically this is described by the ode 2 d d t x l i t g l i 1 t x l i 1 t g l i t x l i t m l i t i 1 n where l 0 denotes the egg stage i e l 0 e note that in this model the last larval stage i e x l n t typically refers either to pupa or to the last nymphal stage depending on the species under study it is worth to remark that also in this case the mortality rate of the preimmaginal stages may depend on the number of individuals in the states and more precisely on the number of insects w r t the food availability hence although for the sake of notation the mortality rate functions of the larval stages are indicated as m l i t it is implicitly meant for some species m l i t x t x l i t in eq 2 a similar discussion can be done for all mortality rates in all development stages of insects life cycle and thus will not be repeated for the next stages note also that in line of principle the development rates may depend on the size of the population adult males since the reproduction is a process that does not involve the preimaginal stages for the sake of simplicity the distinction between sexes is introduced only on the equations describing adults accordingly when the individuals leave the last larval stage they are distributed between adult males and females in proportion to the sex ratio s r in many species this parameter can be considered constant with good approximation but in the case of species which change their sex ratio depending on the period of the year and of environmental and biological parameters e g jarošík et al 2003 s r can be considered as a function of the time s r t as a convention we will denote with s r t the proportion of females within the population the proportion of males is the complement 1 s r t accordingly to this discussion let us introduce the variable x a m t which represents the number of adult males at time t with a similar reasoning to eqs 1 and 2 the variation on the number of adult males x a m t depends on i the number of individuals coming from the last larval instar which is based on x l n t the current number of individuals at that stage the corresponding development rate function g l n t and the sex ratio 1 s r t and ii the number of adults males that leave the stage due to mortality which is based on the current number of individuals x a m t and the mortality rate function for this stage i e m a m t mathematically 3 d d t x a m t 1 s r t g l n t x l n t m a m t x a m t females stage 1 as already mentioned in this model the adult females life stage is described by up two substages depending on the species these two substages can represent different things for instance they can be used to describe two classes of age with different reproduction mortality rates or can be used to distinguish between non mated and mated females the number of female individuals in the adult stage 1 is denoted by x a f 1 one of the inflows of individuals is the portion of the larvae that become females and enter the female stage 1 accordingly to the sex ratio s r t another inflow of individuals is for the species for which it makes sense e g for species where females after oviposition are again fertile the flow of individuals that from the female stage 2 moves back to the female stage 1 this flow is proportional to the transition rate g 1 2 t for species for which this is not the case g 1 2 t 0 the number of individuals leaving the class is the sum of the portion of individuals developing to the next stage accordingly to the transition rate function g 1 2 t and the ones that die accordingly to the mortality rate function m a f 1 t mathematically the equation describing the female stage 1 is 4 d d t x a f 1 t s r t g l n t x l n t g 1 2 t x a f 1 t m a f 1 t x a f 1 t g 1 2 t x a f 2 t it is worth to remark that in the case of a subdivision in non mated and mated females the transition rate g 1 2 t may be a function of the number of males namely g 1 2 t x a m t female stage 2 the variation on the number of individuals x a f 2 t in this stage depends on i the inflow of females from female stage 1 accordingly to the transition rate function g 1 2 t ii the number of females in female stage 2 that moves back to female stage 1 where it makes sense proportionally to the transition rate g 1 2 t iii the number of females which leave the stage due to mortality proportionally to the mortality rate function m a f 2 t mathematically 5 d d t x a f 2 t g 1 2 t x a f 1 t m a f 2 t x a f 2 t g 1 2 t x a f 2 t in the case this stage is not needed for the description of a specific species it is enough to set g 1 2 t 0 model summary the overall system can be written as the following system of odes 6 d d t x e t g a f 1 t β 1 t x a f 1 t g a f 2 t β 2 t x a f 2 t g e t x e t m e t x e t d d t x l 1 t g e t x e t g l 1 t x l 1 t m l 1 t x l 1 t d d t x l n t g l n 1 t x l n 1 t g l n t x l n t m l n t x l n t d d t x a m t 1 s r t g l n t x l n t m a m t x a m t d d t x a f 1 t s r t g l n t x l n t g 1 2 t x a f 1 t m a f 1 t x a f 1 t g 1 2 t x a f 2 t d d t x a f 2 t g 1 2 t x a f 1 t m a f 2 t x a f 2 t g 1 2 t x a f 2 t a list of the variables and functions with their description is reported in table 1 remark as mentioned before the development mortality and fertility rates can be in general not only functions of environmental parameters temperature humidity food availability etc but also of the system state hence it is worth to remind that all the rate functions within the model e g g i t m i t β i t might be in line of principle dependent on the states x t i e g i t x t m i t x t β i t x t more specifically common dependencies are i in the mortality and development rates to represent that overpopulation increases the mortality rate and slows down the development rates see e g the logistic map mohd safuan et al 2012 and ii in the fertility rates or equivalently in the rate g 1 2 t if the substage 2 describes mated females to consider that the probability of a female to procreate depends on the adult males population density anguelov et al 2012 however it must be remarked that for many species of agricultural interest these dependencies on the state can be omitted the reason is that for what concerns the dependency of the rates on overpopulation because of the abundance of food and because of control policies in agriculture is extremely rare that insect populations reach overpopulation numbers araújo et al 2019 note that these kinds of phenomena are instead quite common in forestry contarini et al 2013 elderd et al 2013 and urban areas araújo et al 2019 where treatments are usually not allowed or not convenient for what concerns the dependency of fertility mating rates with the concentration of males for most species this is a saturated function that above a certain male concentration becomes practically a constant rhainds 2010 although important in line of principle for most species this dependency is not well studied and is neglected as it has an effect only for very low population densities or where the number of males is much smaller with respect to the female population rhainds 2010 for most species of agricultural interest this situation does not occur frequently usually it just happen at the very beginning of the growing season after overwintering and is often neglected in the literature note that in the case the rate functions do not depend on the state model 6 becomes a linear time varying system 2 3 connection with existing ode based physiologically based models in this section we show with no seek of completeness how some relevant physiologically based models in the existing literature can be seen as special cases of model 6 ode model from banks et al 2019 this model was introduced by banks et al 2019 to describe a population of homalodisca vitripennis the insect s life cycle was divided in three macro stages namely eggs x e a combined nymphal stage x n and adults x a the mathematical model as presented in the original work is the following 7 d x e d t b t t 270 x a r e t t 270 d e x e d x n d t r e t t 270 x e r n t t 270 d n x n d x a d t r n t t 270 x n d a t t 270 x a where t t 270 is the temperature in c at time t 270 days d e d n and d a are the mortality rate functions r e and r n are the development rate functions and finally b t t 270 is the fertility rate function model 7 can be obtained as a particular case of model 6 making the following positions i the number of preimmaginal stages is n 1 ii there are no males represented by the model namely the equation describing males in the model 6 is omitted iii the transition rates g 1 2 t and g 1 2 t are set to zero and iv the sex ratio s r t 1 given that the males are not included within the model in addition only one female substage is considered the substage 1 accordingly the equation related to x a f 2 t is omitted 6 β 2 t 0 and β 1 t b t t 270 for a summary please refer to table 2 ode model from nance et al 2018 the model was introduced by nance et al 2018 with the aim to represent aedes albopictus population dynamics also in this case the population was divided in three macro stages eggs e larval stages i and adult females the latter contrary to the model of banks et al 7 is divided in two substages the non mated females a h and the mated females a g the resulting system of four odes is written in the original paper as 8 d e d t 1 e k e 1 α p γ a g β a g μ e f e t e d i d t f e t e m i t f i t i d a h d t f i t i m a t μ r f a h t a h γ a g a g d a g d t f a h t a h m a t μ r γ a g a g model 8 can be derived from our model 6 making the following positions see also table 2 i the equation describing egg populations in the model 8 can be obtained by eq 1 considering β 1 t 0 and β 2 t 1 e k e 1 α p β since nance et al indicate with f e t and μ e the egg s development and mortality rates respectively ii the number of larval instars is n 1 iii there are no males in the model hence the adult male state and the associated equation is omitted iv the transition rate g 1 2 t γ a g while g 1 2 t f a h t v the sex ratio s r t 1 since males are not represented in the model vi the adult mortality rate is the sum of two terms namely m a f 1 t m a f 2 t m a t μ r t ode model from manetsch 1976 and vansickle 1977b the model known by the name of distributed delay model represents the ectotherms life cycle considering a series of h age classes not corresponding directly to the identifiable life stages mathematically it is presented as follows 9 d d t q 1 t h g t q 0 t q 1 t 1 1 h g t a r t d d t q 2 t h g t q 1 t q 2 t 1 1 h g t a r t d d t q h t h g t q h 1 t q h t 1 1 h g t a r t where q i t indicates the number of individuals in the i th age class g t is the development rate function and a r t is the mortality rate function model 9 can be obtained from model 6 making the following positions table 2 i there are no males represented by the model accordingly eq 3 is omitted ii only larval stages are considered with a number n h accordingly the egg 1 females of substage 1 4 and females of substage 2 5 equations are not present iii development and mortality rates are the same in all the equations namely m l i t a r t and g l i t h g t respectively ode model from otero et al 2006 this model was introduced by otero et al 2006 with the aim to simulate populations of aedes aegypti the model divides the life cycle of the species in a total of five stages eggs e larvae l pupae p young adult females a 1 and adult females a 2 also in this case the model does not consider the male population mathematically was presented in the original work otero et al 2006 as follows 10 d e d t e g n o v r 1 a 1 o v r 2 a 2 m e e e l r 1 γ l e d l d t e l r 1 γ l e m l l α l 2 l p r l d p d t l p r l m p p p a r p d a 1 d t p a r e f p 2 m a a 1 o v r 1 a 1 d a 2 d t o v r 1 a 1 m a a 2 the model 10 can be obtained from model 6 considering the following positions reported also intable 2 i the model does not describe male populations accordingly the state and the equation describing males are omitted ii the number of preimmaginal stages is n 2 namely larva l and pupa p iii the adult females are divided in two gonotrophic cycles a 1 and a 2 where reproduction is allowed the development rates are g a f 1 t o v r 1 and g a f 2 t o v r 2 respectively iv the average number of eggs laid is provided by the same oviposition rate β 1 t β 2 t e g n v the egg development rate depends also on the population density of larvae l g e t e l r 1 γ l vi larvae and pupae develop with respective rates g l 1 t l p r and g l 2 t p a r vii the sex ratio is s r t 1 2 e f while the transition rates are g 1 2 t 0 and g 1 2 t o v r 1 respectively viii the mortality rates are m e t m e m l 1 t m l α l m l 2 t m p m a f 1 t m a f 2 t m a 2 4 case study the spotted wing drosophila drosophila suzukii in this section we show that the proposed model 6 can be used to define a new model for a pest of high agricultural interest simply by using development fertility and mortality rates available in the literature the effectiveness and the open loop predictivity of the resulting model is demonstrated against data collected between 2017 and 2019 in different locations 2 4 1 biology and development fertility and mortality rate functions the spotted wing drosophila drosophila suzukii is a harmful pest worldwide in most countries it represents an invasive species of more or less recent introduction it originates from asia more specifically from japan kanzawa 1939 and given its capability to adapt to different territories and climates it is now present in north and south america hauser 2011 and in europe calabria et al 2012 where it was firstly detected in spain cini et al 2012 and italy grassi et al 2011 about one decade ago d suzukii is characterized by a high polyphagy and by a short generation time which lead to up to 15 generations in a year cini et al 2012 soft fruit plantations cherry strawberry blueberry apples peaches grapes and more in general prunus and rubus spp walsh et al 2011 ioratti et al 2011 are the most affected crops contrary to other fruit flies the spotted wing drosophila can lay eggs on ripening fruits using its particular serrated ovipositor ryan et al 2016 the damages produced are mainly due to the oviposition and to the larval feeding which makes the fruits unmarketable larvae more specifically develop on the ripening fruits feeding the endocarp tissue and possibly opening access points for secondary pathogens responsible of relevant diseases such as fungi and bacteria this insect is characterized by a sexual dimorphism from where its common name spotted wing drosophila derives males have two black spots on the wings hauser 2011 ibouh et al 2019 this feature represents an important factor for the field monitoring as it allows to more rapidly distinguish them from other similar species unlike males females are at first sight closely similar to other drosophila species cini et al 2012 and the differentiation requires optical instruments such as microscopes to analyse the ovipositor rossini et al 2020a hence to simplify the monitoring activities the data collection for this species typically focuses only on males in this work we propose a model for the life cycle of the spotted wing drosophila consisting of an egg stage three larval instars pupa stage and adult stages accordingly the total number of equations in the model 6 is 8 one for the egg stage four for the larval stages pupa is considered as the last larval instar and one for the adult males non mated females and mated females respectively due to its harmfulness the dependence of d suzukii development fertility and mortality rates on temperature has been studied by several authors tochen et al 2014 emiljanowicz et al 2014 asplen et al 2015 dalton et al 2011 kinjo et al 2014 an exhaustive overview about the main rate functions commonly used to represent the biological features of the spotted wing drosophila can be found in winkler et al 2021 accordingly the literature provides all the information needed to build a specific model using the proposed general model 6 the first expression introduced is the development rate function rossini et al 2020a tested different functions using the data provided in tochen et al 2014 assessing that the briere et al 1999 function 11 was a very good function to describe the relationship between d suzukii development rate and environmental temperature mathematically the briére function is defined as 11 g t a t t t t t l t m t t 1 m where a and m are empirical parameters t l and t m are the lower and upper temperature thresholds below and above which the development of the species theoretically does not occur it is worth to remind the reader that the development rate is defined as the inverse of the development time severini and gilioli 2002 liu et al 1995 damos and savopoulou soultani 2012 rossini et al 2019b even though the spotted wing drosophila is one of the most studied pests there is not sufficient information to estimate the parameters of the function 11 for each life stage accordingly this leads to the unavoidable simplification of considering only one development rate function for all the stages an estimation of the accidental mortality dependent on the temperature was proposed by asplen et al 2015 who interpolated the data provided by dalton et al 2011 kinjo et al 2014 and tochen et al 2014 with a second order polynomial function however this approximation tends to overestimate the mortality in temperature ranges where the development of the species can still be considered near the optimum hence for the purpose of this work we decided to use a more detailed function in particular in this work we considered the fourth order polynomial function 12 m t t a 1 t t 4 b 1 t t 3 c 1 t t 2 d 1 t t e 1 eq 12 is commonly known as the bathtub function and is widely used to represent the dependence of the mortality on temperature wang et al 2002 since it is able to describe the low mortality rates in the optimal temperature ranges and the rapid increase as the thermal thresholds of the species are reached the coefficients a 1 b 1 c 1 d 1 and e 1 in 12 are empirical parameters which in this study are estimated based on the rates provided in a highly detailed study published by ryan et al 2016 the python scripts used to compute the parameters of 12 are publicly available at the github page https github com niboros91 ectotherms ode based model the quality of this polynomial fitting in representing the data from ryan et al 2016 has been assessed with a χ 2 test and considering the coefficient of determination r 2 the values of these measures and of the parameters are reported in table 3 similarly to what we did for the development rate function 11 the same mortality rate will be used for all the stages ranging from egg to pupa however an additional consideration is necessary for all the adult stages referring to the eqs 3 4 and 5 it is possible to notice that there is not an explicit reference to the development rate accordingly the respective mortality rates should take into account of the mortality due to ageing i e the development rate leading to the following modifications 13 m a m t g t m t t m a f 1 t g t m t t m a f 2 t g t m t t where m t t and g t are expressed by the functions 11 and 12 respectively in other words we are considering the mortality rate in the terminal life stages as the sum of the natural mortality ageing and the accidental mortality due for the sake of simplicity to temperature for the temperature dependent birth rate function β 2 t we consider the equation provided by ryan et al 2016 who fitted their experimental data with the following gaussian like function 14 β 2 t t α γ 1 π λ 2 γ 2 λ 2 t t τ 2 δ 2 γ i f t m i n t t t m a x 0 o t h e r w i s e this birth rate function 14 expresses the number of eggs produced per day by the adult mated females as a function of the temperature t m i n and t m a x represent the lower and upper temperature thresholds where the oviposition occurs while α γ λ δ and τ are empirical parameters since for the case under study the adult females substages are defined as non mated and mated we set β 1 0 to the best of our knowledge d suzukii females can mate only once in their life cycle accordingly the transition rate g 1 2 t 0 for the rate g 1 2 t the function g 1 2 t 1 m t t was selected the reason why this is not a function of the number of males in the population is that as already stated in section 2 2 in average conditions the probability that a female meets a male is considered constant the last parameter to be defined is the sex ratio s r t this value has been reported by emiljanowicz et al 2014 as s r 0 5 i e males females 1 1 and for the purposes of this work can be considered in first approximation constant even though it is known that it might in theory change in particular environmental conditions thistlewood et al 2018 for the sake of completeness this section is concluded reporting in table 3 all the numerical values of the parameters that have been included in the model 6 to simulate d suzukii 2 5 numerical scheme for equation solutions since all the rate functions for the developed model depend only on the environmental factors and not on the states 6 is a linear time varying system that can be rewritten as 15 x t a t x t where the matrix in box i is the transition matrix containing all the rate functions and parameters introduced in the previous subsections as it is common in this kind of models the dependency on the temperature should be considered in the average sense rather than as an instantaneous temperature accordingly we will consider average daily temperatures because of this assuming a sampling time t s that is an integer fraction of one day 15 is equivalent to the following discrete time system 17 x t t s e a t t s x t where a t denotes the transition matrix 16 with the temperatures measured at time t in this study the sampling time is set equal to t s 1 d a y from 17 the state of the population at the next sampling time t t s can be obtained based on the current state x t and the computed transition matrix a t all the code to simulate these equations including the parameters and the daily average temperatures for the different growing seasons in exam have been encoded in a matlab script vers r2018b and is publicly available at the github page https github com niboros91 ectotherms ode based model 2 5 1 field trials for model validation to assess the predictive capability of the presented model the experimental dataset of rossini et al 2020a will be considered rossini et al 2020a reports a three year experiment 2017 2019 in an experimental cherry orchard located in montelibretti lazio italy and a two year experiment 2018 2019 in a second cherry orchard located in monterotondo lazio italy the dataset provides the dynamics of adult male flies during the cherry growing season in the period april july in this work we complement the existing dataset with new unpublished data collected in the winter 2018 from july to december 2018 these data are particularly precious for the validation of the model because they allow to simulate and validate more generations in different seasons of the same year the experimental orchards have a surface of 2000 square metres and are cultivated with local mixed cherry varieties we will denote the two experimental fields as montelibretti field and monterotondo field maintaining the same nomenclature used in rossini et al 2020a overall the data collection covers the period from 20 april to 28 june from 19 april to 15 december and from 12 april to 18 july in the years 2017 2018 and 2019 respectively three droso trap biobest waterloo belgium lured with droskidrink azienda agricola prantil priò trento italy were deployed in each field and inspected weekly because of the easier distinguishability of the adult males the population profile was obtained only for this sex daily temperature values were obtained by averaging 24 measurements in 24 h provided by the arsial agency regional agency for the development of innovation and agriculture in lazio arsial 2019 the most interested readers are referred to rossini et al 2020a for further information about the experimental trial simulations and field data can be compared following the procedure already discussed in other works such as bellocchi et al 2011 ikemoto and kiritani 2019 rossini et al 2020c 2021a b 2020b e and combine the use of the χ 2 function and of the coefficient of determination r 2 notably the χ 2 function is used as indicator of the distance among the n points of the simulated and field populations according to this assumption hence the lower is the value of the function more simulations and field data are overlapped however it may happen that in case of high population densities even a small difference between high values can provide high χ 2 values accordingly the coefficient of determination r 2 is introduced to confirm the reliability of the estimations provided by χ 2 an r 2 value close to 1 hence will indicate a high reliability of the simulations in representing field data 3 results in this section we show the results of the open loop simulation and compare them with the data available from the experimental fields the first year of survey 2017 was the year where only data from the montelibretti field were available fig 2 the field population in this year was on the whole low reporting three peaks on 25 april 14 may and 15 june respectively the day zero for the simulations was fixed to 15 march the highest peak was reported on the 15 june the first simulated peak i e half of march end of april was slightly anticipated with respect to the field data despite the low population density assessed the reliability of the model has been confirmed by the χ 2 and r 2 values reported in table 4 the year 2018 was the most complete regarding the data availability and it allows to show the long term behaviour of the model in both fields the day zero for the simulations was fixed to 15 april in the montelibretti field fig 3 the experimental population reported two close peaks on 26 june and 12 july while the simulation reported only a single peak centred on 2 july in the hottest period of the season late july august the model indicated a population density close to zero which started to rise again at the end of september even though the early autumnal generation of the experimental population increased slightly slower with respect to the simulations both peaks were centred on the same day 19 october a similar situation was assessed at the monterotondo field fig 4 where in the first part of the year two peaks were reported at the experimental population on 5 and 19 july while the model provided a single peak centred on 21 july the behaviour during the hottest period of the season was the same assessed at the montelibretti field with a more pronounced increase occurring at the beginning of october in the second part of 2018 both the experimental and simulated populations reported a single peak centred on 26 october and 8 november respectively the numerical consistence of the simulations in representing the field data table 4 confirmed the overall reliability of the model for the 2018 season also due to the length of the survey this season highlights the model behaviour better than the other ones for this reason two additional plots one for each field were reported in figs 5 and 6 with all the d suzukii life stages of the model in the growing season 2019 the last year of survey the day zero for the simulation was fixed to the 18 april in the montelibretti field four population peaks were assessed at the field trials occurring on 25 april 11 may 11 and 28 june respectively while simulations reported only two peaks centred on 1 may and 27 june fig 7 moreover the 2019 montelibretti field reported a population density overall higher with respect to monterotondo field monterotondo field reported three peaks for the experimental populations occurred on 27 april 12 june and 4 july respectively while simulations indicated two peaks centred on 30 april and 25 june fig 8 the higher inhomogeneity of the experimental populations in this season is underlined by the χ 2 values listed in table 4 the highest and the lowest χ 2 values assessed in the three year survey were in fact assessed on 2019 the r 2 values instead confirm the reliability of the model in representing the field data also in 2019 4 discussions and conclusion the case study of d suzukii confirms the reliability of the novel model 6 introduced in this work in representing ectotherms life cycle it is worth to remark that despite the approximations and simplifications due to the lack of more accurate data about the biology of the spotted wing drosophila most notably despite the fact that simulations were performed in open loop the model faithfully describes the trend of all the experimental populations the most interesting results are provided by the growing season 2018 when the field trials provided the longer availability of monitoring data to compare with simulations with a single simulation the model was capable to describe the spring and early middle autumn generations as well as the apparent absence of d suzukii in the late summer the only anomaly that the model was not able to predict was the apparent increase of the experimental population in the late autumn of 2018 this last fact deserves some discussion and represents an interesting starting point for future investigations we believe that a major cause of this apparent increase of the counted number of males might be actually induced by a distortion introduced by the traps in fact the scarcity of food in these fields due to the dormancy of the great part of the wild and cultivated plants occurring in late autumn winter may elicit the adults towards the traps which are food based to look for food accordingly it is reasonable to assume that the high number of captured insects in the late 2018 in both fields may be mostly provoked by an increase of efficiency of the traps due to food scarcity in the fields unfortunately to the best of our knowledge there is no evidence in the current literature to confirm this supposition even though it is suggested by our empirical observations these data however also raise the point that clearly in winter the field population does not go so close to the zero as predicted by the model we believe this is due to the mortality rate function used that overestimates the mortality as the temperature decreases too much it is implicitly supposed that outside the temperature thresholds provided by the briére function the development rate is zero while the mortality rate goes to very high values typically around 1 days 1 or above this is not completely true as showed also by dalton et al 2011 and it is well known that a certain portion of the population is able to survive the entire winter and restart reproduction as temperature raise again we believe that further studies are needed to understand better the winter ecology of the d suzukii from a quantitative point of view the hope is that this would allow to predict numerically the spring generations on the basis of what happens in the previous autumn and on the meteorological features of the winter although additional future validations are necessary and the link between the late autumn generations and the next spring ones have still to be numerically established the existence of such link is well known and documented in the literature marshall et al 2020 deutsch et al 2018 graham 1952 in view of this fact the fact that both simulations and data show a relevant peak of insects in middle october is a highly relevant evidence that is worth to mention it is documented in the current literature cini et al 2012 that this autumn population develops on fruits fallen on the ground before the harvest or on secondary host plants currently in most orchards these insect generations are not controlled by farmers as they occur after the harvest however the high peak reached by this population combined with the fact that this population is likely linked with the amount of successful overwintering insects suggest that it would be convenient to perform autumn winter control actions in order to reduce potential infestations on ripening fruits in the subsequent spring controlling the last generation of d suzukii occurring in the year moreover has the advantage to allow the use of active ingredients in a season where the cherries are not present in the field accordingly a preventive control action can help to reduce the number of treatments during the fruit growing season resulting in a healthier product for consumers overall the model showed the most efficient response in the fields with the higher population densities where the fluctuations in the experimental population were lower note that even though it was assumed that the population peaks correspond to single generations it may happened that in the case of low population densities the peaks correspond to fluctuations of the catches corresponding to the same generation given this fact the model described faithfully the increase and decrease of the populations even in the cases where the peaks of simulated and field populations were not completely overlapped the results presented in this work are in line with the results of rossini et al 2020a where a generalized version of the von foerster equation a first order pde was applied to simulate the same field dataset of the present study contrary to this work however different fertility and mortality rate functions were used moreover the use of the generalized von foerster equation made necessary to run a single simulation for each generation of the year the advantage of a model based on a system of odes is both conceptual and practical as stated in the introduction and the application in the case study of the spotted wing drosophila preliminary confirms this claim using a system of odes instead of pdes to represent ectotherms life cycles is conceptually more natural given the biological subdivision in identifiable and discrete stages note also that pde models like e g the one presented by rossini et al in rossini et al 2020a to be actually simulated need to be discretized this means that through the application of the upwind scheme the continuous age classes are anyway translated in a collection of discrete states transforming de facto the pdes in a system of odes this aspect is not new and has been pointed out by several authors during the years plant and wilson 1986 rossini et al 2020b f bellagamba et al 1987 and buffoni and pasquali 2007 in fact showed how pde models describing populations of ectotherms can be discretized and transformed in systems of odes to be solved accordingly the model presented in this work represents a natural evolution of the mathematical and biological literature on the field in addition the versatility of the odes allows a more reliable description of the phenomenon since it is easier to improve the equations by adding novel functions related to other biological aspects the use of odes to describe biological phenomena has been recently and successfully applied also in systems involving multiple actors such as in the case of xylella fastidiosa brunetti et al 2020 or vegetation physiognomies in the interaction between grass and trees in the savanna yatat djeumen et al 2021 these two models may represent a great potential for future extensions of the general theory introduced with this work among the models used to represent the spotted wing drosophila also the distributed delay model 9 was applied in 2016 gutierrez et al 2016 to predict potential invasions in america europe and mediterranean basin however one of the main issues in applying the ddm is the determination of the number of age classes since there is not a direct connection between the number of equations of the model and the number of identifiable life stages rossini et al 2020b f in addition the ddm expresses difficulties in representing a two sexed populations since there is not a specific equation for males and females the physiologically based model that we have introduced hereby instead not only includes the ddm as special case but has the great advantage to avoid the calibration necessary to determine the number of its age classes an ode approach to simulate d suzukii infestation dynamics was also proposed by pfab et al 2018 w r t the optimal timing for releasing parasitoids in biological control programs different assumptions were made in this case by the authors leading to a non linear system where a time varying delay is considered even though the population dynamics model in pfab et al 2018 can be traced back as particular case of 6 the non linear approach can be surely a good starting point for future improvement of the model 6 applied to the spotted wing drosophila the distinction between the mated and non mated females or more in general between the female stage 1 and female stage 2 makes the representation of the life cycle of most of the ectotherms more realistic at first sight in the case of the spotted wing drosophila one can think to eliminate directly the non mated female stage with a consequent elimination of an equation by the system even if practically this choice can be reasonable with a suitable re tuning of the parameters it is not from a conceptual point of view the transition towards the stage of non mated females in fact is necessary from a biological point of view since the individuals continue to develop before becoming mated it is known from the literature revadi et al 2015 that after the emergence the adult females become mated in a time range of 1 3 days avoiding the non mated stage in the model hence means to anticipate the reproduction of the aforementioned time range introducing a distortion in the description of the population dynamics the same mechanism of reproduction described by our model was presented by nance et al 2018 in the case of the aedes albopictus and by otero et al 2006 in the case of aedes aegypti as showed in section 2 3 the adult females also in this case were distinguished in mated and non mated nance et al 2018 or in two gonotrophic cycles otero et al 2006 even though no reference to the modelling of males is made also in those cases the differentiation of the adult female stage in two substages provided a more reliable description of the life cycle as confirmed by their results the difference of our model with respect to the model of nance et al 2018 and otero et al 2006 is the generalization of the system of odes in order to consider both the sexes and the birth rate in addition we have extended the concept of life stage to all the stages that are entomologically identifiable without considering the preimmaginal stages as a single stage this make the model suitable for most species of agricultural interest given a clear description of the life cycle an implicit assumption of our study and of the great part of the models presented in literature is that the population is closed namely there are no immigration emigration terms future works will extend to the case of open populations migration terms can be introduced in the specific stage equations with slight modifications considering that the incoming outcoming individuals are proportional to specific migration rate functions also here the advantage to have equations specific for each identifiable stage allows to include the biological notions into the model it is known that not all the stages are allowed to move or migrate to be more concrete let us refer to the case of the spotted wing drosophila where the egg and larval instars represent the great part of the life cycle the motion in this part of the life cycle is limited to the plant scale accordingly it is reasonable to say that these are static stages on the other hand adults fly and spread within the field and towards other fields looking for oviposition sites or individuals of the other sex for mating even though the aforementioned example is referred to the case study considered hereby once the biological traits of the species are known the same specific considerations can be done accordingly this aspect leaves to suppose that migration terms can be considered for the model spatialization if the field is subdivided in a lattice it is possible to consider a matrix of local populations able to migrate from neighbouring parcels spatial patterns of insects and animal in general is usually represented with second order pdes where a reaction and a diffusion term is considered ainseba and sebastian 2001 tait et al 2018 di blasio and lamberti 1977 1978 however this representation does not consider the subdivision of the life cycle in physiological age classes age is usually considered as a time nor the dependence of the development on environmental parameters on the other hand other authors gutierrez et al 2016 proposed the insertion of physiologically based models the ddm more specifically in gis systems without considering nevertheless the interaction between neighbouring parcels of the grid the model presented in this work once provided with migration terms can potentially solve the problem of modelling the spatial diffusion of insect pests and ectotherms in general in addition the mathematical representation of males and females provides an advantage in the introduction of migration terms for all the species where the motion is allowed only for one of the two sexes this is for instance the case of the opheroptera brumata where the males can migrate actively and the females can only move passively because of underdeveloped wings tikkanen et al 2000 also considering the aforementioned example o brumata has a different behaviour for males and females since males emerge a week earlier on average with respect to females and can mate multiple times our model with the specific assumptions can describe a behaviour of this type also and it is our main purpose of future developments and studies always remaining in the context of potential applications and future developments it is worth to remind that the results presented in this study were obtained in open loop without using the data collected to improve the estimation at each data collection time the advantage of working with systems of odes and more specifically with linear systems is the possibility to use the theory of the kalman filtering to correct the predictions on the basis of the present and past monitoring data future works will study how the use of kalman filtering can improve the estimation and the prediction of a population behaviour credit authorship contribution statement luca rossini conceptualization methodology software data curation writing original draft writing review editing formal analysis validation nicolás bono rosselló data curation software writing original draft writing review editing visualization stefano speranza investigation resources supervision project administration funding acquisition emanuele garone conceptualization methodology writing original draft writing review editing supervision project administration funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the authors are grateful to the anonymous reviewers for their comments and suggestions which have been greatly helpful for the improvement of this manuscript this work was supported by the european commission under the grant agreement number 774571 project pantheon is funded by the european community horizon 2020 program under grant agreement 774571 the research was carried out in the frame of the miur ministry for education university and research initiative department of excellence law 232 2016 the monitoring data used to pursue the aim of this study were kindly provided by oplatium appendix model characterization a 0 1 stability dependence on temperature all the rate functions involved in the description of d suzukii case study are temperature dependent accordingly the temperature is the driving parameter that influences the dynamics it must be noted that the system obtained for the case of the d suzukii if the temperature is fixed becomes a linear time invariant lti system since the stability properties of a lti system are completely characterized by its eigenvalues the eigenvalues of the matrix 16 in function of the temperature were calculated based on this fig a 1 shows that as temperature approaches to values near the upper and lower thresholds indicated by the briére 11 the system becomes stable all eigenvalues negative suggesting that the population asymptotically decreases towards zero in the optimum temperature range instead the instability of the system is in accordance with the population increase as confirmed also by the comparison between simulations and field data a 0 2 sensitivity analysis let us explore the behaviour of the model applied to d suzukii with respect to the parameters involved for the sake of simplicity temperatures of the montelibretti field in the season 2018 were considered as well as the same time range of the simulation detailed in section 2 5 1 a series of 20000 simulations have been performed considering a random variation of 10 around the values of the briére development rate function 11 listed in table 3 a random variation of 10 of the fertility 14 and mortality rate 12 functions around the daily value calculated in each time step the choice of the aforementioned random variations is mainly due to the biological meaning and importance of the parameters the briére development rate function 11 contains the information of the lower and upper temperature thresholds for the development while the other two empirical parameters are related to the increase of the rate briere et al 1999 for this reason it is worth to consider their variation singularly fertility and mortality rates instead contain only empirical parameters with no biological meaning hence it is worth to explore the random variation around the daily temperature value and not around each single parameter the 20000 simulations are reported in fig a 2 considering only the population of males in order to be coherent with the validation presented in section 3 
24582,this paper introduces a novel general model based on ordinary differential equations odes which is able to describe the population dynamics of a large class of insect pests the proposed model is a physiologically inspired generalization of a number of ad hoc models presented through the years in the literature its main feature is that it allows the systematic generation of a population model for a species by simply defining its key features namely the sex ratio and the development fertility and mortality rates the first part of the paper provides a detailed description of the model and shows that most ode based models existing in literature can be obtained as a special case of the proposed model the second part of the paper shows an application of the model to the spotted wing drosophila drosophila suzukii which is a highly relevant pest in agriculture the biological features of this species i e the sex ratio and the various rates were retrieved from the existing scientific literature the obtained model was validated using data from a three year survey conducted in two experimental fields results show that the model describes faithfully the experimental populations although the simulations were performed completely in open loop and without any adaptation of the parameters extracted from the existing literature keywords integrated pest management physiologically based models linear time varying systems alien species crop protection 1 introduction in recent years thanks to the growing availability of different technologies we are experiencing what is often defined as the fourth agricultural revolution barrett and rose 2020 the key concept of such revolution is the so called precision agriculture pierpaoli et al 2013 precision agriculture is a concept that incorporates a series of technological and philosophical changes in the way agriculture is conceived the key feature of precision agriculture is that it aims at using the inputs e g water and agrochemicals only when and where they are actually needed stafford 2015 the scientific community is investing a considerable amount of effort to make this vision become a reality a large number of activities on the subject are currently ongoing at different levels rupnik et al 2019 to progress towards the precision agriculture paradigm particular attention must be focused on plant protection against pests and diseases in fact a large portion of the agrochemicals is used to control insect pests and pathogens such as bacteria fungi or nematodes and it is well known that an indiscriminate use of these substances is highly dangerous for the ecosystems partel et al 2019 accordingly to use agrochemicals in a more selective way would dramatically reduce the environmental footprint of farming several authors potamitis et al 2017 lucchi et al 2018 pointed out that to do so the development of technologies for the automated semi automated detection of pests and diseases is fundamental however technology alone is not enough this is due to at least two reasons i in agriculture measuring is economically expensive and for many crops it will likely never be realistic to perform a continuous monitoring of all plants ii in order to plan effective treatments it is important not only to measure the current status of the farm but also to predict the future evolution of the infestations accordingly in parallel with the technological research it is fundamental to develop mathematical models able to describe and predict the evolution of the infestations lessio and alma 2021 many scientists around the world are currently working on the mathematical modelling of insect pests population dynamics lessio and alma 2021 banks et al 2019 gilioli et al 2016 schaub et al 2017 pest population models are particularly important when pest management is performed through the release of natural enemies the use of which is rapidly growing among farmers and is one of the core aspects of the so called integrated pest management ipm framework in fact the effectiveness of ipm control strategies is strongly related to the pest life cycles and to when the peak of the individuals belonging to the most susceptible stages occurs which to be determined requires the use of sufficiently reliable mathematical models orlandini et al 2018 insects like most ectotherms progress through their life stages with development speeds that are highly dependent on the environmental parameters temperature mainly harcourt 1969 this concept is well known by entomologists lessio and alma 2021 at the point that several authors estimated mathematical expressions to describe the development rate as a function of the temperature see quinn 2017 mirhosseini et al 2017 shi et al 2017 and references therein the proliferation of mathematical expressions describing the relationship between ectotherms and environmental parameters such as temperature laid the foundations for the so called physiologically based models conceptually a physiologically based model can be defined as the union between phenological models and population dynamics models which means that they describe the development of ectotherm populations over time while considering the stage development driven by environmental factors most of the physiologically based models are formulated using ordinary manetsch 1976 nance et al 2018 vansickle 1977b banks et al 2019 otero et al 2006 and partial vansickle 1977a rossini et al 2019a 2020d deangelis and huston 1987 von foerster 1959 ainseba and sebastian 2001 he and ainseba 2014 differential equations odes and pdes respectively note that although most existing models present similarities they are ad hoc models each developed for specific insect species the aim of this work is to propose a general model able to describe the life cycle of most insect species of agricultural interest the proposed model is a generalization of several existing models presented in the literature such as manetsch 1976 nance et al 2018 vansickle 1977b banks et al 2019 and otero et al 2006 this means that all these models can be seen as special embodiments of the general model presented in this paper the proposed model formulation considers both a detailed description of the biological mechanisms of the ectotherms populations development and a description of their age structure in terms of identifiable life stages contrary to other species such as mammals insects have well defined and identifiable life stages accordingly a natural way to represent their life cycle in mathematical form is through a system of coupled odes where each equation describes a clear and well identifiable part of the life cycle although some pde based models have been presented in the literature odes are a much more natural way to describe the development of insect populations and moreover are much simpler to handle and simulate in the model we propose in this work the transitions between the various stages are summarized in terms of development fertility and mortality rates which as mentioned before are commonly studied in the entomological literature ikemoto and kiritani 2019 quinn 2017 pasquali et al 2019 and that are typically a function of the temperature and possibly of other external phenomena such as food availability parker 1974 gutierrez et al 1994 1984 and photo period baumgärtner et al 2012 we believe that the model proposed in this study provides a general framework that will allow the community to describe and simulate in a systematic and standardized way many insect populations indeed to develop a model for a given insect species it is enough to recover the development fertility and mortality rate functions specific to a species and plug them in our framework to obtain a new model to show the effectiveness and the flexibility of the proposed model we will show that several models proposed in the literature for specific species can be actually seen as special cases for our model furthermore we propose a new and highly relevant by itself case study concerning the modelling of an invasive insect pest the spotted wing drosophila drosophila suzukii matsumura diptera drosophilidae for this insect the general model presented in this paper has been particularized using the development fertility and mortality rate functions and parameters available in the literature the simulations are then compared with data coming from a three years data collection campaign on two different fields part of the used data were already published in rossini et al 2020a and part is published here for the first time interestingly the open loop simulations of the obtained model faithfully predict the measured data without any adaptation of the parameters 2 materials and methods 2 1 model overview and assumptions in order to describe the main mechanisms of insects development the ectotherms life cycle is divided into discrete age classes each representing an identifiable life stage as shown in fig 1 we consider an egg stage a variable number of larval instars and up to two adult stages note that adult stages are divided by sex which is a highly important feature to describe insects where the two sexes have different characteristics to each stage it is associated a scalar state x i t i e l 1 l n a m a f 1 a f 2 which represents the number of individuals in the population that at time t are in the stage i similarly to what is presented in other studies in the literature rossini et al 2019a 2020d the flow of individuals entering and leaving each life stage is regulated by specific rate functions which are i specific for each species and ii relate the development mortality and fertility rates to the environmental parameters e g temperature relative humidity photo period food availability etc and optionally to one or more states of the system as we will detail in the next subsections this naturally leads to model the population development as a system of odes as already mentioned to capture the specificities of certain insects the adult stages in fig 1 are divided by sex and moreover the possibility that females can be in two different states representing e g non mated and mated or younger and older females is taken into account note that in line of principle even more adult stages could be considered however to the best of our knowledge no model using more than two adult stages has been presented so far in the literature nor we are aware of species for which more than 2 stages are necessary to describe the life of adult females we believe that this two sexes two female stages modelling is particularly important to represent multivoltine species i e species having multiple generations in a single year or in a single growing season and allows to model as special cases a number of specific situations including thelytokous parthenogenetic species where populations are composed only by females in this case s r 1 and no equations describing males are present species where it is convenient to use the two female substages to distinguish between non mated and mated females in this case β 2 0 note that it is also possible to model i females that mate and lay eggs multiple times in their life cycle g 1 2 0 or ii females that mate only once in their life cycle g 1 2 0 species where it is convenient to divide the life of a female in two different stages with different fertility and mortality rates in this case β 1 0 β 2 0 g 1 2 0 in the rest of the text we will describe the odes for each stage of the proposed model note that in the literature the rate functions between stages are often characterized as functions of the temperature only estay et al 2014 rebaudo and rabhi 2018 orlandini et al 2018 quinn 2017 ikemoto and kiritani 2019 but there are cases where corrections to take into account other factors e g relative humidity or rain are used nance et al 2018 in this work we have chosen to write them as functions of the time to highlight that in line of principle they can be functions not only of the temperature but also of other environmental factors which in turn depend on time for the sake of completeness we have also to mention that some of these rates e g mortality rates and fertility rates may also depend on some of the states of the population to model for instance that overpopulation increases the mortality rate see e g otero et al 2006 for the sake of notation compactness the potential dependence of the rate functions on the population states will not be explicitly reported in the rest of the this paper unless explicitly needed 2 2 model formulation following the assumptions summarized in the above general overview we hereby introduce the general equations of our model we wish to remind the reader that being a general model not all possible development paths that the model is able to describe make sense for all insects but that depending on the species some of the development fertility rates must be put to zero as usually done in the ecological literature all over this paper we assume the time measurement unit to be d a y s and the rate functions to be expressed in o f i n d i v i d u a l s d a y egg stage we denote by x e t the number of individuals in the egg stage at time t the variation of x e t over time depends on i the number of new eggs produced by adult females which is a function of the number of adult females in the two stages denoted by x a f i t i 1 2 of the fertility rates β i t i 1 2 and the development rates g a f i t i 1 2 ii the number of eggs which moves to the first larval instar stage given by the current population and the development rate function g e t at time t and iii the number of eggs which leaves the stage due to mortality which is based on the mortality rate function m e t accordingly the egg stage can be expressed by the following ode 1 d d t x e t g a f 1 t β 1 t x a f 1 t g a f 2 t β 2 t x a f 2 t g e t x e t m e t x e t note that in the most accurate models the mortality rate within equation 1 may explicitly depend on the state since overpopulation in the breeding sites is a common phenomenon in many species see e g otero et al 2006 in this case the mortality rate will be in the form m e t x e t instead of m e t accordingly although for notational simplicity the notation m e t will be maintained throughout the text we remark that in line of principle this rate can also be a function of the state larval stages larval stages are usually composed by a series of identifiable instars whose number varies from species to species although in many models all larval instars are mathematically represented by a single stage di cola et al 1989 picart and ainseba 2011 nance et al 2018 the proposed model allow to generalize to an arbitrary number of instars in general we believe that if the larval instars are identifiable each of them should be treated as a single stage thus contrary to previous works in this work the larval stage is described by n chained equations corresponding to the number of larval instars we denote by x l i t the number of individuals belonging to the i th larval instar at time t the variation of x l i t over time depends on i the number of individuals coming from the previous stage which is a function of the populations of the stage x l i 1 x e t for the first larval instar and the development rate function g l i 1 t g e t for the first larval instar ii the number of individuals that after maturation moves towards the next stage which depends on the corresponding development rate function g l i t at time t and iii the number of individuals that leave the stage due to mortality given by the current number of individuals x l i t and the mortality rate function m l i t mathematically this is described by the ode 2 d d t x l i t g l i 1 t x l i 1 t g l i t x l i t m l i t i 1 n where l 0 denotes the egg stage i e l 0 e note that in this model the last larval stage i e x l n t typically refers either to pupa or to the last nymphal stage depending on the species under study it is worth to remark that also in this case the mortality rate of the preimmaginal stages may depend on the number of individuals in the states and more precisely on the number of insects w r t the food availability hence although for the sake of notation the mortality rate functions of the larval stages are indicated as m l i t it is implicitly meant for some species m l i t x t x l i t in eq 2 a similar discussion can be done for all mortality rates in all development stages of insects life cycle and thus will not be repeated for the next stages note also that in line of principle the development rates may depend on the size of the population adult males since the reproduction is a process that does not involve the preimaginal stages for the sake of simplicity the distinction between sexes is introduced only on the equations describing adults accordingly when the individuals leave the last larval stage they are distributed between adult males and females in proportion to the sex ratio s r in many species this parameter can be considered constant with good approximation but in the case of species which change their sex ratio depending on the period of the year and of environmental and biological parameters e g jarošík et al 2003 s r can be considered as a function of the time s r t as a convention we will denote with s r t the proportion of females within the population the proportion of males is the complement 1 s r t accordingly to this discussion let us introduce the variable x a m t which represents the number of adult males at time t with a similar reasoning to eqs 1 and 2 the variation on the number of adult males x a m t depends on i the number of individuals coming from the last larval instar which is based on x l n t the current number of individuals at that stage the corresponding development rate function g l n t and the sex ratio 1 s r t and ii the number of adults males that leave the stage due to mortality which is based on the current number of individuals x a m t and the mortality rate function for this stage i e m a m t mathematically 3 d d t x a m t 1 s r t g l n t x l n t m a m t x a m t females stage 1 as already mentioned in this model the adult females life stage is described by up two substages depending on the species these two substages can represent different things for instance they can be used to describe two classes of age with different reproduction mortality rates or can be used to distinguish between non mated and mated females the number of female individuals in the adult stage 1 is denoted by x a f 1 one of the inflows of individuals is the portion of the larvae that become females and enter the female stage 1 accordingly to the sex ratio s r t another inflow of individuals is for the species for which it makes sense e g for species where females after oviposition are again fertile the flow of individuals that from the female stage 2 moves back to the female stage 1 this flow is proportional to the transition rate g 1 2 t for species for which this is not the case g 1 2 t 0 the number of individuals leaving the class is the sum of the portion of individuals developing to the next stage accordingly to the transition rate function g 1 2 t and the ones that die accordingly to the mortality rate function m a f 1 t mathematically the equation describing the female stage 1 is 4 d d t x a f 1 t s r t g l n t x l n t g 1 2 t x a f 1 t m a f 1 t x a f 1 t g 1 2 t x a f 2 t it is worth to remark that in the case of a subdivision in non mated and mated females the transition rate g 1 2 t may be a function of the number of males namely g 1 2 t x a m t female stage 2 the variation on the number of individuals x a f 2 t in this stage depends on i the inflow of females from female stage 1 accordingly to the transition rate function g 1 2 t ii the number of females in female stage 2 that moves back to female stage 1 where it makes sense proportionally to the transition rate g 1 2 t iii the number of females which leave the stage due to mortality proportionally to the mortality rate function m a f 2 t mathematically 5 d d t x a f 2 t g 1 2 t x a f 1 t m a f 2 t x a f 2 t g 1 2 t x a f 2 t in the case this stage is not needed for the description of a specific species it is enough to set g 1 2 t 0 model summary the overall system can be written as the following system of odes 6 d d t x e t g a f 1 t β 1 t x a f 1 t g a f 2 t β 2 t x a f 2 t g e t x e t m e t x e t d d t x l 1 t g e t x e t g l 1 t x l 1 t m l 1 t x l 1 t d d t x l n t g l n 1 t x l n 1 t g l n t x l n t m l n t x l n t d d t x a m t 1 s r t g l n t x l n t m a m t x a m t d d t x a f 1 t s r t g l n t x l n t g 1 2 t x a f 1 t m a f 1 t x a f 1 t g 1 2 t x a f 2 t d d t x a f 2 t g 1 2 t x a f 1 t m a f 2 t x a f 2 t g 1 2 t x a f 2 t a list of the variables and functions with their description is reported in table 1 remark as mentioned before the development mortality and fertility rates can be in general not only functions of environmental parameters temperature humidity food availability etc but also of the system state hence it is worth to remind that all the rate functions within the model e g g i t m i t β i t might be in line of principle dependent on the states x t i e g i t x t m i t x t β i t x t more specifically common dependencies are i in the mortality and development rates to represent that overpopulation increases the mortality rate and slows down the development rates see e g the logistic map mohd safuan et al 2012 and ii in the fertility rates or equivalently in the rate g 1 2 t if the substage 2 describes mated females to consider that the probability of a female to procreate depends on the adult males population density anguelov et al 2012 however it must be remarked that for many species of agricultural interest these dependencies on the state can be omitted the reason is that for what concerns the dependency of the rates on overpopulation because of the abundance of food and because of control policies in agriculture is extremely rare that insect populations reach overpopulation numbers araújo et al 2019 note that these kinds of phenomena are instead quite common in forestry contarini et al 2013 elderd et al 2013 and urban areas araújo et al 2019 where treatments are usually not allowed or not convenient for what concerns the dependency of fertility mating rates with the concentration of males for most species this is a saturated function that above a certain male concentration becomes practically a constant rhainds 2010 although important in line of principle for most species this dependency is not well studied and is neglected as it has an effect only for very low population densities or where the number of males is much smaller with respect to the female population rhainds 2010 for most species of agricultural interest this situation does not occur frequently usually it just happen at the very beginning of the growing season after overwintering and is often neglected in the literature note that in the case the rate functions do not depend on the state model 6 becomes a linear time varying system 2 3 connection with existing ode based physiologically based models in this section we show with no seek of completeness how some relevant physiologically based models in the existing literature can be seen as special cases of model 6 ode model from banks et al 2019 this model was introduced by banks et al 2019 to describe a population of homalodisca vitripennis the insect s life cycle was divided in three macro stages namely eggs x e a combined nymphal stage x n and adults x a the mathematical model as presented in the original work is the following 7 d x e d t b t t 270 x a r e t t 270 d e x e d x n d t r e t t 270 x e r n t t 270 d n x n d x a d t r n t t 270 x n d a t t 270 x a where t t 270 is the temperature in c at time t 270 days d e d n and d a are the mortality rate functions r e and r n are the development rate functions and finally b t t 270 is the fertility rate function model 7 can be obtained as a particular case of model 6 making the following positions i the number of preimmaginal stages is n 1 ii there are no males represented by the model namely the equation describing males in the model 6 is omitted iii the transition rates g 1 2 t and g 1 2 t are set to zero and iv the sex ratio s r t 1 given that the males are not included within the model in addition only one female substage is considered the substage 1 accordingly the equation related to x a f 2 t is omitted 6 β 2 t 0 and β 1 t b t t 270 for a summary please refer to table 2 ode model from nance et al 2018 the model was introduced by nance et al 2018 with the aim to represent aedes albopictus population dynamics also in this case the population was divided in three macro stages eggs e larval stages i and adult females the latter contrary to the model of banks et al 7 is divided in two substages the non mated females a h and the mated females a g the resulting system of four odes is written in the original paper as 8 d e d t 1 e k e 1 α p γ a g β a g μ e f e t e d i d t f e t e m i t f i t i d a h d t f i t i m a t μ r f a h t a h γ a g a g d a g d t f a h t a h m a t μ r γ a g a g model 8 can be derived from our model 6 making the following positions see also table 2 i the equation describing egg populations in the model 8 can be obtained by eq 1 considering β 1 t 0 and β 2 t 1 e k e 1 α p β since nance et al indicate with f e t and μ e the egg s development and mortality rates respectively ii the number of larval instars is n 1 iii there are no males in the model hence the adult male state and the associated equation is omitted iv the transition rate g 1 2 t γ a g while g 1 2 t f a h t v the sex ratio s r t 1 since males are not represented in the model vi the adult mortality rate is the sum of two terms namely m a f 1 t m a f 2 t m a t μ r t ode model from manetsch 1976 and vansickle 1977b the model known by the name of distributed delay model represents the ectotherms life cycle considering a series of h age classes not corresponding directly to the identifiable life stages mathematically it is presented as follows 9 d d t q 1 t h g t q 0 t q 1 t 1 1 h g t a r t d d t q 2 t h g t q 1 t q 2 t 1 1 h g t a r t d d t q h t h g t q h 1 t q h t 1 1 h g t a r t where q i t indicates the number of individuals in the i th age class g t is the development rate function and a r t is the mortality rate function model 9 can be obtained from model 6 making the following positions table 2 i there are no males represented by the model accordingly eq 3 is omitted ii only larval stages are considered with a number n h accordingly the egg 1 females of substage 1 4 and females of substage 2 5 equations are not present iii development and mortality rates are the same in all the equations namely m l i t a r t and g l i t h g t respectively ode model from otero et al 2006 this model was introduced by otero et al 2006 with the aim to simulate populations of aedes aegypti the model divides the life cycle of the species in a total of five stages eggs e larvae l pupae p young adult females a 1 and adult females a 2 also in this case the model does not consider the male population mathematically was presented in the original work otero et al 2006 as follows 10 d e d t e g n o v r 1 a 1 o v r 2 a 2 m e e e l r 1 γ l e d l d t e l r 1 γ l e m l l α l 2 l p r l d p d t l p r l m p p p a r p d a 1 d t p a r e f p 2 m a a 1 o v r 1 a 1 d a 2 d t o v r 1 a 1 m a a 2 the model 10 can be obtained from model 6 considering the following positions reported also intable 2 i the model does not describe male populations accordingly the state and the equation describing males are omitted ii the number of preimmaginal stages is n 2 namely larva l and pupa p iii the adult females are divided in two gonotrophic cycles a 1 and a 2 where reproduction is allowed the development rates are g a f 1 t o v r 1 and g a f 2 t o v r 2 respectively iv the average number of eggs laid is provided by the same oviposition rate β 1 t β 2 t e g n v the egg development rate depends also on the population density of larvae l g e t e l r 1 γ l vi larvae and pupae develop with respective rates g l 1 t l p r and g l 2 t p a r vii the sex ratio is s r t 1 2 e f while the transition rates are g 1 2 t 0 and g 1 2 t o v r 1 respectively viii the mortality rates are m e t m e m l 1 t m l α l m l 2 t m p m a f 1 t m a f 2 t m a 2 4 case study the spotted wing drosophila drosophila suzukii in this section we show that the proposed model 6 can be used to define a new model for a pest of high agricultural interest simply by using development fertility and mortality rates available in the literature the effectiveness and the open loop predictivity of the resulting model is demonstrated against data collected between 2017 and 2019 in different locations 2 4 1 biology and development fertility and mortality rate functions the spotted wing drosophila drosophila suzukii is a harmful pest worldwide in most countries it represents an invasive species of more or less recent introduction it originates from asia more specifically from japan kanzawa 1939 and given its capability to adapt to different territories and climates it is now present in north and south america hauser 2011 and in europe calabria et al 2012 where it was firstly detected in spain cini et al 2012 and italy grassi et al 2011 about one decade ago d suzukii is characterized by a high polyphagy and by a short generation time which lead to up to 15 generations in a year cini et al 2012 soft fruit plantations cherry strawberry blueberry apples peaches grapes and more in general prunus and rubus spp walsh et al 2011 ioratti et al 2011 are the most affected crops contrary to other fruit flies the spotted wing drosophila can lay eggs on ripening fruits using its particular serrated ovipositor ryan et al 2016 the damages produced are mainly due to the oviposition and to the larval feeding which makes the fruits unmarketable larvae more specifically develop on the ripening fruits feeding the endocarp tissue and possibly opening access points for secondary pathogens responsible of relevant diseases such as fungi and bacteria this insect is characterized by a sexual dimorphism from where its common name spotted wing drosophila derives males have two black spots on the wings hauser 2011 ibouh et al 2019 this feature represents an important factor for the field monitoring as it allows to more rapidly distinguish them from other similar species unlike males females are at first sight closely similar to other drosophila species cini et al 2012 and the differentiation requires optical instruments such as microscopes to analyse the ovipositor rossini et al 2020a hence to simplify the monitoring activities the data collection for this species typically focuses only on males in this work we propose a model for the life cycle of the spotted wing drosophila consisting of an egg stage three larval instars pupa stage and adult stages accordingly the total number of equations in the model 6 is 8 one for the egg stage four for the larval stages pupa is considered as the last larval instar and one for the adult males non mated females and mated females respectively due to its harmfulness the dependence of d suzukii development fertility and mortality rates on temperature has been studied by several authors tochen et al 2014 emiljanowicz et al 2014 asplen et al 2015 dalton et al 2011 kinjo et al 2014 an exhaustive overview about the main rate functions commonly used to represent the biological features of the spotted wing drosophila can be found in winkler et al 2021 accordingly the literature provides all the information needed to build a specific model using the proposed general model 6 the first expression introduced is the development rate function rossini et al 2020a tested different functions using the data provided in tochen et al 2014 assessing that the briere et al 1999 function 11 was a very good function to describe the relationship between d suzukii development rate and environmental temperature mathematically the briére function is defined as 11 g t a t t t t t l t m t t 1 m where a and m are empirical parameters t l and t m are the lower and upper temperature thresholds below and above which the development of the species theoretically does not occur it is worth to remind the reader that the development rate is defined as the inverse of the development time severini and gilioli 2002 liu et al 1995 damos and savopoulou soultani 2012 rossini et al 2019b even though the spotted wing drosophila is one of the most studied pests there is not sufficient information to estimate the parameters of the function 11 for each life stage accordingly this leads to the unavoidable simplification of considering only one development rate function for all the stages an estimation of the accidental mortality dependent on the temperature was proposed by asplen et al 2015 who interpolated the data provided by dalton et al 2011 kinjo et al 2014 and tochen et al 2014 with a second order polynomial function however this approximation tends to overestimate the mortality in temperature ranges where the development of the species can still be considered near the optimum hence for the purpose of this work we decided to use a more detailed function in particular in this work we considered the fourth order polynomial function 12 m t t a 1 t t 4 b 1 t t 3 c 1 t t 2 d 1 t t e 1 eq 12 is commonly known as the bathtub function and is widely used to represent the dependence of the mortality on temperature wang et al 2002 since it is able to describe the low mortality rates in the optimal temperature ranges and the rapid increase as the thermal thresholds of the species are reached the coefficients a 1 b 1 c 1 d 1 and e 1 in 12 are empirical parameters which in this study are estimated based on the rates provided in a highly detailed study published by ryan et al 2016 the python scripts used to compute the parameters of 12 are publicly available at the github page https github com niboros91 ectotherms ode based model the quality of this polynomial fitting in representing the data from ryan et al 2016 has been assessed with a χ 2 test and considering the coefficient of determination r 2 the values of these measures and of the parameters are reported in table 3 similarly to what we did for the development rate function 11 the same mortality rate will be used for all the stages ranging from egg to pupa however an additional consideration is necessary for all the adult stages referring to the eqs 3 4 and 5 it is possible to notice that there is not an explicit reference to the development rate accordingly the respective mortality rates should take into account of the mortality due to ageing i e the development rate leading to the following modifications 13 m a m t g t m t t m a f 1 t g t m t t m a f 2 t g t m t t where m t t and g t are expressed by the functions 11 and 12 respectively in other words we are considering the mortality rate in the terminal life stages as the sum of the natural mortality ageing and the accidental mortality due for the sake of simplicity to temperature for the temperature dependent birth rate function β 2 t we consider the equation provided by ryan et al 2016 who fitted their experimental data with the following gaussian like function 14 β 2 t t α γ 1 π λ 2 γ 2 λ 2 t t τ 2 δ 2 γ i f t m i n t t t m a x 0 o t h e r w i s e this birth rate function 14 expresses the number of eggs produced per day by the adult mated females as a function of the temperature t m i n and t m a x represent the lower and upper temperature thresholds where the oviposition occurs while α γ λ δ and τ are empirical parameters since for the case under study the adult females substages are defined as non mated and mated we set β 1 0 to the best of our knowledge d suzukii females can mate only once in their life cycle accordingly the transition rate g 1 2 t 0 for the rate g 1 2 t the function g 1 2 t 1 m t t was selected the reason why this is not a function of the number of males in the population is that as already stated in section 2 2 in average conditions the probability that a female meets a male is considered constant the last parameter to be defined is the sex ratio s r t this value has been reported by emiljanowicz et al 2014 as s r 0 5 i e males females 1 1 and for the purposes of this work can be considered in first approximation constant even though it is known that it might in theory change in particular environmental conditions thistlewood et al 2018 for the sake of completeness this section is concluded reporting in table 3 all the numerical values of the parameters that have been included in the model 6 to simulate d suzukii 2 5 numerical scheme for equation solutions since all the rate functions for the developed model depend only on the environmental factors and not on the states 6 is a linear time varying system that can be rewritten as 15 x t a t x t where the matrix in box i is the transition matrix containing all the rate functions and parameters introduced in the previous subsections as it is common in this kind of models the dependency on the temperature should be considered in the average sense rather than as an instantaneous temperature accordingly we will consider average daily temperatures because of this assuming a sampling time t s that is an integer fraction of one day 15 is equivalent to the following discrete time system 17 x t t s e a t t s x t where a t denotes the transition matrix 16 with the temperatures measured at time t in this study the sampling time is set equal to t s 1 d a y from 17 the state of the population at the next sampling time t t s can be obtained based on the current state x t and the computed transition matrix a t all the code to simulate these equations including the parameters and the daily average temperatures for the different growing seasons in exam have been encoded in a matlab script vers r2018b and is publicly available at the github page https github com niboros91 ectotherms ode based model 2 5 1 field trials for model validation to assess the predictive capability of the presented model the experimental dataset of rossini et al 2020a will be considered rossini et al 2020a reports a three year experiment 2017 2019 in an experimental cherry orchard located in montelibretti lazio italy and a two year experiment 2018 2019 in a second cherry orchard located in monterotondo lazio italy the dataset provides the dynamics of adult male flies during the cherry growing season in the period april july in this work we complement the existing dataset with new unpublished data collected in the winter 2018 from july to december 2018 these data are particularly precious for the validation of the model because they allow to simulate and validate more generations in different seasons of the same year the experimental orchards have a surface of 2000 square metres and are cultivated with local mixed cherry varieties we will denote the two experimental fields as montelibretti field and monterotondo field maintaining the same nomenclature used in rossini et al 2020a overall the data collection covers the period from 20 april to 28 june from 19 april to 15 december and from 12 april to 18 july in the years 2017 2018 and 2019 respectively three droso trap biobest waterloo belgium lured with droskidrink azienda agricola prantil priò trento italy were deployed in each field and inspected weekly because of the easier distinguishability of the adult males the population profile was obtained only for this sex daily temperature values were obtained by averaging 24 measurements in 24 h provided by the arsial agency regional agency for the development of innovation and agriculture in lazio arsial 2019 the most interested readers are referred to rossini et al 2020a for further information about the experimental trial simulations and field data can be compared following the procedure already discussed in other works such as bellocchi et al 2011 ikemoto and kiritani 2019 rossini et al 2020c 2021a b 2020b e and combine the use of the χ 2 function and of the coefficient of determination r 2 notably the χ 2 function is used as indicator of the distance among the n points of the simulated and field populations according to this assumption hence the lower is the value of the function more simulations and field data are overlapped however it may happen that in case of high population densities even a small difference between high values can provide high χ 2 values accordingly the coefficient of determination r 2 is introduced to confirm the reliability of the estimations provided by χ 2 an r 2 value close to 1 hence will indicate a high reliability of the simulations in representing field data 3 results in this section we show the results of the open loop simulation and compare them with the data available from the experimental fields the first year of survey 2017 was the year where only data from the montelibretti field were available fig 2 the field population in this year was on the whole low reporting three peaks on 25 april 14 may and 15 june respectively the day zero for the simulations was fixed to 15 march the highest peak was reported on the 15 june the first simulated peak i e half of march end of april was slightly anticipated with respect to the field data despite the low population density assessed the reliability of the model has been confirmed by the χ 2 and r 2 values reported in table 4 the year 2018 was the most complete regarding the data availability and it allows to show the long term behaviour of the model in both fields the day zero for the simulations was fixed to 15 april in the montelibretti field fig 3 the experimental population reported two close peaks on 26 june and 12 july while the simulation reported only a single peak centred on 2 july in the hottest period of the season late july august the model indicated a population density close to zero which started to rise again at the end of september even though the early autumnal generation of the experimental population increased slightly slower with respect to the simulations both peaks were centred on the same day 19 october a similar situation was assessed at the monterotondo field fig 4 where in the first part of the year two peaks were reported at the experimental population on 5 and 19 july while the model provided a single peak centred on 21 july the behaviour during the hottest period of the season was the same assessed at the montelibretti field with a more pronounced increase occurring at the beginning of october in the second part of 2018 both the experimental and simulated populations reported a single peak centred on 26 october and 8 november respectively the numerical consistence of the simulations in representing the field data table 4 confirmed the overall reliability of the model for the 2018 season also due to the length of the survey this season highlights the model behaviour better than the other ones for this reason two additional plots one for each field were reported in figs 5 and 6 with all the d suzukii life stages of the model in the growing season 2019 the last year of survey the day zero for the simulation was fixed to the 18 april in the montelibretti field four population peaks were assessed at the field trials occurring on 25 april 11 may 11 and 28 june respectively while simulations reported only two peaks centred on 1 may and 27 june fig 7 moreover the 2019 montelibretti field reported a population density overall higher with respect to monterotondo field monterotondo field reported three peaks for the experimental populations occurred on 27 april 12 june and 4 july respectively while simulations indicated two peaks centred on 30 april and 25 june fig 8 the higher inhomogeneity of the experimental populations in this season is underlined by the χ 2 values listed in table 4 the highest and the lowest χ 2 values assessed in the three year survey were in fact assessed on 2019 the r 2 values instead confirm the reliability of the model in representing the field data also in 2019 4 discussions and conclusion the case study of d suzukii confirms the reliability of the novel model 6 introduced in this work in representing ectotherms life cycle it is worth to remark that despite the approximations and simplifications due to the lack of more accurate data about the biology of the spotted wing drosophila most notably despite the fact that simulations were performed in open loop the model faithfully describes the trend of all the experimental populations the most interesting results are provided by the growing season 2018 when the field trials provided the longer availability of monitoring data to compare with simulations with a single simulation the model was capable to describe the spring and early middle autumn generations as well as the apparent absence of d suzukii in the late summer the only anomaly that the model was not able to predict was the apparent increase of the experimental population in the late autumn of 2018 this last fact deserves some discussion and represents an interesting starting point for future investigations we believe that a major cause of this apparent increase of the counted number of males might be actually induced by a distortion introduced by the traps in fact the scarcity of food in these fields due to the dormancy of the great part of the wild and cultivated plants occurring in late autumn winter may elicit the adults towards the traps which are food based to look for food accordingly it is reasonable to assume that the high number of captured insects in the late 2018 in both fields may be mostly provoked by an increase of efficiency of the traps due to food scarcity in the fields unfortunately to the best of our knowledge there is no evidence in the current literature to confirm this supposition even though it is suggested by our empirical observations these data however also raise the point that clearly in winter the field population does not go so close to the zero as predicted by the model we believe this is due to the mortality rate function used that overestimates the mortality as the temperature decreases too much it is implicitly supposed that outside the temperature thresholds provided by the briére function the development rate is zero while the mortality rate goes to very high values typically around 1 days 1 or above this is not completely true as showed also by dalton et al 2011 and it is well known that a certain portion of the population is able to survive the entire winter and restart reproduction as temperature raise again we believe that further studies are needed to understand better the winter ecology of the d suzukii from a quantitative point of view the hope is that this would allow to predict numerically the spring generations on the basis of what happens in the previous autumn and on the meteorological features of the winter although additional future validations are necessary and the link between the late autumn generations and the next spring ones have still to be numerically established the existence of such link is well known and documented in the literature marshall et al 2020 deutsch et al 2018 graham 1952 in view of this fact the fact that both simulations and data show a relevant peak of insects in middle october is a highly relevant evidence that is worth to mention it is documented in the current literature cini et al 2012 that this autumn population develops on fruits fallen on the ground before the harvest or on secondary host plants currently in most orchards these insect generations are not controlled by farmers as they occur after the harvest however the high peak reached by this population combined with the fact that this population is likely linked with the amount of successful overwintering insects suggest that it would be convenient to perform autumn winter control actions in order to reduce potential infestations on ripening fruits in the subsequent spring controlling the last generation of d suzukii occurring in the year moreover has the advantage to allow the use of active ingredients in a season where the cherries are not present in the field accordingly a preventive control action can help to reduce the number of treatments during the fruit growing season resulting in a healthier product for consumers overall the model showed the most efficient response in the fields with the higher population densities where the fluctuations in the experimental population were lower note that even though it was assumed that the population peaks correspond to single generations it may happened that in the case of low population densities the peaks correspond to fluctuations of the catches corresponding to the same generation given this fact the model described faithfully the increase and decrease of the populations even in the cases where the peaks of simulated and field populations were not completely overlapped the results presented in this work are in line with the results of rossini et al 2020a where a generalized version of the von foerster equation a first order pde was applied to simulate the same field dataset of the present study contrary to this work however different fertility and mortality rate functions were used moreover the use of the generalized von foerster equation made necessary to run a single simulation for each generation of the year the advantage of a model based on a system of odes is both conceptual and practical as stated in the introduction and the application in the case study of the spotted wing drosophila preliminary confirms this claim using a system of odes instead of pdes to represent ectotherms life cycles is conceptually more natural given the biological subdivision in identifiable and discrete stages note also that pde models like e g the one presented by rossini et al in rossini et al 2020a to be actually simulated need to be discretized this means that through the application of the upwind scheme the continuous age classes are anyway translated in a collection of discrete states transforming de facto the pdes in a system of odes this aspect is not new and has been pointed out by several authors during the years plant and wilson 1986 rossini et al 2020b f bellagamba et al 1987 and buffoni and pasquali 2007 in fact showed how pde models describing populations of ectotherms can be discretized and transformed in systems of odes to be solved accordingly the model presented in this work represents a natural evolution of the mathematical and biological literature on the field in addition the versatility of the odes allows a more reliable description of the phenomenon since it is easier to improve the equations by adding novel functions related to other biological aspects the use of odes to describe biological phenomena has been recently and successfully applied also in systems involving multiple actors such as in the case of xylella fastidiosa brunetti et al 2020 or vegetation physiognomies in the interaction between grass and trees in the savanna yatat djeumen et al 2021 these two models may represent a great potential for future extensions of the general theory introduced with this work among the models used to represent the spotted wing drosophila also the distributed delay model 9 was applied in 2016 gutierrez et al 2016 to predict potential invasions in america europe and mediterranean basin however one of the main issues in applying the ddm is the determination of the number of age classes since there is not a direct connection between the number of equations of the model and the number of identifiable life stages rossini et al 2020b f in addition the ddm expresses difficulties in representing a two sexed populations since there is not a specific equation for males and females the physiologically based model that we have introduced hereby instead not only includes the ddm as special case but has the great advantage to avoid the calibration necessary to determine the number of its age classes an ode approach to simulate d suzukii infestation dynamics was also proposed by pfab et al 2018 w r t the optimal timing for releasing parasitoids in biological control programs different assumptions were made in this case by the authors leading to a non linear system where a time varying delay is considered even though the population dynamics model in pfab et al 2018 can be traced back as particular case of 6 the non linear approach can be surely a good starting point for future improvement of the model 6 applied to the spotted wing drosophila the distinction between the mated and non mated females or more in general between the female stage 1 and female stage 2 makes the representation of the life cycle of most of the ectotherms more realistic at first sight in the case of the spotted wing drosophila one can think to eliminate directly the non mated female stage with a consequent elimination of an equation by the system even if practically this choice can be reasonable with a suitable re tuning of the parameters it is not from a conceptual point of view the transition towards the stage of non mated females in fact is necessary from a biological point of view since the individuals continue to develop before becoming mated it is known from the literature revadi et al 2015 that after the emergence the adult females become mated in a time range of 1 3 days avoiding the non mated stage in the model hence means to anticipate the reproduction of the aforementioned time range introducing a distortion in the description of the population dynamics the same mechanism of reproduction described by our model was presented by nance et al 2018 in the case of the aedes albopictus and by otero et al 2006 in the case of aedes aegypti as showed in section 2 3 the adult females also in this case were distinguished in mated and non mated nance et al 2018 or in two gonotrophic cycles otero et al 2006 even though no reference to the modelling of males is made also in those cases the differentiation of the adult female stage in two substages provided a more reliable description of the life cycle as confirmed by their results the difference of our model with respect to the model of nance et al 2018 and otero et al 2006 is the generalization of the system of odes in order to consider both the sexes and the birth rate in addition we have extended the concept of life stage to all the stages that are entomologically identifiable without considering the preimmaginal stages as a single stage this make the model suitable for most species of agricultural interest given a clear description of the life cycle an implicit assumption of our study and of the great part of the models presented in literature is that the population is closed namely there are no immigration emigration terms future works will extend to the case of open populations migration terms can be introduced in the specific stage equations with slight modifications considering that the incoming outcoming individuals are proportional to specific migration rate functions also here the advantage to have equations specific for each identifiable stage allows to include the biological notions into the model it is known that not all the stages are allowed to move or migrate to be more concrete let us refer to the case of the spotted wing drosophila where the egg and larval instars represent the great part of the life cycle the motion in this part of the life cycle is limited to the plant scale accordingly it is reasonable to say that these are static stages on the other hand adults fly and spread within the field and towards other fields looking for oviposition sites or individuals of the other sex for mating even though the aforementioned example is referred to the case study considered hereby once the biological traits of the species are known the same specific considerations can be done accordingly this aspect leaves to suppose that migration terms can be considered for the model spatialization if the field is subdivided in a lattice it is possible to consider a matrix of local populations able to migrate from neighbouring parcels spatial patterns of insects and animal in general is usually represented with second order pdes where a reaction and a diffusion term is considered ainseba and sebastian 2001 tait et al 2018 di blasio and lamberti 1977 1978 however this representation does not consider the subdivision of the life cycle in physiological age classes age is usually considered as a time nor the dependence of the development on environmental parameters on the other hand other authors gutierrez et al 2016 proposed the insertion of physiologically based models the ddm more specifically in gis systems without considering nevertheless the interaction between neighbouring parcels of the grid the model presented in this work once provided with migration terms can potentially solve the problem of modelling the spatial diffusion of insect pests and ectotherms in general in addition the mathematical representation of males and females provides an advantage in the introduction of migration terms for all the species where the motion is allowed only for one of the two sexes this is for instance the case of the opheroptera brumata where the males can migrate actively and the females can only move passively because of underdeveloped wings tikkanen et al 2000 also considering the aforementioned example o brumata has a different behaviour for males and females since males emerge a week earlier on average with respect to females and can mate multiple times our model with the specific assumptions can describe a behaviour of this type also and it is our main purpose of future developments and studies always remaining in the context of potential applications and future developments it is worth to remind that the results presented in this study were obtained in open loop without using the data collected to improve the estimation at each data collection time the advantage of working with systems of odes and more specifically with linear systems is the possibility to use the theory of the kalman filtering to correct the predictions on the basis of the present and past monitoring data future works will study how the use of kalman filtering can improve the estimation and the prediction of a population behaviour credit authorship contribution statement luca rossini conceptualization methodology software data curation writing original draft writing review editing formal analysis validation nicolás bono rosselló data curation software writing original draft writing review editing visualization stefano speranza investigation resources supervision project administration funding acquisition emanuele garone conceptualization methodology writing original draft writing review editing supervision project administration funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the authors are grateful to the anonymous reviewers for their comments and suggestions which have been greatly helpful for the improvement of this manuscript this work was supported by the european commission under the grant agreement number 774571 project pantheon is funded by the european community horizon 2020 program under grant agreement 774571 the research was carried out in the frame of the miur ministry for education university and research initiative department of excellence law 232 2016 the monitoring data used to pursue the aim of this study were kindly provided by oplatium appendix model characterization a 0 1 stability dependence on temperature all the rate functions involved in the description of d suzukii case study are temperature dependent accordingly the temperature is the driving parameter that influences the dynamics it must be noted that the system obtained for the case of the d suzukii if the temperature is fixed becomes a linear time invariant lti system since the stability properties of a lti system are completely characterized by its eigenvalues the eigenvalues of the matrix 16 in function of the temperature were calculated based on this fig a 1 shows that as temperature approaches to values near the upper and lower thresholds indicated by the briére 11 the system becomes stable all eigenvalues negative suggesting that the population asymptotically decreases towards zero in the optimum temperature range instead the instability of the system is in accordance with the population increase as confirmed also by the comparison between simulations and field data a 0 2 sensitivity analysis let us explore the behaviour of the model applied to d suzukii with respect to the parameters involved for the sake of simplicity temperatures of the montelibretti field in the season 2018 were considered as well as the same time range of the simulation detailed in section 2 5 1 a series of 20000 simulations have been performed considering a random variation of 10 around the values of the briére development rate function 11 listed in table 3 a random variation of 10 of the fertility 14 and mortality rate 12 functions around the daily value calculated in each time step the choice of the aforementioned random variations is mainly due to the biological meaning and importance of the parameters the briére development rate function 11 contains the information of the lower and upper temperature thresholds for the development while the other two empirical parameters are related to the increase of the rate briere et al 1999 for this reason it is worth to consider their variation singularly fertility and mortality rates instead contain only empirical parameters with no biological meaning hence it is worth to explore the random variation around the daily temperature value and not around each single parameter the 20000 simulations are reported in fig a 2 considering only the population of males in order to be coherent with the validation presented in section 3 
24583,the use of correlative ecological niche models has highly increased in the last decade despite all literature and textbooks in this field few practical guidelines exist on the correct application of these techniques we present here a step by step guideline explaining best practices for calculating correlative ecological niche models considering their conceptual and statistical assumptions and limitations we divided the modelling process into four stages 1 data collection and preparation 2 model calculation 3 model evaluation and validation 4 and model application based on ecological niche theory we review the concepts of ecological niche and how they can be modelled classes of correlative models modelling software selection of study area data sources for species records and environmental variables types of species records and their influence on correlative models errors in species records minimum number of species records and environmental variables effects of prevalence sampling design biases and collinearity between variables model calculation model projection to different scenarios in time and space ensemble modelling model validation classification discrimination and calibration metrics calculation of null models analysis of model results and model thresholding this guideline is expected to help potential users to obtain better results when using correlative ecological niche models keywords species distribution models best practices model assumptions and limitations model preparation and parametrization model validation model performance 1 what is ecological niche modelling ecological niche models enms are empirical or mathematical approximations to the ecological niche of a species barbosa et al 2012 enms relate physiological or chorological i e species location data to environmental variables using statistical methods or theoretically derived response surfaces with the aim of describing understanding and or predicting the distribution of species franklin 2010 peterson et al 2011 sillero 2011 barbosa et al 2012 guisan et al 2017 the mathematical output of enms can be an equation relating the expected distribution of the species the dependant variable to a set of environmental predictors the independent variables olivera gomez and mellink 2005 or the response curves describing how each environmental predictor relates to the dependant variable chapman et al 2019 this mathematical model can be spatialised into a cartographic model i e a map representing habitat suitability probability of the species occurrence or the favourability see definition in table 1 for species occurrence acevedo et al 2012 hatten 2014 ørsted and ørsted 2019 therefore enms are predicted in the environmental space and projected to the geographical space see definitions in table 1 enms have wide applicability in numerous fields see table 2 authors use different terms to refer to a family of related concepts and modelling approaches franklin 2010 peterson et al 2011 guisan et al 2017 species distribution model sdm is a more biogeographical term which emphasises the distribution of species and it reflects an interest in historical anthropogenic and population dynamics aspects of the distribution in addition to its environmental drivers sdm has been preferentially used for algorithms that predict occurrence probability thus using species presences and absences guisan and zimmermann 2000 elith and leathwick 2009 climate envelope model cem is specifically focused on the relationship of the species distribution with climate as it uses only climate related predictors and a type of algorithm called envelope hampe 2004 araújo and peterson 2012 booth et al 2014 habitat suitability model hsm normally refers to algorithms predicting how suitable habitats are e g enfa hirzel et al 2002 the term enm is more inclusive as it embraces most types of algorithms to model species distributions mechanistic and correlative methods see below linking them to the ecological niche theory sillero 2011 it helps to keep in mind the importance of ecological niche theory when modelling species distributions sillero 2011 the arrival of easy to use correlative techniques such as maxent phillips et al 2006 revolutionised the field of enms researchers were able to model species distributions without providing explicit observations of absence the outputs were very similar to those provided by presence absence methods variable contributions to the model variable response curves and a map representing a continuous predicted response as opposed to the categorical maps provided by climate envelope algorithms e g bioclim booth et al 2014 with only two classes suitable and unsuitable however what is being modelled is frequently misunderstood sillero 2011 consequently a thorough updated and generic step by step guideline on how to model a species niche is much needed sillero et al 2010 barbosa et al 2012 anderson 2015 jarnevich et al 2015 recent literature has provided sets of standards for niche modelling under different purposes araújo et al 2019 feng et al 2019b sofaer et al 2019b zurell et al 2020 other studies focus on a specific modelling method wilson 2009 merow et al 2013 however an outline of the sequence of key modelling steps including best practices is still lacking misunderstandings and bad practices are still frequent in enms sillero and barbosa 2021 here we present an updated and detailed guide on how to perform correlative ecological niche models aiming to highlight two key points 1 use a modelling method that correctly addresses the research question and 2 interpret enm results correctly 2 ecological niche background many definitions of ecological niche have been proposed over time the grinnellian niche was the first to be defined grinnell 1917 it considers the ecological niche as a subset of the environment containing the habitat conditions that allow the individuals of a species to survive and reproduce grinnell 1917 the habitat is therefore composed of variables the so called scenopoetic variables e g variables able to create scenes that cannot be modified by the species e g climate soberón 2007 grinnell s niche is a property of the environment the eltonian niche was proposed by elton 1927 here the ecological niche is the functional role of a species inside a community elton 1927 mainly according to consumed resources bionomic variables e g nutrients soberón 2007 elton s niche is a property of the ecosystem the hutchinsonian niche provided the first mathematical description of the ecological niche hutchinson 1957 it splits the niche into two categories fundamental and realised niche fig 1 the fundamental niche is the n dimensional hypervolume on the environmental space where a species can maintain a viable population and persist over time without immigration each dimension is an environmental variable the realised niche is the subset of the fundamental niche where the species is not excluded by competition hutchinson 1957 posteriorly other biotic interactions e g predation parasitism symbiosis dispersal ability as well as geographical and historical constraints were also considered limiting the realised niche in what was called occupied niche pearson 2007 hutchinson s niche is a property of the species this niche is a space volume defined by its position boundaries size and shape but it lacks a formal definition of internal heterogeneity according to hutchinson the fundamental niche supposed equal probability of species persistence in all localities and zero survival probability in all points outside the niche given that habitat suitability is a gradient of conditions from optimal to suboptimal a graduality in the niche definition that relates niche to habitat suitability is needed by addressing the task of describing an internal structure of hutchinson s niche niches can be considered as the responses of species to habitat conditions maguire 1973 thus treating the niche as an interaction between the species and the environment maguire s niche is thus a property of the species environment complex some expansions to the niche concept were later introduced with implications for enm interpretation first the potential niche was defined as the part of the fundamental niche that exists on earth at a given time jackson and overpeck 2000 thus part of the fundamental niche is not expressed in the current conditions although it may have been present in the past or may appear in the future this is important for example in predictions of future distributions under climate change scenarios pulliam 1988 applied the source sink theory to the ecological niche populations of a species may occur in unsuitable areas sinks if immigrants are constantly arriving from healthy populations sources therefore species may use a range of environmental conditions larger than their fundamental niche pulliam 1988 this concept is thus crucial for understanding enm results see for example santos et al 2009 silva rocha et al 2015 pulido pastor et al 2018 the occurrence of species in areas deemed as unsuitable by an enm is not necessarily a case of erroneous prediction some populations may live in suboptimal conditions santos et al 2009 silva rocha et al 2015 similarly species can also be absent from suitable areas historical or dispersal reasons for example may prevent the species from arriving at suitable habitats holt 2003 in metapopulation theory levins 1969 many species are considered to live in fragmented suitable habitat patches connected by migration which can be temporarily unoccupied due to demographic stochasticity pulido pastor et al 2021 this is also an important concept to consider when interpreting enm results models can identify suitable habitats that are not occupied by the species and this is not necessarily an error of the model pulido pastor et al 2021 the conceptual differences between the potential and the realised niche can be represented in the biotic abiotic movement diagram bam fig 1 soberón and peterson 2005 the niche is represented by the overlap of three circles in the environmental space each one describing different driving factors the circle a represents the abiotic environmental space where the species populations can survive and persist over time corresponding therefore to the potential niche the circle b is the environmental space where the species is free of biotic exclusion e g by competition the circle m is the environmental space where the species can disperse without limitations the realised niche corresponds to the intersection of the three circles 3 main categories of enms and the species niche they forecast enms may be classified into three main categories mechanistic correlative and hybrid models jiménez valverde et al 2008 dormann et al 2012 depending on how explicitly biological processes e g metabolism are incorporated while mechanistic models typically incorporate physiological morphological and behavioural data kearney and porter 2009 correlative and hybrid models use geographical occurrence data mechanistic models tend to predict the fundamental niche but when expressed in a map it is the potential niche that is forecasted and correlative and hybrid models the realised niche sillero 2011 ideally we should choose the modelling algorithm depending on the research question and not based on the available data guillera arroita et al 2015 3 1 mechanistic models mechanistic niche models allow us to model depict and interrogate species fundamental and potential niches typically phenotypic trait values i e morphology physiology and behaviour of a given organism are translated into performance or fitness components using sets of equations usually mass and energy balance equations that define how these traits interact with the environment porter et al 1973 kearney and porter 2009 kearney et al 2010 buckley et al 2018 that way it is possible to map species potential niches into the landscape at the same time knowing the mechanisms or processes encapsulated by the model explicitly incorporating processes and functional traits are advantages of mechanistic models in doing so they 1 reduce the risk of extrapolation under novel environmental conditions e g when projecting in space or time elith and leathwick 2009 elith et al 2010 2 help to model the very processes limiting distribution ranges and driving range shifts briscoe et al 2016 enriquez urzelai et al 2019 and 3 allow us to account for geographic phenotypic variation phenotypic plasticity and evolutionary adaptation kearney et al 2009 kolbe et al 2010 moran et al 2016 enriquez urzelai et al 2020 as any hypothetical deductive approach mechanistic models can balance conflicting evidence given the theory and thus help to improve theoretical knowledge unfortunately the amount of required data on species traits and the scarcity of available tools e g open source code to fit mechanistic niche models have dragged the use of these models buckley et al 2018 still species trait data and open source code for mechanistic modelling are becoming more readily available e g nichemapr https github com mrke nichemapr and trenchr https github com trenchproject trenchr this together with the current appreciation of the need for accounting for processes in ecology biogeography and climate change biology cabral et al 2017 is opening new horizons for mechanistic niche modelling 3 2 correlative models presence absence presence background and presence only models correlative methods can be classified into three main groups depending on the type of species occurrence data used presence absence presence background or profile and presence only methods presence absence methods use observations of species occurrences and absences absences correspond to places where the species did not occur upon observation i e upon field sampling in theory these methods distinguish the environmental conditions between occupied and non occupied habitats providing the probability of finding the species at each place sillero 2011 the probability of species occurrence in a given habitat represents the proportion of expected occurrence at those specific habitat conditions feller 1968 guisan and zimmermann 2000 the capacity of presence absence methods in correctly distinguishing between probably occupied and probably unoccupied habitats will depend on what types of absences are used see below when georeferenced observations of absences are not available it is possible as well to lattice the study area using a grid of spatial units either arbitrary e g utm cells natural e g river basins or administrative e g municipalities and compute presences as the cells with at least one observation and absences as the cells with no observation of the species cressie 1993 pseudo absences absence points created artificially can also be used as surrogates of true observation of absences presence absence modelling methods include logistic regression brito et al 1999 generalized linear models and generalized additive models guisan et al 2002 random forest breiman 1999 boosted regression trees elith et al 2008 multivariate adaptive regression splines moisen and frescino 2002 and artificial neural networks tarroso et al 2012 these methods can also be used with presence only data when comparing for example occurrence localities of two parapatric species or two species with similar ecology brito and crespo 2002 real et al 2005 arntzen and espregueira themudo 2008 romero et al 2014 torreblanca et al 2019 here the presence of one species does not mean necessarily the absence of the other species rather these models distinguish where a species is more likely to occur regarding its parapatric or ecological counterpart presence background methods compare the available environmental conditions in the study area i e background with the conditions used by the species as represented by its occurrences hirzel et al 2002 phillips et al 2006 all locations in the background where the species did not occur are considered as available and unused conditions in theory presence background methods distinguish between suitable and unsuitable habitats these methods do not provide the probability of finding the species in a given place but an index of habitat suitability i e the quality of the habitat for the survival and persistence of the species sillero 2011 which is specific to each modelling method acevedo et al 2012 in general terms habitat suitability does not assure the presence of the species nor habitat unsuitability assure the absence of the species presence background modelling methods include ecological niche factor analysis enfa hirzel et al 2002 genetic algorithm for rule set production garp stockwell and noble 1992 and maximum entropy maxent phillips et al 2006 s j 2017 despite being erroneously called presence only methods as they do not use absences or pseudo absences they require both presences and background information to compute habitat suitability it is also very frequent to consider the background as equal to pseudo absences although these concepts are not equivalent the background is a representation of the entire study area phillips et al 2009 guillera arroita et al 2014 including presences and absences presence only methods do not use absence nor background data species occurrences are the only species data in the analysis presence only methods include envelope algorithms booth et al 2014 i e methods that define habitat suitability as an n dimensional volume the so called envelope enclosed by the environmental limits inferred by species occurrence in the study area in envelope models suitable habitats can be delimited with different geometric forms such as a rectangle the minimum convex polygon or more complex polygons covering all or most of the occurrences in theory these correlative methods might provide the closest approximation to the potential niche as they may consider suitable any condition in which the species has been observed jiménez valverde et al 2008 sillero 2011 however they may fail to identify sinks pulliam 1988 where conditions do not allow self sustaining populations and presence is only maintained by immigration mahalanobis distance explicitly considers the intensity of occurrence in different conditions but not the relative availability of habitats in the study area clark et al 1993 consequently a widely available habitat that is only partially used can be considered more suitable than a very scarce habitat that is always used presence only methods include overlap analysis brito et al 1999 bioclim nix 1986 booth et al 2014 domain carpenter et al 1993 habitat walker and cocks 1991 and mahalanobis distance clark et al 1993 in summary presence absence methods are in theory generally closer to species distributions while presence background and presence only methods tend to provide larger predictions of the realised niche see however sánchez montes et al 2019 we can say that conceptually the outputs of the latter are intermediate between the realised and potential niches jiménez valverde et al 2008 sillero 2011 for example presence absence models might be conservative to identify new possible locations prone to invasion by an alien species as they aim at predicting occupied niches rather than those suitable areas where the species is not present see however muñoz and real 2006 pereira et al 2020 how close a model is to the species distribution will depend on the biases in the species records presences and absences see below 3 3 hybrid models a third and less explored category involves process orientated models which estimate occupied distribution areas and associated environments from assumptions about niche dimensions biotic interactions and dispersal abilities heisey et al 2010 peterson et al 2015 thus some models can be clearly placed as correlative or process based dormann et al 2012 while most models usually fall somewhere in between that continuum in this sense unlike integrated models where correlative and process based modelling strategies are fitted simultaneously to data e g demography within suitable habitats pagel and schurr 2012 hybrid models use process derived explanatory variables such as dispersal to fit later correlative models zurell 2017 enriquez urzelai et al 2019 4 how to build correlative ecological niche models first we should identify the target ecological niche that will answer the research question of the study in order to select the algorithm accordingly if the research question is to forecast the fundamental or potential niches mechanistic methods should be selected to forecast the realised niche correlative methods should be preferred sillero 2011 to analyse the species observed distribution to understand why the species occurs in some places and not in others due to habitat suitability and other factors such as history anthropogenic effects population dynamics or biotic interactions presence absence methods could be the most helpful however to identify habitat suitability for a given species i e those locations that fit the environmental requirements of the species in the study area presence background or presence only methods may be preferable then the modelling process will be composed of four stages table 3 preparation of all necessary data calculation of models evaluation and validation of models and application of models data preparation is usually the most time consuming as any statistical method enms make some assumptions guisan and thuiller 2005 wiens et al 2009 gallien et al 2012 anderson 2012 1 the species is in equilibrium with the environment i e all suitable habitats are occupied by the species this rarely happens as the capacity of the species to occupy habitats is limited mainly by its dispersal characteristics and biogeographic history i e suitable habitats may occur beyond a geographical barrier which is impossible to cross for the species therefore what should be guaranteed is that the species is in pseudo equilibrium i e the species occupies all suitable habitats where it can disperse thus the study area should not include areas where the species cannot disperse anderson and raza 2010 however chamorro et al 2020 demonstrated that models based on fuzzy set theory can measure the spatial and temporal disequilibrium between a species breeding area and its climatic favourability for breeding although a species is in equilibrium with all the combinations of forces resulting in the current configuration of its distribution including historical ones it does not have to be in equilibrium with each one of them models can assess how the changes in particular favourable conditions attract the species and lead to changes in species distributions chamorro et al 2020 2 the biases in the modelling system are minimal fithian et al 2015 the sampling design should not be focused on particular regions of the study area habitat types or activity periods unfortunately most species surveys are biased to some degree as species occurrences are normally collected near roads or at easily accessible locations also the sampling effort should be homogeneous across the study area the selection of variables for modelling may also be biased some specific variable is selected actively or some important variable for the species is lacking four types of biases should be avoided within the study region anderson 2012 niche space assumption the study area holds all the adequate environmental conditions for the species occurrence dispersal demographic noise assumption the species occupies all suitable areas and is not excluded from some areas due to dispersal establishment and persistence biotic noise assumption the species is not excluded from suitable areas due to biotic interactions human noise assumption the species is not excluded from suitable areas due to human activities 3 all variables included in the model are related to species occurrence this is essential in correlative algorithms if the variable does not have a relationship with the species occurrence e g it does not show spatial variability it should not be included in the model the relationship between the species presences and variables can be analysed with pearson or spearman rank correlations 4 the species niche is conserved across space and time when a species is modelled in a given study area we are assuming that the relationships established between the environmental variables and the species are constant across the study area when a model is projected to another scenario in time or space we are assuming that the conditions defined by the model will be equally maintained if the species has adapted to the new scenario it may have created new environmental relationships and the model will fail to predict them 4 1 preparing the data 4 1 1 available software for modelling several computer programmes are available to run correlative ecological niche models see supplementary text s1 such as maxent phillips et al 2006 2017 biomapper hirzel et al 2002 modeco guo and liu 2010 openmodeller enrique et al 2009 and r rcoreteam 2019 r is the software with more modelling applications see supplementary text s2 4 1 2 selection of the study area once you have determined how to address your objective it is necessary to define the study area models including the entire species range usually provide better results than models of partial distributions barbet massin et al 2010 raes 2012 carretero and sillero 2016 as the study area encloses all the environmental variability of the species range models from partial distributions can fail to forecast the complete species range carretero and sillero 2016 however partial distributions may be better to identify other distribution constraints which may differ in different parts of the distribution range castro et al 2008 martínez freiría et al 2008 vale et al 2015 in any case the exact definition of the limits of the study area is not straightforward jarnevich et al 2017 the study area can strongly affect model results even if jarnevich et al 2017 did not find noticeable differences between four background methods rectangle around presence points minimum convex polygon a binary kernel and a continuous kernel in a specific case study the study area should cover relevant ranges for the variables that are important for the modelled species this can vary between regions as it depends on the spatial arrangement of the relevant variables relative to species occurrences this subject has not yet received enough attention i e acevedo et al 2012 the size of the study area also affects metrics of model performance the discrimination capacity of the models i e the ability to correctly distinguish presence from absence localities see section 3 validating the model for example typically increases with the size of the study area this is mostly because larger areas tend to include absences more ecologically distant from presences which are easier to distinguish lobo et al 2008 vanderwal et al 2009 the calibration capacity how well the model predicts the gradual occurrence probability decreases with the size of the area because larger surfaces tend to include areas far away from presence locations which are not relevant to infer the interaction between the species and the environment acevedo et al 2012 it is important therefore to define the extent and limits of the study area based on scientific criteria for this three main criteria can be followed 1 use biogeographical regions comrie and glenn 1999 sillero 2010 2 avoid areas where the species cannot disperse anderson and raza 2010 and 3 avoid areas where the frequency distribution curves of the values of critical environmental variables are truncated guisan and thuiller 2005 modelling inside a biogeographical region might be the simplest way as they work as relatively contained systems sillero et al 2009 sillero 2010 barve et al 2011 another option is to exclude those areas where the species cannot disperse anderson and raza 2010 not only in current times but also in the past barve et al 2011 in this way we increase the probability of the species being at equilibrium inside the study area and thus the quality of model predictions but how can we define the areas where the species cannot disperse one option is to perform a preliminary spatial model over a large study area to identify those areas outside the species reach barve et al 2011 acevedo et al 2012 another alternative is to reduce the study area to a buffer around the species records phillips et al 2009 báez et al 2020 the size of the buffer is somewhat subjective and the best distance should be selected from different trials or using information about the species dispersal capacity including long distance dispersal events barve et al 2011 when the frequency distribution curves of the values of critical environmental variables are truncated the extent of the study should be increased as it is not including all environmental variability of the species guisan and thuiller 2005 species distributions are affected by biotic interactions human actions or dispersal capacities consequently the study area should contain all environmental conditions required by the species and without significant bias anderson 2013 4 1 3 obtaining occurrence records data sources species occurrence records are indispensable to calculate a correlative niche model presences and depending on the algorithm absences are necessary there are several sources of species presence records amongst the most frequent sources are distribution atlases sillero et al 2014 online databases such as the citizen science based gbif global biodiversity information facility yesson et al 2007 and field collected data recording species locations with a gps will avoid errors and save time sillero et al 2005 the spatial location of absences will determine the results of the model lobo et al 2010 there are three types of absences fig 1 according to the type of information they provide lobo et al 2010 1 contingent absences they correspond to environmentally suitable areas not occupied due to biotic historical and dispersal reasons contingent absences are outside the occupied niche but inside the realised or potential niches they occur at the overlap of two of the three circles represented in the biotic abiotic movement bam diagram fig 1 these absences are informative of historical or dispersal constraints and they are paramount to distinguish between the occupied and the realised niches pearson 2007 they are more likely in localities with suitable environmental conditions that are spatially distant from current populations 2 environmental absences they correspond to environmentally unsuitable areas environmental absences are outside both the realised and potential niches fig 1 these absences define the niche limits if all absences were of this type even presence background methods could infer these environmental conditions directly from presence records they are likely to correspond to locations where environmental conditions are vastly different from those found in the localities of presence if the study area is exceptionally large a huge proportion of the pseudo absences may be in fact environmental absences 3 methodological absences these are false absences created by errors in species surveys methodological absences can be located inside both the realised and the potential niches most modelling methods can correctly deal with methodological absences as far as they are the result of an insufficient but well distributed sampling effort indeed they infer the ecological requirements of the species according to the variation in the proportion of used habitat in the dataset so unbiased false absences do not affect this variation on the other hand spatially or environmentally biased false absences can introduce errors in the models they will reflect the distribution of survey effort rather than the distribution of species unbiased methodological absences are more likely in the environmentally suitable localities placed near the known presence points while biased absences could be anywhere it is important to highlight that a bias in the absences also implies a bias in the presences as false absences are true presences that are missing from the dataset consequently pseudo absences must be created with caution as their placement may strongly affect the results of the models chefaoui and lobo 2008 vanderwal et al 2009 barbet massin et al 2012 pseudo absences can be created from four sources barbet massin et al 2012 senay et al 2013 hertzog et al 2014 1 allopatric species from the presence of sister species with an excluding distribution niamir et al 2016 noticed that the probability of an undetected presence of the target species at localities in which other taxonomically related species were recorded is lower than in those localities without such recordings phillips et al 2009 also explored the use of the occurrences of a target taxonomic group as biased background data as an entire target group of species observed by similar methods will likely share similar bias they found that target group background improved average performance for all the modelling methods they considered 2 environmental absence areas from verified climatically unsuitable areas e g using a model calculated with a mechanistic or a presence background algorithm engler et al 2004 3 random random points across the study area these pseudo absences are similar to the background but excluding locations with presences this is the reason why presence background methods often provide results very similar to models calculated with many random pseudo absences 4 presence areas within and or outside a specified buffer distance around presence locations so that pseudo absences are neither too close nor too far from recorded presences phillips et al 2009 pseudo absences should be close enough to represent areas to where the species could have dispersed if environmental conditions were favourable and to reflect the same spatial bias of the presences therefore avoiding regions that were not surveyed but not so close that they fall within the home range of the recorded presences the best source of pseudo absences depends on the modelling technique barbet massin et al 2012 kanagaraj et al 2013 random selection should be preferred when using classical regression methods like generalized linear models and generalized additive models and geographically and environmentally stratified random selections for machine learning techniques like boosted regression trees classification trees and random forest when biases are present in species surveys selecting pseudo absences considering these biases provides better results hertzog et al 2014 however methods that incorporate environmental stratification of the background are generally better iturbide et al 2015 model results are more affected by sources of bias and by the number of pseudo absences than by the distribution of pseudo absences lobo and tognelli 2011 the best number of pseudo absences depends on the modelling technique barbet massin et al 2012 kanagaraj et al 2013 recommendations include using a large number e g 10 000 of pseudo absences with regression techniques e g generalised linear models and generalised additive models averaging several runs e g 10 with fewer pseudo absences e g 100 for multiple adaptive regression splines and discriminant analysis and using the same number of pseudo absences as the number of available presences averaging several runs if this number is small for classification techniques such as boosted regression trees classification trees and random forests despite all studies analysing how to create pseudo absences true observations of absences always provide better results wisz and guisan 2009 4 1 4 checking species records for errors published occurrence datasets are not free of errors samy et al 2013 beck et al 2014 sillero et al 2014 meyer et al 2016 errors in coordinates must be always checked by plotting and visually inspecting species records on a map there are several other possible sources of error such as 1 species may be erroneously identified if the modeller is not familiar with the taxonomic group these errors are almost impossible to spot especially for widespread species errors can be detected when the species is reported far from its known or plausible distribution range species misidentification may strongly influence enm results costa et al 2015 aubry et al 2017 indeed false presences affect models more than false absences fernandes et al 2019 2 species records may lack spatial coordinates one or both or their values may be erroneously zero this is very frequent in herbaria and museum records but also in online databases such as gbif if references to localities are available it is possible to associate coordinates to those localities online gazetteer services provide coordinates for the localities however if coordinates are obtained from originally coarse locality data a similar accuracy should be maintained in the geo referencing for all records this spatial accuracy should be concordant with the spatial resolution of the environmental variables used for calculating the models this means that the locality reference needs to be accurate unequivocal and appropriately sized localities such as a country or even a county can be misleading unless they are used on an accordingly latticed study area chipperfield et al 2020 3 x and y coordinates may be switched geographical coordinates are traditionally presented as latitude longitude that is as y x thus they can be introduced in the wrong order as the resulting presences can be located very far from their correct positions this error can usually be spotted when mapping them 4 coordinates may have positional errors e g errors in reading coordinates this error is almost impossible to detect if additional information is not provided for example gbif data usually include a column with a measure of positional accuracy although it is not always filled in positional uncertainty can lead to a reduction in prediction accuracy in enms depending on the spatial autocorrelation in predictors and the levels of positional uncertainty the reduction in prediction accuracy is small when the range of spatial autocorrelation in predictors is larger than three times the standard deviation of the positional error naimi et al 2011 some methods such as boosted regression trees and maxent can be more robust to positional errors in presence coordinates graham et al 2007 finally some modelling methods are sensitive to the abundance of species records per pixel e g maxent while habitat suitability and abundance are not directly related dallas and hastings 2018 thus it is necessary to exclude these pseudo replicates or duplicated records from the analysis phillips et al 2006 some modelling programs do this automatically 4 1 5 checking that all points fall inside the study area once the study area is defined it is necessary to check if all the species records are included in the study area some points will often be placed just outside the limits of the study area or located in a region for which the variables have no values for example when modelling species with coastal presences some points may be placed in no data pixels i e on the wrong side of the coastline even if they were correctly recorded with a gps as the limits of the continents used for mapping the variables may not be very precise these points cannot be used for modelling some modelling applications are not able to work with missing values while others exclude these points automatically if a high number of records with good coverage exist losing some points might not constitute a problem in other cases this is not acceptable hence to avoid losing a point we can either manually move it to the nearest valid pixel sillero and carretero 2013 or add a pixel covering the point and assign it the value of the nearest valid pixel which can be done with some gis software or with r 4 1 6 number of species records sample size is amongst the largest sources of variability in prediction accuracy buisson et al 2010 tessarolo et al 2014 thibaud et al 2014 how many species records are necessary to run an enm there is no fixed rule as some algorithms need more records than others for example envelope algorithms such as bioclim can run with as few as three records obviously the prediction may be very large or very small and it will depend completely on the records included maxent generally provides good results with very small sample sizes papes and gaubert 2007 hernandez et al 2008 three records for specialist species and 13 for generalists van proosdij et al 2016 the necessary sample size depends on the extent of the species distribution widespread species will need more samples as their ranges encompass higher environmental variability conversely specialist species require fewer points to get good predictions as all their environmental variability is restricted to particular environmental conditions seoane et al 2005 hernandez et al 2006 tsoar et al 2007 van proosdij et al 2016 for generalised linear models glm and related methods a recommended number of records is 50 8k or 104 k being k the number of variables field et al 2012 according to this a glm will need at least 58 records presences and absences for only one predictor variable another criterion is provided by franklin 2010 a minimum of ten presence records per predictor variable in general model accuracy increases with sample size until an asymptote is reached hirzel and guisan 2002 stockwell and peterson 2002 hernandez et al 2006 wisz et al 2008 often between 20 and 30 presence records stockwell and peterson 2002 when the sample size is very small the determination of variables importance can be affected mitchell et al 2017 an option would be to use ensembles of small models esm modelling all possible combinations of only two variables breiner et al 2015 2018 as for validation a good option would be the leave one out method i e the test dataset is composed of only one occurrence record set aside that changes in each model replicate hernandez et al 2008 shcheglovitova and anderson 2013 4 1 7 effect of prevalence prevalence is the proportion of presences in the dataset i e the number of presences divided by the total number of modelled localities jimenez valverde and lobo 2006 prevalence strongly affects model results hosmer and lemeshow 2000 jiménez valverde et al 2009 royle et al 2012 merow et al 2013 when prevalence is highly biased e g very low or very high proportion of presences it also influences the suitability values however probability may be transformed into favourability real et al 2006 which represents the response of the species to the environmental conditions irrespective of species prevalence therefore the best option is to use the maximum possible number of relevant absences jimenez valverde and lobo 2006 meynard and quinn 2007 jiménez valverde et al 2009 and then convert the predicted probability to favourability e g acevedo and real 2012 4 1 8 sampling design the type of sampling design has an intermediate influence on models although its absence may have strong effects tessarolo et al 2014 thibaud et al 2014 for presence background algorithms the best sampling strategy tends to be equal stratified followed by regular random and proportional stratified for presence absence algorithms the regular and equal stratified strategies are the best followed by proportional stratified and random hirzel and guisan 2002 4 1 9 checking for biases in species records species records can be geographically or environmentally biased both biases can strongly influence the results of the model phillips et al 2009 hijmans 2012 fourcade et al 2014 geographic biases such as partial distributions provide weak results when the aim is to model the realised niche of the species barbet massin et al 2010 however biases are often originated during sampling creating artificial clusters of points around those areas that are most easily accessible for field workers barbosa et al 2012 merow et al 2013 those clusters should be mitigated through a process called thinning or filtering of records veloz 2009 boria et al 2014 varela et al 2014 filtering may be better than restricting the background area kramer schadt et al 2013 another approach is to select a background or pseudo absence sample that reproduces the same bias or clustering pattern as the presence data phillips et al 2009 merow et al 2013 maxent also allows including a raster map representing sampling bias phillips et al 2009 and sampling effort can also be included as a covariate in regression based models see section below filtering species records and biased backgrounds can be used at the same time to reduce bias effects how to reduce the clustering level on species locations there is not a standard procedure the most widely used method to reduce the clustering of species occurrences is to manually remove points until no artificial clusters are apparent and the species distribution looks homogeneous however spatial statistics can help with this issue the clustering level can be measured with the nearest neighbourhood index nni clark and evans 1954 the nni measures the spatial distribution from 0 clustered pattern to 2 15 regularly dispersed uniform pattern values of 1 represent randomly dispersed patterns therefore any time a point or a group of points is deleted from the species locations the nni can be measured until it reaches the value of 1 however deciding what points are deleted is a subjective procedure currently the sdmtoolbox package for arcmap brown 2014 and at least three r packages help to filter species records spthin aiello lammens et al 2015 usdm naimi et al 2014 and spatialeco evans 2021 see supplementary text s2 for a list of available r packages for enms nevertheless we should take care not to remove clusters that reflect areas where species occurrences not just sampled localities are actually more frequent although filtering is necessary when artificial i e sampling driven clusters are present in the species dataset this process reduces the number of points available for modelling thus the number of points deleted must be balanced to obtain a homogeneous intensity of species records that still allows good model performance and accuracy filtering is often confused with reducing autocorrelation spatial autocorrelation is a property of the first law of geography i e tobler s law tobler 1970 everything is related to everything else but near things are more related than distant things this means that closer locations will have similar values environmental variables like temperature and precipitation will generally be more similar between two near locations than between two distant ones this relationship between the values of a variable in different locations is the spatial autocorrelation a special case of correlation in space when there is a relationship between nearby spatial units of the same variable getis 2007 2008 therefore spatial autocorrelation is an important property of both species distributions and the environmental variables as it reflects the spatial structure of their distribution legendre 1993 artificial clustering due to uneven sampling should be reduced on the species locations but the remaining spatial autocorrelation in both presences and environmental variables is a natural property rather than a problem legendre 1993 notwithstanding spatial autocorrelation should be the same for training and test data see below spatial autocorrelation may inflate the estimation of variable importance when the species response to the environmental gradients is linear this inflation effect is larger when the species environmental preferences coincide with the dominant environmental conditions in the study area harisena et al 2021 autocorrelation can be measured with moran s i moran 1950 which ranges from 1 negative autocorrelation through 0 no autocorrelation to 1 positive autocorrelation if there are biases in sampling effort even after filtering the species records a biased raster can be included in maxent phillips et al 2009 or as a covariate in regression based models báez et al 2007 maxent will decrease habitat suitability in those areas with biases the bias file is a representation of the relative sampling intensity across the whole study area the sampling bias file needs to be a continuous or categorical raster grid ascii format with any value above zero for instance if roads are the source of sampling we may calculate a bias raster as a map of proximity to roads another alternative is to compute higher weights around occurrence points the bias file can also be a categorical raster representing sampled and non sampled areas however models with biased rasters are not always better than models without them syfert et al 2013 furthermore proximity to roads may not represent correctly the sampling bias if roads are not climatically biased kadmon et al 2004 another approach is to select a background or a pseudo absence sample showing the same spatial or environmental bias as the sample of presences or as the sample of a target taxonomic group which is surveyed by similar observers with similar methods dudík et al 2005 phillips et al 2009 merow et al 2013 in this way both presences and background or pseudo absences have the same clustered or biased pattern so the model is less misled by the sampling bias and it focuses on the differences between the presence data and the equally biased background or pseudo absence data ferrier et al 2002 phillips et al 2009 this procedure cannot be used with presence only methods 4 1 10 splitting between training and test records ideally the model should be validated with an independent dataset consequently the origin of that dataset should be different collected with different sampling methods by different people or during a different period as an independent dataset would have a different source of biases it can efficiently validate the model unfortunately independent datasets are seldom available an alternative is to split the available species records between training and test records where training records will be used to calculate the model and test records to validate it even if the final model e g for projection or explanation purposes is built on the complete dataset in the end it is necessary to ensure the independence of training and test datasets meaning that they should not have the same spatial autocorrelation structure peterson and soberón 2012 a way of creating two databases not affected by spatial autocorrelation is to choose the points separated by enough distance to minimise autocorrelation this distance can be determined by a semi variogram which represents autocorrelation against distance thus the semi variogram will indicate the distance above which the points are not related to a specific variable in the geographical space although this distance can be different for different variables recent methods for this purpose include block cross validation implemented in the blockcv r package which can generate spatially or environmentally separated folds for cross validation of models valavi et al 2019 4 1 11 obtaining environmental data enms have been traditionally limited to the use of abiotic variables such as climate elevation land use or soil type many different sources of these data are freely available see supplementary text s3 which has contributed to an explosion of ecological niche modelling studies in the last decades there are two main types of data environmental ground data and remote sensing data ground data are collected with fieldwork or by ground based stations such as meteorological stations these data are then transformed into interpolated surfaces packages such as dismo allow interpolating data from ground stations examples of such datasets are worldclim hijmans et al 2005 fick and hijmans 2017 chelsa karger et al 2017 eumedclim fréjaville and benito garzón 2018 cru ts new et al 2002 harris et al 2014 climond kriticos et al 2012 terraclimate abatzoglou et al 2018 merraclim vega et al 2017 or bio oracle tyberghein et al 2012 distinct portals provide datasets for past worldclim paleoclim http www paleoclim org and future worldclim chelsa climate scenarios for land environments and bio oracle for marine environments some wide scale variables may show inaccurate values on a local or regional level bedia et al 2013 or large discrepancies amongst different climate models varela et al 2015 so their use is not recommended particularly when models are to be extrapolated in time when using elevation and its derivates slope aspect topographical indexes as variables some issues must be considered as topographical variables are generally derived using distances they should be calculated in projected coordinate systems in meters geographical coordinate systems e g wgs84 are spherical and thus distances correspond to arc distances and not euclidean distances burrough and mcdonnell 1998 aspect defines the cardinal position of any pixel north south east west and intermediate combinations burrough and mcdonnell 1998 aspect is measured in degrees thus 360 and 0 represent the same value north as modelling algorithms will assume that those two values represent very different positions a better option is to use northness cos aspect or eastness sin aspect which range between 1 full north east respectively and 1 full south west respectively guisan et al 1999 aspect needs to be calculated in radians degrees π 180 remote sensing rs data offer continuous and cost effective measures of both abiotic and biotic factors across space and time hardly quantifiable by other means cord et al 2013 pasetto et al 2018 arenas castro et al 2018 arenas castro and sillero 2021 while recent sensors provide better and more diverse measurements at finer spatial temporal and spectral scales e g sentinel satellite with 10 20 m pixel size berger and aschbacher 2012 many other sensors e g modis of free accessibility and with global coverage provide reliable products from local to landscape scales and for marine to terrestrial ecosystems he et al 2015 the most widely used remote sensors and tools in enms are spaceborne and airborne systems targeting both passive i e using the reflected sunlight and active sensors i e using an artificial light source some examples of passive sensors are aviris 20 m pixel size landsat 15 to 60 m pixel size or modis 250 m to 1 km pixel size while active sensors include lidar and microwave radars however because not all species or habitats can be detected by remote sensors the use of lightweight unmanned aerial vehicles uavs or drones can be a particularly cost efficient way to collect data for model calibration and validation anderson and gaston 2013 although they typically cover smaller extents and their use can be limited by local regulations in supplementary table s1 we provide examples of potential abiotic and biotic rs predictors that have been used widely in enms 4 1 12 number of environmental variables prediction accuracy on model training data generally improves with increasing numbers of variables until an asymptote is reached peterson and cohoon 1999 cumming 2000 however the number of variables should be smaller than the number of species records and an excessively large number of variables will make the model overfit to the training data therefore decreasing its capacity to predict outside the modelled sample for regression based methods the maximum number of variables should be k n 50 8 or k n 104 k being the number of variables and n the number of species records field et al 2012 for the remaining methods there is no generally agreed rule franklin 2010 recommended no more than n 10 predictors being n the number of occurrence records the fewer species records are available the fewer variables should be included in the model in the case of the bioclim algorithm the size of the rectangle used to define the model decreases with the number of combinations of variables beaumont et al 2005 booth et al 2014 4 1 13 clipping variables variables should be clipped or masked by the study area extent to avoid inaccessible or unsurveyed areas being included in the model if the variables have different spatial resolutions maps should normally be aggregated to the coarsest spatial resolution aggregate is a gis function that groups rectangular areas to create larger pixels by applying a mathematical function mean maximum minimum sum range thus the resulting rasters will have fewer pixels the correct way of downscaling climate variables is complex kriticos and leriche 2010 requiring dynamical downscaling for regional models rummukainen 2010 as an alternative microclimatic layers can be derived using mechanistic models enriquez urzelai et al 2019 kearney and porter 2020 if raster maps are to be used directly as input data rather than a table of values but they have a different origin of coordinates the coordinates of the bottom left pixel they will normally need to be resampled so that they perfectly match resample is a gis function that transfers values between non matching rasters in terms of origin and resolution therefore the number of pixels does not change the new properties of the pixels can be transferred from the nearest pixel by bilinear interpolation or by a cubic convolution 4 1 14 checking the correlation between environmental variables most modelling algorithms are sensitive to high levels of correlation amongst predictor variables dormann et al 2013 de marco and nóbrega 2018 feng et al 2019a in general terms a predictor variable is more likely to be erroneously selected higher risk of a type 1 error when high correlations exist between variables in the case of enms high correlations can have two main consequences dormann et al 2013 de marco and nóbrega 2018 feng et al 2019a 1 results will be over fitted and 2 response curves will not be independent i e the response curve of a variable will not represent exclusively that variable but it will include interactions with other correlated variables yet everything in nature is correlated temperature and precipitation are dependant on each other they are influenced by elevation vegetation depends on those variables and so on therefore it is practically impossible to reduce correlation to zero in any natural set of variables normally variables with a correlation stronger than a certain absolute value such as 0 7 or 0 8 should be excluded before modelling dormann et al 2013 lower absolute thresholds of correlation may yield a small number of variables hampering to obtain a good model if too many variables are discarded an alternative is to transform the set of variables using principal component analysis pca vale et al 2016 pérez i de lanuza et al 2018 pca summarises the environmental variables into orthogonal i e completely uncorrelated factors and these factors can be used to model the species niche however the interpretation of the model will be more difficult the most important factor for the model will likely be the first component as it is the factor explaining most of the variability between the predictors then the contributions of each variable to the first component must be analysed to have an idea of which variables are driving the species distribution and in which directions the same for the rest of the components however if the majority of included variables is not relevant for the modelled species the first component might not be the most important for that species but simply describe most of the variation in the candidate variables using any variable from a pair of highly correlated variables provides similar results thus when selecting a variable authors should opt for the one with a more relevant biological meaning such as its capacity to explain the species distribution given its ecology petitpierre et al 2017 correlation can be measured by parametric e g pearson or non parametric e g spearman coefficients field et al 2012 parametric coefficients assume that the residuals follow a normal distribution which can roughly be the case when the study area encompasses an adequate range of environmental variation but it is worth checking it the variance inflation factor vif measures the correlation of each variable with a combination of all the other variables in the model together zuur et al 2010 dormann et al 2013 thus vif measures multicollinearity or the non independence of predictor variables nevertheless the parameters will continue to be unbiased consistent and efficient when forecasting the species niche in a different region or period the model will be efficient only if the same multicollinearity pattern persists in the projected conditions high multicollinearity exists with a vif value higher than 10 kutner et al 2004 more recent studies claim that the limit should be stated between or below as possible as 3 5 even when standard multiple regression and machine learning approaches are usually applied as the case of enms dormann et al 2013 however it is not necessarily good practice to exclude a variable just because it has a high vif i e a high proportion of variation already accounted for other variables in the dataset it could be better to exclude those other variables instead which would also reduce the vif indeed the selection of variables to be included in the model should be based on a trade off between how relevant the variable may be and the expected consistency of that relevance over time and space where the models are fitted 4 2 calculating the model 4 2 1 obtaining mean and standard deviation of replicates if the algorithm selected for running the models has a probability or a random component e g randomly generated pseudo absences any time the models are calculated the results will be slightly different hence it is necessary to run the models several times to get a sample of model variability and get the mean and standard deviation from that set of models 4 2 2 projecting models to other scenarios in time and space models can be transferred to other space and time scenarios the algorithms apply the formula describing the species niche to another set of environmental variables which can correspond to the past e g worldclim offers past climate scenarios for the holocene the last glacial maximum and the last interglacial period to the future e g climate change scenarios for 2050 and 2070 in worldclim or to another geographical region or resolution scale in the present conditions current records cannot be modelled directly against past or future environmental data models should be built using contemporaneous data and then projected to different periods even if we cannot guarantee that the relationships driving the species niche nowadays will be the same in the future or were the same in the past past occurrence data such as historical records or fossils of well preserved taxa can be modelled directly with past environmental variables martínez meyer et al 2004 martínez meyer and peterson 2006 nogués bravo et al 2008 nogués bravo 2009 varela et al 2009 martínez freiría et al 2016 chiarenza et al 2019 4 3 validating the model the validation of ecological niche models is probably the least developed step particularly in the case of presence only and presence background modelling algorithms the predictive performance of ecological niche models can be validated by three components hosmer and lemeshow 2000 pearce and ferrier 2000 leroy et al 2018 classification capacity the ability of the model to correctly classify occupied sites as suitable or probable or favourable and unoccupied sites as the opposite based on a threshold value discrimination capacity the ability of a model to generally separate or distinguish between occupied and unoccupied sites regardless of any threshold value calibration the agreement between predicted probabilities of occurrence and observed proportions of sites occupied calibration is the most faithful assessment of the reliability of the models but it is not easy to measure in all algorithms and thus many authors have focused on classification and discrimination metrics classification is measured by cross classifying observations and predictions of presences and absences in a confusion matrix using a classification threshold and calculating indices of classification performance such as sensitivity specificity precision over prediction under prediction cohen s kappa or the true skill statistic tss fielding and bell 1997 barbosa et al 2013 allouche et al 2016 in the case of presence only or presence background methods absences are not available here classification metrics are relative rather than absolute and it is essential to compare the evaluation metrics with null models see below in addition model predictions represent a gradient that varies continuously and defining a crisp limit between suitable and unsuitable is difficult and artificial although relatively objective thresholds can be defined e g maximum kappa maximum tss equal sensitivity and specificity liu et al 2005 jiménez valverde and lobo 2007 the criteria to select a threshold remain rather subjective as stated in the section application of the model applying a threshold is not mandatory and implies a loss of information discrimination capacity as measured with the area under the curve auc of the receiver operating characteristic roc plot lobo et al 2008 see below is not related to any particular threshold and it yields the probability that a randomly selected presence will have a higher predicted value than a randomly selected absence a statistical significance of the auc may be also obtained mason and graham 2002 however a good model is not expected to discriminate beyond the discrimination that the species itself makes in the environment therefore models of generalist species tend to have lower discrimination capacity than those of specialist species which does not imply that they are worse models goodness of calibration measures how well the estimated probability of presence represents the observed proportion of presences or the agreement between observations and the continuous predicted values pearce and ferrier 2000 jiménez valverde et al 2013 areias guerreiro et al 2016 calibration may be measured with the hosmer and lemeshow goodness of fit test hosmer and lemeshow 2000 for the training data with miller s statistics miller et al 1991 for the validation data with the boyce index for presence background methods boyce et al 2002 and with a presence only calibration poc plot phillips and elith 2010 for presence only methods calibration assumes probability values not suitability or favourability probability values can be derived directly from favourability real et al 2006 acevedo et al 2012 but not from suitability royle et al 2012 4 3 1 obtaining classification and discrimination metrics all classification metrics are based on the confusion matrix fielding and bell 1997 manel et al 2001 liu et al 2011 barbosa et al 2013 amongst those the most prominent metrics are sensitivity and specificity i e the numbers of correctly classified presences and absences respectively because they are the basis for the most widely used evaluation metrics in enms auc and tss auc stands for the area under the curve of the roc receiver operating characteristic plot hanley and mcneil 1982 zweig and campbell 1993 bradley 1997 fawcett 2006 which depicts the true positive rate sensitivity against the false positive rate 1 specificity at all possible classification thresholds auc ranges from 0 to 1 being 0 5 the value for a model with random discrimination therefore any value above 0 5 corresponds to a model with discrimination better than random and any value below 0 5 corresponds to a model with discrimination worse than random inverted predictions probably due to strong biases the value of the auc is mathematically equivalent to the wilcoxon mann whitney u statistic comparing the predicted values for occupied vs unoccupied sites mason and graham 2002 the auc has been criticised as an overall measure of model performance as it is dependant on the extent of the study area lobo et al 2008 if the study area is big enough to have a large proportion of unoccupied habitats very different environmentally from the occupied area absences will be more easily distinguished from presences and thus a not so good model will still obtain a high auc on the contrary if the study area is too small with presences and absences in more similar and even overlapping environmental conditions the auc will have a low value even if the model is good and predicts correctly the distribution of the species let s imagine a model for a species in the mediterranean area it is very easy to increase the auc by adding north africa to the study area as the algorithm will be able to determine that the species does not occur for example in deserts the maximum auc value in a presence background algorithm is 1 a 2 being a the species prevalence phillips et al 2006 smith 2013 for example if a species occupies 60 of the study region the maximum auc will be 1 0 6 2 0 7 unfortunately a is rarely known it can be only inferred from the relative extent of the study area occupied by presences and background in conclusion the auc is only comparable between models based on the same study area and dataset wiley et al 2003 vanderwal et al 2009 to avoid unrealistically high auc values for rare species or large extents we can use the area under the precision recall curve auc pr instead precision is the proportion of localities predicted as suitable that are actually occupied and recall is the proportion of occupied localities predicted as suitable i e the same as sensitivity as it does not incorporate correctly predicted absences the auc pr is robust to species rarity and unlike the auc of the roc curve it is not affected by large geographic extents sofaer et al 2019a the true skill statistic tss is equal to sensitivity specificity 1 allouche et al 2006 tss ranges from 1 to 1 with 0 corresponding to random classification tss also increases with the extent of the study area and it tends to be correlated with auc leroy et al 2018 4 3 2 obtaining calibration metrics miller s statistic is based on the hypothesis that the calibration line perfect calibration has an intercept of zero and a slope of one and it evaluates the capacity of a model to correctly predict the proportion of sites with a particular environmental profile that will be occupied miller et al 1991 pearce and ferrier 2000 wintle et al 2005 the presence only calibration poc plot was designed for presence only algorithms and determines whether predictions are proportional to conditional probability of presence phillips and elith 2010 model predictions are divided into several bins and the fraction of true presences is plotted against the average model value in each bin if the plotted points are lined up close to the diagonal the model is well calibrated the boyce index is the only calibration metric specifically designed for presence background algorithms it measures how much model predictions differ from a random distribution of the observed presences across the prediction gradients boyce et al 2002 it ranges between 1 and 1 positive values indicate a model in which predicted presences are consistent with the distribution of presences in the evaluation dataset values close to zero mean that the model is not statistically different from a random model and negative values indicate counter predictions i e predicting lower suitability in areas where presences are more frequent hirzel et al 2006 4 3 3 calculating null models another way of assessing model performance is to calculate and evaluate null models for comparison raes and ter steege 2007 beale et al 2008 the procedure consists of creating a set of pseudo presence points randomly distributed across the study area running the models and calculating an evaluation metric e g auc or tss the evaluation metrics for the null models can be calculated with the species training and test records as well bohl et al 2019 the objective is to compare evaluation metrics for the species model and the null models with a statistic such as the t test validation metrics should be significantly better for the species models however species prevalence will always affect the result of the evaluation metrics the difference in the evaluation metrics between species models and null models will be smaller as prevalence increases in other words if the species is a generalist and is widely distributed throughout the study area the distribution of its records will be more similar to a set of random points so smaller differences between the species and the null models will be expected independently of how statistically good the model is it may still be biologically meaningless as table 2 shows ecological niche models can be used to analyse the distribution of other entities rather than species it is possible to model road kills sillero 2008 snake bites yañez arenas et al 2014 or bat mortality due to collisions with windmills santos et al 2013 but it is also possible to model any point process biological or not and obtain a statistically good statistical result model results should be checked always for their ecological meaning 4 3 4 comparing models with aic the performance of presence absence and presence background models can be ranked with the akaike information criterion aic warren and seifert 2011 warren et al 2014 aic is an estimate of the relative information lost when implementing a model a trade off between the goodness of fit and the simplicity e g number of parameters of the model hence aic is not a test of a model it does not have a null hypothesis and it does not provide information about the absolute quality of a model aic is a measure of quality relative to other models based on the same species occurrence dataset with different sets of predictor variables or parameters aic increases with information loss thus the best model for a set of occurrence data is the one with the lowest aic warren and seifert 2011 muscarella et al 2014 4 3 5 analysing model results after evaluating and checking the reliability of the results it is possible to analyse the information provided by the model first we can analyse the contribution of the variables to the model or how much variance each variable explains regression based algorithms provide explained deviance or d2 as well as pseudo r2 values the remaining algorithms provide only the importance of the variables most of the non regression based algorithms do not provide information about the statistical significance of the variables although they can provide variable importance metrics some algorithms provide response curves of the variables these curves show how environmental suitability or presence probability changes as a function of each variable it is possible to know which specific environmental conditions the species is preferably inhabiting some algorithms such as maxent calculate the importance of the variables through a jack knife procedure phillips et al 2006 maxent presents two sets of response curves the first one shows the changes in the habitat suitability as each environmental variable is varied keeping all other environmental variables at their average sample value in the second set each curve corresponds to a model calculated with only that variable in the absence of correlation effects between variables both sets of curves should be similar if variables are strongly correlated the response curve does not represent how habitat suitability changes exclusively with that variable as the curve includes the contribution of other correlated variables pure curves are very difficult to obtain because variables always have some degree of correlation only when using the components of a principal component analysis the curves will correspond exclusively to each component but each component will be a linear combination of all variables pérez i de lanuza et al 2018 4 3 6 analysing model projections with clamping maps and extrapolation analysis the next step is to analyse the model projections i e predictions into the same set of variables used to train perform models but expressing other areas or time frames projections can be restricted through clamping maps or carefully inspected for extrapolation through mess multivariate environmental similarity surface elith et al 2010 2011 or exdet extrapolation detection mesgaran et al 2014 clamping maps indicate the values of the variables for the projection scenarios which are outside the modelled range of values let us imagine a linear regression model the regression line of the model will be calibrated for a specific set of environmental values the line i e the model will only be correctly extrapolated if the relationship between occurrences and environmental variables remains the same beyond those values if the relationship changes e g if there is an asymptote or an inflection the model is not fitted for these new values of the variables and results could be wrong elith and leathwick 2009 this rationale is the same for an enm the mathematical part of an enm is a formula relating the species records to a set of environmental variables this formula is applied to the environmental variables to obtain the final model this is the way of projecting a model to other scenarios in time and or space if a model map is produced for the current environmental variables by applying the model formula the same can be done for those variables from other scenarios in time and space however some values of these variables can be outside the range of values analysed by the model the clamping maps will thus indicate the areas where the model is incurring in extrapolation mess and exdet analyses provide an advanced clamping map they indicate what variables and combinations of values are outside the modelled range mess measures the similarity of any given point to a reference set of points in relationship to the variables elith et al 2010 2011 it reports the closeness of the point to the distribution of reference points gives negative values for dissimilar points and maps these values across the whole prediction region exdet measures the similarity between the reference and projection domains by accounting for both the deviation from the mean and the correlation between variables mesgaran et al 2014 4 4 application of the model 4 4 1 ensemble models if several models are calculated with different algorithms they can be merged in an ensemble by e g averaging them araujo and new 2007 marmion et al 2009 several r packages supplementary text s2 such as biomod2 sdm and enmtml allow to calculate ensemble models in several ways thuiller 2003 thuiller et al 2009 naimi and araújo 2016 andrade et al 2020 although ensemble models are often calculated performing an ensemble of good and bad models may not result in the best or even a good model bates and granger 1969 demonstrated that combining forecasts may yield lower mean errors than any of the constituent individual forecasts but only if 1 each of the forecasts was based on variables or information that the other forecasts had not considered and 2 all forecasts were unbiased thus ensemble forecasting should not be blindly used for combining different models based on the same variables in addition enms may yield either probability suitability or favourability values which differ in meaning and are not commensurable royle et al 2012 even suitability values obtained with different algorithms lack commensurability therefore it is advisable not to merge models from different types of algorithms or at least from different types of algorithm families as noise will be introduced in the final ensemble model hao et al 2019 in addition recent studies show no particular advantage of model ensembles over individually tuned models hao et al 2020 alternatively individual models can be overlapped to represent prediction agreement or consensus martínez freiría et al 2017 2020 4 4 2 thresholding the model frequently decision makers and stakeholders prefer to work with model predictions composed of only two categories presence absence or suitable unsuitable it is then necessary to transform the actual model predictions which typically range continuously from 0 to 1 to a binary prediction map with only two classes for that a threshold must be applied to the continuous predictions everything below the threshold will be considered as predicted absence or unfavourable unsuitable areas everything above the threshold will be considered as predicted presences or favourable suitable areas there are many possible thresholds liu et al 2005 jiménez valverde and lobo 2007 freeman and moisen 2008 nenzén and araújo 2011 liu et al 2016 and the choice is largely arbitrary most thresholds are based on some metric from the confusion matrix such as sensitivity and or specificity some of the most used thresholds are the 10 percentile training presence threshold and the maximum training sensitivity plus specificity vale et al 2014 the first one accepts to classify 10 of the presences as false presences the second one maximises the number of presences and absences correctly classified note that the thresholds for presence absence and presence background algorithms are of different power in theory presence absence algorithms compare occupied to unoccupied habitats to predict probable presence and probable absence areas therefore thresholds often take values close to the species prevalence or sometimes mean predicted probability in the modelled sample nenzén and araújo 2011 liu et al 2013 presence background algorithms ideally distinguish suitable from unsuitable habitats based on the presences and a generally large sample of background points thus the selected classification threshold will generally be lower frequently around 0 3 or even lower as suitable habitats include occupied and unoccupied habitats and the ratio of presences background points is usually low for favourability values which are calculated from probability obtained from presence pseudo absence algorithms a threshold of 0 5 will always separate favourable from unfavourable locations regardless of species prevalence jimenez valverde and lobo 2006 real et al 2006 acevedo and real 2012 the transformation of model output values into binary predictions should only be done if necessary as the actual continuous predictions contain important quantitative information binary model predictions may be useful to calculate potential species richness by adding up binary model outputs for a set of species martínez freiría et al 2013 2017 2020 sillero et al 2009 stacking species enms tends to overestimate species numbers methods like the sesam model can correct this over estimation guisan and rahbek 2011 however potential species richness can also be obtained without binary transformation e g by summing up predicted favourabilities for a group of species using fuzzy logic real et al 2017 estrada et al 2018 4 4 3 considering dispersal scenarios when a model is projected to another period species are usually considered to be able to disperse under two contrasting dispersal scenarios no dispersal or unlimited dispersal carvalho et al 2010a the no dispersal model supposes that the species is not able to disperse to new areas thus the projection excludes any newly suitable areas without current observed species presences on the other hand the unlimited dispersal model considers that the species has an unrestricted capacity to disperse to new areas the projection will include all newly suitable areas the reality must be somewhere between those two dispersal scenarios there are tools such as the migclim r package engler and guisan 2009 engler et al 2012 to model the dispersal of a species from the current situation to the projected one it is also possible to calculate the required dispersal rate for a species and compare that to its observed dispersal rates yu et al 2019 5 final remarks enms like any other modelling tool have limitations and conditions to be considered in order to obtain reliable results currently the most important recurrent issue in correlative enms is probably the lack of consistency in guaranteeing that models fulfil all statistical assumptions when applied this is essential for employing enms with certainty in conservation biogeographical and ecological studies in this sense this work aims to provide step by step guidelines for improving the quality of enms studies however there are some issues that still need improvement where future research should focus on one is model validation new validation methods not based on the confusion matrix are necessary especially for algorithms that do not include absences null models should become a standard procedure in the validation process more studies are also needed to clarify the differences between modelling methods as a best algorithm may not exist if each algorithm is a different approximation to species ecological niche another topic in need of further development is how to define the size and shape of the study area through easy to use and objective criteria as stated in this review some of the current criteria are not easy to implement due to the dependence on expert knowledge also further research is necessary for the application of true spatial methods e g auto logistic regressions geographically weighted regressions where the species distribution is modelled directly in geographical rather than in environmental space finally more standard methods are necessary to obtain better species physiological datasets relevant to mechanistic models further combining correlative and mechanistic models will make enms more process based a strong necessity for better establishing cause effect relationship between the environment and species distributions in summary the future of enms is promising but it will only be successful if best practices are reviewed updated and provided to beginners and also more experienced users 6 credit author statement neftalí sillero conceptualization neftalí sillero salvador arenas castro urtzi enriquez urzelai writing original draft preparation neftalí sillero salvador arenas castro urtzi enriquez urzelai cândida gomes vale diana sousa guedes fernando martínez freiría raimundo real a márcia barbosa writing reviewing and editing declaration of competing interest we declare that the manuscript titled want to model a species niche a step by step guideline on correlative ecological niche modelling by neftalí sillero salvador arenas castro urtzi enriquez urzelai cândida gomes vale diana sousa guedes fernando martínez freiría raimundo real and a márcia barbosa has not been published previously and is not under consideration for publication elsewhere that its publication is approved by all authors and tacitly or explicitly by the responsible authorities where the work was carried out and that if accepted it will not be published elsewhere in the same form in english or in any other language including electronically without the written consent of the copyright holder acknowledgements ns is supported by a ceec2017 contract ceecind 02213 2017 sac is supported by the porbiota e infraestrutura portuguesa de informação e investigação em biodiversidade fellowship poci 01 0145 feder 022127 fm f is supported by a contract from fct ref dl57 2016 cp1440 ct0010 supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j ecolmodel 2021 109671 appendix supplementary materials image application 1 image application 2 image application 3 image application 4 
24583,the use of correlative ecological niche models has highly increased in the last decade despite all literature and textbooks in this field few practical guidelines exist on the correct application of these techniques we present here a step by step guideline explaining best practices for calculating correlative ecological niche models considering their conceptual and statistical assumptions and limitations we divided the modelling process into four stages 1 data collection and preparation 2 model calculation 3 model evaluation and validation 4 and model application based on ecological niche theory we review the concepts of ecological niche and how they can be modelled classes of correlative models modelling software selection of study area data sources for species records and environmental variables types of species records and their influence on correlative models errors in species records minimum number of species records and environmental variables effects of prevalence sampling design biases and collinearity between variables model calculation model projection to different scenarios in time and space ensemble modelling model validation classification discrimination and calibration metrics calculation of null models analysis of model results and model thresholding this guideline is expected to help potential users to obtain better results when using correlative ecological niche models keywords species distribution models best practices model assumptions and limitations model preparation and parametrization model validation model performance 1 what is ecological niche modelling ecological niche models enms are empirical or mathematical approximations to the ecological niche of a species barbosa et al 2012 enms relate physiological or chorological i e species location data to environmental variables using statistical methods or theoretically derived response surfaces with the aim of describing understanding and or predicting the distribution of species franklin 2010 peterson et al 2011 sillero 2011 barbosa et al 2012 guisan et al 2017 the mathematical output of enms can be an equation relating the expected distribution of the species the dependant variable to a set of environmental predictors the independent variables olivera gomez and mellink 2005 or the response curves describing how each environmental predictor relates to the dependant variable chapman et al 2019 this mathematical model can be spatialised into a cartographic model i e a map representing habitat suitability probability of the species occurrence or the favourability see definition in table 1 for species occurrence acevedo et al 2012 hatten 2014 ørsted and ørsted 2019 therefore enms are predicted in the environmental space and projected to the geographical space see definitions in table 1 enms have wide applicability in numerous fields see table 2 authors use different terms to refer to a family of related concepts and modelling approaches franklin 2010 peterson et al 2011 guisan et al 2017 species distribution model sdm is a more biogeographical term which emphasises the distribution of species and it reflects an interest in historical anthropogenic and population dynamics aspects of the distribution in addition to its environmental drivers sdm has been preferentially used for algorithms that predict occurrence probability thus using species presences and absences guisan and zimmermann 2000 elith and leathwick 2009 climate envelope model cem is specifically focused on the relationship of the species distribution with climate as it uses only climate related predictors and a type of algorithm called envelope hampe 2004 araújo and peterson 2012 booth et al 2014 habitat suitability model hsm normally refers to algorithms predicting how suitable habitats are e g enfa hirzel et al 2002 the term enm is more inclusive as it embraces most types of algorithms to model species distributions mechanistic and correlative methods see below linking them to the ecological niche theory sillero 2011 it helps to keep in mind the importance of ecological niche theory when modelling species distributions sillero 2011 the arrival of easy to use correlative techniques such as maxent phillips et al 2006 revolutionised the field of enms researchers were able to model species distributions without providing explicit observations of absence the outputs were very similar to those provided by presence absence methods variable contributions to the model variable response curves and a map representing a continuous predicted response as opposed to the categorical maps provided by climate envelope algorithms e g bioclim booth et al 2014 with only two classes suitable and unsuitable however what is being modelled is frequently misunderstood sillero 2011 consequently a thorough updated and generic step by step guideline on how to model a species niche is much needed sillero et al 2010 barbosa et al 2012 anderson 2015 jarnevich et al 2015 recent literature has provided sets of standards for niche modelling under different purposes araújo et al 2019 feng et al 2019b sofaer et al 2019b zurell et al 2020 other studies focus on a specific modelling method wilson 2009 merow et al 2013 however an outline of the sequence of key modelling steps including best practices is still lacking misunderstandings and bad practices are still frequent in enms sillero and barbosa 2021 here we present an updated and detailed guide on how to perform correlative ecological niche models aiming to highlight two key points 1 use a modelling method that correctly addresses the research question and 2 interpret enm results correctly 2 ecological niche background many definitions of ecological niche have been proposed over time the grinnellian niche was the first to be defined grinnell 1917 it considers the ecological niche as a subset of the environment containing the habitat conditions that allow the individuals of a species to survive and reproduce grinnell 1917 the habitat is therefore composed of variables the so called scenopoetic variables e g variables able to create scenes that cannot be modified by the species e g climate soberón 2007 grinnell s niche is a property of the environment the eltonian niche was proposed by elton 1927 here the ecological niche is the functional role of a species inside a community elton 1927 mainly according to consumed resources bionomic variables e g nutrients soberón 2007 elton s niche is a property of the ecosystem the hutchinsonian niche provided the first mathematical description of the ecological niche hutchinson 1957 it splits the niche into two categories fundamental and realised niche fig 1 the fundamental niche is the n dimensional hypervolume on the environmental space where a species can maintain a viable population and persist over time without immigration each dimension is an environmental variable the realised niche is the subset of the fundamental niche where the species is not excluded by competition hutchinson 1957 posteriorly other biotic interactions e g predation parasitism symbiosis dispersal ability as well as geographical and historical constraints were also considered limiting the realised niche in what was called occupied niche pearson 2007 hutchinson s niche is a property of the species this niche is a space volume defined by its position boundaries size and shape but it lacks a formal definition of internal heterogeneity according to hutchinson the fundamental niche supposed equal probability of species persistence in all localities and zero survival probability in all points outside the niche given that habitat suitability is a gradient of conditions from optimal to suboptimal a graduality in the niche definition that relates niche to habitat suitability is needed by addressing the task of describing an internal structure of hutchinson s niche niches can be considered as the responses of species to habitat conditions maguire 1973 thus treating the niche as an interaction between the species and the environment maguire s niche is thus a property of the species environment complex some expansions to the niche concept were later introduced with implications for enm interpretation first the potential niche was defined as the part of the fundamental niche that exists on earth at a given time jackson and overpeck 2000 thus part of the fundamental niche is not expressed in the current conditions although it may have been present in the past or may appear in the future this is important for example in predictions of future distributions under climate change scenarios pulliam 1988 applied the source sink theory to the ecological niche populations of a species may occur in unsuitable areas sinks if immigrants are constantly arriving from healthy populations sources therefore species may use a range of environmental conditions larger than their fundamental niche pulliam 1988 this concept is thus crucial for understanding enm results see for example santos et al 2009 silva rocha et al 2015 pulido pastor et al 2018 the occurrence of species in areas deemed as unsuitable by an enm is not necessarily a case of erroneous prediction some populations may live in suboptimal conditions santos et al 2009 silva rocha et al 2015 similarly species can also be absent from suitable areas historical or dispersal reasons for example may prevent the species from arriving at suitable habitats holt 2003 in metapopulation theory levins 1969 many species are considered to live in fragmented suitable habitat patches connected by migration which can be temporarily unoccupied due to demographic stochasticity pulido pastor et al 2021 this is also an important concept to consider when interpreting enm results models can identify suitable habitats that are not occupied by the species and this is not necessarily an error of the model pulido pastor et al 2021 the conceptual differences between the potential and the realised niche can be represented in the biotic abiotic movement diagram bam fig 1 soberón and peterson 2005 the niche is represented by the overlap of three circles in the environmental space each one describing different driving factors the circle a represents the abiotic environmental space where the species populations can survive and persist over time corresponding therefore to the potential niche the circle b is the environmental space where the species is free of biotic exclusion e g by competition the circle m is the environmental space where the species can disperse without limitations the realised niche corresponds to the intersection of the three circles 3 main categories of enms and the species niche they forecast enms may be classified into three main categories mechanistic correlative and hybrid models jiménez valverde et al 2008 dormann et al 2012 depending on how explicitly biological processes e g metabolism are incorporated while mechanistic models typically incorporate physiological morphological and behavioural data kearney and porter 2009 correlative and hybrid models use geographical occurrence data mechanistic models tend to predict the fundamental niche but when expressed in a map it is the potential niche that is forecasted and correlative and hybrid models the realised niche sillero 2011 ideally we should choose the modelling algorithm depending on the research question and not based on the available data guillera arroita et al 2015 3 1 mechanistic models mechanistic niche models allow us to model depict and interrogate species fundamental and potential niches typically phenotypic trait values i e morphology physiology and behaviour of a given organism are translated into performance or fitness components using sets of equations usually mass and energy balance equations that define how these traits interact with the environment porter et al 1973 kearney and porter 2009 kearney et al 2010 buckley et al 2018 that way it is possible to map species potential niches into the landscape at the same time knowing the mechanisms or processes encapsulated by the model explicitly incorporating processes and functional traits are advantages of mechanistic models in doing so they 1 reduce the risk of extrapolation under novel environmental conditions e g when projecting in space or time elith and leathwick 2009 elith et al 2010 2 help to model the very processes limiting distribution ranges and driving range shifts briscoe et al 2016 enriquez urzelai et al 2019 and 3 allow us to account for geographic phenotypic variation phenotypic plasticity and evolutionary adaptation kearney et al 2009 kolbe et al 2010 moran et al 2016 enriquez urzelai et al 2020 as any hypothetical deductive approach mechanistic models can balance conflicting evidence given the theory and thus help to improve theoretical knowledge unfortunately the amount of required data on species traits and the scarcity of available tools e g open source code to fit mechanistic niche models have dragged the use of these models buckley et al 2018 still species trait data and open source code for mechanistic modelling are becoming more readily available e g nichemapr https github com mrke nichemapr and trenchr https github com trenchproject trenchr this together with the current appreciation of the need for accounting for processes in ecology biogeography and climate change biology cabral et al 2017 is opening new horizons for mechanistic niche modelling 3 2 correlative models presence absence presence background and presence only models correlative methods can be classified into three main groups depending on the type of species occurrence data used presence absence presence background or profile and presence only methods presence absence methods use observations of species occurrences and absences absences correspond to places where the species did not occur upon observation i e upon field sampling in theory these methods distinguish the environmental conditions between occupied and non occupied habitats providing the probability of finding the species at each place sillero 2011 the probability of species occurrence in a given habitat represents the proportion of expected occurrence at those specific habitat conditions feller 1968 guisan and zimmermann 2000 the capacity of presence absence methods in correctly distinguishing between probably occupied and probably unoccupied habitats will depend on what types of absences are used see below when georeferenced observations of absences are not available it is possible as well to lattice the study area using a grid of spatial units either arbitrary e g utm cells natural e g river basins or administrative e g municipalities and compute presences as the cells with at least one observation and absences as the cells with no observation of the species cressie 1993 pseudo absences absence points created artificially can also be used as surrogates of true observation of absences presence absence modelling methods include logistic regression brito et al 1999 generalized linear models and generalized additive models guisan et al 2002 random forest breiman 1999 boosted regression trees elith et al 2008 multivariate adaptive regression splines moisen and frescino 2002 and artificial neural networks tarroso et al 2012 these methods can also be used with presence only data when comparing for example occurrence localities of two parapatric species or two species with similar ecology brito and crespo 2002 real et al 2005 arntzen and espregueira themudo 2008 romero et al 2014 torreblanca et al 2019 here the presence of one species does not mean necessarily the absence of the other species rather these models distinguish where a species is more likely to occur regarding its parapatric or ecological counterpart presence background methods compare the available environmental conditions in the study area i e background with the conditions used by the species as represented by its occurrences hirzel et al 2002 phillips et al 2006 all locations in the background where the species did not occur are considered as available and unused conditions in theory presence background methods distinguish between suitable and unsuitable habitats these methods do not provide the probability of finding the species in a given place but an index of habitat suitability i e the quality of the habitat for the survival and persistence of the species sillero 2011 which is specific to each modelling method acevedo et al 2012 in general terms habitat suitability does not assure the presence of the species nor habitat unsuitability assure the absence of the species presence background modelling methods include ecological niche factor analysis enfa hirzel et al 2002 genetic algorithm for rule set production garp stockwell and noble 1992 and maximum entropy maxent phillips et al 2006 s j 2017 despite being erroneously called presence only methods as they do not use absences or pseudo absences they require both presences and background information to compute habitat suitability it is also very frequent to consider the background as equal to pseudo absences although these concepts are not equivalent the background is a representation of the entire study area phillips et al 2009 guillera arroita et al 2014 including presences and absences presence only methods do not use absence nor background data species occurrences are the only species data in the analysis presence only methods include envelope algorithms booth et al 2014 i e methods that define habitat suitability as an n dimensional volume the so called envelope enclosed by the environmental limits inferred by species occurrence in the study area in envelope models suitable habitats can be delimited with different geometric forms such as a rectangle the minimum convex polygon or more complex polygons covering all or most of the occurrences in theory these correlative methods might provide the closest approximation to the potential niche as they may consider suitable any condition in which the species has been observed jiménez valverde et al 2008 sillero 2011 however they may fail to identify sinks pulliam 1988 where conditions do not allow self sustaining populations and presence is only maintained by immigration mahalanobis distance explicitly considers the intensity of occurrence in different conditions but not the relative availability of habitats in the study area clark et al 1993 consequently a widely available habitat that is only partially used can be considered more suitable than a very scarce habitat that is always used presence only methods include overlap analysis brito et al 1999 bioclim nix 1986 booth et al 2014 domain carpenter et al 1993 habitat walker and cocks 1991 and mahalanobis distance clark et al 1993 in summary presence absence methods are in theory generally closer to species distributions while presence background and presence only methods tend to provide larger predictions of the realised niche see however sánchez montes et al 2019 we can say that conceptually the outputs of the latter are intermediate between the realised and potential niches jiménez valverde et al 2008 sillero 2011 for example presence absence models might be conservative to identify new possible locations prone to invasion by an alien species as they aim at predicting occupied niches rather than those suitable areas where the species is not present see however muñoz and real 2006 pereira et al 2020 how close a model is to the species distribution will depend on the biases in the species records presences and absences see below 3 3 hybrid models a third and less explored category involves process orientated models which estimate occupied distribution areas and associated environments from assumptions about niche dimensions biotic interactions and dispersal abilities heisey et al 2010 peterson et al 2015 thus some models can be clearly placed as correlative or process based dormann et al 2012 while most models usually fall somewhere in between that continuum in this sense unlike integrated models where correlative and process based modelling strategies are fitted simultaneously to data e g demography within suitable habitats pagel and schurr 2012 hybrid models use process derived explanatory variables such as dispersal to fit later correlative models zurell 2017 enriquez urzelai et al 2019 4 how to build correlative ecological niche models first we should identify the target ecological niche that will answer the research question of the study in order to select the algorithm accordingly if the research question is to forecast the fundamental or potential niches mechanistic methods should be selected to forecast the realised niche correlative methods should be preferred sillero 2011 to analyse the species observed distribution to understand why the species occurs in some places and not in others due to habitat suitability and other factors such as history anthropogenic effects population dynamics or biotic interactions presence absence methods could be the most helpful however to identify habitat suitability for a given species i e those locations that fit the environmental requirements of the species in the study area presence background or presence only methods may be preferable then the modelling process will be composed of four stages table 3 preparation of all necessary data calculation of models evaluation and validation of models and application of models data preparation is usually the most time consuming as any statistical method enms make some assumptions guisan and thuiller 2005 wiens et al 2009 gallien et al 2012 anderson 2012 1 the species is in equilibrium with the environment i e all suitable habitats are occupied by the species this rarely happens as the capacity of the species to occupy habitats is limited mainly by its dispersal characteristics and biogeographic history i e suitable habitats may occur beyond a geographical barrier which is impossible to cross for the species therefore what should be guaranteed is that the species is in pseudo equilibrium i e the species occupies all suitable habitats where it can disperse thus the study area should not include areas where the species cannot disperse anderson and raza 2010 however chamorro et al 2020 demonstrated that models based on fuzzy set theory can measure the spatial and temporal disequilibrium between a species breeding area and its climatic favourability for breeding although a species is in equilibrium with all the combinations of forces resulting in the current configuration of its distribution including historical ones it does not have to be in equilibrium with each one of them models can assess how the changes in particular favourable conditions attract the species and lead to changes in species distributions chamorro et al 2020 2 the biases in the modelling system are minimal fithian et al 2015 the sampling design should not be focused on particular regions of the study area habitat types or activity periods unfortunately most species surveys are biased to some degree as species occurrences are normally collected near roads or at easily accessible locations also the sampling effort should be homogeneous across the study area the selection of variables for modelling may also be biased some specific variable is selected actively or some important variable for the species is lacking four types of biases should be avoided within the study region anderson 2012 niche space assumption the study area holds all the adequate environmental conditions for the species occurrence dispersal demographic noise assumption the species occupies all suitable areas and is not excluded from some areas due to dispersal establishment and persistence biotic noise assumption the species is not excluded from suitable areas due to biotic interactions human noise assumption the species is not excluded from suitable areas due to human activities 3 all variables included in the model are related to species occurrence this is essential in correlative algorithms if the variable does not have a relationship with the species occurrence e g it does not show spatial variability it should not be included in the model the relationship between the species presences and variables can be analysed with pearson or spearman rank correlations 4 the species niche is conserved across space and time when a species is modelled in a given study area we are assuming that the relationships established between the environmental variables and the species are constant across the study area when a model is projected to another scenario in time or space we are assuming that the conditions defined by the model will be equally maintained if the species has adapted to the new scenario it may have created new environmental relationships and the model will fail to predict them 4 1 preparing the data 4 1 1 available software for modelling several computer programmes are available to run correlative ecological niche models see supplementary text s1 such as maxent phillips et al 2006 2017 biomapper hirzel et al 2002 modeco guo and liu 2010 openmodeller enrique et al 2009 and r rcoreteam 2019 r is the software with more modelling applications see supplementary text s2 4 1 2 selection of the study area once you have determined how to address your objective it is necessary to define the study area models including the entire species range usually provide better results than models of partial distributions barbet massin et al 2010 raes 2012 carretero and sillero 2016 as the study area encloses all the environmental variability of the species range models from partial distributions can fail to forecast the complete species range carretero and sillero 2016 however partial distributions may be better to identify other distribution constraints which may differ in different parts of the distribution range castro et al 2008 martínez freiría et al 2008 vale et al 2015 in any case the exact definition of the limits of the study area is not straightforward jarnevich et al 2017 the study area can strongly affect model results even if jarnevich et al 2017 did not find noticeable differences between four background methods rectangle around presence points minimum convex polygon a binary kernel and a continuous kernel in a specific case study the study area should cover relevant ranges for the variables that are important for the modelled species this can vary between regions as it depends on the spatial arrangement of the relevant variables relative to species occurrences this subject has not yet received enough attention i e acevedo et al 2012 the size of the study area also affects metrics of model performance the discrimination capacity of the models i e the ability to correctly distinguish presence from absence localities see section 3 validating the model for example typically increases with the size of the study area this is mostly because larger areas tend to include absences more ecologically distant from presences which are easier to distinguish lobo et al 2008 vanderwal et al 2009 the calibration capacity how well the model predicts the gradual occurrence probability decreases with the size of the area because larger surfaces tend to include areas far away from presence locations which are not relevant to infer the interaction between the species and the environment acevedo et al 2012 it is important therefore to define the extent and limits of the study area based on scientific criteria for this three main criteria can be followed 1 use biogeographical regions comrie and glenn 1999 sillero 2010 2 avoid areas where the species cannot disperse anderson and raza 2010 and 3 avoid areas where the frequency distribution curves of the values of critical environmental variables are truncated guisan and thuiller 2005 modelling inside a biogeographical region might be the simplest way as they work as relatively contained systems sillero et al 2009 sillero 2010 barve et al 2011 another option is to exclude those areas where the species cannot disperse anderson and raza 2010 not only in current times but also in the past barve et al 2011 in this way we increase the probability of the species being at equilibrium inside the study area and thus the quality of model predictions but how can we define the areas where the species cannot disperse one option is to perform a preliminary spatial model over a large study area to identify those areas outside the species reach barve et al 2011 acevedo et al 2012 another alternative is to reduce the study area to a buffer around the species records phillips et al 2009 báez et al 2020 the size of the buffer is somewhat subjective and the best distance should be selected from different trials or using information about the species dispersal capacity including long distance dispersal events barve et al 2011 when the frequency distribution curves of the values of critical environmental variables are truncated the extent of the study should be increased as it is not including all environmental variability of the species guisan and thuiller 2005 species distributions are affected by biotic interactions human actions or dispersal capacities consequently the study area should contain all environmental conditions required by the species and without significant bias anderson 2013 4 1 3 obtaining occurrence records data sources species occurrence records are indispensable to calculate a correlative niche model presences and depending on the algorithm absences are necessary there are several sources of species presence records amongst the most frequent sources are distribution atlases sillero et al 2014 online databases such as the citizen science based gbif global biodiversity information facility yesson et al 2007 and field collected data recording species locations with a gps will avoid errors and save time sillero et al 2005 the spatial location of absences will determine the results of the model lobo et al 2010 there are three types of absences fig 1 according to the type of information they provide lobo et al 2010 1 contingent absences they correspond to environmentally suitable areas not occupied due to biotic historical and dispersal reasons contingent absences are outside the occupied niche but inside the realised or potential niches they occur at the overlap of two of the three circles represented in the biotic abiotic movement bam diagram fig 1 these absences are informative of historical or dispersal constraints and they are paramount to distinguish between the occupied and the realised niches pearson 2007 they are more likely in localities with suitable environmental conditions that are spatially distant from current populations 2 environmental absences they correspond to environmentally unsuitable areas environmental absences are outside both the realised and potential niches fig 1 these absences define the niche limits if all absences were of this type even presence background methods could infer these environmental conditions directly from presence records they are likely to correspond to locations where environmental conditions are vastly different from those found in the localities of presence if the study area is exceptionally large a huge proportion of the pseudo absences may be in fact environmental absences 3 methodological absences these are false absences created by errors in species surveys methodological absences can be located inside both the realised and the potential niches most modelling methods can correctly deal with methodological absences as far as they are the result of an insufficient but well distributed sampling effort indeed they infer the ecological requirements of the species according to the variation in the proportion of used habitat in the dataset so unbiased false absences do not affect this variation on the other hand spatially or environmentally biased false absences can introduce errors in the models they will reflect the distribution of survey effort rather than the distribution of species unbiased methodological absences are more likely in the environmentally suitable localities placed near the known presence points while biased absences could be anywhere it is important to highlight that a bias in the absences also implies a bias in the presences as false absences are true presences that are missing from the dataset consequently pseudo absences must be created with caution as their placement may strongly affect the results of the models chefaoui and lobo 2008 vanderwal et al 2009 barbet massin et al 2012 pseudo absences can be created from four sources barbet massin et al 2012 senay et al 2013 hertzog et al 2014 1 allopatric species from the presence of sister species with an excluding distribution niamir et al 2016 noticed that the probability of an undetected presence of the target species at localities in which other taxonomically related species were recorded is lower than in those localities without such recordings phillips et al 2009 also explored the use of the occurrences of a target taxonomic group as biased background data as an entire target group of species observed by similar methods will likely share similar bias they found that target group background improved average performance for all the modelling methods they considered 2 environmental absence areas from verified climatically unsuitable areas e g using a model calculated with a mechanistic or a presence background algorithm engler et al 2004 3 random random points across the study area these pseudo absences are similar to the background but excluding locations with presences this is the reason why presence background methods often provide results very similar to models calculated with many random pseudo absences 4 presence areas within and or outside a specified buffer distance around presence locations so that pseudo absences are neither too close nor too far from recorded presences phillips et al 2009 pseudo absences should be close enough to represent areas to where the species could have dispersed if environmental conditions were favourable and to reflect the same spatial bias of the presences therefore avoiding regions that were not surveyed but not so close that they fall within the home range of the recorded presences the best source of pseudo absences depends on the modelling technique barbet massin et al 2012 kanagaraj et al 2013 random selection should be preferred when using classical regression methods like generalized linear models and generalized additive models and geographically and environmentally stratified random selections for machine learning techniques like boosted regression trees classification trees and random forest when biases are present in species surveys selecting pseudo absences considering these biases provides better results hertzog et al 2014 however methods that incorporate environmental stratification of the background are generally better iturbide et al 2015 model results are more affected by sources of bias and by the number of pseudo absences than by the distribution of pseudo absences lobo and tognelli 2011 the best number of pseudo absences depends on the modelling technique barbet massin et al 2012 kanagaraj et al 2013 recommendations include using a large number e g 10 000 of pseudo absences with regression techniques e g generalised linear models and generalised additive models averaging several runs e g 10 with fewer pseudo absences e g 100 for multiple adaptive regression splines and discriminant analysis and using the same number of pseudo absences as the number of available presences averaging several runs if this number is small for classification techniques such as boosted regression trees classification trees and random forests despite all studies analysing how to create pseudo absences true observations of absences always provide better results wisz and guisan 2009 4 1 4 checking species records for errors published occurrence datasets are not free of errors samy et al 2013 beck et al 2014 sillero et al 2014 meyer et al 2016 errors in coordinates must be always checked by plotting and visually inspecting species records on a map there are several other possible sources of error such as 1 species may be erroneously identified if the modeller is not familiar with the taxonomic group these errors are almost impossible to spot especially for widespread species errors can be detected when the species is reported far from its known or plausible distribution range species misidentification may strongly influence enm results costa et al 2015 aubry et al 2017 indeed false presences affect models more than false absences fernandes et al 2019 2 species records may lack spatial coordinates one or both or their values may be erroneously zero this is very frequent in herbaria and museum records but also in online databases such as gbif if references to localities are available it is possible to associate coordinates to those localities online gazetteer services provide coordinates for the localities however if coordinates are obtained from originally coarse locality data a similar accuracy should be maintained in the geo referencing for all records this spatial accuracy should be concordant with the spatial resolution of the environmental variables used for calculating the models this means that the locality reference needs to be accurate unequivocal and appropriately sized localities such as a country or even a county can be misleading unless they are used on an accordingly latticed study area chipperfield et al 2020 3 x and y coordinates may be switched geographical coordinates are traditionally presented as latitude longitude that is as y x thus they can be introduced in the wrong order as the resulting presences can be located very far from their correct positions this error can usually be spotted when mapping them 4 coordinates may have positional errors e g errors in reading coordinates this error is almost impossible to detect if additional information is not provided for example gbif data usually include a column with a measure of positional accuracy although it is not always filled in positional uncertainty can lead to a reduction in prediction accuracy in enms depending on the spatial autocorrelation in predictors and the levels of positional uncertainty the reduction in prediction accuracy is small when the range of spatial autocorrelation in predictors is larger than three times the standard deviation of the positional error naimi et al 2011 some methods such as boosted regression trees and maxent can be more robust to positional errors in presence coordinates graham et al 2007 finally some modelling methods are sensitive to the abundance of species records per pixel e g maxent while habitat suitability and abundance are not directly related dallas and hastings 2018 thus it is necessary to exclude these pseudo replicates or duplicated records from the analysis phillips et al 2006 some modelling programs do this automatically 4 1 5 checking that all points fall inside the study area once the study area is defined it is necessary to check if all the species records are included in the study area some points will often be placed just outside the limits of the study area or located in a region for which the variables have no values for example when modelling species with coastal presences some points may be placed in no data pixels i e on the wrong side of the coastline even if they were correctly recorded with a gps as the limits of the continents used for mapping the variables may not be very precise these points cannot be used for modelling some modelling applications are not able to work with missing values while others exclude these points automatically if a high number of records with good coverage exist losing some points might not constitute a problem in other cases this is not acceptable hence to avoid losing a point we can either manually move it to the nearest valid pixel sillero and carretero 2013 or add a pixel covering the point and assign it the value of the nearest valid pixel which can be done with some gis software or with r 4 1 6 number of species records sample size is amongst the largest sources of variability in prediction accuracy buisson et al 2010 tessarolo et al 2014 thibaud et al 2014 how many species records are necessary to run an enm there is no fixed rule as some algorithms need more records than others for example envelope algorithms such as bioclim can run with as few as three records obviously the prediction may be very large or very small and it will depend completely on the records included maxent generally provides good results with very small sample sizes papes and gaubert 2007 hernandez et al 2008 three records for specialist species and 13 for generalists van proosdij et al 2016 the necessary sample size depends on the extent of the species distribution widespread species will need more samples as their ranges encompass higher environmental variability conversely specialist species require fewer points to get good predictions as all their environmental variability is restricted to particular environmental conditions seoane et al 2005 hernandez et al 2006 tsoar et al 2007 van proosdij et al 2016 for generalised linear models glm and related methods a recommended number of records is 50 8k or 104 k being k the number of variables field et al 2012 according to this a glm will need at least 58 records presences and absences for only one predictor variable another criterion is provided by franklin 2010 a minimum of ten presence records per predictor variable in general model accuracy increases with sample size until an asymptote is reached hirzel and guisan 2002 stockwell and peterson 2002 hernandez et al 2006 wisz et al 2008 often between 20 and 30 presence records stockwell and peterson 2002 when the sample size is very small the determination of variables importance can be affected mitchell et al 2017 an option would be to use ensembles of small models esm modelling all possible combinations of only two variables breiner et al 2015 2018 as for validation a good option would be the leave one out method i e the test dataset is composed of only one occurrence record set aside that changes in each model replicate hernandez et al 2008 shcheglovitova and anderson 2013 4 1 7 effect of prevalence prevalence is the proportion of presences in the dataset i e the number of presences divided by the total number of modelled localities jimenez valverde and lobo 2006 prevalence strongly affects model results hosmer and lemeshow 2000 jiménez valverde et al 2009 royle et al 2012 merow et al 2013 when prevalence is highly biased e g very low or very high proportion of presences it also influences the suitability values however probability may be transformed into favourability real et al 2006 which represents the response of the species to the environmental conditions irrespective of species prevalence therefore the best option is to use the maximum possible number of relevant absences jimenez valverde and lobo 2006 meynard and quinn 2007 jiménez valverde et al 2009 and then convert the predicted probability to favourability e g acevedo and real 2012 4 1 8 sampling design the type of sampling design has an intermediate influence on models although its absence may have strong effects tessarolo et al 2014 thibaud et al 2014 for presence background algorithms the best sampling strategy tends to be equal stratified followed by regular random and proportional stratified for presence absence algorithms the regular and equal stratified strategies are the best followed by proportional stratified and random hirzel and guisan 2002 4 1 9 checking for biases in species records species records can be geographically or environmentally biased both biases can strongly influence the results of the model phillips et al 2009 hijmans 2012 fourcade et al 2014 geographic biases such as partial distributions provide weak results when the aim is to model the realised niche of the species barbet massin et al 2010 however biases are often originated during sampling creating artificial clusters of points around those areas that are most easily accessible for field workers barbosa et al 2012 merow et al 2013 those clusters should be mitigated through a process called thinning or filtering of records veloz 2009 boria et al 2014 varela et al 2014 filtering may be better than restricting the background area kramer schadt et al 2013 another approach is to select a background or pseudo absence sample that reproduces the same bias or clustering pattern as the presence data phillips et al 2009 merow et al 2013 maxent also allows including a raster map representing sampling bias phillips et al 2009 and sampling effort can also be included as a covariate in regression based models see section below filtering species records and biased backgrounds can be used at the same time to reduce bias effects how to reduce the clustering level on species locations there is not a standard procedure the most widely used method to reduce the clustering of species occurrences is to manually remove points until no artificial clusters are apparent and the species distribution looks homogeneous however spatial statistics can help with this issue the clustering level can be measured with the nearest neighbourhood index nni clark and evans 1954 the nni measures the spatial distribution from 0 clustered pattern to 2 15 regularly dispersed uniform pattern values of 1 represent randomly dispersed patterns therefore any time a point or a group of points is deleted from the species locations the nni can be measured until it reaches the value of 1 however deciding what points are deleted is a subjective procedure currently the sdmtoolbox package for arcmap brown 2014 and at least three r packages help to filter species records spthin aiello lammens et al 2015 usdm naimi et al 2014 and spatialeco evans 2021 see supplementary text s2 for a list of available r packages for enms nevertheless we should take care not to remove clusters that reflect areas where species occurrences not just sampled localities are actually more frequent although filtering is necessary when artificial i e sampling driven clusters are present in the species dataset this process reduces the number of points available for modelling thus the number of points deleted must be balanced to obtain a homogeneous intensity of species records that still allows good model performance and accuracy filtering is often confused with reducing autocorrelation spatial autocorrelation is a property of the first law of geography i e tobler s law tobler 1970 everything is related to everything else but near things are more related than distant things this means that closer locations will have similar values environmental variables like temperature and precipitation will generally be more similar between two near locations than between two distant ones this relationship between the values of a variable in different locations is the spatial autocorrelation a special case of correlation in space when there is a relationship between nearby spatial units of the same variable getis 2007 2008 therefore spatial autocorrelation is an important property of both species distributions and the environmental variables as it reflects the spatial structure of their distribution legendre 1993 artificial clustering due to uneven sampling should be reduced on the species locations but the remaining spatial autocorrelation in both presences and environmental variables is a natural property rather than a problem legendre 1993 notwithstanding spatial autocorrelation should be the same for training and test data see below spatial autocorrelation may inflate the estimation of variable importance when the species response to the environmental gradients is linear this inflation effect is larger when the species environmental preferences coincide with the dominant environmental conditions in the study area harisena et al 2021 autocorrelation can be measured with moran s i moran 1950 which ranges from 1 negative autocorrelation through 0 no autocorrelation to 1 positive autocorrelation if there are biases in sampling effort even after filtering the species records a biased raster can be included in maxent phillips et al 2009 or as a covariate in regression based models báez et al 2007 maxent will decrease habitat suitability in those areas with biases the bias file is a representation of the relative sampling intensity across the whole study area the sampling bias file needs to be a continuous or categorical raster grid ascii format with any value above zero for instance if roads are the source of sampling we may calculate a bias raster as a map of proximity to roads another alternative is to compute higher weights around occurrence points the bias file can also be a categorical raster representing sampled and non sampled areas however models with biased rasters are not always better than models without them syfert et al 2013 furthermore proximity to roads may not represent correctly the sampling bias if roads are not climatically biased kadmon et al 2004 another approach is to select a background or a pseudo absence sample showing the same spatial or environmental bias as the sample of presences or as the sample of a target taxonomic group which is surveyed by similar observers with similar methods dudík et al 2005 phillips et al 2009 merow et al 2013 in this way both presences and background or pseudo absences have the same clustered or biased pattern so the model is less misled by the sampling bias and it focuses on the differences between the presence data and the equally biased background or pseudo absence data ferrier et al 2002 phillips et al 2009 this procedure cannot be used with presence only methods 4 1 10 splitting between training and test records ideally the model should be validated with an independent dataset consequently the origin of that dataset should be different collected with different sampling methods by different people or during a different period as an independent dataset would have a different source of biases it can efficiently validate the model unfortunately independent datasets are seldom available an alternative is to split the available species records between training and test records where training records will be used to calculate the model and test records to validate it even if the final model e g for projection or explanation purposes is built on the complete dataset in the end it is necessary to ensure the independence of training and test datasets meaning that they should not have the same spatial autocorrelation structure peterson and soberón 2012 a way of creating two databases not affected by spatial autocorrelation is to choose the points separated by enough distance to minimise autocorrelation this distance can be determined by a semi variogram which represents autocorrelation against distance thus the semi variogram will indicate the distance above which the points are not related to a specific variable in the geographical space although this distance can be different for different variables recent methods for this purpose include block cross validation implemented in the blockcv r package which can generate spatially or environmentally separated folds for cross validation of models valavi et al 2019 4 1 11 obtaining environmental data enms have been traditionally limited to the use of abiotic variables such as climate elevation land use or soil type many different sources of these data are freely available see supplementary text s3 which has contributed to an explosion of ecological niche modelling studies in the last decades there are two main types of data environmental ground data and remote sensing data ground data are collected with fieldwork or by ground based stations such as meteorological stations these data are then transformed into interpolated surfaces packages such as dismo allow interpolating data from ground stations examples of such datasets are worldclim hijmans et al 2005 fick and hijmans 2017 chelsa karger et al 2017 eumedclim fréjaville and benito garzón 2018 cru ts new et al 2002 harris et al 2014 climond kriticos et al 2012 terraclimate abatzoglou et al 2018 merraclim vega et al 2017 or bio oracle tyberghein et al 2012 distinct portals provide datasets for past worldclim paleoclim http www paleoclim org and future worldclim chelsa climate scenarios for land environments and bio oracle for marine environments some wide scale variables may show inaccurate values on a local or regional level bedia et al 2013 or large discrepancies amongst different climate models varela et al 2015 so their use is not recommended particularly when models are to be extrapolated in time when using elevation and its derivates slope aspect topographical indexes as variables some issues must be considered as topographical variables are generally derived using distances they should be calculated in projected coordinate systems in meters geographical coordinate systems e g wgs84 are spherical and thus distances correspond to arc distances and not euclidean distances burrough and mcdonnell 1998 aspect defines the cardinal position of any pixel north south east west and intermediate combinations burrough and mcdonnell 1998 aspect is measured in degrees thus 360 and 0 represent the same value north as modelling algorithms will assume that those two values represent very different positions a better option is to use northness cos aspect or eastness sin aspect which range between 1 full north east respectively and 1 full south west respectively guisan et al 1999 aspect needs to be calculated in radians degrees π 180 remote sensing rs data offer continuous and cost effective measures of both abiotic and biotic factors across space and time hardly quantifiable by other means cord et al 2013 pasetto et al 2018 arenas castro et al 2018 arenas castro and sillero 2021 while recent sensors provide better and more diverse measurements at finer spatial temporal and spectral scales e g sentinel satellite with 10 20 m pixel size berger and aschbacher 2012 many other sensors e g modis of free accessibility and with global coverage provide reliable products from local to landscape scales and for marine to terrestrial ecosystems he et al 2015 the most widely used remote sensors and tools in enms are spaceborne and airborne systems targeting both passive i e using the reflected sunlight and active sensors i e using an artificial light source some examples of passive sensors are aviris 20 m pixel size landsat 15 to 60 m pixel size or modis 250 m to 1 km pixel size while active sensors include lidar and microwave radars however because not all species or habitats can be detected by remote sensors the use of lightweight unmanned aerial vehicles uavs or drones can be a particularly cost efficient way to collect data for model calibration and validation anderson and gaston 2013 although they typically cover smaller extents and their use can be limited by local regulations in supplementary table s1 we provide examples of potential abiotic and biotic rs predictors that have been used widely in enms 4 1 12 number of environmental variables prediction accuracy on model training data generally improves with increasing numbers of variables until an asymptote is reached peterson and cohoon 1999 cumming 2000 however the number of variables should be smaller than the number of species records and an excessively large number of variables will make the model overfit to the training data therefore decreasing its capacity to predict outside the modelled sample for regression based methods the maximum number of variables should be k n 50 8 or k n 104 k being the number of variables and n the number of species records field et al 2012 for the remaining methods there is no generally agreed rule franklin 2010 recommended no more than n 10 predictors being n the number of occurrence records the fewer species records are available the fewer variables should be included in the model in the case of the bioclim algorithm the size of the rectangle used to define the model decreases with the number of combinations of variables beaumont et al 2005 booth et al 2014 4 1 13 clipping variables variables should be clipped or masked by the study area extent to avoid inaccessible or unsurveyed areas being included in the model if the variables have different spatial resolutions maps should normally be aggregated to the coarsest spatial resolution aggregate is a gis function that groups rectangular areas to create larger pixels by applying a mathematical function mean maximum minimum sum range thus the resulting rasters will have fewer pixels the correct way of downscaling climate variables is complex kriticos and leriche 2010 requiring dynamical downscaling for regional models rummukainen 2010 as an alternative microclimatic layers can be derived using mechanistic models enriquez urzelai et al 2019 kearney and porter 2020 if raster maps are to be used directly as input data rather than a table of values but they have a different origin of coordinates the coordinates of the bottom left pixel they will normally need to be resampled so that they perfectly match resample is a gis function that transfers values between non matching rasters in terms of origin and resolution therefore the number of pixels does not change the new properties of the pixels can be transferred from the nearest pixel by bilinear interpolation or by a cubic convolution 4 1 14 checking the correlation between environmental variables most modelling algorithms are sensitive to high levels of correlation amongst predictor variables dormann et al 2013 de marco and nóbrega 2018 feng et al 2019a in general terms a predictor variable is more likely to be erroneously selected higher risk of a type 1 error when high correlations exist between variables in the case of enms high correlations can have two main consequences dormann et al 2013 de marco and nóbrega 2018 feng et al 2019a 1 results will be over fitted and 2 response curves will not be independent i e the response curve of a variable will not represent exclusively that variable but it will include interactions with other correlated variables yet everything in nature is correlated temperature and precipitation are dependant on each other they are influenced by elevation vegetation depends on those variables and so on therefore it is practically impossible to reduce correlation to zero in any natural set of variables normally variables with a correlation stronger than a certain absolute value such as 0 7 or 0 8 should be excluded before modelling dormann et al 2013 lower absolute thresholds of correlation may yield a small number of variables hampering to obtain a good model if too many variables are discarded an alternative is to transform the set of variables using principal component analysis pca vale et al 2016 pérez i de lanuza et al 2018 pca summarises the environmental variables into orthogonal i e completely uncorrelated factors and these factors can be used to model the species niche however the interpretation of the model will be more difficult the most important factor for the model will likely be the first component as it is the factor explaining most of the variability between the predictors then the contributions of each variable to the first component must be analysed to have an idea of which variables are driving the species distribution and in which directions the same for the rest of the components however if the majority of included variables is not relevant for the modelled species the first component might not be the most important for that species but simply describe most of the variation in the candidate variables using any variable from a pair of highly correlated variables provides similar results thus when selecting a variable authors should opt for the one with a more relevant biological meaning such as its capacity to explain the species distribution given its ecology petitpierre et al 2017 correlation can be measured by parametric e g pearson or non parametric e g spearman coefficients field et al 2012 parametric coefficients assume that the residuals follow a normal distribution which can roughly be the case when the study area encompasses an adequate range of environmental variation but it is worth checking it the variance inflation factor vif measures the correlation of each variable with a combination of all the other variables in the model together zuur et al 2010 dormann et al 2013 thus vif measures multicollinearity or the non independence of predictor variables nevertheless the parameters will continue to be unbiased consistent and efficient when forecasting the species niche in a different region or period the model will be efficient only if the same multicollinearity pattern persists in the projected conditions high multicollinearity exists with a vif value higher than 10 kutner et al 2004 more recent studies claim that the limit should be stated between or below as possible as 3 5 even when standard multiple regression and machine learning approaches are usually applied as the case of enms dormann et al 2013 however it is not necessarily good practice to exclude a variable just because it has a high vif i e a high proportion of variation already accounted for other variables in the dataset it could be better to exclude those other variables instead which would also reduce the vif indeed the selection of variables to be included in the model should be based on a trade off between how relevant the variable may be and the expected consistency of that relevance over time and space where the models are fitted 4 2 calculating the model 4 2 1 obtaining mean and standard deviation of replicates if the algorithm selected for running the models has a probability or a random component e g randomly generated pseudo absences any time the models are calculated the results will be slightly different hence it is necessary to run the models several times to get a sample of model variability and get the mean and standard deviation from that set of models 4 2 2 projecting models to other scenarios in time and space models can be transferred to other space and time scenarios the algorithms apply the formula describing the species niche to another set of environmental variables which can correspond to the past e g worldclim offers past climate scenarios for the holocene the last glacial maximum and the last interglacial period to the future e g climate change scenarios for 2050 and 2070 in worldclim or to another geographical region or resolution scale in the present conditions current records cannot be modelled directly against past or future environmental data models should be built using contemporaneous data and then projected to different periods even if we cannot guarantee that the relationships driving the species niche nowadays will be the same in the future or were the same in the past past occurrence data such as historical records or fossils of well preserved taxa can be modelled directly with past environmental variables martínez meyer et al 2004 martínez meyer and peterson 2006 nogués bravo et al 2008 nogués bravo 2009 varela et al 2009 martínez freiría et al 2016 chiarenza et al 2019 4 3 validating the model the validation of ecological niche models is probably the least developed step particularly in the case of presence only and presence background modelling algorithms the predictive performance of ecological niche models can be validated by three components hosmer and lemeshow 2000 pearce and ferrier 2000 leroy et al 2018 classification capacity the ability of the model to correctly classify occupied sites as suitable or probable or favourable and unoccupied sites as the opposite based on a threshold value discrimination capacity the ability of a model to generally separate or distinguish between occupied and unoccupied sites regardless of any threshold value calibration the agreement between predicted probabilities of occurrence and observed proportions of sites occupied calibration is the most faithful assessment of the reliability of the models but it is not easy to measure in all algorithms and thus many authors have focused on classification and discrimination metrics classification is measured by cross classifying observations and predictions of presences and absences in a confusion matrix using a classification threshold and calculating indices of classification performance such as sensitivity specificity precision over prediction under prediction cohen s kappa or the true skill statistic tss fielding and bell 1997 barbosa et al 2013 allouche et al 2016 in the case of presence only or presence background methods absences are not available here classification metrics are relative rather than absolute and it is essential to compare the evaluation metrics with null models see below in addition model predictions represent a gradient that varies continuously and defining a crisp limit between suitable and unsuitable is difficult and artificial although relatively objective thresholds can be defined e g maximum kappa maximum tss equal sensitivity and specificity liu et al 2005 jiménez valverde and lobo 2007 the criteria to select a threshold remain rather subjective as stated in the section application of the model applying a threshold is not mandatory and implies a loss of information discrimination capacity as measured with the area under the curve auc of the receiver operating characteristic roc plot lobo et al 2008 see below is not related to any particular threshold and it yields the probability that a randomly selected presence will have a higher predicted value than a randomly selected absence a statistical significance of the auc may be also obtained mason and graham 2002 however a good model is not expected to discriminate beyond the discrimination that the species itself makes in the environment therefore models of generalist species tend to have lower discrimination capacity than those of specialist species which does not imply that they are worse models goodness of calibration measures how well the estimated probability of presence represents the observed proportion of presences or the agreement between observations and the continuous predicted values pearce and ferrier 2000 jiménez valverde et al 2013 areias guerreiro et al 2016 calibration may be measured with the hosmer and lemeshow goodness of fit test hosmer and lemeshow 2000 for the training data with miller s statistics miller et al 1991 for the validation data with the boyce index for presence background methods boyce et al 2002 and with a presence only calibration poc plot phillips and elith 2010 for presence only methods calibration assumes probability values not suitability or favourability probability values can be derived directly from favourability real et al 2006 acevedo et al 2012 but not from suitability royle et al 2012 4 3 1 obtaining classification and discrimination metrics all classification metrics are based on the confusion matrix fielding and bell 1997 manel et al 2001 liu et al 2011 barbosa et al 2013 amongst those the most prominent metrics are sensitivity and specificity i e the numbers of correctly classified presences and absences respectively because they are the basis for the most widely used evaluation metrics in enms auc and tss auc stands for the area under the curve of the roc receiver operating characteristic plot hanley and mcneil 1982 zweig and campbell 1993 bradley 1997 fawcett 2006 which depicts the true positive rate sensitivity against the false positive rate 1 specificity at all possible classification thresholds auc ranges from 0 to 1 being 0 5 the value for a model with random discrimination therefore any value above 0 5 corresponds to a model with discrimination better than random and any value below 0 5 corresponds to a model with discrimination worse than random inverted predictions probably due to strong biases the value of the auc is mathematically equivalent to the wilcoxon mann whitney u statistic comparing the predicted values for occupied vs unoccupied sites mason and graham 2002 the auc has been criticised as an overall measure of model performance as it is dependant on the extent of the study area lobo et al 2008 if the study area is big enough to have a large proportion of unoccupied habitats very different environmentally from the occupied area absences will be more easily distinguished from presences and thus a not so good model will still obtain a high auc on the contrary if the study area is too small with presences and absences in more similar and even overlapping environmental conditions the auc will have a low value even if the model is good and predicts correctly the distribution of the species let s imagine a model for a species in the mediterranean area it is very easy to increase the auc by adding north africa to the study area as the algorithm will be able to determine that the species does not occur for example in deserts the maximum auc value in a presence background algorithm is 1 a 2 being a the species prevalence phillips et al 2006 smith 2013 for example if a species occupies 60 of the study region the maximum auc will be 1 0 6 2 0 7 unfortunately a is rarely known it can be only inferred from the relative extent of the study area occupied by presences and background in conclusion the auc is only comparable between models based on the same study area and dataset wiley et al 2003 vanderwal et al 2009 to avoid unrealistically high auc values for rare species or large extents we can use the area under the precision recall curve auc pr instead precision is the proportion of localities predicted as suitable that are actually occupied and recall is the proportion of occupied localities predicted as suitable i e the same as sensitivity as it does not incorporate correctly predicted absences the auc pr is robust to species rarity and unlike the auc of the roc curve it is not affected by large geographic extents sofaer et al 2019a the true skill statistic tss is equal to sensitivity specificity 1 allouche et al 2006 tss ranges from 1 to 1 with 0 corresponding to random classification tss also increases with the extent of the study area and it tends to be correlated with auc leroy et al 2018 4 3 2 obtaining calibration metrics miller s statistic is based on the hypothesis that the calibration line perfect calibration has an intercept of zero and a slope of one and it evaluates the capacity of a model to correctly predict the proportion of sites with a particular environmental profile that will be occupied miller et al 1991 pearce and ferrier 2000 wintle et al 2005 the presence only calibration poc plot was designed for presence only algorithms and determines whether predictions are proportional to conditional probability of presence phillips and elith 2010 model predictions are divided into several bins and the fraction of true presences is plotted against the average model value in each bin if the plotted points are lined up close to the diagonal the model is well calibrated the boyce index is the only calibration metric specifically designed for presence background algorithms it measures how much model predictions differ from a random distribution of the observed presences across the prediction gradients boyce et al 2002 it ranges between 1 and 1 positive values indicate a model in which predicted presences are consistent with the distribution of presences in the evaluation dataset values close to zero mean that the model is not statistically different from a random model and negative values indicate counter predictions i e predicting lower suitability in areas where presences are more frequent hirzel et al 2006 4 3 3 calculating null models another way of assessing model performance is to calculate and evaluate null models for comparison raes and ter steege 2007 beale et al 2008 the procedure consists of creating a set of pseudo presence points randomly distributed across the study area running the models and calculating an evaluation metric e g auc or tss the evaluation metrics for the null models can be calculated with the species training and test records as well bohl et al 2019 the objective is to compare evaluation metrics for the species model and the null models with a statistic such as the t test validation metrics should be significantly better for the species models however species prevalence will always affect the result of the evaluation metrics the difference in the evaluation metrics between species models and null models will be smaller as prevalence increases in other words if the species is a generalist and is widely distributed throughout the study area the distribution of its records will be more similar to a set of random points so smaller differences between the species and the null models will be expected independently of how statistically good the model is it may still be biologically meaningless as table 2 shows ecological niche models can be used to analyse the distribution of other entities rather than species it is possible to model road kills sillero 2008 snake bites yañez arenas et al 2014 or bat mortality due to collisions with windmills santos et al 2013 but it is also possible to model any point process biological or not and obtain a statistically good statistical result model results should be checked always for their ecological meaning 4 3 4 comparing models with aic the performance of presence absence and presence background models can be ranked with the akaike information criterion aic warren and seifert 2011 warren et al 2014 aic is an estimate of the relative information lost when implementing a model a trade off between the goodness of fit and the simplicity e g number of parameters of the model hence aic is not a test of a model it does not have a null hypothesis and it does not provide information about the absolute quality of a model aic is a measure of quality relative to other models based on the same species occurrence dataset with different sets of predictor variables or parameters aic increases with information loss thus the best model for a set of occurrence data is the one with the lowest aic warren and seifert 2011 muscarella et al 2014 4 3 5 analysing model results after evaluating and checking the reliability of the results it is possible to analyse the information provided by the model first we can analyse the contribution of the variables to the model or how much variance each variable explains regression based algorithms provide explained deviance or d2 as well as pseudo r2 values the remaining algorithms provide only the importance of the variables most of the non regression based algorithms do not provide information about the statistical significance of the variables although they can provide variable importance metrics some algorithms provide response curves of the variables these curves show how environmental suitability or presence probability changes as a function of each variable it is possible to know which specific environmental conditions the species is preferably inhabiting some algorithms such as maxent calculate the importance of the variables through a jack knife procedure phillips et al 2006 maxent presents two sets of response curves the first one shows the changes in the habitat suitability as each environmental variable is varied keeping all other environmental variables at their average sample value in the second set each curve corresponds to a model calculated with only that variable in the absence of correlation effects between variables both sets of curves should be similar if variables are strongly correlated the response curve does not represent how habitat suitability changes exclusively with that variable as the curve includes the contribution of other correlated variables pure curves are very difficult to obtain because variables always have some degree of correlation only when using the components of a principal component analysis the curves will correspond exclusively to each component but each component will be a linear combination of all variables pérez i de lanuza et al 2018 4 3 6 analysing model projections with clamping maps and extrapolation analysis the next step is to analyse the model projections i e predictions into the same set of variables used to train perform models but expressing other areas or time frames projections can be restricted through clamping maps or carefully inspected for extrapolation through mess multivariate environmental similarity surface elith et al 2010 2011 or exdet extrapolation detection mesgaran et al 2014 clamping maps indicate the values of the variables for the projection scenarios which are outside the modelled range of values let us imagine a linear regression model the regression line of the model will be calibrated for a specific set of environmental values the line i e the model will only be correctly extrapolated if the relationship between occurrences and environmental variables remains the same beyond those values if the relationship changes e g if there is an asymptote or an inflection the model is not fitted for these new values of the variables and results could be wrong elith and leathwick 2009 this rationale is the same for an enm the mathematical part of an enm is a formula relating the species records to a set of environmental variables this formula is applied to the environmental variables to obtain the final model this is the way of projecting a model to other scenarios in time and or space if a model map is produced for the current environmental variables by applying the model formula the same can be done for those variables from other scenarios in time and space however some values of these variables can be outside the range of values analysed by the model the clamping maps will thus indicate the areas where the model is incurring in extrapolation mess and exdet analyses provide an advanced clamping map they indicate what variables and combinations of values are outside the modelled range mess measures the similarity of any given point to a reference set of points in relationship to the variables elith et al 2010 2011 it reports the closeness of the point to the distribution of reference points gives negative values for dissimilar points and maps these values across the whole prediction region exdet measures the similarity between the reference and projection domains by accounting for both the deviation from the mean and the correlation between variables mesgaran et al 2014 4 4 application of the model 4 4 1 ensemble models if several models are calculated with different algorithms they can be merged in an ensemble by e g averaging them araujo and new 2007 marmion et al 2009 several r packages supplementary text s2 such as biomod2 sdm and enmtml allow to calculate ensemble models in several ways thuiller 2003 thuiller et al 2009 naimi and araújo 2016 andrade et al 2020 although ensemble models are often calculated performing an ensemble of good and bad models may not result in the best or even a good model bates and granger 1969 demonstrated that combining forecasts may yield lower mean errors than any of the constituent individual forecasts but only if 1 each of the forecasts was based on variables or information that the other forecasts had not considered and 2 all forecasts were unbiased thus ensemble forecasting should not be blindly used for combining different models based on the same variables in addition enms may yield either probability suitability or favourability values which differ in meaning and are not commensurable royle et al 2012 even suitability values obtained with different algorithms lack commensurability therefore it is advisable not to merge models from different types of algorithms or at least from different types of algorithm families as noise will be introduced in the final ensemble model hao et al 2019 in addition recent studies show no particular advantage of model ensembles over individually tuned models hao et al 2020 alternatively individual models can be overlapped to represent prediction agreement or consensus martínez freiría et al 2017 2020 4 4 2 thresholding the model frequently decision makers and stakeholders prefer to work with model predictions composed of only two categories presence absence or suitable unsuitable it is then necessary to transform the actual model predictions which typically range continuously from 0 to 1 to a binary prediction map with only two classes for that a threshold must be applied to the continuous predictions everything below the threshold will be considered as predicted absence or unfavourable unsuitable areas everything above the threshold will be considered as predicted presences or favourable suitable areas there are many possible thresholds liu et al 2005 jiménez valverde and lobo 2007 freeman and moisen 2008 nenzén and araújo 2011 liu et al 2016 and the choice is largely arbitrary most thresholds are based on some metric from the confusion matrix such as sensitivity and or specificity some of the most used thresholds are the 10 percentile training presence threshold and the maximum training sensitivity plus specificity vale et al 2014 the first one accepts to classify 10 of the presences as false presences the second one maximises the number of presences and absences correctly classified note that the thresholds for presence absence and presence background algorithms are of different power in theory presence absence algorithms compare occupied to unoccupied habitats to predict probable presence and probable absence areas therefore thresholds often take values close to the species prevalence or sometimes mean predicted probability in the modelled sample nenzén and araújo 2011 liu et al 2013 presence background algorithms ideally distinguish suitable from unsuitable habitats based on the presences and a generally large sample of background points thus the selected classification threshold will generally be lower frequently around 0 3 or even lower as suitable habitats include occupied and unoccupied habitats and the ratio of presences background points is usually low for favourability values which are calculated from probability obtained from presence pseudo absence algorithms a threshold of 0 5 will always separate favourable from unfavourable locations regardless of species prevalence jimenez valverde and lobo 2006 real et al 2006 acevedo and real 2012 the transformation of model output values into binary predictions should only be done if necessary as the actual continuous predictions contain important quantitative information binary model predictions may be useful to calculate potential species richness by adding up binary model outputs for a set of species martínez freiría et al 2013 2017 2020 sillero et al 2009 stacking species enms tends to overestimate species numbers methods like the sesam model can correct this over estimation guisan and rahbek 2011 however potential species richness can also be obtained without binary transformation e g by summing up predicted favourabilities for a group of species using fuzzy logic real et al 2017 estrada et al 2018 4 4 3 considering dispersal scenarios when a model is projected to another period species are usually considered to be able to disperse under two contrasting dispersal scenarios no dispersal or unlimited dispersal carvalho et al 2010a the no dispersal model supposes that the species is not able to disperse to new areas thus the projection excludes any newly suitable areas without current observed species presences on the other hand the unlimited dispersal model considers that the species has an unrestricted capacity to disperse to new areas the projection will include all newly suitable areas the reality must be somewhere between those two dispersal scenarios there are tools such as the migclim r package engler and guisan 2009 engler et al 2012 to model the dispersal of a species from the current situation to the projected one it is also possible to calculate the required dispersal rate for a species and compare that to its observed dispersal rates yu et al 2019 5 final remarks enms like any other modelling tool have limitations and conditions to be considered in order to obtain reliable results currently the most important recurrent issue in correlative enms is probably the lack of consistency in guaranteeing that models fulfil all statistical assumptions when applied this is essential for employing enms with certainty in conservation biogeographical and ecological studies in this sense this work aims to provide step by step guidelines for improving the quality of enms studies however there are some issues that still need improvement where future research should focus on one is model validation new validation methods not based on the confusion matrix are necessary especially for algorithms that do not include absences null models should become a standard procedure in the validation process more studies are also needed to clarify the differences between modelling methods as a best algorithm may not exist if each algorithm is a different approximation to species ecological niche another topic in need of further development is how to define the size and shape of the study area through easy to use and objective criteria as stated in this review some of the current criteria are not easy to implement due to the dependence on expert knowledge also further research is necessary for the application of true spatial methods e g auto logistic regressions geographically weighted regressions where the species distribution is modelled directly in geographical rather than in environmental space finally more standard methods are necessary to obtain better species physiological datasets relevant to mechanistic models further combining correlative and mechanistic models will make enms more process based a strong necessity for better establishing cause effect relationship between the environment and species distributions in summary the future of enms is promising but it will only be successful if best practices are reviewed updated and provided to beginners and also more experienced users 6 credit author statement neftalí sillero conceptualization neftalí sillero salvador arenas castro urtzi enriquez urzelai writing original draft preparation neftalí sillero salvador arenas castro urtzi enriquez urzelai cândida gomes vale diana sousa guedes fernando martínez freiría raimundo real a márcia barbosa writing reviewing and editing declaration of competing interest we declare that the manuscript titled want to model a species niche a step by step guideline on correlative ecological niche modelling by neftalí sillero salvador arenas castro urtzi enriquez urzelai cândida gomes vale diana sousa guedes fernando martínez freiría raimundo real and a márcia barbosa has not been published previously and is not under consideration for publication elsewhere that its publication is approved by all authors and tacitly or explicitly by the responsible authorities where the work was carried out and that if accepted it will not be published elsewhere in the same form in english or in any other language including electronically without the written consent of the copyright holder acknowledgements ns is supported by a ceec2017 contract ceecind 02213 2017 sac is supported by the porbiota e infraestrutura portuguesa de informação e investigação em biodiversidade fellowship poci 01 0145 feder 022127 fm f is supported by a contract from fct ref dl57 2016 cp1440 ct0010 supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j ecolmodel 2021 109671 appendix supplementary materials image application 1 image application 2 image application 3 image application 4 
24584,soil nitrogen n loss is a part of n biogeochemical processes which plays an important role in the agricultural ecological and environmental management because it is difficult to assess the temporal and spatial changes of different n forms in leachates by field measurement methods conceptual and physical models are usually used to describe soil n loss however soil n models are often associated with multiple sources of uncertainty e g model parameter and structure which may largely influence the reliability and accuracy of the models the multimodel ensemble prediction mep is specifically designed to reduce the parameter and structural uncertainty in n biogeochemical modelling by representing a set of candidate models however the existing mep methods still need to be improved by integrating various kinds of prior knowledge and quantifying each part of predictive uncertainty in addition published studies mainly focused on the regional scale mep of the land carbon balance however the regional scale mep of soil n losses is lacking this paper firstly proposed the mep methods of soil n losses at different spatial scales 1 using the monte carlo sampling to randomly alter the soil and crop parameters governing the n cycle and driving multiple soil n models at plot scale and 2 generating an ensemble of tigge thorpex interactive grand global ensemble weather forecasts and an ensemble of random soil and crop parameters and driving multiple soil n models at regional scale this study also discussed different methods used for realizing mep it is found that the ensemble mean produced a large bias when simulating soil n losses by using the bias correction technique the rmses of the ensemble mean decreased by 57 5 86 0 overall the mep can enhance our understanding of soil n cycle in addition this study is also helpful to accurately estimate the response of soil n loss to global change and provide support for agricultural production and environmental protection keywords nitrogen cycle biogeochemical processes model uncertainty vadose zone global change regional scale 1 modelling of soil n losses soil nitrogen n losses e g denitrification ammonia volatilization leaching and runoff play an important role in the biological production solute and energy transport and ecological environment quality in the earth s critical zone elser et al 2007 zhu et al 2012 griffis et al 2017 lu et al 2020 kherif et al 2021 in recent decades fertilization and tillage substantially accelerate the soil n losses lu et al 2011 which directly reduce the amount of n that plants can absorb thus reducing crop yield adiku et al 2021 movement of dissolved n with water through vertical and lateral subsurface flow contributes to the eutrophication of rivers and lakes qin et al 2007 excessive n loss into the water body also often leads to the proliferation of algae and aquatic plants the depletion of oxygen in the water and the decrease of water transparency will affect the survival of fish in addition nitrous oxide n2o and nitric oxide no emissions from soils to the atmosphere exacerbate the global climate change problem butman and raymond 2011 moreover precipitation through nitrate leaching and gas losses through denitrification can largely influence the water and n availability which have indirectly impacts on ecosystem co2 exchange including net ecosystem productivity ecosystem respiration and gross ecosystem photosynthesis zhang et al 2015a combined with the analytical instruments e g gas chromatograph and continuous flow analyzer several experimental apparatus have been designed to measure soil n losses e g zero tension lysimeters for collecting soil leachate samples and static chamber for sampling emitted greenhouse gases from soils valente et al 1995 however it is difficult to determine the spatio temporal variations of soil n losses due to sampling with sparse spatial coverage a limited number of locations and relatively low frequency one time for a week or two weeks therefore conceptual and physically based models with different degrees of complexity have been developed to simulate n biogeochemical processes of soils table 1 these models can be roughly divided into two groups biogeochemical process models and agro hydrological models with applications at different spatio temporal scales biogeochemical process models focused on n cycling simplify soil water parameters while agro hydrological models focused on agricultural practices and soil water processes simplify n cycling parameters many previous studies have been conducted to derive soil n models to simulate n runoff e g hou et al 2019 leaching e g li et al 2014 and gas emissions e g rahn et al 2012 across different spatio temporal scales it is worthy to note that zhu and riley 2015 emphasized that terrestrial models must represent soil n losses e g denitrification n loss and n emissions accurately if they are to credibly estimate emissions of nitrogen and carbon containing greenhouse gases important in climate change predictions performance and robustness of soil n models largely depends on errors in model parameter and structure modelling of n biogeochemical processes requires input parameters e g climate soil and crop the nonlinearity of the model parameters seriously complicates calibration of the n biogeochemical models against field monitoring data manzoni et al 2004 to overcome such model artifacts several previous studies e g lindgren and destouni 2004 applied the scaling methodology in form of the closed form expressions of regional scale delivery factors as functions of plot scale n loss rates to obtain the actual underlying n model parameter in addition previous studies concluded that there is no best model structure kronvang et al 2009 guber et al 2009 the mechanistic model considered the best may be better to describe the particular processes under certain calibration conditions but fail to adequately simulate other process during different calibration and validation periods to obtain more reliable predictions the multimodel ensemble prediction mep emerged as a popular and powerful technique in different environmental modelling applications exbrayat et al 2011 liao et al 2014 liao et al 2017 bastola and misra 2015 recently to deal with the model structure uncertainty lai et al 2020 combined the hydrus 3d and dndc models to simulate the spatio temporal variations of nitrate leaching on a tea garden hillslope with good accuracy 2 the mep methodology and its application in predicting soil n losses unlike single deterministic forecasts mep is based on a combination of the outputs of all candidate models this usually involves using various input parameters to a n biogeochemical model or using various n biogeochemical models to produce an ensemble of soil n outputs in order to perform better prediction accuracies compared with the single forecasts fig 1 the ensemble mean was used to combine outputs of all independent models for simulating the leachate no 3 n concentration the linear bias correction which shifts the ensemble mean forecasts proportionally and makes the means closer to that of the observations was then combined with the ensemble mean to improve the predictions 1 y a 0 a x e m where y is the bias removed ensemble mean a 0 is the intercept a is the slope and x em is the ensemble mean from fig 1 the bias removed ensemble mean matched well with observations in the field of earth sciences mep was first applied in climate predictions krishnamuri et al 2000 yun et al 2003 and then extended to other fields such as forecasting of flood roulin 2007 cloke and pappenberger 2009 groundwater flow ye et al 2004 rojas et al 2008 and water flow in the vadose zone guber et al 2009 liao et al 2017 mep is now slowly also being used in n biogeochemical modelling kronvang et al 2009 first applied the mep to predict n losses with the use of eight different n models in 17 european catchments and demonstrated the superiority of mep compared to single forecasts mep was then used to simulate transport of different n forms e g nitrate no 3 n ammonium nh 4 n and total n loads in a swedish meso scale catchment exbrayat et al 2010 total n concentration in a western australian catchment exbrayat et al 2011 no and n2o emissions from three winter wheat summer maize rotation fields in shanxi province of china zhang et al 2015b recently teutschbein et al 2017 applied 15 climate model combinations 1 hydrological model and 5 n models to create an ensemble of simulations of inorganic n loading from land to water across boreal hemiboreal sweden since the mep was introduced in the late 1960s the focus is on whether this method is better than single forecasts regarding this question almost all the studies have reported that mep outperformed single forecasts in n biogeochemical modelling kronvang et al 2009 exbrayat et al 2013 sharma et al 2019 a biogeochemical model consists of several components while the individual components closely interact with one another any component is likely to influence the nearly all biogeochemical processes however usually the soil n cycle is represented by several empirical equations generated from laboratory studies besides the classical laws of physics chemistry and biology it is prone to incorrect simulation results based on a single model by neglecting the possibility of other expression forms to describe the core processes in that case single models tend to show worse performances than ensembles indeed forecast error can be reduced by using ensembles due to the nonlinear filtering process an ensemble mean forecast is statistically or on average more robust and accurate than a single forecast and then an improved forecast but mep is not only a tool to improve a single deterministic forecast but more importantly to quantify forecast uncertainty which is the ultimate goal and the core mission of mep 3 uncertainty in n biogeochemical models many previous studies have found that there is no single accepted theory of n cycling and n biogeochemical models are still facing a high degree of uncertainty for example exbrayat et al 2010 found that the mismatches of the predictions of different n forms e g no 3 n nh 4 n and total n loads with the observations could not only be attributed to the sole parameter uncertainty moreover they demonstrated that more complex tools based on a more detailed description of n biogeochemical processes were not necessarily better zhang et al 2015b observed that simulations of no and n2o emissions by the dndc landscape dndc and iap n gas models produced the uncertainty resulting from the structural differences initial conditions and parameterizations in n biogeochemical models recently teutschbein et al 2017 indicated that the driving climate models were the main cause of model uncertainty when simulating inorganic n loading from land to water across boreal hemiboreal sweden however when analyzing an individual study site the hydrological model parameterization and the choice of an appropriate n model were of much greater importance than when upscaling to the entire swedish land area mep is specifically designed to deal with the uncertainty in n biogeochemical modelling by representing a set of n models multiple sources of uncertainty influence the reliability of n biogeochemical models according to the logical process of n modelling the source could be partitioned as model parameter model structural and observation uncertainties fig 2 which are described in detail below 3 1 parameter uncertainty the parameter uncertainty is recognized as one of the most important uncertainty of n biogeochemical model predictions this uncertainty is mainly due to the different practical significance of each parameter some parameters are difficult to obtain accurate values and the parameters calibrated by empirical estimation or measured values may have deviations from the actual values the uncertainty and sensitivity analysis of parameters plays an important role in optimizing the range of parameters and improving the application ability of the model so far the two most common methods for quantifying parameter uncertainty include markov chain monte carlo mcmc mangoubi and smith 2017 and generalized likelihood uncertainty estimation glue beven and binley 1992 mcmc is a dynamic sampling technique that allows sampling of complex high dimensional distributions not accessible by simple samplers middleton et al 2019 the core of mcmc is an algorithm which determines the sampling efficiency and reliability of uncertainty analysis the common algorithms are metropolis hastings m h adaptive proposal distribution ap adaptive metropolis am gibbs shuffled complex evolution metropolis scem and differential evolution adaptive metropolis dream wu and zeng 2013 recently extensions of the m h algorithm e g metropolis adjusted langevin and the hamiltonian or hybrid monte carlo algorithms were also popular mcmc algorithms especially for large dimensional targets heng and jacob 2019 jacob et al 2020 previous studies have been conducted to apply mcmc to solve n biogeochemical model uncertainty problems rahn et al 2012 combined the multi chain mcmc and metropolis algorithm to estimate the uncertainty of the model parameters in modelling of soil no and n2o emissions from forest sites in the study by fitton et al 2014 monte carlo simulations were conducted to test the potential influence of uncertainties in the soil and climate inputs on modelled n2o emission from cropland sites in general mcmc shows strong flexibility and high reliability in uncertainty analysis of various n biogeochemical models glue has also been used in evaluation of n model parameter uncertainty liebermann et al 2018 the core idea of this method is that the model accuracy is not affected by one parameter but by multiple parameters glue a monte carlo simulation technique uses uniform random sampling to obtain the posterior distributions of the model parameters in that case this method requires a huge number of simulations to obtain the convergence of monte carlo simulation due to its ineffective sampling technique previous studies have demonstrated that glue is only suitable for low dimensional parameter uncertainty analysis whereas mcmc is more stable for complex high dimensional problems wu and zeng 2013 to improve the efficiency of the uncertainty analysis technique a sensitivity analysis is often used prior to the uncertainty analysis this helps to restrict the analysis to the most important parameters and to avoid overfitting the widely used sensitivity analysis techniques include multivariate regression morris and sobol s methods and extended fourier amplitude sensitive test efast zhang et al 2020 previous studies applied the sensitivity analysis to determine the key parameters of n biogeochemical models it is found that soil properties e g ph and clay content are more important than the remaining input parameters in estimating soil n2o emission fitton et al 2014 while soil n leaching was most sensitive to fertilizer rate and soil porosity li et al 2014 3 2 structural uncertainty n biogeochemical processes of soils are described with a set of equations i e the model structure the reason for the structural uncertainty is that the conceptual model is not able to represent the real n biogeochemical processes in other words all models are not perfect and have their limitations for instance nitrification and denitrification processes occur at the same time and are mutually influenced by each other indicating a knowledge gap of core processes describing n biogeochemical cycle arhonditsis et al 2008 in addition round off error a miscalculation that results from rounding off numbers to a convenient number of decimals also contributes to structural uncertainty if a numerical simulation model e g hydrus šimůnek et al 1998 is applied as a result accurate simulation of soil n cycle is still a challenge for existing models xu and zhang 2014 in addition the simulation results obtained by different n model structures are also quite different which has been observed by abdalla et al 2010 for soil n2o fluxes by sansoulet et al 2014 for plant n uptake and by boomer et al 2013 for n discharge from a watershed mep is an effective tool to deal with the n model structural uncertainty the standard mep consists of the following steps i calibrating a group of n biogeochemical models with measured data ii ranking these models based on evaluation criteria iii removing the models with unreasonable and poor performances and iv combining the weighted predictions of the remaining models the simplest form of mep is the ensemble mean that assigns equal weight on all the candidate models finding weights of individual forecasts in mep is an improved method e g by using regression based method information theory and bayesian model averaging bma samadi et al 2020 among these methods the most popular method is bma which is not only able to integrate various kinds of prior knowledge but also quantify each part of predictive uncertainty mustafa et al 2020 ajami and gu 2010 first applied the bma to investigate the complexity in microbial metabolic processes in soil n modelling based on different biogeochemical models they suggested the need to consider a mep strategy over a single model selection in biogeochemical modelling study previous studies have been conducted to compare the model parameter and structural uncertainty in biogeochemical modelling among these some have found that model parameter uncertainty dominated over model structural uncertainty e g shen et al 2013 ma et al 2018 however other studies have shown that the model uncertainty is primarily caused by the structural uncertainty rather than the parameter uncertainty radwan et al 2004 o neill and melnikov 2008 the various studies suggest that the answer to the question of which uncertainty is more important relies on the choice of the n models and the exactness and representativeness of model parameters 3 3 observation uncertainty observation uncertainty stems from systematic a persistent error that cannot be attributed to chance and random errors a statistical error that is wholly due to chance and does not recur which can occur in the processes of collecting and measuring data when soil n model is calibrated and validated based on a group of less robust observation data the uncertainty related to model output is regarded as observation error n studies have focused on uncertainty related to observed data for example previous studies found that there is large spatial variability in soil n2o fluxes giltrap et al 2020 thus either multiple small chambers or fewer larger chambers are required to reduce the measurement uncertainty matthews et al 2010 chadwick et al 2014 the degree of linearity of headspace n2o accumulation which is influenced by chamber height soil air porosity soil warming and cooling can also attribute to the measurement uncertainty based partly on gas transport theory headspace n2o concentrations in closed chambers increase nonlinearly with time anger et al 2003 found apparent linearity even in those chambers with the largest fluxes which therefore were the least likely to be subject to observation uncertainty chadwick et al 2014 suggested that maximizing chamber numbers should be given priority over maximizing the number of headspace samplings per enclosure period due to limited resources in addition several studies discussed the validity of using ambient air samples as a surrogate for the initial headspace n2o concentration cardenas et al 2010 smith et al 2012 soil n studies also focused on observation uncertainty in n leaching the common methods for estimating n leaching are lysimeter ceramic suction cup and soil resin core methods lysimeter has the advantage of simultaneously determining the n concentration and leaching water volume while ceramic suction cup and soil resin core can only determine the n concentration allaire leung et al 2001 fares et al 2009 wang et al 2012 found that suction cups are inappropriate for the determination of cumulative leaching in the structured soils preferential flow is attributed to differences between the results obtained by the suction cups and the lysimeters kabala et al 2017 demonstrated that acceptable results could be obtained from suction cups when used in unstructured well drained soils lysimeters measure the total leaching loss from a known sample volume which is useful for irrigation and fertilizer applications however when using this method the soil structure is destroyed resulting in the alteration of the pathways for water and solute flow weihermuller et al 2007 overall all of the methods have advantages and disadvantages so researchers should apply particular method under particular conditions it may be an effective approach to reduce the observation uncertainty by combining the multiple observed values obtained by different methods 4 toward a framework for the mep of soil n losses in previous studies the mep has been used to predict soil n cycle however these studies mainly focused on the regional or catchment scale e g kronvang et al 2009 exbrayat et al 2013 but not on the plot or site scale in addition mep was often applied to deal with the n model structural uncertainty not the model parameter uncertainty furthermore almost all studies used the simple average of the ensemble members to realize mep but this kind of assigning equal weights easily led to systematic bias in the prediction results to solve these problems a framework for the mep of soil n cycle at plot and regional scales is proposed in this section fig 3 previous studies demonstrated that climate soil and crop parameters are the key parameters influencing the n cycle in the field li et al 2014 fitton et al 2014 hou et al 2019 messaoudi et al 2020 these parameters are difficult to measure accurately due to the heterogeneity of the environment however the plot scale meteorological data can be more accurate than soil and crop parameters therefore the plot scale mep mainly focuses on the uncertainty in soil and crop parameters at regional scale the spatial variation of climate factors e g precipitation and air temperature cannot be effectively reflected by the plot scale data measured by traditional ground meteorological stations cloke and pappenberger 2009 in this case the regional scale mep should consider the uncertainty in climate factors in addition to those in soil and crop parameters 4 1 plot scale mep mep was used to deal with both the n model parameter and structural uncertainty the plot scale mep can be constructed as following steps fig 3 i collecting and analyzing the model data in the study area such as topography vegetation or crop soil climate and management practices ii developing and calibrating multiple n biogeochemical models in the study area based on the measured data iii using the monte carlo sampling or latin hypercube technique mckay et al 1979 to randomly alter the soil and crop parameters governing the n biogeochemical processes while the previously calibrated water balance parameters remain constant iv realizing a large number of model runs for each n model and compiling several single model ensembles for each model with independent n forms e g no 3 n concentration and n2o flux v selecting one best single model ensemble per model and n form based on two goodness of fit indicators the coefficient of determination r 2 and the root mean squared error rmse eq 1 2 rmse i 1 n o i s i 2 n where oi and si are observed and simulated value at time step i and n is the number of observations vi and compiling multimodel ensembles for each n form and applying the ensemble mean arithmetic average of all individual models or other methods e g bias removal techniques and superensemble based on weight optimization to realize mep and testing the mep of soil n cycle based on evaluation criteria the key to the success of plot scale mep of soil n cycle lies in the step iii which is how to generate random soil parameters especially soil hydraulic properties shps e g field capacity permanent wilting point and saturated hydraulic conductivity which are difficult to measure directly bouma 1989 these are the most important parameters controlling the soil hydrological processes which transport and connect electron donors and electron acceptors that determine redox potential and thus n biogeochemical processes zhu et al 2018 therefore accurately estimating the mean and standard deviation sd for probability distributions of the shps is critical for monte carlo sampling in mep pedotransfer functions ptfs have long been applied to predict shps from easily measured basic soil properties e g texture organic matter content and bulk density schaap et al 1998 pachepsky and rawls 2004 liao et al 2011 and can be applied to find the mean and sd of the shps the common method is to use various ptfs developed in different regions to predict the shps in a certain area and then the mean and sd of the shps can be estimated cichota et al 2013 there is no strict requirement for the selection of ptfs but we suggest that those ptfs developed from relatively large databases e g 200 soil samples as suggested by guber et al 2009 should be selected as far as possible such as soilpar 2 acutis and donatelli 2003 rosetta schaap et al 1998 and hypres wösten et al 1999 this is because the accuracy and reliability of the ptfs largely depend on the number of samples khodaverdiloo et al 2018 in addition the uncertainty in crop parameters e g biomass c n ratio and initial biomass production of grains leaves stems and roots also needs to be focused on and can be investigated by analyzing the effects of different crop parameter variation ranges on model output uncertainty based on some statistical analysis e g kendall s coefficient of concordance and the top down coefficient of concordance helton et al 2004 based on this the mean and sd of crop parameters can be determined taking a case study as an example the plot scale mep was used to predict soil no 3 n losses from a tea garden hillslope which was located in the western hilly area of taihu lake basin china 31 21 n 119 03 e the process based daycent dndc leachm and hydrus models were selected to represent the model structural uncertainty while 6 classical ptfs available in soilpar 2 software were selected to represent the soil parameter i e field capacity and permanent wilting point uncertainty the period from 2013 2015 was used for model calibration while the period of year 2016 2018 was applied for model validation a comprehensive field survey was carried out during 2013 2018 covering all the information of agricultural practices and environmental factors e g climate soil and plant for detailed information of the model simulation regarding descriptions of models and ptfs settings of model initial conditions in the tea garden ecosystem and simulation outputs of the bias removed ensemble mean we refer to the study of liao et al 2020 as seen in fig 4 ab the total water percolation and no 3 n leaching fluxes simulated by the four models were relatively different the soil parameter and model structural uncertainty were equally important in soil no 3 n leaching modelling fig 4c the rmses of the daycent dndc leachm and hydrus model ensemble mean were 32 73 13 50 10 80 and 10 94 mg l 1 respectively the ensemble mean produced a large bias when simulating the leachate no 3 n concentrations fig 4defg which may be related to the prediction bias of ptfs since the accuracy of ptfs outside of their development area is generally low after bias removal the rmses of the ensemble mean decreased by 57 5 86 0 fig 4h exbrayat et al 2010 also found the multi model ensembles produced better n prediction results than single model ensembles this confirmed the benefits of exploring different model structures amongst which we may not know an a priori best one it is because that each model captures certain important aspects of the information about the system and the advantages of some models can compensate for weaknesses in the other models resulting in an overall better prediction 4 2 regional scale mep the regional scale mep has to deal with the uncertainty associated with climate factors e g precipitation and temperature which drive multiple hydrological and biogeochemical processes gao et al 2014 however the variability of climate factors may largely influence the regional scale n modelling downscaling of multiple global climate models and coupling them with regional scale n biogeochemical models can be an effective avenue to realize regional scale mep and improve n simulations kok et al 2018 in addition the coupled models can be further applied to reduce soil n losses by the optimization of irrigation water and fertilizer management practices especially under global climate change combination of different irrigation regimes and n rates can be input into the coupling models to simulate soil n losses and crop production by using the scenario simulation finally economic analysis can be applied to determine the most appropriate combination of n fertilizer and irrigation the atmosphere is a highly nonlinear system so it is impossible to predict its exact state chen et al 2019 weather prediction is not only represented by the physical process but also limited by the resolution of the simulated atmospheric dynamics and the sensitivity to the model s initial condition and sub grid parameterization cloke and pappenberger 2009 thorpex shapiro and thorpe 2004 interactive grand global ensemble tigge starting from october 2006 aims to address the nature of uncertainty in weather observations tigge consists of ensemble forecast data from 10 global national weather prediction centers e g national centers for environmental prediction ncep european centre for medium range weather forecasts ecmwf china meteorological administration cma etc richardson 2005 the ensembles of numerical weather predictions are often applied in different hydrological and flood forecasting cloke and pappenberger 2009 but they are rarely used in n cycle modelling just recently chang et al 2017 coupled eight isimip2a biome models and two climate forcing datasets to produce 16 simulations of net carbon fluxes over global terrestrial ecosystems in order to use climate ensembles in n biogeochemical models meteorological pre processing is usually required due to the spatio temporal scale mismatch between the original tigge product and the climate input used by the n models therefore the original forecasts should be downscaled or disaggregated walsh et al 2018 first applying bilinear interpolation to regrid a low resolution product to a high resolution grid then establishing the linear relationship between the forecast value and the observations at each grid point and correcting the error caused by the interpolation and finally integrating the results of each forecast center after correction in some ways e g by using bias removed ensemble mean and superensemble approaches krishnamurti et al 1999 the regional scale mep is constructed as following steps fig 3 i measuring the model data in the study area and further developing and calibrating multiple n models ii generating an ensemble of tigge weather forecasts and using the monte carlo sampling to randomly alter the soil and crop parameters iii using different soil and crop parameters and weather forecasts to drive n models and realizing a large number of model runs for each n model iv compiling several single model ensembles for each model v selecting one best single model ensemble per model and n form based on evaluation criteria and compiling multimodel ensembles for each n form and vi applying bma to realize mep and evaluate the performance of the mep in the step ii ptfs can also be applied to find the mean and sd of the shps but the spatial variability of the ptf inputs pedotransfer variables e g basic soil properties at regional scale must be considered due to the fact that the ptf inputs are often obtained using the kriging cokriging techniques the ptf input uncertainty can be represented by the kriging cokriging variance and quantified by assuming that the kriging cokriging estimates follow a normal distribution deng et al 2009 in regional scale mep the mean and sd for probability distributions of the shps can be estimated by integrating various ptfs developed in different regions and multiple kriging cokriging estimates of the ptf inputs chirico et al 2007 5 key challenges of using mep for n biogeochemical modelling 5 1 using new advancements in geophysical and biochemical sampling methods to improve regional scale n models state of the art geophysical and biochemical methods should be applied to assess effects of heterogeneity of surface and subsurface domains on soil n cycle and improve regional scale n models in these domains several hydrological and biological processes e g dynamic redox zone preferential flows and subsurface and surface flows to streams and lakes and parameters dominate at regional scale compared to plot scale in recent years behroozmand et al 2019 used a new tractive time domain electromagnetic system to derive detailed three dimensional 3d information about the subsurface materials and their hydraulic properties maurya et al 2020 also applied a towed transient electromagnetic tool to map a 3d subsurface hydrogeology in high resolution if the distribution of sand and clay deposits is known in the vicinity of the agricultural n pollution source one can predict the pathways for the movement of the water and n in addition the biochemical tracer techniques e g stable isotopes have also been used to understand the hydrological and n cycles wu et al 2019 engesgaard et al 2020 5 2 understanding the hydrological and microbial regulation mechanism of soil n cycle understanding the mechanism of soil n cycle has to be improved as mep would benefit from better members exbrayat et al 2010 from a hydrological perspective the movement of soil water is the primary driving force of n transport in the vadose zone in addition soil water content regulates redox potential over long time periods and further affects soil n transformations lin 2010 previous studies focused the effects of soil water processes on n biogeochemical cycle that were comparable to those of land use land cover climate factors and topography saha et al 2016 latati et al 2019 however these effects have not been comprehensively and fundamentally integrated into n cycling investigations parameters like soil moisture water leakage and water table were often applied to develop empirical relationships between soil water and n cycle e g zhu et al 2015 but mechanisms remained unclear recently zhu et al 2018 reviewed recent progress in research on soil water processes and soil n cycle and proposed three possible solutions hydrogeophysical upscaling and model coupling techniques for studying interactions between soil water processes and the n cycle from a microbial perspective n fixation nitrification denitrification anaerobic ammonium oxidation and dissimilatory nitrate reduction to ammonium performed by a group of bacteria and archaea are the five key microbial processes to regulate soil n cycle ajami and gu 2010 recently kherif et al 2021 also highlighted the functional role of micro organisms in the modelling of continuous transfers of c and n in terrestrial ecosystems however the relative contributions of the five microbial processes to n cycle are still unclear hydrological processes are always merged with microbial processes to regulate soil n cycle simultaneously fig 5 at high soil moisture levels anoxic conditions prevent bacteria from performing the aerobic oxidation that is necessary for decomposition in this case the process of denitrification may occur releasing n gases the optimum conditions for nitrification are very similar to those for ammonification and net n mineralization with a little different when the soil tends to be saturated with the decrease of soil water content the activity of microorganisms will decrease resulting in the reduction of the ammonification rate at low soil moisture levels porporato et al 2003 in the previous study the eco hydrology was coupled with biogeochemical cycle to simulate the carbon cycle changes nakayama and pelletier 2018 however little research was conducted to develop a hydrologic and n biogeochemical coupling model therefore it is necessary to couple the hydrological and microbial regulation mechanism for a better understanding of the soil n cycle zhu et al 2018 proposed that soil water processes play an important role in regulating the abundance duration and timing of n rich microsites in turn the abundance duration and timing of these microsites play a critical role in the magnitude and vector of environmental n losses which can lead to water pollution and the accumulation of subsoil organic matter they also suggested that using hydrogeophysical tools e g ground penetrating radar or gpr electromagnetic induction or emi and electrical resistivity tomography or ert to detect soil water processes and then linked to electrochemical n sensors to reveal the soil n cycle 5 3 accurately estimating the uncertainty associated with n biogeochemical models the primary purpose of n model uncertainty analysis is to give a range of an output parameter for example major uncertainties can be identified through sensitivity analysis which can be helpful to understand and simplify the structure of the model improve the efficiency of parameter calibration and the accuracy of the model and increase the reliability of the model the largest source of uncertainty in modelling n biogeochemical processes should be given particular attention in previous studies only limited parameters and models were considered to quantify model uncertainty a large number of additional crop and soil related parameters can strongly impact the simulation results it makes sense to include a reasonable range of key parameters and n models to estimate model uncertainty in addition existing studies focused less on the influence of observation uncertainty on n biogeochemical modelling the observation error is assumed to be independent normally distributed with a mean of 0 and covariance matrix i e the error variance magnitude at each data point and its correlation to adjacent data points wu and zeng 2013 at present bayesian forecasting system bfs integrated bayesian uncertainty estimator ibune and bayesian total error analysis batea kavetski et al 2006 can be potential tools to address the observation uncertainty in n biogeochemical modelling for example herr and krzysztofowicz 2015 used the analytic numerical bfs which produced a short term probabilistic stage transition forecast to quantify the observation uncertainty associated with the hydrologic model output ibune and batea were both developed based on the hierarchical generalized processing of observation uncertainty 5 4 improving the soil n measurement accuracy n leaching surface runoff plant n uptake and gas emissions are four main sources of soil n losses the uptake of n by plants is often determined by continuous flow analyzer which is stable and easy to realize however the long term monitoring of soil n leaching surface runoff and gas emissions is complex and arduous due to limited resources in terms of n leaching measurement how to keep the original state of the soil column not to interfere with the surrounding soil environment is an urgent problem to be solved in the future improving the design and installation technology of lysimeters and developing new synchronous observation technology of soil moisture and n are the keys to study soil n leaching the n in surface runoff is usually determined by spectrophotometry but the soil particles in the runoff can affect the analysis results this is because the soil particles have an influence on the absorbance of spectrophotometer therefore this influence should be removed by means of centrifugation and filtration and the accuracy of the determination results can be further improved by increasing the number of repetitions soil gas emission measurement also needs further optimization greater numbers of chambers are often associated with higher reliability of flux measurements however it will also increase the field work how to balance the relationship between accuracy requirements and available resources is a problem to be solved 5 5 investigating the independence of n biogeochemical models mep can reduce model uncertainty and improve model prediction accuracy based on the assumption that each model is independent of each other therefore whether the model is independent or not is a problem that must be considered when using mep for example in table 1 both the hydrus and leachm models use the richards equation and convection diffusion equation to describe soil water movement and n transport respectively therefore these two models are not independent however each of them is independent of other models e g dndc and daycent in addition the essence of daycent and century is the same but the time step is different therefore these two models are not independent but each of them is independent of other models listed in table 1 although the model is independently developed by different research groups all over the world it has common features in some aspects firstly several models use the same hypothesis or theoretical parameters as model inputs e g both dndc and daycent models use cascade method for water percolation calculation in this case the parameters or structural uncertainty of the multiple models are the same and the combination of multiple models may not improve the accuracy in addition the same observation data are often used in the calibration or validation of the model thus the parameter defects or observation errors will not be eliminated when using mep secondly some models use the same numerical method for solving convection dispersion equation and each method has its own shortcomings as a result the existing n biogeochemical models cannot be considered completely independent the parameters and principles of each module should be considered strictly which is helpful to select some relatively independent models for mep 5 6 overcoming the limitation of mep for plot scale mep there is no scientific basis to decide which model is more suitable for combination guber et al 2009 models are often chosen according to researcher s subjective judgment or data preparation which means that the models applied in mep are not systematic the contribution of each prediction model to mep is also different therefore how to select the model needs careful consideration when using mep for regional scale mep the climate ensemble may produce unreliable simulation results in places with high precipitation this would certainly further influence the regional scale mep of n biogeochemical processes possible improvements include the following i increasing the resolution of the climate model ii increasing the number of forecast members iii improving the method of initial field disturbance and iv improving the simulation method of model error 5 7 developing more robust mep methods with the rapid development of artificial intelligence the application of machine learning technology e g artificial neural networks anns develops rapidly deep learning dl which refers to anns that are composed of many layers is a powerful set of techniques for finding accurate information from raw data hinton et al 2006 therefore dl has great potential to be applied in the context of unsupervised ensemble learning and has been used in some environmental modelling wang et al 2017 mo et al 2019 however little research is conducted to use dl for the mep of soil n cycle in addition under global climate change it is also an important research direction to combine big data and data mining technologies to extract forecast information from massive ensemble forecast data 6 conclusions nitrogen plays an important role in biogeochemical processes in soils the existing models describe the n biogeochemical processes with great uncertainty including parameters structural and observation uncertainty mep is an effective way to reduce the uncertainty in soil n modelling this paper elaborates the multiple sources of uncertainty influencing the reliability of n biogeochemical models and proposes the mep methods of n biogeochemical processes at plot and regional scales at plot scale the monte carlo sampling can be used to randomly alter the soil and crop parameters governing the n cycle and driving multiple soil n models while at regional scale an ensemble of tigge weather forecasts and an ensemble of random soil and crop parameters were generated and then multiple soil n models were driven the mep of soil n cycle was then realized at both scales these approaches will enable to reduce the uncertainty improve the prediction accuracy and better understand the soil n cycle across different spatial scales global climate change has always been the research focus of earth sciences therefore coupling the mep of n biogeochemical processes with global climate models can be applied to evaluate the impacts of global climate change on soil n losses under different water and fertilizer management in the future declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this study was financially supported by the national natural science foundation of china 41771107 and 41971117 the key research plans of frontier sciences chinese academy of sciences qyzdb ssw dqc038 and the youth innovation promotion association chinese academy of sciences 2020317 
24584,soil nitrogen n loss is a part of n biogeochemical processes which plays an important role in the agricultural ecological and environmental management because it is difficult to assess the temporal and spatial changes of different n forms in leachates by field measurement methods conceptual and physical models are usually used to describe soil n loss however soil n models are often associated with multiple sources of uncertainty e g model parameter and structure which may largely influence the reliability and accuracy of the models the multimodel ensemble prediction mep is specifically designed to reduce the parameter and structural uncertainty in n biogeochemical modelling by representing a set of candidate models however the existing mep methods still need to be improved by integrating various kinds of prior knowledge and quantifying each part of predictive uncertainty in addition published studies mainly focused on the regional scale mep of the land carbon balance however the regional scale mep of soil n losses is lacking this paper firstly proposed the mep methods of soil n losses at different spatial scales 1 using the monte carlo sampling to randomly alter the soil and crop parameters governing the n cycle and driving multiple soil n models at plot scale and 2 generating an ensemble of tigge thorpex interactive grand global ensemble weather forecasts and an ensemble of random soil and crop parameters and driving multiple soil n models at regional scale this study also discussed different methods used for realizing mep it is found that the ensemble mean produced a large bias when simulating soil n losses by using the bias correction technique the rmses of the ensemble mean decreased by 57 5 86 0 overall the mep can enhance our understanding of soil n cycle in addition this study is also helpful to accurately estimate the response of soil n loss to global change and provide support for agricultural production and environmental protection keywords nitrogen cycle biogeochemical processes model uncertainty vadose zone global change regional scale 1 modelling of soil n losses soil nitrogen n losses e g denitrification ammonia volatilization leaching and runoff play an important role in the biological production solute and energy transport and ecological environment quality in the earth s critical zone elser et al 2007 zhu et al 2012 griffis et al 2017 lu et al 2020 kherif et al 2021 in recent decades fertilization and tillage substantially accelerate the soil n losses lu et al 2011 which directly reduce the amount of n that plants can absorb thus reducing crop yield adiku et al 2021 movement of dissolved n with water through vertical and lateral subsurface flow contributes to the eutrophication of rivers and lakes qin et al 2007 excessive n loss into the water body also often leads to the proliferation of algae and aquatic plants the depletion of oxygen in the water and the decrease of water transparency will affect the survival of fish in addition nitrous oxide n2o and nitric oxide no emissions from soils to the atmosphere exacerbate the global climate change problem butman and raymond 2011 moreover precipitation through nitrate leaching and gas losses through denitrification can largely influence the water and n availability which have indirectly impacts on ecosystem co2 exchange including net ecosystem productivity ecosystem respiration and gross ecosystem photosynthesis zhang et al 2015a combined with the analytical instruments e g gas chromatograph and continuous flow analyzer several experimental apparatus have been designed to measure soil n losses e g zero tension lysimeters for collecting soil leachate samples and static chamber for sampling emitted greenhouse gases from soils valente et al 1995 however it is difficult to determine the spatio temporal variations of soil n losses due to sampling with sparse spatial coverage a limited number of locations and relatively low frequency one time for a week or two weeks therefore conceptual and physically based models with different degrees of complexity have been developed to simulate n biogeochemical processes of soils table 1 these models can be roughly divided into two groups biogeochemical process models and agro hydrological models with applications at different spatio temporal scales biogeochemical process models focused on n cycling simplify soil water parameters while agro hydrological models focused on agricultural practices and soil water processes simplify n cycling parameters many previous studies have been conducted to derive soil n models to simulate n runoff e g hou et al 2019 leaching e g li et al 2014 and gas emissions e g rahn et al 2012 across different spatio temporal scales it is worthy to note that zhu and riley 2015 emphasized that terrestrial models must represent soil n losses e g denitrification n loss and n emissions accurately if they are to credibly estimate emissions of nitrogen and carbon containing greenhouse gases important in climate change predictions performance and robustness of soil n models largely depends on errors in model parameter and structure modelling of n biogeochemical processes requires input parameters e g climate soil and crop the nonlinearity of the model parameters seriously complicates calibration of the n biogeochemical models against field monitoring data manzoni et al 2004 to overcome such model artifacts several previous studies e g lindgren and destouni 2004 applied the scaling methodology in form of the closed form expressions of regional scale delivery factors as functions of plot scale n loss rates to obtain the actual underlying n model parameter in addition previous studies concluded that there is no best model structure kronvang et al 2009 guber et al 2009 the mechanistic model considered the best may be better to describe the particular processes under certain calibration conditions but fail to adequately simulate other process during different calibration and validation periods to obtain more reliable predictions the multimodel ensemble prediction mep emerged as a popular and powerful technique in different environmental modelling applications exbrayat et al 2011 liao et al 2014 liao et al 2017 bastola and misra 2015 recently to deal with the model structure uncertainty lai et al 2020 combined the hydrus 3d and dndc models to simulate the spatio temporal variations of nitrate leaching on a tea garden hillslope with good accuracy 2 the mep methodology and its application in predicting soil n losses unlike single deterministic forecasts mep is based on a combination of the outputs of all candidate models this usually involves using various input parameters to a n biogeochemical model or using various n biogeochemical models to produce an ensemble of soil n outputs in order to perform better prediction accuracies compared with the single forecasts fig 1 the ensemble mean was used to combine outputs of all independent models for simulating the leachate no 3 n concentration the linear bias correction which shifts the ensemble mean forecasts proportionally and makes the means closer to that of the observations was then combined with the ensemble mean to improve the predictions 1 y a 0 a x e m where y is the bias removed ensemble mean a 0 is the intercept a is the slope and x em is the ensemble mean from fig 1 the bias removed ensemble mean matched well with observations in the field of earth sciences mep was first applied in climate predictions krishnamuri et al 2000 yun et al 2003 and then extended to other fields such as forecasting of flood roulin 2007 cloke and pappenberger 2009 groundwater flow ye et al 2004 rojas et al 2008 and water flow in the vadose zone guber et al 2009 liao et al 2017 mep is now slowly also being used in n biogeochemical modelling kronvang et al 2009 first applied the mep to predict n losses with the use of eight different n models in 17 european catchments and demonstrated the superiority of mep compared to single forecasts mep was then used to simulate transport of different n forms e g nitrate no 3 n ammonium nh 4 n and total n loads in a swedish meso scale catchment exbrayat et al 2010 total n concentration in a western australian catchment exbrayat et al 2011 no and n2o emissions from three winter wheat summer maize rotation fields in shanxi province of china zhang et al 2015b recently teutschbein et al 2017 applied 15 climate model combinations 1 hydrological model and 5 n models to create an ensemble of simulations of inorganic n loading from land to water across boreal hemiboreal sweden since the mep was introduced in the late 1960s the focus is on whether this method is better than single forecasts regarding this question almost all the studies have reported that mep outperformed single forecasts in n biogeochemical modelling kronvang et al 2009 exbrayat et al 2013 sharma et al 2019 a biogeochemical model consists of several components while the individual components closely interact with one another any component is likely to influence the nearly all biogeochemical processes however usually the soil n cycle is represented by several empirical equations generated from laboratory studies besides the classical laws of physics chemistry and biology it is prone to incorrect simulation results based on a single model by neglecting the possibility of other expression forms to describe the core processes in that case single models tend to show worse performances than ensembles indeed forecast error can be reduced by using ensembles due to the nonlinear filtering process an ensemble mean forecast is statistically or on average more robust and accurate than a single forecast and then an improved forecast but mep is not only a tool to improve a single deterministic forecast but more importantly to quantify forecast uncertainty which is the ultimate goal and the core mission of mep 3 uncertainty in n biogeochemical models many previous studies have found that there is no single accepted theory of n cycling and n biogeochemical models are still facing a high degree of uncertainty for example exbrayat et al 2010 found that the mismatches of the predictions of different n forms e g no 3 n nh 4 n and total n loads with the observations could not only be attributed to the sole parameter uncertainty moreover they demonstrated that more complex tools based on a more detailed description of n biogeochemical processes were not necessarily better zhang et al 2015b observed that simulations of no and n2o emissions by the dndc landscape dndc and iap n gas models produced the uncertainty resulting from the structural differences initial conditions and parameterizations in n biogeochemical models recently teutschbein et al 2017 indicated that the driving climate models were the main cause of model uncertainty when simulating inorganic n loading from land to water across boreal hemiboreal sweden however when analyzing an individual study site the hydrological model parameterization and the choice of an appropriate n model were of much greater importance than when upscaling to the entire swedish land area mep is specifically designed to deal with the uncertainty in n biogeochemical modelling by representing a set of n models multiple sources of uncertainty influence the reliability of n biogeochemical models according to the logical process of n modelling the source could be partitioned as model parameter model structural and observation uncertainties fig 2 which are described in detail below 3 1 parameter uncertainty the parameter uncertainty is recognized as one of the most important uncertainty of n biogeochemical model predictions this uncertainty is mainly due to the different practical significance of each parameter some parameters are difficult to obtain accurate values and the parameters calibrated by empirical estimation or measured values may have deviations from the actual values the uncertainty and sensitivity analysis of parameters plays an important role in optimizing the range of parameters and improving the application ability of the model so far the two most common methods for quantifying parameter uncertainty include markov chain monte carlo mcmc mangoubi and smith 2017 and generalized likelihood uncertainty estimation glue beven and binley 1992 mcmc is a dynamic sampling technique that allows sampling of complex high dimensional distributions not accessible by simple samplers middleton et al 2019 the core of mcmc is an algorithm which determines the sampling efficiency and reliability of uncertainty analysis the common algorithms are metropolis hastings m h adaptive proposal distribution ap adaptive metropolis am gibbs shuffled complex evolution metropolis scem and differential evolution adaptive metropolis dream wu and zeng 2013 recently extensions of the m h algorithm e g metropolis adjusted langevin and the hamiltonian or hybrid monte carlo algorithms were also popular mcmc algorithms especially for large dimensional targets heng and jacob 2019 jacob et al 2020 previous studies have been conducted to apply mcmc to solve n biogeochemical model uncertainty problems rahn et al 2012 combined the multi chain mcmc and metropolis algorithm to estimate the uncertainty of the model parameters in modelling of soil no and n2o emissions from forest sites in the study by fitton et al 2014 monte carlo simulations were conducted to test the potential influence of uncertainties in the soil and climate inputs on modelled n2o emission from cropland sites in general mcmc shows strong flexibility and high reliability in uncertainty analysis of various n biogeochemical models glue has also been used in evaluation of n model parameter uncertainty liebermann et al 2018 the core idea of this method is that the model accuracy is not affected by one parameter but by multiple parameters glue a monte carlo simulation technique uses uniform random sampling to obtain the posterior distributions of the model parameters in that case this method requires a huge number of simulations to obtain the convergence of monte carlo simulation due to its ineffective sampling technique previous studies have demonstrated that glue is only suitable for low dimensional parameter uncertainty analysis whereas mcmc is more stable for complex high dimensional problems wu and zeng 2013 to improve the efficiency of the uncertainty analysis technique a sensitivity analysis is often used prior to the uncertainty analysis this helps to restrict the analysis to the most important parameters and to avoid overfitting the widely used sensitivity analysis techniques include multivariate regression morris and sobol s methods and extended fourier amplitude sensitive test efast zhang et al 2020 previous studies applied the sensitivity analysis to determine the key parameters of n biogeochemical models it is found that soil properties e g ph and clay content are more important than the remaining input parameters in estimating soil n2o emission fitton et al 2014 while soil n leaching was most sensitive to fertilizer rate and soil porosity li et al 2014 3 2 structural uncertainty n biogeochemical processes of soils are described with a set of equations i e the model structure the reason for the structural uncertainty is that the conceptual model is not able to represent the real n biogeochemical processes in other words all models are not perfect and have their limitations for instance nitrification and denitrification processes occur at the same time and are mutually influenced by each other indicating a knowledge gap of core processes describing n biogeochemical cycle arhonditsis et al 2008 in addition round off error a miscalculation that results from rounding off numbers to a convenient number of decimals also contributes to structural uncertainty if a numerical simulation model e g hydrus šimůnek et al 1998 is applied as a result accurate simulation of soil n cycle is still a challenge for existing models xu and zhang 2014 in addition the simulation results obtained by different n model structures are also quite different which has been observed by abdalla et al 2010 for soil n2o fluxes by sansoulet et al 2014 for plant n uptake and by boomer et al 2013 for n discharge from a watershed mep is an effective tool to deal with the n model structural uncertainty the standard mep consists of the following steps i calibrating a group of n biogeochemical models with measured data ii ranking these models based on evaluation criteria iii removing the models with unreasonable and poor performances and iv combining the weighted predictions of the remaining models the simplest form of mep is the ensemble mean that assigns equal weight on all the candidate models finding weights of individual forecasts in mep is an improved method e g by using regression based method information theory and bayesian model averaging bma samadi et al 2020 among these methods the most popular method is bma which is not only able to integrate various kinds of prior knowledge but also quantify each part of predictive uncertainty mustafa et al 2020 ajami and gu 2010 first applied the bma to investigate the complexity in microbial metabolic processes in soil n modelling based on different biogeochemical models they suggested the need to consider a mep strategy over a single model selection in biogeochemical modelling study previous studies have been conducted to compare the model parameter and structural uncertainty in biogeochemical modelling among these some have found that model parameter uncertainty dominated over model structural uncertainty e g shen et al 2013 ma et al 2018 however other studies have shown that the model uncertainty is primarily caused by the structural uncertainty rather than the parameter uncertainty radwan et al 2004 o neill and melnikov 2008 the various studies suggest that the answer to the question of which uncertainty is more important relies on the choice of the n models and the exactness and representativeness of model parameters 3 3 observation uncertainty observation uncertainty stems from systematic a persistent error that cannot be attributed to chance and random errors a statistical error that is wholly due to chance and does not recur which can occur in the processes of collecting and measuring data when soil n model is calibrated and validated based on a group of less robust observation data the uncertainty related to model output is regarded as observation error n studies have focused on uncertainty related to observed data for example previous studies found that there is large spatial variability in soil n2o fluxes giltrap et al 2020 thus either multiple small chambers or fewer larger chambers are required to reduce the measurement uncertainty matthews et al 2010 chadwick et al 2014 the degree of linearity of headspace n2o accumulation which is influenced by chamber height soil air porosity soil warming and cooling can also attribute to the measurement uncertainty based partly on gas transport theory headspace n2o concentrations in closed chambers increase nonlinearly with time anger et al 2003 found apparent linearity even in those chambers with the largest fluxes which therefore were the least likely to be subject to observation uncertainty chadwick et al 2014 suggested that maximizing chamber numbers should be given priority over maximizing the number of headspace samplings per enclosure period due to limited resources in addition several studies discussed the validity of using ambient air samples as a surrogate for the initial headspace n2o concentration cardenas et al 2010 smith et al 2012 soil n studies also focused on observation uncertainty in n leaching the common methods for estimating n leaching are lysimeter ceramic suction cup and soil resin core methods lysimeter has the advantage of simultaneously determining the n concentration and leaching water volume while ceramic suction cup and soil resin core can only determine the n concentration allaire leung et al 2001 fares et al 2009 wang et al 2012 found that suction cups are inappropriate for the determination of cumulative leaching in the structured soils preferential flow is attributed to differences between the results obtained by the suction cups and the lysimeters kabala et al 2017 demonstrated that acceptable results could be obtained from suction cups when used in unstructured well drained soils lysimeters measure the total leaching loss from a known sample volume which is useful for irrigation and fertilizer applications however when using this method the soil structure is destroyed resulting in the alteration of the pathways for water and solute flow weihermuller et al 2007 overall all of the methods have advantages and disadvantages so researchers should apply particular method under particular conditions it may be an effective approach to reduce the observation uncertainty by combining the multiple observed values obtained by different methods 4 toward a framework for the mep of soil n losses in previous studies the mep has been used to predict soil n cycle however these studies mainly focused on the regional or catchment scale e g kronvang et al 2009 exbrayat et al 2013 but not on the plot or site scale in addition mep was often applied to deal with the n model structural uncertainty not the model parameter uncertainty furthermore almost all studies used the simple average of the ensemble members to realize mep but this kind of assigning equal weights easily led to systematic bias in the prediction results to solve these problems a framework for the mep of soil n cycle at plot and regional scales is proposed in this section fig 3 previous studies demonstrated that climate soil and crop parameters are the key parameters influencing the n cycle in the field li et al 2014 fitton et al 2014 hou et al 2019 messaoudi et al 2020 these parameters are difficult to measure accurately due to the heterogeneity of the environment however the plot scale meteorological data can be more accurate than soil and crop parameters therefore the plot scale mep mainly focuses on the uncertainty in soil and crop parameters at regional scale the spatial variation of climate factors e g precipitation and air temperature cannot be effectively reflected by the plot scale data measured by traditional ground meteorological stations cloke and pappenberger 2009 in this case the regional scale mep should consider the uncertainty in climate factors in addition to those in soil and crop parameters 4 1 plot scale mep mep was used to deal with both the n model parameter and structural uncertainty the plot scale mep can be constructed as following steps fig 3 i collecting and analyzing the model data in the study area such as topography vegetation or crop soil climate and management practices ii developing and calibrating multiple n biogeochemical models in the study area based on the measured data iii using the monte carlo sampling or latin hypercube technique mckay et al 1979 to randomly alter the soil and crop parameters governing the n biogeochemical processes while the previously calibrated water balance parameters remain constant iv realizing a large number of model runs for each n model and compiling several single model ensembles for each model with independent n forms e g no 3 n concentration and n2o flux v selecting one best single model ensemble per model and n form based on two goodness of fit indicators the coefficient of determination r 2 and the root mean squared error rmse eq 1 2 rmse i 1 n o i s i 2 n where oi and si are observed and simulated value at time step i and n is the number of observations vi and compiling multimodel ensembles for each n form and applying the ensemble mean arithmetic average of all individual models or other methods e g bias removal techniques and superensemble based on weight optimization to realize mep and testing the mep of soil n cycle based on evaluation criteria the key to the success of plot scale mep of soil n cycle lies in the step iii which is how to generate random soil parameters especially soil hydraulic properties shps e g field capacity permanent wilting point and saturated hydraulic conductivity which are difficult to measure directly bouma 1989 these are the most important parameters controlling the soil hydrological processes which transport and connect electron donors and electron acceptors that determine redox potential and thus n biogeochemical processes zhu et al 2018 therefore accurately estimating the mean and standard deviation sd for probability distributions of the shps is critical for monte carlo sampling in mep pedotransfer functions ptfs have long been applied to predict shps from easily measured basic soil properties e g texture organic matter content and bulk density schaap et al 1998 pachepsky and rawls 2004 liao et al 2011 and can be applied to find the mean and sd of the shps the common method is to use various ptfs developed in different regions to predict the shps in a certain area and then the mean and sd of the shps can be estimated cichota et al 2013 there is no strict requirement for the selection of ptfs but we suggest that those ptfs developed from relatively large databases e g 200 soil samples as suggested by guber et al 2009 should be selected as far as possible such as soilpar 2 acutis and donatelli 2003 rosetta schaap et al 1998 and hypres wösten et al 1999 this is because the accuracy and reliability of the ptfs largely depend on the number of samples khodaverdiloo et al 2018 in addition the uncertainty in crop parameters e g biomass c n ratio and initial biomass production of grains leaves stems and roots also needs to be focused on and can be investigated by analyzing the effects of different crop parameter variation ranges on model output uncertainty based on some statistical analysis e g kendall s coefficient of concordance and the top down coefficient of concordance helton et al 2004 based on this the mean and sd of crop parameters can be determined taking a case study as an example the plot scale mep was used to predict soil no 3 n losses from a tea garden hillslope which was located in the western hilly area of taihu lake basin china 31 21 n 119 03 e the process based daycent dndc leachm and hydrus models were selected to represent the model structural uncertainty while 6 classical ptfs available in soilpar 2 software were selected to represent the soil parameter i e field capacity and permanent wilting point uncertainty the period from 2013 2015 was used for model calibration while the period of year 2016 2018 was applied for model validation a comprehensive field survey was carried out during 2013 2018 covering all the information of agricultural practices and environmental factors e g climate soil and plant for detailed information of the model simulation regarding descriptions of models and ptfs settings of model initial conditions in the tea garden ecosystem and simulation outputs of the bias removed ensemble mean we refer to the study of liao et al 2020 as seen in fig 4 ab the total water percolation and no 3 n leaching fluxes simulated by the four models were relatively different the soil parameter and model structural uncertainty were equally important in soil no 3 n leaching modelling fig 4c the rmses of the daycent dndc leachm and hydrus model ensemble mean were 32 73 13 50 10 80 and 10 94 mg l 1 respectively the ensemble mean produced a large bias when simulating the leachate no 3 n concentrations fig 4defg which may be related to the prediction bias of ptfs since the accuracy of ptfs outside of their development area is generally low after bias removal the rmses of the ensemble mean decreased by 57 5 86 0 fig 4h exbrayat et al 2010 also found the multi model ensembles produced better n prediction results than single model ensembles this confirmed the benefits of exploring different model structures amongst which we may not know an a priori best one it is because that each model captures certain important aspects of the information about the system and the advantages of some models can compensate for weaknesses in the other models resulting in an overall better prediction 4 2 regional scale mep the regional scale mep has to deal with the uncertainty associated with climate factors e g precipitation and temperature which drive multiple hydrological and biogeochemical processes gao et al 2014 however the variability of climate factors may largely influence the regional scale n modelling downscaling of multiple global climate models and coupling them with regional scale n biogeochemical models can be an effective avenue to realize regional scale mep and improve n simulations kok et al 2018 in addition the coupled models can be further applied to reduce soil n losses by the optimization of irrigation water and fertilizer management practices especially under global climate change combination of different irrigation regimes and n rates can be input into the coupling models to simulate soil n losses and crop production by using the scenario simulation finally economic analysis can be applied to determine the most appropriate combination of n fertilizer and irrigation the atmosphere is a highly nonlinear system so it is impossible to predict its exact state chen et al 2019 weather prediction is not only represented by the physical process but also limited by the resolution of the simulated atmospheric dynamics and the sensitivity to the model s initial condition and sub grid parameterization cloke and pappenberger 2009 thorpex shapiro and thorpe 2004 interactive grand global ensemble tigge starting from october 2006 aims to address the nature of uncertainty in weather observations tigge consists of ensemble forecast data from 10 global national weather prediction centers e g national centers for environmental prediction ncep european centre for medium range weather forecasts ecmwf china meteorological administration cma etc richardson 2005 the ensembles of numerical weather predictions are often applied in different hydrological and flood forecasting cloke and pappenberger 2009 but they are rarely used in n cycle modelling just recently chang et al 2017 coupled eight isimip2a biome models and two climate forcing datasets to produce 16 simulations of net carbon fluxes over global terrestrial ecosystems in order to use climate ensembles in n biogeochemical models meteorological pre processing is usually required due to the spatio temporal scale mismatch between the original tigge product and the climate input used by the n models therefore the original forecasts should be downscaled or disaggregated walsh et al 2018 first applying bilinear interpolation to regrid a low resolution product to a high resolution grid then establishing the linear relationship between the forecast value and the observations at each grid point and correcting the error caused by the interpolation and finally integrating the results of each forecast center after correction in some ways e g by using bias removed ensemble mean and superensemble approaches krishnamurti et al 1999 the regional scale mep is constructed as following steps fig 3 i measuring the model data in the study area and further developing and calibrating multiple n models ii generating an ensemble of tigge weather forecasts and using the monte carlo sampling to randomly alter the soil and crop parameters iii using different soil and crop parameters and weather forecasts to drive n models and realizing a large number of model runs for each n model iv compiling several single model ensembles for each model v selecting one best single model ensemble per model and n form based on evaluation criteria and compiling multimodel ensembles for each n form and vi applying bma to realize mep and evaluate the performance of the mep in the step ii ptfs can also be applied to find the mean and sd of the shps but the spatial variability of the ptf inputs pedotransfer variables e g basic soil properties at regional scale must be considered due to the fact that the ptf inputs are often obtained using the kriging cokriging techniques the ptf input uncertainty can be represented by the kriging cokriging variance and quantified by assuming that the kriging cokriging estimates follow a normal distribution deng et al 2009 in regional scale mep the mean and sd for probability distributions of the shps can be estimated by integrating various ptfs developed in different regions and multiple kriging cokriging estimates of the ptf inputs chirico et al 2007 5 key challenges of using mep for n biogeochemical modelling 5 1 using new advancements in geophysical and biochemical sampling methods to improve regional scale n models state of the art geophysical and biochemical methods should be applied to assess effects of heterogeneity of surface and subsurface domains on soil n cycle and improve regional scale n models in these domains several hydrological and biological processes e g dynamic redox zone preferential flows and subsurface and surface flows to streams and lakes and parameters dominate at regional scale compared to plot scale in recent years behroozmand et al 2019 used a new tractive time domain electromagnetic system to derive detailed three dimensional 3d information about the subsurface materials and their hydraulic properties maurya et al 2020 also applied a towed transient electromagnetic tool to map a 3d subsurface hydrogeology in high resolution if the distribution of sand and clay deposits is known in the vicinity of the agricultural n pollution source one can predict the pathways for the movement of the water and n in addition the biochemical tracer techniques e g stable isotopes have also been used to understand the hydrological and n cycles wu et al 2019 engesgaard et al 2020 5 2 understanding the hydrological and microbial regulation mechanism of soil n cycle understanding the mechanism of soil n cycle has to be improved as mep would benefit from better members exbrayat et al 2010 from a hydrological perspective the movement of soil water is the primary driving force of n transport in the vadose zone in addition soil water content regulates redox potential over long time periods and further affects soil n transformations lin 2010 previous studies focused the effects of soil water processes on n biogeochemical cycle that were comparable to those of land use land cover climate factors and topography saha et al 2016 latati et al 2019 however these effects have not been comprehensively and fundamentally integrated into n cycling investigations parameters like soil moisture water leakage and water table were often applied to develop empirical relationships between soil water and n cycle e g zhu et al 2015 but mechanisms remained unclear recently zhu et al 2018 reviewed recent progress in research on soil water processes and soil n cycle and proposed three possible solutions hydrogeophysical upscaling and model coupling techniques for studying interactions between soil water processes and the n cycle from a microbial perspective n fixation nitrification denitrification anaerobic ammonium oxidation and dissimilatory nitrate reduction to ammonium performed by a group of bacteria and archaea are the five key microbial processes to regulate soil n cycle ajami and gu 2010 recently kherif et al 2021 also highlighted the functional role of micro organisms in the modelling of continuous transfers of c and n in terrestrial ecosystems however the relative contributions of the five microbial processes to n cycle are still unclear hydrological processes are always merged with microbial processes to regulate soil n cycle simultaneously fig 5 at high soil moisture levels anoxic conditions prevent bacteria from performing the aerobic oxidation that is necessary for decomposition in this case the process of denitrification may occur releasing n gases the optimum conditions for nitrification are very similar to those for ammonification and net n mineralization with a little different when the soil tends to be saturated with the decrease of soil water content the activity of microorganisms will decrease resulting in the reduction of the ammonification rate at low soil moisture levels porporato et al 2003 in the previous study the eco hydrology was coupled with biogeochemical cycle to simulate the carbon cycle changes nakayama and pelletier 2018 however little research was conducted to develop a hydrologic and n biogeochemical coupling model therefore it is necessary to couple the hydrological and microbial regulation mechanism for a better understanding of the soil n cycle zhu et al 2018 proposed that soil water processes play an important role in regulating the abundance duration and timing of n rich microsites in turn the abundance duration and timing of these microsites play a critical role in the magnitude and vector of environmental n losses which can lead to water pollution and the accumulation of subsoil organic matter they also suggested that using hydrogeophysical tools e g ground penetrating radar or gpr electromagnetic induction or emi and electrical resistivity tomography or ert to detect soil water processes and then linked to electrochemical n sensors to reveal the soil n cycle 5 3 accurately estimating the uncertainty associated with n biogeochemical models the primary purpose of n model uncertainty analysis is to give a range of an output parameter for example major uncertainties can be identified through sensitivity analysis which can be helpful to understand and simplify the structure of the model improve the efficiency of parameter calibration and the accuracy of the model and increase the reliability of the model the largest source of uncertainty in modelling n biogeochemical processes should be given particular attention in previous studies only limited parameters and models were considered to quantify model uncertainty a large number of additional crop and soil related parameters can strongly impact the simulation results it makes sense to include a reasonable range of key parameters and n models to estimate model uncertainty in addition existing studies focused less on the influence of observation uncertainty on n biogeochemical modelling the observation error is assumed to be independent normally distributed with a mean of 0 and covariance matrix i e the error variance magnitude at each data point and its correlation to adjacent data points wu and zeng 2013 at present bayesian forecasting system bfs integrated bayesian uncertainty estimator ibune and bayesian total error analysis batea kavetski et al 2006 can be potential tools to address the observation uncertainty in n biogeochemical modelling for example herr and krzysztofowicz 2015 used the analytic numerical bfs which produced a short term probabilistic stage transition forecast to quantify the observation uncertainty associated with the hydrologic model output ibune and batea were both developed based on the hierarchical generalized processing of observation uncertainty 5 4 improving the soil n measurement accuracy n leaching surface runoff plant n uptake and gas emissions are four main sources of soil n losses the uptake of n by plants is often determined by continuous flow analyzer which is stable and easy to realize however the long term monitoring of soil n leaching surface runoff and gas emissions is complex and arduous due to limited resources in terms of n leaching measurement how to keep the original state of the soil column not to interfere with the surrounding soil environment is an urgent problem to be solved in the future improving the design and installation technology of lysimeters and developing new synchronous observation technology of soil moisture and n are the keys to study soil n leaching the n in surface runoff is usually determined by spectrophotometry but the soil particles in the runoff can affect the analysis results this is because the soil particles have an influence on the absorbance of spectrophotometer therefore this influence should be removed by means of centrifugation and filtration and the accuracy of the determination results can be further improved by increasing the number of repetitions soil gas emission measurement also needs further optimization greater numbers of chambers are often associated with higher reliability of flux measurements however it will also increase the field work how to balance the relationship between accuracy requirements and available resources is a problem to be solved 5 5 investigating the independence of n biogeochemical models mep can reduce model uncertainty and improve model prediction accuracy based on the assumption that each model is independent of each other therefore whether the model is independent or not is a problem that must be considered when using mep for example in table 1 both the hydrus and leachm models use the richards equation and convection diffusion equation to describe soil water movement and n transport respectively therefore these two models are not independent however each of them is independent of other models e g dndc and daycent in addition the essence of daycent and century is the same but the time step is different therefore these two models are not independent but each of them is independent of other models listed in table 1 although the model is independently developed by different research groups all over the world it has common features in some aspects firstly several models use the same hypothesis or theoretical parameters as model inputs e g both dndc and daycent models use cascade method for water percolation calculation in this case the parameters or structural uncertainty of the multiple models are the same and the combination of multiple models may not improve the accuracy in addition the same observation data are often used in the calibration or validation of the model thus the parameter defects or observation errors will not be eliminated when using mep secondly some models use the same numerical method for solving convection dispersion equation and each method has its own shortcomings as a result the existing n biogeochemical models cannot be considered completely independent the parameters and principles of each module should be considered strictly which is helpful to select some relatively independent models for mep 5 6 overcoming the limitation of mep for plot scale mep there is no scientific basis to decide which model is more suitable for combination guber et al 2009 models are often chosen according to researcher s subjective judgment or data preparation which means that the models applied in mep are not systematic the contribution of each prediction model to mep is also different therefore how to select the model needs careful consideration when using mep for regional scale mep the climate ensemble may produce unreliable simulation results in places with high precipitation this would certainly further influence the regional scale mep of n biogeochemical processes possible improvements include the following i increasing the resolution of the climate model ii increasing the number of forecast members iii improving the method of initial field disturbance and iv improving the simulation method of model error 5 7 developing more robust mep methods with the rapid development of artificial intelligence the application of machine learning technology e g artificial neural networks anns develops rapidly deep learning dl which refers to anns that are composed of many layers is a powerful set of techniques for finding accurate information from raw data hinton et al 2006 therefore dl has great potential to be applied in the context of unsupervised ensemble learning and has been used in some environmental modelling wang et al 2017 mo et al 2019 however little research is conducted to use dl for the mep of soil n cycle in addition under global climate change it is also an important research direction to combine big data and data mining technologies to extract forecast information from massive ensemble forecast data 6 conclusions nitrogen plays an important role in biogeochemical processes in soils the existing models describe the n biogeochemical processes with great uncertainty including parameters structural and observation uncertainty mep is an effective way to reduce the uncertainty in soil n modelling this paper elaborates the multiple sources of uncertainty influencing the reliability of n biogeochemical models and proposes the mep methods of n biogeochemical processes at plot and regional scales at plot scale the monte carlo sampling can be used to randomly alter the soil and crop parameters governing the n cycle and driving multiple soil n models while at regional scale an ensemble of tigge weather forecasts and an ensemble of random soil and crop parameters were generated and then multiple soil n models were driven the mep of soil n cycle was then realized at both scales these approaches will enable to reduce the uncertainty improve the prediction accuracy and better understand the soil n cycle across different spatial scales global climate change has always been the research focus of earth sciences therefore coupling the mep of n biogeochemical processes with global climate models can be applied to evaluate the impacts of global climate change on soil n losses under different water and fertilizer management in the future declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this study was financially supported by the national natural science foundation of china 41771107 and 41971117 the key research plans of frontier sciences chinese academy of sciences qyzdb ssw dqc038 and the youth innovation promotion association chinese academy of sciences 2020317 
