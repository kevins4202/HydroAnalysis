index,text
6090,decades of efforts to reduce groundwater overdraft through investment in irrigation efficiency has in many cases failed to reduce aquifer depletion this is one reason for greater attention to water supply augmentation efforts through the capture of surface water during high flow events for managed aquifer recharge mar or additional surface storage we use a landscape level model to examine the optimal interaction among mar surface reservoir storage crop choice and groundwater conservation policies in eastern arkansas we find the cost of mar water must be less than half the average groundwater pumping cost to increase the aquifer level increases in irrigation intensive crops mean that only a fraction of the recharged water raises groundwater levels we observe that policies to conserve groundwater such as a pumping cap or tax are more cost effective for society with a lower cost of mar water keywords optimization model spatial dynamic long run aquifer management managed aquifer recharge 1 introduction falling groundwater levels raise the future costs of well pumping for irrigation and diminish the resilience of agriculture to drought over the past century the average annual groundwater depletion in the united states was about 6 5 million acre feet and this average rose to 19 4 million acre feet from 2001 to 2008 konikow 2013 reducing withdrawals by increasing irrigation efficiency alone is not an adequate solution for the sustainable management of groundwater pfeiffer and lin 2014 grafton et al 2018 instead many regions conjunctively use surface and groundwater harou and lund 2008 anrc 2017 one type of conjunctive use is the storage of excess surface water in aquifers through managed aquifer recharge mar rather than in surface reservoirs harter and dahlke 2014 o geen 2018 however no studies optimize whether mar can economically complement traditional irrigation sources such as groundwater or surface reservoirs the traditional supplies are likely cheaper initially but the role of mar in irrigation could become prominent as those sources become unavailable or prohibitively expensive our study fills three major knowledge gaps in the literature by optimizing economic returns through the spatial dynamic interaction of mar traditional irrigation sources and crop choice first the optimization of economic returns is relevant because this is how farm irrigators the principal water users make their decisions the optimization then provides a useful guide for how the irrigators might use mar over time and across the landscape as the expense of traditional irrigation sources rise second crop choice allows switching between crops of varying irrigation intensity and this can lead to a slippage effect which is when the use of mar stabilizes groundwater levels causes a switch to irrigation intensive crops and increases groundwater pumping grafton et al 2018 the slippage effect occurs with the use of efficient irrigation practices pfeiffer and lin 2014 adams and kovacs 2019 and the conjunctive use of surface reservoirs kovacs and durand morat 2017 but no study examines if and how much this occurs with mar third since the study of mar through optimization is new our analysis examines how sensitive optimal mar use is to crop profitability initial groundwater depths and groundwater conservation policies which is of potential interest to water managers and policy makers traditionally the construction of surface reservoirs allows for the storage of water during the wet season for dry season uses however reservoir storage can be expensive occupy valuable land and most of the optimal locations for reservoirs are already developed scanlon et al 2016 brown et al 2019 surface water reservoirs are also less attractive if heat waves from climate change shift snowpack runoff to the early spring when demand is low barnett et al 2005 or more intensive rainfall leads to flood water that reservoirs do not have the capacity to store najibi et al 2017 instead excess water could be put into depleted aquifers to increase sustainable groundwater yields bouwer 2002 aquifer storage methods include injection through wells shafts and boreholes spreading over fields induced bank filtration and in channel or reservoir modifications hannappel et al 2014 mar can increase groundwater supplies to buffer against climate extremes in the future and water agencies use mar in many parts of the world niswonger et al 2017 scherberg et al 2014 2018 however mar through injection wells is often less economically feasible than surface reservoirs because there is a large expense to clean and pump water into the aquifer also the use of mar through infiltration basins means there are expenses for land and maintenance of the basins all mar approaches mean there is a future expense to pump the water back out of the aquifer recent research highlights the use of mar to sustain agricultural production harter dahlke 2014 scanlon et al 2016 o geen 2018 however most of this research focuses on the technical suitability of mar with geographic information systems ahani amineh et al 2017 smith et al 2017 gibson et al 2018 or hydrologic models i e modflow niswonger et al 2017 scherberg et al 2014 2018 rather than economic feasibility mar is a type of conjunctive use that directs excess surface water to aquifer storage rather than surface reservoirs evans and evans 2011 dillon and arshad 2016 when the capacity of surface reservoirs is met excess water can be directed into the aquifers spatial variability in the hydrologic and agronomic conditions of a landscape then determine where and when mar is economically feasible maliva 2014 2015 dillon and arshad 2016 although mar is technologically feasible kresse et al 2014 little is known about the effects of mar on groundwater pumping land use and the economic returns on an agricultural landscape nor do earlier studies examine as our study does the trade offs in the role of groundwater augmentation through on and off farm surface storage and mar to maximize economic returns through conventional and efficient irrigation practices marques et al 2010 balali et al 2011 and pulido velazquez et al 2011 analyze groundwater conservation technologies and multiple crops while comparing objectives such as aquifer conservation and economic returns marques et al 2010 use two stage stochastic quadratic programming to optimize conjunctive water use of groundwater pumping and artificial recharge with cropping and irrigation technology decisions for an irrigation district in california marques et al 2010 rely on the assumption of a single large aquifer and a negligible change in the groundwater table and pumping cost for the entire irrigation district also their model of the aquifer assumes an instant and uniform response to pumping over the entire extent and this representation for the aquifer significantly underestimates the magnitude of the groundwater pumping externality brozović et al 2010 balali et al 2011 use a non linear optimization model to analyze the impacts of irrigation water pricing and agricultural policy scenarios on aquifer conservation although the recharge volume in their model was not chosen through optimization pulido velazquez et al 2011 propose a downscaling approach to generate future climate indices and incorporate those indices into the simes and aquatool process based simulation models to examine conjunctive use water management mar is a component of the model but mar is not chosen through an optimization model other economic mar studies do not consider how to spatially optimize artificial recharge for a landscape our study region for the optimal use of excess water for surface reservoirs or mar through injection wells is eastern arkansas usa arkansas is the largest user of water for irrigation from the mississippi valley alluvial aquifer the third most used aquifer in the united states konikow 2013 the region receives an abundant 45 50 in of rainfall per year clark and hart 2009 but this mostly occurs in the winter and spring seasons before the crop s major water demand and this makes the storage of the seasonal rainfall an attractive prospect based on the legal definition of excess surface water for the state there is more than 5 5 million acre feet year or 85 of all irrigation water applied in the state in 2013 of excess surface water that can be withdrawn from two major rivers in the region anrc 2014 usda nass 2013 groundwater use in arkansas supports the largest rice production in the united states in addition to other irrigated crops especially soybeans but also corn and cotton a substantial rise in the number of irrigated acres has meant a tenfold increase in the use of groundwater for irrigation between 1950 and 2010 kresse et al 2014 cones of depression in the groundwater level surface have led to the designation of critical groundwater areas in the state anrc 2005 2017 we examine whether irrigators choose between groundwater pumping that results in lower water levels and higher pumping costs surface reservoirs constrained by capacity and mar constrained by the maximum injection rate and water conveyance and cleaning costs from surface water sources to injection sites this in turn influences farm decisions across the landscape for crop choice and irrigation practices particular attention is given to the relationship between the irrigation intensity of the chosen crops and the surface reservoir and mar water costs mar recovery efficiencies and the occurrence of drought 2 methods we use non linear optimization to maximize the present value of net returns from farm production over an entire time horizon through the choice of multiple crops mar water use and on and off farm surface water use for a couple thousand sites on a landscape other than the well pumping component the model is linear in the choice variables our aim is to consider how the detailed spatial and temporal dimensions of a deterministic model influence crop and water source choices we assume that farm producers collectively optimize profits and perfectly foresee future market and environmental conditions to keep the focus on the tradeoffs between the optimal planner s use of mar and other water sources the baseline model supposes that there is no use of mar and we compare model outcomes without mar to the outcomes with mar for a range of mar costs sensitivity analyses of the baseline model with mar evaluate the robustness of mar use net returns and aquifer conservation to changes in key parameters 2 1 land use choices the landscape is spatially heterogeneous in groundwater resources and crop yields anrc 2017 usda nass 2018a there are many potential remedies to groundwater overdraft and our model considers surface water storage with on farm reservoirs or off farm water water stored in surface reservoirs deliveries non irrigated crops idle crop land and more efficient irrigation practices there are m land uses that include the following crops rice irrigated soybean corn and cotton non irrigated soybean and double cropped irrigated soybean with winter wheat two other land uses include fallowing the land or constructing on farm reservoirs an on farm reservoir built on a unit of land permanently remains as a reservoir for the duration of the study period these crops may use k irrigation practices namely conventional contour levee flood for rice and flexible poly pipe furrow for other crops conservation furrow the use of soil sensors and computerized hole selection software for calculating punched hole sizes in flexible poly pipe and zero grade leveling flood for rice hignight et al 2009 henry et al 2016 mississippi state university 2016a b each year t a producer at farm site f chooses to allocate a fli t acres to land use l and irrigation practice i 1 1 there is typically a mix of crops in each cell each year that reflects the crops grown in rotation based on the historical land use but there is no constraint that crop types switch every year there are sixteen crop and irrigation practices choices each year a site can have more than one crop and irrigation choice eq 1 indicates that the sum of the land in all uses and irrigation practices must equal the amount of land a f suitable for agriculture at site f in the initial year 1 l m i k a fli t a f for all t any land use l other than an on farm reservoir can become another land use in the subsequent period constrained by minimum and maximum amounts of the land use based on historical land use patterns 2 2 irrigation the irrigation water demand per crop w r fli is the irrigation water applied per unit of land at site f to crop l with irrigation practice i confronting groundwater shortage we assume producers switch to less intensively irrigated crops rather than deficit irrigate an intensively irrigated crop empirical evidence from moore et al 1994 and wang and segarra 2011 suggests that perfectly inelastic demand for irrigation water is a reasonable assumption even in the long run pumping equipment changes can address seasonal problems of groundwater overdraft over the long run seasonal overdraft is an important consideration for the timing of groundwater pumping within a year but less important to choices over a century the total irrigation demand at each site is w r fli multiplied by the amount of land in each irrigated crop l which equals the sum of groundwater use 2 2 in the eastern arkansas previous studies show that 93 of farmers used groundwater from the mississippi river valley alluvial aquifer locally referred to as alluvial aquifer during 1985 2010 usgs 2018 and thus we assume that groundwater for irrigation comes only from the alluvial aquifer g w f t off farm surface reservoir water use o w f t and on farm reservoir water use r w f t as shown in eq 2 2 l m i 1 k w r fli a fli t g w t t o w f t r w f t the water in an on farm reservoir depends on the recovery of runoff from irrigation and precipitation kovacs et al 2014 express the water held by a unit of land in a reservoir as ω fr ω fw ω fr a fr t a f where ω fr and ω fw are the water recovered to a unit of reservoir land from irrigation and precipitation respectively and a fr t is the total land in an on farm reservoir at site f in time t as the reservoir occupies a larger proportion of the field then the irrigation component diminishes until the water in the reservoir is only from precipitation ω fw 2 3 groundwater level and maximum mar injection rates groundwater flow depends on forward difference approximation to solve a combination of darcy s law and the continuity equation i e laplace s equation wang anderson 1982 the water level at site f in year t 1 h t 1 depends on the water level in year t h t storativity s the size of the site a f the sources and sinks which include the natural recharge n r f t the use of water for managed aquifer recharge ma r f t scaled by a recovery efficiency r e f t the groundwater extraction off farm and on farm surface reservoir application and a return flow coefficient α each site has a finite initial reserve of groundwater available to irrigators and we assume that each site has a single well at the center that can be used for both groundwater pumping and mar mar only occurs through the well injection because the study area has a relatively thick confining unit more than 10 feet which makes recharge through infiltration basins less effective due to the expense of removing the confining units fitzpatrick 1990 3 3 there is a growing interest in identifying sites where the confining layer is thin enough to permit infiltration mar which is less expensive but there is insufficient information on the underlying soil and geologic properties of the landscape to evaluate this option the recovery efficiency r e f t which indicates the proportion of recharge water not lost to surface water bodies or other aquifers scales the mar the net change in the volume of water due to human intervention at site f n r f t r e f t m a r f t 1 α g w f t α r w f t o w f t where the groundwater use scales by 1 α to account for a portion of the applied groundwater pumping returning to the aquifer and the surface water use from on farm storage r w f t or off farm delivery o w f t which scales by the proportion of return flow α the storativity area of the aquifer a f s divides the change in the volume of water in the aquifer to calculate the change in the water level shown in eq 3 4 4 the first section of the supporting information describes the calibration to the historical change in groundwater levels 3 h f t 1 h f t n r f t r e f t m a r f t 1 α g w f t α r w f t o w f t a f s the maximum amount of mar water for injection into the aquifer at each cell depends on the hydraulic properties theis 1935 and the evidence from actual recharge tests fitzpatrick 1990 cooper and jacob 1946 simplified the theis equation for large values of time t and or small values of well radius r to be eq 4 4 h fw h f 0 2 3 m a r f t 4 π t f log 2 25 t f t r 2 s where h fw is the hydraulic head undergoing injection and h f 0 is the initial hydraulic head prior to injection t f is the transmissivity which equals the saturated thickness multiplied by horizontal hydraulic conductivity t f k f b f a well is suitable for well injection if dt w f h fw h f 0 is equal to or greater than one where dt w f is the depth to static water level below the ground surface gibson et al 2018 when the maximum amount of water is injected dt w f h fw h f 0 is equal to one solving for mar on the right hand side of eq 3 when dt w f h fw h f 0 is set equal to one indicates maximum annual injection rate for the site 2 4 total net returns objective the irrigation and land use choices that maximize profitability depend on input costs crop prices and the groundwater level the total cost of mar water c ar t is the per unit cost of mar water which consists of fixed costs c f a r fix e g pipeline canal pumps and other infrastructure and equipment costs and variable costs c f a r var e g principally energy costs to transport the water to the injection well and inject water in to the aquifer 5 5 we assume that a farmer uses bank infiltration to extract surface water through extraction wells and transport convey water to injection wells the concept is to induce flow through the streambed into the aquifer and capture that water rather than groundwater from storage and use a pipeline to transfer water to where mar is needed and inject the water into the aquifer using injection wells additional description of the cost components for surface water delivery is in the second section of the supporting information fema 2016 gibson et al 2018 multiplied by the total volume of injected mar water eq 5 5 c ar t f n c f a r fix c f a r var m a r f t similarly the total cost of off farm surface storage water c ow t is the per unit cost of off farm water c f ow which includes fixed costs e g siting and land purchases in addition to infrastructure and equipment and variable costs multiplied by the volume of off farm water eq 6 6 c ow t j n c f ow o w f t the total cost of groundwater pumping c gw t depends on the cost to lift one unit of water by one unit of depth c f gw multiplied by the depth h f t plus the capital costs per unit of water extracted for the well which accounts for new well drilling in response to aquifer decline c f cw multiplied by the volume of groundwater pumped eq 7 7 c gw t f n c f gw h f t c f cw g w f t the total cost of pumping from on farm reservoirs c rw t is shown in eq 8 as the cost of pumping a unit of water from an on farm reservoir c f rw multiplied by the reservoir water in use plus the capital and maintenance cost of a unit of reservoir land for each period c f cw multiplied by the reservoir area built 8 c rw t f n c f rw r w f t c f cw a fr t given the time horizon t the model maximizes the total net return over all n farm sites which have variation in land use hydrologic conditions and the costs of surface water conveyance for mar water the price of crop l is p l the yield of crop l planted at site f with irrigation practice i is y fli and the production cost of crop l with irrigation practice i is c li the real discount factor in year t is δ t the objective is to maximize the present value of net returns shown in eq 9 as 9 max a fli t r w f t o w f t g w f t m a r f t t t δ t f n l m i k p l y fli c li a fli t c ar t c ow t c gw t c rw t subject to the non negativity constraints in eq 10 10 a fli t 0 r w f t 0 o w f t 0 g w f t 0 m a r f t 0 and the spatial dynamics of land irrigation and artificial recharge eq 1 4 2 5 sensitivity analyses the cost of mar water and off farm water are largely unknown because the fixed costs depend on unspecified plans for the water delivery infrastructure 6 6 agricultural lands in the study area that currently do not have access to off farm surface reservoirs could receive water from planned and or under construction united states of army corps of engineers reservoirs we therefore assume a range for the fixed capital costs e g infrastructure equipment and interest that are paid for equally across all the farm sites the variable water conveyance costs depend on the distance to a river with an approved excess surface water allocation and the volume of the water delivery due to the variability of recharged water recovery scherberg et al 2014 webb 2015 we also evaluate the economic feasibility of mar for recovery efficiency at both 60 and 100 some model runs consider the presence of drought because this could change the proportion of water for mar relative to other irrigation sources other sensitivity analyses examine the model outcomes in response to 50 higher and lower crop margins initial depths to groundwater and the real discount rate crop margin changes reflect three types of movements that occur regularly from market forces crop prices yields or production costs also the use of water for mar is responsive to the initial depth to the groundwater and the real discount rate 2 6 groundwater policies mar in conjunction with groundwater conservation policies could more cost effectively curtail overdraft a pumping cap of 75 of current pumping at a mar water cost of 20 acre foot is a compromise between political feasibility and the more stringent cap necessary for the sustainable yield of the aquifer anrc 2017 additional pumping beyond what the cap allows is possible each period if mar completely replaces for that period the excess groundwater pumping the pumping cap at a mar water cost of 40 and 60 acre foot is set to achieve a level of groundwater conservation similar to the 75 pumping cap at a mar water cost of 20 acre foot an alternative policy is a tax to increase the groundwater pumping costs which also decreases pumping and net returns the tax is set to achieve a level of groundwater conservation similar to the 75 pumping cap at a mar water cost of 20 acre foot a cost effective policy conserves a unit of groundwater at a lower social cost than any other policy the social cost of a policy is the difference in economic returns with the policy versus without the policy plus the change in government tax revenue the social cost thus indicates what society gives up to increase groundwater this criterion does not say what the efficient level of groundwater should be but only what policies can raise the groundwater level at the lowest social cost 3 study location and data farmers in the eastern arkansas region fig 1 rely heavily on groundwater from the alluvial aquifer the top most layer of the mississippi embayment for irrigation because alternative water sources are uncertain or unavailable during irrigation periods czarnecki et al 2002 vories evett 2010 anrc 2013 about 93 of groundwater withdrawals in eastern arkansas were for irrigation from 1985 to 2010 usgs 2018 three eight digit hydrodologic unit code huc watersheds delineate the study area fig 1 and overlap with eleven arkanasas counties the study area overlays critical groundwater areas cga defined by the arkansas natural resources comission anrc as aquifers with significant groundwater depletion and degradation anrc 2005 2017 the study period is 120 years from 2017 to 2136 to evaluate how long term groundwater overdraft relates to the economic feasiblility of mar a grid of 2000 cells is overlaid on the study area to extract spatially heterogenous information on hydrologic conditions and crop yields for the model each cell has a well located in the center of the site and the total available land for crops is based on the initial year cropland the wells are dual purpose useful for both recharge of surplus water in the winter and spring followed by groundwater extraction during periods of irrigation the injection well operates in october through april when surplus water is available no irrigation occurs and obtaining water rights is the most flexible fitzpatrick 1990 the depth to the water table saturated thickness and hydraulic conductivity of the aquifer from the anrc are site specific anrc 2017 the saturated thickness allows us to calculate the limited volume of groundwater available to each site the natural recharge values and the aquifer storativity come from u s geologic survey clark and hart 2009 reitz et al 2017 based on the geo hydrologic conditions across the sites described in section 1 of the supporting information and eq 3 we estimate that the maximum annual injection rate for recharge across the sites varies from 155 to 6782 acre feet per year also a usgs pilot study of mar through well injection shows that water can be injected at rates varying between 37 and 860 gallons min 60 1400 acre feet per year in eastern arkansas sniegocki et al 1965 fitzpatrick 1990 combining these two independent approaches to calculating the injection rate the maximum injection annually across injection sites is between of 155 and 700 acre feet over non irrigation periods 7 7 if we select a system with a capacity of 1225 gallons min we need to operate the recharge roughly 130 days to be able to inject 700 acre feet given the temporal variation of surplus water water quality and time of operation and maintenance of the recharge system due to well clogging biological growth chemical reactions between the native groundwater or aquifer materials and recharge water precipitation of insoluble products due to aeration and air entrainment sniegocki 1963a b 1965 we select the maximum annual injection rate across recharge sites as between of 155 and 700 acre feet year even though hydrogeologic conditions in many sites can withstand a higher injection rate section 2 of the supporting information indicates excess surface water in the region can meet the potential water demand for mar water even when all injection wells operate at full capacity i e 700 acre feet per year arkansas natural resources commission estimates that there is more than 5 5 million acre feet per year of excess surface water that is legally available from the two biggest rivers in the study area namely the white and arkansas rivers water has to be transported from a river with excess surface water and the mar water cost largely depends on the capital costs to deliver water from the rivers to the recharge sites dr j rigby and mr d pyne personal communication august 4 2018 the capital costs of the planned off farm delivery of water from the u s army corp of engineers projects in arkansas are highly speculative anrc 2014 since the capital costs c f a r fix and c f ow that we suppose are the same across all the sites are uncertain we suppose a range from 10 to 100 acre foot based on the cost of the planned projects anrc 2014 table a1 in the third section of the supporting information has the average acreage of each crop initially by site based on the 2017 cropland data layer usda nass 2018a the irrigated vs non irrigated soybean acreage is based on the harvested acreage for 2016 2017 usda nass 2018b the estimate of yield for each of the crops comes from the average county crop yields for the past 5 years division of agriculture uark 2018 the capital and operating costs for the irrigation technologies reservoirs mar wells and the costs of production for the crops shown in table a2 are constant over time in real terms also in the third section of the supporting information is a description of adjustment coefficients to the crop irrigation demand and crop yields to alternative irrigation practices we use a 2 real discount rate which comes from a 5 nominal discount rate based on the 30 year treasury bond yield over the fifty years less a long run expectation for inflation of 3 u s department of the treasury 2017 a drought year described in section 4 of the supporting information has a negative palmer drought severity indices pdsi value noaa 2018 we make a synthetic drought record for the 120 year study period by repeating the past thirty years of historical pdsi values four times palmer 1965 the reduction in dryland crop yields from drought comes from yield data for the last thirty years usda nass 2018b and the increase in groundwater pumping for irrigated crops due to drought comes from producers response to the 2012 drought in arkansas kemper et al 2012 drought typically increases irrigation by 1 2 additional inches for row crops and 5 10 additional acre inches of water for rice kemper et al 2012 4 results and discussion initially we examine the optimal amount of mar water use for different costs of mar water and recovery efficiencies with and without drought we consider how much mar incentivizes land use change to more intensively irrigated land and we compare total net returns with mar only versus off farm surface storage deliveries for a range of water costs second we analyze the use of mar water and other irrigation sources for sensitivity analyses on the crop margins and initial depths to groundwater third we consider how the use of mar influences the cost effectiveness of groundwater conservation policies 4 1 optimal use of water for mar fig 2 shows the use of water for mar for different costs of mar water and drought conditions over the 120 year study period the recovery efficiency and cost of mar water influence the effectiveness of using mar water to replenish groundwater stored in the aquifer but drought only increases the demand for mar water considerably when the cost of mar water is less than 30 acre foot if 100 recovery efficiency is possible and the cost of mar water is less than 100 acre foot then there is well injection at some sites early in the time horizon fig 2b and d however extensive use of mar water only appears to occur if the cost of mar water is less than 60 acre foot and the recovery efficiency is at least 60 fig 2a and c if the cost of mar water is 20 acre foot producers cumulatively inject about 35 million acre feet of excess surface water to the aquifer with a recovery efficiency of 60 over the time horizon at the same recovery efficiency and a cost of mar water of 60 acre foot there is only 1 3 million acre feet that producers cumulatively inject to the aquifer or about 5 42 acre feet year at each injection well this finding is consistent with previous studies that show artificial recharge is not widely in use due to the high cost hays 2001 kresse et al 2014 fig 2c and d indicate that drought increases the water applied for irrigation and use of water for mar but the water in use for mar declines quickly as the cost of mar increases in drought years we suppose there is less rainfall during the growing season but there is still ample water during the wet season to permit recharge at a recovery efficiency of 60 the drought increases the cumulative amount of mar water by approximately 30 at a cost of mar water of 20 acre foot but the difference in the use of water for mar between drought and no drought scenarios is negligible if the cost of mar is between 80 and 100 acre foot drought has less influence on the water in use for mar than the recovery efficiency and cost of mar water the optimal use of mar water over time differs according to the cost of mar water and the recovery efficiency at a cost of mar water less than initial groundwater withdrawal costs which is approximately 40 acre foot for most sites and a recovery efficiency of 100 the optimal approach is significant injection early in the time horizon to increase groundwater levels and reduce the pumping costs for the entire time horizon however when the cost of mar water is greater than the initial groundwater withdrawal costs such as 60 acre foot producers begin to inject when groundwater levels fall to a certain level and the optimal mar water use is then set to stabilize the groundwater level and net returns fig 2 the injection of water becomes the cheaper approach to maintain profitability than allowing groundwater levels to continue falling table 1 indicates that for a cost of mar water above initial groundwater withdrawal costs producers use less irrigation intensive crops e g non irrigated soybeans and no mar water use for the first half of the time horizon but in the last half of the time horizon there are more irrigation intensive crops e g irrigated soybeans and the use of mar water 4 2 slippage effects a slippage or rebound 8 8 here we use the term slippage rather than rebound where slippage refers to increase in irrigated crops acreage due to higher groundwater levels while rebound effect refers to an increase in water application due to higher groundwater levels the results show that both slippage and rebound effects are happening the use of mar water increases irrigated crops in response to lower groundwater pumping costs there is also movement from less irrigation intensive crops to more irrigation intensive crops that leads to an increase in groundwater withdrawals effect refers to the increase in groundwater pumping that occurs when more irrigation intensive crops are grown because the cost of irrigation falls due to greater irrigation efficiency or the use of water for mar the percentage of slippage refers to the percent increase in groundwater use divided by the use of water for mar as an example table 1 indicates that the percentage of slippage in the year 2136 at a cost of mar of 20 acre foot is 114 5 102 3 35 4 100 34 5 fig 3 indicates that without drought and a cost of mar water higher than 90 acre foot increased groundwater withdrawal is small and the percentage slippage is less than 30 at a cost of mar water of 20 acre foot 34 45 of recharged water is offset through increased groundwater use also when drought is present which increases the use of water for mar slightly the percentage of slippage is higher the use of mar water alone is unlikely to significantly improve the aquifer stock due to the slippage effect unless the cost of mar water is less than 20 acre foot contrary to niswonger et al 2017 and scherberg et al 2014 2018 when the cost of mar water is 40 60 acre foot the aquifer stock remains nearly the same as the aquifer stock without the use of water for mar because the percentage of slippage is so high additional measures such as restrictions in land use changes might therefore be needed for groundwater conservation ward and pulido velazquez 2008 4 3 net returns with water from the use of mar and off farm surface reservoirs fig 4 shows the response of net returns to a range of off farm surface water costs for a scenario without the use of water for mar and the response of net returns to a range of mar water costs with no off farm surface water for three scenarios of mar recovery efficiency as costs of water increases total net returns naturally fall in all scenarios off farm surface storage always provides a higher total net return if the unit price of water from reservoir storage and aquifer storage mar is the same the higher net returns from surface storage are because the water remains on the surface rather than being pumped up later from the aquifer the use of water for mar provides nearly no gain in total net returns if the cost of mar water is greater than 40 acre foot 4 4 sensitivity of model outcomes to the cost of off farm surface water drought crop margins initial depth to groundwater and the real discount rate table 2 indicates the use of water for mar can slow aquifer depletion if the cost of mar water is less than 20 per acre foot scenario 20 200 i e unit cost of water for mar of 20 per acre foot and a unit cost of water for off farm surface storage of 200 per acre foot but does not slow aquifer depletion when the cost of mar water is higher than 40 per acre foot the aquifer declines to 61 7 million acre feet at the end of time horizon from an initial 92 8 million acre feet when there is no use of water for mar water or when the cost of mar water is higher than 40 per acre foot drought intensifies groundwater pumping and increases the use of water for mar slightly groundwater depletion is less with the conjunctive use of water for mar and off farm surface water scenarios 20 60 i e 20 per acre foot of water for mar and 60 per acre foot for off farm surface water 40 60 60 60 20 80 40 80 60 80 for the scenario 60 80 the aquifer stock only declines to about 80 million acre feet at the end of the time horizon the cost of off farm surface water is low enough at 80 or lower per acre foot that a significant component of the total irrigation water comes from the surface rather than the ground table 3 shows how the cost of mar water and the cost of off farm surface water interact to influence the net returns and aquifer stock relative to a baseline without mar or off farm surface water cheaper off farm surface water provides higher net returns and a larger percentage increase in the aquifer stock conjunctive use of mar and off farm surface water results in more groundwater and higher net returns compared with the use of water for mar alone at a cost of mar water of 40 per acre foot a decrease in the cost of off farm surface water from 60 to 20 per acre foot makes net returns go from 6 8 above the baseline to 36 above the baseline for a given cost of off farm surface water a decrease in the cost of mar water has much less influence than the cost of off farm surface water on net returns and the aquifer stock at an off farm surface water cost of 60 per acre foot a decrease in the cost of mar water from 60 to 20 per acre foot makes net returns go from 6 7 above the baseline to only slight higher at 6 9 above the baseline however the more expensive off farm surface water is the greater the influence that lower costs of mar water have on increasing net returns and the aquifer stock above the baseline the use of water for mar buffers net returns against drought but there is not much buffer for the aquifer stock unless the cost of mar water is considerably lower than the average groundwater pumping cost table 4 indicates what happens to the use of water for mar when crop margins double 2cm or halve 0 5cm and also what happens when the initial depth to groundwater doubles 2dtw or halves 0 5dtw at double the crop margins the use of water for mar more than doubles from the baseline to 0 65 and 0 12 million acre foot for a mar water cost of 20 and 60 per acre foot respectively the significant rise in the use of water for mar is because groundwater levels fall faster with greater crop water demand due to a shift toward irrigated crops the groundwater use also increases but does not double suggesting the use of water for mar is more profitable than solely mining the groundwater the use of water for mar nearly disappears when the crop margins half because there is no reason to supplement groundwater with mar when minimal groundwater is in use at half the initial depth to water the use of water for mar increases from 0 30 to 0 37 million acre feet at a mar water cost of 20 per acre foot and increases from 0 01 to 0 03 million acre feet at a mar water cost of 60 per acre foot the use of water for mar to supplement groundwater is more profitable if the cost of pumping groundwater is less however if the initial depth doubles the use of water for mar is zero at a cost of 60 per acre foot and only 0 07 million acre feet of water for mar annually at a cost of 20 per acre foot the use of mar to supplement groundwater is less profitable if initial groundwater pumping costs are large if the real interest rate doubles to 4 the groundwater pumping remains unchanged but the use of mar water declines from 0 3 to 0 09 million acre feet at a mar water cost of 20 per acre foot there is less reason to use mar to support groundwater levels in the future if the present value of future net returns from irrigated production are lower if the real interest rate halves to 1 the use of mar water increases to 0 63 million acre feet at a low cost of mar water 20 per acre foot but remains unchanged at a high cost of mar water 60 per acre foot lower interest rates increase the present value of future returns from irrigated production and this creates the incentive to sustain the aquifer through greater use of mar and through a shift from rice to less irrigation intensive corn and soybeans 4 5 effect of groundwater conservation policies on the crop and irrigation choices and net returns table 5 shows that the pumping cap and tax policies generate a cost in 2017 us dollars to society per acre foot of groundwater conserved that range from 1 0 to 35 2 the pumping cap and taxes cause net returns to producers to fall compared to the baseline without the policies and the cost to society is those losses plus the gain in government revenue if the policy is a tax as the cost of mar water increases the social cost of the pumping cap for groundwater conservation increases from less than 2 to about 35 per acre foot of groundwater conserved likewise the conservation cost of a pumping tax increases with the cost of mar water from approximately 1 22 per acre foot of groundwater conserved since a lower cost of mar water reduces the groundwater conservation cost of cap and tax policies mar and conservation policies appear to be complements for conservation also a recovery efficiency higher than 60 makes the conservation cost even lower conservation policies increase the aquifer stock less when the cost of mar water is low but the social cost of the policies are also lower the pumping tax is a more cost effective approach to conserve groundwater compared to the pumping cap 5 conclusion our results on the optimal economic use of water for mar contrast with the results from hydrologic models where land use is fixed niswonger et al 2017 scherberg et al 2014 2018 at the likely cost of mar water for irrigation in eastern arkansas which is at least 40 per acre foot falconer and johnson 2017 the use of water for mar is unlikely to reduce groundwater overdraft our model indicates that the use of water for mar has a moderate role in the alleviation of groundwater overdraft at a cost of 40 per acre foot due to minimal injection and the slippage effect there is evidence that producers would shift to more irrigation intensive crops with the availability of mar water and groundwater pumping could increase a more effective approach for reducing the groundwater overdraft is the conjunctive use of mar water and surface water storage this is only effective though if the cost of the surface water deliveries are less than the 100 acre foot groundwater conservation polices such as the use of a cap or fee on groundwater extraction are more cost effective with the use of water for mar if the cost mar water is much lower than the average groundwater pumping cost then mar should begin early in the time horizon to lower groundwater pumping costs over the entire study period drought slightly increases the use of water for mar but drought is unlikely to make mar economically feasible higher irrigation demand by doubling crop margins more than doubles the use of mar water to supplement the groundwater but halving the crop margins nearly eliminates the use of water for mar even at the lowest cost of mar water the use of water for mar is thus heavily dependent on the anticipated irrigation demand of crops also regions with large depths to the aquifer are unlikely to use mar water to supplement groundwater because the cost of pumping the water back out of the aquifer is high a lower real discount rate encourages aquifer conservation and mar water use while a higher real discount rate does the opposite water policy makers continue the search for strategies to allow producers to maximize net returns and sustain the groundwater resource greater irrigation efficiency can increase water use through the slippage effect and not necessarily conserve groundwater grafton et al 2018 and conjunctive use strategies such as the use of surface water reservoirs should also proceed with caution since the slippage effect can also occur kovacs and durand morat 2017 our study finds that unless the cost of mar water is substantially less than the average groundwater pumping cost or the cost of water from surface storage is about the same or less than the average groundwater pumping cost then the slippage effect is large we suppose ample water for mar is available in eastern arkansas but periods of extreme drought might limit the water available for mar and surface reservoirs if the use of water for mar is known not to be possible in some years this would increase mar when precipitation is abundant also for a shorter time horizon a model could allow for deficit irrigation rather than assume producers switch to new irrigation practices or less water intensive crops another extension to the model is to change the number of sites in the study area which would be equivalent to decreasing or increasing the proximity of the wells and examine what this does to the well pumping of the surrounding sites the hydrological component of our model is simple particularly in the assumption that there are no lateral flows between sites to allow for computationally tractable optimization an economic model coupled with a more sophisticated hydrologic model such as modflow would better account for the complexity of groundwater flows also our model overlooks the potential effects of climate change on aquifer recharge pulido velazquez et al 2015 2018 zhang et al 2016 meixner et al 2016 gemitzi et al 2017 smerdon 2017 and the assessment of conjunctive use strategies pulido velazquez et al 2011 2008 escriva bou et al 2017 since drought will change in the future due to climate change future studies could incorporate a statistical approach to generate climate scenarios to evaluate the impact of a potential shift in the intensity and frequency of drought on the economics of mar fatichi et al 2011 collados lara et al 2018 declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work supported by the usda economic research service through a cooperative agreement 58 6000 7 0090 any opinions findings or recommendations expressed in this material are those of the author s and do not necessarily reflect the views of the usda appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2019 124220 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 supplementary data 2 
6090,decades of efforts to reduce groundwater overdraft through investment in irrigation efficiency has in many cases failed to reduce aquifer depletion this is one reason for greater attention to water supply augmentation efforts through the capture of surface water during high flow events for managed aquifer recharge mar or additional surface storage we use a landscape level model to examine the optimal interaction among mar surface reservoir storage crop choice and groundwater conservation policies in eastern arkansas we find the cost of mar water must be less than half the average groundwater pumping cost to increase the aquifer level increases in irrigation intensive crops mean that only a fraction of the recharged water raises groundwater levels we observe that policies to conserve groundwater such as a pumping cap or tax are more cost effective for society with a lower cost of mar water keywords optimization model spatial dynamic long run aquifer management managed aquifer recharge 1 introduction falling groundwater levels raise the future costs of well pumping for irrigation and diminish the resilience of agriculture to drought over the past century the average annual groundwater depletion in the united states was about 6 5 million acre feet and this average rose to 19 4 million acre feet from 2001 to 2008 konikow 2013 reducing withdrawals by increasing irrigation efficiency alone is not an adequate solution for the sustainable management of groundwater pfeiffer and lin 2014 grafton et al 2018 instead many regions conjunctively use surface and groundwater harou and lund 2008 anrc 2017 one type of conjunctive use is the storage of excess surface water in aquifers through managed aquifer recharge mar rather than in surface reservoirs harter and dahlke 2014 o geen 2018 however no studies optimize whether mar can economically complement traditional irrigation sources such as groundwater or surface reservoirs the traditional supplies are likely cheaper initially but the role of mar in irrigation could become prominent as those sources become unavailable or prohibitively expensive our study fills three major knowledge gaps in the literature by optimizing economic returns through the spatial dynamic interaction of mar traditional irrigation sources and crop choice first the optimization of economic returns is relevant because this is how farm irrigators the principal water users make their decisions the optimization then provides a useful guide for how the irrigators might use mar over time and across the landscape as the expense of traditional irrigation sources rise second crop choice allows switching between crops of varying irrigation intensity and this can lead to a slippage effect which is when the use of mar stabilizes groundwater levels causes a switch to irrigation intensive crops and increases groundwater pumping grafton et al 2018 the slippage effect occurs with the use of efficient irrigation practices pfeiffer and lin 2014 adams and kovacs 2019 and the conjunctive use of surface reservoirs kovacs and durand morat 2017 but no study examines if and how much this occurs with mar third since the study of mar through optimization is new our analysis examines how sensitive optimal mar use is to crop profitability initial groundwater depths and groundwater conservation policies which is of potential interest to water managers and policy makers traditionally the construction of surface reservoirs allows for the storage of water during the wet season for dry season uses however reservoir storage can be expensive occupy valuable land and most of the optimal locations for reservoirs are already developed scanlon et al 2016 brown et al 2019 surface water reservoirs are also less attractive if heat waves from climate change shift snowpack runoff to the early spring when demand is low barnett et al 2005 or more intensive rainfall leads to flood water that reservoirs do not have the capacity to store najibi et al 2017 instead excess water could be put into depleted aquifers to increase sustainable groundwater yields bouwer 2002 aquifer storage methods include injection through wells shafts and boreholes spreading over fields induced bank filtration and in channel or reservoir modifications hannappel et al 2014 mar can increase groundwater supplies to buffer against climate extremes in the future and water agencies use mar in many parts of the world niswonger et al 2017 scherberg et al 2014 2018 however mar through injection wells is often less economically feasible than surface reservoirs because there is a large expense to clean and pump water into the aquifer also the use of mar through infiltration basins means there are expenses for land and maintenance of the basins all mar approaches mean there is a future expense to pump the water back out of the aquifer recent research highlights the use of mar to sustain agricultural production harter dahlke 2014 scanlon et al 2016 o geen 2018 however most of this research focuses on the technical suitability of mar with geographic information systems ahani amineh et al 2017 smith et al 2017 gibson et al 2018 or hydrologic models i e modflow niswonger et al 2017 scherberg et al 2014 2018 rather than economic feasibility mar is a type of conjunctive use that directs excess surface water to aquifer storage rather than surface reservoirs evans and evans 2011 dillon and arshad 2016 when the capacity of surface reservoirs is met excess water can be directed into the aquifers spatial variability in the hydrologic and agronomic conditions of a landscape then determine where and when mar is economically feasible maliva 2014 2015 dillon and arshad 2016 although mar is technologically feasible kresse et al 2014 little is known about the effects of mar on groundwater pumping land use and the economic returns on an agricultural landscape nor do earlier studies examine as our study does the trade offs in the role of groundwater augmentation through on and off farm surface storage and mar to maximize economic returns through conventional and efficient irrigation practices marques et al 2010 balali et al 2011 and pulido velazquez et al 2011 analyze groundwater conservation technologies and multiple crops while comparing objectives such as aquifer conservation and economic returns marques et al 2010 use two stage stochastic quadratic programming to optimize conjunctive water use of groundwater pumping and artificial recharge with cropping and irrigation technology decisions for an irrigation district in california marques et al 2010 rely on the assumption of a single large aquifer and a negligible change in the groundwater table and pumping cost for the entire irrigation district also their model of the aquifer assumes an instant and uniform response to pumping over the entire extent and this representation for the aquifer significantly underestimates the magnitude of the groundwater pumping externality brozović et al 2010 balali et al 2011 use a non linear optimization model to analyze the impacts of irrigation water pricing and agricultural policy scenarios on aquifer conservation although the recharge volume in their model was not chosen through optimization pulido velazquez et al 2011 propose a downscaling approach to generate future climate indices and incorporate those indices into the simes and aquatool process based simulation models to examine conjunctive use water management mar is a component of the model but mar is not chosen through an optimization model other economic mar studies do not consider how to spatially optimize artificial recharge for a landscape our study region for the optimal use of excess water for surface reservoirs or mar through injection wells is eastern arkansas usa arkansas is the largest user of water for irrigation from the mississippi valley alluvial aquifer the third most used aquifer in the united states konikow 2013 the region receives an abundant 45 50 in of rainfall per year clark and hart 2009 but this mostly occurs in the winter and spring seasons before the crop s major water demand and this makes the storage of the seasonal rainfall an attractive prospect based on the legal definition of excess surface water for the state there is more than 5 5 million acre feet year or 85 of all irrigation water applied in the state in 2013 of excess surface water that can be withdrawn from two major rivers in the region anrc 2014 usda nass 2013 groundwater use in arkansas supports the largest rice production in the united states in addition to other irrigated crops especially soybeans but also corn and cotton a substantial rise in the number of irrigated acres has meant a tenfold increase in the use of groundwater for irrigation between 1950 and 2010 kresse et al 2014 cones of depression in the groundwater level surface have led to the designation of critical groundwater areas in the state anrc 2005 2017 we examine whether irrigators choose between groundwater pumping that results in lower water levels and higher pumping costs surface reservoirs constrained by capacity and mar constrained by the maximum injection rate and water conveyance and cleaning costs from surface water sources to injection sites this in turn influences farm decisions across the landscape for crop choice and irrigation practices particular attention is given to the relationship between the irrigation intensity of the chosen crops and the surface reservoir and mar water costs mar recovery efficiencies and the occurrence of drought 2 methods we use non linear optimization to maximize the present value of net returns from farm production over an entire time horizon through the choice of multiple crops mar water use and on and off farm surface water use for a couple thousand sites on a landscape other than the well pumping component the model is linear in the choice variables our aim is to consider how the detailed spatial and temporal dimensions of a deterministic model influence crop and water source choices we assume that farm producers collectively optimize profits and perfectly foresee future market and environmental conditions to keep the focus on the tradeoffs between the optimal planner s use of mar and other water sources the baseline model supposes that there is no use of mar and we compare model outcomes without mar to the outcomes with mar for a range of mar costs sensitivity analyses of the baseline model with mar evaluate the robustness of mar use net returns and aquifer conservation to changes in key parameters 2 1 land use choices the landscape is spatially heterogeneous in groundwater resources and crop yields anrc 2017 usda nass 2018a there are many potential remedies to groundwater overdraft and our model considers surface water storage with on farm reservoirs or off farm water water stored in surface reservoirs deliveries non irrigated crops idle crop land and more efficient irrigation practices there are m land uses that include the following crops rice irrigated soybean corn and cotton non irrigated soybean and double cropped irrigated soybean with winter wheat two other land uses include fallowing the land or constructing on farm reservoirs an on farm reservoir built on a unit of land permanently remains as a reservoir for the duration of the study period these crops may use k irrigation practices namely conventional contour levee flood for rice and flexible poly pipe furrow for other crops conservation furrow the use of soil sensors and computerized hole selection software for calculating punched hole sizes in flexible poly pipe and zero grade leveling flood for rice hignight et al 2009 henry et al 2016 mississippi state university 2016a b each year t a producer at farm site f chooses to allocate a fli t acres to land use l and irrigation practice i 1 1 there is typically a mix of crops in each cell each year that reflects the crops grown in rotation based on the historical land use but there is no constraint that crop types switch every year there are sixteen crop and irrigation practices choices each year a site can have more than one crop and irrigation choice eq 1 indicates that the sum of the land in all uses and irrigation practices must equal the amount of land a f suitable for agriculture at site f in the initial year 1 l m i k a fli t a f for all t any land use l other than an on farm reservoir can become another land use in the subsequent period constrained by minimum and maximum amounts of the land use based on historical land use patterns 2 2 irrigation the irrigation water demand per crop w r fli is the irrigation water applied per unit of land at site f to crop l with irrigation practice i confronting groundwater shortage we assume producers switch to less intensively irrigated crops rather than deficit irrigate an intensively irrigated crop empirical evidence from moore et al 1994 and wang and segarra 2011 suggests that perfectly inelastic demand for irrigation water is a reasonable assumption even in the long run pumping equipment changes can address seasonal problems of groundwater overdraft over the long run seasonal overdraft is an important consideration for the timing of groundwater pumping within a year but less important to choices over a century the total irrigation demand at each site is w r fli multiplied by the amount of land in each irrigated crop l which equals the sum of groundwater use 2 2 in the eastern arkansas previous studies show that 93 of farmers used groundwater from the mississippi river valley alluvial aquifer locally referred to as alluvial aquifer during 1985 2010 usgs 2018 and thus we assume that groundwater for irrigation comes only from the alluvial aquifer g w f t off farm surface reservoir water use o w f t and on farm reservoir water use r w f t as shown in eq 2 2 l m i 1 k w r fli a fli t g w t t o w f t r w f t the water in an on farm reservoir depends on the recovery of runoff from irrigation and precipitation kovacs et al 2014 express the water held by a unit of land in a reservoir as ω fr ω fw ω fr a fr t a f where ω fr and ω fw are the water recovered to a unit of reservoir land from irrigation and precipitation respectively and a fr t is the total land in an on farm reservoir at site f in time t as the reservoir occupies a larger proportion of the field then the irrigation component diminishes until the water in the reservoir is only from precipitation ω fw 2 3 groundwater level and maximum mar injection rates groundwater flow depends on forward difference approximation to solve a combination of darcy s law and the continuity equation i e laplace s equation wang anderson 1982 the water level at site f in year t 1 h t 1 depends on the water level in year t h t storativity s the size of the site a f the sources and sinks which include the natural recharge n r f t the use of water for managed aquifer recharge ma r f t scaled by a recovery efficiency r e f t the groundwater extraction off farm and on farm surface reservoir application and a return flow coefficient α each site has a finite initial reserve of groundwater available to irrigators and we assume that each site has a single well at the center that can be used for both groundwater pumping and mar mar only occurs through the well injection because the study area has a relatively thick confining unit more than 10 feet which makes recharge through infiltration basins less effective due to the expense of removing the confining units fitzpatrick 1990 3 3 there is a growing interest in identifying sites where the confining layer is thin enough to permit infiltration mar which is less expensive but there is insufficient information on the underlying soil and geologic properties of the landscape to evaluate this option the recovery efficiency r e f t which indicates the proportion of recharge water not lost to surface water bodies or other aquifers scales the mar the net change in the volume of water due to human intervention at site f n r f t r e f t m a r f t 1 α g w f t α r w f t o w f t where the groundwater use scales by 1 α to account for a portion of the applied groundwater pumping returning to the aquifer and the surface water use from on farm storage r w f t or off farm delivery o w f t which scales by the proportion of return flow α the storativity area of the aquifer a f s divides the change in the volume of water in the aquifer to calculate the change in the water level shown in eq 3 4 4 the first section of the supporting information describes the calibration to the historical change in groundwater levels 3 h f t 1 h f t n r f t r e f t m a r f t 1 α g w f t α r w f t o w f t a f s the maximum amount of mar water for injection into the aquifer at each cell depends on the hydraulic properties theis 1935 and the evidence from actual recharge tests fitzpatrick 1990 cooper and jacob 1946 simplified the theis equation for large values of time t and or small values of well radius r to be eq 4 4 h fw h f 0 2 3 m a r f t 4 π t f log 2 25 t f t r 2 s where h fw is the hydraulic head undergoing injection and h f 0 is the initial hydraulic head prior to injection t f is the transmissivity which equals the saturated thickness multiplied by horizontal hydraulic conductivity t f k f b f a well is suitable for well injection if dt w f h fw h f 0 is equal to or greater than one where dt w f is the depth to static water level below the ground surface gibson et al 2018 when the maximum amount of water is injected dt w f h fw h f 0 is equal to one solving for mar on the right hand side of eq 3 when dt w f h fw h f 0 is set equal to one indicates maximum annual injection rate for the site 2 4 total net returns objective the irrigation and land use choices that maximize profitability depend on input costs crop prices and the groundwater level the total cost of mar water c ar t is the per unit cost of mar water which consists of fixed costs c f a r fix e g pipeline canal pumps and other infrastructure and equipment costs and variable costs c f a r var e g principally energy costs to transport the water to the injection well and inject water in to the aquifer 5 5 we assume that a farmer uses bank infiltration to extract surface water through extraction wells and transport convey water to injection wells the concept is to induce flow through the streambed into the aquifer and capture that water rather than groundwater from storage and use a pipeline to transfer water to where mar is needed and inject the water into the aquifer using injection wells additional description of the cost components for surface water delivery is in the second section of the supporting information fema 2016 gibson et al 2018 multiplied by the total volume of injected mar water eq 5 5 c ar t f n c f a r fix c f a r var m a r f t similarly the total cost of off farm surface storage water c ow t is the per unit cost of off farm water c f ow which includes fixed costs e g siting and land purchases in addition to infrastructure and equipment and variable costs multiplied by the volume of off farm water eq 6 6 c ow t j n c f ow o w f t the total cost of groundwater pumping c gw t depends on the cost to lift one unit of water by one unit of depth c f gw multiplied by the depth h f t plus the capital costs per unit of water extracted for the well which accounts for new well drilling in response to aquifer decline c f cw multiplied by the volume of groundwater pumped eq 7 7 c gw t f n c f gw h f t c f cw g w f t the total cost of pumping from on farm reservoirs c rw t is shown in eq 8 as the cost of pumping a unit of water from an on farm reservoir c f rw multiplied by the reservoir water in use plus the capital and maintenance cost of a unit of reservoir land for each period c f cw multiplied by the reservoir area built 8 c rw t f n c f rw r w f t c f cw a fr t given the time horizon t the model maximizes the total net return over all n farm sites which have variation in land use hydrologic conditions and the costs of surface water conveyance for mar water the price of crop l is p l the yield of crop l planted at site f with irrigation practice i is y fli and the production cost of crop l with irrigation practice i is c li the real discount factor in year t is δ t the objective is to maximize the present value of net returns shown in eq 9 as 9 max a fli t r w f t o w f t g w f t m a r f t t t δ t f n l m i k p l y fli c li a fli t c ar t c ow t c gw t c rw t subject to the non negativity constraints in eq 10 10 a fli t 0 r w f t 0 o w f t 0 g w f t 0 m a r f t 0 and the spatial dynamics of land irrigation and artificial recharge eq 1 4 2 5 sensitivity analyses the cost of mar water and off farm water are largely unknown because the fixed costs depend on unspecified plans for the water delivery infrastructure 6 6 agricultural lands in the study area that currently do not have access to off farm surface reservoirs could receive water from planned and or under construction united states of army corps of engineers reservoirs we therefore assume a range for the fixed capital costs e g infrastructure equipment and interest that are paid for equally across all the farm sites the variable water conveyance costs depend on the distance to a river with an approved excess surface water allocation and the volume of the water delivery due to the variability of recharged water recovery scherberg et al 2014 webb 2015 we also evaluate the economic feasibility of mar for recovery efficiency at both 60 and 100 some model runs consider the presence of drought because this could change the proportion of water for mar relative to other irrigation sources other sensitivity analyses examine the model outcomes in response to 50 higher and lower crop margins initial depths to groundwater and the real discount rate crop margin changes reflect three types of movements that occur regularly from market forces crop prices yields or production costs also the use of water for mar is responsive to the initial depth to the groundwater and the real discount rate 2 6 groundwater policies mar in conjunction with groundwater conservation policies could more cost effectively curtail overdraft a pumping cap of 75 of current pumping at a mar water cost of 20 acre foot is a compromise between political feasibility and the more stringent cap necessary for the sustainable yield of the aquifer anrc 2017 additional pumping beyond what the cap allows is possible each period if mar completely replaces for that period the excess groundwater pumping the pumping cap at a mar water cost of 40 and 60 acre foot is set to achieve a level of groundwater conservation similar to the 75 pumping cap at a mar water cost of 20 acre foot an alternative policy is a tax to increase the groundwater pumping costs which also decreases pumping and net returns the tax is set to achieve a level of groundwater conservation similar to the 75 pumping cap at a mar water cost of 20 acre foot a cost effective policy conserves a unit of groundwater at a lower social cost than any other policy the social cost of a policy is the difference in economic returns with the policy versus without the policy plus the change in government tax revenue the social cost thus indicates what society gives up to increase groundwater this criterion does not say what the efficient level of groundwater should be but only what policies can raise the groundwater level at the lowest social cost 3 study location and data farmers in the eastern arkansas region fig 1 rely heavily on groundwater from the alluvial aquifer the top most layer of the mississippi embayment for irrigation because alternative water sources are uncertain or unavailable during irrigation periods czarnecki et al 2002 vories evett 2010 anrc 2013 about 93 of groundwater withdrawals in eastern arkansas were for irrigation from 1985 to 2010 usgs 2018 three eight digit hydrodologic unit code huc watersheds delineate the study area fig 1 and overlap with eleven arkanasas counties the study area overlays critical groundwater areas cga defined by the arkansas natural resources comission anrc as aquifers with significant groundwater depletion and degradation anrc 2005 2017 the study period is 120 years from 2017 to 2136 to evaluate how long term groundwater overdraft relates to the economic feasiblility of mar a grid of 2000 cells is overlaid on the study area to extract spatially heterogenous information on hydrologic conditions and crop yields for the model each cell has a well located in the center of the site and the total available land for crops is based on the initial year cropland the wells are dual purpose useful for both recharge of surplus water in the winter and spring followed by groundwater extraction during periods of irrigation the injection well operates in october through april when surplus water is available no irrigation occurs and obtaining water rights is the most flexible fitzpatrick 1990 the depth to the water table saturated thickness and hydraulic conductivity of the aquifer from the anrc are site specific anrc 2017 the saturated thickness allows us to calculate the limited volume of groundwater available to each site the natural recharge values and the aquifer storativity come from u s geologic survey clark and hart 2009 reitz et al 2017 based on the geo hydrologic conditions across the sites described in section 1 of the supporting information and eq 3 we estimate that the maximum annual injection rate for recharge across the sites varies from 155 to 6782 acre feet per year also a usgs pilot study of mar through well injection shows that water can be injected at rates varying between 37 and 860 gallons min 60 1400 acre feet per year in eastern arkansas sniegocki et al 1965 fitzpatrick 1990 combining these two independent approaches to calculating the injection rate the maximum injection annually across injection sites is between of 155 and 700 acre feet over non irrigation periods 7 7 if we select a system with a capacity of 1225 gallons min we need to operate the recharge roughly 130 days to be able to inject 700 acre feet given the temporal variation of surplus water water quality and time of operation and maintenance of the recharge system due to well clogging biological growth chemical reactions between the native groundwater or aquifer materials and recharge water precipitation of insoluble products due to aeration and air entrainment sniegocki 1963a b 1965 we select the maximum annual injection rate across recharge sites as between of 155 and 700 acre feet year even though hydrogeologic conditions in many sites can withstand a higher injection rate section 2 of the supporting information indicates excess surface water in the region can meet the potential water demand for mar water even when all injection wells operate at full capacity i e 700 acre feet per year arkansas natural resources commission estimates that there is more than 5 5 million acre feet per year of excess surface water that is legally available from the two biggest rivers in the study area namely the white and arkansas rivers water has to be transported from a river with excess surface water and the mar water cost largely depends on the capital costs to deliver water from the rivers to the recharge sites dr j rigby and mr d pyne personal communication august 4 2018 the capital costs of the planned off farm delivery of water from the u s army corp of engineers projects in arkansas are highly speculative anrc 2014 since the capital costs c f a r fix and c f ow that we suppose are the same across all the sites are uncertain we suppose a range from 10 to 100 acre foot based on the cost of the planned projects anrc 2014 table a1 in the third section of the supporting information has the average acreage of each crop initially by site based on the 2017 cropland data layer usda nass 2018a the irrigated vs non irrigated soybean acreage is based on the harvested acreage for 2016 2017 usda nass 2018b the estimate of yield for each of the crops comes from the average county crop yields for the past 5 years division of agriculture uark 2018 the capital and operating costs for the irrigation technologies reservoirs mar wells and the costs of production for the crops shown in table a2 are constant over time in real terms also in the third section of the supporting information is a description of adjustment coefficients to the crop irrigation demand and crop yields to alternative irrigation practices we use a 2 real discount rate which comes from a 5 nominal discount rate based on the 30 year treasury bond yield over the fifty years less a long run expectation for inflation of 3 u s department of the treasury 2017 a drought year described in section 4 of the supporting information has a negative palmer drought severity indices pdsi value noaa 2018 we make a synthetic drought record for the 120 year study period by repeating the past thirty years of historical pdsi values four times palmer 1965 the reduction in dryland crop yields from drought comes from yield data for the last thirty years usda nass 2018b and the increase in groundwater pumping for irrigated crops due to drought comes from producers response to the 2012 drought in arkansas kemper et al 2012 drought typically increases irrigation by 1 2 additional inches for row crops and 5 10 additional acre inches of water for rice kemper et al 2012 4 results and discussion initially we examine the optimal amount of mar water use for different costs of mar water and recovery efficiencies with and without drought we consider how much mar incentivizes land use change to more intensively irrigated land and we compare total net returns with mar only versus off farm surface storage deliveries for a range of water costs second we analyze the use of mar water and other irrigation sources for sensitivity analyses on the crop margins and initial depths to groundwater third we consider how the use of mar influences the cost effectiveness of groundwater conservation policies 4 1 optimal use of water for mar fig 2 shows the use of water for mar for different costs of mar water and drought conditions over the 120 year study period the recovery efficiency and cost of mar water influence the effectiveness of using mar water to replenish groundwater stored in the aquifer but drought only increases the demand for mar water considerably when the cost of mar water is less than 30 acre foot if 100 recovery efficiency is possible and the cost of mar water is less than 100 acre foot then there is well injection at some sites early in the time horizon fig 2b and d however extensive use of mar water only appears to occur if the cost of mar water is less than 60 acre foot and the recovery efficiency is at least 60 fig 2a and c if the cost of mar water is 20 acre foot producers cumulatively inject about 35 million acre feet of excess surface water to the aquifer with a recovery efficiency of 60 over the time horizon at the same recovery efficiency and a cost of mar water of 60 acre foot there is only 1 3 million acre feet that producers cumulatively inject to the aquifer or about 5 42 acre feet year at each injection well this finding is consistent with previous studies that show artificial recharge is not widely in use due to the high cost hays 2001 kresse et al 2014 fig 2c and d indicate that drought increases the water applied for irrigation and use of water for mar but the water in use for mar declines quickly as the cost of mar increases in drought years we suppose there is less rainfall during the growing season but there is still ample water during the wet season to permit recharge at a recovery efficiency of 60 the drought increases the cumulative amount of mar water by approximately 30 at a cost of mar water of 20 acre foot but the difference in the use of water for mar between drought and no drought scenarios is negligible if the cost of mar is between 80 and 100 acre foot drought has less influence on the water in use for mar than the recovery efficiency and cost of mar water the optimal use of mar water over time differs according to the cost of mar water and the recovery efficiency at a cost of mar water less than initial groundwater withdrawal costs which is approximately 40 acre foot for most sites and a recovery efficiency of 100 the optimal approach is significant injection early in the time horizon to increase groundwater levels and reduce the pumping costs for the entire time horizon however when the cost of mar water is greater than the initial groundwater withdrawal costs such as 60 acre foot producers begin to inject when groundwater levels fall to a certain level and the optimal mar water use is then set to stabilize the groundwater level and net returns fig 2 the injection of water becomes the cheaper approach to maintain profitability than allowing groundwater levels to continue falling table 1 indicates that for a cost of mar water above initial groundwater withdrawal costs producers use less irrigation intensive crops e g non irrigated soybeans and no mar water use for the first half of the time horizon but in the last half of the time horizon there are more irrigation intensive crops e g irrigated soybeans and the use of mar water 4 2 slippage effects a slippage or rebound 8 8 here we use the term slippage rather than rebound where slippage refers to increase in irrigated crops acreage due to higher groundwater levels while rebound effect refers to an increase in water application due to higher groundwater levels the results show that both slippage and rebound effects are happening the use of mar water increases irrigated crops in response to lower groundwater pumping costs there is also movement from less irrigation intensive crops to more irrigation intensive crops that leads to an increase in groundwater withdrawals effect refers to the increase in groundwater pumping that occurs when more irrigation intensive crops are grown because the cost of irrigation falls due to greater irrigation efficiency or the use of water for mar the percentage of slippage refers to the percent increase in groundwater use divided by the use of water for mar as an example table 1 indicates that the percentage of slippage in the year 2136 at a cost of mar of 20 acre foot is 114 5 102 3 35 4 100 34 5 fig 3 indicates that without drought and a cost of mar water higher than 90 acre foot increased groundwater withdrawal is small and the percentage slippage is less than 30 at a cost of mar water of 20 acre foot 34 45 of recharged water is offset through increased groundwater use also when drought is present which increases the use of water for mar slightly the percentage of slippage is higher the use of mar water alone is unlikely to significantly improve the aquifer stock due to the slippage effect unless the cost of mar water is less than 20 acre foot contrary to niswonger et al 2017 and scherberg et al 2014 2018 when the cost of mar water is 40 60 acre foot the aquifer stock remains nearly the same as the aquifer stock without the use of water for mar because the percentage of slippage is so high additional measures such as restrictions in land use changes might therefore be needed for groundwater conservation ward and pulido velazquez 2008 4 3 net returns with water from the use of mar and off farm surface reservoirs fig 4 shows the response of net returns to a range of off farm surface water costs for a scenario without the use of water for mar and the response of net returns to a range of mar water costs with no off farm surface water for three scenarios of mar recovery efficiency as costs of water increases total net returns naturally fall in all scenarios off farm surface storage always provides a higher total net return if the unit price of water from reservoir storage and aquifer storage mar is the same the higher net returns from surface storage are because the water remains on the surface rather than being pumped up later from the aquifer the use of water for mar provides nearly no gain in total net returns if the cost of mar water is greater than 40 acre foot 4 4 sensitivity of model outcomes to the cost of off farm surface water drought crop margins initial depth to groundwater and the real discount rate table 2 indicates the use of water for mar can slow aquifer depletion if the cost of mar water is less than 20 per acre foot scenario 20 200 i e unit cost of water for mar of 20 per acre foot and a unit cost of water for off farm surface storage of 200 per acre foot but does not slow aquifer depletion when the cost of mar water is higher than 40 per acre foot the aquifer declines to 61 7 million acre feet at the end of time horizon from an initial 92 8 million acre feet when there is no use of water for mar water or when the cost of mar water is higher than 40 per acre foot drought intensifies groundwater pumping and increases the use of water for mar slightly groundwater depletion is less with the conjunctive use of water for mar and off farm surface water scenarios 20 60 i e 20 per acre foot of water for mar and 60 per acre foot for off farm surface water 40 60 60 60 20 80 40 80 60 80 for the scenario 60 80 the aquifer stock only declines to about 80 million acre feet at the end of the time horizon the cost of off farm surface water is low enough at 80 or lower per acre foot that a significant component of the total irrigation water comes from the surface rather than the ground table 3 shows how the cost of mar water and the cost of off farm surface water interact to influence the net returns and aquifer stock relative to a baseline without mar or off farm surface water cheaper off farm surface water provides higher net returns and a larger percentage increase in the aquifer stock conjunctive use of mar and off farm surface water results in more groundwater and higher net returns compared with the use of water for mar alone at a cost of mar water of 40 per acre foot a decrease in the cost of off farm surface water from 60 to 20 per acre foot makes net returns go from 6 8 above the baseline to 36 above the baseline for a given cost of off farm surface water a decrease in the cost of mar water has much less influence than the cost of off farm surface water on net returns and the aquifer stock at an off farm surface water cost of 60 per acre foot a decrease in the cost of mar water from 60 to 20 per acre foot makes net returns go from 6 7 above the baseline to only slight higher at 6 9 above the baseline however the more expensive off farm surface water is the greater the influence that lower costs of mar water have on increasing net returns and the aquifer stock above the baseline the use of water for mar buffers net returns against drought but there is not much buffer for the aquifer stock unless the cost of mar water is considerably lower than the average groundwater pumping cost table 4 indicates what happens to the use of water for mar when crop margins double 2cm or halve 0 5cm and also what happens when the initial depth to groundwater doubles 2dtw or halves 0 5dtw at double the crop margins the use of water for mar more than doubles from the baseline to 0 65 and 0 12 million acre foot for a mar water cost of 20 and 60 per acre foot respectively the significant rise in the use of water for mar is because groundwater levels fall faster with greater crop water demand due to a shift toward irrigated crops the groundwater use also increases but does not double suggesting the use of water for mar is more profitable than solely mining the groundwater the use of water for mar nearly disappears when the crop margins half because there is no reason to supplement groundwater with mar when minimal groundwater is in use at half the initial depth to water the use of water for mar increases from 0 30 to 0 37 million acre feet at a mar water cost of 20 per acre foot and increases from 0 01 to 0 03 million acre feet at a mar water cost of 60 per acre foot the use of water for mar to supplement groundwater is more profitable if the cost of pumping groundwater is less however if the initial depth doubles the use of water for mar is zero at a cost of 60 per acre foot and only 0 07 million acre feet of water for mar annually at a cost of 20 per acre foot the use of mar to supplement groundwater is less profitable if initial groundwater pumping costs are large if the real interest rate doubles to 4 the groundwater pumping remains unchanged but the use of mar water declines from 0 3 to 0 09 million acre feet at a mar water cost of 20 per acre foot there is less reason to use mar to support groundwater levels in the future if the present value of future net returns from irrigated production are lower if the real interest rate halves to 1 the use of mar water increases to 0 63 million acre feet at a low cost of mar water 20 per acre foot but remains unchanged at a high cost of mar water 60 per acre foot lower interest rates increase the present value of future returns from irrigated production and this creates the incentive to sustain the aquifer through greater use of mar and through a shift from rice to less irrigation intensive corn and soybeans 4 5 effect of groundwater conservation policies on the crop and irrigation choices and net returns table 5 shows that the pumping cap and tax policies generate a cost in 2017 us dollars to society per acre foot of groundwater conserved that range from 1 0 to 35 2 the pumping cap and taxes cause net returns to producers to fall compared to the baseline without the policies and the cost to society is those losses plus the gain in government revenue if the policy is a tax as the cost of mar water increases the social cost of the pumping cap for groundwater conservation increases from less than 2 to about 35 per acre foot of groundwater conserved likewise the conservation cost of a pumping tax increases with the cost of mar water from approximately 1 22 per acre foot of groundwater conserved since a lower cost of mar water reduces the groundwater conservation cost of cap and tax policies mar and conservation policies appear to be complements for conservation also a recovery efficiency higher than 60 makes the conservation cost even lower conservation policies increase the aquifer stock less when the cost of mar water is low but the social cost of the policies are also lower the pumping tax is a more cost effective approach to conserve groundwater compared to the pumping cap 5 conclusion our results on the optimal economic use of water for mar contrast with the results from hydrologic models where land use is fixed niswonger et al 2017 scherberg et al 2014 2018 at the likely cost of mar water for irrigation in eastern arkansas which is at least 40 per acre foot falconer and johnson 2017 the use of water for mar is unlikely to reduce groundwater overdraft our model indicates that the use of water for mar has a moderate role in the alleviation of groundwater overdraft at a cost of 40 per acre foot due to minimal injection and the slippage effect there is evidence that producers would shift to more irrigation intensive crops with the availability of mar water and groundwater pumping could increase a more effective approach for reducing the groundwater overdraft is the conjunctive use of mar water and surface water storage this is only effective though if the cost of the surface water deliveries are less than the 100 acre foot groundwater conservation polices such as the use of a cap or fee on groundwater extraction are more cost effective with the use of water for mar if the cost mar water is much lower than the average groundwater pumping cost then mar should begin early in the time horizon to lower groundwater pumping costs over the entire study period drought slightly increases the use of water for mar but drought is unlikely to make mar economically feasible higher irrigation demand by doubling crop margins more than doubles the use of mar water to supplement the groundwater but halving the crop margins nearly eliminates the use of water for mar even at the lowest cost of mar water the use of water for mar is thus heavily dependent on the anticipated irrigation demand of crops also regions with large depths to the aquifer are unlikely to use mar water to supplement groundwater because the cost of pumping the water back out of the aquifer is high a lower real discount rate encourages aquifer conservation and mar water use while a higher real discount rate does the opposite water policy makers continue the search for strategies to allow producers to maximize net returns and sustain the groundwater resource greater irrigation efficiency can increase water use through the slippage effect and not necessarily conserve groundwater grafton et al 2018 and conjunctive use strategies such as the use of surface water reservoirs should also proceed with caution since the slippage effect can also occur kovacs and durand morat 2017 our study finds that unless the cost of mar water is substantially less than the average groundwater pumping cost or the cost of water from surface storage is about the same or less than the average groundwater pumping cost then the slippage effect is large we suppose ample water for mar is available in eastern arkansas but periods of extreme drought might limit the water available for mar and surface reservoirs if the use of water for mar is known not to be possible in some years this would increase mar when precipitation is abundant also for a shorter time horizon a model could allow for deficit irrigation rather than assume producers switch to new irrigation practices or less water intensive crops another extension to the model is to change the number of sites in the study area which would be equivalent to decreasing or increasing the proximity of the wells and examine what this does to the well pumping of the surrounding sites the hydrological component of our model is simple particularly in the assumption that there are no lateral flows between sites to allow for computationally tractable optimization an economic model coupled with a more sophisticated hydrologic model such as modflow would better account for the complexity of groundwater flows also our model overlooks the potential effects of climate change on aquifer recharge pulido velazquez et al 2015 2018 zhang et al 2016 meixner et al 2016 gemitzi et al 2017 smerdon 2017 and the assessment of conjunctive use strategies pulido velazquez et al 2011 2008 escriva bou et al 2017 since drought will change in the future due to climate change future studies could incorporate a statistical approach to generate climate scenarios to evaluate the impact of a potential shift in the intensity and frequency of drought on the economics of mar fatichi et al 2011 collados lara et al 2018 declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work supported by the usda economic research service through a cooperative agreement 58 6000 7 0090 any opinions findings or recommendations expressed in this material are those of the author s and do not necessarily reflect the views of the usda appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2019 124220 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 supplementary data 2 
6091,discerning the reasons for the changes in runoff is a key issue for understanding hydrological cycles under nonstationary conditions this study conducted a budyko based framework for quantifying the impacts of aridity index and other factors on annual runoff in 355 catchments in the united states the aridity index is the ratio of potential evapotranspiration to precipitation representing the dry conditions in budyko framework other factors are the influence of everything else except the aridity index and are represented by the parameter w in budyko type equations which is a time dependent variable in this case then the impacts of aridity index and other factors were decomposed based on the annual variations in the budyko spaces the results show the current budyko type equations which use time varying parameters can improve the fitting capability for most catchments in the united states aridity index is the main driver causing the increasing trend of runoff in the us other factors on the other hand are the main reasons for the decreasing trend of runoff in the us keywords climate change human activities runoff budyko equations 1 introduction currently runoff in many regions have exhibit nonstationary characteristic because of the complex interactions between climate change human activities and hydrological processes milly et al 2005 climate change has caused the temperature to increase in many regions of the world leading to complex variations in precipitation and floods armal et al 2018 gong and ho 2002 scheff and frierson 2015 yin et al 2018 the increased temperature has also caused precipitation to shift from snow to rain and changed the relationship between runoff and precipitation evapotranspiration and other hydrometeorological variables berghuijs et al 2014 marshall et al 2019 human activities on the other hand influence the process of catchment water yield directly through water withdrawal diversion etc or indirectly via land use changes and vegetation cover bao et al 2012 as a result the runoff which is a main source for human water consumption may become nonstationary and pose a grand challenge for sustainable water resources management milly et al 2008 finding the reasons for the variations in runoff is essential for the understanding of hydrologic processes especially for some catchments with nonstationary runoff the results will provide a theoretical basis for many nonstationary researches such as nonstationary flood frequency analysis bracken et al 2018 li et al 2018 lima et al 2015 luke et al 2017 projections of water availability based on global climate models asokan et al 2016 shen et al 2014 and adaptive water resources management haasnoot et al 2013 kepeng and juncang 2013 ren et al 2019 zeff et al 2016 apart from that many studies have stated the demand for clarifying the interactions between precipitation temperature evaporation and human activities biermann 2012 carmona et al 2014 lewis and maslin 2015 scheff 2018 wang and hejazi 2011 a great amount of effort has been made to quantify the impacts of hydrometeorological and anthropogenic variables on runoff including hydrological models ma et al 2010 wen et al 2015 wu et al 2017b trend analysis hao et al 2008 linear regression models ahn and merwade 2014 kong et al 2016 back propagation artificial neural network method liu et al 2010 and budyko based method berghuijs et al 2017 donohue et al 2011 gao et al 2016 li et al 2019 mwangi et al 2016 wu et al 2017a xu et al 2014 zhang et al 2011 2015 zhao et al 2014 among these methods the budyko type equation is a relatively simple and robust method and can be applied with readily available data despite its simplicity the budyko type equation has been proven to be useful and reliable in many studies berghuijs et al 2014 greve et al 2015 gudmundsson et al 2016 the sensitivity method jiang et al 2015 li et al 2019 roderick and farquhar 2011 and decomposition method proposed by wang and hejazi 2011 are the two main methods based on the budyko framework to analyze the reasons for the changes in catchment water yields at the mean annual time scale in budyko based decomposition studies aridity index and parameter w are the two main drivers influencing runoff the aridity index is the ratio of potential evapotranspiration to precipitation i e e p t p t and determines the climatic conditions tabari and aghajanloo 2013 yang et al 2019 parameter w is the parameter in some one parameter budyko type equations and is usually interpreted as catchment properties chen et al 2013 dan et al 2013 istanbulluoglu et al 2012 some studies see these two drivers as climate change and human activity li et al 2019 renard et al 2011 wang and hejazi 2011 wu et al 2017a however aridity index doesn t equal to climate change many other factors such as carbon dioxide scheff 2018 yang et al 2019 rainfall seasonality lavenne and andréassian 2018 yang et al 2012 rainfall intensity yang et al 2009 are also components of climate change influencing water yields but don t belong to aridity index in addition some studies show that temperature irrigation water consumption may correlate with parameter w jiang et al 2015 zhang et al 2019 as a result we hereafter name these two drivers as aridity index and other factors for brevity and clarity other factors mainly point to the catchment properties but also contains some climatic and anthropogenic variables such as carbon dioxide and rainfall seasonality previous studies based on budyko type equations were usually conducted in three steps cavalcante et al 2019 patterson et al 2013 roderick and farquhar 2011 wang and hejazi 2011 wu et al 2017a 1 data were divided into two independent periods by the change point in runoff time series i e the pre and postchange periods 2 the budyko type equations were fitted to the data in the pre and postchange periods 3 the sensitivity method jiang et al 2015 li et al 2019 roderick and farquhar 2011 or the decomposition method proposed by wang and hejazi 2011 was used to decompose the difference in runoff between the pre and postchange periods the changes caused by precipitation and potential evapotranspiration are attributed to aridity index the impacts of other factors on the other hand are quantified by the changes in the parameters of the budyko type equations however the three steps in the previous budyko based method may have some deficiencies 1 the method can only decompose the changes in runoff between two or more time periods of multiple years the parameters in the budyko type equation are assumed to be constant in the pre and postchange periods and it is implicitly assumed that the effects of aridity and other factors suddenly occur at the time of the change points this assumption does not agree with reality because aridity index and other factors are more likely to occur gradually over the entire study period or several years 2 this method may not be appropriate for some regions without significant change points or with many change points in the runoff time series motivated by the problems in previous studies an improved budyko based framework for quantifying the impacts of aridity and other factors on runoff at the annual time scale is applied in this study first a time varying budyko type equation was derived to describe the temporal variations in catchment properties via the time varying parameters in the budyko type equations then the long term trends in climatic variables were modeled using time as an explanatory variable finally an improved method based on the study by wang and hejazi 2011 was used to decompose the impacts of aridity index and other factors on runoff at the annual scale using 355 catchments in the united states these three parts consist of the framework in this study and can be used to other regions as well this paper is organized as follows section 2 presents the budyko based method section 3 and section 4 present the applications of this framework in the united states discussion and conclusions are provided in section 5 and section 6 respectively 2 methods 2 1 time varying budyko type equations before applying time varying budyko type equations it is important to select an appropriate time scale for the budyko type equations the subannual time scale is not appropriate because the water storage change may not equal zero averaging over single or multiple years such as five years or ten years may be a better solution berghuijs et al 2017 berghuijs et al 2014 jiang et al 2015 zhang et al 2019 in this case the annual runoff annual areal precipitation and potential evapotranspiration data are averaged over five years to satisfy the assumption that the changes in water storage can be ignored considering the length of the data set berghuijs et al 2017 berghuijs and woods 2016 liu et al 2017 however an accurate quantification of water storage change may improve the accuracy of this study hereafter the mean annual runoff precipitation actual evapotranspiration and potential evapotranspiration from year t 4 to year t are denoted by r t p t e t and e p t respectively here fu s equation a popular one parameter budyko type equation was used to calculate evapotranspiration e t fu 1981 zhang et al 2004 1 e t p t 1 φ t 1 φ t w 1 w w 1 where φ t the aridity index equals the ratio of the potential evapotranspiration e p t to the precipitation p t i e e p t p t and parameter w is a parameter accounting for the controls of the catchment properties on the partitioning of precipitation into evapotranspiration and runoff based on the water balance law the catchment runoff r t can be expressed as follows 2 r t p t e t δ s where δ s is the change in water storage in the long term the change δ s is negligible and equal to zero jiang et al 2015 the precipitation p t is the observed inputs the evapotranspiration e t is estimated from budyko type equations i e eq 1 then the expression for runoff r t is rewritten by substituting the fu equation to eq 2 as follows 3 r t p t p t 1 φ t 1 φ t w 1 w p t φ t 1 φ t w 1 w w 1 the parameter w in eq 3 which represents other factors is still constant and cannot capture the time varying impacts of other factors at the annual time scale previous studies have related temperature precipitation and human water consumption to parameter w jiang et al 2015 zhang et al 2019 liu et al 2017 introduced a dynamic parameter w in budyko framework therefore two time varying budyko type equations are used in this study to solve this problem the parameter w t is considered as a time variant parameter depending on time t rather than a constant the linear and quadratic equations of variable w t with time t are considered in this study 4 r t p t φ t 1 φ t w t 1 w t 5 w t m a x α β 1 t 1 6 w t m a x α β 1 t β 2 t 2 1 where t is the time step which is equal to 1 in the first year and the number of years in the last year α is the intercept and β β 1 β 2 are the regression coefficients of time in fu s equation the parameter w t must be larger than 1 therefore we use a maximum function to assure the domain of parameter w t in this paper fu s equation with a constant parameter w is termed the constant budyko type equation cbe in contrast the equations with time varying parameter w t using eqs 5 and 6 are termed the linear time varying budyko type equation l tvbe and quadratic time varying budyko type equation q tvbe respectively 2 2 modeling climatic variables in the context of fu s equation the temporal variations in parameter w t have been quantified by the time varying budyko type equations then the long term trends in observed precipitation p obs t and potential evapotranspiration e p o b s t are described using the following two functions 7 p obs t f p t β p e p 8 e p o b s t f ep t β e p e ep where f p and f ep are the functions used for modeling long term changes in precipitation and potential evapotranspiration t is time β p and β e p are parameters that are estimated using maximum likelihood estimation and e p and e ep are the error terms which are assumed to be normally distributed linear quadratic cubic exponential and logarithmic equations are compared for the functions f p and f ep using the bayesian information criterion bic in this case linear and quadratic function have the best performance based on bic for most regions meanwhile other functions don t have significant advantage over linear and quadratic functions in the remaining regions we only use linear and quadratic functions to fit precipitation and potential evapotranspiration in this case to avoid over fitting then the fitted climate variables p t and e p t are defined to represent the long term trends of precipitation and potential evapotranspiration 9 p t f p t β p 10 e p t f ep t β e p hereafter the fitted values p t and e p t are used to quantify the impact of climate change we did not use the observed precipitation and potential evapotranspiration because the observed climatic variables include some random errors e p and e ep which may result in large uncertainty when analyzing the annual impacts the objective of fitting climatic variables is to better reduce natural variations and represent the nonstationary long term impacts of climatic variables selecting time as an explanatory variable has been commonly used in similar studies of nonstationary frequency analysis aghakouchak et al 2013 cunderlik et al 2007 gu et al 2017 um et al 2017 villarini et al 2009 as a result the long term trends of precipitation and potential evapotranspiration are modeled by the fitting functions f p and f ep 2 3 decomposition method using a catchment no 01064500 name saco river near conway new hampshire location was shown in fig 2 as an example the interannual variations in pairs e p t p t e t p t and the budyko curves w t from 1952 to 2001 have been described in fig 1 a then the method proposed by wang and hejazi 2011 was used to separate the impacts of aridity index and other factors on annual runoff a schematic figure clarifying the decomposition method for quantifying the impacts of aridity index and other factors from year t 1 to year t is plotted in fig 1 b point a e p t 1 p t 1 e t 1 p t 1 represents the hydrometeorological condition in the year t 1 when the parameter in the budyko type equation is w t 1 point c e p t p t e t p t represents the hydrometeorological condition in the year t when the parameter in the budyko type equation is w t the shift from point a to point c was decomposed into two parts first the shift from point a to point b which is caused by the changes in the aridity index e p t 1 p t 1 to e p t p t with the constant parameter of w t 1 and second the vertical shift from point b to point c which is caused by the changes in the budyko curve w t 1 to w t with a constant aridity index of e p t p t accordingly the shift in runoff from year t 1 to year t i e δ r t is divided into two parts the first is the impacts of aridity index δ a t which is attributed to the changes in aridity indexes i e point a to point b in fig 1 b and is expressed as follows 11 δ a t p t φ t 1 φ t w t 1 1 w t 1 p t 1 φ t 1 1 φ t 1 w t 1 1 w t 1 the second is the impacts of other factors δ o t which is attributed to the changes in the budyko type curves i e point b to point c in fig 1 b and is expressed as follows 12 δ o t p t φ t 1 φ t w t 1 w t p t φ t 1 φ t w t 1 1 w t 1 where δ a t and δ o t are the annual impacts of aridity index and other factors from year t 1 to year t respectively however the annual impacts only concentrate on individual years and ignore the prior impacts as a result the cumulative effects of aridity a a t and other factors a o t from the start year t 0 to year t were defined in this study as follows 13 a a t i t 0 1 t δ a i 14 a o t i t 0 1 t δ o i the cumulative impacts can express the impacts from the starting year of data to the present and better illustrate the overall impacts compared with individual impacts δ a t and δ o t hereafter we mainly use the cumulative impacts a a t and a o t to represent the impacts of aridity index and other factors respectively 2 4 impacts between two periods of multiple years the present budyko based method in this study quantifies the impacts of aridity index and other factors over an annual timescale previous methods based on the budyko equations in contrast quantified the impacts between two periods of multiple years patterson et al 2013 roderick and farquhar 2011 wang and hejazi 2011 wu et al 2017a here the relationship between annual impacts and impacts of two periods of multiple years are derived for comparison we assumed data spanning from the start year t 0 to the end year t 2 the change point of the data is year t 1 which divides the data into pre and postchange periods the runoff in year t equals to the runoff in the starting year r t 0 plus the cumulative impacts of aridity index and other factors a a t a o t 15 r t r t 0 a a t a o t then the mean annual runoff in the prechange period r pre and postchange period r post are as follows 16 r pre i t 0 t 1 r i t 1 t 0 1 r t 0 r t 0 a a t 0 1 a o t 0 1 r t 0 a a t 1 a o t 1 t 1 t 0 1 r t 0 i t 0 1 t 1 a a i i t 0 1 t 1 a o i t 1 t 0 1 17 r post i t 1 1 t 2 r i t 2 t 1 r t 0 a a t 1 1 a o t 1 1 r t 0 a a t 1 2 a o t 1 2 r t 0 a a t 2 a o t 2 t 2 t 1 r t 0 i t 1 1 t 2 a a i i t 1 1 t 2 a o i t 2 t 1 the difference in runoff between the pre and postchange periods r diff is as follows 18 r diff r post r pre i t 1 1 t 2 a a i i t 1 1 t 2 a o i t 2 t 1 i t 0 1 t 1 a a i i t 0 1 t 1 a o i t 1 t 0 1 i t 1 1 t 2 a a i t 2 t 1 i t 0 1 t 1 a a i t 1 t 0 1 i t 1 1 t 2 a o i t 2 t 1 i t 0 1 t 1 a o i t 1 t 0 1 where the first and second terms on the right side of eq 18 are the contributions of aridity index and other factors on r diff respectively which are also equal to the impacts between the pre and postchange periods 3 study areas and data in this study 355 catchments out of 438 catchments in the united states were used to analyze the impacts of aridity and other factors on runoff from the model parameter estimation experiment dataset mopex duan et al 2006 which has been used in many previous studies berghuijs and woods 2016 greve et al 2015 the dataset and some specific information are available online www nws noaa gov oh mopex mo datasets html the runoff precipitation and potential evapotranspiration in these catchments are measured in millimeters daily time series are all available for up to 54 years 1948 to 2001 the potential evaporation was estimated based on noaa freewater evaporation atlas which were derived by analysis of evaporation pan farnsworth and thompson 1983 and penman method eighty three catchments were excluded because they had less than 20 years of available data the locations gauge numbers and length of data of the 355 streamflow gauges of the catchments are shown in fig 2 and table s1 the mann kendall m k test was used to detect the trend in annual runoff at the 0 05 significance level the results are shown in fig 2 approximately 53 187 out of 355 catchments of the catchments have significant increasing runoff and another 8 27 out of 355 catchments of the catchments have significant decreasing runoff the catchments with significant increasing runoff are mainly located in the central and eastern united states the catchments with significant decreasing runoff in contrast are mainly located in the northwestern united states in summary the runoff in 61 of the catchments 214 out of 355 catchments have significant trends at the 0 05 level of significance indicating that the nonstationarity of annual runoff in the study catchments is very common 4 results 4 1 validity of the time varying budyko type equations the nash sutcliffe model efficiency coefficient nse nash and sutcliffe 1970 was used to test whether the tvbe is appropriate for 355 catchments in the united states the nse is calculated as follows 19 n s e 1 t 1 n r obs t r sim t 2 t 1 n r obs t r obs 2 where r obs t and r sim t are the observed and simulated runoff at time t respectively and r obs is the mean of observed runoff the spatial distributions of the nse of cbe l tvbe and q tvbe are shown in fig 3 the histogram of the nse for catchments with significant decreasing increasing and no trends of runoff are shown in fig 4 the time varying budyko type equation exhibits much better performance than the constant equations especially for some catchments with significant trends of runoff for the central united states where runoff has a significant increasing trend the nse using cbe ranges from 0 6 to 0 8 the use of the time varying budyko type equations makes the nse increase by approximately 0 2 for eastern regions where the runoff does not have a significant trend the time varying method also improves the results by approximately 0 1 two time varying budyko type equations were used in this study l tvbe and q tvbe the nse of q tvbe was slightly better than that of l tvbe then q tvbe was used for subsequent analysis because the main objective of this study is to understand the reasons for the nonstationarity in annual runoff 4 2 comparison with previous studies the results derived from the budyko based method were compared with the previous study by wang and hejazi 2011 to illustrate the robustness of the results only catchments where the nse are larger than 0 5 were used to quantify the impacts because nse 0 5 indicates that the results may not be reliable the temporal variations in the parameter w of the budyko type equations were quantified by q tvbe due to its superior performance the year 1970 was set as the change point of runoff because some studies have shown that precipitation increases at this point krakauer and fung 2008 mccabe and wolock 2002 small et al 2006 and we wanted to keep the steps consistent with those in the study by wang and hejazi 2011 the decomposition results from the present budyko based method are shown in fig 5 a b the results show that aridity index has caused runoff to increase in most catchments other factors on the other hand did not have a uniform influence on runoff the runoff in nearly half of the catchments was reduced because of other factors the differences between the current method and the previous method by wang and hejazi 2011 are presented in fig 5 c d the difference ranges from 35 mm to 10 mm accounting for 14 to 4 of the mean annual runoff demonstrating that the current decomposition results are reliable although the difference in a small part of the catchments is still large the overall spatial patterns of the impacts are very similar 4 3 cumulative influence the cumulative impacts of aridity index and other factors in the catchments with significant decreasing trends no trends and significant increasing trends of runoff are shown in fig 6 for the catchments with significant decreasing trends of runoff in fig 6 a b the impacts of aridity index mainly occurred from approximately 1960 to 1995 the impacts reached positive values in approximately 2000 in contrast the impacts of other factors are negative and consistently decrease in most catchments demonstrating that other factors have caused the runoff to constantly decrease thus we can infer that the significant decreasing trend of runoff may be attributed to the impacts of other factors for the catchments without any trends of runoff in fig 6 c d the impacts of aridity index became large in the 1960s after 1970 the impacts decreased this is in accord with some studies about the trends of precipitation and runoff in the united states krakauer and fung 2008 mccabe and wolock 2002 small et al 2006 in 2001 the impacts of aridity index were positive in most regions other factors have a smaller and more constant influence on runoff compared with climate change the most dramatic changes in the impacts of other factors occurred between 1970 and 1985 for the catchments with significant increasing trends of runoff in fig 6 e f the cumulative impacts of aridity index have an increasing trend before 1965 there are some regions where aridity index caused the runoff to decrease since then the cumulative impacts of aridity index have continued to increase in 2001 all values were positive the impacts of other factors have a slight increasing trend as well and are smaller and smoother we can conclude that the joint influence of aridity index and other factors led to the increasing trend of runoff in summary the temporal patterns of the impacts of aridity index are homogenous in the united states the runoff increased because of aridity index in most catchments other factors on the other hand are heterogeneous across catchments other factors are the main reasons causing the runoff to decrease significantly and are part of the causes of the increasing trend 5 discussions in this study a budyko based framework was proposed to quantify the annual impacts of aridity index and other factors on runoff the decomposition method in this study was developed from the previous method by wang and hejazi 2011 the accordance between the current method and the previous method can be partly predicted from their similar decomposition procedures the main advantage of the present method is that it not only agrees with the results of the previous method but also provides information about annual variations in budyko framework the results may help us to better understand the response of hydrologic cycles in the anthropocene biermann 2012 lewis and maslin 2015 in addition the budyko type equations used in the present framework are time varying equations which have larger nses compared with those of the constant equations therefore it is inferred that the results of the improved method are more reliable because of its better modeling capability the discrepancies between the current method and the previous method by wang and hejazi 2011 may be explained by the following two factors 1 the improved method uses the time varying budyko type equations to describe the variations in the catchment properties in contrast the previous method fit constant budyko equations for the pre and postchange periods respectively different types of budyko type equations may result in differences in the findings 2 the precipitation and potential evapotranspiration in the improved method were represented by the fitting functions to describe the long term trend the previous method used only the mean of observed values in the pre and postchange periods the results of this study show that the changes in aridity index has caused runoff to increase in recent years the results about aridity index are consistent with previous studies about the trend of precipitation the increase in temperature enhances the water holding capacity of the atmosphere and results in severe and frequent precipitation alfieri et al 2015 min et al 2011 the runoff as a result of precipitation may increase accordingly yin et al 2018 some coupled model intercomparison project phase 5 cmip5 models also predict increased runoff with respect to climate change greve et al 2017 milly and dunne 2017 other factors on the other hand including human activities vegetation land use among others have heterogeneous impacts on runoff in the northwestern united states where the runoff has a significant decreasing trend other factors have caused the runoff to decrease and are the main reasons for the decreasing trend of runoff in other regions of the united states the impacts of other factors are smaller than those of aridity index and partly caused the increasing trend of runoff current studies about the separation of impacts of aridity index and other factors at the annual time scale are still rare the main difficulty we faced is the quantification of the annual variations in catchment properties and climatic variables in this study two time varying budyko type equations i e l tvbe and q tvbe were used to quantify the variations in catchment properties and two modeling functions i e eqs 7 and 8 were used to describe the long term trend of the climatic variable however some problems still exist and deserve further investigation 1 the time varying budyko type equations in this study only use time as an explanatory variable and obtain an appropriate improvement in the modeling capability the advantage of selecting time as an explanatory variable is that it is a relatively simple method and does not require extra data inputs however this process does not have enough physical basis the robustness and reliability of this method deserve further investigation selecting other physically based time varying variables such as the percentage of vegetation cover population density and proportion of irrigated land may be a better solution to account for the variations in the budyko type equations jiang et al 2015 zhang et al 2019 2 two modeling functions were used to describe the long term trend of climatic variables the main objective of fitting long term trends is to eliminate the impacts of random variation and preserve the long term influence of climatic variables other long term models using large scale climate indexes such as the north atlantic oscillation nao the interdecadal pacific oscillation ipo the atlantic multidecadal oscillation amo and the pacific decadal oscillation pdo may be more appropriate methods for analyzing the impacts of climate change however these large scale climate indexes may also include some natural variations how to separate natural climate variation and anthropogenic climate variation is a critical issue in analyzing the annual impacts of climate change armal et al 2018 3 accurate description of potential and actual evapotranspiration is another critical issue in budyko based framework penman monteith equation and pan evaporation are two main methods estimating potential evaporation however increasing carbon dioxide drives partial stomatal closure and consequently indirectly decrease evapotranspiration field and jackson rbmooney 2010 traditional methods estimating evapotranspiration may not accurate any more yang et al 2019 proposed an improved penman monteith equation with the influence of carbon dioxide and got physically based vegetation response to carbon dioxide therefore incorporating increasing carbon dioxide into the budyko framework is a challenge and promising direction 6 conclusions in this study a budyko based framework was proposed to quantify the impacts of aridity index and other factors on annual runoff the time varying budyko type equations and two modeling functions were used to model the annual variations in catchment properties and climatic variables respectively then a decomposition method was used on annual time scales to quantify the annual impacts of aridity index and other factors the main conclusions are as follows 1 time varying budyko type equations improve the fitting capability for most regions of the united states especially for some catchments with significant runoff trends the time varying budyko type equations with linear functions have similar results compared with those of models using quadratic functions 2 the improved framework in this study quantifies the annual impacts of aridity index and other factors in the us and the results obtained are in accord with the previous method aridity index has a spatially uniform influence causing runoff to increase in many catchments in the us while the impacts of other factors are heterogeneous other factors have caused runoff to significantly decrease in the catchments where runoff has displayed significant decreasing trends at the same time other factors also partly caused runoff to increase in some regions with significant increasing runoff trends credit authorship contribution statement xu zhang conceptualization methodology writing original draft qianjin dong funding acquisition writing review editing visualization investigation lei cheng writing review editing supervision jun xia writing review editing validation supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors declare no conflict of interest this work is financially supported by the national natural science foundation of china grant nos 51979198 51439007 the model parameter estimation experiment dataset is available on noaa s national weather service website www nws noaa gov oh mopex mo datasets html appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2019 124224 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 supplementary data 2 
6091,discerning the reasons for the changes in runoff is a key issue for understanding hydrological cycles under nonstationary conditions this study conducted a budyko based framework for quantifying the impacts of aridity index and other factors on annual runoff in 355 catchments in the united states the aridity index is the ratio of potential evapotranspiration to precipitation representing the dry conditions in budyko framework other factors are the influence of everything else except the aridity index and are represented by the parameter w in budyko type equations which is a time dependent variable in this case then the impacts of aridity index and other factors were decomposed based on the annual variations in the budyko spaces the results show the current budyko type equations which use time varying parameters can improve the fitting capability for most catchments in the united states aridity index is the main driver causing the increasing trend of runoff in the us other factors on the other hand are the main reasons for the decreasing trend of runoff in the us keywords climate change human activities runoff budyko equations 1 introduction currently runoff in many regions have exhibit nonstationary characteristic because of the complex interactions between climate change human activities and hydrological processes milly et al 2005 climate change has caused the temperature to increase in many regions of the world leading to complex variations in precipitation and floods armal et al 2018 gong and ho 2002 scheff and frierson 2015 yin et al 2018 the increased temperature has also caused precipitation to shift from snow to rain and changed the relationship between runoff and precipitation evapotranspiration and other hydrometeorological variables berghuijs et al 2014 marshall et al 2019 human activities on the other hand influence the process of catchment water yield directly through water withdrawal diversion etc or indirectly via land use changes and vegetation cover bao et al 2012 as a result the runoff which is a main source for human water consumption may become nonstationary and pose a grand challenge for sustainable water resources management milly et al 2008 finding the reasons for the variations in runoff is essential for the understanding of hydrologic processes especially for some catchments with nonstationary runoff the results will provide a theoretical basis for many nonstationary researches such as nonstationary flood frequency analysis bracken et al 2018 li et al 2018 lima et al 2015 luke et al 2017 projections of water availability based on global climate models asokan et al 2016 shen et al 2014 and adaptive water resources management haasnoot et al 2013 kepeng and juncang 2013 ren et al 2019 zeff et al 2016 apart from that many studies have stated the demand for clarifying the interactions between precipitation temperature evaporation and human activities biermann 2012 carmona et al 2014 lewis and maslin 2015 scheff 2018 wang and hejazi 2011 a great amount of effort has been made to quantify the impacts of hydrometeorological and anthropogenic variables on runoff including hydrological models ma et al 2010 wen et al 2015 wu et al 2017b trend analysis hao et al 2008 linear regression models ahn and merwade 2014 kong et al 2016 back propagation artificial neural network method liu et al 2010 and budyko based method berghuijs et al 2017 donohue et al 2011 gao et al 2016 li et al 2019 mwangi et al 2016 wu et al 2017a xu et al 2014 zhang et al 2011 2015 zhao et al 2014 among these methods the budyko type equation is a relatively simple and robust method and can be applied with readily available data despite its simplicity the budyko type equation has been proven to be useful and reliable in many studies berghuijs et al 2014 greve et al 2015 gudmundsson et al 2016 the sensitivity method jiang et al 2015 li et al 2019 roderick and farquhar 2011 and decomposition method proposed by wang and hejazi 2011 are the two main methods based on the budyko framework to analyze the reasons for the changes in catchment water yields at the mean annual time scale in budyko based decomposition studies aridity index and parameter w are the two main drivers influencing runoff the aridity index is the ratio of potential evapotranspiration to precipitation i e e p t p t and determines the climatic conditions tabari and aghajanloo 2013 yang et al 2019 parameter w is the parameter in some one parameter budyko type equations and is usually interpreted as catchment properties chen et al 2013 dan et al 2013 istanbulluoglu et al 2012 some studies see these two drivers as climate change and human activity li et al 2019 renard et al 2011 wang and hejazi 2011 wu et al 2017a however aridity index doesn t equal to climate change many other factors such as carbon dioxide scheff 2018 yang et al 2019 rainfall seasonality lavenne and andréassian 2018 yang et al 2012 rainfall intensity yang et al 2009 are also components of climate change influencing water yields but don t belong to aridity index in addition some studies show that temperature irrigation water consumption may correlate with parameter w jiang et al 2015 zhang et al 2019 as a result we hereafter name these two drivers as aridity index and other factors for brevity and clarity other factors mainly point to the catchment properties but also contains some climatic and anthropogenic variables such as carbon dioxide and rainfall seasonality previous studies based on budyko type equations were usually conducted in three steps cavalcante et al 2019 patterson et al 2013 roderick and farquhar 2011 wang and hejazi 2011 wu et al 2017a 1 data were divided into two independent periods by the change point in runoff time series i e the pre and postchange periods 2 the budyko type equations were fitted to the data in the pre and postchange periods 3 the sensitivity method jiang et al 2015 li et al 2019 roderick and farquhar 2011 or the decomposition method proposed by wang and hejazi 2011 was used to decompose the difference in runoff between the pre and postchange periods the changes caused by precipitation and potential evapotranspiration are attributed to aridity index the impacts of other factors on the other hand are quantified by the changes in the parameters of the budyko type equations however the three steps in the previous budyko based method may have some deficiencies 1 the method can only decompose the changes in runoff between two or more time periods of multiple years the parameters in the budyko type equation are assumed to be constant in the pre and postchange periods and it is implicitly assumed that the effects of aridity and other factors suddenly occur at the time of the change points this assumption does not agree with reality because aridity index and other factors are more likely to occur gradually over the entire study period or several years 2 this method may not be appropriate for some regions without significant change points or with many change points in the runoff time series motivated by the problems in previous studies an improved budyko based framework for quantifying the impacts of aridity and other factors on runoff at the annual time scale is applied in this study first a time varying budyko type equation was derived to describe the temporal variations in catchment properties via the time varying parameters in the budyko type equations then the long term trends in climatic variables were modeled using time as an explanatory variable finally an improved method based on the study by wang and hejazi 2011 was used to decompose the impacts of aridity index and other factors on runoff at the annual scale using 355 catchments in the united states these three parts consist of the framework in this study and can be used to other regions as well this paper is organized as follows section 2 presents the budyko based method section 3 and section 4 present the applications of this framework in the united states discussion and conclusions are provided in section 5 and section 6 respectively 2 methods 2 1 time varying budyko type equations before applying time varying budyko type equations it is important to select an appropriate time scale for the budyko type equations the subannual time scale is not appropriate because the water storage change may not equal zero averaging over single or multiple years such as five years or ten years may be a better solution berghuijs et al 2017 berghuijs et al 2014 jiang et al 2015 zhang et al 2019 in this case the annual runoff annual areal precipitation and potential evapotranspiration data are averaged over five years to satisfy the assumption that the changes in water storage can be ignored considering the length of the data set berghuijs et al 2017 berghuijs and woods 2016 liu et al 2017 however an accurate quantification of water storage change may improve the accuracy of this study hereafter the mean annual runoff precipitation actual evapotranspiration and potential evapotranspiration from year t 4 to year t are denoted by r t p t e t and e p t respectively here fu s equation a popular one parameter budyko type equation was used to calculate evapotranspiration e t fu 1981 zhang et al 2004 1 e t p t 1 φ t 1 φ t w 1 w w 1 where φ t the aridity index equals the ratio of the potential evapotranspiration e p t to the precipitation p t i e e p t p t and parameter w is a parameter accounting for the controls of the catchment properties on the partitioning of precipitation into evapotranspiration and runoff based on the water balance law the catchment runoff r t can be expressed as follows 2 r t p t e t δ s where δ s is the change in water storage in the long term the change δ s is negligible and equal to zero jiang et al 2015 the precipitation p t is the observed inputs the evapotranspiration e t is estimated from budyko type equations i e eq 1 then the expression for runoff r t is rewritten by substituting the fu equation to eq 2 as follows 3 r t p t p t 1 φ t 1 φ t w 1 w p t φ t 1 φ t w 1 w w 1 the parameter w in eq 3 which represents other factors is still constant and cannot capture the time varying impacts of other factors at the annual time scale previous studies have related temperature precipitation and human water consumption to parameter w jiang et al 2015 zhang et al 2019 liu et al 2017 introduced a dynamic parameter w in budyko framework therefore two time varying budyko type equations are used in this study to solve this problem the parameter w t is considered as a time variant parameter depending on time t rather than a constant the linear and quadratic equations of variable w t with time t are considered in this study 4 r t p t φ t 1 φ t w t 1 w t 5 w t m a x α β 1 t 1 6 w t m a x α β 1 t β 2 t 2 1 where t is the time step which is equal to 1 in the first year and the number of years in the last year α is the intercept and β β 1 β 2 are the regression coefficients of time in fu s equation the parameter w t must be larger than 1 therefore we use a maximum function to assure the domain of parameter w t in this paper fu s equation with a constant parameter w is termed the constant budyko type equation cbe in contrast the equations with time varying parameter w t using eqs 5 and 6 are termed the linear time varying budyko type equation l tvbe and quadratic time varying budyko type equation q tvbe respectively 2 2 modeling climatic variables in the context of fu s equation the temporal variations in parameter w t have been quantified by the time varying budyko type equations then the long term trends in observed precipitation p obs t and potential evapotranspiration e p o b s t are described using the following two functions 7 p obs t f p t β p e p 8 e p o b s t f ep t β e p e ep where f p and f ep are the functions used for modeling long term changes in precipitation and potential evapotranspiration t is time β p and β e p are parameters that are estimated using maximum likelihood estimation and e p and e ep are the error terms which are assumed to be normally distributed linear quadratic cubic exponential and logarithmic equations are compared for the functions f p and f ep using the bayesian information criterion bic in this case linear and quadratic function have the best performance based on bic for most regions meanwhile other functions don t have significant advantage over linear and quadratic functions in the remaining regions we only use linear and quadratic functions to fit precipitation and potential evapotranspiration in this case to avoid over fitting then the fitted climate variables p t and e p t are defined to represent the long term trends of precipitation and potential evapotranspiration 9 p t f p t β p 10 e p t f ep t β e p hereafter the fitted values p t and e p t are used to quantify the impact of climate change we did not use the observed precipitation and potential evapotranspiration because the observed climatic variables include some random errors e p and e ep which may result in large uncertainty when analyzing the annual impacts the objective of fitting climatic variables is to better reduce natural variations and represent the nonstationary long term impacts of climatic variables selecting time as an explanatory variable has been commonly used in similar studies of nonstationary frequency analysis aghakouchak et al 2013 cunderlik et al 2007 gu et al 2017 um et al 2017 villarini et al 2009 as a result the long term trends of precipitation and potential evapotranspiration are modeled by the fitting functions f p and f ep 2 3 decomposition method using a catchment no 01064500 name saco river near conway new hampshire location was shown in fig 2 as an example the interannual variations in pairs e p t p t e t p t and the budyko curves w t from 1952 to 2001 have been described in fig 1 a then the method proposed by wang and hejazi 2011 was used to separate the impacts of aridity index and other factors on annual runoff a schematic figure clarifying the decomposition method for quantifying the impacts of aridity index and other factors from year t 1 to year t is plotted in fig 1 b point a e p t 1 p t 1 e t 1 p t 1 represents the hydrometeorological condition in the year t 1 when the parameter in the budyko type equation is w t 1 point c e p t p t e t p t represents the hydrometeorological condition in the year t when the parameter in the budyko type equation is w t the shift from point a to point c was decomposed into two parts first the shift from point a to point b which is caused by the changes in the aridity index e p t 1 p t 1 to e p t p t with the constant parameter of w t 1 and second the vertical shift from point b to point c which is caused by the changes in the budyko curve w t 1 to w t with a constant aridity index of e p t p t accordingly the shift in runoff from year t 1 to year t i e δ r t is divided into two parts the first is the impacts of aridity index δ a t which is attributed to the changes in aridity indexes i e point a to point b in fig 1 b and is expressed as follows 11 δ a t p t φ t 1 φ t w t 1 1 w t 1 p t 1 φ t 1 1 φ t 1 w t 1 1 w t 1 the second is the impacts of other factors δ o t which is attributed to the changes in the budyko type curves i e point b to point c in fig 1 b and is expressed as follows 12 δ o t p t φ t 1 φ t w t 1 w t p t φ t 1 φ t w t 1 1 w t 1 where δ a t and δ o t are the annual impacts of aridity index and other factors from year t 1 to year t respectively however the annual impacts only concentrate on individual years and ignore the prior impacts as a result the cumulative effects of aridity a a t and other factors a o t from the start year t 0 to year t were defined in this study as follows 13 a a t i t 0 1 t δ a i 14 a o t i t 0 1 t δ o i the cumulative impacts can express the impacts from the starting year of data to the present and better illustrate the overall impacts compared with individual impacts δ a t and δ o t hereafter we mainly use the cumulative impacts a a t and a o t to represent the impacts of aridity index and other factors respectively 2 4 impacts between two periods of multiple years the present budyko based method in this study quantifies the impacts of aridity index and other factors over an annual timescale previous methods based on the budyko equations in contrast quantified the impacts between two periods of multiple years patterson et al 2013 roderick and farquhar 2011 wang and hejazi 2011 wu et al 2017a here the relationship between annual impacts and impacts of two periods of multiple years are derived for comparison we assumed data spanning from the start year t 0 to the end year t 2 the change point of the data is year t 1 which divides the data into pre and postchange periods the runoff in year t equals to the runoff in the starting year r t 0 plus the cumulative impacts of aridity index and other factors a a t a o t 15 r t r t 0 a a t a o t then the mean annual runoff in the prechange period r pre and postchange period r post are as follows 16 r pre i t 0 t 1 r i t 1 t 0 1 r t 0 r t 0 a a t 0 1 a o t 0 1 r t 0 a a t 1 a o t 1 t 1 t 0 1 r t 0 i t 0 1 t 1 a a i i t 0 1 t 1 a o i t 1 t 0 1 17 r post i t 1 1 t 2 r i t 2 t 1 r t 0 a a t 1 1 a o t 1 1 r t 0 a a t 1 2 a o t 1 2 r t 0 a a t 2 a o t 2 t 2 t 1 r t 0 i t 1 1 t 2 a a i i t 1 1 t 2 a o i t 2 t 1 the difference in runoff between the pre and postchange periods r diff is as follows 18 r diff r post r pre i t 1 1 t 2 a a i i t 1 1 t 2 a o i t 2 t 1 i t 0 1 t 1 a a i i t 0 1 t 1 a o i t 1 t 0 1 i t 1 1 t 2 a a i t 2 t 1 i t 0 1 t 1 a a i t 1 t 0 1 i t 1 1 t 2 a o i t 2 t 1 i t 0 1 t 1 a o i t 1 t 0 1 where the first and second terms on the right side of eq 18 are the contributions of aridity index and other factors on r diff respectively which are also equal to the impacts between the pre and postchange periods 3 study areas and data in this study 355 catchments out of 438 catchments in the united states were used to analyze the impacts of aridity and other factors on runoff from the model parameter estimation experiment dataset mopex duan et al 2006 which has been used in many previous studies berghuijs and woods 2016 greve et al 2015 the dataset and some specific information are available online www nws noaa gov oh mopex mo datasets html the runoff precipitation and potential evapotranspiration in these catchments are measured in millimeters daily time series are all available for up to 54 years 1948 to 2001 the potential evaporation was estimated based on noaa freewater evaporation atlas which were derived by analysis of evaporation pan farnsworth and thompson 1983 and penman method eighty three catchments were excluded because they had less than 20 years of available data the locations gauge numbers and length of data of the 355 streamflow gauges of the catchments are shown in fig 2 and table s1 the mann kendall m k test was used to detect the trend in annual runoff at the 0 05 significance level the results are shown in fig 2 approximately 53 187 out of 355 catchments of the catchments have significant increasing runoff and another 8 27 out of 355 catchments of the catchments have significant decreasing runoff the catchments with significant increasing runoff are mainly located in the central and eastern united states the catchments with significant decreasing runoff in contrast are mainly located in the northwestern united states in summary the runoff in 61 of the catchments 214 out of 355 catchments have significant trends at the 0 05 level of significance indicating that the nonstationarity of annual runoff in the study catchments is very common 4 results 4 1 validity of the time varying budyko type equations the nash sutcliffe model efficiency coefficient nse nash and sutcliffe 1970 was used to test whether the tvbe is appropriate for 355 catchments in the united states the nse is calculated as follows 19 n s e 1 t 1 n r obs t r sim t 2 t 1 n r obs t r obs 2 where r obs t and r sim t are the observed and simulated runoff at time t respectively and r obs is the mean of observed runoff the spatial distributions of the nse of cbe l tvbe and q tvbe are shown in fig 3 the histogram of the nse for catchments with significant decreasing increasing and no trends of runoff are shown in fig 4 the time varying budyko type equation exhibits much better performance than the constant equations especially for some catchments with significant trends of runoff for the central united states where runoff has a significant increasing trend the nse using cbe ranges from 0 6 to 0 8 the use of the time varying budyko type equations makes the nse increase by approximately 0 2 for eastern regions where the runoff does not have a significant trend the time varying method also improves the results by approximately 0 1 two time varying budyko type equations were used in this study l tvbe and q tvbe the nse of q tvbe was slightly better than that of l tvbe then q tvbe was used for subsequent analysis because the main objective of this study is to understand the reasons for the nonstationarity in annual runoff 4 2 comparison with previous studies the results derived from the budyko based method were compared with the previous study by wang and hejazi 2011 to illustrate the robustness of the results only catchments where the nse are larger than 0 5 were used to quantify the impacts because nse 0 5 indicates that the results may not be reliable the temporal variations in the parameter w of the budyko type equations were quantified by q tvbe due to its superior performance the year 1970 was set as the change point of runoff because some studies have shown that precipitation increases at this point krakauer and fung 2008 mccabe and wolock 2002 small et al 2006 and we wanted to keep the steps consistent with those in the study by wang and hejazi 2011 the decomposition results from the present budyko based method are shown in fig 5 a b the results show that aridity index has caused runoff to increase in most catchments other factors on the other hand did not have a uniform influence on runoff the runoff in nearly half of the catchments was reduced because of other factors the differences between the current method and the previous method by wang and hejazi 2011 are presented in fig 5 c d the difference ranges from 35 mm to 10 mm accounting for 14 to 4 of the mean annual runoff demonstrating that the current decomposition results are reliable although the difference in a small part of the catchments is still large the overall spatial patterns of the impacts are very similar 4 3 cumulative influence the cumulative impacts of aridity index and other factors in the catchments with significant decreasing trends no trends and significant increasing trends of runoff are shown in fig 6 for the catchments with significant decreasing trends of runoff in fig 6 a b the impacts of aridity index mainly occurred from approximately 1960 to 1995 the impacts reached positive values in approximately 2000 in contrast the impacts of other factors are negative and consistently decrease in most catchments demonstrating that other factors have caused the runoff to constantly decrease thus we can infer that the significant decreasing trend of runoff may be attributed to the impacts of other factors for the catchments without any trends of runoff in fig 6 c d the impacts of aridity index became large in the 1960s after 1970 the impacts decreased this is in accord with some studies about the trends of precipitation and runoff in the united states krakauer and fung 2008 mccabe and wolock 2002 small et al 2006 in 2001 the impacts of aridity index were positive in most regions other factors have a smaller and more constant influence on runoff compared with climate change the most dramatic changes in the impacts of other factors occurred between 1970 and 1985 for the catchments with significant increasing trends of runoff in fig 6 e f the cumulative impacts of aridity index have an increasing trend before 1965 there are some regions where aridity index caused the runoff to decrease since then the cumulative impacts of aridity index have continued to increase in 2001 all values were positive the impacts of other factors have a slight increasing trend as well and are smaller and smoother we can conclude that the joint influence of aridity index and other factors led to the increasing trend of runoff in summary the temporal patterns of the impacts of aridity index are homogenous in the united states the runoff increased because of aridity index in most catchments other factors on the other hand are heterogeneous across catchments other factors are the main reasons causing the runoff to decrease significantly and are part of the causes of the increasing trend 5 discussions in this study a budyko based framework was proposed to quantify the annual impacts of aridity index and other factors on runoff the decomposition method in this study was developed from the previous method by wang and hejazi 2011 the accordance between the current method and the previous method can be partly predicted from their similar decomposition procedures the main advantage of the present method is that it not only agrees with the results of the previous method but also provides information about annual variations in budyko framework the results may help us to better understand the response of hydrologic cycles in the anthropocene biermann 2012 lewis and maslin 2015 in addition the budyko type equations used in the present framework are time varying equations which have larger nses compared with those of the constant equations therefore it is inferred that the results of the improved method are more reliable because of its better modeling capability the discrepancies between the current method and the previous method by wang and hejazi 2011 may be explained by the following two factors 1 the improved method uses the time varying budyko type equations to describe the variations in the catchment properties in contrast the previous method fit constant budyko equations for the pre and postchange periods respectively different types of budyko type equations may result in differences in the findings 2 the precipitation and potential evapotranspiration in the improved method were represented by the fitting functions to describe the long term trend the previous method used only the mean of observed values in the pre and postchange periods the results of this study show that the changes in aridity index has caused runoff to increase in recent years the results about aridity index are consistent with previous studies about the trend of precipitation the increase in temperature enhances the water holding capacity of the atmosphere and results in severe and frequent precipitation alfieri et al 2015 min et al 2011 the runoff as a result of precipitation may increase accordingly yin et al 2018 some coupled model intercomparison project phase 5 cmip5 models also predict increased runoff with respect to climate change greve et al 2017 milly and dunne 2017 other factors on the other hand including human activities vegetation land use among others have heterogeneous impacts on runoff in the northwestern united states where the runoff has a significant decreasing trend other factors have caused the runoff to decrease and are the main reasons for the decreasing trend of runoff in other regions of the united states the impacts of other factors are smaller than those of aridity index and partly caused the increasing trend of runoff current studies about the separation of impacts of aridity index and other factors at the annual time scale are still rare the main difficulty we faced is the quantification of the annual variations in catchment properties and climatic variables in this study two time varying budyko type equations i e l tvbe and q tvbe were used to quantify the variations in catchment properties and two modeling functions i e eqs 7 and 8 were used to describe the long term trend of the climatic variable however some problems still exist and deserve further investigation 1 the time varying budyko type equations in this study only use time as an explanatory variable and obtain an appropriate improvement in the modeling capability the advantage of selecting time as an explanatory variable is that it is a relatively simple method and does not require extra data inputs however this process does not have enough physical basis the robustness and reliability of this method deserve further investigation selecting other physically based time varying variables such as the percentage of vegetation cover population density and proportion of irrigated land may be a better solution to account for the variations in the budyko type equations jiang et al 2015 zhang et al 2019 2 two modeling functions were used to describe the long term trend of climatic variables the main objective of fitting long term trends is to eliminate the impacts of random variation and preserve the long term influence of climatic variables other long term models using large scale climate indexes such as the north atlantic oscillation nao the interdecadal pacific oscillation ipo the atlantic multidecadal oscillation amo and the pacific decadal oscillation pdo may be more appropriate methods for analyzing the impacts of climate change however these large scale climate indexes may also include some natural variations how to separate natural climate variation and anthropogenic climate variation is a critical issue in analyzing the annual impacts of climate change armal et al 2018 3 accurate description of potential and actual evapotranspiration is another critical issue in budyko based framework penman monteith equation and pan evaporation are two main methods estimating potential evaporation however increasing carbon dioxide drives partial stomatal closure and consequently indirectly decrease evapotranspiration field and jackson rbmooney 2010 traditional methods estimating evapotranspiration may not accurate any more yang et al 2019 proposed an improved penman monteith equation with the influence of carbon dioxide and got physically based vegetation response to carbon dioxide therefore incorporating increasing carbon dioxide into the budyko framework is a challenge and promising direction 6 conclusions in this study a budyko based framework was proposed to quantify the impacts of aridity index and other factors on annual runoff the time varying budyko type equations and two modeling functions were used to model the annual variations in catchment properties and climatic variables respectively then a decomposition method was used on annual time scales to quantify the annual impacts of aridity index and other factors the main conclusions are as follows 1 time varying budyko type equations improve the fitting capability for most regions of the united states especially for some catchments with significant runoff trends the time varying budyko type equations with linear functions have similar results compared with those of models using quadratic functions 2 the improved framework in this study quantifies the annual impacts of aridity index and other factors in the us and the results obtained are in accord with the previous method aridity index has a spatially uniform influence causing runoff to increase in many catchments in the us while the impacts of other factors are heterogeneous other factors have caused runoff to significantly decrease in the catchments where runoff has displayed significant decreasing trends at the same time other factors also partly caused runoff to increase in some regions with significant increasing runoff trends credit authorship contribution statement xu zhang conceptualization methodology writing original draft qianjin dong funding acquisition writing review editing visualization investigation lei cheng writing review editing supervision jun xia writing review editing validation supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors declare no conflict of interest this work is financially supported by the national natural science foundation of china grant nos 51979198 51439007 the model parameter estimation experiment dataset is available on noaa s national weather service website www nws noaa gov oh mopex mo datasets html appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2019 124224 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 supplementary data 2 
6092,in this paper point prediction and prediction intervals pis of artificial neural network ann based downscaling for mean monthly precipitation and temperature of two stations tabriz and ardabil in north west of iran were evaluated using general circulation models gcms pis were constructed by novel upper lower bound estimation lube method in which an ann with two outputs was constructed for estimating the prediction bounds also bootstrap method as a classic technique for assessing uncertainty of ann was used to further examine the proposed lube method in this way the accuracy of pis was quantified by coverage and width criteria three gcms can esm2 bnu esm inm cm4 and ensemble gcm ensemble of mentioned models were used in four grid points around each of station for evaluating ann based downscaling of precipitation and temperature parameters comparison between the results of two methods indicated that lube method could lead to more reliable results than the bootstrap method pis width and coverage probability were 10 40 lower and 2 10 higher than the bootstrap method for different gcms respectively ensemble gcm led to more accurate results so that computed pis width and coverage probability were 10 60 lower and 2 20 higher than those for the single gcms keywords general circulation models downscaling prediction interval artificial neural network 1 introduction thegeneral circulation models gcms as climate models are employed to forecast the atmospheric conditions understand the weather and forecast climate change there are some studies focus on the impact of the climate change on the atmospheric variables over the world e g see mcsweeney et al 2015 campozano et al 2016 osman and abdellatif 2016 ranjbar et al 2018 liu et al 2019 in addition there are some studies assess the impact of climate change on the temperature and precipitation in middle east countries in alotaibi et al 2018 various gcms and data driven models were applied to study changes in temperature and precipitation of qassim region in saudi arabia results in this study showed that the temperature may be increased in the region and rainfall will differ over various spans of the future in okkan 2015 the impact of climate change on monthly precipitation of tahtali watershed in turkey was investigated it was concluded that precipitation is decreased around 12 4 during the period between 2020 and 2039 10 0 during the period between 2040 and 2059 and 18 3 during the period between 2080 and 2099 and statistically significant changes during the periods 2001 2019 and 2060 2079 okkan and kirdemir 2016 downscaled the monthly precipitation for gediz basin in turkey and used several gcms and the obtained results showed a decrease trend for precipitation with different intensities in different scenarios despite the gcms trustworthy provision of atmospheric data the coarse spatial resolution of gcms causes weak application in local scale modeling therefore an appropriate downscaling approach should be used to access local scale weather data from large scale gcms wilby and wigley 1997 in order to project local climate change it is essential to interpret the coarse scale gcms and reanalysis output to finer spatial scale by dynamical or statistical downscaling methods in dynamical downscaling a regional climate model is attained by gcm boundary conditions and solving equations of motion and thermodynamics danandeh mehr and kahya 2016 although these models have the ability to develop climate variables the process consists of uncertainty in parameterization of sub grid scale processes with higher computational costs whereas statistical downscaling discovers relationships between local climate variable and gcms independent of any information about the physics of the process sailor and li 1999 olsson et al 2004 harpham and wilby 2005 chen and adams 2006 sousa et al 2007 spak et al 2007 beecham et al 2014 however there are assumptions for statistical downscaling e g as statistical downscaling serves black box modeling tools so the calibrated model can t be similarly used in other regions also there should be data from a regional station and for downscaling in addition developing a statistical downscaling model for finer time scales such as daily or hourly often becomes a challenging task due to high memory requirements and slow convergence associated with modeling large data sets şen 2010 artificial neural network ann is a black box model with the ability to extract complicated relations between predictor and predictand variables and simulate the nonlinear and time varying features of the atmospheric variables at various scales e g monthly daily hourly could lead to prevalent use of ann in gcm data downscaling e g see wilby and wigley 1997 dibike and coulibaly 2006 fistikoglu and okkan 2010 okkan and fistikoglu 2014 okkan and inan 2015 okkan and kirdemir 2016 although there are intensive applications of ann for downscaling of gcms data point estimation prediction of targets by ann conveys no information about the sampling error prediction accuracy and uncertainty of the model with this regard some studies already examined the uncertainty and reliability of ann based gcm downscaling procedure focusing on the confidence intervals cis e g khan et al 2006 samadi et al 2013 prediction intervals pis and cis are two prevalent measures for assessment of prediction forecast uncertainty cis correspond to the accuracy of the prediction of the regression i e the mean of the target probability distribution whereas pis assimilate the accuracy of the predicted values versus the measured values heskes 1997 khosravi et al 2011b confidence interval ci corresponds to the modeling uncertainty which can be classified into different forms based on the variability arises from model inputs parameters and structures which combine together contributes in producing the prediction uncertainty pis correspond to the accuracy of the prediction of targets instead of estimating the true model therefore pis are included more sources of the uncertainty and are wider than cis and as so are more beneficial from practical aspect since the constructed upper and lower bounds of pi are capable of capturing exact observed values shrivastava et al 2015 decision makers should provide design plan to manage critical issues due to climate change with this regard in prediction intervals by considering uncertainties a bound is obtained that is essential in decision making management and design optimistic and pessimistic decision making can be considered by prediction intervals if we have the bounds in the case that the problem is critical so pessimistic decision making is applied and upper bound will be the bases of planning but it may not be economical however in the case that optimistic decision making is considered the lower bound will be the bases of planning but with a bit high risk on the other hand for the climate change used gcms contain various sources of uncertainty which are associated with gcms data scenarios and physical rules of gcms and these uncertainties affect the predictions for future in climate change studies while using gcms by applying point prediction for future designing can be uneconomical or may be critical conditions won t be considered in this study these uncertainties have been handled using multi gcms and also estimating the prediction intervals instead of point prediction which can represent such uncertainties therefore in climate studies when applying gcms while having pi there will be more alternatives for designing some classic techniques are usually used to construct the pis for ann methods such as delta bayesian mean variance estimation and bootstrap techniques the delta technique employs the standard asymptotic theory for constructing the pis chryssolouris et al 1996 hwang and ding 1997 in this technique the intervals are constructed under the assumption that the noise is homogeneous and normally distributed which is the main limitation of this technique the bayesian technique is on the basis of the bayesian statistics to express the uncertainty of the network weights in terms of probability distributions and integrates them to obtain the probability distribution of the target conditions the bayesian approach requires time consuming monte carlo integration overweight space in multi dimensional real world applications mackay 1992 the mean variance estimation based method also assumes that errors are normally distributed around the true mean of targets therefore pis can easily be constructed if the parameters of this distribution mean and variance are known the dependence of the target variance on the set of inputs is the basic assumption and of course the main limitation of this method nix and weigend 1994 on the other hand the bootstrap technique neither requires the complex computations of derivatives and hessian matrix inversion involved in the delta method nor the montre carlo solutions of the integrals involved in the bayesian approach dybowski and roberts 2001 therefore this simple method has been widely used in several hydro climatologic studies e g dibike et al 2008 samadi et al 2013 in this study lower upper bound estimation lube method which was firstly introduced by khosravi et al 2010 and is a novel pis construction method in hydro climatologic issues is applied to construct pis for ann based downscaling of monthly precipitation and temperature parameters at tabriz and ardabil stations located in northwest of iran in the lube method an ann with two output neurons representing upper and lower bounds of the estimation is trained the coverage probability of lube is better than other methods and it can effectively establish trade off between the correctness and informativeness of pis khosravi et al 2011a moreover the required time for pis construction is remarkably smaller than other methods quan et al 2014 in this way three gcms and their ensemble are used and the obtained results by lube are compared with those obtained by the bootstrap method although in some studies different methods have been already used to construct pis of ann methods in hydrological modeling e g srivastav et al 2007 kasiviswanathan et al 2013 kasiviswanathan and sudheer 2016 kumar et al 2015 to the best of authors knowledge as a novel application of lube method in the hydro climatic issues this is the first study to model pis of ann based gcm data downscaling 2 materials and methods 2 1 proposed methodology in the proposed modeling dominant atmospheric parameters related to the precipitation and temperature of both stations were distinguished using the mi measure thereafter point predictions by ann method and then pis of ann based downscaling were constructed and evaluated by both lube and bootstrap methods using available data finally point and interval predictions for future 2020 2055 values of precipitation and temperature were estimated for both stations under rcp8 5 climate change scenario in the following sub sections the components of the proposed methodology are described in details 2 1 1 study area and used data in this study the modeling was applied to the data from two stations tabriz and ardabil to have a comparison about the performance of the proposed methodology over different case studies tabriz latitude 38 07 n longitude 46 14 e and elevation 1364 m and ardabil latitude 38 22 n longitude 48 30 e and elevation 1332 m are located in the north west of iran see fig 1 ardabil is located on the slopes of the sabalan mountain the average annual minimum and maximum temperatures are 2 c and 19 c in january and july respectively total annual precipitation is about 361 2 mm the relative humidity in the region is about 73 and 48 in december and june respectively tabriz located in the quru river valley between long ridges of volcanic cones in the sahand and eynali mountains the valley opens up into a plain that gently slopes down to the eastern shores oflake urmia 60 km to the west average annual minimum and maximum temperatures are 2 c and 26 c in january and july respectively total annual precipitation is about 280 mm the relative humidity values in the region are about 72 and 36 in january and july respectively for eliciting local scale station data from large scale gcm data the mean monthly observed precipitation and temperature time series were obtained from the iran meteorological office for the periods of 1951 2012 and 1976 2012 for tabriz and ardabil stations respectively the gcm data under the ipcc ar5 cmip5 ipcc assessment report 5 and coupled model intercomparison project data sets for historical past data from the ipcc data distribution center http cera www dkrz de and future simulations under the representative concentration pathways rcp8 5 for the duration of 2020 2055 were retrieved the predictors were extracted from three gcms including can esm2 inm cm4 bnu esm respectively from research centers of canada russia and china with mean monthly atmospheric variables see table 1 according to the previous studies for the region which examined several gcms and concluded that these gcms can lead to better outcomes see nourani et al 2018b hosseini baghanam et al 2018 since some previous studies have shown better performance when using data from multiple grid points around the study area frost et al 2011 guo et al 2012 beecham et al 2014 predictors from four grid points around each study station were considered in the modeling procedure as two stations have the same latitude hence six grid points were used totally which are surrounding the two stations for applied gcms see fig 1 points a1 to a6 and b1 to b6 for bnu esm can esm2 and inm cm4 respectively accessible predictors for applied gcms were tabulated in table 1 the number of applied large scale atmospheric predictors at each grid point which are potential predictors input were 95 for bnu esm and inm cm4 models and 120 for can esm2 model therefore 1240 predictors are the candidate for input of considered gcms for the downscaling model of each parameter if the method of trial and error will be used to select dominant inputs 2 1240 1 tests are required which is a time consuming input selection process therefore nonlinear mi measure between candidate inputs and target yang et al 2000 was used in this study to select dominant inputs of ann based downscaling models since the parameters are in different orders of magnitude and units all were firstly normalized 2 1 2 artificial neural network based downscaling the anns have been used for downscaling the hydro climatologic parameters using gcm data an ann may be explained as a network of interconnected neurons the common structure of the ann consists of three layers the first layer that contains the input variables is the input layer and the last layer relevant to the output variable is called the output layer the layers between the input and output layers are the hidden layers neurons that connect the layers reforced by weights the optimal set of weights is determined through the learning process the learning process consists of known input and output values which train the network while finding the known output set using a known input set the best weights are calculated among the applied neural networks the feed forward neural network fnn with the back propagation bp training algorithm is the most commonly used method in solving different engineering problems nourani and kalantari 2010 sharghi et al 2018 sharghi et al 2019 a three layer fnn bp network model trained using the levenberg marquardt optimization algorithm haykin 1994 was chosen for this study three layered fnns are based on a linear combination of the input variables which are transformed by a nonlinear activation function implement of ann influenced by multiple factors including i predictors selection п number of hidden neurons network structure and ш specified training algorithm for connecting weights according to the network structure issues the poor performance in training may be due to the inadequate number of hidden neurons but exceeding number of hidden neurons may lead to overtraining and additional training time trial and error is the commonly used method to obtain optimal number of hidden neurons the scope of an optimal ann architecture is to minimize the error between simulated output and the desired value with the most compact and simple structure huge and redundant data appropriately selecting gcms and grid points also predictors are of main significance in any gcms downscaling method for a particular area lee 2017 some researchers have confirmed the improvement in the performance of data driven models via input data screening ahmadi and han 2013 ahmadi et al 2015 hosseini baghanam et al 2018 nourani et al 2018a nourani et al 2018b non linear mi measure was applied in the current study to determine the dominant inputs among the potential inputs from surrounding points of different gcms for the study stations although several previous studies used correlation coefficient cc to select inputs for black box models such as the ann model devak and dhanya 2016 it has been criticized by nourani et al 2015 which for modeling non linear processes via non linear models it is possible to have a weak linear relation between inputs and output but a strong non linear relation therefore it is suggested to use a non linear measure for non linear ann based modeling in order to select the most dominant inputs for the ann models among huge numbers of available potential variables i e here 1240 nonlinear mutual information mi measure was used in this study entropy or information content is a statistical measure of the randomness or uncertainty in terms of probability distribution it has been introduced as a measurement criterion of disorder turbulence and uncertainty in general the theory of shannon information content is used in the discrete or continuous form based on the data and problem nature regarding the fact that the data used in this paper are discrete the mi of tworandom variables is a measure of the mutual dependencebetween two variables high value of mi indicates a large reduction in uncertainty low mi indicates a small reduction and zero mi between two random variables means that the variables are independent mi between two random variables of x and y is defined as yang et al 2000 1 m i x y h x h y h x y where h x and h y are the entropies of x and y respectively the entropy for random variable x with length of n with values x1 x2 xn and the corresponding probabilities p1 p2 pn can be computed as shannon 1948 2 h x i 1 n p x i l o g p x i in eq 1 h x y is the joint entropy of x and y which can be calculated by gao 2008 h x y i 1 n i 1 n p x i y i l o g p x i y i 3 mi was applied between the predictors gcm variables and predictands i e precipitation and temperature to sort out the relationships between inputs and outputs for the numerical calculation of mi and h using eqs 1 3 probability density function pdf for all of the variables should be specified histogram method is the most common method of pdf calculating by application of this methodology the sample space is divided into n bins each with δx or δy interval according to eq 1 we need entropy and according to eq in order to compute entropy we need to compute pdf probability density function of each parameter which in this case bin size is important and can affect the mi values but maybe mi values are changed but it should be noted that the rank of parameters based on mi will be the same because the bin size for all parameters kept fix and it affects the results equally so dominant parameters were selected according to the mi rank it should be noticed that in contrast to the correlation coefficient mi is used to measure the nonlinear dependency with parameters in which linearity can be considered as a special case of such nonlinearity so if nonlinear relationship can be detected similarly the linearly relationship can also be detected if the inputs are dependent these inputs are useless and less effective in the modeling consequently mi was used in this study and it was measured between various parameters therefore selected dominant inputs were independent without collinearity for the purpose of assessing efficiency of downscaling and point predictions by ann criteria of root mean square error rmse eq 7 nash sutcliffe efficiency nse eq 8 and cc eq 9 were used in this study the nse ranges from to 1 an efficiency of 1 shows proper adjustment of downscaled model output to the predictand while efficiency of 0 expresses that the model predictions have the same accuracy as the mean of the predictand and an efficiency less than zero means the observed mean has better prediction than the model the rmse corresponds to adaptation between measured and simulated data which is the sample standard deviation of the differences between predictor and predictand it ranges between 0 and whereas with reduction in rmse the efficiency is improved the range of values for the cc bounded by 1 to 1 the cc of 1 shows a perfect negative correlation while a cc of 1 shows a perfectpositive correlation a correlation of 0 shows no relationship between the two variables 7 rmse i 1 n r i z i 2 n 8 nse 1 i 1 n r i z i 2 i 1 n r i r 2 9 cc r i r z i z r i r 2 z i z 2 in eqs 7 9 ri and zi are predictand and observations respectively r and z are means of predictand and observations and finally n is the total number of observations 2 1 3 concepts of pis the uncertainty associated with models includes both modeling and prediction uncertainties modeling uncertainty is due to inappropriate fit of the model to the target the modeling uncertainty can be due to the model inputs parameters and structures which in combine contributes in producing the prediction uncertainty the input uncertainty is mainly due to instrument measurement and sampling error the parameter uncertainty consists of incapability to recognize a parameter set which can lead to the best performance of the model the simplification insufficiency in the explanation of real world process through mathematical equation lead to model structure uncertainty shrestha and solomatine 2008 the prediction uncertainty drives from typical of random phenomena and is intrinsic in the data series used for the modeling morgan et al 1990 krupnick et al 2006 cis and pis are most commonly used statistical measures for quantifying the uncertainty of prediction by a model for a set of n data samples x i t i i 1 n a model can be written as heskes 1997 4 t i f x i w e i xi is a sample of the input space ti is the observed target and f with the actual parameter set w is the non linear function representing the true underlying function model and ei is the error with zero mean the approximate model f xi w is the mean of the distribution of the targets where the estimated parameters set w can be determined using a machine learning technique access to accurate prediction of true model is the main purpose of the point prediction however some indicators are essential to quantification the prediction with this regard cis corresponds to estimation of true model and is calculated by 5 ci f x i w f x i w on the other hand pis correspond to precision of prediction of targets and can be calculated as 6 pi t i f x i w f x i w f x i w e i pis deal with the uncertainty in the prediction of a future realization of a random variable and account for more sources of the uncertainty model misspecification and noise variance and is wider than ci and therefore was considered in this study as the measure of prediction uncertainty two measures for the quantitative assessment of constructed pis are pi coverage probability picp and mean pi width mpiw picp measures the percentage of observed values that fall within the prediction band if the width of prediction band is wider it covers most of the observed values the more picp is closer to its nominal value the more reliable it is picp as eq 10 is the measure that shows how good the pis are khosravi et al 2010 kasiviswanathan et al 2013 10 picp 1 n i 1 n c i i f l x i x i u x i c i 1 e l s e c i 0 where u xi and l xi represent respectively the upper and lower bounds of pis corresponding to the i th sample the ideal value of picp could be gained if the upper and lower bounds of pis had extremely large values actually too wide pis are not valuable because pis carry no report around the observed values therefore additional criterion should be used for quantification of the width of prediction bounds as khosravi et al 2011a 11 mpiw 1 n i 1 n l x i u x i finally after calculation of pis width in order to compare obtained pis by various techniques normalization is required for the value of mpiw in the form of 12 nmpiw mpiw r where r is the range of the underlying target nmpiw is a dimensionless measure indicating how narrow pis are considering these two measures nmpiw and picp independently may not drive to accurate results because they have the contrary relationship therefore both measures should be simultaneously evaluated in the procedure of pis construction the structure of ann with two outputs for estimating upper and lower bounds of pis via lube method is shown by fig 2 the first output corresponds to the upper bound and the second stands for the lower bound steps of the proposed lube method and training ann with two outputs to construct pis are summarized in fig 3 at first step data set is split into training and validation sub sets then an ann with two outputs optionally for initial values of outputs 5 of observed values can be considered to train ann and find initial guesses for the weights then weights are randomly perturbed around the initial weights to generate some new weight sets dhanesh and sudheer 2011 have reported that ann weights are sensitive in a range of 10 from the calibrated values therefore some new anns with the several sets of perturbed weights in the range of 10 around initialized weights are created and anns are simulated with these weight sets to obtain different sets of pis the numbers of generated sets of weights depend on the number of hidden neurons were considered in the range of 700 1200 in this study the pis set which leads to the highest picp and lowest nmpil values is finally considered as the final result see fig 3 for networks evaluation first the picp were assessed in case that picp value is lower than considered 1 α in this study α was considered as 0 1 confidence level equivalent network is rejected as its coverage probability is very low if picp is around or above 1 α in this study α was considered as 0 1 the nmpil is compared with nmpil of the already considered optimal network if it is lower optimal network is replaced by the new network this procedure continues until all networks are checked efron and tibshirani 1993 developed bootstrap method which resamples the training datasets for the purpose of generating various models by training an individual network on each resampled instance of the original dataset see fig 4 this technique develops new sets of samples to present appropriate comprehension about the mean and variability of main sample independent of any knowledge about data distribution bootstrap is a simplified approach for quantification the uncertainty related to ann prediction srivastav et al 2007 the positive point about the application of this technique is that it does not require complex derivatives of any non linear function if random samples are bootstrapped each time from total available dataset the simple arithmetic average of prediction can be considered as the model output corresponds to the i th input data point of x this process is performed by repeated sampling with replacement of the original dataset of size n to obtain b bootstraps datasets each with a size of n therefore b neural network models are developed where each bootstrap dataset may differ slightly the mean and variance of outputs of these b networks are calculated as follows to compute pis 13 y boot x 1 b b 1 b f x i p b 14 σ boot 2 x 1 b 1 b 1 b f x i p b y boot x 2 where p b denotes to the parameter obtained from b th bootstrap sample and f denotes to the functional form of the ann model to construct pi of a prediction l u for a future observation x having normal distributionprobability of p with knownmeanandstandard derivation we will have 15 p l x u p l y boot σ boot x y boot σ boot u y boot σ boot where z x y boot σ boot the standard score of x is distributed as standard normal grant and leavenworth 1972 hence 16 l y boot σ boot z u y boot σ boot z or l y boot z σ boot u y boot z σ boot to calculate the pis the value of z in eq 16 for the distribution of pdf should be determined in which to do that the formula of the pdf must be known or assumed in which for this purpose due to simplicity and generality of the normal pdf it is usually used it is possible to use other pdfs but sometimes their application will not be straightforward as well a normal pdf different values of z correspond to different confidence levels are tabulated in table 2 3 results and discussion for evaluating the capability of the lube method to construct pis of downscaled precipitation and temperature values the dominant inputs from gcms were selected by mi measure and then classic ann with one output was trained to find point predictions then an ann with two output neurons considering 5 of observed values as the initial guess for upper and lower bounds was trained to initialize the weights of the network the perturbed values of initialized weights were used to create networks with two outputs of lower and upper bounds finally the developed networks were used to project the monthly precipitation and temperature values point predictions and related pis for the near and far futures years 2020 and 2055 the pis results were also compared with the results of the classic bootstrap method the details of the obtained results are presented in the following sub sections 3 1 point predictions by ann based downscaling method as explained in nourani et al 2018 parameters selected by mi led to better results than selected parameters by cc in order to have comparison between cc and mi measures the performance of both measures were compared for temperature and precipitation of ardabil station with bnu esm model see table 4 as shown in table 4 selected inputs via mi measure led to better results compared to the selected inputs via cc therefore mi measure was computed between target observed precipitation and temperature at stations and each atmospheric predictor from gcm in surface and various levels of the atmosphere at six grid points around the stations and the variables with higher ranges of mi in significant level of t student were selected as the inputs for the anns results of predictor selection are tabulated in table 3 according to table 3 relative humidity hur northward wind va and air temperature ta mostly show maximum mi values in three gcms with temperature based on the mi nonlinear method the pressure variables i e va humidity variable hur with nonlinear relation by station temperature were selected as the dominant predictors since change in the topography leads to pressure change and changes of weather pressure in turn affects the temperature change so the pressure variables might nonlinearly be related to the temperature of the region such nonlinear relations could be detected by mi method most selected dominant parameters which have relation with the temperature of the tabriz station is from a1 grid point as hur this may be due to the impact of the proximity of this grid point to urmia lake so its humidity have relation with the temperature another dominant parameter was va which shows the influence of wind which blowing from sahand mountains in ardabil station temperature is affected mostly by humidity variables especially in grid points a3 and b6 located in caspian sea which this sea has a significant impact on ardabil station climate also for precipitation of the tabriz station hus and hur were prominent predictors in high pressure levels this is due to mountainous and arid climate of the tabriz region and inadequate humidity sources i e large water bodies around the study area so far away water bodies like the caspian sea can be transferred in high pressure levels about precipitation of ardabil station similarly humidity variables from grid points a3 and b6 as well as ua and uas eastward wind have more impact on the precipitation values since wind transfers the humidity from seaside to the station zg is one of the effective variables in b6 grid point for precipitation of ardabil which emphasize the importance of temperature alteration on the sea therefore blowing wind to the location of the ardabil carry out the humidity to the nearby mountainous region as shown in table 3 large scale precipitation parameters were not selected as dominant inputs maybe due to the locations of the case studies e g black sea caspian sea sahand mountains where the impact of grid points e g precipitation does not reach by the study region similarly in some other studies precipitation large scale parameter was not selected as the input parameter for the downscaling e g see osman and abdellatif 2016 liu et al 2019 the selected variables were used as inputs of ann models and in this way all data were normalized because the active function which is used as a non linear kernel in ann is more sensitive to the large variations in the range of 1 to 1 or 0 to 1 for the purpose of calibration and validation the anns the data set was split into two parts 75 of the data were applied for training and the rest 25 were used for the validation purpose historical gcms data of bnu esm2 and inm cm4 are available until 2005 but can esm2 provides the data up to 2012 as so for the tabriz station calibration and validation periods were set to 1951 1991 and 1992 2005 and for the ardabil station as 1976 1997 and 1998 2005 respectively for modeling by bnu esm and inm cm4 whereas for the can esm2 model the calibration and validation periods were respectively set to 1951 1996 and 1997 2012 for tabriz station and 1976 2003 and 2004 2012 for the ardabil station a three layer ffnn with levenberg marquardt scheme of bp training algorithm and the tangent sigmoid tansig as the activation function was applied to downscale each of precipitation and temperature parameter for both stations to distinguish the optimum ann structure the epoch and hidden neuron numbers were obtained through the procedure of trial and error the best training epoch number and optimum hidden neurons number were found in the range of 100 360 and 3 12 respectively for the models see table 5 according to some previous studies e g feng et al 2010 using the ensemble of gcms instead of single gcm can usually improve the downscaling accuracy in this way for the purpose of enhancing the performance of the ann based downscaling models the ensemble of single gcms outputs were used as inputs of another ann to construct ensemble of gcms see fig 5 as another scenario of the modeling criteria of rmse nse and cc were measured for assessing the efficiency of modeling the obtained results of point prediction are tabulated in table 5 for both parameters and both stations as shown in table 5 ensemble of gcms showed better performance in comparison to the single gcms for both stations and both parameters nse for verification data for ensemble of gcm was up to 11 higher than single gcms a conceivable description is that the model ensemble receives various physical parameterizations and therefore eliminates the limitations of an overconfident single model simulation the ensemble of gcms includes features of all cooperating gcms and therefore may lead to more reliable predictions tebaldi and knutti 2007 duan and phillips 2010 pincus et al 2008 among single gcms for tabriz station bnu esm led to better performance in ann based downscaling of both temperature and precipitation parameters it can be concluded that for this station gcms with high resolutions have better efficiency but for ardabil station inm cm4 data yielded to more reliable results among single gcms for temperature but can esm data would be better for prediction of precipitation these results indicate that models with lower resolution i e inm cm4 might show better temporal performance than those with higher resolutions which is in agreement with some previous studies miao et al 2013 for both stations gcms led to better performance in temperature rather than precipitation this consequence has adaptation to previous studies sun et al 2015 ahmadalipour et al 2017 this is mainly because of the more stable and regular nature of temperature which makes it easier to predict unlike high uncertainty associated with the precipitation parameter moreover vertical air motion caused by atmospheric instabilities and air flow over orographic features effect on precipitation variation as shown in fig 6 c d the temperature was over estimated for both stations furthermore as shown in fig 6b precipitation of ardabil station was underestimated these results might be due to the unreliable performance of applied gcms in handling clouds and water vapor some researchers discovered that cmip5 models prone to underestimate the cloud cover nam et al 2012 and stratospheric water vapor fyfe et al 2013 therefore the impact of the sun in warming the planet will be overestimated in the simulating process satellite consideration recommended that gcms have neglected about weak reactions caused by clouds and water vapor christy et al 2010 therefore the carbon dioxide impact on the warming will be decreased fyfe et al 2013 comparison between the results of two stations indicates that the used gcms led to better performance for tabriz station than ardabil therefore it could be concluded that same gcms might not perform similarly for different stations due to the difference in atmosphere and position of the stations since the ann point prediction may include uncertainty and conveys no information about the accuracy of modeling it is essential to quantify the prediction bound so in the following sub section results of pis construction are provided and evaluated by criteria defined in the previous sections 3 2 constructed pis using lube and bootstrap methods the overall performance of any pis construction method for ann based modeling highly depends on the network structure and training process to generate pis of downscaling results by lube method a network was created for each parameter temperature and precipitation of tabriz and ardabil each containing two output neurons as upper and lower bounds of prediction for each sample point the optimum number of hidden neurons was determined by trial and error process examining the range of 1 to 12 neurons confidence level associated with all pis was considered as 90 α 0 1 two criteria picp eq 9 and nmpiw eq 11 were computed for each generated set of weights by perturbation of initialized weights to find out the optimum structure of ann for constructing the pis with maximum value of picp and minimum value of nmpiw the obtained optimal picp and nmpiw values in constructing the pis of precipitation and temperature parameters for tabriz and ardabil statins are presented in table 6 picp value for ensemble gcms of tabriz station was up to 20 and 10 higher than the single gcms whereas nmpiw value was up to 10 and 50 less than single gcms for temperature and precipitation respectively in comparison with different single gcms so ensemble of gcms showed better performance either in point prediction or pis construction better performance of the models ensemble compared to the single models have been already confirmed in some studies as well duan and phillips 2010 miao et al 2013 according to table 6 ensemble modeling showed more impact on narrowing prediction width than the prediction coverage in addition for ardabil station using ensemble of gcms data picp showed up to 30 and 20 higher values whereas nmpiw value was up to 20 and 20 lower than the single gcms for temperature and precipitation parameters respectively as picp and nmpiw are conflicting criteria considering the results of both measures showed that can esm2 model led to better outcome for precipitation and bnu esm for temperature of tabriz station but for ardabil station can esm2 and bnu esm got better results respectively for temperature and precipitation parameters therefore unlike point prediction gcms with high resolution may have better performance in comparison to gcms with lower resolution i e inm cm4 in constructing the pis for further evaluation of the pis values constructed by lube method the classic bootstrap method was also used to create pis and the results of both methods were compared with together in this way an ann for each parameter was trained 80 times each time modeling by randomly selected resampled 400 250 samples among 659 359 total samples respectively from data sets of tabriz and ardabil stations for can esm2 model selected resampled samples were 650 and 350 among 743 and 431 total samples respectively from data sets of tabriz and ardabil stations trained weights were then used to simulate the outputs of the ann model for all samples then for constructing pis mean and standard derivation of outputs with confidence level of 90 were applied to constructed pis bounds using eqs 13 16 and the obtained results are tabulated in table 6 again for the bootstrap method ensemble gcms approximately showed better results with regard to the single gcms as shown in table 6 for single gcms can esm2 led to better results for precipitation of tabriz and ardabil stations as shown in table 6 the constructed pis using the bootstrap method had wider width than lube method thereupon it could capture more targets leading to higher picp values even though bootstrap may lead to higher values of picp compared to lube but since pis higher values of nmpiw so the constructed pis via bootstrap method are not superior to those constructed via lube method as tabulated in table 6 constructed pis via lube method show better qualities than bootstrap method this lower performance of the bootstrap method is due to its inherent structure which randomly arranges the input data sets in most cases the bootstrap method overestimated the parameters although bootstrap mostly consists of peak points as shown in fig 6 in some cases it was unable to capture peak points this is because of training various anns with randomly selected sets of sub data therefore training sub data may not contain the statistical characteristics of the main data or maybe lack of peak points in considered sets in training anns cause inappropriate performance of the bootstrap technique compare according to eq 16 the upper and lower bounds of pis obtained via bootstrap method should be symmetric around mean value as shown in fig 6 this is true for temperature but for precipitation the lower bound values of pi below the zero were set to zero and therefore the constructed pis for the precipitation by the bootstrap method did not show a complete symmetric pattern in term of constructed pis by lube method pis were obtained directly as outputs of the ann without any prior assumption about data distribution but in the bootstrap method to construct pis it was assumed that the errors are normally distributed also the required time for construction pis by lube method is so smaller than the bootstrap method this is due to b times training of ann in the bootstrap method but for lube method the ann is trained only one time khosravi et al 2011a consequently lube method can be considered as a reliable approach for construction of pis from both quantitative and qualitative aspects of modeling as tabulated in table 6 although two criteria in some cases may have close values in most of the cases there is remarkable difference in values of picp and nmpiw of constructed pis of two methods after developing the models for point prediction and pis construction they were used for predicting the precipitation and temperature values and their pis for years 2025 and 2050 under the rcp8 5 scenario 3 3 projections of precipitation and temperature and related pis for future after training and verification of anns for point prediction and pi construction by the historical data mean monthly precipitation and temperature of two stations were predicted for near and far futures years 2020 and 2055 under rcp8 5 scenario also the results of point prediction lube and bootstrap method for the last year of historical data december 2004 to november 2005 were compared to the near and far futures dominant parameters and optimum ann structures determined in the previous steps were used for simulating precipitation and temperature values for the future the results were shown in figs 7 and 8 as shown in figs 7 and 8 in some cases the values of point prediction fall out of the pis ranges this is because the point predictions for future contain uncertainty and aren t 100 accurate so it is possible to see the point predictions sometimes fall out of the pis ranges as shown in fig 7a and according to the obtained results tabulated in table 6 for tabriz station the temperature may increase about 10 c up to 2025 compared to 2005 in winter and autumn but there will not be a remarkable change in spring and summer temperature values from 2005 until 2025 on the other hand for the ardabil station the temperature may increase in winter up to 2 c but temperature approximately remains the same in summer and spring and increase up to 7 c in autumn for year 2025 with regard to 2005 about the mean monthly precipitation of tabriz station it shows a decrease up to 88 mm and 24 mm respectively in spring and autumn but in february it approximately shows the same values with regard to the corresponding values of table 6 for the ardabil station although a 50 mm decrease is seen for spring precipitation of 2025 compared to 2005 the mean monthly precipitation does not show a remarkable change until 2025 as shown in figs 7 and 8 a comparison was done for mean monthly temperature and mean monthly precipitation values of two stations for years 2025 and 2050 the results showed that temperature of ardabil station in 2050 will increase 5 c compared to 2025 in april but approximately there will be little difference in temperature of other months in addition precipitation in january and february will be almost constant in these two years but in march the precipitation in 2050 will be increased about 120 mm compared to 2025 on the other hand in all months of autumn precipitation will be decreased up to 120 mm but for the summer the precipitation will have same values for 2025 and 2050 for the tabriz station precipitation may show remarkable decrease in february and march about 10 and 60 respectively in 2050 compared to those in 2025 this may be due to the increasing pollution density since many extremely small vapor particles were prevented to condensate caused by propagation of pollutions hence raindrops prevented from formatting in general precipitation shows overall decrease in 2050 with regard to 2025 temperature in tabriz station shows 2 c 16 increase in january but for march and october it may show up to 9 c decrease in 2050 compared with the values at 2025 for other months the temperature may have same values therefore in tabriz station precipitation and temperature would face more changes than ardabil station under considered gcms different performances of the models for these two stations may be due to their positions and their climate conditions tabriz station has mountainous climate but ardabil station has the semi humid climate moreover tabriz station as an industrial city may get more influence from the climate change scenarios in the future in the final step the optimum anns with highest picp and lowest nmpiw for construction of pis by both lube and bootstrap methods were used to estimate pis for precipitation and temperature parameters under rcp8 5 scenario for both 2020 and 2055 years moreover the obtained results were compared with constructed pis for year 2005 the results are illustrated in figs 7 and 8 also nmpiw for constructed pis are tabulated in table 7 as shown in table 7 constructed pis for most cases and both methods lube and bootstrap and parameters will increase in both 2025 and 2050 years compared to 2005 which indicates the increase of uncertainty in prediction of mentioned parameters in out coming years as shown in fig 7 temperature pis width is wider in summer than other seasons for tabriz station but for ardabil station pis have approximately constant width as shown in fig 8 for tabriz station precipitation pis are wider in winter and spring than other seasons but for ardabil station at spring pi has wider width which indicates higher uncertainty of precipitation in winter and spring as shown in figs 7 and 8 in all cases point prediction trend was similar to lube method but bootstrap showed different trends for temperature the reason for this incompatibility of bootstrap could be due to random selection of sub sets for training of ann or inappropriate number of generated samples as shown in table 7 a comparison between the constructed pis for both stations shows that for ardabil station pis for both years 2025 and 2050 methods lube and bootstrap and parameters precipitation temperature are wider than those for the tabriz station therefore uncertainty associated with prediction by the gcm data for ardabil station is higher than the tabriz station this result is linked to the point prediction results of these two stations the reason of this performance might be due to this fact that although now tabriz contains more manufactories and industries with regard to ardabil as a developing city the industrial growth rate of ardabil for future is remarkably higher than tabriz analysis of computed pis indicated that the precipitation pis for two stations and methods are wider than those for the temperature therefore the reliability of the precipitation prediction is somewhat less than temperature which congruous the complex and irregular pattern of precipitation with regard to the temperature parameter it is quite expected result in quality point of view but in this study it was tried to quantify this fact moreover it confirms the poor performance of gcms based modeling of precipitation as mentioned in point prediction performance in the previous section as shown in figs 7 and 8 for all cases lube method constructed narrower pis than bootstrap method which indicates that lube may provide more reliable pis results than bootstrap method high width of constructed pis by bootstrap method denotes to the overestimated results provided by this method comparison between constructed pis by lube method for both 2025 and 2050 years indicates that for both stations precipitation pis will decrease but temperature pis will increase in 2050 compared to 2025 as rcp8 5 scenario represents the increasing trend of temperature uncertainty associated with the temperature may be increased too but bootstrap method approximately showed same intervals for both years 4 conclusions although ann based downscaling gcm has been broadly used in prediction of climate variables point predictions by ann convey no information about prediction uncertainty in this content pi is an essential indicator for quantifying the reliability of ann based downscaling of climate parameters using gcms data in this paper ann based downscaling of temperature and precipitation variables was performed using three different gcms and ensemble gcms using the data from1950 to 2012 and from 1975 to 2012 for training the anns of tabriz and ardabil stations respectively in addition the rcp8 5 scenario was used for predicting future temperature and precipitation values for 2025 and 2055 dominant variables among several atmospheric parameters at four grid points around each station were selected by mi measure ann based downscaling using single and multi gcms data indicated that ensemble gcms could lead to more accurate results whereas can esm2 data yielded the best results among single gcms pis of ann based downscaling were constructed by lube method training an ann for each parameter with two outputs as upper and lower bounds of the prediction for quantitatively evaluating the performance of the constructed pis nmpiw and picp criteria were applied results were also compared with those from the classic bootstrap method analysis indicated that ensemble gcms could lead to more reliable results so that picp was up to 20 higher and nmpiw was up to 50 lower with regard to the single gcms it was concluded that the lube technique could build pis with low nmpiw and high picp with regard to the bootstrap method nmpiw for lube method was 10 60 less than bootstrap method consequently the lube methods superiority was derived in pis construction compared to the bootstrap method also tabriz station under applied gcms showed better performance than the ardabil station in the proposed lube method to optimize the ann network to construct pis two criteria of picp and nmpiw were considered as the objective function of optimization in order to expedite the optimization convergence and get more accurate results it is recommended to hybrid these two criteria as a cost function and use a robust metaheuristic method such as genetic algorithm particle swarm optimization to find out the optimum network the sources of uncertainty in the climatic projections can be assessed in future works and the total uncertainty can be decomposed into its main contributors e g gcms and emission scenarios using a valid statistical method such as variance decomposition sample size method declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement the resarch was conducted under a finincial grant form university of tabriz research affairs 
6092,in this paper point prediction and prediction intervals pis of artificial neural network ann based downscaling for mean monthly precipitation and temperature of two stations tabriz and ardabil in north west of iran were evaluated using general circulation models gcms pis were constructed by novel upper lower bound estimation lube method in which an ann with two outputs was constructed for estimating the prediction bounds also bootstrap method as a classic technique for assessing uncertainty of ann was used to further examine the proposed lube method in this way the accuracy of pis was quantified by coverage and width criteria three gcms can esm2 bnu esm inm cm4 and ensemble gcm ensemble of mentioned models were used in four grid points around each of station for evaluating ann based downscaling of precipitation and temperature parameters comparison between the results of two methods indicated that lube method could lead to more reliable results than the bootstrap method pis width and coverage probability were 10 40 lower and 2 10 higher than the bootstrap method for different gcms respectively ensemble gcm led to more accurate results so that computed pis width and coverage probability were 10 60 lower and 2 20 higher than those for the single gcms keywords general circulation models downscaling prediction interval artificial neural network 1 introduction thegeneral circulation models gcms as climate models are employed to forecast the atmospheric conditions understand the weather and forecast climate change there are some studies focus on the impact of the climate change on the atmospheric variables over the world e g see mcsweeney et al 2015 campozano et al 2016 osman and abdellatif 2016 ranjbar et al 2018 liu et al 2019 in addition there are some studies assess the impact of climate change on the temperature and precipitation in middle east countries in alotaibi et al 2018 various gcms and data driven models were applied to study changes in temperature and precipitation of qassim region in saudi arabia results in this study showed that the temperature may be increased in the region and rainfall will differ over various spans of the future in okkan 2015 the impact of climate change on monthly precipitation of tahtali watershed in turkey was investigated it was concluded that precipitation is decreased around 12 4 during the period between 2020 and 2039 10 0 during the period between 2040 and 2059 and 18 3 during the period between 2080 and 2099 and statistically significant changes during the periods 2001 2019 and 2060 2079 okkan and kirdemir 2016 downscaled the monthly precipitation for gediz basin in turkey and used several gcms and the obtained results showed a decrease trend for precipitation with different intensities in different scenarios despite the gcms trustworthy provision of atmospheric data the coarse spatial resolution of gcms causes weak application in local scale modeling therefore an appropriate downscaling approach should be used to access local scale weather data from large scale gcms wilby and wigley 1997 in order to project local climate change it is essential to interpret the coarse scale gcms and reanalysis output to finer spatial scale by dynamical or statistical downscaling methods in dynamical downscaling a regional climate model is attained by gcm boundary conditions and solving equations of motion and thermodynamics danandeh mehr and kahya 2016 although these models have the ability to develop climate variables the process consists of uncertainty in parameterization of sub grid scale processes with higher computational costs whereas statistical downscaling discovers relationships between local climate variable and gcms independent of any information about the physics of the process sailor and li 1999 olsson et al 2004 harpham and wilby 2005 chen and adams 2006 sousa et al 2007 spak et al 2007 beecham et al 2014 however there are assumptions for statistical downscaling e g as statistical downscaling serves black box modeling tools so the calibrated model can t be similarly used in other regions also there should be data from a regional station and for downscaling in addition developing a statistical downscaling model for finer time scales such as daily or hourly often becomes a challenging task due to high memory requirements and slow convergence associated with modeling large data sets şen 2010 artificial neural network ann is a black box model with the ability to extract complicated relations between predictor and predictand variables and simulate the nonlinear and time varying features of the atmospheric variables at various scales e g monthly daily hourly could lead to prevalent use of ann in gcm data downscaling e g see wilby and wigley 1997 dibike and coulibaly 2006 fistikoglu and okkan 2010 okkan and fistikoglu 2014 okkan and inan 2015 okkan and kirdemir 2016 although there are intensive applications of ann for downscaling of gcms data point estimation prediction of targets by ann conveys no information about the sampling error prediction accuracy and uncertainty of the model with this regard some studies already examined the uncertainty and reliability of ann based gcm downscaling procedure focusing on the confidence intervals cis e g khan et al 2006 samadi et al 2013 prediction intervals pis and cis are two prevalent measures for assessment of prediction forecast uncertainty cis correspond to the accuracy of the prediction of the regression i e the mean of the target probability distribution whereas pis assimilate the accuracy of the predicted values versus the measured values heskes 1997 khosravi et al 2011b confidence interval ci corresponds to the modeling uncertainty which can be classified into different forms based on the variability arises from model inputs parameters and structures which combine together contributes in producing the prediction uncertainty pis correspond to the accuracy of the prediction of targets instead of estimating the true model therefore pis are included more sources of the uncertainty and are wider than cis and as so are more beneficial from practical aspect since the constructed upper and lower bounds of pi are capable of capturing exact observed values shrivastava et al 2015 decision makers should provide design plan to manage critical issues due to climate change with this regard in prediction intervals by considering uncertainties a bound is obtained that is essential in decision making management and design optimistic and pessimistic decision making can be considered by prediction intervals if we have the bounds in the case that the problem is critical so pessimistic decision making is applied and upper bound will be the bases of planning but it may not be economical however in the case that optimistic decision making is considered the lower bound will be the bases of planning but with a bit high risk on the other hand for the climate change used gcms contain various sources of uncertainty which are associated with gcms data scenarios and physical rules of gcms and these uncertainties affect the predictions for future in climate change studies while using gcms by applying point prediction for future designing can be uneconomical or may be critical conditions won t be considered in this study these uncertainties have been handled using multi gcms and also estimating the prediction intervals instead of point prediction which can represent such uncertainties therefore in climate studies when applying gcms while having pi there will be more alternatives for designing some classic techniques are usually used to construct the pis for ann methods such as delta bayesian mean variance estimation and bootstrap techniques the delta technique employs the standard asymptotic theory for constructing the pis chryssolouris et al 1996 hwang and ding 1997 in this technique the intervals are constructed under the assumption that the noise is homogeneous and normally distributed which is the main limitation of this technique the bayesian technique is on the basis of the bayesian statistics to express the uncertainty of the network weights in terms of probability distributions and integrates them to obtain the probability distribution of the target conditions the bayesian approach requires time consuming monte carlo integration overweight space in multi dimensional real world applications mackay 1992 the mean variance estimation based method also assumes that errors are normally distributed around the true mean of targets therefore pis can easily be constructed if the parameters of this distribution mean and variance are known the dependence of the target variance on the set of inputs is the basic assumption and of course the main limitation of this method nix and weigend 1994 on the other hand the bootstrap technique neither requires the complex computations of derivatives and hessian matrix inversion involved in the delta method nor the montre carlo solutions of the integrals involved in the bayesian approach dybowski and roberts 2001 therefore this simple method has been widely used in several hydro climatologic studies e g dibike et al 2008 samadi et al 2013 in this study lower upper bound estimation lube method which was firstly introduced by khosravi et al 2010 and is a novel pis construction method in hydro climatologic issues is applied to construct pis for ann based downscaling of monthly precipitation and temperature parameters at tabriz and ardabil stations located in northwest of iran in the lube method an ann with two output neurons representing upper and lower bounds of the estimation is trained the coverage probability of lube is better than other methods and it can effectively establish trade off between the correctness and informativeness of pis khosravi et al 2011a moreover the required time for pis construction is remarkably smaller than other methods quan et al 2014 in this way three gcms and their ensemble are used and the obtained results by lube are compared with those obtained by the bootstrap method although in some studies different methods have been already used to construct pis of ann methods in hydrological modeling e g srivastav et al 2007 kasiviswanathan et al 2013 kasiviswanathan and sudheer 2016 kumar et al 2015 to the best of authors knowledge as a novel application of lube method in the hydro climatic issues this is the first study to model pis of ann based gcm data downscaling 2 materials and methods 2 1 proposed methodology in the proposed modeling dominant atmospheric parameters related to the precipitation and temperature of both stations were distinguished using the mi measure thereafter point predictions by ann method and then pis of ann based downscaling were constructed and evaluated by both lube and bootstrap methods using available data finally point and interval predictions for future 2020 2055 values of precipitation and temperature were estimated for both stations under rcp8 5 climate change scenario in the following sub sections the components of the proposed methodology are described in details 2 1 1 study area and used data in this study the modeling was applied to the data from two stations tabriz and ardabil to have a comparison about the performance of the proposed methodology over different case studies tabriz latitude 38 07 n longitude 46 14 e and elevation 1364 m and ardabil latitude 38 22 n longitude 48 30 e and elevation 1332 m are located in the north west of iran see fig 1 ardabil is located on the slopes of the sabalan mountain the average annual minimum and maximum temperatures are 2 c and 19 c in january and july respectively total annual precipitation is about 361 2 mm the relative humidity in the region is about 73 and 48 in december and june respectively tabriz located in the quru river valley between long ridges of volcanic cones in the sahand and eynali mountains the valley opens up into a plain that gently slopes down to the eastern shores oflake urmia 60 km to the west average annual minimum and maximum temperatures are 2 c and 26 c in january and july respectively total annual precipitation is about 280 mm the relative humidity values in the region are about 72 and 36 in january and july respectively for eliciting local scale station data from large scale gcm data the mean monthly observed precipitation and temperature time series were obtained from the iran meteorological office for the periods of 1951 2012 and 1976 2012 for tabriz and ardabil stations respectively the gcm data under the ipcc ar5 cmip5 ipcc assessment report 5 and coupled model intercomparison project data sets for historical past data from the ipcc data distribution center http cera www dkrz de and future simulations under the representative concentration pathways rcp8 5 for the duration of 2020 2055 were retrieved the predictors were extracted from three gcms including can esm2 inm cm4 bnu esm respectively from research centers of canada russia and china with mean monthly atmospheric variables see table 1 according to the previous studies for the region which examined several gcms and concluded that these gcms can lead to better outcomes see nourani et al 2018b hosseini baghanam et al 2018 since some previous studies have shown better performance when using data from multiple grid points around the study area frost et al 2011 guo et al 2012 beecham et al 2014 predictors from four grid points around each study station were considered in the modeling procedure as two stations have the same latitude hence six grid points were used totally which are surrounding the two stations for applied gcms see fig 1 points a1 to a6 and b1 to b6 for bnu esm can esm2 and inm cm4 respectively accessible predictors for applied gcms were tabulated in table 1 the number of applied large scale atmospheric predictors at each grid point which are potential predictors input were 95 for bnu esm and inm cm4 models and 120 for can esm2 model therefore 1240 predictors are the candidate for input of considered gcms for the downscaling model of each parameter if the method of trial and error will be used to select dominant inputs 2 1240 1 tests are required which is a time consuming input selection process therefore nonlinear mi measure between candidate inputs and target yang et al 2000 was used in this study to select dominant inputs of ann based downscaling models since the parameters are in different orders of magnitude and units all were firstly normalized 2 1 2 artificial neural network based downscaling the anns have been used for downscaling the hydro climatologic parameters using gcm data an ann may be explained as a network of interconnected neurons the common structure of the ann consists of three layers the first layer that contains the input variables is the input layer and the last layer relevant to the output variable is called the output layer the layers between the input and output layers are the hidden layers neurons that connect the layers reforced by weights the optimal set of weights is determined through the learning process the learning process consists of known input and output values which train the network while finding the known output set using a known input set the best weights are calculated among the applied neural networks the feed forward neural network fnn with the back propagation bp training algorithm is the most commonly used method in solving different engineering problems nourani and kalantari 2010 sharghi et al 2018 sharghi et al 2019 a three layer fnn bp network model trained using the levenberg marquardt optimization algorithm haykin 1994 was chosen for this study three layered fnns are based on a linear combination of the input variables which are transformed by a nonlinear activation function implement of ann influenced by multiple factors including i predictors selection п number of hidden neurons network structure and ш specified training algorithm for connecting weights according to the network structure issues the poor performance in training may be due to the inadequate number of hidden neurons but exceeding number of hidden neurons may lead to overtraining and additional training time trial and error is the commonly used method to obtain optimal number of hidden neurons the scope of an optimal ann architecture is to minimize the error between simulated output and the desired value with the most compact and simple structure huge and redundant data appropriately selecting gcms and grid points also predictors are of main significance in any gcms downscaling method for a particular area lee 2017 some researchers have confirmed the improvement in the performance of data driven models via input data screening ahmadi and han 2013 ahmadi et al 2015 hosseini baghanam et al 2018 nourani et al 2018a nourani et al 2018b non linear mi measure was applied in the current study to determine the dominant inputs among the potential inputs from surrounding points of different gcms for the study stations although several previous studies used correlation coefficient cc to select inputs for black box models such as the ann model devak and dhanya 2016 it has been criticized by nourani et al 2015 which for modeling non linear processes via non linear models it is possible to have a weak linear relation between inputs and output but a strong non linear relation therefore it is suggested to use a non linear measure for non linear ann based modeling in order to select the most dominant inputs for the ann models among huge numbers of available potential variables i e here 1240 nonlinear mutual information mi measure was used in this study entropy or information content is a statistical measure of the randomness or uncertainty in terms of probability distribution it has been introduced as a measurement criterion of disorder turbulence and uncertainty in general the theory of shannon information content is used in the discrete or continuous form based on the data and problem nature regarding the fact that the data used in this paper are discrete the mi of tworandom variables is a measure of the mutual dependencebetween two variables high value of mi indicates a large reduction in uncertainty low mi indicates a small reduction and zero mi between two random variables means that the variables are independent mi between two random variables of x and y is defined as yang et al 2000 1 m i x y h x h y h x y where h x and h y are the entropies of x and y respectively the entropy for random variable x with length of n with values x1 x2 xn and the corresponding probabilities p1 p2 pn can be computed as shannon 1948 2 h x i 1 n p x i l o g p x i in eq 1 h x y is the joint entropy of x and y which can be calculated by gao 2008 h x y i 1 n i 1 n p x i y i l o g p x i y i 3 mi was applied between the predictors gcm variables and predictands i e precipitation and temperature to sort out the relationships between inputs and outputs for the numerical calculation of mi and h using eqs 1 3 probability density function pdf for all of the variables should be specified histogram method is the most common method of pdf calculating by application of this methodology the sample space is divided into n bins each with δx or δy interval according to eq 1 we need entropy and according to eq in order to compute entropy we need to compute pdf probability density function of each parameter which in this case bin size is important and can affect the mi values but maybe mi values are changed but it should be noted that the rank of parameters based on mi will be the same because the bin size for all parameters kept fix and it affects the results equally so dominant parameters were selected according to the mi rank it should be noticed that in contrast to the correlation coefficient mi is used to measure the nonlinear dependency with parameters in which linearity can be considered as a special case of such nonlinearity so if nonlinear relationship can be detected similarly the linearly relationship can also be detected if the inputs are dependent these inputs are useless and less effective in the modeling consequently mi was used in this study and it was measured between various parameters therefore selected dominant inputs were independent without collinearity for the purpose of assessing efficiency of downscaling and point predictions by ann criteria of root mean square error rmse eq 7 nash sutcliffe efficiency nse eq 8 and cc eq 9 were used in this study the nse ranges from to 1 an efficiency of 1 shows proper adjustment of downscaled model output to the predictand while efficiency of 0 expresses that the model predictions have the same accuracy as the mean of the predictand and an efficiency less than zero means the observed mean has better prediction than the model the rmse corresponds to adaptation between measured and simulated data which is the sample standard deviation of the differences between predictor and predictand it ranges between 0 and whereas with reduction in rmse the efficiency is improved the range of values for the cc bounded by 1 to 1 the cc of 1 shows a perfect negative correlation while a cc of 1 shows a perfectpositive correlation a correlation of 0 shows no relationship between the two variables 7 rmse i 1 n r i z i 2 n 8 nse 1 i 1 n r i z i 2 i 1 n r i r 2 9 cc r i r z i z r i r 2 z i z 2 in eqs 7 9 ri and zi are predictand and observations respectively r and z are means of predictand and observations and finally n is the total number of observations 2 1 3 concepts of pis the uncertainty associated with models includes both modeling and prediction uncertainties modeling uncertainty is due to inappropriate fit of the model to the target the modeling uncertainty can be due to the model inputs parameters and structures which in combine contributes in producing the prediction uncertainty the input uncertainty is mainly due to instrument measurement and sampling error the parameter uncertainty consists of incapability to recognize a parameter set which can lead to the best performance of the model the simplification insufficiency in the explanation of real world process through mathematical equation lead to model structure uncertainty shrestha and solomatine 2008 the prediction uncertainty drives from typical of random phenomena and is intrinsic in the data series used for the modeling morgan et al 1990 krupnick et al 2006 cis and pis are most commonly used statistical measures for quantifying the uncertainty of prediction by a model for a set of n data samples x i t i i 1 n a model can be written as heskes 1997 4 t i f x i w e i xi is a sample of the input space ti is the observed target and f with the actual parameter set w is the non linear function representing the true underlying function model and ei is the error with zero mean the approximate model f xi w is the mean of the distribution of the targets where the estimated parameters set w can be determined using a machine learning technique access to accurate prediction of true model is the main purpose of the point prediction however some indicators are essential to quantification the prediction with this regard cis corresponds to estimation of true model and is calculated by 5 ci f x i w f x i w on the other hand pis correspond to precision of prediction of targets and can be calculated as 6 pi t i f x i w f x i w f x i w e i pis deal with the uncertainty in the prediction of a future realization of a random variable and account for more sources of the uncertainty model misspecification and noise variance and is wider than ci and therefore was considered in this study as the measure of prediction uncertainty two measures for the quantitative assessment of constructed pis are pi coverage probability picp and mean pi width mpiw picp measures the percentage of observed values that fall within the prediction band if the width of prediction band is wider it covers most of the observed values the more picp is closer to its nominal value the more reliable it is picp as eq 10 is the measure that shows how good the pis are khosravi et al 2010 kasiviswanathan et al 2013 10 picp 1 n i 1 n c i i f l x i x i u x i c i 1 e l s e c i 0 where u xi and l xi represent respectively the upper and lower bounds of pis corresponding to the i th sample the ideal value of picp could be gained if the upper and lower bounds of pis had extremely large values actually too wide pis are not valuable because pis carry no report around the observed values therefore additional criterion should be used for quantification of the width of prediction bounds as khosravi et al 2011a 11 mpiw 1 n i 1 n l x i u x i finally after calculation of pis width in order to compare obtained pis by various techniques normalization is required for the value of mpiw in the form of 12 nmpiw mpiw r where r is the range of the underlying target nmpiw is a dimensionless measure indicating how narrow pis are considering these two measures nmpiw and picp independently may not drive to accurate results because they have the contrary relationship therefore both measures should be simultaneously evaluated in the procedure of pis construction the structure of ann with two outputs for estimating upper and lower bounds of pis via lube method is shown by fig 2 the first output corresponds to the upper bound and the second stands for the lower bound steps of the proposed lube method and training ann with two outputs to construct pis are summarized in fig 3 at first step data set is split into training and validation sub sets then an ann with two outputs optionally for initial values of outputs 5 of observed values can be considered to train ann and find initial guesses for the weights then weights are randomly perturbed around the initial weights to generate some new weight sets dhanesh and sudheer 2011 have reported that ann weights are sensitive in a range of 10 from the calibrated values therefore some new anns with the several sets of perturbed weights in the range of 10 around initialized weights are created and anns are simulated with these weight sets to obtain different sets of pis the numbers of generated sets of weights depend on the number of hidden neurons were considered in the range of 700 1200 in this study the pis set which leads to the highest picp and lowest nmpil values is finally considered as the final result see fig 3 for networks evaluation first the picp were assessed in case that picp value is lower than considered 1 α in this study α was considered as 0 1 confidence level equivalent network is rejected as its coverage probability is very low if picp is around or above 1 α in this study α was considered as 0 1 the nmpil is compared with nmpil of the already considered optimal network if it is lower optimal network is replaced by the new network this procedure continues until all networks are checked efron and tibshirani 1993 developed bootstrap method which resamples the training datasets for the purpose of generating various models by training an individual network on each resampled instance of the original dataset see fig 4 this technique develops new sets of samples to present appropriate comprehension about the mean and variability of main sample independent of any knowledge about data distribution bootstrap is a simplified approach for quantification the uncertainty related to ann prediction srivastav et al 2007 the positive point about the application of this technique is that it does not require complex derivatives of any non linear function if random samples are bootstrapped each time from total available dataset the simple arithmetic average of prediction can be considered as the model output corresponds to the i th input data point of x this process is performed by repeated sampling with replacement of the original dataset of size n to obtain b bootstraps datasets each with a size of n therefore b neural network models are developed where each bootstrap dataset may differ slightly the mean and variance of outputs of these b networks are calculated as follows to compute pis 13 y boot x 1 b b 1 b f x i p b 14 σ boot 2 x 1 b 1 b 1 b f x i p b y boot x 2 where p b denotes to the parameter obtained from b th bootstrap sample and f denotes to the functional form of the ann model to construct pi of a prediction l u for a future observation x having normal distributionprobability of p with knownmeanandstandard derivation we will have 15 p l x u p l y boot σ boot x y boot σ boot u y boot σ boot where z x y boot σ boot the standard score of x is distributed as standard normal grant and leavenworth 1972 hence 16 l y boot σ boot z u y boot σ boot z or l y boot z σ boot u y boot z σ boot to calculate the pis the value of z in eq 16 for the distribution of pdf should be determined in which to do that the formula of the pdf must be known or assumed in which for this purpose due to simplicity and generality of the normal pdf it is usually used it is possible to use other pdfs but sometimes their application will not be straightforward as well a normal pdf different values of z correspond to different confidence levels are tabulated in table 2 3 results and discussion for evaluating the capability of the lube method to construct pis of downscaled precipitation and temperature values the dominant inputs from gcms were selected by mi measure and then classic ann with one output was trained to find point predictions then an ann with two output neurons considering 5 of observed values as the initial guess for upper and lower bounds was trained to initialize the weights of the network the perturbed values of initialized weights were used to create networks with two outputs of lower and upper bounds finally the developed networks were used to project the monthly precipitation and temperature values point predictions and related pis for the near and far futures years 2020 and 2055 the pis results were also compared with the results of the classic bootstrap method the details of the obtained results are presented in the following sub sections 3 1 point predictions by ann based downscaling method as explained in nourani et al 2018 parameters selected by mi led to better results than selected parameters by cc in order to have comparison between cc and mi measures the performance of both measures were compared for temperature and precipitation of ardabil station with bnu esm model see table 4 as shown in table 4 selected inputs via mi measure led to better results compared to the selected inputs via cc therefore mi measure was computed between target observed precipitation and temperature at stations and each atmospheric predictor from gcm in surface and various levels of the atmosphere at six grid points around the stations and the variables with higher ranges of mi in significant level of t student were selected as the inputs for the anns results of predictor selection are tabulated in table 3 according to table 3 relative humidity hur northward wind va and air temperature ta mostly show maximum mi values in three gcms with temperature based on the mi nonlinear method the pressure variables i e va humidity variable hur with nonlinear relation by station temperature were selected as the dominant predictors since change in the topography leads to pressure change and changes of weather pressure in turn affects the temperature change so the pressure variables might nonlinearly be related to the temperature of the region such nonlinear relations could be detected by mi method most selected dominant parameters which have relation with the temperature of the tabriz station is from a1 grid point as hur this may be due to the impact of the proximity of this grid point to urmia lake so its humidity have relation with the temperature another dominant parameter was va which shows the influence of wind which blowing from sahand mountains in ardabil station temperature is affected mostly by humidity variables especially in grid points a3 and b6 located in caspian sea which this sea has a significant impact on ardabil station climate also for precipitation of the tabriz station hus and hur were prominent predictors in high pressure levels this is due to mountainous and arid climate of the tabriz region and inadequate humidity sources i e large water bodies around the study area so far away water bodies like the caspian sea can be transferred in high pressure levels about precipitation of ardabil station similarly humidity variables from grid points a3 and b6 as well as ua and uas eastward wind have more impact on the precipitation values since wind transfers the humidity from seaside to the station zg is one of the effective variables in b6 grid point for precipitation of ardabil which emphasize the importance of temperature alteration on the sea therefore blowing wind to the location of the ardabil carry out the humidity to the nearby mountainous region as shown in table 3 large scale precipitation parameters were not selected as dominant inputs maybe due to the locations of the case studies e g black sea caspian sea sahand mountains where the impact of grid points e g precipitation does not reach by the study region similarly in some other studies precipitation large scale parameter was not selected as the input parameter for the downscaling e g see osman and abdellatif 2016 liu et al 2019 the selected variables were used as inputs of ann models and in this way all data were normalized because the active function which is used as a non linear kernel in ann is more sensitive to the large variations in the range of 1 to 1 or 0 to 1 for the purpose of calibration and validation the anns the data set was split into two parts 75 of the data were applied for training and the rest 25 were used for the validation purpose historical gcms data of bnu esm2 and inm cm4 are available until 2005 but can esm2 provides the data up to 2012 as so for the tabriz station calibration and validation periods were set to 1951 1991 and 1992 2005 and for the ardabil station as 1976 1997 and 1998 2005 respectively for modeling by bnu esm and inm cm4 whereas for the can esm2 model the calibration and validation periods were respectively set to 1951 1996 and 1997 2012 for tabriz station and 1976 2003 and 2004 2012 for the ardabil station a three layer ffnn with levenberg marquardt scheme of bp training algorithm and the tangent sigmoid tansig as the activation function was applied to downscale each of precipitation and temperature parameter for both stations to distinguish the optimum ann structure the epoch and hidden neuron numbers were obtained through the procedure of trial and error the best training epoch number and optimum hidden neurons number were found in the range of 100 360 and 3 12 respectively for the models see table 5 according to some previous studies e g feng et al 2010 using the ensemble of gcms instead of single gcm can usually improve the downscaling accuracy in this way for the purpose of enhancing the performance of the ann based downscaling models the ensemble of single gcms outputs were used as inputs of another ann to construct ensemble of gcms see fig 5 as another scenario of the modeling criteria of rmse nse and cc were measured for assessing the efficiency of modeling the obtained results of point prediction are tabulated in table 5 for both parameters and both stations as shown in table 5 ensemble of gcms showed better performance in comparison to the single gcms for both stations and both parameters nse for verification data for ensemble of gcm was up to 11 higher than single gcms a conceivable description is that the model ensemble receives various physical parameterizations and therefore eliminates the limitations of an overconfident single model simulation the ensemble of gcms includes features of all cooperating gcms and therefore may lead to more reliable predictions tebaldi and knutti 2007 duan and phillips 2010 pincus et al 2008 among single gcms for tabriz station bnu esm led to better performance in ann based downscaling of both temperature and precipitation parameters it can be concluded that for this station gcms with high resolutions have better efficiency but for ardabil station inm cm4 data yielded to more reliable results among single gcms for temperature but can esm data would be better for prediction of precipitation these results indicate that models with lower resolution i e inm cm4 might show better temporal performance than those with higher resolutions which is in agreement with some previous studies miao et al 2013 for both stations gcms led to better performance in temperature rather than precipitation this consequence has adaptation to previous studies sun et al 2015 ahmadalipour et al 2017 this is mainly because of the more stable and regular nature of temperature which makes it easier to predict unlike high uncertainty associated with the precipitation parameter moreover vertical air motion caused by atmospheric instabilities and air flow over orographic features effect on precipitation variation as shown in fig 6 c d the temperature was over estimated for both stations furthermore as shown in fig 6b precipitation of ardabil station was underestimated these results might be due to the unreliable performance of applied gcms in handling clouds and water vapor some researchers discovered that cmip5 models prone to underestimate the cloud cover nam et al 2012 and stratospheric water vapor fyfe et al 2013 therefore the impact of the sun in warming the planet will be overestimated in the simulating process satellite consideration recommended that gcms have neglected about weak reactions caused by clouds and water vapor christy et al 2010 therefore the carbon dioxide impact on the warming will be decreased fyfe et al 2013 comparison between the results of two stations indicates that the used gcms led to better performance for tabriz station than ardabil therefore it could be concluded that same gcms might not perform similarly for different stations due to the difference in atmosphere and position of the stations since the ann point prediction may include uncertainty and conveys no information about the accuracy of modeling it is essential to quantify the prediction bound so in the following sub section results of pis construction are provided and evaluated by criteria defined in the previous sections 3 2 constructed pis using lube and bootstrap methods the overall performance of any pis construction method for ann based modeling highly depends on the network structure and training process to generate pis of downscaling results by lube method a network was created for each parameter temperature and precipitation of tabriz and ardabil each containing two output neurons as upper and lower bounds of prediction for each sample point the optimum number of hidden neurons was determined by trial and error process examining the range of 1 to 12 neurons confidence level associated with all pis was considered as 90 α 0 1 two criteria picp eq 9 and nmpiw eq 11 were computed for each generated set of weights by perturbation of initialized weights to find out the optimum structure of ann for constructing the pis with maximum value of picp and minimum value of nmpiw the obtained optimal picp and nmpiw values in constructing the pis of precipitation and temperature parameters for tabriz and ardabil statins are presented in table 6 picp value for ensemble gcms of tabriz station was up to 20 and 10 higher than the single gcms whereas nmpiw value was up to 10 and 50 less than single gcms for temperature and precipitation respectively in comparison with different single gcms so ensemble of gcms showed better performance either in point prediction or pis construction better performance of the models ensemble compared to the single models have been already confirmed in some studies as well duan and phillips 2010 miao et al 2013 according to table 6 ensemble modeling showed more impact on narrowing prediction width than the prediction coverage in addition for ardabil station using ensemble of gcms data picp showed up to 30 and 20 higher values whereas nmpiw value was up to 20 and 20 lower than the single gcms for temperature and precipitation parameters respectively as picp and nmpiw are conflicting criteria considering the results of both measures showed that can esm2 model led to better outcome for precipitation and bnu esm for temperature of tabriz station but for ardabil station can esm2 and bnu esm got better results respectively for temperature and precipitation parameters therefore unlike point prediction gcms with high resolution may have better performance in comparison to gcms with lower resolution i e inm cm4 in constructing the pis for further evaluation of the pis values constructed by lube method the classic bootstrap method was also used to create pis and the results of both methods were compared with together in this way an ann for each parameter was trained 80 times each time modeling by randomly selected resampled 400 250 samples among 659 359 total samples respectively from data sets of tabriz and ardabil stations for can esm2 model selected resampled samples were 650 and 350 among 743 and 431 total samples respectively from data sets of tabriz and ardabil stations trained weights were then used to simulate the outputs of the ann model for all samples then for constructing pis mean and standard derivation of outputs with confidence level of 90 were applied to constructed pis bounds using eqs 13 16 and the obtained results are tabulated in table 6 again for the bootstrap method ensemble gcms approximately showed better results with regard to the single gcms as shown in table 6 for single gcms can esm2 led to better results for precipitation of tabriz and ardabil stations as shown in table 6 the constructed pis using the bootstrap method had wider width than lube method thereupon it could capture more targets leading to higher picp values even though bootstrap may lead to higher values of picp compared to lube but since pis higher values of nmpiw so the constructed pis via bootstrap method are not superior to those constructed via lube method as tabulated in table 6 constructed pis via lube method show better qualities than bootstrap method this lower performance of the bootstrap method is due to its inherent structure which randomly arranges the input data sets in most cases the bootstrap method overestimated the parameters although bootstrap mostly consists of peak points as shown in fig 6 in some cases it was unable to capture peak points this is because of training various anns with randomly selected sets of sub data therefore training sub data may not contain the statistical characteristics of the main data or maybe lack of peak points in considered sets in training anns cause inappropriate performance of the bootstrap technique compare according to eq 16 the upper and lower bounds of pis obtained via bootstrap method should be symmetric around mean value as shown in fig 6 this is true for temperature but for precipitation the lower bound values of pi below the zero were set to zero and therefore the constructed pis for the precipitation by the bootstrap method did not show a complete symmetric pattern in term of constructed pis by lube method pis were obtained directly as outputs of the ann without any prior assumption about data distribution but in the bootstrap method to construct pis it was assumed that the errors are normally distributed also the required time for construction pis by lube method is so smaller than the bootstrap method this is due to b times training of ann in the bootstrap method but for lube method the ann is trained only one time khosravi et al 2011a consequently lube method can be considered as a reliable approach for construction of pis from both quantitative and qualitative aspects of modeling as tabulated in table 6 although two criteria in some cases may have close values in most of the cases there is remarkable difference in values of picp and nmpiw of constructed pis of two methods after developing the models for point prediction and pis construction they were used for predicting the precipitation and temperature values and their pis for years 2025 and 2050 under the rcp8 5 scenario 3 3 projections of precipitation and temperature and related pis for future after training and verification of anns for point prediction and pi construction by the historical data mean monthly precipitation and temperature of two stations were predicted for near and far futures years 2020 and 2055 under rcp8 5 scenario also the results of point prediction lube and bootstrap method for the last year of historical data december 2004 to november 2005 were compared to the near and far futures dominant parameters and optimum ann structures determined in the previous steps were used for simulating precipitation and temperature values for the future the results were shown in figs 7 and 8 as shown in figs 7 and 8 in some cases the values of point prediction fall out of the pis ranges this is because the point predictions for future contain uncertainty and aren t 100 accurate so it is possible to see the point predictions sometimes fall out of the pis ranges as shown in fig 7a and according to the obtained results tabulated in table 6 for tabriz station the temperature may increase about 10 c up to 2025 compared to 2005 in winter and autumn but there will not be a remarkable change in spring and summer temperature values from 2005 until 2025 on the other hand for the ardabil station the temperature may increase in winter up to 2 c but temperature approximately remains the same in summer and spring and increase up to 7 c in autumn for year 2025 with regard to 2005 about the mean monthly precipitation of tabriz station it shows a decrease up to 88 mm and 24 mm respectively in spring and autumn but in february it approximately shows the same values with regard to the corresponding values of table 6 for the ardabil station although a 50 mm decrease is seen for spring precipitation of 2025 compared to 2005 the mean monthly precipitation does not show a remarkable change until 2025 as shown in figs 7 and 8 a comparison was done for mean monthly temperature and mean monthly precipitation values of two stations for years 2025 and 2050 the results showed that temperature of ardabil station in 2050 will increase 5 c compared to 2025 in april but approximately there will be little difference in temperature of other months in addition precipitation in january and february will be almost constant in these two years but in march the precipitation in 2050 will be increased about 120 mm compared to 2025 on the other hand in all months of autumn precipitation will be decreased up to 120 mm but for the summer the precipitation will have same values for 2025 and 2050 for the tabriz station precipitation may show remarkable decrease in february and march about 10 and 60 respectively in 2050 compared to those in 2025 this may be due to the increasing pollution density since many extremely small vapor particles were prevented to condensate caused by propagation of pollutions hence raindrops prevented from formatting in general precipitation shows overall decrease in 2050 with regard to 2025 temperature in tabriz station shows 2 c 16 increase in january but for march and october it may show up to 9 c decrease in 2050 compared with the values at 2025 for other months the temperature may have same values therefore in tabriz station precipitation and temperature would face more changes than ardabil station under considered gcms different performances of the models for these two stations may be due to their positions and their climate conditions tabriz station has mountainous climate but ardabil station has the semi humid climate moreover tabriz station as an industrial city may get more influence from the climate change scenarios in the future in the final step the optimum anns with highest picp and lowest nmpiw for construction of pis by both lube and bootstrap methods were used to estimate pis for precipitation and temperature parameters under rcp8 5 scenario for both 2020 and 2055 years moreover the obtained results were compared with constructed pis for year 2005 the results are illustrated in figs 7 and 8 also nmpiw for constructed pis are tabulated in table 7 as shown in table 7 constructed pis for most cases and both methods lube and bootstrap and parameters will increase in both 2025 and 2050 years compared to 2005 which indicates the increase of uncertainty in prediction of mentioned parameters in out coming years as shown in fig 7 temperature pis width is wider in summer than other seasons for tabriz station but for ardabil station pis have approximately constant width as shown in fig 8 for tabriz station precipitation pis are wider in winter and spring than other seasons but for ardabil station at spring pi has wider width which indicates higher uncertainty of precipitation in winter and spring as shown in figs 7 and 8 in all cases point prediction trend was similar to lube method but bootstrap showed different trends for temperature the reason for this incompatibility of bootstrap could be due to random selection of sub sets for training of ann or inappropriate number of generated samples as shown in table 7 a comparison between the constructed pis for both stations shows that for ardabil station pis for both years 2025 and 2050 methods lube and bootstrap and parameters precipitation temperature are wider than those for the tabriz station therefore uncertainty associated with prediction by the gcm data for ardabil station is higher than the tabriz station this result is linked to the point prediction results of these two stations the reason of this performance might be due to this fact that although now tabriz contains more manufactories and industries with regard to ardabil as a developing city the industrial growth rate of ardabil for future is remarkably higher than tabriz analysis of computed pis indicated that the precipitation pis for two stations and methods are wider than those for the temperature therefore the reliability of the precipitation prediction is somewhat less than temperature which congruous the complex and irregular pattern of precipitation with regard to the temperature parameter it is quite expected result in quality point of view but in this study it was tried to quantify this fact moreover it confirms the poor performance of gcms based modeling of precipitation as mentioned in point prediction performance in the previous section as shown in figs 7 and 8 for all cases lube method constructed narrower pis than bootstrap method which indicates that lube may provide more reliable pis results than bootstrap method high width of constructed pis by bootstrap method denotes to the overestimated results provided by this method comparison between constructed pis by lube method for both 2025 and 2050 years indicates that for both stations precipitation pis will decrease but temperature pis will increase in 2050 compared to 2025 as rcp8 5 scenario represents the increasing trend of temperature uncertainty associated with the temperature may be increased too but bootstrap method approximately showed same intervals for both years 4 conclusions although ann based downscaling gcm has been broadly used in prediction of climate variables point predictions by ann convey no information about prediction uncertainty in this content pi is an essential indicator for quantifying the reliability of ann based downscaling of climate parameters using gcms data in this paper ann based downscaling of temperature and precipitation variables was performed using three different gcms and ensemble gcms using the data from1950 to 2012 and from 1975 to 2012 for training the anns of tabriz and ardabil stations respectively in addition the rcp8 5 scenario was used for predicting future temperature and precipitation values for 2025 and 2055 dominant variables among several atmospheric parameters at four grid points around each station were selected by mi measure ann based downscaling using single and multi gcms data indicated that ensemble gcms could lead to more accurate results whereas can esm2 data yielded the best results among single gcms pis of ann based downscaling were constructed by lube method training an ann for each parameter with two outputs as upper and lower bounds of the prediction for quantitatively evaluating the performance of the constructed pis nmpiw and picp criteria were applied results were also compared with those from the classic bootstrap method analysis indicated that ensemble gcms could lead to more reliable results so that picp was up to 20 higher and nmpiw was up to 50 lower with regard to the single gcms it was concluded that the lube technique could build pis with low nmpiw and high picp with regard to the bootstrap method nmpiw for lube method was 10 60 less than bootstrap method consequently the lube methods superiority was derived in pis construction compared to the bootstrap method also tabriz station under applied gcms showed better performance than the ardabil station in the proposed lube method to optimize the ann network to construct pis two criteria of picp and nmpiw were considered as the objective function of optimization in order to expedite the optimization convergence and get more accurate results it is recommended to hybrid these two criteria as a cost function and use a robust metaheuristic method such as genetic algorithm particle swarm optimization to find out the optimum network the sources of uncertainty in the climatic projections can be assessed in future works and the total uncertainty can be decomposed into its main contributors e g gcms and emission scenarios using a valid statistical method such as variance decomposition sample size method declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgement the resarch was conducted under a finincial grant form university of tabriz research affairs 
6093,due to disadvantages of the core sampling method for determining soil bulk density bd many soil surveys lack data of bd to meet extensive demands for bd in hydrology agriculture environment etc an approach based on a pedotransfer function ptf is often established using available data of soil properties such as texture organic matter content ph and soil depth recently an approach based on proximal soil sensing pss was also proposed to fulfill this purpose i e subtracting volumetric water content θ estimated using visible and near infrared spectroscopy vis nirs from bd of wet soils determined using gamma ray attenuation with 120 samples collected from 20 profiles and 38 topsoils in a hilly subtropical area in china this study compared accuracy of the two approaches based on leave one out cross validation loocv and repeated cross validations with a wide range of randomly split samples texture organic matter content ph and depth of the samples were measured and they were used within multiple linear regression to establish ptfs results showed that the approach based on pss was at least 12 more accurate than the other and its estimated bd were close to those measured using the core sampling method for instance in loocv estimated bd based on pss had root mean square error rmse of 0 082 g cm 3 coefficient of determination r2 of 0 92 and residual prediction deviation rpd of 2 07 while estimated bd based on the best ptf had rmse of 0 094 g cm 3 r2 of 0 70 and prd of 1 82 the results also showed that accuracy of the approach based on pss was determined by accuracy of estimated θ using vis nirs however it is limited to improve accuracy of estimated bd using the approach based on pss further by improving accuracy of estimated θ this study demonstrated that the approach based on pss is promising for estimating bd in future soil surveys keywords gamma ray attenuation visual near infrared spectroscopy pedotransfer function proximal soil sensing 1 introduction bulk density bd is a primary property of soils it is closely related to soil functions in hydrology agriculture environment etc by impacting tillage movements of plant nutrients water air and energy in soil plant root growth and so on costa et al 2013 yi et al 2016 lobsey and viscarra rossel 2016 tian et al 2018 qiao et al 2019 thus it is an important parameter in evaluating land drainage irrigation nutrient stock carbon stock pollutant mass balance biomass productivity etc li et al 2016 shiri et al 2017 tian et al 2019 however the traditional method for determining bd i e core sampling of a known volume of soil followed by drying at 105 c for 24 h usually is not very convenient to conduct because of stones and plant roots in soil and it is also laborious time consuming expensive destructive prone to measurement error quraishi and mouazen 2013a and b al asadi and mouazen 2014 tian et al 2018 as a result bd information is missing in a lot of routine soil surveys martin et al 2009 suuster et al 2011 reidy et al 2016 to meet extensive demands for bd information for agricultural activities ecological and environmental evaluations and modeling and many other scientific researches scientists developed a range of methods which are easy to be conducted free of labor non destructive or cost and time effective e g pedotransfer functions ptfs penetration resistance pr gamma ray attenuation thermo time domain reflectometry visible and near infrared spectroscopy vis nirs the method of ptfs is the earliest and most frequently used one jeffrey 1970 adams 1973 federer 1983 a ptf is an empirical function modeled between bd and readily measured soil properties such as organic carbon and texture and easily available soil information such as soil depth and soil type it can be modeled using many types of modeling methods varying from basic statistical methods to multivariate spatial statistics e g linear regression exponential equation and polynomial equation and to machine learning methods such as classification and regression trees tranter et al 2007 artificial neural networks ann yi et al 2016 qiao et al 2019 random forest ramcharan et al 2017 and generalized boosted models martin et al 2009 jalabert et al 2010 chen et al 2018 so given commonly measured soil properties such as organic carbon and texture the method of ptfs is relatively convenient to be conducted and hence has been widely used so far however the method of ptfs suffers several drawbacks suuster et al 2011 yi et al 2016 the most important drawback is that a ptf is specific to a geomorphic region or soil type meaning that it cannot be simply extrapolated beyond the geomorphic region or soil type from which it was developed mcbratney et al 2002 for example de vos et al 2005 found that predictive qualities of 12 published ptfs in literature for predicting bd were mostly different between topsoil and subsoil thus although a large number of ptfs have been published in literature it is still necessary to establish a new one for a specific area or to validate published ones for their applicability in a new area this unavoidably requires for soil data and modeling in a new area another drawback is that the accuracy of a ptf is complexly related to factors such as modeling techniques available soil properties and interested soils for example tranter et al 2007 presented that a ptf modeled using multiple linear regression mlr outperformed another one modeled using regression tree but later martin et al 2009 presented a contrary result different combinations of soil properties have been used in literature to develop a ptf and generally they performed differently in different cases de vos et al 2005 yi et al 2016 some studies suggested to divide interested soils into different ranges and developed a ptf for each range specifically harrison and bocock 1981 but some others found that this did not help to improve estimation accuracy de vos et al 2005 benites et al 2007 proximal soil sensing pss is another convenient method to measure bd which is also free of labor and cost and time effective in literature a lot of approaches had been developed using pss including gamma ray attenuation pr frequency domain reflectometry fdr and vis nirs particularly lobsey and viscarra rossel 2016 proposed to combine gamma ray attenuation and vis nirs for estimating soil bd in this way bd of wet soil is first determined using gamma ray attenuation and then it is corrected by subtracting volumetric water content θ estimated using vis nirs gamma ray attenuation has been proposed much earlier for measuring bd by luo and wells 1992 and wells and luo 1992 and vis nirs is often used to estimate many soil properties including water content e g gravimetric moisture content in al asadi and mouazen 2014 and mouazen and al asadi 2018 moreover data fusion is believed to be an important tool for improving prediction of soil properties using pss kuang et al 2012 for example al asadi and mouazen 2014 demonstrated an improvement in predicting gravimetric moisture content and θ using data fusion of vis nirs and fdr compared with single vis nirs or single fdr lobsey and viscarra rossel 2016 already showed that this approach of combining gamma ray attenuation and vis nirs estimated bd with rmse of 0 055 g m 3 and r2 of 0 90 much more accurately than those estimated bd based on gamma ray attenuation only i e without being adjusted using water content estimated using vis nirs thus data fusion of gamma ray attenuation and vis nirs probably could estimate bd very accurately similar to the method of ptfs the approach of combining gamma ray attenuation and vis nirs for estimating soil bd also has some drawbacks first mouazen and al asadi 2018 concerned about the negative influence of the radioactive energy source on human health however this can be overcome using a lead container as a shield actually viscarra rossel et al 2017 have already integrated gamma ray attenuation with digital camera and vis nirs into their soil condition analysis system for practical use second the accuracy of this approach for estimating bd is also influenced by those factors that can influence accuracy of estimation of θ to the best of our knowledge few studies so far have applied this approach for estimating bd i e lobsey and viscarra rossel 2016 viscarra rossel et al 2017 and wang et al 2019 the objectives of this study are to 1 apply the approach of combining gamma ray attenuation and vis nirs to estimate bd based on 120 core samples collected in a hilly subtropical area in china 2 establish ptfs for estimating bd of the same samples with commonly measured soil properties i e organic matter content omc contents of sand 0 05 2 mm silt 0 002 0 05 mm and clay 0 002 mm ph and soil depth and 3 compare accuracy of the approach and ptfs 2 materials and methods 2 1 soil sampling soil samples were collected in a hilly area of 1 6 km2 located in nanning southwest china within latitude 22 58 3 22 59 17 n and longitude 108 20 55 108 21 54 e the climate of this area is subtropical humid monsoon with an annual average temperature of 21 6 c and an annual average rainfall of 1300 6 mm the elevation of this area ranges between 130 and 300 m and the average slope of this area is 24 8 in history this area has been always used for forestry since two decades ago it has been under eucalyptus plantation soils of this area are derived based on mud stone mud shale and sand shale and they are latosolic red soil referred to ustisol in the u s soil taxonomy fifty eight sites of this area were selected to collect samples in terms of elevation aspect and slope among them 20 sites were sampled with a soil profile each genetic horizon of a profile was sampled by the core method using standard sharpened steel cylinders of 100 cm3 volume d 53 mm h 50 mm on the remaining 38 sites topsoil equivalent to the genetic horizon a was sampled in the same way depths of all the samples were recorded when sampling a total of 120 samples were collected 2 2 lab analysis after weighting the above core samples were scanned in laboratory using a vis nirs spectrometer fieldspec 4 analytical spectral devices asd boulder co usa the spectrometer has a spectral range of 350 2500 nm and a spectral resolution of 3 nm at 700 nm and 6 nm at 1400 and 2100 nm its sampling interval is 1 4 nm between 350 nm and 1000 nm and 1 1 nm between 1001 nm and 2500 nm it has a light source of a halogen bulb enclosed in an angle of 12 with a contact probe of detection fibers using the spectrometer 9 measurements were made at both ends of a core sample in order to account for soil variation and 10 spectra were recorded for each measurement in order to minimize noises and to maximize the signal to noise ratio the resulting 180 spectra of each core sample were averaged to represent the whole core sample at last the range of each averaged spectra was reduced to 400 2400 nm to eliminate noises at both edges and then each spectra was reduced by averaging 10 successive wavelengths after scanned using the vis nirs spectrometer each core sample was sealed tightly with scotch tape in order to retain moisture for the following gamma ray attenuation measurement the gamma ray attenuation measurements were made using gem18180 ortec usa with a high purity germanium gamma detector when the core samples were wet the radioactive source was 137cs with an activity of 185 mbq and a photon energy of 0 662 mev for each core sample the measurements were made axially through the center and three positions evenly offset the center the four measurements of each core sample were averaged to represent the whole core sample after the above measurement of gamma ray attenuation the core samples were dried at 40 c for 7 days and then were repeatedly weighted and dried until the weights of the samples were constant the weights before and after drying were used to calculate θ and bd the low temperature of 40 c was used in order to keep omc constant for the following laboratory analysis finally the samples were measured for omc using the potassium dichromate oxidation method soil ph using a ph meter 1 2 5 soil to water ratio and contents of sand silt and clay using the malvern panalytical mastersizer 2000 malvern uk a laser diffraction testing instrument 2 3 bulk density measured using proximal soil sensing following lobsey and viscarra rossel 2016 bd was estimated using the equation 1 ρ b γ 1 x μ s ln i 0 i μ w μ s ρ w θ where ρ b γ represents bd in g cm 3 x is the sample thickness in cm μ s represents the mass attenuation coefficients of dry soil in cm2 g 1 i 0 is the unattenuated radiation emitted from the source i is the incident radiation at the detector and μ w represents the mass attenuation coefficients of soil water in cm2 g 1 ρ w represents the density of soil water in g cm 3 μ s is assumed to be consistent for sensing soil bd with gamma ray attenuation in this study the μ s of wang et al 2019 i e 0 0856 cm2 g 1 was used because the soils were from the same study area the μ w and ρ w actually were measured using distilled water and they were also the same to those of wang et al 2019 0 0850 cm2 g 1 and 1 g cm 3 similarly the other parameters in eq 1 were also the same to those of wang et al 2019 except i and θ i is the measured gamma ray attenuations for individual soil samples θ is estimated based on the vis nirs measurement using plsr and they were validated in the section 2 5 2 4 pedostransfer functions mlr was used to establish a ptf in this study because it is simple straightforward for interpretation the above measured soil properties i e omc ph and contents of sand silt and clay as well as recorded soil depth were used in mlr to establish a ptf these properties were chosen because they are commonly measured in a soil survey so they are generally available correlations between the properties and with bd were first analyzed then all possible combinations of the soil properties that were significantly correlated with bd at a level of 0 05 but having no multicollinearity were used to establish a ptf based on ordinary least square using the lm function of r r core team 2016 meanwhile commonly used variable selection procedures for mlr i e backward forward and both directions stepwise methods were also tried based on all of the measured soil properties in order to search for the best combination of variables for establishing a ptf finally only ptfs that have every variable with a statistical significance at a level of 0 05 and have residuals being normally distributed simply evaluated by the q q plot were used to estimate bd 2 5 validation both leave one out cross validation loocv and cross validation with randomly split samples from the 120 collected samples were used to validate bd estimated using a ptf and pss as well as the above estimated θ based on vis nirs in loocv each sample was selected to validate the estimation made using the remaining 119 samples a taylor diagram was plotted to compare accuracies of the estimated bd in loocv in the cross validation with randomly split samples n samples were randomly selected to validate estimation made using the remaining samples for all ptfs and pss the same n samples and remaining samples were used in this study n ranged from 1 to 40 for each n the validation was repeated for 100 times and an averaged validation criterion over the 100 times was computed to represent the validation criterion for the n the following three criteria were computed in the validations as well as in calibration of ptfs root mean squared error rmse residual prediction deviation rpd also called prediction deviation ratio in literature and coefficient of determination r2 they were calculated as 2 r m s e 1 n i 1 n o b s i pred i 2 3 r 2 1 n 1 i 1 n p r e d i μ pred o b s i μ obs 2 σ pred 2 σ obs 2 4 r p d σ obs r m s e where obs i is the observed value of sample i pred i is the corresponding predicted value σ pred and μ pred denote standard deviation and mean of predicted values respectively and σ obs and μ obs denote standard deviation and mean of observed values respectively rmse indicates prediction precision by measuring the variance of prediction errors and is sensitive to an outlier a large rmse value indicates a high prediction error r2 measures the goodness of fit between the predicted and observed values and it has the optimal value of 1 indicating a perfect fit rpd measures the ratio of standard deviation of observed values divided by the rmse and it is widely used in literature of pss to compare predictions made by different models the larger a rpd the better predictions are according to quraishi and mouazen 2013b it is generally classified into three classes a rpd of smaller than 1 4 indicating a poor prediction a rpd between 1 4 and 1 8 indicating a fair prediction and a rpd of larger than 1 8 indicating a good prediction 3 results and discussion 3 1 basic statistics of the soil properties table 1 lists basic statistics of the soil properties fig 1 shows histograms of the soil properties these statistics suggest that the bd values of this study vary largely and cover general bd values in literature for example the 300 bd values in mouazen and al asadi 2018 vary between 0 879 g cm 3 and 1 671 g cm 3 with an average of 1 304 g cm 3 and a standard deviation of 0 130 g cm 3 the 1013 bd values in al asadi and mouazen 2014 vary between 0 71 g cm 3 and 2 08 g cm 3 with an average of 1 43 g cm 3 and a standard deviation of 0 22 g cm 3 in table 1 values of skewness and kurtosis for bd indicate that the distribution of the bd values of this study is closely normal which is verified by fig 1 a the variations of omc contents of sand silt and clay ph depths and θ vary in different degrees the variations of omc and depths are quite large as indicated by coefficients of variation of 59 79 and 54 26 this is attributed to the sampling method of this study about half of the samples i e 58 were collected in the genetic horizon a generally omc in the genetic horizon a is much larger than in deeper horizons thus the variation of omc in this study is large depths of the genetic horizon a are smaller than those of deeper horizons while soil profiles vary in depth across the hilly study area so the distribution of depths in fig 1 g is clearly right skewed and this is also indicated by the skewness for depth in table 1 the variations of contents of sand silt and clay are modest with coefficients of variation of 16 29 23 00 in table 1 the variation of θ was not big either as indicated by the coefficient of variation of 16 69 the variation of ph is the smallest indicated by the coefficient of variation of 10 11 this is because the samples of this study are collected in a small area with the same parent materials and climate however the distribution of ph is a little bit right skewed as shown in fig 1 f 3 2 pedotransfer functions table 2 lists correlations between the soil properties bd is strongly correlated with omc ph and depth at a statistical level of 0 01 and with the content of silt at a statistical level of 0 05 it is common to see significantly strong correlations between bd and these soil properties in literature qiao et al 2019 table 2 also shows that there are statistically significant correlations between the soil properties for example omc is statistically significantly correlated with ph and depth so these correlated soil properties would not be used together to establish a ptf to avoid multicollinearity based on the correlation analysis omc content of silt ph and depth are chosen for establishing a ptf for estimating bd using mlr these four soil properties lead to totally 15 combinations for establishing ptfs however only six of the 15 result in a ptf that has every variable being statistically significant and has residuals being normally distributed the six ptfs established based on them are shown in table 3 and are numbered from 1 to 6 for citing in the following four ptfs are established based on a single variable i e each of the four chosen soil properties and the other two are based on two variables i e omc and silt and silt and depth respectively the two pairs in the last two ptfs do not correlate with each other according to table 2 based on all of the soil properties the backward and both directions stepwise procedures all select omc and silt for establishing a ptf although the forward direction stepwise procedure select all of the properties for establishing a ptf only omc and silt have statistical significances at a level of 0 05 thus the three variable selection procedures suggest omc and silt for establishing a ptf i e the ptf 5 discussed in the above the six ptfs explained 4 5 71 of the variation of bd in terms of r2 table 3 ptf 5 based on omc and the content of silt has the largest r2 i e 0 71 which is very closely followed by ptf 1 based on om only this suggests that om plays a major role in explaining variation of bd in this study in contrast the content of silt plays a minor role this minor role plays by the content of silt is verified by the r2 of ptf 2 based on this soil property only i e 0 045 the smallest r2 in table 3 ptf 6 based on the content of silt and depth has the third largest r2 i e 0 40 closely followed by ptf 4 based on depth only with a r2 of 0 35 ptf 3 based on ph only has the second smallest r2 i e 0 085 just a little larger than the smallest one de vos et al 2005 summarized r2 of 12 published ptfs and showed that they vary between 0 41 and 0 96 comparatively in this study except the two ptfs based on the content of silt and ph respectively the other four ptfs all have r2 close to those summarized in de vos et al 2005 however the ptfs summarized in de vos et al 2005 are much more complex than the ptfs of this study since the former take different transformations of a soil property e g natural logarithm transformation or different types of linear functions e g exponential linear and power linear although it might be possible for r2 of the ptfs in table 3 to increase if such transformations and functions are adopted de vos et al 2005 found no substantial enhancement in r2 due to including second and third polynomials in modeling a ptf so it remains a question for future studies to investigate if different forms of a soil property could help to increase r2 of a ptf recently ptfs established in quraishi and mouazen 2013a using mlr have r2 ranging from 0 04 to 0 51 smaller than r2 of the ptfs in table 3 this shows that the ptfs of this study are generally good in table 3 values of rmse and rpd of the models are also in the same order of r2 particularly values of rpd suggest that ptfs 1 and 5 predict fairly on the calibration data while the other four ptfs predict poorly however these values of rmse and rpd might be biased because they are derived from the calibration data 3 3 volumetric water content estimated using proximal soil sensing fig 2 shows coefficients of correlation between vis nirs reflectance and θ of soil samples at individual wavelengths ranging from 404 5 nm to 2404 5 nm clearly the correlations are all negative except at the wavelengths of 434 5 454 5 nm and 524 5 834 5 nm shaded in fig 2 the correlations are significant at a statistical level of 0 05 or 0 01 this suggests that it is possible to use the vis nirs spectra to estimate θ fig 3 presents accuracy criteria for the estimated θ based on vis nirs using plsr in loocv rmse is not very big i e 3 0 accounting for 12 of average θ of the samples in table 1 however r2 and rpd from loocv are not very high either i e 0 52 and 1 4 respectively so these results from loocv suggest that accuracy of the estimated θ based on vis nirs using plsr is poor in the validation using randomly split samples values of these accuracy criteria for estimated θ vary with the number of samples for modeling as shown in fig 3 rmse varies between 2 45 and 3 21 accounting for 9 7 to 12 of average θ of the samples r2 varies between 0 49 and 1 while rpd varies between 1 31 and 2 24 these results suggest that accuracies of the estimated θ in the validation using randomly split samples are mostly just fair or even poor while only sometimes they are good for example 55 of the rpd values are between 1 4 and 1 8 and 42 5 are smaller than 1 4 while only 2 5 of the rpd values are larger than 1 8 3 4 bulk density estimated using pedotransfer functions and proximal soil sensing fig 4 presents scatter plots of measured versus estimated bd in loocv meanwhile estimated bd using pss without corrections for water content are also presented i e the black dots in fig 4 g which are called pss 1 in the following estimated bd using pss with corrections for water content based on vis nirs i e the black dots in fig 4 h are called pss 2 in the following besides estimated bd using pss with corrections for water content based on oven dry are also presented i e the red circles in fig 4 g and h taylor diagram for the estimated bd is shown in fig 5 clearly pss 2 in fig 4 h are the closest to the measured bd while pss 1 in fig 4 g consistently bias from the measured bd among the ptfs ptfs 1 and 5 are the closest to the measured bd whereas ptfs 2 and 3 are the furthest this order appears again in the taylor diagram of fig 5 except pss 1 moving very close to pss 2 the move of pss 1 is attributed to the fact that the taylor diagram is based on standard deviation of differences between estimated and observed bd values ignoring average of the differences as shown in fig 4 g although pss 1 is regressed very well with the measured bd resulting in a high correlation in the taylor diagram of fig 5 they are the most biased away from the 1 1 line the bias indicates that they are larger than the measured bd obviously the biases are attributed to the uncorrected water contents in the core samples fig 6 shows accuracy criteria of the estimated bd of ptfs 1 6 and pss 1 2 in loocv pss 2 has the smallest rmse i e 0 082 g cm 3 accounting for 6 03 of average measured bd in table 1 and it also has the largest r2 and rpd i e 0 92 and 2 07 respectively thus these accuracy criteria suggest that pss 2 is the most accurate among all ptfs ptf 5 has the smallest rmse i e 0 094 g cm 3 and it has the largest r2 and rpd i e 0 70 and 1 82 respectively so pss 2 is much more accurate than the most accurate ptf i e ptf 5 compared with ptf 5 pss 2 decreases rmse by 12 and increases r2 and rpd by 31 and 14 respectively the order of accuracies of the ptfs is the same to that of modeling r2 of the ptfs in table 3 inferring that accuracy of a ptf is determined by modeling r2 of the ptf at last pss 1 has the largest rmse and the smallest rpd suggesting that pss 1 is the worst prediction although r2 of pss 1 is the second largest this is due to the good regression relationship between pss 1 and the measured bd as shown in fig 4 g it is already explained in the above that pss 1 biases the most away from the measured bd similar to the results from loocv results from the validation using randomly split samples fig 6 also suggest that pss 2 is more accurate than ptfs 1 6 except for the rpd values from validations based on samples 2 compared with the best ptf i e ptf 5 pss 2 decreases rmse by 2 42 17 09 and increases r2 and rpd by 0 34 and 10 22 respectively pss 1 is still the worst besides results from the validation using randomly split samples also suggest that accuracy of a ptf is determined by modeling r2 of the ptf as the order of accuracy criteria of the ptfs is the same to that of modeling r2 of the ptfs in table 3 when the number of samples for validation is larger than 20 values of the accuracy criteria are relatively stable and r2 values from the validation are close to modeling r2 values of the ptfs the best ptf established in quraishi and mouazen 2013a using mlr with pr moisture content omc and content of clay results in rmse of 0 13 g cm 3 and r2 of 0 51 in validation qiao et al 2019 repeatedly validated five published ptfs and a new one established using mlr with omc content of clay and or soil depth original or natural logarithm transformed for their own study area and reported rmse of 0 079 0 612 g cm 3 and r2 of 0 003 0 356 yi et al 2016 also repeatedly validated 14 published ptfs and newly established ones using mlr and ann with omc content of clay bd of organic matter and minerals organic carbon and soil depth for their own study area and reported rmse of 0 14 0 54 g cm 3 and r2 of 0 22 0 72 so the best ptf of this study i e ptf 5 with rmse of 0 094 g cm 3 and r2 of 0 70 is much more accurate than most of these reported in literature quraishi and mouazen 2013b developed a pss model for estimating bd which combing pr and vis nirs estimated moisture content omc and clay content using ann their model estimates bd with rmse of 0 08 g cm 3 and r2 of 0 84 when validating and when testing rmse and r2 are 0 04 g cm 3 and 0 94 respectively al asadi and mouazen 2014 developed pss models for estimating bd which combining vis nirs measured gravimetric moisture content and fdr measured θ they used both plsr and ann for modeling and the ann based model presents a better accuracy in validation with rmse of 0 095 g cm 3 and r2 of 0 81 in mouazen and al asadi 2018 a similar pss model results in rmse of 0 061 0 086 g cm 3 r2 of 0 57 0 86 and rpd of 1 51 2 60 for different levels of moisture content in validation lobsey and viscarra rossel 2016 used the same approach of this study but a different modeling technique for estimating θ i e ann their model results in rmse of 0 055 g cm 3 and r2 of 0 897 in validation so comparatively accuracy of pss 2 of this study is similar to or better than those published the comparison between pss 1 and 2 shows that correcting estimated bd using estimated θ is important for estimating bd based on pss this can be clearly seen in eq 1 in fig 4 h pss 2 is much closer to measured bd than pss 1 in fig 4 g and fig 6 clearly shows that pss 2 is much more accurate than pss 1 for example the loocv in fig 6 suggests that compared with pss1 pss 2 decreases rmse by 59 and increases r2 by 5 5 and rpd by 145 however improving estimation accuracy of θ further could not lead to an equivalent improvement in estimation accuracy of bd as shown in fig 4 g estimated bd corrected using measured θ also deviate a little from the 1 1 line and in fig 4 h they are quite close to pss 2 in fact estimated bd corrected using measured θ have rmse of 0 080 g cm 3 r2 of 0 94 and rpd of 2 12 so the improvements in accuracy of these bd over pss 2 are very small i e 2 4 of decrease in rmse 3 2 of increase in r2 and 2 5 of increase in rpd this can be attributed to measurement errors in laboratory analysis on θ in addition this is also because θ and its parameter in eq 1 are not large as shown in table 1 θ in weight averagely accounts for 18 65 of bd in eq 1 its parameter is 0 99 g cm 3 4 conclusions this study applied the approach based on pss i e combining gamma ray attenuation and vis nirs to estimate bd using 120 core samples collected in a hilly subtropical area in china and compared it with another commonly used convenient and efficient approach for estimating bd i e ptf it demonstrates that the approach based on pss is more accurate than the other the former leads to estimated bd values close to the measured ones with rmse of about 0 082 g cm 3 r2 larger than 0 90 and rpd larger than 2 00 in contrast the latter leads to estimated bd values biased much more away from the measured ones with rmse larger than 0 094 g cm 3 r2 smaller than 0 70 and rpd smaller than 1 80 besides this study also shows that accuracy of the approach based on pss is mainly determined by the accuracy of estimated θ using vis nirs nevertheless improving accuracy of estimated θ further could only lead to a small improvement in accuracy of the approach based on pss this study summarizes that the approach based on pss is promising for estimating bd in future soil surveys declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this research is financially supported by the national natural science foundation of china 41771246 and 41541006 prof jun li at school of geography and planning sun yat sen university china provided the vis nirs spectrometer for this study mr qi luo at college of physics and energy shenzhen university china provided gem18180 for this study we are grateful to them 
6093,due to disadvantages of the core sampling method for determining soil bulk density bd many soil surveys lack data of bd to meet extensive demands for bd in hydrology agriculture environment etc an approach based on a pedotransfer function ptf is often established using available data of soil properties such as texture organic matter content ph and soil depth recently an approach based on proximal soil sensing pss was also proposed to fulfill this purpose i e subtracting volumetric water content θ estimated using visible and near infrared spectroscopy vis nirs from bd of wet soils determined using gamma ray attenuation with 120 samples collected from 20 profiles and 38 topsoils in a hilly subtropical area in china this study compared accuracy of the two approaches based on leave one out cross validation loocv and repeated cross validations with a wide range of randomly split samples texture organic matter content ph and depth of the samples were measured and they were used within multiple linear regression to establish ptfs results showed that the approach based on pss was at least 12 more accurate than the other and its estimated bd were close to those measured using the core sampling method for instance in loocv estimated bd based on pss had root mean square error rmse of 0 082 g cm 3 coefficient of determination r2 of 0 92 and residual prediction deviation rpd of 2 07 while estimated bd based on the best ptf had rmse of 0 094 g cm 3 r2 of 0 70 and prd of 1 82 the results also showed that accuracy of the approach based on pss was determined by accuracy of estimated θ using vis nirs however it is limited to improve accuracy of estimated bd using the approach based on pss further by improving accuracy of estimated θ this study demonstrated that the approach based on pss is promising for estimating bd in future soil surveys keywords gamma ray attenuation visual near infrared spectroscopy pedotransfer function proximal soil sensing 1 introduction bulk density bd is a primary property of soils it is closely related to soil functions in hydrology agriculture environment etc by impacting tillage movements of plant nutrients water air and energy in soil plant root growth and so on costa et al 2013 yi et al 2016 lobsey and viscarra rossel 2016 tian et al 2018 qiao et al 2019 thus it is an important parameter in evaluating land drainage irrigation nutrient stock carbon stock pollutant mass balance biomass productivity etc li et al 2016 shiri et al 2017 tian et al 2019 however the traditional method for determining bd i e core sampling of a known volume of soil followed by drying at 105 c for 24 h usually is not very convenient to conduct because of stones and plant roots in soil and it is also laborious time consuming expensive destructive prone to measurement error quraishi and mouazen 2013a and b al asadi and mouazen 2014 tian et al 2018 as a result bd information is missing in a lot of routine soil surveys martin et al 2009 suuster et al 2011 reidy et al 2016 to meet extensive demands for bd information for agricultural activities ecological and environmental evaluations and modeling and many other scientific researches scientists developed a range of methods which are easy to be conducted free of labor non destructive or cost and time effective e g pedotransfer functions ptfs penetration resistance pr gamma ray attenuation thermo time domain reflectometry visible and near infrared spectroscopy vis nirs the method of ptfs is the earliest and most frequently used one jeffrey 1970 adams 1973 federer 1983 a ptf is an empirical function modeled between bd and readily measured soil properties such as organic carbon and texture and easily available soil information such as soil depth and soil type it can be modeled using many types of modeling methods varying from basic statistical methods to multivariate spatial statistics e g linear regression exponential equation and polynomial equation and to machine learning methods such as classification and regression trees tranter et al 2007 artificial neural networks ann yi et al 2016 qiao et al 2019 random forest ramcharan et al 2017 and generalized boosted models martin et al 2009 jalabert et al 2010 chen et al 2018 so given commonly measured soil properties such as organic carbon and texture the method of ptfs is relatively convenient to be conducted and hence has been widely used so far however the method of ptfs suffers several drawbacks suuster et al 2011 yi et al 2016 the most important drawback is that a ptf is specific to a geomorphic region or soil type meaning that it cannot be simply extrapolated beyond the geomorphic region or soil type from which it was developed mcbratney et al 2002 for example de vos et al 2005 found that predictive qualities of 12 published ptfs in literature for predicting bd were mostly different between topsoil and subsoil thus although a large number of ptfs have been published in literature it is still necessary to establish a new one for a specific area or to validate published ones for their applicability in a new area this unavoidably requires for soil data and modeling in a new area another drawback is that the accuracy of a ptf is complexly related to factors such as modeling techniques available soil properties and interested soils for example tranter et al 2007 presented that a ptf modeled using multiple linear regression mlr outperformed another one modeled using regression tree but later martin et al 2009 presented a contrary result different combinations of soil properties have been used in literature to develop a ptf and generally they performed differently in different cases de vos et al 2005 yi et al 2016 some studies suggested to divide interested soils into different ranges and developed a ptf for each range specifically harrison and bocock 1981 but some others found that this did not help to improve estimation accuracy de vos et al 2005 benites et al 2007 proximal soil sensing pss is another convenient method to measure bd which is also free of labor and cost and time effective in literature a lot of approaches had been developed using pss including gamma ray attenuation pr frequency domain reflectometry fdr and vis nirs particularly lobsey and viscarra rossel 2016 proposed to combine gamma ray attenuation and vis nirs for estimating soil bd in this way bd of wet soil is first determined using gamma ray attenuation and then it is corrected by subtracting volumetric water content θ estimated using vis nirs gamma ray attenuation has been proposed much earlier for measuring bd by luo and wells 1992 and wells and luo 1992 and vis nirs is often used to estimate many soil properties including water content e g gravimetric moisture content in al asadi and mouazen 2014 and mouazen and al asadi 2018 moreover data fusion is believed to be an important tool for improving prediction of soil properties using pss kuang et al 2012 for example al asadi and mouazen 2014 demonstrated an improvement in predicting gravimetric moisture content and θ using data fusion of vis nirs and fdr compared with single vis nirs or single fdr lobsey and viscarra rossel 2016 already showed that this approach of combining gamma ray attenuation and vis nirs estimated bd with rmse of 0 055 g m 3 and r2 of 0 90 much more accurately than those estimated bd based on gamma ray attenuation only i e without being adjusted using water content estimated using vis nirs thus data fusion of gamma ray attenuation and vis nirs probably could estimate bd very accurately similar to the method of ptfs the approach of combining gamma ray attenuation and vis nirs for estimating soil bd also has some drawbacks first mouazen and al asadi 2018 concerned about the negative influence of the radioactive energy source on human health however this can be overcome using a lead container as a shield actually viscarra rossel et al 2017 have already integrated gamma ray attenuation with digital camera and vis nirs into their soil condition analysis system for practical use second the accuracy of this approach for estimating bd is also influenced by those factors that can influence accuracy of estimation of θ to the best of our knowledge few studies so far have applied this approach for estimating bd i e lobsey and viscarra rossel 2016 viscarra rossel et al 2017 and wang et al 2019 the objectives of this study are to 1 apply the approach of combining gamma ray attenuation and vis nirs to estimate bd based on 120 core samples collected in a hilly subtropical area in china 2 establish ptfs for estimating bd of the same samples with commonly measured soil properties i e organic matter content omc contents of sand 0 05 2 mm silt 0 002 0 05 mm and clay 0 002 mm ph and soil depth and 3 compare accuracy of the approach and ptfs 2 materials and methods 2 1 soil sampling soil samples were collected in a hilly area of 1 6 km2 located in nanning southwest china within latitude 22 58 3 22 59 17 n and longitude 108 20 55 108 21 54 e the climate of this area is subtropical humid monsoon with an annual average temperature of 21 6 c and an annual average rainfall of 1300 6 mm the elevation of this area ranges between 130 and 300 m and the average slope of this area is 24 8 in history this area has been always used for forestry since two decades ago it has been under eucalyptus plantation soils of this area are derived based on mud stone mud shale and sand shale and they are latosolic red soil referred to ustisol in the u s soil taxonomy fifty eight sites of this area were selected to collect samples in terms of elevation aspect and slope among them 20 sites were sampled with a soil profile each genetic horizon of a profile was sampled by the core method using standard sharpened steel cylinders of 100 cm3 volume d 53 mm h 50 mm on the remaining 38 sites topsoil equivalent to the genetic horizon a was sampled in the same way depths of all the samples were recorded when sampling a total of 120 samples were collected 2 2 lab analysis after weighting the above core samples were scanned in laboratory using a vis nirs spectrometer fieldspec 4 analytical spectral devices asd boulder co usa the spectrometer has a spectral range of 350 2500 nm and a spectral resolution of 3 nm at 700 nm and 6 nm at 1400 and 2100 nm its sampling interval is 1 4 nm between 350 nm and 1000 nm and 1 1 nm between 1001 nm and 2500 nm it has a light source of a halogen bulb enclosed in an angle of 12 with a contact probe of detection fibers using the spectrometer 9 measurements were made at both ends of a core sample in order to account for soil variation and 10 spectra were recorded for each measurement in order to minimize noises and to maximize the signal to noise ratio the resulting 180 spectra of each core sample were averaged to represent the whole core sample at last the range of each averaged spectra was reduced to 400 2400 nm to eliminate noises at both edges and then each spectra was reduced by averaging 10 successive wavelengths after scanned using the vis nirs spectrometer each core sample was sealed tightly with scotch tape in order to retain moisture for the following gamma ray attenuation measurement the gamma ray attenuation measurements were made using gem18180 ortec usa with a high purity germanium gamma detector when the core samples were wet the radioactive source was 137cs with an activity of 185 mbq and a photon energy of 0 662 mev for each core sample the measurements were made axially through the center and three positions evenly offset the center the four measurements of each core sample were averaged to represent the whole core sample after the above measurement of gamma ray attenuation the core samples were dried at 40 c for 7 days and then were repeatedly weighted and dried until the weights of the samples were constant the weights before and after drying were used to calculate θ and bd the low temperature of 40 c was used in order to keep omc constant for the following laboratory analysis finally the samples were measured for omc using the potassium dichromate oxidation method soil ph using a ph meter 1 2 5 soil to water ratio and contents of sand silt and clay using the malvern panalytical mastersizer 2000 malvern uk a laser diffraction testing instrument 2 3 bulk density measured using proximal soil sensing following lobsey and viscarra rossel 2016 bd was estimated using the equation 1 ρ b γ 1 x μ s ln i 0 i μ w μ s ρ w θ where ρ b γ represents bd in g cm 3 x is the sample thickness in cm μ s represents the mass attenuation coefficients of dry soil in cm2 g 1 i 0 is the unattenuated radiation emitted from the source i is the incident radiation at the detector and μ w represents the mass attenuation coefficients of soil water in cm2 g 1 ρ w represents the density of soil water in g cm 3 μ s is assumed to be consistent for sensing soil bd with gamma ray attenuation in this study the μ s of wang et al 2019 i e 0 0856 cm2 g 1 was used because the soils were from the same study area the μ w and ρ w actually were measured using distilled water and they were also the same to those of wang et al 2019 0 0850 cm2 g 1 and 1 g cm 3 similarly the other parameters in eq 1 were also the same to those of wang et al 2019 except i and θ i is the measured gamma ray attenuations for individual soil samples θ is estimated based on the vis nirs measurement using plsr and they were validated in the section 2 5 2 4 pedostransfer functions mlr was used to establish a ptf in this study because it is simple straightforward for interpretation the above measured soil properties i e omc ph and contents of sand silt and clay as well as recorded soil depth were used in mlr to establish a ptf these properties were chosen because they are commonly measured in a soil survey so they are generally available correlations between the properties and with bd were first analyzed then all possible combinations of the soil properties that were significantly correlated with bd at a level of 0 05 but having no multicollinearity were used to establish a ptf based on ordinary least square using the lm function of r r core team 2016 meanwhile commonly used variable selection procedures for mlr i e backward forward and both directions stepwise methods were also tried based on all of the measured soil properties in order to search for the best combination of variables for establishing a ptf finally only ptfs that have every variable with a statistical significance at a level of 0 05 and have residuals being normally distributed simply evaluated by the q q plot were used to estimate bd 2 5 validation both leave one out cross validation loocv and cross validation with randomly split samples from the 120 collected samples were used to validate bd estimated using a ptf and pss as well as the above estimated θ based on vis nirs in loocv each sample was selected to validate the estimation made using the remaining 119 samples a taylor diagram was plotted to compare accuracies of the estimated bd in loocv in the cross validation with randomly split samples n samples were randomly selected to validate estimation made using the remaining samples for all ptfs and pss the same n samples and remaining samples were used in this study n ranged from 1 to 40 for each n the validation was repeated for 100 times and an averaged validation criterion over the 100 times was computed to represent the validation criterion for the n the following three criteria were computed in the validations as well as in calibration of ptfs root mean squared error rmse residual prediction deviation rpd also called prediction deviation ratio in literature and coefficient of determination r2 they were calculated as 2 r m s e 1 n i 1 n o b s i pred i 2 3 r 2 1 n 1 i 1 n p r e d i μ pred o b s i μ obs 2 σ pred 2 σ obs 2 4 r p d σ obs r m s e where obs i is the observed value of sample i pred i is the corresponding predicted value σ pred and μ pred denote standard deviation and mean of predicted values respectively and σ obs and μ obs denote standard deviation and mean of observed values respectively rmse indicates prediction precision by measuring the variance of prediction errors and is sensitive to an outlier a large rmse value indicates a high prediction error r2 measures the goodness of fit between the predicted and observed values and it has the optimal value of 1 indicating a perfect fit rpd measures the ratio of standard deviation of observed values divided by the rmse and it is widely used in literature of pss to compare predictions made by different models the larger a rpd the better predictions are according to quraishi and mouazen 2013b it is generally classified into three classes a rpd of smaller than 1 4 indicating a poor prediction a rpd between 1 4 and 1 8 indicating a fair prediction and a rpd of larger than 1 8 indicating a good prediction 3 results and discussion 3 1 basic statistics of the soil properties table 1 lists basic statistics of the soil properties fig 1 shows histograms of the soil properties these statistics suggest that the bd values of this study vary largely and cover general bd values in literature for example the 300 bd values in mouazen and al asadi 2018 vary between 0 879 g cm 3 and 1 671 g cm 3 with an average of 1 304 g cm 3 and a standard deviation of 0 130 g cm 3 the 1013 bd values in al asadi and mouazen 2014 vary between 0 71 g cm 3 and 2 08 g cm 3 with an average of 1 43 g cm 3 and a standard deviation of 0 22 g cm 3 in table 1 values of skewness and kurtosis for bd indicate that the distribution of the bd values of this study is closely normal which is verified by fig 1 a the variations of omc contents of sand silt and clay ph depths and θ vary in different degrees the variations of omc and depths are quite large as indicated by coefficients of variation of 59 79 and 54 26 this is attributed to the sampling method of this study about half of the samples i e 58 were collected in the genetic horizon a generally omc in the genetic horizon a is much larger than in deeper horizons thus the variation of omc in this study is large depths of the genetic horizon a are smaller than those of deeper horizons while soil profiles vary in depth across the hilly study area so the distribution of depths in fig 1 g is clearly right skewed and this is also indicated by the skewness for depth in table 1 the variations of contents of sand silt and clay are modest with coefficients of variation of 16 29 23 00 in table 1 the variation of θ was not big either as indicated by the coefficient of variation of 16 69 the variation of ph is the smallest indicated by the coefficient of variation of 10 11 this is because the samples of this study are collected in a small area with the same parent materials and climate however the distribution of ph is a little bit right skewed as shown in fig 1 f 3 2 pedotransfer functions table 2 lists correlations between the soil properties bd is strongly correlated with omc ph and depth at a statistical level of 0 01 and with the content of silt at a statistical level of 0 05 it is common to see significantly strong correlations between bd and these soil properties in literature qiao et al 2019 table 2 also shows that there are statistically significant correlations between the soil properties for example omc is statistically significantly correlated with ph and depth so these correlated soil properties would not be used together to establish a ptf to avoid multicollinearity based on the correlation analysis omc content of silt ph and depth are chosen for establishing a ptf for estimating bd using mlr these four soil properties lead to totally 15 combinations for establishing ptfs however only six of the 15 result in a ptf that has every variable being statistically significant and has residuals being normally distributed the six ptfs established based on them are shown in table 3 and are numbered from 1 to 6 for citing in the following four ptfs are established based on a single variable i e each of the four chosen soil properties and the other two are based on two variables i e omc and silt and silt and depth respectively the two pairs in the last two ptfs do not correlate with each other according to table 2 based on all of the soil properties the backward and both directions stepwise procedures all select omc and silt for establishing a ptf although the forward direction stepwise procedure select all of the properties for establishing a ptf only omc and silt have statistical significances at a level of 0 05 thus the three variable selection procedures suggest omc and silt for establishing a ptf i e the ptf 5 discussed in the above the six ptfs explained 4 5 71 of the variation of bd in terms of r2 table 3 ptf 5 based on omc and the content of silt has the largest r2 i e 0 71 which is very closely followed by ptf 1 based on om only this suggests that om plays a major role in explaining variation of bd in this study in contrast the content of silt plays a minor role this minor role plays by the content of silt is verified by the r2 of ptf 2 based on this soil property only i e 0 045 the smallest r2 in table 3 ptf 6 based on the content of silt and depth has the third largest r2 i e 0 40 closely followed by ptf 4 based on depth only with a r2 of 0 35 ptf 3 based on ph only has the second smallest r2 i e 0 085 just a little larger than the smallest one de vos et al 2005 summarized r2 of 12 published ptfs and showed that they vary between 0 41 and 0 96 comparatively in this study except the two ptfs based on the content of silt and ph respectively the other four ptfs all have r2 close to those summarized in de vos et al 2005 however the ptfs summarized in de vos et al 2005 are much more complex than the ptfs of this study since the former take different transformations of a soil property e g natural logarithm transformation or different types of linear functions e g exponential linear and power linear although it might be possible for r2 of the ptfs in table 3 to increase if such transformations and functions are adopted de vos et al 2005 found no substantial enhancement in r2 due to including second and third polynomials in modeling a ptf so it remains a question for future studies to investigate if different forms of a soil property could help to increase r2 of a ptf recently ptfs established in quraishi and mouazen 2013a using mlr have r2 ranging from 0 04 to 0 51 smaller than r2 of the ptfs in table 3 this shows that the ptfs of this study are generally good in table 3 values of rmse and rpd of the models are also in the same order of r2 particularly values of rpd suggest that ptfs 1 and 5 predict fairly on the calibration data while the other four ptfs predict poorly however these values of rmse and rpd might be biased because they are derived from the calibration data 3 3 volumetric water content estimated using proximal soil sensing fig 2 shows coefficients of correlation between vis nirs reflectance and θ of soil samples at individual wavelengths ranging from 404 5 nm to 2404 5 nm clearly the correlations are all negative except at the wavelengths of 434 5 454 5 nm and 524 5 834 5 nm shaded in fig 2 the correlations are significant at a statistical level of 0 05 or 0 01 this suggests that it is possible to use the vis nirs spectra to estimate θ fig 3 presents accuracy criteria for the estimated θ based on vis nirs using plsr in loocv rmse is not very big i e 3 0 accounting for 12 of average θ of the samples in table 1 however r2 and rpd from loocv are not very high either i e 0 52 and 1 4 respectively so these results from loocv suggest that accuracy of the estimated θ based on vis nirs using plsr is poor in the validation using randomly split samples values of these accuracy criteria for estimated θ vary with the number of samples for modeling as shown in fig 3 rmse varies between 2 45 and 3 21 accounting for 9 7 to 12 of average θ of the samples r2 varies between 0 49 and 1 while rpd varies between 1 31 and 2 24 these results suggest that accuracies of the estimated θ in the validation using randomly split samples are mostly just fair or even poor while only sometimes they are good for example 55 of the rpd values are between 1 4 and 1 8 and 42 5 are smaller than 1 4 while only 2 5 of the rpd values are larger than 1 8 3 4 bulk density estimated using pedotransfer functions and proximal soil sensing fig 4 presents scatter plots of measured versus estimated bd in loocv meanwhile estimated bd using pss without corrections for water content are also presented i e the black dots in fig 4 g which are called pss 1 in the following estimated bd using pss with corrections for water content based on vis nirs i e the black dots in fig 4 h are called pss 2 in the following besides estimated bd using pss with corrections for water content based on oven dry are also presented i e the red circles in fig 4 g and h taylor diagram for the estimated bd is shown in fig 5 clearly pss 2 in fig 4 h are the closest to the measured bd while pss 1 in fig 4 g consistently bias from the measured bd among the ptfs ptfs 1 and 5 are the closest to the measured bd whereas ptfs 2 and 3 are the furthest this order appears again in the taylor diagram of fig 5 except pss 1 moving very close to pss 2 the move of pss 1 is attributed to the fact that the taylor diagram is based on standard deviation of differences between estimated and observed bd values ignoring average of the differences as shown in fig 4 g although pss 1 is regressed very well with the measured bd resulting in a high correlation in the taylor diagram of fig 5 they are the most biased away from the 1 1 line the bias indicates that they are larger than the measured bd obviously the biases are attributed to the uncorrected water contents in the core samples fig 6 shows accuracy criteria of the estimated bd of ptfs 1 6 and pss 1 2 in loocv pss 2 has the smallest rmse i e 0 082 g cm 3 accounting for 6 03 of average measured bd in table 1 and it also has the largest r2 and rpd i e 0 92 and 2 07 respectively thus these accuracy criteria suggest that pss 2 is the most accurate among all ptfs ptf 5 has the smallest rmse i e 0 094 g cm 3 and it has the largest r2 and rpd i e 0 70 and 1 82 respectively so pss 2 is much more accurate than the most accurate ptf i e ptf 5 compared with ptf 5 pss 2 decreases rmse by 12 and increases r2 and rpd by 31 and 14 respectively the order of accuracies of the ptfs is the same to that of modeling r2 of the ptfs in table 3 inferring that accuracy of a ptf is determined by modeling r2 of the ptf at last pss 1 has the largest rmse and the smallest rpd suggesting that pss 1 is the worst prediction although r2 of pss 1 is the second largest this is due to the good regression relationship between pss 1 and the measured bd as shown in fig 4 g it is already explained in the above that pss 1 biases the most away from the measured bd similar to the results from loocv results from the validation using randomly split samples fig 6 also suggest that pss 2 is more accurate than ptfs 1 6 except for the rpd values from validations based on samples 2 compared with the best ptf i e ptf 5 pss 2 decreases rmse by 2 42 17 09 and increases r2 and rpd by 0 34 and 10 22 respectively pss 1 is still the worst besides results from the validation using randomly split samples also suggest that accuracy of a ptf is determined by modeling r2 of the ptf as the order of accuracy criteria of the ptfs is the same to that of modeling r2 of the ptfs in table 3 when the number of samples for validation is larger than 20 values of the accuracy criteria are relatively stable and r2 values from the validation are close to modeling r2 values of the ptfs the best ptf established in quraishi and mouazen 2013a using mlr with pr moisture content omc and content of clay results in rmse of 0 13 g cm 3 and r2 of 0 51 in validation qiao et al 2019 repeatedly validated five published ptfs and a new one established using mlr with omc content of clay and or soil depth original or natural logarithm transformed for their own study area and reported rmse of 0 079 0 612 g cm 3 and r2 of 0 003 0 356 yi et al 2016 also repeatedly validated 14 published ptfs and newly established ones using mlr and ann with omc content of clay bd of organic matter and minerals organic carbon and soil depth for their own study area and reported rmse of 0 14 0 54 g cm 3 and r2 of 0 22 0 72 so the best ptf of this study i e ptf 5 with rmse of 0 094 g cm 3 and r2 of 0 70 is much more accurate than most of these reported in literature quraishi and mouazen 2013b developed a pss model for estimating bd which combing pr and vis nirs estimated moisture content omc and clay content using ann their model estimates bd with rmse of 0 08 g cm 3 and r2 of 0 84 when validating and when testing rmse and r2 are 0 04 g cm 3 and 0 94 respectively al asadi and mouazen 2014 developed pss models for estimating bd which combining vis nirs measured gravimetric moisture content and fdr measured θ they used both plsr and ann for modeling and the ann based model presents a better accuracy in validation with rmse of 0 095 g cm 3 and r2 of 0 81 in mouazen and al asadi 2018 a similar pss model results in rmse of 0 061 0 086 g cm 3 r2 of 0 57 0 86 and rpd of 1 51 2 60 for different levels of moisture content in validation lobsey and viscarra rossel 2016 used the same approach of this study but a different modeling technique for estimating θ i e ann their model results in rmse of 0 055 g cm 3 and r2 of 0 897 in validation so comparatively accuracy of pss 2 of this study is similar to or better than those published the comparison between pss 1 and 2 shows that correcting estimated bd using estimated θ is important for estimating bd based on pss this can be clearly seen in eq 1 in fig 4 h pss 2 is much closer to measured bd than pss 1 in fig 4 g and fig 6 clearly shows that pss 2 is much more accurate than pss 1 for example the loocv in fig 6 suggests that compared with pss1 pss 2 decreases rmse by 59 and increases r2 by 5 5 and rpd by 145 however improving estimation accuracy of θ further could not lead to an equivalent improvement in estimation accuracy of bd as shown in fig 4 g estimated bd corrected using measured θ also deviate a little from the 1 1 line and in fig 4 h they are quite close to pss 2 in fact estimated bd corrected using measured θ have rmse of 0 080 g cm 3 r2 of 0 94 and rpd of 2 12 so the improvements in accuracy of these bd over pss 2 are very small i e 2 4 of decrease in rmse 3 2 of increase in r2 and 2 5 of increase in rpd this can be attributed to measurement errors in laboratory analysis on θ in addition this is also because θ and its parameter in eq 1 are not large as shown in table 1 θ in weight averagely accounts for 18 65 of bd in eq 1 its parameter is 0 99 g cm 3 4 conclusions this study applied the approach based on pss i e combining gamma ray attenuation and vis nirs to estimate bd using 120 core samples collected in a hilly subtropical area in china and compared it with another commonly used convenient and efficient approach for estimating bd i e ptf it demonstrates that the approach based on pss is more accurate than the other the former leads to estimated bd values close to the measured ones with rmse of about 0 082 g cm 3 r2 larger than 0 90 and rpd larger than 2 00 in contrast the latter leads to estimated bd values biased much more away from the measured ones with rmse larger than 0 094 g cm 3 r2 smaller than 0 70 and rpd smaller than 1 80 besides this study also shows that accuracy of the approach based on pss is mainly determined by the accuracy of estimated θ using vis nirs nevertheless improving accuracy of estimated θ further could only lead to a small improvement in accuracy of the approach based on pss this study summarizes that the approach based on pss is promising for estimating bd in future soil surveys declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this research is financially supported by the national natural science foundation of china 41771246 and 41541006 prof jun li at school of geography and planning sun yat sen university china provided the vis nirs spectrometer for this study mr qi luo at college of physics and energy shenzhen university china provided gem18180 for this study we are grateful to them 
6094,large scale reservoirs play an essential role in water resources management for agriculture irrigation water supply and flood controls however we need robust reservoir operation systems under both normal flow and extreme flow conditions in this study we applied recurrent neural networks rnn to simulate the operation of three multi purpose reservoirs located in the upper chao phraya river basin two reservoirs have the function of multiannual flow regulation and one has the function of incomplete annual regulation the goal of this study is to explore the applicability of rnn models for operation of reservoirs with multiannual flow regulation under different flow regimes especially under extreme floods and droughts we used three rnns namely nonlinear autoregressive models with exogenous input narx long short term memory lstm and genetic algorithm based naxr ga naxr for reservoir operation based on historical data for real time water resources management an accurate inflow forecast is required to provide a real time reservoir outflow and thus we also carried out a real time reservoir operation using the rnn and the inflow forecast by a distributed hydrological model results show that 1 ga narx has the highest accuracy among three rnns and is more stable than the original narx by optimizing the initial conditions although it takes longer training time than narx and lstm 2 ga narx based operation model is effective under extreme floods and droughts and 3 the real time operation system combining the ga narx and the distributed hydrological model has reasonable accuracy in both wet season and dry season rnn based operation model developed in this study has potential applicability in practical water management and the model combining the hydrological prediction is specially useful for real time reservoir operation keywords recurrent neural networks real time reservoir operation inflow forecast by distributed hydrological model the upper chao phraya river basin 1 introduction as an important infrastructure for water resources management and utilization reservoirs provide us many benefits such as controlling flood mitigating drought irrigating agriculture generating hydropower and supplying water resources chang and chang 2006 lehner et al 2011 zhang et al 2018a real time reservoir operation including accurate real time inflow forecast is required for realizing the above functions coulibaly et al 2000 lin et al 2009 louks and sigvaldason 1981 valipour et al 2013 zhang et al 2018a previous studies on real time reservoir operations showed that simulation models can provide more detailed and realistic representation of reservoir operations with lower computational demands and are more readily accepted by operators in practice lund and guzman 1999 uysal et al 2016 yang et al 2016 conceptual or physical based models are widely used to simulate the controlled outflow and water level of single or multiple reservoir systems for example sigvaldson 1976 developed a mathematical reservoir simulation model for a multipurpose multiple reservoir system based on the concept of priority georgakakos and marks 1987 proposed an efficient method for the real time operation by using a set of stochastic differential equations to describe the dynamics in reservoirs with the increasing development in river dynamics and computer technology many advanced and complex simulation models have been developed and widely used in practice such as the hec ressim model klipsch and hurst 2007 the weap model purkey 2005 and the calsim model draper et al 2004 these physical based models provide solid foundations for estimating reservoir outflow and storage zhang et al 2018a through combing operation patterns described mathematically and empirical operation rule curves based on historical hydrological data since the process of reservoir operation is transparent and interpretable in physical based models it is easier for operators to understand and achieve the water management goal however simulation models are effective when the predefined operation policies established in the model reflect the actual operation process johnson et al 1991 yang et al 2016 in actual reservoir operations it is widely acknowledged that operators often add their own judgment to adapt to specific conditions objectives or constraints existing at various situations operation curves are often used as a reference or guideline oliveira and loucks 1997 and the applicability of the physical model based on pre established rule curves is insufficient for reservoir operation in real time especially during the extreme flood events chang and chang 2001 saavedra valeriano et al 2010 an actual reservoir operation process sometimes deviates from the operational plan due to the operators judgement or knowledge for managing emergencies such as floods and droughts this makes the physical models difficult to accurately simulate real time reservoir operation johnson et al 1991 oliveira and loucks 1997 zhang et al 2018a therefore it needs to develop an efficient and easy to use reservoir simulation model based on the reservoir input and output data which can take the operators historical experience into account without the requirement of huge data for water resources management in the downstream to overcome the limitations of physical models hydrologists tried data driven models to simulate the hydrological processes recently machine learning ml techniques have been applied in hydrological time series forecast bai et al 2016 chen et al 2013 hung et al 2009 nasseri et al 2008 yu et al 2017 as for the application in reservoir operation the black box nature of most ml models could make it difficult for operators to understand the process however since machine learning methods have super abilities to fit complex high dimensional relationships they have been increasingly used for extracting the actual operation rules based on the historical records of inflow and outflow which contains the empirical knowledge for dealing with the extreme flows and time varying demands from the downstream corani et al 2009 rasouli et al 2012 wang et al 2010 yang et al 2016 zhang et al 2018a among many machine learning models multilayer perceptron models mlps support vector machine and regression svm and svr and classification and regression tree cart have been applied for reservoir operation simulation with the back propagation bp algorithm and time delayed input variables mlp models were successfully used to simulate the outflow of reservoirs chaves and chang 2008 jain et al 1999 however mlps have several limitations such as local optimal solutions and gradient disappearance to practical applications zhang et al 2019 based on statistical learning theory svm or svr is widely used in the field of reservoir operation aboutalebi et al 2015 ji et al 2014 lin et al 2006 and reported to have better prediction accuracy of reservoir discharge over traditional artificial neural networks lin et al 2006 svm has the advantages of fast training speed and provides the best solutions but it still has several limitations such as the sensitivity to the choice of the kernel function and no guarantee to learn exact parameters for the best solutions patle and chouhan 2013 yan et al 2003 as a type of decision tree models cart was used to extract the actual reservoir operation pattern combined with a shuffled cross validation scheme and the controlled release and storage trajectories of nine major reservoirs in california were simulated yang et al 2016 however most of the previous studies tested the ml models for a short period which may not sufficient to demonstrate their applicabilities in different flow regimes especially in extreme flood and drought conditions with the feedback on both time delayed input and output rnn can preserve and remember the short past and long past information and therefore it is preferred for a complex dynamic timing and sequential problem adi et al 2017 chung et al 2016 koutnik et al 2014 zhang et al 2019 although the rnn still suffers from limitations of longer time consumption the gradient vanishing and exploding problems it is preferred for simulation of reservoir operation with dynamic process and high dependence on the historical information zhang et al 2018a compared three machine learning models namely the artificial neural network support vector regression and long short time memory lstm in simulations of reservoir operation at the gezhouba dam and reported that lstm was a type of rnn which had the best overall performance however gezhouba dam is a hydropower plant without storage zhang 2004 and has very limited flow regulation capacities sharma and singh 2013 in this case inflow and outflow are highly correlated by using three recurrent neural network models zhang et al 2019 simulated xiluodu reservoir operation which has an incomplete annual regulation ability chen 2015 further studies are desired to verify effectiveness of rnn for the large reservoirs with multiannual flow regulation capacities especially a focus on simulating reservoir operation in the extreme hydrological conditions floods and droughts is required nonlinear autoregressive model with exogenous input narx lin et al 1996 menezes jr and barreto 2008 and long short term memory lstm model greff et al 2017 hochreiter and schmidhuber 1997 are two widely used rnns with different model structures in hydrological time series forecast compared with conventional neural networks narx adds loops to feed the previous input and output back to the network and pass the information from one step to the next and the feedback delays including input delays and output delays represent the lag time of input and output with input vectors built through tapped delay lines narx model can be efficiently applied to long term prediction of nonlinear time series chang et al 2016 menezes jr and barreto 2008 with chain like modules similar to narx lstm network adopts memory blocks that are composed of an input gate an output gate a memory cell and a forget gate gers 2002 these components are recurrently connected to each other and located between the input and the output layers to replace hidden layers so as to filter out nonessential information while preserving useful information from the long past shen 2018 the two models have been applied for sewer overflow monitoring and groundwater level prediction chang et al 2016 shen 2018 wunsch et al 2018 zhang et al 2018b but there are few applications for operation simulation of reservoirs with multiannual flow regulation especially under extreme flood and drought conditions physically based hydrological models have been widely used for hydrological simulation and forecast mateo et al 2015 among them the geomorphology based hydrological model gbhm yang et al 1998 yang et al 2002 has been successfully used in many catchments of china and asia such as yangtze river li et al 2015a mekong river wang et al 2016 and jiulong river lu et al 2018 to provide downstream water managers an outflow forecast with one day in advance at least it is desired to test the gbhm for inflow forecast in a real time reservoir operation chao phraya river basin covers about 30 of the total territory of thailand and a large amount of farmland and several big cities such as chiang mai nakhon sawan bangkok etc are within the basin the agriculture economics and life of this basin are seriously affected by the frequent floods and droughts benfield 2011 promchote et al 2016 and the thailand government highly relies on reservoirs in the upstream for water resources management hungspreug et al 2000 with the challenge of climate change and population growth reservoir operation is under great pressure and operators need a high efficiency reservoir operation model as a decision supporting tool for coping with rapidly changing environments in addition an efficient real time outflow forecast for managing the floods and droughts in the downstream regions is also required therefore the reservoir operation tools need to be improved due to the rapidly changing environments and development of the rnn offers an opportunity in the reservoir operations in the upstream of chao phraya river in thailand in this study we use rnns to extract the reservoir operation rules from the historical operation data and use gbhm to carry out the reservoir inflow forecast combining the rnn based reservoir operation model with the hydrological model a real time reservoir outflow forecast is achieved as a case study including two multiannual regulation reservoirs and one incomplete annual regulation reservoir three multipurpose reservoirs located in the upper chao phraya river basin are chosen to examine the performance of the real time operation system this study strives to 1 verify effectiveness of rnn in reservoir operations for the multipurpose reservoirs with multiannual flow regulations 2 test the applicability of the rnn based operation model for different flow regimes including the extremely high and low flows and 3 develop a real time reservoir operation system by combining a distributed hydrological model for providing reservoir outflow forecast with a one day leading time 2 study area and data 2 1 the upper chao phraya river basin and three reservoirs in thailand this study choses three multipurpose reservoirs including the bhumibol reservoir the sirikit reservoir and the khwae noi bamrung dan reservoir located in the upper chao phraya river basin and the upstream of reservoirs as the study area see fig 1 the upper chao phraya river basin is located in northern thailand and its drainage area is 110 569 km2 tebakari et al 2012 the climate is tropic monsoon and the mean annual precipitation is about 1 200 mm on average 85 of the total annual rainfall occurs between may and november wet season while the dry season is from december to april ponpang nga and techamahasaranont 2016 the bhumibol reservoir constructed across the ping river is located at 17 24 degrees of north latitude and 98 97 degrees of east longitude and is the largest reservoir in thailand with multiannual flow regulation it has a drainage area of 26 386 km2 with total storage capacity of 13 426 billion m3 and has a surface area of 316 0 km2 the reservoir is built for water storage and irrigation for agricultures flood control fisheries saltwater intrusion management as well as hydroelectric power generation supratid et al 2017 the sirikit reservoir constructed across the nan river has a drainage area of 13 130 km2 with total storage capacity of 10 508 billion m3 and has a surface area of 260 0 km2 the sirikit reservoir is also a multipurpose reservoir with multiannual flow regulation the khwae noi bamrung dan reservoir constructed across a tributary of the nan river has a drainage area of 4 254 km2 with total storage capacity of 769 million m3 and this reservoir is a multipurpose reservoir with incomplete annual regulation 2 2 data data used in this study include data of the inflow storage and release of three reservoirs geographic information for the upstream of the reservoirs and climate forcing data qin et al 2017 the climate forcing data include daily precipitation daily air temperature mean maxima and minima daily mean wind speed daily mean relative humidity and daily sunshine duration those data except daily mean wind speed are observed at 14 meteorological stations and 96 rainfall stations managed by royal irrigation department of thailand within the upper chao phraya river basin the daily mean wind speed is obtained from the global land data assimilation system rodell et al 2004 except wind speed data other climate data are spatially interpolated with an angular distance weighting method with elevation corrections yang et al 2004 the spatial resolution of the gridded climate forcing dataset is 2 5 km 2 5 km the soil water parameters including saturated soil moisture residual soil moisture and soil hydraulic conductivity are estimated using the method proposed by rawls and brakensiek 1985 the soil data of the upper chao phraya river basin are taken from the harmonized world soil database hwsd fao et al 2012 the land use map is provided by department of land development information of thailand and the changes of land use during simulated period are ignored the shuttle radar topography mission srtm digital elevation model dem with a spatial resolution of 90 m jarvis et al 2008 is used in this study the vegetation parameters used in this study include the leaf area index lai and the fraction of photosynthetically active radiation fpar which are derived from the 3rd generation of normalized difference vegetation index ndvi3g of the global inventory modeling and mapping studies gimms zhu et al 2013 the historical daily inflow data daily water storage data and daily controlled outflow data of three reservoirs are selected to derive the reservoir operation rules while the daily evaporation data of the reservoirs are used to calculate the storage trajectories these daily data are all gathered form the royal irrigation department of thailand and the daily reservoir operation data of three reservoirs are shown in fig 2 3 methodology 3 1 problem formulation we work on three multipurpose reservoirs which all have a concrete dam fig 3 shows the simplified schematic diagram of the operation system for the functions of irrigation downstream water supply power generation and flood control to meet the demand of various functions the operators regulate the reservoir release through controlling the sluice gates when the downstream water demand exceeds the water requirement of the power generation the excess water will be released through the spillway otherwise the required water will be released through the power station to meet the objective of power generation the water from the spillway and the power station will join at the tail water reach and the sluice gates will split the water to meet the demand of irrigation water supply and the environmental flow requirements of downstream ahmed and sarma 2005 the process of the operation can be expressed as 1 q out t f q in t s t 1 d h e where q out t is the outflow which is the decision variable in reservoir operation f represents the operation rules q in t and s t 1 represent the reservoir inflow and the initial storage respectively and d is the total water demand which includes the requirements of irrigation water supply power generation and environmental flow of downstream in addition the reservoir operation namely the operation of sluice gates also needs the historical experience he which mainly contains operation curves as reference and empirical successes or operators knowledge in actual practice lund and guzman 1999 mateo et al 2015 although it is difficult to accurately describe the empirical knowledge or judgment it is implied in the historical operation data this provides the possibility of application for the data driven ml models since the relationship between the operation rules and various objectives also can be reflected in the historical operation data the historical inflow outflow and storage data are used to extract the operation rules through rnns additionally there are also other constraints in reservoir operation including water balance equation hydrology constrains for storage and outflow nagesh kumar and janga reddy 2007 the water balance equation can be expressed as 2 s t 1 s t δ t 2 q in t q in t 1 δ t 2 q out t q out t 1 where δ t is a short time interval for routing the hydrological constrains for storage and outflow can be expressed as 3 s dead s t s max 4 0 q out t where sdead is the dead storage and smax is the full storage in this study we use three rnns to learn the operation polices from the historical operation data and then construct the reservoir operation model to simulate the reservoir outflow 3 2 machine learning methods in this study all data were split into training 70 of data validation 15 and testing 15 for machine learning models as for the bhumibol reservoir the training period is from 1 january 1970 to 31 december 1997 the validation period is from 1 january 1998 to 31 december 2003 and the test period is from 1 january 2004 to 31 december 2011 as for the sirikit reservoir the training period is from 1 january 2003 to 30 april 2013 the validation period is from 1 may 2013 to 15 july 2015 and the test period is from 16 july 2015 to 30 september 2017 as for the khwae noi bamrung dan reservoir the training period is from 1 january 2009 to 18 february 2015 the validation period is from 19 february 2015 to 9 june 2016 and the test period is from 10 june 2016 to 30 september 2017 3 2 1 basic narx model we use a nonlinear autoregressive model with exogenous input narx which belongs to the class of recurrent neural networks rnns and is regarded as a well suitable algorithm to model the discrete time nonlinear dynamic systems the architecture of the narx model is shown in fig 4 and it can be mathematically expressed as 5 y n 1 f y n y n d y x n x n d x where x n and y n are the input and output of the model at time step n respectively and dx 1 and dy 1 are the input delay and output delay respectively the function f is generally unknown and needs to be approximated ardalani farsa and zolfaghari 2010 both input and the output can be multivariate time series and a general narx model with more than one input and one output can be expressed as 6 y n 1 f o b o h 1 n w ho f h b h k 1 nx i 0 d x w ikh x k n i j 0 d y w jh y n j where f0 and fh are the activation functions of hidden layer and output layer and wh0 wikh and wjh are the weights of connections among layers variables bo and bh are biases n is the number of hidden neurons and nx is the number of inputs the detail of narx can be found in lin et al 1997 and menezes jr and barreto 2008 the architecture of narx is mainly determined by two hyper parameters which are the time delays dx and dy and the number of hidden neurons in hidden layers n in this study the time delay of input dx are set equal to that of output dy the detailed hyper parameter tuning process and the results are given in the supplementary material we use levenberg marquardt method for training and the parallel mode for building the model which means the output values are used as input recurrently in addition we use the tanh function as the activation function 3 2 2 ga narx model as shown in eq 6 the parameters of narx include weights and biases the selection of proper weights and biases is important for narx performance however parameters including weights and biases of neural networks are often trained by gradient based optimization methods which may lead to premature convergence and the tendency of being trapped in local optimums yang et al 2017 moreover gradient based optimization schemes are very sensitive to initial conditions and different initial weights and biases may lead to different solutions yang et al 2017 zanchettin and ludermir 2007 one remedy for the issue is to start from a good set of initial values that could lead to the best optimal solutions bahrami et al 2016 genetic algorithm ga is one of the most widely used evolutionary optimization algorithms which is inspired by biological evolution and imitates the rules of survival of the fittest in biological evolution soleimani and kannan 2015 wang 1991 wang 1997 and the detail of ga can be found in davis 1991 in this study we use ga to optimize the narx model parameters ga narx with the objective function of mean square errors mse the architecture of ga narx is given in fig 4 both narx and ga narx models are realized by the matlab software beale et al 1992 3 2 3 lstm model a long short term memory lstm model is also a type of rnns with the hidden layer replaced by a specially designed memory block that is composed of an input gate an output gate a memory cell and a forget gate the input gate determines that which new information generated by the memory cell will be stored in the cell state and the forget gate determines which information to remove from the cell state the structure of the lstm model is shown in fig 5 and a general memory block of lstm model can be expressed by the following equations 7 c n 1 σ w f x n 1 w f y n b f c n σ w i x n 1 w i y n b i tanh w c x n 1 w c y n b c 8 y n 1 σ w o x n 1 w o y n b o tanh c n 1 where c is the cell state and w and w are the weights of the connections between gates and layers bi bf bo and bh are the biases symbol σ and tanh are activation functions from the equations above we can see that the lstm model is totally different from the narx model in terms of architecture and prediction methods the detailed expression and applications of lstm can be found in hochreiter and schmidhuber 1997 and greff et al 2017 in this study the initial learning rate and the number of the hidden nodes are two hyper parameters need to be determined the detailed results of hyper parameters tuning are shown in the supplementary material for comparison we set the time delays of lstm same as narx models and adopt a three layer lstm which consists of one input layer one lstm hidden layer and one output layer like narx the backpropagation through time bptt algorithm werbos 1990 is used to train the lstm model and the adaptive moment estimation adam algorithm kingma and ba 2014 is used as the learning rate method the loss index chosen in this study is mean square error mse and the tanh and sigmoid functions are selected as the activation functions the lstm model is realized by keras module with the backend of tensorflow module abadi et al 2016 of python to better evaluate the reservoir operation models we compare the performance of the models under different flow regimes they include high flow low flow and intermediate flow which are determined by the 25th and 75th percentiles based on the outflow frequency distribution curve zhang et al 2018a in addition the daily trajectories of the reservoir storage are also calculated during the test period according to the water balance equation see eq 2 using the simulated outflow 3 3 the geomorphology based hydrological model gbhm this study uses gbhm to forecast the inflow of the bhumibol reservoir in gbhm the river network is extracted from a digital elevation model dem using a flow accumulation method and ordered using the horton strahler scheme the entire catchment is divided into a series of sub catchments and each sub catchment is divided into several flow intervals to ensure that the grids in the same interval have the same flow distance simulation of the hydrological processes in the gbhm model is mainly composed of two parts hydrological simulation at each hillslope unit and river routing along the river networks ma et al 2010 the hillslope hydrological simulation includes the calculation of canopy interception evapotranspiration infiltration surface flow unsaturated flow and groundwater flow the river routing along the networks is solved using the kinematic wave method by accumulating the hydrological simulations of each grid the total runoff in each interval can be generated and the river discharge at the outlet of each sub catchment is yielded with the accumulation of the interval runoff the details of the model can be found in yang et al 2002 in this study the 2 5 km 2 5 km is selected as the grid resolution of the gbhm and the whole basin is divided into four classes with a total of 58 sub basins and ordered by the horton strahler scheme a six year warm up run is used to activate the gbhm and initialize the hydrological conditions qin et al 2017 most parameters of gbhm are defined according to their physical meaning either obtained from situ observations or global databases only a few parameters need to be calibrated such as the saturated hydraulic conductivity of the topsoil groundwater hydraulic conductivity and slope shape factor the detailed information of the parameters can be found in miao et al 2016 since gbhm is used to forecast the reservoir inflow in this study the error caused by the meteorological forecast is not considered which means the observed meteorological data are used as the forcing data to drive the model limited by the gauged meteorological data the hydrological simulation by gbhm starts from 1 january 1997 since process based hydrological models usually adopt calibration and validation to achieve the stable performance qin et al 2017 the daily inflow data of bhumibol reservoir from 1 january 1997 to 31 december 2002 are used to calibrate the parameters and the validation period is set from 1 january 2003 to 31 december 2011 3 4 simulating reservoir operations 3 4 1 reservoir operation models based on rnns in this study three large reservoirs are selected for simulating the reservoir operation and the daily reservoir operation data including inflow outflow and storage data are used to construct the data driven reservoir operation model the operation data are classified into predictor variables inputs and target variable output the first type of predictor variable is the reservoir inflow which is dependent on the natural upstream flows and represents the hydrological processes of the upper basin as the utility of forecasts in reservoir operation has long been recognized anghileri et al 2016 klemeš 1977 yao and georgakakos 2001 and the benefits of short term weather forecast have been widely accepted nayak et al 2018 the inflow forecast for the current day and next two days is also adopted as the predictor variables therefore in this study the inflows of the previous two days q in t 2 q in t 1 current day q in t and the future two days q in t 1 q in t 2 are chosen as the predictor variables the second type of predictor variables is the reservoir storage volume or a state variable which is widely used to guide the reservoir releases the outflow is always determined according to the storage volume or water levels required in the rule curve that sets the desired operation criteria based on historical experience to meet different objectives such as water supply flood control irrigation and hydropower generation therefore according to the water balance equation eq 2 the initial storage s t 1 is selected as a predictor variable the target variable is the reservoir daily outflow q out t on the current day after the target and predictor variables are determined the reservoir operation model based on rnns can be developed 3 4 2 real time reservoir operations with the combination of the reservoir operation rules derived by the rnn based models and the inflow forecast by the hydrological model a real time operation system of bhumibol reservoir can be obtained since the reservoir operation is mainly embodied in the control of the release or outflow from the reservoir the real time operation can be represented by real time outflow forecast to carry out the real time operation first the inflow forecasts of the current day and the next two days predicted by gbhm model are used as the input variables q in t 1 q in t 2 and q in t of the developed rnn based reservoir operation model second the observed inflows of the past two days and the observed storage of the previous day are used to update the inflow variables q in t 2 q in t 1 and the initial storage variable s t 1 of the reservoir operation model to ensure that the historical inputs are the observed values with the daily updated input variables run the rnn based model and the real time reservoir outflow forecast can be achieved see the framework of the real time operation system shown in fig 3 the bhumibol reservoir is selected as a case study to develop the real time reservoir operation system with the data from 1 january 2012 to 6 july 2015 3 5 model performance evaluation we used root mean square errors rmse and pearson s correlation coefficients r to evaluate the performance of the models percent bias pbias and the nash sutcliffe efficiency nse nash and sutcliffe 1970 which are both widely used to evaluate the accuracy of the hydrological model are also chose to describe the statistical properties of the models in this study moriasi et al 2015 the r and nse are two normalized statistical indexes and a value closer to 1 indicates a better simulation as recommended by previous studies the model performance can be judged satisfactory for flow simulations if daily monthly or annual r greater than 0 84 nse greater than 0 50 15 p b i a s 15 and the rmse is less than half of the standard deviation of the observed data for watershed scale models moriasi et al 2007 yang et al 2016 zhang et al 2018a in addition we also adopt the difference of the occurrence day of the annual maximum flood damfd to represent the timing error of the models and a positive value means that the simulated flood peak time lags behind the measured value since only the largest flood in a year is identified in the annual maximum flood series amf and several large floods are usually ignored this study used the peaks over threshold method pot to overcome this drawback a threshold that leads to three events per year is used and the details of the amf and pot can be found in lang et al 1999 and mediero et al 2014 4 results in this section we compared simulations of the reservoir operation by three rnns and presented the results of reservoir inflow simulation by gbhm model and the accuracy of real time reservoir operations 4 1 model performance comparison in reservoir operation simulation this section compares the simulated reservoir outflow by three rnns to evaluate their performances as for narx and ga narx the results of hyper parameter selection show that the models with 8 time delays and 5 hidden neurons for the bhumibol reservoir 10 time delays and 8 hidden neurons for the sirikit reservoir and 11 time delays and 9 hidden neurons for the khwae noi bamrung dan reservoir have the most stable and accurate performance as for lstm the results of hyper parameter selection indicate that the models with the learning rate of 0 025 and 64 hidden nodes for the bhumibol reservoir the learning rate of 0 002 and 32 hidden nodes for the sirikit reservoir and the learning rate of 0 0005 and 16 hidden nodes for the khwae noi bamrung dan reservoir have the best performance table 1 summarizes the performances of three rnns of three reservoirs fig 6 shows the simulation results of the bhumibol reservoir and the results of other two reservoirs can be found in the supplementary materials in fig 6 the results during the test period are plotted with a logarithmic scale to clear the model performance for low flows we can see that three rnns can simulate the outflow of three reservoirs satisfactorily with high nse larger than 0 65 and low absolute pbias value less than 10 and ga narx is the best one among three rnns the results also indicate that the rnns can simulate the operation of both multiannual regulation reservoir and incomplete annual regulation reservoir to better evaluate the rnn based reservoir operation models we compare the performance of the models under different flow regimes and the results of the bhumibol reservoir are shown in fig 6 for low flow simulation rnns greatly overestimate the outflow of all three reservoirs with a positive pbias larger than 20 and the lstm model has the lowest accuracy for intermediate flow all rnns have a slight underestimation or overestimation with a small pbias less than 10 for high flow simulation the rnns all underestimate the high flow with a negative pbias less than 20 and the ga narx model is obviously more accurate than other two models the overestimation of low flow and the underestimation of high flow may be caused by the sigmoidal activation function sudheer et al 2003 for sigmoidal functions the slope gradually tends to 0 as the absolute value of independent variable increasing which indicates that the high flow will be transformed to a lower value and the low flow will be transformed to a higher value by the activation functions since the slope of the activation functions corresponding to the intermediate value is close to 1 the intermediate value has no obvious deviation in addition we found the frequencies of high and low flow in the outflow time series are far lower than that of intermediate flows and this may cause insufficient training of the model with the limited high and low flow dataset moreover as an effective evolutionary algorithm ga used in this study generally improved the performance of traditional narx dai et al 2011 ding et al 2013 jain and srinivasulu 2004 sulistiyo et al 2014 yang et al 2017 for all three reservoirs examined in this study the performance of ga narx in the test period is improved and the improvement does not depend on initial weights and biases this study also suggests ga is very helpful to overcome the premature convergence and high sensitivity to initial conditions of narx as a data driven model the rnn uses mathematical equations with many parameters to replace the complex kinetic processes of physical models and this can be seen as a parameterization of the reservoir operation chaves and kojiri 2007 the rnn models in this study adopt several constraints with physical significance e g water balance equation hydraulic constrains for reservoir storage and dam release etc and thus the results still obey the basic physical laws and boundary conditions since actual reservoir operation is a continuous optimization process the feedback from the downstream is also important to improve the reservoir operation for satisfying the water management requirement in the downstream the rnn model training based on the historical input and output data can extract the previous reservoir operators experience and therefore the simulation results of the rnn model can also be a good reference for the current reservoir operators 4 2 applicability of reservoir operation by the rnn based models since the bhumibol reservoir has the longest records among three reservoirs and only its operation rule curves can be obtained this study selects the bhumibol reservoir and further discusses the applicability of reservoir operation by ga narx through comparing with the existing operation rules we also examine the model performance under extreme flood and drought conditions to compare with the existing reservoir operation rules also referred as operation rule curves which define an empirically desired storage outflow relationship louks and sigvaldason 1981 yang et al 2016 we calculate the daily trajectories of the reservoir storage related to the reservoir operation extracted by our best performing model namely ga narx model for long term operation simulation the error will accumulate gradually fig 7 a to reduce the impact of the accumulated error we yearly update the storage at the beginning of wet season see fig 7b as shown in fig 7b the upper curve and the lower curve represent the actual simplified operating rule curves of bhumibol reservoir provided by the thai royal irrigation department and the reservoir water storage should be in between the two lines however the observed storage trajectory exceeds the upper and lower boundaries many times in historical records this suggests that the operators of bhumibol reservoir did not strictly follow the operation curves for some reasons this phenomenon is partly caused by natural processes such as the flood year of 2011 and partly by the personal judgement and experience of the decision makers mateo 2012 as shown in fig 7b the results from the ga narx model match the actual reservoir storage trajectories better this indicates that the ga narx model can meet the actual goals of the reservoir operators in addition the storage trajectories show that the reservoir tends to store more water in wet year such as 2007 and use these water for regulation in the following dry years such as 2007 2008 2009 and 2010 the satisfactory simulation of the storage also indicates the operation rules extracted by ga narx can achieve the multiannual regulation functions for multi purpose as one of the major rice exporters thailand suffers a lot from extreme hydrological events such as 2010 drought and 2011 flood mateo et al 2015 to further examine the applicability of the reservoir operation model under extreme floods and droughts this study selects 2010 and 2011 as typical years and the results are shown in fig 8 a in the 2010 drought the simulated outflow by the ga narx model matches the observed outflow with the nse of 0 93 and the r of 0 96 and there is no obvious overestimation or underestimation with the pbias of 0 94 in the 2011 floods the model also has good performances with the nse of 0 79 and the r of 0 90 and slight underestimation of the outflow pbias of 1 65 this shows that the operation model based on rnn can provide a reasonable estimation of the reservoir outflow during the extreme hydrological events and the ga narx model is suitable for reservoir operation during the extreme droughts and floods in addition we also compare the daily storage trajectories fig 8b by ga narx under 2010 drought and 2011 flood with observed storage and operation curves the results show that ga narx can better simulate the storage trajectories under extreme hydrological events besides the results show that the reservoir extended the release time from july to august to relieve the drought in 2010 and emptied its flood control storage in april ahead of schedule to mitigate the impact of flood in 2011 this indicates the operation rules extracted by ga narx can predict flood control and drought mitigation well 4 3 real time reservoir operation with inflow forecast by gbhm to develop a real time reservoir operation system it requires an effective inflow forecast this study uses the inflow forecast by gbhm together with the ga narx operation model and builds a real time reservoir operation system for the bhumibol reservoir 4 3 1 reservoir inflow forecast by gbhm the simulated reservoir inflow of the bhumibol reservoir by gbhm in calibration and validation periods is shown in fig 9 and performance of gbhm model is shown in table 2 the inflow simulation by gbhm is satisfactory with the nse of 0 83 and the pbias of 0 26 in validation period although it has a slightly underestimation the results also show that gbhm has a good simulation of the baseflow while has a slight underestimation of the peak flow and the flood peak appearance time simulated by the gbhm slightly lags the observation from the results it can be concluded that with 3 h of computational time for one year simulation gbhm is suitable to conduct the real time daily inflow forecast 4 3 2 real time reservoir operation in this study the observed meteorological data from 1 january 2012 to 6 july 2015 are selected as the weather forecast data to carry out the real time forecast of the reservoir inflow using gbhm based on the inflow forecast the ga narx model can operate the reservoir in real time results are shown in fig 10 and table 2 the results show that the performance of the real time outflow forecast is satisfactory with the nse of 0 89 according to moriasi et al 2007 the outflow in the dry season of 2012 is obviously underestimated because of the abrupt change of the operation rules in that period mateo 2012 this abrupt change is not included in the training period data and thus not able to be learned by rnns the impacts of inflow forecast error by gbhm on real time reservoir operation will be discussed in section 5 1 in addition the results show that the system can capture the daily variations in wet season more stably and effectively than that in dry season this phenomenon is mainly caused by the different functions of reservoirs in wet season and dry season the bhumibol reservoir is mainly used for irrigation and water supply in dry season and the operators need to consider complicated downstream water demand which has more uncertainties while power generation and flood control are the main functions in wet season and have less uncertainties and thus the daily variation of outflow in dry season is greater than it in wet season and is more difficult to capture the real time reservoir operation system developed in this study is run on a pc having the execution environment of intel core tm i7 7700 k cpu of 4 20 ghz it takes about 3 0 hour computation time for one year simulation of the real time reservoir operation this includes about three hours of inflow forecast by gbhm and 17 s for reservoir operation by trained ga narx since the inflow forecast needs most computational time the applicability on a larger scale problem mainly depends on the computational expense of gbhm model gbhm has been successfully used in many catchments of china and asia with different scales such as the yangtze river with a drainage area of 1 8 million km2 li et al 2015b mekong river with a drainage area of 795 000 km2 wang et al 2016 jiulong river with a drainage area of 14 741 km2 lu et al 2018 for practical use of this real time reservoir operation system we need to improve the inflow forecast especially the computational efficiency of inflow forecast in the future 5 discussions 5 1 impact of inflow forecast error and operator s bias on the operation model to explore the influence of inflow forecast errors on the rnn based operation model the inflow forecast errors are assumed to be random and can be fitted to a normal distribution with a mean value of 0 and a standard deviation determined based on the observed inflow data baker 1977 datta and burges 1984 sankarasubramanian et al 2008 zhao et al 2011 we use monte carlo methods to generate 2000 samples of the inflow from the distribution previous study has shown that the uncertainties of baseflow simulation are smaller than that of peak flow simulation by gbhm and the range of the uncertainties is about 10 20 li et al 2012 in this study the standard deviations of the inflow forecast errors are given as 10 and 20 fig 11 shows the results and it can be found that the uncertainties of the simulated reservoir outflow increase as the error of inflow forecast increases the majority of the observed outflow is within the light grey bound with 95 confidence interval and the mean values of forecast outflow follow the observed values well which also can be inferred that the ga narx model is robust for real time reservoir operation since the biases of the dam operators implicit in the historical operation data may affect the future forecast we discuss possible impacts under different situations in general since the historical operation rules contain not only the successful experience of engineers but also the lessons of their failures these operation rules are not necessarily the best and may not achieve all the functions of the reservoir in the future operated by these rules in the future the outflow may also fail to meet the requirement of the water management in some situations for normal years the reservoir operation according to the pre established rules can generally meet the water demand of the downstream which does not highly depend on the experience and judgment of operators therefore the outflow forecast may be less affected by those deviations however in case of extreme floods and droughts or other emergency situations it is not enough to only use of the pre established operation rules and the operation process may highly depend on the experience of operators and the feedback of the downstream johnson et al 1991 oliveira and loucks 1997 zhang et al 2018a since the historical experience may not meet the requirements in those emergency situations the outflow forecast may also not meet the downstream water demand to reduce the impacts of the historical biases the operation model should be retrained every 5 to 10 years ahmad et al 2014 this is an area that we need to further study in the future 5 2 potential applications of the reservoir operation system the reservoir operation system established in this study has the potential for improving long term water resources planning and real time flood risk management for water resources planning under a fast changing environment such as climate change and land use changes long term simulation of reservoir operation can provide references for the decision makers by using the future meteorological data output from the general circulation models gcms gbhm model can provide a long term inflow prediction based on the gcms outputs and subsequently the rnn based operation model can carry a long term simulation of reservoir operation for future water resources planning real time flood and drought risk management requires forecast of reservoir inflow and outflow with a few days leading time at least reservoir outflow forecast with input variables updated every three days five days and seven days are calculated and compared in fig 12 the results show that the reservoir operation system can provide a robust outflow forecast with a leading time up to 5 days in many cases cascade reservoirs in a river basin always have hydraulic connections and storage compensations and work together to meet the water demand zhou et al 2014 therefore the connectivity of reservoirs should be quantified mathematically and used as a type of predictor variables in the operation model in future study besides the meteorological forecast is not used in the inflow forecast and thus future study also need to address the applicability of weather forecast in real time reservoir operation 6 conclusions this study investigated the applicability of three rnn models narx lstm and ga narx for simulating the reservoir operation and developed a real time operation system for the bhumibol reservoir by combining a distributed hydrological model gbhm for inflow forecast the performance of rnn based reservoir operation models was evaluated under different flow regimes and extreme hydrological events we discussed the applicability of ga narx and the impacts of the ga on the optimization of the narx according to the results we found 1 rnns are capable of capturing the actual reservoir operation rules from the historical data and simulating the reservoir outflow properly on the other hand rnns underestimate high flow and overestimate low flow due to the use of the sigmoidal activation function and the limited high and low flow data in the historical time series 2 by optimizing the initial conditions of narx ga can greatly improve the prediction accuracy comparing with the traditional narx ga narx also overcomes the drawback of high sensitivity of narx to the initial conditions 3 ga narx based operation model is effective under extreme floods and droughts and can simulate the storage trajectories better than traditional methods which implies that the ga narx based operation model captures the engineer s judgements during the extreme flow conditions based on the feedback from downstream 4 coupling gbhm for the inflow forecast the real time operation system of the bhumibol reservoir developed in this study can provide robust reservoir outflow forecast with a one day leading time this is useful in real water resources management in the chao phraya river basin declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work was financially supported by the national natural science foundation of china project nos 41661144031 the authors would like to thank prof jerasorn santisirsomboon for providing the data used in this study the authors also thank the editor and three anonymous reviewers for their constructive and detailed comments appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2019 124229 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
6094,large scale reservoirs play an essential role in water resources management for agriculture irrigation water supply and flood controls however we need robust reservoir operation systems under both normal flow and extreme flow conditions in this study we applied recurrent neural networks rnn to simulate the operation of three multi purpose reservoirs located in the upper chao phraya river basin two reservoirs have the function of multiannual flow regulation and one has the function of incomplete annual regulation the goal of this study is to explore the applicability of rnn models for operation of reservoirs with multiannual flow regulation under different flow regimes especially under extreme floods and droughts we used three rnns namely nonlinear autoregressive models with exogenous input narx long short term memory lstm and genetic algorithm based naxr ga naxr for reservoir operation based on historical data for real time water resources management an accurate inflow forecast is required to provide a real time reservoir outflow and thus we also carried out a real time reservoir operation using the rnn and the inflow forecast by a distributed hydrological model results show that 1 ga narx has the highest accuracy among three rnns and is more stable than the original narx by optimizing the initial conditions although it takes longer training time than narx and lstm 2 ga narx based operation model is effective under extreme floods and droughts and 3 the real time operation system combining the ga narx and the distributed hydrological model has reasonable accuracy in both wet season and dry season rnn based operation model developed in this study has potential applicability in practical water management and the model combining the hydrological prediction is specially useful for real time reservoir operation keywords recurrent neural networks real time reservoir operation inflow forecast by distributed hydrological model the upper chao phraya river basin 1 introduction as an important infrastructure for water resources management and utilization reservoirs provide us many benefits such as controlling flood mitigating drought irrigating agriculture generating hydropower and supplying water resources chang and chang 2006 lehner et al 2011 zhang et al 2018a real time reservoir operation including accurate real time inflow forecast is required for realizing the above functions coulibaly et al 2000 lin et al 2009 louks and sigvaldason 1981 valipour et al 2013 zhang et al 2018a previous studies on real time reservoir operations showed that simulation models can provide more detailed and realistic representation of reservoir operations with lower computational demands and are more readily accepted by operators in practice lund and guzman 1999 uysal et al 2016 yang et al 2016 conceptual or physical based models are widely used to simulate the controlled outflow and water level of single or multiple reservoir systems for example sigvaldson 1976 developed a mathematical reservoir simulation model for a multipurpose multiple reservoir system based on the concept of priority georgakakos and marks 1987 proposed an efficient method for the real time operation by using a set of stochastic differential equations to describe the dynamics in reservoirs with the increasing development in river dynamics and computer technology many advanced and complex simulation models have been developed and widely used in practice such as the hec ressim model klipsch and hurst 2007 the weap model purkey 2005 and the calsim model draper et al 2004 these physical based models provide solid foundations for estimating reservoir outflow and storage zhang et al 2018a through combing operation patterns described mathematically and empirical operation rule curves based on historical hydrological data since the process of reservoir operation is transparent and interpretable in physical based models it is easier for operators to understand and achieve the water management goal however simulation models are effective when the predefined operation policies established in the model reflect the actual operation process johnson et al 1991 yang et al 2016 in actual reservoir operations it is widely acknowledged that operators often add their own judgment to adapt to specific conditions objectives or constraints existing at various situations operation curves are often used as a reference or guideline oliveira and loucks 1997 and the applicability of the physical model based on pre established rule curves is insufficient for reservoir operation in real time especially during the extreme flood events chang and chang 2001 saavedra valeriano et al 2010 an actual reservoir operation process sometimes deviates from the operational plan due to the operators judgement or knowledge for managing emergencies such as floods and droughts this makes the physical models difficult to accurately simulate real time reservoir operation johnson et al 1991 oliveira and loucks 1997 zhang et al 2018a therefore it needs to develop an efficient and easy to use reservoir simulation model based on the reservoir input and output data which can take the operators historical experience into account without the requirement of huge data for water resources management in the downstream to overcome the limitations of physical models hydrologists tried data driven models to simulate the hydrological processes recently machine learning ml techniques have been applied in hydrological time series forecast bai et al 2016 chen et al 2013 hung et al 2009 nasseri et al 2008 yu et al 2017 as for the application in reservoir operation the black box nature of most ml models could make it difficult for operators to understand the process however since machine learning methods have super abilities to fit complex high dimensional relationships they have been increasingly used for extracting the actual operation rules based on the historical records of inflow and outflow which contains the empirical knowledge for dealing with the extreme flows and time varying demands from the downstream corani et al 2009 rasouli et al 2012 wang et al 2010 yang et al 2016 zhang et al 2018a among many machine learning models multilayer perceptron models mlps support vector machine and regression svm and svr and classification and regression tree cart have been applied for reservoir operation simulation with the back propagation bp algorithm and time delayed input variables mlp models were successfully used to simulate the outflow of reservoirs chaves and chang 2008 jain et al 1999 however mlps have several limitations such as local optimal solutions and gradient disappearance to practical applications zhang et al 2019 based on statistical learning theory svm or svr is widely used in the field of reservoir operation aboutalebi et al 2015 ji et al 2014 lin et al 2006 and reported to have better prediction accuracy of reservoir discharge over traditional artificial neural networks lin et al 2006 svm has the advantages of fast training speed and provides the best solutions but it still has several limitations such as the sensitivity to the choice of the kernel function and no guarantee to learn exact parameters for the best solutions patle and chouhan 2013 yan et al 2003 as a type of decision tree models cart was used to extract the actual reservoir operation pattern combined with a shuffled cross validation scheme and the controlled release and storage trajectories of nine major reservoirs in california were simulated yang et al 2016 however most of the previous studies tested the ml models for a short period which may not sufficient to demonstrate their applicabilities in different flow regimes especially in extreme flood and drought conditions with the feedback on both time delayed input and output rnn can preserve and remember the short past and long past information and therefore it is preferred for a complex dynamic timing and sequential problem adi et al 2017 chung et al 2016 koutnik et al 2014 zhang et al 2019 although the rnn still suffers from limitations of longer time consumption the gradient vanishing and exploding problems it is preferred for simulation of reservoir operation with dynamic process and high dependence on the historical information zhang et al 2018a compared three machine learning models namely the artificial neural network support vector regression and long short time memory lstm in simulations of reservoir operation at the gezhouba dam and reported that lstm was a type of rnn which had the best overall performance however gezhouba dam is a hydropower plant without storage zhang 2004 and has very limited flow regulation capacities sharma and singh 2013 in this case inflow and outflow are highly correlated by using three recurrent neural network models zhang et al 2019 simulated xiluodu reservoir operation which has an incomplete annual regulation ability chen 2015 further studies are desired to verify effectiveness of rnn for the large reservoirs with multiannual flow regulation capacities especially a focus on simulating reservoir operation in the extreme hydrological conditions floods and droughts is required nonlinear autoregressive model with exogenous input narx lin et al 1996 menezes jr and barreto 2008 and long short term memory lstm model greff et al 2017 hochreiter and schmidhuber 1997 are two widely used rnns with different model structures in hydrological time series forecast compared with conventional neural networks narx adds loops to feed the previous input and output back to the network and pass the information from one step to the next and the feedback delays including input delays and output delays represent the lag time of input and output with input vectors built through tapped delay lines narx model can be efficiently applied to long term prediction of nonlinear time series chang et al 2016 menezes jr and barreto 2008 with chain like modules similar to narx lstm network adopts memory blocks that are composed of an input gate an output gate a memory cell and a forget gate gers 2002 these components are recurrently connected to each other and located between the input and the output layers to replace hidden layers so as to filter out nonessential information while preserving useful information from the long past shen 2018 the two models have been applied for sewer overflow monitoring and groundwater level prediction chang et al 2016 shen 2018 wunsch et al 2018 zhang et al 2018b but there are few applications for operation simulation of reservoirs with multiannual flow regulation especially under extreme flood and drought conditions physically based hydrological models have been widely used for hydrological simulation and forecast mateo et al 2015 among them the geomorphology based hydrological model gbhm yang et al 1998 yang et al 2002 has been successfully used in many catchments of china and asia such as yangtze river li et al 2015a mekong river wang et al 2016 and jiulong river lu et al 2018 to provide downstream water managers an outflow forecast with one day in advance at least it is desired to test the gbhm for inflow forecast in a real time reservoir operation chao phraya river basin covers about 30 of the total territory of thailand and a large amount of farmland and several big cities such as chiang mai nakhon sawan bangkok etc are within the basin the agriculture economics and life of this basin are seriously affected by the frequent floods and droughts benfield 2011 promchote et al 2016 and the thailand government highly relies on reservoirs in the upstream for water resources management hungspreug et al 2000 with the challenge of climate change and population growth reservoir operation is under great pressure and operators need a high efficiency reservoir operation model as a decision supporting tool for coping with rapidly changing environments in addition an efficient real time outflow forecast for managing the floods and droughts in the downstream regions is also required therefore the reservoir operation tools need to be improved due to the rapidly changing environments and development of the rnn offers an opportunity in the reservoir operations in the upstream of chao phraya river in thailand in this study we use rnns to extract the reservoir operation rules from the historical operation data and use gbhm to carry out the reservoir inflow forecast combining the rnn based reservoir operation model with the hydrological model a real time reservoir outflow forecast is achieved as a case study including two multiannual regulation reservoirs and one incomplete annual regulation reservoir three multipurpose reservoirs located in the upper chao phraya river basin are chosen to examine the performance of the real time operation system this study strives to 1 verify effectiveness of rnn in reservoir operations for the multipurpose reservoirs with multiannual flow regulations 2 test the applicability of the rnn based operation model for different flow regimes including the extremely high and low flows and 3 develop a real time reservoir operation system by combining a distributed hydrological model for providing reservoir outflow forecast with a one day leading time 2 study area and data 2 1 the upper chao phraya river basin and three reservoirs in thailand this study choses three multipurpose reservoirs including the bhumibol reservoir the sirikit reservoir and the khwae noi bamrung dan reservoir located in the upper chao phraya river basin and the upstream of reservoirs as the study area see fig 1 the upper chao phraya river basin is located in northern thailand and its drainage area is 110 569 km2 tebakari et al 2012 the climate is tropic monsoon and the mean annual precipitation is about 1 200 mm on average 85 of the total annual rainfall occurs between may and november wet season while the dry season is from december to april ponpang nga and techamahasaranont 2016 the bhumibol reservoir constructed across the ping river is located at 17 24 degrees of north latitude and 98 97 degrees of east longitude and is the largest reservoir in thailand with multiannual flow regulation it has a drainage area of 26 386 km2 with total storage capacity of 13 426 billion m3 and has a surface area of 316 0 km2 the reservoir is built for water storage and irrigation for agricultures flood control fisheries saltwater intrusion management as well as hydroelectric power generation supratid et al 2017 the sirikit reservoir constructed across the nan river has a drainage area of 13 130 km2 with total storage capacity of 10 508 billion m3 and has a surface area of 260 0 km2 the sirikit reservoir is also a multipurpose reservoir with multiannual flow regulation the khwae noi bamrung dan reservoir constructed across a tributary of the nan river has a drainage area of 4 254 km2 with total storage capacity of 769 million m3 and this reservoir is a multipurpose reservoir with incomplete annual regulation 2 2 data data used in this study include data of the inflow storage and release of three reservoirs geographic information for the upstream of the reservoirs and climate forcing data qin et al 2017 the climate forcing data include daily precipitation daily air temperature mean maxima and minima daily mean wind speed daily mean relative humidity and daily sunshine duration those data except daily mean wind speed are observed at 14 meteorological stations and 96 rainfall stations managed by royal irrigation department of thailand within the upper chao phraya river basin the daily mean wind speed is obtained from the global land data assimilation system rodell et al 2004 except wind speed data other climate data are spatially interpolated with an angular distance weighting method with elevation corrections yang et al 2004 the spatial resolution of the gridded climate forcing dataset is 2 5 km 2 5 km the soil water parameters including saturated soil moisture residual soil moisture and soil hydraulic conductivity are estimated using the method proposed by rawls and brakensiek 1985 the soil data of the upper chao phraya river basin are taken from the harmonized world soil database hwsd fao et al 2012 the land use map is provided by department of land development information of thailand and the changes of land use during simulated period are ignored the shuttle radar topography mission srtm digital elevation model dem with a spatial resolution of 90 m jarvis et al 2008 is used in this study the vegetation parameters used in this study include the leaf area index lai and the fraction of photosynthetically active radiation fpar which are derived from the 3rd generation of normalized difference vegetation index ndvi3g of the global inventory modeling and mapping studies gimms zhu et al 2013 the historical daily inflow data daily water storage data and daily controlled outflow data of three reservoirs are selected to derive the reservoir operation rules while the daily evaporation data of the reservoirs are used to calculate the storage trajectories these daily data are all gathered form the royal irrigation department of thailand and the daily reservoir operation data of three reservoirs are shown in fig 2 3 methodology 3 1 problem formulation we work on three multipurpose reservoirs which all have a concrete dam fig 3 shows the simplified schematic diagram of the operation system for the functions of irrigation downstream water supply power generation and flood control to meet the demand of various functions the operators regulate the reservoir release through controlling the sluice gates when the downstream water demand exceeds the water requirement of the power generation the excess water will be released through the spillway otherwise the required water will be released through the power station to meet the objective of power generation the water from the spillway and the power station will join at the tail water reach and the sluice gates will split the water to meet the demand of irrigation water supply and the environmental flow requirements of downstream ahmed and sarma 2005 the process of the operation can be expressed as 1 q out t f q in t s t 1 d h e where q out t is the outflow which is the decision variable in reservoir operation f represents the operation rules q in t and s t 1 represent the reservoir inflow and the initial storage respectively and d is the total water demand which includes the requirements of irrigation water supply power generation and environmental flow of downstream in addition the reservoir operation namely the operation of sluice gates also needs the historical experience he which mainly contains operation curves as reference and empirical successes or operators knowledge in actual practice lund and guzman 1999 mateo et al 2015 although it is difficult to accurately describe the empirical knowledge or judgment it is implied in the historical operation data this provides the possibility of application for the data driven ml models since the relationship between the operation rules and various objectives also can be reflected in the historical operation data the historical inflow outflow and storage data are used to extract the operation rules through rnns additionally there are also other constraints in reservoir operation including water balance equation hydrology constrains for storage and outflow nagesh kumar and janga reddy 2007 the water balance equation can be expressed as 2 s t 1 s t δ t 2 q in t q in t 1 δ t 2 q out t q out t 1 where δ t is a short time interval for routing the hydrological constrains for storage and outflow can be expressed as 3 s dead s t s max 4 0 q out t where sdead is the dead storage and smax is the full storage in this study we use three rnns to learn the operation polices from the historical operation data and then construct the reservoir operation model to simulate the reservoir outflow 3 2 machine learning methods in this study all data were split into training 70 of data validation 15 and testing 15 for machine learning models as for the bhumibol reservoir the training period is from 1 january 1970 to 31 december 1997 the validation period is from 1 january 1998 to 31 december 2003 and the test period is from 1 january 2004 to 31 december 2011 as for the sirikit reservoir the training period is from 1 january 2003 to 30 april 2013 the validation period is from 1 may 2013 to 15 july 2015 and the test period is from 16 july 2015 to 30 september 2017 as for the khwae noi bamrung dan reservoir the training period is from 1 january 2009 to 18 february 2015 the validation period is from 19 february 2015 to 9 june 2016 and the test period is from 10 june 2016 to 30 september 2017 3 2 1 basic narx model we use a nonlinear autoregressive model with exogenous input narx which belongs to the class of recurrent neural networks rnns and is regarded as a well suitable algorithm to model the discrete time nonlinear dynamic systems the architecture of the narx model is shown in fig 4 and it can be mathematically expressed as 5 y n 1 f y n y n d y x n x n d x where x n and y n are the input and output of the model at time step n respectively and dx 1 and dy 1 are the input delay and output delay respectively the function f is generally unknown and needs to be approximated ardalani farsa and zolfaghari 2010 both input and the output can be multivariate time series and a general narx model with more than one input and one output can be expressed as 6 y n 1 f o b o h 1 n w ho f h b h k 1 nx i 0 d x w ikh x k n i j 0 d y w jh y n j where f0 and fh are the activation functions of hidden layer and output layer and wh0 wikh and wjh are the weights of connections among layers variables bo and bh are biases n is the number of hidden neurons and nx is the number of inputs the detail of narx can be found in lin et al 1997 and menezes jr and barreto 2008 the architecture of narx is mainly determined by two hyper parameters which are the time delays dx and dy and the number of hidden neurons in hidden layers n in this study the time delay of input dx are set equal to that of output dy the detailed hyper parameter tuning process and the results are given in the supplementary material we use levenberg marquardt method for training and the parallel mode for building the model which means the output values are used as input recurrently in addition we use the tanh function as the activation function 3 2 2 ga narx model as shown in eq 6 the parameters of narx include weights and biases the selection of proper weights and biases is important for narx performance however parameters including weights and biases of neural networks are often trained by gradient based optimization methods which may lead to premature convergence and the tendency of being trapped in local optimums yang et al 2017 moreover gradient based optimization schemes are very sensitive to initial conditions and different initial weights and biases may lead to different solutions yang et al 2017 zanchettin and ludermir 2007 one remedy for the issue is to start from a good set of initial values that could lead to the best optimal solutions bahrami et al 2016 genetic algorithm ga is one of the most widely used evolutionary optimization algorithms which is inspired by biological evolution and imitates the rules of survival of the fittest in biological evolution soleimani and kannan 2015 wang 1991 wang 1997 and the detail of ga can be found in davis 1991 in this study we use ga to optimize the narx model parameters ga narx with the objective function of mean square errors mse the architecture of ga narx is given in fig 4 both narx and ga narx models are realized by the matlab software beale et al 1992 3 2 3 lstm model a long short term memory lstm model is also a type of rnns with the hidden layer replaced by a specially designed memory block that is composed of an input gate an output gate a memory cell and a forget gate the input gate determines that which new information generated by the memory cell will be stored in the cell state and the forget gate determines which information to remove from the cell state the structure of the lstm model is shown in fig 5 and a general memory block of lstm model can be expressed by the following equations 7 c n 1 σ w f x n 1 w f y n b f c n σ w i x n 1 w i y n b i tanh w c x n 1 w c y n b c 8 y n 1 σ w o x n 1 w o y n b o tanh c n 1 where c is the cell state and w and w are the weights of the connections between gates and layers bi bf bo and bh are the biases symbol σ and tanh are activation functions from the equations above we can see that the lstm model is totally different from the narx model in terms of architecture and prediction methods the detailed expression and applications of lstm can be found in hochreiter and schmidhuber 1997 and greff et al 2017 in this study the initial learning rate and the number of the hidden nodes are two hyper parameters need to be determined the detailed results of hyper parameters tuning are shown in the supplementary material for comparison we set the time delays of lstm same as narx models and adopt a three layer lstm which consists of one input layer one lstm hidden layer and one output layer like narx the backpropagation through time bptt algorithm werbos 1990 is used to train the lstm model and the adaptive moment estimation adam algorithm kingma and ba 2014 is used as the learning rate method the loss index chosen in this study is mean square error mse and the tanh and sigmoid functions are selected as the activation functions the lstm model is realized by keras module with the backend of tensorflow module abadi et al 2016 of python to better evaluate the reservoir operation models we compare the performance of the models under different flow regimes they include high flow low flow and intermediate flow which are determined by the 25th and 75th percentiles based on the outflow frequency distribution curve zhang et al 2018a in addition the daily trajectories of the reservoir storage are also calculated during the test period according to the water balance equation see eq 2 using the simulated outflow 3 3 the geomorphology based hydrological model gbhm this study uses gbhm to forecast the inflow of the bhumibol reservoir in gbhm the river network is extracted from a digital elevation model dem using a flow accumulation method and ordered using the horton strahler scheme the entire catchment is divided into a series of sub catchments and each sub catchment is divided into several flow intervals to ensure that the grids in the same interval have the same flow distance simulation of the hydrological processes in the gbhm model is mainly composed of two parts hydrological simulation at each hillslope unit and river routing along the river networks ma et al 2010 the hillslope hydrological simulation includes the calculation of canopy interception evapotranspiration infiltration surface flow unsaturated flow and groundwater flow the river routing along the networks is solved using the kinematic wave method by accumulating the hydrological simulations of each grid the total runoff in each interval can be generated and the river discharge at the outlet of each sub catchment is yielded with the accumulation of the interval runoff the details of the model can be found in yang et al 2002 in this study the 2 5 km 2 5 km is selected as the grid resolution of the gbhm and the whole basin is divided into four classes with a total of 58 sub basins and ordered by the horton strahler scheme a six year warm up run is used to activate the gbhm and initialize the hydrological conditions qin et al 2017 most parameters of gbhm are defined according to their physical meaning either obtained from situ observations or global databases only a few parameters need to be calibrated such as the saturated hydraulic conductivity of the topsoil groundwater hydraulic conductivity and slope shape factor the detailed information of the parameters can be found in miao et al 2016 since gbhm is used to forecast the reservoir inflow in this study the error caused by the meteorological forecast is not considered which means the observed meteorological data are used as the forcing data to drive the model limited by the gauged meteorological data the hydrological simulation by gbhm starts from 1 january 1997 since process based hydrological models usually adopt calibration and validation to achieve the stable performance qin et al 2017 the daily inflow data of bhumibol reservoir from 1 january 1997 to 31 december 2002 are used to calibrate the parameters and the validation period is set from 1 january 2003 to 31 december 2011 3 4 simulating reservoir operations 3 4 1 reservoir operation models based on rnns in this study three large reservoirs are selected for simulating the reservoir operation and the daily reservoir operation data including inflow outflow and storage data are used to construct the data driven reservoir operation model the operation data are classified into predictor variables inputs and target variable output the first type of predictor variable is the reservoir inflow which is dependent on the natural upstream flows and represents the hydrological processes of the upper basin as the utility of forecasts in reservoir operation has long been recognized anghileri et al 2016 klemeš 1977 yao and georgakakos 2001 and the benefits of short term weather forecast have been widely accepted nayak et al 2018 the inflow forecast for the current day and next two days is also adopted as the predictor variables therefore in this study the inflows of the previous two days q in t 2 q in t 1 current day q in t and the future two days q in t 1 q in t 2 are chosen as the predictor variables the second type of predictor variables is the reservoir storage volume or a state variable which is widely used to guide the reservoir releases the outflow is always determined according to the storage volume or water levels required in the rule curve that sets the desired operation criteria based on historical experience to meet different objectives such as water supply flood control irrigation and hydropower generation therefore according to the water balance equation eq 2 the initial storage s t 1 is selected as a predictor variable the target variable is the reservoir daily outflow q out t on the current day after the target and predictor variables are determined the reservoir operation model based on rnns can be developed 3 4 2 real time reservoir operations with the combination of the reservoir operation rules derived by the rnn based models and the inflow forecast by the hydrological model a real time operation system of bhumibol reservoir can be obtained since the reservoir operation is mainly embodied in the control of the release or outflow from the reservoir the real time operation can be represented by real time outflow forecast to carry out the real time operation first the inflow forecasts of the current day and the next two days predicted by gbhm model are used as the input variables q in t 1 q in t 2 and q in t of the developed rnn based reservoir operation model second the observed inflows of the past two days and the observed storage of the previous day are used to update the inflow variables q in t 2 q in t 1 and the initial storage variable s t 1 of the reservoir operation model to ensure that the historical inputs are the observed values with the daily updated input variables run the rnn based model and the real time reservoir outflow forecast can be achieved see the framework of the real time operation system shown in fig 3 the bhumibol reservoir is selected as a case study to develop the real time reservoir operation system with the data from 1 january 2012 to 6 july 2015 3 5 model performance evaluation we used root mean square errors rmse and pearson s correlation coefficients r to evaluate the performance of the models percent bias pbias and the nash sutcliffe efficiency nse nash and sutcliffe 1970 which are both widely used to evaluate the accuracy of the hydrological model are also chose to describe the statistical properties of the models in this study moriasi et al 2015 the r and nse are two normalized statistical indexes and a value closer to 1 indicates a better simulation as recommended by previous studies the model performance can be judged satisfactory for flow simulations if daily monthly or annual r greater than 0 84 nse greater than 0 50 15 p b i a s 15 and the rmse is less than half of the standard deviation of the observed data for watershed scale models moriasi et al 2007 yang et al 2016 zhang et al 2018a in addition we also adopt the difference of the occurrence day of the annual maximum flood damfd to represent the timing error of the models and a positive value means that the simulated flood peak time lags behind the measured value since only the largest flood in a year is identified in the annual maximum flood series amf and several large floods are usually ignored this study used the peaks over threshold method pot to overcome this drawback a threshold that leads to three events per year is used and the details of the amf and pot can be found in lang et al 1999 and mediero et al 2014 4 results in this section we compared simulations of the reservoir operation by three rnns and presented the results of reservoir inflow simulation by gbhm model and the accuracy of real time reservoir operations 4 1 model performance comparison in reservoir operation simulation this section compares the simulated reservoir outflow by three rnns to evaluate their performances as for narx and ga narx the results of hyper parameter selection show that the models with 8 time delays and 5 hidden neurons for the bhumibol reservoir 10 time delays and 8 hidden neurons for the sirikit reservoir and 11 time delays and 9 hidden neurons for the khwae noi bamrung dan reservoir have the most stable and accurate performance as for lstm the results of hyper parameter selection indicate that the models with the learning rate of 0 025 and 64 hidden nodes for the bhumibol reservoir the learning rate of 0 002 and 32 hidden nodes for the sirikit reservoir and the learning rate of 0 0005 and 16 hidden nodes for the khwae noi bamrung dan reservoir have the best performance table 1 summarizes the performances of three rnns of three reservoirs fig 6 shows the simulation results of the bhumibol reservoir and the results of other two reservoirs can be found in the supplementary materials in fig 6 the results during the test period are plotted with a logarithmic scale to clear the model performance for low flows we can see that three rnns can simulate the outflow of three reservoirs satisfactorily with high nse larger than 0 65 and low absolute pbias value less than 10 and ga narx is the best one among three rnns the results also indicate that the rnns can simulate the operation of both multiannual regulation reservoir and incomplete annual regulation reservoir to better evaluate the rnn based reservoir operation models we compare the performance of the models under different flow regimes and the results of the bhumibol reservoir are shown in fig 6 for low flow simulation rnns greatly overestimate the outflow of all three reservoirs with a positive pbias larger than 20 and the lstm model has the lowest accuracy for intermediate flow all rnns have a slight underestimation or overestimation with a small pbias less than 10 for high flow simulation the rnns all underestimate the high flow with a negative pbias less than 20 and the ga narx model is obviously more accurate than other two models the overestimation of low flow and the underestimation of high flow may be caused by the sigmoidal activation function sudheer et al 2003 for sigmoidal functions the slope gradually tends to 0 as the absolute value of independent variable increasing which indicates that the high flow will be transformed to a lower value and the low flow will be transformed to a higher value by the activation functions since the slope of the activation functions corresponding to the intermediate value is close to 1 the intermediate value has no obvious deviation in addition we found the frequencies of high and low flow in the outflow time series are far lower than that of intermediate flows and this may cause insufficient training of the model with the limited high and low flow dataset moreover as an effective evolutionary algorithm ga used in this study generally improved the performance of traditional narx dai et al 2011 ding et al 2013 jain and srinivasulu 2004 sulistiyo et al 2014 yang et al 2017 for all three reservoirs examined in this study the performance of ga narx in the test period is improved and the improvement does not depend on initial weights and biases this study also suggests ga is very helpful to overcome the premature convergence and high sensitivity to initial conditions of narx as a data driven model the rnn uses mathematical equations with many parameters to replace the complex kinetic processes of physical models and this can be seen as a parameterization of the reservoir operation chaves and kojiri 2007 the rnn models in this study adopt several constraints with physical significance e g water balance equation hydraulic constrains for reservoir storage and dam release etc and thus the results still obey the basic physical laws and boundary conditions since actual reservoir operation is a continuous optimization process the feedback from the downstream is also important to improve the reservoir operation for satisfying the water management requirement in the downstream the rnn model training based on the historical input and output data can extract the previous reservoir operators experience and therefore the simulation results of the rnn model can also be a good reference for the current reservoir operators 4 2 applicability of reservoir operation by the rnn based models since the bhumibol reservoir has the longest records among three reservoirs and only its operation rule curves can be obtained this study selects the bhumibol reservoir and further discusses the applicability of reservoir operation by ga narx through comparing with the existing operation rules we also examine the model performance under extreme flood and drought conditions to compare with the existing reservoir operation rules also referred as operation rule curves which define an empirically desired storage outflow relationship louks and sigvaldason 1981 yang et al 2016 we calculate the daily trajectories of the reservoir storage related to the reservoir operation extracted by our best performing model namely ga narx model for long term operation simulation the error will accumulate gradually fig 7 a to reduce the impact of the accumulated error we yearly update the storage at the beginning of wet season see fig 7b as shown in fig 7b the upper curve and the lower curve represent the actual simplified operating rule curves of bhumibol reservoir provided by the thai royal irrigation department and the reservoir water storage should be in between the two lines however the observed storage trajectory exceeds the upper and lower boundaries many times in historical records this suggests that the operators of bhumibol reservoir did not strictly follow the operation curves for some reasons this phenomenon is partly caused by natural processes such as the flood year of 2011 and partly by the personal judgement and experience of the decision makers mateo 2012 as shown in fig 7b the results from the ga narx model match the actual reservoir storage trajectories better this indicates that the ga narx model can meet the actual goals of the reservoir operators in addition the storage trajectories show that the reservoir tends to store more water in wet year such as 2007 and use these water for regulation in the following dry years such as 2007 2008 2009 and 2010 the satisfactory simulation of the storage also indicates the operation rules extracted by ga narx can achieve the multiannual regulation functions for multi purpose as one of the major rice exporters thailand suffers a lot from extreme hydrological events such as 2010 drought and 2011 flood mateo et al 2015 to further examine the applicability of the reservoir operation model under extreme floods and droughts this study selects 2010 and 2011 as typical years and the results are shown in fig 8 a in the 2010 drought the simulated outflow by the ga narx model matches the observed outflow with the nse of 0 93 and the r of 0 96 and there is no obvious overestimation or underestimation with the pbias of 0 94 in the 2011 floods the model also has good performances with the nse of 0 79 and the r of 0 90 and slight underestimation of the outflow pbias of 1 65 this shows that the operation model based on rnn can provide a reasonable estimation of the reservoir outflow during the extreme hydrological events and the ga narx model is suitable for reservoir operation during the extreme droughts and floods in addition we also compare the daily storage trajectories fig 8b by ga narx under 2010 drought and 2011 flood with observed storage and operation curves the results show that ga narx can better simulate the storage trajectories under extreme hydrological events besides the results show that the reservoir extended the release time from july to august to relieve the drought in 2010 and emptied its flood control storage in april ahead of schedule to mitigate the impact of flood in 2011 this indicates the operation rules extracted by ga narx can predict flood control and drought mitigation well 4 3 real time reservoir operation with inflow forecast by gbhm to develop a real time reservoir operation system it requires an effective inflow forecast this study uses the inflow forecast by gbhm together with the ga narx operation model and builds a real time reservoir operation system for the bhumibol reservoir 4 3 1 reservoir inflow forecast by gbhm the simulated reservoir inflow of the bhumibol reservoir by gbhm in calibration and validation periods is shown in fig 9 and performance of gbhm model is shown in table 2 the inflow simulation by gbhm is satisfactory with the nse of 0 83 and the pbias of 0 26 in validation period although it has a slightly underestimation the results also show that gbhm has a good simulation of the baseflow while has a slight underestimation of the peak flow and the flood peak appearance time simulated by the gbhm slightly lags the observation from the results it can be concluded that with 3 h of computational time for one year simulation gbhm is suitable to conduct the real time daily inflow forecast 4 3 2 real time reservoir operation in this study the observed meteorological data from 1 january 2012 to 6 july 2015 are selected as the weather forecast data to carry out the real time forecast of the reservoir inflow using gbhm based on the inflow forecast the ga narx model can operate the reservoir in real time results are shown in fig 10 and table 2 the results show that the performance of the real time outflow forecast is satisfactory with the nse of 0 89 according to moriasi et al 2007 the outflow in the dry season of 2012 is obviously underestimated because of the abrupt change of the operation rules in that period mateo 2012 this abrupt change is not included in the training period data and thus not able to be learned by rnns the impacts of inflow forecast error by gbhm on real time reservoir operation will be discussed in section 5 1 in addition the results show that the system can capture the daily variations in wet season more stably and effectively than that in dry season this phenomenon is mainly caused by the different functions of reservoirs in wet season and dry season the bhumibol reservoir is mainly used for irrigation and water supply in dry season and the operators need to consider complicated downstream water demand which has more uncertainties while power generation and flood control are the main functions in wet season and have less uncertainties and thus the daily variation of outflow in dry season is greater than it in wet season and is more difficult to capture the real time reservoir operation system developed in this study is run on a pc having the execution environment of intel core tm i7 7700 k cpu of 4 20 ghz it takes about 3 0 hour computation time for one year simulation of the real time reservoir operation this includes about three hours of inflow forecast by gbhm and 17 s for reservoir operation by trained ga narx since the inflow forecast needs most computational time the applicability on a larger scale problem mainly depends on the computational expense of gbhm model gbhm has been successfully used in many catchments of china and asia with different scales such as the yangtze river with a drainage area of 1 8 million km2 li et al 2015b mekong river with a drainage area of 795 000 km2 wang et al 2016 jiulong river with a drainage area of 14 741 km2 lu et al 2018 for practical use of this real time reservoir operation system we need to improve the inflow forecast especially the computational efficiency of inflow forecast in the future 5 discussions 5 1 impact of inflow forecast error and operator s bias on the operation model to explore the influence of inflow forecast errors on the rnn based operation model the inflow forecast errors are assumed to be random and can be fitted to a normal distribution with a mean value of 0 and a standard deviation determined based on the observed inflow data baker 1977 datta and burges 1984 sankarasubramanian et al 2008 zhao et al 2011 we use monte carlo methods to generate 2000 samples of the inflow from the distribution previous study has shown that the uncertainties of baseflow simulation are smaller than that of peak flow simulation by gbhm and the range of the uncertainties is about 10 20 li et al 2012 in this study the standard deviations of the inflow forecast errors are given as 10 and 20 fig 11 shows the results and it can be found that the uncertainties of the simulated reservoir outflow increase as the error of inflow forecast increases the majority of the observed outflow is within the light grey bound with 95 confidence interval and the mean values of forecast outflow follow the observed values well which also can be inferred that the ga narx model is robust for real time reservoir operation since the biases of the dam operators implicit in the historical operation data may affect the future forecast we discuss possible impacts under different situations in general since the historical operation rules contain not only the successful experience of engineers but also the lessons of their failures these operation rules are not necessarily the best and may not achieve all the functions of the reservoir in the future operated by these rules in the future the outflow may also fail to meet the requirement of the water management in some situations for normal years the reservoir operation according to the pre established rules can generally meet the water demand of the downstream which does not highly depend on the experience and judgment of operators therefore the outflow forecast may be less affected by those deviations however in case of extreme floods and droughts or other emergency situations it is not enough to only use of the pre established operation rules and the operation process may highly depend on the experience of operators and the feedback of the downstream johnson et al 1991 oliveira and loucks 1997 zhang et al 2018a since the historical experience may not meet the requirements in those emergency situations the outflow forecast may also not meet the downstream water demand to reduce the impacts of the historical biases the operation model should be retrained every 5 to 10 years ahmad et al 2014 this is an area that we need to further study in the future 5 2 potential applications of the reservoir operation system the reservoir operation system established in this study has the potential for improving long term water resources planning and real time flood risk management for water resources planning under a fast changing environment such as climate change and land use changes long term simulation of reservoir operation can provide references for the decision makers by using the future meteorological data output from the general circulation models gcms gbhm model can provide a long term inflow prediction based on the gcms outputs and subsequently the rnn based operation model can carry a long term simulation of reservoir operation for future water resources planning real time flood and drought risk management requires forecast of reservoir inflow and outflow with a few days leading time at least reservoir outflow forecast with input variables updated every three days five days and seven days are calculated and compared in fig 12 the results show that the reservoir operation system can provide a robust outflow forecast with a leading time up to 5 days in many cases cascade reservoirs in a river basin always have hydraulic connections and storage compensations and work together to meet the water demand zhou et al 2014 therefore the connectivity of reservoirs should be quantified mathematically and used as a type of predictor variables in the operation model in future study besides the meteorological forecast is not used in the inflow forecast and thus future study also need to address the applicability of weather forecast in real time reservoir operation 6 conclusions this study investigated the applicability of three rnn models narx lstm and ga narx for simulating the reservoir operation and developed a real time operation system for the bhumibol reservoir by combining a distributed hydrological model gbhm for inflow forecast the performance of rnn based reservoir operation models was evaluated under different flow regimes and extreme hydrological events we discussed the applicability of ga narx and the impacts of the ga on the optimization of the narx according to the results we found 1 rnns are capable of capturing the actual reservoir operation rules from the historical data and simulating the reservoir outflow properly on the other hand rnns underestimate high flow and overestimate low flow due to the use of the sigmoidal activation function and the limited high and low flow data in the historical time series 2 by optimizing the initial conditions of narx ga can greatly improve the prediction accuracy comparing with the traditional narx ga narx also overcomes the drawback of high sensitivity of narx to the initial conditions 3 ga narx based operation model is effective under extreme floods and droughts and can simulate the storage trajectories better than traditional methods which implies that the ga narx based operation model captures the engineer s judgements during the extreme flow conditions based on the feedback from downstream 4 coupling gbhm for the inflow forecast the real time operation system of the bhumibol reservoir developed in this study can provide robust reservoir outflow forecast with a one day leading time this is useful in real water resources management in the chao phraya river basin declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work was financially supported by the national natural science foundation of china project nos 41661144031 the authors would like to thank prof jerasorn santisirsomboon for providing the data used in this study the authors also thank the editor and three anonymous reviewers for their constructive and detailed comments appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2019 124229 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
