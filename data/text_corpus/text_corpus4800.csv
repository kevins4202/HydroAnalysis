index,text
24000,oil plumes released from subsea blowouts can induce strong optical extinction effect and significantly affect radiative transfer in the ocean euphotic zone where photosynthesis occurs in this paper the effect of oil plumes on the ocean radiative transfer is studied numerically by modeling the dispersion of oil plume in the ocean mixed layer and the radiative transfer through the oil contaminated seawater due to the interactions with flows in the ocean mixed layer oil plumes of different droplet diameters exhibit considerable differences in plume size shape and oil concentration with the same volumetric release rate plumes of large oil droplets exhibit highly intermittent local concentration in near surface regions and cause strong but intermittent extinction effect over relatively small horizontal area plumes of small oil droplets diffuse more smoothly over large horizontal and vertical extensions resulting in significant overall extinction effect to the radiative transfer in the ocean euphotic zone keywords oil spill dispersion ocean optics turbulence wave 1 introduction crude oil as indicated by its dark color is a strong absorber of light when spilled into the upper ocean otremba 2007 in the aftermath of a large scale offshore oil spill such as the 2010 deepwater horizon accident spilled crude oil can spread over a large horizontal area in the upper ocean and last for long time before being restored or biodegraded inducing significant impact on the ocean ecosystem atlas and hazen 2011 camilli et al 2010 hazen et al 2010 surface oil slicks and suspended oil droplets in the euphotic zone can block light from penetrating into subsurface region where phytoplankton live kirk 2011 threatening the ocean ecosystem from the origin of its food chain by significantly reducing the rate of photosynthesis on the other hand ultraviolet light can alter degrade oil in the process of photo degradation which can produce some byproducts that can be more toxic than the source oil king et al 2014 radović et al 2014 ray et al 2014 bacosa et al 2015 improved knowledge on the light penetration in oil contaminated seawater can help obtain a more accurate estimation of the photo degradation rate than using the normal light penetration profiles obtained based on the natural ocean condition recent report by lay et al 2015 based on the field measurement data obtained during the deepwater horizon oil spill incident has confirmed the noticeable effect of spilled crude oil on the vertical variation of incident ultraviolet radiation and extinction coefficients in the northern gulf of mexico thus understanding the oil induced effects on the oceanic radiative transfer is crucial for accurately modeling the ocean ecosystem evolution in the wake of a large offshore oil spill suspended crude oil droplets affect the local seawater s inherent optical properties iops i e the light absorption and scattering coefficients which depend on the local droplet number density droplet size and oil type otremba and król 2002 król et al 2006 otremba 2007 rudź et al 2013 the dispersion of oil droplets and other buoyant particles in the euphotic zone is actively driven by various physical processes induced by atmospheric forcing e g shear induced turbulence sea surface waves langmuir circulations ekman transport thermal convection etc edson et al 2007 sullivan and mcwilliams 2010 özgökmen et al 2012 d asaro 2014 kukulka et al 2016 these effects continuously mix the very upper tens of meters of the ocean to form the ocean mixed layer oml which can also cause considerable dilution of the oil droplet plume by horizontal and vertical mixing see e g mcwilliams and sullivan 2000 yang et al 2015 on the other hand the buoyancy of the oil droplets acts as a resistant force to the mixing effects generated by the oceanic flows and can cause inhibition of oil plume dilution under certain conditions yang et al 2014a in recent years the continuous growth of computer power has made high fidelity computational models feasible for tackling the complex ocean processes particularly large eddy simulation les based on the craik leibovich cl equation leibovich 1983 has proven to be a useful tool for providing insights of fine scale oceanic flows and transport phenomena skyllingstad and denbo 1995 mcwilliams et al 1997 li et al 2005 noh et al 2006 harcourt and d asaro 2008 grant and belcher 2009 kukulka et al 2009 li and fox kemper 2017 using the les method several recent studies have been able to shed light on the detailed three dimensional dispersion processes of oil plumes in the oml under various conditions yang et al 2014a 2015 chor et al 2018a b in particular under wind and wave dominant conditions plumes of oil droplets are found to be strongly affected by langmuir circulations and shear induced turbulence and exhibit various types of surface patterns with different dilution levels ranging from highly intermittent surface streaks for large oil droplets to smoothly diffused plumes for small oil droplets yang et al 2014a 2015 under convection dominant conditions buoyant materials show strong preferential concentration in surface convergence regions generated by convective cells in addition highly buoyant particles e g large oil droplets can also be affected by a secondary effect induced by some persistent surface vortices in the turbulent flow field that collect and cluster these particles into vorticity dominant surface regions chor et al 2018a due to the considerable spatial variation of oil droplet concentration caused by these aforementioned flow induced transport phenomena in the oml the iops of the oil contaminated seawater can also exhibit complex spatial variations that can strongly affect the variation of light intensity in the euphotic zone which is a crucial information for modeling the light variation due to oil spill but has not been well understood up to date simple one dimensional downward irradiance models e g woźniak et al 2003 lee et al 2005 woźniak and dera 2007 require the information about the diffuse attenuation coefficient which is an apparent optical property of the water body and is not available from the literature for the ocean contaminated by oil plumes with complex spatial variations this directly motivates the current study with the detailed three dimensional flow field information in hand the oceanic light field can be efficiently modeled by solving the radiative transfer equation using the monte carlo simulation mcs method kirk 1981a b gordon 1985 simulations based on the mcs method can capture the three dimensional radiative transfer in dynamic ocean covered by wind generated sea surface waves you et al 2009 xu et al 2011 the combination of les and mcs methods has been demonstrated to provide valuable insights for understanding the complex effects of ocean turbulence on its optical properties xu et al 2012 the effects of particles on the radiative transfer can also be included in the mcs method using the mie theory e g plass and kattawar 1972 wang and wang 2002 in this study we utilize these recent advancements in computational models to establish a numerical modeling framework for simulating the radiative transfer in the ocean euphotic zone contaminated by plumes of suspended crude oil droplets we perform two sets of numerical experiments corresponding to two representative oml flow conditions 1 wind wave dominant condition with shear generated turbulence and wave induced langmuir circulations and 2 convection dominant condition with thermal convective cells because the oil droplet size plays a crucial role in determining both the dynamic response of the oil plume to the oml flows yang et al 2014a 2015 and the light absorption scattering mie 1908 otremba and król 2002 otremba 2007 for each oml condition we consider three different oil droplet diameters all together these simulation cases allow us to cover a variety of oil plume patterns with different levels of horizontal and vertical dilutions from which the effect of oil contamination on oceanic radiative transfer is studied fig 1 illustrates the problem configuration and some representative results for the effect of flow and oil field on the radiative transfer this paper is organized as follows details of the computational models used in this work are reported in section 2 section 3 shows the simulation and statistical analysis results finally conclusions are given in section 4 2 numerical models 2 1 highlight of modeling strategy radiative transfer in natural seawater is affected by the sea surface geometry and seawater properties underneath the surface e g temperature salinity suspended particulate matter colored dissolved organic matter etc mobley 1994 kirk 2011 in the case of an offshore oil spill incident the presence of suspended oil droplets further complicates the radiative transfer process and causes considerable variation to the subsurface light field note that the essential physical processes that affect the light field i e wave oscillation turbulence mixing and transport and photon propagation occur at very different time scales for example the ocean waves oscillate at the periods of o 0 1 o 10 seconds depending on the wavelength the surface oil plumes evolve at the time scale of minutes for small scale features and hours for large scale patterns a photon s lifetime when propagating in the upper ocean is on the order of o 0 001 o 0 1 microseconds depending on the penetration depth the considerable time scale separation and significant differences in the details of the physical processes impose great challenges in this study we adopted a suite of numerical models that were designed for capturing different aspects of this complex physical problem and combined their strengths to tackle the problem the overall modeling strategy is highlighted below i the instantaneous sea surface wave field is simulated using a high order spectral hos method dommermuth and yue 1987 which provides the geometry of the air water interface for modeling the light refraction at the sea surface based on snell s law and fresnel s equations you et al 2009 xu et al 2011 see details in section 2 2 and appendix a ii underneath the sea surface the oml flow field is simulated using a les model yang et al 2014a which models the oceanic flow structures e g shear turbulence langmuir circulations convective cells etc generated by sea surface wind shear stress surface heat flux and wave induced stokes drift this les model is based on the widely used craik leibovich equation in which the accumulated effect of sea surface waves on the turbulence and material transport is modeled based on the wave induced stokes drift current leibovich 1983 see details in section 2 3 iii in the ocean column the transport of crude oil droplets is modeled using an eulerian eulerian les method yang et al 2014a 2015 in which the evolution of the concentration field of the oil droplets is simulated by a finite volume les model and is coupled with the les model for oceanic flow described in ii see details in section 2 3 iv based on the instantaneous sea surface wave geometry obtained from i and the instantaneous oil droplet concentration obtained from iii the seawater iops are modeled and the radiative transfer in the euphotic zone is simulated by a mcs model this model can capture the effects of suspended oil droplets on the absorption and scattering of photons as they propagate through the mixture of seawater and oil droplets see details in section 2 4 and appendix b each of these above models has proven track record for modeling their corresponding physical processes in various applications and their details are presented in the next several subsections fig 1 shows a representative example of the simulation results obtained by this set of numerical models because the physical processes involved in the current problem are complicated and occur over a wide range of time and length scales it is impractical to perform the simulations with each of the above models fully coupled in a two way dynamic coupling manner instead in the current study the hydrodynamic models i iii are used as precursor simulators to provide the required flow field data for the mcs model iv to simulate the radiative transfer in the oil contaminated seawater among the three hydrodynamic models i iii the two les models ii and iii are dynamically coupled to simulate the oil plume dispersion in the upper ocean in a wave averaged but turbulence resolved manner as explained below in section 2 3 the coupled les models account for the accumulated effect of sea surface waves on the oil transport but do not model the instantaneous waves explicitly the hos model i uses identical wave spectra as in the les model to provide the corresponding wave surface geometry the combination of the surface waves and the subsurface oil concentration field provides a synthetic upper ocean field for modeling the radiative transfer process details of each models are discussed below in sections 2 2 2 4 as well as in appendices a and b 2 2 high order spectral simulation of sea surface waves when light strikes on the sea surface it first interacts with the air water interface curved due to waves in this study we adopt the widely used high order spectral method to simulate instantaneous sea surface waves the hos method models the wave motions based on the potential flow theory in which the wave orbital velocity satisfies u φ where φ is the velocity potential in the water body the wave induced flow motions satisfy the continuity equation 2 φ 0 on the sea surface the wave satisfies both the kinematic and dynamic free surface boundary conditions which can be defined precisely at the instantaneous wave surface z η x y t using zakharov s equations zakharov 1968 1 η t η φ s 1 η 2 z φ x y η t 0 at z η 2 φ s t g η φ s 2 2 1 2 1 η 2 z φ x y η t 2 0 at z η here η is the instantaneous wave surface elevation φ s φ z η is the surface potential and x y is the horizontal gradient for fast numerical simulation the continuity equation and boundary conditions 1 and 2 are rewritten into series of discretized modes using perturbation method and eigenfunction expansion following dommermuth and yue 1987 also see mei et al 2005 and are solved numerically using fourier series based pseudo spectral method additional details of the current hos model are given in appendix a the hos method has been successfully applied to a variety of different ocean surface wave problems in recent years see e g liu and yue 1998 tanaka 2001 alam et al 2010 goullet and choi 2011 yang and shen 2011 yang et al 2013 2014b c fig 2 a shows a sample result of sea surface wave field simulated using the current hos model 2 3 large eddy simulation of turbulent flows and oil plume transport in ocean mixed layer to efficiently simulate the langmuir circulations and shear convection driven turbulent flows in the ocean mixed layer and the corresponding oil plume transport we employ a les model that consists of a pseudo spectral finite difference flow solver based on the cl equation and a finite volume oil transport solver chamecki et al 2008 yang et al 2014a this les model has been successfully applied to simulate oil and buoyant particle dispersion in oml in several recent studies yang et al 2014a 2015 chen et al 2016 chor et al 2018a b in this model the oml flows are governed by the filtered continuity equation and cl equation 3 u 0 4 d u d t 1 ρ 0 p f c e 3 u u s u s ω τ d 1 ρ ρ 0 g e 3 here tilde denotes a variable resolved on the les grid u is the fluid velocity vector d d t t u is the material derivative ρ 0 is the reference seawater density ρ is the resolved local seawater density p is the modified pressure g is the gravitational acceleration e 3 is the unit vector in the vertical direction f c is the coriolis frequency u s is the wave induced stokes drift velocity ω u is the vorticity and τ u u u u is the subgrid scale sgs stress tensor with tr τ being its trace and τ d τ tr τ 3 i being its deviatoric part and i is the identity tensor the first four terms on the right hand side of eq 4 are pressure gradient force coriolis force the vortex force due to stokes drift representing the phase averaged effects of surface gravity waves on the mean flow and turbulence and the sgs term representing the effect of unresolved fluid motions below les grid scale details for modeling the stokes drift current u s z are given further below the last term in eq 4 is the buoyancy force due to density variation which is formed based on the boussinesq approximation see e g mcwilliams et al 1997 özgökmen et al 2011 the buoyancy force induced by the oil droplets is neglected due to the low released rate considered in this study and the low local oil concentration after turbulence induced dilution following previous les studies e g mcwilliams et al 1997 polton et al 2008 kukulka et al 2010 yang et al 2014a 2015 we assume the seawater density satisfies a linear equation of state i e ρ ρ 0 1 α t θ θ 0 where α t 2 1 0 4 k 1 is the thermal expansion coefficient θ is the resolved potential temperature and θ 0 is the reference temperature corresponding to ρ 0 the variation of the potential temperature field is computed by solving a filtered convection diffusion equation 5 d θ d t u s θ π t where π t u θ u θ is the sgs heat flux the transport of oil plumes in oml flows is simulated using an eulerian approach chamecki et al 2008 yang et al 2014a oil droplets of the same diameter d are considered as one species and their instantaneous distribution is represented by a continuous eulerian mass concentration field c x t the evolution of c is governed by the filtered transport equation 6 c t v c π c q s where π c u c u c is the sgs oil concentration flux q s is a source term for subsurface release of the oil droplets and v is the resolved lagrangian transport velocity of the oil droplets which is modeled as ferry and balachandar 2001 yang et al 2014a 2015 chen et al 2016 7 v u u s w r e 3 r 1 t d d u d t τ o t d 3 2 here w r is the droplet rise velocity relative to the surrounding fluid due to the balance of buoyancy gravity and stokes drag which is modeled as balachandar and eaton 2010 yang et al 2016 8 w r w r s re d 0 2 w r s 1 0 15 re d 0 687 1 0 2 re d 750 where w r s ρ 0 ρ d g d 2 18 μ is the droplet rise velocity given by stokes law ρ d is the oil density re d ρ 0 w r d μ is the particle reynolds number and μ is the dynamic viscosity of the seawater the first three terms on the right hand side of eq 7 represent the dominant effects acting on buoyant particles in oml flows the fourth term on the right hand side of eq 7 represents the additional effects due to added mass and sgs fluid stress force where r 3 ρ 0 2 ρ d ρ 0 is the density ratio parameter and t d w r r 1 g is the droplet response time scale yang et al 2015 2016 in order to solve eqs 4 6 proper turbulence closures are required for the sgs terms τ π t and π c in the current model the sgs stress tensor τ is parameterized using the lilly smagorinsky eddy viscosity model smagorinsky 1963 lilly i e τ 2 ν τ s 2 c s δ 2 s s where s u u t 2 is the resolved strain rate tensor ν τ is the sgs eddy viscosity δ is the les grid filter scale and c s is the smagorinsky coefficient the instantaneous and local value of c s is determined dynamically during the simulation using the lagrangian averaged scale dependent dynamic model bou zeid et al 2005 with the sgs eddy viscosity modeled as ν τ c s δ 2 s the sgs heat flux π t and oil mass flux π c are then parameterized as π t ν τ pr τ θ and π c ν τ sc τ c based on constant turbulent prandtl number pr τ 0 4 and schmidt number sc τ 0 4 antonopoulos domis 1981 moeng 1984 mason 1989 sullivan et al 1994 kumar et al 2006 chamecki et al 2009 yang et al 2014a 2015 note that for the simplification of the model the temperature changes of the seawater and oil droplets due to light absorption are not considered in this study the oil droplets and the surrounding seawater are assumed to be in thermal equilibrium state so that the heat exchange between them is also omitted in eq 5 in this study we consider the typical open sea condition such that the sea surface is covered by a broadband wind generated surface wave field with a directional spectrum s k α where k 2 π λ is the wavenumber λ is the wavelength α is the inclination angle between the wave propagation direction and the mean wind direction note that because the cl equation 4 models the accumulated effect of surface waves on the shear driven turbulence in a wave phase averaged context the instantaneous sea surface motions are not included in the simulation consistent with the cl modeling framework the top boundary of the les domain is modeled as a rigid flat surface with an imposed mean shear stress in the downwind direction i e the x direction in this study and the fluctuating components of the horizontal velocity components satisfy the free slip condition at this top boundary the averaged wave effect is taken into account via the stokes drift current following mcwilliams and restrepo 1999 also see e g harcourt and d asaro 2008 webb and fox kemper 2011 li and fox kemper 2017 the leading order approximation of the corresponding stokes drift of such broadband sea surface wave field can be calculated as 9 u s z 2 g 0 π π cos α e 1 sin α e 2 k 2 5 s k α exp 2 k z d α d k where e 1 and e 2 are the unit vectors in the x and y directions respectively in the simulations the wave spectrum s k α is prescribed based on the widely used empirical spectrum obtained by donelan and pierson 1987 based on field measurement data and the stokes drift u s calculated by eq 9 is used in the les model equations 4 5 and 7 to simulate the oml flows fig 2 shows some sample oml flow results obtained by this les model 2 4 monte carlo simulation for radiative transfer the light transport in the ocean euphotic zone is governed by the radiative transfer equation rte mobley 1994 xu and yue 2014 which can be simulated efficiently by the monte carlo simulation method kirk 1981a b as illustrated in fig 3 the mcs method models the scattering and absorption events of photons as they travel in the seawater i e a physical representation for the neumann series of the rte which are controlled by the absorption coefficient a scattering coefficient b beam attenuation coefficient c a b and scattering phase function ℬ by tracing and calculating the summation of the scatterings and absorptions of many photons the oceanic light field can be modeled mcs method has been widely used for studying oceanic radiative transfer see e g kirk 1981a b gordon 1985 xu et al 2011 2012 xu and yue 2014 a general guidance of the mcs method can be found in leathers et al 2004 additional details of the current mcs model are given in appendix b details on modeling a b and ℬ for oil contaminated seawater are also given in appendix b for simplification in the current mcs model a black sky approximation is made such that the light absorption and scattering caused by the atmosphere are neglected consequently a photon packet can be initialized right above the sea surface here we summarize the key procedure of the mcs method used in this study as illustrated in fig 3 1 a photon packet with initial energy e i is launched at a random location in the air right above the ocean surface and travel towards the surface with an incident angle γ i 2 the photon packet passes through the air water interface with a transmitted angle γ t and energy e t based on the fresnel equations and the refraction indices of air n a and water n w 3 when a photon packet travels through the oil contaminated seawater it experiences a medium with spatial variation of iops to determine the optical pathlength l of the photon packet in this highly nonhomogeneous medium the multi stepped approach used by wang et al 1995 is adopted in the current mcs in particular the total pathlength is given by l l i with the sub step pathlength l i being determined by the equation l i c i ln q 1 where c i is the local les cell averaged beam attenuation coefficient for the i th sub step and q 1 is a random number within 0 1 in the simulation the photon packet travels over the optical pathlength l with spatially varying c along its current travel direction described by θ φ where θ and φ are the polar angle and azimuthal angle of the path respectively 4 after traveling over l a random number q 2 0 1 is generated and compared with the single scattering albedo ω 0 b c if q 2 ω 0 the photon packet changes the traveling direction due to scattering and a new set of angles θ φ are determined based on the scattering phase function ℬ and steps 3 and 4 are repeated otherwise the photon packet is deceased due to absorption and a new photon packet is initialized and traced in the simulation by repeating steps 1 4 fig 4 shows a sample result for the radiative transfer of 500 nm wavelength light in clean seawater underneath a surface wave field obtained from the current mcs model in this mcs test case the inherent optical properties of the seawater for the 500 nm light are set to be a 0 0257 m 1 b 0 0029 m 1 and c a b 0 0286 m 1 smith and baker 1981 there were totally 5 1 0 10 photon packets launched and tracked as shown in the figure the typical swimming pool effect associated with wave induced light focusing is clearly visualized from the contours of the downward irradiance e d at two representative depths fig 4 b and c the local downward irradiance is calculated as xu et al 2012 10 e d x y z 0 2 π 0 π 2 i x y z θ φ cos θ sin θ d θ d φ where i x y z θ φ is the local radiance obtained from the mcs model the mcs result also captures the depth dependent decay of the horizontally averaged downward irradiance e d note that the vertical attenuation of the downward irradiance can be expressed in the form of an exponential decay function e d e d 1 exp k d z z 1 where e d 1 is the average downward irradiance at the reference level z 1 1 m and k d is the diffuse attenuation coefficient kirk 2011 for this test case k d 0 0271 m 1 smith and baker 1981 fig 4 d shows good agreement between the mcs result and the exponential decay profile additional validations for the mcs model can be found in appendix b 3 results 3 1 problem setup the upper ocean boundary layer is a highly dynamic system and it is nearly impossible to include all effects in a single modeling framework to capture the detailed spatial variation of the light field we choose to focus on small scale effects relative to submesoscale ocean eddies as shown in fig 1 we consider the oil dispersion in the oml and the resulted light field variation under the influences of shear induced turbulence langmuir circulations sea surface waves and thermal convections we consider two different sea surface forcing conditions corresponding to shear dominant and convection dominant conditions in the shear dominant case a constant wind shear stress τ w 0 168 n m 2 is applied in the x direction which corresponds to a wind speed u 10 10 m s measured at 10 m height and a friction velocity u 1 28 cm s in water based on empirical parameterization donelan 1982 a weak heat flux of q 15 5 w m 2 out of the ocean is imposed at the surface to help spin up the flow mcwilliams et al 1997 yang et al 2014a 2015 under this condition the oml flow is dominated by the three dimensional turbulence generated by the wind induced shear and the coherent langmuir circulation cells generated by wave turbulence interaction the wave condition is discussed further below in the rest of this paper we refer to this flow condition as lc in the convection dominant case we apply a weaker wind stress τ w 0 036 n m 2 corresponding to wind speed u 10 5 m s and friction velocity u 0 59 cm s in water and a stronger surface heat flux of q 207 0 w m 2 under this condition the convective cells generated by the thermal convection are the dominant flow structures and hereinafter we refer to this condition as cc for both flow conditions we set the coriolis frequency to be f c 7 1 0 5 s 1 corresponding to a latitude of 28 7 n note that the surface heat flux imposed in the les represents the combined effect of various surface heat transfer processes e g convection radiation and evaporation edson et al 2007 which are typically not modeled explicitly in the les model based on the cl equation nevertheless the surface wind stress and heat flux conditions considered in this study fall in the range of the parameters considered in previous les studies of oml flows e g mcwilliams et al 1997 harcourt and d asaro 2008 mensa et al 2015 yang et al 2015 chor et al 2018b for both flow conditions we assume the sea surface wave field is in equilibrium with the wind forcing we adopt a widely used empirical broadband wave spectrum parameterization donelan and pierson 1987 the wavelengths at the spectrum peak are λ p 92 2 m for lc and 23 1 m for cc and the corresponding wave periods are t p 7 69 s and 3 85 s respectively based on these empirical spectra for each flow condition a three dimensional broadband wave field is constructed and used as the initial condition for the hos model to simulate the instantaneous sea surface waves underneath the sea surface we use a computational domain of 922 m long and wide and 100 m deep to simulate the oil dispersion in oml using les with 384 384 256 computational grid points the flow field is well mixed in the top half of the domain corresponding to an oml depth z i 50 m and stably stratified further below with a temperature gradient d θ d z 0 01 k m 1 for the broadband wave conditions considered in this study the corresponding stokes drift currents are calculated by integrating the wave spectra mcwilliams and restrepo 1999 harcourt and d asaro 2008 webb and fox kemper 2011 li and fox kemper 2017 the corresponding turbulent langmuir number is about the same for both the lc and cc conditions l a t u u s 0 0 3 where u is the friction velocity in the water caused by the wind shear and u s 0 is the magnitude of the wave induced stokes drift velocity at the mean water surface level mcwilliams et al 1997 following recent les studies on oil plume dispersion in oml e g yang et al 2014a 2015 we use the reference seawater density ρ 0 1031 0 kg m 3 and viscosity μ f 1 08 1 0 3 kg m s and the oil density ρ d 859 9 kg m 3 for each flow condition we consider three different cases differentiated by the droplet diameter i e d 0 27 0 42 and 0 70 mm these droplet diameters fall into the small size range i e typically d 1 mm so that the droplets can be assumed to have spherical shape clift et al 1978 zheng and yapa 2000 and are within the range of possible droplet size distributions reported for offshore oil spills li et al 2017 for each case a monodisperse oil plume with the same droplet size is released from a localized source at the 75 m depth with a low mass release rate of q s 10 kg s in this way the oil plume in each case models a near surface sub plume of oil droplets with similar size originated from a deep water release note that the sub plumes with different droplet sizes would rise along different paths in the oml due to the differences in their rise velocities yang et al 2015 the resulting oil concentration in the surface plume is found to be within the range of the concentration levels obtained from simulations based on the realistic scale blowout rate from the wellhead chen et al 2018 the local oil concentrations obtained from the les runs are also found to be at a level that induce negligible buoyancy effect to the two oml flow conditions considered in this study in the mcs the incident light is directed vertically downward the iops induced by naturally existing substances in the seawater such as water molecules suspended particulate matter and colored dissolved organic matter are prescribed based on empirical parameterizations mobley 1994 woźniak and dera 2007 kirk 2011 the effects of oil droplets on the iops are modeled based on the simulated oil concentration using mie theory bohren and huffman 2008 see more details in appendix b we note that the radiative transfer in the upper ocean is also strongly affected by the wavelength of the light as shown in appendix b in particular the light absorption reaches the lowest order of o 0 01 m 1 in pure seawater around the light wavelength of 450 nm and increases gradually to the order of o 1 m 1 towards both the ultraviolet and infrared ends of the light spectrum the light scattering coefficient of pure seawater decreases monotonically as the light wavelength increases mobley 1994 on the other hand both the light absorption and scattering effects induced by suspended crude oil droplets decrease monotonically as the light wavelength increases otremba 2007 therefore a large set of simulations for a range of representative wavelengths in the full light spectrum would need to be performed in order to obtain the complete picture for the effects of the oil plumes on the upper ocean light field however to avoid further complicating the simulation and data analysis in this study we only consider the radiative transfer of the 450 nm wavelength light which is in the spectrum range for oceanic photosynthesis overall in this study we conduct simulations and data analyses for 6 cases covering two different flow conditions with three different oil droplet sizes for each moreover for comparison purpose we also conduct two benchmark cases without oil plume for both the lc and cc flow conditions 3 2 simulation results and statistical analysis as shown in fig 5 a for the lc condition the interaction between wave induced stokes drift and shear induced turbulence is able to generate langmuir circulations mcwilliams et al 1997 li et al 2005 as indicated by the streaky structures in the vertical velocity contours i e the windrows for the cc condition the large surface heat flux causes strong thermal instability that dominates over the weaker craik leibovich second type instability caused by wave turbulence interaction craik and leibovich 1976 and the thermal convection cells become the main flow structures as shown in fig 5 b note that the vertical velocity field in the lc case fluctuates more energetically than that in the cc case due to the effect of the langmuir circulations as indicated by the vertical velocity contours shown in fig 5 the flow field features for the wind wave dominant lc case and the convection dominant cc case are consistent with those reported in the literature e g mcwilliams et al 1997 mensa et al 2015 in response to the flow induced transport the surface oil plume forms different patterns due to the different characteristics of the flow conditions in the lc condition the oil converges into narrow downwind bands namely the surface windrows generated by contour rotating langmuir cells mcwilliams et al 1997 yang et al 2014a 2015 while in the cc condition the oil concentrates into surface patches corresponding to convergence regions between convective cells chor et al 2018a moreover as shown in fig 6 for the same flow condition the oil plume pattern is also strongly affected by the buoyancy of the oil droplet which can be quantified by the floatability parameter β w r w where w r is the droplet rise velocity due to buoyancy and w is a velocity scale representing the level of mixing induced by oml flows for the lc condition w can be set to be the surface stokes drift velocity u s 0 and β w r u s 0 d b 1 where d b is the drift to buoyancy ratio proposed by yang et al 2014a as shown in fig 6 b d the oil plume exhibits highly intermittent surface pattern with high local concentration in windrows when β is large and volumetrically diffused smooth pattern when β is small yang et al 2014a 2015 for the cc condition w can be set to be the deardorff convective velocity w g α t w θ s z i 1 3 where g is the gravitational acceleration α t is the thermal expansion coefficient w is the vertical velocity fluctuation θ is the temperature fluctuation z i is the oml depth and s denotes a reynolds average at the surface in practice it is computed at the first les grid below the mean sea surface level chor et al 2018a it is worth mentioning that very recently a more general form for the turbulence velocity scale w has been proposed to account for various levels of wind shear stokes drift and buoyancy flux chor et al 2018b because the oil transport in the oml and the resulted light field variation are highly three dimensional fig 1 this requires us to analyze both the horizontal and the vertical distributions of the oil concentration and their effects on the light field fig 7 shows several representative instantaneous snapshots of oil concentration on the surface and the corresponding subsurface light field at 10 m depth the vertical variations on the oil and light fields are illustrated by the vertical profiles of horizontal average statistics shown in figs 8 and 9 we analyze the effect of the oil on the subsurface light field by quantifying the beam attenuation coefficient c and the downward irradiance e d mobley 1994 xu et al 2012 when calculating horizontal average we focus on the flow regions contaminated by the dispersed oil plume which can be determined statistically based on the time average of the vertically integrated oil concentration chen et al 2018 previous study has shown that the averaged oil plumes are smooth and continuous even when the instantaneous oil field is highly intermittent yang et al 2015 as shown in figs 8 a and 9 a the horizontal area a of the average oil contaminated region increases as the droplet floatability decreases plumes of large oil droplets possess strong floatability to overcome the downwelling motion induced by langmuir circulations and thermal convection forming high concentration surface plumes that cover relatively small regions near the surface plumes of small oil droplets have weak floatability and can be dispersed widely by oml flows over large horizontal and vertical extensions which also dilute the local oil droplet concentration to relatively low level yang et al 2014a chor et al 2018a b the statistics of the oil plume and light field can be obtained by performing horizontal average within a which is denoted as a as shown in figs 8 b and 9 b plumes of larger droplets tend to have higher average concentration near the surface with rapidly decreased concentration towards deeper depth while plumes of smaller droplets have more smooth vertical distribution of oil concentration as a result the oil plumes with d 0 70 mm cause significant increase of light attenuation coefficient near the surface but this effect decreases quickly with depth due to the decrease of oil concentration figs 8 b and 9 b for the cases with d 0 42 mm and d 0 27 mm although the increase of light attenuation coefficient near the surface may be less significant than that in the case with d 0 70 mm this effect persists over much deeper depth due to the much smoother distribution of oil droplets over the seawater column figs 8 c and 9 c combining the effects of the vertical oil distribution horizontal intermittency level of the oil plume and difference in local oil concentration fig 6 the oil plumes with smaller droplets result in more significant deficit for the downward irradiance than the plumes with larger droplets even though the latter have higher local oil concentration near the surface figs 8 d and 9 d it should be pointed out that the current study focuses on modeling the effects of monodispersed surface oil plumes on upper ocean radiative transfer with idealized oceanic and oil release conditions separating oil plumes with different droplet sizes into different simulation cases allows us to connect the droplet size oil plume dilution pattern and the radiative transfer with the recent advancements on modeling oil droplet size distribution in subsea blowouts zhao et al 2014 2015 socolofsky et al 2015 li et al 2017 les of polydispersed oil plumes can be performed to obtain in situ modeling of more realistic surface plumes with the mixture of various droplet sizes which will be a subject of future study as the initial attempt in this study we limit to the idealized setup considering the high level of complexity and computational cost involved in applying several high fidelity numerical models 4 conclusion and discussion the current study combines the strengths of several high fidelity numerical models for simulating various physical processes i e wave mechanics oil plume dispersion by oml turbulent flows and radiative transfer through the complex oil seawater mixture medium to help improve our understanding on the impact of offshore oil spills on ocean light field due to the high complexity of the physical processes by no mean the current study is meant to capture all the relevant physics in this problem nevertheless the simulation results presented here show that plumes of oil droplets can significantly reduce the downward irradiance of the light in the ocean euphotic zone and this effect is strongly affected by the dynamic interaction between oil and oml flows governed by the oil droplet floatability while in general the presence of oil plume can cause considerable reduction to the downward irradiance this effect appears to be more significant for plumes of smaller oil droplet sizes because these plumes are dispersed more widely by the oml flows this finding suggests that additional effect to the ocean ecosystem caused by the variation of ocean light field may need to be taken into consideration when applying dispersant for oil spill remediation and response as dispersant can significantly reduce the oil droplet size moreover it is worth mentioning that the numerical models used in this study can also be applied to simulate the backscattered light signal of surface oil plumes which can provide useful insights to help link the remote sensing signals to the surface and subsurface characteristics of the oil plumes to support the decision making process for future oil spill response and remediation furhermore even though the reduced downward irradiance obtained from the current study can be used to estimate the potential impact of oil plumes on the phytoplankton photosynthesis rate the direct calculation of the phytoplankton population evolution and photosynthesis rate are not included in the current model with the continuous advancement in computer power and numerical model capability these additional features may be included into the current modeling framework these are the subjects for future research acknowledgments this research was made possible by a grant from the gulf of mexico research initiative d y also acknowledges the financial support from start up funds at the university of houston data are publicly available through the gulf of mexico research initiative information and data cooperative griidc at https data gulfresearchinitiative org data r5 x283 000 0004 doi 10 7266 n7 w0hm 6f39 appendix a high order spectral simulation of sea surface waves in current hos model the continuity equation and boundary conditions 1 and 2 are solved together based on the perturbation method and pseudo spectral method dommermuth and yue 1987 in particular φ is expanded into a perturbation series with respect to wave steepness to order m a 1 φ x y z t m 1 m φ m x y z t the surface potential φ s can then be expressed based on the perturbation modes φ m using taylor series expansion about z 0 a 2 φ s x y t m 1 m ℓ 0 m m η ℓ ℓ ℓ z ℓ φ m x y z t z 0 finally φ m is rewritten into an eigenfunction expansion a 3 φ m x y z t n 1 n φ n m t ψ n x y z where ψ n x y z exp k n z i k n x is the eigenfunction under deep water condition i 1 x is the horizontal coordinate vector and k n k x n k y n is the two dimensional wavenumber vector for the n th wave mode which is related to the scalar wavenumber as k k k x 2 k y 2 by substituting eqs a 1 a 3 into 1 and 2 the evolution equations for η and φ s are obtained dommermuth and yue 1987 mei et al 2005 a 4 η t η φ s 1 η 2 m 1 m ℓ 0 m m η ℓ ℓ n 1 n φ n m ℓ 1 ψ n z ℓ 1 z 0 a 5 φ s t g η φ s 2 2 1 η 2 2 m 1 m ℓ 0 m m η ℓ ℓ n 1 n φ n m ℓ 1 ψ n z ℓ 1 z 0 2 in the current hos model eqs a 4 and a 5 are discretized using the pseudo spectral method based on fourier series and integrated in time by a fourth order runge kutta scheme yang and shen 2011 yang et al 2013 2014b c the hos model can capture the nonlinear wave wave interactions and simulate an unsteady time resolved surface wave field in this study the hos wave simulation is initialized based on the empirical wave spectra for equilibrium ocean wave conditions from donelan and pierson 1987 using a random phase method yang and shen 2011 yang et al 2014b under the equilibrium condition the energy input from the wind to the wave field is weak and the hos model may be used without the expensive coupling with a wind turbulence solver that was used in yang and shen 2011 as shown in yang et al 2013 the current hos model can maintain the equilibrium wave spectrum well for a considerable period of time without the dynamic coupling with the wind field for energy input therefore in this study the hos model is used in a stand alone mode to provide unsteady time resolved surface wave fields in spatial domain for modeling the effects of surface waves on the light refraction at the air water interface under equilibrium wind wave condition note that if a non equilibrium wind wave condition is to be considered proper wind forcing should be included in the hos model in order to capture the evolution of the wave spectrum we note that the study reported in the current paper mainly focuses on the simulations and analysis of the effects of the surface oil plumes on the underwater radiative transfer the effects of sea surface waves on the radiative transfer have already been studied extensively in previous studies e g xu et al 2011 xu and yue 2014 thus are not analyzed in detail in the current paper it is worth mentioning that the surface wave field may also be synthesized by simple linear superposition of fourier modes based on the empirical wave spectra which can save the computational cost associated with simulating the wave field however cautions should be taken for the potential errors associated with neglecting the wave nonlinearity effects xu et al 2011 note that for the simulation cases reported in this study the total computational cost is mostly associated with the les modeling of the oil plume dispersion in the ocean turbulence as well as the mcs modeling of the underwater radiative transfer and the impact of the hos wave modeling on the computational cost is small therefore in this study the hos model is adopted for providing the surface wave field condition to the mcs considering its high order accuracy and computational efficiency appendix b modeling the inherent optical properties of oil contaminated seawater in natural ocean condition the seawater inherent optical properties vary with temperature θ salinity s chlorophyll concentration c c h optical properties and number density n d of suspended oil droplets etc mobley 1994 kirk 2011 inducing significant variation to the light field xu et al 2012 in the case of oil contaminated seawater the effects of suspended crude oil droplets dominate the variation of the iops in the reported simulations the environmental parameters of natural seawater i e θ s and c c h are prescribed based on typical ocean environments the instantaneous local number density of crude oil droplets is given by n d c ρ d π d 3 6 where c is the oil mass concentration obtained from the les oil plume model ρ d is the density of oil droplet and d is oil droplet diameter the specific formulas used for computing the iops of oil contaminated seawater are summarized below b 1 modeling light absorption and scattering in natural seawater the light absorption coefficient a can be modeled as a function of temperature θ salinity s chlorophyll concentration c c h light wavelength λ l oil droplet diameter d and number density n d as mobley 1994 bricaud et al 1998 stramski and tegowski 2001 woźniak and dera 2007 b 1 a θ s c c h d n d λ l a w θ s λ l a s p m c c h λ l a c d o m c c h λ l a d d n d λ l here a w represents the absorption by seawater molecules and is modeled as pegau et al 1997 jonasz and fournier 2007 b 2 a w θ s λ l a w θ r 0 λ l ψ θ θ θ r ψ s s where θ r is a reference temperature and ψ θ and ψ s are the slope coefficients for θ and s respectively considering a representative ocean mixed layer condition with θ 20 c and s 3 5 in this study we set a w 0 0145 m 1 mobley 1994 the second term a s p m represents the absorption due to suspended particulate matter spm covary with the chlorophyll concentration c c h measured in mg m 3 which can be modeled either as bricaud et al 1998 morel and maritorena 2001 stramski et al 2001 solonenk and mobley 2015 b 3 a s p m c c h λ l b λ l c c h e λ l or as haltrin 1999 xu et al 2012 b 4 a s p m c c h λ l a s p m λ l c c h 0 602 where b λ l e λ l and a s p m λ l are empirical coefficients the third term a c d o m represents the absorption due to colored dissolved organic matter cdom and can be parameterized as bricaud et al 1981 b 5 a c d o m c c h λ l a c d o m c c h λ l r exp s c d o m λ l λ l r where a c d o m c c h λ l r depends on c c h λ l r is a reference light wavelength and s c d o m is an empirical constant kirk 2011 solonenk and mobley 2015 alternatively a c d o m can also be parameterized based on the concentrations of the first two components in cdom i e fulvic acid and humic acid as follows carder et al 1989 haltrin 1999 jonasz and fournier 2007 xu et al 2012 b 6 a c d o m c c h λ l c f a f exp k f λ l c h a h exp k h λ l where c f 1 74098 c c h exp 0 12327 c c h is the specific concentration of fulvic acid a f 35 959 m 2 mg is the specific absorption coefficient of fulvic acid k f 0 0189 nm 1 c h 0 19334 c c h exp 0 12343 c c h is the specific concentration of humic acid a h 18 828 m 2 mg is the specific absorption coefficient of humic acid and k h 0 01105 nm 1 carder et al 1989 haltrin 1999 in this study eqs b 4 and b 6 are used to model a s p m and a c d o m respectively the corresponding vertical distribution of chlorophyll concentration is prescribed based on woźniak and dera 2007 b 7 c c h z c c h 0 c c o n s t c m exp z h m a x σ z 2 c c o n s t c m exp h m a x σ z 2 where b 8 c c o n s t 1 0 0 0437 0 8644 log c c h 0 0 0883 log c c h 0 2 b 9 c m 0 269 0 245 log c c h 0 1 51 log c c h 0 2 2 13 log c c h 0 3 0 814 log c c h 0 4 b 10 h m a x 17 9 44 6 log c c h 0 38 1 log c c h 0 2 1 32 log c c h 0 3 10 7 log c c h 0 4 b 11 σ z 0 01 4 08 2 17 log c c h 0 0 239 log c c h 0 2 0 562 log c c h 0 3 0 514 log c c h 0 4 and the surface concentration of chlorophyll is assumed to be c c h 0 c c h 0 0 1 mg m 3 woźniak and dera 2007 the last term a d in eq b 1 accounts for the absorption due to suspended oil droplets which depends on the droplet number density n d and droplet diameter d it can be modeled based on mie theory as stramski and tegowski 2001 otremba and król 2002 hergert and wriedt 2012 b 12 a d d n d λ l π d 2 4 q a b d λ l n d where q a b is the absorption efficiency details on how to model q a b using mie theory are given further below the light scattering coefficient b can be modeled as stramski and tegowski 2001 solonenk and mobley 2015 b 13 b c c h d n d λ l b w λ l b s p m c c h λ l b d d n d λ l here b w corresponds to the scattering caused by water molecules b 14 b w λ l 5 83 1 0 3 λ l r λ l 4 322 b s p m corresponds to the scattering caused by the spm b 15 b s p m c c h λ l b s λ l c s c c h b l λ l c l c c h where b s measured in m 2 mg and c s measured in mg m 3 are the specific scattering coefficient and concentration of small size spm respectively and b l and c l are the corresponding quantities for large size spm they can be parameterized as haltrin 1999 solonenk and mobley 2015 b 16 b s λ l 1 513 1 0 3 λ l r λ l 1 7 b 17 b l λ l 3 411 1 0 4 λ l r λ l 0 3 b 18 c s c c h 17 39 c c h exp 0 11631 c c h b 19 c l c c h 762 84 c c h exp 0 03092 c c h the last term b d accounts for the scattering due to suspended oil which can be modeled based on mie theory as stramski and tegowski 2001 otremba and król 2002 hergert and wriedt 2012 b 20 b d d n d λ l π d 2 4 q s c d λ l n d where q s c is the scattering efficiency details on how to model q s c using mie theory are given further below the scattering direction is determined by the total scattering phase function which is expressed as a weighted sum of the three contributions stramski and tegowski 2001 b 21 ℬ δ θ c c h d n d λ l ℬ w δ θ λ l b w λ l b c c h d n d λ l ℬ s p m δ θ b s p m λ l b c c h d n d λ l ℬ d δ θ λ l b d d n d λ l b c c h d n d λ l where δ θ is the relative polar angle away from the incident direction due to scattering and ℬ w δ θ λ l ℬ s p m δ θ and ℬ d δ θ λ l are the scattering phase functions of seawater spm and other particles respectively values for ℬ w δ θ λ l can be found in mobley 1994 and morel and maritorena 2001 ℬ s p m δ θ is modeled by the petzold phase function petzold 1972 stramski and tegowski 2001 solonenk and mobley 2015 and ℬ d δ θ λ l is modeled based on mie theory with details given below note that in eq b 21 the dependence on the change of azimuthal angle φ is not included by assuming homogeneity of the scattering direction with respect to φ fig b 1 shows the result of a mcs test case for radiative transfer of 500 nm light in a natural ocean condition without oil with a mean surface chlorophyll concentration of c c h 0 1 mg m 3 in this test case the vertical profile of the chlorophyll concentration is modeled based on eq b 7 and c c h 0 the corresponding seawater absorption and scattering coefficients are modeled based on eqs b 1 and b 13 and the scattering phase function is modeled based on eq b 21 the corresponding diffuse attenuation coefficient k d as a function of the vertical coordinate z can be calculated based on the empirical model as woźniak et al 2003 woźniak and dera 2007 b 22 k d z k w c c h z c 1 exp a 1 c c h z k d i for the λ l 500 nm light the model constants are k w 0 0276 m 1 c 1 0 0672 m 2 mg a 1 0 610 m 3 mg and k d i 0 0389 m 2 mg overall the vertical profile of e d obtained from the current mcs model shows good agreement with the exponential decay profile e d z e d 0 exp 0 z k d ζ d ζ predicted by the empirical model of woźniak et al 2003 where the k d profile is given by eq b 22 b 2 modeling light scattering by oil droplets based on mie theory the corresponding absorption and scattering coefficients of oil droplets can be calculated via mie theory mie 1908 bohren and huffman 2008 in particular the extinction efficiency q e x scattering efficiency q s c and absorption efficiency q a b due to suspended oil droplets are calculated as bohren and huffman 2008 b 23 q s c 2 χ 2 n 1 2 n 1 a n 2 b n 2 b 24 q e x 2 χ 2 n 1 2 n 1 ℜ a n b n b 25 q a b q e x q s c where χ π d λ l is the diffraction parameter ℜ is the real part of the sum of the complex numbers a n and b n b 26 a n d n m χ m n χ ψ n χ ψ n 1 χ d n m χ m n χ ξ n χ ξ n 1 χ b 27 b n d n m χ m n χ ψ n χ ψ n 1 χ d n m χ m n χ ξ n χ ξ n 1 χ m n d n w is the relative refractive index n d is the refractive index of oil droplet n w is the refractive index of seawater and d n ϱ d ln ψ n ϱ d ϱ is the logarithmic derivative which satisfies the recurrence relation b 28 d n 1 ϱ n ϱ 1 d n ϱ n ϱ the riccati bessel functions ψ n x and ξ n x satisfy the following upward recurrence relation bohren and huffman 2008 b 29 ψ n 1 χ 2 n 1 χ ψ n χ ψ n 1 χ b 30 ξ n 1 χ 2 n 1 χ ξ n χ ξ n 1 χ beginning with b 31 ψ 0 χ sin χ b 32 ψ 1 χ cos χ b 33 ξ 0 χ sin χ i cos χ b 34 ξ 1 χ cos χ i sin χ where i 1 in this study the complex refractive index of spherical oil droplet is set to be n d 1 494 0 0089 i for light with wavelength λ l 450 nm otremba and piskozub 2004 and the refractive index of seawater is n w 1 34 the scattering function due to oil droplets can also be determined based on a n and b n as fu and sun 2001 bohren and huffman 2008 b 35 p d δ θ 2 χ 2 q s c s 1 δ θ 2 s 2 δ θ 2 where s 1 and s 2 are the amplitude functions b 36 s 1 δ θ n 1 2 n 1 n n 1 a n π n cos δ θ b n τ n cos δ θ b 37 s 2 δ θ n 1 2 n 1 n n 1 a n τ n cos δ θ b n π n cos δ θ here the angular functions π n and τ n are defined as π n p n 1 sin δ θ and τ n d p n 1 d δ θ where p n 1 are the associated legendre functions of the first kind of degree n and order 1 in the simulation π n and τ n can be calculated based on the following upward recurrence relations bohren and huffman 2008 b 38 π n ς 2 n 1 n 1 ς π n 1 ς n n 1 π n 2 ς b 39 τ n ς n ς π n ς n 1 π n 1 ς beginning with b 40 π 1 ς 1 b 41 π 0 ς 0 where ς cos δ θ the scattering phase function used in eq b 21 can then be obtained as ℬ d p d 4 π fig b 2 shows some sample results for the scattering phase functions for various diffraction parameters obtained using mie theory the results computed by mie theory scattering module in the current mcs model are plotted together with the theoretical results from fu and sun 2001 note that the values from fu and sun 2001 are reproduced by digitalizing the results reported in their fig 5 so some small artificial errors may be induced during this image digitalization process nevertheless fig b 2 shows good agreement between the two independent calculations which shows that the mie scattering model is implemented correctly in the current mcs model framework it should be noted that mie theory may not always provide accurate prediction of the volume scattering functions for nonspherical particles the oil droplets dispersed in the upper ocean boundary layer may exhibit noticeable deformations due to the forcing induced by the oceanic flows such as turbulence and waves which has not been well studied due to the complex physical processes involved moreover to the best of the authors knowledge up to date there is no reliable and accurate empirical models for the volume scattering functions of oil seawater mixture in a dynamic ocean environment like what is pointed out by bohren and huffman 2008 for the complex problem studied in this paper mie theory seems to be one of the only few feasible methods for modeling the light scattering properties of the oil contaminated seawater however if new advancements are made in the future on the empirical or theoretical modeling of the effects of oil droplets on light scattering the current mcs model can be readily improved by implementing these new scattering models to replace the existing mie theory module b 3 light refraction at the air water interface when an unpolarized light enters the water through the air water interface the refraction follows the snell s law mobley 1994 b 42 n a sin γ i n w sin γ t where γ i is the incident angle with respect to the interface normal direction γ t is the transmitted angle on the water side and n a and n w are the optical refractive indices of air and water respectively the reflectance r of the radiant energy is given by the fresnel equations mobley 1994 b 43 r 1 2 sin γ i γ t sin γ i γ t 2 tan γ i γ t tan γ i γ t 2 if γ i 0 n a n w n a n w 2 if γ i 0 in the mcs model for a photon packet passing the air water interface the refraction of its trajectory is modeled based on eq b 42 and the transmitted energy that the photon packet carries into the water is e t e i 1 r where e i is the incident energy of the photon packet and r is determined by eq b 43 leathers et al 2004 fig b 3 shows the downward irradiance e d in the seawater without oil plumes for the lc and cc cases for comparison an additional reference case with a flat sea surface is also shown this figure illustrates the effect of sea surface waves for the downward irradiance shown in figs 8 and 9 the presence of the sea surface wave field causes a small fraction of the incident light energy to reflect back to the air resulting smaller downward irradiance under the wave surface than that under the flat water surface corresponding to the idealized calm sea condition note that the wave fields in the lc and cc cases obey the same empirical wave spectrum model from donelan and pierson 1987 although the peak wavelengths of sea surface waves in these two cases are different see section 3 1 the surface slopes of the waves in the high wavenumber range are similar between the two cases resulting in similar initial downward irradiance underneath the wave surface the downward irradiances for the lc and cc cases obtained without oil plumes are used as the reference value e d r in figs 8 d and 9 d for obtaining the oil induced deficit 
24000,oil plumes released from subsea blowouts can induce strong optical extinction effect and significantly affect radiative transfer in the ocean euphotic zone where photosynthesis occurs in this paper the effect of oil plumes on the ocean radiative transfer is studied numerically by modeling the dispersion of oil plume in the ocean mixed layer and the radiative transfer through the oil contaminated seawater due to the interactions with flows in the ocean mixed layer oil plumes of different droplet diameters exhibit considerable differences in plume size shape and oil concentration with the same volumetric release rate plumes of large oil droplets exhibit highly intermittent local concentration in near surface regions and cause strong but intermittent extinction effect over relatively small horizontal area plumes of small oil droplets diffuse more smoothly over large horizontal and vertical extensions resulting in significant overall extinction effect to the radiative transfer in the ocean euphotic zone keywords oil spill dispersion ocean optics turbulence wave 1 introduction crude oil as indicated by its dark color is a strong absorber of light when spilled into the upper ocean otremba 2007 in the aftermath of a large scale offshore oil spill such as the 2010 deepwater horizon accident spilled crude oil can spread over a large horizontal area in the upper ocean and last for long time before being restored or biodegraded inducing significant impact on the ocean ecosystem atlas and hazen 2011 camilli et al 2010 hazen et al 2010 surface oil slicks and suspended oil droplets in the euphotic zone can block light from penetrating into subsurface region where phytoplankton live kirk 2011 threatening the ocean ecosystem from the origin of its food chain by significantly reducing the rate of photosynthesis on the other hand ultraviolet light can alter degrade oil in the process of photo degradation which can produce some byproducts that can be more toxic than the source oil king et al 2014 radović et al 2014 ray et al 2014 bacosa et al 2015 improved knowledge on the light penetration in oil contaminated seawater can help obtain a more accurate estimation of the photo degradation rate than using the normal light penetration profiles obtained based on the natural ocean condition recent report by lay et al 2015 based on the field measurement data obtained during the deepwater horizon oil spill incident has confirmed the noticeable effect of spilled crude oil on the vertical variation of incident ultraviolet radiation and extinction coefficients in the northern gulf of mexico thus understanding the oil induced effects on the oceanic radiative transfer is crucial for accurately modeling the ocean ecosystem evolution in the wake of a large offshore oil spill suspended crude oil droplets affect the local seawater s inherent optical properties iops i e the light absorption and scattering coefficients which depend on the local droplet number density droplet size and oil type otremba and król 2002 król et al 2006 otremba 2007 rudź et al 2013 the dispersion of oil droplets and other buoyant particles in the euphotic zone is actively driven by various physical processes induced by atmospheric forcing e g shear induced turbulence sea surface waves langmuir circulations ekman transport thermal convection etc edson et al 2007 sullivan and mcwilliams 2010 özgökmen et al 2012 d asaro 2014 kukulka et al 2016 these effects continuously mix the very upper tens of meters of the ocean to form the ocean mixed layer oml which can also cause considerable dilution of the oil droplet plume by horizontal and vertical mixing see e g mcwilliams and sullivan 2000 yang et al 2015 on the other hand the buoyancy of the oil droplets acts as a resistant force to the mixing effects generated by the oceanic flows and can cause inhibition of oil plume dilution under certain conditions yang et al 2014a in recent years the continuous growth of computer power has made high fidelity computational models feasible for tackling the complex ocean processes particularly large eddy simulation les based on the craik leibovich cl equation leibovich 1983 has proven to be a useful tool for providing insights of fine scale oceanic flows and transport phenomena skyllingstad and denbo 1995 mcwilliams et al 1997 li et al 2005 noh et al 2006 harcourt and d asaro 2008 grant and belcher 2009 kukulka et al 2009 li and fox kemper 2017 using the les method several recent studies have been able to shed light on the detailed three dimensional dispersion processes of oil plumes in the oml under various conditions yang et al 2014a 2015 chor et al 2018a b in particular under wind and wave dominant conditions plumes of oil droplets are found to be strongly affected by langmuir circulations and shear induced turbulence and exhibit various types of surface patterns with different dilution levels ranging from highly intermittent surface streaks for large oil droplets to smoothly diffused plumes for small oil droplets yang et al 2014a 2015 under convection dominant conditions buoyant materials show strong preferential concentration in surface convergence regions generated by convective cells in addition highly buoyant particles e g large oil droplets can also be affected by a secondary effect induced by some persistent surface vortices in the turbulent flow field that collect and cluster these particles into vorticity dominant surface regions chor et al 2018a due to the considerable spatial variation of oil droplet concentration caused by these aforementioned flow induced transport phenomena in the oml the iops of the oil contaminated seawater can also exhibit complex spatial variations that can strongly affect the variation of light intensity in the euphotic zone which is a crucial information for modeling the light variation due to oil spill but has not been well understood up to date simple one dimensional downward irradiance models e g woźniak et al 2003 lee et al 2005 woźniak and dera 2007 require the information about the diffuse attenuation coefficient which is an apparent optical property of the water body and is not available from the literature for the ocean contaminated by oil plumes with complex spatial variations this directly motivates the current study with the detailed three dimensional flow field information in hand the oceanic light field can be efficiently modeled by solving the radiative transfer equation using the monte carlo simulation mcs method kirk 1981a b gordon 1985 simulations based on the mcs method can capture the three dimensional radiative transfer in dynamic ocean covered by wind generated sea surface waves you et al 2009 xu et al 2011 the combination of les and mcs methods has been demonstrated to provide valuable insights for understanding the complex effects of ocean turbulence on its optical properties xu et al 2012 the effects of particles on the radiative transfer can also be included in the mcs method using the mie theory e g plass and kattawar 1972 wang and wang 2002 in this study we utilize these recent advancements in computational models to establish a numerical modeling framework for simulating the radiative transfer in the ocean euphotic zone contaminated by plumes of suspended crude oil droplets we perform two sets of numerical experiments corresponding to two representative oml flow conditions 1 wind wave dominant condition with shear generated turbulence and wave induced langmuir circulations and 2 convection dominant condition with thermal convective cells because the oil droplet size plays a crucial role in determining both the dynamic response of the oil plume to the oml flows yang et al 2014a 2015 and the light absorption scattering mie 1908 otremba and król 2002 otremba 2007 for each oml condition we consider three different oil droplet diameters all together these simulation cases allow us to cover a variety of oil plume patterns with different levels of horizontal and vertical dilutions from which the effect of oil contamination on oceanic radiative transfer is studied fig 1 illustrates the problem configuration and some representative results for the effect of flow and oil field on the radiative transfer this paper is organized as follows details of the computational models used in this work are reported in section 2 section 3 shows the simulation and statistical analysis results finally conclusions are given in section 4 2 numerical models 2 1 highlight of modeling strategy radiative transfer in natural seawater is affected by the sea surface geometry and seawater properties underneath the surface e g temperature salinity suspended particulate matter colored dissolved organic matter etc mobley 1994 kirk 2011 in the case of an offshore oil spill incident the presence of suspended oil droplets further complicates the radiative transfer process and causes considerable variation to the subsurface light field note that the essential physical processes that affect the light field i e wave oscillation turbulence mixing and transport and photon propagation occur at very different time scales for example the ocean waves oscillate at the periods of o 0 1 o 10 seconds depending on the wavelength the surface oil plumes evolve at the time scale of minutes for small scale features and hours for large scale patterns a photon s lifetime when propagating in the upper ocean is on the order of o 0 001 o 0 1 microseconds depending on the penetration depth the considerable time scale separation and significant differences in the details of the physical processes impose great challenges in this study we adopted a suite of numerical models that were designed for capturing different aspects of this complex physical problem and combined their strengths to tackle the problem the overall modeling strategy is highlighted below i the instantaneous sea surface wave field is simulated using a high order spectral hos method dommermuth and yue 1987 which provides the geometry of the air water interface for modeling the light refraction at the sea surface based on snell s law and fresnel s equations you et al 2009 xu et al 2011 see details in section 2 2 and appendix a ii underneath the sea surface the oml flow field is simulated using a les model yang et al 2014a which models the oceanic flow structures e g shear turbulence langmuir circulations convective cells etc generated by sea surface wind shear stress surface heat flux and wave induced stokes drift this les model is based on the widely used craik leibovich equation in which the accumulated effect of sea surface waves on the turbulence and material transport is modeled based on the wave induced stokes drift current leibovich 1983 see details in section 2 3 iii in the ocean column the transport of crude oil droplets is modeled using an eulerian eulerian les method yang et al 2014a 2015 in which the evolution of the concentration field of the oil droplets is simulated by a finite volume les model and is coupled with the les model for oceanic flow described in ii see details in section 2 3 iv based on the instantaneous sea surface wave geometry obtained from i and the instantaneous oil droplet concentration obtained from iii the seawater iops are modeled and the radiative transfer in the euphotic zone is simulated by a mcs model this model can capture the effects of suspended oil droplets on the absorption and scattering of photons as they propagate through the mixture of seawater and oil droplets see details in section 2 4 and appendix b each of these above models has proven track record for modeling their corresponding physical processes in various applications and their details are presented in the next several subsections fig 1 shows a representative example of the simulation results obtained by this set of numerical models because the physical processes involved in the current problem are complicated and occur over a wide range of time and length scales it is impractical to perform the simulations with each of the above models fully coupled in a two way dynamic coupling manner instead in the current study the hydrodynamic models i iii are used as precursor simulators to provide the required flow field data for the mcs model iv to simulate the radiative transfer in the oil contaminated seawater among the three hydrodynamic models i iii the two les models ii and iii are dynamically coupled to simulate the oil plume dispersion in the upper ocean in a wave averaged but turbulence resolved manner as explained below in section 2 3 the coupled les models account for the accumulated effect of sea surface waves on the oil transport but do not model the instantaneous waves explicitly the hos model i uses identical wave spectra as in the les model to provide the corresponding wave surface geometry the combination of the surface waves and the subsurface oil concentration field provides a synthetic upper ocean field for modeling the radiative transfer process details of each models are discussed below in sections 2 2 2 4 as well as in appendices a and b 2 2 high order spectral simulation of sea surface waves when light strikes on the sea surface it first interacts with the air water interface curved due to waves in this study we adopt the widely used high order spectral method to simulate instantaneous sea surface waves the hos method models the wave motions based on the potential flow theory in which the wave orbital velocity satisfies u φ where φ is the velocity potential in the water body the wave induced flow motions satisfy the continuity equation 2 φ 0 on the sea surface the wave satisfies both the kinematic and dynamic free surface boundary conditions which can be defined precisely at the instantaneous wave surface z η x y t using zakharov s equations zakharov 1968 1 η t η φ s 1 η 2 z φ x y η t 0 at z η 2 φ s t g η φ s 2 2 1 2 1 η 2 z φ x y η t 2 0 at z η here η is the instantaneous wave surface elevation φ s φ z η is the surface potential and x y is the horizontal gradient for fast numerical simulation the continuity equation and boundary conditions 1 and 2 are rewritten into series of discretized modes using perturbation method and eigenfunction expansion following dommermuth and yue 1987 also see mei et al 2005 and are solved numerically using fourier series based pseudo spectral method additional details of the current hos model are given in appendix a the hos method has been successfully applied to a variety of different ocean surface wave problems in recent years see e g liu and yue 1998 tanaka 2001 alam et al 2010 goullet and choi 2011 yang and shen 2011 yang et al 2013 2014b c fig 2 a shows a sample result of sea surface wave field simulated using the current hos model 2 3 large eddy simulation of turbulent flows and oil plume transport in ocean mixed layer to efficiently simulate the langmuir circulations and shear convection driven turbulent flows in the ocean mixed layer and the corresponding oil plume transport we employ a les model that consists of a pseudo spectral finite difference flow solver based on the cl equation and a finite volume oil transport solver chamecki et al 2008 yang et al 2014a this les model has been successfully applied to simulate oil and buoyant particle dispersion in oml in several recent studies yang et al 2014a 2015 chen et al 2016 chor et al 2018a b in this model the oml flows are governed by the filtered continuity equation and cl equation 3 u 0 4 d u d t 1 ρ 0 p f c e 3 u u s u s ω τ d 1 ρ ρ 0 g e 3 here tilde denotes a variable resolved on the les grid u is the fluid velocity vector d d t t u is the material derivative ρ 0 is the reference seawater density ρ is the resolved local seawater density p is the modified pressure g is the gravitational acceleration e 3 is the unit vector in the vertical direction f c is the coriolis frequency u s is the wave induced stokes drift velocity ω u is the vorticity and τ u u u u is the subgrid scale sgs stress tensor with tr τ being its trace and τ d τ tr τ 3 i being its deviatoric part and i is the identity tensor the first four terms on the right hand side of eq 4 are pressure gradient force coriolis force the vortex force due to stokes drift representing the phase averaged effects of surface gravity waves on the mean flow and turbulence and the sgs term representing the effect of unresolved fluid motions below les grid scale details for modeling the stokes drift current u s z are given further below the last term in eq 4 is the buoyancy force due to density variation which is formed based on the boussinesq approximation see e g mcwilliams et al 1997 özgökmen et al 2011 the buoyancy force induced by the oil droplets is neglected due to the low released rate considered in this study and the low local oil concentration after turbulence induced dilution following previous les studies e g mcwilliams et al 1997 polton et al 2008 kukulka et al 2010 yang et al 2014a 2015 we assume the seawater density satisfies a linear equation of state i e ρ ρ 0 1 α t θ θ 0 where α t 2 1 0 4 k 1 is the thermal expansion coefficient θ is the resolved potential temperature and θ 0 is the reference temperature corresponding to ρ 0 the variation of the potential temperature field is computed by solving a filtered convection diffusion equation 5 d θ d t u s θ π t where π t u θ u θ is the sgs heat flux the transport of oil plumes in oml flows is simulated using an eulerian approach chamecki et al 2008 yang et al 2014a oil droplets of the same diameter d are considered as one species and their instantaneous distribution is represented by a continuous eulerian mass concentration field c x t the evolution of c is governed by the filtered transport equation 6 c t v c π c q s where π c u c u c is the sgs oil concentration flux q s is a source term for subsurface release of the oil droplets and v is the resolved lagrangian transport velocity of the oil droplets which is modeled as ferry and balachandar 2001 yang et al 2014a 2015 chen et al 2016 7 v u u s w r e 3 r 1 t d d u d t τ o t d 3 2 here w r is the droplet rise velocity relative to the surrounding fluid due to the balance of buoyancy gravity and stokes drag which is modeled as balachandar and eaton 2010 yang et al 2016 8 w r w r s re d 0 2 w r s 1 0 15 re d 0 687 1 0 2 re d 750 where w r s ρ 0 ρ d g d 2 18 μ is the droplet rise velocity given by stokes law ρ d is the oil density re d ρ 0 w r d μ is the particle reynolds number and μ is the dynamic viscosity of the seawater the first three terms on the right hand side of eq 7 represent the dominant effects acting on buoyant particles in oml flows the fourth term on the right hand side of eq 7 represents the additional effects due to added mass and sgs fluid stress force where r 3 ρ 0 2 ρ d ρ 0 is the density ratio parameter and t d w r r 1 g is the droplet response time scale yang et al 2015 2016 in order to solve eqs 4 6 proper turbulence closures are required for the sgs terms τ π t and π c in the current model the sgs stress tensor τ is parameterized using the lilly smagorinsky eddy viscosity model smagorinsky 1963 lilly i e τ 2 ν τ s 2 c s δ 2 s s where s u u t 2 is the resolved strain rate tensor ν τ is the sgs eddy viscosity δ is the les grid filter scale and c s is the smagorinsky coefficient the instantaneous and local value of c s is determined dynamically during the simulation using the lagrangian averaged scale dependent dynamic model bou zeid et al 2005 with the sgs eddy viscosity modeled as ν τ c s δ 2 s the sgs heat flux π t and oil mass flux π c are then parameterized as π t ν τ pr τ θ and π c ν τ sc τ c based on constant turbulent prandtl number pr τ 0 4 and schmidt number sc τ 0 4 antonopoulos domis 1981 moeng 1984 mason 1989 sullivan et al 1994 kumar et al 2006 chamecki et al 2009 yang et al 2014a 2015 note that for the simplification of the model the temperature changes of the seawater and oil droplets due to light absorption are not considered in this study the oil droplets and the surrounding seawater are assumed to be in thermal equilibrium state so that the heat exchange between them is also omitted in eq 5 in this study we consider the typical open sea condition such that the sea surface is covered by a broadband wind generated surface wave field with a directional spectrum s k α where k 2 π λ is the wavenumber λ is the wavelength α is the inclination angle between the wave propagation direction and the mean wind direction note that because the cl equation 4 models the accumulated effect of surface waves on the shear driven turbulence in a wave phase averaged context the instantaneous sea surface motions are not included in the simulation consistent with the cl modeling framework the top boundary of the les domain is modeled as a rigid flat surface with an imposed mean shear stress in the downwind direction i e the x direction in this study and the fluctuating components of the horizontal velocity components satisfy the free slip condition at this top boundary the averaged wave effect is taken into account via the stokes drift current following mcwilliams and restrepo 1999 also see e g harcourt and d asaro 2008 webb and fox kemper 2011 li and fox kemper 2017 the leading order approximation of the corresponding stokes drift of such broadband sea surface wave field can be calculated as 9 u s z 2 g 0 π π cos α e 1 sin α e 2 k 2 5 s k α exp 2 k z d α d k where e 1 and e 2 are the unit vectors in the x and y directions respectively in the simulations the wave spectrum s k α is prescribed based on the widely used empirical spectrum obtained by donelan and pierson 1987 based on field measurement data and the stokes drift u s calculated by eq 9 is used in the les model equations 4 5 and 7 to simulate the oml flows fig 2 shows some sample oml flow results obtained by this les model 2 4 monte carlo simulation for radiative transfer the light transport in the ocean euphotic zone is governed by the radiative transfer equation rte mobley 1994 xu and yue 2014 which can be simulated efficiently by the monte carlo simulation method kirk 1981a b as illustrated in fig 3 the mcs method models the scattering and absorption events of photons as they travel in the seawater i e a physical representation for the neumann series of the rte which are controlled by the absorption coefficient a scattering coefficient b beam attenuation coefficient c a b and scattering phase function ℬ by tracing and calculating the summation of the scatterings and absorptions of many photons the oceanic light field can be modeled mcs method has been widely used for studying oceanic radiative transfer see e g kirk 1981a b gordon 1985 xu et al 2011 2012 xu and yue 2014 a general guidance of the mcs method can be found in leathers et al 2004 additional details of the current mcs model are given in appendix b details on modeling a b and ℬ for oil contaminated seawater are also given in appendix b for simplification in the current mcs model a black sky approximation is made such that the light absorption and scattering caused by the atmosphere are neglected consequently a photon packet can be initialized right above the sea surface here we summarize the key procedure of the mcs method used in this study as illustrated in fig 3 1 a photon packet with initial energy e i is launched at a random location in the air right above the ocean surface and travel towards the surface with an incident angle γ i 2 the photon packet passes through the air water interface with a transmitted angle γ t and energy e t based on the fresnel equations and the refraction indices of air n a and water n w 3 when a photon packet travels through the oil contaminated seawater it experiences a medium with spatial variation of iops to determine the optical pathlength l of the photon packet in this highly nonhomogeneous medium the multi stepped approach used by wang et al 1995 is adopted in the current mcs in particular the total pathlength is given by l l i with the sub step pathlength l i being determined by the equation l i c i ln q 1 where c i is the local les cell averaged beam attenuation coefficient for the i th sub step and q 1 is a random number within 0 1 in the simulation the photon packet travels over the optical pathlength l with spatially varying c along its current travel direction described by θ φ where θ and φ are the polar angle and azimuthal angle of the path respectively 4 after traveling over l a random number q 2 0 1 is generated and compared with the single scattering albedo ω 0 b c if q 2 ω 0 the photon packet changes the traveling direction due to scattering and a new set of angles θ φ are determined based on the scattering phase function ℬ and steps 3 and 4 are repeated otherwise the photon packet is deceased due to absorption and a new photon packet is initialized and traced in the simulation by repeating steps 1 4 fig 4 shows a sample result for the radiative transfer of 500 nm wavelength light in clean seawater underneath a surface wave field obtained from the current mcs model in this mcs test case the inherent optical properties of the seawater for the 500 nm light are set to be a 0 0257 m 1 b 0 0029 m 1 and c a b 0 0286 m 1 smith and baker 1981 there were totally 5 1 0 10 photon packets launched and tracked as shown in the figure the typical swimming pool effect associated with wave induced light focusing is clearly visualized from the contours of the downward irradiance e d at two representative depths fig 4 b and c the local downward irradiance is calculated as xu et al 2012 10 e d x y z 0 2 π 0 π 2 i x y z θ φ cos θ sin θ d θ d φ where i x y z θ φ is the local radiance obtained from the mcs model the mcs result also captures the depth dependent decay of the horizontally averaged downward irradiance e d note that the vertical attenuation of the downward irradiance can be expressed in the form of an exponential decay function e d e d 1 exp k d z z 1 where e d 1 is the average downward irradiance at the reference level z 1 1 m and k d is the diffuse attenuation coefficient kirk 2011 for this test case k d 0 0271 m 1 smith and baker 1981 fig 4 d shows good agreement between the mcs result and the exponential decay profile additional validations for the mcs model can be found in appendix b 3 results 3 1 problem setup the upper ocean boundary layer is a highly dynamic system and it is nearly impossible to include all effects in a single modeling framework to capture the detailed spatial variation of the light field we choose to focus on small scale effects relative to submesoscale ocean eddies as shown in fig 1 we consider the oil dispersion in the oml and the resulted light field variation under the influences of shear induced turbulence langmuir circulations sea surface waves and thermal convections we consider two different sea surface forcing conditions corresponding to shear dominant and convection dominant conditions in the shear dominant case a constant wind shear stress τ w 0 168 n m 2 is applied in the x direction which corresponds to a wind speed u 10 10 m s measured at 10 m height and a friction velocity u 1 28 cm s in water based on empirical parameterization donelan 1982 a weak heat flux of q 15 5 w m 2 out of the ocean is imposed at the surface to help spin up the flow mcwilliams et al 1997 yang et al 2014a 2015 under this condition the oml flow is dominated by the three dimensional turbulence generated by the wind induced shear and the coherent langmuir circulation cells generated by wave turbulence interaction the wave condition is discussed further below in the rest of this paper we refer to this flow condition as lc in the convection dominant case we apply a weaker wind stress τ w 0 036 n m 2 corresponding to wind speed u 10 5 m s and friction velocity u 0 59 cm s in water and a stronger surface heat flux of q 207 0 w m 2 under this condition the convective cells generated by the thermal convection are the dominant flow structures and hereinafter we refer to this condition as cc for both flow conditions we set the coriolis frequency to be f c 7 1 0 5 s 1 corresponding to a latitude of 28 7 n note that the surface heat flux imposed in the les represents the combined effect of various surface heat transfer processes e g convection radiation and evaporation edson et al 2007 which are typically not modeled explicitly in the les model based on the cl equation nevertheless the surface wind stress and heat flux conditions considered in this study fall in the range of the parameters considered in previous les studies of oml flows e g mcwilliams et al 1997 harcourt and d asaro 2008 mensa et al 2015 yang et al 2015 chor et al 2018b for both flow conditions we assume the sea surface wave field is in equilibrium with the wind forcing we adopt a widely used empirical broadband wave spectrum parameterization donelan and pierson 1987 the wavelengths at the spectrum peak are λ p 92 2 m for lc and 23 1 m for cc and the corresponding wave periods are t p 7 69 s and 3 85 s respectively based on these empirical spectra for each flow condition a three dimensional broadband wave field is constructed and used as the initial condition for the hos model to simulate the instantaneous sea surface waves underneath the sea surface we use a computational domain of 922 m long and wide and 100 m deep to simulate the oil dispersion in oml using les with 384 384 256 computational grid points the flow field is well mixed in the top half of the domain corresponding to an oml depth z i 50 m and stably stratified further below with a temperature gradient d θ d z 0 01 k m 1 for the broadband wave conditions considered in this study the corresponding stokes drift currents are calculated by integrating the wave spectra mcwilliams and restrepo 1999 harcourt and d asaro 2008 webb and fox kemper 2011 li and fox kemper 2017 the corresponding turbulent langmuir number is about the same for both the lc and cc conditions l a t u u s 0 0 3 where u is the friction velocity in the water caused by the wind shear and u s 0 is the magnitude of the wave induced stokes drift velocity at the mean water surface level mcwilliams et al 1997 following recent les studies on oil plume dispersion in oml e g yang et al 2014a 2015 we use the reference seawater density ρ 0 1031 0 kg m 3 and viscosity μ f 1 08 1 0 3 kg m s and the oil density ρ d 859 9 kg m 3 for each flow condition we consider three different cases differentiated by the droplet diameter i e d 0 27 0 42 and 0 70 mm these droplet diameters fall into the small size range i e typically d 1 mm so that the droplets can be assumed to have spherical shape clift et al 1978 zheng and yapa 2000 and are within the range of possible droplet size distributions reported for offshore oil spills li et al 2017 for each case a monodisperse oil plume with the same droplet size is released from a localized source at the 75 m depth with a low mass release rate of q s 10 kg s in this way the oil plume in each case models a near surface sub plume of oil droplets with similar size originated from a deep water release note that the sub plumes with different droplet sizes would rise along different paths in the oml due to the differences in their rise velocities yang et al 2015 the resulting oil concentration in the surface plume is found to be within the range of the concentration levels obtained from simulations based on the realistic scale blowout rate from the wellhead chen et al 2018 the local oil concentrations obtained from the les runs are also found to be at a level that induce negligible buoyancy effect to the two oml flow conditions considered in this study in the mcs the incident light is directed vertically downward the iops induced by naturally existing substances in the seawater such as water molecules suspended particulate matter and colored dissolved organic matter are prescribed based on empirical parameterizations mobley 1994 woźniak and dera 2007 kirk 2011 the effects of oil droplets on the iops are modeled based on the simulated oil concentration using mie theory bohren and huffman 2008 see more details in appendix b we note that the radiative transfer in the upper ocean is also strongly affected by the wavelength of the light as shown in appendix b in particular the light absorption reaches the lowest order of o 0 01 m 1 in pure seawater around the light wavelength of 450 nm and increases gradually to the order of o 1 m 1 towards both the ultraviolet and infrared ends of the light spectrum the light scattering coefficient of pure seawater decreases monotonically as the light wavelength increases mobley 1994 on the other hand both the light absorption and scattering effects induced by suspended crude oil droplets decrease monotonically as the light wavelength increases otremba 2007 therefore a large set of simulations for a range of representative wavelengths in the full light spectrum would need to be performed in order to obtain the complete picture for the effects of the oil plumes on the upper ocean light field however to avoid further complicating the simulation and data analysis in this study we only consider the radiative transfer of the 450 nm wavelength light which is in the spectrum range for oceanic photosynthesis overall in this study we conduct simulations and data analyses for 6 cases covering two different flow conditions with three different oil droplet sizes for each moreover for comparison purpose we also conduct two benchmark cases without oil plume for both the lc and cc flow conditions 3 2 simulation results and statistical analysis as shown in fig 5 a for the lc condition the interaction between wave induced stokes drift and shear induced turbulence is able to generate langmuir circulations mcwilliams et al 1997 li et al 2005 as indicated by the streaky structures in the vertical velocity contours i e the windrows for the cc condition the large surface heat flux causes strong thermal instability that dominates over the weaker craik leibovich second type instability caused by wave turbulence interaction craik and leibovich 1976 and the thermal convection cells become the main flow structures as shown in fig 5 b note that the vertical velocity field in the lc case fluctuates more energetically than that in the cc case due to the effect of the langmuir circulations as indicated by the vertical velocity contours shown in fig 5 the flow field features for the wind wave dominant lc case and the convection dominant cc case are consistent with those reported in the literature e g mcwilliams et al 1997 mensa et al 2015 in response to the flow induced transport the surface oil plume forms different patterns due to the different characteristics of the flow conditions in the lc condition the oil converges into narrow downwind bands namely the surface windrows generated by contour rotating langmuir cells mcwilliams et al 1997 yang et al 2014a 2015 while in the cc condition the oil concentrates into surface patches corresponding to convergence regions between convective cells chor et al 2018a moreover as shown in fig 6 for the same flow condition the oil plume pattern is also strongly affected by the buoyancy of the oil droplet which can be quantified by the floatability parameter β w r w where w r is the droplet rise velocity due to buoyancy and w is a velocity scale representing the level of mixing induced by oml flows for the lc condition w can be set to be the surface stokes drift velocity u s 0 and β w r u s 0 d b 1 where d b is the drift to buoyancy ratio proposed by yang et al 2014a as shown in fig 6 b d the oil plume exhibits highly intermittent surface pattern with high local concentration in windrows when β is large and volumetrically diffused smooth pattern when β is small yang et al 2014a 2015 for the cc condition w can be set to be the deardorff convective velocity w g α t w θ s z i 1 3 where g is the gravitational acceleration α t is the thermal expansion coefficient w is the vertical velocity fluctuation θ is the temperature fluctuation z i is the oml depth and s denotes a reynolds average at the surface in practice it is computed at the first les grid below the mean sea surface level chor et al 2018a it is worth mentioning that very recently a more general form for the turbulence velocity scale w has been proposed to account for various levels of wind shear stokes drift and buoyancy flux chor et al 2018b because the oil transport in the oml and the resulted light field variation are highly three dimensional fig 1 this requires us to analyze both the horizontal and the vertical distributions of the oil concentration and their effects on the light field fig 7 shows several representative instantaneous snapshots of oil concentration on the surface and the corresponding subsurface light field at 10 m depth the vertical variations on the oil and light fields are illustrated by the vertical profiles of horizontal average statistics shown in figs 8 and 9 we analyze the effect of the oil on the subsurface light field by quantifying the beam attenuation coefficient c and the downward irradiance e d mobley 1994 xu et al 2012 when calculating horizontal average we focus on the flow regions contaminated by the dispersed oil plume which can be determined statistically based on the time average of the vertically integrated oil concentration chen et al 2018 previous study has shown that the averaged oil plumes are smooth and continuous even when the instantaneous oil field is highly intermittent yang et al 2015 as shown in figs 8 a and 9 a the horizontal area a of the average oil contaminated region increases as the droplet floatability decreases plumes of large oil droplets possess strong floatability to overcome the downwelling motion induced by langmuir circulations and thermal convection forming high concentration surface plumes that cover relatively small regions near the surface plumes of small oil droplets have weak floatability and can be dispersed widely by oml flows over large horizontal and vertical extensions which also dilute the local oil droplet concentration to relatively low level yang et al 2014a chor et al 2018a b the statistics of the oil plume and light field can be obtained by performing horizontal average within a which is denoted as a as shown in figs 8 b and 9 b plumes of larger droplets tend to have higher average concentration near the surface with rapidly decreased concentration towards deeper depth while plumes of smaller droplets have more smooth vertical distribution of oil concentration as a result the oil plumes with d 0 70 mm cause significant increase of light attenuation coefficient near the surface but this effect decreases quickly with depth due to the decrease of oil concentration figs 8 b and 9 b for the cases with d 0 42 mm and d 0 27 mm although the increase of light attenuation coefficient near the surface may be less significant than that in the case with d 0 70 mm this effect persists over much deeper depth due to the much smoother distribution of oil droplets over the seawater column figs 8 c and 9 c combining the effects of the vertical oil distribution horizontal intermittency level of the oil plume and difference in local oil concentration fig 6 the oil plumes with smaller droplets result in more significant deficit for the downward irradiance than the plumes with larger droplets even though the latter have higher local oil concentration near the surface figs 8 d and 9 d it should be pointed out that the current study focuses on modeling the effects of monodispersed surface oil plumes on upper ocean radiative transfer with idealized oceanic and oil release conditions separating oil plumes with different droplet sizes into different simulation cases allows us to connect the droplet size oil plume dilution pattern and the radiative transfer with the recent advancements on modeling oil droplet size distribution in subsea blowouts zhao et al 2014 2015 socolofsky et al 2015 li et al 2017 les of polydispersed oil plumes can be performed to obtain in situ modeling of more realistic surface plumes with the mixture of various droplet sizes which will be a subject of future study as the initial attempt in this study we limit to the idealized setup considering the high level of complexity and computational cost involved in applying several high fidelity numerical models 4 conclusion and discussion the current study combines the strengths of several high fidelity numerical models for simulating various physical processes i e wave mechanics oil plume dispersion by oml turbulent flows and radiative transfer through the complex oil seawater mixture medium to help improve our understanding on the impact of offshore oil spills on ocean light field due to the high complexity of the physical processes by no mean the current study is meant to capture all the relevant physics in this problem nevertheless the simulation results presented here show that plumes of oil droplets can significantly reduce the downward irradiance of the light in the ocean euphotic zone and this effect is strongly affected by the dynamic interaction between oil and oml flows governed by the oil droplet floatability while in general the presence of oil plume can cause considerable reduction to the downward irradiance this effect appears to be more significant for plumes of smaller oil droplet sizes because these plumes are dispersed more widely by the oml flows this finding suggests that additional effect to the ocean ecosystem caused by the variation of ocean light field may need to be taken into consideration when applying dispersant for oil spill remediation and response as dispersant can significantly reduce the oil droplet size moreover it is worth mentioning that the numerical models used in this study can also be applied to simulate the backscattered light signal of surface oil plumes which can provide useful insights to help link the remote sensing signals to the surface and subsurface characteristics of the oil plumes to support the decision making process for future oil spill response and remediation furhermore even though the reduced downward irradiance obtained from the current study can be used to estimate the potential impact of oil plumes on the phytoplankton photosynthesis rate the direct calculation of the phytoplankton population evolution and photosynthesis rate are not included in the current model with the continuous advancement in computer power and numerical model capability these additional features may be included into the current modeling framework these are the subjects for future research acknowledgments this research was made possible by a grant from the gulf of mexico research initiative d y also acknowledges the financial support from start up funds at the university of houston data are publicly available through the gulf of mexico research initiative information and data cooperative griidc at https data gulfresearchinitiative org data r5 x283 000 0004 doi 10 7266 n7 w0hm 6f39 appendix a high order spectral simulation of sea surface waves in current hos model the continuity equation and boundary conditions 1 and 2 are solved together based on the perturbation method and pseudo spectral method dommermuth and yue 1987 in particular φ is expanded into a perturbation series with respect to wave steepness to order m a 1 φ x y z t m 1 m φ m x y z t the surface potential φ s can then be expressed based on the perturbation modes φ m using taylor series expansion about z 0 a 2 φ s x y t m 1 m ℓ 0 m m η ℓ ℓ ℓ z ℓ φ m x y z t z 0 finally φ m is rewritten into an eigenfunction expansion a 3 φ m x y z t n 1 n φ n m t ψ n x y z where ψ n x y z exp k n z i k n x is the eigenfunction under deep water condition i 1 x is the horizontal coordinate vector and k n k x n k y n is the two dimensional wavenumber vector for the n th wave mode which is related to the scalar wavenumber as k k k x 2 k y 2 by substituting eqs a 1 a 3 into 1 and 2 the evolution equations for η and φ s are obtained dommermuth and yue 1987 mei et al 2005 a 4 η t η φ s 1 η 2 m 1 m ℓ 0 m m η ℓ ℓ n 1 n φ n m ℓ 1 ψ n z ℓ 1 z 0 a 5 φ s t g η φ s 2 2 1 η 2 2 m 1 m ℓ 0 m m η ℓ ℓ n 1 n φ n m ℓ 1 ψ n z ℓ 1 z 0 2 in the current hos model eqs a 4 and a 5 are discretized using the pseudo spectral method based on fourier series and integrated in time by a fourth order runge kutta scheme yang and shen 2011 yang et al 2013 2014b c the hos model can capture the nonlinear wave wave interactions and simulate an unsteady time resolved surface wave field in this study the hos wave simulation is initialized based on the empirical wave spectra for equilibrium ocean wave conditions from donelan and pierson 1987 using a random phase method yang and shen 2011 yang et al 2014b under the equilibrium condition the energy input from the wind to the wave field is weak and the hos model may be used without the expensive coupling with a wind turbulence solver that was used in yang and shen 2011 as shown in yang et al 2013 the current hos model can maintain the equilibrium wave spectrum well for a considerable period of time without the dynamic coupling with the wind field for energy input therefore in this study the hos model is used in a stand alone mode to provide unsteady time resolved surface wave fields in spatial domain for modeling the effects of surface waves on the light refraction at the air water interface under equilibrium wind wave condition note that if a non equilibrium wind wave condition is to be considered proper wind forcing should be included in the hos model in order to capture the evolution of the wave spectrum we note that the study reported in the current paper mainly focuses on the simulations and analysis of the effects of the surface oil plumes on the underwater radiative transfer the effects of sea surface waves on the radiative transfer have already been studied extensively in previous studies e g xu et al 2011 xu and yue 2014 thus are not analyzed in detail in the current paper it is worth mentioning that the surface wave field may also be synthesized by simple linear superposition of fourier modes based on the empirical wave spectra which can save the computational cost associated with simulating the wave field however cautions should be taken for the potential errors associated with neglecting the wave nonlinearity effects xu et al 2011 note that for the simulation cases reported in this study the total computational cost is mostly associated with the les modeling of the oil plume dispersion in the ocean turbulence as well as the mcs modeling of the underwater radiative transfer and the impact of the hos wave modeling on the computational cost is small therefore in this study the hos model is adopted for providing the surface wave field condition to the mcs considering its high order accuracy and computational efficiency appendix b modeling the inherent optical properties of oil contaminated seawater in natural ocean condition the seawater inherent optical properties vary with temperature θ salinity s chlorophyll concentration c c h optical properties and number density n d of suspended oil droplets etc mobley 1994 kirk 2011 inducing significant variation to the light field xu et al 2012 in the case of oil contaminated seawater the effects of suspended crude oil droplets dominate the variation of the iops in the reported simulations the environmental parameters of natural seawater i e θ s and c c h are prescribed based on typical ocean environments the instantaneous local number density of crude oil droplets is given by n d c ρ d π d 3 6 where c is the oil mass concentration obtained from the les oil plume model ρ d is the density of oil droplet and d is oil droplet diameter the specific formulas used for computing the iops of oil contaminated seawater are summarized below b 1 modeling light absorption and scattering in natural seawater the light absorption coefficient a can be modeled as a function of temperature θ salinity s chlorophyll concentration c c h light wavelength λ l oil droplet diameter d and number density n d as mobley 1994 bricaud et al 1998 stramski and tegowski 2001 woźniak and dera 2007 b 1 a θ s c c h d n d λ l a w θ s λ l a s p m c c h λ l a c d o m c c h λ l a d d n d λ l here a w represents the absorption by seawater molecules and is modeled as pegau et al 1997 jonasz and fournier 2007 b 2 a w θ s λ l a w θ r 0 λ l ψ θ θ θ r ψ s s where θ r is a reference temperature and ψ θ and ψ s are the slope coefficients for θ and s respectively considering a representative ocean mixed layer condition with θ 20 c and s 3 5 in this study we set a w 0 0145 m 1 mobley 1994 the second term a s p m represents the absorption due to suspended particulate matter spm covary with the chlorophyll concentration c c h measured in mg m 3 which can be modeled either as bricaud et al 1998 morel and maritorena 2001 stramski et al 2001 solonenk and mobley 2015 b 3 a s p m c c h λ l b λ l c c h e λ l or as haltrin 1999 xu et al 2012 b 4 a s p m c c h λ l a s p m λ l c c h 0 602 where b λ l e λ l and a s p m λ l are empirical coefficients the third term a c d o m represents the absorption due to colored dissolved organic matter cdom and can be parameterized as bricaud et al 1981 b 5 a c d o m c c h λ l a c d o m c c h λ l r exp s c d o m λ l λ l r where a c d o m c c h λ l r depends on c c h λ l r is a reference light wavelength and s c d o m is an empirical constant kirk 2011 solonenk and mobley 2015 alternatively a c d o m can also be parameterized based on the concentrations of the first two components in cdom i e fulvic acid and humic acid as follows carder et al 1989 haltrin 1999 jonasz and fournier 2007 xu et al 2012 b 6 a c d o m c c h λ l c f a f exp k f λ l c h a h exp k h λ l where c f 1 74098 c c h exp 0 12327 c c h is the specific concentration of fulvic acid a f 35 959 m 2 mg is the specific absorption coefficient of fulvic acid k f 0 0189 nm 1 c h 0 19334 c c h exp 0 12343 c c h is the specific concentration of humic acid a h 18 828 m 2 mg is the specific absorption coefficient of humic acid and k h 0 01105 nm 1 carder et al 1989 haltrin 1999 in this study eqs b 4 and b 6 are used to model a s p m and a c d o m respectively the corresponding vertical distribution of chlorophyll concentration is prescribed based on woźniak and dera 2007 b 7 c c h z c c h 0 c c o n s t c m exp z h m a x σ z 2 c c o n s t c m exp h m a x σ z 2 where b 8 c c o n s t 1 0 0 0437 0 8644 log c c h 0 0 0883 log c c h 0 2 b 9 c m 0 269 0 245 log c c h 0 1 51 log c c h 0 2 2 13 log c c h 0 3 0 814 log c c h 0 4 b 10 h m a x 17 9 44 6 log c c h 0 38 1 log c c h 0 2 1 32 log c c h 0 3 10 7 log c c h 0 4 b 11 σ z 0 01 4 08 2 17 log c c h 0 0 239 log c c h 0 2 0 562 log c c h 0 3 0 514 log c c h 0 4 and the surface concentration of chlorophyll is assumed to be c c h 0 c c h 0 0 1 mg m 3 woźniak and dera 2007 the last term a d in eq b 1 accounts for the absorption due to suspended oil droplets which depends on the droplet number density n d and droplet diameter d it can be modeled based on mie theory as stramski and tegowski 2001 otremba and król 2002 hergert and wriedt 2012 b 12 a d d n d λ l π d 2 4 q a b d λ l n d where q a b is the absorption efficiency details on how to model q a b using mie theory are given further below the light scattering coefficient b can be modeled as stramski and tegowski 2001 solonenk and mobley 2015 b 13 b c c h d n d λ l b w λ l b s p m c c h λ l b d d n d λ l here b w corresponds to the scattering caused by water molecules b 14 b w λ l 5 83 1 0 3 λ l r λ l 4 322 b s p m corresponds to the scattering caused by the spm b 15 b s p m c c h λ l b s λ l c s c c h b l λ l c l c c h where b s measured in m 2 mg and c s measured in mg m 3 are the specific scattering coefficient and concentration of small size spm respectively and b l and c l are the corresponding quantities for large size spm they can be parameterized as haltrin 1999 solonenk and mobley 2015 b 16 b s λ l 1 513 1 0 3 λ l r λ l 1 7 b 17 b l λ l 3 411 1 0 4 λ l r λ l 0 3 b 18 c s c c h 17 39 c c h exp 0 11631 c c h b 19 c l c c h 762 84 c c h exp 0 03092 c c h the last term b d accounts for the scattering due to suspended oil which can be modeled based on mie theory as stramski and tegowski 2001 otremba and król 2002 hergert and wriedt 2012 b 20 b d d n d λ l π d 2 4 q s c d λ l n d where q s c is the scattering efficiency details on how to model q s c using mie theory are given further below the scattering direction is determined by the total scattering phase function which is expressed as a weighted sum of the three contributions stramski and tegowski 2001 b 21 ℬ δ θ c c h d n d λ l ℬ w δ θ λ l b w λ l b c c h d n d λ l ℬ s p m δ θ b s p m λ l b c c h d n d λ l ℬ d δ θ λ l b d d n d λ l b c c h d n d λ l where δ θ is the relative polar angle away from the incident direction due to scattering and ℬ w δ θ λ l ℬ s p m δ θ and ℬ d δ θ λ l are the scattering phase functions of seawater spm and other particles respectively values for ℬ w δ θ λ l can be found in mobley 1994 and morel and maritorena 2001 ℬ s p m δ θ is modeled by the petzold phase function petzold 1972 stramski and tegowski 2001 solonenk and mobley 2015 and ℬ d δ θ λ l is modeled based on mie theory with details given below note that in eq b 21 the dependence on the change of azimuthal angle φ is not included by assuming homogeneity of the scattering direction with respect to φ fig b 1 shows the result of a mcs test case for radiative transfer of 500 nm light in a natural ocean condition without oil with a mean surface chlorophyll concentration of c c h 0 1 mg m 3 in this test case the vertical profile of the chlorophyll concentration is modeled based on eq b 7 and c c h 0 the corresponding seawater absorption and scattering coefficients are modeled based on eqs b 1 and b 13 and the scattering phase function is modeled based on eq b 21 the corresponding diffuse attenuation coefficient k d as a function of the vertical coordinate z can be calculated based on the empirical model as woźniak et al 2003 woźniak and dera 2007 b 22 k d z k w c c h z c 1 exp a 1 c c h z k d i for the λ l 500 nm light the model constants are k w 0 0276 m 1 c 1 0 0672 m 2 mg a 1 0 610 m 3 mg and k d i 0 0389 m 2 mg overall the vertical profile of e d obtained from the current mcs model shows good agreement with the exponential decay profile e d z e d 0 exp 0 z k d ζ d ζ predicted by the empirical model of woźniak et al 2003 where the k d profile is given by eq b 22 b 2 modeling light scattering by oil droplets based on mie theory the corresponding absorption and scattering coefficients of oil droplets can be calculated via mie theory mie 1908 bohren and huffman 2008 in particular the extinction efficiency q e x scattering efficiency q s c and absorption efficiency q a b due to suspended oil droplets are calculated as bohren and huffman 2008 b 23 q s c 2 χ 2 n 1 2 n 1 a n 2 b n 2 b 24 q e x 2 χ 2 n 1 2 n 1 ℜ a n b n b 25 q a b q e x q s c where χ π d λ l is the diffraction parameter ℜ is the real part of the sum of the complex numbers a n and b n b 26 a n d n m χ m n χ ψ n χ ψ n 1 χ d n m χ m n χ ξ n χ ξ n 1 χ b 27 b n d n m χ m n χ ψ n χ ψ n 1 χ d n m χ m n χ ξ n χ ξ n 1 χ m n d n w is the relative refractive index n d is the refractive index of oil droplet n w is the refractive index of seawater and d n ϱ d ln ψ n ϱ d ϱ is the logarithmic derivative which satisfies the recurrence relation b 28 d n 1 ϱ n ϱ 1 d n ϱ n ϱ the riccati bessel functions ψ n x and ξ n x satisfy the following upward recurrence relation bohren and huffman 2008 b 29 ψ n 1 χ 2 n 1 χ ψ n χ ψ n 1 χ b 30 ξ n 1 χ 2 n 1 χ ξ n χ ξ n 1 χ beginning with b 31 ψ 0 χ sin χ b 32 ψ 1 χ cos χ b 33 ξ 0 χ sin χ i cos χ b 34 ξ 1 χ cos χ i sin χ where i 1 in this study the complex refractive index of spherical oil droplet is set to be n d 1 494 0 0089 i for light with wavelength λ l 450 nm otremba and piskozub 2004 and the refractive index of seawater is n w 1 34 the scattering function due to oil droplets can also be determined based on a n and b n as fu and sun 2001 bohren and huffman 2008 b 35 p d δ θ 2 χ 2 q s c s 1 δ θ 2 s 2 δ θ 2 where s 1 and s 2 are the amplitude functions b 36 s 1 δ θ n 1 2 n 1 n n 1 a n π n cos δ θ b n τ n cos δ θ b 37 s 2 δ θ n 1 2 n 1 n n 1 a n τ n cos δ θ b n π n cos δ θ here the angular functions π n and τ n are defined as π n p n 1 sin δ θ and τ n d p n 1 d δ θ where p n 1 are the associated legendre functions of the first kind of degree n and order 1 in the simulation π n and τ n can be calculated based on the following upward recurrence relations bohren and huffman 2008 b 38 π n ς 2 n 1 n 1 ς π n 1 ς n n 1 π n 2 ς b 39 τ n ς n ς π n ς n 1 π n 1 ς beginning with b 40 π 1 ς 1 b 41 π 0 ς 0 where ς cos δ θ the scattering phase function used in eq b 21 can then be obtained as ℬ d p d 4 π fig b 2 shows some sample results for the scattering phase functions for various diffraction parameters obtained using mie theory the results computed by mie theory scattering module in the current mcs model are plotted together with the theoretical results from fu and sun 2001 note that the values from fu and sun 2001 are reproduced by digitalizing the results reported in their fig 5 so some small artificial errors may be induced during this image digitalization process nevertheless fig b 2 shows good agreement between the two independent calculations which shows that the mie scattering model is implemented correctly in the current mcs model framework it should be noted that mie theory may not always provide accurate prediction of the volume scattering functions for nonspherical particles the oil droplets dispersed in the upper ocean boundary layer may exhibit noticeable deformations due to the forcing induced by the oceanic flows such as turbulence and waves which has not been well studied due to the complex physical processes involved moreover to the best of the authors knowledge up to date there is no reliable and accurate empirical models for the volume scattering functions of oil seawater mixture in a dynamic ocean environment like what is pointed out by bohren and huffman 2008 for the complex problem studied in this paper mie theory seems to be one of the only few feasible methods for modeling the light scattering properties of the oil contaminated seawater however if new advancements are made in the future on the empirical or theoretical modeling of the effects of oil droplets on light scattering the current mcs model can be readily improved by implementing these new scattering models to replace the existing mie theory module b 3 light refraction at the air water interface when an unpolarized light enters the water through the air water interface the refraction follows the snell s law mobley 1994 b 42 n a sin γ i n w sin γ t where γ i is the incident angle with respect to the interface normal direction γ t is the transmitted angle on the water side and n a and n w are the optical refractive indices of air and water respectively the reflectance r of the radiant energy is given by the fresnel equations mobley 1994 b 43 r 1 2 sin γ i γ t sin γ i γ t 2 tan γ i γ t tan γ i γ t 2 if γ i 0 n a n w n a n w 2 if γ i 0 in the mcs model for a photon packet passing the air water interface the refraction of its trajectory is modeled based on eq b 42 and the transmitted energy that the photon packet carries into the water is e t e i 1 r where e i is the incident energy of the photon packet and r is determined by eq b 43 leathers et al 2004 fig b 3 shows the downward irradiance e d in the seawater without oil plumes for the lc and cc cases for comparison an additional reference case with a flat sea surface is also shown this figure illustrates the effect of sea surface waves for the downward irradiance shown in figs 8 and 9 the presence of the sea surface wave field causes a small fraction of the incident light energy to reflect back to the air resulting smaller downward irradiance under the wave surface than that under the flat water surface corresponding to the idealized calm sea condition note that the wave fields in the lc and cc cases obey the same empirical wave spectrum model from donelan and pierson 1987 although the peak wavelengths of sea surface waves in these two cases are different see section 3 1 the surface slopes of the waves in the high wavenumber range are similar between the two cases resulting in similar initial downward irradiance underneath the wave surface the downward irradiances for the lc and cc cases obtained without oil plumes are used as the reference value e d r in figs 8 d and 9 d for obtaining the oil induced deficit 
24001,research performed to date on data assimilation da in storm surge modeling has found it to have limited value for predicting rapid surge responses e g those accompanying tropical cyclones in this paper we submit that a well resolved barotropic hydrodynamic model is typically able to capture the surge event itself leaving slower processes that determine the large scale background water level as primary sources of water level error these unresolved drivers reflect physical processes not included in the model s governing equations or forcing terms such as far field atmospheric forcing baroclinic processes major ocean currents steric variations or precipitation we have developed a novel efficient optimal interpolation based da scheme using observations from coastal water level gages that dynamically corrects for the presence of unresolved drivers the methodology is applied for hurricane matthew 2016 and results demonstrate it is highly effective at removing water level residuals roughly halving overall surge errors for that storm the method is computationally efficient well suited for either hindcast or forecast applications and extensible to more advanced techniques and datasets 1 background the hazards of coastal flooding have been observed repeatedly throughout human history 49 of deaths from atlantic hurricanes in the u s 1963 2012 have come from storm surge rappaport 2013 hurricane damages in the u s 1900 2005 from all sources average roughly 10 billion dollars per year pielke et al 2008 in extreme cases direct economic damages have exceeded 100 billion hurricane harvey 2017 hurricane katrina 2005 and the great miami hurricane 1926 and death tolls have extended into the hundreds of thousands bhola cyclone 1970 cyclone nargis 2008 and others enhancing the predictive power of storm surge models is therefore of great importance improvements in forecasting and hindcasting of tropical cyclones tcs have led to much more accurate meteorological data associated with these storms cangialosi 2018 landsea et al 2012 these improvements together with more detailed representations of the physics and greater model resolution have improved storm surge model skill resio and westerink 2008 this has led to a state in which storm surge forecast and hindcast errors are often dominated by what we refer to as unresolved drivers i e physical processes that are not explicitly included in storm surge models common examples include baroclinic processes major oceanic currents precipitation steric fluctuations and far field atmospheric forcing these phenomena typically have longer timescales than the storm surge itself and therefore often show up as gradually varying residuals in water levels this paper presents a method for improving coastal water level predictions in hydrodynamic models through assimilation of water level data to correct for errors introduced by unresolved drivers the method was developed to improve multi day coastal water level forecasts and is shown herein to be highly effective for retrospective studies as well the paper s structure is as follows the remainder of section 1 provides background on errors in forecasts the nature of unresolved drivers and a brief overview of data assimilation da techniques and their use in surge models these ideas are combined to argue in favor of a specific combination of da and model techniques in section 2 the details of which are then presented in sections 3 and 4 a case study demonstrating the effectiveness of this approach is shown using hurricane matthew 2016 in sections 5 and 6 we then discuss justification limitations and alternatives for the proposed da framework in section 7 discussion of the method s use in an operational forecast setting follows in section 8 before concluding data and simulations presented in this study have been published asher 2019 and made publicly available online through designsafe ci at https doi org 10 17603 2z8h 7k90 1 1 advances in surge modeling uncertainties in meteorological forecasts are often the leading order source of uncertainty in storm surge forecasts of tropical cyclones the 2017 24 48 and 72 h track errors for tropical cyclones in the atlantic basin are 32 56 4 and 87 7 nautical miles 59 3 104 162 km respectively cangialosi 2018 these distances can constitute the difference between peak and relatively minor surge however meteorological forecast errors continue to decrease creating a critical window 1 3 days prior to landfall and roughly peak storm surge when surge model errors due to factors other than meteorological forecast uncertainty are becoming significant in the overall predictive power of storm surge forecasts state of the art storm surge models utilize the shallow water equations often in depth integrated barotropic form they include forcing from tides wind and atmospheric pressure bottom drag and in some cases wind waves the history resolution requirements and improvements in storm surge models have been characterized in several studies including bode and hardy 1997 blain et al 1998 dukhovskoy and morey 2011 and kerr et al 2013b a model skill has improved notably over the past two decades due to improvements in computational power topographic data quality meteorological model skill and model physics for instance da in meteorological model hindcasts produces wind and pressure fields that more closely match actual events and significantly improves storm surge model skill cardone and cox 2009 surge models are now reaching a state where low frequency variations in water levels can be a primary contributor to error if not accounted for as shown in fig 1 these data come from validation hindcasts with the adcirc hydrodynamic model described in section 5 1 during development of the national oceanic and atmospheric administration noaa hsofs mesh riverside technologies inc and aecom 2015 simulations were run with model zero at mean sea level to match anticipated operational conditions and the resulting low bias is apparent the difference in modeled and observed mean water level and inspection of time series data right fig 1 make clear that although higher frequency fluctuations are evident slowly varying changes in the water elevation drove much of the low bias for nearly all storms typically surge hindcasts either de trend measured data to remove such background water levels or apply a spatiotemporally constant water level offset to the model that approximates the mean water level preceding the storm in the vicinity of maximum surge e g westerink et al 2008 however this fails to account for spatial variations which may be appreciable depending on the unresolved driver s responsible and the size of the area affected by surge in operational forecast applications changing the water level correction between simulations could apply a shock to the model and if spatially varying would create associated large scale flows making it more suitable as a post processing step but post processing means physical effects of the altered water level and therefore depth are not included in the model simulation and also creates challenges in changing the horizontal extent of the calculated floodplain after the simulation completes which can be quite complicated during major surge events 1 2 unresolved drivers hydrodynamic models designed to accurately simulate storm surge must resolve domains covering thousands of kilometers and features such as elevated roadways and dunes only several meters wide e g bilskie et al 2015 this results in the need for substantial computational resources and a desire to optimize model complexity thus storm surge models are typically depth integrated constant density and decoupled from large scale oceanic motions rainfall and hydrologic input except at relatively large scale in the case of tcs since gridded meteorological data may not adequately resolve the storm s core storm surge models often use parametric representations of the storm s wind and pressure fields such as holland 1980 thereby neglecting both antecedent and far field meteorological conditions these introduce a host of unresolved drivers with varying temporal and spatial scales for instance 1 seasonal water level fluctuations have a spatial scale of hundreds to thousands of kilometers and a temporal scale of months to a year e g enfield and allen 1980 2 fluctuations in major ocean currents extend hundreds to thousands of kilometers and for days to years meinen et al 2010 valle levinson et al 2017 3 runoff from major rainfall events may affect tens to hundreds of kilometers and lasts several days to weeks notably these processes are slow compared to storm surge particularly due to tropical cyclones 1 2 1 magnitudes unresolved drivers generally produce smaller coastal water level fluctuations than tides and storm surge seasonal water level fluctuations u s monthly averages available from https tidesandcurrents noaa gov sltrends sltrends html often exceed 10 cm along the open coast e g barbosa et al 2008 the rise in coastal water levels following a rainfall event usually comes after storm surge with magnitudes of 10 cm or less typical during the surge event though as evidenced in north carolina during hurricane florence 2018 notable exceptions to this may occur in semi enclosed coastal water bodies interannual anomalies in coastal water levels on the order of 5 cm have also been detected and related to local and broader atmospheric forcing patterns andres et al 2013 calafat et al 2018 hong et al 2000 changes in gulf stream transport have been implicated in coastal sea level fluctuations of up to several 10 s of cm ezer and atkinson 2017 goddard et al 2015 sweet et al 2009 atmospheric systems can reduce gulf stream transport by 30 mooers et al 2005 during the time period preceding and including hurricane matthew the florida current transport dropped by approximately 30 fig 4 left ezer and atkinson 2017 associated a 30 40 cm rise in coastal water levels following the passage of hurricane matthew with the large drop in gulf stream transport 1 3 efforts in ocean data assimilation popular da methods include kalman filter variants verlaan and heemink 1997 evensen 2003 altaf et al 2014 optimal interpolation oi oke et al 2002 counillon and bertino 2009a madsen et al 2015 and variational methods bennett 2002 kurapov et al 2011 troupin et al 2012 oi typically uses the variability in the observations and an error covariance matrix assumed a priori to create a spatial field that blends the model and observations and can emulate physical behavior by selecting appropriate covariance function s e g cooper and haines 1996 lorenc 1981 oi is actually a sub optimal version of the more general kalman filter and more advanced kalman filter based approaches do away with parts of these a priori assumptions using a variety of techniques to better propagate the error covariance these and advanced variational methods come at greater computational cost than oi due to the complexity of the analysis and or the need to run multiple model realizations da in coastal water level problems is not new e g the storm surge work of heemink 1986 and has been successfully employed in the north sea e g zijl et al 2015 storm surges in this region are often large geographically and remotely forced madsen et al 2015 combined with the area s large tidal fluctuations and dense sensor network da is able to correct errors introduced by the use of a coarse numerical model e g høyer and andersen 2003 efforts in other regions have shown some promise etala et al 2015 demonstrate short term 6 h forecasting improvements using satellite altimetry and coastal water level data along the argentine coast and multiple authors have successfully calibrated models via assimilation e g graham et al 2016 mayo et al 2014 however tropical cyclones strong local forcing and smaller spatiotemporal scales create many challenges for practical data assimilation butler et al 2012 and altaf et al 2013 2014 improved hurricane surge prediction with a very coarse surge model using several different ensemble kalman filters however major gains were only seen for a very short 2 h forecast window and required careful tuning of the assimilation scheme improvements more than 2 h out were much more modest and required a set of several hundred synthetic water level observations across the continental shelf in the vicinity of the storm track figs 4 and 5 in butler et al 2012 a dataset which does not yet exist butler et al also noted no improvement in forecasts longer than 36 h for h katrina whereas h ike showed some improvement at 48 h we interpret this as being due to the exceptionally long surge signal seen preceding h ike due to the storm s massive size and unusual forerunner surge kennedy et al 2011 similarly peng and xie 2006 noted no improvement in storm surge forecasts beyond 8 h using 4dvar to revise initial conditions with a coarse 3d ocean model by also revising the wind drag coefficient with 4dvar and the same model li et al 2013 realized moderate improvements when wind speed was deliberately set too high low though the choice of correcting wind speed error with drag coefficient is fortuitous these cases point to a fundamental limitation in utilizing da for improving storm surge forecasting that will be explored in the next section as we assess what sort of da might best benefit this problem 2 requirements for storm surge data assimilation both the physics model and the da method face choices that balance complexity and computational cost forecast coastal water level modeling systems must consider the relative importance of model physics grid resolution the number of forecast ensemble members timeliness etc given available computational resources advanced da methods such as 4dvar or ensemble kalman filters require substantial computational resources sometimes over an order of magnitude greater than simulations without assimilation conversely the a priori assumptions made in oi typically lead to lower quality results at a lower computational burden a second consideration is the timescale of the surge event itself peak surge events from tcs often last on the order of 12 h e g hurricanes matthew in figs 8 and 9 and floyd in fig 10 forecast cycles occur every 6 h and lead times for emergency preparation and evacuation are up to several days the time scale of significant storm surge is shorter than the lead time needed for action storm surge is often a locally driven process which can mean water level data with a strong surge signal cannot be assimilated early enough to provide useful information this point is particularly important as it possibly cannot be overcome through more data computational resources or da methods similarly da cannot be expected to represent phenomena whose spatial scale is smaller than the spacing between observations typically 10 200 km along the u s gulf and atlantic coasts given the phenomenological and computational constraints the question becomes how can one most effectively use da to improve storm surge forecasts we argue that a low cost da method paired with existing surge model physics is an effective balance our approach is to use da to address the water s response to more slowly varying large scale unresolved drivers while using the hydrodynamic model to accurately capture the generation and propagation of surge and tides 3 assimilation formulation in this section we describe our approach for ingesting water level corrections into the model while the next section steps through how the correction is generated and implemented in practice we are working with the reynolds averaged depth integrated constant density shallow water equations vallis 2006 luettich and westerink 2004 1 continuity d h ζ d t h ζ u 0 x momentum d u d t f v g ζ x 1 ρ 0 p x τ s x τ b x τ w x h ζ ρ 0 α η d x m x y momentum d v d t f u g ζ y 1 ρ 0 p y τ s y τ b y τ w y h ζ ρ 0 α η d y m y for h the static water depth ζ the water surface elevation t time d dt the material derivative u the depth averaged velocity vector u v f the coriolis parameter g acceleration due to gravity p pressure at the sea surface ρ 0 constant water density subscripts x and y indicating terms in their respective directions τ s surface wind stress τ b bottom drag stress τ w wave radiation stress η newtonian equilibrium tidal potential α effective earth elasticity factor and m vertically integrated lateral stress gradient the continuity equation imposes a mass balance on the solution while the momentum equations impose the force balance our goal is to apply a gradually varying in space and time correction to the water elevation field δ ζ a direct manipulation of the water level will not accomplish this by itself because a rapid barotropic adjustment would occur in the velocity field and the added water would simply flow away rather we found this could be done effectively by introducing a fictitious force into the momentum equations to drive the solution to the desired surface elevation specifically changes in atmospheric pressure create corresponding changes in water surface elevation e g the bulge in sea level under an atmospheric low pressure center this can be approximated via the inverse barometer relationship δ p ρ 0 g δ ζ we therefore modify the sea surface pressure term in the momentum equations to reflect both the actual atmospheric pressure and a pseudo atmospheric pressure 2 p p a δ p p a ρ 0 g δ ζ where p a is the actual atmospheric pressure and δ p is a so called pseudo atmospheric pressure pap considering only the x momentum equation yields 3 d u d t f v g ζ x 1 ρ 0 p a δ p x τ s x τ b x τ w x h ζ ρ 0 α η d x m x substituting in eq 2 and regrouping terms this can also be written as 4 d u d t f v g ζ δ ζ x 1 ρ 0 p a x τ s x τ b x τ w x h ζ ρ 0 α η d x m x in either form a fictitious force is being applied to drive are arrangement of the total water elevation field to include the assimilated elevation differences the resulting adjustment of the total water elevation field then propagates through all other terms in the shallow water equations while adding the fictitious forcing term will drive water to achieve the desired surface elevation correction over time we can assist this process by simultaneously introducing the desired water level correction directly into the water elevation field as noted above the elevation field cannot be modified without the compensating forcing term in the momentum equations because the added water would quickly flow away when directly applying a correction δ ζ to the water elevation the correction in the momentum equations eq 4 can be thought of as providing a force to maintain the elevation correction using only the fictitious force term we are altering the velocity field to accomplish the re arrangement of water to achieve the desired total water elevation adding water in directly minimizes the need for this dynamic re arrangement and therefore lessens the accompanying velocity field alteration however under the assumption that the corrections are gradual in space and time the two methods should exhibit similar behaviors which is what we observed in practice in open coastal waters differences were primarily located in areas with significant constrictions the similarities and differences between the methods are discussed in more detail in section 7 4 for the sake of clarity in the remainder of the manuscript we term the pap method as applying only the fictitious forcing in the momentum equations while the con method applies the forcing and directly adds removes water 4 storm surge data assimilation framework the da system employed here can be broken down into four steps 1 performing an unassimilated simulation 2 time averaging or lowpass filtering the difference between this simulation and observed water levels at observation sites 3 generating a spatial difference field from these differences 4 repeating the simulation with the added correction applied in the model fig 2 shows a simplified schematic of the process with steps 2 3 lumped together a more detailed schematic is shown in supplemental figure 1 the procedure is repeated at selected intervals in time e g every forecast cycle in a forecast system and the pap forcing is interpolated in time between cycles the unassimilated and assimilated model states are saved at the end of each simulation so that they may be resumed at the start of the next cycle the da framework used here can be classified e g daley 1991 as a continuous sequential scheme using optimal interpolation in that the da analyses are carried out every assimilation cycle sequential and the correction is applied continuously to the simulation continuous by way of the pap forcing and the mass field if desired several parts of our approach are similar to those developed in the da literature including the time distributed averaging procedure of oke et al 2002 and the incremental analysis update technique of bloom et al 1996 in the remainder of this section we describe methodological details of the 4 steps a step by step summary is provided alongside supplemental figure 1 we provide a more thorough discussion of our choices and alternatives in section 7 before proceeding however we make two clarifications on nomenclature first in da literature forecast often refers to an unassimilated system state such as an unassimilated simulation the term background is also used for this quantity though its history is somewhat complicated see ide et al 1997 so here we use first guess for this quantity to avoid confusion with a true forecast second we use the term difference field here to refer to the spatial field of differences between observed and unassimilated modeled water levels 4 1 step 1 unassimilated simulation the first guess field of water elevations is determined by running an unassimilated simulation whose final state is saved to permit restarting at the beginning of the next assimilation cycle separating the unassimilated and assimilated simulations is unusual in da we term this a two track assimilation scheme however it ensures that our model solution is driven to match the missing low frequency component without introducing overshoot and undershoot oscillations 4 2 step 2 time averaging the first guess and the observed water level data are averaged over a chosen time period t nominally 1 10 days in order to filter out high frequency fluctuations such as astronomical tides that constitute most of coastal water level variations selecting the time scale as an integer multiple of the dominant tidal cycle 12 42 h for m2 semidiurnal tides suppresses tidal phasing errors that might cause undesired oscillations in the difference field further discussion on the choice of time scale is presented in section 7 3 4 3 step 3 difference field the mean difference between observed and modeled data is then fed into oi with an assumed error covariance to produce a gridded difference field e g fig 6 calculating and storing the full resolution covariance matrix a 106 106 matrix for the 1 8 million node mesh used in this study would be a daunting task and it is common in the da literature to partition the domain into subdomains to manage this problem however we argue the time averaging of water levels the gradual nature of the unresolved drivers we wish to capture compared to typical grid resolutions and the large distance between observations make the use of a coarser grid for data assimilation computations appropriate after which results are interpolated to the model mesh to explain generation of the difference field we begin with a brief introduction to sequential data assimilation there is substantial variability in the notation utilized in da literature however we mostly follow that of ide et al 1997 the base equation in sequential data assimilation is 5 x a x f k y o h x f x f kd d y o h x f where bold lowercase uppercase variables denote vectors matrices we now define the variables and their dimensions in context of traditional da terminology in quotes their meaning for the problem at hand is supplied in the following paragraph n number of grid points m number of observed values denoted p in ide et al 1997 x f x f t n 1 time varying forecast background or first guess system state vector y o y o t m 1 time varying observation vector x a n 1 the analysis vector k n m the kalman gain matrix or gridding operator h m n the observation operator or measurement operator d m 1 the innovation vector or observational residual put in the context of this problem n is the number of grid points m is the number of gages where observed water levels are available for assimilation x f are the water levels from an unassimilated model simulation at the grid points y o are the observed water levels at the gages x a are the water levels calculated by the assimilation process at the grid points at a single point in time h linearly interpolates the unassimilated model water levels to the locations of the observations d is a set of water level differences at the observed locations and k performs the heavy lifting of creating the difference field kd in reality k depends on h and the error covariance structure of the first guess and the observations for a conceptual overview readers are directed to a recent review article moore et al 2019 for further details interested readers are directed to fletcher 2017 bertino et al 2003 bennett 2002 and evensen 2003 daley 1991 calculation of the water level correction is termed the analysis step in da we do not directly apply eq 5 in our method rather we time average d as described in the last section and compute the difference field as 6 δ ζ a k d t for δ ζ a n 1 the difference field corresponding to δ ζ and t the time scale of the averaging operator denoted by angle brackets we then introduce this time averaged difference field in the model to apply the correction gradually and let the model s physics respond accordingly using either the pap or con methods as explained in section 3 4 4 step 4 assimilated simulation and forecast with a new difference field calculated the assimilated simulation is then restarted from its last saved state and run forward from the previous cycle until the current time is reached much like the unassimilated simulation in step 1 each difference field is considered to represent the correction for the current time and so the pap forcing and the elevation correction if desired applied during a simulation evolves in time by linearly interpolating between the previous and current difference fields if this is used as part of a forecast system the forecast simulations would then be initiated using that assimilated solution as the initial condition together with some assumption of how the difference field evolves into the future 5 case study setup modeling experiments were undertaken to evaluate the ideas presented here and to build an algorithm for carrying out such assimilations under operational conditions hurricane matthew 2016 was selected due to the presence of a persistent bias between predicted and observed water levels prior to and throughout the event and the availability of high quality data to support the investigations the adcirc model coupled with the swan wave model was used data assimilation was done with water level data from a set of coastal water level gages each of these components is described in further detail in this section 5 1 numerical model adcirc is an ocean circulation model based on the 2d 3d shallow water equations it solves these equations in a continuous galerkin linear finite element unstructured mesh framework luettich and westerink 2004 westerink et al 2008 here it is used in its 2d depth integrated form swan is a 3rd generation phase averaged spectral wave model that solves the conservation of wave action equation as it evolves in time and space booij et al 1999 zijlema 2010 it operates on the same linear triangular mesh as adcirc the two models are tightly coupled with water depths and currents passed to swan and wave radiation stress gradients passed to adcirc at each shared time step dietrich et al 2011b a the coupled model is highly parallelized for execution on supercomputing systems tanaka et al 2011 dietrich et al 2011a kerr et al 2013a making it useful for numerous surge modeling applications the 1 8 million node 3 6 million element hsofs mesh was used riverside technologies inc and aecom 2015 shown in fig 3 the hsofs mesh covers the western north atlantic and all overland areas of the neighboring u s coast up to an elevation of 10 meters above sea level with detailed representations of inlets rivers barrier islands roadways and other key features elevation data is based on the latest available bathymetry and lidar derived topography mesh resolution in coastal areas is typically 400 to 500 meters and as low as 200 meters in some areas making it an intermediate resolution grid developed specifically for national scale real time storm surge forecasting applications this mesh is now used by noaa for operational coastal water level and storm surge guidance in their estofs extratropical surge and tide operational forecast system and hsofs hurricane surge on demand forecast system programs meteorological forcing is shared by adcirc and swan and is described in the next section tidal forcing in the adcirc model is specified by periodic water elevations along the offshore boundary and body forcing throughout the domain based on the oregon state university topex poseidon global inverse solution version 7 2 tpxo7 2 egbert and erofeeva 2002 manning s n based bottom friction in adcirc is based on 2006 c cap land cover data so that increased dissipation during flooding in marshes and overland areas is accounted for directional reductions in wind speed due to the roughness of overland features is accounted for using the land cover data upwind of a given location to determine the roughness height in a charnock type relation for oceanweather and holland type wind models discussed in the next section since these are considered to be at marine exposure overland drag for waves is considered less important since their primary use here is in helping calculate accurate surge elevations via wave radiation stresses and depth induced breaking is the primary mechanism of energy dissipation in such cases bottom friction in swan is formulated as a jonswap type sea state dependent drag hasselmann et al 1973 and no wind reductions are performed the adcirc model is explicit and finite difference in time and so has a courant limited time step of 2 s for this application the swan model is time implicit allowing it to have a larger 15 minute time step more granular detail on model setup parameters is provided in the supplemental 5 2 hurricane matthew hurricane matthew was a cape verde type 1 1 hurricanes originating near the cape verde islands more info here http www aoml noaa gov hrd tcfaq a2 html hurricane that developed into a tropical cyclone on september 28 2016 near barbados the storm passed between south america and the greater antilles briefly becoming a category 5 hurricane on the saffir simpson hurricane wind scale before turning north on october 2 it made landfalls on haiti and cuba on october 4 and 5 respectively it then tracked just offshore of the southeastern u s coastline for several days barely making landfall in south carolina on october 8 before transitioning to an extra tropical cyclone on october 9 and heading offshore stewart 2017 although the storm s surges were not as severe as many other historic storms matthew s track fig 4 brought moderate surges to over 1000 km of u s coastline and high water conditions for several days at many sites providing a large amount of observational data over which to study the storm s effects meteorological forcing for the coupled model is provided in the form of winds and sea level pressures and is taken from three sources in order to assess the effects of different meteorological fields the most basic meteorological forcing comes from a parametric vortex model the generalized asymmetric holland model or gahm based on holland 1980 but without requiring the cyclostrophic balance assumption gao 2018 parametric models such as gahm are useful in that they allow wind and pressure fields to be constructed in a dynamically consistent manner directly from meteorologist forecast parameters in the case of gahm radii to maximum winds are determined in each storm quadrant by fitting the model to specified wind isotachs in each quadrant gao 2018 dietrich et al 2018 there are no far field winds associated with the gahm other than those of the translating vortex of the storm an intermediate quality meteorological forcing was developed by combining the gahm with north american mesoscale forecast system nam fields the latter supplying the far field winds and pressures blending between the two datasets is performed over a range of several radii to maximum winds away from the storm center in order to provide a smooth transition the third and highest quality source of wind and pressure forcing comes from reanalysis meteorological fields defined objectively using airborne terrestrial and oceanic measurements including stepped frequency microwave radiometer sfmr data by oceanweather inc owi cox et al 1995 cardone and cox 2009 5 3 observation data water level data was collected from a total of 44 permanent stations along the open coast estuaries bays and rivers and 129 temporary storm tide sensors deployed for hurricane matthew all of these data are from either noaa or the u s geological survey usgs 24 noaa gages were used in the assimilation set that forms the y o observations needed for da shown in fig 4 19 gages and 129 storm tide sensors visible in fig 7 were used as validation of the scheme the final gage located at springmaid pier sc was lost when the pier was destroyed by matthew shortly before the storm surge peaked this gage was also included in y o m 25 while functioning but then dropped m 24 when found to be out of operation without any apparent loss of fidelity in the solution suggesting the methodology is reasonably robust to events like gage failures provided sufficient gages are included in determining the difference field all gages in the assimilation set were located at or close to the open coast whereas the validation data are generally in more sheltered waters rivers and overland further information on all data used is supplied in supplemental table 2 5 4 data assimilation da was carried out using the method described in section 4 assimilated simulations were run using both the pap method and the con method as described in section 3 a 6 h assimilation cycle was used that corresponded to the hurricane advisories provided by the national hurricane center fig 2 every assimilation cycle the first guess field x f was updated with a 6 h model run using the ending state of the previous unassimilated solution as its initial condition observed and unassimilated modeled water levels were averaged over the previous 24 84 h two m2 tidal cycles and were used to compute differences at the gage locations these differences were input into oi assuming a gaussian error covariance matrix with a constant correlation length 2 2 the observation error is assumed very small 1 mm since noaa water level gages are very accurate of 1 degree in addition the difference field was constrained to approach zero offshore by placing a sequence of artificial gages just off the continental shelf break with their d set to zero offshore of these areas the difference field was discarded an example of a resulting difference field for each of the meteorological forcings is shown for 00 00 h utc on october 5 2016 in fig 6 a 6 h model run with assimilation was then performed using the ending state of the previous assimilated solution as its initial condition and linearly interpolating the difference field in time from the previous to the newly constructed difference field over the 6 h assimilated model run if this were to be used as part of a forecast modeling system the assimilated model run would then be used as the initial condition for the forecast 6 case study results simulations were carried out from 00 00 utc october 2 to 00 00 utc october 11 2016 with the three sources of meteorological forcing both with and without assimilation giving a total of 6 simulations for hurricane matthew runs without assimilation are referred to as baseline cases and the two letter shorthand nomenclature shown in table 1 will now be used to refer to individual simulations minimal differences in skill metrics were observed between the results from the pap and con methods and so only the pap method results are presented in this section con results are in supplemental material data and simulations presented here are available online through their publication asher 2019 6 1 model skill errors in peak surge estimates are provided in figs 5 and 7 time series at selected gages are shown in fig 8 and time series plots at all gages are in supplemental figure 3 skill metrics for both peak and time series data are provided in table 1 with bias being positive when the model water level is higher than the observed time series statistics were calculated over the 120 h from october 5 00 00 to october 10 00 00 utc all three baseline simulations show negative model underestimation biases ranging from 22 to 79cm at the 24 assimilation sites the gb simulation has the greatest bias being approximately twice that of the ob and nb simulations which have similar biases with da the bias is largely removed ranging from 1 cm to 6cm as measured by peak surge or time series across all assimilation and validation stations for the three meteorological forcings mean absolute error mae and root mean square error rmse are reduced by a quarter to two thirds of their baseline simulation values as well error statistics for the con method supplemental table 1 were within 1 cm of the pap method with no systematic trend the largest remaining errors in the da simulations occurred within pamlico sound and its accompanying rivers in north carolina these errors are due to a combination of a frontal weather system north of matthew that is not well represented in any of the meteorological forcing datasetsas well as errors in model bathymetry within the sound model simulations not shown using a different grid with higher resolution and better bathymetry gave an increase in peak surge of 30 cm at the noaa hatteras gage fig 8 bringing it into much closer agreement with observations 6 2 assimilation effects the spatial structure of the difference fields indicates a slight increasing trend from south to north along the us southeast atlantic coast fig 6 at this time 00 00 utc 10 5 2016 the eye of matthew was located at approximately 20 degrees north fig 4 the temporal behavior of the difference field is shown at selected stations along the coast in fig 9 time series plots at all gages are in supplemental figure 3 the two m2 tidal cycle time average and the gaussian error covariance with 1 degree correlation length together appear to impose reasonable spatial and temporal smoothness in the difference field consistent with the objective of correcting for low frequency unresolved drivers the difference field is generally twice as large for the gb as the ob and nb solutions consistent with the increased bias noted above the substantial reduction of model bias and accompanying other error statistics in the da simulations provides strong evidence that this approach is effectively correcting for the unresolved drivers in the water surface elevation comparison of the gb and nb simulations suggests that approximately half the bias in the gb simulation may be due to missing far field meteorology and that da is able to reasonably compensate for this deficiency in model forcing comparison of the ob and nb simulations suggests that the blended gahm nam wind and pressure fields provide a reasonable forecast grade substitute for the more detailed reanalysis owi fields assuming that the ob and nb reasonably capture the meteorological component of the water level forcing the remaining half of the bias in the gb run and the majority of the bias in the ob and nb runs must be due to non meteorological unresolved drivers water levels are characteristically high in october with historical monthly average water levels ranging from 19 cm at daytona beach fl to 17 cm at fort pulaski ga to 12 cm at beaufort nc the area from southern florida to cape hatteras is adjacent to the gulf stream which experienced a substantial decrease in transport during matthew s passage fig 4 decreased gulf stream transport has been associated with increases in coastal water level ezer and atkinson 2017 and this may provide an additional unresolved driver during the matthew time period 7 data assimilation framework discussion as presented above we have found our da approach to be an effective tool for reducing a significant source of error in storm surge simulations calculating a difference field eq 6 involves multiple choices including the form of the gain matrix k the time averaging used to calculate d t and the m observation sites that form y o lastly there is the matter of selecting how data are manifested or ingested back into the model as was done via the pap forcing alone pap method or the forcing paired with direct addition of water con method each of these items will now be addressed both in terms of the proposed method and in terms of the techniques presented in the meteorological and oceanographic da literature 7 1 gain matrix k the most challenging step in determining k is defining the first guess error covariance matrix typically denoted b or p f note the latter does not denote the pap field it is common to partition b into a diagonal variance matrix d n n that can optionally be updated in time and a stationary i e time independent correlation matrix c n n as b d 1 2 c d 1 2 we expect strong anisotropy in the correlation structure with distinct characteristic scales in the cross and along shore directions which should evolve through estuaries bays and further upstream therefore presuming a single correlation length is clearly suboptimal as indicated in the following example in 1999 hurricanes dennis and floyd dropped massive amounts of rain in north carolina within a few weeks of each other leading to record breaking flooding across much of the state this resulted in differences in water levels on either side of the north carolina barrier island complex as high as 0 5 m fig 10 shows the effect this had on the water level anomaly surface determined via oi using a 4 day average water level prior to floyd and a constant correlation length of 1 degree the open coast gage at duck shows a small anomaly in the water level time series since it is not appreciably affected by the rainfall however the gage at oregon inlet shows a much larger longer lasting anomaly due to the runoff filling up pamlico sound the water level anomaly surface using our simple correlation structure is unable to match the 16 cm difference in the 4 day mean water level between the two gages application of a more appropriate correlation matrix would permit a sharp spatial gradient to be more faithfully 3 3 the lowpass filtering of our data suggests brief episodic changes in correlation like the overtopping of a barrier island during a large storm surge likely need not be accounted for in the correlation matrix represented in the difference field we expect that the structure of the correlation matrix c will depend on the unresolved driver s at work and therefore it is unclear whether a single covariance structure can fully account for distinct phenomena if a substantial portion of the to be assimilated model error d is presumed to come from physics absent from the model and not errors due to model forcing initial conditions etc then along with the sparsity of measurements this means a substantial portion of the error covariance structure is not identifiable 4 4 this is closely related to the motivation for the fixed basis form of the singular evolutive extended kalman seek filter brasseur and verron 2006 put another way the correlation on all time scales of interest between the sheltered oregon inlet and open coast duck locations discussed in the previous paragraph can only be estimated with measured data or a model with the physics needed to resolve all time and space scales of interest so one must either rely on an incomplete estimate of c from the surge model s correlation structure or else infer it from another source such as altimetry data a more advanced model or a parametric function this difficulty in revealing the full covariance structure motivates a generalization of eq 6 to 7 δ ζ a j 1 j k j d t j where j is the index of j difference fields note we will use d j as shorthand for d t j this permits accounting for different unresolved drivers separately each with its own correlation matrix c j with this we can consider a series of spatiotemporal scales corresponding to different unresolved drivers whose covariance structures can be inferred using one of the methods mentioned in the last paragraph eq 7 is attractive because it conforms nicely to one interpretation of the theoretical basis for the forcing term that it represents a closure scheme for a series of unresolved drivers discrete physical processes that the hydrodynamic model s governing equations and inputs do not explicitly account for while conceptually attractive many physical processes have overlapping scales making separation difficult to accomplish in practice thus the approach of defining different correlation matrices for different unresolved drivers may be most useful for separating out shorter fluctuations e g days to weeks from those that affect seasonal or longer term water levels since correlation lengths for the latter processes are substantially longer e g calafat et al 2018 7 2 sites m greater data density and quality generally results in improved estimates however since the physical dynamics are not accounted for in our implementation of oi utilizing data which are not representative of the coastal environment under consideration can be problematic if the data are not handled with care preliminary tests utilizing water level gages in rivers were found to produce lower quality difference fields because our oi implementation does not resolve the pathway taken by the water and so the area of influence of these gages is exaggerated this like the example in section 7 1 may be alleviated through use of proper correlation structure being unbound by physical constraints the difference field can diverge when extrapolating which is why we imposed the artificial gages with their d set to zero off the continental shelf break to weakly constrain the difference toward zero in the offshore direction as discussed in section 5 4 physical constraints could be applied to deal with such issues within the da scheme however the irrelevance of such small offshore water level fluctuations on coastal water levels suggests any technique may suffice a similar issue arises in inland areas where the d at the coast may not be relevant if inland gages are not available or used then in cases where the inland domain extent is large compared to the correlation length ways to constrain the difference field inland may need to be devised 7 3 time scales t time averaging in calculating d j acts as a boxcar filter on the water level difference it is not clear the choice of averaging method is particularly important and other analyses have shown that simple filtering methods can be advantageous bloom et al 1996 oke et al 2002 however the choice of averaging time scale t is key the exact choice of time scale represents a balance between which fluctuations to remove and which to keep and so can depend on the processes of interest use of a rather short 24 84 h averaging period in this study permitted da to correct for the surge error resulting from poor far field meteorology in the gahm model however no systematic study was undertaken to evaluate whether this was the best choice of t review of time series in fig 9 suggests an averaging period 1 5x or 2x this length may have also produced similar results though this question may warrant further review under other conditions our approach may create a lag in the modeled response since 1 the difference field is based on data prior to the current point in time and 2 there may exist some lag time in the model responding to the forcing in the case of the pap method lag due to the former should be small unless d shifts rapidly compared to the assimilation interval lag due to the latter is discussed in section 7 4 note that lag due to the former issue could also be resolved by centering the assimilation window in time 5 5 this would classify the approach a smoother which utilizes both past and future data as opposed to a filter 7 4 ingestion method techniques for incorporating the water level correction back into a model simulation which we term ingestion are built into methods like certain ensemble kalman filters and 4dvar one of their advantages there is no such prescribed method for oi we proposed two methods in section 3 the matthew case study did little to elucidate differences as the methods error statistics were nearly identical therefore we now present a simple test problem and use it to distinguish the methods and how they each modify the solution the ga simulation presented in section 6 was repeated with all forcing disabled except for the assimilation to isolate its effects the ga simulation s difference field was chosen because it is a realistic test case with relatively large elevations peaking at almost 0 7 m in some regions and rising falling up to 20 cm day 9 day pap and con simulations were conducted with the initial elevation difference ramped in over 31 days prior to the beginning of the 9 day simulation to ensure both simulations start at the same equilibrium state note that simulation days 31 40 here correspond to october 2 11 2016 in the matthew case study results are shown in fig 11 across the entire study area maximum differences in the two simulations are less than 2 cm except for three regions ordered from north to south the pamlico albemarle sound complex in north carolina the st johns river in florida and the indian river lagoon system in florida in these areas differences reached 5 20 cm these areas are characterized by having tightly restricted flows to the ocean in all cases the con method s water levels track the difference fields more closely than the pap s this is expected given that the pap method requires the elevation field to respond to the imposed forcing whereas the con method imposes the elevation change directly however which result is preferable is situational in open coastal areas and areas with moderate connections to the open coast the propagation is fast and the difference between the methods minimal fig 11 however the pap method fills and empties tightly restricted semi enclosed waterbodies more slowly for example the pamlico albemarle sound complex a very large bay with very narrow openings filled at 8 15 cm day during the pap assimilated simulations noting that the correction field is derived primarily from coastal gages during matthew this may reflect a realistic damping of the coastally derived elevation correction this suggests the relative utility of the two methods is largely relegated to waterbodies with a weak connection to the open ocean and is tied to the expected accuracy of the difference field i e does the difference field correctly represent the water elevation difference inside these waterbodies in which case the con method may be more accurate or is it simply a landward extension of the coastal water level difference in which case the pap method may be more accurate one case of special note is a fully enclosed waterbody such as a coastal pond or gated waterway the con method would raise lower water levels in the waterbody whereas the pap method would only impose a gradient across the waterbody until the water level in an adjacent coastal region rose to a level that caused it to become connected with the enclosed waterbody here again which result is preferable depends on one s expectation of the true difference field 8 operational considerations operational forecasts carry substantially different priorities from those of other modeling studies in the former a critical requirement is getting an answer in a timely fashion to the degree the quality of the answer can be improved it should be but subject to the constraints that the improvement can be computed quickly enough to allow the result to be timely and that the process does not cause the forecast to fail e g introduce model instability the need to perform two simulations one with and one without assimilation means that this method roughly doubles the computational requirements for a hindcast study calculation of the difference field itself takes minimal time however in an operational forecast setting this doubling only applies to the simulation period going from past to present supplemental figure 1 typically a 6 h window the result of the assimilation is the creation of an improved initial condition for the impending forecast s assuming a 6 h assimilation forecast cycle the computational burden increases by 7 6 for a single 3 day forecast or 4 6 for a single 5 day forecast this small computational burden decreases even further if a multiple forecast ensemble is computed using the same initial condition e g to 1 6 for a 3 day 5 member ensemble forecast since computing the difference field does not require the forecast meteorology it is possible to run the unassimilated simulation and compute the difference field concurrent with the generation of the meteorological forecast if this is done the additional computational time required to implement da in the storm surge model would not delay the surge forecast which must wait for the forecast meteorology to become available the reliability of the difference field is a function of the quality of the input data as well as the choices made in computing it it is therefore important that any observation data stream be quality controlled the failure of the springmaid pier gage during matthew is an example of the loss of a real time data stream the oi surface in this case study did not change markedly after the gage failed and was removed from the data used to determine the difference field as seen in the time series in fig 9 at the nearby oyster landing gage the charleston sc and wrightsville beach nc gages are the two nearest to springmaid pier each roughly 1 degree away this indicates the 1 degree correlation length is reasonably chosen given the density of available observations and the smoothness of the assumed gaussian covariance operational applications will need to choose sites and covariance structure in a way that ensures loss of a gage or gages does not lead to physically unrealistic difference fields when carrying out a true forecast some assumption must be made about how the difference field transforms into the future in our initial use of this approach in forecast applications we have held the difference field constant through the forecast cycle more sophisticated approaches could be proposed incorporating expected growth decay times implied by the characteristic time scale of the dominant unresolved driver s 9 conclusions storm surge modeling systems have grown in complexity and accuracy and have reached a state where unresolved drivers are major contributors to model errors several such drivers are well known to cause appreciable coastal water level variations changes in large scale currents like the gulf stream are of particular curiosity since they have been shown to be affected by passing storms and there is recent evidence suggesting this could be an important component of multi day water level fluctuations not reproduced by surge models hurricane matthew appears to be one example of this tropical cyclone driven surge itself is often a rapid response that is not well suited for da in forecasts and seems better handled by the physics of the model itself in particular there appears to be a limit to how much da can improve tropical cyclone surge forecasts because guidance is often needed earlier than meaningful water level data can be assimilated conversely many unresolved drivers typically vary over spatial and temporal scales longer than that of storm surge and are therefore good candidates for da to allow allocation of computational resources elsewhere to this end a system for assimilating water level data into a surge prediction system has been constructed based around the principle of low cost continuous sequential data assimilation it was implemented as a pseudo atmospheric pressure forcing term with and without a direct correction to the water elevation term in the adcirc surge model and was evaluated for the case of 2016 s hurricane matthew using multiple meteorological data sources comparing results from the gahm parametric vortex model with the blended gahm nam model suggests that approximately half of the low bias in the gahm simulation was due to missing far field winds counter to prior experiences high grade assimilated reanalysis winds owi did not appreciably improve model performance compared to the blended gahm nam meteorology for matthew calculated water level differences ranged from 0 2 to 0 6 m and were typically twice as large for the gahm simulations as for the gahm nam and owi simulations results from the da simulations were very favorable with measures of model surge bias changing from 0 22 to 0 79 m in the unassimilated simulations to 0 06 to 0 01 meters in assimilated simulations mean absolute errors were also reduced by 48 to 66 at assimilation sites and 16 to 45 at validation sites further surge error statistics with the gahm and gahm nam meteorological fields were indistinguishable from those with the owi reanalysis fields once da was performed thus the da was able to account for the effect of far field winds on water levels absent in the simple gahm parametric vortex model it is not clear to what degree this accounted for antecedent conditions vs remote forcing though time series suggest both were at play the ability to compensate for some of the error in the meteorological forcing is particularly useful for forecasting because high quality reanalysis meteorological fields are not available the small increase in computational effort typically a few percent makes this method highly amenable to forecast applications the performance difference between the two assimilation methods for matthew was equivocal with both methods showing nearly identical error metrics a simplified test case illustrated conditions in which solutions diverge with differences being largely relegated to semi enclosed waterbodies weakly tied to the open ocean the merit of each method in such cases was argued to be case dependent and tied to the expected accuracy of the difference field a generalized framework for assimilating water level data into storm surge models using continuous sequential da has been proposed care has been taken to discuss implementation details as they pertain specifically to surge and to provide recommendations on how to navigate these issues in particular discovery of the first guess error covariance due to unresolved drivers is intrinsically impaired by their absence from the model this may support the use of multiple discrete difference fields corresponding to distinct scales of unresolved drivers 9 1 future work limitations of the proposed methodology are chiefly imposed by the need to specify the error covariance used in the assimilation we were pleased that a very simple error covariance worked well and greatly reduced the water level errors in our case but recognize the potential value of more sophisticated approaches these should be able to address the current method s largest shortcomings while allowing for more observed data to be used ensemble optimal interpolation or enoi oke et al 2002 evensen 2003 oke et al 2009 may be a promising candidate here enoi is effectively a hybridization of ensemble kalman filter and oi methods whereby a stationary ensemble e g a set of historical simulations is used to prescribe the covariance which can be made to vary over long seasonal time scales brasseur et al 2006 ideally such an ensemble would come from a more complex model that includes our unresolved drivers although even a 2d barotropic model should be able to recover first order structures such as the disconnect between open ocean and estuarine waterbodies the combination of multiple discrete difference fields corresponding to distinct scale of unresolved drivers may provide useful aid as well a better specification of the spatial structure of the elevation difference field may help determine the robustness of the pap and con methods additional data sources would help constrain the da satellite altimetry coverage is not guaranteed on the time scale of a storm surge event and there are substantial difficulties in getting quality measurements within 50 km of the coast however continued improvements have allowed for measurements of storm surge increasingly close to the coast fenoglio marc et al 2015 madsen et al 2007 2015 efforts to bring online airborne measurements of water surface elevation wright et al 2009 could also lead to more comprehensive water surface data in the immediate nearshore better data on offshore water levels will also allow for more physically realistic closure of interpolated surfaces this text has not discussed how velocity data might be incorporated in this system nor their utility though peng and xie 2006 indicated little gains in assimilating both compared to assimilating only water elevation in storm surge forecasting improvements in knowledge of the system physics can aid the da analysis to this end research into how hurricanes affect large scale fluctuations such as the gulf stream e g todd et al 2018 is of use comparison to a 3d ocean model s water surface topography may help inform the structure of the error covariance improvements in model physics to reduce the need for the da correction should also be pursued to whatever degree possible while maintaining compatibility with available computational resources credit authorship contribution statement taylor g asher conceptualization data curation formal analysis investigation methodology project administration resources software supervision validation visualization writing original draft writing review editing richard a luettich jr conceptualization funding acquisition methodology project administration supervision writing review editing jason g fleming investigation software brian o blanton methodology software acknowledgments the authors would like to thank elaine spiller for her helpful review and comments on our manuscript the florida current cable and section data are made freely available on the atlantic oceanographic and meteorological laboratory web page www aoml noaa gov phod floridacurrent and are funded by the doc noaa4 climate program office ocean observing and monitoring division water level data were acquired from the noaa nos center for operational oceanographic products and services http tidesandcurrents noaa gov api and the usgs https waterdata usgs gov nwis rt and https stn wim usgs gov fev matthewoctober2016 some color schemes were taken from colorbrewer http colorbrewer org background maps for some figures are credited to esri here delorme mapmyindia openstreetmap contributors and the gis user community further information is available here https www arcgis com home item html id 87fcdf91a0f14e4a9fda40a763c6f2b8 this material is based upon work supported by the u s national science foundation under grant award number aci 1339723 and the us department of homeland security under grant award number 2015 st 061 nd0001 01 declarations all authors approve of this manuscript the authors certify this original work has not been published nor submitted elsewhere disclaimer the views and conclusions contained in this document are those of the authors and should not be interpreted as necessarily representing the official policies either expressed or implied of the u s department of homeland security declaration of competing interest r luettich is a creator and owns a partial interest in the copyright to the adcirc source code appendix a supplementary data supplementary material related to this article can be found online at https doi org 10 1016 j ocemod 2019 101483 appendix a supplementary data the following is the supplementary material related to this article mmc s1 
24001,research performed to date on data assimilation da in storm surge modeling has found it to have limited value for predicting rapid surge responses e g those accompanying tropical cyclones in this paper we submit that a well resolved barotropic hydrodynamic model is typically able to capture the surge event itself leaving slower processes that determine the large scale background water level as primary sources of water level error these unresolved drivers reflect physical processes not included in the model s governing equations or forcing terms such as far field atmospheric forcing baroclinic processes major ocean currents steric variations or precipitation we have developed a novel efficient optimal interpolation based da scheme using observations from coastal water level gages that dynamically corrects for the presence of unresolved drivers the methodology is applied for hurricane matthew 2016 and results demonstrate it is highly effective at removing water level residuals roughly halving overall surge errors for that storm the method is computationally efficient well suited for either hindcast or forecast applications and extensible to more advanced techniques and datasets 1 background the hazards of coastal flooding have been observed repeatedly throughout human history 49 of deaths from atlantic hurricanes in the u s 1963 2012 have come from storm surge rappaport 2013 hurricane damages in the u s 1900 2005 from all sources average roughly 10 billion dollars per year pielke et al 2008 in extreme cases direct economic damages have exceeded 100 billion hurricane harvey 2017 hurricane katrina 2005 and the great miami hurricane 1926 and death tolls have extended into the hundreds of thousands bhola cyclone 1970 cyclone nargis 2008 and others enhancing the predictive power of storm surge models is therefore of great importance improvements in forecasting and hindcasting of tropical cyclones tcs have led to much more accurate meteorological data associated with these storms cangialosi 2018 landsea et al 2012 these improvements together with more detailed representations of the physics and greater model resolution have improved storm surge model skill resio and westerink 2008 this has led to a state in which storm surge forecast and hindcast errors are often dominated by what we refer to as unresolved drivers i e physical processes that are not explicitly included in storm surge models common examples include baroclinic processes major oceanic currents precipitation steric fluctuations and far field atmospheric forcing these phenomena typically have longer timescales than the storm surge itself and therefore often show up as gradually varying residuals in water levels this paper presents a method for improving coastal water level predictions in hydrodynamic models through assimilation of water level data to correct for errors introduced by unresolved drivers the method was developed to improve multi day coastal water level forecasts and is shown herein to be highly effective for retrospective studies as well the paper s structure is as follows the remainder of section 1 provides background on errors in forecasts the nature of unresolved drivers and a brief overview of data assimilation da techniques and their use in surge models these ideas are combined to argue in favor of a specific combination of da and model techniques in section 2 the details of which are then presented in sections 3 and 4 a case study demonstrating the effectiveness of this approach is shown using hurricane matthew 2016 in sections 5 and 6 we then discuss justification limitations and alternatives for the proposed da framework in section 7 discussion of the method s use in an operational forecast setting follows in section 8 before concluding data and simulations presented in this study have been published asher 2019 and made publicly available online through designsafe ci at https doi org 10 17603 2z8h 7k90 1 1 advances in surge modeling uncertainties in meteorological forecasts are often the leading order source of uncertainty in storm surge forecasts of tropical cyclones the 2017 24 48 and 72 h track errors for tropical cyclones in the atlantic basin are 32 56 4 and 87 7 nautical miles 59 3 104 162 km respectively cangialosi 2018 these distances can constitute the difference between peak and relatively minor surge however meteorological forecast errors continue to decrease creating a critical window 1 3 days prior to landfall and roughly peak storm surge when surge model errors due to factors other than meteorological forecast uncertainty are becoming significant in the overall predictive power of storm surge forecasts state of the art storm surge models utilize the shallow water equations often in depth integrated barotropic form they include forcing from tides wind and atmospheric pressure bottom drag and in some cases wind waves the history resolution requirements and improvements in storm surge models have been characterized in several studies including bode and hardy 1997 blain et al 1998 dukhovskoy and morey 2011 and kerr et al 2013b a model skill has improved notably over the past two decades due to improvements in computational power topographic data quality meteorological model skill and model physics for instance da in meteorological model hindcasts produces wind and pressure fields that more closely match actual events and significantly improves storm surge model skill cardone and cox 2009 surge models are now reaching a state where low frequency variations in water levels can be a primary contributor to error if not accounted for as shown in fig 1 these data come from validation hindcasts with the adcirc hydrodynamic model described in section 5 1 during development of the national oceanic and atmospheric administration noaa hsofs mesh riverside technologies inc and aecom 2015 simulations were run with model zero at mean sea level to match anticipated operational conditions and the resulting low bias is apparent the difference in modeled and observed mean water level and inspection of time series data right fig 1 make clear that although higher frequency fluctuations are evident slowly varying changes in the water elevation drove much of the low bias for nearly all storms typically surge hindcasts either de trend measured data to remove such background water levels or apply a spatiotemporally constant water level offset to the model that approximates the mean water level preceding the storm in the vicinity of maximum surge e g westerink et al 2008 however this fails to account for spatial variations which may be appreciable depending on the unresolved driver s responsible and the size of the area affected by surge in operational forecast applications changing the water level correction between simulations could apply a shock to the model and if spatially varying would create associated large scale flows making it more suitable as a post processing step but post processing means physical effects of the altered water level and therefore depth are not included in the model simulation and also creates challenges in changing the horizontal extent of the calculated floodplain after the simulation completes which can be quite complicated during major surge events 1 2 unresolved drivers hydrodynamic models designed to accurately simulate storm surge must resolve domains covering thousands of kilometers and features such as elevated roadways and dunes only several meters wide e g bilskie et al 2015 this results in the need for substantial computational resources and a desire to optimize model complexity thus storm surge models are typically depth integrated constant density and decoupled from large scale oceanic motions rainfall and hydrologic input except at relatively large scale in the case of tcs since gridded meteorological data may not adequately resolve the storm s core storm surge models often use parametric representations of the storm s wind and pressure fields such as holland 1980 thereby neglecting both antecedent and far field meteorological conditions these introduce a host of unresolved drivers with varying temporal and spatial scales for instance 1 seasonal water level fluctuations have a spatial scale of hundreds to thousands of kilometers and a temporal scale of months to a year e g enfield and allen 1980 2 fluctuations in major ocean currents extend hundreds to thousands of kilometers and for days to years meinen et al 2010 valle levinson et al 2017 3 runoff from major rainfall events may affect tens to hundreds of kilometers and lasts several days to weeks notably these processes are slow compared to storm surge particularly due to tropical cyclones 1 2 1 magnitudes unresolved drivers generally produce smaller coastal water level fluctuations than tides and storm surge seasonal water level fluctuations u s monthly averages available from https tidesandcurrents noaa gov sltrends sltrends html often exceed 10 cm along the open coast e g barbosa et al 2008 the rise in coastal water levels following a rainfall event usually comes after storm surge with magnitudes of 10 cm or less typical during the surge event though as evidenced in north carolina during hurricane florence 2018 notable exceptions to this may occur in semi enclosed coastal water bodies interannual anomalies in coastal water levels on the order of 5 cm have also been detected and related to local and broader atmospheric forcing patterns andres et al 2013 calafat et al 2018 hong et al 2000 changes in gulf stream transport have been implicated in coastal sea level fluctuations of up to several 10 s of cm ezer and atkinson 2017 goddard et al 2015 sweet et al 2009 atmospheric systems can reduce gulf stream transport by 30 mooers et al 2005 during the time period preceding and including hurricane matthew the florida current transport dropped by approximately 30 fig 4 left ezer and atkinson 2017 associated a 30 40 cm rise in coastal water levels following the passage of hurricane matthew with the large drop in gulf stream transport 1 3 efforts in ocean data assimilation popular da methods include kalman filter variants verlaan and heemink 1997 evensen 2003 altaf et al 2014 optimal interpolation oi oke et al 2002 counillon and bertino 2009a madsen et al 2015 and variational methods bennett 2002 kurapov et al 2011 troupin et al 2012 oi typically uses the variability in the observations and an error covariance matrix assumed a priori to create a spatial field that blends the model and observations and can emulate physical behavior by selecting appropriate covariance function s e g cooper and haines 1996 lorenc 1981 oi is actually a sub optimal version of the more general kalman filter and more advanced kalman filter based approaches do away with parts of these a priori assumptions using a variety of techniques to better propagate the error covariance these and advanced variational methods come at greater computational cost than oi due to the complexity of the analysis and or the need to run multiple model realizations da in coastal water level problems is not new e g the storm surge work of heemink 1986 and has been successfully employed in the north sea e g zijl et al 2015 storm surges in this region are often large geographically and remotely forced madsen et al 2015 combined with the area s large tidal fluctuations and dense sensor network da is able to correct errors introduced by the use of a coarse numerical model e g høyer and andersen 2003 efforts in other regions have shown some promise etala et al 2015 demonstrate short term 6 h forecasting improvements using satellite altimetry and coastal water level data along the argentine coast and multiple authors have successfully calibrated models via assimilation e g graham et al 2016 mayo et al 2014 however tropical cyclones strong local forcing and smaller spatiotemporal scales create many challenges for practical data assimilation butler et al 2012 and altaf et al 2013 2014 improved hurricane surge prediction with a very coarse surge model using several different ensemble kalman filters however major gains were only seen for a very short 2 h forecast window and required careful tuning of the assimilation scheme improvements more than 2 h out were much more modest and required a set of several hundred synthetic water level observations across the continental shelf in the vicinity of the storm track figs 4 and 5 in butler et al 2012 a dataset which does not yet exist butler et al also noted no improvement in forecasts longer than 36 h for h katrina whereas h ike showed some improvement at 48 h we interpret this as being due to the exceptionally long surge signal seen preceding h ike due to the storm s massive size and unusual forerunner surge kennedy et al 2011 similarly peng and xie 2006 noted no improvement in storm surge forecasts beyond 8 h using 4dvar to revise initial conditions with a coarse 3d ocean model by also revising the wind drag coefficient with 4dvar and the same model li et al 2013 realized moderate improvements when wind speed was deliberately set too high low though the choice of correcting wind speed error with drag coefficient is fortuitous these cases point to a fundamental limitation in utilizing da for improving storm surge forecasting that will be explored in the next section as we assess what sort of da might best benefit this problem 2 requirements for storm surge data assimilation both the physics model and the da method face choices that balance complexity and computational cost forecast coastal water level modeling systems must consider the relative importance of model physics grid resolution the number of forecast ensemble members timeliness etc given available computational resources advanced da methods such as 4dvar or ensemble kalman filters require substantial computational resources sometimes over an order of magnitude greater than simulations without assimilation conversely the a priori assumptions made in oi typically lead to lower quality results at a lower computational burden a second consideration is the timescale of the surge event itself peak surge events from tcs often last on the order of 12 h e g hurricanes matthew in figs 8 and 9 and floyd in fig 10 forecast cycles occur every 6 h and lead times for emergency preparation and evacuation are up to several days the time scale of significant storm surge is shorter than the lead time needed for action storm surge is often a locally driven process which can mean water level data with a strong surge signal cannot be assimilated early enough to provide useful information this point is particularly important as it possibly cannot be overcome through more data computational resources or da methods similarly da cannot be expected to represent phenomena whose spatial scale is smaller than the spacing between observations typically 10 200 km along the u s gulf and atlantic coasts given the phenomenological and computational constraints the question becomes how can one most effectively use da to improve storm surge forecasts we argue that a low cost da method paired with existing surge model physics is an effective balance our approach is to use da to address the water s response to more slowly varying large scale unresolved drivers while using the hydrodynamic model to accurately capture the generation and propagation of surge and tides 3 assimilation formulation in this section we describe our approach for ingesting water level corrections into the model while the next section steps through how the correction is generated and implemented in practice we are working with the reynolds averaged depth integrated constant density shallow water equations vallis 2006 luettich and westerink 2004 1 continuity d h ζ d t h ζ u 0 x momentum d u d t f v g ζ x 1 ρ 0 p x τ s x τ b x τ w x h ζ ρ 0 α η d x m x y momentum d v d t f u g ζ y 1 ρ 0 p y τ s y τ b y τ w y h ζ ρ 0 α η d y m y for h the static water depth ζ the water surface elevation t time d dt the material derivative u the depth averaged velocity vector u v f the coriolis parameter g acceleration due to gravity p pressure at the sea surface ρ 0 constant water density subscripts x and y indicating terms in their respective directions τ s surface wind stress τ b bottom drag stress τ w wave radiation stress η newtonian equilibrium tidal potential α effective earth elasticity factor and m vertically integrated lateral stress gradient the continuity equation imposes a mass balance on the solution while the momentum equations impose the force balance our goal is to apply a gradually varying in space and time correction to the water elevation field δ ζ a direct manipulation of the water level will not accomplish this by itself because a rapid barotropic adjustment would occur in the velocity field and the added water would simply flow away rather we found this could be done effectively by introducing a fictitious force into the momentum equations to drive the solution to the desired surface elevation specifically changes in atmospheric pressure create corresponding changes in water surface elevation e g the bulge in sea level under an atmospheric low pressure center this can be approximated via the inverse barometer relationship δ p ρ 0 g δ ζ we therefore modify the sea surface pressure term in the momentum equations to reflect both the actual atmospheric pressure and a pseudo atmospheric pressure 2 p p a δ p p a ρ 0 g δ ζ where p a is the actual atmospheric pressure and δ p is a so called pseudo atmospheric pressure pap considering only the x momentum equation yields 3 d u d t f v g ζ x 1 ρ 0 p a δ p x τ s x τ b x τ w x h ζ ρ 0 α η d x m x substituting in eq 2 and regrouping terms this can also be written as 4 d u d t f v g ζ δ ζ x 1 ρ 0 p a x τ s x τ b x τ w x h ζ ρ 0 α η d x m x in either form a fictitious force is being applied to drive are arrangement of the total water elevation field to include the assimilated elevation differences the resulting adjustment of the total water elevation field then propagates through all other terms in the shallow water equations while adding the fictitious forcing term will drive water to achieve the desired surface elevation correction over time we can assist this process by simultaneously introducing the desired water level correction directly into the water elevation field as noted above the elevation field cannot be modified without the compensating forcing term in the momentum equations because the added water would quickly flow away when directly applying a correction δ ζ to the water elevation the correction in the momentum equations eq 4 can be thought of as providing a force to maintain the elevation correction using only the fictitious force term we are altering the velocity field to accomplish the re arrangement of water to achieve the desired total water elevation adding water in directly minimizes the need for this dynamic re arrangement and therefore lessens the accompanying velocity field alteration however under the assumption that the corrections are gradual in space and time the two methods should exhibit similar behaviors which is what we observed in practice in open coastal waters differences were primarily located in areas with significant constrictions the similarities and differences between the methods are discussed in more detail in section 7 4 for the sake of clarity in the remainder of the manuscript we term the pap method as applying only the fictitious forcing in the momentum equations while the con method applies the forcing and directly adds removes water 4 storm surge data assimilation framework the da system employed here can be broken down into four steps 1 performing an unassimilated simulation 2 time averaging or lowpass filtering the difference between this simulation and observed water levels at observation sites 3 generating a spatial difference field from these differences 4 repeating the simulation with the added correction applied in the model fig 2 shows a simplified schematic of the process with steps 2 3 lumped together a more detailed schematic is shown in supplemental figure 1 the procedure is repeated at selected intervals in time e g every forecast cycle in a forecast system and the pap forcing is interpolated in time between cycles the unassimilated and assimilated model states are saved at the end of each simulation so that they may be resumed at the start of the next cycle the da framework used here can be classified e g daley 1991 as a continuous sequential scheme using optimal interpolation in that the da analyses are carried out every assimilation cycle sequential and the correction is applied continuously to the simulation continuous by way of the pap forcing and the mass field if desired several parts of our approach are similar to those developed in the da literature including the time distributed averaging procedure of oke et al 2002 and the incremental analysis update technique of bloom et al 1996 in the remainder of this section we describe methodological details of the 4 steps a step by step summary is provided alongside supplemental figure 1 we provide a more thorough discussion of our choices and alternatives in section 7 before proceeding however we make two clarifications on nomenclature first in da literature forecast often refers to an unassimilated system state such as an unassimilated simulation the term background is also used for this quantity though its history is somewhat complicated see ide et al 1997 so here we use first guess for this quantity to avoid confusion with a true forecast second we use the term difference field here to refer to the spatial field of differences between observed and unassimilated modeled water levels 4 1 step 1 unassimilated simulation the first guess field of water elevations is determined by running an unassimilated simulation whose final state is saved to permit restarting at the beginning of the next assimilation cycle separating the unassimilated and assimilated simulations is unusual in da we term this a two track assimilation scheme however it ensures that our model solution is driven to match the missing low frequency component without introducing overshoot and undershoot oscillations 4 2 step 2 time averaging the first guess and the observed water level data are averaged over a chosen time period t nominally 1 10 days in order to filter out high frequency fluctuations such as astronomical tides that constitute most of coastal water level variations selecting the time scale as an integer multiple of the dominant tidal cycle 12 42 h for m2 semidiurnal tides suppresses tidal phasing errors that might cause undesired oscillations in the difference field further discussion on the choice of time scale is presented in section 7 3 4 3 step 3 difference field the mean difference between observed and modeled data is then fed into oi with an assumed error covariance to produce a gridded difference field e g fig 6 calculating and storing the full resolution covariance matrix a 106 106 matrix for the 1 8 million node mesh used in this study would be a daunting task and it is common in the da literature to partition the domain into subdomains to manage this problem however we argue the time averaging of water levels the gradual nature of the unresolved drivers we wish to capture compared to typical grid resolutions and the large distance between observations make the use of a coarser grid for data assimilation computations appropriate after which results are interpolated to the model mesh to explain generation of the difference field we begin with a brief introduction to sequential data assimilation there is substantial variability in the notation utilized in da literature however we mostly follow that of ide et al 1997 the base equation in sequential data assimilation is 5 x a x f k y o h x f x f kd d y o h x f where bold lowercase uppercase variables denote vectors matrices we now define the variables and their dimensions in context of traditional da terminology in quotes their meaning for the problem at hand is supplied in the following paragraph n number of grid points m number of observed values denoted p in ide et al 1997 x f x f t n 1 time varying forecast background or first guess system state vector y o y o t m 1 time varying observation vector x a n 1 the analysis vector k n m the kalman gain matrix or gridding operator h m n the observation operator or measurement operator d m 1 the innovation vector or observational residual put in the context of this problem n is the number of grid points m is the number of gages where observed water levels are available for assimilation x f are the water levels from an unassimilated model simulation at the grid points y o are the observed water levels at the gages x a are the water levels calculated by the assimilation process at the grid points at a single point in time h linearly interpolates the unassimilated model water levels to the locations of the observations d is a set of water level differences at the observed locations and k performs the heavy lifting of creating the difference field kd in reality k depends on h and the error covariance structure of the first guess and the observations for a conceptual overview readers are directed to a recent review article moore et al 2019 for further details interested readers are directed to fletcher 2017 bertino et al 2003 bennett 2002 and evensen 2003 daley 1991 calculation of the water level correction is termed the analysis step in da we do not directly apply eq 5 in our method rather we time average d as described in the last section and compute the difference field as 6 δ ζ a k d t for δ ζ a n 1 the difference field corresponding to δ ζ and t the time scale of the averaging operator denoted by angle brackets we then introduce this time averaged difference field in the model to apply the correction gradually and let the model s physics respond accordingly using either the pap or con methods as explained in section 3 4 4 step 4 assimilated simulation and forecast with a new difference field calculated the assimilated simulation is then restarted from its last saved state and run forward from the previous cycle until the current time is reached much like the unassimilated simulation in step 1 each difference field is considered to represent the correction for the current time and so the pap forcing and the elevation correction if desired applied during a simulation evolves in time by linearly interpolating between the previous and current difference fields if this is used as part of a forecast system the forecast simulations would then be initiated using that assimilated solution as the initial condition together with some assumption of how the difference field evolves into the future 5 case study setup modeling experiments were undertaken to evaluate the ideas presented here and to build an algorithm for carrying out such assimilations under operational conditions hurricane matthew 2016 was selected due to the presence of a persistent bias between predicted and observed water levels prior to and throughout the event and the availability of high quality data to support the investigations the adcirc model coupled with the swan wave model was used data assimilation was done with water level data from a set of coastal water level gages each of these components is described in further detail in this section 5 1 numerical model adcirc is an ocean circulation model based on the 2d 3d shallow water equations it solves these equations in a continuous galerkin linear finite element unstructured mesh framework luettich and westerink 2004 westerink et al 2008 here it is used in its 2d depth integrated form swan is a 3rd generation phase averaged spectral wave model that solves the conservation of wave action equation as it evolves in time and space booij et al 1999 zijlema 2010 it operates on the same linear triangular mesh as adcirc the two models are tightly coupled with water depths and currents passed to swan and wave radiation stress gradients passed to adcirc at each shared time step dietrich et al 2011b a the coupled model is highly parallelized for execution on supercomputing systems tanaka et al 2011 dietrich et al 2011a kerr et al 2013a making it useful for numerous surge modeling applications the 1 8 million node 3 6 million element hsofs mesh was used riverside technologies inc and aecom 2015 shown in fig 3 the hsofs mesh covers the western north atlantic and all overland areas of the neighboring u s coast up to an elevation of 10 meters above sea level with detailed representations of inlets rivers barrier islands roadways and other key features elevation data is based on the latest available bathymetry and lidar derived topography mesh resolution in coastal areas is typically 400 to 500 meters and as low as 200 meters in some areas making it an intermediate resolution grid developed specifically for national scale real time storm surge forecasting applications this mesh is now used by noaa for operational coastal water level and storm surge guidance in their estofs extratropical surge and tide operational forecast system and hsofs hurricane surge on demand forecast system programs meteorological forcing is shared by adcirc and swan and is described in the next section tidal forcing in the adcirc model is specified by periodic water elevations along the offshore boundary and body forcing throughout the domain based on the oregon state university topex poseidon global inverse solution version 7 2 tpxo7 2 egbert and erofeeva 2002 manning s n based bottom friction in adcirc is based on 2006 c cap land cover data so that increased dissipation during flooding in marshes and overland areas is accounted for directional reductions in wind speed due to the roughness of overland features is accounted for using the land cover data upwind of a given location to determine the roughness height in a charnock type relation for oceanweather and holland type wind models discussed in the next section since these are considered to be at marine exposure overland drag for waves is considered less important since their primary use here is in helping calculate accurate surge elevations via wave radiation stresses and depth induced breaking is the primary mechanism of energy dissipation in such cases bottom friction in swan is formulated as a jonswap type sea state dependent drag hasselmann et al 1973 and no wind reductions are performed the adcirc model is explicit and finite difference in time and so has a courant limited time step of 2 s for this application the swan model is time implicit allowing it to have a larger 15 minute time step more granular detail on model setup parameters is provided in the supplemental 5 2 hurricane matthew hurricane matthew was a cape verde type 1 1 hurricanes originating near the cape verde islands more info here http www aoml noaa gov hrd tcfaq a2 html hurricane that developed into a tropical cyclone on september 28 2016 near barbados the storm passed between south america and the greater antilles briefly becoming a category 5 hurricane on the saffir simpson hurricane wind scale before turning north on october 2 it made landfalls on haiti and cuba on october 4 and 5 respectively it then tracked just offshore of the southeastern u s coastline for several days barely making landfall in south carolina on october 8 before transitioning to an extra tropical cyclone on october 9 and heading offshore stewart 2017 although the storm s surges were not as severe as many other historic storms matthew s track fig 4 brought moderate surges to over 1000 km of u s coastline and high water conditions for several days at many sites providing a large amount of observational data over which to study the storm s effects meteorological forcing for the coupled model is provided in the form of winds and sea level pressures and is taken from three sources in order to assess the effects of different meteorological fields the most basic meteorological forcing comes from a parametric vortex model the generalized asymmetric holland model or gahm based on holland 1980 but without requiring the cyclostrophic balance assumption gao 2018 parametric models such as gahm are useful in that they allow wind and pressure fields to be constructed in a dynamically consistent manner directly from meteorologist forecast parameters in the case of gahm radii to maximum winds are determined in each storm quadrant by fitting the model to specified wind isotachs in each quadrant gao 2018 dietrich et al 2018 there are no far field winds associated with the gahm other than those of the translating vortex of the storm an intermediate quality meteorological forcing was developed by combining the gahm with north american mesoscale forecast system nam fields the latter supplying the far field winds and pressures blending between the two datasets is performed over a range of several radii to maximum winds away from the storm center in order to provide a smooth transition the third and highest quality source of wind and pressure forcing comes from reanalysis meteorological fields defined objectively using airborne terrestrial and oceanic measurements including stepped frequency microwave radiometer sfmr data by oceanweather inc owi cox et al 1995 cardone and cox 2009 5 3 observation data water level data was collected from a total of 44 permanent stations along the open coast estuaries bays and rivers and 129 temporary storm tide sensors deployed for hurricane matthew all of these data are from either noaa or the u s geological survey usgs 24 noaa gages were used in the assimilation set that forms the y o observations needed for da shown in fig 4 19 gages and 129 storm tide sensors visible in fig 7 were used as validation of the scheme the final gage located at springmaid pier sc was lost when the pier was destroyed by matthew shortly before the storm surge peaked this gage was also included in y o m 25 while functioning but then dropped m 24 when found to be out of operation without any apparent loss of fidelity in the solution suggesting the methodology is reasonably robust to events like gage failures provided sufficient gages are included in determining the difference field all gages in the assimilation set were located at or close to the open coast whereas the validation data are generally in more sheltered waters rivers and overland further information on all data used is supplied in supplemental table 2 5 4 data assimilation da was carried out using the method described in section 4 assimilated simulations were run using both the pap method and the con method as described in section 3 a 6 h assimilation cycle was used that corresponded to the hurricane advisories provided by the national hurricane center fig 2 every assimilation cycle the first guess field x f was updated with a 6 h model run using the ending state of the previous unassimilated solution as its initial condition observed and unassimilated modeled water levels were averaged over the previous 24 84 h two m2 tidal cycles and were used to compute differences at the gage locations these differences were input into oi assuming a gaussian error covariance matrix with a constant correlation length 2 2 the observation error is assumed very small 1 mm since noaa water level gages are very accurate of 1 degree in addition the difference field was constrained to approach zero offshore by placing a sequence of artificial gages just off the continental shelf break with their d set to zero offshore of these areas the difference field was discarded an example of a resulting difference field for each of the meteorological forcings is shown for 00 00 h utc on october 5 2016 in fig 6 a 6 h model run with assimilation was then performed using the ending state of the previous assimilated solution as its initial condition and linearly interpolating the difference field in time from the previous to the newly constructed difference field over the 6 h assimilated model run if this were to be used as part of a forecast modeling system the assimilated model run would then be used as the initial condition for the forecast 6 case study results simulations were carried out from 00 00 utc october 2 to 00 00 utc october 11 2016 with the three sources of meteorological forcing both with and without assimilation giving a total of 6 simulations for hurricane matthew runs without assimilation are referred to as baseline cases and the two letter shorthand nomenclature shown in table 1 will now be used to refer to individual simulations minimal differences in skill metrics were observed between the results from the pap and con methods and so only the pap method results are presented in this section con results are in supplemental material data and simulations presented here are available online through their publication asher 2019 6 1 model skill errors in peak surge estimates are provided in figs 5 and 7 time series at selected gages are shown in fig 8 and time series plots at all gages are in supplemental figure 3 skill metrics for both peak and time series data are provided in table 1 with bias being positive when the model water level is higher than the observed time series statistics were calculated over the 120 h from october 5 00 00 to october 10 00 00 utc all three baseline simulations show negative model underestimation biases ranging from 22 to 79cm at the 24 assimilation sites the gb simulation has the greatest bias being approximately twice that of the ob and nb simulations which have similar biases with da the bias is largely removed ranging from 1 cm to 6cm as measured by peak surge or time series across all assimilation and validation stations for the three meteorological forcings mean absolute error mae and root mean square error rmse are reduced by a quarter to two thirds of their baseline simulation values as well error statistics for the con method supplemental table 1 were within 1 cm of the pap method with no systematic trend the largest remaining errors in the da simulations occurred within pamlico sound and its accompanying rivers in north carolina these errors are due to a combination of a frontal weather system north of matthew that is not well represented in any of the meteorological forcing datasetsas well as errors in model bathymetry within the sound model simulations not shown using a different grid with higher resolution and better bathymetry gave an increase in peak surge of 30 cm at the noaa hatteras gage fig 8 bringing it into much closer agreement with observations 6 2 assimilation effects the spatial structure of the difference fields indicates a slight increasing trend from south to north along the us southeast atlantic coast fig 6 at this time 00 00 utc 10 5 2016 the eye of matthew was located at approximately 20 degrees north fig 4 the temporal behavior of the difference field is shown at selected stations along the coast in fig 9 time series plots at all gages are in supplemental figure 3 the two m2 tidal cycle time average and the gaussian error covariance with 1 degree correlation length together appear to impose reasonable spatial and temporal smoothness in the difference field consistent with the objective of correcting for low frequency unresolved drivers the difference field is generally twice as large for the gb as the ob and nb solutions consistent with the increased bias noted above the substantial reduction of model bias and accompanying other error statistics in the da simulations provides strong evidence that this approach is effectively correcting for the unresolved drivers in the water surface elevation comparison of the gb and nb simulations suggests that approximately half the bias in the gb simulation may be due to missing far field meteorology and that da is able to reasonably compensate for this deficiency in model forcing comparison of the ob and nb simulations suggests that the blended gahm nam wind and pressure fields provide a reasonable forecast grade substitute for the more detailed reanalysis owi fields assuming that the ob and nb reasonably capture the meteorological component of the water level forcing the remaining half of the bias in the gb run and the majority of the bias in the ob and nb runs must be due to non meteorological unresolved drivers water levels are characteristically high in october with historical monthly average water levels ranging from 19 cm at daytona beach fl to 17 cm at fort pulaski ga to 12 cm at beaufort nc the area from southern florida to cape hatteras is adjacent to the gulf stream which experienced a substantial decrease in transport during matthew s passage fig 4 decreased gulf stream transport has been associated with increases in coastal water level ezer and atkinson 2017 and this may provide an additional unresolved driver during the matthew time period 7 data assimilation framework discussion as presented above we have found our da approach to be an effective tool for reducing a significant source of error in storm surge simulations calculating a difference field eq 6 involves multiple choices including the form of the gain matrix k the time averaging used to calculate d t and the m observation sites that form y o lastly there is the matter of selecting how data are manifested or ingested back into the model as was done via the pap forcing alone pap method or the forcing paired with direct addition of water con method each of these items will now be addressed both in terms of the proposed method and in terms of the techniques presented in the meteorological and oceanographic da literature 7 1 gain matrix k the most challenging step in determining k is defining the first guess error covariance matrix typically denoted b or p f note the latter does not denote the pap field it is common to partition b into a diagonal variance matrix d n n that can optionally be updated in time and a stationary i e time independent correlation matrix c n n as b d 1 2 c d 1 2 we expect strong anisotropy in the correlation structure with distinct characteristic scales in the cross and along shore directions which should evolve through estuaries bays and further upstream therefore presuming a single correlation length is clearly suboptimal as indicated in the following example in 1999 hurricanes dennis and floyd dropped massive amounts of rain in north carolina within a few weeks of each other leading to record breaking flooding across much of the state this resulted in differences in water levels on either side of the north carolina barrier island complex as high as 0 5 m fig 10 shows the effect this had on the water level anomaly surface determined via oi using a 4 day average water level prior to floyd and a constant correlation length of 1 degree the open coast gage at duck shows a small anomaly in the water level time series since it is not appreciably affected by the rainfall however the gage at oregon inlet shows a much larger longer lasting anomaly due to the runoff filling up pamlico sound the water level anomaly surface using our simple correlation structure is unable to match the 16 cm difference in the 4 day mean water level between the two gages application of a more appropriate correlation matrix would permit a sharp spatial gradient to be more faithfully 3 3 the lowpass filtering of our data suggests brief episodic changes in correlation like the overtopping of a barrier island during a large storm surge likely need not be accounted for in the correlation matrix represented in the difference field we expect that the structure of the correlation matrix c will depend on the unresolved driver s at work and therefore it is unclear whether a single covariance structure can fully account for distinct phenomena if a substantial portion of the to be assimilated model error d is presumed to come from physics absent from the model and not errors due to model forcing initial conditions etc then along with the sparsity of measurements this means a substantial portion of the error covariance structure is not identifiable 4 4 this is closely related to the motivation for the fixed basis form of the singular evolutive extended kalman seek filter brasseur and verron 2006 put another way the correlation on all time scales of interest between the sheltered oregon inlet and open coast duck locations discussed in the previous paragraph can only be estimated with measured data or a model with the physics needed to resolve all time and space scales of interest so one must either rely on an incomplete estimate of c from the surge model s correlation structure or else infer it from another source such as altimetry data a more advanced model or a parametric function this difficulty in revealing the full covariance structure motivates a generalization of eq 6 to 7 δ ζ a j 1 j k j d t j where j is the index of j difference fields note we will use d j as shorthand for d t j this permits accounting for different unresolved drivers separately each with its own correlation matrix c j with this we can consider a series of spatiotemporal scales corresponding to different unresolved drivers whose covariance structures can be inferred using one of the methods mentioned in the last paragraph eq 7 is attractive because it conforms nicely to one interpretation of the theoretical basis for the forcing term that it represents a closure scheme for a series of unresolved drivers discrete physical processes that the hydrodynamic model s governing equations and inputs do not explicitly account for while conceptually attractive many physical processes have overlapping scales making separation difficult to accomplish in practice thus the approach of defining different correlation matrices for different unresolved drivers may be most useful for separating out shorter fluctuations e g days to weeks from those that affect seasonal or longer term water levels since correlation lengths for the latter processes are substantially longer e g calafat et al 2018 7 2 sites m greater data density and quality generally results in improved estimates however since the physical dynamics are not accounted for in our implementation of oi utilizing data which are not representative of the coastal environment under consideration can be problematic if the data are not handled with care preliminary tests utilizing water level gages in rivers were found to produce lower quality difference fields because our oi implementation does not resolve the pathway taken by the water and so the area of influence of these gages is exaggerated this like the example in section 7 1 may be alleviated through use of proper correlation structure being unbound by physical constraints the difference field can diverge when extrapolating which is why we imposed the artificial gages with their d set to zero off the continental shelf break to weakly constrain the difference toward zero in the offshore direction as discussed in section 5 4 physical constraints could be applied to deal with such issues within the da scheme however the irrelevance of such small offshore water level fluctuations on coastal water levels suggests any technique may suffice a similar issue arises in inland areas where the d at the coast may not be relevant if inland gages are not available or used then in cases where the inland domain extent is large compared to the correlation length ways to constrain the difference field inland may need to be devised 7 3 time scales t time averaging in calculating d j acts as a boxcar filter on the water level difference it is not clear the choice of averaging method is particularly important and other analyses have shown that simple filtering methods can be advantageous bloom et al 1996 oke et al 2002 however the choice of averaging time scale t is key the exact choice of time scale represents a balance between which fluctuations to remove and which to keep and so can depend on the processes of interest use of a rather short 24 84 h averaging period in this study permitted da to correct for the surge error resulting from poor far field meteorology in the gahm model however no systematic study was undertaken to evaluate whether this was the best choice of t review of time series in fig 9 suggests an averaging period 1 5x or 2x this length may have also produced similar results though this question may warrant further review under other conditions our approach may create a lag in the modeled response since 1 the difference field is based on data prior to the current point in time and 2 there may exist some lag time in the model responding to the forcing in the case of the pap method lag due to the former should be small unless d shifts rapidly compared to the assimilation interval lag due to the latter is discussed in section 7 4 note that lag due to the former issue could also be resolved by centering the assimilation window in time 5 5 this would classify the approach a smoother which utilizes both past and future data as opposed to a filter 7 4 ingestion method techniques for incorporating the water level correction back into a model simulation which we term ingestion are built into methods like certain ensemble kalman filters and 4dvar one of their advantages there is no such prescribed method for oi we proposed two methods in section 3 the matthew case study did little to elucidate differences as the methods error statistics were nearly identical therefore we now present a simple test problem and use it to distinguish the methods and how they each modify the solution the ga simulation presented in section 6 was repeated with all forcing disabled except for the assimilation to isolate its effects the ga simulation s difference field was chosen because it is a realistic test case with relatively large elevations peaking at almost 0 7 m in some regions and rising falling up to 20 cm day 9 day pap and con simulations were conducted with the initial elevation difference ramped in over 31 days prior to the beginning of the 9 day simulation to ensure both simulations start at the same equilibrium state note that simulation days 31 40 here correspond to october 2 11 2016 in the matthew case study results are shown in fig 11 across the entire study area maximum differences in the two simulations are less than 2 cm except for three regions ordered from north to south the pamlico albemarle sound complex in north carolina the st johns river in florida and the indian river lagoon system in florida in these areas differences reached 5 20 cm these areas are characterized by having tightly restricted flows to the ocean in all cases the con method s water levels track the difference fields more closely than the pap s this is expected given that the pap method requires the elevation field to respond to the imposed forcing whereas the con method imposes the elevation change directly however which result is preferable is situational in open coastal areas and areas with moderate connections to the open coast the propagation is fast and the difference between the methods minimal fig 11 however the pap method fills and empties tightly restricted semi enclosed waterbodies more slowly for example the pamlico albemarle sound complex a very large bay with very narrow openings filled at 8 15 cm day during the pap assimilated simulations noting that the correction field is derived primarily from coastal gages during matthew this may reflect a realistic damping of the coastally derived elevation correction this suggests the relative utility of the two methods is largely relegated to waterbodies with a weak connection to the open ocean and is tied to the expected accuracy of the difference field i e does the difference field correctly represent the water elevation difference inside these waterbodies in which case the con method may be more accurate or is it simply a landward extension of the coastal water level difference in which case the pap method may be more accurate one case of special note is a fully enclosed waterbody such as a coastal pond or gated waterway the con method would raise lower water levels in the waterbody whereas the pap method would only impose a gradient across the waterbody until the water level in an adjacent coastal region rose to a level that caused it to become connected with the enclosed waterbody here again which result is preferable depends on one s expectation of the true difference field 8 operational considerations operational forecasts carry substantially different priorities from those of other modeling studies in the former a critical requirement is getting an answer in a timely fashion to the degree the quality of the answer can be improved it should be but subject to the constraints that the improvement can be computed quickly enough to allow the result to be timely and that the process does not cause the forecast to fail e g introduce model instability the need to perform two simulations one with and one without assimilation means that this method roughly doubles the computational requirements for a hindcast study calculation of the difference field itself takes minimal time however in an operational forecast setting this doubling only applies to the simulation period going from past to present supplemental figure 1 typically a 6 h window the result of the assimilation is the creation of an improved initial condition for the impending forecast s assuming a 6 h assimilation forecast cycle the computational burden increases by 7 6 for a single 3 day forecast or 4 6 for a single 5 day forecast this small computational burden decreases even further if a multiple forecast ensemble is computed using the same initial condition e g to 1 6 for a 3 day 5 member ensemble forecast since computing the difference field does not require the forecast meteorology it is possible to run the unassimilated simulation and compute the difference field concurrent with the generation of the meteorological forecast if this is done the additional computational time required to implement da in the storm surge model would not delay the surge forecast which must wait for the forecast meteorology to become available the reliability of the difference field is a function of the quality of the input data as well as the choices made in computing it it is therefore important that any observation data stream be quality controlled the failure of the springmaid pier gage during matthew is an example of the loss of a real time data stream the oi surface in this case study did not change markedly after the gage failed and was removed from the data used to determine the difference field as seen in the time series in fig 9 at the nearby oyster landing gage the charleston sc and wrightsville beach nc gages are the two nearest to springmaid pier each roughly 1 degree away this indicates the 1 degree correlation length is reasonably chosen given the density of available observations and the smoothness of the assumed gaussian covariance operational applications will need to choose sites and covariance structure in a way that ensures loss of a gage or gages does not lead to physically unrealistic difference fields when carrying out a true forecast some assumption must be made about how the difference field transforms into the future in our initial use of this approach in forecast applications we have held the difference field constant through the forecast cycle more sophisticated approaches could be proposed incorporating expected growth decay times implied by the characteristic time scale of the dominant unresolved driver s 9 conclusions storm surge modeling systems have grown in complexity and accuracy and have reached a state where unresolved drivers are major contributors to model errors several such drivers are well known to cause appreciable coastal water level variations changes in large scale currents like the gulf stream are of particular curiosity since they have been shown to be affected by passing storms and there is recent evidence suggesting this could be an important component of multi day water level fluctuations not reproduced by surge models hurricane matthew appears to be one example of this tropical cyclone driven surge itself is often a rapid response that is not well suited for da in forecasts and seems better handled by the physics of the model itself in particular there appears to be a limit to how much da can improve tropical cyclone surge forecasts because guidance is often needed earlier than meaningful water level data can be assimilated conversely many unresolved drivers typically vary over spatial and temporal scales longer than that of storm surge and are therefore good candidates for da to allow allocation of computational resources elsewhere to this end a system for assimilating water level data into a surge prediction system has been constructed based around the principle of low cost continuous sequential data assimilation it was implemented as a pseudo atmospheric pressure forcing term with and without a direct correction to the water elevation term in the adcirc surge model and was evaluated for the case of 2016 s hurricane matthew using multiple meteorological data sources comparing results from the gahm parametric vortex model with the blended gahm nam model suggests that approximately half of the low bias in the gahm simulation was due to missing far field winds counter to prior experiences high grade assimilated reanalysis winds owi did not appreciably improve model performance compared to the blended gahm nam meteorology for matthew calculated water level differences ranged from 0 2 to 0 6 m and were typically twice as large for the gahm simulations as for the gahm nam and owi simulations results from the da simulations were very favorable with measures of model surge bias changing from 0 22 to 0 79 m in the unassimilated simulations to 0 06 to 0 01 meters in assimilated simulations mean absolute errors were also reduced by 48 to 66 at assimilation sites and 16 to 45 at validation sites further surge error statistics with the gahm and gahm nam meteorological fields were indistinguishable from those with the owi reanalysis fields once da was performed thus the da was able to account for the effect of far field winds on water levels absent in the simple gahm parametric vortex model it is not clear to what degree this accounted for antecedent conditions vs remote forcing though time series suggest both were at play the ability to compensate for some of the error in the meteorological forcing is particularly useful for forecasting because high quality reanalysis meteorological fields are not available the small increase in computational effort typically a few percent makes this method highly amenable to forecast applications the performance difference between the two assimilation methods for matthew was equivocal with both methods showing nearly identical error metrics a simplified test case illustrated conditions in which solutions diverge with differences being largely relegated to semi enclosed waterbodies weakly tied to the open ocean the merit of each method in such cases was argued to be case dependent and tied to the expected accuracy of the difference field a generalized framework for assimilating water level data into storm surge models using continuous sequential da has been proposed care has been taken to discuss implementation details as they pertain specifically to surge and to provide recommendations on how to navigate these issues in particular discovery of the first guess error covariance due to unresolved drivers is intrinsically impaired by their absence from the model this may support the use of multiple discrete difference fields corresponding to distinct scales of unresolved drivers 9 1 future work limitations of the proposed methodology are chiefly imposed by the need to specify the error covariance used in the assimilation we were pleased that a very simple error covariance worked well and greatly reduced the water level errors in our case but recognize the potential value of more sophisticated approaches these should be able to address the current method s largest shortcomings while allowing for more observed data to be used ensemble optimal interpolation or enoi oke et al 2002 evensen 2003 oke et al 2009 may be a promising candidate here enoi is effectively a hybridization of ensemble kalman filter and oi methods whereby a stationary ensemble e g a set of historical simulations is used to prescribe the covariance which can be made to vary over long seasonal time scales brasseur et al 2006 ideally such an ensemble would come from a more complex model that includes our unresolved drivers although even a 2d barotropic model should be able to recover first order structures such as the disconnect between open ocean and estuarine waterbodies the combination of multiple discrete difference fields corresponding to distinct scale of unresolved drivers may provide useful aid as well a better specification of the spatial structure of the elevation difference field may help determine the robustness of the pap and con methods additional data sources would help constrain the da satellite altimetry coverage is not guaranteed on the time scale of a storm surge event and there are substantial difficulties in getting quality measurements within 50 km of the coast however continued improvements have allowed for measurements of storm surge increasingly close to the coast fenoglio marc et al 2015 madsen et al 2007 2015 efforts to bring online airborne measurements of water surface elevation wright et al 2009 could also lead to more comprehensive water surface data in the immediate nearshore better data on offshore water levels will also allow for more physically realistic closure of interpolated surfaces this text has not discussed how velocity data might be incorporated in this system nor their utility though peng and xie 2006 indicated little gains in assimilating both compared to assimilating only water elevation in storm surge forecasting improvements in knowledge of the system physics can aid the da analysis to this end research into how hurricanes affect large scale fluctuations such as the gulf stream e g todd et al 2018 is of use comparison to a 3d ocean model s water surface topography may help inform the structure of the error covariance improvements in model physics to reduce the need for the da correction should also be pursued to whatever degree possible while maintaining compatibility with available computational resources credit authorship contribution statement taylor g asher conceptualization data curation formal analysis investigation methodology project administration resources software supervision validation visualization writing original draft writing review editing richard a luettich jr conceptualization funding acquisition methodology project administration supervision writing review editing jason g fleming investigation software brian o blanton methodology software acknowledgments the authors would like to thank elaine spiller for her helpful review and comments on our manuscript the florida current cable and section data are made freely available on the atlantic oceanographic and meteorological laboratory web page www aoml noaa gov phod floridacurrent and are funded by the doc noaa4 climate program office ocean observing and monitoring division water level data were acquired from the noaa nos center for operational oceanographic products and services http tidesandcurrents noaa gov api and the usgs https waterdata usgs gov nwis rt and https stn wim usgs gov fev matthewoctober2016 some color schemes were taken from colorbrewer http colorbrewer org background maps for some figures are credited to esri here delorme mapmyindia openstreetmap contributors and the gis user community further information is available here https www arcgis com home item html id 87fcdf91a0f14e4a9fda40a763c6f2b8 this material is based upon work supported by the u s national science foundation under grant award number aci 1339723 and the us department of homeland security under grant award number 2015 st 061 nd0001 01 declarations all authors approve of this manuscript the authors certify this original work has not been published nor submitted elsewhere disclaimer the views and conclusions contained in this document are those of the authors and should not be interpreted as necessarily representing the official policies either expressed or implied of the u s department of homeland security declaration of competing interest r luettich is a creator and owns a partial interest in the copyright to the adcirc source code appendix a supplementary data supplementary material related to this article can be found online at https doi org 10 1016 j ocemod 2019 101483 appendix a supplementary data the following is the supplementary material related to this article mmc s1 
24002,numerical modeling shows great potential as a method for investigating and predicting the future development of ice shelves in a warming climate the quality of ice shelf ocean models is continuously improving but some limitations remain for models using a terrain following vertical coordinate one such limitation is the enforcement of a minimum water column thickness beneath ice shelves by adjustment of bottom topography how this local distortion of bathymetry from reality affects modeled melt rates and cavity circulation is unknown so far to quantify this effect simulations with the finite element sea ice ice shelf ocean model fesom were executed on four different grids with minimum water column thicknesses of 20 m 50 m 100 m and 200 m while we use a global model grid modifications of bathymetry are applied only to filchner ronne ice shelf we show that the choice of minimum water column thickness does not affect the total basal melt rate of this cold water ice shelf but does in fact impact the distribution of melt rates with significant differences between experiments in the magnitude of melting near the grounding lines keywords fesom ice shelf geometry water column thickness basal melting filchner ronne ice shelf 1 introduction the filchner ronne ice shelf fris in the weddell sea antarctica plays an important role in ice and ocean dynamics by buttressing the ice streams that drain the continental ice sheet it reduces the flow of grounded ice towards the ocean fürst et al 2016 its importance for large scale hydrography and the global thermohaline circulation arises from the production of ice shelf water isw a water mass with a temperature below the surface freezing point which mixes with modified warm deep water mwdw to form weddell sea bottom water wsbw to predict the future evolution of the ice shelves in a warming climate numerical models are employed one of these models is the finite element sea ice ice shelf ocean model fesom which features an unstructured surface mesh and a hybrid vertical coordinate with sigma coordinates around antarctica and z coordinates everywhere else danilov et al 2004 wang et al 2014 timmermann et al 2012 like other models with a terrain following vertical coordinate e g mueller et al 2018 fesom requires a nonzero minimum water column thickness wct to ensure computational efficiency and stability this minimum wct is ensured by lowering the bedrock beneath the ice shelf base where necessary thereby changing the bedrock topography especially in shallow areas near grounding lines these changes may potentially influence the simulated melt rates significantly in order to investigate the sensitivity of the model to alterations in the grounding zone geometry a series of model runs with different bathymetries was executed a set of four different meshes was created each with a different prescribed value for the minimum wct the most affected areas were identified and analyzed according to key oceanographic properties like temperature and salinity and the basal melt rate of the ice shelf the area weighted total melt rate for the fris was also calculated this paper briefly describes the fesom setup and discusses the relevant steps of the mesh generation process the different meshes are compared and the melt rate distribution is analyzed possible mechanisms explaining the changes in melt rates are presented afterwards before investigating the effect on area integrated basal mass loss 2 method fesom the model employed for our investigation solves the hydrostatic primitive equations for the ocean the thermodynamic equations for the interaction between the ocean and ice shelves and dynamic and thermodynamic equations for sea ice the use of terrain following coordinates around antarctica ensures a constant number of 22 levels beneath the ice shelves and a smooth representation of bedrock and ice shelf topography and their slopes the unstructured horizontal mesh allows for increased resolution in areas of interest the surface mesh consists of triangular elements which are extended toward the bottom to form prisms these prisms are split into tetrahedral volume elements we ran experiments on four different meshes with different values prescribed for the minimum water column thickness the prescribed values range between 20 m and 200 m we chose the upper bound of 200 m because it was used in early fesom cavity configurations e g timmermann et al 2012 timmermann and hellmer 2013 nakayama et al 2014 and hence can act as an estimate for the error in these former runs we chose the lower bound of 20 m as it was the lowest value leading to numerically stable simulations see discussion of haney 1991 below for all purposes in this work we assume the 20 m mesh to be the correct representation of ice shelf and bedrock topographies and the simulation on it serves as control experiment against which simulations on other meshes representations are tested we discuss the validity of these assumptions later on all meshes were created from the 1 min version of rtopo 2 schaffer et al 2016 we use a surface mesh similar to the configuration used by timmermann et al 2012 it has a horizontal resolution of 4 km under the smaller ice shelves in the amundsen and bellinghausen seas a resolution of 7 km under the larger ice shelves in the ross and weddell seas 10 km along the antarctic coastline 30 to 40 km in the offshore southern ocean and up to 250 300 km in the deep basins of the atlantic and pacific oceans topography is smoothed using a gaussian smoothing function with a radius varying with horizontal mesh resolution a crucial step in terrain following mesh generation is the smoothing of the ice shelf base which is necessary to avoid numerical issues resulting from strongly sloping vertical coordinate levels haney 1991 smoothing of the ice shelf base avoids these issues but introduces an artificial distortion to the topography of the ice shelf this is most obvious at the ice shelf front where a vertical wall is transformed into a ramp but similar though less obvious modifications can result from smoothing at other locations to represent ice base topography as faithfully as possible smoothing should be limited to the minimum amount that leads to a numerically stable mesh the maximum tolerable slope depends on the resolution of the mesh and the distance between layers which depends on the number of layers and the water column thickness in the fesom mesh generation machinery smoothing of the ice shelf base is done iteratively until the haney number haney 1991 reaches a value below four everywhere smoothing for all four meshes was done with identical parameters derived from the mesh generation of the 20 m mesh the ice base topography is hence identical in all four cases the four meshes only differ in the enforced wct beneath fris and use constant values for minimum wct elsewhere the minimum wct values are 20 m 50 m 100 m and 200 m beneath fris 50 m for the other weddell sea ice shelves and 100 m for the remaining sigma coordinate region these values are enforced by lowering the bedrock where necessary while keeping the ice shelf base unchanged we refer to these four different meshes as wct20 mesh wct50 mesh wct100 mesh and wct200 mesh respectively the ocean was initialized with salinity and temperature data from the 2001 version of the world ocean atlas below the ice shelf the freezing temperature is calculated for each node at the ice shelf base and then prescribed as an initial temperature for the entire water column below it initial salinity within the cavities is obtained from the nearest open water mesh node at the same depth the fesom runs use the hadley center climate model data set for the 20th century hadcm 20c gordon et al 2000 as atmospheric forcing from which bulk fluxes are calculated no runoff or tidal data was used a spin up phase over ten years 1980 1989 was followed by a data collection phase of another ten years 1990 1999 the model was run using a time step of 90 s 3 cavity geometries given that water column thickness in our reference mesh is smaller than in the setup used by timmermann et al 2012 we had to apply a stronger smoothing to the ice shelf draft to ensure that the haney number remains below four the resulting difference in ice shelf draft has been calculated by subtracting the draft of the wct20 mesh from the draft of the original timmermann mesh and is shown in fig 1 as all four meshes were smoothed identically and hence have the same ice shelf draft this plot is representative for the other meshes as well note that we use an upward pointing z axis which is centered at the sea surface so that ice shelf drafts and bedrock depths are always negative within the ocean ice draft smoothing during the fesom mesh generation limits the ice base slope starting from the ice shelf front turning the vertical front into a gentle ramp and then moving towards increasing ice thickness stronger smoothing as required to obtain a stable wct20 run thus leads to shallower ice draft near the ice shelf front differences reach up to 250 m near the ice shelf front east of berkner island and to even higher values in some pockets near the grounding line in contrast there are only a few locations where the base of the ice shelf has become deeper and never more than 35 m deeper these changes in ice shelf draft do not necessarily correspond to changes in water column thickness note that some of the difference shown in fig 1 also results from the difference between rtopo 1 timmermann et al 2010 and rtopo 2 for ice shelf draft however the difference between the two topography data sets is much smaller than the effect of enhanced smoothing and also shows a very different pattern fig 2 shows the water column thickness of the wct200 mesh subtracted from the water column thickness of the wct20 mesh as the ice shelf draft is identical for all four meshes these changes in wct correspond to the changes in the bedrock depth hence fig 2 is equivalent to the difference in bedrock depth but with opposing sign the most significant changes are found near the grounding line around berkner island and between the henry and korff ice rises the difference reaches values up to 180 m where initial wct was very low and the enforcement of a 200 m minimum wct had a big influence on the topography in areas further away from the grounding lines and especially along the ice shelf front no differences occur an investigation of the water mass characteristics along the ice shelf front shows no significant changes between the different meshes in this study sections along the filchner and ronne fronts show differences of less than 0 02 c in temperature 0 02 psu in salinity and 0 005 m s in velocity hence variations in the volume and heat transport into the cavity between the different meshes are negligible so that changes in sub ice shelf melt rate can be safely attributed to altered processes within the cavity 4 results 4 1 melt rate distribution the pattern of melting and freezing under fris in our reference simulation with the wct20 mesh is given in fig 3 the highest melt rates about 3 m yr occur near the deep grounding lines which is consistent with the observation based basal mass budget of moholdt et al 2014 in contrast to their melt rate distribution the model also suggests high melt rates above the central part of filchner trough which may point towards the modeled shelf water inflow through filchner trough being too strong compared to fig 10b in moholdt et al 2014 the melt rate maxima near the grounding lines of recovery glacier and the foundation and rutford ice streams are less pronounced instead our wct20 run suggests wider areas of increased melting freezing rates are generally smaller in both the model and the observations while refreezing near the henry and korff ice rises is consistently found in the model and the observations the two data sets disagree about the occurrence of freezing or melting in several other areas fig 4 shows the difference in melt rate wct200 mesh minus wct20 mesh resulting from a minimum wct of 200 m instead of 20 m despite the fact that modifications to bathymetry are applied only locally the pattern of modified melting spreads over the entire ice shelf over large areas especially west of berkner island these changes are quite small remaining below 0 025 m yr or roughly 20 of the original value compared to the wct20 run the wct200 run yields melt rates more concentrated to the immediate vicinity of the grounding line this improves the representation of melting for the rutford and foundation ice streams but the melt intensification near the grounding line of support force glacier is a feature that is not found in the moholdt et al 2014 distributions the strongest changes in basal melt rates reach values of up to 1 1 m yr around the south of berkner island and 1 m yr under the carlson and slessor ice streams which corresponds to changes of up to 900 these regions coincide with the areas of strong wct alteration see fig 2 indicating the strong influence which the choice of minimum water column thickness has on melt rates near the grounding lines to investigate the mechanisms that govern this sensitivity we will look into two of these strongly affected areas now 4 2 carlson ice stream first an example of increased melting is the carlson ice stream which is situated in the west of fris as is indicated on the inset maps in fig 5 the bedrock topography over the first 82 km from the grounding line is completely controlled by the wct enforcement algorithm for both cases the slope of the bedrock is identical to the slope of the ice shelf base as a result of enforcing a minimum distance between them the thin opening near transect kilometer 82 through which water can enter the area near the grounding line deepens in the wct200 mesh allowing for a stronger water exchange with the surrounding warmer waters this leads to an increase in temperature near the grounding line from 2 8 c to 2 55 c fig 5 top accompanied by a salinity increase from 33 8 to 34 4 fig 5 bottom and an increase in melt rate from below 0 1 m yr to nearly 1 m yr to illustrate the increased exchange rate of water in the region of increased wct along transect velocities are shown in fig 6 where negative values for velocity indicate a flow towards the grounding line for the wct20 mesh a flow towards the grounding line can be found near the bottom in the thicker water column between kilometers 82 and 130 but it does not extend into the thinner area where ice shelf draft is deepest in contrast for the wct200 mesh the lowering of the bedrock widens this thin opening and thus creates a continuous pathway towards the grounding line as a consequence the flow towards the grounding line which is little more than 0 005 m s over most of the area reaches a maximum value above 0 015 m s at the opening naturally a flow of similar velocity and volume leaves the grounding zone along the ice shelf base put together this means a significant increase in water mass exchange between the grounding zone and its surroundings which leads to a substantial increase of melt rates in the area close to the grounding line as can be seen in fig 7 the average melt rate over the first 82 km of the transect increases from 0 12 m yr to 0 65 m yr it is important to note that in exchange for the melt rate increase near the grounding line there is a significant decrease in average melt rate between kilometers 82 and 188 from 0 38 m yr to 0 30 m yr this supports our interpretation that more warm water flows towards the grounding line in the 200 m mesh releasing its heat there therefore less heat is available for melting further north where the warm water was formerly blocked by the very thin opening towards the grounding line we will see later that this compensation between areas of increased and decreased melt rates is a typical feature in this system although the long thin and narrow tunnel towards the grounding line as seen in the wct20 mesh is consistent with rtopo 2 it is probably not a perfect representation of the true topography padman et al 2018 in any case this situation nicely demonstrates the effect of an artificially increased water column thickness in an extensive grounding zone 4 3 slessor ice stream another mechanism for increased melting can be demonstrated by the sensitivity at slessor ice stream fig 8 as in the previous case the modification of bottom topography creates a thicker water column below the ice shelf base near the grounding line and a larger area over which exchange with surrounding waters can happen in addition to this fig 8 also shows the introduction of a slope in sea floor topography between kilometers 150 and 230 a plateau exists for the wct20 mesh in the wct200 mesh it is replaced by a strong slope reflecting the topography of the ice shelf base this slope acts to direct water masses that are dense warm and salty towards the grounding line as a result the 2 1 c isotherm and the 34 45 psu isoline in the wct200 mesh extend all the way to the grounding line whereas they are restricted to the plateau in the wct20 mesh so that no water warmer than 2 1 c and saltier than 34 45 psu enters the area of low wct the salinity increase for the wct200 mesh occurs despite the locally increased melting of 1 6 m yr where it was 1 1 m yr in the wct20 mesh experiment averaged between kilometers 208 and 254 melt rate increases from 0 79 m yr to 1 10 m yr looking at the velocities presented in fig 9 we see that the velocity towards the grounding line actually decreases for the wct200 mesh however as the area over which this lower velocity is maintained is much larger than before this still leads to an increased volume flux and thus heat transport towards the grounding line combined with the increased distance between the ice shelf base and the warm dense water mass near the bottom this also leads to a decreased average melt rate between transect kilometers 120 and 208 from 0 52 m yr in the wct20 mesh to 0 45 m yr as can be seen in fig 10 another decrease in melt rate can be found in the area with increased wct at the western end of the section this is caused by a decrease in the velocity of the water passing through the transect as a consequence of the newly generated area produced by lowering the bedrock near berkner island assuming a constant volume flux through the transect the bigger area allows for a lower velocity through the velocity dependent parameterization of turbulent heat and salt fluxes in the sub ice ocean this leads to a smaller melt rate the assumption of a constant volume flux is reasoned by the fact that water mass transport through the transect is mainly controlled by large scale circulation patterns within the cavity which are not affected by the relatively small changes in wct outside the shallow grounding line areas 4 4 area integrated basal mass loss area integrated basal mass loss is given in table 1 for all four experiments the differences in total melt fluxes are not significant reaching a maximum of 2 51 gt yr between the minimum and maximum values or roughly 2 75 of the minimum value the numbers also do not show any systematic increase or decrease with increasing wct note that the values given in table 1 agree well with previous fesom runs which found a total basal melt flux of 90 gt yr timmermann and hellmer 2013 despite the differences in the ice draft smoothing applied this melt flux is well within the range of independent model or observation based estimates of e g 83 4 24 8 gt yr joughin and padman 2003 155 4 45 gt yr rignot et al 2013 80 30 gt yr foldvik et al 2001 or 82 gt yr hellmer et al 2012 5 discussion and conclusions for this study we have run the fesom model on four meshes with different values for the minimum water column thickness below filchner ronne ice shelf the resulting melt rate distribution and total melt rate were investigated and the mechanisms leading to melt rate changes were analyzed we found that total melt rate is largely insensitive to changes in the minimum wct on a local scale however the enforcement of a larger minimum wct leads to a redistribution of melting and freezing typically an artificially increased wct leads to a spurious concentration of simulated basal melt rates in the vicinity of the grounding line due to an increased accessibility of the ice shelf base to relatively warm and salty water masses while the study was conducted with a finite element model results are not specific to finite elements or more generally to unstructured grid models instead we expect our findings to apply to any ocean general circulation model using a terrain following vertical coordinate with a constant number of layers however given that finite difference models tend to tolerate higher values for the haney number gradually introducing pressure gradient errors but still running with stable numerics the issue of topography smoothing may be more severe for models using the finite element approach although not part of this study we expect similar results to be obtained by ocean models employing z level vertical coordinates however the implementation of low values for wct might be challenging for different reasons in these models in order to fit a number of nodes between any point of the ice shelf base and the bedrock that is large enough to facilitate realistic and numerically stable simulations vertical resolution has to be sufficiently high for all depths in which shallow grounding zones occur for shallow grounding zones in various depths this can lead to a significantly higher number of z levels for the whole mesh the resulting increase in the number of nodes might increase the computational effort beyond what is realistically feasible results in this study were obtained for filchner ronne ice shelf which is the largest ice shelf by volume and of great significance to water mass transformation in the southern ocean but obviously not the only ice shelf that deserves an appropriate representation in general circulation models we expect that the characteristic feature of our results namely a redistribution of melt rate patterns without affecting the total melt rate will hold true for the other large cold water ice shelf the ross ice shelf for both ice shelves any heat content supplied from the open ocean will be converted into melting ice for a constant supply of heat an increased melt in one location is bound to be compensated by reduced melt somewhere else so that total melt rate remains unchanged for the smaller warm water ice shelves of the amundsen and bellingshausen seas the melt potential of cavity water is not fully exploited so that an increased melt in one area is not necessarily compensated by reduced melt somewhere else we therefore expect an increase of total melt as a response to an artificially enlarged water column thickness in this case but a quantitative assessment will have to be deferred to a later study previous research has shown that tides play an important role for melting under fris e g mueller et al 2018 increasing the amplitude of the melt freeze pattern their omission in fesom like in most global ocean general circulation models is therefore likely to contribute to the lack of focus in basal melt rates for e g recovery glacier and the foundation and rutford ice streams in our wct20 reference simulation this deficiency is partly cured by artificially increasing water column thickness but given that this step also introduces spuriously high melt rates at support force glacier it would be misleading to conclude that an artificially increased wct is an appropriate way to correct for biases caused by e g missing tides note that the regions found to be particularly sensitive to artificial changes of water column thickness in this study are shallow inlets under deep drafted ice shelfs i e regions not prone to high tidal velocities see e g fig 3 in mueller et al 2018 in these cases the inclusion of tides is not likely to alter the models response to an artificially increased water column thickness in a qualitative way for the shallow passage south of korff ice rise however where water column thickness is small and tidal currents are strong mueller et al 2018 find decreasing tidal velocities for an increased water column thickness and consequently reduced melting at the margins of the floating ice in this area although wct changes in their case were imposed by a modified ice draft representing a potential future situation with thinner ice the contrasting behavior in case of a narrow passage with strong tidal currents as opposed to dead ended inlets with small tidal currents still indicates that the effect of tides adds further complexity to the problem in models with a terrain following coordinate an adequate representation of shallow grounding zones obtained by allowing very small water column thicknesses comes with a clear trade off for a given horizontal resolution a smaller wct may require a stronger smoothing of the ice shelf draft to keep the haney number within acceptable limits thereby reducing the ice base slope for resolutions on the order of a few km this may distort the ice shelf base substantially and may even affect the representation of maximum ice thickness in the deepest parts of the cavity a higher value for the minimum water column thickness on the other hand is shown here to increase melting near the grounding lines thereby possibly exposing more of the ice shelf base to warm water whether this eventually affects potential grounding line retreat in a warming climate remains to be investigated in a coupled model but our results suggest that the risk should not a priori be ignored for oceanographers who are mainly interested in the total melt water flux enforcing a high minimum water column thickness with little distortion of the ice shelf base even for relatively coarse horizontal meshes will be an appropriate choice in many cases total melt rates and the resulting freshwater flux to the ocean are robust results and show little sensitivity to the representation of shallow water columns at least for the large cold water ice shelf assessed in this study for the simulation of processes near the grounding line and a coupling of ocean and ice sheet models however a correct representation of areas with a shallow water column thickness helps to minimize the risk of a spurious grounding line retreat in ocean climate warming scenarios given that reducing the haney number by increasing horizontal resolution appears to be the most straightforward way to minimize the distortion of the ice shelf by smoothing this implies that coupled ice shelf ocean models with a terrain following vertical coordinate in ice shelf cavities benefit from a fine horizontal resolution not only in the vicinity of the grounding line but also in other regions with a shallow water column or a steeply sloping ice base declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the simulations were performed with resources provided by the north german supercomputing alliance hlrn this study was supported by funding from the helmholtz climate initiative reklim regional climate change germany a joint research project of the helmholtz association of german research centres hgf helpful comments from xylar asay davis and an anonymous reviewer are gratefully acknowledged 
24002,numerical modeling shows great potential as a method for investigating and predicting the future development of ice shelves in a warming climate the quality of ice shelf ocean models is continuously improving but some limitations remain for models using a terrain following vertical coordinate one such limitation is the enforcement of a minimum water column thickness beneath ice shelves by adjustment of bottom topography how this local distortion of bathymetry from reality affects modeled melt rates and cavity circulation is unknown so far to quantify this effect simulations with the finite element sea ice ice shelf ocean model fesom were executed on four different grids with minimum water column thicknesses of 20 m 50 m 100 m and 200 m while we use a global model grid modifications of bathymetry are applied only to filchner ronne ice shelf we show that the choice of minimum water column thickness does not affect the total basal melt rate of this cold water ice shelf but does in fact impact the distribution of melt rates with significant differences between experiments in the magnitude of melting near the grounding lines keywords fesom ice shelf geometry water column thickness basal melting filchner ronne ice shelf 1 introduction the filchner ronne ice shelf fris in the weddell sea antarctica plays an important role in ice and ocean dynamics by buttressing the ice streams that drain the continental ice sheet it reduces the flow of grounded ice towards the ocean fürst et al 2016 its importance for large scale hydrography and the global thermohaline circulation arises from the production of ice shelf water isw a water mass with a temperature below the surface freezing point which mixes with modified warm deep water mwdw to form weddell sea bottom water wsbw to predict the future evolution of the ice shelves in a warming climate numerical models are employed one of these models is the finite element sea ice ice shelf ocean model fesom which features an unstructured surface mesh and a hybrid vertical coordinate with sigma coordinates around antarctica and z coordinates everywhere else danilov et al 2004 wang et al 2014 timmermann et al 2012 like other models with a terrain following vertical coordinate e g mueller et al 2018 fesom requires a nonzero minimum water column thickness wct to ensure computational efficiency and stability this minimum wct is ensured by lowering the bedrock beneath the ice shelf base where necessary thereby changing the bedrock topography especially in shallow areas near grounding lines these changes may potentially influence the simulated melt rates significantly in order to investigate the sensitivity of the model to alterations in the grounding zone geometry a series of model runs with different bathymetries was executed a set of four different meshes was created each with a different prescribed value for the minimum wct the most affected areas were identified and analyzed according to key oceanographic properties like temperature and salinity and the basal melt rate of the ice shelf the area weighted total melt rate for the fris was also calculated this paper briefly describes the fesom setup and discusses the relevant steps of the mesh generation process the different meshes are compared and the melt rate distribution is analyzed possible mechanisms explaining the changes in melt rates are presented afterwards before investigating the effect on area integrated basal mass loss 2 method fesom the model employed for our investigation solves the hydrostatic primitive equations for the ocean the thermodynamic equations for the interaction between the ocean and ice shelves and dynamic and thermodynamic equations for sea ice the use of terrain following coordinates around antarctica ensures a constant number of 22 levels beneath the ice shelves and a smooth representation of bedrock and ice shelf topography and their slopes the unstructured horizontal mesh allows for increased resolution in areas of interest the surface mesh consists of triangular elements which are extended toward the bottom to form prisms these prisms are split into tetrahedral volume elements we ran experiments on four different meshes with different values prescribed for the minimum water column thickness the prescribed values range between 20 m and 200 m we chose the upper bound of 200 m because it was used in early fesom cavity configurations e g timmermann et al 2012 timmermann and hellmer 2013 nakayama et al 2014 and hence can act as an estimate for the error in these former runs we chose the lower bound of 20 m as it was the lowest value leading to numerically stable simulations see discussion of haney 1991 below for all purposes in this work we assume the 20 m mesh to be the correct representation of ice shelf and bedrock topographies and the simulation on it serves as control experiment against which simulations on other meshes representations are tested we discuss the validity of these assumptions later on all meshes were created from the 1 min version of rtopo 2 schaffer et al 2016 we use a surface mesh similar to the configuration used by timmermann et al 2012 it has a horizontal resolution of 4 km under the smaller ice shelves in the amundsen and bellinghausen seas a resolution of 7 km under the larger ice shelves in the ross and weddell seas 10 km along the antarctic coastline 30 to 40 km in the offshore southern ocean and up to 250 300 km in the deep basins of the atlantic and pacific oceans topography is smoothed using a gaussian smoothing function with a radius varying with horizontal mesh resolution a crucial step in terrain following mesh generation is the smoothing of the ice shelf base which is necessary to avoid numerical issues resulting from strongly sloping vertical coordinate levels haney 1991 smoothing of the ice shelf base avoids these issues but introduces an artificial distortion to the topography of the ice shelf this is most obvious at the ice shelf front where a vertical wall is transformed into a ramp but similar though less obvious modifications can result from smoothing at other locations to represent ice base topography as faithfully as possible smoothing should be limited to the minimum amount that leads to a numerically stable mesh the maximum tolerable slope depends on the resolution of the mesh and the distance between layers which depends on the number of layers and the water column thickness in the fesom mesh generation machinery smoothing of the ice shelf base is done iteratively until the haney number haney 1991 reaches a value below four everywhere smoothing for all four meshes was done with identical parameters derived from the mesh generation of the 20 m mesh the ice base topography is hence identical in all four cases the four meshes only differ in the enforced wct beneath fris and use constant values for minimum wct elsewhere the minimum wct values are 20 m 50 m 100 m and 200 m beneath fris 50 m for the other weddell sea ice shelves and 100 m for the remaining sigma coordinate region these values are enforced by lowering the bedrock where necessary while keeping the ice shelf base unchanged we refer to these four different meshes as wct20 mesh wct50 mesh wct100 mesh and wct200 mesh respectively the ocean was initialized with salinity and temperature data from the 2001 version of the world ocean atlas below the ice shelf the freezing temperature is calculated for each node at the ice shelf base and then prescribed as an initial temperature for the entire water column below it initial salinity within the cavities is obtained from the nearest open water mesh node at the same depth the fesom runs use the hadley center climate model data set for the 20th century hadcm 20c gordon et al 2000 as atmospheric forcing from which bulk fluxes are calculated no runoff or tidal data was used a spin up phase over ten years 1980 1989 was followed by a data collection phase of another ten years 1990 1999 the model was run using a time step of 90 s 3 cavity geometries given that water column thickness in our reference mesh is smaller than in the setup used by timmermann et al 2012 we had to apply a stronger smoothing to the ice shelf draft to ensure that the haney number remains below four the resulting difference in ice shelf draft has been calculated by subtracting the draft of the wct20 mesh from the draft of the original timmermann mesh and is shown in fig 1 as all four meshes were smoothed identically and hence have the same ice shelf draft this plot is representative for the other meshes as well note that we use an upward pointing z axis which is centered at the sea surface so that ice shelf drafts and bedrock depths are always negative within the ocean ice draft smoothing during the fesom mesh generation limits the ice base slope starting from the ice shelf front turning the vertical front into a gentle ramp and then moving towards increasing ice thickness stronger smoothing as required to obtain a stable wct20 run thus leads to shallower ice draft near the ice shelf front differences reach up to 250 m near the ice shelf front east of berkner island and to even higher values in some pockets near the grounding line in contrast there are only a few locations where the base of the ice shelf has become deeper and never more than 35 m deeper these changes in ice shelf draft do not necessarily correspond to changes in water column thickness note that some of the difference shown in fig 1 also results from the difference between rtopo 1 timmermann et al 2010 and rtopo 2 for ice shelf draft however the difference between the two topography data sets is much smaller than the effect of enhanced smoothing and also shows a very different pattern fig 2 shows the water column thickness of the wct200 mesh subtracted from the water column thickness of the wct20 mesh as the ice shelf draft is identical for all four meshes these changes in wct correspond to the changes in the bedrock depth hence fig 2 is equivalent to the difference in bedrock depth but with opposing sign the most significant changes are found near the grounding line around berkner island and between the henry and korff ice rises the difference reaches values up to 180 m where initial wct was very low and the enforcement of a 200 m minimum wct had a big influence on the topography in areas further away from the grounding lines and especially along the ice shelf front no differences occur an investigation of the water mass characteristics along the ice shelf front shows no significant changes between the different meshes in this study sections along the filchner and ronne fronts show differences of less than 0 02 c in temperature 0 02 psu in salinity and 0 005 m s in velocity hence variations in the volume and heat transport into the cavity between the different meshes are negligible so that changes in sub ice shelf melt rate can be safely attributed to altered processes within the cavity 4 results 4 1 melt rate distribution the pattern of melting and freezing under fris in our reference simulation with the wct20 mesh is given in fig 3 the highest melt rates about 3 m yr occur near the deep grounding lines which is consistent with the observation based basal mass budget of moholdt et al 2014 in contrast to their melt rate distribution the model also suggests high melt rates above the central part of filchner trough which may point towards the modeled shelf water inflow through filchner trough being too strong compared to fig 10b in moholdt et al 2014 the melt rate maxima near the grounding lines of recovery glacier and the foundation and rutford ice streams are less pronounced instead our wct20 run suggests wider areas of increased melting freezing rates are generally smaller in both the model and the observations while refreezing near the henry and korff ice rises is consistently found in the model and the observations the two data sets disagree about the occurrence of freezing or melting in several other areas fig 4 shows the difference in melt rate wct200 mesh minus wct20 mesh resulting from a minimum wct of 200 m instead of 20 m despite the fact that modifications to bathymetry are applied only locally the pattern of modified melting spreads over the entire ice shelf over large areas especially west of berkner island these changes are quite small remaining below 0 025 m yr or roughly 20 of the original value compared to the wct20 run the wct200 run yields melt rates more concentrated to the immediate vicinity of the grounding line this improves the representation of melting for the rutford and foundation ice streams but the melt intensification near the grounding line of support force glacier is a feature that is not found in the moholdt et al 2014 distributions the strongest changes in basal melt rates reach values of up to 1 1 m yr around the south of berkner island and 1 m yr under the carlson and slessor ice streams which corresponds to changes of up to 900 these regions coincide with the areas of strong wct alteration see fig 2 indicating the strong influence which the choice of minimum water column thickness has on melt rates near the grounding lines to investigate the mechanisms that govern this sensitivity we will look into two of these strongly affected areas now 4 2 carlson ice stream first an example of increased melting is the carlson ice stream which is situated in the west of fris as is indicated on the inset maps in fig 5 the bedrock topography over the first 82 km from the grounding line is completely controlled by the wct enforcement algorithm for both cases the slope of the bedrock is identical to the slope of the ice shelf base as a result of enforcing a minimum distance between them the thin opening near transect kilometer 82 through which water can enter the area near the grounding line deepens in the wct200 mesh allowing for a stronger water exchange with the surrounding warmer waters this leads to an increase in temperature near the grounding line from 2 8 c to 2 55 c fig 5 top accompanied by a salinity increase from 33 8 to 34 4 fig 5 bottom and an increase in melt rate from below 0 1 m yr to nearly 1 m yr to illustrate the increased exchange rate of water in the region of increased wct along transect velocities are shown in fig 6 where negative values for velocity indicate a flow towards the grounding line for the wct20 mesh a flow towards the grounding line can be found near the bottom in the thicker water column between kilometers 82 and 130 but it does not extend into the thinner area where ice shelf draft is deepest in contrast for the wct200 mesh the lowering of the bedrock widens this thin opening and thus creates a continuous pathway towards the grounding line as a consequence the flow towards the grounding line which is little more than 0 005 m s over most of the area reaches a maximum value above 0 015 m s at the opening naturally a flow of similar velocity and volume leaves the grounding zone along the ice shelf base put together this means a significant increase in water mass exchange between the grounding zone and its surroundings which leads to a substantial increase of melt rates in the area close to the grounding line as can be seen in fig 7 the average melt rate over the first 82 km of the transect increases from 0 12 m yr to 0 65 m yr it is important to note that in exchange for the melt rate increase near the grounding line there is a significant decrease in average melt rate between kilometers 82 and 188 from 0 38 m yr to 0 30 m yr this supports our interpretation that more warm water flows towards the grounding line in the 200 m mesh releasing its heat there therefore less heat is available for melting further north where the warm water was formerly blocked by the very thin opening towards the grounding line we will see later that this compensation between areas of increased and decreased melt rates is a typical feature in this system although the long thin and narrow tunnel towards the grounding line as seen in the wct20 mesh is consistent with rtopo 2 it is probably not a perfect representation of the true topography padman et al 2018 in any case this situation nicely demonstrates the effect of an artificially increased water column thickness in an extensive grounding zone 4 3 slessor ice stream another mechanism for increased melting can be demonstrated by the sensitivity at slessor ice stream fig 8 as in the previous case the modification of bottom topography creates a thicker water column below the ice shelf base near the grounding line and a larger area over which exchange with surrounding waters can happen in addition to this fig 8 also shows the introduction of a slope in sea floor topography between kilometers 150 and 230 a plateau exists for the wct20 mesh in the wct200 mesh it is replaced by a strong slope reflecting the topography of the ice shelf base this slope acts to direct water masses that are dense warm and salty towards the grounding line as a result the 2 1 c isotherm and the 34 45 psu isoline in the wct200 mesh extend all the way to the grounding line whereas they are restricted to the plateau in the wct20 mesh so that no water warmer than 2 1 c and saltier than 34 45 psu enters the area of low wct the salinity increase for the wct200 mesh occurs despite the locally increased melting of 1 6 m yr where it was 1 1 m yr in the wct20 mesh experiment averaged between kilometers 208 and 254 melt rate increases from 0 79 m yr to 1 10 m yr looking at the velocities presented in fig 9 we see that the velocity towards the grounding line actually decreases for the wct200 mesh however as the area over which this lower velocity is maintained is much larger than before this still leads to an increased volume flux and thus heat transport towards the grounding line combined with the increased distance between the ice shelf base and the warm dense water mass near the bottom this also leads to a decreased average melt rate between transect kilometers 120 and 208 from 0 52 m yr in the wct20 mesh to 0 45 m yr as can be seen in fig 10 another decrease in melt rate can be found in the area with increased wct at the western end of the section this is caused by a decrease in the velocity of the water passing through the transect as a consequence of the newly generated area produced by lowering the bedrock near berkner island assuming a constant volume flux through the transect the bigger area allows for a lower velocity through the velocity dependent parameterization of turbulent heat and salt fluxes in the sub ice ocean this leads to a smaller melt rate the assumption of a constant volume flux is reasoned by the fact that water mass transport through the transect is mainly controlled by large scale circulation patterns within the cavity which are not affected by the relatively small changes in wct outside the shallow grounding line areas 4 4 area integrated basal mass loss area integrated basal mass loss is given in table 1 for all four experiments the differences in total melt fluxes are not significant reaching a maximum of 2 51 gt yr between the minimum and maximum values or roughly 2 75 of the minimum value the numbers also do not show any systematic increase or decrease with increasing wct note that the values given in table 1 agree well with previous fesom runs which found a total basal melt flux of 90 gt yr timmermann and hellmer 2013 despite the differences in the ice draft smoothing applied this melt flux is well within the range of independent model or observation based estimates of e g 83 4 24 8 gt yr joughin and padman 2003 155 4 45 gt yr rignot et al 2013 80 30 gt yr foldvik et al 2001 or 82 gt yr hellmer et al 2012 5 discussion and conclusions for this study we have run the fesom model on four meshes with different values for the minimum water column thickness below filchner ronne ice shelf the resulting melt rate distribution and total melt rate were investigated and the mechanisms leading to melt rate changes were analyzed we found that total melt rate is largely insensitive to changes in the minimum wct on a local scale however the enforcement of a larger minimum wct leads to a redistribution of melting and freezing typically an artificially increased wct leads to a spurious concentration of simulated basal melt rates in the vicinity of the grounding line due to an increased accessibility of the ice shelf base to relatively warm and salty water masses while the study was conducted with a finite element model results are not specific to finite elements or more generally to unstructured grid models instead we expect our findings to apply to any ocean general circulation model using a terrain following vertical coordinate with a constant number of layers however given that finite difference models tend to tolerate higher values for the haney number gradually introducing pressure gradient errors but still running with stable numerics the issue of topography smoothing may be more severe for models using the finite element approach although not part of this study we expect similar results to be obtained by ocean models employing z level vertical coordinates however the implementation of low values for wct might be challenging for different reasons in these models in order to fit a number of nodes between any point of the ice shelf base and the bedrock that is large enough to facilitate realistic and numerically stable simulations vertical resolution has to be sufficiently high for all depths in which shallow grounding zones occur for shallow grounding zones in various depths this can lead to a significantly higher number of z levels for the whole mesh the resulting increase in the number of nodes might increase the computational effort beyond what is realistically feasible results in this study were obtained for filchner ronne ice shelf which is the largest ice shelf by volume and of great significance to water mass transformation in the southern ocean but obviously not the only ice shelf that deserves an appropriate representation in general circulation models we expect that the characteristic feature of our results namely a redistribution of melt rate patterns without affecting the total melt rate will hold true for the other large cold water ice shelf the ross ice shelf for both ice shelves any heat content supplied from the open ocean will be converted into melting ice for a constant supply of heat an increased melt in one location is bound to be compensated by reduced melt somewhere else so that total melt rate remains unchanged for the smaller warm water ice shelves of the amundsen and bellingshausen seas the melt potential of cavity water is not fully exploited so that an increased melt in one area is not necessarily compensated by reduced melt somewhere else we therefore expect an increase of total melt as a response to an artificially enlarged water column thickness in this case but a quantitative assessment will have to be deferred to a later study previous research has shown that tides play an important role for melting under fris e g mueller et al 2018 increasing the amplitude of the melt freeze pattern their omission in fesom like in most global ocean general circulation models is therefore likely to contribute to the lack of focus in basal melt rates for e g recovery glacier and the foundation and rutford ice streams in our wct20 reference simulation this deficiency is partly cured by artificially increasing water column thickness but given that this step also introduces spuriously high melt rates at support force glacier it would be misleading to conclude that an artificially increased wct is an appropriate way to correct for biases caused by e g missing tides note that the regions found to be particularly sensitive to artificial changes of water column thickness in this study are shallow inlets under deep drafted ice shelfs i e regions not prone to high tidal velocities see e g fig 3 in mueller et al 2018 in these cases the inclusion of tides is not likely to alter the models response to an artificially increased water column thickness in a qualitative way for the shallow passage south of korff ice rise however where water column thickness is small and tidal currents are strong mueller et al 2018 find decreasing tidal velocities for an increased water column thickness and consequently reduced melting at the margins of the floating ice in this area although wct changes in their case were imposed by a modified ice draft representing a potential future situation with thinner ice the contrasting behavior in case of a narrow passage with strong tidal currents as opposed to dead ended inlets with small tidal currents still indicates that the effect of tides adds further complexity to the problem in models with a terrain following coordinate an adequate representation of shallow grounding zones obtained by allowing very small water column thicknesses comes with a clear trade off for a given horizontal resolution a smaller wct may require a stronger smoothing of the ice shelf draft to keep the haney number within acceptable limits thereby reducing the ice base slope for resolutions on the order of a few km this may distort the ice shelf base substantially and may even affect the representation of maximum ice thickness in the deepest parts of the cavity a higher value for the minimum water column thickness on the other hand is shown here to increase melting near the grounding lines thereby possibly exposing more of the ice shelf base to warm water whether this eventually affects potential grounding line retreat in a warming climate remains to be investigated in a coupled model but our results suggest that the risk should not a priori be ignored for oceanographers who are mainly interested in the total melt water flux enforcing a high minimum water column thickness with little distortion of the ice shelf base even for relatively coarse horizontal meshes will be an appropriate choice in many cases total melt rates and the resulting freshwater flux to the ocean are robust results and show little sensitivity to the representation of shallow water columns at least for the large cold water ice shelf assessed in this study for the simulation of processes near the grounding line and a coupling of ocean and ice sheet models however a correct representation of areas with a shallow water column thickness helps to minimize the risk of a spurious grounding line retreat in ocean climate warming scenarios given that reducing the haney number by increasing horizontal resolution appears to be the most straightforward way to minimize the distortion of the ice shelf by smoothing this implies that coupled ice shelf ocean models with a terrain following vertical coordinate in ice shelf cavities benefit from a fine horizontal resolution not only in the vicinity of the grounding line but also in other regions with a shallow water column or a steeply sloping ice base declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the simulations were performed with resources provided by the north german supercomputing alliance hlrn this study was supported by funding from the helmholtz climate initiative reklim regional climate change germany a joint research project of the helmholtz association of german research centres hgf helpful comments from xylar asay davis and an anonymous reviewer are gratefully acknowledged 
24003,this paper presents two semi implicit nonhydrostatic models to simulate surface water waves both models utilize the pressure correction method to solve three dimensional 3d incompressible navier stokes equations nses but one is a noniterative model and the other is associated with iterating to solve the poisson equation for pressure correction terms to meet the high computational demands the poisson equation is solved on the graphics processing unit gpu in conjunction with the conjugate gradient method both the accuracy in resolving the linear dispersion relation and the serially implemented efficiency of the models are assessed and discussed then both models are validated with several test cases ranging from shallow to deep water the results of the two models are very similar and show good agreement with experimental data in the shallow water test cases the accuracy of both models are also evaluated in deep water nonlinear sloshing waves and 2d 3d focusing waves in addition the acceleration due to gpu parallelization is evaluated in a final 3d test case keywords nonhydrostatic model semi implicit three dimensional wave model gpu computing 1 introduction over the past two decades nonhydrostatic models have attracted increased attention because of their accuracy and efficiency in coastal and ocean applications nonhydrostatic models are developed based upon incompressible navier stokes equations nses and are capable of resolving surface water waves ai et al 2014 ai and jin 2010 2012 ai et al 2011 anthonio and hall 2006 bradford 2005 ma et al 2012 stelling and zijlema 2003 wu et al 2010 young and wu 2010a b young et al 2007 yuan and wu 2004 zijlema and stelling 2005 and internal waves fringer et al 2006 lai et al 2010 vitousek and fringer 2011 2014 in such models the free surface is defined as a single value function of the horizontal position and thus can be determined by the so called free surface equation which is obtained by integrating the continuity equation over the water depth and applying kinematic free surface and bottom conditions because they do not need to capture the free surface by using a large number of vertical grids nonhydrostatic models are computationally more efficient than other nse based numerical models e g vof models higuera et al 2013 or level set models chen and yu 2009 involving complicated free surface flows in the development of nonhydrostatic models one of the main issues is the precise implementation of a homogeneous dirichlet boundary condition for the nonhydrostatic pressure on the free surface under a standard staggered grid framework several approaches such as the incorporation of an integration method at the free surface layer young and wu 2010a young et al 2007 yuan and wu 2004 implementation of an extrapolation method anthonio and hall 2006 and embedding of the boussinesq type like equations with a reference velocity to introduce an analytical form of pressure distribution at the top layer wu et al 2010 young and wu 2010b have been employed to impose the zero pressure boundary condition at the free surface in addition stelling and zijlema 2003 proposed a keller box scheme to discretize the vertical momentum equation in which nonhydrostatic pressure is defined at vertically facing cell faces such a definition of the nonhydrostatic pressure allows the zero pressure boundary condition to be imposed straightforwardly at the free surface and has been incorporated in some nonhydrostatic models ai et al 2014 ai and jin 2010 ai et al 2011 ma et al 2012 however the keller box scheme and the definition of vertical velocity used in stelling and zijlema 2003 complicate the discretizations of the vertical momentum equation and the poisson equation in the vertical discretization nonhydrostatic models usually employ either a boundary fitted coordinate system ai and jin 2012 ai et al 2011 bradford 2005 ma et al 2012 young and wu 2010b young et al 2007 zijlema and stelling 2005 or a z coordinate system ai and jin 2010 anthonio and hall 2006 stelling and zijlema 2003 wu et al 2010 young and wu 2010a yuan and wu 2004 each of these systems has advantages and disadvantages the boundary fitted coordinate system can better fit the bed and surface geometry but may introduce large errors in the discretization of the pressure gradient term in simulating steep surface waves young et al 2007 in contrast the discretization of the pressure gradient term can be accurately estimated in the z coordinate system however in the z coordinate system the bed and surface geometry must be represented by stepwise discontinuity which can cause spurious flows recently ai et al 2014 proposed a general boundary fitted coordinate system which allows for a great adaptability of the vertical discretization when wave run up and run down along the shoreline are not involved in the computation the satisfactory results of ai et al demonstrate that the nonhydrostatic model with such a grid system is capable of accurately simulating nonlinear waves with steep free surfaces in this paper we develop nonhydrostatic models for surface waves based on two semi implicit algorithms thus producing two numerical models i e a noniterative model and a model associated with iterating to solve the poisson equation for the pressure correction term both developed models incorporate a novel grid arrangement following ai et al 2011 and a general vertical boundary fitted coordinate system following ai et al 2014 the grid arrangement not only ensures that the homogeneous dirichlet boundary condition for the nonhydrostatic pressure can be precisely and easily imposed on the free surface but also renders the models relatively simple in their discretized forms in both models the pressure correction method is used to solve the nses and the free surface gradient is discretized by the semi implicit method θ method the employment of the θ method is very popular casulli 1999 casulli and zanolli 2002 fringer et al 2006 lai et al 2010 rijnsdorp and zijlema 2016 because this method can easily handle fast surface gravity wave timescales and slow timescales of baroclinic variability the two semi implicit models are developed based upon the same grid arrangement and numerical discretization method which facilitates the following comparison between the two semi implicit algorithms kang and fringer 2005 proved theoretically that semi implicit algorithms can be second order accurate in time for nonhydrostatic free surface flows vitousek and fringer 2013 focused on the analysis of stability and consistency of nonhydrostatic free surface models using semi implicit algorithms and demonstrated that semi implicit nonhydrostatic models are unconditionally stable for linear surface waves when 0 5 θ 1 moreover they also investigated the accuracy of their semi implicit nonhydrostatic models in resolving the linear dispersion relation for a small range of dimensionless water depths however the performance of nonhydrostatic models incorporating semi implicit algorithms needs to be further assessed in this study compared to the work of vitousek and fringer 2013 the accuracy of both of the developed semi implicit models in resolving the linear dispersion relation is assessed and discussed for a wider range of dimensionless water depths the efficiency of the models is also tested due to the lack of comparisons between semi implicit nonhydrostatic models in the simulation of nonlinear surface waves capabilities of both of the developed models in predicting nonlinear surface waves are tested by using several test cases ranging from shallow to deep water although nonhydrostatic models are relatively computationally efficient their parallelization is imperative because the nses are taken as the governing equations the models are computationally expensive for three dimensional 3d problems an option for parallelization is the use of modern graphics processor unit gpu the modern gpu consists of a set of streaming multiprocessors sm and each sm is designed to execute several hundred of threads concurrently in contrast to parallelization based on multicore cpu gpu parallelization is gaining increasing attention because of its favorable cost to performance ratio because solving the poisson equation is computationally intensive and is the most time consuming part of the models in both of the developed models the poisson equation solver is accelerated on a gpu architecture several gpu implementations of nse based numerical models e g the vof model reddy and banerjee 2015 or level set model kuo et al 2011 involving complicated free surface flows have been developed however to our knowledge papers related to gpu accelerated nonhydrostatic models escalante et al 2018 are rare the remainder of this paper is organized as follows section 2 presents governing equations numerical algorithms are described in section 3 in section 4 the accuracy of the developed models in resolving the linear dispersion relation and the efficiency of both serial models are assessed and discussed in section 5 model validations are tested finally conclusions are drawn in the last section 2 governing equations 3d nonhydrostatic free surface flows are described by the incompressible nses which can be expressed in the following forms by splitting the pressure into hydrostatic and nonhydrostatic components such that p g η z q 1 u x v y w z 0 2 u t u 2 x u v y u w z g η x q x ν 2 u x 2 2 u y 2 2 u z 2 3 v t u v x v 2 y v w z g η y q y ν 2 v x 2 2 v y 2 2 v z 2 4 w t u w x v w y w 2 z q z ν 2 w x 2 2 w y 2 2 w z 2 where u v and w are the velocity components in the horizontal x and y and vertical z directions respectively t is the time p is the normalized pressure divided by a constant reference density η is the free surface elevation q is the nonhydrostatic pressure component g is the gravitational acceleration and v is the kinematic viscosity notably diffusion terms in eqs 2 4 are not considered in this study and are not presented in the following section integrating eq 1 from the bottom surface z h x y to the free surface z η x y and applying leibniz s rule with kinematic bottom condition and free surface condition we can obtain the following free surface equation 5 η t x h η u d z y h η v d z 0 at the free surface a homogeneous dirichlet boundary condition for the nonhydrostatic pressure is specified i e q 0 at the inflow normal velocity components are specified by analytical solutions furthermore tangential velocity components are set to zero at the outflow boundary a sommerfeld s radiation condition or a sponge layer technique is implemented to minimize wave reflection into the computational domain 3 numerical algorithms 3 1 grid system the 3d grid system used in both of the present models is built from horizontal rectangular grids and a general vertical boundary fitted coordinate system in this grid system each rectangular block defines a grid cell by introducing the grid indexes i j and k in the x y and z directions respectively the cell center is identified by i j k and the cell faces are denoted by i 1 2 j k i j 1 2 k and i j k 1 2 in the horizontal plane the horizontal velocity components and free surface elevation are defined at staggered locations as shown in fig 1 the horizontal velocity components normal to each cell face are defined at the point of intersection between the face and the segment joining the centers of the two cells that share the face the free surface elevation is located in the center of the cell in the vertical direction a novel grid arrangement is employed which renders the models relatively simple in their discretized forms and the discretized poisson equation for nonhydrostatic pressure corrections symmetric following stelling and zijlema 2003 to apply the dirichlet boundary condition for the nonhydrostatic pressure precisely on the free surface the nonhydrostatic term is defined at the centers of the top and bottom faces of each grid cell see fig 1 however the definition of the vertical velocity component does not follow a standard way stelling and zijlema 2003 wu et al 2010 young and wu 2010a young et al 2007 yuan and wu 2004 and is placed at the cell center following ai et al 2011 in addition both models employ the general vertical boundary fitted coordinate system ai et al 2014 in the vertical direction in which the horizontal levels z k 1 2 are given by 6 z k 1 2 z f k k f η x y t z f n z k f z f h x y k z f h x y k f k k f k k f k k f where z f z k f 1 2 is a fixed level in the given layer k f n z is the number of vertical layers and h is the water depth eq 6 shows that the vertical computational domain is divided into an upper and a lower region by the fixed level z f in each region the layer thickness is distributed uniformly the horizontal levels in the upper region move with time while these levels are fixed in the lower region fig 2 shows a schematic of the general vertical boundary fitted coordinate system notably z f can be defined as a horizontal level or a function of the horizontal position when z f h x y and k f 0 the general boundary fitted coordinate system defined by eq 6 is identical to the traditional boundary fitted coordinate system used in ai et al 2011 following ai et al 2011 and zijlema and stelling 2005 the governing eqs 1 4 are first integrated over the vertical layer k which is bounded by the levels z k 1 2 and z k 1 2 this gives the following equations details about the integration procedures are given in appendix a the continuity equation is 7 δ z k t δ z u k x δ z v k y ω k 1 2 ω k 1 2 0 the horizontal momentum equations are 8 δ z u k t δ z u u k x δ z u v k y ω k 1 2 u k 1 2 ω k 1 2 u k 1 2 g δ z k η x δ z k q x 0 9 δ z v k t δ z u v k x δ z v v k y ω k 1 2 v k 1 2 ω k 1 2 v k 1 2 g δ z k η y δ z k q y 0 the vertical momentum equation is 10 δ z w k t δ z u w k x δ z v w k y ω k 1 2 w k 1 2 ω k 1 2 w k 1 2 δ z k q z 0 where δ z k z k 1 2 z k 1 2 and ω k 1 2 is the vertical velocity relative to layer level z k 1 2 by virtue of 11 δ z u k t δ z k u k t u k δ z k t substituting eq 7 into eq 11 gives the following expression 12 δ z u k t δ z k u k t u k δ z u k x δ z v k y u k ω k 1 2 u k ω k 1 2 therefore substituting eq 12 into eq 8 gives 13 u k t a d v u k g η x q x where a d v u k represents the advection term for u k and can be expressed as 14 a d v u k 1 δ z k δ z u u k x δ z u v k y u k δ z k δ z u k x δ z v k y ω k 1 2 δ z k u k 1 2 u k ω k 1 2 δ z k u k 1 2 u k similarly eqs 9 and 10 can also be written as follows 15 v k t a d v v k g η y q y 16 w k t a d v w k q z where a d v v k and a d v w k represent the advection terms for v k and w k respectively and are expressed as 17 a d v v k 1 δ z k δ z u v k x δ z v v k y v k δ z k δ z u k x δ z v k y ω k 1 2 δ z k v k 1 2 v k ω k 1 2 δ z k v k 1 2 v k 18 a d v w k 1 δ z k δ z u w k x δ z v w k y w k δ z k δ z u k x δ z v k y ω k 1 2 δ z k w k 1 2 w k ω k 1 2 δ z k w k 1 2 w k where w k 1 2 w k 1 w k 2 when k n z for w n z 1 2 which is defined at the free surface it is calculated by solving the continuity eq 1 in a half free surface layer 3 2 numerical discretization the pressure correction method consisting of two major steps is employed to solve eqs 1 13 15 and 16 in the first step the intermediate velocities u i 1 2 j k n 1 2 v i j 1 2 k n 1 2 and w i j k n 1 2 are obtained by solving the momentum eqs 13 15 and 16 which contain the nonhydrostatic pressure at the preceding time level to obtain models that are independent of free surface wave speed the horizontal gradient terms of the water surface in eqs 13 and 15 are discretized by a semi implicit method 19 u i 1 2 j k n 1 2 u i 1 2 j k n δ t a d v u i 1 2 j k n g η x i 1 2 j n θ q x i 1 2 j k n 20 v i j 1 2 k n 1 2 v i j 1 2 k n δ t a d v v i j 1 2 k n g η y i j 1 2 n θ q y i j 1 2 k n 21 w i j k n 1 2 w i j k n δ t a d v w i j k n q z i j k n where η n θ 1 θ η n θ η n 1 and θ is an implicitness factor and has to be chosen in the range 0 5 θ 1 for stability in all the simulations in the present paper θ 0 5 is used for details about the discretizations of a d v u i 1 2 j k n a d v v i j 1 2 k n and a d v w i j k n the reader can refer to ai et al 2011 in eqs 19 21 the gradient terms of the water surface and nonhydrostatic pressure are discretized by means of the central differencing scheme in the second step the new velocities u i 1 2 j k n 1 v i j 1 2 k n 1 and w i j k n 1 are obtained by correcting the intermediate values after including the nonhydrostatic pressure correction term this gives 22 u i 1 2 j k n 1 u i 1 2 j k n 1 2 δ t δ q x i 1 2 j k 23 v i j 1 2 k n 1 v i j 1 2 k n 1 2 δ t δ q y i j 1 2 k 24 w i j k n 1 w i j k n 1 2 δ t δ q z i j k n where δ q q n 1 q n is the nonhydrostatic pressure correction term and is computed from the poisson equation which is obtained by the combination of the discrete continuity and momentum equations the continuity eq 1 is also discretized in semi implicit finite difference form and this gives 25 u i 1 2 j k n θ u i 1 2 j k 1 n θ u i 1 2 j k n θ u i 1 2 j k 1 n θ 2 δ x v i j 1 2 k n θ v i j 1 2 k 1 n θ v i j 1 2 k n θ v i j 1 2 k 1 n θ 2 δ y w i j k n θ w i j k 1 n θ δ z i j k 1 2 0 where k 2 n z and δ z i j k 1 2 δ z i j k 1 δ z i j k 2 for k 1 the continuity eq 1 is discretized in a half bottom layer which gives the following discrete equation by setting w i j 1 2 n θ 0 26 u i 1 2 j 1 n θ u i 1 2 j 1 n θ δ x v i j 1 2 1 n θ v i j 1 2 1 n θ δ y w i j 1 n θ δ z i j 1 2 0 where δ z i j 1 2 δ z i j 1 2 there is no need to discretize the continuity equation in a half free surface layer because the following poisson equation derived from eqs 25 and 26 is enough to determine all the unknown variables in addition w i j 1 2 n θ should be determined by the kinematic bottom condition for an uneven bottom however this has little effects on the results of test cases involving uneven bottom in this study by substituting the expressions for the new velocities from eqs 22 24 into eqs 25 and 26 respectively and considering the zero pressure condition on the free surface δ q n z 1 2 0 the poisson equation for the nonhydrostatic pressure correction term is derived and can be written in matrix form as 27 a δ q b where a is a sparse coefficient matrix δ q is a vector of the nonhydrostatic pressure correction term and b is a known vector related to explicit and intermediate velocities the coefficients of eq 27 are provided in appendix b a semi implicit finite difference approximation for eq 5 is taken to be 28 η i j n 1 η i j n δ t 1 δ x k 1 n z δ z i 1 2 j k n u i 1 2 j k n θ k 1 n z δ z i 1 2 j k n u i 1 2 j k n θ 1 δ y k 1 n z δ z i j 1 2 k n v i j 1 2 k n θ k 1 n z δ z i j 1 2 k n v i j 1 2 k n θ 0 by substituting eqs 22 and 23 and eqs 19 and 20 into eq 28 we can obtain the following expression 29 η i j n 1 η i j n δ t g δ t θ δ x k 1 n z δ z i 1 2 j k n η x i 1 2 j n θ k 1 n z δ z i 1 2 j k n η x i 1 2 j n θ g δ t θ δ y k 1 n z δ z i j 1 2 k n η y i j 1 2 n θ k 1 n z δ z i j 1 2 k n η y i j 1 2 n θ 1 δ x k 1 n z δ z i 1 2 j k n u i 1 2 j k n k 1 n z δ z i 1 2 j k n u i 1 2 j k n 1 δ y k 1 n z δ z i j 1 2 k n v i j 1 2 k n k 1 n z δ z i j 1 2 k n v i j 1 2 k n δ t θ δ x k 1 n z δ z i 1 2 j k n a d v u i 1 2 j k n k 1 n z δ z i 1 2 j k n a d v u i 1 2 j k n δ t θ δ y k 1 n z δ z i j 1 2 k n a d v v i j 1 2 k n k 1 n z δ z i j 1 2 k n a d v v i j 1 2 k n δ t θ δ x k 1 n z δ z i 1 2 j k n q x i 1 2 j k n k 1 n z δ z i 1 2 j k n q x i 1 2 j k n δ t θ δ y k 1 n z δ z i j 1 2 k n q y i j 1 2 k n k 1 n z δ z i j 1 2 k n q y i j 1 2 k n β δ t θ δ x k 1 n z δ z i 1 2 j k n δ q x i 1 2 j k k 1 n z δ z i 1 2 j k n δ q x i 1 2 j k β δ t θ δ y k 1 n z δ z i j 1 2 k n δ q y i j 1 2 k k 1 n z δ z i j 1 2 k n δ q y i j 1 2 k notably a factor β 0 or 1 is introduced in the above equation for consistency with eq 28 eq 7 is also discretized by the semi implicit method to calculate ω k 1 2 this gives 30 δ z i j k n 1 δ z i j k n δ t 1 δ x δ z i 1 2 j k n u i 1 2 j k n θ δ z i 1 2 j k n u i 1 2 j k n θ 1 δ y δ z i j 1 2 k n v i j 1 2 k n θ δ z i j 1 2 k n v i j 1 2 k n θ ω i j k 1 2 n θ ω i j k 1 2 n θ 0 3 3 solution procedure the overall solution procedure is summarized as follows 1 calculate the free surface η i j n 1 by solving eq 29 which neglects the nonhydrostatic pressure correction δ q eq 29 constitutes a strongly diagonally dominant symmetric and positive definite system which is solved by the conjugate gradient method 2 calculate the intermediate velocities u i 1 2 j k n 1 2 v i j 1 2 k n 1 2 and w i j k n 1 2 by using eqs 19 21 3 calculate the nonhydrostatic pressure correction δ q by using eq 27 which is solved on gpu in conjunction with the conjugate gradient method details about the gpu implementation of eq 27 are given in section 3 4 4 update the intermediate velocities by using eqs 22 24 to obtain the new velocities u i 1 2 j k n 1 v i j 1 2 k n 1 and w i j k n 1 5 calculate the vertical velocity relative to layer level ω i j k 1 2 n 1 by using eq 30 note that considering the kinematic bottom and free surface conditions ω 1 2 n 1 ω i j n z 1 2 n 1 0 the above procedure corresponds to β 0 in eq 29 which results in the noniterative semi implicit model when β 1 an iterative procedure is required by repeating steps 1 to 3 until convergence is reached clearly the noniterative model may be computationally more efficient than the iterative model as demonstrated theoretically by kang and fringer 2005 both models are second order accurate in time for nonhydrostatic free surface flows it is worth mentioning that if the pressure projection method is employed β 0 results in the first order temporal accuracy and β 1 still enable the model to be second order accurate in time vitousek and fringer 2013 3 4 gpu implementation of the poisson equation the sparse matrix a in eq 27 contains 10 nonzero diagonals in the bottom layer and 15 nonzero diagonals in the other layers moreover this matrix is symmetric as presented in appendix b in this study the conjugate gradient method is used to solve eq 27 because solving the poisson equation is computationally intensive and is the most time consuming part of both solvers the solution of eq 27 is outsourced to the gpu via a function called kernel which implements the conjugate gradient method in the cuda programming environment a kernel is called by a host cpu and is executed on a device gpu both the cpu and gpu have their own memory data must be transferred between cpu memory and gpu memory however to achieve high performance data transfer should be minimized to reduce memory latency in this study before the kernel is called from the host the vector b and the nonzero coefficients of the matrix a are transferred from cpu memory to gpu memory then after the solution is obtained on gpu it is copied from gpu memory to cpu memory the computationally intensive algorithmic components of the conjugate gradient method mainly include vector addition and vector dot product the implementations of these components on gpu are described in sanders and kandrot 2010 as presented in the above section the poisson equation may be solved many times at each time step for the iterative model normally the matrix a and the vector b are copied from cpu memory to gpu memory every time before solving the poisson equation however because the coefficients of matrix a presented in appendix b are constant within each time step to reduce data transfer latency they are transferred only once before first solving the poisson equation 4 accuracy and efficiency in this section we focus on the accuracy of both models in resolving linear dispersion relations and the efficiency of both serial models by conducting a series of numerical simulations of linear standing waves in all the simulations the layer thickness is uniformly distributed over the water depth we consider linear standing waves in a closed basin of constant depth the basin has a length of l with a constant depth of h 10 m the initial free surface displacement is given as 31 η x t 0 a cos k x cos 2 π t t 0 x l where a and t are the amplitude and wave period of the standing wave and k 2 π l is the wavenumber here the wavelength equals the length of the basin to generate various k h values ranging from shallow water to intermediate water to deep water waves we change the length of the basin but maintain the linear wave condition by adjusting the wave amplitude the horizontal grid size and the time step are firstly set to δ x l 20 and δ t t 40 respectively the normalized wave celerity obtained with two vertical layers versus k h is depicted in fig 3 in which c and c 0 g h are the wave speed and long wave celerity respectively the computed wave celerity is the average value estimated over ten wave periods in the investigated range of k h 5 the iterative model accurately predicts the wave celerity but the noniterative model results gradually deviate from the analytical solution with increases in k h this implies that with the same number of vertical layers the accuracy of the noniterative model may be not as good as that of the iterative model for higher dispersive waves in deep water depths if both models are implemented in the same horizontal and vertical spatial resolution and relatively coarse temporal resolution this can be further demonstrated by fig 4 to present the effect of the number of vertical layers on both of the models accuracy fig 4 displays normalized percentage errors versus a wide range of k h values with increasing vertical layers the iterative model can accurately predict linear dispersive waves up to larger k h values we can define a normalized percentage error as ε c linear c comp c linear where c linear is the phase speed of linear waves and c comp is the average wave speed estimated over ten wave periods for a given tolerance error of ε 1 the iterative model with two three and five layers is accurate up to k h 7 15 and 40 respectively accordingly the noniterative model is only accurate up to k h 3 notably vitousek and fringer 2013 also investigated the accuracy of the two semi implicit algorithms in resolving linear dispersion relations by using a similar test case both semi implicit algorithms showed almost identical results in the investigated water depth range of k h 4 however in the study of vitousek and fringer 2013 the computed wave speed was only estimated over one wave period and only a small range of dimensionless water depth was considered accordingly the accuracy of both present models was assessed severely in this paper because the computed wave speed was estimated over ten wave periods and a wider range of dimensionless water depth was considered to show the influences of both the time step and the horizontal grid size on the two models table 1 presents the normalized percentage errors obtained with different combinations of the time step and the horizontal grid size for k h 10 numerical results with only two and three layers are given because the results with more vertical layers are very similar to those with three layers for the noniterative model by setting δ x l 20 its accuracy is improved significantly by decreasing the time step for the smallest time step of δ t t 160 the accuracy of the noniterative model is close to that of the iterative model however by setting δ t t 160 refining the horizontal grid size almost has no effect on the accuracy of the noniterative model for the iterative model both the time step and the horizontal grid size has little effect on its accuracy the results presented in fig 4 and table 1 imply that both developed models can accurately predict higher dispersive waves with the same time step which is not sufficiently small the iterative model is more accurate than the noniterative model the accuracy of the iterative model can be improved significantly by refining the vertical layers while the accuracy of the noniterative model can be increased by decreasing the time step to better compare both semi implicit models in resolving the linear dispersion relationship in terms of the spatial and temporal resolution it is necessary to derive the numerical dispersion relationship following vitousek and fringer 2013 however this paper only focuses on the development and numerical assessment of the two semi implicit models to show the serial implemented efficiency of both models in response to changes in the horizontal and vertical resolutions we also consider a linear standing wave with a 0 01 m h 10 m and k h 2 5 we define a reference case in which the horizontal grid size of δ x l 20 and two uniform vertical layers are used the same time step is employed for the two models fig 5 a depicts the nondimensional cpu time versus the horizontal resolution increasing factor and fig 5 b shows the comparison of the computational expense between the two models the cpu time shown in fig 5 a is nondimensionalized with respect to that of the reference case while the relative cpu time shown in fig 5 b is the ratio of the computational expense of the iterative model to that of the noniterative model the horizontal resolution increasing factor f h is defined as the ratio of the number of horizontal grid cells to the number of horizontal grid cells employed in the reference case fig 5 a shows that for both models the cpu time increases with increasing horizontal resolution and it increases dramatically when f h 6 as expected fig 5 b shows that the iterative model is more time consuming than the noniterative model the maximum relative cpu time reaches approximately 2 5 while the minimum value is only approximately 1 1 fig 6 a and b show the nondimensional cpu time and the relative cpu time versus the vertical resolution increasing factor respectively the vertical resolution increasing factor f v is defined as the ratio of the number of vertical layers to the number of vertical layers employed in the reference case fig 6 shows that for both models the cpu time increases moderately with the increase in the vertical resolution and the iterative model is also more time consuming than the noniterative model the minimum relative cpu time is 1 1 and the maximum value only reaches approximately 1 4 overall the relative cpu time ranges from 1 1 to 2 5 and all of the relative cpu time costs in the following test cases are within this range by comparing figs 5 a and 6 a it can also be concluded that for both models the computational efficiency is more sensitive to the horizontal resolution than to the vertical resolution 5 test cases both developed semi implicit models are further assessed with five test cases concerning nonlinear surface waves for which either analytical solutions or existing experimental data are available the first two examples focus on nearshore wave propagation in which wave shoaling nonlinearity dispersion reflection and diffraction phenomena occur the third example is used to evaluate the capabilities of both models to simulate nonlinear sloshing waves the last two examples of focusing waves are employed to test the abilities of both models to resolve nonlinear wave groups the acceleration of the poisson equation solver due to gpu parallelization is presented in the final test case which is computationally very expensive in all the computations the same horizontal grid sizes and the same time step are used for the two models 5 1 wave propagation over a submerged bar wave propagation over a submerged bar is a classical two dimensional 2d benchmark test case for the validation of nonlinear dispersive wave models beji and battjes 1993 and luth et al 1994 have conducted a series of laboratory experiments of the propagation of regular waves over a submerged trapezoidal bar in a wave flume in this study the numerical wave flume is 35 m long with 10 m of a sponge layer at the right end the still water depth h is 0 4 m and is reduced to 0 1 m at the submerged bar the upward and downward slopes of the bar are 1 20 and 1 10 respectively fig 7 shows the numerical model setup and free surface elevation measurement stations the present study focuses on two test cases namely case a and case c which involve sinusoidal incident waves with a wave height of h 0 2 0 cm and h 0 4 1 cm respectively and a wave period of t 2 02 s and t 1 01 s respectively experimental data obtained by luth et al 1994 are used for comparison with the numerical results case a with k h 0 67 has been used to verify a number of nonhydrostatic models bradford 2005 casulli 1999 ma et al 2012 stelling and zijlema 2003 wu et al 2010 yuan and wu 2004 however case c with k h 1 69 has a relatively short wavelength and to our knowledge only comparison results obtained by the nonhydrostatic model developed by stelling and zijlema 2003 have been published for this case in this computation for cases a and c the horizontal grid spacing values are set to δ x 0 025 m and 0 0125 m respectively and the time steps are δ t 0 01 s and 0 005 s respectively in both cases the vertical boundary fitted coordinate system is constructed by using two vertical layers with z f h x y and k f 0 figs 8 and 9 show comparisons of the free surface elevation between the two sets of numerical results and the experimental data for case a and c both models predict well wave propagation over the bar which involves the generation of bound higher harmonics via the increase in nonlinearity at the shoaling stage and the transformation of wave patterns due to the release of higher harmonics at the deshoaling stage there are almost no differences between the two model results both models with only two vertical layers are in good agreement with the measurements indicating that both developed models can accurately predict 2d nearshore wave propagation in which wave shoaling nonlinearity and dispersion occur 5 2 wave transformation over a circular shoal this example examines the capabilities of both models to predict 3d nearshore wave propagation the numerical results are compared with experimental data from chawla 1995 the experimental setup is shown in fig 10 in which a circular shoal is placed on a flat bottom the boundary of the shoal is given by 32 x 5 2 y 8 98 2 6 6049 whereas the depth on the shoal is 33 h x y h 8 73 82 81 x 5 2 y 8 98 2 where h 0 45 m is the still water depth the incident wave with a wave height h 0 1 18 cm and a wave period t 0 1 0 s is specified at the left boundary resulting in k h 1 90 at the right end of the computational domain a sommerfeld s radiation boundary is used to minimize wave reflection the same test case has been used to verify the nonhydrostatic model developed by zijlema and stelling 2005 in this computation a uniform grid of δ x δ y 0 05 m is used in the horizontal domain and the constant time step is set to δ t 0 02 s similar to the former example the vertical boundary fitted coordinate system is also constructed by using two vertical layers with z f h x y and k f 0 for both models the total grid number is therefore 440 364 2 320320 both simulations are run for 40 s fig 11 shows comparisons among the normalized wave heights at four sections of the two sets of numerical results and experimental data only minor discrepancies exist between the two numerical models generally both model results are in good agreement with the measured data this demonstrates the capabilities of both models for resolving 3d nearshore wave propagation in which wave shoaling reflection and diffraction occur 5 3 nonlinear sloshing waves in this example we consider nonlinear sloshing motions in a closed basin the basin has a length of l 2 0 m and a still water depth of h 1 0 m the initial free surface profile also follows eq 31 but two wave steepnesses of a k 0 1 and 0 2 are considered in the simulations in which k 2 π l such that k h π similar test cases have been used to verify other nonhydrostatic models ai et al 2014 young et al 2007 the second order analytical solution described in wu et al 1998 is used for the comparison with numerical results a horizontal grid spacing of δ x l 40 and time step of δ t t 40 are used in the computations where t is the wave period in the vertical direction the grid system is constructed by using ten vertical layers with z f 0 1 m and k f 9 for both models comparisons of the time histories of the free surface elevation at x l 2 among the two sets of numerical results and analytical solutions are depicted in fig 12 a notable discrepancy between the results of the two models occurs in the last few wave periods the difference between the results of the two models is more apparent in the case of large wave steepness than in the case of small wave steepness overall with the same horizontal grid spacing and the time step the iterative model results are in good agreement with the analytical solution and are better than the noniterative model results 5 4 2d focusing waves the spatial temporal focusing of wave groups at one point in space and time is believed to be one of the physical mechanisms contributing to the formation of extreme waves many researchers have made a great deal of effort to investigate focusing behavior by using laboratory experiments baldock et al 1996 baldock and swan 1996 johannessen and swan 2001 ma et al 2010 ning et al 2009 in the last decade nonhydrostatic models for simulating focusing wave groups have received increased attention in this example to assess both models representation of 2d nonlinear focusing waves experiments conducted by baldock et al 1996 which have been reproduced by few nonhydrostatic models ai et al 2014 young and wu 2010a are used the dimension of the computational domain is 0 x 20 m the still water depth is h 0 7 m a 5 m sponge layer is applied at the end of the computational domain x 20 m the two period ranges or frequency bands indicated in table 2 are considered in the present simulations case b55 corresponds to a broad bandwidth and case d55 represents a narrow bandwidth both cases have the same input wave amplitude of a n 1 n a n 55 mm where n 29 is the number of frequency components and a n defines the amplitude of each component wave components are of equal amplitude and equally spaced within the period range the inflow boundary is specified at x 0 m and the imposed normal velocity components are given by 34 u x z t n 1 n a n ω n cosh k n h z sin h k n h cos k n x x f ω n t t f where k n and ω n denote the wavenumber and frequency of each component respectively satisfying the linear dispersion relationship and x f 8 m and t f 30 s are the theoretical focusing position and time respectively in this computation for the narrow bandwidth case case d55 the horizontal domain is discretized by setting the grid spacing at δ x 0 025 m and the time step is taken as δ t 0 005 s to accurately predict the focusing position and time in the broad bandwidth case case b55 a refined grid with δ x 0 0125 m and a small time step of δ t 0 0025 s are used the vertical boundary fitted coordinate system is constructed by using seven vertical layers with z f 0 1 m and k f 6 figs 13 and 14 show comparisons of the temporal and spatial wave profiles among the two sets of numerical results and experimental data for case b55 and case d55 where t r t t f and x r x x f generally the results of both models are in good agreement with the experimental data however the noniterative model slightly underestimates the main wave crest accordingly the focusing position and time are also underpredicted by the noniterative model table 3 compares the calculated focusing positions and times with the measured data which are estimated from fig 10 of baldock et al 1996 the iterative model overestimates the focusing position and time by 6 9 and 9 5 respectively for case b55 and only underestimates focusing position and time by 0 7 and 3 0 respectively for case d55 accordingly the noniterative model underestimates the focusing position and time by 12 6 and 20 1 respectively for case b55 and by 10 4 and 13 4 respectively for case d55 5 5 3d focusing waves in the last example experimental data from johannessen and swan 2001 are used to verify both models representation of 3d nonlinear focusing waves similar problems have also been predicted by few nonhydrostatic models ai et al 2014 young and wu 2010b as shown in fig 15 the dimensions of the computational domain are 0 x 13 m and 0 y 25 m the still water depth is h 1 2 m a 5 0 m sponge layer is applied at the end of the computational domain as presented in table 4 we considered two wave groups with different input amplitudes the largest input amplitude i e a 78 mm is very close to the limit at which incipient wave breaking occurs each wave group consists of n 28 frequency components and in each frequency there are m 91 direction components for each frequency component the frequency f n is equally spaced within the frequency range and the wave amplitude a n is proportional to f n 2 for each direction component the direction θ m ranges from 45 to 45 the inflow boundary is specified at x 0 m and the imposed normal velocity components can be expressed as 35 u x y z t n 1 n a n ω n cosh k n h z sin h k n h m 1 m b n m cos k n x x f cos θ m y y f sin θ m ω n t t f where x f y f 5 5 12 5 m is the theoretical focusing position t f 50 s is the theoretical focusing time and b n m is the directional spread of wave components which is normalized so that m 1 m b n m 1 in this study the directional spread is independent of the wave frequency and is expressed by adopting the following typical spreading parameter 36 b θ m b cos s θ m 2 where b is a normalizing coefficient and s is the directional spread parameter in this computation we choose the horizontal grid spacing of δ x 0 025 m and δ y 0 05 m and construct the vertical boundary fitted coordinate system by employing ten vertical layers with z f 0 12 m and k f 9 the chosen time step is 0 005 s and the total simulation time is up to 54 s fig 16 shows comparisons of the time histories of the free surface elevation at the focusing position among the two sets of numerical results and experimental data for the case with a small input amplitude case d4555 the results of both models are very close and are in good agreement with the experimental data however the iterative model results are slightly better than the noniterative model results for the case with a large input amplitude case d4578 because the main wave crest is slightly underestimated by the noniterative model comparisons of the focusing position and time among the results of both models and measured data are shown in table 5 the measured data are estimated from fig 12 of johannessen and swan 2001 for case d4555 both models predict the focusing position very well but overestimate the focusing time significantly the iterative model overestimates the focusing position by only 1 8 and the noniterative model underestimates the focusing position by only 2 0 the significant overestimation of the focusing time by both models may be attributed to inaccurately measured data because as easily found in fig 12 of johannessen and swan 2001 the measured focusing time for case d4555 is much lower than the best fit polynomial for the measured data for case d4578 the iterative model underestimates the focusing position and time by 4 9 and 14 0 respectively accordingly the noniterative model underestimates the focusing position and time by 15 6 and 24 5 respectively to test the performance of the gpu implementation of the poisson equation in both models case d4578 is solved by using the serial and gpu accelerated versions of the code all computations are carried out with single precision floating point numbers the test environment is based on a desktop computer with an intel r core tm i7 7700k cpu and a nvidia geforce gtx 1080 ti gpu the cpu is a quad core processor with eight threads that has a base frequency of 4 2 ghz and peak frequency of 4 5 gh with 8 mb l3 cache the gpu consists of 3584 cuda cores and has a total memory bandwidth of 484 gb s each cuda core has a base clock rate of 1480 mhz and a boost frequency of 1582 mhz the performance of the gpu accelerated poisson solver is presented in table 6 the cpu time is measured by executing the serial code in a single thread while the gpu time is the parallel running time on the gpu the speedups with respect to a single thread cpu are 16 61 and 17 18 for the noniterative model and iterative model respectively the greatest speedup value is obtained by the iterative model which is attributed to the fact that the gpu accelerated part of the iterative model is more computationally intensive than that of the noniterative model because for the iterative model the poisson equation may need to be solved many times at each time step 6 conclusions in this paper two nonhydrostatic models namely iterative and noniterative models are developed to simulate surface water waves both models employ the semi implicit method to discretize the free surface and solve the 3d incompressible nses with the pressure correction method to improve both models efficiency the poisson equation solver is run on gpu in conjunction with the conjugate gradient method an assessment of both models accuracy in resolving the linear dispersion relation is conducted for a wide range of k h values it is inferred that for the long term evolution of higher dispersive waves the iterative model is more accurate than the noniterative model when the time step is not sufficiently small by refining the vertical layers the accuracy of the iterative model can be improved significantly by decreasing the time step the accuracy of the noniterative model can be increased the serially implemented efficiency of both models is also tested in resolving linear dispersive waves the iterative model is computationally more expensive than the noniterative model the ratio of the cpu time consumed by the iterative model to that spent by the noniterative model is in the range of 1 1 2 5 both models efficiency is more sensitive to the horizontal grid resolution than the vertical grid resolution for wave propagation over uneven bottoms the overall good agreements between the two sets of model results and experimental data indicate that both models by using only two vertical layers can accurately simulate nearshore wave propagation involving wave shoaling nonlinearity dispersion reflection and diffraction phenomena for the investigated k h values for nonlinear sloshing waves with k h π with the same horizontal grid sizes and the same time step the iterative model results are better than the noniterative model results and are in good agreement with the analytical solution in the last two examples involving 2d and 3d focusing wave groups the iterative model predicts slightly larger values of the focusing position and time than the noniterative model by considering the measurement errors and uncertainties in the developed models both models well resolved the 2d and 3d focusing wave groups the acceleration due to gpu parallelization is evaluated in the 3d focusing wave group test which is very computationally expensive a speedup of approximately 17 times for both of the developed models is observed due to the current gpu implementation of the poisson equation in general by considering the accuracy and efficiency of both semi implicit models the noniterative model is preferable to the iterative model for predicting nearshore wave propagation both models are capable of accurately predicting the long term evolution of surface waves in deep water conditions and can perform well in the test cases involving focusing wave groups moreover the computational times of both models can be reduced by using gpu parallelization acknowledgments this work was supported by the national key research and development program china grant no 2017yfc1404200 the national natural science foundation of china grant nos 51679031 51720105010 51309052 the high tech ship research projects sponsored by the ministry of industry and information technology miit of china grant no 2016 23 7 and the fundamental research funds for the central universities china grant nos dut16td08 dut18zd401 appendix a integration procedures for eqs 1 4 eqs 7 10 are obtained by integrating eqs 1 4 some details about the integration procedures are given as follows by integrating eq 1 over a layer thickness of δ z k z k 1 2 z k 1 2 and using the leibniz rule given by a 1 z k 1 2 z k 1 2 u x v y w z d z δ z u k x δ z v k y u z x z k 1 2 z k 1 2 v z y z k 1 2 z k 1 2 w k 1 2 w k 1 2 0 the relations between w k 1 2 and ω k 1 2 can be expressed as a 2 w k 1 2 ω k 1 2 z k 1 2 t u k 1 2 z k 1 2 x v k 1 2 z k 1 2 y by substituting eq a 2 into eq a 1 the layer integrated continuity eq 7 is obtained to obtain eq 8 the left side terms of eq 2 are first integrated over a layer thickness using the leibniz rule the integration result is written as a 3 z k 1 2 z k 1 2 u t d z z k 1 2 z k 1 2 u 2 x u v y u w z d z δ z u k t u z t z k 1 2 u z t z k 1 2 x z k 1 2 z k 1 2 u 2 d z y z k 1 2 z k 1 2 u v d z ω k 1 2 z k 1 2 t u z k 1 2 ω k 1 2 z k 1 2 t u z k 1 2 where eq a 2 has been substituted the above eq a 3 can be simplified as follows a 4 z k 1 2 z k 1 2 u t d z z k 1 2 z k 1 2 u 2 x u v y u w z d z δ z u k t δ z u u k x δ z u v k x ω u k 1 2 ω u k 1 2 it can be easily found that the eq a 4 is identical to the left side terms of eq 8 then a similar integration procedure is applied to the right side terms of eq 2 because diffusion terms are not considered in the study and the water surface gradient is independent of the integration only the layer integrated nonhydrostatic pressure gradient is given as a 5 z k 1 2 z k 1 2 q x d z δ z q k x q z x z k 1 2 q z x z k 1 2 δ z k q x k q k q k 1 2 z k 1 2 x q k 1 2 q k z k 1 2 x the second and third terms in the above equation were neglected in the present models however for steep topography one may recover these terms to reduce errors due to the treatment of the nonhydrostatic pressure gradient following a similar procedure eqs 9 and 10 be obtained by integrating eqs 3 and 4 respectively details about this procedure are not given for brevity appendix b coefficients of the poisson equation for nonhydrostatic pressure corrections by substituting the expressions for the new velocities from eqs 22 24 into eq 25 the following equation for k 2 n z is obtained b 1 a 1 δ q i j k 1 2 a 2 δ q i j k 1 2 a 3 δ q i j k 3 2 a 4 δ q i 1 j k 1 2 a 5 δ q i 1 j k 1 2 a 6 δ q i 1 j k 3 2 a 7 δ q i 1 j k 1 2 a 8 δ q i 1 j k 1 2 a 9 δ q i 1 j k 3 2 a 10 δ q i j 1 k 1 2 a 11 δ q i j 1 k 1 2 a 12 δ q i j 1 k 3 2 a 13 δ q i j 1 k 1 2 a 14 δ q i j 1 k 1 2 a 15 δ q i j 1 k 3 2 f where b 2 a 1 θ δ t 2 δ x 2 θ δ t 2 δ y 2 θ δ t δ z i j k 1 2 δ z i j k b 3 a 2 θ δ t δ x 2 θ δ t δ y 2 θ δ t δ z i j k 1 2 1 δ z i j k 1 1 δ z i j k b 4 a 3 θ δ t 2 δ x 2 θ δ t 2 δ y 2 θ δ t δ z i j k 1 2 δ z i j k 1 b 5 a 4 a 6 a 7 a 9 θ δ t 4 δ x 2 b 6 a 5 a 8 θ δ t 2 δ x 2 b 7 a 10 a 12 a 13 a 15 θ δ t 4 δ y 2 b 8 a 11 a 14 θ δ t 2 δ y 2 and b 9 f 1 2 δ x u i 1 2 j k n θ 2 u i 1 2 j k 1 n θ 2 u i 1 2 j k n θ 2 u i 1 2 j k 1 n θ 2 1 2 δ y v i j 1 2 k n θ 2 v i j 1 2 k 1 n θ 2 v i j 1 2 k n θ 2 v i j 1 2 k 1 n θ 2 1 δ z i j k 1 2 w i j k n θ 2 w i j k 1 n θ 2 with b 10 u n θ 2 1 θ u n θ u n 1 2 b 11 v n θ 2 1 θ v n θ v n 1 2 b 12 w n θ 2 1 θ w n θ w n 1 2 similarly by substituting the expressions for the new velocities from eqs 22 24 into eq 26 the resulting equation for the half bottom layer k 1 can be expressed as b 13 b 1 δ q i j 3 2 b 2 δ q i j 1 2 b 3 δ q i 1 j 3 2 b 4 δ q i 1 j 1 2 b 5 δ q i 1 j 3 2 b 6 δ q i 1 j 1 2 b 7 δ q i j 1 3 2 b 8 δ q i j 1 1 2 b 9 δ q i j 1 3 2 b 10 δ q i j 1 1 2 g where b 14 b 1 θ δ t δ x 2 θ δ t δ y 2 θ δ t δ z i j 1 2 δ z i j 1 b 15 b 2 θ δ t δ x 2 θ δ t δ y 2 θ δ t δ z i j 1 2 δ z i j 1 b 16 b 3 b 4 b 5 b 6 θ δ t 2 δ x 2 b 17 b 7 b 8 b 9 b 10 θ δ t 2 δ y 2 and b 18 g 1 δ x u i 1 2 j 1 n θ 2 u i 1 2 j 1 n θ 2 1 δ y v i j 1 2 1 n θ 2 v i j 1 2 1 n θ 2 1 δ z i j 1 2 w i j 1 n θ 2 the set of eqs b 1 and b 13 forms the poisson equation 27 which is a sparse linear symmetric system that contains 10 nonzero diagonals in the bottom layer and 15 nonzero diagonals in the other layers 
24003,this paper presents two semi implicit nonhydrostatic models to simulate surface water waves both models utilize the pressure correction method to solve three dimensional 3d incompressible navier stokes equations nses but one is a noniterative model and the other is associated with iterating to solve the poisson equation for pressure correction terms to meet the high computational demands the poisson equation is solved on the graphics processing unit gpu in conjunction with the conjugate gradient method both the accuracy in resolving the linear dispersion relation and the serially implemented efficiency of the models are assessed and discussed then both models are validated with several test cases ranging from shallow to deep water the results of the two models are very similar and show good agreement with experimental data in the shallow water test cases the accuracy of both models are also evaluated in deep water nonlinear sloshing waves and 2d 3d focusing waves in addition the acceleration due to gpu parallelization is evaluated in a final 3d test case keywords nonhydrostatic model semi implicit three dimensional wave model gpu computing 1 introduction over the past two decades nonhydrostatic models have attracted increased attention because of their accuracy and efficiency in coastal and ocean applications nonhydrostatic models are developed based upon incompressible navier stokes equations nses and are capable of resolving surface water waves ai et al 2014 ai and jin 2010 2012 ai et al 2011 anthonio and hall 2006 bradford 2005 ma et al 2012 stelling and zijlema 2003 wu et al 2010 young and wu 2010a b young et al 2007 yuan and wu 2004 zijlema and stelling 2005 and internal waves fringer et al 2006 lai et al 2010 vitousek and fringer 2011 2014 in such models the free surface is defined as a single value function of the horizontal position and thus can be determined by the so called free surface equation which is obtained by integrating the continuity equation over the water depth and applying kinematic free surface and bottom conditions because they do not need to capture the free surface by using a large number of vertical grids nonhydrostatic models are computationally more efficient than other nse based numerical models e g vof models higuera et al 2013 or level set models chen and yu 2009 involving complicated free surface flows in the development of nonhydrostatic models one of the main issues is the precise implementation of a homogeneous dirichlet boundary condition for the nonhydrostatic pressure on the free surface under a standard staggered grid framework several approaches such as the incorporation of an integration method at the free surface layer young and wu 2010a young et al 2007 yuan and wu 2004 implementation of an extrapolation method anthonio and hall 2006 and embedding of the boussinesq type like equations with a reference velocity to introduce an analytical form of pressure distribution at the top layer wu et al 2010 young and wu 2010b have been employed to impose the zero pressure boundary condition at the free surface in addition stelling and zijlema 2003 proposed a keller box scheme to discretize the vertical momentum equation in which nonhydrostatic pressure is defined at vertically facing cell faces such a definition of the nonhydrostatic pressure allows the zero pressure boundary condition to be imposed straightforwardly at the free surface and has been incorporated in some nonhydrostatic models ai et al 2014 ai and jin 2010 ai et al 2011 ma et al 2012 however the keller box scheme and the definition of vertical velocity used in stelling and zijlema 2003 complicate the discretizations of the vertical momentum equation and the poisson equation in the vertical discretization nonhydrostatic models usually employ either a boundary fitted coordinate system ai and jin 2012 ai et al 2011 bradford 2005 ma et al 2012 young and wu 2010b young et al 2007 zijlema and stelling 2005 or a z coordinate system ai and jin 2010 anthonio and hall 2006 stelling and zijlema 2003 wu et al 2010 young and wu 2010a yuan and wu 2004 each of these systems has advantages and disadvantages the boundary fitted coordinate system can better fit the bed and surface geometry but may introduce large errors in the discretization of the pressure gradient term in simulating steep surface waves young et al 2007 in contrast the discretization of the pressure gradient term can be accurately estimated in the z coordinate system however in the z coordinate system the bed and surface geometry must be represented by stepwise discontinuity which can cause spurious flows recently ai et al 2014 proposed a general boundary fitted coordinate system which allows for a great adaptability of the vertical discretization when wave run up and run down along the shoreline are not involved in the computation the satisfactory results of ai et al demonstrate that the nonhydrostatic model with such a grid system is capable of accurately simulating nonlinear waves with steep free surfaces in this paper we develop nonhydrostatic models for surface waves based on two semi implicit algorithms thus producing two numerical models i e a noniterative model and a model associated with iterating to solve the poisson equation for the pressure correction term both developed models incorporate a novel grid arrangement following ai et al 2011 and a general vertical boundary fitted coordinate system following ai et al 2014 the grid arrangement not only ensures that the homogeneous dirichlet boundary condition for the nonhydrostatic pressure can be precisely and easily imposed on the free surface but also renders the models relatively simple in their discretized forms in both models the pressure correction method is used to solve the nses and the free surface gradient is discretized by the semi implicit method θ method the employment of the θ method is very popular casulli 1999 casulli and zanolli 2002 fringer et al 2006 lai et al 2010 rijnsdorp and zijlema 2016 because this method can easily handle fast surface gravity wave timescales and slow timescales of baroclinic variability the two semi implicit models are developed based upon the same grid arrangement and numerical discretization method which facilitates the following comparison between the two semi implicit algorithms kang and fringer 2005 proved theoretically that semi implicit algorithms can be second order accurate in time for nonhydrostatic free surface flows vitousek and fringer 2013 focused on the analysis of stability and consistency of nonhydrostatic free surface models using semi implicit algorithms and demonstrated that semi implicit nonhydrostatic models are unconditionally stable for linear surface waves when 0 5 θ 1 moreover they also investigated the accuracy of their semi implicit nonhydrostatic models in resolving the linear dispersion relation for a small range of dimensionless water depths however the performance of nonhydrostatic models incorporating semi implicit algorithms needs to be further assessed in this study compared to the work of vitousek and fringer 2013 the accuracy of both of the developed semi implicit models in resolving the linear dispersion relation is assessed and discussed for a wider range of dimensionless water depths the efficiency of the models is also tested due to the lack of comparisons between semi implicit nonhydrostatic models in the simulation of nonlinear surface waves capabilities of both of the developed models in predicting nonlinear surface waves are tested by using several test cases ranging from shallow to deep water although nonhydrostatic models are relatively computationally efficient their parallelization is imperative because the nses are taken as the governing equations the models are computationally expensive for three dimensional 3d problems an option for parallelization is the use of modern graphics processor unit gpu the modern gpu consists of a set of streaming multiprocessors sm and each sm is designed to execute several hundred of threads concurrently in contrast to parallelization based on multicore cpu gpu parallelization is gaining increasing attention because of its favorable cost to performance ratio because solving the poisson equation is computationally intensive and is the most time consuming part of the models in both of the developed models the poisson equation solver is accelerated on a gpu architecture several gpu implementations of nse based numerical models e g the vof model reddy and banerjee 2015 or level set model kuo et al 2011 involving complicated free surface flows have been developed however to our knowledge papers related to gpu accelerated nonhydrostatic models escalante et al 2018 are rare the remainder of this paper is organized as follows section 2 presents governing equations numerical algorithms are described in section 3 in section 4 the accuracy of the developed models in resolving the linear dispersion relation and the efficiency of both serial models are assessed and discussed in section 5 model validations are tested finally conclusions are drawn in the last section 2 governing equations 3d nonhydrostatic free surface flows are described by the incompressible nses which can be expressed in the following forms by splitting the pressure into hydrostatic and nonhydrostatic components such that p g η z q 1 u x v y w z 0 2 u t u 2 x u v y u w z g η x q x ν 2 u x 2 2 u y 2 2 u z 2 3 v t u v x v 2 y v w z g η y q y ν 2 v x 2 2 v y 2 2 v z 2 4 w t u w x v w y w 2 z q z ν 2 w x 2 2 w y 2 2 w z 2 where u v and w are the velocity components in the horizontal x and y and vertical z directions respectively t is the time p is the normalized pressure divided by a constant reference density η is the free surface elevation q is the nonhydrostatic pressure component g is the gravitational acceleration and v is the kinematic viscosity notably diffusion terms in eqs 2 4 are not considered in this study and are not presented in the following section integrating eq 1 from the bottom surface z h x y to the free surface z η x y and applying leibniz s rule with kinematic bottom condition and free surface condition we can obtain the following free surface equation 5 η t x h η u d z y h η v d z 0 at the free surface a homogeneous dirichlet boundary condition for the nonhydrostatic pressure is specified i e q 0 at the inflow normal velocity components are specified by analytical solutions furthermore tangential velocity components are set to zero at the outflow boundary a sommerfeld s radiation condition or a sponge layer technique is implemented to minimize wave reflection into the computational domain 3 numerical algorithms 3 1 grid system the 3d grid system used in both of the present models is built from horizontal rectangular grids and a general vertical boundary fitted coordinate system in this grid system each rectangular block defines a grid cell by introducing the grid indexes i j and k in the x y and z directions respectively the cell center is identified by i j k and the cell faces are denoted by i 1 2 j k i j 1 2 k and i j k 1 2 in the horizontal plane the horizontal velocity components and free surface elevation are defined at staggered locations as shown in fig 1 the horizontal velocity components normal to each cell face are defined at the point of intersection between the face and the segment joining the centers of the two cells that share the face the free surface elevation is located in the center of the cell in the vertical direction a novel grid arrangement is employed which renders the models relatively simple in their discretized forms and the discretized poisson equation for nonhydrostatic pressure corrections symmetric following stelling and zijlema 2003 to apply the dirichlet boundary condition for the nonhydrostatic pressure precisely on the free surface the nonhydrostatic term is defined at the centers of the top and bottom faces of each grid cell see fig 1 however the definition of the vertical velocity component does not follow a standard way stelling and zijlema 2003 wu et al 2010 young and wu 2010a young et al 2007 yuan and wu 2004 and is placed at the cell center following ai et al 2011 in addition both models employ the general vertical boundary fitted coordinate system ai et al 2014 in the vertical direction in which the horizontal levels z k 1 2 are given by 6 z k 1 2 z f k k f η x y t z f n z k f z f h x y k z f h x y k f k k f k k f k k f where z f z k f 1 2 is a fixed level in the given layer k f n z is the number of vertical layers and h is the water depth eq 6 shows that the vertical computational domain is divided into an upper and a lower region by the fixed level z f in each region the layer thickness is distributed uniformly the horizontal levels in the upper region move with time while these levels are fixed in the lower region fig 2 shows a schematic of the general vertical boundary fitted coordinate system notably z f can be defined as a horizontal level or a function of the horizontal position when z f h x y and k f 0 the general boundary fitted coordinate system defined by eq 6 is identical to the traditional boundary fitted coordinate system used in ai et al 2011 following ai et al 2011 and zijlema and stelling 2005 the governing eqs 1 4 are first integrated over the vertical layer k which is bounded by the levels z k 1 2 and z k 1 2 this gives the following equations details about the integration procedures are given in appendix a the continuity equation is 7 δ z k t δ z u k x δ z v k y ω k 1 2 ω k 1 2 0 the horizontal momentum equations are 8 δ z u k t δ z u u k x δ z u v k y ω k 1 2 u k 1 2 ω k 1 2 u k 1 2 g δ z k η x δ z k q x 0 9 δ z v k t δ z u v k x δ z v v k y ω k 1 2 v k 1 2 ω k 1 2 v k 1 2 g δ z k η y δ z k q y 0 the vertical momentum equation is 10 δ z w k t δ z u w k x δ z v w k y ω k 1 2 w k 1 2 ω k 1 2 w k 1 2 δ z k q z 0 where δ z k z k 1 2 z k 1 2 and ω k 1 2 is the vertical velocity relative to layer level z k 1 2 by virtue of 11 δ z u k t δ z k u k t u k δ z k t substituting eq 7 into eq 11 gives the following expression 12 δ z u k t δ z k u k t u k δ z u k x δ z v k y u k ω k 1 2 u k ω k 1 2 therefore substituting eq 12 into eq 8 gives 13 u k t a d v u k g η x q x where a d v u k represents the advection term for u k and can be expressed as 14 a d v u k 1 δ z k δ z u u k x δ z u v k y u k δ z k δ z u k x δ z v k y ω k 1 2 δ z k u k 1 2 u k ω k 1 2 δ z k u k 1 2 u k similarly eqs 9 and 10 can also be written as follows 15 v k t a d v v k g η y q y 16 w k t a d v w k q z where a d v v k and a d v w k represent the advection terms for v k and w k respectively and are expressed as 17 a d v v k 1 δ z k δ z u v k x δ z v v k y v k δ z k δ z u k x δ z v k y ω k 1 2 δ z k v k 1 2 v k ω k 1 2 δ z k v k 1 2 v k 18 a d v w k 1 δ z k δ z u w k x δ z v w k y w k δ z k δ z u k x δ z v k y ω k 1 2 δ z k w k 1 2 w k ω k 1 2 δ z k w k 1 2 w k where w k 1 2 w k 1 w k 2 when k n z for w n z 1 2 which is defined at the free surface it is calculated by solving the continuity eq 1 in a half free surface layer 3 2 numerical discretization the pressure correction method consisting of two major steps is employed to solve eqs 1 13 15 and 16 in the first step the intermediate velocities u i 1 2 j k n 1 2 v i j 1 2 k n 1 2 and w i j k n 1 2 are obtained by solving the momentum eqs 13 15 and 16 which contain the nonhydrostatic pressure at the preceding time level to obtain models that are independent of free surface wave speed the horizontal gradient terms of the water surface in eqs 13 and 15 are discretized by a semi implicit method 19 u i 1 2 j k n 1 2 u i 1 2 j k n δ t a d v u i 1 2 j k n g η x i 1 2 j n θ q x i 1 2 j k n 20 v i j 1 2 k n 1 2 v i j 1 2 k n δ t a d v v i j 1 2 k n g η y i j 1 2 n θ q y i j 1 2 k n 21 w i j k n 1 2 w i j k n δ t a d v w i j k n q z i j k n where η n θ 1 θ η n θ η n 1 and θ is an implicitness factor and has to be chosen in the range 0 5 θ 1 for stability in all the simulations in the present paper θ 0 5 is used for details about the discretizations of a d v u i 1 2 j k n a d v v i j 1 2 k n and a d v w i j k n the reader can refer to ai et al 2011 in eqs 19 21 the gradient terms of the water surface and nonhydrostatic pressure are discretized by means of the central differencing scheme in the second step the new velocities u i 1 2 j k n 1 v i j 1 2 k n 1 and w i j k n 1 are obtained by correcting the intermediate values after including the nonhydrostatic pressure correction term this gives 22 u i 1 2 j k n 1 u i 1 2 j k n 1 2 δ t δ q x i 1 2 j k 23 v i j 1 2 k n 1 v i j 1 2 k n 1 2 δ t δ q y i j 1 2 k 24 w i j k n 1 w i j k n 1 2 δ t δ q z i j k n where δ q q n 1 q n is the nonhydrostatic pressure correction term and is computed from the poisson equation which is obtained by the combination of the discrete continuity and momentum equations the continuity eq 1 is also discretized in semi implicit finite difference form and this gives 25 u i 1 2 j k n θ u i 1 2 j k 1 n θ u i 1 2 j k n θ u i 1 2 j k 1 n θ 2 δ x v i j 1 2 k n θ v i j 1 2 k 1 n θ v i j 1 2 k n θ v i j 1 2 k 1 n θ 2 δ y w i j k n θ w i j k 1 n θ δ z i j k 1 2 0 where k 2 n z and δ z i j k 1 2 δ z i j k 1 δ z i j k 2 for k 1 the continuity eq 1 is discretized in a half bottom layer which gives the following discrete equation by setting w i j 1 2 n θ 0 26 u i 1 2 j 1 n θ u i 1 2 j 1 n θ δ x v i j 1 2 1 n θ v i j 1 2 1 n θ δ y w i j 1 n θ δ z i j 1 2 0 where δ z i j 1 2 δ z i j 1 2 there is no need to discretize the continuity equation in a half free surface layer because the following poisson equation derived from eqs 25 and 26 is enough to determine all the unknown variables in addition w i j 1 2 n θ should be determined by the kinematic bottom condition for an uneven bottom however this has little effects on the results of test cases involving uneven bottom in this study by substituting the expressions for the new velocities from eqs 22 24 into eqs 25 and 26 respectively and considering the zero pressure condition on the free surface δ q n z 1 2 0 the poisson equation for the nonhydrostatic pressure correction term is derived and can be written in matrix form as 27 a δ q b where a is a sparse coefficient matrix δ q is a vector of the nonhydrostatic pressure correction term and b is a known vector related to explicit and intermediate velocities the coefficients of eq 27 are provided in appendix b a semi implicit finite difference approximation for eq 5 is taken to be 28 η i j n 1 η i j n δ t 1 δ x k 1 n z δ z i 1 2 j k n u i 1 2 j k n θ k 1 n z δ z i 1 2 j k n u i 1 2 j k n θ 1 δ y k 1 n z δ z i j 1 2 k n v i j 1 2 k n θ k 1 n z δ z i j 1 2 k n v i j 1 2 k n θ 0 by substituting eqs 22 and 23 and eqs 19 and 20 into eq 28 we can obtain the following expression 29 η i j n 1 η i j n δ t g δ t θ δ x k 1 n z δ z i 1 2 j k n η x i 1 2 j n θ k 1 n z δ z i 1 2 j k n η x i 1 2 j n θ g δ t θ δ y k 1 n z δ z i j 1 2 k n η y i j 1 2 n θ k 1 n z δ z i j 1 2 k n η y i j 1 2 n θ 1 δ x k 1 n z δ z i 1 2 j k n u i 1 2 j k n k 1 n z δ z i 1 2 j k n u i 1 2 j k n 1 δ y k 1 n z δ z i j 1 2 k n v i j 1 2 k n k 1 n z δ z i j 1 2 k n v i j 1 2 k n δ t θ δ x k 1 n z δ z i 1 2 j k n a d v u i 1 2 j k n k 1 n z δ z i 1 2 j k n a d v u i 1 2 j k n δ t θ δ y k 1 n z δ z i j 1 2 k n a d v v i j 1 2 k n k 1 n z δ z i j 1 2 k n a d v v i j 1 2 k n δ t θ δ x k 1 n z δ z i 1 2 j k n q x i 1 2 j k n k 1 n z δ z i 1 2 j k n q x i 1 2 j k n δ t θ δ y k 1 n z δ z i j 1 2 k n q y i j 1 2 k n k 1 n z δ z i j 1 2 k n q y i j 1 2 k n β δ t θ δ x k 1 n z δ z i 1 2 j k n δ q x i 1 2 j k k 1 n z δ z i 1 2 j k n δ q x i 1 2 j k β δ t θ δ y k 1 n z δ z i j 1 2 k n δ q y i j 1 2 k k 1 n z δ z i j 1 2 k n δ q y i j 1 2 k notably a factor β 0 or 1 is introduced in the above equation for consistency with eq 28 eq 7 is also discretized by the semi implicit method to calculate ω k 1 2 this gives 30 δ z i j k n 1 δ z i j k n δ t 1 δ x δ z i 1 2 j k n u i 1 2 j k n θ δ z i 1 2 j k n u i 1 2 j k n θ 1 δ y δ z i j 1 2 k n v i j 1 2 k n θ δ z i j 1 2 k n v i j 1 2 k n θ ω i j k 1 2 n θ ω i j k 1 2 n θ 0 3 3 solution procedure the overall solution procedure is summarized as follows 1 calculate the free surface η i j n 1 by solving eq 29 which neglects the nonhydrostatic pressure correction δ q eq 29 constitutes a strongly diagonally dominant symmetric and positive definite system which is solved by the conjugate gradient method 2 calculate the intermediate velocities u i 1 2 j k n 1 2 v i j 1 2 k n 1 2 and w i j k n 1 2 by using eqs 19 21 3 calculate the nonhydrostatic pressure correction δ q by using eq 27 which is solved on gpu in conjunction with the conjugate gradient method details about the gpu implementation of eq 27 are given in section 3 4 4 update the intermediate velocities by using eqs 22 24 to obtain the new velocities u i 1 2 j k n 1 v i j 1 2 k n 1 and w i j k n 1 5 calculate the vertical velocity relative to layer level ω i j k 1 2 n 1 by using eq 30 note that considering the kinematic bottom and free surface conditions ω 1 2 n 1 ω i j n z 1 2 n 1 0 the above procedure corresponds to β 0 in eq 29 which results in the noniterative semi implicit model when β 1 an iterative procedure is required by repeating steps 1 to 3 until convergence is reached clearly the noniterative model may be computationally more efficient than the iterative model as demonstrated theoretically by kang and fringer 2005 both models are second order accurate in time for nonhydrostatic free surface flows it is worth mentioning that if the pressure projection method is employed β 0 results in the first order temporal accuracy and β 1 still enable the model to be second order accurate in time vitousek and fringer 2013 3 4 gpu implementation of the poisson equation the sparse matrix a in eq 27 contains 10 nonzero diagonals in the bottom layer and 15 nonzero diagonals in the other layers moreover this matrix is symmetric as presented in appendix b in this study the conjugate gradient method is used to solve eq 27 because solving the poisson equation is computationally intensive and is the most time consuming part of both solvers the solution of eq 27 is outsourced to the gpu via a function called kernel which implements the conjugate gradient method in the cuda programming environment a kernel is called by a host cpu and is executed on a device gpu both the cpu and gpu have their own memory data must be transferred between cpu memory and gpu memory however to achieve high performance data transfer should be minimized to reduce memory latency in this study before the kernel is called from the host the vector b and the nonzero coefficients of the matrix a are transferred from cpu memory to gpu memory then after the solution is obtained on gpu it is copied from gpu memory to cpu memory the computationally intensive algorithmic components of the conjugate gradient method mainly include vector addition and vector dot product the implementations of these components on gpu are described in sanders and kandrot 2010 as presented in the above section the poisson equation may be solved many times at each time step for the iterative model normally the matrix a and the vector b are copied from cpu memory to gpu memory every time before solving the poisson equation however because the coefficients of matrix a presented in appendix b are constant within each time step to reduce data transfer latency they are transferred only once before first solving the poisson equation 4 accuracy and efficiency in this section we focus on the accuracy of both models in resolving linear dispersion relations and the efficiency of both serial models by conducting a series of numerical simulations of linear standing waves in all the simulations the layer thickness is uniformly distributed over the water depth we consider linear standing waves in a closed basin of constant depth the basin has a length of l with a constant depth of h 10 m the initial free surface displacement is given as 31 η x t 0 a cos k x cos 2 π t t 0 x l where a and t are the amplitude and wave period of the standing wave and k 2 π l is the wavenumber here the wavelength equals the length of the basin to generate various k h values ranging from shallow water to intermediate water to deep water waves we change the length of the basin but maintain the linear wave condition by adjusting the wave amplitude the horizontal grid size and the time step are firstly set to δ x l 20 and δ t t 40 respectively the normalized wave celerity obtained with two vertical layers versus k h is depicted in fig 3 in which c and c 0 g h are the wave speed and long wave celerity respectively the computed wave celerity is the average value estimated over ten wave periods in the investigated range of k h 5 the iterative model accurately predicts the wave celerity but the noniterative model results gradually deviate from the analytical solution with increases in k h this implies that with the same number of vertical layers the accuracy of the noniterative model may be not as good as that of the iterative model for higher dispersive waves in deep water depths if both models are implemented in the same horizontal and vertical spatial resolution and relatively coarse temporal resolution this can be further demonstrated by fig 4 to present the effect of the number of vertical layers on both of the models accuracy fig 4 displays normalized percentage errors versus a wide range of k h values with increasing vertical layers the iterative model can accurately predict linear dispersive waves up to larger k h values we can define a normalized percentage error as ε c linear c comp c linear where c linear is the phase speed of linear waves and c comp is the average wave speed estimated over ten wave periods for a given tolerance error of ε 1 the iterative model with two three and five layers is accurate up to k h 7 15 and 40 respectively accordingly the noniterative model is only accurate up to k h 3 notably vitousek and fringer 2013 also investigated the accuracy of the two semi implicit algorithms in resolving linear dispersion relations by using a similar test case both semi implicit algorithms showed almost identical results in the investigated water depth range of k h 4 however in the study of vitousek and fringer 2013 the computed wave speed was only estimated over one wave period and only a small range of dimensionless water depth was considered accordingly the accuracy of both present models was assessed severely in this paper because the computed wave speed was estimated over ten wave periods and a wider range of dimensionless water depth was considered to show the influences of both the time step and the horizontal grid size on the two models table 1 presents the normalized percentage errors obtained with different combinations of the time step and the horizontal grid size for k h 10 numerical results with only two and three layers are given because the results with more vertical layers are very similar to those with three layers for the noniterative model by setting δ x l 20 its accuracy is improved significantly by decreasing the time step for the smallest time step of δ t t 160 the accuracy of the noniterative model is close to that of the iterative model however by setting δ t t 160 refining the horizontal grid size almost has no effect on the accuracy of the noniterative model for the iterative model both the time step and the horizontal grid size has little effect on its accuracy the results presented in fig 4 and table 1 imply that both developed models can accurately predict higher dispersive waves with the same time step which is not sufficiently small the iterative model is more accurate than the noniterative model the accuracy of the iterative model can be improved significantly by refining the vertical layers while the accuracy of the noniterative model can be increased by decreasing the time step to better compare both semi implicit models in resolving the linear dispersion relationship in terms of the spatial and temporal resolution it is necessary to derive the numerical dispersion relationship following vitousek and fringer 2013 however this paper only focuses on the development and numerical assessment of the two semi implicit models to show the serial implemented efficiency of both models in response to changes in the horizontal and vertical resolutions we also consider a linear standing wave with a 0 01 m h 10 m and k h 2 5 we define a reference case in which the horizontal grid size of δ x l 20 and two uniform vertical layers are used the same time step is employed for the two models fig 5 a depicts the nondimensional cpu time versus the horizontal resolution increasing factor and fig 5 b shows the comparison of the computational expense between the two models the cpu time shown in fig 5 a is nondimensionalized with respect to that of the reference case while the relative cpu time shown in fig 5 b is the ratio of the computational expense of the iterative model to that of the noniterative model the horizontal resolution increasing factor f h is defined as the ratio of the number of horizontal grid cells to the number of horizontal grid cells employed in the reference case fig 5 a shows that for both models the cpu time increases with increasing horizontal resolution and it increases dramatically when f h 6 as expected fig 5 b shows that the iterative model is more time consuming than the noniterative model the maximum relative cpu time reaches approximately 2 5 while the minimum value is only approximately 1 1 fig 6 a and b show the nondimensional cpu time and the relative cpu time versus the vertical resolution increasing factor respectively the vertical resolution increasing factor f v is defined as the ratio of the number of vertical layers to the number of vertical layers employed in the reference case fig 6 shows that for both models the cpu time increases moderately with the increase in the vertical resolution and the iterative model is also more time consuming than the noniterative model the minimum relative cpu time is 1 1 and the maximum value only reaches approximately 1 4 overall the relative cpu time ranges from 1 1 to 2 5 and all of the relative cpu time costs in the following test cases are within this range by comparing figs 5 a and 6 a it can also be concluded that for both models the computational efficiency is more sensitive to the horizontal resolution than to the vertical resolution 5 test cases both developed semi implicit models are further assessed with five test cases concerning nonlinear surface waves for which either analytical solutions or existing experimental data are available the first two examples focus on nearshore wave propagation in which wave shoaling nonlinearity dispersion reflection and diffraction phenomena occur the third example is used to evaluate the capabilities of both models to simulate nonlinear sloshing waves the last two examples of focusing waves are employed to test the abilities of both models to resolve nonlinear wave groups the acceleration of the poisson equation solver due to gpu parallelization is presented in the final test case which is computationally very expensive in all the computations the same horizontal grid sizes and the same time step are used for the two models 5 1 wave propagation over a submerged bar wave propagation over a submerged bar is a classical two dimensional 2d benchmark test case for the validation of nonlinear dispersive wave models beji and battjes 1993 and luth et al 1994 have conducted a series of laboratory experiments of the propagation of regular waves over a submerged trapezoidal bar in a wave flume in this study the numerical wave flume is 35 m long with 10 m of a sponge layer at the right end the still water depth h is 0 4 m and is reduced to 0 1 m at the submerged bar the upward and downward slopes of the bar are 1 20 and 1 10 respectively fig 7 shows the numerical model setup and free surface elevation measurement stations the present study focuses on two test cases namely case a and case c which involve sinusoidal incident waves with a wave height of h 0 2 0 cm and h 0 4 1 cm respectively and a wave period of t 2 02 s and t 1 01 s respectively experimental data obtained by luth et al 1994 are used for comparison with the numerical results case a with k h 0 67 has been used to verify a number of nonhydrostatic models bradford 2005 casulli 1999 ma et al 2012 stelling and zijlema 2003 wu et al 2010 yuan and wu 2004 however case c with k h 1 69 has a relatively short wavelength and to our knowledge only comparison results obtained by the nonhydrostatic model developed by stelling and zijlema 2003 have been published for this case in this computation for cases a and c the horizontal grid spacing values are set to δ x 0 025 m and 0 0125 m respectively and the time steps are δ t 0 01 s and 0 005 s respectively in both cases the vertical boundary fitted coordinate system is constructed by using two vertical layers with z f h x y and k f 0 figs 8 and 9 show comparisons of the free surface elevation between the two sets of numerical results and the experimental data for case a and c both models predict well wave propagation over the bar which involves the generation of bound higher harmonics via the increase in nonlinearity at the shoaling stage and the transformation of wave patterns due to the release of higher harmonics at the deshoaling stage there are almost no differences between the two model results both models with only two vertical layers are in good agreement with the measurements indicating that both developed models can accurately predict 2d nearshore wave propagation in which wave shoaling nonlinearity and dispersion occur 5 2 wave transformation over a circular shoal this example examines the capabilities of both models to predict 3d nearshore wave propagation the numerical results are compared with experimental data from chawla 1995 the experimental setup is shown in fig 10 in which a circular shoal is placed on a flat bottom the boundary of the shoal is given by 32 x 5 2 y 8 98 2 6 6049 whereas the depth on the shoal is 33 h x y h 8 73 82 81 x 5 2 y 8 98 2 where h 0 45 m is the still water depth the incident wave with a wave height h 0 1 18 cm and a wave period t 0 1 0 s is specified at the left boundary resulting in k h 1 90 at the right end of the computational domain a sommerfeld s radiation boundary is used to minimize wave reflection the same test case has been used to verify the nonhydrostatic model developed by zijlema and stelling 2005 in this computation a uniform grid of δ x δ y 0 05 m is used in the horizontal domain and the constant time step is set to δ t 0 02 s similar to the former example the vertical boundary fitted coordinate system is also constructed by using two vertical layers with z f h x y and k f 0 for both models the total grid number is therefore 440 364 2 320320 both simulations are run for 40 s fig 11 shows comparisons among the normalized wave heights at four sections of the two sets of numerical results and experimental data only minor discrepancies exist between the two numerical models generally both model results are in good agreement with the measured data this demonstrates the capabilities of both models for resolving 3d nearshore wave propagation in which wave shoaling reflection and diffraction occur 5 3 nonlinear sloshing waves in this example we consider nonlinear sloshing motions in a closed basin the basin has a length of l 2 0 m and a still water depth of h 1 0 m the initial free surface profile also follows eq 31 but two wave steepnesses of a k 0 1 and 0 2 are considered in the simulations in which k 2 π l such that k h π similar test cases have been used to verify other nonhydrostatic models ai et al 2014 young et al 2007 the second order analytical solution described in wu et al 1998 is used for the comparison with numerical results a horizontal grid spacing of δ x l 40 and time step of δ t t 40 are used in the computations where t is the wave period in the vertical direction the grid system is constructed by using ten vertical layers with z f 0 1 m and k f 9 for both models comparisons of the time histories of the free surface elevation at x l 2 among the two sets of numerical results and analytical solutions are depicted in fig 12 a notable discrepancy between the results of the two models occurs in the last few wave periods the difference between the results of the two models is more apparent in the case of large wave steepness than in the case of small wave steepness overall with the same horizontal grid spacing and the time step the iterative model results are in good agreement with the analytical solution and are better than the noniterative model results 5 4 2d focusing waves the spatial temporal focusing of wave groups at one point in space and time is believed to be one of the physical mechanisms contributing to the formation of extreme waves many researchers have made a great deal of effort to investigate focusing behavior by using laboratory experiments baldock et al 1996 baldock and swan 1996 johannessen and swan 2001 ma et al 2010 ning et al 2009 in the last decade nonhydrostatic models for simulating focusing wave groups have received increased attention in this example to assess both models representation of 2d nonlinear focusing waves experiments conducted by baldock et al 1996 which have been reproduced by few nonhydrostatic models ai et al 2014 young and wu 2010a are used the dimension of the computational domain is 0 x 20 m the still water depth is h 0 7 m a 5 m sponge layer is applied at the end of the computational domain x 20 m the two period ranges or frequency bands indicated in table 2 are considered in the present simulations case b55 corresponds to a broad bandwidth and case d55 represents a narrow bandwidth both cases have the same input wave amplitude of a n 1 n a n 55 mm where n 29 is the number of frequency components and a n defines the amplitude of each component wave components are of equal amplitude and equally spaced within the period range the inflow boundary is specified at x 0 m and the imposed normal velocity components are given by 34 u x z t n 1 n a n ω n cosh k n h z sin h k n h cos k n x x f ω n t t f where k n and ω n denote the wavenumber and frequency of each component respectively satisfying the linear dispersion relationship and x f 8 m and t f 30 s are the theoretical focusing position and time respectively in this computation for the narrow bandwidth case case d55 the horizontal domain is discretized by setting the grid spacing at δ x 0 025 m and the time step is taken as δ t 0 005 s to accurately predict the focusing position and time in the broad bandwidth case case b55 a refined grid with δ x 0 0125 m and a small time step of δ t 0 0025 s are used the vertical boundary fitted coordinate system is constructed by using seven vertical layers with z f 0 1 m and k f 6 figs 13 and 14 show comparisons of the temporal and spatial wave profiles among the two sets of numerical results and experimental data for case b55 and case d55 where t r t t f and x r x x f generally the results of both models are in good agreement with the experimental data however the noniterative model slightly underestimates the main wave crest accordingly the focusing position and time are also underpredicted by the noniterative model table 3 compares the calculated focusing positions and times with the measured data which are estimated from fig 10 of baldock et al 1996 the iterative model overestimates the focusing position and time by 6 9 and 9 5 respectively for case b55 and only underestimates focusing position and time by 0 7 and 3 0 respectively for case d55 accordingly the noniterative model underestimates the focusing position and time by 12 6 and 20 1 respectively for case b55 and by 10 4 and 13 4 respectively for case d55 5 5 3d focusing waves in the last example experimental data from johannessen and swan 2001 are used to verify both models representation of 3d nonlinear focusing waves similar problems have also been predicted by few nonhydrostatic models ai et al 2014 young and wu 2010b as shown in fig 15 the dimensions of the computational domain are 0 x 13 m and 0 y 25 m the still water depth is h 1 2 m a 5 0 m sponge layer is applied at the end of the computational domain as presented in table 4 we considered two wave groups with different input amplitudes the largest input amplitude i e a 78 mm is very close to the limit at which incipient wave breaking occurs each wave group consists of n 28 frequency components and in each frequency there are m 91 direction components for each frequency component the frequency f n is equally spaced within the frequency range and the wave amplitude a n is proportional to f n 2 for each direction component the direction θ m ranges from 45 to 45 the inflow boundary is specified at x 0 m and the imposed normal velocity components can be expressed as 35 u x y z t n 1 n a n ω n cosh k n h z sin h k n h m 1 m b n m cos k n x x f cos θ m y y f sin θ m ω n t t f where x f y f 5 5 12 5 m is the theoretical focusing position t f 50 s is the theoretical focusing time and b n m is the directional spread of wave components which is normalized so that m 1 m b n m 1 in this study the directional spread is independent of the wave frequency and is expressed by adopting the following typical spreading parameter 36 b θ m b cos s θ m 2 where b is a normalizing coefficient and s is the directional spread parameter in this computation we choose the horizontal grid spacing of δ x 0 025 m and δ y 0 05 m and construct the vertical boundary fitted coordinate system by employing ten vertical layers with z f 0 12 m and k f 9 the chosen time step is 0 005 s and the total simulation time is up to 54 s fig 16 shows comparisons of the time histories of the free surface elevation at the focusing position among the two sets of numerical results and experimental data for the case with a small input amplitude case d4555 the results of both models are very close and are in good agreement with the experimental data however the iterative model results are slightly better than the noniterative model results for the case with a large input amplitude case d4578 because the main wave crest is slightly underestimated by the noniterative model comparisons of the focusing position and time among the results of both models and measured data are shown in table 5 the measured data are estimated from fig 12 of johannessen and swan 2001 for case d4555 both models predict the focusing position very well but overestimate the focusing time significantly the iterative model overestimates the focusing position by only 1 8 and the noniterative model underestimates the focusing position by only 2 0 the significant overestimation of the focusing time by both models may be attributed to inaccurately measured data because as easily found in fig 12 of johannessen and swan 2001 the measured focusing time for case d4555 is much lower than the best fit polynomial for the measured data for case d4578 the iterative model underestimates the focusing position and time by 4 9 and 14 0 respectively accordingly the noniterative model underestimates the focusing position and time by 15 6 and 24 5 respectively to test the performance of the gpu implementation of the poisson equation in both models case d4578 is solved by using the serial and gpu accelerated versions of the code all computations are carried out with single precision floating point numbers the test environment is based on a desktop computer with an intel r core tm i7 7700k cpu and a nvidia geforce gtx 1080 ti gpu the cpu is a quad core processor with eight threads that has a base frequency of 4 2 ghz and peak frequency of 4 5 gh with 8 mb l3 cache the gpu consists of 3584 cuda cores and has a total memory bandwidth of 484 gb s each cuda core has a base clock rate of 1480 mhz and a boost frequency of 1582 mhz the performance of the gpu accelerated poisson solver is presented in table 6 the cpu time is measured by executing the serial code in a single thread while the gpu time is the parallel running time on the gpu the speedups with respect to a single thread cpu are 16 61 and 17 18 for the noniterative model and iterative model respectively the greatest speedup value is obtained by the iterative model which is attributed to the fact that the gpu accelerated part of the iterative model is more computationally intensive than that of the noniterative model because for the iterative model the poisson equation may need to be solved many times at each time step 6 conclusions in this paper two nonhydrostatic models namely iterative and noniterative models are developed to simulate surface water waves both models employ the semi implicit method to discretize the free surface and solve the 3d incompressible nses with the pressure correction method to improve both models efficiency the poisson equation solver is run on gpu in conjunction with the conjugate gradient method an assessment of both models accuracy in resolving the linear dispersion relation is conducted for a wide range of k h values it is inferred that for the long term evolution of higher dispersive waves the iterative model is more accurate than the noniterative model when the time step is not sufficiently small by refining the vertical layers the accuracy of the iterative model can be improved significantly by decreasing the time step the accuracy of the noniterative model can be increased the serially implemented efficiency of both models is also tested in resolving linear dispersive waves the iterative model is computationally more expensive than the noniterative model the ratio of the cpu time consumed by the iterative model to that spent by the noniterative model is in the range of 1 1 2 5 both models efficiency is more sensitive to the horizontal grid resolution than the vertical grid resolution for wave propagation over uneven bottoms the overall good agreements between the two sets of model results and experimental data indicate that both models by using only two vertical layers can accurately simulate nearshore wave propagation involving wave shoaling nonlinearity dispersion reflection and diffraction phenomena for the investigated k h values for nonlinear sloshing waves with k h π with the same horizontal grid sizes and the same time step the iterative model results are better than the noniterative model results and are in good agreement with the analytical solution in the last two examples involving 2d and 3d focusing wave groups the iterative model predicts slightly larger values of the focusing position and time than the noniterative model by considering the measurement errors and uncertainties in the developed models both models well resolved the 2d and 3d focusing wave groups the acceleration due to gpu parallelization is evaluated in the 3d focusing wave group test which is very computationally expensive a speedup of approximately 17 times for both of the developed models is observed due to the current gpu implementation of the poisson equation in general by considering the accuracy and efficiency of both semi implicit models the noniterative model is preferable to the iterative model for predicting nearshore wave propagation both models are capable of accurately predicting the long term evolution of surface waves in deep water conditions and can perform well in the test cases involving focusing wave groups moreover the computational times of both models can be reduced by using gpu parallelization acknowledgments this work was supported by the national key research and development program china grant no 2017yfc1404200 the national natural science foundation of china grant nos 51679031 51720105010 51309052 the high tech ship research projects sponsored by the ministry of industry and information technology miit of china grant no 2016 23 7 and the fundamental research funds for the central universities china grant nos dut16td08 dut18zd401 appendix a integration procedures for eqs 1 4 eqs 7 10 are obtained by integrating eqs 1 4 some details about the integration procedures are given as follows by integrating eq 1 over a layer thickness of δ z k z k 1 2 z k 1 2 and using the leibniz rule given by a 1 z k 1 2 z k 1 2 u x v y w z d z δ z u k x δ z v k y u z x z k 1 2 z k 1 2 v z y z k 1 2 z k 1 2 w k 1 2 w k 1 2 0 the relations between w k 1 2 and ω k 1 2 can be expressed as a 2 w k 1 2 ω k 1 2 z k 1 2 t u k 1 2 z k 1 2 x v k 1 2 z k 1 2 y by substituting eq a 2 into eq a 1 the layer integrated continuity eq 7 is obtained to obtain eq 8 the left side terms of eq 2 are first integrated over a layer thickness using the leibniz rule the integration result is written as a 3 z k 1 2 z k 1 2 u t d z z k 1 2 z k 1 2 u 2 x u v y u w z d z δ z u k t u z t z k 1 2 u z t z k 1 2 x z k 1 2 z k 1 2 u 2 d z y z k 1 2 z k 1 2 u v d z ω k 1 2 z k 1 2 t u z k 1 2 ω k 1 2 z k 1 2 t u z k 1 2 where eq a 2 has been substituted the above eq a 3 can be simplified as follows a 4 z k 1 2 z k 1 2 u t d z z k 1 2 z k 1 2 u 2 x u v y u w z d z δ z u k t δ z u u k x δ z u v k x ω u k 1 2 ω u k 1 2 it can be easily found that the eq a 4 is identical to the left side terms of eq 8 then a similar integration procedure is applied to the right side terms of eq 2 because diffusion terms are not considered in the study and the water surface gradient is independent of the integration only the layer integrated nonhydrostatic pressure gradient is given as a 5 z k 1 2 z k 1 2 q x d z δ z q k x q z x z k 1 2 q z x z k 1 2 δ z k q x k q k q k 1 2 z k 1 2 x q k 1 2 q k z k 1 2 x the second and third terms in the above equation were neglected in the present models however for steep topography one may recover these terms to reduce errors due to the treatment of the nonhydrostatic pressure gradient following a similar procedure eqs 9 and 10 be obtained by integrating eqs 3 and 4 respectively details about this procedure are not given for brevity appendix b coefficients of the poisson equation for nonhydrostatic pressure corrections by substituting the expressions for the new velocities from eqs 22 24 into eq 25 the following equation for k 2 n z is obtained b 1 a 1 δ q i j k 1 2 a 2 δ q i j k 1 2 a 3 δ q i j k 3 2 a 4 δ q i 1 j k 1 2 a 5 δ q i 1 j k 1 2 a 6 δ q i 1 j k 3 2 a 7 δ q i 1 j k 1 2 a 8 δ q i 1 j k 1 2 a 9 δ q i 1 j k 3 2 a 10 δ q i j 1 k 1 2 a 11 δ q i j 1 k 1 2 a 12 δ q i j 1 k 3 2 a 13 δ q i j 1 k 1 2 a 14 δ q i j 1 k 1 2 a 15 δ q i j 1 k 3 2 f where b 2 a 1 θ δ t 2 δ x 2 θ δ t 2 δ y 2 θ δ t δ z i j k 1 2 δ z i j k b 3 a 2 θ δ t δ x 2 θ δ t δ y 2 θ δ t δ z i j k 1 2 1 δ z i j k 1 1 δ z i j k b 4 a 3 θ δ t 2 δ x 2 θ δ t 2 δ y 2 θ δ t δ z i j k 1 2 δ z i j k 1 b 5 a 4 a 6 a 7 a 9 θ δ t 4 δ x 2 b 6 a 5 a 8 θ δ t 2 δ x 2 b 7 a 10 a 12 a 13 a 15 θ δ t 4 δ y 2 b 8 a 11 a 14 θ δ t 2 δ y 2 and b 9 f 1 2 δ x u i 1 2 j k n θ 2 u i 1 2 j k 1 n θ 2 u i 1 2 j k n θ 2 u i 1 2 j k 1 n θ 2 1 2 δ y v i j 1 2 k n θ 2 v i j 1 2 k 1 n θ 2 v i j 1 2 k n θ 2 v i j 1 2 k 1 n θ 2 1 δ z i j k 1 2 w i j k n θ 2 w i j k 1 n θ 2 with b 10 u n θ 2 1 θ u n θ u n 1 2 b 11 v n θ 2 1 θ v n θ v n 1 2 b 12 w n θ 2 1 θ w n θ w n 1 2 similarly by substituting the expressions for the new velocities from eqs 22 24 into eq 26 the resulting equation for the half bottom layer k 1 can be expressed as b 13 b 1 δ q i j 3 2 b 2 δ q i j 1 2 b 3 δ q i 1 j 3 2 b 4 δ q i 1 j 1 2 b 5 δ q i 1 j 3 2 b 6 δ q i 1 j 1 2 b 7 δ q i j 1 3 2 b 8 δ q i j 1 1 2 b 9 δ q i j 1 3 2 b 10 δ q i j 1 1 2 g where b 14 b 1 θ δ t δ x 2 θ δ t δ y 2 θ δ t δ z i j 1 2 δ z i j 1 b 15 b 2 θ δ t δ x 2 θ δ t δ y 2 θ δ t δ z i j 1 2 δ z i j 1 b 16 b 3 b 4 b 5 b 6 θ δ t 2 δ x 2 b 17 b 7 b 8 b 9 b 10 θ δ t 2 δ y 2 and b 18 g 1 δ x u i 1 2 j 1 n θ 2 u i 1 2 j 1 n θ 2 1 δ y v i j 1 2 1 n θ 2 v i j 1 2 1 n θ 2 1 δ z i j 1 2 w i j 1 n θ 2 the set of eqs b 1 and b 13 forms the poisson equation 27 which is a sparse linear symmetric system that contains 10 nonzero diagonals in the bottom layer and 15 nonzero diagonals in the other layers 
24004,averaging techniques are used to generate upscaled forms of the shallow water equations for storm surge including subgrid corrections these systems are structurally similar to the standard shallow water equations but have additional terms related to integral properties of the fine scale bathymetry topography and flow as the system only operates with coarse scale variables such as averaged fluid velocity relating to flow these fine scale integrals require closures to relate them to the coarsened variables closures with different levels of complexity are identified and tested for accuracy against high resolution solutions of the standard shallow water equations results show that for coarse grids in complex geometries inclusion of subgrid closure terms greatly improves model accuracy when compared to standard solutions and will thereby enable new classes of storm surge models keywords subgrid methods storm surge numerical methods mathematical modeling shallow water equations 1 introduction modern storm surge models have been split into two disparate branches based on their intended uses 1 low resolution ensemble forecasts using hundreds to thousands of surge model runs these models are largely used before tropical cyclone landfalls or for climatological surge studies zachry et al 2017 each realization is typically run on a single computational core and uses relatively coarse computational grids to ensure that they can finish the many runs required within tight forecast windows 2 high resolution simulations these are either performed singly or in small ensembles in forecasts or in potentially much larger quantity for hindcasts or climatological studies such simulations are almost invariably run on large parallel computing systems anon 2015 hope et al 2013 differences between these two varieties of simulation are characterized by run times and accuracy low resolution models are much faster but have generally lower accuracy and vice versa for high resolution models kerr et al 2013 this state of affairs has existed for at least the past decade but neither camp is entirely satisfied the low resolution modelers would like to increase accuracy while the high resolution camp often cannot complete simulations in the times it desires and also requires expensive computational hardware that is not readily available to many furthermore extremely high resolution topographic and bathymetric datasets are increasingly becoming available in many locations with detail that cannot currently be resolved by any large scale surge models danielson et al 2018 an intermediate path exists with the use of subgrid models defina 2000 casulli 2009 casulli and stelling 2011 volp et al 2013 it is well known that quantities in high resolution models are not completely independent for example nearby surface elevations are very highly correlated so knowledge at one location implies a good knowledge of surface elevations at nearby locations also even if they lie on a different computational grid cell subgrid models make use of such correlations to strongly reduce the number of computational degrees of freedom while retaining their bulk effects in modified sets of equations the fundamental assumption of subgrid models which is not often stated explicitly is that subgrid effects are uniquely defined and can be adequately represented by functions of coarsened averaged properties such as water levels or velocities combined with integral functions of high resolution ground elevations friction characteristics and so on the accuracy of subgrid solutions depends greatly on these coarsened properties for many cases systems display strong correlations that enable the subgrid system to retain almost all of the accuracy of the original high resolution system in other cases detailed subgrid properties may not be unique functions of coarsened properties a simple example is shown in fig 1 where water levels on either side of a levee are independent quantities in this case one water level is insufficient to represent important details of the system because the two water bodies are not connected however if the water level were high enough to inundate the levee then a single variable to represent water levels would become much more viable some of these same tradeoffs are also present usually unannounced and unevaluated in standard storm surge models where simple velocity elevation and bathymetry distributions within a cell are simply assumed to adequately represent the processes of interest the concept of subgrids is implicit in many aspects of hydrodynamics as one example manning s equation used in channel flow hydraulics te chow 1982 explicitly constructs a solution with lower degrees of freedom from higher resolution bathymetry and land cover similarly darcy s law for porous media flow aggregates the effects of very small scale unresolved features into a coarser scale continuum importantly it is possible to construct darcy s law from first principles using subgrid physical properties of a porous medium whitaker 1999 which is similar to our intention here subgrids for surge inundation circulation modeling have been explored previously by several groups but using somewhat different techniques than will be applied here defina 2000 developed a set of equations that looked much like the conservative form of the shallow water equations but with a correction to the mass conservation equation that accounts for partially wet partially dry regions and separate corrections to momentum and bottom friction arising from non uniform spatial velocities the wet dry fraction was assumed to have an error function variation with surface elevation casulli 2009 developed an elegant theory numerical technique for subgrid wetting and drying that guarantees non negative depths at the shoreline through the solution of a mildly nonlinear equation this system again closely resembles nonlinear shallow water equations with a correction for partially wet elements in contrast to defina s work casulli 2009 used lookup tables derived from high resolution bathymetry to obtain the wet fraction as a function of surface elevation sehili et al 2014 implemented results from casulli 2009 and casulli and stelling 2011 to examine storm surge flooding around hamburg and found that the subgrid system delivered similar accuracy to the standard shallow water equations but with around 5 of the cost this of course is a huge gain and enables both new problems to be studied and existing problems to be examined either in more detail or at much lower cost such subgrid models have had to make approximations for example bottom friction was computed using mean depth and velocity in sehili et al 2014 rather than as an integral over the detailed bathymetry more advanced closures require additional assumptions defina 2000 and volp et al 2013 2016 employed approximations including a steady friction gradient to obtain closed form solutions for integral friction that are exact for special cases such as steady channel flow and devised techniques to evaluate subgrid friction along individual strips of a cell wu et al 2017 2016 extended volp s results to include the effects of vegetation drag in salt marshes and applied the new system to a section of delaware bay d alpaos and defina 2007 further examined the effect of unresolved momentum mixing and found that these contributions could in some cases be modeled by increasing the effective bottom friction for coarse grid solutions these previous studies have shown considerable improvements in the resolution accuracy tradeoff but there remain significant uncertainties in closures and even in the basic forms of the equations to be used the present paper develops shallow water subgrid systems for storm surge using formal averaging methods e g whitaker 1999 these methods produce equations that are similar in many ways to those found in previous studies but have additional terms and closures that had been previously neglected and arise from the averaging process different levels of closures are identified as well as the information required for their implementation the systems are tested for accuracy and intercompared at different resolutions in the remainder of this paper section 2 derives the subgrid theory and discusses the different levels of closure section 3 tests the systems on idealized geometries and over the more complex real world environment of buttermilk bay massachusetts usa finally section 4 summarizes the present work and gives a framework for future research development and implementation activities 2 theory high resolution storm surge systems are generally governed by the depth integrated shallow water equations to be solved here in conservative form the conservation of mass equation is 1 h t h u x h v y 0 where u u v is the depth averaged horizontal velocity vector and the local total water depth is h h η where h is the still water depth and η is the free surface elevation the conservative form of the momentum equation is 2 h u t x h u u y h u v g h η x τ b x τ s x ρ 1 ρ p a x f c h v 1 ρ h τ x x x h τ x y y 3 h v t x h v u y h v v g h η y τ b y τ s y ρ 1 ρ p a y f c h u 1 ρ h τ x y x h τ y y y where τ b τ b x τ b y is the bed stress τ s τ s x τ s y is the surface stress τ x x τ x y and τ y y are depth averaged reynolds stresses p a is local atmospheric pressure and f c is the coriolis parameter when the topography and bathymetry are represented faithfully at high enough resolution and given the appropriate atmospheric forcing and bottom friction numerical systems based on these equations have been shown to provide accurate representations of storm surge for a variety of situations see for example bunya et al 2010 dietrich et al 2010 hope et al 2013 2 1 averaging tools subgrid equations are derived from the original high resolution equations 1 3 following techniques laid out in whitaker 1999 that were originally developed for use in the generation of equations for flow in porous media these result in new sets of equations for coarsened quantities but with corrections over the subgrid scale the averaging scale to be used here is a g the so called grid averaging area numerically this averaging scale must be at least as large as the coarse grid size but may be larger computational coarsened variables will be defined on this grid averaged scale with smaller scale variations smoothed out for some dummy quantity q hydrodynamic variables coarsened to the grid scale are defined as 4 q g 1 a g a w q d a where a w is the wet portion of a g this will be called the grid average and is denoted with subscript g an alternate average used here is the wet average which uses the wet portion of the averaging area and is defined as 5 q w 1 a w a w q d a this average will be denoted with subscript w the terms grid average and wet average are respectively equivalent to the phase average and intrinsic phase average found in e g whitaker 1999 for fully inundated completely wet grids these quantities will be identical the volume averaged velocity used here is defined as 6 u a g h u d a a g h d a because the depth is by definition zero in dry areas this quantity is identical if the integration limits are taken as the wet area rather than the entire grid although other definitions of velocity are possible use of a volume averaged velocity eliminates the necessity for closures in some terms often it is helpful to define coarsened variables in terms of the wet averages where integrals are defined only over the wet area for example the grid average of water surface elevation in partially wet regions has much less physical meaning than the wet average if we define the wet averaging area as 7 a w ϕ a g where ϕ is the wet fraction in the averaging area which may vary strongly with local surface elevations then for hydrodynamic quantity q 8 q g ϕ q w the grid averaged wet volume per unit area is now 9 where φ is a wet fraction for a given value z and p s 1 for s 0 and 0 for s 0 if subgrid bathymetry and topography are known and we assume that s t d η h w then ϕ φ η can be defined and used to develop a lookup table these are single valued relations and so can be flipped as desired 10 where it is understood that the average for η is taken over the wet fraction not the full averaging area this can also be implemented as a lookup table and may be useful numerically the development of subgrid equations involves taking grid averages of the mass and momentum equations 1 3 and determining closures for terms that are not uniquely defined by the coarsened variables with details of the averaging techniques given in whitaker 1999 two rules are used repeatedly for translating hydrodynamic quantities between fine and coarse scales 11 q g q g 1 a g γ w n q d s 12 q t g q g t 1 a g γ w q u b n d s where γ w is the wet dry boundary n is the boundary normal and u b is the velocity of the potentially moving boundary these rules relate averages of operators acting on fine scale quantities to those acting on coarse quantities and introduce additional terms at the wet dry boundary we note that by averaging the conservative form of the momentum equation rather than the nonconservative form all boundary integral terms that are proportional to the local water depth h are zero by definition and do not require additional closures for these terms 2 2 averaged mass equation the averaged mass equation can be written in various interchangeable forms using the definition of volume averaged velocity relationships between wet and grid averages and the coarsening rules 6 12 while averaging to the grid level but using wet averaged hydrodynamic variables the system becomes 13 ϕ h w t ϕ h w u x ϕ h w v y 0 again boundary integrals in 11 12 become zero and do not appear in 13 because h is zero at the wet dry boundary using the definition of grid averaged quantities 8 the mass equation may be written in terms of the grid averaged depth as 14 h g t u h g x v h g y 0 or equivalently as 15 from 9 and using leibniz s rule the mass equation can be also written with a time derivative of η as follows 16 ϕ η t ϕ h w u x ϕ h w v y 0 which is equivalent to the form presented by defina 2000 who used flux as a variable rather than velocity as here all of the forms of the mass equation are quite straightforward if we can uniquely define water volume per unit area grid averaged depth as a function of surface elevation as in 10 then the conservation of mass system is closed and requires no additional manipulation 2 3 momentum equations the averaged momentum equations are derived from 3 using the volume averaged velocity 6 the definitions for averaged quantities and wet averages the coarsening rules 6 12 and the averaged mass equation 16 because the conservative form of the momentum equation has zero depth at the shoreline boundary terms in 11 12 vanish simplifying the coarsened equations greatly coarsened equations are given in quasi conservative form by 17 ϕ u h w t x ϕ u u h w y ϕ u v h w g ϕ h η x w ϕ τ b x τ s x ρ w ϕ h w ρ p a x ϕ f c v h w 1 ρ x ϕ h τ x x w y ϕ h τ x y w 18 ϕ v h w t x ϕ u v h w y ϕ v v h w g ϕ h η y w ϕ τ b y τ s y ρ w ϕ h w ρ p a y ϕ f c u h w 1 ρ x ϕ h τ x y w y ϕ h τ y y w we note that if it is assumed that the coriolis parameter f c varies on larger spatial scales than velocities and depths the coriolis term needs no additional closure arising from the definition of volume averaged velocity making the same assumption for the atmospheric pressure term leads to terms that similarly do not require additional closures however convective momentum bottom friction surface gradients and reynolds stresses all require further assumptions to close the system a quasi nonconservative form of the momentum equation generated by averaging the conservative form of the momentum equation and then dividing through by the mean depth is given in appendix a this resembles the nonconservative form of the shallow water momentum equation with additional closure terms arising from the averaging process and may be useful for certain numerical schemes we note that this is different than if we had simply averaged the nonconservative form of the momentum equation which results in difficult boundary terms and is not shown here 2 4 closures we make closure approximations so that all quantities are written in terms of the coarsened variables the closure approximations are required because subgrid fluctuations in bathymetry and or land cover induce fluctuations in velocity friction and depth whose values are highly correlated and non negligible many of these terms cannot be evaluated exactly and must be closed to a large degree the accuracy of the subgrid system will depend on both the general form assumed for the closures and the specific choices made to close the system the general forms for closures are chosen to resemble standard systems as much as possible in order to enable modification of existing codes while retaining the generality to pursue advanced closure options for the convective momentum terms the closure assumption is made to look like the standard system with additional correction coefficients 19 u u h w u v h w v u h w v v h w c u u u u h w c u v u v h w c v u v u h w c v v v v h w the general form of this closure is equivalent to that of defina 2000 who instead derived the system in flux variables surface gradient terms are approximated as 20 h η x w h w c η x x η x c η x y η y 21 h η y w h w c η y x η x c η y y η y this closure term may be the most surprising but as will be shown it is clearly needed in some cases because the area averages of gradients on a grid average may be dominated by a few small subregions cross terms will not be needed in many cases but may be required in regions where bottom friction and thus surface gradients are anisotropic because of subgrid features the bottom stress closure is given as a quadratic bottom friction law generalized to 22 τ b x ρ w ρ c f u u ρ w u c m f x x u c m f x y v 23 τ b y ρ w ρ c f u v ρ w u c m f y x u c m f y y v where c m f x x η etc are to be determined equivalent frictional coefficients that may be strong functions of water surface elevation other quadratic frictional closures e g manning may be translated into this form once again cross terms are possible because of anisotropy coarse scale reynolds stress terms are approximated as 24 h τ x x w h τ x y w h τ x y w h τ y y w h w μ t 2 u x u y v x v x u y 2 v y where μ t x y t is a grid scale eddy viscosity other reynolds stress approximations that do not use eddy viscosity are also possible but are not explored here after substituting the closure terms into momentum equations 17 18 and canceling some terms using the averaged mass equation the momentum equations become 25 ϕ h w u t u ϕ u h w x c u u ϕ u u h w y c u v ϕ u v h w g ϕ h w c η x x η x c η x y η y ϕ u c m f x x u c m f x y v ϕ h w ρ p a x ϕ f c v h w ϕ τ s x ρ 1 ρ x ϕ h w μ t 2 u x 1 ρ y ϕ h w μ t u y v x 26 ϕ h w v t v ϕ u h w x c v u ϕ u v h w y c v v ϕ v v h w g ϕ h w c η y x η x c η y y η y ϕ u c m f y x u c m f y y v ϕ h w ρ p a y ϕ f c u h w ϕ τ s y ρ 1 ρ x ϕ h w μ t u y v x 1 ρ y ϕ h w μ t 2 v y in summary the set of governing equations based on averaging of the swe with wet averaged variables consists of 13 25 and 26 in the discretization of the governing equations with a staggered finite difference fd scheme as described in appendix b it is more convenient to work with their equivalent form in which the grid averaged total depth h g is used by using the fact that h g ϕ h w the momentum equations 25 26 can be respectively rewritten as 27 h g u t u u h g x c u u u u h g y c u v u v h g g h g c η x x η x c η x y η y ϕ u c m f x x u c m f x y v h g ρ p a x h g f c v ϕ τ s x ρ 1 ρ x h g μ t 2 u x 1 ρ y h g μ t u y v x 28 h g v t v u h g x c v u u v h g y c v v v v h g g h g c η y x η x c η y y η y ϕ u c m f y x u c m f y y v h g ρ p a y h g f c u ϕ τ s y ρ 1 ρ x h g μ t u y v x 1 ρ y h g μ t 2 v y thus when using the grid averaged total depth h g the set of governing equations consists of 14 27 and 28 2 4 1 standard solution the standard non subgrid solutions may be recovered by using the closures ϕ 0 η h g ϕ 1 η h g c η x x c η y y 1 c η x y c η y x 0 c m f x x c m f y y c f g c m f x y c m f y x 0 c u u c v v c u v c v u 1 where here the mean bed elevation h g and the mean friction coefficients c m f x x etc are computed over the entire grid averaging area rather than the wet area the turbulent eddy viscosity or other approximation to reynolds stresses will use any scheme desired by the user these equations exactly revert to standard shallow water equations as implemented in a particular numerical scheme 2 4 2 level 0 closure a basic subgrid closure is used for determining the wet fraction but with very simple assumptions about flow essentially it assumes that partial wetting and drying within a cell are determined by the wet fraction as calculated from subgrid data with an assumed near flat water surface in the averaging area ϕ η a w η a g with all other closures the same as in the standard solution this closure is similar to that used in casulli 2009 and sehili et al 2014 2 4 3 level 1 closure level 1 closures use the fractional wetting and drying of level 0 but also employ assumptions about the flow structure using canonical or near canonical solutions defina 2000 and volp et al 2013 assumed a constant friction slope at all points on the subgrid which may be thought of as flow in a quasi 1d channel but with varying depths across the profile this assumption defines the overall velocities at all locations in relation to the averaged velocity local velocities and depths are substituted back into the full equations and comparison with the form of the closures yields closure coefficients this particular closure can work well for flow that is almost parallel to depth contours but is not expected to be as accurate for flow perpendicular to depth contours the closure is different depending on which form of the averaged velocity variable is used the level 1 closure can be written as ϕ η a w η a g c η x x c η y y 1 c η x y c η y x 0 c m f x x c m f y y h g r v 2 c m f x y c m f y x 0 where 29 r v h w h 3 2 c f 1 2 w is dimensional with units l 1 2 c u u c v v c v u c u v 1 h w h 2 c f w r v 2 again the turbulent eddy viscosity μ t is not uniquely defined by this closure 2 4 4 level 2 closure the level 2 closure uses high resolution modeling to evaluate numerically all closure coefficients which are then used in the coarse resolution subgrid system to accomplish this a high resolution model is run potentially for a variety of water levels and hydrodynamic conditions then the values of the closure terms are determined for a defined averaging area which may be equal to the coarse grid and retained as a lookup table for all closures we assume c f x y η if the forms of the closures are chosen well and the closure terms have been accurately evaluated then the subgrid system should very closely reproduce the high resolution model there are many possible ways that these closures could be computed and the determination of closure coefficients remains an area of very active research although more sophisticated closures are to be introduced in future work this introductory paper uses time and water level invariant closures with coefficients determined using a least squares regression for example the x convective momentum closure chooses c u u to minimize least square error in u u h w c u u u u h w and so on the entire time series of model outputs is used for the minimization and different coefficients will be obtained at each coarse grid cell cross terms c η x y c η y x c m f x y and c m y x are set to zero although there has been progress on computing anisotropic friction e g viero and valipour 2017 and anisotropic resistance due to obstacles viero 2019 in specific cases we do not yet have tools to evaluate anisotropy for general level 2 closures this method of evaluating closure coefficients is not the only possible solution coefficients that are water level dependent will be necessary in regions where wetting and drying dominate simplified solutions of flow in subregions may also prove to be a viable methodology to determine closure coefficients research into level 2 closures is likely a decadal effort and proper choice of closures may be a controlling factor for accuracy in many instances 3 tests and validation this section presents several tests that challenge different aspects of the newly developed system tests include idealized scenarios that isolate specific portions of the system and flooding cycles in a complex real world bathymetry all tests are driven by gravity neither atmospheric pressure nor wind stress is applied in this introductory paper however these are not expected to change conclusions greatly as they are easily closed for use in the subgrid system wind induced overland flooding may however introduce additional complex geometries and wetting drying considerations for real world cases tests here are divided into three sections 1 flows in quasi one dimensional channels 2 flows through a two dimensional bay channel system 3 flows through the complex geometry of buttermilk bay massachusetts usa all tests compare standard shallow water solutions with level 0 and higher level closures the two dimensional bay channel test also makes a first attempt at a level 2 closure ground truth for all simulations is taken to be the high resolution solution of the shallow water equations note that all results presented below use manning s formula 30 c f g n 2 h 1 3 where n denotes the manning s roughness coefficient unless otherwise indicated the manning s roughness coefficient and magnitude of gravitational acceleration are set as n 0 02 m 1 3s and g 9 81 m s 2 for these introductory tests which are focused in large part on testing filling and frictional closures terms accounting for horizontal momentum diffusion are excluded 3 1 idealized test flow in quasi one dimensional channels in this test the subgrid system is applied to solve three idealized quasi one dimensional open channel flow problems i steady flow through a compound channel ii periodic flow through a channel with a parabolic cross section and vertical sidewalls and iii periodic flow through a compound channel with a parabolic cross section and flat floodplain these three tests are used to examine the wetting and drying performance of the subgrid system in different channel configurations and to demonstrate the importance of corrections even in these seemingly relatively simple idealized applications all subgrid calculations in this section consider geometries where the cross section of the channel resides within one grid cell these tests explore the feasibility of treating a simple channel flow entirely at the subgrid level within a framework of a two dimensional numerical solver here levels 0 partial filling of cell and 1 canonical channel flow closure closures are considered in the calculations 3 1 1 steady flow in a sinuous compound channel this first test which is adapted from volp et al 2013 considers a compound channel consisting of a sinusoidal channel and two floodplains the channel geometry and cross section are depicted in fig 2 the meandering narrow channel has a rectangular cross section of 63 m width and its bed level is 3 m below the adjacent floodplains the slope of the compound channel is 0 0001 downhill in the x direction thus there is a 1 m change in bed elevation over the channel length constant surface elevations η c and η c 1 m are imposed at the channel inlet and outlet respectively which generate steady flow with a surface elevation parallel to the bed slope because flow is quasi 1d the advection term is very small and the solution is largely a balance between the surface gradient and bottom friction here the numerical experiment focuses only on the case where the floodplains are fully flooded i e η c is greater than the elevation of the floodplains at the inlet in this case correcting the friction term to account for variations in the water depth will improve representation of volumetric discharge values the numerical solution computed on the fine grid of δ x δ y 1 m resolution is used as a reference solution while the coarse grid used only one 63 m 10000 m cell that covered the entire fine grid domain because surface elevations were imposed at the boundaries and there is only one grid cell elevations are not an appropriate point of comparison between standard and subgrid solutions however this is not the case for the discharge which depends strongly on the bottom stress and its distribution in space fig 3 shows the relative discharge error r q n q ref q n 100 where q n is the volumetric discharge across the channel cross section u h d y for the subgrid and standard solutions and q ref is the discharge of the reference solution in fig 3 the magenta diamonds depict the results from closure level 1 and the blue stars depict closure level 0 it is noted that in this test case because every computational cell is completely wet the subgrid technique with level 0 closure and standard method become identical due to the fact that the area fraction ϕ is unity and h w is simply η h g it can be seen that the level 0 closure underpredicts the discharge especially at low water levels because the advection term is negligible and surface elevations of the reference solution and coarse grid solution are identical it can be concluded that bottom friction is the only term that is not a good approximation in the coarse grid solution because the difference in water depth between channel and flat floodplains is relatively large for these low water levels the level 0 closure overestimates the bottom friction and as a consequence underestimates velocity and discharge as the water level increases the relative difference in depth decreases and the predicted closure level 0 discharge value becomes closer to that of the reference solution it can be observed that the discharge obtained from level 1 is close to that of the reference solution for all water levels which is as expected since this closure was derived under the assumption of uniform channel flow 3 1 2 parabolic channel in this example quasi tidal flow in a long parabolic channel is considered with a channel cross section as shown in fig 4 the channel length is 5376 m and width is 128 m the channel inlet surface elevation is forced with a tide like time series η t sin 2 π t t m where t is a varying forcing period to assess sensitivity of the closures a wall boundary condition is imposed on the far end of the channel for this case the reference solution uses a grid with 2 m 2 m resolution while the coarse simulations use a much coarser 128 m 128 m grid the full channel width is included in one coarse grid cell but there are 42 coarse cells in the direction of flow the underlying bathymetric data employed in the subgrid calculations is identical to that of the reference solution fig 5 shows water surface amplitudes maximum minus minimum surface elevation for the subgrid and standard solutions after flow reaches a periodic steady state at the far end of the channel in this test example portions of the channel are subjected to rising and receding water the subgrid systems which account for the mass correction through the partial filling of cells that are not fully submerged can improve upon the standard solution indeed as can be observed in fig 5 the amplitudes obtained from the subgrid system are in significantly better agreement with the reference solution in comparison to the standard solution level 0 closure blue stars which includes only the partial filling accurately predicts amplitude especially at low forcing frequencies where the effect of nonlinearity in the system is low however the mass correction alone is insufficient as indicated by somewhat larger errors in level 0 closure results for higher frequencies these problems stem from inaccurate bottom friction and advection terms in this test case there is an overestimation of friction and an underestimation of advective stresses in contrast the subgrid system with level 1 closure which is based on a constant frictional slope assumption yields water surface amplitudes that match closely to the reference solution this provides numerical evidence that when the proper subgrid correction parameters are used the system proposed here is able to produce an accurate solution on the coarse grid 3 1 3 compound parabolic channel in this final quasi 1d example a compound parabolic channel is considered for quasi tidal flow as illustrated in fig 6 the channel has a length of 5376 m and an overall width of 256 m and a flat floodplain exists at elevation z 0 25 m as with the previous example the open boundary is forced by the elevation boundary condition η t sin 2 π t t m with a wall boundary at the far end thus water periodically generates overflow from the main channel to the flood plain the grid size used in the coarse grid calculations and reference solution is 256 m 256 m and 2 m 2 m respectively fig 7 shows the computed coarse grid water surface amplitudes for subgrid levels 0 and 1 closures at the closed end of the channel in comparison to the coarse grid standard solutions and the high resolution reference solution overall the results exhibit a pattern similar to the previous example the standard solution yields rather poor amplitudes at all but the lowest forcing frequencies while both level 0 and especially level 1 closures produce solutions that are in much better agreement with the reference solution solutions for level 0 closure do show errors increasing with increasing forcing frequency level 0 closure errors for this test are noticeably larger than those found for the level 0 closure solution of the parabolic problem as shown in fig 8 this error increase comes from the very large relative variation in water depth between channel and wet floodplain and consequent variations in friction and convective stresses level 0 closures do not account for the large depth variations in computation of bottom stresses and convective momentum and so have much greater error for this case in contrast the level 1 closure can provide a much more accurate water surface amplitude as seen in fig 7 as it accounts for the effect of friction and convective stresses and the channel floodplain test closely resembles the assumptions used to derive the level 1 closure itself 3 2 flow through repeating bay channel systems a first test of the level 2 closure methodology is performed in an idealized system of bays and channels which differs strongly from the quasi 1d systems tested previously in this system channels enable exchange of mass and momentum between subsequent bays the channel bay interface features an abrupt narrowing expansion meaning the characteristic velocity fields of the bays and channels vary greatly the chain like geometry of bays and channels induces non linear momentum effects that create challenges in predicting the surface elevations and velocities in each bay simulations of this system are run on a high resolution grid where all geometrical descriptions are resolved additionally simulations are computed on a coarse grid where each coarse grid cell spans a single bay channel pair with such coarse resolution the momentum equations require significant corrections when the interplay of the channel and bay scale physics is significant 3 2 1 repeating bay channel system setup the bathymetry for the system of repeating bays and channels is shown in fig 9 in total there are 10 bay channel pairs with each bay connected to the subsequent bay by a narrow channel wet portions of the domain blue have a bed elevation of z 4 m the elevation of the neighboring floodplains yellow is z 1 m sufficiently high that it remains dry throughout the simulation each bay has length 320 m and width 480 m where width is in the y direction and perpendicular to the primary flow direction each channel has length 192 m and width 32 m the seaward boundary borders a longer reservoir with length 1024 m and width 512 m which has a periodic elevation boundary condition imposed at x 0 driving primary flow sinusoidal quasi tidal forcing cycles have a varying period t with a fixed range of 0 4 m which is 10 of the still water depth the accuracy and robustness of our initial level 2 closure is examined by running simulations for varying forcing frequencies and comparing to high resolution simulations and other closure levels 3 2 2 level 2 corrections level 2 corrections are employed on a coarse grid with dimensions 512 m 512 m this resolution fits one channel bay pair exactly into one coarse cell in this study as a first attempt at level 2 closure correction coefficient values are time independent level 2 coefficient values are selected for each grid cell from high resolution results using the methods described previously in section 2 4 4 and we note that each coarse grid cell has a separate set of time independent correction coefficients 3 2 3 repeating bay channel reference case the reference test case for the bay channel geometry has period t 3 h it is selected because the high resolution and standard coarse grid solutions have significant differences in both the surface elevation amplitudes and timing the high resolution simulation used for comparison and to train the level 2 closure has 8 m 8 m resolution fig 10 a shows the water surface amplitude in each bay for the high resolution black standard red level 0 closure blue and level 2 closure green simulations note that for this particular case levels 0 and 1 closures are identical because the wet area of each cell has uniform depth in general the standard and level 0 methods overestimate the amplitude in each bay the level 2 closure more accurately predicts amplitudes in bays closest to the reservoir however water level fluctuations are overestimated in the back bays the predicted amplitude by the standard method is always largest fig 10 b displays the error in timing of high tide as a fraction of forcing period t peak n t peak r e f t where t peak corresponds to the time of the fourth high tide event for the high resolution and coarse simulations and t is the forcing period the standard and level 0 closure methods predict early arrival of high tide and this error increases as distance from the reservoir increases however including the level 2 coefficients significantly reduces the error in arrival of high water specifically the representative correction coefficients used in level 2 closure effectively increase friction while also reducing the sea surface gradient effect both of which delay the propagation of the wave as the distance from the reservoir increases the standard and level 0 closure methods generally display greater error in predicting the timing of high and low tide events as well as the amplitude fig 10 c d displays the time series of surface elevation for the fine and coarse resolution simulations in the bay farthest from the reservoir and in the reservoir respectively in the reservoir all coarse simulations show excellent agreement with the high resolution run as expected because this is where forcing is applied in the back bay the flow has been significantly affected by the channels and so the correction terms in the momentum equations become important the standard and level 0 closure simulations yield surface elevations that significantly deviate from the high resolution benchmark the level 2 closure method sufficiently corrects the timing of the flow however the amplitude is still overestimated in the repeating bay channel system the channels play an important role in transporting momentum through the domain the narrowing at the bay channel interface induces an area of high flow velocity and thus high deviations from the mean coarse cell velocity u these fluctuations manifest as large values of corrections to the friction and convective terms additionally the channels experience large sea surface gradients but only comprise a small portion of the overall grid hence the channel scale physics must be incorporated into the momentum equation of the coarse simulations for accurate portrayal of sea surface evolution the importance of averaged sea surface gradient may be seen in fig 10 a b for the magenta triangles which represent sub level 2 computations level 2 with surface gradient coefficients set to c η x x c η y y 1 c η x y c η y x 0 these sub level 2 results are much worse than full level 2 and are very close to those from levels 1 and 0 simulations demonstrating that even if convection and friction are considered the new surface gradient average terms introduced here are needed in some situations to ensure that accurate solutions are obtained given that primary flow is in the x direction the important closure coefficients are c u u c η x and n m x fig 11 shows the representative values of these correction coefficients divided by the coefficients of the standard solution c u u c η x 1 n 02 the effective bottom friction roughness n m x is larger than the local roughness coefficient the average effective roughness parameter over all coarse grid points is n m x 053 which is 2 6 time greater than the high resolution value increasing the effective bottom friction is important for accurately capturing event timings in the bays far from the reservoir as well as lowering amplitudes in the back bays similarly a large correction coefficient c u u 8 5 is required in the convective term to account for the high velocity in the channel the sea surface gradient on the other hand requires a reduction by approximately a factor of 10 c η x 0 10 note the surface gradient and convective corrections increased the accuracy of amplitudes however the overestimation of amplitude by the level 2 closure suggests that the simple methodology used here i e choosing one closure value that is independent of water level may be too simplistic 3 2 4 level 2 robustness the sensitivity of level 2 closure corrections to forcing frequency is tested by varying the forcing periods to t 1 5 2 3 6 and 12 h but using the same correction coefficients as were found for t 3 h fig 12 plots the amplitude in the back bay against the forcing period for the different cases as the frequency increases the deviation in amplitude from the high resolution solution also increases for the standard and level 0 methods see fig 12 a while the level 2 closure is considerably more accurate similarly the errors in high tide arrival time increase with increasing forcing frequency for the standard and level 0 methods see fig 12 b again the level 2 closure accounts for channel scale physics that effectively delay the signal and therefore predict more accurately the timing of high tide events for higher frequencies sub level 2 simulations without surface gradient corrections give results that are much worse than with full level 2 almost certainly because of the large differences in surface gradients between wide bays and narrow channels at low frequencies all coarse methods provide accurate representation of sea surface evolution fig 12 c d shows the time series of surface elevation in the back bay for the longest 12 h and shortest 1 5 h forcing periods using a 12 h period all coarse simulation methods match the high resolution run using a higher forcing frequency the errors in both amplitude and arrival time increase for the standard and level 0 methods thus suggesting the need for significant correction of the momentum equation fig 12 shows the level 2 closure can accurately approximate this correction for all tested forcing frequencies and that the coefficients needed for such corrections are relatively independent of frequency hence this suggests that if the appropriate correction coefficients can be found they could provide a robust model not only for the case where they are based on but also over more general conditions 3 3 complex test buttermilk bay in this section the subgrid system is applied to a more realistic simulation of flooding cycles at buttermilk bay massachusetts usa 41 760n 70 620w see fig 13 this multi bay system has a main bay connected by a very narrow channel to a secondary bay little buttermilk bay that is quite difficult to simulate using standard techniques a tertiary water body queen sewell pond has a slightly higher elevation than the two main bays but can be reached by high water levels the computational domain ω used here has dimensions 3584 m 3584 m red box in fig 13 see also fig 14 the simulation is driven at the southern boundary by the tide like elevation boundary conditions see fig 14 more specifically the elevation boundary conditions 31 η a 0 tanh 2 t t r cos ω t are imposed along x y 0 2224 x 3234 the portion of the southern boundary close to the cohasset narrows inlet note that as the flow in the cape cod canal is not the main interest of this test zero elevations are prescribed along the portion of boundaries intersecting the canal in 31 a 0 denotes the forcing amplitude ω the frequency and t r the ramping time the test considered here simulates large semidiurnal tidal cycles and flow between the different bays more precisely the tidal frequency is set to ω 1 4544 1 0 4 s 1 and a 0 2 m this range is larger than the 0 8 m total combined semi diurnal m2 s2 n2 and k2 tides see anon 0000 in this area note that this unrealistically large tidal amplitude is intentionally employed in order to test the robustness of the subgrid system in dealing with filling and draining the test considers neither wind nor atmospheric pressure forcing all simulations are started from a quiescent initial state the elevation forcing is gradually ramped from zero with the ramping time t r 0 25 day level 0 and level 1 closures are considered in the subgrid system the momentum equations in the quasi non conservative forms are employed in the numerical calculations six computational coarse grids are used for intercomparison with resolutions δ x δ y 512 256 128 64 32 16 8 m the staggered fd fv solution with casulli s subgrid wetting drying casulli 2009 computed on the 4 m grid is used as a reference solution our numerical schemes with level 0 closure is to large extent very similar to this fd fv scheme here the finer grids are obtained successively by dividing each grid cell into four uniform cells in all subgrid calculations 1 m lidar elevation data are used to describe the subgrid bathymetric depth danielson et al 2018 a standard model where the bathymetric depth in each cell is equal to an average of the lidar data over the cell is also considered for comparison purposes fig 15 illustrates the cell averaged bathymetric depth of the area north of the cohasset narrow on the grids of successively coarsening resolution the resolution of the grid shown in fig 15 c is 64 m which is slightly coarser than the typical finest grid size used in the floodplains of state of the art high resolution storm surge models such as adcirc tanaka et al 2011 hope et al 2013 it can be noticed that a large amount of topographical detail is already lost at this level of resolution and further loss of detail can be clearly observed as the grid resolutions are further coarsened figs 16 18 show respectively the surface elevation of the wet area computed on the grids of 8 64 256 m resolution at three specific times in which the tide at the boundary is rising in these figures plots on the left column show the results from the standard model and the right column show the results from the subgrid model with level 0 closure it is noted that cells in the standard model are either wet or dry while in the subgrid model the cells can be partially wet when the high resolution 8 m grid is used i e when the topographical features are sufficiently resolved the results from the standard model and the subgrid model are in very good agreement see fig 16 as can be seen in fig 18 the coarse grid 256 m solution of the standard model completely fails to capture the connections between the bays due to the loss of topographical details of the averaged topography it can be clearly observed that the subgrid model is indeed able to capture all connections between the inlet main bay and back bay in the coarse grid solution in addition the passages of water through the small hydro connectivity features i e a brook at the northwest of the main bay and a small channel on the southern end of the back bay are clearly present in the subgrid solution for the 64 m grid see fig 17 although the connection between the main bay and back bay exists in the solution of the standard model it is clearly insufficient as indicated by the time lag of the response in the back bay although not shown in this figure it is noted that the numerical solutions of the subgrid model with level 1 closure are qualitatively and quantitatively very similar to the solution of the level 0 closure the time series of the surface elevation are recorded at different locations figs 19 22 plot the time series at stations marked by blue dots in fig 14 a in these figures the top panel shows the standard solution and the bottom panel shows the subgrid solution with level 0 closure computed on various grids note that because the results from level 1 closure are virtually identical to that of level 0 they are omitted from the plots from these figures it can be clearly noticed that when using the same resolution coarse grid solutions obtained from the subgrid model are always in better agreement with the 4 m reference solution than the standard model indeed flow does not reach the main bay and little buttermilk bay when coarse grids are used in the standard solution at these locations a much higher resolution is required in the standard model in order to obtain numerical results that are comparable to that of the coarse grid subgrid model note that flow from the inlet enters buttermilk bay and its back bay through the channels both the subgrid and standard solutions show an increase in grid sensitivity at the stations in the secondary bays in comparison to those at station 1 however the subgrid model is significantly less sensitive to grid resolution than the standard model the usual root mean square rms errors over one cycle are given by 32 e x 1 n i 1 n η x t i η ref x t i 2 t i i δ t t a where n denotes the number of samples over one cycle with δ t 5 min sampling size and t a 1 day denotes an offset constant these are given in table 1 a c for the standard level 0 closure and level 1 closure solutions respectively for the same grid resolution the rms errors in the subgrid solution are at worst comparable to one order of magnitude lower than those of the standard solution at all stations as qualitatively observed in the previous plots the rms errors in the coarse grid solution from the subgrid model are directly comparable to those of the standard solution computed on the higher resolution grid for example at station 3 the subgrid level 0 closure solution on 256 m grid is roughly comparable to the standard solution on 32 m to 64 m grids at station 5 which is located in the wetting drying areas the subgrid solution is comparable to the standard solution on 8 m to 16 m grids which are even finer than those seen in station 3 the results demonstrate the potential cost savings from employing the subgrid model as reasonable results may be obtained with significantly lower degrees of freedom approximately one to two orders of magnitude for this particular test in comparison to the reference solution used errors in the level 1 closure solution are in overall slightly higher than those of the level 0 closure solution the level 1 closure solution shows slightly lower error levels at some grid resolutions especially at station 1 this is somewhat unexpected as it would be surmised that level 1 would be more accurate the reasons for the difference appear to be because for larger grid sizes a single cell near the connections can contain both part of the large bay and a narrow channel much like in section 3 2 3 thus level 1 assumptions are not necessarily more appropriate a second reason arises from artificial connectivity induced by two separate water bodies without connectivity appearing in some of the largest grid cells for both levels 0 and 1 as it is now the system assumes that these bodies are connected at the subgrid level but this is not necessarily true nevertheless the differences between the error levels in the level 1 and 0 closure solution are negligibly small lastly it is worthwhile to mention that at these stations the numerical rates of convergence of both level 0 and level 1 closure subgrid models range approximately from 0 5 to 1 i e e s o h p p 0 5 1 0 the rates are within the range of values to be generally expected in our numerical schemes since they are based on the use of the first order upwind scheme and a fixed mesh solution technique in dealing with the problem of wetting drying areas 4 discussion and conclusions when compared to standard shallow water solutions it is clear that the use of subgrid corrections derived by a formal averaging process allows increased accuracy in complex shore regions when using lower resolution simulations however simulation accuracy depends greatly on the form of closures and more complex scenarios may require more complex closures most of the closure terms derived by the averaging process might have been expected from intuition and some have already been implemented by other researchers however corrections to the gradient of mean water surface elevations shown in eqs 20 21 are less obvious but appear quite necessary in situations where flow characteristics change strongly within an averaging volume determination of closure coefficients remains a challenging task and much work will be required to investigate general closure methodologies however the repeating bay channel test case showed that even in systems that display complex geometries and have non linear effects a simple coefficient can still effectively capture much of the subgrid physics at play and significantly improve model performance anisotropy of friction and spatial variability of surface elevation gradients is another area where further research is needed tensorial manning s coefficients have been used by inland flooding researchers viero and valipour 2017 but their application to general inhomogeneous topographies is not yet a solved problem one aspect of the subgrid system that was not addressed but is very important in many coastal regions is flow connectivity through an averaging area the work presented here does not yet consider whether flow at the boundaries has a path to reach other boundaries of a grid cell or whether it is blocked by land in some regions including the buttermilk bay simulations not accounting for these non continuous flow paths may be a limiting factor for simulation accuracy and as seen in fig 1 very recently casulli 2019 addressed this issue by cloning cells and edges based on connectivity effectively introducing additional degrees of freedom into a single grid location corrections such as this appear to be necessary when a single degree of freedom is insufficient flow connectivity is an important area of research that continues to be actively investigated all tests considered here were conducted on relatively small regular grids using a code written specifically for the subgrid system most typical storm surge and circulation simulations use much larger grids and may have very different grid properties efforts are underway to incorporate the subgrid corrections introduced here into more widely used and available models that have a greater impact on the field and will be reported on in the future acknowledgments work here was funded under national science foundation usa grants icer 1664040 and 1664037 and through a grant from the joint airborne lidar bathymetry technical center of expertise jalbtcx usa through a subcontract with optimal geo ts is supported by the national science foundation usa graduate research fellowship under grant no dge 1841556 their support is gratefully acknowledged appendix a quasi non conservative form of subgrid equations non conservative forms of shallow water like equations are useful for many numerical schemes the most obvious subgrid solution is to perform averaging on the nonconservative form directly and then to develop closures this naive methodology proves suboptimal as whitaker averaging in this form generates several difficulties to close boundary integral terms that disappear in the conservative forms because of the zero depth and thus momentum at the wet dry boundary an alternate methodology that removes these forms is to begin with 27 28 and use the product rule to expand the third and fourth terms on the left hand side of 27 and 28 to arrive at 33 h g u t u c u u 1 u c u v 1 v h g c u u u h g u x c u v v h g u y g c η x x h g η x g h g c η x y η y ϕ u c m f x x u c m f x y v ϕ τ s x w ρ h g ρ p a x f c v h g 1 ρ x h g μ t 2 u x 1 ρ y h g μ t u y v x 34 h g v t v c v u 1 u c v v 1 v h g c v u u h g v x c v v v h g v y g c η y x h g η x g c η y y h g η y ϕ u c m f y x u c m f y y v ϕ τ s y w ρ h g ρ p a x f c u h g 1 ρ x h g μ t u y v x 1 ρ y h g μ t 2 v y note that the above forms offer convenience in numerical realization as the differences between the implementations of the quasi conservative and quasi non conservative are only in the discretization schemes for the advection terms see appendix b for more details note that the quasi non conservative forms that resemble more to the conventional non conservative forms can be obtained by dividing both sides of the above equations by the grid average depth appendix b fd scheme on structured staggered grid this section describes finite difference schemes on a staggered grid used in numerical discretization of the governing equations 15 27 and 28 these finite difference schemes are based in large part on adaptations of the numerical schemes presented in casulli 1990 2009 stelling and duinmeijer 2003 volp et al 2013 to accommodate the proposed subgrid governing equations note that although the mass equations 15 and 16 are equivalent when is defined by 9 15 is chosen since it leads to a preferable property of mass conservation at the discrete level the terms associated with cross term closure coefficients c η x y c η y x c m f x y c m f y x in the averaged momentum equations are excluded in this study they will be implemented in a future study here the standard 2d arakawa c grid is adopted the unknown flow variables η u and u are placed at the cell center and at the midpoint of the vertical and horizontal cell edges respectively see fig 23 the mass 15 and the x momentum 27 and the y momentum 28 are discretized at the nodes associated with the discrete variables η u and v respectively to keep the notation simple η u v and h will be used to refer to the averaged variables η u v and h g respectively the precise notation will be used when it is not clear from context the control volumes ω η i j x i 1 2 x i 1 2 y j 1 2 y j 1 2 ω u i 1 2 j x i 1 x i y j 1 2 y i j 1 2 ω v i j 1 2 x i 1 2 x i 1 2 y j 1 y i j 1 are assigned to the flow variables η i j u i 1 2 j and v i j 1 2 respectively the averaging area a g is assumed to be identical to the grid size the control volume size for a given η and bathymetric depth h x of arbitrarily fine resolution the value of the averaged water depth at each node is evaluated from the formula 9 with the integration defined over its associated control volume see fig 24 b 0 1 continuity discretization a semi implicit finite difference discretization of the continuity equation 15 for a cell i j is considered this scheme is a result of using the euler backward in time discretization with the grid averaged total water depth h from the current time level by multiplying the above equation by δ x δ y one has 35 v i j η i j n 1 v i j η i j n δ t u i 1 2 j n 1 a i 1 2 j n u i 1 2 j n 1 a i 1 2 j n v i j 1 2 n 1 a i j 1 2 n v i j 1 2 n 1 a i j 1 2 n 0 a form reminiscent of the fv scheme where v i j is the water volume in the cell a i 1 2 j n 1 h i 1 2 j n δ y and a i j 1 2 n 1 h i j 1 2 n δ x the grid averaged water height h i 1 2 j is determined by 36 h i 1 2 j 1 δ x δ y ω u h d x 1 δ x δ y x i x i 1 2 y i 1 2 y i 1 2 h η i j d x d y x i 1 2 x i 1 y i 1 2 y i 1 2 h η i 1 j d x d y the grid average at the v node h i j 1 2 is defined in the same manner it is noted that the formula 35 is written for any cell having at least one wet edge the edge is considered wet when the wet cross section area of such edge is greater than a given small positive tolerance more precisely the edge associated with u i 1 2 j is considered wet when y j 1 2 y j 1 2 h η i 1 2 j d y ε where η i 1 2 j η i j η i 1 j 2 b 0 2 momentum discretization for simplicity of presentation the x and y directed bottom stresses τ b x and τ b y are written as τ b x ρ w γ u τ b y ρ w γ v below the discretization of the x momentum equation 27 is described a semi implicit finite difference scheme on the u node is given by 37 h i 1 2 n u i 1 2 j n 1 u i 1 2 j n δ t f i 1 2 j n g h i 1 2 j n c η i 1 2 j η i 1 j η i j δ x γ i 1 2 j u i 1 2 j n 1 where f i 1 2 j n u i 1 2 j q e u q w u δ x q n v q s v δ y 38 c u u e q e u u e n c u u w q w u u w n δ x c u v n q n v u n n c u v s q s v u s n δ y is the discretization formula of the advection term note that in this discretization formula the bottom friction and the surface gradient terms are treated implicitly via the euler backward scheme while the advection terms are treated explicitly through the euler forward scheme in 38 q e u q w u represent the x directed mass fluxes at the east and west edges of the control volume ω u while q n v and q s v denote the y directed mass fluxes at the north and south edges they are evaluated through the following formula q e u u i 1 2 j n h i 1 2 j n 1 u i 3 2 j n h i 3 2 j n 1 2 q w u u i 1 2 j n h i 1 2 j n 1 u i 1 2 j n h i 1 2 j n 1 2 q n v v i j 1 2 n h i j 1 2 n 1 v i 1 j 1 2 n h i 1 j 1 2 n 1 2 q s v v i j 1 2 n h i j 1 2 n 1 v i 1 j 1 2 n h i 1 j 1 2 n 1 2 the velocities u e u w u n and u s which are the x directed velocity along the east west north and south edges of the control volume ω u respectively are determined by a first order upwind scheme with an upwind direction determined by a sign of the flow q e more precisely u e u i 1 2 j q e u 0 u i 3 2 j q e u 0 u w u i 1 2 j q w u 0 u i 1 2 j q w u 0 39 u n u i 1 2 j q n v 0 u i 1 2 j 1 q n v 0 u w u i 1 2 j 1 q s v 0 u i 1 2 j q s v 0 it can be verified that when c u u and c u v are set to one the discrete advection term is simply an upwind scheme for example if the flow direction is positive q e 0 the discrete advection term at the u i 1 2 j node corresponds to f i 1 2 j n q w u u i 1 2 j u i 1 2 j δ x q s v u i 1 2 j u i 1 2 j 1 δ y by rearranging 37 one has at the i 1 2 j node 40 u i 1 2 j n 1 1 h i 1 2 j h i 1 2 j n u i 1 2 j n δ t f i 1 2 j n g δ t δ x h i 1 2 j n η i 1 j n 1 η i j n 1 where h i 1 2 j 1 h i 1 2 j n γ i 1 2 j δ t a semi implicit finite difference scheme for the y momentum equation at the v node can be devised in a similar way more specifically at node i j 1 2 one has 41 v i j 1 2 n 1 1 h i j 1 2 h i j 1 2 n v i j 1 2 n δ t g i j 1 2 n g δ t δ x h i j 1 2 n η i j 1 n 1 η i j n 1 where g i j 1 2 n represents the explicit discretization scheme of the advection the fd equations for the non conservative momentum equations 33 and 34 are identical to 40 and 41 except for f n and g n more precisely the following scheme 42 f i 1 2 j n u i 1 2 j c u u e 1 q e u c u u w 1 q w u δ x c u v n 1 q n v c u v s 1 q s v δ y c u u u i 1 2 j n h i 1 2 j n λ x 1 u i 1 2 j n λ x 0 u i 1 2 j n λ x 1 u i 3 2 j n δ x c u v v i 1 2 j n h i 1 2 j n λ y 1 u i 1 2 j 1 n λ y 0 u i 1 2 j n λ y 1 u i 1 2 j 1 n δ y is considered in the discretization of the x momentum equation here the value of λ x l and λ y l depends on the upwind direction more precisely λ x 1 1 λ x 0 1 λ x 1 0 for u i 1 2 j 0 λ x 1 0 λ x 0 1 λ x 1 1 for u i 1 2 j 0 λ y 1 1 λ y 0 1 λ y 1 0 for v i 1 2 j 0 λ y 1 0 λ y 0 1 λ y 1 1 for v i 1 2 j 0 since v i 1 2 j is not defined on the u node where the x momentum is discretized v i 1 2 j is interpolated from the surrounding v nodes through v i 1 2 j n v i j 1 2 n v i 1 j 1 2 n v i j 1 2 n v i 1 j 1 2 n 4 note that g n for the y momentum equation 34 is defined in an analogous manner the discretization formulas 40 and 41 are defined at the wet edges and the velocity on the dry edges is assumed to be zeros although this is not strictly true at the wetting drying front b 0 3 solution algorithm the solution η n 1 u n 1 v n 1 can be obtained either by i solving the system of nonlinear equations 35 40 and 40 simultaneously or by ii solving a reduced system of equations arising from the substitution of 40 and 40 into 35 casulli 2009 such a reduced system of nonlinear algebraic equations is given by v i j η i j n 1 a i 1 2 j η i 1 j n 1 a i 1 2 j η i 1 j n 1 d i j η i j n 1 a i j 1 2 η i j 1 n 1 a i j 1 2 η i j 1 n 1 v i j n η i j n b i 1 2 j b i 1 2 j b i j 1 2 b i j 1 2 where a i 1 2 j g δ t 2 δ x h i 1 2 j n h i 1 2 j a i 1 2 j a i j 1 2 g δ t 2 δ y h i j 1 2 h i j 1 2 a i j 1 2 d i j a i 1 2 j a i 1 2 j a i j 1 2 a i j 1 2 b i 1 2 j δ t h i 1 2 j a i 1 2 j h i 1 2 j n u i 1 2 j n δ t f i 1 2 j n b i j 1 2 δ t h i j 1 2 a i j 1 2 h i j 1 2 n v i 1 2 j n δ t g i j 1 2 n a more compact form of the above system of equations is 43 v η t η b where η is a vector of the solution at the next time level η i j n 1 t is the matrix with a and d as its entries v is the vector of the water volume and b is the known right hand side vector note that t is symmetric with positive diagonal entries and negative off diagonal entries it has at most five nonzero entries for each row a five point stencil the system of equations 43 is nonlinear and is solved by the newton raphson method 44 ζ m 1 ζ m j 1 v ζ m t ζ m b where m is the iteration step and j ζ m is the jacobian matrix of 43 evaluated at ζ m a good approximation of the jacobian is 45 j p η m t where p is a diagonal matrix of the wet area of the cell δ x δ y ϕ casulli 2009 the formula 44 is iterated with the solution at the current time step as an initial guess η 0 ζ n until a criterion ζ m 1 ζ m t o l is met and set η n 1 ζ m subsequently the velocities at the time level n 1 are obtained from 40 and 41 with the now known ζ n 1 
24004,averaging techniques are used to generate upscaled forms of the shallow water equations for storm surge including subgrid corrections these systems are structurally similar to the standard shallow water equations but have additional terms related to integral properties of the fine scale bathymetry topography and flow as the system only operates with coarse scale variables such as averaged fluid velocity relating to flow these fine scale integrals require closures to relate them to the coarsened variables closures with different levels of complexity are identified and tested for accuracy against high resolution solutions of the standard shallow water equations results show that for coarse grids in complex geometries inclusion of subgrid closure terms greatly improves model accuracy when compared to standard solutions and will thereby enable new classes of storm surge models keywords subgrid methods storm surge numerical methods mathematical modeling shallow water equations 1 introduction modern storm surge models have been split into two disparate branches based on their intended uses 1 low resolution ensemble forecasts using hundreds to thousands of surge model runs these models are largely used before tropical cyclone landfalls or for climatological surge studies zachry et al 2017 each realization is typically run on a single computational core and uses relatively coarse computational grids to ensure that they can finish the many runs required within tight forecast windows 2 high resolution simulations these are either performed singly or in small ensembles in forecasts or in potentially much larger quantity for hindcasts or climatological studies such simulations are almost invariably run on large parallel computing systems anon 2015 hope et al 2013 differences between these two varieties of simulation are characterized by run times and accuracy low resolution models are much faster but have generally lower accuracy and vice versa for high resolution models kerr et al 2013 this state of affairs has existed for at least the past decade but neither camp is entirely satisfied the low resolution modelers would like to increase accuracy while the high resolution camp often cannot complete simulations in the times it desires and also requires expensive computational hardware that is not readily available to many furthermore extremely high resolution topographic and bathymetric datasets are increasingly becoming available in many locations with detail that cannot currently be resolved by any large scale surge models danielson et al 2018 an intermediate path exists with the use of subgrid models defina 2000 casulli 2009 casulli and stelling 2011 volp et al 2013 it is well known that quantities in high resolution models are not completely independent for example nearby surface elevations are very highly correlated so knowledge at one location implies a good knowledge of surface elevations at nearby locations also even if they lie on a different computational grid cell subgrid models make use of such correlations to strongly reduce the number of computational degrees of freedom while retaining their bulk effects in modified sets of equations the fundamental assumption of subgrid models which is not often stated explicitly is that subgrid effects are uniquely defined and can be adequately represented by functions of coarsened averaged properties such as water levels or velocities combined with integral functions of high resolution ground elevations friction characteristics and so on the accuracy of subgrid solutions depends greatly on these coarsened properties for many cases systems display strong correlations that enable the subgrid system to retain almost all of the accuracy of the original high resolution system in other cases detailed subgrid properties may not be unique functions of coarsened properties a simple example is shown in fig 1 where water levels on either side of a levee are independent quantities in this case one water level is insufficient to represent important details of the system because the two water bodies are not connected however if the water level were high enough to inundate the levee then a single variable to represent water levels would become much more viable some of these same tradeoffs are also present usually unannounced and unevaluated in standard storm surge models where simple velocity elevation and bathymetry distributions within a cell are simply assumed to adequately represent the processes of interest the concept of subgrids is implicit in many aspects of hydrodynamics as one example manning s equation used in channel flow hydraulics te chow 1982 explicitly constructs a solution with lower degrees of freedom from higher resolution bathymetry and land cover similarly darcy s law for porous media flow aggregates the effects of very small scale unresolved features into a coarser scale continuum importantly it is possible to construct darcy s law from first principles using subgrid physical properties of a porous medium whitaker 1999 which is similar to our intention here subgrids for surge inundation circulation modeling have been explored previously by several groups but using somewhat different techniques than will be applied here defina 2000 developed a set of equations that looked much like the conservative form of the shallow water equations but with a correction to the mass conservation equation that accounts for partially wet partially dry regions and separate corrections to momentum and bottom friction arising from non uniform spatial velocities the wet dry fraction was assumed to have an error function variation with surface elevation casulli 2009 developed an elegant theory numerical technique for subgrid wetting and drying that guarantees non negative depths at the shoreline through the solution of a mildly nonlinear equation this system again closely resembles nonlinear shallow water equations with a correction for partially wet elements in contrast to defina s work casulli 2009 used lookup tables derived from high resolution bathymetry to obtain the wet fraction as a function of surface elevation sehili et al 2014 implemented results from casulli 2009 and casulli and stelling 2011 to examine storm surge flooding around hamburg and found that the subgrid system delivered similar accuracy to the standard shallow water equations but with around 5 of the cost this of course is a huge gain and enables both new problems to be studied and existing problems to be examined either in more detail or at much lower cost such subgrid models have had to make approximations for example bottom friction was computed using mean depth and velocity in sehili et al 2014 rather than as an integral over the detailed bathymetry more advanced closures require additional assumptions defina 2000 and volp et al 2013 2016 employed approximations including a steady friction gradient to obtain closed form solutions for integral friction that are exact for special cases such as steady channel flow and devised techniques to evaluate subgrid friction along individual strips of a cell wu et al 2017 2016 extended volp s results to include the effects of vegetation drag in salt marshes and applied the new system to a section of delaware bay d alpaos and defina 2007 further examined the effect of unresolved momentum mixing and found that these contributions could in some cases be modeled by increasing the effective bottom friction for coarse grid solutions these previous studies have shown considerable improvements in the resolution accuracy tradeoff but there remain significant uncertainties in closures and even in the basic forms of the equations to be used the present paper develops shallow water subgrid systems for storm surge using formal averaging methods e g whitaker 1999 these methods produce equations that are similar in many ways to those found in previous studies but have additional terms and closures that had been previously neglected and arise from the averaging process different levels of closures are identified as well as the information required for their implementation the systems are tested for accuracy and intercompared at different resolutions in the remainder of this paper section 2 derives the subgrid theory and discusses the different levels of closure section 3 tests the systems on idealized geometries and over the more complex real world environment of buttermilk bay massachusetts usa finally section 4 summarizes the present work and gives a framework for future research development and implementation activities 2 theory high resolution storm surge systems are generally governed by the depth integrated shallow water equations to be solved here in conservative form the conservation of mass equation is 1 h t h u x h v y 0 where u u v is the depth averaged horizontal velocity vector and the local total water depth is h h η where h is the still water depth and η is the free surface elevation the conservative form of the momentum equation is 2 h u t x h u u y h u v g h η x τ b x τ s x ρ 1 ρ p a x f c h v 1 ρ h τ x x x h τ x y y 3 h v t x h v u y h v v g h η y τ b y τ s y ρ 1 ρ p a y f c h u 1 ρ h τ x y x h τ y y y where τ b τ b x τ b y is the bed stress τ s τ s x τ s y is the surface stress τ x x τ x y and τ y y are depth averaged reynolds stresses p a is local atmospheric pressure and f c is the coriolis parameter when the topography and bathymetry are represented faithfully at high enough resolution and given the appropriate atmospheric forcing and bottom friction numerical systems based on these equations have been shown to provide accurate representations of storm surge for a variety of situations see for example bunya et al 2010 dietrich et al 2010 hope et al 2013 2 1 averaging tools subgrid equations are derived from the original high resolution equations 1 3 following techniques laid out in whitaker 1999 that were originally developed for use in the generation of equations for flow in porous media these result in new sets of equations for coarsened quantities but with corrections over the subgrid scale the averaging scale to be used here is a g the so called grid averaging area numerically this averaging scale must be at least as large as the coarse grid size but may be larger computational coarsened variables will be defined on this grid averaged scale with smaller scale variations smoothed out for some dummy quantity q hydrodynamic variables coarsened to the grid scale are defined as 4 q g 1 a g a w q d a where a w is the wet portion of a g this will be called the grid average and is denoted with subscript g an alternate average used here is the wet average which uses the wet portion of the averaging area and is defined as 5 q w 1 a w a w q d a this average will be denoted with subscript w the terms grid average and wet average are respectively equivalent to the phase average and intrinsic phase average found in e g whitaker 1999 for fully inundated completely wet grids these quantities will be identical the volume averaged velocity used here is defined as 6 u a g h u d a a g h d a because the depth is by definition zero in dry areas this quantity is identical if the integration limits are taken as the wet area rather than the entire grid although other definitions of velocity are possible use of a volume averaged velocity eliminates the necessity for closures in some terms often it is helpful to define coarsened variables in terms of the wet averages where integrals are defined only over the wet area for example the grid average of water surface elevation in partially wet regions has much less physical meaning than the wet average if we define the wet averaging area as 7 a w ϕ a g where ϕ is the wet fraction in the averaging area which may vary strongly with local surface elevations then for hydrodynamic quantity q 8 q g ϕ q w the grid averaged wet volume per unit area is now 9 where φ is a wet fraction for a given value z and p s 1 for s 0 and 0 for s 0 if subgrid bathymetry and topography are known and we assume that s t d η h w then ϕ φ η can be defined and used to develop a lookup table these are single valued relations and so can be flipped as desired 10 where it is understood that the average for η is taken over the wet fraction not the full averaging area this can also be implemented as a lookup table and may be useful numerically the development of subgrid equations involves taking grid averages of the mass and momentum equations 1 3 and determining closures for terms that are not uniquely defined by the coarsened variables with details of the averaging techniques given in whitaker 1999 two rules are used repeatedly for translating hydrodynamic quantities between fine and coarse scales 11 q g q g 1 a g γ w n q d s 12 q t g q g t 1 a g γ w q u b n d s where γ w is the wet dry boundary n is the boundary normal and u b is the velocity of the potentially moving boundary these rules relate averages of operators acting on fine scale quantities to those acting on coarse quantities and introduce additional terms at the wet dry boundary we note that by averaging the conservative form of the momentum equation rather than the nonconservative form all boundary integral terms that are proportional to the local water depth h are zero by definition and do not require additional closures for these terms 2 2 averaged mass equation the averaged mass equation can be written in various interchangeable forms using the definition of volume averaged velocity relationships between wet and grid averages and the coarsening rules 6 12 while averaging to the grid level but using wet averaged hydrodynamic variables the system becomes 13 ϕ h w t ϕ h w u x ϕ h w v y 0 again boundary integrals in 11 12 become zero and do not appear in 13 because h is zero at the wet dry boundary using the definition of grid averaged quantities 8 the mass equation may be written in terms of the grid averaged depth as 14 h g t u h g x v h g y 0 or equivalently as 15 from 9 and using leibniz s rule the mass equation can be also written with a time derivative of η as follows 16 ϕ η t ϕ h w u x ϕ h w v y 0 which is equivalent to the form presented by defina 2000 who used flux as a variable rather than velocity as here all of the forms of the mass equation are quite straightforward if we can uniquely define water volume per unit area grid averaged depth as a function of surface elevation as in 10 then the conservation of mass system is closed and requires no additional manipulation 2 3 momentum equations the averaged momentum equations are derived from 3 using the volume averaged velocity 6 the definitions for averaged quantities and wet averages the coarsening rules 6 12 and the averaged mass equation 16 because the conservative form of the momentum equation has zero depth at the shoreline boundary terms in 11 12 vanish simplifying the coarsened equations greatly coarsened equations are given in quasi conservative form by 17 ϕ u h w t x ϕ u u h w y ϕ u v h w g ϕ h η x w ϕ τ b x τ s x ρ w ϕ h w ρ p a x ϕ f c v h w 1 ρ x ϕ h τ x x w y ϕ h τ x y w 18 ϕ v h w t x ϕ u v h w y ϕ v v h w g ϕ h η y w ϕ τ b y τ s y ρ w ϕ h w ρ p a y ϕ f c u h w 1 ρ x ϕ h τ x y w y ϕ h τ y y w we note that if it is assumed that the coriolis parameter f c varies on larger spatial scales than velocities and depths the coriolis term needs no additional closure arising from the definition of volume averaged velocity making the same assumption for the atmospheric pressure term leads to terms that similarly do not require additional closures however convective momentum bottom friction surface gradients and reynolds stresses all require further assumptions to close the system a quasi nonconservative form of the momentum equation generated by averaging the conservative form of the momentum equation and then dividing through by the mean depth is given in appendix a this resembles the nonconservative form of the shallow water momentum equation with additional closure terms arising from the averaging process and may be useful for certain numerical schemes we note that this is different than if we had simply averaged the nonconservative form of the momentum equation which results in difficult boundary terms and is not shown here 2 4 closures we make closure approximations so that all quantities are written in terms of the coarsened variables the closure approximations are required because subgrid fluctuations in bathymetry and or land cover induce fluctuations in velocity friction and depth whose values are highly correlated and non negligible many of these terms cannot be evaluated exactly and must be closed to a large degree the accuracy of the subgrid system will depend on both the general form assumed for the closures and the specific choices made to close the system the general forms for closures are chosen to resemble standard systems as much as possible in order to enable modification of existing codes while retaining the generality to pursue advanced closure options for the convective momentum terms the closure assumption is made to look like the standard system with additional correction coefficients 19 u u h w u v h w v u h w v v h w c u u u u h w c u v u v h w c v u v u h w c v v v v h w the general form of this closure is equivalent to that of defina 2000 who instead derived the system in flux variables surface gradient terms are approximated as 20 h η x w h w c η x x η x c η x y η y 21 h η y w h w c η y x η x c η y y η y this closure term may be the most surprising but as will be shown it is clearly needed in some cases because the area averages of gradients on a grid average may be dominated by a few small subregions cross terms will not be needed in many cases but may be required in regions where bottom friction and thus surface gradients are anisotropic because of subgrid features the bottom stress closure is given as a quadratic bottom friction law generalized to 22 τ b x ρ w ρ c f u u ρ w u c m f x x u c m f x y v 23 τ b y ρ w ρ c f u v ρ w u c m f y x u c m f y y v where c m f x x η etc are to be determined equivalent frictional coefficients that may be strong functions of water surface elevation other quadratic frictional closures e g manning may be translated into this form once again cross terms are possible because of anisotropy coarse scale reynolds stress terms are approximated as 24 h τ x x w h τ x y w h τ x y w h τ y y w h w μ t 2 u x u y v x v x u y 2 v y where μ t x y t is a grid scale eddy viscosity other reynolds stress approximations that do not use eddy viscosity are also possible but are not explored here after substituting the closure terms into momentum equations 17 18 and canceling some terms using the averaged mass equation the momentum equations become 25 ϕ h w u t u ϕ u h w x c u u ϕ u u h w y c u v ϕ u v h w g ϕ h w c η x x η x c η x y η y ϕ u c m f x x u c m f x y v ϕ h w ρ p a x ϕ f c v h w ϕ τ s x ρ 1 ρ x ϕ h w μ t 2 u x 1 ρ y ϕ h w μ t u y v x 26 ϕ h w v t v ϕ u h w x c v u ϕ u v h w y c v v ϕ v v h w g ϕ h w c η y x η x c η y y η y ϕ u c m f y x u c m f y y v ϕ h w ρ p a y ϕ f c u h w ϕ τ s y ρ 1 ρ x ϕ h w μ t u y v x 1 ρ y ϕ h w μ t 2 v y in summary the set of governing equations based on averaging of the swe with wet averaged variables consists of 13 25 and 26 in the discretization of the governing equations with a staggered finite difference fd scheme as described in appendix b it is more convenient to work with their equivalent form in which the grid averaged total depth h g is used by using the fact that h g ϕ h w the momentum equations 25 26 can be respectively rewritten as 27 h g u t u u h g x c u u u u h g y c u v u v h g g h g c η x x η x c η x y η y ϕ u c m f x x u c m f x y v h g ρ p a x h g f c v ϕ τ s x ρ 1 ρ x h g μ t 2 u x 1 ρ y h g μ t u y v x 28 h g v t v u h g x c v u u v h g y c v v v v h g g h g c η y x η x c η y y η y ϕ u c m f y x u c m f y y v h g ρ p a y h g f c u ϕ τ s y ρ 1 ρ x h g μ t u y v x 1 ρ y h g μ t 2 v y thus when using the grid averaged total depth h g the set of governing equations consists of 14 27 and 28 2 4 1 standard solution the standard non subgrid solutions may be recovered by using the closures ϕ 0 η h g ϕ 1 η h g c η x x c η y y 1 c η x y c η y x 0 c m f x x c m f y y c f g c m f x y c m f y x 0 c u u c v v c u v c v u 1 where here the mean bed elevation h g and the mean friction coefficients c m f x x etc are computed over the entire grid averaging area rather than the wet area the turbulent eddy viscosity or other approximation to reynolds stresses will use any scheme desired by the user these equations exactly revert to standard shallow water equations as implemented in a particular numerical scheme 2 4 2 level 0 closure a basic subgrid closure is used for determining the wet fraction but with very simple assumptions about flow essentially it assumes that partial wetting and drying within a cell are determined by the wet fraction as calculated from subgrid data with an assumed near flat water surface in the averaging area ϕ η a w η a g with all other closures the same as in the standard solution this closure is similar to that used in casulli 2009 and sehili et al 2014 2 4 3 level 1 closure level 1 closures use the fractional wetting and drying of level 0 but also employ assumptions about the flow structure using canonical or near canonical solutions defina 2000 and volp et al 2013 assumed a constant friction slope at all points on the subgrid which may be thought of as flow in a quasi 1d channel but with varying depths across the profile this assumption defines the overall velocities at all locations in relation to the averaged velocity local velocities and depths are substituted back into the full equations and comparison with the form of the closures yields closure coefficients this particular closure can work well for flow that is almost parallel to depth contours but is not expected to be as accurate for flow perpendicular to depth contours the closure is different depending on which form of the averaged velocity variable is used the level 1 closure can be written as ϕ η a w η a g c η x x c η y y 1 c η x y c η y x 0 c m f x x c m f y y h g r v 2 c m f x y c m f y x 0 where 29 r v h w h 3 2 c f 1 2 w is dimensional with units l 1 2 c u u c v v c v u c u v 1 h w h 2 c f w r v 2 again the turbulent eddy viscosity μ t is not uniquely defined by this closure 2 4 4 level 2 closure the level 2 closure uses high resolution modeling to evaluate numerically all closure coefficients which are then used in the coarse resolution subgrid system to accomplish this a high resolution model is run potentially for a variety of water levels and hydrodynamic conditions then the values of the closure terms are determined for a defined averaging area which may be equal to the coarse grid and retained as a lookup table for all closures we assume c f x y η if the forms of the closures are chosen well and the closure terms have been accurately evaluated then the subgrid system should very closely reproduce the high resolution model there are many possible ways that these closures could be computed and the determination of closure coefficients remains an area of very active research although more sophisticated closures are to be introduced in future work this introductory paper uses time and water level invariant closures with coefficients determined using a least squares regression for example the x convective momentum closure chooses c u u to minimize least square error in u u h w c u u u u h w and so on the entire time series of model outputs is used for the minimization and different coefficients will be obtained at each coarse grid cell cross terms c η x y c η y x c m f x y and c m y x are set to zero although there has been progress on computing anisotropic friction e g viero and valipour 2017 and anisotropic resistance due to obstacles viero 2019 in specific cases we do not yet have tools to evaluate anisotropy for general level 2 closures this method of evaluating closure coefficients is not the only possible solution coefficients that are water level dependent will be necessary in regions where wetting and drying dominate simplified solutions of flow in subregions may also prove to be a viable methodology to determine closure coefficients research into level 2 closures is likely a decadal effort and proper choice of closures may be a controlling factor for accuracy in many instances 3 tests and validation this section presents several tests that challenge different aspects of the newly developed system tests include idealized scenarios that isolate specific portions of the system and flooding cycles in a complex real world bathymetry all tests are driven by gravity neither atmospheric pressure nor wind stress is applied in this introductory paper however these are not expected to change conclusions greatly as they are easily closed for use in the subgrid system wind induced overland flooding may however introduce additional complex geometries and wetting drying considerations for real world cases tests here are divided into three sections 1 flows in quasi one dimensional channels 2 flows through a two dimensional bay channel system 3 flows through the complex geometry of buttermilk bay massachusetts usa all tests compare standard shallow water solutions with level 0 and higher level closures the two dimensional bay channel test also makes a first attempt at a level 2 closure ground truth for all simulations is taken to be the high resolution solution of the shallow water equations note that all results presented below use manning s formula 30 c f g n 2 h 1 3 where n denotes the manning s roughness coefficient unless otherwise indicated the manning s roughness coefficient and magnitude of gravitational acceleration are set as n 0 02 m 1 3s and g 9 81 m s 2 for these introductory tests which are focused in large part on testing filling and frictional closures terms accounting for horizontal momentum diffusion are excluded 3 1 idealized test flow in quasi one dimensional channels in this test the subgrid system is applied to solve three idealized quasi one dimensional open channel flow problems i steady flow through a compound channel ii periodic flow through a channel with a parabolic cross section and vertical sidewalls and iii periodic flow through a compound channel with a parabolic cross section and flat floodplain these three tests are used to examine the wetting and drying performance of the subgrid system in different channel configurations and to demonstrate the importance of corrections even in these seemingly relatively simple idealized applications all subgrid calculations in this section consider geometries where the cross section of the channel resides within one grid cell these tests explore the feasibility of treating a simple channel flow entirely at the subgrid level within a framework of a two dimensional numerical solver here levels 0 partial filling of cell and 1 canonical channel flow closure closures are considered in the calculations 3 1 1 steady flow in a sinuous compound channel this first test which is adapted from volp et al 2013 considers a compound channel consisting of a sinusoidal channel and two floodplains the channel geometry and cross section are depicted in fig 2 the meandering narrow channel has a rectangular cross section of 63 m width and its bed level is 3 m below the adjacent floodplains the slope of the compound channel is 0 0001 downhill in the x direction thus there is a 1 m change in bed elevation over the channel length constant surface elevations η c and η c 1 m are imposed at the channel inlet and outlet respectively which generate steady flow with a surface elevation parallel to the bed slope because flow is quasi 1d the advection term is very small and the solution is largely a balance between the surface gradient and bottom friction here the numerical experiment focuses only on the case where the floodplains are fully flooded i e η c is greater than the elevation of the floodplains at the inlet in this case correcting the friction term to account for variations in the water depth will improve representation of volumetric discharge values the numerical solution computed on the fine grid of δ x δ y 1 m resolution is used as a reference solution while the coarse grid used only one 63 m 10000 m cell that covered the entire fine grid domain because surface elevations were imposed at the boundaries and there is only one grid cell elevations are not an appropriate point of comparison between standard and subgrid solutions however this is not the case for the discharge which depends strongly on the bottom stress and its distribution in space fig 3 shows the relative discharge error r q n q ref q n 100 where q n is the volumetric discharge across the channel cross section u h d y for the subgrid and standard solutions and q ref is the discharge of the reference solution in fig 3 the magenta diamonds depict the results from closure level 1 and the blue stars depict closure level 0 it is noted that in this test case because every computational cell is completely wet the subgrid technique with level 0 closure and standard method become identical due to the fact that the area fraction ϕ is unity and h w is simply η h g it can be seen that the level 0 closure underpredicts the discharge especially at low water levels because the advection term is negligible and surface elevations of the reference solution and coarse grid solution are identical it can be concluded that bottom friction is the only term that is not a good approximation in the coarse grid solution because the difference in water depth between channel and flat floodplains is relatively large for these low water levels the level 0 closure overestimates the bottom friction and as a consequence underestimates velocity and discharge as the water level increases the relative difference in depth decreases and the predicted closure level 0 discharge value becomes closer to that of the reference solution it can be observed that the discharge obtained from level 1 is close to that of the reference solution for all water levels which is as expected since this closure was derived under the assumption of uniform channel flow 3 1 2 parabolic channel in this example quasi tidal flow in a long parabolic channel is considered with a channel cross section as shown in fig 4 the channel length is 5376 m and width is 128 m the channel inlet surface elevation is forced with a tide like time series η t sin 2 π t t m where t is a varying forcing period to assess sensitivity of the closures a wall boundary condition is imposed on the far end of the channel for this case the reference solution uses a grid with 2 m 2 m resolution while the coarse simulations use a much coarser 128 m 128 m grid the full channel width is included in one coarse grid cell but there are 42 coarse cells in the direction of flow the underlying bathymetric data employed in the subgrid calculations is identical to that of the reference solution fig 5 shows water surface amplitudes maximum minus minimum surface elevation for the subgrid and standard solutions after flow reaches a periodic steady state at the far end of the channel in this test example portions of the channel are subjected to rising and receding water the subgrid systems which account for the mass correction through the partial filling of cells that are not fully submerged can improve upon the standard solution indeed as can be observed in fig 5 the amplitudes obtained from the subgrid system are in significantly better agreement with the reference solution in comparison to the standard solution level 0 closure blue stars which includes only the partial filling accurately predicts amplitude especially at low forcing frequencies where the effect of nonlinearity in the system is low however the mass correction alone is insufficient as indicated by somewhat larger errors in level 0 closure results for higher frequencies these problems stem from inaccurate bottom friction and advection terms in this test case there is an overestimation of friction and an underestimation of advective stresses in contrast the subgrid system with level 1 closure which is based on a constant frictional slope assumption yields water surface amplitudes that match closely to the reference solution this provides numerical evidence that when the proper subgrid correction parameters are used the system proposed here is able to produce an accurate solution on the coarse grid 3 1 3 compound parabolic channel in this final quasi 1d example a compound parabolic channel is considered for quasi tidal flow as illustrated in fig 6 the channel has a length of 5376 m and an overall width of 256 m and a flat floodplain exists at elevation z 0 25 m as with the previous example the open boundary is forced by the elevation boundary condition η t sin 2 π t t m with a wall boundary at the far end thus water periodically generates overflow from the main channel to the flood plain the grid size used in the coarse grid calculations and reference solution is 256 m 256 m and 2 m 2 m respectively fig 7 shows the computed coarse grid water surface amplitudes for subgrid levels 0 and 1 closures at the closed end of the channel in comparison to the coarse grid standard solutions and the high resolution reference solution overall the results exhibit a pattern similar to the previous example the standard solution yields rather poor amplitudes at all but the lowest forcing frequencies while both level 0 and especially level 1 closures produce solutions that are in much better agreement with the reference solution solutions for level 0 closure do show errors increasing with increasing forcing frequency level 0 closure errors for this test are noticeably larger than those found for the level 0 closure solution of the parabolic problem as shown in fig 8 this error increase comes from the very large relative variation in water depth between channel and wet floodplain and consequent variations in friction and convective stresses level 0 closures do not account for the large depth variations in computation of bottom stresses and convective momentum and so have much greater error for this case in contrast the level 1 closure can provide a much more accurate water surface amplitude as seen in fig 7 as it accounts for the effect of friction and convective stresses and the channel floodplain test closely resembles the assumptions used to derive the level 1 closure itself 3 2 flow through repeating bay channel systems a first test of the level 2 closure methodology is performed in an idealized system of bays and channels which differs strongly from the quasi 1d systems tested previously in this system channels enable exchange of mass and momentum between subsequent bays the channel bay interface features an abrupt narrowing expansion meaning the characteristic velocity fields of the bays and channels vary greatly the chain like geometry of bays and channels induces non linear momentum effects that create challenges in predicting the surface elevations and velocities in each bay simulations of this system are run on a high resolution grid where all geometrical descriptions are resolved additionally simulations are computed on a coarse grid where each coarse grid cell spans a single bay channel pair with such coarse resolution the momentum equations require significant corrections when the interplay of the channel and bay scale physics is significant 3 2 1 repeating bay channel system setup the bathymetry for the system of repeating bays and channels is shown in fig 9 in total there are 10 bay channel pairs with each bay connected to the subsequent bay by a narrow channel wet portions of the domain blue have a bed elevation of z 4 m the elevation of the neighboring floodplains yellow is z 1 m sufficiently high that it remains dry throughout the simulation each bay has length 320 m and width 480 m where width is in the y direction and perpendicular to the primary flow direction each channel has length 192 m and width 32 m the seaward boundary borders a longer reservoir with length 1024 m and width 512 m which has a periodic elevation boundary condition imposed at x 0 driving primary flow sinusoidal quasi tidal forcing cycles have a varying period t with a fixed range of 0 4 m which is 10 of the still water depth the accuracy and robustness of our initial level 2 closure is examined by running simulations for varying forcing frequencies and comparing to high resolution simulations and other closure levels 3 2 2 level 2 corrections level 2 corrections are employed on a coarse grid with dimensions 512 m 512 m this resolution fits one channel bay pair exactly into one coarse cell in this study as a first attempt at level 2 closure correction coefficient values are time independent level 2 coefficient values are selected for each grid cell from high resolution results using the methods described previously in section 2 4 4 and we note that each coarse grid cell has a separate set of time independent correction coefficients 3 2 3 repeating bay channel reference case the reference test case for the bay channel geometry has period t 3 h it is selected because the high resolution and standard coarse grid solutions have significant differences in both the surface elevation amplitudes and timing the high resolution simulation used for comparison and to train the level 2 closure has 8 m 8 m resolution fig 10 a shows the water surface amplitude in each bay for the high resolution black standard red level 0 closure blue and level 2 closure green simulations note that for this particular case levels 0 and 1 closures are identical because the wet area of each cell has uniform depth in general the standard and level 0 methods overestimate the amplitude in each bay the level 2 closure more accurately predicts amplitudes in bays closest to the reservoir however water level fluctuations are overestimated in the back bays the predicted amplitude by the standard method is always largest fig 10 b displays the error in timing of high tide as a fraction of forcing period t peak n t peak r e f t where t peak corresponds to the time of the fourth high tide event for the high resolution and coarse simulations and t is the forcing period the standard and level 0 closure methods predict early arrival of high tide and this error increases as distance from the reservoir increases however including the level 2 coefficients significantly reduces the error in arrival of high water specifically the representative correction coefficients used in level 2 closure effectively increase friction while also reducing the sea surface gradient effect both of which delay the propagation of the wave as the distance from the reservoir increases the standard and level 0 closure methods generally display greater error in predicting the timing of high and low tide events as well as the amplitude fig 10 c d displays the time series of surface elevation for the fine and coarse resolution simulations in the bay farthest from the reservoir and in the reservoir respectively in the reservoir all coarse simulations show excellent agreement with the high resolution run as expected because this is where forcing is applied in the back bay the flow has been significantly affected by the channels and so the correction terms in the momentum equations become important the standard and level 0 closure simulations yield surface elevations that significantly deviate from the high resolution benchmark the level 2 closure method sufficiently corrects the timing of the flow however the amplitude is still overestimated in the repeating bay channel system the channels play an important role in transporting momentum through the domain the narrowing at the bay channel interface induces an area of high flow velocity and thus high deviations from the mean coarse cell velocity u these fluctuations manifest as large values of corrections to the friction and convective terms additionally the channels experience large sea surface gradients but only comprise a small portion of the overall grid hence the channel scale physics must be incorporated into the momentum equation of the coarse simulations for accurate portrayal of sea surface evolution the importance of averaged sea surface gradient may be seen in fig 10 a b for the magenta triangles which represent sub level 2 computations level 2 with surface gradient coefficients set to c η x x c η y y 1 c η x y c η y x 0 these sub level 2 results are much worse than full level 2 and are very close to those from levels 1 and 0 simulations demonstrating that even if convection and friction are considered the new surface gradient average terms introduced here are needed in some situations to ensure that accurate solutions are obtained given that primary flow is in the x direction the important closure coefficients are c u u c η x and n m x fig 11 shows the representative values of these correction coefficients divided by the coefficients of the standard solution c u u c η x 1 n 02 the effective bottom friction roughness n m x is larger than the local roughness coefficient the average effective roughness parameter over all coarse grid points is n m x 053 which is 2 6 time greater than the high resolution value increasing the effective bottom friction is important for accurately capturing event timings in the bays far from the reservoir as well as lowering amplitudes in the back bays similarly a large correction coefficient c u u 8 5 is required in the convective term to account for the high velocity in the channel the sea surface gradient on the other hand requires a reduction by approximately a factor of 10 c η x 0 10 note the surface gradient and convective corrections increased the accuracy of amplitudes however the overestimation of amplitude by the level 2 closure suggests that the simple methodology used here i e choosing one closure value that is independent of water level may be too simplistic 3 2 4 level 2 robustness the sensitivity of level 2 closure corrections to forcing frequency is tested by varying the forcing periods to t 1 5 2 3 6 and 12 h but using the same correction coefficients as were found for t 3 h fig 12 plots the amplitude in the back bay against the forcing period for the different cases as the frequency increases the deviation in amplitude from the high resolution solution also increases for the standard and level 0 methods see fig 12 a while the level 2 closure is considerably more accurate similarly the errors in high tide arrival time increase with increasing forcing frequency for the standard and level 0 methods see fig 12 b again the level 2 closure accounts for channel scale physics that effectively delay the signal and therefore predict more accurately the timing of high tide events for higher frequencies sub level 2 simulations without surface gradient corrections give results that are much worse than with full level 2 almost certainly because of the large differences in surface gradients between wide bays and narrow channels at low frequencies all coarse methods provide accurate representation of sea surface evolution fig 12 c d shows the time series of surface elevation in the back bay for the longest 12 h and shortest 1 5 h forcing periods using a 12 h period all coarse simulation methods match the high resolution run using a higher forcing frequency the errors in both amplitude and arrival time increase for the standard and level 0 methods thus suggesting the need for significant correction of the momentum equation fig 12 shows the level 2 closure can accurately approximate this correction for all tested forcing frequencies and that the coefficients needed for such corrections are relatively independent of frequency hence this suggests that if the appropriate correction coefficients can be found they could provide a robust model not only for the case where they are based on but also over more general conditions 3 3 complex test buttermilk bay in this section the subgrid system is applied to a more realistic simulation of flooding cycles at buttermilk bay massachusetts usa 41 760n 70 620w see fig 13 this multi bay system has a main bay connected by a very narrow channel to a secondary bay little buttermilk bay that is quite difficult to simulate using standard techniques a tertiary water body queen sewell pond has a slightly higher elevation than the two main bays but can be reached by high water levels the computational domain ω used here has dimensions 3584 m 3584 m red box in fig 13 see also fig 14 the simulation is driven at the southern boundary by the tide like elevation boundary conditions see fig 14 more specifically the elevation boundary conditions 31 η a 0 tanh 2 t t r cos ω t are imposed along x y 0 2224 x 3234 the portion of the southern boundary close to the cohasset narrows inlet note that as the flow in the cape cod canal is not the main interest of this test zero elevations are prescribed along the portion of boundaries intersecting the canal in 31 a 0 denotes the forcing amplitude ω the frequency and t r the ramping time the test considered here simulates large semidiurnal tidal cycles and flow between the different bays more precisely the tidal frequency is set to ω 1 4544 1 0 4 s 1 and a 0 2 m this range is larger than the 0 8 m total combined semi diurnal m2 s2 n2 and k2 tides see anon 0000 in this area note that this unrealistically large tidal amplitude is intentionally employed in order to test the robustness of the subgrid system in dealing with filling and draining the test considers neither wind nor atmospheric pressure forcing all simulations are started from a quiescent initial state the elevation forcing is gradually ramped from zero with the ramping time t r 0 25 day level 0 and level 1 closures are considered in the subgrid system the momentum equations in the quasi non conservative forms are employed in the numerical calculations six computational coarse grids are used for intercomparison with resolutions δ x δ y 512 256 128 64 32 16 8 m the staggered fd fv solution with casulli s subgrid wetting drying casulli 2009 computed on the 4 m grid is used as a reference solution our numerical schemes with level 0 closure is to large extent very similar to this fd fv scheme here the finer grids are obtained successively by dividing each grid cell into four uniform cells in all subgrid calculations 1 m lidar elevation data are used to describe the subgrid bathymetric depth danielson et al 2018 a standard model where the bathymetric depth in each cell is equal to an average of the lidar data over the cell is also considered for comparison purposes fig 15 illustrates the cell averaged bathymetric depth of the area north of the cohasset narrow on the grids of successively coarsening resolution the resolution of the grid shown in fig 15 c is 64 m which is slightly coarser than the typical finest grid size used in the floodplains of state of the art high resolution storm surge models such as adcirc tanaka et al 2011 hope et al 2013 it can be noticed that a large amount of topographical detail is already lost at this level of resolution and further loss of detail can be clearly observed as the grid resolutions are further coarsened figs 16 18 show respectively the surface elevation of the wet area computed on the grids of 8 64 256 m resolution at three specific times in which the tide at the boundary is rising in these figures plots on the left column show the results from the standard model and the right column show the results from the subgrid model with level 0 closure it is noted that cells in the standard model are either wet or dry while in the subgrid model the cells can be partially wet when the high resolution 8 m grid is used i e when the topographical features are sufficiently resolved the results from the standard model and the subgrid model are in very good agreement see fig 16 as can be seen in fig 18 the coarse grid 256 m solution of the standard model completely fails to capture the connections between the bays due to the loss of topographical details of the averaged topography it can be clearly observed that the subgrid model is indeed able to capture all connections between the inlet main bay and back bay in the coarse grid solution in addition the passages of water through the small hydro connectivity features i e a brook at the northwest of the main bay and a small channel on the southern end of the back bay are clearly present in the subgrid solution for the 64 m grid see fig 17 although the connection between the main bay and back bay exists in the solution of the standard model it is clearly insufficient as indicated by the time lag of the response in the back bay although not shown in this figure it is noted that the numerical solutions of the subgrid model with level 1 closure are qualitatively and quantitatively very similar to the solution of the level 0 closure the time series of the surface elevation are recorded at different locations figs 19 22 plot the time series at stations marked by blue dots in fig 14 a in these figures the top panel shows the standard solution and the bottom panel shows the subgrid solution with level 0 closure computed on various grids note that because the results from level 1 closure are virtually identical to that of level 0 they are omitted from the plots from these figures it can be clearly noticed that when using the same resolution coarse grid solutions obtained from the subgrid model are always in better agreement with the 4 m reference solution than the standard model indeed flow does not reach the main bay and little buttermilk bay when coarse grids are used in the standard solution at these locations a much higher resolution is required in the standard model in order to obtain numerical results that are comparable to that of the coarse grid subgrid model note that flow from the inlet enters buttermilk bay and its back bay through the channels both the subgrid and standard solutions show an increase in grid sensitivity at the stations in the secondary bays in comparison to those at station 1 however the subgrid model is significantly less sensitive to grid resolution than the standard model the usual root mean square rms errors over one cycle are given by 32 e x 1 n i 1 n η x t i η ref x t i 2 t i i δ t t a where n denotes the number of samples over one cycle with δ t 5 min sampling size and t a 1 day denotes an offset constant these are given in table 1 a c for the standard level 0 closure and level 1 closure solutions respectively for the same grid resolution the rms errors in the subgrid solution are at worst comparable to one order of magnitude lower than those of the standard solution at all stations as qualitatively observed in the previous plots the rms errors in the coarse grid solution from the subgrid model are directly comparable to those of the standard solution computed on the higher resolution grid for example at station 3 the subgrid level 0 closure solution on 256 m grid is roughly comparable to the standard solution on 32 m to 64 m grids at station 5 which is located in the wetting drying areas the subgrid solution is comparable to the standard solution on 8 m to 16 m grids which are even finer than those seen in station 3 the results demonstrate the potential cost savings from employing the subgrid model as reasonable results may be obtained with significantly lower degrees of freedom approximately one to two orders of magnitude for this particular test in comparison to the reference solution used errors in the level 1 closure solution are in overall slightly higher than those of the level 0 closure solution the level 1 closure solution shows slightly lower error levels at some grid resolutions especially at station 1 this is somewhat unexpected as it would be surmised that level 1 would be more accurate the reasons for the difference appear to be because for larger grid sizes a single cell near the connections can contain both part of the large bay and a narrow channel much like in section 3 2 3 thus level 1 assumptions are not necessarily more appropriate a second reason arises from artificial connectivity induced by two separate water bodies without connectivity appearing in some of the largest grid cells for both levels 0 and 1 as it is now the system assumes that these bodies are connected at the subgrid level but this is not necessarily true nevertheless the differences between the error levels in the level 1 and 0 closure solution are negligibly small lastly it is worthwhile to mention that at these stations the numerical rates of convergence of both level 0 and level 1 closure subgrid models range approximately from 0 5 to 1 i e e s o h p p 0 5 1 0 the rates are within the range of values to be generally expected in our numerical schemes since they are based on the use of the first order upwind scheme and a fixed mesh solution technique in dealing with the problem of wetting drying areas 4 discussion and conclusions when compared to standard shallow water solutions it is clear that the use of subgrid corrections derived by a formal averaging process allows increased accuracy in complex shore regions when using lower resolution simulations however simulation accuracy depends greatly on the form of closures and more complex scenarios may require more complex closures most of the closure terms derived by the averaging process might have been expected from intuition and some have already been implemented by other researchers however corrections to the gradient of mean water surface elevations shown in eqs 20 21 are less obvious but appear quite necessary in situations where flow characteristics change strongly within an averaging volume determination of closure coefficients remains a challenging task and much work will be required to investigate general closure methodologies however the repeating bay channel test case showed that even in systems that display complex geometries and have non linear effects a simple coefficient can still effectively capture much of the subgrid physics at play and significantly improve model performance anisotropy of friction and spatial variability of surface elevation gradients is another area where further research is needed tensorial manning s coefficients have been used by inland flooding researchers viero and valipour 2017 but their application to general inhomogeneous topographies is not yet a solved problem one aspect of the subgrid system that was not addressed but is very important in many coastal regions is flow connectivity through an averaging area the work presented here does not yet consider whether flow at the boundaries has a path to reach other boundaries of a grid cell or whether it is blocked by land in some regions including the buttermilk bay simulations not accounting for these non continuous flow paths may be a limiting factor for simulation accuracy and as seen in fig 1 very recently casulli 2019 addressed this issue by cloning cells and edges based on connectivity effectively introducing additional degrees of freedom into a single grid location corrections such as this appear to be necessary when a single degree of freedom is insufficient flow connectivity is an important area of research that continues to be actively investigated all tests considered here were conducted on relatively small regular grids using a code written specifically for the subgrid system most typical storm surge and circulation simulations use much larger grids and may have very different grid properties efforts are underway to incorporate the subgrid corrections introduced here into more widely used and available models that have a greater impact on the field and will be reported on in the future acknowledgments work here was funded under national science foundation usa grants icer 1664040 and 1664037 and through a grant from the joint airborne lidar bathymetry technical center of expertise jalbtcx usa through a subcontract with optimal geo ts is supported by the national science foundation usa graduate research fellowship under grant no dge 1841556 their support is gratefully acknowledged appendix a quasi non conservative form of subgrid equations non conservative forms of shallow water like equations are useful for many numerical schemes the most obvious subgrid solution is to perform averaging on the nonconservative form directly and then to develop closures this naive methodology proves suboptimal as whitaker averaging in this form generates several difficulties to close boundary integral terms that disappear in the conservative forms because of the zero depth and thus momentum at the wet dry boundary an alternate methodology that removes these forms is to begin with 27 28 and use the product rule to expand the third and fourth terms on the left hand side of 27 and 28 to arrive at 33 h g u t u c u u 1 u c u v 1 v h g c u u u h g u x c u v v h g u y g c η x x h g η x g h g c η x y η y ϕ u c m f x x u c m f x y v ϕ τ s x w ρ h g ρ p a x f c v h g 1 ρ x h g μ t 2 u x 1 ρ y h g μ t u y v x 34 h g v t v c v u 1 u c v v 1 v h g c v u u h g v x c v v v h g v y g c η y x h g η x g c η y y h g η y ϕ u c m f y x u c m f y y v ϕ τ s y w ρ h g ρ p a x f c u h g 1 ρ x h g μ t u y v x 1 ρ y h g μ t 2 v y note that the above forms offer convenience in numerical realization as the differences between the implementations of the quasi conservative and quasi non conservative are only in the discretization schemes for the advection terms see appendix b for more details note that the quasi non conservative forms that resemble more to the conventional non conservative forms can be obtained by dividing both sides of the above equations by the grid average depth appendix b fd scheme on structured staggered grid this section describes finite difference schemes on a staggered grid used in numerical discretization of the governing equations 15 27 and 28 these finite difference schemes are based in large part on adaptations of the numerical schemes presented in casulli 1990 2009 stelling and duinmeijer 2003 volp et al 2013 to accommodate the proposed subgrid governing equations note that although the mass equations 15 and 16 are equivalent when is defined by 9 15 is chosen since it leads to a preferable property of mass conservation at the discrete level the terms associated with cross term closure coefficients c η x y c η y x c m f x y c m f y x in the averaged momentum equations are excluded in this study they will be implemented in a future study here the standard 2d arakawa c grid is adopted the unknown flow variables η u and u are placed at the cell center and at the midpoint of the vertical and horizontal cell edges respectively see fig 23 the mass 15 and the x momentum 27 and the y momentum 28 are discretized at the nodes associated with the discrete variables η u and v respectively to keep the notation simple η u v and h will be used to refer to the averaged variables η u v and h g respectively the precise notation will be used when it is not clear from context the control volumes ω η i j x i 1 2 x i 1 2 y j 1 2 y j 1 2 ω u i 1 2 j x i 1 x i y j 1 2 y i j 1 2 ω v i j 1 2 x i 1 2 x i 1 2 y j 1 y i j 1 are assigned to the flow variables η i j u i 1 2 j and v i j 1 2 respectively the averaging area a g is assumed to be identical to the grid size the control volume size for a given η and bathymetric depth h x of arbitrarily fine resolution the value of the averaged water depth at each node is evaluated from the formula 9 with the integration defined over its associated control volume see fig 24 b 0 1 continuity discretization a semi implicit finite difference discretization of the continuity equation 15 for a cell i j is considered this scheme is a result of using the euler backward in time discretization with the grid averaged total water depth h from the current time level by multiplying the above equation by δ x δ y one has 35 v i j η i j n 1 v i j η i j n δ t u i 1 2 j n 1 a i 1 2 j n u i 1 2 j n 1 a i 1 2 j n v i j 1 2 n 1 a i j 1 2 n v i j 1 2 n 1 a i j 1 2 n 0 a form reminiscent of the fv scheme where v i j is the water volume in the cell a i 1 2 j n 1 h i 1 2 j n δ y and a i j 1 2 n 1 h i j 1 2 n δ x the grid averaged water height h i 1 2 j is determined by 36 h i 1 2 j 1 δ x δ y ω u h d x 1 δ x δ y x i x i 1 2 y i 1 2 y i 1 2 h η i j d x d y x i 1 2 x i 1 y i 1 2 y i 1 2 h η i 1 j d x d y the grid average at the v node h i j 1 2 is defined in the same manner it is noted that the formula 35 is written for any cell having at least one wet edge the edge is considered wet when the wet cross section area of such edge is greater than a given small positive tolerance more precisely the edge associated with u i 1 2 j is considered wet when y j 1 2 y j 1 2 h η i 1 2 j d y ε where η i 1 2 j η i j η i 1 j 2 b 0 2 momentum discretization for simplicity of presentation the x and y directed bottom stresses τ b x and τ b y are written as τ b x ρ w γ u τ b y ρ w γ v below the discretization of the x momentum equation 27 is described a semi implicit finite difference scheme on the u node is given by 37 h i 1 2 n u i 1 2 j n 1 u i 1 2 j n δ t f i 1 2 j n g h i 1 2 j n c η i 1 2 j η i 1 j η i j δ x γ i 1 2 j u i 1 2 j n 1 where f i 1 2 j n u i 1 2 j q e u q w u δ x q n v q s v δ y 38 c u u e q e u u e n c u u w q w u u w n δ x c u v n q n v u n n c u v s q s v u s n δ y is the discretization formula of the advection term note that in this discretization formula the bottom friction and the surface gradient terms are treated implicitly via the euler backward scheme while the advection terms are treated explicitly through the euler forward scheme in 38 q e u q w u represent the x directed mass fluxes at the east and west edges of the control volume ω u while q n v and q s v denote the y directed mass fluxes at the north and south edges they are evaluated through the following formula q e u u i 1 2 j n h i 1 2 j n 1 u i 3 2 j n h i 3 2 j n 1 2 q w u u i 1 2 j n h i 1 2 j n 1 u i 1 2 j n h i 1 2 j n 1 2 q n v v i j 1 2 n h i j 1 2 n 1 v i 1 j 1 2 n h i 1 j 1 2 n 1 2 q s v v i j 1 2 n h i j 1 2 n 1 v i 1 j 1 2 n h i 1 j 1 2 n 1 2 the velocities u e u w u n and u s which are the x directed velocity along the east west north and south edges of the control volume ω u respectively are determined by a first order upwind scheme with an upwind direction determined by a sign of the flow q e more precisely u e u i 1 2 j q e u 0 u i 3 2 j q e u 0 u w u i 1 2 j q w u 0 u i 1 2 j q w u 0 39 u n u i 1 2 j q n v 0 u i 1 2 j 1 q n v 0 u w u i 1 2 j 1 q s v 0 u i 1 2 j q s v 0 it can be verified that when c u u and c u v are set to one the discrete advection term is simply an upwind scheme for example if the flow direction is positive q e 0 the discrete advection term at the u i 1 2 j node corresponds to f i 1 2 j n q w u u i 1 2 j u i 1 2 j δ x q s v u i 1 2 j u i 1 2 j 1 δ y by rearranging 37 one has at the i 1 2 j node 40 u i 1 2 j n 1 1 h i 1 2 j h i 1 2 j n u i 1 2 j n δ t f i 1 2 j n g δ t δ x h i 1 2 j n η i 1 j n 1 η i j n 1 where h i 1 2 j 1 h i 1 2 j n γ i 1 2 j δ t a semi implicit finite difference scheme for the y momentum equation at the v node can be devised in a similar way more specifically at node i j 1 2 one has 41 v i j 1 2 n 1 1 h i j 1 2 h i j 1 2 n v i j 1 2 n δ t g i j 1 2 n g δ t δ x h i j 1 2 n η i j 1 n 1 η i j n 1 where g i j 1 2 n represents the explicit discretization scheme of the advection the fd equations for the non conservative momentum equations 33 and 34 are identical to 40 and 41 except for f n and g n more precisely the following scheme 42 f i 1 2 j n u i 1 2 j c u u e 1 q e u c u u w 1 q w u δ x c u v n 1 q n v c u v s 1 q s v δ y c u u u i 1 2 j n h i 1 2 j n λ x 1 u i 1 2 j n λ x 0 u i 1 2 j n λ x 1 u i 3 2 j n δ x c u v v i 1 2 j n h i 1 2 j n λ y 1 u i 1 2 j 1 n λ y 0 u i 1 2 j n λ y 1 u i 1 2 j 1 n δ y is considered in the discretization of the x momentum equation here the value of λ x l and λ y l depends on the upwind direction more precisely λ x 1 1 λ x 0 1 λ x 1 0 for u i 1 2 j 0 λ x 1 0 λ x 0 1 λ x 1 1 for u i 1 2 j 0 λ y 1 1 λ y 0 1 λ y 1 0 for v i 1 2 j 0 λ y 1 0 λ y 0 1 λ y 1 1 for v i 1 2 j 0 since v i 1 2 j is not defined on the u node where the x momentum is discretized v i 1 2 j is interpolated from the surrounding v nodes through v i 1 2 j n v i j 1 2 n v i 1 j 1 2 n v i j 1 2 n v i 1 j 1 2 n 4 note that g n for the y momentum equation 34 is defined in an analogous manner the discretization formulas 40 and 41 are defined at the wet edges and the velocity on the dry edges is assumed to be zeros although this is not strictly true at the wetting drying front b 0 3 solution algorithm the solution η n 1 u n 1 v n 1 can be obtained either by i solving the system of nonlinear equations 35 40 and 40 simultaneously or by ii solving a reduced system of equations arising from the substitution of 40 and 40 into 35 casulli 2009 such a reduced system of nonlinear algebraic equations is given by v i j η i j n 1 a i 1 2 j η i 1 j n 1 a i 1 2 j η i 1 j n 1 d i j η i j n 1 a i j 1 2 η i j 1 n 1 a i j 1 2 η i j 1 n 1 v i j n η i j n b i 1 2 j b i 1 2 j b i j 1 2 b i j 1 2 where a i 1 2 j g δ t 2 δ x h i 1 2 j n h i 1 2 j a i 1 2 j a i j 1 2 g δ t 2 δ y h i j 1 2 h i j 1 2 a i j 1 2 d i j a i 1 2 j a i 1 2 j a i j 1 2 a i j 1 2 b i 1 2 j δ t h i 1 2 j a i 1 2 j h i 1 2 j n u i 1 2 j n δ t f i 1 2 j n b i j 1 2 δ t h i j 1 2 a i j 1 2 h i j 1 2 n v i 1 2 j n δ t g i j 1 2 n a more compact form of the above system of equations is 43 v η t η b where η is a vector of the solution at the next time level η i j n 1 t is the matrix with a and d as its entries v is the vector of the water volume and b is the known right hand side vector note that t is symmetric with positive diagonal entries and negative off diagonal entries it has at most five nonzero entries for each row a five point stencil the system of equations 43 is nonlinear and is solved by the newton raphson method 44 ζ m 1 ζ m j 1 v ζ m t ζ m b where m is the iteration step and j ζ m is the jacobian matrix of 43 evaluated at ζ m a good approximation of the jacobian is 45 j p η m t where p is a diagonal matrix of the wet area of the cell δ x δ y ϕ casulli 2009 the formula 44 is iterated with the solution at the current time step as an initial guess η 0 ζ n until a criterion ζ m 1 ζ m t o l is met and set η n 1 ζ m subsequently the velocities at the time level n 1 are obtained from 40 and 41 with the now known ζ n 1 
