index,text
2565,accurate estimation of mountain vegetation gross primary productivity gpp at fine spatial resolutions offers opportunities to better understand mountain ecosystems feedback to the global climate system eco hydrological models have great advantages in simulating mountain vegetation photosynthesis but their large scale applications remain challenging at fine spatial resolutions due to the computing resources in this work a scheme by integrating an eco hydrological model called boreal ecosystem productivity simulator terrainlab btl with the linear and non linear downscaling processes was developed to obtain large scale mountain vegetation gpp at the 30 m resolution over four watersheds firstly two coarse spatial resolution gpp were simulated by btl at 480 m and 120 m then the 30 m resolution gpp was estimated by a linear downscaling process modelled at 120 m and a non linear downscaling process modelled from 480 m to 120 m the 30 m resolution btl simulated gpp was served as reference for evaluation results showed that the root mean square error rmse after downscaling was decreased by 110 gcm 2year 1 compared to the 120 m resolution btl simulated gpp 500 gcm 2 year 1 at the 30 m resolution highlighting the effectiveness of the proposed scheme in recovering the topographic variations of mountain vegetation gpp at fine spatial resolutions compared to the 120 m resolution btl simulated gpp 351 gcm 2 year 1 rmse after downscaling was decreased by 156 gcm 2 year 1 at the 120 m resolution indicating that the proposed scheme is feasible in correcting gpp errors at coarse spatial resolutions more specifically the non linear downscaling process was observed to effectively improve gpp estimates after linear downscaling suggesting that the spatial scaling errors in coarse estimates should be considered in the downscaling process our study indicates that the scheme that runs eco hydrological models at coarse resolutions and then downscales them by surface heterogeneity is a practical approach for obtaining large scale mountain vegetation gpp at fine spatial resolutions keywords gross primary productivity fine spatial resolution eco hydrological models surface heterogeneity spatial downscaling data availability data will be made available on request 1 introduction comprising approximately 24 of the terrestrial surface kapos et al 2000 mountain ecosystems provide a variety of essential services with farreaching effects on the climate system such as carbon storage hilton and west 2020 material resource provisioning bandyopadhyay et al 1997 biodiversity conservation yang and xu 2003 and water reservoirs viviroli et al 2011 over the last century mountain vegetation has been regarded as an essential bio indicator for monitoring the responses of terrestrial ecosystems to climate changes steinbauer et al 2018 accurate estimation of mountain vegetation gross primary productivity gpp defined as the total atmospheric carbon assimilated by vegetation is crucial to understanding the functioning of mountain ecosystems and their feedback on the global climate system chen et al 2012 xu et al 2019 yuan et al 2019 currently gpp can be mainly estimated by eddy covariance ec technology and remote sensing rs based ecosystem models the flux measurements of carbon water and energy are provided by various regional ec networks such as the europeflux aubinet et al 2000 asiaflux mizoguchi et al 2009 carboafrica henry et al 2011 ozflux beringer et al 2016 and ameriflux novick et al 2018 these regional ec networks usually monitor the carbon exchange at the temporal resolution of half hour bhattacharyya et al 2013 but their spatial representation is always limited to several kilometers kljun et al 2015 by combining the canopy scale knowledge of photosynthesis and multi scale vegetation information from rs observations xiao et al 2019 ecosystem models make it feasible to estimate gpp at the large scale which are mainly based on the approaches of machine learning jung 2019 tramontana et al 2016 light use efficiency lue he et al 2013 running et al 2004 xiao et al 2004 vegetation index vi sims et al 2008 wu et al 2011 and process chen et al 1999 foley et al 1996 over the past decades ecosystem models for large scale gpp estimation are always running at medium or coarse spatial resolutions such as the moderate resolution imaging spectroradiometer modis gpp running et al 2015 vegetation photosynthesis model vpm gpp zhang et al 2017 light response function lrf gpp tagesson et al 2021 and global land surface satellite glass gpp liang et al 2021 yuan et al 2010 such coarse or medium gpp datasets have been reported to have large uncertainties in mountain ecosystems because 1 the ignorance of surface heterogeneity within each coarse or medium modelling pixels would lead to obvious spatial scaling errors in the final estimates ahl et al 2005 ershadi et al 2013 xie et al 2022 and 2 coarse or medium estimates would potentially lose the topographic characteristics of mountain vegetation gpp robinson et al 2018 wang et al 2019b regarding the first spatial scaling issue previous studies have made efforts to develop several spatial scaling algorithms by considering surface heterogeneity chen et al 2013 simic et al 2004 xie et al 2021a such as the vegetation type vegetation density and surface topography despite these spatial scaling algorithms could improve the coarse estimates of vegetation productivity they still could not recover the topographic characteristics of mountain vegetation gpp leaving the second issue unsolved since several satellite sensors could offer fine spatial resolution vegetation information fine spatial resolution vegetation gpp estimates can be obtained by directly running ecosystem models at fine spatial resolutions for example robinson et al 2018 executed the modis gpp algorithm at the 30 m resolution and created an improved dataset for the united states recently huang et al 2022 also generated the global fine resolution of glass hi glass gpp dataset by running the two leaf ec lue model at the 30 m resolution by integrating fine spatial resolution rs based information e g landsat vis current fine spatial resolution gpp datasets can further depict the effect of vegetation heterogeneity on photosynthesis but neglect the surface topography in the carbon modeling process limited by the high computing resources almost all the regional or global gpp datasets are generated from lue based or vi based approaches such as the aforementioned modis glass and vpm gpp huang et al 2022 robinson et al 2018 zhang et al 2017 lue based or vi based approaches always estimate gpp based on each single modeling pixel while little attention has been paid to these ecological processes between pixels i e soil water of higher elevation pixels could move to lower elevation pixels beven et al 2021 chen et al 2005 wigmosta et al 1994 in mountain ecosystems surface topography has an apparent hydrological control on the water cycle beven et al 2021 chen et al 2005 wigmosta et al 1994 and therefore the stomatal conductance harris et al 2004 jarvis 1976 tan et al 2019 phenological dynamics band et al 1993 and photosynthesis ju and chen 2005 ju et al 2006 it has been reported that surface topography is as important as vegetation heterogeneity in determining the spatial distributions of vegetation productivity chen et al 2013 for the above purposes some eco hydrological models have been developed to characterize the interaction between terrestrial carbon and water cycles in mountain ecosystems such as the boreal ecosystem productivity simulator beps terrainlab govind et al 2009 and catchment nutrients management model denitrification decomposition model zhang et al 2018 although such eco hydrological models have great advantages in obtaining mountain vegetation gpp their regional or global applications at fine spatial resolutions remain challenging due to the complicated model structures rather than directly running eco hydrological models at fine spatial resolutions running eco hydrological models at coarse spatial resolutions and then downscaling these estimates by surface heterogeneity is a potential method to obtain fine spatial resolution mountain vegetation gpp at regional or global scales over the past decades various algorithms have been proposed to downscale coarser resolution datasets to finer resolutions ma et al 2017a ma et al 2018 ma et al 2019b ma et al 2017b however current spatial downscaling algorithms for carbon and water fluxes estimates usually assume that the relationship between coarse resolution estimates and surface heterogeneity is universal at fine spatial resolutions ke et al 2017 zhao et al 2018 hereafter termed as the linear downscaling process such linear downscaling algorithms neglect the spatial scaling errors in coarse spatial resolution estimates and therefore adopting these relationships obtained at coarse spatial resolutions to obtain fine spatial resolution estimates might have biases to reduce the uncertainties caused by the spatial scaling errors in coarse spatial resolution estimates it is necessary to improve the linear downscaling process by adding a process associated with the non linear response of photosynthesis to environmental variations across spatial resolutions hereafter termed the non linear downscaling process given the above insights the main objectives of this study are to 1 develop a fine spatial resolution estimation scheme for large scale mountain vegetation gpp by integrating an eco hydrological model with the combination of a linear downscaling process and a non linear downscaling process and 2 characterize the contributions of linear and non linear downscaling processes in recovering the topographic characteristics of mountain vegetation gpp at fine spatial resolutions and correcting spatial scaling errors at coarse spatial resolutions in this work the proposed scheme was evaluated at four mountainous watersheds and the outcomes can provide references for obtaining fine spatial resolution mountain vegetation gpp at regional or global scales 2 methodology 2 1 description of the mountain vegetation gpp model an eco hydrological model beps terrainlab v2 0 btl that considers the controls of surface topography on carbon and water cycles govind et al 2009 was used to obtain mountain vegetation gpp in this work in btl a flow mechanism is adopted to simulate the control of surface topography on the movement of groundwater between pixels btl also designs a four leaf strategy to calculate the overstory canopy s photosynthesis ao which can be briefly described as 1 a o a sun a shd 2 a sun a sun u n s a t l a i sun u a sun s a t l a i sun 1 u 3 a shd a shd u n s a t l a i shd u a shd s a t l a i shd 1 u where asun unsat and asun sat are the net photosynthetic rates of the sunlit canopy with the states of unsaturated and saturated moisture respectively ashd unsat and ashd sat are the photosynthetic rates of the shaded canopy with the states of unsaturated and saturated moisture respectively laisun and laishd are the leaf area index lai of sunlit canopy and shaded canopy respectively u is the fraction of roots in the state of unsaturated moisture and thus 1 u represents the fraction of roots in the state of saturated moisture the net photosynthetic rate of the four parts is calculated by a leaf level model farquhar et al 1980 4 a min w c w j r d 5 w c v m c γ c k c 1 o k o 6 w j j m c γ 4 c 8 γ where wc and wj are the gross photosynthetic rates limited by rubiso and rubp respectively rd indicates the daytime leaf dark respiration vm and jm are the maximum rates of carboxylation and electron transport respectively c and o are the concentrations of intercellular co2 and o2 respectively kc and ko are the michaelis menten constants for co2 and o2 respectively γ is the co2 compensation point without dark respiration more descriptions of beps terrainlab and btl are provided in chen et al 1999 chen et al 2005 and govind et al 2009 respectively 2 2 downscaling based scheme for obtaining fine spatial resolution mountain vegetation gpp the proposed downscaling based scheme for obtaining a 30 m resolution mountain vegetation gpp is shown in fig 1 according to the traditional downscaling method used in previous studies ke et al 2017 zhao et al 2018 if assuming that the response of photosynthesis to environmental variations across spatial resolutions is linear the relationship between gpp estimates and surface heterogeneity at coarse resolutions is feasible to estimate gpp at fine spatial resolutions denoted as gppl considering the spatial scaling errors in coarse gpp estimates chen et al 2013 simic et al 2004 xie et al 2021a this study makes a step forward to correct the residual biases in gppl by modelling the non linear response of mountain vegetation photosynthesis to environmental variations denoted as gppnl in this context gpp at the 30 m spatial resolution i e gpp30 l nl is separated into a linear part i e gpp30 l and a non linear part i e gpp30 nl 7 gp p l n l 30 g p p l 30 g p p nl 30 the detailed modelling processes of gpp30 l and gpp30 nl can be found in the following sections 2 2 1 modelling the linear downscaling process at the 120 m and 480 m resolutions firstly gpp estimate at the spatial resolution of 120 m i e gpp120 btl and 480 m i e gpp480 btl is obtained by directly running the btl model then the relationships between btl simulated gpp and surface heterogeneity at 120 m i e f120 l and 480 m i e f480 l are modelled by the random forest algorithm 8 gp p btl 120 f l 120 x veg 120 x top 120 x met 9 gp p btl 480 f l 480 x veg 480 x top 480 x met where x120 veg and x120 top are the indicators for describing vegetation heterogeneity and surface topography at 120 m resolution respectively x480 veg and x480 top are the indicators for describing vegetation heterogeneity and surface topography at 480 m resolution respectively xmet represents the climatic indicators including precipitation pre radiation rad and temperature tem at the watershed scale based on previous studies chen et al 2013 xie et al 2021a this study expresses the vegetation heterogeneity by land cover lc and lai and describes the local and long distance topographical variations by elevation slope aspect topographic wetness index twi and sky view factor svf the basis for selecting these factors can be found in appendix s1 twi and svf can be calculated according to sorensen et al 2006 and zaksek et al 2011 10 twi i n facc tan s 11 svf 1 n d i 1 n d 1 sin h i where facc indicates the area of flow accumulation s is the slope hi represents the angle of vertical altitude nd indicates the total number of directions random forest is an ensemble based algorithm by assuming that a set of predictors always perform better than an individual predictor breiman et al 2001 which has been successfully and widely used in estimating biological parameters such as gpp tramontana et al 2016 lai houborg and mccabe 2018 soil moisture zhao et al 2018 and land surface temperature zhao et al 2019 during the regression process a multitude of decision trees the number was set as 500 in this work are firstly constructed based on approximately two thirds of the training sample i e bootstrap samples and then are un biasedly evaluated against the remaining one third samples i e out of bag samples the predicted values of all the individual trees in the forest are aggregated to obtain the final values 2 2 2 modelling the non linear downscaling process from 480 m to 120 m resolution in this step the linear downscaling process modelled at 480 m resolution i e f480 l is firstly applied to obtain gpp at the 120 m resolution i e gpp120 l 12 gp p l 120 f l 480 x veg 120 x top 120 x met where x120 veg and x120 top are the indicators for describing vegetation heterogeneity and surface topography at 120 m resolution respectively if the response of photosynthesis to environmental variations across spatial resolutions is linear there should be no bias between gpp120 btl and gpp120 l however there are inevitable residual biases due to the spatial scaling errors and it can be calculated as 13 gp p nl 120 g p p btl 120 g p p l 120 finally the relationship between gpp120 nl and the variations of surface heterogeneity from 120 m to 480 m i e fnl is also modelled by the random forest algorithm 14 gp p nl 120 f nl x veg 120 x top 120 x veg 480 x top 480 x met 2 2 3 obtaining gpp at the 30 m resolution by combining the linear and non linear downscaling according to the modelling processes associated with linear downscaling and non linear downscaling the modelled relationships are applied to the information of surface heterogeneity at the spatial resolutions of 30 m and 120 m 15 gp p l 30 f l 120 x veg 30 x top 30 x met 16 gp p nl 30 f nl x veg 30 x top 30 x veg 120 x top 120 x met where x30 veg and x30 top are respectively the indicators for describing vegetation heterogeneity and surface topography at the spatial resolution of 30 m 2 3 experimental design 2 3 1 study areas as listed in table 1 the proposed scheme was evaluated at four mountainous watersheds namely cn wl jp mbf us gle and cn cha as shown in fig 2 the slope ranges of cn wl jp mbf us gle and cn cha are 0 79 0 49 0 54 and 0 27 respectively the the main vegetation types are needleleaf forest nf broadleaf forest bf mixed forest mf shrubland grass and crop 2 3 2 data source and processing in this work mainly five datasets were used to drive the btl model which can be summarized as 1 the site based daily meteorological data in the four watersheds including incoming solar radiation air temperature and precipitation 2 30 m resolution lc maps acquired from gong et al 2013 and xie et al 2021b 3 30 m resolution and 8 day lai maps generated from modis and landsat datasets xie et al 2021a xie et al 2021b 4 30 m resolution elevation slope and aspect acquired from the shuttle radar topography mission digital elevation model srtm dem van zyl 2001 and 5 250 m resolution soil type maps obtained from the open land map olm products hengl et al 2017 besides the site based meteorological data all the other four datasets should be firstly prepared at the spatial resolution of 30 m in the middle or coarse spatial resolution simulations of carbon and water fluxes over mountainous areas previous studies always calculate slope and aspect at the fine spatial resolution and then aggregated them to coarser resolutions zhao et al 2019 in this study the soil type maps at the spatial resolution of 30 m were obtained from the coarse olm maps by assuming the soil types of subpixels were same to those of the coarse pixels then these 30 m resolution input datasets were aggregated to two coarse spatial resolutions following that 1 the lc and soil type of each 120 m or 480 m pixel were set as the major types of 30 m subpixels and 2 lai elevation slope and aspect were averaged to the 480 m or 120 m resolution additionally the available daily ec gpp estimates obtained from the global flux network arain and restrepo coupe 2005 baldocchi et al 2001 guan et al 2006 matsumoto et al 2008 were also adopted to evaluate the btl model at the jp mbf us gle and cn cha sites since cn wl is a newly established station the site based measurements were insufficient to obtain reliable tower based gpp wutzler et al 2018 more descriptions of calculating tower based gpp can be found at the website of https www bgc jena mpg de 2 3 3 simulation procedure of btl in this work the key biophysical parameter of btl named maximum carboxylation rate across vegetation types was obtained from he et al 2019 and other biophysical parameters were set following liu et al 2018 besides these biophysical parameters hydrological parameters of btl were set according to the corresponding values in govind et al 2009 previous studies associated with the spatial scaling of vegetation productivity were always conducted by annual values chen et al 2013 simic et al 2004 in this work all the gpp estimates from btl were simulated at a daily step and then aggregated to annual values to perform the downscaling process 2 3 4 validation of the proposed scheme ec technology could provide reliable carbon flux measurements and thus ec gpp has been widely used to evaluate gpp estimates from various models over the past decades guan et al 2021 running et al 2004 zhang et al 2017 to validate the proposed scheme the gpp estimates obtained by running the btl model at the 30 m resolution were served as the reference gpp i e gpp30 btl and the reference gpp was firstly evaluated against daily ec gpp with regards to the effectiveness of the proposed downscaling based scheme in recovering the topographic features of mountain vegetation gpp at the 30 m resolution relationships between reference gpp and 1 120 m resolution btl simulated gpp resampled to 30 m resolution by assuming the values of subpixels were same to those of the coarse pixels 2 gpp after linear downscaling and 3 gpp after linear and non linear downscaling were adopted as evaluation indicators to further assess the advantage of the proposed scheme in correcting spatial scaling errors relationships between aggregated reference gpp and 1 120 m resolution btl simulated gpp or aggregated to the 480 m resolution 2 aggregated gpp after linear downscaling and 3 aggregated gpp after linear and non linear downscaling were also compared at 120 m and 480 m resolutions in the above comparisons the agreement index d root mean square error rmse and mean absolute error mae were selected as the indicators 17 d 1 j 1 n p j o j 2 j 1 n p j o o j o 2 18 rmse 1 n j 1 n p j o j 2 19 mae 1 n i 1 n p j o j where n is the total number of 30 m 120 m or 480 m resolution pixels o is the reference gpp at 30 m resolution aggregated reference gpp at 120 m resolution or aggregated reference gpp at 480 m resolution p is the 120 m resolution btl simulated gpp gpp after linear downscaling and gpp after linear and non linear downscaling prepared at 30 m 120 m and 480 m resolutions o is the mean value of o 3 results and analysis 3 1 relationships between ec gpp and gpp estimates relationships between ec gpp and btl simulated gpp at the jp mbf us gle and cn cha sites are presented in fig 3 results showed that daily btl simulated gpp at the 30 m resolution had good relationships with ec gpp characterized by d values of 0 83 0 96 and rmse values of 0 59 2 76 gc m 2 day 1 compared to the btl simulated gpp estimates at the spatial resolution of 120 m btl simulated gpp estimates at the spatial resolution of 30 m were observed to match better with ec gpp with the d values increased by 0 02 to 0 12 and the rmse values decreased by 0 04 to 0 87 gc m 2 day 1 3 2 evaluation of the rf algorithm in modeling linear and non linear relationships relationships between 120 m resolution btl simulated gpp and rf trained gpp are presented in fig 4 results showed that rf trained gpp from the linear modeling process had a good relationship with the 120 m resolution btl simulated gpp characterized by d rmse and mae values of 0 96 119 and 83 gc m 2 yr 1 as for the combination of linear and non linear modeling processes rf trained gpp also matched well with the 120 m resolution btl simulated gpp characterized by d rmse and mae values of 0 98 98 and 66 gc m 2 yr 1 compared the linear modeling process the combination of linear and non linear modeling processes was observed to achieve a slight better performance with rmse and mae values decreased by 21 and 17 gc m 2 yr 1 3 3 comparisons of gpp estimates at the spatial resolution of 30 m the spatial distributions of reference gpp and gpp after linear and non linear downscaling at the 30 m resolution over the cn wl watershed sub fig 5 aa ba are presented as an example as shown in sub fig 5cb 120 m resolution btl simulated gpp was observed to lose the most detailed characteristics over the whole watershed and the major pixels with high values showed an obvious underestimation after applying the linear and non linear downscaling processes the gpp estimates were observed to recover the major topographic features at the watershed scale and the phenomenon of underestimation was alleviated the 30 m resolution relationships between reference gpp and 120 m resolution btl simulated gpp gpp after linear downscaling and gpp after both the linear and non linear downscaling are illustrated in sub fig 6 aa ba and ca as for all the pixels over the four watersheds the d rmse and mae values between reference gpp and 120 m resolution btl simulated gpp were 0 69 500 and 341 gc m 2 year 1 respectively the d rmse and mae values were improved 1 by 0 07 91 and 53 gc m 2 year 1 after the linear downscaling and 2 by 0 13 110 and 63 gc m 2 year 1 after both the linear and non linear downscaling in comparisons with the 120 m resolution btl simulated gpp estimates the d values between reference gpp and 120 m resolution btl simulated gpp after linear downscaling and after both the linear and non linear downscaling across vegetation types are listed in table 2 at the 30 m resolution the d values of 120 m resolution btl simulated gpp in forest shrub grass and crop pixels were 0 65 0 70 0 82 and 0 72 respectively after applying the linear downscaling process the d values of gpp estimates in forest shrub grass and crop pixels were increased by 0 05 0 13 0 10 and 0 14 respectively after applying both the linear and non linear downscaling processes the d values of gpp estimates in forest shrub grass and crop pixels were increased by 0 12 0 17 0 12 and 0 17 respectively compared to the single linear downscaling the combination of linear and non linear downscaling processes increased the d values by 0 07 0 04 0 02 and 0 03 in forest shrub grass and crop pixels 3 4 comparisons of gpp estimates at the spatial resolutions of 120 m and 480 m the spatial characteristics of aggregated reference gpp 120 m resolution btl simulated gpp or aggregated to the 480 m resolution aggregated gpp after linear downscaling and aggregated gpp after linear and non linear downscaling at the 120 m resolution sub fig 5 ab cb and 480 m resolution sub fig 5 ac cc over the cn wl watershed are presented as an example at the 120 m and 480 m resolutions 120 m resolution btl simulated gpp showed a similar spatial distribution to the reference gpp in low values while an apparent spatial difference with reference gpp was observed in high values the gpp estimates were observed to increase in the high values after applying both the linear and non linear downscaling processes the pixel based gpp comparisons at the 120 m resolution are shown in sub fig 6 ab cb results showed that 120 m resolution btl simulated gpp had a moderate relationship with reference gpp characterized by the d rmse and mae values of 0 80 351 and 256 gc m 2 year 1 after applying the linear downscaling process gpp estimates were found to match better with the reference gpp with d rmse and mae values were improved by 0 08 106 and 81 gc m 2 year 1 at the 120 m resolution gpp estimates after applying both the linear and non linear downscaling processes were observed to match best with reference gpp at the 120 m resolution with d rmse and mae values were improved by 0 14 156 and 114 gc m 2 year 1 compared to the 120 m resolution btl simulated gpp the gpp comparisons at the 480 m resolution are illustrated in sub fig 6 ac cc the d rmse and mae values between reference gpp and 120 m resolution btl simulated gpp at the 480 m resolution were 0 88 235 and 178 gc m 2 year 1 respectively compared to the 120 m resolution btl simulated gpp estimates the d rmse and mae values were improved 1 by 0 02 29 and 23 gc m 2 year 1 after the linear downscaling and 2 by 0 08 92 and 72 gc m 2 year 1 after both the linear and non linear downscaling at the 480 m resolution as listed in table 2 at the 120 m resolution the d values of 120 m resolution btl simulated gpp in forest shrub grass and crop pixels were 0 77 0 81 0 93 and 0 88 respectively after applying the linear downscaling process the d values of gpp estimates in forest shrub grass and crop pixels were increased by 0 07 0 13 0 05 and 0 09 respectively after applying both the linear and non linear downscaling processes the d values in forest shrub grass and crop pixels were increased by 0 15 0 15 0 05 and 0 09 respectively at the 120 m resolution the combination of linear and non linear downscaling processes increased the d values by 0 08 and 0 02 in forest and shrub pixels compared to the single linear downscaling 3 5 contributions of linear and non linear downscaling processes across topographic conditions the d values between reference gpp and 120 m resolution btl simulated gpp gpp after linear downscaling and gpp after linear and non linear downscaling in different slope ranges are summarized in table 3 and fig 7 in different slope ranges d values of 120 m resolution btl simulated gpp gpp after linear downscaling and gpp after linear and non linear downscaling ranged from 0 64 to 0 77 0 70 0 89 and 0 77 0 91 respectively results also showed that d between reference gpp and 120 m resolution btl simulated gpp increased when the slope varied from 0 to 30 and presented similar values in the slope ranges of 30 50 after applying the linear downscaling process d was decreased by 0 06 0 12 which usually showed a higher value with an increase in slope after applying both the linear and non linear downscaling processes d was further decreased by 0 02 0 07 compared to the single linear downscaling process which showed a lower improvement with an increase in slope 4 discussion 4 1 effectiveness of the proposed scheme in obtaining fine spatial resolution mountain vegetation gpp generally the performances of linear downscaling process at the spatial resolutions of 30 m 120 m and 480 m were expected because the effect of vegetation heterogeneity local topographical variations and long distance topographical variations on photosynthesis at the watershed scale is still preserved in the 120 m and 480 m resolution gpp estimates vegetation heterogeneity has been reported as a determining factor in photosynthesis characteristics associated with vegetation types he et al 2019 jung et al 2007 park et al 2019 xiao et al 2011 and the capacity of vegetation photosynthesis related to canopy density and structure chen and black 1992 fang et al 2019 topographical variations are important in regulating the incoming solar radiation yan et al 2018 movement of the saturated subsurface base flows cycle beven et al 2021 chen et al 2005 wigmosta et al 1994 and therefore the water availability of vegetation ju and chen 2005 ju et al 2006 the finer spatial resolution that the linear downscaling process is modelled at the better performance of the linear downscaling process would be the linear downscaling process was modelled by assuming that the relationship between coarse resolution estimates and surface heterogeneity is universal at fine spatial resolutions which is widely adopted in current spatial downscaling algorithms for the estimates of carbon and water fluxes ke et al 2017 zhao et al 2018 although the influence of surface heterogeneity on photosynthesis at the watershed scale is preserved in the 120 m and 480 m resolution gpp estimates the ignorance of surface heterogeneity within modelling pixels has been reported to cause obvious spatial scaling errors in these coarse resolution estimates ahl et al 2005 ershadi et al 2013 moorcroft et al 2001 therefore gpp estimates after the linear downscaling process might still have biases for this need this work innovatively proposed a non linear downscaling process by the relationships between gpp estimates at the 120 m resolution and the variations of surface heterogeneity from 480 m to 120 m compared to the single linear downscaling the combination of linear and non linear downscaling processes was observed to achieve a larger improvement of gpp estimates at the spatial resolutions of 30 m 120 m and 480 m because the non linear downscaling effectively reduced the spatial scaling errors by integrating the variations of vegetation heterogeneity local topographical variations and long distance topographical variations from 120 m to 30 m for example simic et al 2004 developed a spatial scaling algorithm associated with the spatial information of lai and lc to correct coarse resolution net primary productivity npp estimates based on the effectiveness of endogenous heterogeneity chen et al 2013 further improved the spatial scaling algorithm by adding the local topographical variations i e elevation and slope xie et al 2021a also moved forward to integrate the algorithm of chen et al 2013 with the subpixel information of long distance topographical variations i e svf and twi in this work the non linear downscaling was modelled from 480 m to 120 m resolution which might lose the capacity to describe the hydrological control of surface topography from 120 m to 30 m if the non linear downscaling was modelled at a finer spatial resolution the proposed downscaling based scheme would achieve a better performance overall results showed that the scheme proposed in this work could effectively recover the topographic features of mountain vegetation gpp at the 30 m resolution and correct gpp spatial scaling errors at the spatial resolutions of 120 m and 480 m after applying the proposed scheme a larger improvement was observed in the grass shrub and crop pixels than in the forest pixels because herbaceous vegetation might be more sensitive to surface topography previous studies revealed that water availability has an obvious effect in herbaceous vegetation e g grass knapp and smith 2001 liu et al 2016 wu et al 2015 generally water storage of the herbaceous vegetation e g grass and shrub always depends on the quantity of leaf whereas the woody vegetation can obtain water from deep groundwater 4 2 suggestions for obtaining fine spatial resolution mountain vegetation gpp at large scale over the last five years several global vegetation gpp datasets at the 30 m resolution have been generated by executing the gpp models with the rs based vegetation information at fine spatial resolutions huang et al 2022 robinson et al 2018 however almost all the regional or global gpp datasets are obtained from lue based or vi based approaches these approaches always estimate gpp without the consideration of surface topography leading to biases in mountain ecosystems due to the ignored hydrological control of surface topography on the water cycle beven et al 2021 chen et al 2005 wigmosta et al 1994 and therefore the photosynthesis ju and chen 2005 ju et al 2006 eco hydrological models are scientific tools to address the interaction between carbon and water cycles in mountain ecosystems govind et al 2009 zhang et al 2018 whereas their regional or global applications at fine spatial resolutions remain difficult due to the complicated model structures previous studies have made efforts to modify lue based and vi based models to improve mountain vegetation gpp estimation xie and li 2020a b but the understanding of multiple ecological interactions between surface topography and vegetation photosynthesis in these modified models is not as plentiful as that in the eco hydrological models to develop a general approach that are of interest to carbon modelling in mountain ecosystems the main purpose of this work is to find an effective way to obtain fine spatial resolution mountain vegetation gpp 1 the used ecosystem models should have the full ability to describe hydrological control of surface topography on vegetation photosynthesis 2 the computing resources in the large scale simulations should be low and thus it can be easily implemented and 3 the uncertainties in these fine spatial resolution mountain vegetation gpp estimates should be as low as possible under the above situation of low computing resources to meet the above requirements this study firstly suggested a scheme that runs eco hydrological models at coarse spatial resolutions and then downscales these coarse estimates by surface heterogeneity which is a feasible approach for obtaining fine spatial resolution mountain vegetation gpp at large scale 4 3 existing limitations in current work in this work the random forest algorithm was adopted to model the linear downscaling process and the non linear downscaling process it should be noted that the construction of the linear and non linear downscaling models was restricted to those covered by surface characteristics at the spatial resolutions of 480 m and 120 m for example if the coarse resolution pixels used in the construction of downscaling models are all in low slopes the random forest algorithm would show uncertainties for the 30 m resolution pixels with very high slopes e g 70 previous studies also indicated that sufficient pixels under different topographic characteristics are necessary to construct accurate regression models hutengs and vohland 2016 in this work the mean values of gpp estimates within the central 1 5 1 5 km area at tower sites were compared with ec gpp a previous study has suggested that the direct use of rs lai data in ecosystem models would lead to an underestimation in annual gpp wang et al 2019a gpp directly simulated at 30 m resolution had a lower value than ec gpp in this work which might be caused by the direct use of current rs lai actually footprint variation could lead to both over and under estimations of carbon flux due to various wind directions and surface heterogeneity and more consideration should be given to the flux footprint in the future the environmental factors are very necessary in the gpp downscaling process three climatic indicators including precipitation radiation and temperature were obtained from site based data and then were used in the proposed scheme as current multiple gridded climatic datasets could provide valuable environmental information at large scale ma et al 2019a ma et al 2022 ma et al 2020 future work should adopt them to obtain mountain vegetation gpp especially in these areas without site based climatic measurements 5 conclusion accurate estimation of mountain vegetation gpp is crucial to understanding the functioning of mountain ecosystems eco hydrological models are scientific tools to simulate the interaction between terrestrial carbon and water cycles in mountain ecosystems whereas their regional or global applications at fine spatial resolutions remain challenging due to the complicated model structures to overcome the high computing resources of directly running eco hydrological models at fine spatial resolutions a scheme by integrating an eco hydrological model with a linear downscaling process modelled at the spatial resolution of 120 m and a non linear downscaling process modelled from 480 m to 120 m resolution was developed to obtain mountain vegetation gpp at the spatial resolution of 30 m the gpp estimates obtained by running the btl model at the 30 m resolution were served as the reference gpp to evaluate the proposed scheme the main conclusions can be illustrated as 1 at the 30 m resolution results showed that rmse was decreased by 110 gc m 2 year 1 after the combination of linear and non linear downscaling processes compared to the 120 m resolution btl simulated gpp rmse 500 gc m 2 year 1 highlighting the effectiveness of the proposed downscaling based scheme in recovering the topographic variations of mountain vegetation gpp at fine spatial resolutions 2 at the 120 m resolution rmse was observed to decrease by 156 gc m 2 year 1 after the combination of linear and non linear downscaling processes compared to the 120 m resolution btl simulated gpp rmse 351 gc m 2 year 1 suggesting that the proposed downscaling based scheme is feasible in correcting gpp errors at coarse spatial resolutions 3 the non linear downscaling process was observed to effectively improve these gpp estimates after linear downscaling indicating that the spatial scaling errors in coarse estimates should be considered in the current downscaling algorithm of vegetation productivity credit authorship contribution statement xinyao xie conceptualization methodology software investigation visualization writing original draft writing review editing funding acquisition ainong li supervision funding acquisition jie tian visualization changlin wu visualization huaan jin conceptualization methodology declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this study has been jointly supported by the national key research and development program of china grant no 2020yfa0608702 the national natural science foundation of china grant no 42201418 the postdoctoral science foundation of china grant no 2021m700139 the chinese academy of sciences special research assistant program and the strategic priority research program of the chinese academy of sciences grant no xda19030303 this study used modis data landsat data soil texture maps lc maps srtm dem and ec and climate data over four watersheds we should thank all the data providers and researchers special thanks also to mr zhengjian zhang for his efforts in collecting tower measurements at the cn wl site 
2565,accurate estimation of mountain vegetation gross primary productivity gpp at fine spatial resolutions offers opportunities to better understand mountain ecosystems feedback to the global climate system eco hydrological models have great advantages in simulating mountain vegetation photosynthesis but their large scale applications remain challenging at fine spatial resolutions due to the computing resources in this work a scheme by integrating an eco hydrological model called boreal ecosystem productivity simulator terrainlab btl with the linear and non linear downscaling processes was developed to obtain large scale mountain vegetation gpp at the 30 m resolution over four watersheds firstly two coarse spatial resolution gpp were simulated by btl at 480 m and 120 m then the 30 m resolution gpp was estimated by a linear downscaling process modelled at 120 m and a non linear downscaling process modelled from 480 m to 120 m the 30 m resolution btl simulated gpp was served as reference for evaluation results showed that the root mean square error rmse after downscaling was decreased by 110 gcm 2year 1 compared to the 120 m resolution btl simulated gpp 500 gcm 2 year 1 at the 30 m resolution highlighting the effectiveness of the proposed scheme in recovering the topographic variations of mountain vegetation gpp at fine spatial resolutions compared to the 120 m resolution btl simulated gpp 351 gcm 2 year 1 rmse after downscaling was decreased by 156 gcm 2 year 1 at the 120 m resolution indicating that the proposed scheme is feasible in correcting gpp errors at coarse spatial resolutions more specifically the non linear downscaling process was observed to effectively improve gpp estimates after linear downscaling suggesting that the spatial scaling errors in coarse estimates should be considered in the downscaling process our study indicates that the scheme that runs eco hydrological models at coarse resolutions and then downscales them by surface heterogeneity is a practical approach for obtaining large scale mountain vegetation gpp at fine spatial resolutions keywords gross primary productivity fine spatial resolution eco hydrological models surface heterogeneity spatial downscaling data availability data will be made available on request 1 introduction comprising approximately 24 of the terrestrial surface kapos et al 2000 mountain ecosystems provide a variety of essential services with farreaching effects on the climate system such as carbon storage hilton and west 2020 material resource provisioning bandyopadhyay et al 1997 biodiversity conservation yang and xu 2003 and water reservoirs viviroli et al 2011 over the last century mountain vegetation has been regarded as an essential bio indicator for monitoring the responses of terrestrial ecosystems to climate changes steinbauer et al 2018 accurate estimation of mountain vegetation gross primary productivity gpp defined as the total atmospheric carbon assimilated by vegetation is crucial to understanding the functioning of mountain ecosystems and their feedback on the global climate system chen et al 2012 xu et al 2019 yuan et al 2019 currently gpp can be mainly estimated by eddy covariance ec technology and remote sensing rs based ecosystem models the flux measurements of carbon water and energy are provided by various regional ec networks such as the europeflux aubinet et al 2000 asiaflux mizoguchi et al 2009 carboafrica henry et al 2011 ozflux beringer et al 2016 and ameriflux novick et al 2018 these regional ec networks usually monitor the carbon exchange at the temporal resolution of half hour bhattacharyya et al 2013 but their spatial representation is always limited to several kilometers kljun et al 2015 by combining the canopy scale knowledge of photosynthesis and multi scale vegetation information from rs observations xiao et al 2019 ecosystem models make it feasible to estimate gpp at the large scale which are mainly based on the approaches of machine learning jung 2019 tramontana et al 2016 light use efficiency lue he et al 2013 running et al 2004 xiao et al 2004 vegetation index vi sims et al 2008 wu et al 2011 and process chen et al 1999 foley et al 1996 over the past decades ecosystem models for large scale gpp estimation are always running at medium or coarse spatial resolutions such as the moderate resolution imaging spectroradiometer modis gpp running et al 2015 vegetation photosynthesis model vpm gpp zhang et al 2017 light response function lrf gpp tagesson et al 2021 and global land surface satellite glass gpp liang et al 2021 yuan et al 2010 such coarse or medium gpp datasets have been reported to have large uncertainties in mountain ecosystems because 1 the ignorance of surface heterogeneity within each coarse or medium modelling pixels would lead to obvious spatial scaling errors in the final estimates ahl et al 2005 ershadi et al 2013 xie et al 2022 and 2 coarse or medium estimates would potentially lose the topographic characteristics of mountain vegetation gpp robinson et al 2018 wang et al 2019b regarding the first spatial scaling issue previous studies have made efforts to develop several spatial scaling algorithms by considering surface heterogeneity chen et al 2013 simic et al 2004 xie et al 2021a such as the vegetation type vegetation density and surface topography despite these spatial scaling algorithms could improve the coarse estimates of vegetation productivity they still could not recover the topographic characteristics of mountain vegetation gpp leaving the second issue unsolved since several satellite sensors could offer fine spatial resolution vegetation information fine spatial resolution vegetation gpp estimates can be obtained by directly running ecosystem models at fine spatial resolutions for example robinson et al 2018 executed the modis gpp algorithm at the 30 m resolution and created an improved dataset for the united states recently huang et al 2022 also generated the global fine resolution of glass hi glass gpp dataset by running the two leaf ec lue model at the 30 m resolution by integrating fine spatial resolution rs based information e g landsat vis current fine spatial resolution gpp datasets can further depict the effect of vegetation heterogeneity on photosynthesis but neglect the surface topography in the carbon modeling process limited by the high computing resources almost all the regional or global gpp datasets are generated from lue based or vi based approaches such as the aforementioned modis glass and vpm gpp huang et al 2022 robinson et al 2018 zhang et al 2017 lue based or vi based approaches always estimate gpp based on each single modeling pixel while little attention has been paid to these ecological processes between pixels i e soil water of higher elevation pixels could move to lower elevation pixels beven et al 2021 chen et al 2005 wigmosta et al 1994 in mountain ecosystems surface topography has an apparent hydrological control on the water cycle beven et al 2021 chen et al 2005 wigmosta et al 1994 and therefore the stomatal conductance harris et al 2004 jarvis 1976 tan et al 2019 phenological dynamics band et al 1993 and photosynthesis ju and chen 2005 ju et al 2006 it has been reported that surface topography is as important as vegetation heterogeneity in determining the spatial distributions of vegetation productivity chen et al 2013 for the above purposes some eco hydrological models have been developed to characterize the interaction between terrestrial carbon and water cycles in mountain ecosystems such as the boreal ecosystem productivity simulator beps terrainlab govind et al 2009 and catchment nutrients management model denitrification decomposition model zhang et al 2018 although such eco hydrological models have great advantages in obtaining mountain vegetation gpp their regional or global applications at fine spatial resolutions remain challenging due to the complicated model structures rather than directly running eco hydrological models at fine spatial resolutions running eco hydrological models at coarse spatial resolutions and then downscaling these estimates by surface heterogeneity is a potential method to obtain fine spatial resolution mountain vegetation gpp at regional or global scales over the past decades various algorithms have been proposed to downscale coarser resolution datasets to finer resolutions ma et al 2017a ma et al 2018 ma et al 2019b ma et al 2017b however current spatial downscaling algorithms for carbon and water fluxes estimates usually assume that the relationship between coarse resolution estimates and surface heterogeneity is universal at fine spatial resolutions ke et al 2017 zhao et al 2018 hereafter termed as the linear downscaling process such linear downscaling algorithms neglect the spatial scaling errors in coarse spatial resolution estimates and therefore adopting these relationships obtained at coarse spatial resolutions to obtain fine spatial resolution estimates might have biases to reduce the uncertainties caused by the spatial scaling errors in coarse spatial resolution estimates it is necessary to improve the linear downscaling process by adding a process associated with the non linear response of photosynthesis to environmental variations across spatial resolutions hereafter termed the non linear downscaling process given the above insights the main objectives of this study are to 1 develop a fine spatial resolution estimation scheme for large scale mountain vegetation gpp by integrating an eco hydrological model with the combination of a linear downscaling process and a non linear downscaling process and 2 characterize the contributions of linear and non linear downscaling processes in recovering the topographic characteristics of mountain vegetation gpp at fine spatial resolutions and correcting spatial scaling errors at coarse spatial resolutions in this work the proposed scheme was evaluated at four mountainous watersheds and the outcomes can provide references for obtaining fine spatial resolution mountain vegetation gpp at regional or global scales 2 methodology 2 1 description of the mountain vegetation gpp model an eco hydrological model beps terrainlab v2 0 btl that considers the controls of surface topography on carbon and water cycles govind et al 2009 was used to obtain mountain vegetation gpp in this work in btl a flow mechanism is adopted to simulate the control of surface topography on the movement of groundwater between pixels btl also designs a four leaf strategy to calculate the overstory canopy s photosynthesis ao which can be briefly described as 1 a o a sun a shd 2 a sun a sun u n s a t l a i sun u a sun s a t l a i sun 1 u 3 a shd a shd u n s a t l a i shd u a shd s a t l a i shd 1 u where asun unsat and asun sat are the net photosynthetic rates of the sunlit canopy with the states of unsaturated and saturated moisture respectively ashd unsat and ashd sat are the photosynthetic rates of the shaded canopy with the states of unsaturated and saturated moisture respectively laisun and laishd are the leaf area index lai of sunlit canopy and shaded canopy respectively u is the fraction of roots in the state of unsaturated moisture and thus 1 u represents the fraction of roots in the state of saturated moisture the net photosynthetic rate of the four parts is calculated by a leaf level model farquhar et al 1980 4 a min w c w j r d 5 w c v m c γ c k c 1 o k o 6 w j j m c γ 4 c 8 γ where wc and wj are the gross photosynthetic rates limited by rubiso and rubp respectively rd indicates the daytime leaf dark respiration vm and jm are the maximum rates of carboxylation and electron transport respectively c and o are the concentrations of intercellular co2 and o2 respectively kc and ko are the michaelis menten constants for co2 and o2 respectively γ is the co2 compensation point without dark respiration more descriptions of beps terrainlab and btl are provided in chen et al 1999 chen et al 2005 and govind et al 2009 respectively 2 2 downscaling based scheme for obtaining fine spatial resolution mountain vegetation gpp the proposed downscaling based scheme for obtaining a 30 m resolution mountain vegetation gpp is shown in fig 1 according to the traditional downscaling method used in previous studies ke et al 2017 zhao et al 2018 if assuming that the response of photosynthesis to environmental variations across spatial resolutions is linear the relationship between gpp estimates and surface heterogeneity at coarse resolutions is feasible to estimate gpp at fine spatial resolutions denoted as gppl considering the spatial scaling errors in coarse gpp estimates chen et al 2013 simic et al 2004 xie et al 2021a this study makes a step forward to correct the residual biases in gppl by modelling the non linear response of mountain vegetation photosynthesis to environmental variations denoted as gppnl in this context gpp at the 30 m spatial resolution i e gpp30 l nl is separated into a linear part i e gpp30 l and a non linear part i e gpp30 nl 7 gp p l n l 30 g p p l 30 g p p nl 30 the detailed modelling processes of gpp30 l and gpp30 nl can be found in the following sections 2 2 1 modelling the linear downscaling process at the 120 m and 480 m resolutions firstly gpp estimate at the spatial resolution of 120 m i e gpp120 btl and 480 m i e gpp480 btl is obtained by directly running the btl model then the relationships between btl simulated gpp and surface heterogeneity at 120 m i e f120 l and 480 m i e f480 l are modelled by the random forest algorithm 8 gp p btl 120 f l 120 x veg 120 x top 120 x met 9 gp p btl 480 f l 480 x veg 480 x top 480 x met where x120 veg and x120 top are the indicators for describing vegetation heterogeneity and surface topography at 120 m resolution respectively x480 veg and x480 top are the indicators for describing vegetation heterogeneity and surface topography at 480 m resolution respectively xmet represents the climatic indicators including precipitation pre radiation rad and temperature tem at the watershed scale based on previous studies chen et al 2013 xie et al 2021a this study expresses the vegetation heterogeneity by land cover lc and lai and describes the local and long distance topographical variations by elevation slope aspect topographic wetness index twi and sky view factor svf the basis for selecting these factors can be found in appendix s1 twi and svf can be calculated according to sorensen et al 2006 and zaksek et al 2011 10 twi i n facc tan s 11 svf 1 n d i 1 n d 1 sin h i where facc indicates the area of flow accumulation s is the slope hi represents the angle of vertical altitude nd indicates the total number of directions random forest is an ensemble based algorithm by assuming that a set of predictors always perform better than an individual predictor breiman et al 2001 which has been successfully and widely used in estimating biological parameters such as gpp tramontana et al 2016 lai houborg and mccabe 2018 soil moisture zhao et al 2018 and land surface temperature zhao et al 2019 during the regression process a multitude of decision trees the number was set as 500 in this work are firstly constructed based on approximately two thirds of the training sample i e bootstrap samples and then are un biasedly evaluated against the remaining one third samples i e out of bag samples the predicted values of all the individual trees in the forest are aggregated to obtain the final values 2 2 2 modelling the non linear downscaling process from 480 m to 120 m resolution in this step the linear downscaling process modelled at 480 m resolution i e f480 l is firstly applied to obtain gpp at the 120 m resolution i e gpp120 l 12 gp p l 120 f l 480 x veg 120 x top 120 x met where x120 veg and x120 top are the indicators for describing vegetation heterogeneity and surface topography at 120 m resolution respectively if the response of photosynthesis to environmental variations across spatial resolutions is linear there should be no bias between gpp120 btl and gpp120 l however there are inevitable residual biases due to the spatial scaling errors and it can be calculated as 13 gp p nl 120 g p p btl 120 g p p l 120 finally the relationship between gpp120 nl and the variations of surface heterogeneity from 120 m to 480 m i e fnl is also modelled by the random forest algorithm 14 gp p nl 120 f nl x veg 120 x top 120 x veg 480 x top 480 x met 2 2 3 obtaining gpp at the 30 m resolution by combining the linear and non linear downscaling according to the modelling processes associated with linear downscaling and non linear downscaling the modelled relationships are applied to the information of surface heterogeneity at the spatial resolutions of 30 m and 120 m 15 gp p l 30 f l 120 x veg 30 x top 30 x met 16 gp p nl 30 f nl x veg 30 x top 30 x veg 120 x top 120 x met where x30 veg and x30 top are respectively the indicators for describing vegetation heterogeneity and surface topography at the spatial resolution of 30 m 2 3 experimental design 2 3 1 study areas as listed in table 1 the proposed scheme was evaluated at four mountainous watersheds namely cn wl jp mbf us gle and cn cha as shown in fig 2 the slope ranges of cn wl jp mbf us gle and cn cha are 0 79 0 49 0 54 and 0 27 respectively the the main vegetation types are needleleaf forest nf broadleaf forest bf mixed forest mf shrubland grass and crop 2 3 2 data source and processing in this work mainly five datasets were used to drive the btl model which can be summarized as 1 the site based daily meteorological data in the four watersheds including incoming solar radiation air temperature and precipitation 2 30 m resolution lc maps acquired from gong et al 2013 and xie et al 2021b 3 30 m resolution and 8 day lai maps generated from modis and landsat datasets xie et al 2021a xie et al 2021b 4 30 m resolution elevation slope and aspect acquired from the shuttle radar topography mission digital elevation model srtm dem van zyl 2001 and 5 250 m resolution soil type maps obtained from the open land map olm products hengl et al 2017 besides the site based meteorological data all the other four datasets should be firstly prepared at the spatial resolution of 30 m in the middle or coarse spatial resolution simulations of carbon and water fluxes over mountainous areas previous studies always calculate slope and aspect at the fine spatial resolution and then aggregated them to coarser resolutions zhao et al 2019 in this study the soil type maps at the spatial resolution of 30 m were obtained from the coarse olm maps by assuming the soil types of subpixels were same to those of the coarse pixels then these 30 m resolution input datasets were aggregated to two coarse spatial resolutions following that 1 the lc and soil type of each 120 m or 480 m pixel were set as the major types of 30 m subpixels and 2 lai elevation slope and aspect were averaged to the 480 m or 120 m resolution additionally the available daily ec gpp estimates obtained from the global flux network arain and restrepo coupe 2005 baldocchi et al 2001 guan et al 2006 matsumoto et al 2008 were also adopted to evaluate the btl model at the jp mbf us gle and cn cha sites since cn wl is a newly established station the site based measurements were insufficient to obtain reliable tower based gpp wutzler et al 2018 more descriptions of calculating tower based gpp can be found at the website of https www bgc jena mpg de 2 3 3 simulation procedure of btl in this work the key biophysical parameter of btl named maximum carboxylation rate across vegetation types was obtained from he et al 2019 and other biophysical parameters were set following liu et al 2018 besides these biophysical parameters hydrological parameters of btl were set according to the corresponding values in govind et al 2009 previous studies associated with the spatial scaling of vegetation productivity were always conducted by annual values chen et al 2013 simic et al 2004 in this work all the gpp estimates from btl were simulated at a daily step and then aggregated to annual values to perform the downscaling process 2 3 4 validation of the proposed scheme ec technology could provide reliable carbon flux measurements and thus ec gpp has been widely used to evaluate gpp estimates from various models over the past decades guan et al 2021 running et al 2004 zhang et al 2017 to validate the proposed scheme the gpp estimates obtained by running the btl model at the 30 m resolution were served as the reference gpp i e gpp30 btl and the reference gpp was firstly evaluated against daily ec gpp with regards to the effectiveness of the proposed downscaling based scheme in recovering the topographic features of mountain vegetation gpp at the 30 m resolution relationships between reference gpp and 1 120 m resolution btl simulated gpp resampled to 30 m resolution by assuming the values of subpixels were same to those of the coarse pixels 2 gpp after linear downscaling and 3 gpp after linear and non linear downscaling were adopted as evaluation indicators to further assess the advantage of the proposed scheme in correcting spatial scaling errors relationships between aggregated reference gpp and 1 120 m resolution btl simulated gpp or aggregated to the 480 m resolution 2 aggregated gpp after linear downscaling and 3 aggregated gpp after linear and non linear downscaling were also compared at 120 m and 480 m resolutions in the above comparisons the agreement index d root mean square error rmse and mean absolute error mae were selected as the indicators 17 d 1 j 1 n p j o j 2 j 1 n p j o o j o 2 18 rmse 1 n j 1 n p j o j 2 19 mae 1 n i 1 n p j o j where n is the total number of 30 m 120 m or 480 m resolution pixels o is the reference gpp at 30 m resolution aggregated reference gpp at 120 m resolution or aggregated reference gpp at 480 m resolution p is the 120 m resolution btl simulated gpp gpp after linear downscaling and gpp after linear and non linear downscaling prepared at 30 m 120 m and 480 m resolutions o is the mean value of o 3 results and analysis 3 1 relationships between ec gpp and gpp estimates relationships between ec gpp and btl simulated gpp at the jp mbf us gle and cn cha sites are presented in fig 3 results showed that daily btl simulated gpp at the 30 m resolution had good relationships with ec gpp characterized by d values of 0 83 0 96 and rmse values of 0 59 2 76 gc m 2 day 1 compared to the btl simulated gpp estimates at the spatial resolution of 120 m btl simulated gpp estimates at the spatial resolution of 30 m were observed to match better with ec gpp with the d values increased by 0 02 to 0 12 and the rmse values decreased by 0 04 to 0 87 gc m 2 day 1 3 2 evaluation of the rf algorithm in modeling linear and non linear relationships relationships between 120 m resolution btl simulated gpp and rf trained gpp are presented in fig 4 results showed that rf trained gpp from the linear modeling process had a good relationship with the 120 m resolution btl simulated gpp characterized by d rmse and mae values of 0 96 119 and 83 gc m 2 yr 1 as for the combination of linear and non linear modeling processes rf trained gpp also matched well with the 120 m resolution btl simulated gpp characterized by d rmse and mae values of 0 98 98 and 66 gc m 2 yr 1 compared the linear modeling process the combination of linear and non linear modeling processes was observed to achieve a slight better performance with rmse and mae values decreased by 21 and 17 gc m 2 yr 1 3 3 comparisons of gpp estimates at the spatial resolution of 30 m the spatial distributions of reference gpp and gpp after linear and non linear downscaling at the 30 m resolution over the cn wl watershed sub fig 5 aa ba are presented as an example as shown in sub fig 5cb 120 m resolution btl simulated gpp was observed to lose the most detailed characteristics over the whole watershed and the major pixels with high values showed an obvious underestimation after applying the linear and non linear downscaling processes the gpp estimates were observed to recover the major topographic features at the watershed scale and the phenomenon of underestimation was alleviated the 30 m resolution relationships between reference gpp and 120 m resolution btl simulated gpp gpp after linear downscaling and gpp after both the linear and non linear downscaling are illustrated in sub fig 6 aa ba and ca as for all the pixels over the four watersheds the d rmse and mae values between reference gpp and 120 m resolution btl simulated gpp were 0 69 500 and 341 gc m 2 year 1 respectively the d rmse and mae values were improved 1 by 0 07 91 and 53 gc m 2 year 1 after the linear downscaling and 2 by 0 13 110 and 63 gc m 2 year 1 after both the linear and non linear downscaling in comparisons with the 120 m resolution btl simulated gpp estimates the d values between reference gpp and 120 m resolution btl simulated gpp after linear downscaling and after both the linear and non linear downscaling across vegetation types are listed in table 2 at the 30 m resolution the d values of 120 m resolution btl simulated gpp in forest shrub grass and crop pixels were 0 65 0 70 0 82 and 0 72 respectively after applying the linear downscaling process the d values of gpp estimates in forest shrub grass and crop pixels were increased by 0 05 0 13 0 10 and 0 14 respectively after applying both the linear and non linear downscaling processes the d values of gpp estimates in forest shrub grass and crop pixels were increased by 0 12 0 17 0 12 and 0 17 respectively compared to the single linear downscaling the combination of linear and non linear downscaling processes increased the d values by 0 07 0 04 0 02 and 0 03 in forest shrub grass and crop pixels 3 4 comparisons of gpp estimates at the spatial resolutions of 120 m and 480 m the spatial characteristics of aggregated reference gpp 120 m resolution btl simulated gpp or aggregated to the 480 m resolution aggregated gpp after linear downscaling and aggregated gpp after linear and non linear downscaling at the 120 m resolution sub fig 5 ab cb and 480 m resolution sub fig 5 ac cc over the cn wl watershed are presented as an example at the 120 m and 480 m resolutions 120 m resolution btl simulated gpp showed a similar spatial distribution to the reference gpp in low values while an apparent spatial difference with reference gpp was observed in high values the gpp estimates were observed to increase in the high values after applying both the linear and non linear downscaling processes the pixel based gpp comparisons at the 120 m resolution are shown in sub fig 6 ab cb results showed that 120 m resolution btl simulated gpp had a moderate relationship with reference gpp characterized by the d rmse and mae values of 0 80 351 and 256 gc m 2 year 1 after applying the linear downscaling process gpp estimates were found to match better with the reference gpp with d rmse and mae values were improved by 0 08 106 and 81 gc m 2 year 1 at the 120 m resolution gpp estimates after applying both the linear and non linear downscaling processes were observed to match best with reference gpp at the 120 m resolution with d rmse and mae values were improved by 0 14 156 and 114 gc m 2 year 1 compared to the 120 m resolution btl simulated gpp the gpp comparisons at the 480 m resolution are illustrated in sub fig 6 ac cc the d rmse and mae values between reference gpp and 120 m resolution btl simulated gpp at the 480 m resolution were 0 88 235 and 178 gc m 2 year 1 respectively compared to the 120 m resolution btl simulated gpp estimates the d rmse and mae values were improved 1 by 0 02 29 and 23 gc m 2 year 1 after the linear downscaling and 2 by 0 08 92 and 72 gc m 2 year 1 after both the linear and non linear downscaling at the 480 m resolution as listed in table 2 at the 120 m resolution the d values of 120 m resolution btl simulated gpp in forest shrub grass and crop pixels were 0 77 0 81 0 93 and 0 88 respectively after applying the linear downscaling process the d values of gpp estimates in forest shrub grass and crop pixels were increased by 0 07 0 13 0 05 and 0 09 respectively after applying both the linear and non linear downscaling processes the d values in forest shrub grass and crop pixels were increased by 0 15 0 15 0 05 and 0 09 respectively at the 120 m resolution the combination of linear and non linear downscaling processes increased the d values by 0 08 and 0 02 in forest and shrub pixels compared to the single linear downscaling 3 5 contributions of linear and non linear downscaling processes across topographic conditions the d values between reference gpp and 120 m resolution btl simulated gpp gpp after linear downscaling and gpp after linear and non linear downscaling in different slope ranges are summarized in table 3 and fig 7 in different slope ranges d values of 120 m resolution btl simulated gpp gpp after linear downscaling and gpp after linear and non linear downscaling ranged from 0 64 to 0 77 0 70 0 89 and 0 77 0 91 respectively results also showed that d between reference gpp and 120 m resolution btl simulated gpp increased when the slope varied from 0 to 30 and presented similar values in the slope ranges of 30 50 after applying the linear downscaling process d was decreased by 0 06 0 12 which usually showed a higher value with an increase in slope after applying both the linear and non linear downscaling processes d was further decreased by 0 02 0 07 compared to the single linear downscaling process which showed a lower improvement with an increase in slope 4 discussion 4 1 effectiveness of the proposed scheme in obtaining fine spatial resolution mountain vegetation gpp generally the performances of linear downscaling process at the spatial resolutions of 30 m 120 m and 480 m were expected because the effect of vegetation heterogeneity local topographical variations and long distance topographical variations on photosynthesis at the watershed scale is still preserved in the 120 m and 480 m resolution gpp estimates vegetation heterogeneity has been reported as a determining factor in photosynthesis characteristics associated with vegetation types he et al 2019 jung et al 2007 park et al 2019 xiao et al 2011 and the capacity of vegetation photosynthesis related to canopy density and structure chen and black 1992 fang et al 2019 topographical variations are important in regulating the incoming solar radiation yan et al 2018 movement of the saturated subsurface base flows cycle beven et al 2021 chen et al 2005 wigmosta et al 1994 and therefore the water availability of vegetation ju and chen 2005 ju et al 2006 the finer spatial resolution that the linear downscaling process is modelled at the better performance of the linear downscaling process would be the linear downscaling process was modelled by assuming that the relationship between coarse resolution estimates and surface heterogeneity is universal at fine spatial resolutions which is widely adopted in current spatial downscaling algorithms for the estimates of carbon and water fluxes ke et al 2017 zhao et al 2018 although the influence of surface heterogeneity on photosynthesis at the watershed scale is preserved in the 120 m and 480 m resolution gpp estimates the ignorance of surface heterogeneity within modelling pixels has been reported to cause obvious spatial scaling errors in these coarse resolution estimates ahl et al 2005 ershadi et al 2013 moorcroft et al 2001 therefore gpp estimates after the linear downscaling process might still have biases for this need this work innovatively proposed a non linear downscaling process by the relationships between gpp estimates at the 120 m resolution and the variations of surface heterogeneity from 480 m to 120 m compared to the single linear downscaling the combination of linear and non linear downscaling processes was observed to achieve a larger improvement of gpp estimates at the spatial resolutions of 30 m 120 m and 480 m because the non linear downscaling effectively reduced the spatial scaling errors by integrating the variations of vegetation heterogeneity local topographical variations and long distance topographical variations from 120 m to 30 m for example simic et al 2004 developed a spatial scaling algorithm associated with the spatial information of lai and lc to correct coarse resolution net primary productivity npp estimates based on the effectiveness of endogenous heterogeneity chen et al 2013 further improved the spatial scaling algorithm by adding the local topographical variations i e elevation and slope xie et al 2021a also moved forward to integrate the algorithm of chen et al 2013 with the subpixel information of long distance topographical variations i e svf and twi in this work the non linear downscaling was modelled from 480 m to 120 m resolution which might lose the capacity to describe the hydrological control of surface topography from 120 m to 30 m if the non linear downscaling was modelled at a finer spatial resolution the proposed downscaling based scheme would achieve a better performance overall results showed that the scheme proposed in this work could effectively recover the topographic features of mountain vegetation gpp at the 30 m resolution and correct gpp spatial scaling errors at the spatial resolutions of 120 m and 480 m after applying the proposed scheme a larger improvement was observed in the grass shrub and crop pixels than in the forest pixels because herbaceous vegetation might be more sensitive to surface topography previous studies revealed that water availability has an obvious effect in herbaceous vegetation e g grass knapp and smith 2001 liu et al 2016 wu et al 2015 generally water storage of the herbaceous vegetation e g grass and shrub always depends on the quantity of leaf whereas the woody vegetation can obtain water from deep groundwater 4 2 suggestions for obtaining fine spatial resolution mountain vegetation gpp at large scale over the last five years several global vegetation gpp datasets at the 30 m resolution have been generated by executing the gpp models with the rs based vegetation information at fine spatial resolutions huang et al 2022 robinson et al 2018 however almost all the regional or global gpp datasets are obtained from lue based or vi based approaches these approaches always estimate gpp without the consideration of surface topography leading to biases in mountain ecosystems due to the ignored hydrological control of surface topography on the water cycle beven et al 2021 chen et al 2005 wigmosta et al 1994 and therefore the photosynthesis ju and chen 2005 ju et al 2006 eco hydrological models are scientific tools to address the interaction between carbon and water cycles in mountain ecosystems govind et al 2009 zhang et al 2018 whereas their regional or global applications at fine spatial resolutions remain difficult due to the complicated model structures previous studies have made efforts to modify lue based and vi based models to improve mountain vegetation gpp estimation xie and li 2020a b but the understanding of multiple ecological interactions between surface topography and vegetation photosynthesis in these modified models is not as plentiful as that in the eco hydrological models to develop a general approach that are of interest to carbon modelling in mountain ecosystems the main purpose of this work is to find an effective way to obtain fine spatial resolution mountain vegetation gpp 1 the used ecosystem models should have the full ability to describe hydrological control of surface topography on vegetation photosynthesis 2 the computing resources in the large scale simulations should be low and thus it can be easily implemented and 3 the uncertainties in these fine spatial resolution mountain vegetation gpp estimates should be as low as possible under the above situation of low computing resources to meet the above requirements this study firstly suggested a scheme that runs eco hydrological models at coarse spatial resolutions and then downscales these coarse estimates by surface heterogeneity which is a feasible approach for obtaining fine spatial resolution mountain vegetation gpp at large scale 4 3 existing limitations in current work in this work the random forest algorithm was adopted to model the linear downscaling process and the non linear downscaling process it should be noted that the construction of the linear and non linear downscaling models was restricted to those covered by surface characteristics at the spatial resolutions of 480 m and 120 m for example if the coarse resolution pixels used in the construction of downscaling models are all in low slopes the random forest algorithm would show uncertainties for the 30 m resolution pixels with very high slopes e g 70 previous studies also indicated that sufficient pixels under different topographic characteristics are necessary to construct accurate regression models hutengs and vohland 2016 in this work the mean values of gpp estimates within the central 1 5 1 5 km area at tower sites were compared with ec gpp a previous study has suggested that the direct use of rs lai data in ecosystem models would lead to an underestimation in annual gpp wang et al 2019a gpp directly simulated at 30 m resolution had a lower value than ec gpp in this work which might be caused by the direct use of current rs lai actually footprint variation could lead to both over and under estimations of carbon flux due to various wind directions and surface heterogeneity and more consideration should be given to the flux footprint in the future the environmental factors are very necessary in the gpp downscaling process three climatic indicators including precipitation radiation and temperature were obtained from site based data and then were used in the proposed scheme as current multiple gridded climatic datasets could provide valuable environmental information at large scale ma et al 2019a ma et al 2022 ma et al 2020 future work should adopt them to obtain mountain vegetation gpp especially in these areas without site based climatic measurements 5 conclusion accurate estimation of mountain vegetation gpp is crucial to understanding the functioning of mountain ecosystems eco hydrological models are scientific tools to simulate the interaction between terrestrial carbon and water cycles in mountain ecosystems whereas their regional or global applications at fine spatial resolutions remain challenging due to the complicated model structures to overcome the high computing resources of directly running eco hydrological models at fine spatial resolutions a scheme by integrating an eco hydrological model with a linear downscaling process modelled at the spatial resolution of 120 m and a non linear downscaling process modelled from 480 m to 120 m resolution was developed to obtain mountain vegetation gpp at the spatial resolution of 30 m the gpp estimates obtained by running the btl model at the 30 m resolution were served as the reference gpp to evaluate the proposed scheme the main conclusions can be illustrated as 1 at the 30 m resolution results showed that rmse was decreased by 110 gc m 2 year 1 after the combination of linear and non linear downscaling processes compared to the 120 m resolution btl simulated gpp rmse 500 gc m 2 year 1 highlighting the effectiveness of the proposed downscaling based scheme in recovering the topographic variations of mountain vegetation gpp at fine spatial resolutions 2 at the 120 m resolution rmse was observed to decrease by 156 gc m 2 year 1 after the combination of linear and non linear downscaling processes compared to the 120 m resolution btl simulated gpp rmse 351 gc m 2 year 1 suggesting that the proposed downscaling based scheme is feasible in correcting gpp errors at coarse spatial resolutions 3 the non linear downscaling process was observed to effectively improve these gpp estimates after linear downscaling indicating that the spatial scaling errors in coarse estimates should be considered in the current downscaling algorithm of vegetation productivity credit authorship contribution statement xinyao xie conceptualization methodology software investigation visualization writing original draft writing review editing funding acquisition ainong li supervision funding acquisition jie tian visualization changlin wu visualization huaan jin conceptualization methodology declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this study has been jointly supported by the national key research and development program of china grant no 2020yfa0608702 the national natural science foundation of china grant no 42201418 the postdoctoral science foundation of china grant no 2021m700139 the chinese academy of sciences special research assistant program and the strategic priority research program of the chinese academy of sciences grant no xda19030303 this study used modis data landsat data soil texture maps lc maps srtm dem and ec and climate data over four watersheds we should thank all the data providers and researchers special thanks also to mr zhengjian zhang for his efforts in collecting tower measurements at the cn wl site 
2566,due to the fast dissolution kinetics of rich carbonate minerals on the chinese loess plateau clp the high ph values and high concentrations of ca2 and dissolved inorganic carbon dic characterize the surface waters on the clp which represents the largest loess area in the world the unique hydrochemical properties of aquatic ecosystems on the clp may have substantial biological carbon pump bcp potential a mechanism that changes the availability of c n and p which affects phytoplankton structure or composition to change eutrophication and phytoplankton abundance to improve gross primary productivity gpp therefore understanding the c n p driven changes in river fed reservoir ecosystems on the clp is essential for improving watershed management mitigating eutrophication and optimizing carbon sequestration here we investigated the phytoplankton community structure and gpp the stable carbon isotope compositions of dic particulate organic carbon poc δ13cdic and δ13cpoc and c n p nutrient levels in the wuli river dongfeng and hong river houjiahe river fed reservoir ecosystems in xi an city on the northwestern clp during the hydrological year from november 2020 to july 2021 our results show that 1 phytoplankton photosynthesis was the major mechanism that drove the transformation of the dic to organic carbon in the reservoirs and the hydrodynamic effect can be enhanced by shortening the hydraulic retention time hrt which leads to increases in flow velocity increases in water disturbances and decreases in nutrient load of the water body photosynthesis and algal growth 2 the gpp in the dongfeng reservoir with high hco3 concentrations but low co2 10 μm and low total nitrogen total phosphorus tn tp ratios 4 was limited by n due to the predominance of cyanophyta and chlorophyta and the gpp in the houjiahe reservoir with low hco3 concentrations but high co2 10 μm and high tn tp ratios 100 was limited by c due to the predominance of bacillariophyta 3 the availability of co2 regulated the structure of the phytoplankton community in the reservoirs and with an increase in dissolved co2 the dominant species changed from cyanophyta to bacillariophyta therefore it is inferred that by changing land use or adjusting the hrt of the reservoir we may maintain the required c n p nutrient element ratios for promoting co2 fertilization on the bcp in reservoirs on the clp which may simultaneously help increase carbon sequestration and alleviate eutrophication by changing the phytoplankton community structure from cyanophyta to bacillariophyta keywords phytoplankton community succession c n p limitation river fed reservoir ecosystem eutrophication mitigation carbon sequestration chinese loess plateau data availability data will be made available on request 1 introduction as primary producers in aquatic ecosystems e g rivers reservoirs and lakes phytoplankton photosynthetic carbon sequestration contributes almost 50 to the global gross primary productivity gpp of organic matter bauer et al 2013 havens 2014 wang et al 2011 phytoplankton assimilates dissolved inorganic carbon dic during photosynthesis and converts it into organic carbon oc which is closely associated with the carbon sink anderson et al 2014 and huang et al 2017 have found that when lakes are converted from oligo mesotrophic to eutrophic their carbon sequestration capacity increases in eutrophic waters however the transparency and dissolved oxygen do content of the water are reduced as algae residues decompose and generate large amounts of greenhouse gases li et al 2021 in addition cyanophyta bloom in eutrophic water bodies can produce odorous and toxic compounds causing serious harm to aquatic ecosystems and human health huisman et al 2018 ross et al 2006 therefore although eutrophication contributes useful carbon sinks which may help alleviate global warming it is detrimental to aquatic ecosystems in addition studies have shown that in the hard alkaline aquatic karst ecosystems in southwest china photosynthetic organisms produce a biological carbon pump bcp effect through photosynthesis converting dic to oc which is an important mechanism for the formation of stable and long term carbonate weathering carbon sink he et al 2020 he et al 2022 liu and dreybrodt 2015 additionally dic fertilization of bcp might benefit phytoplankton communities in the water body by adjusting their structure bao et al 2021 bao et al 2020 zeng et al 2019 although bcp and water eutrophication are governed by the formation of organic matter through aquatic photosynthesis their nutrient restriction mechanisms differ the relative availability of carbon c nitrogen n and phosphorus p often restricts the basic structure of phytoplankton communities in aquatic ecosystems and affects the formation of catalytic cell pools the rate of photosynthesis and thus the growth and maximum achievable biomass hammer et al 2019 phillips et al 2008 since the cp debate of the early 1970 s phytoplankton growth in lakes is largely believed to depend on p availability carpenter 2008 schindler et al 2008 this is primarily due to the fact that some cyanobacteria can fix n to meet their n requirements smith 1990 however studies have demonstrated that when the trophic state changes in inland waters n may be a potential factor in limiting phytoplankton development chaffin 2013 ibáñez and penuelas 2019 further studies have shown that n and p are interchangeable as the main limiting factors for example the system with nitrogen fixing algae mainly shows p limitation and the system without nitrogen fixing algae may mainly show n limitation whereas dissolved co2 co2 aq aq is used herein instead of aqueous is unlikely to be a major limiting factor howarth and marino 2006 schindler et al 1972 schindler et al 1973 smith 1984 tyrrell 1999 however many observations call for reconsidering the role of co2 aq in freshwater ecosystems especially in hard alkaline waters first the exchange of co2 between water and atmosphere is slow and the diffusion rate of co2 in surface water is 104 fold lower than that in the atmosphere stumm and morgan 1981 owing to extensive photosynthesis during the growth of phytoplankton the diffusive influx of co2 from the air cannot fulfill the photosynthetic demand second in freshwater and marine systems co2 aq is the preferred substrate for photosynthesis although hco3 is available to many primary producers burris et al 1981 king 1970 kragh et al 2017 low decarie et al 2015 third ph levels of alkaline water are usually between 8 and 9 within this range dic in the water is dominated by hco3 and the concentration of co2 aq is only 1 2 dic zeng et al 2019 additionally photosynthesis by phytoplankton reduces the concentration of co2 aq causing the water to become co2 unsaturated and increasing the ph value which leads to a further decrease in the proportion of co2 aq in dic thus the availability of co2 aq can be a limiting factor for phytoplankton photosynthesis king 1970 low decarie et al 2011 zagarese et al 2021 notably ample evidence supports this conclusion for example low decarie et al 2015 found through a mesocosms experiment that co2 aq greatly enhanced the growth of phytoplankton bao et al 2020 found that high co2 aq increased the c sequestration in karst surface waters with high ph and high dic however these findings are mainly from mesocosms experiments or karst areas in southwest china and the situation in the chinese loess plateau clp remains unclear in addition to gpp the structure and composition of phytoplankton respond to variations in co2 aq concentrations in surface waters iversen et al 2019 in long term evolution some algae use the co2 concentrating mechanism ccm to enhance their affinity for dic enabling hco3 to act as a c source for photosynthesis gaining a competitive advantage reinfelder 2011 phytoplankton ccm are species specific raven et al 2020 therefore elevated co2 may favor species that possess inferior ccm or do not contain ccm riebesell 2004 shi et al 2017 cyanophyta directly related to eutrophication are more capable than other algae of adapting to low co2 aq but chlorophyta bacillariophyta and submerged plants which are beneficial for the improvement of water quality often grow in high co2 aq environment bao et al 2020 kragh et al 2017 low decarie et al 2015 low decarie et al 2011 vadstrup and madsen 1995 wang et al 2018 zeng et al 2019 water chemistry is primarily influenced by carbonate weathering in the clp zhang et al 2015 and is characterized by high ph hco3 and ca2 levels which is similar to the water chemistry of karst water bodies in southwest china where alkaline hard water is dominant however the c limitation on phytoplankton growth and the succession of phytoplankton species in surface waters on the clp which show similar hydrochemical characteristics to karst areas in southwest china but different climatic conditions remain unclear in addition the damming of the river not only changes the continuity of the river but increases the hydraulic retention time hrt affecting hydrodynamic conditions and changing the nutrient cycle in the river the stoichiometries are also different in the two reservoirs this differences affects the limiting nutrient of phytoplankton changing the phytoplankton community naiman et al 1987 vörösmarty and dork 2000 which affects the efficiency of bcp thus we investigated the phytoplankton community structure and gpp the stable carbon isotope compositions of dic particulate organic carbon poc δ13cdic and δ13cpoc and c n p nutrient levels in the two dammed rivers located in xi an city on the northwestern clp we hypothesized that a c fertilization mechanism of bcp in aquatic ecosystems of the clp would help increase the carbon sink capacity of surface water and alleviating eutrophication simultaneously via changes in biological structure and species compositions this finding is of great significance for mitigating the greenhouse gas effect improving water quality management and restoring aquatic ecosystems liu et al 2021 riebesell et al 1993 especially in the arid and semi arid clp where rainfall is scarce and evaporation is strong limiting water resources 2 materials and methods 2 1 study area the studied reservoirs were dongfeng reservoir dfsk and houjiahe reservoir hjhsk xi an city shaanxi province 34 10 34 18 n 109 10 109 22 e fig 1 with average depths of 5 m and 3 m and surface areas of 0 065 km2 and 0 05 km2 respectively hjhsk fig 1e exhibits a shorter hrt table s1 than dfsk does fig 1d because the former has a perennial outlet fig 1c with an annual average flow of 0 15 m3 s 1 fig s1 notably dfsk and hjhsk are on the wuli river wlh fig 1b and hong river hh fig 1c respectively both rivers are characterized by a warm temperate semi humid continental climate and the annual mean air temperature is 13 the annual precipitation is 720 mm of which nearly 60 occurs from july to october mo et al 2018 farmland 70 4 is the dominant land use type along the wlh followed by forest 26 3 fig 1b along the hh forest 57 3 is the dominant use type followed by farmland 38 8 fig 1c the two watersheds are located on the clp which covers 640 000 km2 accounting for 6 of china s land surface representing the largest loess area worldwide li et al 2019 liu 1985 the carbonate content in the clp is between 10 and 20 li et al 2007 zhang et al 1995 carbonate weathering is more sensitive to the monsoon climate than silicates owing to the relatively fast dissolution kinetics of carbonates jin et al 2011 liu and dreybrod 1997 therefore both watersheds feature notable carbonate weathering a description of the two watershed s geology and stratigraphy is provided in the supplementary information si 2 2 field monitoring field monitoring was performed in autumn november 2020 winter january 2021 spring april 2021 and summer july 2021 based on the climate cycle portable ponsel odeon equipment was used to measure water temperature wt ph electrical conductivity ec 25 c and dissolved oxygen do before deployment the equipment was calibrated for ph ec and do the calibration method and the device s measuring accuracy were as described by bao et al 2020 moreover dic was titrated using an in situ aquamerck alkalinity test kit merck germany with a resolution of 0 05 mmol l 1 zeng et al 2017 since the ph of the surface water was between 8 14 and 9 40 in the study area the alkalinity was chiefly composed of hco3 zeng et al 2019 therefore the result of alkalinity titration mainly reflects the hco3 concentration 2 3 sample collection and bulk geochemical analyses thirty nine surface water samples were collected in ultrapure water washed 100 ml glass bottles to determine tn and tp the samples were filtered through 0 45 μm millipore filters into 20 ml acid washed high density polyethylene bottles for major cation and anion determination cation samples were acidified to ph 2 using ultrapure hno3 major anions and major cations were analyzed by automated dionex ics 90 ion chromatography dionex usa and inductively coupled plasma optical emission spectrometer icp oes usa respectively tp and tn were measured using molybdate spectrophotometry gb 11893 89 and were analyzed using ultraviolet spectroscopy hj 636 2012 after digestion with alkaline potassium persulfate respectively doc poc concentrations and the δ13c of dic and poc were measured using the method described by zhao et al 2022 total suspended solids tss were determined by the weighing method yang et al 2016 in addition surface water samples upper 0 5 m were collected and filtered through a 47 mm gf f filter and stored at 20 to test the chlorophyll a chl a we used 95 hot ethanol extractions to determine chl a concentration sartory and grobbelaar 1984 methods for identification of phytoplankton species and algal cell counts are in si the δ13c of dic and poc were measured on a mat 252 253 thermo fisher scientific mass spectrometer stable c isotope ratios are reported per mil relative to the international vienna peedee belemnite standard the accuracy of δ13c of the instrument was better than 0 06 δ13c was calculated as δ13csample rsample rstandard rstandard 1000 in this equation r is the 13c 12c ratio of the sample 2 4 data calculation and statistics 2 4 1 calculation of the gpp the vertical generalized production model vgpm was used to calculate gpp the model comprehensively considers factors that affect the primary productivity of the water column such as wt light conditions chl a content and the depth of the euphotic layer to accurately estimate the primary production of phytoplankton behrenfeld and falkowski 1997a the vgpm has been verified by datasets from thousands of sites over long periods in large areas and in different waters its calculation is accurate it is widely applicable and its basic form is as follows 1 gpp 0 66125 p opt b e0 e0 4 1 z e u c o p t d i r r where gpp is the primary productivity integrated from the surface layer to the euphotic layer mgc m 2 d 1 copt is the chl a concentration of surface water μg l 1 deng et al 2017 and dirr is the photoperiod h https data sheshiyuanyi com weatherdata p opt b is the maximum rate of c fixation of the water column as a function of wt and its expression is as follows behrenfeld and falkowski 1997a b 2 p opt b 1 13 t 1 0 4 00 t 28 5 p opt b 1 0 t 28 5 3 p opt b 1 2956 2 749 10 1 t 6 17 10 2 t 2 2 05 10 2 t 3 2 462 10 3 t 4 1 3148 10 4 t 5 3 4132 10 6 t 6 3 27 10 8 t 7 where p opt b is the maximum rate of c fixation of the water column when 1 0 t 28 5 is the wt e0 is the photosynthetically available radiation intensity of the water surface mol m 2 d 1 in this study e0 is 30 mol m 2 d 1 in spring 32 54 mol m 2 d 1 in summer 19 76 in autumn and 16 08 mol m 2 d 1 in winter jiang et al 2013 zeu is the depth of the euphotic layer when the water depth is less than the depth of the euphotic layer it is replaced by the water depth and calculated by the following empirical formula 4 zeu 4 605 0 062ctripton 0 011cchla 1 430 r2 0 954 n 199 p 0 001 where ctripton is the concentration of tss and cchla is the chl a concentration of the surface water μg l 1 yin et al 2017 2 4 2 calculation of co2 partial pressure pco2 co2 aq and sic the pco2 co2 aq concentrations and calcite saturation index sic were calculated using phreeqc3 geochemical modeling software with ph wt and concentrations of k na ca2 mg2 hco3 cl so4 2 and no3 concentrations zeebe and wolf gladrow 2001 in addition we used the inflow river as a reference value to calculate the degree of change in the δ13cdic and dic of the reservoirs to reflect the role of hrt in the migration and transformation of dic and then to explore the influence of hrt on the strength of the hydrodynamic effect of the reservoir defined by the following equation 5 δ 13 c dic cr 100 δ 13 c dic r e s e r v o i r δ 13 c dic r i v e r δ 13 c dic r i v e r 6 dic cr 100 dic r e s e r v o i r dic r i v e r dic r i v e r where δ13cdic cr and dic cr are the calculated ratios of variation of δ13cdic and dic concentrations between the average value of inflow river samples river and the reservoir samples reservoir 2 4 3 data analyses correlation analysis and figure drawing were conducted using originpro 2021 the sample point distribution map was based on arcgis 10 7 esri redlands ca usa ibm spss statistics 26 was used to perform independent t tests after the normal distribution test to compare the levels of c n and p in the two reservoirs 3 results 3 1 environment variables the temporal and spatial variations in surface wt ph do and tss concentration are shown in fig s2 and the hco3 co2 aq tn and tp concentrations are shown in fig s3 for the study year the spatiotemporal variation in these parameters in the two river reservoir ecosystems is shown in the si in addition as shown in fig 2 dfsk and hjhsk had substantially different nutritional conditions dfsk had higher hco3 concentrations but lower co2 than hjhsk namely lower co2 relative availability 0 29 the availability of co2 relative hco3 higher tp concentrations and lower tn concentrations i e lower tn tp hjhsk had medium hco3 concentrations and higher co2 relative availability 0 73 lower tp concentrations and higher tn concentrations i e higher tn tp than dfsk the two river fed reservoir ecosystems had higher values of doc and poc in summer and autumn than in spring and winter fig s4a and s4b sic was greater than zero year round fig s4d the spatiotemporal variation in doc poc pco2 and sic in the two river reservoir ecosystems is shown in the si the δ13cdic values of the wlh and hh ranged from 11 25 to 4 75 and 13 93 to 7 27 respectively with an average of 7 67 and 8 45 respectively fig 3 a and 3b the δ13cpoc values of the wlh and hh ranged from 34 75 to 27 79 and 37 49 to 28 22 respectively with an average of 29 88 and 33 08 respectively fig 3a and 3b overall δ13cdic and δ13cpoc showed synchronous variations in the two reservoirs fig 3a and 3b the δ13cdic of the reservoir was more positive than that of the inflow river in both watersheds the δ13cpoc of the reservoir in the wlh watershed was more positive than that of the inflow river only in the summer and autumn fig 3a and 3b 3 2 dynamics of phytoplankton community composition and chlorophyll a for dfsk bacillariophyta dominated the phytoplankton community during autumn and winter whereas chlorophyta and cyanophyta exceeded bacillariophyta in spring and summer fig 3c hjhsk changed from the absolute dominance of bacillariophyta in autumn winter and spring to bacillariophyta in summer followed by chlorophyta fig 3d the dominant phyla and species in dfsk and hjhsk are in table s2 seasonal phytoplankton biomass in the two watersheds is shown in fig 4 in general the abundance of phytoplankton species in the two river watersheds was highest in summer or autumn and lowest in winter or spring average density values of dfsk algae descended with different seasons in the following order summer 285 cells ml 1 autumn 147 cells ml 1 spring 45 cells ml 1 winter 26 cells ml 1 the average algae density of hjhsk reached a maximum in autumn 249 cells ml 1 and a minimum in spring 64 cells ml 1 the biomass of phytoplankton in the reservoir was approximately the same as that in the inflow river in spring but the biomass of the former was much higher than that of the latter in other seasons chl a concentrations ranged from 0 04 to 63 4 μg l 1 and showed synchronous variation with species successions fig 3c and 3d 3 3 gpp the gpp of phytoplankton over the sampling period calculated by the vgpm is shown in fig 5 in dfsk the gpp reached its highest value in summer 2436 72 mgc m 2 d 1 and lowest value in spring 148 13 mgc m 2 d 1 the gpp in dfsk was an average of 344 times higher than that of the inflow river in hjhsk the highest gpp 441 8 mgc m 2 d 1 occurred in autumn and the lowest in spring 89 90 mgc m 2 d 1 the average gpp in hjhsk was 66 times that of the inflow river as shown in fig 5 the average gpp 637 79 mgc m 2 d 1 of dfsk across the studied year was significantly 2 6 times higher than the average gpp 246 94 mgc m 2 d 1 of hjhsk 3 4 correlation and nutrient stoichiometric ratio analysis the sample values for dic cr and δ13cdic cr in both reservoirs are presented in fig 6 a most of these samples fall in the lower left quadrant of the plot where decreased δ13cdic cr values δ13cdic cr 0 are associated with decreased dic concentrations dic cr 0 a strong positive correlation between ph and δ13cdic was also observed fig 6b additionally dic in both reservoirs showed a significant negative correlation with doc and poc fig 6c and 6d there was a substantial positive correlation between δ13cdic and δ13cpoc fig 6e nutrient limitation factors for gpp differed in hjhsk and dfsk fig 7 gpp in dfsk was primarily hampered by n fig 7a c however gpp in hjhsk was primarily limited by co2 aq fig 7d f additionally the abundance of cyanophyta and chlorophyta showed a significant positive correlation with δ13cdic and δ13cpoc fig 8 a and 8b and these dominant algae are usually associated with high δ13cdic and δ13cpoc and low co2 aq concentration fig 8c and 8d 4 discussion 4 1 main mechanism of the transformation of dic to oc in the reservoirs coupled carbonate weathering is a conceptual model that combines carbonate mineral weathering with aquatic photosynthesis indicates that aquatic photosynthetic organisms may produce strong bcp through photosynthesis converting dic produced by carbonate dissolution to a more stable oc stored in sediments which is the key mechanism for the formation of long term stable carbonate weathering carbon sink liu and dreybrodt 2015 liu et al 2018 7 h 2 o c a c o 3 c o 2 c a 2 2 h c o 3 bcp c a c o 3 x c o 2 h 2 o 1 x c h 2 o o 2 where x and 1 x are stoichiometric coefficients in the euphotic layer phytoplankton consume dic mainly co2 and hco3 for photosynthesis to promote its growth phytoplankton preferentially absorb light 12c during this process which causes a reduction in the dic concentration and an enrichment in δ13cdic in the euphotic zone breugel et al 2005 fig 6a shows the effect of different physical processes such as co2 outgassing og chemical processes such as calcite precipitation cp and calcite dissolution cd and biological processes such as biological production bp and degradation of oc dc on the dic of the reservoirs if both dic cr and δ13cdic cr are negative the system is mainly affected by bp and og alling et al 2012 kumar et al 2018 if dic cr is negative but δ13cdic cr is positive the system is probably affected by cp samanta et al 2015 if both dic cr and δ13cdic cr are positive the dc may be an influencing factor wang et al 2019 if dic cr is positive and δ13cdic cr is negative cd may be an influencing factor gwenaeel et al 2003 our analysis shows that bp og was the dominant process affecting the surface water of the reservoir however since og and bp have different effects on dic i e the former emits co2 to the atmosphere and the latter can fix dic under under saturated conditions the competition between the two mechanisms may affect the c balance of the reservoir demars et al 2016 we also found that some of the sampled points were in the cd region but the sic of these points was greater than zero fig s4d thus no cd process was observed to further distinguish these mechanisms we used the soil organic carbon isotope δ13csoc around the reservoir to trace allochthonous oc the average values of δ13csoc for dfsk and hjhsk were 26 11 and 25 81 respectively fig 6f the δ13cpoc of dfsk and hjhsk were more negative than their allochthonous δ13csoc with an average value of 30 33 fig 3a and 34 48 fig 3b respectively we also found a significant positive correlation between δ13cdic and δ13cpoc in the reservoirs dfsk r2 0 42 p 0 05 hjhsk r2 0 32 p 0 05 fig 6e indicating that phytoplankton photosynthesis was a significant factor affecting c balance in addition the bcp in reservoirs can convert dic to oc and the positive correlation of doc and poc concentrations with dic indicated that bcp was the dominant mechanism of the transformation of dic to oc in the reservoirs fig 6c and 6d additionally as co2 or hco3 is fixed by phytoplankton photosynthesis a simultaneous increase in ph and δ13cdic could occur alling et al 2012 and in this study a positive relationship between ph and δ13cdic was observed in the reservoirs fig 6b in summary phytoplankton photosynthesis was the major mechanism that affected the transformation of dic to oc in the clp reservoirs 4 2 hydrodynamic effect was enhanced by shortening hrt a dam s interception decreases flow velocity and increases hrt affecting hydrodynamics cheng et al 2019 yang et al 2022 studies have shown that long hrt promotes algal photosynthesis affecting phytoplankton biomass for example tarczyńska et al 2001 found a cyanophyta bloom in sulejów reservoir poland when the hrt was 60 120 days and kawara et al 1998 found that in asahi reservoir japan an algal bloom will appeared when hrt exceeded 14 days as aforementioned the photosynthesis of surface algae can alter δ13cdic in surface waters in this study the δ13cdic cr of dfsk 42 63 7 41 during the study period was greater than that of hjhsk 20 48 5 83 fig 6a indicating that the c fixation by phytoplankton photosynthesis showed high discrepancies between the two reservoirs probably due to the hrt as aforementioned hjhsk had an outlet with an average annual flow rate of 0 15 m3 s 1 whereas dfsk had no perennial outlets only an artificial drainage outlet during the flood season this difference resulted in a significantly longer hrt in dfsk than in hjhsk table s1 the two reservoirs are in the same climate zone and are relatively proximal thus the altitude air temperature and wt data were similar table s1 fig s2a therefore the δ13cdic cr of hjhsk is small indicating that its short hrt weakens the photosynthesis of phytoplankton enhances the hydrodynamic effect and makes the reservoir behave similarly to a river wang et al 2020 found the same pattern in the river reservoir system in the wujiang river china the hydrodynamic effect includes many factors such as flow velocity discharge and water disturbance changes in these factors have different effects on algae growth complicating the relationship between hydrodynamics and algae growth yang et al 2022 on the one hand increases in reservoir flow are accompanied by increases in tss which brings not only nutrients but also induced light limitation during the study period the tss of the two reservoirs were similar fig s2d indicating that the effect of tss on algae growth was similar on the other hand the change in flow velocity affected the amount of reservoir sediments humborg et al 1997 and nutrient loading dillon and rigler 1974 which affected the concentration of nutrient elements such as c n p in the water body studies have shown that sediments are important nutrient pools and the scouring and removal of sediments in water may remove internal nutrients liu et al 2016 wan et al 2021 hjhsk had a shorter hrt and higher flow velocity than dfsk did table s1 and in hjhsk the sediments could not be buried for a long time and its internal nutrients e g n and p could be removed in time as shown in fig s3c and s3d the tn and tp concentrations in hjhsk were lower than those of the inflow river showing that the nutrients were from the river input and the tp concentration of the surface water of dfsk was much higher than that of the inflow river which might be the result of the internal release of nutrients from the sediment because the p cycle is coupled with the c and n cycles canfield et al 2020 sediment c and n may also affect the nutritional characteristics of surface water our research has indicated that increases in the hrt enhance the photosynthesis of algae søballe 1987 resulting in a more positive δ13cdic of the reservoir and a larger variation in δ13cdic cr figs s3 6a and 6e whereas shortening the hrt could enhance the hydrodynamic effect wang et al 2020 however we found that in spring the biomass of phytoplankton was similar between the reservoirs or between each reservoir and the corresponding inflow river fig 4 therefore the hrt could not completely illustrate the mechanism of the biomass of phytoplankton hence the c n p ratio mediated by the hydrodynamic effect might be the major driver for phytoplankton biomass i e gpp discussed in section 4 3 4 3 effects of nutrient concentrations ratios on gpp of reservoirs river damming changes biogeochemical parameters in aquatic ecosystems and the content of nutrient elements c n and p which affects their stoichiometric ratios in the reservoir affecting the nutritional limit of algae growth and the gpp of the freshwater system naiman et al 1987 as aforementioned dfsk and hjhsk had significantly different nutrient conditions the former had higher hco3 concentrations lower co2 relative availability and lower tn tp than the latter whereas the latter had lower hco3 higher co2 relative availability and higher tn tp than the former in addition the average gpp of the former during the study period was 2 6 times that of the latter indicating that nutritional conditions may have an important impact on reservoir productivity based on the gpp estimated by the vgpm we showed the relationship between gpp and co2 aq tn and tp fig 7 the results show that the gpp in dfsk was mainly restricted by n at tn tp 4 whereas the gpp in hjhsk was mainly restricted by co2 aq at tn tp 100 the reason for this finding is the difference in phytoplankton species composition and succession in the two reservoirs during the study period in their long term evolution nearly all eukaryotic algae and cyanobacteria possess a ccm that can increase the co2 concentration of cells and ensure that their photosynthesis obtains a sufficient c source supply giordano et al 2005 the operation of ccm increases the co2 concentration in the carboxylase to compensate for the insufficient affinity of ribulose 1 5 bisphosphate carboxylase oxygenase rubisco for co2 that is to improve the c fixation efficiency of rubisco by accumulating high concentrations of intracellular co2 badger et al 2002 wang et al 2011 it has been demonstrated that cyanobacteria and green algae have a higher rubisco maximum carboxylation rate than diatoms savir et al 2010 young et al 2016 cyanophyta maintain the ccm activity in any c source environment whereas eukaryotic microalgae e g bacillariophyta generally only activate their ccm in environments with atmospheric co2 levels or low co2 concentrations and do not show ccm activity in a high co2 environment dfsk changed from bacillariophyta domination in autumn and winter to cyanobacteria and chlorophyta domination in spring and summer due to the high hco3 concentration inside dfsk cyanobacteria and chlorophyta initiated ccm when co2 aq was insufficient therefore dfsk did not show the co2 aq limitation but showed an obvious n limitation fig 7a c studies have shown that anabaena and aphanizomenon flos aquae in cyanobacteria are the main nitrogen fixing organisms in river ecosystems gruber and galloway 2008 whearas aphanizomenon flos aquae was not observed in dfsk during the study period anabaena only occurred in summer and was not the most abundant genus among cyanobacteria table s2 in addition biological nitrogen fixation requires the presence of nitrogenase and sufficient energy the reaction equation is as follows 8 n 2 8 e 6 h 2 n a t p 2 n h 3 4 h 2 n a d p n p i studies have shown that nitrogenase can only play a catalytic role under anaerobic conditions and loses its activity when oxygen concentration is high bebout et al 1993 in summer as the wt increases the activity of nitrogenase increases mcqueen and lean 1987 but the do of dfsk also reached the maximum with an average of 179 4 fig s2c due to the influence of phytoplankton photosynthesis in summer under the hedging action of high do and high wt the activity of nitrogenase decreased and anabaena did not show strong nitrogen fixation ability in summer additionally dfsk was characterized by high tp and low tn concentrations a high tp alleviates the phytoplankton demand for phosphorus therefore the gpp of dfsk mainly shows the result of being limited by n unlike dfsk hjhsk changed from the absolute dominance of bacillariophyta in autumn winter and spring to bacillariophyta closely followed by chlorophyta in summer the absolute advantage of diatoms is that they preferentially use co2 aq for photosynthesis additionally as aforementioned the exchange of co2 between water and the atmosphere is slow and the diffusion rate of co2 in the surface water is 104 fold lower than that in the air in addition similar to the karst aquatic ecosystem the watershed in the clp is highly alkaline owing to its unique hydrochemical characteristics during the sampling period the average ph of hjhsk was 8 5 0 2 studies have shown that in alkaline waters with ph 8 co2 aq is 1 of dic bao et al 2020 riebesell et al 1993 zeng et al 2019 therefore the gpp of hjhsk is mainly limited by co2 aq fig 7d f this finding is consistent with the conclusion in the literature that co2 aq has the highest limitation effect on diatoms bao et al 2020 king 1970 low decarie et al 2011 4 4 response of phytoplankton community succession to co2 aq carbon isotopic evidence the δ13c of different carbon pools differs for example 0 for marine carbonate 8 for atmospheric co2 and from approximately 27 to 12 5 for organic matter based on the photosynthesis of precursor vegetation c3 and c4 respectively clark and fritz 1997 vogel 1993 due to diffusion processes soil co2 is likely to be enriched by approximately 4 4 cerling et al 1991 namely isotopic values of approximately 23 and 10 produced in c3 and c4 ecosystems respectively in our study the mean δ13cdic are 7 67 and 8 45 in wlh and hh respectively and the values for both reservoirs are higher than those for inflow rivers fig 3a and 3b this phenomenon suggests that δ13cdic in the study area is mainly controlled by carbonate weathering and soil co2 dissolution but is also controlled by phytoplankton photosynthesis and respiration in conjunction with discussion 4 1 photosynthesis is the main controlling factor for surface water in our study area notably stable carbon isotopic compositions are widely used to study carbon biogeochemical cycling and phytoplankton succession wang et al 2020 xiao et al 2021 in addition combining δ13cdic with the δ13cpoc can improve the understanding of the response of phytoplankton dynamics hellings et al 1999 savoye et al 2003 aquatic photosynthetic organisms consume dic co2 or hco3 to fix oc under the action of a strong bcp and the source of dic provide phytoplankton with different c isotopic signatures brutemark et al 2009 an important reason for the differences in the c isotope composition of phytoplankton is the difference in stable carbon isotope fractionation εp between phytoplankton taxa and species mcnevin et al 2007 the εp of phytoplankton is complex mainly due to the different mechanisms by which different species of phytoplankton use c especially those physiological processes that involve the ccm badger et al 1998 rokitta and rost 2012 as aforementioned ccm in cyanophyta and chlorophyta are more efficient than other algae at low co2 aq badger and price 2003 therefore co2 aq limitation may drive the succession of phytoplankton from bacillariophyta beneficial to water quality to cyanophyta directly related to eutrophication resulting in hco3 becoming a main inorganic c source for phytoplankton bao et al 2020 kragh et al 2017 low decarie et al 2015 low decarie et al 2011 vadstrup and madsen 1995 wang et al 2018 the high absorption and assimilation of hco3 can reduce the 13c fractionation value since hco3 is rich in 13c relative to co2 approximately 10 brandenburg et al 2022 this process is reflected in the δ13c levels resulting in higher δ13c in cyanophyta and chlorophyta than in other phyta and corresponding δ13cdic is also relatively positive xiao et al 2021 therefore the abundances of cyanophyta and chlorophyta were significantly positively correlated with δ13cdic and δ13cpoc fig 8a and 8b in addition as shown in fig 8c and 8d when the concentration of co2 aq was lower than 10 μmol l 1 δ13cdic and δ13cpoc were obviously more positive the former is generally higher than 6 and the latter was generally higher than 30 and phytoplankton were dominated by cyanophyta and chlorophyta indicating that hco3 as the main inorganic c source was largely assimilated in summary under the premise of appropriate light and heat conditions cyanophyta replaced bacillariophyta as the major algae species in a low co2 aq aquatic environment 5 conclusions and perspectives this study explored the mechanism responsible for transforming dic to oc in the reservoirs of the clp discussed the influence of the hrt on the hydrodynamic effect identified the nutrient limitation mechanism of gpp in reservoirs with different nutritional conditions and explored the response mechanism of phytoplankton community succession to co2 aq in reservoirs based on the δ13cdic the δ13cpoc and the correlation between dic and oc in the river fed reservoir ecosystems on the clp phytoplankton photosynthesis was the major factor driving the transformation of dic to oc in the reservoirs and the hydrodynamic effect can be enhanced by shortening the hrt additionally nutrient restriction analysis using the ratios of nutrient elements of the two reservoirs with different nutrient conditions showed that dfsk with low co2 relative availability and low tn tp was limited by n whereas hjhsk with high co2 relative availability and high tn tp was limited by c in addition co2 availability regulated the composition and structure of phytoplankton in the reservoirs that is with the increase in co2 aq the dominant species changed from cyanophyta and chlorophyta to bacillariophyta and this process has a mitigating effect on eutrophication based on the aforementioned analysis we suggest adjusting the hrt of reservoirs and land use that maintains it within the threshold range of the c n p nutrient element ratios required by bcp for dic fertilization this finding may help to alleviate eutrophication by adjusting phytoplankton structure in addition this finding will increase the carbon sink capacity in reservoirs on the clp via dic fertilization of algae this study improves the understanding of the c n p limitation mechanism of the phytoplankton community structure and gpp changes in the surface waters of the clp with high ph and high dic in semi arid areas and provides policymakers with useful information on mitigating reservoir eutrophication and increasing carbon sinks credit authorship contribution statement mingyu shao writing original draft writing review editing software visualization data curation zaihua liu conceptualization methodology supervision writing review editing hailong sun data curation supervision formal analysis software writing review editing chaowei lai data curation investigation zhen ma data curation investigation xuejun he data curation investigation yan fang data curation investigation qinong chai data curation investigation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this study was financially supported by the strategic priority research program of chinese academy of sciences xdb40020000 the national natural science foundation of china 42130501 42141008 u1612441 and 41921004 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 128781 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
2566,due to the fast dissolution kinetics of rich carbonate minerals on the chinese loess plateau clp the high ph values and high concentrations of ca2 and dissolved inorganic carbon dic characterize the surface waters on the clp which represents the largest loess area in the world the unique hydrochemical properties of aquatic ecosystems on the clp may have substantial biological carbon pump bcp potential a mechanism that changes the availability of c n and p which affects phytoplankton structure or composition to change eutrophication and phytoplankton abundance to improve gross primary productivity gpp therefore understanding the c n p driven changes in river fed reservoir ecosystems on the clp is essential for improving watershed management mitigating eutrophication and optimizing carbon sequestration here we investigated the phytoplankton community structure and gpp the stable carbon isotope compositions of dic particulate organic carbon poc δ13cdic and δ13cpoc and c n p nutrient levels in the wuli river dongfeng and hong river houjiahe river fed reservoir ecosystems in xi an city on the northwestern clp during the hydrological year from november 2020 to july 2021 our results show that 1 phytoplankton photosynthesis was the major mechanism that drove the transformation of the dic to organic carbon in the reservoirs and the hydrodynamic effect can be enhanced by shortening the hydraulic retention time hrt which leads to increases in flow velocity increases in water disturbances and decreases in nutrient load of the water body photosynthesis and algal growth 2 the gpp in the dongfeng reservoir with high hco3 concentrations but low co2 10 μm and low total nitrogen total phosphorus tn tp ratios 4 was limited by n due to the predominance of cyanophyta and chlorophyta and the gpp in the houjiahe reservoir with low hco3 concentrations but high co2 10 μm and high tn tp ratios 100 was limited by c due to the predominance of bacillariophyta 3 the availability of co2 regulated the structure of the phytoplankton community in the reservoirs and with an increase in dissolved co2 the dominant species changed from cyanophyta to bacillariophyta therefore it is inferred that by changing land use or adjusting the hrt of the reservoir we may maintain the required c n p nutrient element ratios for promoting co2 fertilization on the bcp in reservoirs on the clp which may simultaneously help increase carbon sequestration and alleviate eutrophication by changing the phytoplankton community structure from cyanophyta to bacillariophyta keywords phytoplankton community succession c n p limitation river fed reservoir ecosystem eutrophication mitigation carbon sequestration chinese loess plateau data availability data will be made available on request 1 introduction as primary producers in aquatic ecosystems e g rivers reservoirs and lakes phytoplankton photosynthetic carbon sequestration contributes almost 50 to the global gross primary productivity gpp of organic matter bauer et al 2013 havens 2014 wang et al 2011 phytoplankton assimilates dissolved inorganic carbon dic during photosynthesis and converts it into organic carbon oc which is closely associated with the carbon sink anderson et al 2014 and huang et al 2017 have found that when lakes are converted from oligo mesotrophic to eutrophic their carbon sequestration capacity increases in eutrophic waters however the transparency and dissolved oxygen do content of the water are reduced as algae residues decompose and generate large amounts of greenhouse gases li et al 2021 in addition cyanophyta bloom in eutrophic water bodies can produce odorous and toxic compounds causing serious harm to aquatic ecosystems and human health huisman et al 2018 ross et al 2006 therefore although eutrophication contributes useful carbon sinks which may help alleviate global warming it is detrimental to aquatic ecosystems in addition studies have shown that in the hard alkaline aquatic karst ecosystems in southwest china photosynthetic organisms produce a biological carbon pump bcp effect through photosynthesis converting dic to oc which is an important mechanism for the formation of stable and long term carbonate weathering carbon sink he et al 2020 he et al 2022 liu and dreybrodt 2015 additionally dic fertilization of bcp might benefit phytoplankton communities in the water body by adjusting their structure bao et al 2021 bao et al 2020 zeng et al 2019 although bcp and water eutrophication are governed by the formation of organic matter through aquatic photosynthesis their nutrient restriction mechanisms differ the relative availability of carbon c nitrogen n and phosphorus p often restricts the basic structure of phytoplankton communities in aquatic ecosystems and affects the formation of catalytic cell pools the rate of photosynthesis and thus the growth and maximum achievable biomass hammer et al 2019 phillips et al 2008 since the cp debate of the early 1970 s phytoplankton growth in lakes is largely believed to depend on p availability carpenter 2008 schindler et al 2008 this is primarily due to the fact that some cyanobacteria can fix n to meet their n requirements smith 1990 however studies have demonstrated that when the trophic state changes in inland waters n may be a potential factor in limiting phytoplankton development chaffin 2013 ibáñez and penuelas 2019 further studies have shown that n and p are interchangeable as the main limiting factors for example the system with nitrogen fixing algae mainly shows p limitation and the system without nitrogen fixing algae may mainly show n limitation whereas dissolved co2 co2 aq aq is used herein instead of aqueous is unlikely to be a major limiting factor howarth and marino 2006 schindler et al 1972 schindler et al 1973 smith 1984 tyrrell 1999 however many observations call for reconsidering the role of co2 aq in freshwater ecosystems especially in hard alkaline waters first the exchange of co2 between water and atmosphere is slow and the diffusion rate of co2 in surface water is 104 fold lower than that in the atmosphere stumm and morgan 1981 owing to extensive photosynthesis during the growth of phytoplankton the diffusive influx of co2 from the air cannot fulfill the photosynthetic demand second in freshwater and marine systems co2 aq is the preferred substrate for photosynthesis although hco3 is available to many primary producers burris et al 1981 king 1970 kragh et al 2017 low decarie et al 2015 third ph levels of alkaline water are usually between 8 and 9 within this range dic in the water is dominated by hco3 and the concentration of co2 aq is only 1 2 dic zeng et al 2019 additionally photosynthesis by phytoplankton reduces the concentration of co2 aq causing the water to become co2 unsaturated and increasing the ph value which leads to a further decrease in the proportion of co2 aq in dic thus the availability of co2 aq can be a limiting factor for phytoplankton photosynthesis king 1970 low decarie et al 2011 zagarese et al 2021 notably ample evidence supports this conclusion for example low decarie et al 2015 found through a mesocosms experiment that co2 aq greatly enhanced the growth of phytoplankton bao et al 2020 found that high co2 aq increased the c sequestration in karst surface waters with high ph and high dic however these findings are mainly from mesocosms experiments or karst areas in southwest china and the situation in the chinese loess plateau clp remains unclear in addition to gpp the structure and composition of phytoplankton respond to variations in co2 aq concentrations in surface waters iversen et al 2019 in long term evolution some algae use the co2 concentrating mechanism ccm to enhance their affinity for dic enabling hco3 to act as a c source for photosynthesis gaining a competitive advantage reinfelder 2011 phytoplankton ccm are species specific raven et al 2020 therefore elevated co2 may favor species that possess inferior ccm or do not contain ccm riebesell 2004 shi et al 2017 cyanophyta directly related to eutrophication are more capable than other algae of adapting to low co2 aq but chlorophyta bacillariophyta and submerged plants which are beneficial for the improvement of water quality often grow in high co2 aq environment bao et al 2020 kragh et al 2017 low decarie et al 2015 low decarie et al 2011 vadstrup and madsen 1995 wang et al 2018 zeng et al 2019 water chemistry is primarily influenced by carbonate weathering in the clp zhang et al 2015 and is characterized by high ph hco3 and ca2 levels which is similar to the water chemistry of karst water bodies in southwest china where alkaline hard water is dominant however the c limitation on phytoplankton growth and the succession of phytoplankton species in surface waters on the clp which show similar hydrochemical characteristics to karst areas in southwest china but different climatic conditions remain unclear in addition the damming of the river not only changes the continuity of the river but increases the hydraulic retention time hrt affecting hydrodynamic conditions and changing the nutrient cycle in the river the stoichiometries are also different in the two reservoirs this differences affects the limiting nutrient of phytoplankton changing the phytoplankton community naiman et al 1987 vörösmarty and dork 2000 which affects the efficiency of bcp thus we investigated the phytoplankton community structure and gpp the stable carbon isotope compositions of dic particulate organic carbon poc δ13cdic and δ13cpoc and c n p nutrient levels in the two dammed rivers located in xi an city on the northwestern clp we hypothesized that a c fertilization mechanism of bcp in aquatic ecosystems of the clp would help increase the carbon sink capacity of surface water and alleviating eutrophication simultaneously via changes in biological structure and species compositions this finding is of great significance for mitigating the greenhouse gas effect improving water quality management and restoring aquatic ecosystems liu et al 2021 riebesell et al 1993 especially in the arid and semi arid clp where rainfall is scarce and evaporation is strong limiting water resources 2 materials and methods 2 1 study area the studied reservoirs were dongfeng reservoir dfsk and houjiahe reservoir hjhsk xi an city shaanxi province 34 10 34 18 n 109 10 109 22 e fig 1 with average depths of 5 m and 3 m and surface areas of 0 065 km2 and 0 05 km2 respectively hjhsk fig 1e exhibits a shorter hrt table s1 than dfsk does fig 1d because the former has a perennial outlet fig 1c with an annual average flow of 0 15 m3 s 1 fig s1 notably dfsk and hjhsk are on the wuli river wlh fig 1b and hong river hh fig 1c respectively both rivers are characterized by a warm temperate semi humid continental climate and the annual mean air temperature is 13 the annual precipitation is 720 mm of which nearly 60 occurs from july to october mo et al 2018 farmland 70 4 is the dominant land use type along the wlh followed by forest 26 3 fig 1b along the hh forest 57 3 is the dominant use type followed by farmland 38 8 fig 1c the two watersheds are located on the clp which covers 640 000 km2 accounting for 6 of china s land surface representing the largest loess area worldwide li et al 2019 liu 1985 the carbonate content in the clp is between 10 and 20 li et al 2007 zhang et al 1995 carbonate weathering is more sensitive to the monsoon climate than silicates owing to the relatively fast dissolution kinetics of carbonates jin et al 2011 liu and dreybrod 1997 therefore both watersheds feature notable carbonate weathering a description of the two watershed s geology and stratigraphy is provided in the supplementary information si 2 2 field monitoring field monitoring was performed in autumn november 2020 winter january 2021 spring april 2021 and summer july 2021 based on the climate cycle portable ponsel odeon equipment was used to measure water temperature wt ph electrical conductivity ec 25 c and dissolved oxygen do before deployment the equipment was calibrated for ph ec and do the calibration method and the device s measuring accuracy were as described by bao et al 2020 moreover dic was titrated using an in situ aquamerck alkalinity test kit merck germany with a resolution of 0 05 mmol l 1 zeng et al 2017 since the ph of the surface water was between 8 14 and 9 40 in the study area the alkalinity was chiefly composed of hco3 zeng et al 2019 therefore the result of alkalinity titration mainly reflects the hco3 concentration 2 3 sample collection and bulk geochemical analyses thirty nine surface water samples were collected in ultrapure water washed 100 ml glass bottles to determine tn and tp the samples were filtered through 0 45 μm millipore filters into 20 ml acid washed high density polyethylene bottles for major cation and anion determination cation samples were acidified to ph 2 using ultrapure hno3 major anions and major cations were analyzed by automated dionex ics 90 ion chromatography dionex usa and inductively coupled plasma optical emission spectrometer icp oes usa respectively tp and tn were measured using molybdate spectrophotometry gb 11893 89 and were analyzed using ultraviolet spectroscopy hj 636 2012 after digestion with alkaline potassium persulfate respectively doc poc concentrations and the δ13c of dic and poc were measured using the method described by zhao et al 2022 total suspended solids tss were determined by the weighing method yang et al 2016 in addition surface water samples upper 0 5 m were collected and filtered through a 47 mm gf f filter and stored at 20 to test the chlorophyll a chl a we used 95 hot ethanol extractions to determine chl a concentration sartory and grobbelaar 1984 methods for identification of phytoplankton species and algal cell counts are in si the δ13c of dic and poc were measured on a mat 252 253 thermo fisher scientific mass spectrometer stable c isotope ratios are reported per mil relative to the international vienna peedee belemnite standard the accuracy of δ13c of the instrument was better than 0 06 δ13c was calculated as δ13csample rsample rstandard rstandard 1000 in this equation r is the 13c 12c ratio of the sample 2 4 data calculation and statistics 2 4 1 calculation of the gpp the vertical generalized production model vgpm was used to calculate gpp the model comprehensively considers factors that affect the primary productivity of the water column such as wt light conditions chl a content and the depth of the euphotic layer to accurately estimate the primary production of phytoplankton behrenfeld and falkowski 1997a the vgpm has been verified by datasets from thousands of sites over long periods in large areas and in different waters its calculation is accurate it is widely applicable and its basic form is as follows 1 gpp 0 66125 p opt b e0 e0 4 1 z e u c o p t d i r r where gpp is the primary productivity integrated from the surface layer to the euphotic layer mgc m 2 d 1 copt is the chl a concentration of surface water μg l 1 deng et al 2017 and dirr is the photoperiod h https data sheshiyuanyi com weatherdata p opt b is the maximum rate of c fixation of the water column as a function of wt and its expression is as follows behrenfeld and falkowski 1997a b 2 p opt b 1 13 t 1 0 4 00 t 28 5 p opt b 1 0 t 28 5 3 p opt b 1 2956 2 749 10 1 t 6 17 10 2 t 2 2 05 10 2 t 3 2 462 10 3 t 4 1 3148 10 4 t 5 3 4132 10 6 t 6 3 27 10 8 t 7 where p opt b is the maximum rate of c fixation of the water column when 1 0 t 28 5 is the wt e0 is the photosynthetically available radiation intensity of the water surface mol m 2 d 1 in this study e0 is 30 mol m 2 d 1 in spring 32 54 mol m 2 d 1 in summer 19 76 in autumn and 16 08 mol m 2 d 1 in winter jiang et al 2013 zeu is the depth of the euphotic layer when the water depth is less than the depth of the euphotic layer it is replaced by the water depth and calculated by the following empirical formula 4 zeu 4 605 0 062ctripton 0 011cchla 1 430 r2 0 954 n 199 p 0 001 where ctripton is the concentration of tss and cchla is the chl a concentration of the surface water μg l 1 yin et al 2017 2 4 2 calculation of co2 partial pressure pco2 co2 aq and sic the pco2 co2 aq concentrations and calcite saturation index sic were calculated using phreeqc3 geochemical modeling software with ph wt and concentrations of k na ca2 mg2 hco3 cl so4 2 and no3 concentrations zeebe and wolf gladrow 2001 in addition we used the inflow river as a reference value to calculate the degree of change in the δ13cdic and dic of the reservoirs to reflect the role of hrt in the migration and transformation of dic and then to explore the influence of hrt on the strength of the hydrodynamic effect of the reservoir defined by the following equation 5 δ 13 c dic cr 100 δ 13 c dic r e s e r v o i r δ 13 c dic r i v e r δ 13 c dic r i v e r 6 dic cr 100 dic r e s e r v o i r dic r i v e r dic r i v e r where δ13cdic cr and dic cr are the calculated ratios of variation of δ13cdic and dic concentrations between the average value of inflow river samples river and the reservoir samples reservoir 2 4 3 data analyses correlation analysis and figure drawing were conducted using originpro 2021 the sample point distribution map was based on arcgis 10 7 esri redlands ca usa ibm spss statistics 26 was used to perform independent t tests after the normal distribution test to compare the levels of c n and p in the two reservoirs 3 results 3 1 environment variables the temporal and spatial variations in surface wt ph do and tss concentration are shown in fig s2 and the hco3 co2 aq tn and tp concentrations are shown in fig s3 for the study year the spatiotemporal variation in these parameters in the two river reservoir ecosystems is shown in the si in addition as shown in fig 2 dfsk and hjhsk had substantially different nutritional conditions dfsk had higher hco3 concentrations but lower co2 than hjhsk namely lower co2 relative availability 0 29 the availability of co2 relative hco3 higher tp concentrations and lower tn concentrations i e lower tn tp hjhsk had medium hco3 concentrations and higher co2 relative availability 0 73 lower tp concentrations and higher tn concentrations i e higher tn tp than dfsk the two river fed reservoir ecosystems had higher values of doc and poc in summer and autumn than in spring and winter fig s4a and s4b sic was greater than zero year round fig s4d the spatiotemporal variation in doc poc pco2 and sic in the two river reservoir ecosystems is shown in the si the δ13cdic values of the wlh and hh ranged from 11 25 to 4 75 and 13 93 to 7 27 respectively with an average of 7 67 and 8 45 respectively fig 3 a and 3b the δ13cpoc values of the wlh and hh ranged from 34 75 to 27 79 and 37 49 to 28 22 respectively with an average of 29 88 and 33 08 respectively fig 3a and 3b overall δ13cdic and δ13cpoc showed synchronous variations in the two reservoirs fig 3a and 3b the δ13cdic of the reservoir was more positive than that of the inflow river in both watersheds the δ13cpoc of the reservoir in the wlh watershed was more positive than that of the inflow river only in the summer and autumn fig 3a and 3b 3 2 dynamics of phytoplankton community composition and chlorophyll a for dfsk bacillariophyta dominated the phytoplankton community during autumn and winter whereas chlorophyta and cyanophyta exceeded bacillariophyta in spring and summer fig 3c hjhsk changed from the absolute dominance of bacillariophyta in autumn winter and spring to bacillariophyta in summer followed by chlorophyta fig 3d the dominant phyla and species in dfsk and hjhsk are in table s2 seasonal phytoplankton biomass in the two watersheds is shown in fig 4 in general the abundance of phytoplankton species in the two river watersheds was highest in summer or autumn and lowest in winter or spring average density values of dfsk algae descended with different seasons in the following order summer 285 cells ml 1 autumn 147 cells ml 1 spring 45 cells ml 1 winter 26 cells ml 1 the average algae density of hjhsk reached a maximum in autumn 249 cells ml 1 and a minimum in spring 64 cells ml 1 the biomass of phytoplankton in the reservoir was approximately the same as that in the inflow river in spring but the biomass of the former was much higher than that of the latter in other seasons chl a concentrations ranged from 0 04 to 63 4 μg l 1 and showed synchronous variation with species successions fig 3c and 3d 3 3 gpp the gpp of phytoplankton over the sampling period calculated by the vgpm is shown in fig 5 in dfsk the gpp reached its highest value in summer 2436 72 mgc m 2 d 1 and lowest value in spring 148 13 mgc m 2 d 1 the gpp in dfsk was an average of 344 times higher than that of the inflow river in hjhsk the highest gpp 441 8 mgc m 2 d 1 occurred in autumn and the lowest in spring 89 90 mgc m 2 d 1 the average gpp in hjhsk was 66 times that of the inflow river as shown in fig 5 the average gpp 637 79 mgc m 2 d 1 of dfsk across the studied year was significantly 2 6 times higher than the average gpp 246 94 mgc m 2 d 1 of hjhsk 3 4 correlation and nutrient stoichiometric ratio analysis the sample values for dic cr and δ13cdic cr in both reservoirs are presented in fig 6 a most of these samples fall in the lower left quadrant of the plot where decreased δ13cdic cr values δ13cdic cr 0 are associated with decreased dic concentrations dic cr 0 a strong positive correlation between ph and δ13cdic was also observed fig 6b additionally dic in both reservoirs showed a significant negative correlation with doc and poc fig 6c and 6d there was a substantial positive correlation between δ13cdic and δ13cpoc fig 6e nutrient limitation factors for gpp differed in hjhsk and dfsk fig 7 gpp in dfsk was primarily hampered by n fig 7a c however gpp in hjhsk was primarily limited by co2 aq fig 7d f additionally the abundance of cyanophyta and chlorophyta showed a significant positive correlation with δ13cdic and δ13cpoc fig 8 a and 8b and these dominant algae are usually associated with high δ13cdic and δ13cpoc and low co2 aq concentration fig 8c and 8d 4 discussion 4 1 main mechanism of the transformation of dic to oc in the reservoirs coupled carbonate weathering is a conceptual model that combines carbonate mineral weathering with aquatic photosynthesis indicates that aquatic photosynthetic organisms may produce strong bcp through photosynthesis converting dic produced by carbonate dissolution to a more stable oc stored in sediments which is the key mechanism for the formation of long term stable carbonate weathering carbon sink liu and dreybrodt 2015 liu et al 2018 7 h 2 o c a c o 3 c o 2 c a 2 2 h c o 3 bcp c a c o 3 x c o 2 h 2 o 1 x c h 2 o o 2 where x and 1 x are stoichiometric coefficients in the euphotic layer phytoplankton consume dic mainly co2 and hco3 for photosynthesis to promote its growth phytoplankton preferentially absorb light 12c during this process which causes a reduction in the dic concentration and an enrichment in δ13cdic in the euphotic zone breugel et al 2005 fig 6a shows the effect of different physical processes such as co2 outgassing og chemical processes such as calcite precipitation cp and calcite dissolution cd and biological processes such as biological production bp and degradation of oc dc on the dic of the reservoirs if both dic cr and δ13cdic cr are negative the system is mainly affected by bp and og alling et al 2012 kumar et al 2018 if dic cr is negative but δ13cdic cr is positive the system is probably affected by cp samanta et al 2015 if both dic cr and δ13cdic cr are positive the dc may be an influencing factor wang et al 2019 if dic cr is positive and δ13cdic cr is negative cd may be an influencing factor gwenaeel et al 2003 our analysis shows that bp og was the dominant process affecting the surface water of the reservoir however since og and bp have different effects on dic i e the former emits co2 to the atmosphere and the latter can fix dic under under saturated conditions the competition between the two mechanisms may affect the c balance of the reservoir demars et al 2016 we also found that some of the sampled points were in the cd region but the sic of these points was greater than zero fig s4d thus no cd process was observed to further distinguish these mechanisms we used the soil organic carbon isotope δ13csoc around the reservoir to trace allochthonous oc the average values of δ13csoc for dfsk and hjhsk were 26 11 and 25 81 respectively fig 6f the δ13cpoc of dfsk and hjhsk were more negative than their allochthonous δ13csoc with an average value of 30 33 fig 3a and 34 48 fig 3b respectively we also found a significant positive correlation between δ13cdic and δ13cpoc in the reservoirs dfsk r2 0 42 p 0 05 hjhsk r2 0 32 p 0 05 fig 6e indicating that phytoplankton photosynthesis was a significant factor affecting c balance in addition the bcp in reservoirs can convert dic to oc and the positive correlation of doc and poc concentrations with dic indicated that bcp was the dominant mechanism of the transformation of dic to oc in the reservoirs fig 6c and 6d additionally as co2 or hco3 is fixed by phytoplankton photosynthesis a simultaneous increase in ph and δ13cdic could occur alling et al 2012 and in this study a positive relationship between ph and δ13cdic was observed in the reservoirs fig 6b in summary phytoplankton photosynthesis was the major mechanism that affected the transformation of dic to oc in the clp reservoirs 4 2 hydrodynamic effect was enhanced by shortening hrt a dam s interception decreases flow velocity and increases hrt affecting hydrodynamics cheng et al 2019 yang et al 2022 studies have shown that long hrt promotes algal photosynthesis affecting phytoplankton biomass for example tarczyńska et al 2001 found a cyanophyta bloom in sulejów reservoir poland when the hrt was 60 120 days and kawara et al 1998 found that in asahi reservoir japan an algal bloom will appeared when hrt exceeded 14 days as aforementioned the photosynthesis of surface algae can alter δ13cdic in surface waters in this study the δ13cdic cr of dfsk 42 63 7 41 during the study period was greater than that of hjhsk 20 48 5 83 fig 6a indicating that the c fixation by phytoplankton photosynthesis showed high discrepancies between the two reservoirs probably due to the hrt as aforementioned hjhsk had an outlet with an average annual flow rate of 0 15 m3 s 1 whereas dfsk had no perennial outlets only an artificial drainage outlet during the flood season this difference resulted in a significantly longer hrt in dfsk than in hjhsk table s1 the two reservoirs are in the same climate zone and are relatively proximal thus the altitude air temperature and wt data were similar table s1 fig s2a therefore the δ13cdic cr of hjhsk is small indicating that its short hrt weakens the photosynthesis of phytoplankton enhances the hydrodynamic effect and makes the reservoir behave similarly to a river wang et al 2020 found the same pattern in the river reservoir system in the wujiang river china the hydrodynamic effect includes many factors such as flow velocity discharge and water disturbance changes in these factors have different effects on algae growth complicating the relationship between hydrodynamics and algae growth yang et al 2022 on the one hand increases in reservoir flow are accompanied by increases in tss which brings not only nutrients but also induced light limitation during the study period the tss of the two reservoirs were similar fig s2d indicating that the effect of tss on algae growth was similar on the other hand the change in flow velocity affected the amount of reservoir sediments humborg et al 1997 and nutrient loading dillon and rigler 1974 which affected the concentration of nutrient elements such as c n p in the water body studies have shown that sediments are important nutrient pools and the scouring and removal of sediments in water may remove internal nutrients liu et al 2016 wan et al 2021 hjhsk had a shorter hrt and higher flow velocity than dfsk did table s1 and in hjhsk the sediments could not be buried for a long time and its internal nutrients e g n and p could be removed in time as shown in fig s3c and s3d the tn and tp concentrations in hjhsk were lower than those of the inflow river showing that the nutrients were from the river input and the tp concentration of the surface water of dfsk was much higher than that of the inflow river which might be the result of the internal release of nutrients from the sediment because the p cycle is coupled with the c and n cycles canfield et al 2020 sediment c and n may also affect the nutritional characteristics of surface water our research has indicated that increases in the hrt enhance the photosynthesis of algae søballe 1987 resulting in a more positive δ13cdic of the reservoir and a larger variation in δ13cdic cr figs s3 6a and 6e whereas shortening the hrt could enhance the hydrodynamic effect wang et al 2020 however we found that in spring the biomass of phytoplankton was similar between the reservoirs or between each reservoir and the corresponding inflow river fig 4 therefore the hrt could not completely illustrate the mechanism of the biomass of phytoplankton hence the c n p ratio mediated by the hydrodynamic effect might be the major driver for phytoplankton biomass i e gpp discussed in section 4 3 4 3 effects of nutrient concentrations ratios on gpp of reservoirs river damming changes biogeochemical parameters in aquatic ecosystems and the content of nutrient elements c n and p which affects their stoichiometric ratios in the reservoir affecting the nutritional limit of algae growth and the gpp of the freshwater system naiman et al 1987 as aforementioned dfsk and hjhsk had significantly different nutrient conditions the former had higher hco3 concentrations lower co2 relative availability and lower tn tp than the latter whereas the latter had lower hco3 higher co2 relative availability and higher tn tp than the former in addition the average gpp of the former during the study period was 2 6 times that of the latter indicating that nutritional conditions may have an important impact on reservoir productivity based on the gpp estimated by the vgpm we showed the relationship between gpp and co2 aq tn and tp fig 7 the results show that the gpp in dfsk was mainly restricted by n at tn tp 4 whereas the gpp in hjhsk was mainly restricted by co2 aq at tn tp 100 the reason for this finding is the difference in phytoplankton species composition and succession in the two reservoirs during the study period in their long term evolution nearly all eukaryotic algae and cyanobacteria possess a ccm that can increase the co2 concentration of cells and ensure that their photosynthesis obtains a sufficient c source supply giordano et al 2005 the operation of ccm increases the co2 concentration in the carboxylase to compensate for the insufficient affinity of ribulose 1 5 bisphosphate carboxylase oxygenase rubisco for co2 that is to improve the c fixation efficiency of rubisco by accumulating high concentrations of intracellular co2 badger et al 2002 wang et al 2011 it has been demonstrated that cyanobacteria and green algae have a higher rubisco maximum carboxylation rate than diatoms savir et al 2010 young et al 2016 cyanophyta maintain the ccm activity in any c source environment whereas eukaryotic microalgae e g bacillariophyta generally only activate their ccm in environments with atmospheric co2 levels or low co2 concentrations and do not show ccm activity in a high co2 environment dfsk changed from bacillariophyta domination in autumn and winter to cyanobacteria and chlorophyta domination in spring and summer due to the high hco3 concentration inside dfsk cyanobacteria and chlorophyta initiated ccm when co2 aq was insufficient therefore dfsk did not show the co2 aq limitation but showed an obvious n limitation fig 7a c studies have shown that anabaena and aphanizomenon flos aquae in cyanobacteria are the main nitrogen fixing organisms in river ecosystems gruber and galloway 2008 whearas aphanizomenon flos aquae was not observed in dfsk during the study period anabaena only occurred in summer and was not the most abundant genus among cyanobacteria table s2 in addition biological nitrogen fixation requires the presence of nitrogenase and sufficient energy the reaction equation is as follows 8 n 2 8 e 6 h 2 n a t p 2 n h 3 4 h 2 n a d p n p i studies have shown that nitrogenase can only play a catalytic role under anaerobic conditions and loses its activity when oxygen concentration is high bebout et al 1993 in summer as the wt increases the activity of nitrogenase increases mcqueen and lean 1987 but the do of dfsk also reached the maximum with an average of 179 4 fig s2c due to the influence of phytoplankton photosynthesis in summer under the hedging action of high do and high wt the activity of nitrogenase decreased and anabaena did not show strong nitrogen fixation ability in summer additionally dfsk was characterized by high tp and low tn concentrations a high tp alleviates the phytoplankton demand for phosphorus therefore the gpp of dfsk mainly shows the result of being limited by n unlike dfsk hjhsk changed from the absolute dominance of bacillariophyta in autumn winter and spring to bacillariophyta closely followed by chlorophyta in summer the absolute advantage of diatoms is that they preferentially use co2 aq for photosynthesis additionally as aforementioned the exchange of co2 between water and the atmosphere is slow and the diffusion rate of co2 in the surface water is 104 fold lower than that in the air in addition similar to the karst aquatic ecosystem the watershed in the clp is highly alkaline owing to its unique hydrochemical characteristics during the sampling period the average ph of hjhsk was 8 5 0 2 studies have shown that in alkaline waters with ph 8 co2 aq is 1 of dic bao et al 2020 riebesell et al 1993 zeng et al 2019 therefore the gpp of hjhsk is mainly limited by co2 aq fig 7d f this finding is consistent with the conclusion in the literature that co2 aq has the highest limitation effect on diatoms bao et al 2020 king 1970 low decarie et al 2011 4 4 response of phytoplankton community succession to co2 aq carbon isotopic evidence the δ13c of different carbon pools differs for example 0 for marine carbonate 8 for atmospheric co2 and from approximately 27 to 12 5 for organic matter based on the photosynthesis of precursor vegetation c3 and c4 respectively clark and fritz 1997 vogel 1993 due to diffusion processes soil co2 is likely to be enriched by approximately 4 4 cerling et al 1991 namely isotopic values of approximately 23 and 10 produced in c3 and c4 ecosystems respectively in our study the mean δ13cdic are 7 67 and 8 45 in wlh and hh respectively and the values for both reservoirs are higher than those for inflow rivers fig 3a and 3b this phenomenon suggests that δ13cdic in the study area is mainly controlled by carbonate weathering and soil co2 dissolution but is also controlled by phytoplankton photosynthesis and respiration in conjunction with discussion 4 1 photosynthesis is the main controlling factor for surface water in our study area notably stable carbon isotopic compositions are widely used to study carbon biogeochemical cycling and phytoplankton succession wang et al 2020 xiao et al 2021 in addition combining δ13cdic with the δ13cpoc can improve the understanding of the response of phytoplankton dynamics hellings et al 1999 savoye et al 2003 aquatic photosynthetic organisms consume dic co2 or hco3 to fix oc under the action of a strong bcp and the source of dic provide phytoplankton with different c isotopic signatures brutemark et al 2009 an important reason for the differences in the c isotope composition of phytoplankton is the difference in stable carbon isotope fractionation εp between phytoplankton taxa and species mcnevin et al 2007 the εp of phytoplankton is complex mainly due to the different mechanisms by which different species of phytoplankton use c especially those physiological processes that involve the ccm badger et al 1998 rokitta and rost 2012 as aforementioned ccm in cyanophyta and chlorophyta are more efficient than other algae at low co2 aq badger and price 2003 therefore co2 aq limitation may drive the succession of phytoplankton from bacillariophyta beneficial to water quality to cyanophyta directly related to eutrophication resulting in hco3 becoming a main inorganic c source for phytoplankton bao et al 2020 kragh et al 2017 low decarie et al 2015 low decarie et al 2011 vadstrup and madsen 1995 wang et al 2018 the high absorption and assimilation of hco3 can reduce the 13c fractionation value since hco3 is rich in 13c relative to co2 approximately 10 brandenburg et al 2022 this process is reflected in the δ13c levels resulting in higher δ13c in cyanophyta and chlorophyta than in other phyta and corresponding δ13cdic is also relatively positive xiao et al 2021 therefore the abundances of cyanophyta and chlorophyta were significantly positively correlated with δ13cdic and δ13cpoc fig 8a and 8b in addition as shown in fig 8c and 8d when the concentration of co2 aq was lower than 10 μmol l 1 δ13cdic and δ13cpoc were obviously more positive the former is generally higher than 6 and the latter was generally higher than 30 and phytoplankton were dominated by cyanophyta and chlorophyta indicating that hco3 as the main inorganic c source was largely assimilated in summary under the premise of appropriate light and heat conditions cyanophyta replaced bacillariophyta as the major algae species in a low co2 aq aquatic environment 5 conclusions and perspectives this study explored the mechanism responsible for transforming dic to oc in the reservoirs of the clp discussed the influence of the hrt on the hydrodynamic effect identified the nutrient limitation mechanism of gpp in reservoirs with different nutritional conditions and explored the response mechanism of phytoplankton community succession to co2 aq in reservoirs based on the δ13cdic the δ13cpoc and the correlation between dic and oc in the river fed reservoir ecosystems on the clp phytoplankton photosynthesis was the major factor driving the transformation of dic to oc in the reservoirs and the hydrodynamic effect can be enhanced by shortening the hrt additionally nutrient restriction analysis using the ratios of nutrient elements of the two reservoirs with different nutrient conditions showed that dfsk with low co2 relative availability and low tn tp was limited by n whereas hjhsk with high co2 relative availability and high tn tp was limited by c in addition co2 availability regulated the composition and structure of phytoplankton in the reservoirs that is with the increase in co2 aq the dominant species changed from cyanophyta and chlorophyta to bacillariophyta and this process has a mitigating effect on eutrophication based on the aforementioned analysis we suggest adjusting the hrt of reservoirs and land use that maintains it within the threshold range of the c n p nutrient element ratios required by bcp for dic fertilization this finding may help to alleviate eutrophication by adjusting phytoplankton structure in addition this finding will increase the carbon sink capacity in reservoirs on the clp via dic fertilization of algae this study improves the understanding of the c n p limitation mechanism of the phytoplankton community structure and gpp changes in the surface waters of the clp with high ph and high dic in semi arid areas and provides policymakers with useful information on mitigating reservoir eutrophication and increasing carbon sinks credit authorship contribution statement mingyu shao writing original draft writing review editing software visualization data curation zaihua liu conceptualization methodology supervision writing review editing hailong sun data curation supervision formal analysis software writing review editing chaowei lai data curation investigation zhen ma data curation investigation xuejun he data curation investigation yan fang data curation investigation qinong chai data curation investigation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this study was financially supported by the strategic priority research program of chinese academy of sciences xdb40020000 the national natural science foundation of china 42130501 42141008 u1612441 and 41921004 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 128781 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
2567,slope aspect plays a vital role in hydrological processes by regulating soil physicochemical properties however its influencing mechanisms and effects on soil hydrological properties are poorly understood especially in the qinghai tibetan plateau qtp in this study two slope aspects i e south facing sf and north facing nf were selected on the northeastern qtp and their soil physicochemical and hydrological properties were examined our results showed that the 0 20 cm water holding capacity and water supply capacity were higher in the sf aspect than in the nf aspect whereas they were lower in the sf aspect than in the nf aspect in the 20 50 cm soil layer this suggested that the vegetation in the sf slope might suffer less from soil erosion owing to its higher topsoil water retention furthermore the soil properties were also altered by slope aspect with the clay content in the nf aspect being higher than in the sf aspect in the 0 50 cm layer and reaching a significant value in the 30 50 cm soil layer besides the soil total carbon tc total nitrogen tn and soil organic matter som were significantly higher in the sf aspect than in the nf aspect in the 0 20 cm soil layer however the 30 50 cm tc tn and som contents were significantly lower in the sf aspect than in the nf aspect overall the soil water holding capacity and supply capacity were mainly controlled by som followed by capillary porosity total porosity and soil bulk density thus soil hydrological properties were significantly affected by the slope aspect and topsoil water retention in the sf aspect was stronger than that in the nf aspect these results provide significant insights for the vegetation recovery of degraded grasslands in alpine ecosystems keywords qinghai tibet plateau alpine meadow slope aspect soil water holding capacity soil properties data availability data will be made available on request 1 introduction soil hydrological properties are important factors of soil hydrological processes gao et al 2018 which control several mechanisms such as water infiltration water supply and evapotranspiration dai et al 2020b however hydrological properties are affected by factors such as vegetation type deng et al 2016 mei et al 2018 grassland degradation dai et al 2020b pan et al 2017 soil properties saxton and rawls 2006 yang et al 2014 topography sun et al 2019 and slope aspect geroy et al 2011 slope aspect is characterized by the slope direction e g south facing sf or north facing nf slopes selvakumar et al 2009 and it significantly affects temperature vegetation productivity energy and water balances begum et al 2010 gong et al 2008 halim and normaniza 2015 of an ecosystem thus controlling soil hydrological properties to date several studies have examined the role of slope on infiltration based on theoretical formulations for infiltration dynamics and models such as the philip green ampt and brooks corey models su et al 2017 morbidelli et al 2018 however most models have considered only a horizontal soil surface or a surface with a low slope that does not affect the infiltration process different slope aspects have rarely been considered fiori et al 2007 which lead to the effects of slope aspects on soil hydrological processes remain largely unclear thus exploring the variations in and influencing mechanisms of soil hydrological properties across different slope aspects could provide insights to manage degraded grasslands and hydrological models in alpine ecosystems in recent years the effects of grassland degradation or vegetation types on soil hydrological properties have been well documented dai et al 2020b pan et al 2017 however little attention has been paid to the role of slope aspects on soil hydrological properties thereby greatly limiting the comprehensive evaluation of soil hydrological processes in complex terrains generally the soil microclimate and vegetation characteristics differ between the nf and sf slopes for example the solar radiation in the sf slope was three times that of the nf slope which contributed to the higher soil temperature and lower moisture in the sf slopes than in the nf slopes sun et al 2019 thus it is reasonable to expect that the vegetation condition and soil properties may differ between the sf and nf slopes thereby altering the soil hydrological properties sun et al 2019 found that the soil water content in the nf aspect was 20 9 higher than that in the sf aspect and the soil water holding capacity in the sf aspect was higher than that in the nf aspect owing to its higher soil organic carbon and available nitrogen in the nf aspect zhang et al 2012 in addition gebrelibanos and assen 2014 found that the field capacity and permanent wilting point were higher in the nf aspect than in the sf aspect because of the higher soil organic matter som and clay content in the nf aspect compared with the sf aspect these results suggest that soil hydrological properties vary with the slope aspect however most previous studies have been mainly conducted in arid and semi arid regions and few studies have focused on alpine ecosystems especially the qinghai tibet plateau qtp we speculated that soil water retention might lead to contrasting results in alpine ecosystems owing to their unique climate conditions such as low temperature and high radiation the alpine qtp is the highest and most extensive plateau region worldwide almost 60 of which is covered by a grassland ecosystem dai et al 2019 however due to the topographic features induced by slope aspect the soil and vegetation conditions are significantly different between the nf and sf slope aspects of this region thereby altering the soil hydrological properties in this study we aimed to 1 examine the variations in the soil hydrological processes such as soil water holding capacity and water supply capacity at different slope aspects and 2 explore the dominant factors driving soil hydrological processes and quantify their contributions to better assess the water holding capacity across different slope aspects soil water retention curve was adopted to describe the relationship between soil water pressure pressure head and soil moisture content our results could contribute to better management of degraded grasslands and maintenance of soil water conservation of alpine ecosystems 2 materials and methods 2 1 study site the experiment was performed in the valleys of the haibei alpine meadow ecosystem research station qinghai china 37 37 n 101 19 e 3200 m a m s l which is located in northeastern qtp fig 1 a the alpine meadow ecosystem in this site experiences a typical plateau continental monsoon climate the average annual precipitation and temperature during 1983 2018 were 484 mm and 1 1 c respectively li et al 2021 precipitation mainly occurs during the growing season i e may september and accounts for almost 80 of the total precipitation the minimum and maximum monthly temperatures are observed in january 15 0 c and july 10 1 c respectively moreover the average rate of actual evapotranspiration is approximately 468 mm dai et al 2021b according to the chinese soil classification system the soil type belongs to a mat cry gelic cambisol moreover the soil thickness is approximately 50 80 cm with abundant som in the topsoil layer owing to the thick mattic epipedon dai et al 2021b the root biomass is mainly concentrated in the 0 10 cm soil layer accounting for approximately 85 of the total root biomass furthermore the grassland ecosystem is an alpine kobresia meadow which is dominated by kobresia humilis stipa aliena trigonella ruthenica and anaphalis lacteal 2 2 experimental design soil sampling and vegetation survey the field experiment was conducted in august 2020 and two slope aspects sf 0 90 and nf 180 270 at approximately 3300 m altitude along the valleys in the haibei alpine meadow ecosystem research station were selected for sampling fig 1a six sample points were selected on the sf and nf aspects each starting from the bottom to the top of the slope fig 1b and c to prevent the effects of slope angle and altitude on soil properties in the study area sampling points were located at similar slope positions three 50 50 cm quadrats were placed at each sample point in both the sf and nf aspects both undisturbed and disturbed soil samples were collected in this study undisturbed soil samples 100 cm3 were collected using a core ring sampler from five soil layers 0 10 10 20 20 30 30 40 and 40 50 cm of three quadrats to determine soil water storage bulk density bd porosity and other hydraulic properties the disturbed soil samples were collected using a soil auger passed through 2 mm and 0 25 mm soil sieves and finally used to analyze the soil properties and soil particle sizes moreover aboveground and belowground biomasses were measured at each sampling point 2 3 laboratory measurements and analyses to eliminate the effect of som on soil particle size measurement the soil particle size from the disturbed soil samples was measured after eliminating som and the soil particles were classified as clay 0 002 mm silt 0 002 0 02 mm and sand 0 02 2 mm contents peng et al 2014 som was measured using the walkey black method nelson and sommers 1983 while total carbon tc and total nitrogen tn were measured using an elemental analyzer elementar vario el iii hanau germany the soil bd was obtained from the undisturbed soil samples collected after oven drying at 105 c for 72 h subsequently the total porosity tp was measured using soil bd and particle density and was then used to calculate soil capillary porosity cp soil non capillary porosity ncp and soil water storage sws mm as follows dai et al 2020a cp cmc bd v 100 ncp tp cp sws h θ bd 10 1 where soil particle density ds is 2 65 g cm 3 cmc is the capillary holding capacity v is the volume of the steel ring core cm3 h is the soil depth cm θ is the soil gravimetric water content and 10 1 mm cm is a unit conversion factor 2 4 statistical analysis all data were expressed as mean standard error se one way analysis of variance anova was used to test the differences in soil and hydrological properties for the same soil layers among different aspects and then a least significant difference test was performed to analyze the differences when the anova results were significant at p 0 05 to identify the dominant factors controlling soil water holding capacity among different aspects variance partitioning and redundancy analysis rda were used to identify the relationships between soil properties and soil hydrological properties and hier part and vegan packages were used to quantitatively assess the relative contribution of soil properties to soil hydrological properties all statistical analyses were conducted using r software version 3 4 1 r core team 2017 3 results 3 1 soil particle size distribution the soil particle size distribution was dominated by silt content mean 58 75 in the top 0 50 cm soil layer across the two slope aspects followed by sand mean 32 82 and clay mean 8 43 fig 2 soil texture class was classified as silty loam fig 3 the clay content in the nf aspect was 8 higher than that in the sf aspect in the 0 50 cm layer and the difference was statistically significant for the 20 30 and 30 40 cm p 0 05 layers furthermore the silt content in the nf aspect was higher than that in the sf aspect in the 0 50 cm layer except in the 20 30 cm layer whereas the sand content was lower in the nf aspect than in the sf aspect in the 0 50 cm layer except in the 20 30 cm layer overall the clay content decreased with soil depth while sand content increased with soil depth 3 2 vegetation and soil properties across the two slope aspects the vegetation and soil properties differed significantly between the two slope aspects particularly the aboveground biomass and belowground biomasses in the sf aspect were significantly higher than those in the nf aspect fig 4 regarding soil properties the bd was significantly higher in the nf aspect than in the sf aspect in the 10 20 cm soil layer p 0 05 fig 5 a whereas the tp was significantly lower in the nf aspect than in the sf aspect in the 10 20 cm layer fig 5b and c furthermore the tc tn and som were significantly higher in the of the sf aspect than in the nf aspect in the 0 20 cm layer whereas the tc tn and som were significantly lower in the sf aspect than in the nf aspect in the 30 50 cm layer fig 5e f and h however the c n ratio was significantly higher in the sf aspect than in the nf aspect in the 20 50 cm fig 5g 3 3 soil water holding capacity and water supply capacity across the two slope aspects the gardner model showed a good fit for the relationship between soil water content and matric potential with a high correlation coefficient fig 6 the soil water holding capacity i e the value of parameter a and soil water supply capacity i e the value of parameter a b were higher in the sf aspect than in the sf aspect in the 0 20 cm layer whereas these two parameters were lower in the sf aspect than in the nf aspect in the 20 50 cm soil layer fig 6 furthermore the soil water storage in the sf aspect was higher than that in the nf aspect in the 0 10 cm layer whereas it was lower in the sf aspect than that in the nf aspect in the 30 50 cm layer fig 7 3 4 relationships between soil hydrological properties and soil properties pearson s correlation analysis showed that the soil water holding capacity and soil water supply capacity were significantly positively correlated with som tp and cp but significantly negatively correlated with bd fig 8 b the first rda axis rda1 and second rda axis rda2 explained 89 90 of the total variation in soil water holding capacity and water supply capacity fig 8a moreover som was the most important factor controlling the soil water holding capacity accounting for 25 29 of the total variance fig 9 a similarly som was also the most important factor controlling the soil water supply capacity accounting for 24 96 of the total variance fig 9b however the soil particle size distribution explained the variations in the soil water holding capacity and water supply capacity to a small extent fig 9 4 discussion 4 1 soil physicochemical properties across the two slope aspects soil properties are greatly affected by slope aspect owing to the variations in environmental factors induced by slope aspect gebrelibanos and assen 2014 huang et al 2015 xue et al 2018 we found that som in the sf aspect was significantly higher than that in the nf aspect in the 0 20 cm layer fig 5h this was inconsistent with the results of a previous study conducted in the highlands of ethiopia and the loess plateau region wherein som was lower in the sf aspect than in the nf aspect gebrelibanos and assen 2014 huang et al 2015 one possible explanation for these discrepancies might be climatic differences plants are limited by soil moisture more than soil temperature in a relatively dry region gebrelibanos and assen 2014 thus higher soil moisture in the nf aspect could stimulate the activity of the microbial community and vegetation growth xue et al 2018 thereby facilitating litter decomposition and nutrient cycling xue et al 2018 this ultimately leads to higher som in the nf aspect comparatively the plants in the alpine ecosystem in this study were mainly limited by temperature compared with soil moisture thus higher insolation and temperature in the sf aspect could largely improve plant growth thereby contributing to higher vegetation biomass and litter decomposition in the sf aspect fig 4 therefore the higher som content in the sf aspect was probably due to the higher vegetation biomass and litter decomposition as most soil carbon input was derived from vegetation biomass wu et al 2010a furthermore the environmental variation induced by the slope aspect was an additional potential factor affecting som by regulating vegetation biomass a previous study reported that direct solar radiation received by the sf aspect was almost three times that of the nf aspect particularly in summer when the solar radiation is the maximum sun et al 2019 higher solar radiation could promote the growth of root biomass thereby increasing soil carbon in the sf aspect compared to the nf aspect xue et al 2018 in contrast we found that 30 50 cm som in the deep soil was significantly lower in the sf aspect than in the nf aspect which may be attributed to the lower c n ratio in the nf aspect than in the sf aspect as most soil n is part of som yimer et al 2006 the distribution pattern of tn was similar to that of som i e the tn in the sf aspect was significantly higher than that in the nf aspect in the 0 20 cm layer whereas the tn in the sf aspect was significantly lower than that in the nf aspect in the 30 50 cm layer fig 5f in addition to som the soil bd also varied with the slope aspect and the topsoil bd 0 20 cm in the nf aspect was higher than that in the sf aspect but deeper soil bd 20 50 cm in the nf aspect was lower than that in the sf aspect fig 5a this was inconsistent with previous studies conducted in arid regions wherein the soil bd in the nf aspect was lower than that in the sf aspect gebrelibanos and assen 2014 the lower soil bd 0 20 cm in the sf aspect was linked to the higher som content in the sf aspect which was also confirmed by the significant negative correlation between som and soil bd fig 8 that is high som contents can reduce soil bd moreover the low soil bd values 0 20 cm in the sf aspect increased soil tp and cp 4 2 soil hydrological properties across the two slope aspects given that the aspect slope influences the variations in environmental factors such as soil moisture and temperature liu and yin 2013 ya ling et al 2008 it is reasonable to expect that soil hydrological properties vary with slope aspect previous studies have reported that the soil moisture content in the nf aspect was higher than that in the sf aspect because the former received less insolation than the latter although both aspects display same factors such as parent material elevation slope position and precipitation sun et al 2019 the high insolation in the sf aspect increased the moisture consumption by soil evaporation this has also been reported in arid and semi arid regions where soil evaporation in the sf aspect was higher than that in the nf aspect hu et al 2008 jin et al 2008 wang et al 2011 eventually leading to lower soil water content in the sf aspect under the same precipitation conditions however in our study we found higher soil water storage in the sf aspect than in the nf aspect in the 0 10 cm layer fig 6 this was contrasting to previous studies conducted in the highlands of ethiopia and himalayan valley where the field capacity and permanent wilting point in the nf aspect were higher than those in the sf aspect gebrelibanos and assen 2014 måren et al 2015 the higher soil moisture storage in the sf aspect might be attributed to its stronger rainfall infiltration capacity by low surface runoff owing to its higher vegetation height and aboveground biomass in the sf aspect fig 4 the higher som in the sf aspect further contributed to the increased soil water storage which further increased the soil moisture storage in the sf aspect moreover we found that the soil water holding capacity and water supply capacity varied between the two slope aspects for example the soil water holding capacity and water supply capacity in the sf aspect were higher than in the nf aspect in the 0 20 cm layer fig 6 considering that soil water holding capacity and soil water supply capacity are important components of hydrological properties which regulate soil infiltration evapotranspiration and water storage in specific soil layers robinson et al 2008 we concluded that the topsoil had a stronger water retention capacity in the sf aspect than in the nf aspect and could store more water for evapotranspiration under seasonal droughts thus the plants in the sf aspect may be less vulnerable to soil water stress and soil erosion contrastingly the soil water holding capacity and water supply capacities in the sf aspect were lower than those in the nf aspect in the 20 50 cm layer these trends in soil water holding capacity and water supply capacity primarily contributed to variations in som for examine the som in the sf aspect was significantly higher than that in the nf aspect in the 0 20 cm layer while it was lower in the sf aspect than in the nf aspect in the 20 50 cm layer this was consistent with the patterns of soil water holding capacity and water supply capacity which was also supported by the significantly positive relationship between som and soil water holding capacity and soil water supply capacity fig 8 however compared with som soil size distribution weakly influenced soil water holding capacity which is inconsistent with a previous study that reported that soil water holding capacity was mainly dominated by the clay content wösten et al 2001 this insignificant relationship between soil water holding capacity and soil particle size may be ascribed to the fact that the range of clay content 8 43 was relatively low fig 2 whereas the som content was relatively high fig 5h thus water was weakly adsorbed on clay this was also confirmed by the results of a previous study wherein the soil water holding capacity of silt loam was controlled by som rather than clay yang et al 2014 4 3 implications for degraded grassland restoration and water conservation grassland ecosystems cover more than 60 of the qtp and provide important ecosystem services such as biodiversity conservation carbon storage and water conservation dong et al 2020 however in recent decades the grasslands in the qtp have suffered from serious degradation owing to increasing human activity cao et al 2019 numerous studies have attempted to identify methods to recover degraded grasslands accordingly several approaches such as grazing management dai et al 2021a species selection wu et al 2010b and nutrient addition wang et al 2020 have been adopted but little attention has been paid to the role of slope aspects in grassland restoration given that grassland restoration is greatly affected by soil hydrological properties such as soil water holding capacity and water supply capacity high water holding capacity and water supply capacity could promote quick plant recovery we found that the soil water holding capacity and water supply capacity in the sf aspect were higher than those in the nf aspect fig 6 suggesting that the plants in the sf aspect may be less vulnerable to soil water stress and soil erosion moreover grassland restoration in the sf aspect may promote plant growth especially considering that the root system in the alpine grassland is mainly distributed in shallow soil layers 0 20 cm therefore our study could provide significant insights into the restoration of degraded grasslands in the qtp 5 conclusion the soil hydrological and physicochemical properties differed significantly between the sf and nf aspects the topsoil 0 20 cm water holding capacity and water supply capacity in the sf aspect were higher than those in the sf aspect whereas the deep soil 20 50 cm water holding capacity and water supply capacity in the sf aspect were lower than those in the nf aspect these results were consistent with the som results thus we can conclude that the soil water holding capacity and soil water supply capacity were mainly determined by som and the topsoil in the sf aspect may be less vulnerable to soil erosion and water stress further our results suggested that soil hydrological properties are greatly influenced by slope aspect which altered soil properties such as som thus slope aspects should be considered while recovering degraded grasslands and designing soil water conservation strategies in alpine ecosystems credit authorship contribution statement licong dai conceptualization methodology resources investigation data curation writing original draft formal analysis visualization ruiyu fu data curation writing original draft xiaowei guo resources investigation yangong du writing review editing fawei zhang guangmin cao conceptualization methodology writing review editing funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments we sincerely appreciate the invaluable comments of two reviewers this work was supported by the natural science foundation of hainan 422qn264 the natural science foundation of qinghai 2021 hz 811 national natural science foundation of china 41730752 and start up funding from hainan university kyqd zr 22085 
2567,slope aspect plays a vital role in hydrological processes by regulating soil physicochemical properties however its influencing mechanisms and effects on soil hydrological properties are poorly understood especially in the qinghai tibetan plateau qtp in this study two slope aspects i e south facing sf and north facing nf were selected on the northeastern qtp and their soil physicochemical and hydrological properties were examined our results showed that the 0 20 cm water holding capacity and water supply capacity were higher in the sf aspect than in the nf aspect whereas they were lower in the sf aspect than in the nf aspect in the 20 50 cm soil layer this suggested that the vegetation in the sf slope might suffer less from soil erosion owing to its higher topsoil water retention furthermore the soil properties were also altered by slope aspect with the clay content in the nf aspect being higher than in the sf aspect in the 0 50 cm layer and reaching a significant value in the 30 50 cm soil layer besides the soil total carbon tc total nitrogen tn and soil organic matter som were significantly higher in the sf aspect than in the nf aspect in the 0 20 cm soil layer however the 30 50 cm tc tn and som contents were significantly lower in the sf aspect than in the nf aspect overall the soil water holding capacity and supply capacity were mainly controlled by som followed by capillary porosity total porosity and soil bulk density thus soil hydrological properties were significantly affected by the slope aspect and topsoil water retention in the sf aspect was stronger than that in the nf aspect these results provide significant insights for the vegetation recovery of degraded grasslands in alpine ecosystems keywords qinghai tibet plateau alpine meadow slope aspect soil water holding capacity soil properties data availability data will be made available on request 1 introduction soil hydrological properties are important factors of soil hydrological processes gao et al 2018 which control several mechanisms such as water infiltration water supply and evapotranspiration dai et al 2020b however hydrological properties are affected by factors such as vegetation type deng et al 2016 mei et al 2018 grassland degradation dai et al 2020b pan et al 2017 soil properties saxton and rawls 2006 yang et al 2014 topography sun et al 2019 and slope aspect geroy et al 2011 slope aspect is characterized by the slope direction e g south facing sf or north facing nf slopes selvakumar et al 2009 and it significantly affects temperature vegetation productivity energy and water balances begum et al 2010 gong et al 2008 halim and normaniza 2015 of an ecosystem thus controlling soil hydrological properties to date several studies have examined the role of slope on infiltration based on theoretical formulations for infiltration dynamics and models such as the philip green ampt and brooks corey models su et al 2017 morbidelli et al 2018 however most models have considered only a horizontal soil surface or a surface with a low slope that does not affect the infiltration process different slope aspects have rarely been considered fiori et al 2007 which lead to the effects of slope aspects on soil hydrological processes remain largely unclear thus exploring the variations in and influencing mechanisms of soil hydrological properties across different slope aspects could provide insights to manage degraded grasslands and hydrological models in alpine ecosystems in recent years the effects of grassland degradation or vegetation types on soil hydrological properties have been well documented dai et al 2020b pan et al 2017 however little attention has been paid to the role of slope aspects on soil hydrological properties thereby greatly limiting the comprehensive evaluation of soil hydrological processes in complex terrains generally the soil microclimate and vegetation characteristics differ between the nf and sf slopes for example the solar radiation in the sf slope was three times that of the nf slope which contributed to the higher soil temperature and lower moisture in the sf slopes than in the nf slopes sun et al 2019 thus it is reasonable to expect that the vegetation condition and soil properties may differ between the sf and nf slopes thereby altering the soil hydrological properties sun et al 2019 found that the soil water content in the nf aspect was 20 9 higher than that in the sf aspect and the soil water holding capacity in the sf aspect was higher than that in the nf aspect owing to its higher soil organic carbon and available nitrogen in the nf aspect zhang et al 2012 in addition gebrelibanos and assen 2014 found that the field capacity and permanent wilting point were higher in the nf aspect than in the sf aspect because of the higher soil organic matter som and clay content in the nf aspect compared with the sf aspect these results suggest that soil hydrological properties vary with the slope aspect however most previous studies have been mainly conducted in arid and semi arid regions and few studies have focused on alpine ecosystems especially the qinghai tibet plateau qtp we speculated that soil water retention might lead to contrasting results in alpine ecosystems owing to their unique climate conditions such as low temperature and high radiation the alpine qtp is the highest and most extensive plateau region worldwide almost 60 of which is covered by a grassland ecosystem dai et al 2019 however due to the topographic features induced by slope aspect the soil and vegetation conditions are significantly different between the nf and sf slope aspects of this region thereby altering the soil hydrological properties in this study we aimed to 1 examine the variations in the soil hydrological processes such as soil water holding capacity and water supply capacity at different slope aspects and 2 explore the dominant factors driving soil hydrological processes and quantify their contributions to better assess the water holding capacity across different slope aspects soil water retention curve was adopted to describe the relationship between soil water pressure pressure head and soil moisture content our results could contribute to better management of degraded grasslands and maintenance of soil water conservation of alpine ecosystems 2 materials and methods 2 1 study site the experiment was performed in the valleys of the haibei alpine meadow ecosystem research station qinghai china 37 37 n 101 19 e 3200 m a m s l which is located in northeastern qtp fig 1 a the alpine meadow ecosystem in this site experiences a typical plateau continental monsoon climate the average annual precipitation and temperature during 1983 2018 were 484 mm and 1 1 c respectively li et al 2021 precipitation mainly occurs during the growing season i e may september and accounts for almost 80 of the total precipitation the minimum and maximum monthly temperatures are observed in january 15 0 c and july 10 1 c respectively moreover the average rate of actual evapotranspiration is approximately 468 mm dai et al 2021b according to the chinese soil classification system the soil type belongs to a mat cry gelic cambisol moreover the soil thickness is approximately 50 80 cm with abundant som in the topsoil layer owing to the thick mattic epipedon dai et al 2021b the root biomass is mainly concentrated in the 0 10 cm soil layer accounting for approximately 85 of the total root biomass furthermore the grassland ecosystem is an alpine kobresia meadow which is dominated by kobresia humilis stipa aliena trigonella ruthenica and anaphalis lacteal 2 2 experimental design soil sampling and vegetation survey the field experiment was conducted in august 2020 and two slope aspects sf 0 90 and nf 180 270 at approximately 3300 m altitude along the valleys in the haibei alpine meadow ecosystem research station were selected for sampling fig 1a six sample points were selected on the sf and nf aspects each starting from the bottom to the top of the slope fig 1b and c to prevent the effects of slope angle and altitude on soil properties in the study area sampling points were located at similar slope positions three 50 50 cm quadrats were placed at each sample point in both the sf and nf aspects both undisturbed and disturbed soil samples were collected in this study undisturbed soil samples 100 cm3 were collected using a core ring sampler from five soil layers 0 10 10 20 20 30 30 40 and 40 50 cm of three quadrats to determine soil water storage bulk density bd porosity and other hydraulic properties the disturbed soil samples were collected using a soil auger passed through 2 mm and 0 25 mm soil sieves and finally used to analyze the soil properties and soil particle sizes moreover aboveground and belowground biomasses were measured at each sampling point 2 3 laboratory measurements and analyses to eliminate the effect of som on soil particle size measurement the soil particle size from the disturbed soil samples was measured after eliminating som and the soil particles were classified as clay 0 002 mm silt 0 002 0 02 mm and sand 0 02 2 mm contents peng et al 2014 som was measured using the walkey black method nelson and sommers 1983 while total carbon tc and total nitrogen tn were measured using an elemental analyzer elementar vario el iii hanau germany the soil bd was obtained from the undisturbed soil samples collected after oven drying at 105 c for 72 h subsequently the total porosity tp was measured using soil bd and particle density and was then used to calculate soil capillary porosity cp soil non capillary porosity ncp and soil water storage sws mm as follows dai et al 2020a cp cmc bd v 100 ncp tp cp sws h θ bd 10 1 where soil particle density ds is 2 65 g cm 3 cmc is the capillary holding capacity v is the volume of the steel ring core cm3 h is the soil depth cm θ is the soil gravimetric water content and 10 1 mm cm is a unit conversion factor 2 4 statistical analysis all data were expressed as mean standard error se one way analysis of variance anova was used to test the differences in soil and hydrological properties for the same soil layers among different aspects and then a least significant difference test was performed to analyze the differences when the anova results were significant at p 0 05 to identify the dominant factors controlling soil water holding capacity among different aspects variance partitioning and redundancy analysis rda were used to identify the relationships between soil properties and soil hydrological properties and hier part and vegan packages were used to quantitatively assess the relative contribution of soil properties to soil hydrological properties all statistical analyses were conducted using r software version 3 4 1 r core team 2017 3 results 3 1 soil particle size distribution the soil particle size distribution was dominated by silt content mean 58 75 in the top 0 50 cm soil layer across the two slope aspects followed by sand mean 32 82 and clay mean 8 43 fig 2 soil texture class was classified as silty loam fig 3 the clay content in the nf aspect was 8 higher than that in the sf aspect in the 0 50 cm layer and the difference was statistically significant for the 20 30 and 30 40 cm p 0 05 layers furthermore the silt content in the nf aspect was higher than that in the sf aspect in the 0 50 cm layer except in the 20 30 cm layer whereas the sand content was lower in the nf aspect than in the sf aspect in the 0 50 cm layer except in the 20 30 cm layer overall the clay content decreased with soil depth while sand content increased with soil depth 3 2 vegetation and soil properties across the two slope aspects the vegetation and soil properties differed significantly between the two slope aspects particularly the aboveground biomass and belowground biomasses in the sf aspect were significantly higher than those in the nf aspect fig 4 regarding soil properties the bd was significantly higher in the nf aspect than in the sf aspect in the 10 20 cm soil layer p 0 05 fig 5 a whereas the tp was significantly lower in the nf aspect than in the sf aspect in the 10 20 cm layer fig 5b and c furthermore the tc tn and som were significantly higher in the of the sf aspect than in the nf aspect in the 0 20 cm layer whereas the tc tn and som were significantly lower in the sf aspect than in the nf aspect in the 30 50 cm layer fig 5e f and h however the c n ratio was significantly higher in the sf aspect than in the nf aspect in the 20 50 cm fig 5g 3 3 soil water holding capacity and water supply capacity across the two slope aspects the gardner model showed a good fit for the relationship between soil water content and matric potential with a high correlation coefficient fig 6 the soil water holding capacity i e the value of parameter a and soil water supply capacity i e the value of parameter a b were higher in the sf aspect than in the sf aspect in the 0 20 cm layer whereas these two parameters were lower in the sf aspect than in the nf aspect in the 20 50 cm soil layer fig 6 furthermore the soil water storage in the sf aspect was higher than that in the nf aspect in the 0 10 cm layer whereas it was lower in the sf aspect than that in the nf aspect in the 30 50 cm layer fig 7 3 4 relationships between soil hydrological properties and soil properties pearson s correlation analysis showed that the soil water holding capacity and soil water supply capacity were significantly positively correlated with som tp and cp but significantly negatively correlated with bd fig 8 b the first rda axis rda1 and second rda axis rda2 explained 89 90 of the total variation in soil water holding capacity and water supply capacity fig 8a moreover som was the most important factor controlling the soil water holding capacity accounting for 25 29 of the total variance fig 9 a similarly som was also the most important factor controlling the soil water supply capacity accounting for 24 96 of the total variance fig 9b however the soil particle size distribution explained the variations in the soil water holding capacity and water supply capacity to a small extent fig 9 4 discussion 4 1 soil physicochemical properties across the two slope aspects soil properties are greatly affected by slope aspect owing to the variations in environmental factors induced by slope aspect gebrelibanos and assen 2014 huang et al 2015 xue et al 2018 we found that som in the sf aspect was significantly higher than that in the nf aspect in the 0 20 cm layer fig 5h this was inconsistent with the results of a previous study conducted in the highlands of ethiopia and the loess plateau region wherein som was lower in the sf aspect than in the nf aspect gebrelibanos and assen 2014 huang et al 2015 one possible explanation for these discrepancies might be climatic differences plants are limited by soil moisture more than soil temperature in a relatively dry region gebrelibanos and assen 2014 thus higher soil moisture in the nf aspect could stimulate the activity of the microbial community and vegetation growth xue et al 2018 thereby facilitating litter decomposition and nutrient cycling xue et al 2018 this ultimately leads to higher som in the nf aspect comparatively the plants in the alpine ecosystem in this study were mainly limited by temperature compared with soil moisture thus higher insolation and temperature in the sf aspect could largely improve plant growth thereby contributing to higher vegetation biomass and litter decomposition in the sf aspect fig 4 therefore the higher som content in the sf aspect was probably due to the higher vegetation biomass and litter decomposition as most soil carbon input was derived from vegetation biomass wu et al 2010a furthermore the environmental variation induced by the slope aspect was an additional potential factor affecting som by regulating vegetation biomass a previous study reported that direct solar radiation received by the sf aspect was almost three times that of the nf aspect particularly in summer when the solar radiation is the maximum sun et al 2019 higher solar radiation could promote the growth of root biomass thereby increasing soil carbon in the sf aspect compared to the nf aspect xue et al 2018 in contrast we found that 30 50 cm som in the deep soil was significantly lower in the sf aspect than in the nf aspect which may be attributed to the lower c n ratio in the nf aspect than in the sf aspect as most soil n is part of som yimer et al 2006 the distribution pattern of tn was similar to that of som i e the tn in the sf aspect was significantly higher than that in the nf aspect in the 0 20 cm layer whereas the tn in the sf aspect was significantly lower than that in the nf aspect in the 30 50 cm layer fig 5f in addition to som the soil bd also varied with the slope aspect and the topsoil bd 0 20 cm in the nf aspect was higher than that in the sf aspect but deeper soil bd 20 50 cm in the nf aspect was lower than that in the sf aspect fig 5a this was inconsistent with previous studies conducted in arid regions wherein the soil bd in the nf aspect was lower than that in the sf aspect gebrelibanos and assen 2014 the lower soil bd 0 20 cm in the sf aspect was linked to the higher som content in the sf aspect which was also confirmed by the significant negative correlation between som and soil bd fig 8 that is high som contents can reduce soil bd moreover the low soil bd values 0 20 cm in the sf aspect increased soil tp and cp 4 2 soil hydrological properties across the two slope aspects given that the aspect slope influences the variations in environmental factors such as soil moisture and temperature liu and yin 2013 ya ling et al 2008 it is reasonable to expect that soil hydrological properties vary with slope aspect previous studies have reported that the soil moisture content in the nf aspect was higher than that in the sf aspect because the former received less insolation than the latter although both aspects display same factors such as parent material elevation slope position and precipitation sun et al 2019 the high insolation in the sf aspect increased the moisture consumption by soil evaporation this has also been reported in arid and semi arid regions where soil evaporation in the sf aspect was higher than that in the nf aspect hu et al 2008 jin et al 2008 wang et al 2011 eventually leading to lower soil water content in the sf aspect under the same precipitation conditions however in our study we found higher soil water storage in the sf aspect than in the nf aspect in the 0 10 cm layer fig 6 this was contrasting to previous studies conducted in the highlands of ethiopia and himalayan valley where the field capacity and permanent wilting point in the nf aspect were higher than those in the sf aspect gebrelibanos and assen 2014 måren et al 2015 the higher soil moisture storage in the sf aspect might be attributed to its stronger rainfall infiltration capacity by low surface runoff owing to its higher vegetation height and aboveground biomass in the sf aspect fig 4 the higher som in the sf aspect further contributed to the increased soil water storage which further increased the soil moisture storage in the sf aspect moreover we found that the soil water holding capacity and water supply capacity varied between the two slope aspects for example the soil water holding capacity and water supply capacity in the sf aspect were higher than in the nf aspect in the 0 20 cm layer fig 6 considering that soil water holding capacity and soil water supply capacity are important components of hydrological properties which regulate soil infiltration evapotranspiration and water storage in specific soil layers robinson et al 2008 we concluded that the topsoil had a stronger water retention capacity in the sf aspect than in the nf aspect and could store more water for evapotranspiration under seasonal droughts thus the plants in the sf aspect may be less vulnerable to soil water stress and soil erosion contrastingly the soil water holding capacity and water supply capacities in the sf aspect were lower than those in the nf aspect in the 20 50 cm layer these trends in soil water holding capacity and water supply capacity primarily contributed to variations in som for examine the som in the sf aspect was significantly higher than that in the nf aspect in the 0 20 cm layer while it was lower in the sf aspect than in the nf aspect in the 20 50 cm layer this was consistent with the patterns of soil water holding capacity and water supply capacity which was also supported by the significantly positive relationship between som and soil water holding capacity and soil water supply capacity fig 8 however compared with som soil size distribution weakly influenced soil water holding capacity which is inconsistent with a previous study that reported that soil water holding capacity was mainly dominated by the clay content wösten et al 2001 this insignificant relationship between soil water holding capacity and soil particle size may be ascribed to the fact that the range of clay content 8 43 was relatively low fig 2 whereas the som content was relatively high fig 5h thus water was weakly adsorbed on clay this was also confirmed by the results of a previous study wherein the soil water holding capacity of silt loam was controlled by som rather than clay yang et al 2014 4 3 implications for degraded grassland restoration and water conservation grassland ecosystems cover more than 60 of the qtp and provide important ecosystem services such as biodiversity conservation carbon storage and water conservation dong et al 2020 however in recent decades the grasslands in the qtp have suffered from serious degradation owing to increasing human activity cao et al 2019 numerous studies have attempted to identify methods to recover degraded grasslands accordingly several approaches such as grazing management dai et al 2021a species selection wu et al 2010b and nutrient addition wang et al 2020 have been adopted but little attention has been paid to the role of slope aspects in grassland restoration given that grassland restoration is greatly affected by soil hydrological properties such as soil water holding capacity and water supply capacity high water holding capacity and water supply capacity could promote quick plant recovery we found that the soil water holding capacity and water supply capacity in the sf aspect were higher than those in the nf aspect fig 6 suggesting that the plants in the sf aspect may be less vulnerable to soil water stress and soil erosion moreover grassland restoration in the sf aspect may promote plant growth especially considering that the root system in the alpine grassland is mainly distributed in shallow soil layers 0 20 cm therefore our study could provide significant insights into the restoration of degraded grasslands in the qtp 5 conclusion the soil hydrological and physicochemical properties differed significantly between the sf and nf aspects the topsoil 0 20 cm water holding capacity and water supply capacity in the sf aspect were higher than those in the sf aspect whereas the deep soil 20 50 cm water holding capacity and water supply capacity in the sf aspect were lower than those in the nf aspect these results were consistent with the som results thus we can conclude that the soil water holding capacity and soil water supply capacity were mainly determined by som and the topsoil in the sf aspect may be less vulnerable to soil erosion and water stress further our results suggested that soil hydrological properties are greatly influenced by slope aspect which altered soil properties such as som thus slope aspects should be considered while recovering degraded grasslands and designing soil water conservation strategies in alpine ecosystems credit authorship contribution statement licong dai conceptualization methodology resources investigation data curation writing original draft formal analysis visualization ruiyu fu data curation writing original draft xiaowei guo resources investigation yangong du writing review editing fawei zhang guangmin cao conceptualization methodology writing review editing funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments we sincerely appreciate the invaluable comments of two reviewers this work was supported by the natural science foundation of hainan 422qn264 the natural science foundation of qinghai 2021 hz 811 national natural science foundation of china 41730752 and start up funding from hainan university kyqd zr 22085 
2568,to estimate snowpack water storage in mountain basins this study presents a framework that couples a deep learning long short term memory lstm model and a zonal bias correction approach for assimilating ground snow observations we explored the framework s ability for snow water equivalent swe mapping and forecasting in a domain including the feather yuba bear and american river basins in california s sierra nevada through a series of different modeling experiments performances of the lstm model and bias correction approach were independently investigated the lstm model trained with meteorological forcing precipitation and temperature landscape attributes and antecedent lagged snow conditions showed good agreement with swe reanalysis data nash sutcliffe efficiency nse 0 99 however for continuous swe projection without using swe reanalysis as the antecedent snow condition the lstm model underestimated basin scale and site scale swe nse 0 19 reflecting large discrepancies since model bias accumulates over time thus a zonal inverse distance weighting idw bias correction approach was proposed to assimilate ground observations and correct model trajectory with the bias correction swe estimates were significantly improved nse 0 79 the zonal idw approach accounts for snow differences across different areas by zonal distance based on historical snow patterns showing better predictions than the original idw which showed larger biases in complex terrain with a rain shadow we observed that swe estimates from the framework were not sensitive to the difference in precipitation and temperature forcings between observation based data and one day ahead weather forecasts suggesting that the framework can use weather forecast forcing for snowpack forecasting comparison between results from monthly and daily bias corrections showed that increasing bias correction frequency and integrating more snow observations can further improve swe estimates using the continuous swe products analyses of 170 precipitation events showed that snowmelt often occurred when daily temperature was above 3 7 c augmenting runoff the proposed framework leverages ground observations and a deep learning model to provide daily gridded snowpack estimates which are important for runoff forecasting and water supply keywords snowpack snowmelt bias correction inverse distance weight lstm model data availability data will be made available on request 1 introduction mountain snowpack is an important component of the global water and energy budget barnett et al 1988 sturm 2015 and seasonal snowmelt driven runoff from natural water towers provides fresh water for more than one sixth of the world s population in downstream regions barnett et al 2005 mankin et al 2015 in california the seasonal snowpack in the sierra nevada is the major water source bales et al 2006 dettinger and anderson 2015 accounting for approximately 60 of consumptive water use and 72 of reservoir storage rhoades et al 2018 snowmelt driven runoff can also significantly contribute to flood hazards threatening public safety and infrastructure li and simonovic 2002 mccabe et al 2007 e g extreme snowmelt generated runoff driven by rain on snow during warm atmospheric river storms henn et al 2020 however snowpack distribution has high spatial temporal variability influenced by elevation slope and aspect topography vegetation cover and wind redistribution clark et al 2011 dettinger et al 2004 elder et al 1991 pflug and lundquist 2020 posing challenges for accurate snowpack estimation dozier 2011 margulis et al 2019 which is crucial for water supply planning reservoir operation and flood control the water amount in the snowpack snow water equivalent swe is of the most interest hydrologically at a point scale swe can be reliably measured on the ground from snow pillows snow depth sensors and field surveys however in situ swe measurements cannot provide detailed spatial information as they are typically limited in spatial resolution meanwhile it is challenging to obtain perfect swe observations due to the heterogeneity in mountainous environments siirila woodburn et al 2021 as such a number of methods have been developed to provide the spatial distribution of mountain swe i e gridded products while there are also some limitations dozier et al 2016 for example swe products can be obtained by spatial interpolation and regression approaches fassnacht et al 2003 harshburger et al 2010 schneider and molotch 2016 and these estimates are constrained by the density and location of ground measurements with greater uncertainty in unrepresented locations products from global passive microwave remote sensing have large spatial coverage while they are known to suffer from artifacts in mountain terrain and underestimate swe gan et al 2021 swe reconstruction based on energy balance and satellite observation of snow disappearance cline et al 1998 molotch and margulis 2008 only covers the snowmelt season and needs further development for real time applications gridded swe at a fine spatial resolution of 50 m can be estimated using periodic airborne lidar based snow depth and modeled snow density painter et al 2016 which opened opportunities for snowpack mapping and model evaluation bair et al 2016 oaida et al 2019 pflug and lundquist 2020 yang et al 2022 zheng et al 2018 for basin scale swe estimation with limited ground swe measurements ensemble optimal interpolation can be used together with historical lidar derived swe maps as a stationary background malek et al 2020 limiting its ability to represent swe changes imposed by extreme warm or snow storms on the other side physically based snow models have been developed based on theoretical understanding from observations and experiments the models can simulate swe changes at fine spatial and temporal resolutions barrett 2003 marks et al 1999 for accurate predictions snow models require correct initial conditions and meteorological forcing data e g precipitation and air temperature with uncertainties primarily from input data parameterization and deficiency in model structure bair et al 2018 baldo and margulis 2017 lv et al 2019 magnusson et al 2014 mortimer et al 2020 deep learning has recently emerged as a powerful modeling tool to capture complex processes in hydrology kratzert et al 2019 shen et al 2018 without explicit knowledge of physical processes and strong structural assumptions deep learning models use an interconnected network of neurons to directly learn dynamic responses from extensive data schmidhuber 2015 and thus are less affected by structural deficiencies appearing in physically based models feng et al 2020 shen 2018 as a type of recurrent neural network the long short term memory lstm model can memorize system internal states capturing long term dependencies between input and output hochreiter and schmidhuber 1997 lstm modeling has been widely applied to predict time series data with remarkable success particularly for rainfall runoff processes with promising performance compared to physically based models chen et al 2020 cui et al 2022a feng et al 2020 frame et al 2021 gauch et al 2021 kratzert et al 2021 zhang et al 2018 snowpack is highly temporally autocorrelated and hence naturally has a long memory fiddes et al 2019 which can be taken advantage of by the lstm model yet the unique potential for swe prediction using state of the art lstm modeling has not been explored data assimilation is commonly applied in physically based hydrologic modeling for better forecasts clark et al 2008 cluzet et al 2021 liu and gupta 2007 magnusson et al 2014 saloranta 2016 that is using recent observations to update model state or output and to correct erroneous model trajectories caused by model deficiencies to improve the predictive ability of snow models different techniques are applied to assimilate ground swe measurements lidar snow data and remote sensing snow cover data for example the operational snow data assimilation system snodas uses a nudging procedure to assimilate the spatially interpolated differences between observed snow values and estimates from a mass and energy balance model barrett 2003 i e bias correct model estimates toward observations boni et al 2010 the swe reanalysis data for california s sierra nevada were generated using a bayesian framework to assimilate remote sensing based fractional snow cover data into a snow model margulis et al 2019 2016 direct insertion of lidar derived snow depth data into a distributed physically based isnobal model can improve snow simulation hedrick et al 2018 considering the snowpack s nature of high temporal autocorrelation and spatial heterogeneity it is worth exploiting whether there is a great potential for leveraging recent snow observations to improve deep learning based snow estimates in this study we developed and tested a framework that couples a deep learning based lstm model and snow observation assimilation for daily swe mapping and forecasting which are important to seasonal water supply short term runoff forecasting and flood control our specific aims were to i evaluate whether an lstm model without using ground observations can adequately estimate swe ii develop a nudging approach accounting for different characteristics in snow zones to efficiently assimilate real time snow observations into the lstm model and evaluate its performance compared to the commonly used inverse distance weighting bias correction and iii investigate whether the lstm model with assimilation is sensitive to meteorological forcing inputs weather forecasts versus observation based datasets and different assimilation frequencies daily versus monthly here we hypothesized that frequent assimilation of available snow observations accounting for zonal snow differences can improve deep learning based basin scale swe estimates 2 data and methods this study focuses on swe mapping in a domain in northern california s sierra nevada with dense ground snow observations fig 1 to develop and demonstrate a framework consisting of a deep learning based model and data assimilation fig 2 this section describes ground snow observations gridded snow datasets and remote sensing data used in the framework an lstm model was trained to predict initial swe maps with the inputs of dynamic forcing landscape attributes and lagged snow observations we then propose an assimilation approach based on inverse distance weighting with the considerations of snow zone differences to bias correct the initial lstm estimates toward ground snow observations after filtering the swe estimates using snow cover data final swe estimates were integrated into the lstm model as inputs for next time step calculation 2 1 study area and data our study domain includes three basins in northern california s sierra nevada fig 1 the feather yuba bear and american river basins each providing major water resources for municipal water supplies downstream agriculture and aquatic ecosystems the domain has a typical mediterranean climate which is characterized by wet winters and early springs and little precipitation during summer winter seasonal snowpack provides water resources throughout the drier summer dams and reservoirs at lake oroville bullards bar and folsom lake are critical for flood control and power generation for the sacramento area carter et al 2006 the feather basin has an area of 9430 km2 above oroville dam the western side of the feather basin receives significantly more precipitation than its eastern rain shadowed area due to its complex topography with mixed arrangements of ridges and valleys freeman 2011 water from the yuba bear river basin 4400 km2 joins the feather river the largest tributary of the sacramento river the largest river in california as the second largest tributary to the sacramento river the american river has a drainage area of 4770 km2 specifically for the purpose of snowpack mapping and forecasting this study focused on seasonally snow covered areas of the domain fig 3 a i e the areas with elevations above an average snow line of 1500 m cui et al 2020 huning and aghakouchak 2020 margulis et al 2016 welch et al 2013 wrzesien et al 2017 three sources of in situ swe observations were used as ground truth fig 1 first was daily automatic swe data from the operational snow pillow network 27 sites table s1 with real time data hosted by the california data exchange center cdec http cdec water ca gov second was monthly manual snow courses 70 sites conducted on the first day during january june from cdec third was daily swe values estimated using snow depth observations by a research wireless sensor network wsn 7 sites in table s1 data available at https doi org 10 6071 m39q2v in the american river basin and basin averaged snow density cui et al 2022b zhang et al 2017a note that 10 snow depth sensors were distributed within 1 km2 at each wsn site to capture snow variability caused by landscape attributes welch et al 2013 zhang et al 2017b and their averaged values at each site were used since this study estimated swe of the three basins at 1 km2 grids all collected swe observations were quality controlled to remove out of range values cui et al 2022b three gridded snow products were used to develop and evaluate a deep learning based model first was daily swe reanalysis data for the sierra nevada above 1500 m elevation during water years wy october 1 september 30 1985 2016 available at https ucla app box com v swe reanalysis the swe reanalysis data at a spatial resolution of 90 m were generated by a bayesian data assimilation framework to constrain and update a snow model using landsat snow cover data huning and margulis 2018 margulis et al 2016 evaluation using independent ground snow observations i e not used in the assimilation procedure of the swe reanalysis showed that the reanalysis data had a mean swe bias of 30 mm and a correlation 0 95 with observations over the sierra nevada margulis et al 2016 second was daily operational swe products from snodas nohrsc 2004 https nsidc org data g02158 at 1 km resolution during wy2007 2019 the snodas products assimilate observations from satellite snow cover airborne measurements and ground stations e g snow pillows and snow courses by spatial interpolation of differences between observations and estimates from a mass and energy balance snow model barrett 2003 carroll et al 2001 while the widely used snodas swe product is not the ground truth it often serves as a useful benchmark for assessing other modeled estimates broxton et al 2016 cho and jacobs 2020 wrzesien et al 2017 for this study the swe reanalysis data were aggregated to 1 km resolution the same resolution as used in the snodas product third was the remotely sensed fractional snow covered area from modis metsämäki et al 2015 nagler et al 2021 https catalogue ceda ac uk uuid ef8eb5ff84994f2ca416dbb2df7f72c7 the daily fractional snow covered area data 0 100 were resampled to the same resolution as the two snow products above using the nearest neighbor method this study included two different daily meteorological forcing datasets to investigate their influences on our swe estimates first was observation based precipitation and temperature data from the parameter elevation relationships on independent slopes model prism https prism oregonstate edu which are actively used as inputs for hydrologic modeling prism data are interpolated based on a climate elevation regression using ground measurements from nearly 13 000 stations for precipitation and 10 000 stations for temperature daly et al 2008 the original prism data at an 800 m resolution were aggregated to the same resolution as the snow products second was weather forecast data from the california nevada river forecast center cnrfc https www cnrfc noaa gov daily quantitative precipitation forecasts qpf and temperature forecasts at 1 day lead time with a spatial resolution of 4 km for wy2012 2019 were collected and then bilinearly interpolated to the same resolution as gridded snow products for this study we augmented our precipitation event based snowmelt runoff analyses using the snow level data from two frequency modulated continuous wave fmcw radars in the study area one is located at oroville 39 532 n 121 488 w 114 m elevation in the feather and the other is located at colfax 39 080 n 120 938 w 644 m elevation in the american fig 1 the radar snow level indicates the elevation at which the probability of precipitation falling as snow is 50 johnston et al 2017 white et al 2010 i e precipitation at elevations above the rain snow transition level is mainly in the form of snow these operational radars provide near real time atmospheric snow level information 10 min resolution from https psl noaa gov data obs data which is valuable for estimating ground precipitation phase i e rain versus snow cui et al 2020 we used the mean values of the two radars as the snow level data for the three basins in our study area and averaged them to hourly and daily resolutions 2 2 deep learning based swe model with zonal bias correction our snow mapping and forecasting framework fig 2 contains two main components i e an lstm model and a zonal inverse distance weighting idw bias correction which are described below 2 2 1 lstm model for initial snow estimates we developed an lstm model to provide initial swe estimates at each 1 km pixel of the three basins the lstm model can learn long term or short term dependencies from sequential data by using recurrently connected memory cells to store and process sequential information hochreiter and schmidhuber 1997 at each time step a series of information gates i e input gate forget gate and output gate controls the information flow of cell state and hidden state fig s1 the hidden state at the last time step t was connected to a dense layer followed by a dropout layer to predict the target variable at step t which was swe t in our case mathematical details about the lstm model can be found in text s1 the lstm model inputs at each daily time step t included dynamic meteorological forcing data precipitation and temperature at day t and seven static landscape attributes for each pixel precipitation and temperature are the primary drivers of daily swe change nedelcev and jenicek 2021 sospedra alfonso and merryfield 2017 e g swe increment due to snowfall is primarily affected by both precipitation and temperature and snowmelt can also be classically estimated using temperature as a key indicator the seven static landscape attributes are elevation slope aspect latitude and longitude from the national elevation dataset gesch et al 2018 and canopy cover from the national land cover database dewitz 2019 as these attributes affect snow accumulation and ablation zheng et al 2018 e g elevation is highly correlated with air pressure which affects rain snow partitioning dai 2008 latitude slope and aspect affect solar radiation tian et al 2001 which is a main variable for snowmelt prediction bouamri et al 2018 additionally a one day lagged swe value antecedent swe at one day prior i e swe t 1 was integrated as one input feature to assist the lstm model in better learning snow evolution according to recent snow conditions the target variable is swe t from the daily gridded swe estimates at 1 km resolution using the snow reanalysis product margulis et al 2016 here the process model based swe product instead of ground swe measurements was used for training the lstm model because of the more comprehensive spatial coverage of reanalysis data a total of 10 735 1 km pixels above 1500 m elevation versus the limited continuous ground based swe measurements 34 snow pillow and wsn sites considering the uncertainty of precipitation measurements from relatively sparse gauges at higher elevations in snow covered mountains cui et al 2022b rasmussen et al 2012 the lstm model was trained using precipitation and temperature forcing inputs from prism which also made use of snow course measurements for precipitation interpolation henn et al 2015 we trained the lstm model with sequential data with a length of 7 days meaning that input data from day t 6 to t were used to predict swe at target day t in this study a 7 day sequence length was used taking into account that a 7 day data can sufficiently reflect snow changes that are driven mainly by recent temperature and precipitation and b for investigating snowmelt driven extreme events a 7 day duration was used considering the response time of streamflow to precipitation and persistence days of snowmelt related flood events cho et al 2021 all input data were standardized by subtracting their mean and dividing by their standard deviation the hidden units of both the lstm layer and dense layer were 200 and a dropout rate was 0 25 cui et al 2022a using the keras deep learning package gulli and pal 2017 the lstm model was optimized by the adam algorithm with a loss function of mean squared error and an initial learning rate of 0 001 for the 31 year swe data at a total of 10 735 pixels 68 wy1985 2006 16 wy2007 2011 and 16 wy2012 2016 were split and used as training validation and testing periods respectively the trained lstm model can be seen as a surrogate snow model learned from the snow reanalysis data providing initial swe estimates in response to recent meteorological and snow conditions 2 2 2 zonal idw bias correction assimilating ground observations to assimilate snow observations we proposed a bias correction approach based on zonal inverse distance weighting idw to nudge initial lstm swe estimates i e background estimates toward ground swe observations the original idw is often used to correct background model estimates using observations such as snodas barrett 2003 and in a snow depth study by boni et al 2010 the core task of bias correction is to spatially interpolate point scale residuals which in our case are the swe residuals denoted as ri mm between a ground observation at any site i and the initial lstm swe estimate at the grid point that includes the observation site for any grid pixel j its euclidean distance dj i m to observation site i is expressed as 1 d j i x j x i 2 y j y i 2 α h j h i 2 where x and y m are the two utm universal transverse mercator coordinates h is the elevation m factor α adds more weight 5000 to elevational distance versus horizontal distance barrett 2003 foppa et al 2007 magnusson et al 2014 since snow shows stronger variability along elevational than horizontal distance the original idw determines a set of weights u j i unitless based on inverse distance squared weights between grid j and a total of n ground sites used for assimilation 2 u j i 1 d j i 2 i 1 n 1 d j i 2 if using the original idw for bias correction the swe bias at any pixel is interpolated using the original idw weights u j i multiplied by residuals at all sites ri mm however snow exhibits strong heterogeneity in complex mountain terrain which is not fully accounted for in the original idw for example the eastern rain shadow area in the feather river basin receives significantly less precipitation than does the western windward side freeman 2011 malek et al 2019 resulting in relatively lower snow storage which cannot be explicitly explained by either horizontal or elevational distance hence we proposed a zonal distance to enable the idw weights to represent spatial snow heterogeneity based on historical snow pattern information first our study areas were divided into five different snow zones fig 3a determined by a gaussian mixture model oroza et al 2016 using normal april 1st snowpack amount i e the average reanalysis swe on april 1st during wy1985 2016 the normal swe amount increases gradually from zone 1 to 5 fig 3b zone 1 in the american river basin is mainly in lower elevations with less orographic precipitation meanwhile zone 1 includes the eastern rain shadow area in the feather river basin the areas at higher elevations with large precipitation were included in zone 5 which has the largest snowpack considering different snow characteristics across snow zones we then defined the zonal distance zj i between grid j and observation site i based on the absolute difference of their zone numbers z with a range of 1 5 3 z j i z j z i 1 the zonal distance was used to assign greater weights to the sites in closer snow zones that share more similarities in snow characteristics thus the final zonal idw weights wj were calculated by normalizing the original idw weight with zonal distance 4 w j i u j i z j i p i 1 n u j i z j i p where p is a decay factor to lower the influence of sites with larger zonal distances to grid j in other words a larger value of p means assigning a larger weight of sites in the same snow zone we set p as 5 for this study after several trials therefore the swe residual at any grid pixel j rj mm is interpolated using zonal idw weights and bias ri mm at all sites used for assimilation fig 3a 5 r j i 1 n w j i r i a daily bias corrected swe map was calculated as the summation of the zonal idw swe residual map and the initial lstm map such that the lstm estimates were nudged to ground snow observations afterward the bias corrected swe map was further filtered using the modis fractional snow cover area data to obtain final gridded daily swe estimates so that swe at pixels without snow cover 0 fractional snow cover area was set to 0 mm note that as depicted in fig 2 the final daily swe estimates were integrated as updated the antecedent swe of lstm model inputs for the initial swe mapping at the next time step our proposed modeling approach was implemented using the python programming language version 3 7 van rossum and drake 2009 and libraries including keras chollet et al 2015 scikit learn pedregosa et al 2011 numpy harris et al 2020 h5py collette et al 2022 pandas the pandas development team 2022 gdal ogr gdal ogr contributors 2022 and pyproj snow et al 2022 2 3 modeling experiments and evaluation a series of modeling experiments table 1 were designed to investigate the swe prediction performance of the deep learning lstm model and the potential improvement from the zonal idw bias correction the training experiment expt 1 with prism forcing demonstrated the prediction ability of the lstm only model with ideal reanalysis data as antecedent lagged data since the reanalysis data are not available for real time swe mapping expt 2 integrated continuous swe estimates from the lstm only model as antecedent snow data to indicate the extent to which modeled swe bias would accumulate in the projection mode without any bias correction in comparison to expt 1 by adding daily bias corrections using the ground swe observations from snow pillows the wireless sensor network and snow courses expt 3 and 4 were designed to investigate the estimation difference between the original idw lstm idw and the proposed zonal idw lstm zonal idw and the performance improvement from bias correction compared to expt 2 for possible swe forecasting expt 5 used the lstm idw with one day leading weather forecast data from cnrfc which was different from all other experiments forced by observation based prism data to investigate the impact of bias correction frequency on swe estimates expt 6 was set similar to expt 4 except that only a monthly bias correction was applied using snow course observations to perform intercomparisons of results from the above mentioned experiments we evaluated swe estimates with metrics at three different scales i e point basin and map monthly swe observations at 28 snow course sites denoted as evaluation sites in table s1 and fig 3a were used to calculate the mean and standard deviation of their differences to modeled swe at corresponding grids this point scale evaluation was used to assess model performance at sites that were not used for bias correction at a basin scale the time series of average swe estimates across all areas above 1500 m elevation were compared against the average swe observations from all ground sites using the nash sutcliffe efficiency coefficient nse ranging from to 1 with 1 denoting a perfect model ritter and muñoz carpena 2013 at a detailed map scale the spatial swe map of 1 km resolution we compared different swe estimates using the structural similarity index ssim which was originally proposed for image comparison wang et al 2004 and further applied in spatial data jones et al 2016 the ssim is a single value metric that combines three local similarities in terms of the mean variance and spatial covariance between two swe maps using a spatially moving window 3 3 gird mathematical details about the ssim can be found in text s2 and jones et al 2016 simply put the ssim has a range from 1 to 1 with 1 indicating that the two maps are identical and with 1 showing complete dissimilarity of map spatial structure using this overall metric for map comparison the spatial differences of modeled swe estimates can be explicitly evaluated we also investigated snowmelt related runoff in the three basins for precipitation events in wy2007 2019 using our best daily swe products from the above modeling experiments to identify a precipitation event we first selected all precipitation days defined as the days with basin averaged prism precipitation 0 254 mm i e the measurable precipitation 0 01 in defined by the national weather service following sumargo et al 2020 and cui et al 2022b then a precipitation event was determined as the consecutive precipitation days with cumulative precipitation 20 mm cui et al 2022b for the determined 170 precipitation events e g the top 20 events in table s2 we further classified them into three types according to their mean radar snow level cold events dominated by snowfall 50 snow level during the event is lower than the 1500 m lowest elevation in our study domain derived from 1 km dem data mixed phased events dominated by rain snow mixed precipitation 50 snow level in between the lowest 1500 m and highest 2880 m elevations and warm events dominated by rainfall 50 snow level higher than 2880 m highest elevation for each precipitation day runoff potential rp mm quantifies the available water contributing to runoff processes and floods based on the snowpack mass balance cho et al 2021 yan et al 2018 runoff potential can be calculated using precipitation p mm and daily swe change δswe mm positive values for increasing swe which is rp p δ s w e the runoff ratio c unitless is defined as the ratio of runoff potential to precipitation c rp p 1 δ s w e p therefore for snowmelt related runoff e g rain on snow runoff potential includes additional water from melting snow resulting in runoff ratio c 1 3 results 3 1 performance of lstm model in this training experiment expt 1 the lstm model showed a good swe predictability compared to swe reanalysis data used as training targets fig 4 the average swe in the three basins fluctuated during wy1985 2016 fig 4c with peak snow occurring in wy1993 and lowest snow in warm wy2015 in response to precipitation and temperature fig 4a b the nses of basin averaged swe for the training validation and testing periods were all 0 99 indicating that the lstm model successfully estimated snowpack storage in mountains and captured temporary changes the pixel level comparison for the testing period fig 4d reveals that the lstm model predicted swe was in good agreement with snow reanalysis with a coefficient of determination r2 of 0 99 and root mean square error rmse of 5 85 mm table 2 pixel level swe differences were evenly spread out from the mean of 0 30 mm fig 4e showing that the estimates from the lstm model were generally small and unbiased it should be noted that in this training experiment the lstm model used the swe reanalysis data as its antecedent lagged snow condition meaning that potential estimation biases were somewhat corrected by integrating the lagged reanalysis swe data 3 2 comparison across modeling experiments 3 2 1 swe estimates from different experiments for swe mapping applications in projection mode the lstm model iteratively used its predictions as lagged swe conditions without bias correction expt 2 this differed from the training mode expt 1 where lagged swe conditions were from swe reanalysis data not readily available in near real time the lstm in the projection model expt 2 underestimated basin average and site scale swe compared to estimates based on ground observations fig 5 a and table 3 the underestimations in the projection model expt 2 were more noticeable than the lstm in training mode expt 1 and the swe reanalysis dataset as also shown in fig s2 although the swe reanalysis dataset showed underestimation table 3 the projection model without bias correction further underestimated swe compared to its training swe reanalysis dataset site scale evaluation demonstrated that the negative bias in the projection model accumulated and was substantially lower than in the swe reanalysis the bias accumulation is more notable during wet years e g wy2011 in fig s2b therefore bias accumulation contributes most to swe underestimation in the lstm projection mode though the relatively slight underestimation in the trained lstm model is inherited from the underestimation bias of the training swe reanalysis dataset this suggests that bias correction by assimilating ground observations is needed by applying bias corrections based on the original idw expt 3 and the zonal idw expt 4 the nses of basin scale swe estimates were significantly improved to 0 886 and 0 787 respectively compared to 0 193 from expt 2 note that the basin scale swe estimates from observations represented an upper limit since ground observation sites were often placed in relatively snow rich areas hence all modeled basin scale swe estimates showed negative mean differences meaning that these estimates were lower than the average of ground observations table 3 of note the computational cost of our modeling approaches is not an issue for general applications e g for each daily timestep in expt 4 it takes 2 8 s to perform swe mapping over our study area using a computer with an intel r xeon r platinum 8268 2 90 ghz cpu evaluation at the site scale shows that lstm models with bias correction expt 3 and 4 slightly overestimated swe but with lower absolute differences compared to other experiments fig 5b and table 3 the swe differences were more noticeable during wet years e g 2010 and 2011 than dry years e g 2014 2015 the swe reanalysis showed a larger underestimation mean site scale swe difference of 65 mm than snodas 41 mm since snodas assimilated ground observations while the reanalysis dataset did not although the lstm model with the original idw bias correction expt 3 had the highest nse table 3 it tended to overestimate swe more 34 mm and had a wider spread of bias a standard deviation of 43 mm than that with the zonal idw expt 4 a mean bias of 20 mm and a standard deviation of 37 mm this may be due to the fact that bias correction with the original idw does not account for characteristics at different snow zones showing an inferior performance than that using the zonal idw which is further investigated at a spatial map scale in the following section 3 2 2 comparison between zonal idw and original idw bias correction taking a high snowpack day on april 1 2011 as an example the swe estimates from both lstm models with the original idw and zonal idw bias corrections showed larger snowpack on the western windward side and high elevations of the three basins fig 6 a b however the model with the original idw correction estimated a higher basin averaged swe 1200 mm than that with zonal idw 1010 mm the overestimation was noticeable in areas with lower swe estimates from the model with zonal idw correction fig 6c at the map scale the areas with larger differences were mainly located in the eastern rain shadow of the feather river basin fig 6d indicated by relatively lower similarity smaller ssim the similarity of swe estimates between lstm models with the original idw expt 3 and the zonal idw bias correction expt 4 was higher during water years with less snow wy2014 and 2015 in fig s3a indicating that the two different bias correction approaches have smaller differences during dry years the mean ssim on the first day of january may during wy2007 2016 was again relatively lower in the rain shadow areas of the feather river basin fig s3b thus the ssim in snow zone 1 of which a great portion is in rain shadow areas was lower than in other snow zones fig s3c for zone 5 with the largest historical snowpack the similarity between the two estimates was relatively lower than those in zones 2 3 and 4 highlighting that the two bias correction approaches have greater differences in snow richer areas we further evaluated swe estimates from the two bias correction approaches using ground snow observations for six sites in the low ssim rain shadow area fig 7 the lstm model with the original idw bias correction showed the largest mean bias of 67 mm compared to 15 mm from that with zonal idw correction and 3 mm from snodas fig 7a note that snodas products may assimilate the observations for six evaluation sites thus showing the lowest mean bias using the student s t test we observed that the swe bias from the zonal idw correction shows significantly lower values than that from the original idw correction one tailed p value of 2 3 10 8 while no statistically significant difference to that from snodas two tailed p value of 0 12 in terms of bias variabilities denoted by standard deviation the lstm model with the zonal idw showed a statistically significant one tailed p values 0 003 lower value mean of 42 mm than snodas 74 mm and the lstm model with the original idw bias correction 78 mm overall the proposal zonal idw showed better swe bias correction results than the original idw approach which does not account for snow differences across snow zones leading to a larger snowpack overestimation 3 2 3 bias distribution across snow zones the swe residual from the zonal idw bias correction showed spatial variability across the three basins fig s4a the eastern rain shadow areas in the feather river basin had negative swe residuals meaning that the initial swe estimates from the lstm model tend to overestimate swe compared to ground observations positive swe residuals were typically shown in the western windward side of three basins where snowpack generally increases with elevation due to lower temperatures and orographic enhancement of precipitation swe residuals also increased along snow zones with larger historical snowpack with median values from 0 4 to 1 2 mm across five snow zones fig s4b the positive swe residuals across zones 2 5 indicate that the lstm model initially underestimated swe in comparison to ground swe observations 3 3 modeling with different forcing inputs and bias correction frequencies to forecast snowpack in the near future weather forecast meteorological data can be used as model forcing inputs as for applications in observation sparse mountain regions daily ground snow observation may not be available for bias correction thus we further investigated swe estimates from the lstm model with zonal idw bias correction with different forcing inputs expt 5 and bias correction frequencies expt 6 3 3 1 forecasts versus observation based forcing inputs the basin scale swe estimates from the model with precipitation and temperature forcing from cnrfc 1 day forecasts agreed with those from the model with observation based prism forcing data fig 8 a the nse between the model results using prism and the averaged swe from ground observations was 0 82 slightly 0 81 from the model with forecast forcing compared to site scale snow courses the model with forecast forcing showed a larger overestimation a mean bias of 11 mm than that 6 mm with prism forcing fig 8b it is worth noting that there were differences between the forecasts and prism forcing data fig s5a b the mean precipitation ssim was 0 81 while larger dissimilarity was shown in high elevation windward areas daily precipitation forecasts during wy2014 2019 averaged 0 02 mm larger than prism with a standard deviation of 2 2 mm the mean temperature ssim was 0 33 indicating that their temperature differences were more notable than precipitation differences daily temperature forecasts averaged 0 11 c lower than prism with a standard deviation of 3 99 c the higher precipitation and cooler temperature from the forecast data resulted in the slightly larger swe overestimation the mean ssim of swe estimates was 0 82 fig s5c with lower values in snow zones with historically larger snowpacks fig s5d reflecting a larger difference in swe estimates caused by the forcing data difference in high elevations overall the bias correction approach nudged initial swe estimates toward ground snow observation making final swe estimates generally not sensitive to the difference in meteorological forcings 3 3 2 daily versus monthly bias correction integrating snow observations at a monthly frequency significantly improved the nse to 0 770 from 0 190 compared to the projection lstm without bias correction fig s6a although the value was smaller than the 0 798 from the model with a daily bias correction a site scale comparison shows that the monthly bias correction had a larger standard deviation 51 mm of bias than did the daily bias correction 37 mm though both yielded a similar mean bias of 18 mm fig s6b the most negative bias 252 mm for monthly bias correction appeared on june 1 2011 shown by comparing to observations from two available snow courses on that day observations from only seven snow courses were used for monthly bias correction which was much fewer than a total of 25 ground observations snow courses plus pillows used for daily bias correction as expected integrating more information from all available ground sites across the three basins can reduce estimation bias on a map scale the ssim on the first day of each month i e the day when monthly correction was applied between estimates from daily and monthly correction was 0 717 larger than a mean ssim of 0 532 for the 15th day of each month fig 9 a b the larger dissimilarity on the 15th day the middle between two monthly correction days indicates that snow difference was more noticeable during the periods without bias correction as model bias accumulated this is further evidenced by the more noticeable bias and larger rmse during mid and late parts of snow accumulation months compared to the first day of each month fig s7a b again the similarity of swe estimation tended to be lower in snow zones at higher elevations with larger snowpacks fig 9c d the southeastern part of our study domain exhibited a low similarity likely due to the fact that the dense swe measurements from snow pillows and the wireless sensor network were used in the daily bias correction while not used in the monthly correction 3 4 snowmelt related runoff two extreme precipitation events fig 10 out of total 170 events are used to illustrate basin averaged swe and runoff potential estimated using the lstm model with daily zonal idw bias correction of note our study area has a mediterranean climate with wet winters and dry summers meaning that warm precipitation events classified in this study often occur in dry summers with small precipitation totals fig s8 the two illustrative events had mean daily precipitation intensity 30 mm d 1 table s2 one is a mixed phased event on february 1 11 2017 cumulative prism precipitation ranked 2nd highest of the 170 events table s2 and the other is a cold event on february 12 18 2019 ranked 13th for the mixed phased event fig 10a f radar snow level averaged 1950 m before feb 7 however the snow level elevated to around 2540 m on feb 7 9 fig 10a due to an atmospheric river transporting intense moisture flux to the mountain cui et al 2022b resulting in warmer temperatures fig 10b large precipitation fig 10c during this precipitation period the decrease of basin averaged swe from the observations and models fig 10d and the negative swe changes fig 10e in particular those from ground observations often located in higher elevation snow rich areas indicate the occurrence of rain on snow contributing additional snowmelt to potential runoff fig 10f for which a detailed investigation can be found in henn et al 2020 daily swe did not show noticeable differences between the modeling results using prism and cnrfc forecasts their differences in runoff potential are mainly contributed by the differences in precipitation amount both model results using prism and cnrfc forecasts indicate a runoff ratio 1 1 for this event reflecting the additional snowmelt runoff from rain on snow during the other cold event fig 10g l 58 of snow level observations were below the lowest 1500 m elevation of our study domain a portion of precipitation fell as solid precipitation and continuously increased basin averaged swe resulting in a runoff ratio of 0 4 for this cold event for a total of 982 precipitation days during the 170 events we observed close relationships between temperature snowmelt runoff and radar snow level fig 11 the frequency of snowmelt runoff i e runoff ratio 1 is positively correlated to daily temperature fig 11a following the sigmoidal curve often used for describing the relationship between temperature and snowfall frequency dai 2008 jennings et al 2018 we observed that the frequency of snowmelt runoff per 1 c temperature bin is well explained r2 0 93 by a hyperbolic tangent function freq 0 484 t a n h 0 116 t 4 884 1 165 which suggests a 50 snowmelt runoff temperature at 3 7 c meanwhile temperature linearly correlates with daily radar snow level fig 11b we fitted the data using the huber regression huber 1973 which is robust to outliers that may exist in radar data cui et al 2020 minder and kingsmill 2013 osborne et al 2021 after removing 66 outliers 10 of radar data identified by the huber regression the fitted equation snowlevel 125 69 t 1573 explains 81 of the variance of daily snow level data the 50 snowmelt runoff temperature at 3 7 c corresponds to the snow level at 2040 m elevation above which there is a high chance of additional snowmelt augmenting basin scale runoff in our study domain 4 discussion 4 1 the need of assimilating snow observations into deep learning based estimates in this snowpack mapping and forecasting study the deep learning lstm model alone does not provide satisfactory estimates owing to bias accumulating during the projection period even though the lstm model in a training mode performs well the good performance in the training mode indicates that the lstm model has learned snow dynamics reflected in the training data attention should be paid to applying the deep learning lstm model for projection i e open loop simulation iteratively uses modeled swe estimates as antecedent condition inputs as model bias gradually accumulates leading to swe underestimations in the peak snow season which is more noticeable during wet years than during dry years the deep learning model s capability for snowpack projection needs to be carefully evaluated before putting into practice antecedent lagged swe conditions play an important role in simulating swe changes in response to meteorological forcing this is attributed to the reasonable predictive ability in the training mode which integrates swe reanalysis data as antecedent conditions updating final bias corrected swe estimates as antecedent lagged swe observations helps the lstm model perform projections based on more accurate recent snow conditions this is consistent with the finding in a streamflow forecast study using an lstm model feng et al 2020 showing that directly integrating one day lagged observations into model inputs can strongly improve forecasts compared to model results without using recent observations as inputs for mountain regions with seasonal snowfall the important precipitation forcing data have uncertainties since gauge measurements are spatially limited and associated with high uncertainty often underestimated during snowfall cui et al 2022b rasmussen et al 2012 the precipitation uncertainties propagate to the swe projection bias through modeling abbasnezhadi et al 2021 reported that assimilation of snow data can add valuable information that is not readily available from sparse precipitation gauges and hence significantly improves streamflow estimation our study demonstrated that the lstm model showed larger initial swe underestimations in higher elevation snow richer areas fig s3 coincident with the potential precipitation underestimations from gauge based data in higher elevations cui et al 2022b further precipitation differences between weather forecasts and gauge based datasets are relatively large at higher elevations contributing to larger differences in snow richer areas ground snow observations considered more reliable than precipitation measurements at higher elevations during snowfall periods lundquist et al 2019 can effectively bias correct initial swe estimates from the deep learning model as demonstrated by bias correction methods using either the original idw or the new proposed zonal idw for snowpack forecasting using the framework lstm model with zonal idw bias correction the swe estimates forced by one day leading weather forecasts are comparable to those forced by observation based prism data this indicates that the framework is not sensitive to the differences in forcing data since the bias correction procedure continuously nudges model estimates back to a right trajectory although there are considerable dissimilarities between weather forecasts and observations during high flood risk seasons these snowpack forecasts driven by weather forecasts can be used to estimate snowpack storage and potential snowmelt that may significantly contribute to extreme runoff providing important information for flood control plans and reservoir management 4 2 historical snow pattern information improves bias correlation the proposed zonal idw bias correction used the zonal distance to account for the snow difference in mountains based on the historical snow pattern information snow heterogeneity from a reanalysis dataset in complex terrain like our study domain that includes large rain shadow areas snowpack differences cannot be well explained by either horizontal or elevational distances this explains why the zonal idw bias correction embedding historical snow pattern difference across the three basins showed better performance than the original idw bias correction particularly in the rain shadow areas previous studies also suggested that historical snow pattern information is useful for swe prediction for example pflug and lundquist 2020 inferred snow depth in california s tuolumne watershed from lidar data only covering a small portion of the domain based on snow pattern repeatability building on the inter annual consistency of snow distribution a nearest neighbor technique was applied to find the closed historical lidar derived swe that best fits current snow conditions observed by a significant amount of hypothetically placed wireless sensor networks zheng et al 2018 a number of machine learning based studies have reported that historical snow pattern i e climatological swe is one of the most informative predictors for swe estimation bair et al 2018 schneider and molotch 2016 yang et al 2022 thus it is suggested to use historical snow pattern information e g zonal idw method to help bias correct the initial swe estimates from either physically based or deep learning based models 4 3 broader and more frequent observations for assimilation applications this study demonstrates that assimilating broader and more frequent observations can improve swe estimates through the comparison between daily and monthly bias corrections we observed that even assimilating snow course only observations at a longer monthly frequency can substantially improve swe estimates suggesting that any available ground observation in data sparse regions could be used to improve model estimates increasing bias correction frequency to one day and integrating extra snow observations from snow pillows and wireless sensor network into the framework can further improve snowpack mapping other valuable snowpack observations from novel techniques whenever available can be leveraged to improve and nudge model prediction toward observations complementing the ground snow observations from operational networks for example the periodic airborne lidar can provide basin scale swe at a fine resolution of 50 m painter et al 2016 which can be directly assimilated into model simulations hedrick et al 2018 crowd sourced snow measurements collected by citizen scientists e g recreational users and snow enthusiasts in relatively undersampled high mountain areas can be used in data assimilation to improve model estimates crumley et al 2021 for fine scale e g 1 km swe estimation the spatially distributed clusters of more than ten wireless sensor nodes within 1 km2 across headwater basins cui et al 2022b welch et al 2013 zhang et al 2017a b can provide on the ground information on snow variability caused by local landscape attributes in terms of spatial and temporal coverages plus coarse and fine scale heterogeneities all these snow observations have their unique potential to improve model based swe estimates 4 4 machine learning methods for snow mapping this study demonstrated the potential of the deep learning lstm model in snow mapping which is one of many machine learning applications for swe estimation for example linear regression models explicitly explain the importance of historical snow patterns snow cover data physiographic information and vegetation variable fassnacht et al 2003 schneider and molotch 2016 yang et al 2022 which are all used in our proposed approach given the nonlinearity of snow spatial distribution tree based regression models are used to capture the non linear relationships between predictor variables and swe bair et al 2018 elder et al 1998 molotch et al 2005 revuelto et al 2020 yang et al 2019 zhang et al 2021 another non linear method is based on neural networks e g the conventional feed forward neural network i e artificial neural network ann has become popular for estimating snow information bair et al 2018 broxton et al 2019 ghanjkhanlo et al 2020 ntokas et al 2021 tedesco et al 2004 compared to conventional neural networks deep learning models which consisted of more hidden layers and a more complex structure have better generalization performance and stronger nonlinear expressiveness capability shen 2018 wang et al 2020 yuan et al 2020 deep learning models showed good performance in snow related studies e g the applications of deep belief network dbn in satellite retrieved snow depth wang et al 2020 yet deep learning has rarely been applied to swe mapping the lstm model explored in this study accounts for the temporal autocorrelation memory of swe showing a promising short term prediction ability figs 4 and 8 however as discussed in section 4 1 above the lstm model relies on antecedent swe conditions which are often not available in near real time point ground swe measurements or other available near real time data e g lestak 2022 can be used to improve lstm predictions through the proposed bias correction approach there is still room for reducing the lstm model s reliance on antecedent snow conditions for example it is worth investigating the physics informed hybrid lstm model in future snow studies since hybrid models that combine hydrological process understanding with deep learning models have shown their potential in further improving streamflow prediction frame et al 2021 lu et al 2021 the approach proposed in this study can be transferred to other regions on the one hand though regionally specific swe reanalysis data were used to train the lstm model and determine the interpolation snow zones for our study domain in california s sierra nevada any available high quality swe reanalysis could be used for applications in other regions meanwhile the method margulis et al 2016 used to generate swe reanalysis data in the sierra nevada is applicable in other regions across the world as it has been successfully implemented in the high mountain asia https doi org 10 5067 hnaugjqxscvu liu et al 2021 margulis et al 2019 on the other hand transfer learning using a deep learning model trained in data rich regions can improve streamflow prediction in data sparse regions ma et al 2021 oruche et al 2021 implying that the trained lstm snow model in our study domain with relatively rich data may be transferable to other regions which deserves further investigations of note our approach was proposed using high resolution meteorological forcing datasets derived from ground observations and has not been evaluated its applicability using coarse resolution forcing datasets e g global 0 25 0 25 data from gldas era5 5 conclusions using three seasonally snow coved basins of the northern sierra nevada as an example this study presents a framework that couples a deep learning lstm model and a zonal bias correction approach for estimating snowpack in mountain areas our proposed hypothesis was supported by comparisons to ground snow measurements at three different scales point basin and map scale across six modeling experiments showing that frequent assimilation of available snow observations accounting for zonal snow differences can improve deep learning based basin scale swe estimates in a practical context the proposed framework based on a deep learning model can simply yet effectively assimilate in situ snow observations for real time snowpack mapping and forecasting this study highlights that even when a state of the art deep learning model is applied for real time snow applications assimilating ground observations by accounting for zonal snow differences can provide unparalleled information for improving model accuracy particularly in complex terrain for regions with water resources that rely on snowmelt driven runoff snow estimates from this framework can assist forecasters and water managers in decision making regarding flood control and water supply complementing operational snow products from physical process based models for example in our study area we need to be cautious on precipitation days when temperature is above 3 7 c or snow level higher than 2040 m since basin runoff can be augmented by additional water originating from snowmelt credit authorship contribution statement guotao cui conceptualization methodology investigation visualization writing original draft writing review editing michael anderson writing review editing roger bales supervision funding acquisition conceptualization resources investigation writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was supported by the u s bureau of reclamation watersmart program sustain and manage america s resources for tomorrow the california department of water resources the uc university of california water security and sustainability research initiative grant no 13941 and the nsf major research instrumentation grant ear 1126887 we thank e bair and two anonymous reviewers for their valuable comments and constructive suggestions appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 128835 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
2568,to estimate snowpack water storage in mountain basins this study presents a framework that couples a deep learning long short term memory lstm model and a zonal bias correction approach for assimilating ground snow observations we explored the framework s ability for snow water equivalent swe mapping and forecasting in a domain including the feather yuba bear and american river basins in california s sierra nevada through a series of different modeling experiments performances of the lstm model and bias correction approach were independently investigated the lstm model trained with meteorological forcing precipitation and temperature landscape attributes and antecedent lagged snow conditions showed good agreement with swe reanalysis data nash sutcliffe efficiency nse 0 99 however for continuous swe projection without using swe reanalysis as the antecedent snow condition the lstm model underestimated basin scale and site scale swe nse 0 19 reflecting large discrepancies since model bias accumulates over time thus a zonal inverse distance weighting idw bias correction approach was proposed to assimilate ground observations and correct model trajectory with the bias correction swe estimates were significantly improved nse 0 79 the zonal idw approach accounts for snow differences across different areas by zonal distance based on historical snow patterns showing better predictions than the original idw which showed larger biases in complex terrain with a rain shadow we observed that swe estimates from the framework were not sensitive to the difference in precipitation and temperature forcings between observation based data and one day ahead weather forecasts suggesting that the framework can use weather forecast forcing for snowpack forecasting comparison between results from monthly and daily bias corrections showed that increasing bias correction frequency and integrating more snow observations can further improve swe estimates using the continuous swe products analyses of 170 precipitation events showed that snowmelt often occurred when daily temperature was above 3 7 c augmenting runoff the proposed framework leverages ground observations and a deep learning model to provide daily gridded snowpack estimates which are important for runoff forecasting and water supply keywords snowpack snowmelt bias correction inverse distance weight lstm model data availability data will be made available on request 1 introduction mountain snowpack is an important component of the global water and energy budget barnett et al 1988 sturm 2015 and seasonal snowmelt driven runoff from natural water towers provides fresh water for more than one sixth of the world s population in downstream regions barnett et al 2005 mankin et al 2015 in california the seasonal snowpack in the sierra nevada is the major water source bales et al 2006 dettinger and anderson 2015 accounting for approximately 60 of consumptive water use and 72 of reservoir storage rhoades et al 2018 snowmelt driven runoff can also significantly contribute to flood hazards threatening public safety and infrastructure li and simonovic 2002 mccabe et al 2007 e g extreme snowmelt generated runoff driven by rain on snow during warm atmospheric river storms henn et al 2020 however snowpack distribution has high spatial temporal variability influenced by elevation slope and aspect topography vegetation cover and wind redistribution clark et al 2011 dettinger et al 2004 elder et al 1991 pflug and lundquist 2020 posing challenges for accurate snowpack estimation dozier 2011 margulis et al 2019 which is crucial for water supply planning reservoir operation and flood control the water amount in the snowpack snow water equivalent swe is of the most interest hydrologically at a point scale swe can be reliably measured on the ground from snow pillows snow depth sensors and field surveys however in situ swe measurements cannot provide detailed spatial information as they are typically limited in spatial resolution meanwhile it is challenging to obtain perfect swe observations due to the heterogeneity in mountainous environments siirila woodburn et al 2021 as such a number of methods have been developed to provide the spatial distribution of mountain swe i e gridded products while there are also some limitations dozier et al 2016 for example swe products can be obtained by spatial interpolation and regression approaches fassnacht et al 2003 harshburger et al 2010 schneider and molotch 2016 and these estimates are constrained by the density and location of ground measurements with greater uncertainty in unrepresented locations products from global passive microwave remote sensing have large spatial coverage while they are known to suffer from artifacts in mountain terrain and underestimate swe gan et al 2021 swe reconstruction based on energy balance and satellite observation of snow disappearance cline et al 1998 molotch and margulis 2008 only covers the snowmelt season and needs further development for real time applications gridded swe at a fine spatial resolution of 50 m can be estimated using periodic airborne lidar based snow depth and modeled snow density painter et al 2016 which opened opportunities for snowpack mapping and model evaluation bair et al 2016 oaida et al 2019 pflug and lundquist 2020 yang et al 2022 zheng et al 2018 for basin scale swe estimation with limited ground swe measurements ensemble optimal interpolation can be used together with historical lidar derived swe maps as a stationary background malek et al 2020 limiting its ability to represent swe changes imposed by extreme warm or snow storms on the other side physically based snow models have been developed based on theoretical understanding from observations and experiments the models can simulate swe changes at fine spatial and temporal resolutions barrett 2003 marks et al 1999 for accurate predictions snow models require correct initial conditions and meteorological forcing data e g precipitation and air temperature with uncertainties primarily from input data parameterization and deficiency in model structure bair et al 2018 baldo and margulis 2017 lv et al 2019 magnusson et al 2014 mortimer et al 2020 deep learning has recently emerged as a powerful modeling tool to capture complex processes in hydrology kratzert et al 2019 shen et al 2018 without explicit knowledge of physical processes and strong structural assumptions deep learning models use an interconnected network of neurons to directly learn dynamic responses from extensive data schmidhuber 2015 and thus are less affected by structural deficiencies appearing in physically based models feng et al 2020 shen 2018 as a type of recurrent neural network the long short term memory lstm model can memorize system internal states capturing long term dependencies between input and output hochreiter and schmidhuber 1997 lstm modeling has been widely applied to predict time series data with remarkable success particularly for rainfall runoff processes with promising performance compared to physically based models chen et al 2020 cui et al 2022a feng et al 2020 frame et al 2021 gauch et al 2021 kratzert et al 2021 zhang et al 2018 snowpack is highly temporally autocorrelated and hence naturally has a long memory fiddes et al 2019 which can be taken advantage of by the lstm model yet the unique potential for swe prediction using state of the art lstm modeling has not been explored data assimilation is commonly applied in physically based hydrologic modeling for better forecasts clark et al 2008 cluzet et al 2021 liu and gupta 2007 magnusson et al 2014 saloranta 2016 that is using recent observations to update model state or output and to correct erroneous model trajectories caused by model deficiencies to improve the predictive ability of snow models different techniques are applied to assimilate ground swe measurements lidar snow data and remote sensing snow cover data for example the operational snow data assimilation system snodas uses a nudging procedure to assimilate the spatially interpolated differences between observed snow values and estimates from a mass and energy balance model barrett 2003 i e bias correct model estimates toward observations boni et al 2010 the swe reanalysis data for california s sierra nevada were generated using a bayesian framework to assimilate remote sensing based fractional snow cover data into a snow model margulis et al 2019 2016 direct insertion of lidar derived snow depth data into a distributed physically based isnobal model can improve snow simulation hedrick et al 2018 considering the snowpack s nature of high temporal autocorrelation and spatial heterogeneity it is worth exploiting whether there is a great potential for leveraging recent snow observations to improve deep learning based snow estimates in this study we developed and tested a framework that couples a deep learning based lstm model and snow observation assimilation for daily swe mapping and forecasting which are important to seasonal water supply short term runoff forecasting and flood control our specific aims were to i evaluate whether an lstm model without using ground observations can adequately estimate swe ii develop a nudging approach accounting for different characteristics in snow zones to efficiently assimilate real time snow observations into the lstm model and evaluate its performance compared to the commonly used inverse distance weighting bias correction and iii investigate whether the lstm model with assimilation is sensitive to meteorological forcing inputs weather forecasts versus observation based datasets and different assimilation frequencies daily versus monthly here we hypothesized that frequent assimilation of available snow observations accounting for zonal snow differences can improve deep learning based basin scale swe estimates 2 data and methods this study focuses on swe mapping in a domain in northern california s sierra nevada with dense ground snow observations fig 1 to develop and demonstrate a framework consisting of a deep learning based model and data assimilation fig 2 this section describes ground snow observations gridded snow datasets and remote sensing data used in the framework an lstm model was trained to predict initial swe maps with the inputs of dynamic forcing landscape attributes and lagged snow observations we then propose an assimilation approach based on inverse distance weighting with the considerations of snow zone differences to bias correct the initial lstm estimates toward ground snow observations after filtering the swe estimates using snow cover data final swe estimates were integrated into the lstm model as inputs for next time step calculation 2 1 study area and data our study domain includes three basins in northern california s sierra nevada fig 1 the feather yuba bear and american river basins each providing major water resources for municipal water supplies downstream agriculture and aquatic ecosystems the domain has a typical mediterranean climate which is characterized by wet winters and early springs and little precipitation during summer winter seasonal snowpack provides water resources throughout the drier summer dams and reservoirs at lake oroville bullards bar and folsom lake are critical for flood control and power generation for the sacramento area carter et al 2006 the feather basin has an area of 9430 km2 above oroville dam the western side of the feather basin receives significantly more precipitation than its eastern rain shadowed area due to its complex topography with mixed arrangements of ridges and valleys freeman 2011 water from the yuba bear river basin 4400 km2 joins the feather river the largest tributary of the sacramento river the largest river in california as the second largest tributary to the sacramento river the american river has a drainage area of 4770 km2 specifically for the purpose of snowpack mapping and forecasting this study focused on seasonally snow covered areas of the domain fig 3 a i e the areas with elevations above an average snow line of 1500 m cui et al 2020 huning and aghakouchak 2020 margulis et al 2016 welch et al 2013 wrzesien et al 2017 three sources of in situ swe observations were used as ground truth fig 1 first was daily automatic swe data from the operational snow pillow network 27 sites table s1 with real time data hosted by the california data exchange center cdec http cdec water ca gov second was monthly manual snow courses 70 sites conducted on the first day during january june from cdec third was daily swe values estimated using snow depth observations by a research wireless sensor network wsn 7 sites in table s1 data available at https doi org 10 6071 m39q2v in the american river basin and basin averaged snow density cui et al 2022b zhang et al 2017a note that 10 snow depth sensors were distributed within 1 km2 at each wsn site to capture snow variability caused by landscape attributes welch et al 2013 zhang et al 2017b and their averaged values at each site were used since this study estimated swe of the three basins at 1 km2 grids all collected swe observations were quality controlled to remove out of range values cui et al 2022b three gridded snow products were used to develop and evaluate a deep learning based model first was daily swe reanalysis data for the sierra nevada above 1500 m elevation during water years wy october 1 september 30 1985 2016 available at https ucla app box com v swe reanalysis the swe reanalysis data at a spatial resolution of 90 m were generated by a bayesian data assimilation framework to constrain and update a snow model using landsat snow cover data huning and margulis 2018 margulis et al 2016 evaluation using independent ground snow observations i e not used in the assimilation procedure of the swe reanalysis showed that the reanalysis data had a mean swe bias of 30 mm and a correlation 0 95 with observations over the sierra nevada margulis et al 2016 second was daily operational swe products from snodas nohrsc 2004 https nsidc org data g02158 at 1 km resolution during wy2007 2019 the snodas products assimilate observations from satellite snow cover airborne measurements and ground stations e g snow pillows and snow courses by spatial interpolation of differences between observations and estimates from a mass and energy balance snow model barrett 2003 carroll et al 2001 while the widely used snodas swe product is not the ground truth it often serves as a useful benchmark for assessing other modeled estimates broxton et al 2016 cho and jacobs 2020 wrzesien et al 2017 for this study the swe reanalysis data were aggregated to 1 km resolution the same resolution as used in the snodas product third was the remotely sensed fractional snow covered area from modis metsämäki et al 2015 nagler et al 2021 https catalogue ceda ac uk uuid ef8eb5ff84994f2ca416dbb2df7f72c7 the daily fractional snow covered area data 0 100 were resampled to the same resolution as the two snow products above using the nearest neighbor method this study included two different daily meteorological forcing datasets to investigate their influences on our swe estimates first was observation based precipitation and temperature data from the parameter elevation relationships on independent slopes model prism https prism oregonstate edu which are actively used as inputs for hydrologic modeling prism data are interpolated based on a climate elevation regression using ground measurements from nearly 13 000 stations for precipitation and 10 000 stations for temperature daly et al 2008 the original prism data at an 800 m resolution were aggregated to the same resolution as the snow products second was weather forecast data from the california nevada river forecast center cnrfc https www cnrfc noaa gov daily quantitative precipitation forecasts qpf and temperature forecasts at 1 day lead time with a spatial resolution of 4 km for wy2012 2019 were collected and then bilinearly interpolated to the same resolution as gridded snow products for this study we augmented our precipitation event based snowmelt runoff analyses using the snow level data from two frequency modulated continuous wave fmcw radars in the study area one is located at oroville 39 532 n 121 488 w 114 m elevation in the feather and the other is located at colfax 39 080 n 120 938 w 644 m elevation in the american fig 1 the radar snow level indicates the elevation at which the probability of precipitation falling as snow is 50 johnston et al 2017 white et al 2010 i e precipitation at elevations above the rain snow transition level is mainly in the form of snow these operational radars provide near real time atmospheric snow level information 10 min resolution from https psl noaa gov data obs data which is valuable for estimating ground precipitation phase i e rain versus snow cui et al 2020 we used the mean values of the two radars as the snow level data for the three basins in our study area and averaged them to hourly and daily resolutions 2 2 deep learning based swe model with zonal bias correction our snow mapping and forecasting framework fig 2 contains two main components i e an lstm model and a zonal inverse distance weighting idw bias correction which are described below 2 2 1 lstm model for initial snow estimates we developed an lstm model to provide initial swe estimates at each 1 km pixel of the three basins the lstm model can learn long term or short term dependencies from sequential data by using recurrently connected memory cells to store and process sequential information hochreiter and schmidhuber 1997 at each time step a series of information gates i e input gate forget gate and output gate controls the information flow of cell state and hidden state fig s1 the hidden state at the last time step t was connected to a dense layer followed by a dropout layer to predict the target variable at step t which was swe t in our case mathematical details about the lstm model can be found in text s1 the lstm model inputs at each daily time step t included dynamic meteorological forcing data precipitation and temperature at day t and seven static landscape attributes for each pixel precipitation and temperature are the primary drivers of daily swe change nedelcev and jenicek 2021 sospedra alfonso and merryfield 2017 e g swe increment due to snowfall is primarily affected by both precipitation and temperature and snowmelt can also be classically estimated using temperature as a key indicator the seven static landscape attributes are elevation slope aspect latitude and longitude from the national elevation dataset gesch et al 2018 and canopy cover from the national land cover database dewitz 2019 as these attributes affect snow accumulation and ablation zheng et al 2018 e g elevation is highly correlated with air pressure which affects rain snow partitioning dai 2008 latitude slope and aspect affect solar radiation tian et al 2001 which is a main variable for snowmelt prediction bouamri et al 2018 additionally a one day lagged swe value antecedent swe at one day prior i e swe t 1 was integrated as one input feature to assist the lstm model in better learning snow evolution according to recent snow conditions the target variable is swe t from the daily gridded swe estimates at 1 km resolution using the snow reanalysis product margulis et al 2016 here the process model based swe product instead of ground swe measurements was used for training the lstm model because of the more comprehensive spatial coverage of reanalysis data a total of 10 735 1 km pixels above 1500 m elevation versus the limited continuous ground based swe measurements 34 snow pillow and wsn sites considering the uncertainty of precipitation measurements from relatively sparse gauges at higher elevations in snow covered mountains cui et al 2022b rasmussen et al 2012 the lstm model was trained using precipitation and temperature forcing inputs from prism which also made use of snow course measurements for precipitation interpolation henn et al 2015 we trained the lstm model with sequential data with a length of 7 days meaning that input data from day t 6 to t were used to predict swe at target day t in this study a 7 day sequence length was used taking into account that a 7 day data can sufficiently reflect snow changes that are driven mainly by recent temperature and precipitation and b for investigating snowmelt driven extreme events a 7 day duration was used considering the response time of streamflow to precipitation and persistence days of snowmelt related flood events cho et al 2021 all input data were standardized by subtracting their mean and dividing by their standard deviation the hidden units of both the lstm layer and dense layer were 200 and a dropout rate was 0 25 cui et al 2022a using the keras deep learning package gulli and pal 2017 the lstm model was optimized by the adam algorithm with a loss function of mean squared error and an initial learning rate of 0 001 for the 31 year swe data at a total of 10 735 pixels 68 wy1985 2006 16 wy2007 2011 and 16 wy2012 2016 were split and used as training validation and testing periods respectively the trained lstm model can be seen as a surrogate snow model learned from the snow reanalysis data providing initial swe estimates in response to recent meteorological and snow conditions 2 2 2 zonal idw bias correction assimilating ground observations to assimilate snow observations we proposed a bias correction approach based on zonal inverse distance weighting idw to nudge initial lstm swe estimates i e background estimates toward ground swe observations the original idw is often used to correct background model estimates using observations such as snodas barrett 2003 and in a snow depth study by boni et al 2010 the core task of bias correction is to spatially interpolate point scale residuals which in our case are the swe residuals denoted as ri mm between a ground observation at any site i and the initial lstm swe estimate at the grid point that includes the observation site for any grid pixel j its euclidean distance dj i m to observation site i is expressed as 1 d j i x j x i 2 y j y i 2 α h j h i 2 where x and y m are the two utm universal transverse mercator coordinates h is the elevation m factor α adds more weight 5000 to elevational distance versus horizontal distance barrett 2003 foppa et al 2007 magnusson et al 2014 since snow shows stronger variability along elevational than horizontal distance the original idw determines a set of weights u j i unitless based on inverse distance squared weights between grid j and a total of n ground sites used for assimilation 2 u j i 1 d j i 2 i 1 n 1 d j i 2 if using the original idw for bias correction the swe bias at any pixel is interpolated using the original idw weights u j i multiplied by residuals at all sites ri mm however snow exhibits strong heterogeneity in complex mountain terrain which is not fully accounted for in the original idw for example the eastern rain shadow area in the feather river basin receives significantly less precipitation than does the western windward side freeman 2011 malek et al 2019 resulting in relatively lower snow storage which cannot be explicitly explained by either horizontal or elevational distance hence we proposed a zonal distance to enable the idw weights to represent spatial snow heterogeneity based on historical snow pattern information first our study areas were divided into five different snow zones fig 3a determined by a gaussian mixture model oroza et al 2016 using normal april 1st snowpack amount i e the average reanalysis swe on april 1st during wy1985 2016 the normal swe amount increases gradually from zone 1 to 5 fig 3b zone 1 in the american river basin is mainly in lower elevations with less orographic precipitation meanwhile zone 1 includes the eastern rain shadow area in the feather river basin the areas at higher elevations with large precipitation were included in zone 5 which has the largest snowpack considering different snow characteristics across snow zones we then defined the zonal distance zj i between grid j and observation site i based on the absolute difference of their zone numbers z with a range of 1 5 3 z j i z j z i 1 the zonal distance was used to assign greater weights to the sites in closer snow zones that share more similarities in snow characteristics thus the final zonal idw weights wj were calculated by normalizing the original idw weight with zonal distance 4 w j i u j i z j i p i 1 n u j i z j i p where p is a decay factor to lower the influence of sites with larger zonal distances to grid j in other words a larger value of p means assigning a larger weight of sites in the same snow zone we set p as 5 for this study after several trials therefore the swe residual at any grid pixel j rj mm is interpolated using zonal idw weights and bias ri mm at all sites used for assimilation fig 3a 5 r j i 1 n w j i r i a daily bias corrected swe map was calculated as the summation of the zonal idw swe residual map and the initial lstm map such that the lstm estimates were nudged to ground snow observations afterward the bias corrected swe map was further filtered using the modis fractional snow cover area data to obtain final gridded daily swe estimates so that swe at pixels without snow cover 0 fractional snow cover area was set to 0 mm note that as depicted in fig 2 the final daily swe estimates were integrated as updated the antecedent swe of lstm model inputs for the initial swe mapping at the next time step our proposed modeling approach was implemented using the python programming language version 3 7 van rossum and drake 2009 and libraries including keras chollet et al 2015 scikit learn pedregosa et al 2011 numpy harris et al 2020 h5py collette et al 2022 pandas the pandas development team 2022 gdal ogr gdal ogr contributors 2022 and pyproj snow et al 2022 2 3 modeling experiments and evaluation a series of modeling experiments table 1 were designed to investigate the swe prediction performance of the deep learning lstm model and the potential improvement from the zonal idw bias correction the training experiment expt 1 with prism forcing demonstrated the prediction ability of the lstm only model with ideal reanalysis data as antecedent lagged data since the reanalysis data are not available for real time swe mapping expt 2 integrated continuous swe estimates from the lstm only model as antecedent snow data to indicate the extent to which modeled swe bias would accumulate in the projection mode without any bias correction in comparison to expt 1 by adding daily bias corrections using the ground swe observations from snow pillows the wireless sensor network and snow courses expt 3 and 4 were designed to investigate the estimation difference between the original idw lstm idw and the proposed zonal idw lstm zonal idw and the performance improvement from bias correction compared to expt 2 for possible swe forecasting expt 5 used the lstm idw with one day leading weather forecast data from cnrfc which was different from all other experiments forced by observation based prism data to investigate the impact of bias correction frequency on swe estimates expt 6 was set similar to expt 4 except that only a monthly bias correction was applied using snow course observations to perform intercomparisons of results from the above mentioned experiments we evaluated swe estimates with metrics at three different scales i e point basin and map monthly swe observations at 28 snow course sites denoted as evaluation sites in table s1 and fig 3a were used to calculate the mean and standard deviation of their differences to modeled swe at corresponding grids this point scale evaluation was used to assess model performance at sites that were not used for bias correction at a basin scale the time series of average swe estimates across all areas above 1500 m elevation were compared against the average swe observations from all ground sites using the nash sutcliffe efficiency coefficient nse ranging from to 1 with 1 denoting a perfect model ritter and muñoz carpena 2013 at a detailed map scale the spatial swe map of 1 km resolution we compared different swe estimates using the structural similarity index ssim which was originally proposed for image comparison wang et al 2004 and further applied in spatial data jones et al 2016 the ssim is a single value metric that combines three local similarities in terms of the mean variance and spatial covariance between two swe maps using a spatially moving window 3 3 gird mathematical details about the ssim can be found in text s2 and jones et al 2016 simply put the ssim has a range from 1 to 1 with 1 indicating that the two maps are identical and with 1 showing complete dissimilarity of map spatial structure using this overall metric for map comparison the spatial differences of modeled swe estimates can be explicitly evaluated we also investigated snowmelt related runoff in the three basins for precipitation events in wy2007 2019 using our best daily swe products from the above modeling experiments to identify a precipitation event we first selected all precipitation days defined as the days with basin averaged prism precipitation 0 254 mm i e the measurable precipitation 0 01 in defined by the national weather service following sumargo et al 2020 and cui et al 2022b then a precipitation event was determined as the consecutive precipitation days with cumulative precipitation 20 mm cui et al 2022b for the determined 170 precipitation events e g the top 20 events in table s2 we further classified them into three types according to their mean radar snow level cold events dominated by snowfall 50 snow level during the event is lower than the 1500 m lowest elevation in our study domain derived from 1 km dem data mixed phased events dominated by rain snow mixed precipitation 50 snow level in between the lowest 1500 m and highest 2880 m elevations and warm events dominated by rainfall 50 snow level higher than 2880 m highest elevation for each precipitation day runoff potential rp mm quantifies the available water contributing to runoff processes and floods based on the snowpack mass balance cho et al 2021 yan et al 2018 runoff potential can be calculated using precipitation p mm and daily swe change δswe mm positive values for increasing swe which is rp p δ s w e the runoff ratio c unitless is defined as the ratio of runoff potential to precipitation c rp p 1 δ s w e p therefore for snowmelt related runoff e g rain on snow runoff potential includes additional water from melting snow resulting in runoff ratio c 1 3 results 3 1 performance of lstm model in this training experiment expt 1 the lstm model showed a good swe predictability compared to swe reanalysis data used as training targets fig 4 the average swe in the three basins fluctuated during wy1985 2016 fig 4c with peak snow occurring in wy1993 and lowest snow in warm wy2015 in response to precipitation and temperature fig 4a b the nses of basin averaged swe for the training validation and testing periods were all 0 99 indicating that the lstm model successfully estimated snowpack storage in mountains and captured temporary changes the pixel level comparison for the testing period fig 4d reveals that the lstm model predicted swe was in good agreement with snow reanalysis with a coefficient of determination r2 of 0 99 and root mean square error rmse of 5 85 mm table 2 pixel level swe differences were evenly spread out from the mean of 0 30 mm fig 4e showing that the estimates from the lstm model were generally small and unbiased it should be noted that in this training experiment the lstm model used the swe reanalysis data as its antecedent lagged snow condition meaning that potential estimation biases were somewhat corrected by integrating the lagged reanalysis swe data 3 2 comparison across modeling experiments 3 2 1 swe estimates from different experiments for swe mapping applications in projection mode the lstm model iteratively used its predictions as lagged swe conditions without bias correction expt 2 this differed from the training mode expt 1 where lagged swe conditions were from swe reanalysis data not readily available in near real time the lstm in the projection model expt 2 underestimated basin average and site scale swe compared to estimates based on ground observations fig 5 a and table 3 the underestimations in the projection model expt 2 were more noticeable than the lstm in training mode expt 1 and the swe reanalysis dataset as also shown in fig s2 although the swe reanalysis dataset showed underestimation table 3 the projection model without bias correction further underestimated swe compared to its training swe reanalysis dataset site scale evaluation demonstrated that the negative bias in the projection model accumulated and was substantially lower than in the swe reanalysis the bias accumulation is more notable during wet years e g wy2011 in fig s2b therefore bias accumulation contributes most to swe underestimation in the lstm projection mode though the relatively slight underestimation in the trained lstm model is inherited from the underestimation bias of the training swe reanalysis dataset this suggests that bias correction by assimilating ground observations is needed by applying bias corrections based on the original idw expt 3 and the zonal idw expt 4 the nses of basin scale swe estimates were significantly improved to 0 886 and 0 787 respectively compared to 0 193 from expt 2 note that the basin scale swe estimates from observations represented an upper limit since ground observation sites were often placed in relatively snow rich areas hence all modeled basin scale swe estimates showed negative mean differences meaning that these estimates were lower than the average of ground observations table 3 of note the computational cost of our modeling approaches is not an issue for general applications e g for each daily timestep in expt 4 it takes 2 8 s to perform swe mapping over our study area using a computer with an intel r xeon r platinum 8268 2 90 ghz cpu evaluation at the site scale shows that lstm models with bias correction expt 3 and 4 slightly overestimated swe but with lower absolute differences compared to other experiments fig 5b and table 3 the swe differences were more noticeable during wet years e g 2010 and 2011 than dry years e g 2014 2015 the swe reanalysis showed a larger underestimation mean site scale swe difference of 65 mm than snodas 41 mm since snodas assimilated ground observations while the reanalysis dataset did not although the lstm model with the original idw bias correction expt 3 had the highest nse table 3 it tended to overestimate swe more 34 mm and had a wider spread of bias a standard deviation of 43 mm than that with the zonal idw expt 4 a mean bias of 20 mm and a standard deviation of 37 mm this may be due to the fact that bias correction with the original idw does not account for characteristics at different snow zones showing an inferior performance than that using the zonal idw which is further investigated at a spatial map scale in the following section 3 2 2 comparison between zonal idw and original idw bias correction taking a high snowpack day on april 1 2011 as an example the swe estimates from both lstm models with the original idw and zonal idw bias corrections showed larger snowpack on the western windward side and high elevations of the three basins fig 6 a b however the model with the original idw correction estimated a higher basin averaged swe 1200 mm than that with zonal idw 1010 mm the overestimation was noticeable in areas with lower swe estimates from the model with zonal idw correction fig 6c at the map scale the areas with larger differences were mainly located in the eastern rain shadow of the feather river basin fig 6d indicated by relatively lower similarity smaller ssim the similarity of swe estimates between lstm models with the original idw expt 3 and the zonal idw bias correction expt 4 was higher during water years with less snow wy2014 and 2015 in fig s3a indicating that the two different bias correction approaches have smaller differences during dry years the mean ssim on the first day of january may during wy2007 2016 was again relatively lower in the rain shadow areas of the feather river basin fig s3b thus the ssim in snow zone 1 of which a great portion is in rain shadow areas was lower than in other snow zones fig s3c for zone 5 with the largest historical snowpack the similarity between the two estimates was relatively lower than those in zones 2 3 and 4 highlighting that the two bias correction approaches have greater differences in snow richer areas we further evaluated swe estimates from the two bias correction approaches using ground snow observations for six sites in the low ssim rain shadow area fig 7 the lstm model with the original idw bias correction showed the largest mean bias of 67 mm compared to 15 mm from that with zonal idw correction and 3 mm from snodas fig 7a note that snodas products may assimilate the observations for six evaluation sites thus showing the lowest mean bias using the student s t test we observed that the swe bias from the zonal idw correction shows significantly lower values than that from the original idw correction one tailed p value of 2 3 10 8 while no statistically significant difference to that from snodas two tailed p value of 0 12 in terms of bias variabilities denoted by standard deviation the lstm model with the zonal idw showed a statistically significant one tailed p values 0 003 lower value mean of 42 mm than snodas 74 mm and the lstm model with the original idw bias correction 78 mm overall the proposal zonal idw showed better swe bias correction results than the original idw approach which does not account for snow differences across snow zones leading to a larger snowpack overestimation 3 2 3 bias distribution across snow zones the swe residual from the zonal idw bias correction showed spatial variability across the three basins fig s4a the eastern rain shadow areas in the feather river basin had negative swe residuals meaning that the initial swe estimates from the lstm model tend to overestimate swe compared to ground observations positive swe residuals were typically shown in the western windward side of three basins where snowpack generally increases with elevation due to lower temperatures and orographic enhancement of precipitation swe residuals also increased along snow zones with larger historical snowpack with median values from 0 4 to 1 2 mm across five snow zones fig s4b the positive swe residuals across zones 2 5 indicate that the lstm model initially underestimated swe in comparison to ground swe observations 3 3 modeling with different forcing inputs and bias correction frequencies to forecast snowpack in the near future weather forecast meteorological data can be used as model forcing inputs as for applications in observation sparse mountain regions daily ground snow observation may not be available for bias correction thus we further investigated swe estimates from the lstm model with zonal idw bias correction with different forcing inputs expt 5 and bias correction frequencies expt 6 3 3 1 forecasts versus observation based forcing inputs the basin scale swe estimates from the model with precipitation and temperature forcing from cnrfc 1 day forecasts agreed with those from the model with observation based prism forcing data fig 8 a the nse between the model results using prism and the averaged swe from ground observations was 0 82 slightly 0 81 from the model with forecast forcing compared to site scale snow courses the model with forecast forcing showed a larger overestimation a mean bias of 11 mm than that 6 mm with prism forcing fig 8b it is worth noting that there were differences between the forecasts and prism forcing data fig s5a b the mean precipitation ssim was 0 81 while larger dissimilarity was shown in high elevation windward areas daily precipitation forecasts during wy2014 2019 averaged 0 02 mm larger than prism with a standard deviation of 2 2 mm the mean temperature ssim was 0 33 indicating that their temperature differences were more notable than precipitation differences daily temperature forecasts averaged 0 11 c lower than prism with a standard deviation of 3 99 c the higher precipitation and cooler temperature from the forecast data resulted in the slightly larger swe overestimation the mean ssim of swe estimates was 0 82 fig s5c with lower values in snow zones with historically larger snowpacks fig s5d reflecting a larger difference in swe estimates caused by the forcing data difference in high elevations overall the bias correction approach nudged initial swe estimates toward ground snow observation making final swe estimates generally not sensitive to the difference in meteorological forcings 3 3 2 daily versus monthly bias correction integrating snow observations at a monthly frequency significantly improved the nse to 0 770 from 0 190 compared to the projection lstm without bias correction fig s6a although the value was smaller than the 0 798 from the model with a daily bias correction a site scale comparison shows that the monthly bias correction had a larger standard deviation 51 mm of bias than did the daily bias correction 37 mm though both yielded a similar mean bias of 18 mm fig s6b the most negative bias 252 mm for monthly bias correction appeared on june 1 2011 shown by comparing to observations from two available snow courses on that day observations from only seven snow courses were used for monthly bias correction which was much fewer than a total of 25 ground observations snow courses plus pillows used for daily bias correction as expected integrating more information from all available ground sites across the three basins can reduce estimation bias on a map scale the ssim on the first day of each month i e the day when monthly correction was applied between estimates from daily and monthly correction was 0 717 larger than a mean ssim of 0 532 for the 15th day of each month fig 9 a b the larger dissimilarity on the 15th day the middle between two monthly correction days indicates that snow difference was more noticeable during the periods without bias correction as model bias accumulated this is further evidenced by the more noticeable bias and larger rmse during mid and late parts of snow accumulation months compared to the first day of each month fig s7a b again the similarity of swe estimation tended to be lower in snow zones at higher elevations with larger snowpacks fig 9c d the southeastern part of our study domain exhibited a low similarity likely due to the fact that the dense swe measurements from snow pillows and the wireless sensor network were used in the daily bias correction while not used in the monthly correction 3 4 snowmelt related runoff two extreme precipitation events fig 10 out of total 170 events are used to illustrate basin averaged swe and runoff potential estimated using the lstm model with daily zonal idw bias correction of note our study area has a mediterranean climate with wet winters and dry summers meaning that warm precipitation events classified in this study often occur in dry summers with small precipitation totals fig s8 the two illustrative events had mean daily precipitation intensity 30 mm d 1 table s2 one is a mixed phased event on february 1 11 2017 cumulative prism precipitation ranked 2nd highest of the 170 events table s2 and the other is a cold event on february 12 18 2019 ranked 13th for the mixed phased event fig 10a f radar snow level averaged 1950 m before feb 7 however the snow level elevated to around 2540 m on feb 7 9 fig 10a due to an atmospheric river transporting intense moisture flux to the mountain cui et al 2022b resulting in warmer temperatures fig 10b large precipitation fig 10c during this precipitation period the decrease of basin averaged swe from the observations and models fig 10d and the negative swe changes fig 10e in particular those from ground observations often located in higher elevation snow rich areas indicate the occurrence of rain on snow contributing additional snowmelt to potential runoff fig 10f for which a detailed investigation can be found in henn et al 2020 daily swe did not show noticeable differences between the modeling results using prism and cnrfc forecasts their differences in runoff potential are mainly contributed by the differences in precipitation amount both model results using prism and cnrfc forecasts indicate a runoff ratio 1 1 for this event reflecting the additional snowmelt runoff from rain on snow during the other cold event fig 10g l 58 of snow level observations were below the lowest 1500 m elevation of our study domain a portion of precipitation fell as solid precipitation and continuously increased basin averaged swe resulting in a runoff ratio of 0 4 for this cold event for a total of 982 precipitation days during the 170 events we observed close relationships between temperature snowmelt runoff and radar snow level fig 11 the frequency of snowmelt runoff i e runoff ratio 1 is positively correlated to daily temperature fig 11a following the sigmoidal curve often used for describing the relationship between temperature and snowfall frequency dai 2008 jennings et al 2018 we observed that the frequency of snowmelt runoff per 1 c temperature bin is well explained r2 0 93 by a hyperbolic tangent function freq 0 484 t a n h 0 116 t 4 884 1 165 which suggests a 50 snowmelt runoff temperature at 3 7 c meanwhile temperature linearly correlates with daily radar snow level fig 11b we fitted the data using the huber regression huber 1973 which is robust to outliers that may exist in radar data cui et al 2020 minder and kingsmill 2013 osborne et al 2021 after removing 66 outliers 10 of radar data identified by the huber regression the fitted equation snowlevel 125 69 t 1573 explains 81 of the variance of daily snow level data the 50 snowmelt runoff temperature at 3 7 c corresponds to the snow level at 2040 m elevation above which there is a high chance of additional snowmelt augmenting basin scale runoff in our study domain 4 discussion 4 1 the need of assimilating snow observations into deep learning based estimates in this snowpack mapping and forecasting study the deep learning lstm model alone does not provide satisfactory estimates owing to bias accumulating during the projection period even though the lstm model in a training mode performs well the good performance in the training mode indicates that the lstm model has learned snow dynamics reflected in the training data attention should be paid to applying the deep learning lstm model for projection i e open loop simulation iteratively uses modeled swe estimates as antecedent condition inputs as model bias gradually accumulates leading to swe underestimations in the peak snow season which is more noticeable during wet years than during dry years the deep learning model s capability for snowpack projection needs to be carefully evaluated before putting into practice antecedent lagged swe conditions play an important role in simulating swe changes in response to meteorological forcing this is attributed to the reasonable predictive ability in the training mode which integrates swe reanalysis data as antecedent conditions updating final bias corrected swe estimates as antecedent lagged swe observations helps the lstm model perform projections based on more accurate recent snow conditions this is consistent with the finding in a streamflow forecast study using an lstm model feng et al 2020 showing that directly integrating one day lagged observations into model inputs can strongly improve forecasts compared to model results without using recent observations as inputs for mountain regions with seasonal snowfall the important precipitation forcing data have uncertainties since gauge measurements are spatially limited and associated with high uncertainty often underestimated during snowfall cui et al 2022b rasmussen et al 2012 the precipitation uncertainties propagate to the swe projection bias through modeling abbasnezhadi et al 2021 reported that assimilation of snow data can add valuable information that is not readily available from sparse precipitation gauges and hence significantly improves streamflow estimation our study demonstrated that the lstm model showed larger initial swe underestimations in higher elevation snow richer areas fig s3 coincident with the potential precipitation underestimations from gauge based data in higher elevations cui et al 2022b further precipitation differences between weather forecasts and gauge based datasets are relatively large at higher elevations contributing to larger differences in snow richer areas ground snow observations considered more reliable than precipitation measurements at higher elevations during snowfall periods lundquist et al 2019 can effectively bias correct initial swe estimates from the deep learning model as demonstrated by bias correction methods using either the original idw or the new proposed zonal idw for snowpack forecasting using the framework lstm model with zonal idw bias correction the swe estimates forced by one day leading weather forecasts are comparable to those forced by observation based prism data this indicates that the framework is not sensitive to the differences in forcing data since the bias correction procedure continuously nudges model estimates back to a right trajectory although there are considerable dissimilarities between weather forecasts and observations during high flood risk seasons these snowpack forecasts driven by weather forecasts can be used to estimate snowpack storage and potential snowmelt that may significantly contribute to extreme runoff providing important information for flood control plans and reservoir management 4 2 historical snow pattern information improves bias correlation the proposed zonal idw bias correction used the zonal distance to account for the snow difference in mountains based on the historical snow pattern information snow heterogeneity from a reanalysis dataset in complex terrain like our study domain that includes large rain shadow areas snowpack differences cannot be well explained by either horizontal or elevational distances this explains why the zonal idw bias correction embedding historical snow pattern difference across the three basins showed better performance than the original idw bias correction particularly in the rain shadow areas previous studies also suggested that historical snow pattern information is useful for swe prediction for example pflug and lundquist 2020 inferred snow depth in california s tuolumne watershed from lidar data only covering a small portion of the domain based on snow pattern repeatability building on the inter annual consistency of snow distribution a nearest neighbor technique was applied to find the closed historical lidar derived swe that best fits current snow conditions observed by a significant amount of hypothetically placed wireless sensor networks zheng et al 2018 a number of machine learning based studies have reported that historical snow pattern i e climatological swe is one of the most informative predictors for swe estimation bair et al 2018 schneider and molotch 2016 yang et al 2022 thus it is suggested to use historical snow pattern information e g zonal idw method to help bias correct the initial swe estimates from either physically based or deep learning based models 4 3 broader and more frequent observations for assimilation applications this study demonstrates that assimilating broader and more frequent observations can improve swe estimates through the comparison between daily and monthly bias corrections we observed that even assimilating snow course only observations at a longer monthly frequency can substantially improve swe estimates suggesting that any available ground observation in data sparse regions could be used to improve model estimates increasing bias correction frequency to one day and integrating extra snow observations from snow pillows and wireless sensor network into the framework can further improve snowpack mapping other valuable snowpack observations from novel techniques whenever available can be leveraged to improve and nudge model prediction toward observations complementing the ground snow observations from operational networks for example the periodic airborne lidar can provide basin scale swe at a fine resolution of 50 m painter et al 2016 which can be directly assimilated into model simulations hedrick et al 2018 crowd sourced snow measurements collected by citizen scientists e g recreational users and snow enthusiasts in relatively undersampled high mountain areas can be used in data assimilation to improve model estimates crumley et al 2021 for fine scale e g 1 km swe estimation the spatially distributed clusters of more than ten wireless sensor nodes within 1 km2 across headwater basins cui et al 2022b welch et al 2013 zhang et al 2017a b can provide on the ground information on snow variability caused by local landscape attributes in terms of spatial and temporal coverages plus coarse and fine scale heterogeneities all these snow observations have their unique potential to improve model based swe estimates 4 4 machine learning methods for snow mapping this study demonstrated the potential of the deep learning lstm model in snow mapping which is one of many machine learning applications for swe estimation for example linear regression models explicitly explain the importance of historical snow patterns snow cover data physiographic information and vegetation variable fassnacht et al 2003 schneider and molotch 2016 yang et al 2022 which are all used in our proposed approach given the nonlinearity of snow spatial distribution tree based regression models are used to capture the non linear relationships between predictor variables and swe bair et al 2018 elder et al 1998 molotch et al 2005 revuelto et al 2020 yang et al 2019 zhang et al 2021 another non linear method is based on neural networks e g the conventional feed forward neural network i e artificial neural network ann has become popular for estimating snow information bair et al 2018 broxton et al 2019 ghanjkhanlo et al 2020 ntokas et al 2021 tedesco et al 2004 compared to conventional neural networks deep learning models which consisted of more hidden layers and a more complex structure have better generalization performance and stronger nonlinear expressiveness capability shen 2018 wang et al 2020 yuan et al 2020 deep learning models showed good performance in snow related studies e g the applications of deep belief network dbn in satellite retrieved snow depth wang et al 2020 yet deep learning has rarely been applied to swe mapping the lstm model explored in this study accounts for the temporal autocorrelation memory of swe showing a promising short term prediction ability figs 4 and 8 however as discussed in section 4 1 above the lstm model relies on antecedent swe conditions which are often not available in near real time point ground swe measurements or other available near real time data e g lestak 2022 can be used to improve lstm predictions through the proposed bias correction approach there is still room for reducing the lstm model s reliance on antecedent snow conditions for example it is worth investigating the physics informed hybrid lstm model in future snow studies since hybrid models that combine hydrological process understanding with deep learning models have shown their potential in further improving streamflow prediction frame et al 2021 lu et al 2021 the approach proposed in this study can be transferred to other regions on the one hand though regionally specific swe reanalysis data were used to train the lstm model and determine the interpolation snow zones for our study domain in california s sierra nevada any available high quality swe reanalysis could be used for applications in other regions meanwhile the method margulis et al 2016 used to generate swe reanalysis data in the sierra nevada is applicable in other regions across the world as it has been successfully implemented in the high mountain asia https doi org 10 5067 hnaugjqxscvu liu et al 2021 margulis et al 2019 on the other hand transfer learning using a deep learning model trained in data rich regions can improve streamflow prediction in data sparse regions ma et al 2021 oruche et al 2021 implying that the trained lstm snow model in our study domain with relatively rich data may be transferable to other regions which deserves further investigations of note our approach was proposed using high resolution meteorological forcing datasets derived from ground observations and has not been evaluated its applicability using coarse resolution forcing datasets e g global 0 25 0 25 data from gldas era5 5 conclusions using three seasonally snow coved basins of the northern sierra nevada as an example this study presents a framework that couples a deep learning lstm model and a zonal bias correction approach for estimating snowpack in mountain areas our proposed hypothesis was supported by comparisons to ground snow measurements at three different scales point basin and map scale across six modeling experiments showing that frequent assimilation of available snow observations accounting for zonal snow differences can improve deep learning based basin scale swe estimates in a practical context the proposed framework based on a deep learning model can simply yet effectively assimilate in situ snow observations for real time snowpack mapping and forecasting this study highlights that even when a state of the art deep learning model is applied for real time snow applications assimilating ground observations by accounting for zonal snow differences can provide unparalleled information for improving model accuracy particularly in complex terrain for regions with water resources that rely on snowmelt driven runoff snow estimates from this framework can assist forecasters and water managers in decision making regarding flood control and water supply complementing operational snow products from physical process based models for example in our study area we need to be cautious on precipitation days when temperature is above 3 7 c or snow level higher than 2040 m since basin runoff can be augmented by additional water originating from snowmelt credit authorship contribution statement guotao cui conceptualization methodology investigation visualization writing original draft writing review editing michael anderson writing review editing roger bales supervision funding acquisition conceptualization resources investigation writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was supported by the u s bureau of reclamation watersmart program sustain and manage america s resources for tomorrow the california department of water resources the uc university of california water security and sustainability research initiative grant no 13941 and the nsf major research instrumentation grant ear 1126887 we thank e bair and two anonymous reviewers for their valuable comments and constructive suggestions appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 128835 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
2569,delineating a homogeneous region is a standard procedure for rainfall frequency analysis in predicting precipitation in ungauged basins pub in vast unpopulated areas however for data about the extreme weather events measured at stations that are asymmetrically distributed the use of conventional regionalization techniques for forecasting is challenging vast depopulated zones such as high mountain catchment areas basins and swamps are rich in features that influence precipitation but they contain few stations hence data from the populated area must be used to estimate data for the unpopulated areas accordingly this study developed a novel spatial imputation approach for simulating spatial precipitation over a planar grid in this approach the markov chain random field mcrf technique is used to estimate the parameters of the stochastic process of ungauged sites at all grid points from versatile juxtapositional directions the probability learning based mcrf approach differs from most traditional interpolation approaches which may fail in unevenly distributed situations after completing the training the predicted precipitation in the mountainous areas was validated through a third party dataset despite the quality of third party data our accuracy is confirmed both in standard metric and visual inspections the normalized root mean square errors between the predicted values and the validation values were below 0 321 demonstrating that the mcrf step can effectively estimate the precipitation at unevenly distributed sites keywords extreme precipitation precipitation estimation in ungauged basins pub anti symmetric distribution markov chain random field kriging homogeneous regionalization data availability data will be made available on request 1 introduction meteorological events have conventionally been quantified using straightforward approaches the quantifications must be confined within a predefined boundary however not every region possesses sufficient historical data that can fit a presumed probability distribution bárdossy et al 2021 when the locations of the data collection stations are randomly distributed achieving a satisfactory data fit becomes more challenging a rough regionalization method is usually used to accommodate difficulties related to estimations in ungauged basins pub nevertheless regionalization becomes challenging when stations are unevenly distributed as illustrated in fig 1 even if the average density of sites in an area is sufficient weather stations are often concentrated in one place this type of distribution can be referred to as asymmetric because the plains are overpopulated with stations and the areas with more complex terrains are underpopulated suroso and bárdossy 2018 most metropolitan areas often situated on plains or estuaries have sufficient meteorological data but an excessive number of stations by contrast vast depopulated zones such as high mountain catchment areas basins and swamps are rich in meteorological features but lacking in stations accurate climate predictions are often required in these depopulated areas to support major engineering works in the past optimal approaches for defining regional boundaries in these territories were controversial grouping sparsely populated areas as one region is not acceptable nor is grouping more densely populated areas with sparsely populated areas currently shorter and longer term recurring storm events appear to occur in the same regions which might be attributed to a poor delineation of the homogeneous regions moreover increasing climate variations render statistical estimations more challenging accordingly this study develops a novel spatial imputation algorithm by converging the conditional probabilities of variograms from all locations this study reconstructs all the available spatiotemporal precipitation data on a grid structure instead of fitting a general probability distribution derived from gauged sites most geographical prediction methods such as linear mixed models are not accurate when the number of unknown points are considerably greater than the number of known data points the traditional interpolation approaches cannot tolerate a large part of missing values and therefore a reliable missing value imputation method should be applied before turning into interpolation in this paper we propose a spatial markov chain random field mcrf for imputing the geographical data before the estimation of precipitation events the mcrf approach can be adapted to a wider range of spatial distributions than can ordinary spatiotemporal decomposition approaches with a unified grid of spatiotemporal data high dimensional clustering can then be achieved 2 related works despite the initiative of the international association of hydrological sciences on regionalization methods for estimation in ungauged basins pub no consensus on estimation models has yet been reached yeo and nguyen 2016 approaches have been proposed to solve the problem primarily through assumptions or acquiring external information these proposed approaches can be divided into three categories such as kriging frequency analysis and satellites but they lack sufficient environmental determinants spatial and temporal heterogeneity a sensitive selection of covariates relevant information and contiguously identified regions zhang et al 2017 hailegeorgis and alfredsen 2017 das 2019 as far as we are aware no study has directly addressed the problem of asymmetric site distribution classic assumptions in spatial continuity may not be relevant to this situation therefore our proposed approach can solve the problem by imputing the missing information at all grid locations our mcrf approach differs from others such as self organizing maps or interpolation based kriging because it is a statistical learning method that does not require a presumed distance or anisotropic weighting regarding methods in the literature relevant to this study spatiotemporal kriging models have been proposed for simulating events related to climate change and assessing data from asymmetric sites nevertheless studies on such models have not provided congruent conclusions concerning regionalization the meteorological applications of generative adversarial networks are also under investigated goodfellow et al 2014 common methods for performing spatial prediction and simulation at ungauged sites include region of influence spatial proximity regression physical similarity and machine learning approaches du et al 2014 the data and methods usually used to construct models from gauged and ungauged sites are flawed because the quantity and reliability of the collected data are uncertain and model assumptions may be inconsistent wen et al 2017 libertino et al 2018 at a local scale region of influence approaches using index methods are recognized as the de facto standard for meteorology related analysis among grassroots engineers however different methods for the delineation of regions can produce different prediction results hailegeorgis and alfredsen 2017 das 2019 at the grid level interpolation approaches such as kriging and inverse distance weighting assume sites in spatial proximity to have similar weather conditions nevertheless additional factors such as environmental conditions and catchment attributes are seldom considered li and heap 2011 the correlation over short distances tends to be clustered for high precipitation sites suroso and bárdossy 2018 a study libertino et al 2018 reported performance benchmarks for spatial interpolation processes moreover kriging or spatial regression methods with a range of covariates has been commonly used in previous studies li and heap 2011 however model building in this context is not straightforward spatial and temporal parameters may be heterogeneous consideration of fixed and random effects is required and the distribution of residual type errors may not be gaussian varga et al 2016 das et al 2020 extreme weather events related to climate change increase the severity of problems associated with spatial variability zhang et al 2012 gummadi et al 2018 the ordinary kriging method performs acceptably in spatial interpolation di piazza et al 2011 however when the percentage of missing values or ungauged sites exceeds a certain level or the climate changes considerably the ordinary kriging method is insufficient for evaluation kriging is the most commonly used method for pub under the presumption of a relationship between neighboring locations for example latticekrig or anisotropic kriging uses gaussian markov random fields with gaussian covariance in spatial dimensions nychka et al 2015 huang et al 2016 quantile kriging has been reported to be realistic in precipitation variability among locations bárdossy et al 2021 the directional variability can also be modeled asymmetrically cyclically or in any direction carle and fogg 1997 dai et al 2019 however markov chain models based on transition probabilities are more suitable for use in geostatistical applications when the spatial correlations are asymmetrically juxtapositional or disjunctive matos et al 2014 of the various markov chain models continuous lag markov chains are the most suitable for situations involving unbalanced station distributions fabbri et al 2020 compared with satellite based methods kriging methods are still widely used although satellite imaging provides information about ungauged areas it has some drawbacks for example the information may not be directly relevant or consistent the information may be only available for a shorter period and satellite records provide poor correspondence between cloud top observations and rain gauge reports kitzmiller et al 2013 therefore satellite information can serve as a role of assistance and the costly weather stations are still necessary actually in the contemporary applications of precipitation rain gauges are the mainstream instrument with high reliability compared to satellites or doppler radars our mcrf models are therefore developed as an alternative for data imputation in missing values of ungauged grid locations although the proposed approach does not rely fully on neural network models this aspect of our iteration framework requires further investigation ensemble learning has enabled researchers to overcome modeling difficulties and obtain accurate results in weather forecasts drake et al 2006 lee and chen 2021 the generative processes can effectively control underlying stochastic processes according to their learning results our mcrf based kriging generator is based primarily on the markov chain concept in contrast to a neumann scott based process kyriakidis et al 2004 tarpanelli et al 2012 a generalized super resolution convolutional neural network cnn was also proved to be efficient and robust for predicting extreme weather events bihlo 2021 although some image translation networks or models have been used in hydrology neural networks usually do not obtain outstanding performance in modeling stochastic time series valizadeh et al 2017 3 markov chain random field kriging in our mcrf based kriging approach as shown in fig 2 precipitation estimation using ungauged data is conducted through an iterative process before the data are sent for model estimation the data from heterogeneous stations must be corrected and converted into a multidimensional data cube the target locations are then arranged into a regular structure such as a grid and peak precipitation is estimated throughout the grid structure because the number of ungauged locations considerably exceeds that of gauged sites classic kriging methods may encounter numerical difficulties therefore our mcrf approach estimates a markov chain before implementing the kriging step the accuracy of the kriging process is then boosted in the proposed approach the ungauged information is imputed at all grid locations let z s l be a categorical random variable at the location s l l 1 n with k mutually exclusive categories or states z 1 z k a continuous lag markov chain model or mcrf is a probability measure μ in the σ field of the borel set comprised of the states z 1 z k an mcrf can be realized by the conditional probabilities 1 t i j s l s k prob z s l z j z s k z i i j 1 k through the behavior of the spatial conditional probability t i j we can consider that the mcrf embodies a spread of state changes that is the occurrence at one location is affected by occurrences at its neighbors and its occurrence conversely also affects neighbors in a different direction the conditional probability in space is also called transiograms we develop a method to train the values from the discrete quantized state spaces for each markov chain at all s l locations to simplify the modeling of spatial transition the spatial variability in direction ϕ is defined as t i j h ϕ prob category j occurs at x h ϕ category i occurs at x where h ϕ is a positive lag separation distance the matrix form representation of the mcrf is defined such that the transition probability matrix is the mapping t h ϕ r d 0 1 k k and t h ϕ exp h ϕ r ϕ where r ϕ r k k is a transition rate matrix satisfying r i i 0 i 1 k r i j 0 for i j j 1 k r i j 0 and i 1 k p i r i j 0 with the proportion of the i th category represented by p i in addition r i j ϕ p j p i r j i ϕ represents the opposite direction ϕ to obtain an estimation of the transition rate matrix r ϕ we can apply a multidimensional approach in the ellipsoidal interpolation r i j ϕ v 1 d h v ϕ h ϕ r i j e v 2 where h v ϕ is the v th component of the vector h ϕ and e v is the standard basis vector if the off diagonal transition rates represent the juxtapositional tendencies symmetric juxtapositional patterns emerge in direction ϕ as well as in the direction ϕ we can extend the model to arbitrary directions by decomposing r along the orthogonal directions that is r x and r y the random variable z s l is then captured in the mcrf the unobservable rainfall distribution y s r m at location s in domain d can be assumed to follow a spatial random effects sre model according to 2 2 y s t s α v s ξ s s d where t r m n α r n 1 v r m and ξ r m represents a covariate vector a corresponding regression coefficient vector a small scale spatially correlated random effect and a fine scale spatially uncorrected random effect respectively assuming that random effects are of zero mean we can decompose the spatially correlated zero mean random process v s l 1 r ψ l s η l where ψ l s l 1 r is a set of r vectors of spatial basis or kernel density functions and η l s is the corresponding coefficient vector the parameters estimated in the sre model include the aforementioned coefficients and the spatial covariance of v in the study the number of observations is considerably lower than the number of grid locations therefore the covariates have been sufficiently imputed by our mcrf at the previous step the detailed mcrf steps are illustrated in fig 3 let the basic areal units baus represent a discretized domain of interest d g a i d i 1 n d i 1 n a i and a i a j 0 for i j for n small non overlapping areas or grids nguyen et al 2012 the baus present the target grid for the estimation of mcrf algorithm which is based on the observation locations s l l 1 n in summary r n m and n represent the numbers of bases baus covariates and observations in the measurement of the internal process y respectively accordingly we have that n r and n r at the bau level v s η the basis ϕ s r m r is then up sampled to s r n r by 3 s 1 a i a i ψ s d s i 1 n therefore the new matrix form 2 of sre becomes 4 y ˆ t α s η ξ ˆ where y ˆ r n t r n l s r n r α r l η r r and ξ ˆ r n the covariates t must be represented in a matrix at the discrete locations of the baus given the observation w w j j 1 m the relation with the spatial process y can be captured in w c w y c w δ ϵ linking the projection to the original sre model 4 yields the final sre 5 w t w α s w η ξ w δ w ϵ where w r m t w c w t r m l s w c w s r m r α r l η r r and ξ w c w ξ δ w c w δ ϵ r m the parameters to be estimated are θ α σ ξ σ η k with respect to the likelihood l c θ η w θ 4 results to verify our approach we selected a southern portion of the island of 35 808 km 2 13 826 mi 2 and a 23 45 million population in taiwan for demonstration the vast unpopulated mountains on the island dominate the eastern two thirds and the rest one third are plains where the majority of the population resides the climate of the island lies in the northern tropical zone with tropical marine climate in general but there are large variations from north to south and from plains to mountains the average rainfall is 2600 mm 100 inches and the average temperature ranges from 16 c 61 f in january to 30 c 86 f in july the rainy season coincides with the summer east asian monsoon and typhoons frequently hit for all seasons winter brings in steady light rain in the north and dryness in the south we concentrate the study area on the south part of the island fig 4 which represents a typical asymmetric landscape with anti symmetric site distribution in a complex tropical climate from a sea level plain to 2000 3000 m high elevated mountains in the vast unpopulated area most of the land was mountainous without stations that is the anti symmetrically distributed area as illustrated in fig 4 the yellow dots represent the cwb sites with a large number of stations distributed across the plain 136 and 122 sites before and after data cleaning cwb 2021 most stations were concentrated in the metropolitan area and few stations were located in mountainous areas our method is designed for the situation of unevenly distributed sites even if the average density of sites in an area is sufficient weather stations are often concentrated in a part of the area such distribution is referred to as anti symmetric because the plains are overpopulated with stations and the areas with more complex terrains are underpopulated most metropolitan areas often situated on plains or estuaries have sufficient meteorological data but an excessive number of stations by contrast vast depopulated zones without electricity such as high mountain catchment areas basins and swamps are rich in meteorological features but lacking in stations therefore accurate precipitation data are often required in these depopulated areas to support major engineering works we use two sources of data for the estimation process the long term central weather bureau cwb data can be used for training the estimation model in contrast the short term soil and water conservation bureau swcb data was only used for cross validation for our estimation results in the unpopulated areas our algorithm is different from other learning algorithms our method is to estimate the ungauged grid locations at high mountains from gauged sites on plains therefore we cannot perform the typical split of 70 for training and 30 for validation because the 30 could still be located in metropolitan areas all data from cwb were for training that is building the estimation model consequently we use the swcb data to double check the correctness of the estimation for the mountainous sites while cwb data mostly are from stations in plains swcb data are mostly from mountainous areas because of the maintenance challenges for the remote sites the timespan of the data may be short and the data readings may not be trustworthy in addition locations and times may be mislabeled and instruments may not be properly maintained the station coordination information could be incorrectly registered and some sites may stop functioning for a random period and back to recover unexpectedly because those locations are difficult to reach the operation conditions of rain gauges and recording equipment were unknown therefore the data cleaning task was difficult to perform despite more than 30 sites being recorded nevertheless 14 sites with a short period of historical data were kept despite a low accepted standard of data cleaning regardless of the data reliability the independent dataset can still serve as a reasonably useful source to verify the accuracy of estimation for the ungauged locations in mountainous areas the computation work for training the mcrf model is massive because the number of parameters are huge however the estimation work can be performed in offline once a year the model training was performed in a 16 core i9 12900 cpu rtx 3090 gpu with 512g dram a complete training cycle in the 16 parallel threads lasted about a half week by maintaining cpu temperature under 100 c through our proposed approach we first established a grid structure and added the long term rainfall characteristics l moments of historical data to the structure at the gauged stations we calculated the l moments along with the historical data the l moment statistics constituted a summarized quantity for testing the goodness of fit of the probability distributions to determine the homogeneity of the site groups they had already been subjected to a series of improvements using conventional moment methods to ensure that the estimates were unbiased normal and stable in small samples l 1 represents the mean precipitation from samples specifically it represents the average of the largest annual 1 day precipitation the l scale can be expressed as l cv l 2 l 1 l skewness can be expressed as l sk l 3 l 2 and l kurtosis can be expressed as l kt l 4 l 2 where 6 l i i 1 k 0 i 1 1 k i 1 k e x i k i for the k th order statistic x k n in a sample x of size n and expectation e in particular l 1 e x l 2 e x 2 2 e x 1 2 2 l cv can be considered a dimensionless measure of the variability of the annual largest one day storm the four l moments are then calculated for the subsequent estimation in mountainous areas subsequently we imputed the data obtained for the ungauged locations in the vast unpopulated area by using the mcrf process all four l moments were estimated for each grid location this step provided an initial value for the covariates in the next spatial regression the mcrf approach was used to discretize the l moments into states and estimate the most probable ones the triangular points in fig 5 indicate the known values of the stations the spatial estimation was congruent with the observed values but this estimation was not the final fit a moderate amount of slack can prevent overfitting in the final converged solutions the results of the mcrf based imputation were used as the input for the subsequent kriging process because the mcrf approach was used to impute the missing values obtained at ungauged locations in the vast areas of forests and mountains we conducted fixed rank kriging with sufficient covariate resolution as illustrated by fig 5 the colors match well between small dots and triangles our estimation results were very close to the cwb and swcb data and the estimated values were almost identical to the data obtained from the 122 cwb stations in addition the estimated values were also almost identical to the newly provided data of the 14 swcb stations notice that the precious swcb data at monotonous areas albeit incomplete still served as validation instead of training after completing the training the predicted precipitation in the mountainous areas should be validated through a third party dataset because of the asymmetric distribution we acquired other sources of data for the mountainous area to verify our approach the normalized root mean square errors nrmses between the training and validation steps were low and the kling gupta efficiency kge values were high table 1 kge is a measure that is frequently used to assess the goodness of fit of two vectors used in hydrological estimation processes knoben et al 2019 lee and chen 2021 7 kge 1 r 1 2 σ s i m σ o b s 1 2 μ s i m μ o b s 1 2 a high kge value is considered to indicate high goodness of fit estimations of higher moments are not usually as accurate as those of lower moments because of the statistical computation estimation accuracy for the four l moments in terms of training and validation metrics is elaborated in table 1 in most model training situations high validation performance is desirable instead of high training performance these two indicators should be adequately balanced in order not to fall into an over fitting situation the model needs to be accurate on both historical and future data instead of past data only despite the quality of third party data our accuracy is still confirmed both in standard metric and visual inspections the normalized root mean square errors between the predicted values and the validation values were below 0 321 demonstrating that the mcrf step can effectively estimate the precipitation at unevenly distributed sites without over fitting the validation results reveal the effectiveness of our approach in estimating extreme precipitation in the ungauged grid locations 5 conclusions this study aims to replace conventional frequency analysis in engineering applications in case of the replacement takes an extraordinarily long time in the engineering community at least our results should fix the regionalization problem for the classical frequency analysis frequency analysis is always performed in a homogeneous region with a designated parameter for example your house may locate in a region that may encounter a 1 m flood every 100 years how to delineate a homogeneous region taking such a designated parameter is challenging due to insufficient weather information or versatile influences in the landscape our results can provide a scientific and verifiable base to the local authorities and engineers in determining the precipitation pattern and regional parameters to delineate a homogeneous area across the heterogeneous territory for administration precipitation in the mountainous areas must be nevertheless estimated under a situation of the low amount of information because of the cost of installation weather stations appear to be anti symmetrically distributed in the heterogeneous territory estimating precipitation with sparsely gauged stations was difficult ordinary interpolations may fail in such unevenly distributed situations our probability learning based mcrf kriging approach differs from most traditional interpolation approaches in this study we have applied the method to a tropical island with 122 unevenly distributed stations over a wide range of altitudes and equipment spacing the results show that our method can effectively compensate for missing values over a vast ungauged territory with anti symmetrically distributed weather stations thus enabling the estimation of the most probable extreme precipitation for the anti symmetric weather station distribution the effectiveness is confirmed from two perspectives first the estimated precipitation has been cross validated through a third party data source second the validation accuracy is close to the training accuracy which implies that the model will be continuously effective after acquiring new data our mcrf models are therefore proven to be a reliable method for data imputation in missing values of ungauged grid locations 5 1 discussions to provide a numerical comparison between the predicted and measured values we plotted the l 1 values obtained for all the stations as presented in fig 6 in the figure the predicted values were compared with the original measurement values the 45 degree gray line is the matching line and it is not the line of linear regression if the predicted values completely match the original values all the red dots will perfectly drop to the 45 degree gray line because of the special purpose of our estimation our method mainly estimates the values without historical data traditionally the missing values are simply computed by interpolation interpolation is the most common and straightforward way to deal with the missing data problem it just simply assumes that vicinity locations have similar weather however in the anti symmetric weather stations there is no adjacent stations to average from such a straightforward assumption may not hold when the administration covers heterogeneous territories therefore interpolation mostly fails in the anti symmetric case our mcrf method is designed to estimate the values without adjacent data observe the red dots in fig 6 most of the estimations fall into the vicinity of the 45 degree gray line except some outliers that are apart from the diagonal line the estimated values from our model are close to the validation values which are prepared by a third party data source swcb therefore in the future we hope that we can correctly estimate precipitation in mountainous areas the future accuracy is ensured by the balance between training and validation errors that is the chance of over fitting is low from table 1 the normalized root mean square errors between the predicted values and the validation values were all below 0 321 demonstrating that the mcrf step can effectively estimate the precipitation at unevenly distributed sites without over fitting despite the quality of third party data our accuracy is confirmed both in standard metric and visual inspections the discrepancy in fig 6 may be due to the data cleanness the validation results reveal the effectiveness of our approach in estimating extreme precipitation in the ungauged grid locations because the purpose of model training in this study is to replace the practice of frequency analysis not an accurate prediction on ungauged locations solving the classical problem of frequency may help field engineers traditionally frequency analysis is commonly used in the field practice of engineering applications because of its simplicity and not relying on computers however a designated parameter e g 1 event 100 yrs must be assumed before fitting the probability distribution at a location for the occurrence of disaster events however not every location has sufficient historical data to fit such a probability distribution the regionalization problem for the managing authority is challenging because of many undetermined reasons administrative county borders become the default standard however weather conditions are unlikely to change with the artificial border lines instead of defining the regional boundaries by the county borders we suggest a reasonable delineation based on the local properties of precipitation in the complex mountainous areas in this study we chose an area with complex climate conditions and an anti symmetric station distribution the chosen case well demonstrates the effectiveness of our method as shown in fig 7 with the accurate estimation of l moments at the grid locations the clustering can make each region homogeneous in the precipitation pattern based on our estimation works we then suggest that the delineation can be divided by the local properties in 6 areas the counties in the map of fig 7 mostly consist of plain and high mountainous areas as indicated by the dem in fig 4 they all have versatile landscapes and weather characteristics without gauged data the existing engineering standard can only treat the entire county as one region and apply the same parameter to the entire region for the frequency analysis apparently the parameters for plains and mountains should be different therefore the argument about the boundaries cannot be resolved our estimation based on the l moments provides a clue to delineate the administrative regions the local authorities may not know how to perform mcrf to estimate precipitation at the mountain but they can still use their frequency analysis based on the identified regions we contribute to the practical management task by explicitly delineating the regions with the accurate statistics on the grid the regionalization for delineating homogeneous characteristics can be then accomplished our estimation results are well suitable for the administrative planning for construction works in the catchment areas 5 2 limitations and future works this study has limitations in the validation process the predicted precipitation characteristics need to be verified with authorized precision however the operating conditions in the remote territory are uncontrollable machine reliability and electricity are extremely limited in such a difficult situation therefore it is uncertain whether the reason causing the estimation errors is due to the method or the data accuracy in the future study the validation process can be enhanced through the help of alpine and reservation authorities credit authorship contribution statement ming hsi lee conceptualization validation formal analysis investigation resources data curation writing original draft writing review editing visualization supervision project administration funding acquisition yenming j chen conceptualization methodology software validation formal analysis investigation writing original draft writing review editing visualization declaration of competing interest the authors declare no conflict of interest acknowledgments all authors have read and agreed to the published version of the manuscript this research was funded by ministry of science and technology taiwan grant number most 110 2625 m 020 002 and 109 2410 h 992 018 my2 
2569,delineating a homogeneous region is a standard procedure for rainfall frequency analysis in predicting precipitation in ungauged basins pub in vast unpopulated areas however for data about the extreme weather events measured at stations that are asymmetrically distributed the use of conventional regionalization techniques for forecasting is challenging vast depopulated zones such as high mountain catchment areas basins and swamps are rich in features that influence precipitation but they contain few stations hence data from the populated area must be used to estimate data for the unpopulated areas accordingly this study developed a novel spatial imputation approach for simulating spatial precipitation over a planar grid in this approach the markov chain random field mcrf technique is used to estimate the parameters of the stochastic process of ungauged sites at all grid points from versatile juxtapositional directions the probability learning based mcrf approach differs from most traditional interpolation approaches which may fail in unevenly distributed situations after completing the training the predicted precipitation in the mountainous areas was validated through a third party dataset despite the quality of third party data our accuracy is confirmed both in standard metric and visual inspections the normalized root mean square errors between the predicted values and the validation values were below 0 321 demonstrating that the mcrf step can effectively estimate the precipitation at unevenly distributed sites keywords extreme precipitation precipitation estimation in ungauged basins pub anti symmetric distribution markov chain random field kriging homogeneous regionalization data availability data will be made available on request 1 introduction meteorological events have conventionally been quantified using straightforward approaches the quantifications must be confined within a predefined boundary however not every region possesses sufficient historical data that can fit a presumed probability distribution bárdossy et al 2021 when the locations of the data collection stations are randomly distributed achieving a satisfactory data fit becomes more challenging a rough regionalization method is usually used to accommodate difficulties related to estimations in ungauged basins pub nevertheless regionalization becomes challenging when stations are unevenly distributed as illustrated in fig 1 even if the average density of sites in an area is sufficient weather stations are often concentrated in one place this type of distribution can be referred to as asymmetric because the plains are overpopulated with stations and the areas with more complex terrains are underpopulated suroso and bárdossy 2018 most metropolitan areas often situated on plains or estuaries have sufficient meteorological data but an excessive number of stations by contrast vast depopulated zones such as high mountain catchment areas basins and swamps are rich in meteorological features but lacking in stations accurate climate predictions are often required in these depopulated areas to support major engineering works in the past optimal approaches for defining regional boundaries in these territories were controversial grouping sparsely populated areas as one region is not acceptable nor is grouping more densely populated areas with sparsely populated areas currently shorter and longer term recurring storm events appear to occur in the same regions which might be attributed to a poor delineation of the homogeneous regions moreover increasing climate variations render statistical estimations more challenging accordingly this study develops a novel spatial imputation algorithm by converging the conditional probabilities of variograms from all locations this study reconstructs all the available spatiotemporal precipitation data on a grid structure instead of fitting a general probability distribution derived from gauged sites most geographical prediction methods such as linear mixed models are not accurate when the number of unknown points are considerably greater than the number of known data points the traditional interpolation approaches cannot tolerate a large part of missing values and therefore a reliable missing value imputation method should be applied before turning into interpolation in this paper we propose a spatial markov chain random field mcrf for imputing the geographical data before the estimation of precipitation events the mcrf approach can be adapted to a wider range of spatial distributions than can ordinary spatiotemporal decomposition approaches with a unified grid of spatiotemporal data high dimensional clustering can then be achieved 2 related works despite the initiative of the international association of hydrological sciences on regionalization methods for estimation in ungauged basins pub no consensus on estimation models has yet been reached yeo and nguyen 2016 approaches have been proposed to solve the problem primarily through assumptions or acquiring external information these proposed approaches can be divided into three categories such as kriging frequency analysis and satellites but they lack sufficient environmental determinants spatial and temporal heterogeneity a sensitive selection of covariates relevant information and contiguously identified regions zhang et al 2017 hailegeorgis and alfredsen 2017 das 2019 as far as we are aware no study has directly addressed the problem of asymmetric site distribution classic assumptions in spatial continuity may not be relevant to this situation therefore our proposed approach can solve the problem by imputing the missing information at all grid locations our mcrf approach differs from others such as self organizing maps or interpolation based kriging because it is a statistical learning method that does not require a presumed distance or anisotropic weighting regarding methods in the literature relevant to this study spatiotemporal kriging models have been proposed for simulating events related to climate change and assessing data from asymmetric sites nevertheless studies on such models have not provided congruent conclusions concerning regionalization the meteorological applications of generative adversarial networks are also under investigated goodfellow et al 2014 common methods for performing spatial prediction and simulation at ungauged sites include region of influence spatial proximity regression physical similarity and machine learning approaches du et al 2014 the data and methods usually used to construct models from gauged and ungauged sites are flawed because the quantity and reliability of the collected data are uncertain and model assumptions may be inconsistent wen et al 2017 libertino et al 2018 at a local scale region of influence approaches using index methods are recognized as the de facto standard for meteorology related analysis among grassroots engineers however different methods for the delineation of regions can produce different prediction results hailegeorgis and alfredsen 2017 das 2019 at the grid level interpolation approaches such as kriging and inverse distance weighting assume sites in spatial proximity to have similar weather conditions nevertheless additional factors such as environmental conditions and catchment attributes are seldom considered li and heap 2011 the correlation over short distances tends to be clustered for high precipitation sites suroso and bárdossy 2018 a study libertino et al 2018 reported performance benchmarks for spatial interpolation processes moreover kriging or spatial regression methods with a range of covariates has been commonly used in previous studies li and heap 2011 however model building in this context is not straightforward spatial and temporal parameters may be heterogeneous consideration of fixed and random effects is required and the distribution of residual type errors may not be gaussian varga et al 2016 das et al 2020 extreme weather events related to climate change increase the severity of problems associated with spatial variability zhang et al 2012 gummadi et al 2018 the ordinary kriging method performs acceptably in spatial interpolation di piazza et al 2011 however when the percentage of missing values or ungauged sites exceeds a certain level or the climate changes considerably the ordinary kriging method is insufficient for evaluation kriging is the most commonly used method for pub under the presumption of a relationship between neighboring locations for example latticekrig or anisotropic kriging uses gaussian markov random fields with gaussian covariance in spatial dimensions nychka et al 2015 huang et al 2016 quantile kriging has been reported to be realistic in precipitation variability among locations bárdossy et al 2021 the directional variability can also be modeled asymmetrically cyclically or in any direction carle and fogg 1997 dai et al 2019 however markov chain models based on transition probabilities are more suitable for use in geostatistical applications when the spatial correlations are asymmetrically juxtapositional or disjunctive matos et al 2014 of the various markov chain models continuous lag markov chains are the most suitable for situations involving unbalanced station distributions fabbri et al 2020 compared with satellite based methods kriging methods are still widely used although satellite imaging provides information about ungauged areas it has some drawbacks for example the information may not be directly relevant or consistent the information may be only available for a shorter period and satellite records provide poor correspondence between cloud top observations and rain gauge reports kitzmiller et al 2013 therefore satellite information can serve as a role of assistance and the costly weather stations are still necessary actually in the contemporary applications of precipitation rain gauges are the mainstream instrument with high reliability compared to satellites or doppler radars our mcrf models are therefore developed as an alternative for data imputation in missing values of ungauged grid locations although the proposed approach does not rely fully on neural network models this aspect of our iteration framework requires further investigation ensemble learning has enabled researchers to overcome modeling difficulties and obtain accurate results in weather forecasts drake et al 2006 lee and chen 2021 the generative processes can effectively control underlying stochastic processes according to their learning results our mcrf based kriging generator is based primarily on the markov chain concept in contrast to a neumann scott based process kyriakidis et al 2004 tarpanelli et al 2012 a generalized super resolution convolutional neural network cnn was also proved to be efficient and robust for predicting extreme weather events bihlo 2021 although some image translation networks or models have been used in hydrology neural networks usually do not obtain outstanding performance in modeling stochastic time series valizadeh et al 2017 3 markov chain random field kriging in our mcrf based kriging approach as shown in fig 2 precipitation estimation using ungauged data is conducted through an iterative process before the data are sent for model estimation the data from heterogeneous stations must be corrected and converted into a multidimensional data cube the target locations are then arranged into a regular structure such as a grid and peak precipitation is estimated throughout the grid structure because the number of ungauged locations considerably exceeds that of gauged sites classic kriging methods may encounter numerical difficulties therefore our mcrf approach estimates a markov chain before implementing the kriging step the accuracy of the kriging process is then boosted in the proposed approach the ungauged information is imputed at all grid locations let z s l be a categorical random variable at the location s l l 1 n with k mutually exclusive categories or states z 1 z k a continuous lag markov chain model or mcrf is a probability measure μ in the σ field of the borel set comprised of the states z 1 z k an mcrf can be realized by the conditional probabilities 1 t i j s l s k prob z s l z j z s k z i i j 1 k through the behavior of the spatial conditional probability t i j we can consider that the mcrf embodies a spread of state changes that is the occurrence at one location is affected by occurrences at its neighbors and its occurrence conversely also affects neighbors in a different direction the conditional probability in space is also called transiograms we develop a method to train the values from the discrete quantized state spaces for each markov chain at all s l locations to simplify the modeling of spatial transition the spatial variability in direction ϕ is defined as t i j h ϕ prob category j occurs at x h ϕ category i occurs at x where h ϕ is a positive lag separation distance the matrix form representation of the mcrf is defined such that the transition probability matrix is the mapping t h ϕ r d 0 1 k k and t h ϕ exp h ϕ r ϕ where r ϕ r k k is a transition rate matrix satisfying r i i 0 i 1 k r i j 0 for i j j 1 k r i j 0 and i 1 k p i r i j 0 with the proportion of the i th category represented by p i in addition r i j ϕ p j p i r j i ϕ represents the opposite direction ϕ to obtain an estimation of the transition rate matrix r ϕ we can apply a multidimensional approach in the ellipsoidal interpolation r i j ϕ v 1 d h v ϕ h ϕ r i j e v 2 where h v ϕ is the v th component of the vector h ϕ and e v is the standard basis vector if the off diagonal transition rates represent the juxtapositional tendencies symmetric juxtapositional patterns emerge in direction ϕ as well as in the direction ϕ we can extend the model to arbitrary directions by decomposing r along the orthogonal directions that is r x and r y the random variable z s l is then captured in the mcrf the unobservable rainfall distribution y s r m at location s in domain d can be assumed to follow a spatial random effects sre model according to 2 2 y s t s α v s ξ s s d where t r m n α r n 1 v r m and ξ r m represents a covariate vector a corresponding regression coefficient vector a small scale spatially correlated random effect and a fine scale spatially uncorrected random effect respectively assuming that random effects are of zero mean we can decompose the spatially correlated zero mean random process v s l 1 r ψ l s η l where ψ l s l 1 r is a set of r vectors of spatial basis or kernel density functions and η l s is the corresponding coefficient vector the parameters estimated in the sre model include the aforementioned coefficients and the spatial covariance of v in the study the number of observations is considerably lower than the number of grid locations therefore the covariates have been sufficiently imputed by our mcrf at the previous step the detailed mcrf steps are illustrated in fig 3 let the basic areal units baus represent a discretized domain of interest d g a i d i 1 n d i 1 n a i and a i a j 0 for i j for n small non overlapping areas or grids nguyen et al 2012 the baus present the target grid for the estimation of mcrf algorithm which is based on the observation locations s l l 1 n in summary r n m and n represent the numbers of bases baus covariates and observations in the measurement of the internal process y respectively accordingly we have that n r and n r at the bau level v s η the basis ϕ s r m r is then up sampled to s r n r by 3 s 1 a i a i ψ s d s i 1 n therefore the new matrix form 2 of sre becomes 4 y ˆ t α s η ξ ˆ where y ˆ r n t r n l s r n r α r l η r r and ξ ˆ r n the covariates t must be represented in a matrix at the discrete locations of the baus given the observation w w j j 1 m the relation with the spatial process y can be captured in w c w y c w δ ϵ linking the projection to the original sre model 4 yields the final sre 5 w t w α s w η ξ w δ w ϵ where w r m t w c w t r m l s w c w s r m r α r l η r r and ξ w c w ξ δ w c w δ ϵ r m the parameters to be estimated are θ α σ ξ σ η k with respect to the likelihood l c θ η w θ 4 results to verify our approach we selected a southern portion of the island of 35 808 km 2 13 826 mi 2 and a 23 45 million population in taiwan for demonstration the vast unpopulated mountains on the island dominate the eastern two thirds and the rest one third are plains where the majority of the population resides the climate of the island lies in the northern tropical zone with tropical marine climate in general but there are large variations from north to south and from plains to mountains the average rainfall is 2600 mm 100 inches and the average temperature ranges from 16 c 61 f in january to 30 c 86 f in july the rainy season coincides with the summer east asian monsoon and typhoons frequently hit for all seasons winter brings in steady light rain in the north and dryness in the south we concentrate the study area on the south part of the island fig 4 which represents a typical asymmetric landscape with anti symmetric site distribution in a complex tropical climate from a sea level plain to 2000 3000 m high elevated mountains in the vast unpopulated area most of the land was mountainous without stations that is the anti symmetrically distributed area as illustrated in fig 4 the yellow dots represent the cwb sites with a large number of stations distributed across the plain 136 and 122 sites before and after data cleaning cwb 2021 most stations were concentrated in the metropolitan area and few stations were located in mountainous areas our method is designed for the situation of unevenly distributed sites even if the average density of sites in an area is sufficient weather stations are often concentrated in a part of the area such distribution is referred to as anti symmetric because the plains are overpopulated with stations and the areas with more complex terrains are underpopulated most metropolitan areas often situated on plains or estuaries have sufficient meteorological data but an excessive number of stations by contrast vast depopulated zones without electricity such as high mountain catchment areas basins and swamps are rich in meteorological features but lacking in stations therefore accurate precipitation data are often required in these depopulated areas to support major engineering works we use two sources of data for the estimation process the long term central weather bureau cwb data can be used for training the estimation model in contrast the short term soil and water conservation bureau swcb data was only used for cross validation for our estimation results in the unpopulated areas our algorithm is different from other learning algorithms our method is to estimate the ungauged grid locations at high mountains from gauged sites on plains therefore we cannot perform the typical split of 70 for training and 30 for validation because the 30 could still be located in metropolitan areas all data from cwb were for training that is building the estimation model consequently we use the swcb data to double check the correctness of the estimation for the mountainous sites while cwb data mostly are from stations in plains swcb data are mostly from mountainous areas because of the maintenance challenges for the remote sites the timespan of the data may be short and the data readings may not be trustworthy in addition locations and times may be mislabeled and instruments may not be properly maintained the station coordination information could be incorrectly registered and some sites may stop functioning for a random period and back to recover unexpectedly because those locations are difficult to reach the operation conditions of rain gauges and recording equipment were unknown therefore the data cleaning task was difficult to perform despite more than 30 sites being recorded nevertheless 14 sites with a short period of historical data were kept despite a low accepted standard of data cleaning regardless of the data reliability the independent dataset can still serve as a reasonably useful source to verify the accuracy of estimation for the ungauged locations in mountainous areas the computation work for training the mcrf model is massive because the number of parameters are huge however the estimation work can be performed in offline once a year the model training was performed in a 16 core i9 12900 cpu rtx 3090 gpu with 512g dram a complete training cycle in the 16 parallel threads lasted about a half week by maintaining cpu temperature under 100 c through our proposed approach we first established a grid structure and added the long term rainfall characteristics l moments of historical data to the structure at the gauged stations we calculated the l moments along with the historical data the l moment statistics constituted a summarized quantity for testing the goodness of fit of the probability distributions to determine the homogeneity of the site groups they had already been subjected to a series of improvements using conventional moment methods to ensure that the estimates were unbiased normal and stable in small samples l 1 represents the mean precipitation from samples specifically it represents the average of the largest annual 1 day precipitation the l scale can be expressed as l cv l 2 l 1 l skewness can be expressed as l sk l 3 l 2 and l kurtosis can be expressed as l kt l 4 l 2 where 6 l i i 1 k 0 i 1 1 k i 1 k e x i k i for the k th order statistic x k n in a sample x of size n and expectation e in particular l 1 e x l 2 e x 2 2 e x 1 2 2 l cv can be considered a dimensionless measure of the variability of the annual largest one day storm the four l moments are then calculated for the subsequent estimation in mountainous areas subsequently we imputed the data obtained for the ungauged locations in the vast unpopulated area by using the mcrf process all four l moments were estimated for each grid location this step provided an initial value for the covariates in the next spatial regression the mcrf approach was used to discretize the l moments into states and estimate the most probable ones the triangular points in fig 5 indicate the known values of the stations the spatial estimation was congruent with the observed values but this estimation was not the final fit a moderate amount of slack can prevent overfitting in the final converged solutions the results of the mcrf based imputation were used as the input for the subsequent kriging process because the mcrf approach was used to impute the missing values obtained at ungauged locations in the vast areas of forests and mountains we conducted fixed rank kriging with sufficient covariate resolution as illustrated by fig 5 the colors match well between small dots and triangles our estimation results were very close to the cwb and swcb data and the estimated values were almost identical to the data obtained from the 122 cwb stations in addition the estimated values were also almost identical to the newly provided data of the 14 swcb stations notice that the precious swcb data at monotonous areas albeit incomplete still served as validation instead of training after completing the training the predicted precipitation in the mountainous areas should be validated through a third party dataset because of the asymmetric distribution we acquired other sources of data for the mountainous area to verify our approach the normalized root mean square errors nrmses between the training and validation steps were low and the kling gupta efficiency kge values were high table 1 kge is a measure that is frequently used to assess the goodness of fit of two vectors used in hydrological estimation processes knoben et al 2019 lee and chen 2021 7 kge 1 r 1 2 σ s i m σ o b s 1 2 μ s i m μ o b s 1 2 a high kge value is considered to indicate high goodness of fit estimations of higher moments are not usually as accurate as those of lower moments because of the statistical computation estimation accuracy for the four l moments in terms of training and validation metrics is elaborated in table 1 in most model training situations high validation performance is desirable instead of high training performance these two indicators should be adequately balanced in order not to fall into an over fitting situation the model needs to be accurate on both historical and future data instead of past data only despite the quality of third party data our accuracy is still confirmed both in standard metric and visual inspections the normalized root mean square errors between the predicted values and the validation values were below 0 321 demonstrating that the mcrf step can effectively estimate the precipitation at unevenly distributed sites without over fitting the validation results reveal the effectiveness of our approach in estimating extreme precipitation in the ungauged grid locations 5 conclusions this study aims to replace conventional frequency analysis in engineering applications in case of the replacement takes an extraordinarily long time in the engineering community at least our results should fix the regionalization problem for the classical frequency analysis frequency analysis is always performed in a homogeneous region with a designated parameter for example your house may locate in a region that may encounter a 1 m flood every 100 years how to delineate a homogeneous region taking such a designated parameter is challenging due to insufficient weather information or versatile influences in the landscape our results can provide a scientific and verifiable base to the local authorities and engineers in determining the precipitation pattern and regional parameters to delineate a homogeneous area across the heterogeneous territory for administration precipitation in the mountainous areas must be nevertheless estimated under a situation of the low amount of information because of the cost of installation weather stations appear to be anti symmetrically distributed in the heterogeneous territory estimating precipitation with sparsely gauged stations was difficult ordinary interpolations may fail in such unevenly distributed situations our probability learning based mcrf kriging approach differs from most traditional interpolation approaches in this study we have applied the method to a tropical island with 122 unevenly distributed stations over a wide range of altitudes and equipment spacing the results show that our method can effectively compensate for missing values over a vast ungauged territory with anti symmetrically distributed weather stations thus enabling the estimation of the most probable extreme precipitation for the anti symmetric weather station distribution the effectiveness is confirmed from two perspectives first the estimated precipitation has been cross validated through a third party data source second the validation accuracy is close to the training accuracy which implies that the model will be continuously effective after acquiring new data our mcrf models are therefore proven to be a reliable method for data imputation in missing values of ungauged grid locations 5 1 discussions to provide a numerical comparison between the predicted and measured values we plotted the l 1 values obtained for all the stations as presented in fig 6 in the figure the predicted values were compared with the original measurement values the 45 degree gray line is the matching line and it is not the line of linear regression if the predicted values completely match the original values all the red dots will perfectly drop to the 45 degree gray line because of the special purpose of our estimation our method mainly estimates the values without historical data traditionally the missing values are simply computed by interpolation interpolation is the most common and straightforward way to deal with the missing data problem it just simply assumes that vicinity locations have similar weather however in the anti symmetric weather stations there is no adjacent stations to average from such a straightforward assumption may not hold when the administration covers heterogeneous territories therefore interpolation mostly fails in the anti symmetric case our mcrf method is designed to estimate the values without adjacent data observe the red dots in fig 6 most of the estimations fall into the vicinity of the 45 degree gray line except some outliers that are apart from the diagonal line the estimated values from our model are close to the validation values which are prepared by a third party data source swcb therefore in the future we hope that we can correctly estimate precipitation in mountainous areas the future accuracy is ensured by the balance between training and validation errors that is the chance of over fitting is low from table 1 the normalized root mean square errors between the predicted values and the validation values were all below 0 321 demonstrating that the mcrf step can effectively estimate the precipitation at unevenly distributed sites without over fitting despite the quality of third party data our accuracy is confirmed both in standard metric and visual inspections the discrepancy in fig 6 may be due to the data cleanness the validation results reveal the effectiveness of our approach in estimating extreme precipitation in the ungauged grid locations because the purpose of model training in this study is to replace the practice of frequency analysis not an accurate prediction on ungauged locations solving the classical problem of frequency may help field engineers traditionally frequency analysis is commonly used in the field practice of engineering applications because of its simplicity and not relying on computers however a designated parameter e g 1 event 100 yrs must be assumed before fitting the probability distribution at a location for the occurrence of disaster events however not every location has sufficient historical data to fit such a probability distribution the regionalization problem for the managing authority is challenging because of many undetermined reasons administrative county borders become the default standard however weather conditions are unlikely to change with the artificial border lines instead of defining the regional boundaries by the county borders we suggest a reasonable delineation based on the local properties of precipitation in the complex mountainous areas in this study we chose an area with complex climate conditions and an anti symmetric station distribution the chosen case well demonstrates the effectiveness of our method as shown in fig 7 with the accurate estimation of l moments at the grid locations the clustering can make each region homogeneous in the precipitation pattern based on our estimation works we then suggest that the delineation can be divided by the local properties in 6 areas the counties in the map of fig 7 mostly consist of plain and high mountainous areas as indicated by the dem in fig 4 they all have versatile landscapes and weather characteristics without gauged data the existing engineering standard can only treat the entire county as one region and apply the same parameter to the entire region for the frequency analysis apparently the parameters for plains and mountains should be different therefore the argument about the boundaries cannot be resolved our estimation based on the l moments provides a clue to delineate the administrative regions the local authorities may not know how to perform mcrf to estimate precipitation at the mountain but they can still use their frequency analysis based on the identified regions we contribute to the practical management task by explicitly delineating the regions with the accurate statistics on the grid the regionalization for delineating homogeneous characteristics can be then accomplished our estimation results are well suitable for the administrative planning for construction works in the catchment areas 5 2 limitations and future works this study has limitations in the validation process the predicted precipitation characteristics need to be verified with authorized precision however the operating conditions in the remote territory are uncontrollable machine reliability and electricity are extremely limited in such a difficult situation therefore it is uncertain whether the reason causing the estimation errors is due to the method or the data accuracy in the future study the validation process can be enhanced through the help of alpine and reservation authorities credit authorship contribution statement ming hsi lee conceptualization validation formal analysis investigation resources data curation writing original draft writing review editing visualization supervision project administration funding acquisition yenming j chen conceptualization methodology software validation formal analysis investigation writing original draft writing review editing visualization declaration of competing interest the authors declare no conflict of interest acknowledgments all authors have read and agreed to the published version of the manuscript this research was funded by ministry of science and technology taiwan grant number most 110 2625 m 020 002 and 109 2410 h 992 018 my2 
