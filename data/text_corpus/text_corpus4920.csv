index,text
24600,this paper describes integrating remote sensing and meteorological data for dynamic winter wheat yield prediction at fixed date intervals with an integral regression model in most cases both rainfall and irrigation supply the water needs of crops we postulated that meteorological precipitation could not fully represent the actual amount of water available to crops whereas the temperature vegetation dryness index tvdi can represent actual water which monitors soil moisture according to this meteorological and remote sensing data based on sunshine hours temperature and tvdi formed a light temperature water data combination which are the three most fundamental and critical factors related to crop growth the new data combination was used as the input variables of the integral regression model which could predict the crop yield at a fixed date interval of any length the dynamic results were then compared with that of the meteorology data combination sunshine hours temperature and precipitation we selected a total of seven county level areas in semi humid and arid regions in china the proposed dynamic prediction approach achieved good results at the county level from march 21 to maturity at 16 day intervals with predicted r2 0 94 and root mean squared error range of 15 54 121 01 kg ha 1 between predicted and actual yield with leave one year out cross validation for each prediction date the trend of dynamic prediction accuracy had a relatively stable state in addition tvdi contained more crop water information and prediction results using tvdi and meteorology were generally superior to that using only meteorology for semi humid and arid areas with the best results for arid regions thus integrating meteorology and tvdi could effectively dynamically predict yield at county level for most agroclimatic regions and particularly for arid regions the work has implications for dynamic yield prediction and improving prediction accuracy and can be extended to other areas keywords yield prediction winter wheat modis tvdi precipitation county level 1 introduction crop yield information is essential for food security grain trade and land management in a country or region timely and accurate crop yield prediction before harvest is critical for food security and administrative planning pagani et al 2018 zhao et al 2013 overall crop yield depends on multiple factors including climate soil type crop details etc which are also commonly used as parameters for crop yield prediction elavarasan et al 2018 light temperature and precipitation porter and semenov 2005 are critical and fundamental factors in climate and affect crop production cai et al 2019 kern et al 2018 kukal and irmak 2018 muchow et al 1990 rosenzweig and parry 1994 schmidhuber and tubiello 2007 trnka et al 2007 wit et al 2005 precipitation alone is insufficient to analyze water effects on crop growth and development for low precipitation regions actual crop evapotranspiration in these regions tends to be much higher than annual precipitation liu et al 2002 and water stress directly affects crop yield hence agricultural irrigation has become an essential source of water for crops most irrigation water and precipitation will eventually present in the soil as soil moisture and ensure water supply for crops however monitoring soil moisture content requires considerable human resources particularly for large scale monitoring with the development of remote sensing technology many metrics have been proposed to monitor or reflect the living environment and conditions for crop growth balaghi et al 2008 cai et al 2019 kern et al 2018 zhang et al 2016 vegetation indexes ban et al 2017 li et al 2014 liu et al 2019 e g normalized difference vegetation index ndvi enhanced vegetation index evi photosynthetic activities guan et al 2016 guanter et al 2014 and phenology bolton and friedl 2013 zeng et al 2016 zhang et al 2016 can be used to monitor crop growth conditions heat stress siebert et al 2014 land surface temperature lst and solar radiation holzman et al 2018 and water stress anderson et al 2011 inge et al 2002 can describe crop living environments these metrics are used to replace or integrate with climate factors to predict yield and the predictive results have improved elavarasan et al 2018 holzman et al 2018 mkhabela et al 2011 tucker 1979 based on parameterizing the relationship between lst and a vegetation index remote sensing temperature vegetation dryness index tvdi inge et al 2002 can be used to monitor soil moisture and drought on a large scale sun et al 2012 zhang et al 2014a some studies indicated that tvdi was suitable to assess soil water content at the roots of cultivated land crops holzman et al 2014a showing a significant negative correlation with soil moisture at 20 cm depth and in the surface soil scholars have defined a generalized relationship between crop yield and tvdi using a quadratic function holzman et al 2018 2014b intermediate values of tvdi in the quadratic function indicate normal water conditions for crop growth corresponding to maximum yield with values higher and lower than the intermediate values expressing water excess and stress conditions respectively corresponding to yield loss previous yield prediction research mostly focused on a single critical time or several discontinuous times before harvest with data for the corresponding period e g critical days month phenological stage bognár et al 2017 kogan et al 2013 li et al 2019 lopresti et al 2015 and day of year with maximum vegetation index values becker reshef et al 2010 dempewolf et al 2014 and rarely considered dynamic yield prediction however continuous dynamic yield prediction at fixed intervals through the growing season can provide superior support and guidance to decision makers and farmers compared with single or discontinuous timing for instance they can provide more information about yield change later in the growing season the methods used in dynamic yield prediction within the season include crop simulation models and empirical models cai et al 2019 feng et al 2020 when using crop models for yield prediction a significant limitation is related to the unknown weather from the prediction date to the maturity date basso and liu 2018 empirical models lack biophysical significance and need to consider the time scale used to aggregate data and predict yield crop yield can be separated into trend yield meteorological yield and random noise hai xia et al 2018 li et al 2019 zhang et al 2014b trend yield represents changes due to social and technological level factors whereas random noise includes accidental influences on grain yield and is usually ignored in practical applications salazar et al 2007 meteorological yield xi min 1985 is mainly affected by meteorological factors sunshine temperature and precipitation fisher fisher 1925 proposed a statistical but biologically significant integral regression model to predict crop yields dynamically which was initially applied to agrometeorology the biological significance was due to meteorological factors affecting meteorological yield changed with the crop growth time and their influence on meteorological yield also changed with time the model assumed the crop was affected by micro effects from meteorological factors for each moment and meteorological yield represented the accumulated micro effects over the growth period if each moment was defined by days the final meteorological yield was the definite integral of daily synergistic effects from meteorological factors on crop growth and development i e an integral regression of meteorological yield and meteorological factors over different time stages therefore dynamic yield prediction can be considered based on meteorological data of specific and arbitrary time length in this paper we integrated sunshine temperature and tvdi to form a light temperature water data combination and used the data combination and the integral regression model to predict winter wheat yield at a fixed date interval the specific objectives follow i to evaluate dynamic yield prediction results from the sunshine temperature and tvdi data combination and ii to compare dynamic yield prediction results from the data combination with results from a meteorological combination of sunshine temperature and precipitation 2 materials and methods 2 1 study areas we selected two typical regions hebei province and ningxia hui autonomous region in china mainly rain fed and irrigated agriculture respectively with large differences in precipitation as the study areas fig 1 shows the two areas hebei province 113 27 119 50 e 36 05 42 40 n semi humid region and ningxia hui autonomous region 104 17 107 39 e 35 14 39 23 n arid region which have different irrigation needs hebei province has vast plains with four distinct seasons and is one of the principal winter wheat growing regions in northern china it has a typical temperate continental monsoon climate with overall climatic conditions suitable for winter wheat growth the multi year average of accumulated active temperature 10 c frost free period and precipitation are approximately 4200 4500 c 130 220 days and 400 800 mm respectively the semi humid and humid agricultural areas are not purely fed by rain sprinkle or diversion irrigation on cultivated land during crucial growth periods helps ensure adequate soil water content ningxia hui autonomous region includes the ningxia plain one of the major wheat growing regions in ningxia and has a temperate continental arid and semi arid climate with annual average precipitation approximately 200 mm evaporation is intense approximately 5 10 fold the precipitation the multi year average of accumulated active temperature and frost free period are approximately 3300 c and 160 170 days respectively the terrain gradually tilts from southwest to northeast and the yellow river runs across the plain the geographical position and climate characteristics make the ningxia plain an important irrigation agricultural area we chose seven main winter wheat producing counties to analyze the effect of tvdi in the two areas with different degrees of irrigation on winter wheat yield prediction the four counties in hebei were nangong botou laoting and raoyang and the three counties in ningxia were zhongning helan and litong fig 1 2 2 data and processing table 1 summarizes the collected data including winter wheat statistical satellite remote sensing and meteorological data from 2002 to 2016 winter wheat statistical data were used to define the yield and remote sensing and meteorological data were used as yield predictors time series data for any year used in this paper were based on the study area s winter wheat phenology ningxia and hebei regions have similar latitude and hence similar winter wheat phenological periods but with subtle differences we obtained the multi year range for each phenology period from the agricultural time database of the ministry of agriculture and rural affairs of china http www zzys moa gov cn fig 2 shows that the winter wheat phenology period in hebei province was mid october to late june whereas in ningxia it was early october to early july 2 2 1 statistical data statistical data included winter wheat planting acreage and production at the county level from 2003 to 2016 from the statistical yearbook for hebei and ningxia guo et al 2020 jianxi et al 2019 the two data types were compiled by the local bureau of statistics based on reports from sub level towns and villages planting acreage ha was total planted area and production kg was total production each county s yield was obtained by dividing production by planting area kg ha 1 yield for one or two years for some areas was considerably higher or lower than the multi year yield trend from 2003 to 2016 and we treated such yield data as statistical outliers the generalized extreme studentized deviate esd test rosner 1983 was used to test the outliers fig 3 2 2 2 remote sensing data 1 landsat identifying winter wheat fields is an essential component of model development and implementation since this allows retrieval of winter wheat specific remotely sensed parameters since no winter wheat maps were available for seven areas a rasterized winter wheat map was produced landsat 5 thematic mapper tm and landsat 8 operational land imager oli satellite images were used to extract winter wheat spatial planting map data in hebei and ningxia for 2007 2010 and 2014 representing annual winter wheat planting information for 2003 2009 2010 2013 and 2014 2016 respectively the dates for these selected images were when crop stems and leaves were the lushest an object oriented classification method was used to produce the winter wheat map we initially pre processed the tm and oli images including radiometric calibration atmospheric correction and orthorectification we then used the scale evaluation tool estimation of scale parameter esp drǎgut et al 2010 to obtain optimal segmentation scales for tm and oli images and the images were subsequently segmented we defined multiple surface types including winter wheat from these object based images depending on the land cover characteristics finally we selected the appropriate number samples and suitable features and used nearest neighbor classification to determine classification rules to extract winter wheat planting information 2 modis we used the moderate resolution imaging spectroradiometer modis mod11a2 land surface temperature lst terra 8 day composite surface temperature level 3 version 6 1 km and mod13a2 normalized difference vegetation index ndvi terra 16 day composite vegetation index level 3 version 6 1 km from 2002 to 2016 available from https ladsweb modaps eosdis nasa gov to calculate tvdi data pre processing included batch geometric correction projection transformation and masking we used maximum value composite mvc holben 1986 to convert 8 day lst into 16 day synthetic data and there were 16 scenes in hebei and 18 scenes in ningxia based on the winter wheat phenology 2 2 3 meteorological data data were sourced from the china meteorological data sharing center http data cma cn including daily sunshine duration hour average temperature c and cumulative precipitation mm at the station level for 2002 2016 sunshine hour average temperature and cumulative precipitation refer to light temperature and water in agriculture respectively six of the seven selected study areas have meteorological stations and the other area has a station nearby see fig 1 therefore meteorological data represented the actual situation for each study area well the daily meteorological data were processed into 16 day interval to match the modis time scale e g march 21st data represented data summed over march 6 21 the predictors for meteorological data had different dimensions to eliminate dimensional and numerical size influences it was essential to ensure all predictors had a similar scale we used 1 x x m a x where x is the data m a x is the maximum data value and x is the scaled data mapped onto 1 1 this ensures that numerical proportionality remained unchanged between data for different times before and after scaling 2 3 methods the overall framework presented in fig 4 shows the order of procedures used in this study to develop and evaluate the dynamic wheat yield prediction model 2 3 1 calculate tvdi we calculated tvdi as follows inge et al 2002 2 tvdi lst ls t min ls t max ls t min where lst is the observed surface temperature k for the given pixel lstmin and lstmax are the minimum and maximum temperature for ndvi pixels defining the wet and dry edge holzman et al 2014b inge et al 2002 respectively and tvdi 0 1 to ensure that the tvdi and the meteorological variables maintained the same dimension eq 1 was used to scale the tvdi we aggregated tvdi data from 1 km resolution to the county level to match the winter wheat yield and meteorological data first winter wheat spatial planting data derived in section 2 2 2 was defined as the mask according to the mask pixels dominated by winter wheat were selected as pure tvdi pixels i e sub pixel proportion 60 wheat land the proportion for each pixel was calculated as 3 p c t m a s k tvdi p i x e l 100 where p c t is the percentage of winter wheat planting area at 1 1 km granularity for each tvdi pixel tvdi p i x e l is the grid unit for the long term sequence remote sensing data in the study area m a s k is the area of winter wheat planting map pixels corresponding to the tvdi pixel spatial range then average tvdi over the pixels with a proportion 60 within a county was calculated for the long time series 2 3 2 separating trend and fluctuation yield yield trend yield and fluctuation yield are related as 4 y y t δ y where y y t and δ y represent yield trend yield and fluctuation yield respectively the factors affecting trend yield change smoothly over time year so trend yield can be considered as a function of time we used a linear moving average to obtain the trend yield i e treated the time series yield as linear over the specific time stage reflecting the overall historical yield trend specifically we took each year as the center to obtain multi year yields within the time window the multi year yields were used to establish a linear fitted equation and fitted yields of corresponding multiple years were obtained based on the fitted equation with continuously sliding time from 2003 to 2016 equations established with different years as the center changed position constantly and slid backward thus multiple fitted yields could be generated depending on window size for each year and the average of the multiple yields was regarded as the actual trend yield for that year the fitted straight line and trend yield for each year was calculated as 5 y i t a i b i t and 6 y i t 1 q j q y i t respectively where y i t and y i t are linear fitted and actual trend yield at time point t t represents year a i and b i are constants and coefficients for the fitted line respectively i n k 1 k is the specific time stage and k 5 in this paper i e the size of moving window n is the number of years of sample data and j 1 2 q with q 1 2 3 k 3 2 1 is the number of linear equations in calculation year t trend yield was assumed to be linear and smoothly changing and the remainder was considered as fluctuating yield meteorological factors strongly influence fluctuation yield so it is sometimes referred to as meteorological yield or yield anomaly li et al 2019 irrigation quantity is directly related to precipitation which also impacts fluctuation yield irrigation affects a small proportion of fluctuation yield and precipitation greatly affects fluctuation yield hence this paper assumed the fluctuation yield explained by sunshine temperature and tvdi included the fluctuation yield explained by sunshine temperature and precipitation we calculated δ y y y t after obtaining y t for each year the trend yield describes a large yield proportion and only a trend yield model can achieve good yield estimation however we predicted fluctuation yield further to improve yield accuracy 2 3 3 combining light temperature water crops are affected by light temperature and water every day during the growing period and these factors are not independent but jointly affect crop growth for example temperature affects crops direct effects and at the same time temperature also affect crops through affecting precipitation indirect effects therefore combining multiple individual factors into a comprehensive factor at each time point to represent the overall growing environment situation is more consistent with physical crop growth we used path analysis aycicek and yildirim 2006 bello and abdulmaliq 2010 to combine light temperature and water into a comprehensive factor to simulate comprehensive effects from these factors on crop growth and development at each time stage path analysis can determine direct effects from independent variables data from three factors on different dates on the dependent variable fluctuation yield and indirect impacts from this independent variable on the dependent variable through other independent variables we used direct effects at each time point as weights multiplying each factor by the weight and summing the factors hence three factors were combined into one comprehensive factor i e sunshine temperature and tvdi combined into a comprehensive factor defined as c tvdi and sunshine temperature and precipitation were combined into the other comprehensive factor defined as c pre the former served as the experimental group and the latter as the control group 2 3 4 dynamic prediction model we used an integral regression model to predict fluctuation yield where fluctuation yield was the dependent variable and c pre or c tvdi were the independent variables the basis for integral regression was that the crop was affected by micro effects from factors for each time point and fluctuation yield represented the accumulated micro effects over the growth period i e the growth period can be divided into n stages within a given time scale producing an n m element linear regression problem where m is the number of factors for the original three factors light temperature and water m 3 whereas m 1 for c pre or c tvdi in this study the regression equation would have many independent variables n and it was challenging to solve integral regression reduced the number of variables and expressed factor influences from emergence to maturity on crop yield integral regression uses the orthogonal polynomial of time to simplify partial regression coefficients for factors that change with time i e reducing independent variables of factors in multiple continuous periods and at the same time reducing information loss we then constructed multi regression models with the new variables thus integral regression can identify factors impacts with continuous time on crop growth integral regression fisher 1925 can be generally expressed as 7 δ y c 0 τ α t x t d t where x t is the single comprehensive factor for c pre or c tvdi in this paper according to the original application of integral regression i e using the three factors light temperature and water as independent variables the regression is expressed as 8 δ y c f a c t o r k 0 τ α f a c t o r t x f a c t o r t d t where f a c t o r represents each factor k 3 δ y is the fluctuation yield c is a constant term α t is the regression coefficient a continuous function expressing factor x influence on fluctuation yield from time t to t δ t and τ is the growth period for calculation convenience α t is generally expanded as an orthogonal polynomial function of time and for this study we used a fifth order polynomial 9 α t α 0 f 0 t α 1 f 1 t α 2 f 2 t α 3 f 3 t α 4 f 4 t α 5 f 5 t where f i t is an orthogonal polynomial of time derived from the chebyshev orthogonal polynomial α i is the partial regression coefficient and i 1 2 5 substituting 9 into 7 10 δ y c α 0 f 0 t x t d t α 1 f 1 t x t d t α 5 f 5 t x t d t let 11 p i f i t x t d t then 10 can be expressed as the linear regression 12 δ y c α 0 p 0 α 1 p 1 α 2 p 2 α 3 p 3 α 4 p 4 α 5 p 5 as discussed above we divided the growth period into n stages with a unit of days i e 13 p i j 1 n f i j t x j t thus based on 11 and 12 the n element linear regression can be expressed as a six element linear regression equation and the fluctuation yield prediction model can be solved yield prediction began on march 21 stem elongation and continued to maturity at a 16 day interval from emergence to each prediction date the number of 16 day interval data in the period was the number of divided stages n the time series data for the 16 day interval was the input to the integral regression model consider march 21 of hebei counties as an example for the period of emergence to march 21 the number of 16 day interval data was 10 and the period was divided into 10 stages the 10 stage time series data for c pre or c tvdi data were used as independent variables with fluctuation yields as the dependent variable for the integral regression model to predict the march 21 yield fluctuation 2 3 5 model evaluation and comparison to render the experiment more reliable we used leave one year out cross validation li et al 2019 to evaluate yield prediction performance on each date a model was first trained using the data with one year removed and then the trained model was used to predict the yield of the missing year this procedure was performed for each year from 2003 to 2016 resulting in maximum 14 years fluctuation yield predictions according to the two purposes of the experiment we conducted two evaluations the first assessed the yield the metrics for evaluating dynamic yield prediction process performance were the coefficient of determination r2 and the root mean squared error rmse they were used to describe relationships between recorded yield and predicted yield the second assessed the fluctuation yield the reason was that we needed to compare c tvdi and c pre in addition to show the prediction of fluctuation yield more intuitively and analyze the factors that affect the accuracy relative error re and mean relative error mre kamilaris and prenafeta boldu 2018 were used to assess integral regress model performance and stability these measures were defined as follows 14 r 2 i 1 n y i y 2 i 1 n y i y i 2 i 1 n y i y 2 15 r m s e 1 n n 1 y y 2 16 r e y i y i y i 100 and 17 m r e i 1 m y i y i y i m 100 where y is recorded yield y is mean recorded yield y is predicted yield n is sample number y represents actual fluctuation yield δ y y represents predicted fluctuation yield and m represents the number of fluctuation yield nash sutcliffe efficiency e1 was also calculated e1 is a modified version of the coefficient of efficiency nash and sutcliffe 1970 defined as one minus the sum of the absolute squared differences between the predicted yield and the observed yield data normalized by the variance of the observed yield data during the period under investigation 18 e 1 1 i 1 n o i p 2 i 1 n o i o 2 where o i is actual fluctuation yielddata p i is predicted fluctuation yield values and o is mean of actual fluctuation yield values values of e1 range between 1 0 which is perfect fit and an efficiency lower than zero indicates that the average value of actual fluctuation yield would have been a better predictor than the model 3 results 3 1 dynamic prediction results the proposed approach integrating sunshine temperature and tvdi was suitable for dynamic yield prediction we obtained multi year fluctuation yield prediction models and predicted results on each date by the leave one year out cross validation the predicted yield results included predicted fluctuation yields and trend yields the relationships between predicted and recorded yields in fig 5 show predicted r2 0 95 for all cases the shapiro wilk test for predicted r2 values of each area provided p values of 0 46 0 02 0 18 0 00 0 26 0 19 and 0 06 in nangong botou laoting raoyang zhongning helan and litong respectively this indicated that most areas passed the test results p 0 05 and there was no artificial effect on the results the rmses were in the range of 15 54 19 94 kg ha 1 for nangnong 21 49 41 37 kg ha 1 for botou 16 07 36 13 kg ha 1 for laoting 21 64 43 75 kg ha 1 for raoyang 47 58 59 00 kg ha 1 for zhongning 32 09 48 15 kg ha 1 for helan and 49 37 121 01 kg ha 1 for litong these values were very small compared with the mean recorded yields from 2003 to 2016 5073 97 5494 89 6012 09 6044 70 4711 00 4852 15 and 5726 25 kg ha 1 for nangong botou laoting raoyang zhongning helan and litong respectively we used averages of each prediction date to assess the trend of dynamic prediction accuracy evaluation metrics predicted r2 and rmse from march 21 to june 25 or july 11 fig 5i the trends in nangong zhongning and helan had small magnitudes with values changing around the mean lines the trends in botou laoting raotang and litong also had little volatility however there were significant changes at march 21 may 8 may 24 and april 6 overall dynamic prediction results did not present a clear upward trend but remained relatively stable 3 2 tvdi and precipitation in study areas fig 6 shows multi year average precipitation and tvdi for each time throughout the growing season for all study areas ningxia is in an arid region and precipitation in each period was less than that for hebei in the same period ningxia needs more irrigation than hebei to ensure winter wheat growth consequently ningxia attached great importance to irrigation facilities and ditches and hence county level 1 km pixels contained many ditches and soil water information with smaller tvdi than hebei thus ningxia tvdi data contained more water information 3 3 comparing c tvdi and c pre we compared the performances of the different input variables c tvdi and c pre using mre including two aspects for each prediction date re over all years fig 7 and each year re for all prediction dates fig 8 the model with maximum trained r2 in the cross validation process was selected as the most stable for each prediction date it estimated the fluctuation yield for all samples and calculated mre fig 7 shows that mre for c tvdi 50 for most prediction dates across all study areas the mres were approximately 40 for four study areas in hebei and were approximately 20 40 for three study areas in ningxia the c pre mre fluctuated around 40 50 for most prediction dates in most study areas and some predictions in raoyang laoting and nangong hebei produced mre 50 thus c tvdi generally achieved good stability superior to c pre and could effectively estimate fluctuation yield we also tested the performance of the different input variables c tvdi and c pre using e1 which is a global measure of model efficiency the average e1 values were positive for all prediction dates with 0 91 0 87 0 93 0 92 0 94 0 90 and 0 93 in the case of c tvdi and 0 89 0 88 0 86 0 88 0 85 0 92 and 0 91 in the case of c pre for nangong botou laoting raoyang zhongning helan and litong respectively the average e1 values of c tvdi were higher than those of c pre in most study areas indicating that c tvdi had a better predictive result to explore the reasons for higher mre 50 and interannual variation we calculated the mre for each year sample for all prediction dates as shown in fig 8 generally c tvdi mre c pre for the corresponding year and mre 50 for most year samples in each study area differences between year samples were relatively large with all study areas exhibiting mre 50 for some years and some years occasionally had mre 100 nangong 2004 c pre 2007 c tvdi botou 2013 c tvdi laoting 2008 and 2010 both c tvdi and c pre raoyang 2012 both c tvdi and c pre zhongning 2010 c pre helan 2013 c pre and litong 2010 both c tvdi and c pre which presented more significant errors than others there was quite wide overall winter wheat actual fluctuation yield distribution from 2003 to 2016 for the seven districts 98 to 111 142 to 139 106 to 199 183 to 153 283 to 347 191 to 238 and 421 to 669 kg ha 1 for nangong botou laoting raoyang zhongning helan and litong respectively with no evidence to reject the null hypothesis that the sampled fluctuation yield values came from a normally distributed population shapiro wilk test p 0 05 absolute values of fluctuation yield for the years with the greater error were relatively small for example fluctuation yield for nangong 2004 9 kg ha 1 far less than the maximum 111 kg ha 1 the re of 2004 in each prediction date was high hence fig 8 shows mre 100 and mre 50 for 2004 for c pre and c tvdi respectively high re for any year would increase the mre for each prediction date fig 7 because the mre for each date was calculated from the re over all years 4 discussion 4 1 advantages of combining multiple factors the integral regression model transformed the time series data into a multiple linear regression model comprising 18 elements when using three factors sunshine temperature and precipitation or tvdi if this method is applied to a large scale the number of county level samples within the region is usually in the hundreds or thousands bolton and friedl 2013 li et al 2019 which is sufficient to solve the regression model however annual time series data is significantly limited for smaller scales such as county level this study had at most 14 year s data for each county which was smaller than the number of independent variables and hence difficult to solve in practice stepwise regression would violate integral regression model principles combining light temperature and water into a single factor reduced the number of independent variables in addition to other advantages discussed in section 2 3 3 the predicted results verified that the proposed data combination method decreasing from 18 to 6 independent variables was suitable for dynamic yield prediction therefore the approach is suitable for yield prediction with small data sets and small scales this paper did not compare the integrated light temperature water comprehensive factor with three factors we specifically investigated light temperature water comprehensive effects to contrast tvdi and precipitation without comparing the combined factor s advantages and disadvantages with all single factors 4 2 application and evaluation in some cases it is necessary to use data for a certain period before harvest to achieve early yield prediction and discard data including harvest period that can get better estimation results becker reshef et al 2010 compared with other prediction methods including statistical regression machine learning and deep learning integral regression does not need to consider the prediction time when variables can achieve the best yield prediction filippi et al 2020 kogan et al 2013 mkhabela et al 2011 or the time scale li et al 2019 which was used to aggregate time series variables data it only uses data from the start of the season to the prediction date that is needed as model input with any fixed date intervals and reduces time and energy consumption we separated yield into trend and fluctuation yields with trend yield prediction requiring only a time series with the year as the independent variable thus improving yield prediction accuracy requires the improvement of fluctuation yield prediction i e re 50 for fluctuation yield for most prediction dates in every study area mre 50 fig 7 the rmse fig 5 ranged from 4 to 102 kg ha 1 across all prediction dates and areas which only represented a small proportion compared with county level yields the e1 with averages 0 80 were higher or slightly smaller than that for values of 0 40 nagy et al 2018 or 0 91 nagy et al 2021 all these data indicate that our yield prediction process achieved excellent results at the county level the results also clearly showed that satellite imaging combined with weather data could provide useful information to develop dynamic models with high accuracy to predict yields at fixed dates for individual counties combining sunshine hours temperature and tvdi represents a functional simplification of light temperature water according to water availability the robustness and stability of c tvdi were superior to c pre indicating that tvdi contains more information than precipitation as also supported by ningxia having a more significant mre reduction magnitude than hebei from c pre to c tvdi fig 7 the background of tvdi reflects the irrigation information i e monitoring of soil moisture is consistent with other studies liang et al 2014 showed that the relationship between tvdi and precipitation was not significant in most areas of china where artificial irrigation has reduced or in some cases eliminated the influence of precipitation on drought chen et al 2015 validated the effectiveness of the tvdi as an index for assessing soil moisture in forest holzman et al 2014b holzman et al 2018 regarded tvdi as a crop water proxy in yield prediction another reason for the high accuracy of c tvdi might be that the precipitation data are represented by a single station value while the tvdi data are a spatial aggregation value precipitation varies widely in small spatial areas and is always challenging to characterize its importance to some extent tvdi can capture better spatial information with increasing inputs from march 21 to other prediction dates the fluctuation yield errors of c tvdi or c pre did not show a significant downward trend but were basically stable fig 5i this is consistent with the physical significance of the integral regression model the model considers the variable s effect on crops in the current prediction time point which can cause fluctuation yields to rise or fall for example the significant changes for the prediction trend in fig 5i showed that environmental variables had an enormous negative impact on crops when the variable in the next time point is added the new variable s influence will weaken or increase the variable s effect for the previous time point which will change the predicted fluctuation yield overall the prediction accuracy in the prediction dates was better for the second half for high mre values with low absolute fluctuation yield values very large or small absolute fluctuation yield values should not be included in the model the final step for dynamic prediction using integral regression was to solve the six element linear regression equation to estimate model parameters by least squares i e find the best function by minimizing the sum of squares of errors using fluctuation yield as the dependent variable however relatively low absolute values were susceptible to regression error if the dependent variable absolute values differed greatly between samples i e although distance or error to the fitted line was small the relative size was large for samples with small absolute values hence the samples with low absolute values had relatively high re compared to the samples with high absolute values for the same distance from the regression line in addition we compared the implications for the fluctuation yield values derived from different outlier test methods on the prediction except for the generalized esd test we calculated the average and standard deviation sd of the time series yields in each county and then removed the outliers if they were not within the range of 3sd han et al 2020 to explore the influence of different outlier processing on fluctuation yield prediction two counties botou and litong had inconsistent outliers for the two test methods in the case of the esd and 3sd methods botou had one and three outliers and litong had zero and three outliers respectively fig 9 shows the related fluctuation yield prediction results mre the mre in each prediction date with the 3sd test method was lower than that for the esd test method for both c tvdi and c pre also indicating that the smoother the time series of fluctuation yields i e eliminating more yield outliers with large fluctuation the better did the model perform 4 3 limitation and outlook one limitation of this study is that we used a static time frame to divide the growth stages of winter wheat in hebei and did not consider that phenology of winter wheat growth stages in the area varied from north to south in future research more detailed phenological data and remote sensing data should be used to improve accuracy of the analysis huang et al 2020 another limitation of this study is the mismatch in the spatial resolutions between tvdi and the meteorological data the remotely sensed tvdi was based on a 1 km 1 km grid whereas meteorological data were retrieved on point data these mismatches between the spatial resolutions will lead to a poor result so a possible improved approach is to use meteorological data based on a grid li et al 2019 the last limitation is that the method has a little capacity to predict fluctuation yield with low absolute value which requires a deeper exploration the ability to predict yield using the dryness index and meteorology parameters can be further improved further research should use other remote sensing drought indices such as a comprehensive application combining tvdi and regional water stress index rwsi the drought severity index dsi and the normalized difference drought index nddi gao et al 2011 indicated that tvdi is more suitable for monitoring mild drought normal and wet conditions but is not suitable for monitoring moderate and severe drought conditions which can be monitored by rwsi the dsi reflects drought conditions through capturing the crop growth stage and photosynthesis ndvi and the crop water stress condition et pet huang et al 2020 zhang et al 2016 the nddi is calculated through combining ndvi and normalized difference water index ndwi which has the highest correlations with soil moisture compared to other indices such as the temperature condition index tci and the vegetation health index vhi for rice paddy fields du et al 2018 5 conclusions this paper proposed a new light temperature water data combination for winter wheat yield dynamic prediction at the county level using remote sensing tvdi to replace the commonly used precipitation to do this we combined sunshine and temperature with tvdi into one comprehensive factor using an integral regression method to realize dynamic yield prediction we also compared prediction results for the new data combination with the meteorological combination of sunshine temperature and precipitation experimental results verified good and stable yield prediction accuracy for all dates from regreening to harvest periods at the county level with dynamic prediction results from the proposed combined sunshine temperature tvdi superior to the meteorological sunshine temperature precipitation this approach can achieve better prediction results and does not need to consider the prediction time and the time scale related to prediction variables remote sensing data tvdi can be combined with other meteorological or remote sensing parameters to estimate crop yield since tvdi contains more water information the results also showed that although modis tvdi acquires data at relatively coarse spatial resolution and most pixels include mixtures of crops tvdi has good applicability for yield prediction at the county level particularly in arid areas tvdi time series with higher spatial resolution may offer further improved performance future studies should compare prediction results between one comprehensive factor and three single factors for more extended time series data and investigate how to solve large re value problems credit authorship contribution statement zhonglin ji conceptualization methodology formal analysis writing original draft yaozhong pan writing review editing supervision nan li investigation resources declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was funded by the national high resolution earth observation system the civil part technology projects of china project no 20 y30f10 9001 20 22 and the national key research and development program of china project no 2018yfc1504603 the authors would like to thank junior fellow apprentices for their support 
24600,this paper describes integrating remote sensing and meteorological data for dynamic winter wheat yield prediction at fixed date intervals with an integral regression model in most cases both rainfall and irrigation supply the water needs of crops we postulated that meteorological precipitation could not fully represent the actual amount of water available to crops whereas the temperature vegetation dryness index tvdi can represent actual water which monitors soil moisture according to this meteorological and remote sensing data based on sunshine hours temperature and tvdi formed a light temperature water data combination which are the three most fundamental and critical factors related to crop growth the new data combination was used as the input variables of the integral regression model which could predict the crop yield at a fixed date interval of any length the dynamic results were then compared with that of the meteorology data combination sunshine hours temperature and precipitation we selected a total of seven county level areas in semi humid and arid regions in china the proposed dynamic prediction approach achieved good results at the county level from march 21 to maturity at 16 day intervals with predicted r2 0 94 and root mean squared error range of 15 54 121 01 kg ha 1 between predicted and actual yield with leave one year out cross validation for each prediction date the trend of dynamic prediction accuracy had a relatively stable state in addition tvdi contained more crop water information and prediction results using tvdi and meteorology were generally superior to that using only meteorology for semi humid and arid areas with the best results for arid regions thus integrating meteorology and tvdi could effectively dynamically predict yield at county level for most agroclimatic regions and particularly for arid regions the work has implications for dynamic yield prediction and improving prediction accuracy and can be extended to other areas keywords yield prediction winter wheat modis tvdi precipitation county level 1 introduction crop yield information is essential for food security grain trade and land management in a country or region timely and accurate crop yield prediction before harvest is critical for food security and administrative planning pagani et al 2018 zhao et al 2013 overall crop yield depends on multiple factors including climate soil type crop details etc which are also commonly used as parameters for crop yield prediction elavarasan et al 2018 light temperature and precipitation porter and semenov 2005 are critical and fundamental factors in climate and affect crop production cai et al 2019 kern et al 2018 kukal and irmak 2018 muchow et al 1990 rosenzweig and parry 1994 schmidhuber and tubiello 2007 trnka et al 2007 wit et al 2005 precipitation alone is insufficient to analyze water effects on crop growth and development for low precipitation regions actual crop evapotranspiration in these regions tends to be much higher than annual precipitation liu et al 2002 and water stress directly affects crop yield hence agricultural irrigation has become an essential source of water for crops most irrigation water and precipitation will eventually present in the soil as soil moisture and ensure water supply for crops however monitoring soil moisture content requires considerable human resources particularly for large scale monitoring with the development of remote sensing technology many metrics have been proposed to monitor or reflect the living environment and conditions for crop growth balaghi et al 2008 cai et al 2019 kern et al 2018 zhang et al 2016 vegetation indexes ban et al 2017 li et al 2014 liu et al 2019 e g normalized difference vegetation index ndvi enhanced vegetation index evi photosynthetic activities guan et al 2016 guanter et al 2014 and phenology bolton and friedl 2013 zeng et al 2016 zhang et al 2016 can be used to monitor crop growth conditions heat stress siebert et al 2014 land surface temperature lst and solar radiation holzman et al 2018 and water stress anderson et al 2011 inge et al 2002 can describe crop living environments these metrics are used to replace or integrate with climate factors to predict yield and the predictive results have improved elavarasan et al 2018 holzman et al 2018 mkhabela et al 2011 tucker 1979 based on parameterizing the relationship between lst and a vegetation index remote sensing temperature vegetation dryness index tvdi inge et al 2002 can be used to monitor soil moisture and drought on a large scale sun et al 2012 zhang et al 2014a some studies indicated that tvdi was suitable to assess soil water content at the roots of cultivated land crops holzman et al 2014a showing a significant negative correlation with soil moisture at 20 cm depth and in the surface soil scholars have defined a generalized relationship between crop yield and tvdi using a quadratic function holzman et al 2018 2014b intermediate values of tvdi in the quadratic function indicate normal water conditions for crop growth corresponding to maximum yield with values higher and lower than the intermediate values expressing water excess and stress conditions respectively corresponding to yield loss previous yield prediction research mostly focused on a single critical time or several discontinuous times before harvest with data for the corresponding period e g critical days month phenological stage bognár et al 2017 kogan et al 2013 li et al 2019 lopresti et al 2015 and day of year with maximum vegetation index values becker reshef et al 2010 dempewolf et al 2014 and rarely considered dynamic yield prediction however continuous dynamic yield prediction at fixed intervals through the growing season can provide superior support and guidance to decision makers and farmers compared with single or discontinuous timing for instance they can provide more information about yield change later in the growing season the methods used in dynamic yield prediction within the season include crop simulation models and empirical models cai et al 2019 feng et al 2020 when using crop models for yield prediction a significant limitation is related to the unknown weather from the prediction date to the maturity date basso and liu 2018 empirical models lack biophysical significance and need to consider the time scale used to aggregate data and predict yield crop yield can be separated into trend yield meteorological yield and random noise hai xia et al 2018 li et al 2019 zhang et al 2014b trend yield represents changes due to social and technological level factors whereas random noise includes accidental influences on grain yield and is usually ignored in practical applications salazar et al 2007 meteorological yield xi min 1985 is mainly affected by meteorological factors sunshine temperature and precipitation fisher fisher 1925 proposed a statistical but biologically significant integral regression model to predict crop yields dynamically which was initially applied to agrometeorology the biological significance was due to meteorological factors affecting meteorological yield changed with the crop growth time and their influence on meteorological yield also changed with time the model assumed the crop was affected by micro effects from meteorological factors for each moment and meteorological yield represented the accumulated micro effects over the growth period if each moment was defined by days the final meteorological yield was the definite integral of daily synergistic effects from meteorological factors on crop growth and development i e an integral regression of meteorological yield and meteorological factors over different time stages therefore dynamic yield prediction can be considered based on meteorological data of specific and arbitrary time length in this paper we integrated sunshine temperature and tvdi to form a light temperature water data combination and used the data combination and the integral regression model to predict winter wheat yield at a fixed date interval the specific objectives follow i to evaluate dynamic yield prediction results from the sunshine temperature and tvdi data combination and ii to compare dynamic yield prediction results from the data combination with results from a meteorological combination of sunshine temperature and precipitation 2 materials and methods 2 1 study areas we selected two typical regions hebei province and ningxia hui autonomous region in china mainly rain fed and irrigated agriculture respectively with large differences in precipitation as the study areas fig 1 shows the two areas hebei province 113 27 119 50 e 36 05 42 40 n semi humid region and ningxia hui autonomous region 104 17 107 39 e 35 14 39 23 n arid region which have different irrigation needs hebei province has vast plains with four distinct seasons and is one of the principal winter wheat growing regions in northern china it has a typical temperate continental monsoon climate with overall climatic conditions suitable for winter wheat growth the multi year average of accumulated active temperature 10 c frost free period and precipitation are approximately 4200 4500 c 130 220 days and 400 800 mm respectively the semi humid and humid agricultural areas are not purely fed by rain sprinkle or diversion irrigation on cultivated land during crucial growth periods helps ensure adequate soil water content ningxia hui autonomous region includes the ningxia plain one of the major wheat growing regions in ningxia and has a temperate continental arid and semi arid climate with annual average precipitation approximately 200 mm evaporation is intense approximately 5 10 fold the precipitation the multi year average of accumulated active temperature and frost free period are approximately 3300 c and 160 170 days respectively the terrain gradually tilts from southwest to northeast and the yellow river runs across the plain the geographical position and climate characteristics make the ningxia plain an important irrigation agricultural area we chose seven main winter wheat producing counties to analyze the effect of tvdi in the two areas with different degrees of irrigation on winter wheat yield prediction the four counties in hebei were nangong botou laoting and raoyang and the three counties in ningxia were zhongning helan and litong fig 1 2 2 data and processing table 1 summarizes the collected data including winter wheat statistical satellite remote sensing and meteorological data from 2002 to 2016 winter wheat statistical data were used to define the yield and remote sensing and meteorological data were used as yield predictors time series data for any year used in this paper were based on the study area s winter wheat phenology ningxia and hebei regions have similar latitude and hence similar winter wheat phenological periods but with subtle differences we obtained the multi year range for each phenology period from the agricultural time database of the ministry of agriculture and rural affairs of china http www zzys moa gov cn fig 2 shows that the winter wheat phenology period in hebei province was mid october to late june whereas in ningxia it was early october to early july 2 2 1 statistical data statistical data included winter wheat planting acreage and production at the county level from 2003 to 2016 from the statistical yearbook for hebei and ningxia guo et al 2020 jianxi et al 2019 the two data types were compiled by the local bureau of statistics based on reports from sub level towns and villages planting acreage ha was total planted area and production kg was total production each county s yield was obtained by dividing production by planting area kg ha 1 yield for one or two years for some areas was considerably higher or lower than the multi year yield trend from 2003 to 2016 and we treated such yield data as statistical outliers the generalized extreme studentized deviate esd test rosner 1983 was used to test the outliers fig 3 2 2 2 remote sensing data 1 landsat identifying winter wheat fields is an essential component of model development and implementation since this allows retrieval of winter wheat specific remotely sensed parameters since no winter wheat maps were available for seven areas a rasterized winter wheat map was produced landsat 5 thematic mapper tm and landsat 8 operational land imager oli satellite images were used to extract winter wheat spatial planting map data in hebei and ningxia for 2007 2010 and 2014 representing annual winter wheat planting information for 2003 2009 2010 2013 and 2014 2016 respectively the dates for these selected images were when crop stems and leaves were the lushest an object oriented classification method was used to produce the winter wheat map we initially pre processed the tm and oli images including radiometric calibration atmospheric correction and orthorectification we then used the scale evaluation tool estimation of scale parameter esp drǎgut et al 2010 to obtain optimal segmentation scales for tm and oli images and the images were subsequently segmented we defined multiple surface types including winter wheat from these object based images depending on the land cover characteristics finally we selected the appropriate number samples and suitable features and used nearest neighbor classification to determine classification rules to extract winter wheat planting information 2 modis we used the moderate resolution imaging spectroradiometer modis mod11a2 land surface temperature lst terra 8 day composite surface temperature level 3 version 6 1 km and mod13a2 normalized difference vegetation index ndvi terra 16 day composite vegetation index level 3 version 6 1 km from 2002 to 2016 available from https ladsweb modaps eosdis nasa gov to calculate tvdi data pre processing included batch geometric correction projection transformation and masking we used maximum value composite mvc holben 1986 to convert 8 day lst into 16 day synthetic data and there were 16 scenes in hebei and 18 scenes in ningxia based on the winter wheat phenology 2 2 3 meteorological data data were sourced from the china meteorological data sharing center http data cma cn including daily sunshine duration hour average temperature c and cumulative precipitation mm at the station level for 2002 2016 sunshine hour average temperature and cumulative precipitation refer to light temperature and water in agriculture respectively six of the seven selected study areas have meteorological stations and the other area has a station nearby see fig 1 therefore meteorological data represented the actual situation for each study area well the daily meteorological data were processed into 16 day interval to match the modis time scale e g march 21st data represented data summed over march 6 21 the predictors for meteorological data had different dimensions to eliminate dimensional and numerical size influences it was essential to ensure all predictors had a similar scale we used 1 x x m a x where x is the data m a x is the maximum data value and x is the scaled data mapped onto 1 1 this ensures that numerical proportionality remained unchanged between data for different times before and after scaling 2 3 methods the overall framework presented in fig 4 shows the order of procedures used in this study to develop and evaluate the dynamic wheat yield prediction model 2 3 1 calculate tvdi we calculated tvdi as follows inge et al 2002 2 tvdi lst ls t min ls t max ls t min where lst is the observed surface temperature k for the given pixel lstmin and lstmax are the minimum and maximum temperature for ndvi pixels defining the wet and dry edge holzman et al 2014b inge et al 2002 respectively and tvdi 0 1 to ensure that the tvdi and the meteorological variables maintained the same dimension eq 1 was used to scale the tvdi we aggregated tvdi data from 1 km resolution to the county level to match the winter wheat yield and meteorological data first winter wheat spatial planting data derived in section 2 2 2 was defined as the mask according to the mask pixels dominated by winter wheat were selected as pure tvdi pixels i e sub pixel proportion 60 wheat land the proportion for each pixel was calculated as 3 p c t m a s k tvdi p i x e l 100 where p c t is the percentage of winter wheat planting area at 1 1 km granularity for each tvdi pixel tvdi p i x e l is the grid unit for the long term sequence remote sensing data in the study area m a s k is the area of winter wheat planting map pixels corresponding to the tvdi pixel spatial range then average tvdi over the pixels with a proportion 60 within a county was calculated for the long time series 2 3 2 separating trend and fluctuation yield yield trend yield and fluctuation yield are related as 4 y y t δ y where y y t and δ y represent yield trend yield and fluctuation yield respectively the factors affecting trend yield change smoothly over time year so trend yield can be considered as a function of time we used a linear moving average to obtain the trend yield i e treated the time series yield as linear over the specific time stage reflecting the overall historical yield trend specifically we took each year as the center to obtain multi year yields within the time window the multi year yields were used to establish a linear fitted equation and fitted yields of corresponding multiple years were obtained based on the fitted equation with continuously sliding time from 2003 to 2016 equations established with different years as the center changed position constantly and slid backward thus multiple fitted yields could be generated depending on window size for each year and the average of the multiple yields was regarded as the actual trend yield for that year the fitted straight line and trend yield for each year was calculated as 5 y i t a i b i t and 6 y i t 1 q j q y i t respectively where y i t and y i t are linear fitted and actual trend yield at time point t t represents year a i and b i are constants and coefficients for the fitted line respectively i n k 1 k is the specific time stage and k 5 in this paper i e the size of moving window n is the number of years of sample data and j 1 2 q with q 1 2 3 k 3 2 1 is the number of linear equations in calculation year t trend yield was assumed to be linear and smoothly changing and the remainder was considered as fluctuating yield meteorological factors strongly influence fluctuation yield so it is sometimes referred to as meteorological yield or yield anomaly li et al 2019 irrigation quantity is directly related to precipitation which also impacts fluctuation yield irrigation affects a small proportion of fluctuation yield and precipitation greatly affects fluctuation yield hence this paper assumed the fluctuation yield explained by sunshine temperature and tvdi included the fluctuation yield explained by sunshine temperature and precipitation we calculated δ y y y t after obtaining y t for each year the trend yield describes a large yield proportion and only a trend yield model can achieve good yield estimation however we predicted fluctuation yield further to improve yield accuracy 2 3 3 combining light temperature water crops are affected by light temperature and water every day during the growing period and these factors are not independent but jointly affect crop growth for example temperature affects crops direct effects and at the same time temperature also affect crops through affecting precipitation indirect effects therefore combining multiple individual factors into a comprehensive factor at each time point to represent the overall growing environment situation is more consistent with physical crop growth we used path analysis aycicek and yildirim 2006 bello and abdulmaliq 2010 to combine light temperature and water into a comprehensive factor to simulate comprehensive effects from these factors on crop growth and development at each time stage path analysis can determine direct effects from independent variables data from three factors on different dates on the dependent variable fluctuation yield and indirect impacts from this independent variable on the dependent variable through other independent variables we used direct effects at each time point as weights multiplying each factor by the weight and summing the factors hence three factors were combined into one comprehensive factor i e sunshine temperature and tvdi combined into a comprehensive factor defined as c tvdi and sunshine temperature and precipitation were combined into the other comprehensive factor defined as c pre the former served as the experimental group and the latter as the control group 2 3 4 dynamic prediction model we used an integral regression model to predict fluctuation yield where fluctuation yield was the dependent variable and c pre or c tvdi were the independent variables the basis for integral regression was that the crop was affected by micro effects from factors for each time point and fluctuation yield represented the accumulated micro effects over the growth period i e the growth period can be divided into n stages within a given time scale producing an n m element linear regression problem where m is the number of factors for the original three factors light temperature and water m 3 whereas m 1 for c pre or c tvdi in this study the regression equation would have many independent variables n and it was challenging to solve integral regression reduced the number of variables and expressed factor influences from emergence to maturity on crop yield integral regression uses the orthogonal polynomial of time to simplify partial regression coefficients for factors that change with time i e reducing independent variables of factors in multiple continuous periods and at the same time reducing information loss we then constructed multi regression models with the new variables thus integral regression can identify factors impacts with continuous time on crop growth integral regression fisher 1925 can be generally expressed as 7 δ y c 0 τ α t x t d t where x t is the single comprehensive factor for c pre or c tvdi in this paper according to the original application of integral regression i e using the three factors light temperature and water as independent variables the regression is expressed as 8 δ y c f a c t o r k 0 τ α f a c t o r t x f a c t o r t d t where f a c t o r represents each factor k 3 δ y is the fluctuation yield c is a constant term α t is the regression coefficient a continuous function expressing factor x influence on fluctuation yield from time t to t δ t and τ is the growth period for calculation convenience α t is generally expanded as an orthogonal polynomial function of time and for this study we used a fifth order polynomial 9 α t α 0 f 0 t α 1 f 1 t α 2 f 2 t α 3 f 3 t α 4 f 4 t α 5 f 5 t where f i t is an orthogonal polynomial of time derived from the chebyshev orthogonal polynomial α i is the partial regression coefficient and i 1 2 5 substituting 9 into 7 10 δ y c α 0 f 0 t x t d t α 1 f 1 t x t d t α 5 f 5 t x t d t let 11 p i f i t x t d t then 10 can be expressed as the linear regression 12 δ y c α 0 p 0 α 1 p 1 α 2 p 2 α 3 p 3 α 4 p 4 α 5 p 5 as discussed above we divided the growth period into n stages with a unit of days i e 13 p i j 1 n f i j t x j t thus based on 11 and 12 the n element linear regression can be expressed as a six element linear regression equation and the fluctuation yield prediction model can be solved yield prediction began on march 21 stem elongation and continued to maturity at a 16 day interval from emergence to each prediction date the number of 16 day interval data in the period was the number of divided stages n the time series data for the 16 day interval was the input to the integral regression model consider march 21 of hebei counties as an example for the period of emergence to march 21 the number of 16 day interval data was 10 and the period was divided into 10 stages the 10 stage time series data for c pre or c tvdi data were used as independent variables with fluctuation yields as the dependent variable for the integral regression model to predict the march 21 yield fluctuation 2 3 5 model evaluation and comparison to render the experiment more reliable we used leave one year out cross validation li et al 2019 to evaluate yield prediction performance on each date a model was first trained using the data with one year removed and then the trained model was used to predict the yield of the missing year this procedure was performed for each year from 2003 to 2016 resulting in maximum 14 years fluctuation yield predictions according to the two purposes of the experiment we conducted two evaluations the first assessed the yield the metrics for evaluating dynamic yield prediction process performance were the coefficient of determination r2 and the root mean squared error rmse they were used to describe relationships between recorded yield and predicted yield the second assessed the fluctuation yield the reason was that we needed to compare c tvdi and c pre in addition to show the prediction of fluctuation yield more intuitively and analyze the factors that affect the accuracy relative error re and mean relative error mre kamilaris and prenafeta boldu 2018 were used to assess integral regress model performance and stability these measures were defined as follows 14 r 2 i 1 n y i y 2 i 1 n y i y i 2 i 1 n y i y 2 15 r m s e 1 n n 1 y y 2 16 r e y i y i y i 100 and 17 m r e i 1 m y i y i y i m 100 where y is recorded yield y is mean recorded yield y is predicted yield n is sample number y represents actual fluctuation yield δ y y represents predicted fluctuation yield and m represents the number of fluctuation yield nash sutcliffe efficiency e1 was also calculated e1 is a modified version of the coefficient of efficiency nash and sutcliffe 1970 defined as one minus the sum of the absolute squared differences between the predicted yield and the observed yield data normalized by the variance of the observed yield data during the period under investigation 18 e 1 1 i 1 n o i p 2 i 1 n o i o 2 where o i is actual fluctuation yielddata p i is predicted fluctuation yield values and o is mean of actual fluctuation yield values values of e1 range between 1 0 which is perfect fit and an efficiency lower than zero indicates that the average value of actual fluctuation yield would have been a better predictor than the model 3 results 3 1 dynamic prediction results the proposed approach integrating sunshine temperature and tvdi was suitable for dynamic yield prediction we obtained multi year fluctuation yield prediction models and predicted results on each date by the leave one year out cross validation the predicted yield results included predicted fluctuation yields and trend yields the relationships between predicted and recorded yields in fig 5 show predicted r2 0 95 for all cases the shapiro wilk test for predicted r2 values of each area provided p values of 0 46 0 02 0 18 0 00 0 26 0 19 and 0 06 in nangong botou laoting raoyang zhongning helan and litong respectively this indicated that most areas passed the test results p 0 05 and there was no artificial effect on the results the rmses were in the range of 15 54 19 94 kg ha 1 for nangnong 21 49 41 37 kg ha 1 for botou 16 07 36 13 kg ha 1 for laoting 21 64 43 75 kg ha 1 for raoyang 47 58 59 00 kg ha 1 for zhongning 32 09 48 15 kg ha 1 for helan and 49 37 121 01 kg ha 1 for litong these values were very small compared with the mean recorded yields from 2003 to 2016 5073 97 5494 89 6012 09 6044 70 4711 00 4852 15 and 5726 25 kg ha 1 for nangong botou laoting raoyang zhongning helan and litong respectively we used averages of each prediction date to assess the trend of dynamic prediction accuracy evaluation metrics predicted r2 and rmse from march 21 to june 25 or july 11 fig 5i the trends in nangong zhongning and helan had small magnitudes with values changing around the mean lines the trends in botou laoting raotang and litong also had little volatility however there were significant changes at march 21 may 8 may 24 and april 6 overall dynamic prediction results did not present a clear upward trend but remained relatively stable 3 2 tvdi and precipitation in study areas fig 6 shows multi year average precipitation and tvdi for each time throughout the growing season for all study areas ningxia is in an arid region and precipitation in each period was less than that for hebei in the same period ningxia needs more irrigation than hebei to ensure winter wheat growth consequently ningxia attached great importance to irrigation facilities and ditches and hence county level 1 km pixels contained many ditches and soil water information with smaller tvdi than hebei thus ningxia tvdi data contained more water information 3 3 comparing c tvdi and c pre we compared the performances of the different input variables c tvdi and c pre using mre including two aspects for each prediction date re over all years fig 7 and each year re for all prediction dates fig 8 the model with maximum trained r2 in the cross validation process was selected as the most stable for each prediction date it estimated the fluctuation yield for all samples and calculated mre fig 7 shows that mre for c tvdi 50 for most prediction dates across all study areas the mres were approximately 40 for four study areas in hebei and were approximately 20 40 for three study areas in ningxia the c pre mre fluctuated around 40 50 for most prediction dates in most study areas and some predictions in raoyang laoting and nangong hebei produced mre 50 thus c tvdi generally achieved good stability superior to c pre and could effectively estimate fluctuation yield we also tested the performance of the different input variables c tvdi and c pre using e1 which is a global measure of model efficiency the average e1 values were positive for all prediction dates with 0 91 0 87 0 93 0 92 0 94 0 90 and 0 93 in the case of c tvdi and 0 89 0 88 0 86 0 88 0 85 0 92 and 0 91 in the case of c pre for nangong botou laoting raoyang zhongning helan and litong respectively the average e1 values of c tvdi were higher than those of c pre in most study areas indicating that c tvdi had a better predictive result to explore the reasons for higher mre 50 and interannual variation we calculated the mre for each year sample for all prediction dates as shown in fig 8 generally c tvdi mre c pre for the corresponding year and mre 50 for most year samples in each study area differences between year samples were relatively large with all study areas exhibiting mre 50 for some years and some years occasionally had mre 100 nangong 2004 c pre 2007 c tvdi botou 2013 c tvdi laoting 2008 and 2010 both c tvdi and c pre raoyang 2012 both c tvdi and c pre zhongning 2010 c pre helan 2013 c pre and litong 2010 both c tvdi and c pre which presented more significant errors than others there was quite wide overall winter wheat actual fluctuation yield distribution from 2003 to 2016 for the seven districts 98 to 111 142 to 139 106 to 199 183 to 153 283 to 347 191 to 238 and 421 to 669 kg ha 1 for nangong botou laoting raoyang zhongning helan and litong respectively with no evidence to reject the null hypothesis that the sampled fluctuation yield values came from a normally distributed population shapiro wilk test p 0 05 absolute values of fluctuation yield for the years with the greater error were relatively small for example fluctuation yield for nangong 2004 9 kg ha 1 far less than the maximum 111 kg ha 1 the re of 2004 in each prediction date was high hence fig 8 shows mre 100 and mre 50 for 2004 for c pre and c tvdi respectively high re for any year would increase the mre for each prediction date fig 7 because the mre for each date was calculated from the re over all years 4 discussion 4 1 advantages of combining multiple factors the integral regression model transformed the time series data into a multiple linear regression model comprising 18 elements when using three factors sunshine temperature and precipitation or tvdi if this method is applied to a large scale the number of county level samples within the region is usually in the hundreds or thousands bolton and friedl 2013 li et al 2019 which is sufficient to solve the regression model however annual time series data is significantly limited for smaller scales such as county level this study had at most 14 year s data for each county which was smaller than the number of independent variables and hence difficult to solve in practice stepwise regression would violate integral regression model principles combining light temperature and water into a single factor reduced the number of independent variables in addition to other advantages discussed in section 2 3 3 the predicted results verified that the proposed data combination method decreasing from 18 to 6 independent variables was suitable for dynamic yield prediction therefore the approach is suitable for yield prediction with small data sets and small scales this paper did not compare the integrated light temperature water comprehensive factor with three factors we specifically investigated light temperature water comprehensive effects to contrast tvdi and precipitation without comparing the combined factor s advantages and disadvantages with all single factors 4 2 application and evaluation in some cases it is necessary to use data for a certain period before harvest to achieve early yield prediction and discard data including harvest period that can get better estimation results becker reshef et al 2010 compared with other prediction methods including statistical regression machine learning and deep learning integral regression does not need to consider the prediction time when variables can achieve the best yield prediction filippi et al 2020 kogan et al 2013 mkhabela et al 2011 or the time scale li et al 2019 which was used to aggregate time series variables data it only uses data from the start of the season to the prediction date that is needed as model input with any fixed date intervals and reduces time and energy consumption we separated yield into trend and fluctuation yields with trend yield prediction requiring only a time series with the year as the independent variable thus improving yield prediction accuracy requires the improvement of fluctuation yield prediction i e re 50 for fluctuation yield for most prediction dates in every study area mre 50 fig 7 the rmse fig 5 ranged from 4 to 102 kg ha 1 across all prediction dates and areas which only represented a small proportion compared with county level yields the e1 with averages 0 80 were higher or slightly smaller than that for values of 0 40 nagy et al 2018 or 0 91 nagy et al 2021 all these data indicate that our yield prediction process achieved excellent results at the county level the results also clearly showed that satellite imaging combined with weather data could provide useful information to develop dynamic models with high accuracy to predict yields at fixed dates for individual counties combining sunshine hours temperature and tvdi represents a functional simplification of light temperature water according to water availability the robustness and stability of c tvdi were superior to c pre indicating that tvdi contains more information than precipitation as also supported by ningxia having a more significant mre reduction magnitude than hebei from c pre to c tvdi fig 7 the background of tvdi reflects the irrigation information i e monitoring of soil moisture is consistent with other studies liang et al 2014 showed that the relationship between tvdi and precipitation was not significant in most areas of china where artificial irrigation has reduced or in some cases eliminated the influence of precipitation on drought chen et al 2015 validated the effectiveness of the tvdi as an index for assessing soil moisture in forest holzman et al 2014b holzman et al 2018 regarded tvdi as a crop water proxy in yield prediction another reason for the high accuracy of c tvdi might be that the precipitation data are represented by a single station value while the tvdi data are a spatial aggregation value precipitation varies widely in small spatial areas and is always challenging to characterize its importance to some extent tvdi can capture better spatial information with increasing inputs from march 21 to other prediction dates the fluctuation yield errors of c tvdi or c pre did not show a significant downward trend but were basically stable fig 5i this is consistent with the physical significance of the integral regression model the model considers the variable s effect on crops in the current prediction time point which can cause fluctuation yields to rise or fall for example the significant changes for the prediction trend in fig 5i showed that environmental variables had an enormous negative impact on crops when the variable in the next time point is added the new variable s influence will weaken or increase the variable s effect for the previous time point which will change the predicted fluctuation yield overall the prediction accuracy in the prediction dates was better for the second half for high mre values with low absolute fluctuation yield values very large or small absolute fluctuation yield values should not be included in the model the final step for dynamic prediction using integral regression was to solve the six element linear regression equation to estimate model parameters by least squares i e find the best function by minimizing the sum of squares of errors using fluctuation yield as the dependent variable however relatively low absolute values were susceptible to regression error if the dependent variable absolute values differed greatly between samples i e although distance or error to the fitted line was small the relative size was large for samples with small absolute values hence the samples with low absolute values had relatively high re compared to the samples with high absolute values for the same distance from the regression line in addition we compared the implications for the fluctuation yield values derived from different outlier test methods on the prediction except for the generalized esd test we calculated the average and standard deviation sd of the time series yields in each county and then removed the outliers if they were not within the range of 3sd han et al 2020 to explore the influence of different outlier processing on fluctuation yield prediction two counties botou and litong had inconsistent outliers for the two test methods in the case of the esd and 3sd methods botou had one and three outliers and litong had zero and three outliers respectively fig 9 shows the related fluctuation yield prediction results mre the mre in each prediction date with the 3sd test method was lower than that for the esd test method for both c tvdi and c pre also indicating that the smoother the time series of fluctuation yields i e eliminating more yield outliers with large fluctuation the better did the model perform 4 3 limitation and outlook one limitation of this study is that we used a static time frame to divide the growth stages of winter wheat in hebei and did not consider that phenology of winter wheat growth stages in the area varied from north to south in future research more detailed phenological data and remote sensing data should be used to improve accuracy of the analysis huang et al 2020 another limitation of this study is the mismatch in the spatial resolutions between tvdi and the meteorological data the remotely sensed tvdi was based on a 1 km 1 km grid whereas meteorological data were retrieved on point data these mismatches between the spatial resolutions will lead to a poor result so a possible improved approach is to use meteorological data based on a grid li et al 2019 the last limitation is that the method has a little capacity to predict fluctuation yield with low absolute value which requires a deeper exploration the ability to predict yield using the dryness index and meteorology parameters can be further improved further research should use other remote sensing drought indices such as a comprehensive application combining tvdi and regional water stress index rwsi the drought severity index dsi and the normalized difference drought index nddi gao et al 2011 indicated that tvdi is more suitable for monitoring mild drought normal and wet conditions but is not suitable for monitoring moderate and severe drought conditions which can be monitored by rwsi the dsi reflects drought conditions through capturing the crop growth stage and photosynthesis ndvi and the crop water stress condition et pet huang et al 2020 zhang et al 2016 the nddi is calculated through combining ndvi and normalized difference water index ndwi which has the highest correlations with soil moisture compared to other indices such as the temperature condition index tci and the vegetation health index vhi for rice paddy fields du et al 2018 5 conclusions this paper proposed a new light temperature water data combination for winter wheat yield dynamic prediction at the county level using remote sensing tvdi to replace the commonly used precipitation to do this we combined sunshine and temperature with tvdi into one comprehensive factor using an integral regression method to realize dynamic yield prediction we also compared prediction results for the new data combination with the meteorological combination of sunshine temperature and precipitation experimental results verified good and stable yield prediction accuracy for all dates from regreening to harvest periods at the county level with dynamic prediction results from the proposed combined sunshine temperature tvdi superior to the meteorological sunshine temperature precipitation this approach can achieve better prediction results and does not need to consider the prediction time and the time scale related to prediction variables remote sensing data tvdi can be combined with other meteorological or remote sensing parameters to estimate crop yield since tvdi contains more water information the results also showed that although modis tvdi acquires data at relatively coarse spatial resolution and most pixels include mixtures of crops tvdi has good applicability for yield prediction at the county level particularly in arid areas tvdi time series with higher spatial resolution may offer further improved performance future studies should compare prediction results between one comprehensive factor and three single factors for more extended time series data and investigate how to solve large re value problems credit authorship contribution statement zhonglin ji conceptualization methodology formal analysis writing original draft yaozhong pan writing review editing supervision nan li investigation resources declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was funded by the national high resolution earth observation system the civil part technology projects of china project no 20 y30f10 9001 20 22 and the national key research and development program of china project no 2018yfc1504603 the authors would like to thank junior fellow apprentices for their support 
24601,land use suitability analysis is of significance for the planning and management of cities the main objective of this study was to develop a spatial model for land suitability assessment for peri urban agricultural development with the use of geographic information systems gis integrated with multi criteria decision analysis mcda techniques physical attributes land use natural resources accessibility geology and soil properties were recognised as the key factors influencing land suitability for peri urban agriculture in the study area the study follows an integrated approach for the suitability assessment of agricultural development in pendik district of istanbul turkey through integrating fuzzy logic model analytical hierarchy process ahp and the technique for order preference by similarity to ideal solution topsis methods suitability classification of land was done in gis by using the specified fuzzy membership functions the weights of the main criteria and their sub criteria were determined through the ahp method eight different zones were ranked according to agricultural development priority by the topsis method the area classified as suitable amounts to 27 of the total area with 0 07 classified as unsuitable the highly suitable areas are mainly located in the north where there are villages specialised in agricultural production the prioritisation of the suitable agricultural areas would assist in land use planning and urban management keywords peri urban agricultural land suitability analysis fuzzy logic ahp topsis pendik turkey 1 introduction the phenomenon of urban agriculture 1 1 the term urban agriculture refers to both urban and peri urban agriculture and the term is interchangably used in the text to represent either urban or peri urban agriculture has been given the most attention over the past decades urban agriculture refers to any agricultural activity such as production of food or non food products occuring on the populated urban zones or the peri urban fringes of cities and towns freeman 1991 smit et al 1996 hovorka 2005 urban agriculture comprises a range of activities including crop livestock horticulture and aquaculture production undertaken at any scale in open spaces mainly located in the outskirts of urban land the boundary between urban and peri urban is along a urban rural gradient which is typically not spatially zoned therefore it is difficult to make a spatial distinction between distinctly urban and clearly rural areas which exhibits considerable heterogeneity in different regions and cities in the world schneider and woodcock 2008 the nature of peri urban areas cannot be generalised because these are characterised by a number of factors including economic characteristics and infrastructural set up of the urban centre the region and the country historical and socio cultural characteristics of the area and its ecological functions and geo physical features the urbanisation process is coupled with unwanted consequences which range from farmland loss to deforestation air and water pollution climate change social segregation and creation of peri urban areas which have socio economic consequences such as condensed poverty and income inequality orsini et al 2013 rimal et al 2017 although urban development increasingly takes place in the brownfield or infill sites urban expansion process has led to agricultural land consumption that resulted in increasing loss of fertile farmlands munton 2009 ustaoglu and williams 2017 in the urban periphery the conversion of agricultural land to urban uses is strongly influenced by land rents and prices of other land uses such as housing with its higher rents outbidding the other land uses ustaoglu and williams 2017 therefore in the urban fringe there exists different market conditions with higher land prices associated with a fragmented structure and complex pattern of ownership and property rights munton 2009 the complex and heterogeneous land uses is a reflection of a dynamic change process as certain components of these areas have grown due to high degree of land transition and conversion for urban purposes and others are characterised as idle and marginal open spaces gant et al 2011 zasada 2011 the poor management of land uses in the peri urban areas has led to deplation of the resources such as air water and soil as well as the deterioration of the quality of living the development of urban and peri urban agriculture is one of the major strategies that has been adopted particularly in developing countries to address negative consequences of farmland conversion in the periphery and to improve wellbeing of urban residents orsini et al 2013 the unprecedented growth in urban population and income has increased food requirements of cities which have continuously increased in recent years and is expected to do so in the near future many cities have restricted access to high quality food due to reduced accessibility to markets financial restrains and inadequate transport provision thomas 2010 a sustainable agriculture approach aims at meeting society s food and textile needs on the basis of healthy environment economic profitability and social and economic equity fao 2014 this highlights the importance of foodshed which is also known as local food production capacity galzki et al 2015 galzki et al 2017 or local foodshed carrying capacity peters et al 2016 it is defined as the geography of urban food supply that verifies the linkages between food producing and food consuming regions across different scales the concept initially emerged in the early twentieth century with the study of mackaye 1920 that researched the linkages between cities and agricultural hinterlands through supply chains this concept was revisited by getz 1991 for a better understanding of how food systems work and emphasising the benefits of local food systems and local food self sufficiency there are economic environmental and societal benefits provided by local foodsheds these include local economic impacts increased food security reduction in energy consumption increased use of sustainable production and distribution methods and enhancement of social justice and equity within a community galzki and mulla 2017 in this context urban agriculture is related to growth processing and distribution of food and non food products within urban or peri urban areas of a city or a region thereby contributing to local food production capacity of that urban area or region the calculation of foodshed is based on two methods the relationship between location of food production and its consumer market is searched in the first approach karg et al 2016 the second approach on the other hand focuses on the production capacity of potentially available land for urban and peri urban agriculture the current analysis of site suitability assessment of peri urban agriculture will therefore serve as an input for foodshed calculations through assessment of production capacity of suitable land for peri urban agriculture by contrast to rural agriculture urban agriculture is linked to local urban economy and the ecological system that supports it gradinaru et al 2018 nevertheless urban agriculture is concerned with human environment interactions and urban rural relations with an aim of promoting a sustainable way for development which give rise to different functions of urban agriculture mougeot 2006 in addition to food and fuel production urban agriculture plays a crucial role in offering other forms of socio economic functions related to educational or recreational activities of urban residents orsini et al 2013 in many regions of the world netherlands and uk among others urban agriculture has been combined with different forms of recreational activities e g hobby farming camping horse riding etc and provides a location for environmental training and education zasada 2011 such multi functional approaches to urban agriculture can lead to diversification of farm income and therefore contribute to economic wellfare of residents in the light of these explanations growth strategies have to be specified for the management of peri urban areas and a new urban rural interface has to be specified that would assist in sustaining urban food security providing new employment opportunities for peri urban and rural communities reducing rural urban segragation and reversing the ongoing trends of resource deplation gutman 2007 ayambire et al 2019 recent studies pointed out that urban agriculture can improve environmental quality through mitigation of urban heat island effect qıu et al 2013 mancebo 2018 marando et al 2019 and reducing the vulnerability of settlements to flooding and draught worku 2017 kalantari et al 2018 urban agriculture can also assist in improving ecosystems and biodiversity lin et al 2015 wilhelm and smith 2018 stenchly et al 2019 spyra et al 2020 providing outdoor spaces for recreational activities rossi et al 2016 hammer et al 2017 komossa et al 2019 komossa et al 2020 contributing to food security yaro et al 2016 olsson et al 2016 khumalo and sibanda 2019 and reducing poverty by providing extra sources of income for the poor zezza and tasciotti 2010 lwasa et al 2014 mugisa et al 2017 though the case studies on urban agriculture has increased considerably in the last decades there are still significant challenges for integrating urban agriculture in an increasingly spatially constrained urban landscapes lin et al 2015 in this regard spatial quantitative analysis provides the means for spatial planning and management given that such analysis focuses on potential locations of development by investigating attributes including proximity to environmental features access to roads jobs and markets geo physical and climatic conditions and incompatible land uses that shape where urban agriculture development is possible mather et al 2006 the literature on land use location suitable sites and patterns of urban agricultural development has been growing most recently one strand of literature has examined land cover use change dynamics and the patterns of land use in the peri urban areas using geo information and remote sensing technologies vizzari 2011 appiah et al 2015 wang and qiu 2017 willkomm et al 2019 mathan and krishnaveni 2020 another strand focuses on land suitability analysis and site selection for the urban and rural agriculture using different methods including multi criteria decision analysis mcda gis fuzzy logic expert systems artificial neural networks and cellular automata modelling thapa and murayama 2008 bagheri et al 2013 weerakoon 2014 appiah et al 2015 kong et al 2016 gomes et al 2019 although the use of mcda integrated with fuzzy methods for the suitability assessment of agricultural sites is recognised its adoption for mapping the suitability of urban agricultural sites is limited as an example of fuzzy logic method chrobak et al 2020 used fuzzy based techniques for the standardisation and aggregation of assessment criteria in the vineyard site selection problem amini et al 2020 integrated fuzzy logic mcda and gis for the assessment of agricultural land suitability in their selected case study area in iran a similar approach was followed by pilevar et al 2020 which integrated fuzzy mcda and gis for land suitability assessment in semi arid regions for wheat and maize farming a more recent study by prabakaran et al 2021 used a combination of fuzzy logic and support vector machines for the assesment and prediction of agricultural productivity see also oh et al 2020 analytical hierarchy process ahp is one of the most commonly used approaches that is applied to resolve highly complex decision making problems such as the multi criteria data utilised in the site suitability assessment mosadeghi et al 2015 musakwa 2018 pilevar et al 2020 it is considered as a powerful technique in solving complicated and unstructured problems where these may present interactions and correlations among different objectives and goals cakir and canbolat 2008 this technique is useful for the decision makers as it is possible to organize critical aspects of a problem into a hierarchical structure javalgi et al 1989 ahp method is used to determine the global weights with the use of pairwise comparison matrices where each criterion is compared in terms of relative importance with respect to its pairwise counterpart in turkey the research that incorporated the ahp approach for the prioritisation of criteria mainly focus on reallocation of agricultural land cay and uyan 2013 urban management in earthquake sensitive areas tudes and yigiter 2010 rural agricultural land suitability akıncı et al 2013 bozdag et al 2016 dedeoglu and dengiz 2019 green space development ustaoglu and aydınoglu 2020a and others the research on site selection of urban and peri urban agriculture in turkey is scarce to our knowledge there is only one research that proposed agricultural belt around the city of bartın turkey based on spatial suitability and evaluation of landscape metrics gormus et al 2019 other research mainly focused on rural agricultural land applying gis ahp or other hybrid methods for the land suitability assessment bozdag et al 2016 selim et al 2018 tercan and dereli 2020 everest 2021 despite the advances achieved with the use of traditional methods including ahp and gis approaches in handling with both qualitative and quantitative criteria of the multi criteria decision problems the fuziness existing in real world problems results in increasing uncertainty in the development of suitability values which stems mainly from fuzziness in land suitability classification zhang et al 2015 considering conventional methods rather than using fuzzy approach in the standardisation of the assessment criteria based on gis may lead to imprecise judgements of decision makers in the site selection problem bouyssou et al 2000 zhang et al 2015 ustaoglu and aydınoglu 2020b to cope with this issue different fuzzy membership functions can be developed for the classification of land suitability values i e fuzzy logic theory the technique for order preference by similarity to ideal solution topsis is another powerful method in dealing with multi criteria decision making problems in real world topsis assists in decision makers to organise the problems to be solved and then to analyse compare and rank alternative solutions chang et al 2012 the studies in the literature either used one of the techniques alone thapa and murayama 2008 thapa et al 2011 weerakoon 2014 or integrated different methodologies other than fuzzy logic and topsis bagheri et al 2013 smith et al 2017 majumdar 2020 sonneveld et al 2021 in the urban agriculture site suitability analysis topsis system is used to evaluate and classify the suitable land so that the highest suitability areas can be ranked and prioritised for the purpose of urban and peri urban agriculture development the use of topsis method is widely used for the site suitability analysis of urban land liu et al 2014 ramya and devedas 2019 xu et al 2021 but its use in sitting peri urban agricultural land use is scarce therefore this paper serves for the purpose of integrating topsis system to the gis fuzzy logic and multi criteria analysis which considerably advanced map overlay approaches to site suitability analysis mcharg 1969 and ranking of suitability classes with the topsis approach resulting in more precise judgements in the site selection problem to our knowledge no studies have adopted such an integrated approach utilising locally available criteria including geo physical factors socio economic conditions natural resources land use etc for specifying urban and peri urban agricultural suitable sites therefore our study aims at contributing to the literature through providing a hybrid method of fuzzy logic mcda topsis for agricultural site selection in the peri urban areas of our selected study area in istanbul e g pendik district the methodological process applied and the relationships between techniques used in the study are summarised in fig 1 data collection data preparation and data processing steps were performed in gis the multi criteria analysis framework and its components were developed based on the review of the literature and expert views the ahp method was used to determine the global weights of the selected criteria with the use of pairwise comparison matrices for the fuzzy modeling approach fuzzy membership functions were defined from the literature and raster maps from fuzzy logic were produced accordingly once the ahp weights were obtained the weights were used for the spatial overlay analysis of the fuzzy based raster maps conducted with the use of gis the resultant suitability maps were passed to the topsis analysis where the suitable lands were prioritised and ranked 2 study area data and methods 2 1 the study area and data sources the study area is a plain district that is located on the eastern part of istanbul metropolitan area fig 2 it is surrounded by kartal sultanbeyli district in the west tuzla district in the east şile in the north and marmara sea in the south the climate in the district varies from cold temperate to mild climate with the average daily temperatures of 6 1 in january and 23 5 in july the geographical area of the district is approximately 179 km2 with a total population of 700 000 as per 2017 census and population density of around 4 inhabitants per square kilometer the district is divided into 36 neighbourhoods varying in terms of size and extent industry and commerce are the main occupation of the people residing in the southern part of pendik district whereas in the north people are more occupied with agriculture and forestry arable land permanent crops greenhouses and non irrigated agricultural land are the principal agricultural land uses which are surrounded by a scattered pattern of natural vegetation of pastures and grassland and forests pendik governorship 2016 the rest of the land comprises urban uses in the south which are industrial and commercial uses high density to medium low density residential uses recreational sites a port and an airport relevant data were used for the site suitability assessment of urban agriculture in pendik district as the source of land use data copernicus urban atlas project of the european commission for 2012 eea european environment agency 2018 were utilised the data consists of 17 urban land cover classes with a minumum mapping unit mmu of 0 25 ha and 10 rural classes with mmu of 1 0 ha the digital elevation model dem dataset of 30 30m resolution transport network map geology soil erosion and political boundary maps were obtained from the database of municipality of pendik slope and elevation data were developed from the dem using the arcgis 10 4 software gis techniques were also used to develop criteria maps fuzzy logic was used for the land use classification which were combined with ahp and topsis to generate the site suitability model for peri urban agricultural development the summary of data and sources can be seen in table 1 2 2 defining criteria for agricultural suitability although many factors may influence land suitability for peri urban agricultural production it is impossible to include all of these factors in the land suitability analysis factors are generally based on influencing variables which influence positively or negatively the agricultural production activity therefore they should be inventoried and classified accordingly based on the literature given in table 2 the selected criteria were grouped into six main categories namely physical attributes land use natural resources accessibility geology and soil properties table 2 the physical characteristics concern slope elevation and aspect which were derived from the analysis of dem slope is usefull in identifying the potential sites for agriculture given that the slope of the land is related to soil quality including soil depth soil moisture soil texture and soil nutrients vashisht et al 2020 thin soils are found on steep slopes where there is high risk of erosion whereas deep soils are at gentle sloping grounds therefore local variations in soil nutrients minerals and agricultural productivity vary with respect to soil depth which is related to the slope zolekar and bhagat 2015 therefore with each incremental increase in slope agricultural yield is significantly reduced li et al 2017 elevation and aspect can be related to climatic factors such as precipitation temperature wind and solar radiation which are the key influencing factors for the agricultural production zhang et al 2015 the existing land use system illustrates the spatial distribution and characteristics of the land such as agricultural land fallow land natural vegetation forest built up land unutilised land water bodies etc there are studies in the literature which adopted land cover use classification for land suitability analysis land assessment and planning chandio et al 2011 zolekar and bhagat 2015 li et al 2017 rocky land barren land dense forest built up land and water bodies are certainly not suitable for agricultural production therefore these land uses are assigned with the lowest suitability values in the land use classification water bodies and other sources of water are important for agricultural production in particular for arable crop production water resources are also important for the ecology of peri urban green land and highly valued for recreational aesthetic and other purposes therefore these are included in many studies as an explanatory factor of site suitability for agricultural and forest development romano et al 2015 li et al 2017 ustaoglu and aydınoglu 2020a an adequate road network i e both municipal and farm roads is crucial for agricultural development as it strengthens market compatitiveness and fosters efficient and inclusive food supply chains both in local and global scales world bank 2015 transport infrastructure matters to all involving in the food supply chains however it is more important to small scale producers who are geographically scattered in space because a good transport infrastructure enables them to obtain essential inputs and get their products to the market high transport accessibility promotes agricultural development through providing easy and low cost access to product markets improving delivery of farm input and products and enhancing the movement of people thus encouraging social inclusion and economic development tegebu and seid 2017 physical proximity to markets and population centers are also important factors that support agricultural development therefore we considered both the road network accessibility and physical distance to markets and residential centers in the analysis soil erosion removes fertile top soil having proper physical chemical and biological properties in high slope zones higher elevation is more prone to erosion risk due to steep slopes and higher rainfall soil erosion negatively impacts agricultural yield by lessening rooting depth degrading soil structure decresing plant available water reserves and depleting soil nutrients li et al 2017 soil erosion threathens current and future productivity of agricultural land and therefore it should be included in the land suitability analysis the correlation between lithology and agricultural land uses e g fertile land led us to specify the lithology classes according to their suitability for agricultural use we noted that polonezköy formation siltstone sandstone conglomerate ömerli formation post tectonic deposits and kartal formation micaceous shale siltstone limestone shaley limestone are the most suitable classes for agricultural production in our case study area soil depth is the vertical depth of soil to bedrock or consolidated clays that restrict plant rooting the agricultural productivity is high in soils with an effective depth of around 100 cm li et al 2017 soil quality level of moisture soil nutrients rate of infiltration and plant growth are highly influenced by soil depth zolekar and bhagat 2015 in our study soil depth more than 100cm was assigned with higher suitabilities and shallow soils were assigned with lower suitabilities soil drainage conditions refer to the capability of soil to drain excessive water which is retained in soil causing inadequate supply of oxygen for root respiration and retention of carbon dioxide produced from respiration li et al 2017 this may result in decline or death of crops therefore soil drainage is another important factor to be included in agricultural suitability assessment other than these factors we employed an agricultural land capability map prepared at the scale of istanbul metropolitan region and from this map we extracted the pendik district according to its municipal boundaries the map represents the areas that are suitable for arable land that are unsuitable for arable land and that are unsuitable for agriculture population and socio economic variables such as changes in population density employment and unemployment rates and other social and demographics characteristics household size age of the farmers farmers revenue etc also influence site selection for peri urban agriculture according to the factors utilised in this study suitable land for peri agricultural land use were developed considering the needs of the population residing in the pendik district because we do not have high resolution socio economic data concerning the peri urban areas in pendik district these variables were not included in the suitability analysis with the availability of this data in the future we can include socio economic variables in the analysis and can compare the resulting suitability maps with the ones developed in this study 2 3 fuzzy modelling the rigid thresholds of the criteria that defines suitability are unreasonable or unrealistic considering that such natural cut off points do not exist in reality in such a case an alternative site with an attribute slightly below the threshold results in absolute rejection to deal with uncertainty resulting from the crisply defined boundaries fuzzy logic approaches have been introduced malczewski 2004 fuzzy logic was initially introduced by l zadeh in 1965 which was a generalisation of classic logic zadeh 1965 a fuzzy set is defined as a class of objects with a continium of grades of memberships where a membership is a function that assigns each object a grade ranging between zero and one i e 0 1 to represent the extent to which an entity belongs to a certain class mathematically a fuzzy set can be defined as 1 a x μ a x for each x x where μa x is the membership function that defines the grade of membership of x in a μa x takes the values 0 and 1 and in between for all a if x x1 x2 xn a can be defined as 2 a x 1 μ a x 1 x 2 μ a x 2 x n μ a x n mcbratney and odeh 1997 defined the fuzzy membership function μa as x 0 1 with each element x belonging to x with a grade of membership μa x 0 1 therefore μa 0 indicates that the value of x does not belong to a and μa 1 means that the value of x completely belongs to a alternatively 0 μa x 1 implies that x belongs to a certain degree to a the simplest form of membership function is triangular but other forms such as gaussian parabolic and sigmoid among others are possible the suitability mapping of peri urban agricultural land can be performed by using the fuzzy logic theory therefore in our study we adopted fuzzy logic for the suitability classification of land use and other criteria maps in our case the value 1 of the membership function represents the maximum suitability whereas value 0 is the minumum suitability for agricultural land development in the study we performed three different models to create membership functions for the criteria that were related to agricultural land suitability these include the gaussian function inverted sigmoid and monotonically decreasing linear functions see ustaoglu and aydınoglu 2020a finally table 3 presents the fuzzy membership functions for each of the criteria with lower and upper limits of functions used in the study area 2 4 the weighting of the criteria by ahp the ahp method which was put forward by saaty 1980 has been selected for multi criteria decision analysis related land suitability assessment of peri urban agricultural development the ahp method determines the weight of the importance of different criteria influencing agricultural land suitability based on pairwise comparisons of the criteria considering their relative importance akıncı et al 2013 weighting the criteria is an important process of land suitability analysis because it affects the result of the analysis and is influenced by criteria that interact with each other in the ahp approach firstly pairwise comparison matrices are generated for main criteria and subcriteria using saaty s rating scale table 4 this scale ranges from 1 9 where 9 indicates the extreme importance and 1 indicates equal importance between two criteria in the pairwise comparison matrix the pairwise comparison matrix was developed by taking into account the information provided by the relevant literature and using the expert views thapa and murayama 2008 feizizadeh and blaschke 2013 zolekar and bhagat 2015 romano et al 2015 pramanik 2016 el baroudy 2016 the group of experts consisted of six people being specialised on urban planning and public policy environmental management and geomatics engineering the resulting outcomes from expert views and the literature were averaged to get a single value on each pair of criteria and sub criteria as these should be represented with a single value in the pairwise comparison matrix to create the pairwise comparison matrix an ahp hierarchical model was constructed that consists of three hierarchical levels including objective main criteria and sub criteria for the ahp model the goal is to determine the agricultural land suitability the main criteria consist of physical attributes accessibility natural resources land use geology and soil properties and the sub criteria are as given in table 3 the method calculates eigenvalues of pairwise matrices besides the final vector of weight coefficients for alternatives pairwise comparisons are represented by an n n square matrix where each element of the matrix pij represents the values of which we prefer factor i to factor j using this square matrix ahp calculates weights for the individual criterion by taking into account the eigenvalue corresponding to the highest eigenvector of the final matrix and normalising sum of the factors to unity park et al 2011 feizizadeh et al 2014 after creating pairwise comparisons matrices the consistency ratio cr index is calculated indicating the probability that matrix ratings are randomly generated saaty 1980 cr is calculated as given in eq 3 3 c r λ m a x n n 1 r i where λmax is the principal eigenvalue of the matrix n is the order of the matrix and ri represents the average of resulting consistency index depending on the order n which is a tabular value the consistency ratio cr equivalent to 0 10 or less indicates a significant level of consistency saaty 1980 in this study the cr of the pairwise comparison matrix for the agricultural suitability is 0 093 therefore there is no inconsistency with the criteria weight coefficients obtained from the ahp method 2 5 agricultural land suitability index we calculated the agricultural land suitability index based on the 15 criteria considered in the analysis the suitability index was computed through a weighted linear summation of the layers using eq 4 4 s j 1 n w j m f j where s is the agricultural land suitability score n is the number of criteria considered in the analysis wj is the weight coefficient of criterion j which was calculated by using the ahp technique and mfj is the membership function for criterion j the value of the agricultural suitability score s ranges between 0 and 1 where a value close to 0 indicates unsuitable lands while 1 represents the most suitable lands for agriculture 2 6 ranking suitable agricultural land by topsis method topsis method one of the multi criteria decision analysis methods was first introduced by hwang and yoon in 1981 for ranking alternative decision points hwang and yoon 1981 topsis permits for a priority ranking by evaluating alternative options or decision points according to certain criteria the basic logic of the method is based on choosing the alternative decision points closest to the positive ideal solution and the most distant to the negative ideal solution this is used in the case where it is necessary to evaluate multi criteria simultaneously tzeng and huang 2011 beskese et al 2015 balioti et al 2018 topsis is an easy method to understand and interpret the method is not based on complex mathematical algorithms by contrast to other mcda methods such as electre and promethee therefore it is one of the most widely used mcda techniques in the literature behzadian et al 2012 also it is advantageous given that the topsis can be integrated with different mcda methods such as fuzzy logic ahp and fuzzy ahp balist et al 2019 özkan et al 2019 bagherzadeh and gholizadeh 2016 the steps that were followed to implement the method are listed below opricovic and tzeng 2004 i creating the decision matrix aij firstly a decision matrix of size m p was created by the decision maker or experts while creating the matrix eq 5 alternative decision points criteria were used in rows and evaluation criteria were included in columns in the current study the decision matrix was created using 8 alternative agricultural land uses and 15 suitability criteria 8 15 detailed information about the matrix created is given in table a1 in the appendix 5 a i j a 11 a 1 p a m 1 a m p ii creating the normalised decision matrix rij the decision matrix created in step 1 should be normalised because it contains variables criteria expressed in different units normalisation of the decision matrix is done using eq 6 and the normalised matrix is given in eq 7 6 r i j a i j i 1 m a i j 2 i 1 2 m j 1 2 p 7 r i j r 11 r 1 p r m 1 r m p iii creating the weighted normalised decision matrix vij the weighting was done by multiplying each element of the normalised matrix rij by a weight coefficient such as wi the coefficient of wi mentioned here can be calculated using different techniques in this study we used the ahp technique that is the most popular in the literature to calculate weight coefficients it should be taken into account here that the sum of the criterion weight coefficients is 1 wi 1 w i 1 the weighted matrix vij is given in eq 8 8 v i j w 1 r 11 w n r 1 p w 1 r m 1 w n r m p v 11 v 1 p v m 1 v m p iv determination of positive ideal a and negative ideal a solution values after creating the weighted matrix eq 8 positive and negative ideal solution clusters were calculated by considering the structure of the problem with the use of eq 9 positive ideal solution values were calculated and with eq 10 negative ideal solution values were calculated 9 a m a x j v i j i i m i n v i j j i j v 1 v 1 n 10 a m i n v i j j i i m a x v i j j i j v 1 v 1 n where i is associated with benefit criteria and j is associated with cost criteria v calculation of distances to positive ideal s and negative ideal s points from eq 11 positive distances from ideal solution points were calculated whereas eq 12 considered negative ideal solution points to calculate the subject distances euclidean distance technique was used 11 s i j 1 n v i j v i j 2 12 s i j 1 n v i j v i j 2 vi calculation of relative proximity to the ideal solution ci finally the euclidian distances from the positive and negative ideal points that were determined in the previous step were used to calculate the relative proximity to the ideal solution the relative proximity is denoted by ci and its value is calculated in eq 13 13 c i s i s i s i where ci takes value in the range of 0 ci 1 if ci 0 c i 0 the decision point is near the absolute negative ideal solution if ci 1 the decision point alternative is near the absolute positive ideal solution in the final step of the topsis method decision points alternatives the suitable agricultural areas for our study were ranked with calculated ci values 3 results 3 1 the weights obtained from ahp method by using the weights of the criteria that were calculated by the ahp method an agricultural suitability map was produced for pendik district with weighted overlay of the criteria data sets that was determined with fuzzy memberships and also the topsis method was utilised to rank alternative suitable areas physical attributes natural resources accessibility land use geology and soil properties are important factors in agricultural land development and thus form the six main criteria in the ahp equal weights were assigned to the main criteria and the weights calculated for each sub criteria are provided in the last column of table 5 when the weights of 15 sub criteria are examined as in table 5 it is seen that particularly agricultural land use capability limiting soil factors criteria e g soil properties elevation and land cover use are more effective on the other hand distances to the fast and slow roads criteria were determined to be the least effective 3 2 agricultural land suitability of the pendik district and current land use the suitability results of the pendik district are given in fig 3 representing the suitability values for each raster cell ranging from the lowest to the highest suitability scores as seen in fig 3 although the most suitable areas for agriculture were determined in different locations of the study area these areas were concentrated especially in the north region land suitability values decrease from village centers to the outskirts and from the centers of existing agricultural uses to the surrounding locations the region of the highest suitability is located at the central part of pendik district whereas the regions of lowest suitabilities are scattered in the south and north east with a smaller area located in the north west the results in table 6 indicate that most sites fall under the moderate suitability class s5 and s6 and high suitability class s7 which represents 86 3 of the total area about 8 of the total area was marginally suitable s3 and s4 and 0 07 was lowly suitable or unsuitable s1 and s2 for agricultural production only 5 68 of the study area were found as very highly suitable which is located mainly in the central part and scattered in the eastern and the western parts of the study area when pendik district is examined different land use types can be identified from the current land cover use map fig 4 three land use types can be highlighted under agricultural use these are arable land pastures and permanent crops in our analysis first these land use types were gathered in a dataset and then the land uses were intersected with agricultural suitability map in the gis environment after generalisation of these intersected areas 8 alternative land areas were determined as the most suitable sites for peri urban agriculture fig 5 3 3 ranking of the most suitable alternative agricultural lands to rank the suitable agricultural lands with the topsis method the steps described in the methodology section were undertaken positive a and negative ideal a solution values calculated from eq s 9 and 10 are shown in table 7 we note that it is important to determine the positive a and negative ideal a solution values accurately for determining the positive a ideal solution values we found that 8 of the most suitable agricultural land areas should be close to watercourses fast roads slow roads the market zone and urban dwellings and the values should be low for slope elevation and erosion susceptibility further to these soil depth should be high aspect should be the south direction land use cover lulc be arable land annual crops permanent crops and pastures agricultural land use capability aluc should correspond to arable land and other soil properties relate to low stoniness good drainage finally the geological structure should be siltstone sandstone conglomerate or post tectonic deposits the details are provided in table a1 in the appendix from eq s 11 and 12 the euclidean distances between the positive and negative ideal points were calculated table 8 using eq 13 the relative proximity to the ideal solution was calculated then alternative agricultural lands were ranked by using the obtained ci values as given in table 8 the ranking results of suitable agricultural lands are shown in fig 6 from fig 6 we note that the top three ranked areas are located in the vicinity of current agricultural land uses in the northern part of the study area where there are favourable geo physical accessibility and location climate and soil conditions among these top ranked areas two of them are located close to the reservoir and the other one is close to the fast roads other prioritised suitable areas are in the surroundings of existing villages and at the intersecting points of the road network so that they could benefit from exisiting infrastructure and labour market for the production and distribution of agricultural products 4 discussion peri urban agriculture and its site selection are challenging tasks to land use scientists and practitioners concerning the limitation of green land within current land use patterns we developed a hybrid methodology integrating fuzzy logic ahp and topsis techniques for determining the most sitable sites for peri urban agriculture for our selected case study area our findings show that there is land area potential for peri urban agricultural development particularly in the northern part of pendik district where there is plenty of land for agricultural production this study adds to the research within land suitability modelling through applying fuzzy logic technique for a better representation of continium of suitability scores in the specified peri urban area to sit its agricultural land use in comparison to other commonly used approaches such as parametric and limitation methods fuzzy logic provides a more flexible way to the standardisation of criteria fuzzy set theory permits partial membership of suitability which represents a more realistic measure of continuous factors as opposed to traditional boolean logic barreto neto and de souza filho 2008 showed that the runoff derived from fuzzy method is closer to the measured runoff in the watershed confirming the suitability of using fuzzy logic in modelling the environment a later study by yousefi et al 2018 admits that the use of fuzzy set provides more flexible assessment in the site selection of solar power plants where there are no certain boundaries between suitable and unsuitable classes similar findings were reported by dos santos et al 2020 amini et al 2020 and prabakaran et al 2021 the ahp method is flexible and can be integrated with other methods such as linear programming topsis and fuzzy logic it is a powerful method in dealing with complex decision problems such as determination of weights for the suitability criteria it provides a well structured approach for the calculation of weights and standardisation of the criteria and it is easy to interpret the resulting maps of suitability zhang et al 2015 indicated that ahp is a more effective method in comparison to its alternatives in the calculation of weights given that the inconsistencies in the system can be measured and controlled in the presence of conflicting criteria the effectiveness of ahp has been commonly reported in the literature which used the subject method in land suitability modelling tudes and yigiter 2010 chandio et al 2011 akıncı et al 2013 mosadeghi et al 2015 pramanik 2016 kazazi darani et al 2018 ramya and devedas 2019 pilevar et al 2020 however ahp has also limitations as it is based on a questionnaire survey to calculate relative weights it is more time consuming for technical applications and due to aggregation of scores compensation between good scores on some criteria and bad scores on other criteria may ocur other limitations of the method include poor knowledge of the stakeholders in the area of interest reproducibility of the results and subjectivity of weights applied to suitability criteria park et al 2011 although the ranking has been made from more suitable areas to less suitable areas it is required to identify suitable areas for agriculture according to their size and make these areas prioritised in this sense topsis method focusing on the criteria and alternative agricultural suitable areas in the decision matrix was applied the core of the topsis approach lies in its separation from the best and the worst situations generated by the combinations of each criterion with the most and the least suitability values the ideal point method generated complete sets of weights and ranks each attribute thus overcoming some of the shortages of conventional mcda methods the latter lacks of independence among the selected attributes the criteria were combined using calculations of their eucledian distances from an ideal point this implies that there is no need to specify a specific relationship between the factors and degree of suitability given that such relationships are not necessarily linear as assumed in other mcda methods by this way topsis method improves decision making to select suitable agricultural areas in prioritisation besides determining suitable areas by combining ahp and fuzzy logic with gis techniques however there are also limitations of the topsis method i e normalization is required to solve multidimentional problems and consistency check cannot be applied in topsis despite the limitations topsis has been successively used in the literature either alone or in combination with other methods for instance choudhary and shankar 2012 applied steep fuzzy ahp topsis method for the selection of thermal power plant location ramya and devedas 2019 integrated gis ahp and topsis for the assessment of suitable locations for industrial development as to our knowledge topsis method was not applied to suitability analysis of urban and peri urban agriculture but there are examples on rural agriculture including bagherzadeh and gholizadeh 2016 kia and domirani 2018 özkan et al 2019 wang et al 2021 factors influencing peri urban agricultural suitability are a complex environmental system comprising of humanmade and natural factors each of which contributes to land suitability through summation of each of these factors our study has shown that different factors including physical attributes natural resources accessibility land use geology and soil properties influence land suitability evaluation result this is also confirmed by majumdar 2020 which focused on peri urban agricultural suitability in kolkota city india through integrating mcda model and crop condition monitoring methods the study indicated that land use digital elevation model dem water facility road network and market facility are influencial in peri urban agricultural suitability outcome thapa and murayama 2008 utilised an integrated technique of ahp and gis to assess suitability of land for peri urban agriculture in hanoi province vietnam soil land use water resources road network and market were selected as major factors that affect peri urban land suitability for agriculture in hanoi a different study by la rosa et al 2014 investigated new forms of urban agriculture in their selected case study area of catania south italy to improve sustainability of the city through taking advantage of multiple benefits and services provided within urban context they considered physical ecological and social features that were analysed applying a gis based multi criteria suitability model a final example is nigussie et al 2021 that explored the capacity of farmlands to supply food and search for suitable locations for urban and peri urban agriculture in the city of addis ababa etiopia similar to la rosa et al 2014 they integrated gis with multi criteria model for the urban agriculture suitability assessment based on irrigation development soil fertility management market system and infrastructure and natural resources development as it can be seen from this literature there is no study integrating fuzzy logic ahp and topsis methods for the suitability assessment of urban and peri urban agricultural land although previous studies developed suitability maps for urban peri urban agricultural development ranging from highly suitable areas to unsuitable areas they did not apply fuzzy logic neither did they rank suitable land areas based on their overall performance in the current study fuzzy logic was used to present a more realistic approach in the representation of continuous data sets specifying each criterion and gis techniques were used to create geographical datasets representing the criteria and overlay them according to ahp weights ahp is very suitable for evaluating alternatives especially when there is high numbers of suitability criteria as it is the case in our study topsis is a flexible approach in ranking of the alternative locations based on their overall performance thus it offers an optimal solution from both low cost and concerns on sustainability of growth perspectives from socio economic and environmental perspectives the literature has shown that urban and peri urban agriculture is associated with multiple co benefits supporting sustainable urban development through helping to deal with societal challanges such as food security and human health preserving the cultural landscape providing nature related experience and education and supports ecosystems and their services gradinaru et al 2018 it is therefore important for the city managers and planning authorities to protect and improve peri urban agricultural sites which is also the case in our study area of pendik district to support social ecological and economic conditions of the society potential agricultural activities conducted in our study area can contribute to economic social and environmental pillars of sustainability economically the agricultural land can provide the pendik district and local villages in the site some fresh food and therefore can contribute to food security and provide income to local food producers from social perspective the peri urban agricultural areas can support the cultural way of life provide green space for recreational activities e g hobby farming and other recreational uses encourage social integration and reduce poverty from environmental perspective peri urban agricultural land can be considered as part of the urban green infrustructure which enhances connectivity and networking of green spaces in pendik district this is particularly important for pendik district given that urban green spaces are fragmented and limited in the southern part due to economic growth rapid urbanisation and weak planning policies and decisions supporting peri urban agriculture in the northern part of pendik will therefore support ecosystem services and other benefits resulting from connection and networking of urban green spaces this needs to be supported by laws and regulations aiming to protect the existing and proposed peri urban agricultural sites in the turkish context this study addressed the prioritisation of potential land for peri urban agricultural development in pendik district therefore the land according to its development potential rank can be considered in planning and policy decisions of local authorities and land managers through comparing actual agricultural land and prioritised land new land for future agricultural use can be specified in local area development plans concerning the northern area of pendik district in fact the suitability assessment contributes to a better understanding of land availability for potential food production and to improve ecosystem management which is also significantly encouraged by urban sustainable development it is also possible to apply the methodological framework that we developed in this study for solving land planning problems such as sitting urban and peri urban agricultural land in different areas and regions in the world 5 conclusion as mentioned the need to carry out agricultural activities in areas close to cities has emerged by enabling various agricultural functions it is necessary to examine these areas in relation to the city functions and to correctly analyse the criteria for choosing the suitable lands in the planning process suitability criteria were derived scientifically from relevant indicators that are applicable for our study area e g physical attributes natural resources accessibility land use geology and soil properties the database for mapping criteria were obtained from public and private sources and the process by which the criteria were ranked is based on a new hybrid approach where we combined fuzzy set ahp and topsis for the determination of the most suitable areas for peri urban agriculture we note that there are many different factors that can be influencial in the site selection problem of peri urban agriculture nevertheless it is almost impossible to include all factors that influence site suitability evaluation this highlights the importance of decision support systems dsss that assist in managing all parameters included in a given analysis and help to managers to choose one of the options by analysing large amount of data in a relatively short time period kazak et al 2017 dsss are applicable in case of unstructured or semi structured problems through offering a tool to decision makers to compare results with increasing their readibility kazak et al 2017 although dsss are powerful tools and assists in conducting complex data analysis these tools remain only a source of decision support given that the final decision always have to be made by people themselves kazak and van hoof 2018 the suitability map that we generated using the fuzzy logic and ahp were analysed under six degrees of suitability classes namely unsuitable lowly suitable marginally suitable moderately suitable highly suitable and very highly suitable most land uses in the study area fall under the high suitable class and moderately suitable class for peri urban agricultural production around 27 of the total land area was found to be highly suitable for agricultural development whereas only 0 07 was unsuitable the unsuitable areas mainly lay in the southern part where urban development occupies the majority of land through the topsis method parts of agricultural land in the north have been identified as the highest agricultural development priority due to their favourable geo physical land use accessibility natural amenities and soil characteristics the proposed method for prioritising agricultural development provides an effective tool for planners and policy makers therefore the results of our analysis can be used in planning processes of these areas as part of planning and management of agricultural land in this regard land re adjustment should be made to reorganise cadastral parcels so that they correspond to suitable agricultural parcels with appropriate size and shape declaration of competing interest the authors declare no conflict of interest acknowledgements the study presented here was funded by the scientific and technological research council of turkey tubi̇tak linked to bideb 2232 programme project no 118c002 appendix table a1 
24601,land use suitability analysis is of significance for the planning and management of cities the main objective of this study was to develop a spatial model for land suitability assessment for peri urban agricultural development with the use of geographic information systems gis integrated with multi criteria decision analysis mcda techniques physical attributes land use natural resources accessibility geology and soil properties were recognised as the key factors influencing land suitability for peri urban agriculture in the study area the study follows an integrated approach for the suitability assessment of agricultural development in pendik district of istanbul turkey through integrating fuzzy logic model analytical hierarchy process ahp and the technique for order preference by similarity to ideal solution topsis methods suitability classification of land was done in gis by using the specified fuzzy membership functions the weights of the main criteria and their sub criteria were determined through the ahp method eight different zones were ranked according to agricultural development priority by the topsis method the area classified as suitable amounts to 27 of the total area with 0 07 classified as unsuitable the highly suitable areas are mainly located in the north where there are villages specialised in agricultural production the prioritisation of the suitable agricultural areas would assist in land use planning and urban management keywords peri urban agricultural land suitability analysis fuzzy logic ahp topsis pendik turkey 1 introduction the phenomenon of urban agriculture 1 1 the term urban agriculture refers to both urban and peri urban agriculture and the term is interchangably used in the text to represent either urban or peri urban agriculture has been given the most attention over the past decades urban agriculture refers to any agricultural activity such as production of food or non food products occuring on the populated urban zones or the peri urban fringes of cities and towns freeman 1991 smit et al 1996 hovorka 2005 urban agriculture comprises a range of activities including crop livestock horticulture and aquaculture production undertaken at any scale in open spaces mainly located in the outskirts of urban land the boundary between urban and peri urban is along a urban rural gradient which is typically not spatially zoned therefore it is difficult to make a spatial distinction between distinctly urban and clearly rural areas which exhibits considerable heterogeneity in different regions and cities in the world schneider and woodcock 2008 the nature of peri urban areas cannot be generalised because these are characterised by a number of factors including economic characteristics and infrastructural set up of the urban centre the region and the country historical and socio cultural characteristics of the area and its ecological functions and geo physical features the urbanisation process is coupled with unwanted consequences which range from farmland loss to deforestation air and water pollution climate change social segregation and creation of peri urban areas which have socio economic consequences such as condensed poverty and income inequality orsini et al 2013 rimal et al 2017 although urban development increasingly takes place in the brownfield or infill sites urban expansion process has led to agricultural land consumption that resulted in increasing loss of fertile farmlands munton 2009 ustaoglu and williams 2017 in the urban periphery the conversion of agricultural land to urban uses is strongly influenced by land rents and prices of other land uses such as housing with its higher rents outbidding the other land uses ustaoglu and williams 2017 therefore in the urban fringe there exists different market conditions with higher land prices associated with a fragmented structure and complex pattern of ownership and property rights munton 2009 the complex and heterogeneous land uses is a reflection of a dynamic change process as certain components of these areas have grown due to high degree of land transition and conversion for urban purposes and others are characterised as idle and marginal open spaces gant et al 2011 zasada 2011 the poor management of land uses in the peri urban areas has led to deplation of the resources such as air water and soil as well as the deterioration of the quality of living the development of urban and peri urban agriculture is one of the major strategies that has been adopted particularly in developing countries to address negative consequences of farmland conversion in the periphery and to improve wellbeing of urban residents orsini et al 2013 the unprecedented growth in urban population and income has increased food requirements of cities which have continuously increased in recent years and is expected to do so in the near future many cities have restricted access to high quality food due to reduced accessibility to markets financial restrains and inadequate transport provision thomas 2010 a sustainable agriculture approach aims at meeting society s food and textile needs on the basis of healthy environment economic profitability and social and economic equity fao 2014 this highlights the importance of foodshed which is also known as local food production capacity galzki et al 2015 galzki et al 2017 or local foodshed carrying capacity peters et al 2016 it is defined as the geography of urban food supply that verifies the linkages between food producing and food consuming regions across different scales the concept initially emerged in the early twentieth century with the study of mackaye 1920 that researched the linkages between cities and agricultural hinterlands through supply chains this concept was revisited by getz 1991 for a better understanding of how food systems work and emphasising the benefits of local food systems and local food self sufficiency there are economic environmental and societal benefits provided by local foodsheds these include local economic impacts increased food security reduction in energy consumption increased use of sustainable production and distribution methods and enhancement of social justice and equity within a community galzki and mulla 2017 in this context urban agriculture is related to growth processing and distribution of food and non food products within urban or peri urban areas of a city or a region thereby contributing to local food production capacity of that urban area or region the calculation of foodshed is based on two methods the relationship between location of food production and its consumer market is searched in the first approach karg et al 2016 the second approach on the other hand focuses on the production capacity of potentially available land for urban and peri urban agriculture the current analysis of site suitability assessment of peri urban agriculture will therefore serve as an input for foodshed calculations through assessment of production capacity of suitable land for peri urban agriculture by contrast to rural agriculture urban agriculture is linked to local urban economy and the ecological system that supports it gradinaru et al 2018 nevertheless urban agriculture is concerned with human environment interactions and urban rural relations with an aim of promoting a sustainable way for development which give rise to different functions of urban agriculture mougeot 2006 in addition to food and fuel production urban agriculture plays a crucial role in offering other forms of socio economic functions related to educational or recreational activities of urban residents orsini et al 2013 in many regions of the world netherlands and uk among others urban agriculture has been combined with different forms of recreational activities e g hobby farming camping horse riding etc and provides a location for environmental training and education zasada 2011 such multi functional approaches to urban agriculture can lead to diversification of farm income and therefore contribute to economic wellfare of residents in the light of these explanations growth strategies have to be specified for the management of peri urban areas and a new urban rural interface has to be specified that would assist in sustaining urban food security providing new employment opportunities for peri urban and rural communities reducing rural urban segragation and reversing the ongoing trends of resource deplation gutman 2007 ayambire et al 2019 recent studies pointed out that urban agriculture can improve environmental quality through mitigation of urban heat island effect qıu et al 2013 mancebo 2018 marando et al 2019 and reducing the vulnerability of settlements to flooding and draught worku 2017 kalantari et al 2018 urban agriculture can also assist in improving ecosystems and biodiversity lin et al 2015 wilhelm and smith 2018 stenchly et al 2019 spyra et al 2020 providing outdoor spaces for recreational activities rossi et al 2016 hammer et al 2017 komossa et al 2019 komossa et al 2020 contributing to food security yaro et al 2016 olsson et al 2016 khumalo and sibanda 2019 and reducing poverty by providing extra sources of income for the poor zezza and tasciotti 2010 lwasa et al 2014 mugisa et al 2017 though the case studies on urban agriculture has increased considerably in the last decades there are still significant challenges for integrating urban agriculture in an increasingly spatially constrained urban landscapes lin et al 2015 in this regard spatial quantitative analysis provides the means for spatial planning and management given that such analysis focuses on potential locations of development by investigating attributes including proximity to environmental features access to roads jobs and markets geo physical and climatic conditions and incompatible land uses that shape where urban agriculture development is possible mather et al 2006 the literature on land use location suitable sites and patterns of urban agricultural development has been growing most recently one strand of literature has examined land cover use change dynamics and the patterns of land use in the peri urban areas using geo information and remote sensing technologies vizzari 2011 appiah et al 2015 wang and qiu 2017 willkomm et al 2019 mathan and krishnaveni 2020 another strand focuses on land suitability analysis and site selection for the urban and rural agriculture using different methods including multi criteria decision analysis mcda gis fuzzy logic expert systems artificial neural networks and cellular automata modelling thapa and murayama 2008 bagheri et al 2013 weerakoon 2014 appiah et al 2015 kong et al 2016 gomes et al 2019 although the use of mcda integrated with fuzzy methods for the suitability assessment of agricultural sites is recognised its adoption for mapping the suitability of urban agricultural sites is limited as an example of fuzzy logic method chrobak et al 2020 used fuzzy based techniques for the standardisation and aggregation of assessment criteria in the vineyard site selection problem amini et al 2020 integrated fuzzy logic mcda and gis for the assessment of agricultural land suitability in their selected case study area in iran a similar approach was followed by pilevar et al 2020 which integrated fuzzy mcda and gis for land suitability assessment in semi arid regions for wheat and maize farming a more recent study by prabakaran et al 2021 used a combination of fuzzy logic and support vector machines for the assesment and prediction of agricultural productivity see also oh et al 2020 analytical hierarchy process ahp is one of the most commonly used approaches that is applied to resolve highly complex decision making problems such as the multi criteria data utilised in the site suitability assessment mosadeghi et al 2015 musakwa 2018 pilevar et al 2020 it is considered as a powerful technique in solving complicated and unstructured problems where these may present interactions and correlations among different objectives and goals cakir and canbolat 2008 this technique is useful for the decision makers as it is possible to organize critical aspects of a problem into a hierarchical structure javalgi et al 1989 ahp method is used to determine the global weights with the use of pairwise comparison matrices where each criterion is compared in terms of relative importance with respect to its pairwise counterpart in turkey the research that incorporated the ahp approach for the prioritisation of criteria mainly focus on reallocation of agricultural land cay and uyan 2013 urban management in earthquake sensitive areas tudes and yigiter 2010 rural agricultural land suitability akıncı et al 2013 bozdag et al 2016 dedeoglu and dengiz 2019 green space development ustaoglu and aydınoglu 2020a and others the research on site selection of urban and peri urban agriculture in turkey is scarce to our knowledge there is only one research that proposed agricultural belt around the city of bartın turkey based on spatial suitability and evaluation of landscape metrics gormus et al 2019 other research mainly focused on rural agricultural land applying gis ahp or other hybrid methods for the land suitability assessment bozdag et al 2016 selim et al 2018 tercan and dereli 2020 everest 2021 despite the advances achieved with the use of traditional methods including ahp and gis approaches in handling with both qualitative and quantitative criteria of the multi criteria decision problems the fuziness existing in real world problems results in increasing uncertainty in the development of suitability values which stems mainly from fuzziness in land suitability classification zhang et al 2015 considering conventional methods rather than using fuzzy approach in the standardisation of the assessment criteria based on gis may lead to imprecise judgements of decision makers in the site selection problem bouyssou et al 2000 zhang et al 2015 ustaoglu and aydınoglu 2020b to cope with this issue different fuzzy membership functions can be developed for the classification of land suitability values i e fuzzy logic theory the technique for order preference by similarity to ideal solution topsis is another powerful method in dealing with multi criteria decision making problems in real world topsis assists in decision makers to organise the problems to be solved and then to analyse compare and rank alternative solutions chang et al 2012 the studies in the literature either used one of the techniques alone thapa and murayama 2008 thapa et al 2011 weerakoon 2014 or integrated different methodologies other than fuzzy logic and topsis bagheri et al 2013 smith et al 2017 majumdar 2020 sonneveld et al 2021 in the urban agriculture site suitability analysis topsis system is used to evaluate and classify the suitable land so that the highest suitability areas can be ranked and prioritised for the purpose of urban and peri urban agriculture development the use of topsis method is widely used for the site suitability analysis of urban land liu et al 2014 ramya and devedas 2019 xu et al 2021 but its use in sitting peri urban agricultural land use is scarce therefore this paper serves for the purpose of integrating topsis system to the gis fuzzy logic and multi criteria analysis which considerably advanced map overlay approaches to site suitability analysis mcharg 1969 and ranking of suitability classes with the topsis approach resulting in more precise judgements in the site selection problem to our knowledge no studies have adopted such an integrated approach utilising locally available criteria including geo physical factors socio economic conditions natural resources land use etc for specifying urban and peri urban agricultural suitable sites therefore our study aims at contributing to the literature through providing a hybrid method of fuzzy logic mcda topsis for agricultural site selection in the peri urban areas of our selected study area in istanbul e g pendik district the methodological process applied and the relationships between techniques used in the study are summarised in fig 1 data collection data preparation and data processing steps were performed in gis the multi criteria analysis framework and its components were developed based on the review of the literature and expert views the ahp method was used to determine the global weights of the selected criteria with the use of pairwise comparison matrices for the fuzzy modeling approach fuzzy membership functions were defined from the literature and raster maps from fuzzy logic were produced accordingly once the ahp weights were obtained the weights were used for the spatial overlay analysis of the fuzzy based raster maps conducted with the use of gis the resultant suitability maps were passed to the topsis analysis where the suitable lands were prioritised and ranked 2 study area data and methods 2 1 the study area and data sources the study area is a plain district that is located on the eastern part of istanbul metropolitan area fig 2 it is surrounded by kartal sultanbeyli district in the west tuzla district in the east şile in the north and marmara sea in the south the climate in the district varies from cold temperate to mild climate with the average daily temperatures of 6 1 in january and 23 5 in july the geographical area of the district is approximately 179 km2 with a total population of 700 000 as per 2017 census and population density of around 4 inhabitants per square kilometer the district is divided into 36 neighbourhoods varying in terms of size and extent industry and commerce are the main occupation of the people residing in the southern part of pendik district whereas in the north people are more occupied with agriculture and forestry arable land permanent crops greenhouses and non irrigated agricultural land are the principal agricultural land uses which are surrounded by a scattered pattern of natural vegetation of pastures and grassland and forests pendik governorship 2016 the rest of the land comprises urban uses in the south which are industrial and commercial uses high density to medium low density residential uses recreational sites a port and an airport relevant data were used for the site suitability assessment of urban agriculture in pendik district as the source of land use data copernicus urban atlas project of the european commission for 2012 eea european environment agency 2018 were utilised the data consists of 17 urban land cover classes with a minumum mapping unit mmu of 0 25 ha and 10 rural classes with mmu of 1 0 ha the digital elevation model dem dataset of 30 30m resolution transport network map geology soil erosion and political boundary maps were obtained from the database of municipality of pendik slope and elevation data were developed from the dem using the arcgis 10 4 software gis techniques were also used to develop criteria maps fuzzy logic was used for the land use classification which were combined with ahp and topsis to generate the site suitability model for peri urban agricultural development the summary of data and sources can be seen in table 1 2 2 defining criteria for agricultural suitability although many factors may influence land suitability for peri urban agricultural production it is impossible to include all of these factors in the land suitability analysis factors are generally based on influencing variables which influence positively or negatively the agricultural production activity therefore they should be inventoried and classified accordingly based on the literature given in table 2 the selected criteria were grouped into six main categories namely physical attributes land use natural resources accessibility geology and soil properties table 2 the physical characteristics concern slope elevation and aspect which were derived from the analysis of dem slope is usefull in identifying the potential sites for agriculture given that the slope of the land is related to soil quality including soil depth soil moisture soil texture and soil nutrients vashisht et al 2020 thin soils are found on steep slopes where there is high risk of erosion whereas deep soils are at gentle sloping grounds therefore local variations in soil nutrients minerals and agricultural productivity vary with respect to soil depth which is related to the slope zolekar and bhagat 2015 therefore with each incremental increase in slope agricultural yield is significantly reduced li et al 2017 elevation and aspect can be related to climatic factors such as precipitation temperature wind and solar radiation which are the key influencing factors for the agricultural production zhang et al 2015 the existing land use system illustrates the spatial distribution and characteristics of the land such as agricultural land fallow land natural vegetation forest built up land unutilised land water bodies etc there are studies in the literature which adopted land cover use classification for land suitability analysis land assessment and planning chandio et al 2011 zolekar and bhagat 2015 li et al 2017 rocky land barren land dense forest built up land and water bodies are certainly not suitable for agricultural production therefore these land uses are assigned with the lowest suitability values in the land use classification water bodies and other sources of water are important for agricultural production in particular for arable crop production water resources are also important for the ecology of peri urban green land and highly valued for recreational aesthetic and other purposes therefore these are included in many studies as an explanatory factor of site suitability for agricultural and forest development romano et al 2015 li et al 2017 ustaoglu and aydınoglu 2020a an adequate road network i e both municipal and farm roads is crucial for agricultural development as it strengthens market compatitiveness and fosters efficient and inclusive food supply chains both in local and global scales world bank 2015 transport infrastructure matters to all involving in the food supply chains however it is more important to small scale producers who are geographically scattered in space because a good transport infrastructure enables them to obtain essential inputs and get their products to the market high transport accessibility promotes agricultural development through providing easy and low cost access to product markets improving delivery of farm input and products and enhancing the movement of people thus encouraging social inclusion and economic development tegebu and seid 2017 physical proximity to markets and population centers are also important factors that support agricultural development therefore we considered both the road network accessibility and physical distance to markets and residential centers in the analysis soil erosion removes fertile top soil having proper physical chemical and biological properties in high slope zones higher elevation is more prone to erosion risk due to steep slopes and higher rainfall soil erosion negatively impacts agricultural yield by lessening rooting depth degrading soil structure decresing plant available water reserves and depleting soil nutrients li et al 2017 soil erosion threathens current and future productivity of agricultural land and therefore it should be included in the land suitability analysis the correlation between lithology and agricultural land uses e g fertile land led us to specify the lithology classes according to their suitability for agricultural use we noted that polonezköy formation siltstone sandstone conglomerate ömerli formation post tectonic deposits and kartal formation micaceous shale siltstone limestone shaley limestone are the most suitable classes for agricultural production in our case study area soil depth is the vertical depth of soil to bedrock or consolidated clays that restrict plant rooting the agricultural productivity is high in soils with an effective depth of around 100 cm li et al 2017 soil quality level of moisture soil nutrients rate of infiltration and plant growth are highly influenced by soil depth zolekar and bhagat 2015 in our study soil depth more than 100cm was assigned with higher suitabilities and shallow soils were assigned with lower suitabilities soil drainage conditions refer to the capability of soil to drain excessive water which is retained in soil causing inadequate supply of oxygen for root respiration and retention of carbon dioxide produced from respiration li et al 2017 this may result in decline or death of crops therefore soil drainage is another important factor to be included in agricultural suitability assessment other than these factors we employed an agricultural land capability map prepared at the scale of istanbul metropolitan region and from this map we extracted the pendik district according to its municipal boundaries the map represents the areas that are suitable for arable land that are unsuitable for arable land and that are unsuitable for agriculture population and socio economic variables such as changes in population density employment and unemployment rates and other social and demographics characteristics household size age of the farmers farmers revenue etc also influence site selection for peri urban agriculture according to the factors utilised in this study suitable land for peri agricultural land use were developed considering the needs of the population residing in the pendik district because we do not have high resolution socio economic data concerning the peri urban areas in pendik district these variables were not included in the suitability analysis with the availability of this data in the future we can include socio economic variables in the analysis and can compare the resulting suitability maps with the ones developed in this study 2 3 fuzzy modelling the rigid thresholds of the criteria that defines suitability are unreasonable or unrealistic considering that such natural cut off points do not exist in reality in such a case an alternative site with an attribute slightly below the threshold results in absolute rejection to deal with uncertainty resulting from the crisply defined boundaries fuzzy logic approaches have been introduced malczewski 2004 fuzzy logic was initially introduced by l zadeh in 1965 which was a generalisation of classic logic zadeh 1965 a fuzzy set is defined as a class of objects with a continium of grades of memberships where a membership is a function that assigns each object a grade ranging between zero and one i e 0 1 to represent the extent to which an entity belongs to a certain class mathematically a fuzzy set can be defined as 1 a x μ a x for each x x where μa x is the membership function that defines the grade of membership of x in a μa x takes the values 0 and 1 and in between for all a if x x1 x2 xn a can be defined as 2 a x 1 μ a x 1 x 2 μ a x 2 x n μ a x n mcbratney and odeh 1997 defined the fuzzy membership function μa as x 0 1 with each element x belonging to x with a grade of membership μa x 0 1 therefore μa 0 indicates that the value of x does not belong to a and μa 1 means that the value of x completely belongs to a alternatively 0 μa x 1 implies that x belongs to a certain degree to a the simplest form of membership function is triangular but other forms such as gaussian parabolic and sigmoid among others are possible the suitability mapping of peri urban agricultural land can be performed by using the fuzzy logic theory therefore in our study we adopted fuzzy logic for the suitability classification of land use and other criteria maps in our case the value 1 of the membership function represents the maximum suitability whereas value 0 is the minumum suitability for agricultural land development in the study we performed three different models to create membership functions for the criteria that were related to agricultural land suitability these include the gaussian function inverted sigmoid and monotonically decreasing linear functions see ustaoglu and aydınoglu 2020a finally table 3 presents the fuzzy membership functions for each of the criteria with lower and upper limits of functions used in the study area 2 4 the weighting of the criteria by ahp the ahp method which was put forward by saaty 1980 has been selected for multi criteria decision analysis related land suitability assessment of peri urban agricultural development the ahp method determines the weight of the importance of different criteria influencing agricultural land suitability based on pairwise comparisons of the criteria considering their relative importance akıncı et al 2013 weighting the criteria is an important process of land suitability analysis because it affects the result of the analysis and is influenced by criteria that interact with each other in the ahp approach firstly pairwise comparison matrices are generated for main criteria and subcriteria using saaty s rating scale table 4 this scale ranges from 1 9 where 9 indicates the extreme importance and 1 indicates equal importance between two criteria in the pairwise comparison matrix the pairwise comparison matrix was developed by taking into account the information provided by the relevant literature and using the expert views thapa and murayama 2008 feizizadeh and blaschke 2013 zolekar and bhagat 2015 romano et al 2015 pramanik 2016 el baroudy 2016 the group of experts consisted of six people being specialised on urban planning and public policy environmental management and geomatics engineering the resulting outcomes from expert views and the literature were averaged to get a single value on each pair of criteria and sub criteria as these should be represented with a single value in the pairwise comparison matrix to create the pairwise comparison matrix an ahp hierarchical model was constructed that consists of three hierarchical levels including objective main criteria and sub criteria for the ahp model the goal is to determine the agricultural land suitability the main criteria consist of physical attributes accessibility natural resources land use geology and soil properties and the sub criteria are as given in table 3 the method calculates eigenvalues of pairwise matrices besides the final vector of weight coefficients for alternatives pairwise comparisons are represented by an n n square matrix where each element of the matrix pij represents the values of which we prefer factor i to factor j using this square matrix ahp calculates weights for the individual criterion by taking into account the eigenvalue corresponding to the highest eigenvector of the final matrix and normalising sum of the factors to unity park et al 2011 feizizadeh et al 2014 after creating pairwise comparisons matrices the consistency ratio cr index is calculated indicating the probability that matrix ratings are randomly generated saaty 1980 cr is calculated as given in eq 3 3 c r λ m a x n n 1 r i where λmax is the principal eigenvalue of the matrix n is the order of the matrix and ri represents the average of resulting consistency index depending on the order n which is a tabular value the consistency ratio cr equivalent to 0 10 or less indicates a significant level of consistency saaty 1980 in this study the cr of the pairwise comparison matrix for the agricultural suitability is 0 093 therefore there is no inconsistency with the criteria weight coefficients obtained from the ahp method 2 5 agricultural land suitability index we calculated the agricultural land suitability index based on the 15 criteria considered in the analysis the suitability index was computed through a weighted linear summation of the layers using eq 4 4 s j 1 n w j m f j where s is the agricultural land suitability score n is the number of criteria considered in the analysis wj is the weight coefficient of criterion j which was calculated by using the ahp technique and mfj is the membership function for criterion j the value of the agricultural suitability score s ranges between 0 and 1 where a value close to 0 indicates unsuitable lands while 1 represents the most suitable lands for agriculture 2 6 ranking suitable agricultural land by topsis method topsis method one of the multi criteria decision analysis methods was first introduced by hwang and yoon in 1981 for ranking alternative decision points hwang and yoon 1981 topsis permits for a priority ranking by evaluating alternative options or decision points according to certain criteria the basic logic of the method is based on choosing the alternative decision points closest to the positive ideal solution and the most distant to the negative ideal solution this is used in the case where it is necessary to evaluate multi criteria simultaneously tzeng and huang 2011 beskese et al 2015 balioti et al 2018 topsis is an easy method to understand and interpret the method is not based on complex mathematical algorithms by contrast to other mcda methods such as electre and promethee therefore it is one of the most widely used mcda techniques in the literature behzadian et al 2012 also it is advantageous given that the topsis can be integrated with different mcda methods such as fuzzy logic ahp and fuzzy ahp balist et al 2019 özkan et al 2019 bagherzadeh and gholizadeh 2016 the steps that were followed to implement the method are listed below opricovic and tzeng 2004 i creating the decision matrix aij firstly a decision matrix of size m p was created by the decision maker or experts while creating the matrix eq 5 alternative decision points criteria were used in rows and evaluation criteria were included in columns in the current study the decision matrix was created using 8 alternative agricultural land uses and 15 suitability criteria 8 15 detailed information about the matrix created is given in table a1 in the appendix 5 a i j a 11 a 1 p a m 1 a m p ii creating the normalised decision matrix rij the decision matrix created in step 1 should be normalised because it contains variables criteria expressed in different units normalisation of the decision matrix is done using eq 6 and the normalised matrix is given in eq 7 6 r i j a i j i 1 m a i j 2 i 1 2 m j 1 2 p 7 r i j r 11 r 1 p r m 1 r m p iii creating the weighted normalised decision matrix vij the weighting was done by multiplying each element of the normalised matrix rij by a weight coefficient such as wi the coefficient of wi mentioned here can be calculated using different techniques in this study we used the ahp technique that is the most popular in the literature to calculate weight coefficients it should be taken into account here that the sum of the criterion weight coefficients is 1 wi 1 w i 1 the weighted matrix vij is given in eq 8 8 v i j w 1 r 11 w n r 1 p w 1 r m 1 w n r m p v 11 v 1 p v m 1 v m p iv determination of positive ideal a and negative ideal a solution values after creating the weighted matrix eq 8 positive and negative ideal solution clusters were calculated by considering the structure of the problem with the use of eq 9 positive ideal solution values were calculated and with eq 10 negative ideal solution values were calculated 9 a m a x j v i j i i m i n v i j j i j v 1 v 1 n 10 a m i n v i j j i i m a x v i j j i j v 1 v 1 n where i is associated with benefit criteria and j is associated with cost criteria v calculation of distances to positive ideal s and negative ideal s points from eq 11 positive distances from ideal solution points were calculated whereas eq 12 considered negative ideal solution points to calculate the subject distances euclidean distance technique was used 11 s i j 1 n v i j v i j 2 12 s i j 1 n v i j v i j 2 vi calculation of relative proximity to the ideal solution ci finally the euclidian distances from the positive and negative ideal points that were determined in the previous step were used to calculate the relative proximity to the ideal solution the relative proximity is denoted by ci and its value is calculated in eq 13 13 c i s i s i s i where ci takes value in the range of 0 ci 1 if ci 0 c i 0 the decision point is near the absolute negative ideal solution if ci 1 the decision point alternative is near the absolute positive ideal solution in the final step of the topsis method decision points alternatives the suitable agricultural areas for our study were ranked with calculated ci values 3 results 3 1 the weights obtained from ahp method by using the weights of the criteria that were calculated by the ahp method an agricultural suitability map was produced for pendik district with weighted overlay of the criteria data sets that was determined with fuzzy memberships and also the topsis method was utilised to rank alternative suitable areas physical attributes natural resources accessibility land use geology and soil properties are important factors in agricultural land development and thus form the six main criteria in the ahp equal weights were assigned to the main criteria and the weights calculated for each sub criteria are provided in the last column of table 5 when the weights of 15 sub criteria are examined as in table 5 it is seen that particularly agricultural land use capability limiting soil factors criteria e g soil properties elevation and land cover use are more effective on the other hand distances to the fast and slow roads criteria were determined to be the least effective 3 2 agricultural land suitability of the pendik district and current land use the suitability results of the pendik district are given in fig 3 representing the suitability values for each raster cell ranging from the lowest to the highest suitability scores as seen in fig 3 although the most suitable areas for agriculture were determined in different locations of the study area these areas were concentrated especially in the north region land suitability values decrease from village centers to the outskirts and from the centers of existing agricultural uses to the surrounding locations the region of the highest suitability is located at the central part of pendik district whereas the regions of lowest suitabilities are scattered in the south and north east with a smaller area located in the north west the results in table 6 indicate that most sites fall under the moderate suitability class s5 and s6 and high suitability class s7 which represents 86 3 of the total area about 8 of the total area was marginally suitable s3 and s4 and 0 07 was lowly suitable or unsuitable s1 and s2 for agricultural production only 5 68 of the study area were found as very highly suitable which is located mainly in the central part and scattered in the eastern and the western parts of the study area when pendik district is examined different land use types can be identified from the current land cover use map fig 4 three land use types can be highlighted under agricultural use these are arable land pastures and permanent crops in our analysis first these land use types were gathered in a dataset and then the land uses were intersected with agricultural suitability map in the gis environment after generalisation of these intersected areas 8 alternative land areas were determined as the most suitable sites for peri urban agriculture fig 5 3 3 ranking of the most suitable alternative agricultural lands to rank the suitable agricultural lands with the topsis method the steps described in the methodology section were undertaken positive a and negative ideal a solution values calculated from eq s 9 and 10 are shown in table 7 we note that it is important to determine the positive a and negative ideal a solution values accurately for determining the positive a ideal solution values we found that 8 of the most suitable agricultural land areas should be close to watercourses fast roads slow roads the market zone and urban dwellings and the values should be low for slope elevation and erosion susceptibility further to these soil depth should be high aspect should be the south direction land use cover lulc be arable land annual crops permanent crops and pastures agricultural land use capability aluc should correspond to arable land and other soil properties relate to low stoniness good drainage finally the geological structure should be siltstone sandstone conglomerate or post tectonic deposits the details are provided in table a1 in the appendix from eq s 11 and 12 the euclidean distances between the positive and negative ideal points were calculated table 8 using eq 13 the relative proximity to the ideal solution was calculated then alternative agricultural lands were ranked by using the obtained ci values as given in table 8 the ranking results of suitable agricultural lands are shown in fig 6 from fig 6 we note that the top three ranked areas are located in the vicinity of current agricultural land uses in the northern part of the study area where there are favourable geo physical accessibility and location climate and soil conditions among these top ranked areas two of them are located close to the reservoir and the other one is close to the fast roads other prioritised suitable areas are in the surroundings of existing villages and at the intersecting points of the road network so that they could benefit from exisiting infrastructure and labour market for the production and distribution of agricultural products 4 discussion peri urban agriculture and its site selection are challenging tasks to land use scientists and practitioners concerning the limitation of green land within current land use patterns we developed a hybrid methodology integrating fuzzy logic ahp and topsis techniques for determining the most sitable sites for peri urban agriculture for our selected case study area our findings show that there is land area potential for peri urban agricultural development particularly in the northern part of pendik district where there is plenty of land for agricultural production this study adds to the research within land suitability modelling through applying fuzzy logic technique for a better representation of continium of suitability scores in the specified peri urban area to sit its agricultural land use in comparison to other commonly used approaches such as parametric and limitation methods fuzzy logic provides a more flexible way to the standardisation of criteria fuzzy set theory permits partial membership of suitability which represents a more realistic measure of continuous factors as opposed to traditional boolean logic barreto neto and de souza filho 2008 showed that the runoff derived from fuzzy method is closer to the measured runoff in the watershed confirming the suitability of using fuzzy logic in modelling the environment a later study by yousefi et al 2018 admits that the use of fuzzy set provides more flexible assessment in the site selection of solar power plants where there are no certain boundaries between suitable and unsuitable classes similar findings were reported by dos santos et al 2020 amini et al 2020 and prabakaran et al 2021 the ahp method is flexible and can be integrated with other methods such as linear programming topsis and fuzzy logic it is a powerful method in dealing with complex decision problems such as determination of weights for the suitability criteria it provides a well structured approach for the calculation of weights and standardisation of the criteria and it is easy to interpret the resulting maps of suitability zhang et al 2015 indicated that ahp is a more effective method in comparison to its alternatives in the calculation of weights given that the inconsistencies in the system can be measured and controlled in the presence of conflicting criteria the effectiveness of ahp has been commonly reported in the literature which used the subject method in land suitability modelling tudes and yigiter 2010 chandio et al 2011 akıncı et al 2013 mosadeghi et al 2015 pramanik 2016 kazazi darani et al 2018 ramya and devedas 2019 pilevar et al 2020 however ahp has also limitations as it is based on a questionnaire survey to calculate relative weights it is more time consuming for technical applications and due to aggregation of scores compensation between good scores on some criteria and bad scores on other criteria may ocur other limitations of the method include poor knowledge of the stakeholders in the area of interest reproducibility of the results and subjectivity of weights applied to suitability criteria park et al 2011 although the ranking has been made from more suitable areas to less suitable areas it is required to identify suitable areas for agriculture according to their size and make these areas prioritised in this sense topsis method focusing on the criteria and alternative agricultural suitable areas in the decision matrix was applied the core of the topsis approach lies in its separation from the best and the worst situations generated by the combinations of each criterion with the most and the least suitability values the ideal point method generated complete sets of weights and ranks each attribute thus overcoming some of the shortages of conventional mcda methods the latter lacks of independence among the selected attributes the criteria were combined using calculations of their eucledian distances from an ideal point this implies that there is no need to specify a specific relationship between the factors and degree of suitability given that such relationships are not necessarily linear as assumed in other mcda methods by this way topsis method improves decision making to select suitable agricultural areas in prioritisation besides determining suitable areas by combining ahp and fuzzy logic with gis techniques however there are also limitations of the topsis method i e normalization is required to solve multidimentional problems and consistency check cannot be applied in topsis despite the limitations topsis has been successively used in the literature either alone or in combination with other methods for instance choudhary and shankar 2012 applied steep fuzzy ahp topsis method for the selection of thermal power plant location ramya and devedas 2019 integrated gis ahp and topsis for the assessment of suitable locations for industrial development as to our knowledge topsis method was not applied to suitability analysis of urban and peri urban agriculture but there are examples on rural agriculture including bagherzadeh and gholizadeh 2016 kia and domirani 2018 özkan et al 2019 wang et al 2021 factors influencing peri urban agricultural suitability are a complex environmental system comprising of humanmade and natural factors each of which contributes to land suitability through summation of each of these factors our study has shown that different factors including physical attributes natural resources accessibility land use geology and soil properties influence land suitability evaluation result this is also confirmed by majumdar 2020 which focused on peri urban agricultural suitability in kolkota city india through integrating mcda model and crop condition monitoring methods the study indicated that land use digital elevation model dem water facility road network and market facility are influencial in peri urban agricultural suitability outcome thapa and murayama 2008 utilised an integrated technique of ahp and gis to assess suitability of land for peri urban agriculture in hanoi province vietnam soil land use water resources road network and market were selected as major factors that affect peri urban land suitability for agriculture in hanoi a different study by la rosa et al 2014 investigated new forms of urban agriculture in their selected case study area of catania south italy to improve sustainability of the city through taking advantage of multiple benefits and services provided within urban context they considered physical ecological and social features that were analysed applying a gis based multi criteria suitability model a final example is nigussie et al 2021 that explored the capacity of farmlands to supply food and search for suitable locations for urban and peri urban agriculture in the city of addis ababa etiopia similar to la rosa et al 2014 they integrated gis with multi criteria model for the urban agriculture suitability assessment based on irrigation development soil fertility management market system and infrastructure and natural resources development as it can be seen from this literature there is no study integrating fuzzy logic ahp and topsis methods for the suitability assessment of urban and peri urban agricultural land although previous studies developed suitability maps for urban peri urban agricultural development ranging from highly suitable areas to unsuitable areas they did not apply fuzzy logic neither did they rank suitable land areas based on their overall performance in the current study fuzzy logic was used to present a more realistic approach in the representation of continuous data sets specifying each criterion and gis techniques were used to create geographical datasets representing the criteria and overlay them according to ahp weights ahp is very suitable for evaluating alternatives especially when there is high numbers of suitability criteria as it is the case in our study topsis is a flexible approach in ranking of the alternative locations based on their overall performance thus it offers an optimal solution from both low cost and concerns on sustainability of growth perspectives from socio economic and environmental perspectives the literature has shown that urban and peri urban agriculture is associated with multiple co benefits supporting sustainable urban development through helping to deal with societal challanges such as food security and human health preserving the cultural landscape providing nature related experience and education and supports ecosystems and their services gradinaru et al 2018 it is therefore important for the city managers and planning authorities to protect and improve peri urban agricultural sites which is also the case in our study area of pendik district to support social ecological and economic conditions of the society potential agricultural activities conducted in our study area can contribute to economic social and environmental pillars of sustainability economically the agricultural land can provide the pendik district and local villages in the site some fresh food and therefore can contribute to food security and provide income to local food producers from social perspective the peri urban agricultural areas can support the cultural way of life provide green space for recreational activities e g hobby farming and other recreational uses encourage social integration and reduce poverty from environmental perspective peri urban agricultural land can be considered as part of the urban green infrustructure which enhances connectivity and networking of green spaces in pendik district this is particularly important for pendik district given that urban green spaces are fragmented and limited in the southern part due to economic growth rapid urbanisation and weak planning policies and decisions supporting peri urban agriculture in the northern part of pendik will therefore support ecosystem services and other benefits resulting from connection and networking of urban green spaces this needs to be supported by laws and regulations aiming to protect the existing and proposed peri urban agricultural sites in the turkish context this study addressed the prioritisation of potential land for peri urban agricultural development in pendik district therefore the land according to its development potential rank can be considered in planning and policy decisions of local authorities and land managers through comparing actual agricultural land and prioritised land new land for future agricultural use can be specified in local area development plans concerning the northern area of pendik district in fact the suitability assessment contributes to a better understanding of land availability for potential food production and to improve ecosystem management which is also significantly encouraged by urban sustainable development it is also possible to apply the methodological framework that we developed in this study for solving land planning problems such as sitting urban and peri urban agricultural land in different areas and regions in the world 5 conclusion as mentioned the need to carry out agricultural activities in areas close to cities has emerged by enabling various agricultural functions it is necessary to examine these areas in relation to the city functions and to correctly analyse the criteria for choosing the suitable lands in the planning process suitability criteria were derived scientifically from relevant indicators that are applicable for our study area e g physical attributes natural resources accessibility land use geology and soil properties the database for mapping criteria were obtained from public and private sources and the process by which the criteria were ranked is based on a new hybrid approach where we combined fuzzy set ahp and topsis for the determination of the most suitable areas for peri urban agriculture we note that there are many different factors that can be influencial in the site selection problem of peri urban agriculture nevertheless it is almost impossible to include all factors that influence site suitability evaluation this highlights the importance of decision support systems dsss that assist in managing all parameters included in a given analysis and help to managers to choose one of the options by analysing large amount of data in a relatively short time period kazak et al 2017 dsss are applicable in case of unstructured or semi structured problems through offering a tool to decision makers to compare results with increasing their readibility kazak et al 2017 although dsss are powerful tools and assists in conducting complex data analysis these tools remain only a source of decision support given that the final decision always have to be made by people themselves kazak and van hoof 2018 the suitability map that we generated using the fuzzy logic and ahp were analysed under six degrees of suitability classes namely unsuitable lowly suitable marginally suitable moderately suitable highly suitable and very highly suitable most land uses in the study area fall under the high suitable class and moderately suitable class for peri urban agricultural production around 27 of the total land area was found to be highly suitable for agricultural development whereas only 0 07 was unsuitable the unsuitable areas mainly lay in the southern part where urban development occupies the majority of land through the topsis method parts of agricultural land in the north have been identified as the highest agricultural development priority due to their favourable geo physical land use accessibility natural amenities and soil characteristics the proposed method for prioritising agricultural development provides an effective tool for planners and policy makers therefore the results of our analysis can be used in planning processes of these areas as part of planning and management of agricultural land in this regard land re adjustment should be made to reorganise cadastral parcels so that they correspond to suitable agricultural parcels with appropriate size and shape declaration of competing interest the authors declare no conflict of interest acknowledgements the study presented here was funded by the scientific and technological research council of turkey tubi̇tak linked to bideb 2232 programme project no 118c002 appendix table a1 
24602,individual trait variation has important ecological implications for species populations and communities in particular individual variation of metabolic rate links directly with the energy use estimation and scaling patterns in community ecology here we examine the mean variance relationship of individual metabolic rate by testing taylor s law a power function relationship between mean and variance for individual rescaled metabolic rate across tree communities in tropical forests we use a constraint based model called maximum entropy theory of ecology mete to estimate and predict the parameters of taylor s law our results show that when assuming a universal metabolic scaling between metabolic rate and aboveground biomass the mete generates the form of taylor s law but fails to predict its slope when setting the metabolic scaling exponent as a community level parameter in the mete model the estimated and predicted slopes of taylor s law agree with each other our parameterized mete model reveals the positive effect of number of individuals on the metabolic scaling exponent these results suggest that fluctuation scaling of individual metabolic rate can be explained solely by the macroecological constraints of communities without relying on the physiological or genetic characters of individual organisms keywords constraint based models diaoluo mountain individual metabolic rate distribution lagrange multiplier maximum entropy mean variance relationship metabolic scaling panama canal 1 introduction individuals of ecological populations and communities display intraspecific and interspecific trait e g body size diet preference and energy use variations that impact population dynamics and ecosystem performance jung et al 2010 bolnick et al 2011 forsman and wennersten 2016 metabolic rate is a key physiological trait that supports individual s growth maintenance and reproduction burton et al 2011 pettersen et al 2018 individual variation of metabolic rate has profound ecological implications across multiple levels of biological organizations first individual metabolic rate variation reflects individual differences in behavior and fitness biro and stamps 2010 careau and garland 2012 metcalfe et al 2016 roche et al 2016 such as aggression cutts et al 1998 morphology speakman et al 2004 and survival pettersen et al 2018 these differences consequently affect the performance and adaptability of species populations burton et al 2011 norin and metcalfe 2019 second it has been shown that individual performance and life history often scale as nonlinear functions of metabolic rate brown et al 2004 jackson et al 2014 auer et al 2015 schramski et al 2015 ton and martin 2016 when scaling up these functions to high organizational levels the average across individuals or species of a nonlinear function is not equal to the function evaluated at the average metabolic rate due to jensen s inequality bolnick et al 2011 in such case higher order moment e g variance estimate of the individual metabolic rate is necessary to accurately approximate the mean of the function savage 2004 so that species or community level properties can be studied lastly individual metabolic rate variation can be integrated with other scaling relationships to test hypotheses in population and community ecology for example by combining the allometric scaling of metabolic rate west et al 2002 and the abundance size variance relationship xu 2016 wang and xu 2017 one can derive the relationship between the variance of assemblage abundance and the variance of individual metabolic rate see discussion for the derivation such relationship can then be used to infer the stability diversity hypothesis in ecology goodman 1975 the ecological relevance of individual metabolic rate variation prompts the questions what are the ecological causes of individual metabolic rate variation is there any scaling relationship that quantifies the variance of individual metabolic rate across spatial temporal or taxonomic scales if yes what theoretical models can be used to explain such relationship we give the background information of these questions in the following we then specify the objectives of the current work at the end of the introduction metabolic rate variation originates not only from individual difference in biology e g size age and sex but also from environmental factors e g temperature the well known wbe model west et al 1997 1999 predicts metabolic rate as a function of body mass and temperature with a universal metabolic scaling exponent of the power function between metabolic rate and body mass of 3 4 contrary to the prediction of the wbe model numerous empirical studies have shown that the metabolic scaling exponent is not universal but rather diverse calder 1996 bokma 2004 glazier 2005 2010 white et al 2007a 2012a hudson et al 2013 research that explores variation in metabolic scaling mostly focuses on the taxonomic differences using species level data glazier 2005 white et al 2007a isaac and carbone 2010 other studies have examined the effects of ontogeny gaitán espitia et al 2013 activity glazier 2020 lifestyle killen et al 2010 and geographical conditions lovegrove 2000 on the metabolic scaling exponent little is known about the variation of metabolic scaling across spatially distinct communities at local or regional scales and the ecological factors that influence such variation we quantify the individual metabolic rate variation using a well known scaling relationship in ecology called taylor s law henceforth tl taylor 1961 tl states that the variance of species abundance is a power function of the mean species abundance taylor et al 1978 1980 taylor and woiwod 1980 1982 recently empirical studies have shown that a variety of biological and non biological quantities beyond non human species abundance conform to tl such as human population density cohen et al 2013 naccarato and benassi 2018 benassi and naccarato 2019 xu and cohen 2019 human mortality bohk et al 2015 leaf symmetry wang et al 2018 energy released by earthquake shi et al 2019 tornado outbreaks tippett and cohen 2016 rainfall tippett and cohen 2020 and prime numbers cohen 2016 other empirical evidence for tl is given in eisler et al 2008 and taylor 2019 the theoretical explanations of tl for species abundance have been studied from biological taylor and taylor 1977 anderson et al 1982 kilpatrick and ives 2003 and statistical kendal and jørgensen 2011a 2011b xiao et al 2015 cohen and xu 2015 perspectives in contrast the empirical evidence and underlying models of tl for individual level traits e g body size and metabolic rate are lacking but see xu 2016 wang and xu 2017 we use the maximum entropy theory of ecology henceforth mete harte 2011 to model and predict tl for individual metabolic rate across communities mete is a constraint based theory using the information entropy concept from thermodynamics and communication science jaynes 1957 harte et al 2008 harte 2011 the key idea of mete is to derive the most uniform joint distribution of species abundance and individual metabolic rate and the intraspecific spatial abundance distribution subject to the mean constraints of macro state variables i e number of individuals number of species total area total metabolic rate of the studied system mete has generated successful predictions of various distribution and scaling patterns in ecology such as species area relationship harte et al 2009 harte and kitzes 2015 wilber et al 2015 species abundance distribution white et al 2012b xiao et al 2015 and individual metabolic rate distribution newman et al 2014 harte et al 2017 the energetic predictions of mete rely on the universal metabolic scaling exponent from external theories e g the metabolic scaling theory west et al 1997 1999 xu 2020 modified the original mete by setting the metabolic scaling exponent as a free parameter and estimated the exponent by fitting the parameterized mete model to the observed individual diameter distribution within a tree community using the mete to model tl for individual metabolic rate provides a top down approach to studying the individual level properties under macro state constraints at the community level without relying on individual s physiology or system specific processes the main goal of this current work is to investigate whether the mete models are useful in predicting the form and parameters of tl for individual metabolic rate specifically using individual tree biomass data from tropical forests we calculate two sets of individual metabolic rate one using the universal metabolic scaling exponent predicted from the metabolic scaling theory west et al 1997 1999 and adopted by the original mete model harte 2011 the other using the metabolic scaling exponent estimated from the parameterized mete model xu 2020 for each set of individual metabolic rate we estimate its mean and variance among individuals and obtain the corresponding tl s parameters by linear regression moreover we predict analytically the mean and variance of individual metabolic rate within a community using the mete for each mete model original and parameterized we compare the parameters of tl using the correspondingly estimated and predicted sets of means and variances similarity in the tl s parameters would inform us about the predictive power of each mete model for tl 2 materials and methods 2 1 data we obtained individual tree data from two tropical forests to test and model tl for individual metabolic rate in both data we used aboveground biomass as the measure for individual tree size the first data set is from the diaoluo mountain latitude 18 45 n longitude 109 52 e a tropical forest in lingshui county of the hainan province china the forest was established as a national forest park in 1999 with a total area of 22 279 hectares in 2014 huang et al 2015 and an average elevation of 1184 m the forest consists mainly of tropical lowland rainforest tropical mountainous rainforest and mountain evergreen broadleaf dwarf forest ma et al 2016 in 2010 and again in 2015 all trees with a diameter at breast height dbh 2 cm were censused from 15 sites each 50 m by 50 m see table 1 in wang and xu 2017 we selected the 2015 data and defined all censused trees regardless of taxon including one tree with dbh of 1 9 cm in each site as a tree community each tree was identified to species and its dbh in cm height in m under crown height in m and crown dimensions east to west south to north in m were measured aboveground biomass agb in g of an individual tree was calculated from its dbh height and wood density following wang and xu 2017 see eqn 5 therein in total 14 282 trees from all 15 sites in 2015 were used for analysis the second data set is the tree census data from 65 forest plots in panama condit et al 2019 of the 65 plots 22 plots were censused once and 43 plots were censused multiple times from 1994 to 2014 to reduce the effect of inter annual temperature variation on tree metabolism and the confounding effect of spatial scale on tl we selected 29 1 ha plots that were first censused in 1996 and 1997 these 29 plots each of 100 m by 100 m are located in tropical lowland forest areas along the climatic gradient of the panama canal pyke et al 2001 within each plot all woody stems with a dbh 10 cm were identified and measured for each tree with multiple stems we defined its dbh by combining the dbh from all of its stems using the pipe model d b h t r e e s t e m d b h s t e m 2 1 2 ernest et al 2009 we defined all measured trees regardless of taxon in each plot as a tree community stem agb in metric tons was calculated from stem dbh and wood density using the equation for moist forests chave et al 2005 we calculated a tree s agb by summing over its stems agb in total 13 295 trees from all 29 plots were used for analysis 2 2 maximum entropy models we predicted the individual rescaled metabolic rate rmr distribution using the maximum entropy theory of ecology mete harte et al 2008 harte 2011 xiao et al 2015 and its parameterized generalization xu 2020 specifically we defined the rmr of an individual as a power of its agb as ε mb agb min agb b here min agb is the minimum individual agb within a community and m is the individual rescaled agb agb min agb b is the metabolic scaling exponent mete s prediction of individual rmr distribution is harte 2011 xiao et al 2015 1 ψ ϵ s 0 n 0 λ 2 e γ 1 e γ 2 e β 1 e β n 0 1 e β 1 n 0 1 e n 0 γ n 0 e n 0 1 γ here s 0 and n 0 are respectively the number of species and the number of individuals within a community β λ 1 λ 2 and γ λ 1 λ 2 ε with λ 1 and λ 2 being the lagrange multipliers of the entropy maximization problem eqn 1 is the most uniform individual rmr distribution constrained by the mean number of individuals per species and mean metabolic rate per species from eqn 1 we derived the analytical formulas for the mean and variance of individual rmr within a community see supplementary materials s1 and used them to predict tl for individual rmr both the original and the parameterized mete models predict the individual rmr distribution using eqn 1 but they differ fundamentally by the treatments of the metabolic scaling exponent b for the original mete b is borrowed from the metabolic scaling theory for vascular plants west et al 1999 which predicts that b 3 4 for agb hence the original mete has no free parameter in contrast the parameterized mete sets b as a community level parameter to estimate b we first transformed eqn 1 to individual rescaled agb m distribution using the change of variable formula see eqn 3 and appendix s1 in xu 2020 2 ξ m b m b 1 λ 2 e γ 1 e γ 2 e β 1 e β n 0 1 e β 1 n 0 1 e n 0 γ n 0 e n 0 1 γ where γ is defined as in eqn 1 and written as a function of m γ λ 1 λ 2 ε λ 1 λ 2 mb in eqn 2 then we estimated b by fitting eqn 2 to the observed individual rescaled agb distribution using the maximum likelihood method unlike the original mete which assumes a universal b of 0 75 the parameterized mete predicts b from the observed individual agb distribution within a community under the mete framework using the universal b assumed in the original mete and the community level b estimated from the parameterized mete respectively we calculated two sets of individual rmr from the agb data using ε agb min agb b and tested respectively tl for individual rmr across communities we then predicted tl for individual rmr with the mean and variance formulas derived from eqn 1 using b s from each mete model fig 1 illustrates the use of the two mete models in this work to evaluate the goodness of fit of the mete models in each tree community we fitted the observed individual rescaled agb distribution using the original mete eqn 2 with b 0 75 the parameterized mete eqn 2 with b as a free parameter and five phenomenological models supplementary materials table s2 1 exponential power law 2 parameter weibull quasi weibull muller landau et al 2006 and 3 parameter weibull crénin 2015 we left truncated each of the phenomenological models at one to match the minimum rescaled agb in each community we fitted all models using the maximum likelihood method and compared their performance using the akaike information criterion corrected for sample size aicc and aicc weight model s with the lowest aicc or largest aicc weight is considered the best for the corresponding tree community to test the robustness of each model with respect to different optimization methods we fitted each model against the empirical data using the nelder mead method nelder and mead 1965 and the newton s method separately if a model s aicc under the two methods differed by more than two in magnitude then the corresponding model was eliminated from the analysis due to its lack of reliability if a model s aicc under the two methods differed by no more than two in magnitude then the nelder mead method was used to obtain the model parameters and aicc 2 3 statistical analysis for each community from each data set we had two sets of estimated individual rmr one using a universal b from metabolic scaling theory the other using b predicted from the parameterized mete see fig 1 for each set we calculated the mean and variance of individual rmr across all individuals regardless of taxon within each community we then tested tl for individual rmr across all communities using the least squares linear regression 3 log v a r i a n c e α 1 β 1 log m e a n and tested the nonlinearity between log mean and log variance using the least square quadratic regression 4 log v a r i a n c e α 2 β 2 log m e a n γ 2 log m e a n 2 log mean and log variance exhibit a linear relationship or tl if β 1 0 in eqn 3 and a nonlinear relationship if γ 2 0 in eqn 4 taylor et al 1978 kolokotrones et al 2010 we call such obtained β 1 the estimated slope of tl similarly we fitted eqns 3 and 4 to the predicted means and variances from the mete model and the parameterized mete model separately supplementary materials eqns s1 2 and s1 3 we call the corresponding estimate of β 1 the predicted slope of tl throughout log log10 to study the sampling effect on the estimated and predicted slopes of tl we created 1000 bootstrap samples of individual trees for each actual community and repeated the entire modeling procedure fig 1 for each bootstrap sample we built the 95 confidence interval ci of the estimated and predicted tl s parameters β 1 and α 1 in eqn 3 and γ 2 eqn 4 using the 2 5th and 97 5th percentiles of the corresponding 1000 point estimates in addition we calculated the difference between the 1000 predicted values and 1000 estimated values of each parameter and built the 95 ci for the corresponding difference if a 95 ci does not contain zero then it means that the predicted and estimated values are significantly different similarly we obtained the 95 ci of the metabolic scaling exponent b from the maximum likelihood estimate of b by fitting the parameterized mete to each bootstrap sample data analysis and model fitting were done in r 4 0 2 r core team 2020 nelder mead method and newton s method for the maximum likelihood estimation were implemented using the optim function of the stats package r core team 2020 and the maxlik function of the maxlik package henningsen and toomet 2011 respectively 3 results for the diaoluo data the parameterized mete model eqn 2 table s2 1 fitted the observed agb distribution well visually in most sites fig 2 the parameterized mete model had the lowest aicc or highest aicc weight among all individual rescaled agb distribution models in 14 of the 15 sites tables 1 and s2 2 the average aicc weight per site was in descending order 94 40 for the parameterized mete model 5 60 for the original mete model and less than 0 01 for the other models for each site the quasi weibull model and the 3 parameter weibull model each yielded different aicc under the two optimization methods see materials and methods in four sites the 2 parameter weibull model yielded different aicc under the two optimization methods these combinations of models and sites were eliminated from analysis for the panama data the parameterized mete model fitted the observed agb distribution well visually in most plots fig 3 and had the lowest aicc in 25 of the 29 plots tables 2 and s2 3 the average aicc weight per plot was in descending order 79 79 for the parameterized mete model 30 81 for the 3 parameter weibull model 4 96 for the original mete model 2 16 for the 2 parameter weibull model 2 01 for the quasi weibull model and less than 0 01 for the exponential model and the power law model under the two optimization methods the quasi weibull model yielded different aicc in 24 plots and the 3 parameter weibull model yielded different aicc in 17 plots these combinations of models and plots were eliminated from analysis metabolic scaling exponent b predicted from the parameterized mete model showed substantial variation among tree communities for the diaoluo data the point estimate of b ranged from 0 58 to 1 23 across sites table 1 of the 15 sites 95 bootstrap ci of b was greater than 0 75 in 12 sites smaller than 0 75 in two sites and contained 0 75 in one site for the panama data the point estimate of b ranged from 0 65 to 1 14 across plots table 2 of the 29 plots 95 bootstrap ci of b was greater than 0 75 in 25 plots and included 0 75 in four plots in both data sets when assuming a universal b 0 75 95 ci of the estimated slope of tl β 1 of eqn 2 was greater than two and 95 ci of the predicted slope of tl was lower than two table 3 figs 4 a c and 5 a c predicted slope of tl from the original mete model was significantly lower than the corresponding estimated slope of tl predicted intercept of tl of the original mete model was significantly higher than the corresponding estimated intercept of tl estimated and predicted quadratic coefficients of eqn 4 γ 2 were similar for the diaoluo data but significantly different for the panama data on the other hand when using b from the parameterized mete model eqn 2 estimated and predicted parameters of tl did not differ from each other in both data sets except that the predicted intercept of tl was significantly greater than the estimated intercept of tl for the panama data table 3 figs 4b d and 5b d estimated and predicted γ 2 were not significantly different in both data sets 4 discussion in summary we find that the mete models both original and parameterized are capable of predicting the form of taylor s law tl for individual metabolic rate across tree communities when assuming the metabolic scaling exponent b as a universal constant prediction of the original mete model underestimated the estimated slope of tl and overestimated the estimated intercept of tl when b was predicted as a community level parameter from mete s individual agb distribution model eqn 2 the predicted slope of tl agreed with the estimated slope of tl in addition our parameterized mete model revealed the effect of ecological variables on the cross community variation of metabolic scaling by estimating b from the data the parameterized mete model was the best individual rescaled agb distribution model for most communities in both data sets tables 1 and 2 this finding is remarkable for two reasons first it suggests that we do not need to invoke detailed biological processes to model size variation within community since mete is a constraint based model derived from the entropy principle and the macro state ecological variables i e number of individuals and number of species second with the parameterized mete model outperforming the other phenomenological models it implies that b as the only parameter in the parameterized mete model captures key biological information of the individual agb distribution in this sense our parameterized mete provides a useful way of estimating b since it does not require metabolic rate measurements that are difficult to obtain from field data butler et al 2004 in most tree communities analyzed here tables 1 and 2 our parameterized mete model showed that b was greater than 0 75 a universal value predicted from the metabolic scaling theory west et al 1997 1999 and partially supported by empirical evidence savage et al 2004 this means that the analyzed tropical forest tree communities expend metabolic energy at a faster rate than that predicted by the metabolic scaling theory range of b predicted from the parameterized mete model was 0 64 for the diaoluo data and 0 49 for the panama data reflecting the variability of b across local communities in both data sets b was positively correlated with the number of individuals within a community fig 6 simple least squares regressions show that number of individuals explained 46 and 54 of variability in b for the diaoluo data and the panama data respectively while number of species explained 1 and 4 of variability in b for the diaoluo data and the panama data respectively analysis using samples bootstrapped from the entire sampling area of each data set showed similar results supplementary materials figs s3 2 and s3 3 we speculate that the predicted b value its variation and its correlation with the number of individuals may be explained by several biological processes first it is possible that the high amount of soil nutrient precipitation and sunlight in tropical forests provide ample resources that permit high energy expenditure by the inhabited individuals second tropical forests are featured by their great taxonomic and functional diversity high species richness for example may lead to interspecific competition that favors the species with high energy use rate third cross community variation of b indicates that local biotic and abiotic factors e g soil condition and species composition may be more important than the large scale environmental conditions e g climate in controlling the metabolic scaling rate we note that our parameterized model relies on community level variables i e total number of individuals and number of species and does not consider individual or species level differences which may further increase the variability of b fourth large number of interspecific trees in the tropics may improve plant plant facilitation that boosts energy acquisition which results in the positive correlation between b and the number of individuals our work provides not only empirical evidence for tl for individual metabolic rate but also a theoretical model i e the parameterized mete model that predicts its slope under the maximum entropy framework the variation of number of individuals number of species and metabolic scaling across communities are sufficient to predict the form and parameters of tl table 3 our model adopts a statistical mechanics approach and uses community level variables to predict individual level patterns such approach is different from the biological models of tl that rely on the system specific mechanisms taylor and taylor 1977 anderson et al 1982 kilpatrick and ives 2003 or the statistical models of tl that are devoid of biological information kendal and jorgensen 2011a 2011b cohen and xu 2015 xiao et al 2015 the successful prediction of tl adds another item to the existing list of macroecological patterns that can be explained by the mete harte 2011 what are the ecological implications of tl for individual metabolic rate first our work extends the empirical confirmation of tl to individual level trait i e metabolic rate therefore opening up the opportunities to understand the mechanisms of tl using individual based models and tools in particular both the original and the parameterized mete models predicted the form of tl for individual metabolic rate but only the parameterized model reproduced successfully tl s parameters this implies that the form of tl is robust enough to be generated under the basic mete framework however key biological information i e metabolic scaling needs to be included in the mete to recover tl s parameters in this sense our findings are in agreement with the recent explorations of tl using the feasible set theory xiao et al 2015 johnson and wilber 2017 on the other hand the validity of tl for individual metabolic rate makes it possible to scale up individual level characteristics to infer properties at higher levels of biological organization e g population or community as mentioned in the introduction many individual level traits are nonlinear functions of the metabolic rate when scaling up these functions to the population or community level the average of a nonlinear function is not equal to the function evaluated at the average due to jensen s inequality unfortunately several ecological properties and patterns such as the population energy use ernest et al 2003 and abundance size relationship white et al 2007b are often tested without evaluating the approximation error caused by the jensen s inequality mathematically to improve the approximation requires higher order moments of individual metabolic rate that is if we denote the nonlinear function of rescaled metabolic rate as f ε then its average f ϵ can be approximated as f ϵ f ϵ 2 v a r ϵ and its variance v a r f ϵ can be approximated as f ϵ 2 v a r ϵ following the delta method oehlert 1992 here f and f are respectively the first derivative and the second derivative of f if tl for individual metabolic rate holds then we can replace v a r ϵ with the power function of ϵ in the above formulas to approximate f ϵ the validity of tl is necessary for scaling up individual level properties using the average value of individual metabolic rate we now give a concrete example of using tl for individual metabolic rate to derive a new scaling relationship at the community level empirical studies by xu 2016 and wang and xu 2017 have shown that the community level spatial variation of assemblage abundance is a negative power function of the individual size variation supporting that hypothesis that a functionally diverse community can enhance the stability of the community mccann 2000 ives and carpenter 2007 denoting the assemblage abundance as n and use agb as individual size measure this relationship states that v a r n is proportional to v a r a g b a a 0 here we use this relationship to derive a new relationship between the variance of assemblage abundance and the variance of individual metabolic rate using the metabolic scaling relationship ϵ a g b min a g b b a g b b and a g b ϵ 1 b using the delta method and tl v a r ϵ ϵ β 1 we can derive a power function relationship between v a r n and v a r ϵ 5 v a r n v a r a g b a v a r ϵ 1 b a 1 b ϵ 1 b 1 2 v a r ϵ a ϵ 2 b 2 v a r ϵ a v a r ϵ 2 b 2 β 1 v a r ϵ a v a r ϵ 2 2 b β 1 a β 1 suppose tl s slope β 1 is positive then the relationship between v a r n and v a r ϵ depends on the relative size of 2 2 b and β 1 in all tree communities analyzed in this work the parameterized mete model predicted that 0 b 2 tables 1 and 2 hence 2 2 b 1 on the other hand estimated β 1 from the parameterized mete model was greater than one table 3 therefore 2 2 b β 1 and 2 2 b β 1 0 eqn 5 implies that the higher individual metabolic rate variation larger v a r ϵ is associated with lower spatial variation of assemblage abundance smaller v a r n treating v a r ϵ as an index for functional diversity and v a r n as an index for spatial instability of the community the above observation gives an empirical evidence for the diversity stability hypothesis it will be interesting to test the parameterized mete model against other data to see if the hypothesis holds for other taxa and communities overall eqn 5 provides a novel integration of two seemingly unrelated scaling parameters b and β 1 and can be used to infer important hypothesis of ecological systems several aspects of the mete models deserve further investigation first we use the simple power function scaling relationship between metabolic rate and agb in the original and the parameterized mete models the effect of temperature and other nonlinear function forms of metabolic scaling kolokotrones et al 2010 may alter the goodness of fit and predictions of the mete models second individual covariance may play a role in determining the tl s slope ballantyne and kerkhoff 2007 but is not incorporated in the formulation of mete which assumes independence among individuals modification of the original mete incorporating individual covariance can shed light in this direction lastly whether the parameterized mete can predict other distribution and scaling patterns in population and community ecology e g intraspecific metabolic rate distribution and tl for intraspecific body size needs more research we argue that it is not trivial to deduce tl for individual metabolic rate or trait in general from well studied scaling relationships in ecology including the abundance size relationship tl for species abundance and allometric scaling of metabolic rate except for the individual size distribution which is one of the abundance size relationships see white et al 2007b none of these scaling patterns incorporates in their formulations the individual level variance of metabolic rate or other traits which is needed to test tl individual size distribution contains individual s size information and can be used to calculate individual level variance from empirical data but this would require grouping individuals into different size classes and the variance calculation may be affected by the class width and the number of classes in contrast our parameterized mete model provides an explicit formula of the individual agb distribution eqn 2 from which the individual level variance can be predicted analytically and compared against data the validity of tl for individual metabolic rate leads to a mathematical relation between the mean and variance of individual trait but it does not mean that we should abandon individual trait variation and focus solely on the mean based approach nakagawa and schielzeth 2012 violle et al 2012 sánchez tójar et al 2020 instead the mean variance scaling studied here offers a method of refining the approximation of community level properties when scaling up nonlinear allometric relationships from the individual level on the other hand our parameterized mete model provides a system independent explanation of tl for individual metabolic rate across tree communities our model adds a new theoretical explanation of the individual variation of metabolic rate without relying on the physiological or genetic characters of individual organisms burton et al 2011 white and kearney 2013 data availability statement diaoluo data and panama data are available from the dryad digital repository respectively at https doi org 10 5061 dryad 87n81 and https doi org 10 15146 mdpr pm59 credit authorship contribution statement meng xu methodology software investigation visualization writing original draft writing review editing funding acquisition mengke jiang software writing original draft hua feng wang methodology data curation writing original draft funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we thank richard condit for sharing the panama tree plots data xu was supported by the scholarly research fund from pace university wang was supported by national scientific foundation of china 31660055 and initial fund from hainan university kyqd1633 the authors declare no conflict of interest supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j ecolmodel 2021 109655 appendix supplementary materials image application 1 
24602,individual trait variation has important ecological implications for species populations and communities in particular individual variation of metabolic rate links directly with the energy use estimation and scaling patterns in community ecology here we examine the mean variance relationship of individual metabolic rate by testing taylor s law a power function relationship between mean and variance for individual rescaled metabolic rate across tree communities in tropical forests we use a constraint based model called maximum entropy theory of ecology mete to estimate and predict the parameters of taylor s law our results show that when assuming a universal metabolic scaling between metabolic rate and aboveground biomass the mete generates the form of taylor s law but fails to predict its slope when setting the metabolic scaling exponent as a community level parameter in the mete model the estimated and predicted slopes of taylor s law agree with each other our parameterized mete model reveals the positive effect of number of individuals on the metabolic scaling exponent these results suggest that fluctuation scaling of individual metabolic rate can be explained solely by the macroecological constraints of communities without relying on the physiological or genetic characters of individual organisms keywords constraint based models diaoluo mountain individual metabolic rate distribution lagrange multiplier maximum entropy mean variance relationship metabolic scaling panama canal 1 introduction individuals of ecological populations and communities display intraspecific and interspecific trait e g body size diet preference and energy use variations that impact population dynamics and ecosystem performance jung et al 2010 bolnick et al 2011 forsman and wennersten 2016 metabolic rate is a key physiological trait that supports individual s growth maintenance and reproduction burton et al 2011 pettersen et al 2018 individual variation of metabolic rate has profound ecological implications across multiple levels of biological organizations first individual metabolic rate variation reflects individual differences in behavior and fitness biro and stamps 2010 careau and garland 2012 metcalfe et al 2016 roche et al 2016 such as aggression cutts et al 1998 morphology speakman et al 2004 and survival pettersen et al 2018 these differences consequently affect the performance and adaptability of species populations burton et al 2011 norin and metcalfe 2019 second it has been shown that individual performance and life history often scale as nonlinear functions of metabolic rate brown et al 2004 jackson et al 2014 auer et al 2015 schramski et al 2015 ton and martin 2016 when scaling up these functions to high organizational levels the average across individuals or species of a nonlinear function is not equal to the function evaluated at the average metabolic rate due to jensen s inequality bolnick et al 2011 in such case higher order moment e g variance estimate of the individual metabolic rate is necessary to accurately approximate the mean of the function savage 2004 so that species or community level properties can be studied lastly individual metabolic rate variation can be integrated with other scaling relationships to test hypotheses in population and community ecology for example by combining the allometric scaling of metabolic rate west et al 2002 and the abundance size variance relationship xu 2016 wang and xu 2017 one can derive the relationship between the variance of assemblage abundance and the variance of individual metabolic rate see discussion for the derivation such relationship can then be used to infer the stability diversity hypothesis in ecology goodman 1975 the ecological relevance of individual metabolic rate variation prompts the questions what are the ecological causes of individual metabolic rate variation is there any scaling relationship that quantifies the variance of individual metabolic rate across spatial temporal or taxonomic scales if yes what theoretical models can be used to explain such relationship we give the background information of these questions in the following we then specify the objectives of the current work at the end of the introduction metabolic rate variation originates not only from individual difference in biology e g size age and sex but also from environmental factors e g temperature the well known wbe model west et al 1997 1999 predicts metabolic rate as a function of body mass and temperature with a universal metabolic scaling exponent of the power function between metabolic rate and body mass of 3 4 contrary to the prediction of the wbe model numerous empirical studies have shown that the metabolic scaling exponent is not universal but rather diverse calder 1996 bokma 2004 glazier 2005 2010 white et al 2007a 2012a hudson et al 2013 research that explores variation in metabolic scaling mostly focuses on the taxonomic differences using species level data glazier 2005 white et al 2007a isaac and carbone 2010 other studies have examined the effects of ontogeny gaitán espitia et al 2013 activity glazier 2020 lifestyle killen et al 2010 and geographical conditions lovegrove 2000 on the metabolic scaling exponent little is known about the variation of metabolic scaling across spatially distinct communities at local or regional scales and the ecological factors that influence such variation we quantify the individual metabolic rate variation using a well known scaling relationship in ecology called taylor s law henceforth tl taylor 1961 tl states that the variance of species abundance is a power function of the mean species abundance taylor et al 1978 1980 taylor and woiwod 1980 1982 recently empirical studies have shown that a variety of biological and non biological quantities beyond non human species abundance conform to tl such as human population density cohen et al 2013 naccarato and benassi 2018 benassi and naccarato 2019 xu and cohen 2019 human mortality bohk et al 2015 leaf symmetry wang et al 2018 energy released by earthquake shi et al 2019 tornado outbreaks tippett and cohen 2016 rainfall tippett and cohen 2020 and prime numbers cohen 2016 other empirical evidence for tl is given in eisler et al 2008 and taylor 2019 the theoretical explanations of tl for species abundance have been studied from biological taylor and taylor 1977 anderson et al 1982 kilpatrick and ives 2003 and statistical kendal and jørgensen 2011a 2011b xiao et al 2015 cohen and xu 2015 perspectives in contrast the empirical evidence and underlying models of tl for individual level traits e g body size and metabolic rate are lacking but see xu 2016 wang and xu 2017 we use the maximum entropy theory of ecology henceforth mete harte 2011 to model and predict tl for individual metabolic rate across communities mete is a constraint based theory using the information entropy concept from thermodynamics and communication science jaynes 1957 harte et al 2008 harte 2011 the key idea of mete is to derive the most uniform joint distribution of species abundance and individual metabolic rate and the intraspecific spatial abundance distribution subject to the mean constraints of macro state variables i e number of individuals number of species total area total metabolic rate of the studied system mete has generated successful predictions of various distribution and scaling patterns in ecology such as species area relationship harte et al 2009 harte and kitzes 2015 wilber et al 2015 species abundance distribution white et al 2012b xiao et al 2015 and individual metabolic rate distribution newman et al 2014 harte et al 2017 the energetic predictions of mete rely on the universal metabolic scaling exponent from external theories e g the metabolic scaling theory west et al 1997 1999 xu 2020 modified the original mete by setting the metabolic scaling exponent as a free parameter and estimated the exponent by fitting the parameterized mete model to the observed individual diameter distribution within a tree community using the mete to model tl for individual metabolic rate provides a top down approach to studying the individual level properties under macro state constraints at the community level without relying on individual s physiology or system specific processes the main goal of this current work is to investigate whether the mete models are useful in predicting the form and parameters of tl for individual metabolic rate specifically using individual tree biomass data from tropical forests we calculate two sets of individual metabolic rate one using the universal metabolic scaling exponent predicted from the metabolic scaling theory west et al 1997 1999 and adopted by the original mete model harte 2011 the other using the metabolic scaling exponent estimated from the parameterized mete model xu 2020 for each set of individual metabolic rate we estimate its mean and variance among individuals and obtain the corresponding tl s parameters by linear regression moreover we predict analytically the mean and variance of individual metabolic rate within a community using the mete for each mete model original and parameterized we compare the parameters of tl using the correspondingly estimated and predicted sets of means and variances similarity in the tl s parameters would inform us about the predictive power of each mete model for tl 2 materials and methods 2 1 data we obtained individual tree data from two tropical forests to test and model tl for individual metabolic rate in both data we used aboveground biomass as the measure for individual tree size the first data set is from the diaoluo mountain latitude 18 45 n longitude 109 52 e a tropical forest in lingshui county of the hainan province china the forest was established as a national forest park in 1999 with a total area of 22 279 hectares in 2014 huang et al 2015 and an average elevation of 1184 m the forest consists mainly of tropical lowland rainforest tropical mountainous rainforest and mountain evergreen broadleaf dwarf forest ma et al 2016 in 2010 and again in 2015 all trees with a diameter at breast height dbh 2 cm were censused from 15 sites each 50 m by 50 m see table 1 in wang and xu 2017 we selected the 2015 data and defined all censused trees regardless of taxon including one tree with dbh of 1 9 cm in each site as a tree community each tree was identified to species and its dbh in cm height in m under crown height in m and crown dimensions east to west south to north in m were measured aboveground biomass agb in g of an individual tree was calculated from its dbh height and wood density following wang and xu 2017 see eqn 5 therein in total 14 282 trees from all 15 sites in 2015 were used for analysis the second data set is the tree census data from 65 forest plots in panama condit et al 2019 of the 65 plots 22 plots were censused once and 43 plots were censused multiple times from 1994 to 2014 to reduce the effect of inter annual temperature variation on tree metabolism and the confounding effect of spatial scale on tl we selected 29 1 ha plots that were first censused in 1996 and 1997 these 29 plots each of 100 m by 100 m are located in tropical lowland forest areas along the climatic gradient of the panama canal pyke et al 2001 within each plot all woody stems with a dbh 10 cm were identified and measured for each tree with multiple stems we defined its dbh by combining the dbh from all of its stems using the pipe model d b h t r e e s t e m d b h s t e m 2 1 2 ernest et al 2009 we defined all measured trees regardless of taxon in each plot as a tree community stem agb in metric tons was calculated from stem dbh and wood density using the equation for moist forests chave et al 2005 we calculated a tree s agb by summing over its stems agb in total 13 295 trees from all 29 plots were used for analysis 2 2 maximum entropy models we predicted the individual rescaled metabolic rate rmr distribution using the maximum entropy theory of ecology mete harte et al 2008 harte 2011 xiao et al 2015 and its parameterized generalization xu 2020 specifically we defined the rmr of an individual as a power of its agb as ε mb agb min agb b here min agb is the minimum individual agb within a community and m is the individual rescaled agb agb min agb b is the metabolic scaling exponent mete s prediction of individual rmr distribution is harte 2011 xiao et al 2015 1 ψ ϵ s 0 n 0 λ 2 e γ 1 e γ 2 e β 1 e β n 0 1 e β 1 n 0 1 e n 0 γ n 0 e n 0 1 γ here s 0 and n 0 are respectively the number of species and the number of individuals within a community β λ 1 λ 2 and γ λ 1 λ 2 ε with λ 1 and λ 2 being the lagrange multipliers of the entropy maximization problem eqn 1 is the most uniform individual rmr distribution constrained by the mean number of individuals per species and mean metabolic rate per species from eqn 1 we derived the analytical formulas for the mean and variance of individual rmr within a community see supplementary materials s1 and used them to predict tl for individual rmr both the original and the parameterized mete models predict the individual rmr distribution using eqn 1 but they differ fundamentally by the treatments of the metabolic scaling exponent b for the original mete b is borrowed from the metabolic scaling theory for vascular plants west et al 1999 which predicts that b 3 4 for agb hence the original mete has no free parameter in contrast the parameterized mete sets b as a community level parameter to estimate b we first transformed eqn 1 to individual rescaled agb m distribution using the change of variable formula see eqn 3 and appendix s1 in xu 2020 2 ξ m b m b 1 λ 2 e γ 1 e γ 2 e β 1 e β n 0 1 e β 1 n 0 1 e n 0 γ n 0 e n 0 1 γ where γ is defined as in eqn 1 and written as a function of m γ λ 1 λ 2 ε λ 1 λ 2 mb in eqn 2 then we estimated b by fitting eqn 2 to the observed individual rescaled agb distribution using the maximum likelihood method unlike the original mete which assumes a universal b of 0 75 the parameterized mete predicts b from the observed individual agb distribution within a community under the mete framework using the universal b assumed in the original mete and the community level b estimated from the parameterized mete respectively we calculated two sets of individual rmr from the agb data using ε agb min agb b and tested respectively tl for individual rmr across communities we then predicted tl for individual rmr with the mean and variance formulas derived from eqn 1 using b s from each mete model fig 1 illustrates the use of the two mete models in this work to evaluate the goodness of fit of the mete models in each tree community we fitted the observed individual rescaled agb distribution using the original mete eqn 2 with b 0 75 the parameterized mete eqn 2 with b as a free parameter and five phenomenological models supplementary materials table s2 1 exponential power law 2 parameter weibull quasi weibull muller landau et al 2006 and 3 parameter weibull crénin 2015 we left truncated each of the phenomenological models at one to match the minimum rescaled agb in each community we fitted all models using the maximum likelihood method and compared their performance using the akaike information criterion corrected for sample size aicc and aicc weight model s with the lowest aicc or largest aicc weight is considered the best for the corresponding tree community to test the robustness of each model with respect to different optimization methods we fitted each model against the empirical data using the nelder mead method nelder and mead 1965 and the newton s method separately if a model s aicc under the two methods differed by more than two in magnitude then the corresponding model was eliminated from the analysis due to its lack of reliability if a model s aicc under the two methods differed by no more than two in magnitude then the nelder mead method was used to obtain the model parameters and aicc 2 3 statistical analysis for each community from each data set we had two sets of estimated individual rmr one using a universal b from metabolic scaling theory the other using b predicted from the parameterized mete see fig 1 for each set we calculated the mean and variance of individual rmr across all individuals regardless of taxon within each community we then tested tl for individual rmr across all communities using the least squares linear regression 3 log v a r i a n c e α 1 β 1 log m e a n and tested the nonlinearity between log mean and log variance using the least square quadratic regression 4 log v a r i a n c e α 2 β 2 log m e a n γ 2 log m e a n 2 log mean and log variance exhibit a linear relationship or tl if β 1 0 in eqn 3 and a nonlinear relationship if γ 2 0 in eqn 4 taylor et al 1978 kolokotrones et al 2010 we call such obtained β 1 the estimated slope of tl similarly we fitted eqns 3 and 4 to the predicted means and variances from the mete model and the parameterized mete model separately supplementary materials eqns s1 2 and s1 3 we call the corresponding estimate of β 1 the predicted slope of tl throughout log log10 to study the sampling effect on the estimated and predicted slopes of tl we created 1000 bootstrap samples of individual trees for each actual community and repeated the entire modeling procedure fig 1 for each bootstrap sample we built the 95 confidence interval ci of the estimated and predicted tl s parameters β 1 and α 1 in eqn 3 and γ 2 eqn 4 using the 2 5th and 97 5th percentiles of the corresponding 1000 point estimates in addition we calculated the difference between the 1000 predicted values and 1000 estimated values of each parameter and built the 95 ci for the corresponding difference if a 95 ci does not contain zero then it means that the predicted and estimated values are significantly different similarly we obtained the 95 ci of the metabolic scaling exponent b from the maximum likelihood estimate of b by fitting the parameterized mete to each bootstrap sample data analysis and model fitting were done in r 4 0 2 r core team 2020 nelder mead method and newton s method for the maximum likelihood estimation were implemented using the optim function of the stats package r core team 2020 and the maxlik function of the maxlik package henningsen and toomet 2011 respectively 3 results for the diaoluo data the parameterized mete model eqn 2 table s2 1 fitted the observed agb distribution well visually in most sites fig 2 the parameterized mete model had the lowest aicc or highest aicc weight among all individual rescaled agb distribution models in 14 of the 15 sites tables 1 and s2 2 the average aicc weight per site was in descending order 94 40 for the parameterized mete model 5 60 for the original mete model and less than 0 01 for the other models for each site the quasi weibull model and the 3 parameter weibull model each yielded different aicc under the two optimization methods see materials and methods in four sites the 2 parameter weibull model yielded different aicc under the two optimization methods these combinations of models and sites were eliminated from analysis for the panama data the parameterized mete model fitted the observed agb distribution well visually in most plots fig 3 and had the lowest aicc in 25 of the 29 plots tables 2 and s2 3 the average aicc weight per plot was in descending order 79 79 for the parameterized mete model 30 81 for the 3 parameter weibull model 4 96 for the original mete model 2 16 for the 2 parameter weibull model 2 01 for the quasi weibull model and less than 0 01 for the exponential model and the power law model under the two optimization methods the quasi weibull model yielded different aicc in 24 plots and the 3 parameter weibull model yielded different aicc in 17 plots these combinations of models and plots were eliminated from analysis metabolic scaling exponent b predicted from the parameterized mete model showed substantial variation among tree communities for the diaoluo data the point estimate of b ranged from 0 58 to 1 23 across sites table 1 of the 15 sites 95 bootstrap ci of b was greater than 0 75 in 12 sites smaller than 0 75 in two sites and contained 0 75 in one site for the panama data the point estimate of b ranged from 0 65 to 1 14 across plots table 2 of the 29 plots 95 bootstrap ci of b was greater than 0 75 in 25 plots and included 0 75 in four plots in both data sets when assuming a universal b 0 75 95 ci of the estimated slope of tl β 1 of eqn 2 was greater than two and 95 ci of the predicted slope of tl was lower than two table 3 figs 4 a c and 5 a c predicted slope of tl from the original mete model was significantly lower than the corresponding estimated slope of tl predicted intercept of tl of the original mete model was significantly higher than the corresponding estimated intercept of tl estimated and predicted quadratic coefficients of eqn 4 γ 2 were similar for the diaoluo data but significantly different for the panama data on the other hand when using b from the parameterized mete model eqn 2 estimated and predicted parameters of tl did not differ from each other in both data sets except that the predicted intercept of tl was significantly greater than the estimated intercept of tl for the panama data table 3 figs 4b d and 5b d estimated and predicted γ 2 were not significantly different in both data sets 4 discussion in summary we find that the mete models both original and parameterized are capable of predicting the form of taylor s law tl for individual metabolic rate across tree communities when assuming the metabolic scaling exponent b as a universal constant prediction of the original mete model underestimated the estimated slope of tl and overestimated the estimated intercept of tl when b was predicted as a community level parameter from mete s individual agb distribution model eqn 2 the predicted slope of tl agreed with the estimated slope of tl in addition our parameterized mete model revealed the effect of ecological variables on the cross community variation of metabolic scaling by estimating b from the data the parameterized mete model was the best individual rescaled agb distribution model for most communities in both data sets tables 1 and 2 this finding is remarkable for two reasons first it suggests that we do not need to invoke detailed biological processes to model size variation within community since mete is a constraint based model derived from the entropy principle and the macro state ecological variables i e number of individuals and number of species second with the parameterized mete model outperforming the other phenomenological models it implies that b as the only parameter in the parameterized mete model captures key biological information of the individual agb distribution in this sense our parameterized mete provides a useful way of estimating b since it does not require metabolic rate measurements that are difficult to obtain from field data butler et al 2004 in most tree communities analyzed here tables 1 and 2 our parameterized mete model showed that b was greater than 0 75 a universal value predicted from the metabolic scaling theory west et al 1997 1999 and partially supported by empirical evidence savage et al 2004 this means that the analyzed tropical forest tree communities expend metabolic energy at a faster rate than that predicted by the metabolic scaling theory range of b predicted from the parameterized mete model was 0 64 for the diaoluo data and 0 49 for the panama data reflecting the variability of b across local communities in both data sets b was positively correlated with the number of individuals within a community fig 6 simple least squares regressions show that number of individuals explained 46 and 54 of variability in b for the diaoluo data and the panama data respectively while number of species explained 1 and 4 of variability in b for the diaoluo data and the panama data respectively analysis using samples bootstrapped from the entire sampling area of each data set showed similar results supplementary materials figs s3 2 and s3 3 we speculate that the predicted b value its variation and its correlation with the number of individuals may be explained by several biological processes first it is possible that the high amount of soil nutrient precipitation and sunlight in tropical forests provide ample resources that permit high energy expenditure by the inhabited individuals second tropical forests are featured by their great taxonomic and functional diversity high species richness for example may lead to interspecific competition that favors the species with high energy use rate third cross community variation of b indicates that local biotic and abiotic factors e g soil condition and species composition may be more important than the large scale environmental conditions e g climate in controlling the metabolic scaling rate we note that our parameterized model relies on community level variables i e total number of individuals and number of species and does not consider individual or species level differences which may further increase the variability of b fourth large number of interspecific trees in the tropics may improve plant plant facilitation that boosts energy acquisition which results in the positive correlation between b and the number of individuals our work provides not only empirical evidence for tl for individual metabolic rate but also a theoretical model i e the parameterized mete model that predicts its slope under the maximum entropy framework the variation of number of individuals number of species and metabolic scaling across communities are sufficient to predict the form and parameters of tl table 3 our model adopts a statistical mechanics approach and uses community level variables to predict individual level patterns such approach is different from the biological models of tl that rely on the system specific mechanisms taylor and taylor 1977 anderson et al 1982 kilpatrick and ives 2003 or the statistical models of tl that are devoid of biological information kendal and jorgensen 2011a 2011b cohen and xu 2015 xiao et al 2015 the successful prediction of tl adds another item to the existing list of macroecological patterns that can be explained by the mete harte 2011 what are the ecological implications of tl for individual metabolic rate first our work extends the empirical confirmation of tl to individual level trait i e metabolic rate therefore opening up the opportunities to understand the mechanisms of tl using individual based models and tools in particular both the original and the parameterized mete models predicted the form of tl for individual metabolic rate but only the parameterized model reproduced successfully tl s parameters this implies that the form of tl is robust enough to be generated under the basic mete framework however key biological information i e metabolic scaling needs to be included in the mete to recover tl s parameters in this sense our findings are in agreement with the recent explorations of tl using the feasible set theory xiao et al 2015 johnson and wilber 2017 on the other hand the validity of tl for individual metabolic rate makes it possible to scale up individual level characteristics to infer properties at higher levels of biological organization e g population or community as mentioned in the introduction many individual level traits are nonlinear functions of the metabolic rate when scaling up these functions to the population or community level the average of a nonlinear function is not equal to the function evaluated at the average due to jensen s inequality unfortunately several ecological properties and patterns such as the population energy use ernest et al 2003 and abundance size relationship white et al 2007b are often tested without evaluating the approximation error caused by the jensen s inequality mathematically to improve the approximation requires higher order moments of individual metabolic rate that is if we denote the nonlinear function of rescaled metabolic rate as f ε then its average f ϵ can be approximated as f ϵ f ϵ 2 v a r ϵ and its variance v a r f ϵ can be approximated as f ϵ 2 v a r ϵ following the delta method oehlert 1992 here f and f are respectively the first derivative and the second derivative of f if tl for individual metabolic rate holds then we can replace v a r ϵ with the power function of ϵ in the above formulas to approximate f ϵ the validity of tl is necessary for scaling up individual level properties using the average value of individual metabolic rate we now give a concrete example of using tl for individual metabolic rate to derive a new scaling relationship at the community level empirical studies by xu 2016 and wang and xu 2017 have shown that the community level spatial variation of assemblage abundance is a negative power function of the individual size variation supporting that hypothesis that a functionally diverse community can enhance the stability of the community mccann 2000 ives and carpenter 2007 denoting the assemblage abundance as n and use agb as individual size measure this relationship states that v a r n is proportional to v a r a g b a a 0 here we use this relationship to derive a new relationship between the variance of assemblage abundance and the variance of individual metabolic rate using the metabolic scaling relationship ϵ a g b min a g b b a g b b and a g b ϵ 1 b using the delta method and tl v a r ϵ ϵ β 1 we can derive a power function relationship between v a r n and v a r ϵ 5 v a r n v a r a g b a v a r ϵ 1 b a 1 b ϵ 1 b 1 2 v a r ϵ a ϵ 2 b 2 v a r ϵ a v a r ϵ 2 b 2 β 1 v a r ϵ a v a r ϵ 2 2 b β 1 a β 1 suppose tl s slope β 1 is positive then the relationship between v a r n and v a r ϵ depends on the relative size of 2 2 b and β 1 in all tree communities analyzed in this work the parameterized mete model predicted that 0 b 2 tables 1 and 2 hence 2 2 b 1 on the other hand estimated β 1 from the parameterized mete model was greater than one table 3 therefore 2 2 b β 1 and 2 2 b β 1 0 eqn 5 implies that the higher individual metabolic rate variation larger v a r ϵ is associated with lower spatial variation of assemblage abundance smaller v a r n treating v a r ϵ as an index for functional diversity and v a r n as an index for spatial instability of the community the above observation gives an empirical evidence for the diversity stability hypothesis it will be interesting to test the parameterized mete model against other data to see if the hypothesis holds for other taxa and communities overall eqn 5 provides a novel integration of two seemingly unrelated scaling parameters b and β 1 and can be used to infer important hypothesis of ecological systems several aspects of the mete models deserve further investigation first we use the simple power function scaling relationship between metabolic rate and agb in the original and the parameterized mete models the effect of temperature and other nonlinear function forms of metabolic scaling kolokotrones et al 2010 may alter the goodness of fit and predictions of the mete models second individual covariance may play a role in determining the tl s slope ballantyne and kerkhoff 2007 but is not incorporated in the formulation of mete which assumes independence among individuals modification of the original mete incorporating individual covariance can shed light in this direction lastly whether the parameterized mete can predict other distribution and scaling patterns in population and community ecology e g intraspecific metabolic rate distribution and tl for intraspecific body size needs more research we argue that it is not trivial to deduce tl for individual metabolic rate or trait in general from well studied scaling relationships in ecology including the abundance size relationship tl for species abundance and allometric scaling of metabolic rate except for the individual size distribution which is one of the abundance size relationships see white et al 2007b none of these scaling patterns incorporates in their formulations the individual level variance of metabolic rate or other traits which is needed to test tl individual size distribution contains individual s size information and can be used to calculate individual level variance from empirical data but this would require grouping individuals into different size classes and the variance calculation may be affected by the class width and the number of classes in contrast our parameterized mete model provides an explicit formula of the individual agb distribution eqn 2 from which the individual level variance can be predicted analytically and compared against data the validity of tl for individual metabolic rate leads to a mathematical relation between the mean and variance of individual trait but it does not mean that we should abandon individual trait variation and focus solely on the mean based approach nakagawa and schielzeth 2012 violle et al 2012 sánchez tójar et al 2020 instead the mean variance scaling studied here offers a method of refining the approximation of community level properties when scaling up nonlinear allometric relationships from the individual level on the other hand our parameterized mete model provides a system independent explanation of tl for individual metabolic rate across tree communities our model adds a new theoretical explanation of the individual variation of metabolic rate without relying on the physiological or genetic characters of individual organisms burton et al 2011 white and kearney 2013 data availability statement diaoluo data and panama data are available from the dryad digital repository respectively at https doi org 10 5061 dryad 87n81 and https doi org 10 15146 mdpr pm59 credit authorship contribution statement meng xu methodology software investigation visualization writing original draft writing review editing funding acquisition mengke jiang software writing original draft hua feng wang methodology data curation writing original draft funding acquisition declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements we thank richard condit for sharing the panama tree plots data xu was supported by the scholarly research fund from pace university wang was supported by national scientific foundation of china 31660055 and initial fund from hainan university kyqd1633 the authors declare no conflict of interest supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j ecolmodel 2021 109655 appendix supplementary materials image application 1 
24603,the dynamical behaviors of a leslie type predator prey system are explored when the functional response is increasing for both predator and prey qualitative and quantitative analysis methods based on stability theory bifurcation theory and numerical simulation are adopted it is showed that the system is dissipative and permanent and its solutions are bounded global stability of the unique positive equilibrium is investigated by constructing dulac function and applying poincaré bendixson theorem the bifurcation behaviors are further explored and the number of limit cycles is determined by calculating the first lyapunov number and the first two focus values it is proved that the positive equilibrium is not a center but a weak focus of multiplicity at most two so the system undergoes hopf bifurcation and bautin bifurcation the normal form of bautin bifurcation is also obtained by introducing the complex system moreover numerical simulations are run to demonstrate the validity of theoretical results keywords predator prey system global stability hopf bifurcation bautin bifurcation limit cycle 1 introduction the dynamic behavior between predator and prey is of great significance in biology mathematics and ecology the best way to understand the dynamics of the predator prey system is to establish mathematical models which has been favored by scholars freedman and wolkowicz 1986 one of the classical type predator prey system has the following form 1 x x g x k p x y y y y d c q x y where the variables x t and y t denote the densities of prey and predators at time t k d and c are positive constants g x k describes the specific growth rate of prey without predators which is continuous and differentiable and satisfies g 0 k r 0 g k k 0 g x k k 0 g x x k 0 g k x k 0 for any x 0 in many researches of population systems logistic growth function g x k r 1 x k is most used the key factor of predator prey interaction is the functional response p x y which describes the amount of prey consumed per predator per unit time for a given number of prey and predator it plays an important role in determining the dynamic behaviors of the system such as steady state oscillation bifurcation and chaos ryu et al 2018 the function q x y indicates a way for predators to transform consumed prey into their own growth parameter c represents the efficiency of conversion while d is the mortality rate of the predator the most familiar situation is q x y p x y the dynamics of system 1 when q x y p x y have been studied by many authors colon et al 2015 seo and deangelis 2011 huang and xiao 2004 however not all predator prey models adopt the form of system 1 in fact mutual interference between predator and prey is also an important factor affecting the population dynamics considering the reciprocal relationship between the decrease of predator population and the per capita availability of food preference leslie 1948 introduced a predator prey system in which the carrying capacity of predator environment is proportional to the abundance of prey that is the growth term of predator depends not only on the density of prey but also on the ratio y x of predator to prey the form is given as 2 d y d t s y 1 l y x where l is the conversion factor from prey to predator s is a positive number and l y x is named leslie gower term then with eq 2 and logistic growth function wollkind and logan 1978 wollkind 1988 employed the following system to investigate the mite outbreak interactions on fruit trees in washington state hoyt 1967 1969 3 x r x 1 x k p x y y y s y 1 l y x where the positive constants r and k refer to the prey intrinsic growth rate and the carrying capacity of the prey without predators the functional response p x y is assumed to be of holling type later arditi and ginzburg 1989 indicated that in many cases such as predators have to search for food and form a school or group the functional responses dependent on both predator and prey are applied in system 3 the exact forms of the functional response can be divided into two categories i prey dependent p x y p x m x leslie gower model m x a x holling tanner model m x 2 a x 2 holling type iii m x a x 2 holling type iv or monod haldane ii ratio dependent p x y p x y or predator dependent p x y m x x a y ratio dependent m x a b x c y beddington deangelis m x y γ a x γ 1 2 1 3 hassell varley these functional responses have been studied in leslie and gower 1960 holling 1966 tanner 1975 kolebaje and popoola 2019 and xue et al 2019 for i and in lajmiri et al 2018 deangelis and holland 2006 negi and gakkhar 2007 bai et al 2020 xiao and ruan 2001 and chen and du 2018 for ii many results such as dissipativeness and permanence local and global stability the existence of periodic orbits and various kinds of bifurcations have been obtained in this paper we consider another functional response of hunting cooperation proposed by cosner et al 1999 as follows 4 p x y c e 0 x y 1 h c e 0 x y where c e 0 h are positive numbers representing the fraction of captured prey killed by each predator in each encounter the total encounter rate between predator and prey and the processing time of each captured prey it is classified as predator dependent in cosner et al 1999 biologically this response function reflects a behavioral mechanism of how a school of predators search touch and kill a group of prey but three assumptions were put forward in cosner et al 1999 i any predator contracting a prey item signals to all the other predators and the predators then aggregate at the location of the prey ii patches herds or schools of prey are large enough so that the predators can aggregate before all of the prey are consumed or escape iii the line of predators must be short enough to allow transmission of a signal mathematically it is different from all the others we have introduced above because of the monotonicity for x and y for more details of this function we can refer to references ryu et al 2018 cosner et al 1999 ryu et al 2018 considered the gause type predator prey system with the functional response as eq 4 which takes the form x r x 1 x k c e 0 x y 1 h c e 0 x y y y ϵ c e 0 x y 1 h c e 0 x y y μ y they showed that the model has two non hyperbolic positive equilibria for some parameter values one is a cusp of codimension two or a saddle node and the other is a multiple focus of multiplicity one they also showed that there exist saddle node hopf and bogdanov takens bifurcations if the predator growth term is assumed to be dependent on the ratio of predators and the prey the new predator prey system with the functional response as eq 4 is established as follows 5 x r x 1 x k c e 0 x y 1 h c e 0 x y y y s y 1 l y x which is graphically represented in fig 1 cooperation among populations is a common behavior in many biological systems the predators use the strategy of spatial grouping to increase the encounter rate with the prey by observing such kind of biological phenomena a functional response as eq 4 is proposed to explain the hunting cooperation of the predator however the cooperation behavior of dominant species may result in extinction of vulnerable species the ideal situation for species is coexistence for ecological balance studying differential systems with this functional response is helpful to further understand the dynamic relationship of the species then effective measures can be taken to protect the endangered species limit cycle is always an important research topic which behaves as periodic oscillation in predator prey system that is coexistence savoca et al 2020 this intriguing dynamic mechanism has been favored by the majority of researchers not only in integer order differential dynamical system but also in fractional order differential dynamical system ghosh et al 2021 this paper is organized as follows in section 2 we give some preliminary results including model simplification equilibria analysis and boundedness dissipation and permanence of the system moreover by constructing dulac function sufficient conditions for global stability are given in section 3 we prove that the system exhibits hopf bifurcation and bautin bifurcation in terms of the original parameters then we further show that there exists a large stable limit cycle enclosing a small unstable limit cycle and a stable focus through numerical simulations the conclusion is given in section 4 2 stability analysis in this section we give the boundedness of the solutions permanence and the stability of the equilibria of the simplified system 2 1 model reduction since the parameters mentioned above are positive we scale the coordinates and constants as follows t r t x x k y h c e 0 k y a r c e 0 h k 2 b s r c s l r h c e 0 k 2 dropping the bars we have 6 x x 1 x a x y 2 1 x y y b y c y 2 x if the system has a positive equilibrium say x y then the following two algebraic equations hold 1 x a y 2 1 x y and b x c y which imply that q x b c x 3 a b 2 c 2 b c x 2 x 1 0 and y b x c we further obtain q 0 q 1 a b 2 c 2 0 hence following the zero point theorem system 6 or 5 has at least one and at most three positive equilibria in the interior of the first quadrant in order to simplify the following calculation we use the method in zhao et al 2015 to transform arbitrary positive equilibrium e x y of system 5 to e 1 1 by defining the new scalings as x x x y y y t r t k k x α h c e 0 x y β s r γ c e 0 y 2 r ω s l y r x and still expressed in terms of x y system 5 is changed to 7 x x 1 x k γ x y 2 1 α x y y y β ω y x since e 1 1 is an equilibrium of system 7 we obtain ω β γ 1 1 k 1 α therefore system 7 is rewritten in the form 8 x x 1 x k k 1 1 α x y 2 k 1 α x y y β y 1 y x the parameter condition in system 5 is changed to k 1 in system 8 to satisfy the biological meaning in the following we consider system 8 in r 2 x y x 0 y 0 2 2 boundedness and permanence we note that all solutions of system 8 are positive if initial value is selected in the interval of r 2 next we consider the boundedness of solutions and the dissipation and permanence for system 8 it is obvious that 9 x x 1 x k if the initial values are positive hence we have 10 lim t s u p x t k which implies that x t will be limited in the interval 0 k it is similar for the second equation of system 8 to obtain 11 y β y 1 y k and then 12 lim t s u p y t k which also implies that y t is limited in the interval 0 k on the other hand since y x k and k 1 we have 13 x x 1 x k k 1 1 α x then 14 lim t i n f x t k 1 k k 1 1 α x 0 therefore when t is large enough we obtain 15 x t x 0 2 and y β y 1 2 y x 0 which indicates that 16 lim t i n f y t x 0 2 y 0 the above analysis is summarized as the following theorem theorem 1 the solutions of system 8 are always positive and bounded in the interior of r 2 if the initial value is selected as positive and these will be limited in the region ω x t y t x 0 x t k a n d y 0 y t k for sufficiently large time t according to the definition of dissipation and permanence anh et al 2012 we further obtain the following results theorem 2 system 8 is dissipative and permanent 2 3 equilibria and their stability in the following we explore the type of the equilibria for system 8 notice that unlike the classical predator prey systems 0 0 is not the equilibrium of system 8 and the system is not even well defined at 0 0 apparently system 8 always has a boundary equilibrium e 0 k 0 the jacobian matrix j e 0 of system 8 at e 0 k 0 takes the form of j e 0 1 0 0 β theorem 3 the equilibrium e 0 k 0 of system 8 is a hyperbolic saddle with the positive x axis as its two stable manifolds and there exists a unique unstable manifold of e 0 in the interior of r 2 the phase portrait is given in fig 2 according to biology there are two cases of biological significance near the equilibrium e 0 k 0 one is that in the absence of predators the prey population will neither become extinct nor grow indefinitely but tends to a certain value that is the environmental carrying capacity k the other is that there exists a small neighborhood of this equilibrium in the first quadrant as the initial values of the predator and the prey are in this area even if the predator population is small it will not be extinct next we focus on the positive equilibria of system 8 if e x y is a positive equilibrium of system 8 then y x and x is a positive root of the equation 17 x 1 α x 2 k 1 x k 0 since x 0 α 0 k 1 the equation α x 2 k 1 x k 0 has no positive roots therefore eq 17 has a unique root x 1 and system 8 has a unique positive equilibrium e 1 1 the jacobian matrix of system 8 at the positive equilibrium e 1 1 is given by j e k 2 α 1 k 1 α k 1 2 α k 1 α β β the determinant and the trace of matrix j e are 18 d e t j e β 2 k α 1 k 1 α and 19 t r j e k 2 α 1 k 1 α β clearly d e t j e is always a positive value but t r j e is indefinite therefore this equilibrium may be a node focus or center rather than a saddle point to sum up the above discussion the following theorem is obtained by using the classical qualitative method theorem 4 for the unique positive equilibrium e 1 1 of system 8 i if β k 2 α 1 k 1 α the equilibrium e 1 1 is a locally asymptotically stable focus or node i i if β k 2 α 1 k 1 α the equilibrium e 1 1 is an unstable focus or node i i i if β k 2 α 1 k 1 α the equilibrium e 1 1 is a weak focus or center the phase portraits are given in fig 3 for i and figs 4 and 6 for i i and i i i from a biological standpoint as the initial data is selected near the stable equilibrium e 1 1 such as x 0 1 5 and y 0 0 8 then following fig 3 b the amplitude of the two populations will gradually decrease over time until it is zero this implies that the predator coexists with the prey in a constant density balance 2 4 globally asymptotic stability of e 1 1 in this subsection we give the sufficient condition for the global stability of equilibrium e 1 1 based on theorem 4 i to illustrate e 1 1 is globally asymptotically stable we need to show that system 8 has no periodic orbits in the region ω by using the bendixson dulac criteria we construct dulac function as follows 20 b x y 1 x y x 0 y 0 write system 8 as 21 x f x y y g x y then we have 22 δ b x y f x y x b x y g x y y α 1 α k 1 x 2 y 3 x 2 1 α x y 2 β k y 1 α x y 2 k x 2 y 1 α x y 2 from system 8 we know that y x k hence δ is negative if 23 α 1 α k 1 k 3 β 1 0 furthermore considering the existence and stability conditions of equilibrium e 1 1 we obtain the following result by using poincaré bendixson theorem zhang et al 1992 theorem 5 if β max k α 2 α 1 k 1 α α 1 α k 1 k 3 1 then equilibrium e 1 1 of system 8 is globally asymptotically stable in the interior of r 2 in biological terms global asymptotic stability means that as long as the initial values of the predator and the prey are in the first quadrant they will eventually tend to a coexisting stable state over time this greatly increases the possibility of the two populations coexisting 3 bifurcation analysis in this section we focus on hopf bifurcation and bautin bifurcation of system 8 3 1 hopf bifurcation from theorem 4 we know that the positive equilibrium e 1 1 is a weak focus or a center as β k 2 α 1 k 1 α β h and it will change its stability when parameter β passes from one side of β β h to the other side where k 2 hence hopf bifurcation may occur at this equilibrium in this subsection we present some conditions such that system 8 undergoes hopf bifurcation and generates a stable limit cycle before analyzing hopf bifurcation in detail we give the following theorem which will be more complete for the study of limit cycles theorem 6 if β k 2 α 1 k 1 α system 8 exists at least a stable limit cycle in r 2 proof following theorem 4 ii we know that e 1 1 is the single positive equilibrium of system 8 and is unstable under the condition β k 2 α 1 k 1 α next to employ poincaré bendixson theorem zhang et al 1992 we just need to construct a annular domain around the equilibrium according to theorem 1 x t and y t will be limited in region ω for sufficiently large time t hence the region bounded by the boundary of ω and the boundary of a small neighborhood of equilibrium e 1 1 is created as the poincaré bendixson annular domain this completes the proof we first make the following scaling transformation 24 d τ d t k x 1 α x y to change system 8 to a polynomial differential system dai and zhao 2018 still represented by t then we have 25 x k x x 2 1 α x y k 1 1 α x 2 y 2 y k β 1 α x y x y y apparently systems 8 and 25 are topologically equivalent in r 2 since k x 1 α x y 0 for x 0 next we convert the unique positive equilibrium e 1 1 to the origin by x x 1 y y 1 and taylor expand system 25 near the origin then dropping the bars system 25 is transformed into 26 x a 10 x a 01 y a 20 x 2 a 11 x y a 02 y 2 a 30 x 3 a 21 x 2 y a 12 x y 2 a 40 x 4 a 31 x 3 y a 22 x 2 y 2 a 41 x 4 y y b 10 x b 01 y b 20 x 2 b 11 x y b 02 y 2 b 21 x 2 y b 12 x y 2 b 03 y 3 b 22 x 2 y 2 b 13 x y 3 where all coefficients are given in appendix a hence using the formula of the first lyapunov number σ from perko 2001 at the origin of system 26 we have 27 σ 3 π l 2 k δ 1 3 2 where k l and δ 1 are given in appendix b in order to make the analysis more complete we use maple 18 for numerical simulations set the system parameters as k 4 α 1 β 0 125 which satisfy the condition of theorem 4 iii and σ 8 516 0 hence following the theory of hopf bifurcation zhang et al 1992 perko 2001 system 8 undergoes a supercritical hopf bifurcation and a stable limit cycle is bifurcated from equilibrium e 1 1 when β passes through β h decreasingly then we have the following theorem theorem 7 assume lyapunov number σ 0 then the positive equilibrium e 1 1 is a weak focus of multiplicity one as β β h and a stable limit cycle is bifurcated through a supercritical hopf bifurcation the phase portrait for a stable limit cycle is given in fig 4 from the point of biology the amplitude of the two populations changes from large to small and eventually tends to a certain value as x 1 1 y 0 9 this implies that a stable limit cycle appears and the two populations eventually coexist with periodic oscillatory balance behavior whether the initial values are outside or inside the limit cycle 3 2 bautin bifurcation in this subsection we try to show that for some parameter values system 8 exists a positive equilibrium which is a stable weak focus of multiplicity two and two limit cycles are generated from bautin bifurcation by perturbing the parameters since β β h k α 2 α 1 k 1 α 0 we have k 2 and a 10 b 10 b 01 then the jacobian matrix of system 26 at the origin 0 0 is given as j a 10 a 01 a 10 a 10 the determinant of the above matrix is d e t j a 10 2 a 10 a 01 0 and the trace is t r j a 10 a 10 0 hence we further obtain the eigenvalues as λ i a 10 2 a 10 a 01 i δ where δ 0 clearly let p 1 a 10 δ 0 a 10 δ it transforms the jacobian matrix into diagonal form as p 1 a 10 a 01 a 10 a 10 p 0 δ δ 0 make the linear transformation x y p u v then system 26 is changed to the form 28 u δ v k 20 u 2 k 11 u v k 02 v 2 k 30 u 3 k 21 u 2 v k 12 u v 2 k 03 v 3 k 40 u 4 k 31 u 3 v k 22 u 2 v 2 k 13 u v 3 k 04 v 4 k 41 u 4 v k 32 u 3 v 2 k 23 u 2 v 3 k 14 u v 4 k 05 v 5 v δ u l 20 u 2 l 11 u v l 02 v 2 l 21 u 2 v l 12 u v 2 l 03 v 3 l 22 u 2 v 2 l 13 u v 3 l 04 v 4 where all coefficients are given in appendix c we abbreviate system 28 as 29 u δ v f u v v δ u g u v in order to get the exact multiplicity of weak focus 0 0 by using the method of the successor function we employ the transformation u r cos θ v r sin θ to change system 29 to a polar coordinate system as 30 r f cos θ g sin θ r p r θ θ δ g cos θ f sin θ r δ q r θ where p r θ and q r θ are power series of r whose coefficients are polynomials of cos θ sin θ therefore we further obtain 31 d r d θ r p r θ δ q r θ r r θ where r r θ r 2 θ r 2 r 3 θ r 3 r 4 θ r 4 the coefficient of each term of function r i θ can be represented by the coefficients of system 28 since the expressions are too long it is omitted here set θ 0 0 r 0 c 0 c 1 and r θ c is the solution of system 31 then the successor function h c of system 28 near origin 0 0 is given by 32 h c r 2 π c r 0 c according to the successor function method in zhang et al 1992 and with the help of the software maple 18 we obtain the first two focal values of system 29 at e 0 0 as 33 v 3 1 8 1 α 2 α 2 k 2 α k 2 2 α 2 5 α k α 2 k 1 α 2 k 1 2 v 1 34 v 5 1 256 1 α 4 α 2 k 2 α k 2 2 α 2 5 α k α 2 k 1 3 2 α 2 k 1 4 v 2 where v 1 and v 2 are given in appendix d we have to consider the possibility that there exist some parameter values such that v 3 v 5 0 if this situation exists then the system will have a center or a weak focus of multiplicity three or more theorem 8 the single non hyperbolic positive equilibrium e 1 1 of system 8 is not a center but a weak focus of multiplicity at most two and so the system has up to two limit cycles generated around e 1 1 to demonstrate theorem 8 we need to employ the following lemma let two polynomials s x 1 x n t x 1 x n φ x 1 x n x 1 x n φ n whose forms are given by s x 1 x n i 1 m 1 s i x 1 x n 1 x n i and t x 1 x n i 1 m 2 t i x 1 x n 1 x n i where φ is an algebraically closed field and m 1 m 2 are positive integers we use r e s s t x n to express the sylvester resultant of s and t relative to x n as in gelfand et al 1994 from theorem 5 in collins 1971 and lemma 4 2 in dai and zhao 2018 a lemma is introduced lemma 1 s and t have no common zero if r e s s t x n 0 next we give the complete proof of theorem 8 proof calculating the resultant of v 1 and v 2 relative to the parameter α by maple 18 we have 35 r e s v 1 v 2 α 368640 8 k 7 k 2 2 2 k 3 3 k 1 23 ϕ where ϕ is a polynomial in k of degree 24 and is given in appendix e when k 2 we obtain ϕ 7 046 1 0 19 by using software maple 18 also as shown in fig 5 the function ϕ is monotonically increasing when k 2 therefore r e s v 1 v 2 α 0 for any k 2 following lemma 1 we have the conclusion that the first two focal values v 3 and v 5 of system 8 at e 1 1 have no common real root that is v 3 0 and v 5 cannot be zero simultaneously this shows that e 1 1 is not a center but a weak focus of multiplicity at most two and so system 8 has up to two limit cycles this completes the proof we give an example by using numerical simulation to illustrate that system 8 undergoes a bautin bifurcation and produces two limit cycles theorem 9 choosing k α β 16 0 2229265907 0 1083963403 the positive equilibrium e 1 1 of system 8 is a stable weak focus of multiplicity two there exhibit two limit cycles generated from bautin bifurcation and the stable limit cycle encloses an unstable limit cycle the phase portrait for two limit cycles is given in fig 6 proof we fix k 16 then α 1 14 since β 0 let v 3 0 we have α 0 2229265907 1 14 β 0 1083963403 and v 5 0 007884853809 hence the results of the theorem hold this completes the proof in order to further explore the position of limit cycles generated by bautin bifurcation we have to calculate the normal form of system 8 let λ 1 λ ω 1 i ω 2 λ 2 λ ω 1 i ω 2 be the eigenvalues of jacobian matrix of system 26 at the origin where ω 1 a 10 b 01 2 ω 2 4 a 10 b 01 a 01 b 10 a 10 b 01 2 2 next we introduce a complex variable z to change system 26 to a complex form as lemma 3 3 in kuznetsov 1995 set ν ω 1 ω 2 and assume that 36 d e t ν β ν k v 3 β v 3 k β β h k k h 0 where β h and k h are the critical values of the parameters which make ω 1 0 and v 3 0 note that gobber and willamowski 1979 studied the relationship between the focal values and the lyapunov numbers and liu 2001 gave a proof of their equivalence therefore following theorem 8 2 in kuznetsov 1995 we obtain the equivalent form of system 26 by replacing lyapunov numbers with focal values 37 z ν i z v 3 z z 2 s z z 4 o z 6 where s s i g n v 5 β h k h 1 hence we have the following theorem theorem 10 if the unique non hyperbolic positive equilibrium e 1 1 of system 8 is a weak focus of multiplicity two and equation 36 holds then the system exhibits bautin bifurcation and its normal form is one of the following forms 38 z ν i z v 3 z z 2 z z 4 o z 6 without losing generality we consider s 1 in the following transform system 38 without the higher order terms to polar coordinate system by ρ ϕ z ρ e i ϕ we obtain 39 ρ ρ ν v 3 ρ 2 ρ 4 ϕ 1 it is obvious that the first equation of system 39 has an equilibrium ρ 0 which corresponds to the unique positive equilibrium 1 1 of system 8 the positive equilibria need to satisfy the equation 40 ν v 3 ρ 2 ρ 4 0 which indicate the limit cycles of system 8 hence the local representations of the bifurcation curves are given as 1 the hopf bifurcation curve h ν v 3 ν 0 2 the fold bifurcation curve t ν v 3 v 3 2 4 ν 0 v 3 0 the bautin bifurcation diagram of system 39 and phase portraits corresponding to system 8 are presented in the following figs 7 and 8 these two bifurcation curves divide the parameter ν v 3 plane into three regions rotating clockwise near the bautin point ν v 3 0 0 see fig 7 and we have the following conclusions a when ν v 3 0 0 the unique positive equilibrium is a weak focus of multiplicity two b when ν v 3 is in region i the system has a unique stable equilibrium and no limit cycles c when ν v 3 lies on the curve h divided into h and h by the bautin bifurcation point the equilibrium has a pair of pure imaginary eigenvalues d as ν v 3 crosses the hopf bifurcation curve h into region i i a stable limit cycle appears e crossing the hopf bifurcation curve h into region i i i an extra unstable limit cycle inside the first one is bifurcated while the equilibrium restores its stability f through a fold bifurcation the limit cycles collide and disappear on the curve t corresponding to the nondegenerate fold bifurcation of the cycles along this curve the system has a critical limit cycle with multiplier one next we give the following numerical examples to verify the correctness of theoretical results for k 16 α 0 3229265907 β 0 2083963403 we calculate ν 0 0378899819 and v 3 0 0130670468 which correspond to case b above see fig 8 a perturb the parameters α β and take the parameter values as k 16 α 0 2729265907 β 0 1083963403 then we have ν 0 0369295126 and v 3 0 0056769541 which correspond to case d above see fig 8 b perturbing α and β again and setting k 16 α 0 1189265907 β 0 0371444259 then we obtain ν 0 0000019678 and v 3 0 0018454220 which correspond to case e above see fig 8 c from a biological point of view there is a wide range of initial values that allow the two populations to coexist but the forms of coexistence are different for the region of the inside inner limit cycle and the neighborhood of the outer limit cycle in a small neighborhood of the outer limit cycle the trajectory is toward the stable limit cycle although the density of the two populations varies greatly they will coexist in the form of periodic oscillations as the inner limit cycle is unstable and the hyperbolic focus is stable the density of the two species will tend to a certain value if initial values are inside the inner limit cycle 4 conclusion the existence and number of limit cycles have always been the research focus of predator prey model predation can cause oscillations in interacting species and many areas also experimental data show that there exist periodic activities between predator and prey may 1972 in this paper we studied the dynamical behaviors of a predator prey system of leslie type with the functional response proposed in cosner et al 1999 special attention is paid to the study of limit cycles as far as we know no investigation has been done to explore the functional response 4 in a predator prey model of leslie type to satisfy the biological significance we firstly analyzed the boundedness dissipation and permanence to verify the effectiveness of the model in describing the relationship between predator and prey then to determine the final state of predator and prey the equilibria are investigated as well as the types are given shang et al 2020 we showed that when the parameters satisfy the conditions in theorem 5 the predator and prey would tend to be stable because the unique positive equilibrium e 1 1 is globally asymptotically stable moreover we presented the conditions of hopf bifurcation and determined the stability of the bifurcated limit cycle by calculating the first lyapunov number using the method of successor function we obtained the first two focal values and deduced that they have no common real root it is inferred that the positive equilibrium 1 1 is not a center but a weak focus of multiplicity at most two we also proved that there exists bautin bifurcation in system 8 and the bifurcation curves are obtained to illustrate the location of limit cycles two limit cycles produced by bautin bifurcation the big stable limit cycle encloses a small unstable limit cycle with a stable hyperbolic focus these indicates that the predator can coexist with the prey with oscillatory balance behavior in a large range liang and pan 2007 compared with the previous results leslie type predator prey model with increasing functional response for both predator and prey is more stable than gause type the inference can be explained by the following three points first our results show that the unique predator free equilibrium is a saddle and the positive half axis of x axis is its two stable manifolds and the only unstable manifold is in the first quadrant this implies that as long as the initial value is not zero the species will not be extinct second we found parameter conditions that make the positive equilibrium globally asymptotically stable third system 8 has hopf bifurcation and bautin bifurcation but no bogdanov takens bifurcation one or two limit cycles can be generated the latter two indicate that the system is not fragile and has strong stability and self recovery ability moreover we gave a detailed biological explanation of our results on mathematics this research will have a positive effect on understanding and further optimizing the ecosystem however if a harvesting rate is considered it may produce more dynamical behaviors and be more conducive to the control of biological species hence we will focus our attention on the research of harvesting influence on this predator prey system credit authorship contribution statement zuchong shang conceptualization methodology data curation writing original draft yuanhua qiao writing review editing lijuan duan software validation jun miao investigation supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work is supported by beijing municipal natural science foundation china no 4202025 partially sponsored by the national natural science foundation of china no 61672070 beijing municipal education commission china no kz201910005008 km201911232003 and the research fund from beijing innovation center for future chips china no kyjj2018004 appendix a the coefficients of system 26 are listed as follows a 10 2 α 1 k α a 01 2 2 k α k α a 20 2 5 α 2 k α a 11 4 4 k k α a 02 1 k α k α a 30 k α 4 α 1 a 21 2 2 k 4 α k α a 12 2 2 k 2 α 2 k α a 40 α a 31 k α 4 α a 22 k α α k 1 a 41 α b 10 k β h k α β h b 01 k β h k α β h b 20 k α β h b 11 k β h k α β h b 02 2 k α β h k β h b 21 2 k α β h b 12 k α β h b 03 k α β h b 22 k α β h b 13 k α β h appendix b the expressions of k l and δ 1 in eq 27 are listed as follows δ 1 α 2 k 2 α k 2 2 α 2 5 α k α 2 k 1 k 1 α 2 α k α 2 k 2 l α k 2 α 1 3 α 5 k 3 9 α 5 k 2 20 α 4 k 3 6 α 5 k 52 α 4 k 2 71 α 3 k 3 5 α 4 k 304 α 3 k 2 18 α 2 k 3 41 α 4 384 α 3 k 174 α 2 k 2 12 α k 3 113 α 3 396 α 2 k 27 α k 2 210 α 2 78 α k 12 k 2 91 α 5 k 11 appendix c the coefficients of system 28 are listed as follows k 20 a 20 b 20 k 11 a 10 δ 2 b 20 b 11 a 11 2 a 20 k 02 a 10 2 δ 2 b 02 a 02 a 20 a 11 b 20 b 11 k 30 a 30 k 21 a 10 δ b 21 a 21 3 a 30 k 12 a 10 2 δ 2 3 a 30 2 a 21 a 12 2 b 21 b 12 k 03 a 10 3 δ 3 b 03 a 30 a 21 a 12 b 21 b 12 k 40 a 40 k 31 a 10 δ 4 a 40 a 31 k 22 a 10 2 δ 2 6 a 40 3 a 31 a 22 b 22 k 13 a 10 3 δ 3 2 b 22 b 13 4 a 40 3 a 31 2 a 22 k 04 a 10 4 δ 4 a 40 a 31 a 22 b 22 b 13 k 41 a 10 a 41 δ k 32 4 a 41 a 10 2 δ 2 k 23 6 a 41 a 10 3 δ 3 k 14 4 a 41 a 10 4 δ 4 k 05 a 41 a 10 5 δ 5 l 20 δ b 20 a 10 l 11 2 b 20 b 11 l 02 a 10 δ b 02 b 11 b 20 l 21 b 21 l 12 a 10 δ b 12 2 b 21 l 03 0 l 22 a 10 b 22 δ l 13 a 10 2 δ 2 b 13 2 b 22 l 04 0 appendix d the expressions of v 1 in eq 33 and v 2 in eq 34 are listed as follows v 1 23 α 4 k 2 36 α 3 k 3 74 α 4 k 147 α 3 k 2 8 α 2 k 3 65 α 4 186 α 3 k 97 α 2 k 2 4 α k 3 37 α 3 273 α 2 k 5 α k 2 154 α 2 96 α k 4 k 2 95 α 11 k 19 v 2 962 α 11 k 3 6095 α 10 k 4 20436 α 9 k 5 37967 α 8 k 6 27348 α 7 k 7 5872 α 11 k 2 38636 α 10 k 3 154026 α 9 k 4 324822 α 8 k 5 221581 α 7 k 6 50088 α 6 k 7 12062 α 11 k 82415 α 10 k 2 432528 α 9 k 3 1042952 α 8 k 4 502680 α 7 k 5 605888 α 6 k 6 32760 α 5 k 7 8332 α 11 58613 α 10 k 562150 α 9 k 2 1545961 α 8 k 3 293489 α 7 k 4 2694569 α 6 k 5 543968 α 5 k 6 8216 α 4 k 7 921 α 10 373128 α 9 k 1034231 α 8 k 2 2784724 α 7 k 3 5489153 α 6 k 4 3245464 α 5 k 5 214763 α 4 k 6 628 α 3 k 7 148896 α 9 159945 α 8 k 4298894 α 7 k 2 4778595 α 6 k 3 9233293 α 5 k 4 1759588 α 4 k 5 35579 α 3 k 6 128 α 2 k 7 185462 α 8 2788216 α 7 k 80352 α 6 k 2 13570136 α 5 k 3 6514706 α 4 k 4 461416 α 3 k 5 2572 α 2 k 6 492630 α 7 2571118 α 6 k 9837855 α 5 k 2 12394792 α 4 k 3 2328785 α 3 k 4 55153 α 2 k 5 256 α k 6 1005139 α 6 2331116 α 5 k 12338328 α 4 k 2 5657718 α 3 k 3 420712 α 2 k 4 3004 α k 5 260080 α 5 5580788 α 4 k 7078122 α 3 k 2 13593549 α 2 k 3 34609 α k 4 128 k 5 762867 α 4 4165222 α 3 k 2142789 α 2 k 2 158988 α k 3 1060 k 4 865038 α 3 1559091 α 2 k 327711 α k 2 6819 k 3 408838 α 2 295520 α k 19609 k 2 94476 α 22501 k 8779 appendix e the expression of ψ in 35 is listed as follows ϕ 1286325472723992576 k 24 49714628547544350720 k 23 852764953827599384576 k 22 8739270752520360378368 k 21 60898640239441349625856 k 20 310989800453675954662912 k 19 1226550217254113770589952 k 18 3913012574395960554806912 k 17 10627526356150503857110368 k 16 26060708645038559870345096 k 15 60632057303060724943164356 k 14 135292879242325522067412418 k 13 280678261896080953158425582 k 12 518224658585255948065332384 k 11 823374278672199175555142589 k 10 1102592245594958330429996269 k 9 1227957198379255087036598893 k 8 1124840796290499216613494183 k 7 836996081466094527806254361 k 6 497526211068113958980954757 k 5 230586498786045242236781397 k 4 80288582090930195428942657 k 3 19757181317269906763809502 k 2 3063677081730577067336924 k 225162874164921662074392 
24603,the dynamical behaviors of a leslie type predator prey system are explored when the functional response is increasing for both predator and prey qualitative and quantitative analysis methods based on stability theory bifurcation theory and numerical simulation are adopted it is showed that the system is dissipative and permanent and its solutions are bounded global stability of the unique positive equilibrium is investigated by constructing dulac function and applying poincaré bendixson theorem the bifurcation behaviors are further explored and the number of limit cycles is determined by calculating the first lyapunov number and the first two focus values it is proved that the positive equilibrium is not a center but a weak focus of multiplicity at most two so the system undergoes hopf bifurcation and bautin bifurcation the normal form of bautin bifurcation is also obtained by introducing the complex system moreover numerical simulations are run to demonstrate the validity of theoretical results keywords predator prey system global stability hopf bifurcation bautin bifurcation limit cycle 1 introduction the dynamic behavior between predator and prey is of great significance in biology mathematics and ecology the best way to understand the dynamics of the predator prey system is to establish mathematical models which has been favored by scholars freedman and wolkowicz 1986 one of the classical type predator prey system has the following form 1 x x g x k p x y y y y d c q x y where the variables x t and y t denote the densities of prey and predators at time t k d and c are positive constants g x k describes the specific growth rate of prey without predators which is continuous and differentiable and satisfies g 0 k r 0 g k k 0 g x k k 0 g x x k 0 g k x k 0 for any x 0 in many researches of population systems logistic growth function g x k r 1 x k is most used the key factor of predator prey interaction is the functional response p x y which describes the amount of prey consumed per predator per unit time for a given number of prey and predator it plays an important role in determining the dynamic behaviors of the system such as steady state oscillation bifurcation and chaos ryu et al 2018 the function q x y indicates a way for predators to transform consumed prey into their own growth parameter c represents the efficiency of conversion while d is the mortality rate of the predator the most familiar situation is q x y p x y the dynamics of system 1 when q x y p x y have been studied by many authors colon et al 2015 seo and deangelis 2011 huang and xiao 2004 however not all predator prey models adopt the form of system 1 in fact mutual interference between predator and prey is also an important factor affecting the population dynamics considering the reciprocal relationship between the decrease of predator population and the per capita availability of food preference leslie 1948 introduced a predator prey system in which the carrying capacity of predator environment is proportional to the abundance of prey that is the growth term of predator depends not only on the density of prey but also on the ratio y x of predator to prey the form is given as 2 d y d t s y 1 l y x where l is the conversion factor from prey to predator s is a positive number and l y x is named leslie gower term then with eq 2 and logistic growth function wollkind and logan 1978 wollkind 1988 employed the following system to investigate the mite outbreak interactions on fruit trees in washington state hoyt 1967 1969 3 x r x 1 x k p x y y y s y 1 l y x where the positive constants r and k refer to the prey intrinsic growth rate and the carrying capacity of the prey without predators the functional response p x y is assumed to be of holling type later arditi and ginzburg 1989 indicated that in many cases such as predators have to search for food and form a school or group the functional responses dependent on both predator and prey are applied in system 3 the exact forms of the functional response can be divided into two categories i prey dependent p x y p x m x leslie gower model m x a x holling tanner model m x 2 a x 2 holling type iii m x a x 2 holling type iv or monod haldane ii ratio dependent p x y p x y or predator dependent p x y m x x a y ratio dependent m x a b x c y beddington deangelis m x y γ a x γ 1 2 1 3 hassell varley these functional responses have been studied in leslie and gower 1960 holling 1966 tanner 1975 kolebaje and popoola 2019 and xue et al 2019 for i and in lajmiri et al 2018 deangelis and holland 2006 negi and gakkhar 2007 bai et al 2020 xiao and ruan 2001 and chen and du 2018 for ii many results such as dissipativeness and permanence local and global stability the existence of periodic orbits and various kinds of bifurcations have been obtained in this paper we consider another functional response of hunting cooperation proposed by cosner et al 1999 as follows 4 p x y c e 0 x y 1 h c e 0 x y where c e 0 h are positive numbers representing the fraction of captured prey killed by each predator in each encounter the total encounter rate between predator and prey and the processing time of each captured prey it is classified as predator dependent in cosner et al 1999 biologically this response function reflects a behavioral mechanism of how a school of predators search touch and kill a group of prey but three assumptions were put forward in cosner et al 1999 i any predator contracting a prey item signals to all the other predators and the predators then aggregate at the location of the prey ii patches herds or schools of prey are large enough so that the predators can aggregate before all of the prey are consumed or escape iii the line of predators must be short enough to allow transmission of a signal mathematically it is different from all the others we have introduced above because of the monotonicity for x and y for more details of this function we can refer to references ryu et al 2018 cosner et al 1999 ryu et al 2018 considered the gause type predator prey system with the functional response as eq 4 which takes the form x r x 1 x k c e 0 x y 1 h c e 0 x y y y ϵ c e 0 x y 1 h c e 0 x y y μ y they showed that the model has two non hyperbolic positive equilibria for some parameter values one is a cusp of codimension two or a saddle node and the other is a multiple focus of multiplicity one they also showed that there exist saddle node hopf and bogdanov takens bifurcations if the predator growth term is assumed to be dependent on the ratio of predators and the prey the new predator prey system with the functional response as eq 4 is established as follows 5 x r x 1 x k c e 0 x y 1 h c e 0 x y y y s y 1 l y x which is graphically represented in fig 1 cooperation among populations is a common behavior in many biological systems the predators use the strategy of spatial grouping to increase the encounter rate with the prey by observing such kind of biological phenomena a functional response as eq 4 is proposed to explain the hunting cooperation of the predator however the cooperation behavior of dominant species may result in extinction of vulnerable species the ideal situation for species is coexistence for ecological balance studying differential systems with this functional response is helpful to further understand the dynamic relationship of the species then effective measures can be taken to protect the endangered species limit cycle is always an important research topic which behaves as periodic oscillation in predator prey system that is coexistence savoca et al 2020 this intriguing dynamic mechanism has been favored by the majority of researchers not only in integer order differential dynamical system but also in fractional order differential dynamical system ghosh et al 2021 this paper is organized as follows in section 2 we give some preliminary results including model simplification equilibria analysis and boundedness dissipation and permanence of the system moreover by constructing dulac function sufficient conditions for global stability are given in section 3 we prove that the system exhibits hopf bifurcation and bautin bifurcation in terms of the original parameters then we further show that there exists a large stable limit cycle enclosing a small unstable limit cycle and a stable focus through numerical simulations the conclusion is given in section 4 2 stability analysis in this section we give the boundedness of the solutions permanence and the stability of the equilibria of the simplified system 2 1 model reduction since the parameters mentioned above are positive we scale the coordinates and constants as follows t r t x x k y h c e 0 k y a r c e 0 h k 2 b s r c s l r h c e 0 k 2 dropping the bars we have 6 x x 1 x a x y 2 1 x y y b y c y 2 x if the system has a positive equilibrium say x y then the following two algebraic equations hold 1 x a y 2 1 x y and b x c y which imply that q x b c x 3 a b 2 c 2 b c x 2 x 1 0 and y b x c we further obtain q 0 q 1 a b 2 c 2 0 hence following the zero point theorem system 6 or 5 has at least one and at most three positive equilibria in the interior of the first quadrant in order to simplify the following calculation we use the method in zhao et al 2015 to transform arbitrary positive equilibrium e x y of system 5 to e 1 1 by defining the new scalings as x x x y y y t r t k k x α h c e 0 x y β s r γ c e 0 y 2 r ω s l y r x and still expressed in terms of x y system 5 is changed to 7 x x 1 x k γ x y 2 1 α x y y y β ω y x since e 1 1 is an equilibrium of system 7 we obtain ω β γ 1 1 k 1 α therefore system 7 is rewritten in the form 8 x x 1 x k k 1 1 α x y 2 k 1 α x y y β y 1 y x the parameter condition in system 5 is changed to k 1 in system 8 to satisfy the biological meaning in the following we consider system 8 in r 2 x y x 0 y 0 2 2 boundedness and permanence we note that all solutions of system 8 are positive if initial value is selected in the interval of r 2 next we consider the boundedness of solutions and the dissipation and permanence for system 8 it is obvious that 9 x x 1 x k if the initial values are positive hence we have 10 lim t s u p x t k which implies that x t will be limited in the interval 0 k it is similar for the second equation of system 8 to obtain 11 y β y 1 y k and then 12 lim t s u p y t k which also implies that y t is limited in the interval 0 k on the other hand since y x k and k 1 we have 13 x x 1 x k k 1 1 α x then 14 lim t i n f x t k 1 k k 1 1 α x 0 therefore when t is large enough we obtain 15 x t x 0 2 and y β y 1 2 y x 0 which indicates that 16 lim t i n f y t x 0 2 y 0 the above analysis is summarized as the following theorem theorem 1 the solutions of system 8 are always positive and bounded in the interior of r 2 if the initial value is selected as positive and these will be limited in the region ω x t y t x 0 x t k a n d y 0 y t k for sufficiently large time t according to the definition of dissipation and permanence anh et al 2012 we further obtain the following results theorem 2 system 8 is dissipative and permanent 2 3 equilibria and their stability in the following we explore the type of the equilibria for system 8 notice that unlike the classical predator prey systems 0 0 is not the equilibrium of system 8 and the system is not even well defined at 0 0 apparently system 8 always has a boundary equilibrium e 0 k 0 the jacobian matrix j e 0 of system 8 at e 0 k 0 takes the form of j e 0 1 0 0 β theorem 3 the equilibrium e 0 k 0 of system 8 is a hyperbolic saddle with the positive x axis as its two stable manifolds and there exists a unique unstable manifold of e 0 in the interior of r 2 the phase portrait is given in fig 2 according to biology there are two cases of biological significance near the equilibrium e 0 k 0 one is that in the absence of predators the prey population will neither become extinct nor grow indefinitely but tends to a certain value that is the environmental carrying capacity k the other is that there exists a small neighborhood of this equilibrium in the first quadrant as the initial values of the predator and the prey are in this area even if the predator population is small it will not be extinct next we focus on the positive equilibria of system 8 if e x y is a positive equilibrium of system 8 then y x and x is a positive root of the equation 17 x 1 α x 2 k 1 x k 0 since x 0 α 0 k 1 the equation α x 2 k 1 x k 0 has no positive roots therefore eq 17 has a unique root x 1 and system 8 has a unique positive equilibrium e 1 1 the jacobian matrix of system 8 at the positive equilibrium e 1 1 is given by j e k 2 α 1 k 1 α k 1 2 α k 1 α β β the determinant and the trace of matrix j e are 18 d e t j e β 2 k α 1 k 1 α and 19 t r j e k 2 α 1 k 1 α β clearly d e t j e is always a positive value but t r j e is indefinite therefore this equilibrium may be a node focus or center rather than a saddle point to sum up the above discussion the following theorem is obtained by using the classical qualitative method theorem 4 for the unique positive equilibrium e 1 1 of system 8 i if β k 2 α 1 k 1 α the equilibrium e 1 1 is a locally asymptotically stable focus or node i i if β k 2 α 1 k 1 α the equilibrium e 1 1 is an unstable focus or node i i i if β k 2 α 1 k 1 α the equilibrium e 1 1 is a weak focus or center the phase portraits are given in fig 3 for i and figs 4 and 6 for i i and i i i from a biological standpoint as the initial data is selected near the stable equilibrium e 1 1 such as x 0 1 5 and y 0 0 8 then following fig 3 b the amplitude of the two populations will gradually decrease over time until it is zero this implies that the predator coexists with the prey in a constant density balance 2 4 globally asymptotic stability of e 1 1 in this subsection we give the sufficient condition for the global stability of equilibrium e 1 1 based on theorem 4 i to illustrate e 1 1 is globally asymptotically stable we need to show that system 8 has no periodic orbits in the region ω by using the bendixson dulac criteria we construct dulac function as follows 20 b x y 1 x y x 0 y 0 write system 8 as 21 x f x y y g x y then we have 22 δ b x y f x y x b x y g x y y α 1 α k 1 x 2 y 3 x 2 1 α x y 2 β k y 1 α x y 2 k x 2 y 1 α x y 2 from system 8 we know that y x k hence δ is negative if 23 α 1 α k 1 k 3 β 1 0 furthermore considering the existence and stability conditions of equilibrium e 1 1 we obtain the following result by using poincaré bendixson theorem zhang et al 1992 theorem 5 if β max k α 2 α 1 k 1 α α 1 α k 1 k 3 1 then equilibrium e 1 1 of system 8 is globally asymptotically stable in the interior of r 2 in biological terms global asymptotic stability means that as long as the initial values of the predator and the prey are in the first quadrant they will eventually tend to a coexisting stable state over time this greatly increases the possibility of the two populations coexisting 3 bifurcation analysis in this section we focus on hopf bifurcation and bautin bifurcation of system 8 3 1 hopf bifurcation from theorem 4 we know that the positive equilibrium e 1 1 is a weak focus or a center as β k 2 α 1 k 1 α β h and it will change its stability when parameter β passes from one side of β β h to the other side where k 2 hence hopf bifurcation may occur at this equilibrium in this subsection we present some conditions such that system 8 undergoes hopf bifurcation and generates a stable limit cycle before analyzing hopf bifurcation in detail we give the following theorem which will be more complete for the study of limit cycles theorem 6 if β k 2 α 1 k 1 α system 8 exists at least a stable limit cycle in r 2 proof following theorem 4 ii we know that e 1 1 is the single positive equilibrium of system 8 and is unstable under the condition β k 2 α 1 k 1 α next to employ poincaré bendixson theorem zhang et al 1992 we just need to construct a annular domain around the equilibrium according to theorem 1 x t and y t will be limited in region ω for sufficiently large time t hence the region bounded by the boundary of ω and the boundary of a small neighborhood of equilibrium e 1 1 is created as the poincaré bendixson annular domain this completes the proof we first make the following scaling transformation 24 d τ d t k x 1 α x y to change system 8 to a polynomial differential system dai and zhao 2018 still represented by t then we have 25 x k x x 2 1 α x y k 1 1 α x 2 y 2 y k β 1 α x y x y y apparently systems 8 and 25 are topologically equivalent in r 2 since k x 1 α x y 0 for x 0 next we convert the unique positive equilibrium e 1 1 to the origin by x x 1 y y 1 and taylor expand system 25 near the origin then dropping the bars system 25 is transformed into 26 x a 10 x a 01 y a 20 x 2 a 11 x y a 02 y 2 a 30 x 3 a 21 x 2 y a 12 x y 2 a 40 x 4 a 31 x 3 y a 22 x 2 y 2 a 41 x 4 y y b 10 x b 01 y b 20 x 2 b 11 x y b 02 y 2 b 21 x 2 y b 12 x y 2 b 03 y 3 b 22 x 2 y 2 b 13 x y 3 where all coefficients are given in appendix a hence using the formula of the first lyapunov number σ from perko 2001 at the origin of system 26 we have 27 σ 3 π l 2 k δ 1 3 2 where k l and δ 1 are given in appendix b in order to make the analysis more complete we use maple 18 for numerical simulations set the system parameters as k 4 α 1 β 0 125 which satisfy the condition of theorem 4 iii and σ 8 516 0 hence following the theory of hopf bifurcation zhang et al 1992 perko 2001 system 8 undergoes a supercritical hopf bifurcation and a stable limit cycle is bifurcated from equilibrium e 1 1 when β passes through β h decreasingly then we have the following theorem theorem 7 assume lyapunov number σ 0 then the positive equilibrium e 1 1 is a weak focus of multiplicity one as β β h and a stable limit cycle is bifurcated through a supercritical hopf bifurcation the phase portrait for a stable limit cycle is given in fig 4 from the point of biology the amplitude of the two populations changes from large to small and eventually tends to a certain value as x 1 1 y 0 9 this implies that a stable limit cycle appears and the two populations eventually coexist with periodic oscillatory balance behavior whether the initial values are outside or inside the limit cycle 3 2 bautin bifurcation in this subsection we try to show that for some parameter values system 8 exists a positive equilibrium which is a stable weak focus of multiplicity two and two limit cycles are generated from bautin bifurcation by perturbing the parameters since β β h k α 2 α 1 k 1 α 0 we have k 2 and a 10 b 10 b 01 then the jacobian matrix of system 26 at the origin 0 0 is given as j a 10 a 01 a 10 a 10 the determinant of the above matrix is d e t j a 10 2 a 10 a 01 0 and the trace is t r j a 10 a 10 0 hence we further obtain the eigenvalues as λ i a 10 2 a 10 a 01 i δ where δ 0 clearly let p 1 a 10 δ 0 a 10 δ it transforms the jacobian matrix into diagonal form as p 1 a 10 a 01 a 10 a 10 p 0 δ δ 0 make the linear transformation x y p u v then system 26 is changed to the form 28 u δ v k 20 u 2 k 11 u v k 02 v 2 k 30 u 3 k 21 u 2 v k 12 u v 2 k 03 v 3 k 40 u 4 k 31 u 3 v k 22 u 2 v 2 k 13 u v 3 k 04 v 4 k 41 u 4 v k 32 u 3 v 2 k 23 u 2 v 3 k 14 u v 4 k 05 v 5 v δ u l 20 u 2 l 11 u v l 02 v 2 l 21 u 2 v l 12 u v 2 l 03 v 3 l 22 u 2 v 2 l 13 u v 3 l 04 v 4 where all coefficients are given in appendix c we abbreviate system 28 as 29 u δ v f u v v δ u g u v in order to get the exact multiplicity of weak focus 0 0 by using the method of the successor function we employ the transformation u r cos θ v r sin θ to change system 29 to a polar coordinate system as 30 r f cos θ g sin θ r p r θ θ δ g cos θ f sin θ r δ q r θ where p r θ and q r θ are power series of r whose coefficients are polynomials of cos θ sin θ therefore we further obtain 31 d r d θ r p r θ δ q r θ r r θ where r r θ r 2 θ r 2 r 3 θ r 3 r 4 θ r 4 the coefficient of each term of function r i θ can be represented by the coefficients of system 28 since the expressions are too long it is omitted here set θ 0 0 r 0 c 0 c 1 and r θ c is the solution of system 31 then the successor function h c of system 28 near origin 0 0 is given by 32 h c r 2 π c r 0 c according to the successor function method in zhang et al 1992 and with the help of the software maple 18 we obtain the first two focal values of system 29 at e 0 0 as 33 v 3 1 8 1 α 2 α 2 k 2 α k 2 2 α 2 5 α k α 2 k 1 α 2 k 1 2 v 1 34 v 5 1 256 1 α 4 α 2 k 2 α k 2 2 α 2 5 α k α 2 k 1 3 2 α 2 k 1 4 v 2 where v 1 and v 2 are given in appendix d we have to consider the possibility that there exist some parameter values such that v 3 v 5 0 if this situation exists then the system will have a center or a weak focus of multiplicity three or more theorem 8 the single non hyperbolic positive equilibrium e 1 1 of system 8 is not a center but a weak focus of multiplicity at most two and so the system has up to two limit cycles generated around e 1 1 to demonstrate theorem 8 we need to employ the following lemma let two polynomials s x 1 x n t x 1 x n φ x 1 x n x 1 x n φ n whose forms are given by s x 1 x n i 1 m 1 s i x 1 x n 1 x n i and t x 1 x n i 1 m 2 t i x 1 x n 1 x n i where φ is an algebraically closed field and m 1 m 2 are positive integers we use r e s s t x n to express the sylvester resultant of s and t relative to x n as in gelfand et al 1994 from theorem 5 in collins 1971 and lemma 4 2 in dai and zhao 2018 a lemma is introduced lemma 1 s and t have no common zero if r e s s t x n 0 next we give the complete proof of theorem 8 proof calculating the resultant of v 1 and v 2 relative to the parameter α by maple 18 we have 35 r e s v 1 v 2 α 368640 8 k 7 k 2 2 2 k 3 3 k 1 23 ϕ where ϕ is a polynomial in k of degree 24 and is given in appendix e when k 2 we obtain ϕ 7 046 1 0 19 by using software maple 18 also as shown in fig 5 the function ϕ is monotonically increasing when k 2 therefore r e s v 1 v 2 α 0 for any k 2 following lemma 1 we have the conclusion that the first two focal values v 3 and v 5 of system 8 at e 1 1 have no common real root that is v 3 0 and v 5 cannot be zero simultaneously this shows that e 1 1 is not a center but a weak focus of multiplicity at most two and so system 8 has up to two limit cycles this completes the proof we give an example by using numerical simulation to illustrate that system 8 undergoes a bautin bifurcation and produces two limit cycles theorem 9 choosing k α β 16 0 2229265907 0 1083963403 the positive equilibrium e 1 1 of system 8 is a stable weak focus of multiplicity two there exhibit two limit cycles generated from bautin bifurcation and the stable limit cycle encloses an unstable limit cycle the phase portrait for two limit cycles is given in fig 6 proof we fix k 16 then α 1 14 since β 0 let v 3 0 we have α 0 2229265907 1 14 β 0 1083963403 and v 5 0 007884853809 hence the results of the theorem hold this completes the proof in order to further explore the position of limit cycles generated by bautin bifurcation we have to calculate the normal form of system 8 let λ 1 λ ω 1 i ω 2 λ 2 λ ω 1 i ω 2 be the eigenvalues of jacobian matrix of system 26 at the origin where ω 1 a 10 b 01 2 ω 2 4 a 10 b 01 a 01 b 10 a 10 b 01 2 2 next we introduce a complex variable z to change system 26 to a complex form as lemma 3 3 in kuznetsov 1995 set ν ω 1 ω 2 and assume that 36 d e t ν β ν k v 3 β v 3 k β β h k k h 0 where β h and k h are the critical values of the parameters which make ω 1 0 and v 3 0 note that gobber and willamowski 1979 studied the relationship between the focal values and the lyapunov numbers and liu 2001 gave a proof of their equivalence therefore following theorem 8 2 in kuznetsov 1995 we obtain the equivalent form of system 26 by replacing lyapunov numbers with focal values 37 z ν i z v 3 z z 2 s z z 4 o z 6 where s s i g n v 5 β h k h 1 hence we have the following theorem theorem 10 if the unique non hyperbolic positive equilibrium e 1 1 of system 8 is a weak focus of multiplicity two and equation 36 holds then the system exhibits bautin bifurcation and its normal form is one of the following forms 38 z ν i z v 3 z z 2 z z 4 o z 6 without losing generality we consider s 1 in the following transform system 38 without the higher order terms to polar coordinate system by ρ ϕ z ρ e i ϕ we obtain 39 ρ ρ ν v 3 ρ 2 ρ 4 ϕ 1 it is obvious that the first equation of system 39 has an equilibrium ρ 0 which corresponds to the unique positive equilibrium 1 1 of system 8 the positive equilibria need to satisfy the equation 40 ν v 3 ρ 2 ρ 4 0 which indicate the limit cycles of system 8 hence the local representations of the bifurcation curves are given as 1 the hopf bifurcation curve h ν v 3 ν 0 2 the fold bifurcation curve t ν v 3 v 3 2 4 ν 0 v 3 0 the bautin bifurcation diagram of system 39 and phase portraits corresponding to system 8 are presented in the following figs 7 and 8 these two bifurcation curves divide the parameter ν v 3 plane into three regions rotating clockwise near the bautin point ν v 3 0 0 see fig 7 and we have the following conclusions a when ν v 3 0 0 the unique positive equilibrium is a weak focus of multiplicity two b when ν v 3 is in region i the system has a unique stable equilibrium and no limit cycles c when ν v 3 lies on the curve h divided into h and h by the bautin bifurcation point the equilibrium has a pair of pure imaginary eigenvalues d as ν v 3 crosses the hopf bifurcation curve h into region i i a stable limit cycle appears e crossing the hopf bifurcation curve h into region i i i an extra unstable limit cycle inside the first one is bifurcated while the equilibrium restores its stability f through a fold bifurcation the limit cycles collide and disappear on the curve t corresponding to the nondegenerate fold bifurcation of the cycles along this curve the system has a critical limit cycle with multiplier one next we give the following numerical examples to verify the correctness of theoretical results for k 16 α 0 3229265907 β 0 2083963403 we calculate ν 0 0378899819 and v 3 0 0130670468 which correspond to case b above see fig 8 a perturb the parameters α β and take the parameter values as k 16 α 0 2729265907 β 0 1083963403 then we have ν 0 0369295126 and v 3 0 0056769541 which correspond to case d above see fig 8 b perturbing α and β again and setting k 16 α 0 1189265907 β 0 0371444259 then we obtain ν 0 0000019678 and v 3 0 0018454220 which correspond to case e above see fig 8 c from a biological point of view there is a wide range of initial values that allow the two populations to coexist but the forms of coexistence are different for the region of the inside inner limit cycle and the neighborhood of the outer limit cycle in a small neighborhood of the outer limit cycle the trajectory is toward the stable limit cycle although the density of the two populations varies greatly they will coexist in the form of periodic oscillations as the inner limit cycle is unstable and the hyperbolic focus is stable the density of the two species will tend to a certain value if initial values are inside the inner limit cycle 4 conclusion the existence and number of limit cycles have always been the research focus of predator prey model predation can cause oscillations in interacting species and many areas also experimental data show that there exist periodic activities between predator and prey may 1972 in this paper we studied the dynamical behaviors of a predator prey system of leslie type with the functional response proposed in cosner et al 1999 special attention is paid to the study of limit cycles as far as we know no investigation has been done to explore the functional response 4 in a predator prey model of leslie type to satisfy the biological significance we firstly analyzed the boundedness dissipation and permanence to verify the effectiveness of the model in describing the relationship between predator and prey then to determine the final state of predator and prey the equilibria are investigated as well as the types are given shang et al 2020 we showed that when the parameters satisfy the conditions in theorem 5 the predator and prey would tend to be stable because the unique positive equilibrium e 1 1 is globally asymptotically stable moreover we presented the conditions of hopf bifurcation and determined the stability of the bifurcated limit cycle by calculating the first lyapunov number using the method of successor function we obtained the first two focal values and deduced that they have no common real root it is inferred that the positive equilibrium 1 1 is not a center but a weak focus of multiplicity at most two we also proved that there exists bautin bifurcation in system 8 and the bifurcation curves are obtained to illustrate the location of limit cycles two limit cycles produced by bautin bifurcation the big stable limit cycle encloses a small unstable limit cycle with a stable hyperbolic focus these indicates that the predator can coexist with the prey with oscillatory balance behavior in a large range liang and pan 2007 compared with the previous results leslie type predator prey model with increasing functional response for both predator and prey is more stable than gause type the inference can be explained by the following three points first our results show that the unique predator free equilibrium is a saddle and the positive half axis of x axis is its two stable manifolds and the only unstable manifold is in the first quadrant this implies that as long as the initial value is not zero the species will not be extinct second we found parameter conditions that make the positive equilibrium globally asymptotically stable third system 8 has hopf bifurcation and bautin bifurcation but no bogdanov takens bifurcation one or two limit cycles can be generated the latter two indicate that the system is not fragile and has strong stability and self recovery ability moreover we gave a detailed biological explanation of our results on mathematics this research will have a positive effect on understanding and further optimizing the ecosystem however if a harvesting rate is considered it may produce more dynamical behaviors and be more conducive to the control of biological species hence we will focus our attention on the research of harvesting influence on this predator prey system credit authorship contribution statement zuchong shang conceptualization methodology data curation writing original draft yuanhua qiao writing review editing lijuan duan software validation jun miao investigation supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this work is supported by beijing municipal natural science foundation china no 4202025 partially sponsored by the national natural science foundation of china no 61672070 beijing municipal education commission china no kz201910005008 km201911232003 and the research fund from beijing innovation center for future chips china no kyjj2018004 appendix a the coefficients of system 26 are listed as follows a 10 2 α 1 k α a 01 2 2 k α k α a 20 2 5 α 2 k α a 11 4 4 k k α a 02 1 k α k α a 30 k α 4 α 1 a 21 2 2 k 4 α k α a 12 2 2 k 2 α 2 k α a 40 α a 31 k α 4 α a 22 k α α k 1 a 41 α b 10 k β h k α β h b 01 k β h k α β h b 20 k α β h b 11 k β h k α β h b 02 2 k α β h k β h b 21 2 k α β h b 12 k α β h b 03 k α β h b 22 k α β h b 13 k α β h appendix b the expressions of k l and δ 1 in eq 27 are listed as follows δ 1 α 2 k 2 α k 2 2 α 2 5 α k α 2 k 1 k 1 α 2 α k α 2 k 2 l α k 2 α 1 3 α 5 k 3 9 α 5 k 2 20 α 4 k 3 6 α 5 k 52 α 4 k 2 71 α 3 k 3 5 α 4 k 304 α 3 k 2 18 α 2 k 3 41 α 4 384 α 3 k 174 α 2 k 2 12 α k 3 113 α 3 396 α 2 k 27 α k 2 210 α 2 78 α k 12 k 2 91 α 5 k 11 appendix c the coefficients of system 28 are listed as follows k 20 a 20 b 20 k 11 a 10 δ 2 b 20 b 11 a 11 2 a 20 k 02 a 10 2 δ 2 b 02 a 02 a 20 a 11 b 20 b 11 k 30 a 30 k 21 a 10 δ b 21 a 21 3 a 30 k 12 a 10 2 δ 2 3 a 30 2 a 21 a 12 2 b 21 b 12 k 03 a 10 3 δ 3 b 03 a 30 a 21 a 12 b 21 b 12 k 40 a 40 k 31 a 10 δ 4 a 40 a 31 k 22 a 10 2 δ 2 6 a 40 3 a 31 a 22 b 22 k 13 a 10 3 δ 3 2 b 22 b 13 4 a 40 3 a 31 2 a 22 k 04 a 10 4 δ 4 a 40 a 31 a 22 b 22 b 13 k 41 a 10 a 41 δ k 32 4 a 41 a 10 2 δ 2 k 23 6 a 41 a 10 3 δ 3 k 14 4 a 41 a 10 4 δ 4 k 05 a 41 a 10 5 δ 5 l 20 δ b 20 a 10 l 11 2 b 20 b 11 l 02 a 10 δ b 02 b 11 b 20 l 21 b 21 l 12 a 10 δ b 12 2 b 21 l 03 0 l 22 a 10 b 22 δ l 13 a 10 2 δ 2 b 13 2 b 22 l 04 0 appendix d the expressions of v 1 in eq 33 and v 2 in eq 34 are listed as follows v 1 23 α 4 k 2 36 α 3 k 3 74 α 4 k 147 α 3 k 2 8 α 2 k 3 65 α 4 186 α 3 k 97 α 2 k 2 4 α k 3 37 α 3 273 α 2 k 5 α k 2 154 α 2 96 α k 4 k 2 95 α 11 k 19 v 2 962 α 11 k 3 6095 α 10 k 4 20436 α 9 k 5 37967 α 8 k 6 27348 α 7 k 7 5872 α 11 k 2 38636 α 10 k 3 154026 α 9 k 4 324822 α 8 k 5 221581 α 7 k 6 50088 α 6 k 7 12062 α 11 k 82415 α 10 k 2 432528 α 9 k 3 1042952 α 8 k 4 502680 α 7 k 5 605888 α 6 k 6 32760 α 5 k 7 8332 α 11 58613 α 10 k 562150 α 9 k 2 1545961 α 8 k 3 293489 α 7 k 4 2694569 α 6 k 5 543968 α 5 k 6 8216 α 4 k 7 921 α 10 373128 α 9 k 1034231 α 8 k 2 2784724 α 7 k 3 5489153 α 6 k 4 3245464 α 5 k 5 214763 α 4 k 6 628 α 3 k 7 148896 α 9 159945 α 8 k 4298894 α 7 k 2 4778595 α 6 k 3 9233293 α 5 k 4 1759588 α 4 k 5 35579 α 3 k 6 128 α 2 k 7 185462 α 8 2788216 α 7 k 80352 α 6 k 2 13570136 α 5 k 3 6514706 α 4 k 4 461416 α 3 k 5 2572 α 2 k 6 492630 α 7 2571118 α 6 k 9837855 α 5 k 2 12394792 α 4 k 3 2328785 α 3 k 4 55153 α 2 k 5 256 α k 6 1005139 α 6 2331116 α 5 k 12338328 α 4 k 2 5657718 α 3 k 3 420712 α 2 k 4 3004 α k 5 260080 α 5 5580788 α 4 k 7078122 α 3 k 2 13593549 α 2 k 3 34609 α k 4 128 k 5 762867 α 4 4165222 α 3 k 2142789 α 2 k 2 158988 α k 3 1060 k 4 865038 α 3 1559091 α 2 k 327711 α k 2 6819 k 3 408838 α 2 295520 α k 19609 k 2 94476 α 22501 k 8779 appendix e the expression of ψ in 35 is listed as follows ϕ 1286325472723992576 k 24 49714628547544350720 k 23 852764953827599384576 k 22 8739270752520360378368 k 21 60898640239441349625856 k 20 310989800453675954662912 k 19 1226550217254113770589952 k 18 3913012574395960554806912 k 17 10627526356150503857110368 k 16 26060708645038559870345096 k 15 60632057303060724943164356 k 14 135292879242325522067412418 k 13 280678261896080953158425582 k 12 518224658585255948065332384 k 11 823374278672199175555142589 k 10 1102592245594958330429996269 k 9 1227957198379255087036598893 k 8 1124840796290499216613494183 k 7 836996081466094527806254361 k 6 497526211068113958980954757 k 5 230586498786045242236781397 k 4 80288582090930195428942657 k 3 19757181317269906763809502 k 2 3063677081730577067336924 k 225162874164921662074392 
24604,complex biological models such as mechanistic research models often need to extend their current use to a broader audience simplification and faster simulations would increase their use here a step by step methodology was developed and applied to partially metamodel hence accelerate the mechanistic model florsys this is a process based multiannual and multispecies model virtual field which simulates crop growth and weed dynamics and allows users to assess cropping systems for crop production and biodiversity the model is relatively slow which makes it difficult to test numerous and diverse cropping systems needed to identify those reconciling crop production and biodiversity here we 1 identified the slowest submodel of florsys i e the 3d voxelized light interception submodel 2 identified and applied a relevant methodology to metamodel this submodel in the simplest situation i e we predicted light interception and absorption directly at the scale of the plant instead of the voxel for a single plant in a field and 3 extrapolated the method to more complex situations i e a plant in diverse and heterogeneous crop weed canopies 4 replaced the original process based florsys submodel by the metamodels which required additional equations and decision rules 5 evaluated the metamodelled florsys with independent field observations showing an adequate prediction quality combined with an increased speed at fine grained scale since the metamodelled version was 28 times faster than the process based version for steps 2 and 3 we used the global sensitivity method based on a truncated legendre polynomial chaos expansion pce whose coefficients were estimated by partial least squares pls regression to simultaneously i rank inputs with respect to their polynomial and total effects on outputs via the so called pce pls sensitivity indices and ii provide metamodels predicting light interception and absorption at the plant level these metamodels were then shortened into parsimonious metamodels via a lasso pls method the study showed that there was a trade off between speed gain due to the metamodelled 3d light submodel and the speed loss due to the additional functions for neighbourhood effects the metamodelled version is best used for testing complex systems where plant location must be modelled precisley e g precision agriculture intercropping with precision sowing whereas the voxelized version with a large voxel size is better for simpler cropping systems the present step by step process may be helpful for investigating and speeding up other complex simulation models with interacting objects agents it notably uses a hybrid approach using a process based albeit simplified approach for the most sensitive plant stage newly emerged tiny plants and separate sampling plans and metamodels to ensure that the more sensitive stages components are adequately covered small plants keywords metamodel light interception photosynthetically active radiation par crop weed canopy sensitivity analysis simulation time 1 introduction the study of biological problems usually requires complex mechanistic models especially when dealing with weed dynamics holst et al 2007a colbach 2010 indeed even though weeds are considered to be the most harmful pest for crop production oerke 2006 national and european policies now increasingly focus on the role of weeds for biodiversity marshall et al 2003 petit et al 2011 and the need to reduce herbicide use because of health issues and environmental concerns stoate et al 2009 waggoner et al 2013 unfortunately to date no alternative weed control technique is alone as efficient as herbicides and thus several cultural techniques must be combined to control weeds liebman and gallandt 1997 many weed dynamics models exist to understand and predict weed dynamics see reviews by colbach and debaeke 1998 holst et al 2007b freckleton and stephens 2009 bagavathiannan et al 2020 only a few take into account the long term effects of the weed impacts on crops the multiplicity of weed species the complexity of cropping systems or the impact on crop production and biodiversity to date florsys gardarin et al 2012 munier jolain et al 2013 colbach et al 2014 colbach et al 2021 is the one model that answers all these requirements this is a process based virtual field model which simulates the effects of cropping systems on weed dynamics as well as on crop production and weed related biodiversity thus making possible a multiobjective design of cropping colbach et al 2017 colbach et al 2021 unfortunately models like florsys that are accurate enough to reproduce the effects of agricultural practices on weed dynamics are time consuming and complex colbach 2010 in order to use florsys to screen numerous cropping systems and identify sustainable herbicide sparse cropping systems the model must be accelerated and simplified this question is common to many other mechanistic models whose use is often limited by their complexity and slowness complex mechanistic models can be simplified by decreasing their precision level as some problems do not require the same high precision level kleijnen and sargent 2000 renton 2011 to simplify a model without losing precision is more difficult and requires different methods global sensitivity analyses can explore the model and understand its behaviour to identify which inputs change the outputs the most this allows developers to assign constant values to minor inputs and to simplify equations cox et al 2006 global sensitivity analyses thus help to find the correct level of complexity for a metamodel by identifying the non influential inputs faivre et al 2013 then metamodelling aims at emulating the original model linking inputs and outputs by less detailed but faster equations which simplifies model use for practical applications examples are metamodelling of the notg forest model marie and simioni 2014 phoma stem canker control hossard et al 2015 and the bio geo chemical dndc europe model villa vialaneix et al 2012 sometimes metamodelling a whole model can be impractical particularly if there are too many inputs and outputs if a model consists of several submodels as is the case of florsys a more practical solution is to perform a local metamodelling on the submodel using most of the computing time marie and simioni 2014 metamodelling requires several steps kleijnen and sargent 2000 that summarize as 1 what is the purpose of the metamodel i e what goal what is the accuracy needed 2 what do we know about the model to be metamodelled i e which inputs which domain of applicability which outputs 3 what method to use which type of metamodel to use which experimental design and 4 how to evaluate the metamodel i e what fitting which validity many sensitivity analysis and metamodelling methods exist like the widespread sobol indices or fast mahévas and iooss 2013 identified three criteria to select the best sensitivity analysis for a complex model 1 the number of possible simulation runs 2 the number and 3 type of inputs the feasible number of runs depending on the simulation time and the number of inputs are crucial to select the relevant methods table 1 when little is known about the model behaviour which is often the case for complex models performing early tests to increase the knowledge of the model is needed the objective of the present paper was to accelerate and simplify a mechanistic model by implementing efficient metamodels through 1 identification of the sensitivity analysis and metamodelling methods adapted to a slow complex model such as florsys 2 identification of the important inputs 3 simplification of the equations and reduction of the computing time we voluntarily excluded technical solutions such as parallel processing or graphical processing unit we focused here on the reasoning for choosing the sensitivity and metamodelling methods and how they were combined with the other steps needed to transform a metamodel into a simulation model the chosen method was fully developed in gauchi et al 2017 for a preliminary study this global sensitivity analysis method is able to deal with both dependant and independent inputs it is based on a truncated legendre polynomial chaos expansion pce whose coefficients are estimated by partial least squares pls regression gauchi et al 2017 aiming to simultaneously rank inputs as a function of their polynomial and total effects on outputs via the so called pce pls sensitivity indices and to provide precise and fast metamodels finally the metamodels were reduced into parsimonious metamodels via a lasso pls regression method the methodology to accelerate and simplify florsys involves several steps fig 1 section 2 presents the target model and its submodels in order to identify the most time consuming submodel i e the light interception submodel step 1 section 3 first presents the metamodelling approach per se with the tests that led to the choice of the most suitable method working with a simple case study i e a single plant in the field step 2 and then how we applied this method to cover all situations in the model i e target plants surrounded by neighbour plants step 3 finally section 4 demonstrates how the metamodels were integrated into florsys step 4 and section 5 uses field observations to investigate which model process based vs metamodel is the best in terms of simulation speed and precision depending on the model use step 5 2 identification of the model constraints 2 1 presentation of florsys florsys gardarin et al 2012 munier jolain et al 2013 colbach et al 2014 colbach et al 2021 is a mechanistic i e process based model which simulates multispecies weed dynamics depending on the cropping system and pedoclimate in a virtual field its purpose is to experiment numerous cropping systems to design sustainable weed management strategies that reconcile reduced herbicide use crop production and biodiversity florsys simulates the annual life cycle of crop and weed plants at a daily time step and is a combination of submodels such as plant emergence plant growth or radiation interception florsys inputs are daily weather soil characteristics initial weed seed bank and cropping system practices crop succession and detailed list of cultural operations outputs include crop yield daily weed seed bank plant densities and biomass for more information see supplementary materiel online s1 as florsys consists of a collection of submodels the simplification should not concern the whole model but individual submodels should be simplified individually to keep modularity and access to specific submodels outputs 2 2 identification of the most time consuming submodel in florsys step 1 the computing time for each florsys submodel was registered for a simulation with diverse crops and cultural practices over 13 years corresponding to a cropping system trial colbach et al 2016a code profiling of the c source code of florsys showed that the 3d radiation interception submodel was by far the most time consuming submodel this submodel predicts the photosynthetically active radiation par intercepted by each plant of the crop weed canopy volume discretised into voxels 3d pixels it used 57 64 and 99 of total simulation time with a voxel edge size of 7 4 and 1 cm respectively the second most time consuming submodel was the germination emergence submodel which used 20 7 and 0 04 of the computation time for the three voxel edge sizes consequently we will focus here on simplifying and accelerating the radiation interception submodel 2 3 a short presentation of the 3d radiation interception submodel the 3d radiation interception submodel munier jolain et al 2013 simulates a 3d sample of the virtual field where the space is discretised into voxels i e 3d pixels crop and weed plants are placed onto this field with plant position and morphology resulting from other florsys submodels crop plants can be sown in rows or broadcast i e random position in the field weeds can be positioned randomly or in species specific patches the radiation interception submodel calculates the amount of photosynthetically active radiation par that arrives on top of the crop weed canopy and that trickles down to the voxels in the underlying layers depending on plant leaf areas species radiation extinction coefficients and solar angle which depends on latitude and season in total 14 input variables can be modified in the submodel for five different outputs 2 3 1 3d radiation interception inputs plants are represented as cylinders delimited by their height and width fig 2 table 2 a the leaf area la of the plant is distributed across the successive voxel layers of the cylinder with 50 of the cumulative leaf area below relative median leaf height rh50 of the plant and its distribution governed by the shape parameter b the species radiation extinction coefficient k and the plant leaf area inside each voxel determine how much incident radiation of the voxel is absorbed by the plant s leaves the radiation absorbed by each plant para is the sum of the radiation absorbed by its leaves in the different voxels other inputs describe the location 1 the field sample i e dimensions in the north south and in the east west directions as well as the grain of the discretization i e the voxel edge size and 2 the position of the solar angle i e latitude of the simulated field and the julian day 2 3 2 3d radiation interception outputs outputs of this submodel table 2 b are used for different purposes in florsys the photosynthetically active radiation absorbed by a plant parap drives biomass accumulation in the growth submodel the daily shading intensity perceived by the plant sid drives etiolation in the morphology submodel the relative intercepted photosynthetically active radiation rpari is considered at three scales the top of a given plant rparitop over the whole plant rpariplant and the soil surface below all plants rparibase these are used as proxies for herbicide penetration and interception in the canopy in the herbicide treatment submodel as single plants are not shaded by neighbouring plants their relative par intercepted on the plant s top rparitop is always 1 thus for the single plant case only four outputs were studied i e parap sid rpariplant rparibase for the plant in a canopy step all five outputs are studied table 2 b the metamodels also predict para per cm² parac i e relative absorption efficiency for a given plant volume 3 simplification and acceleration of the 3d radiation interception submodel to find the best metamodelling and sensitivity analysis method for the radiation interception submodel we started with the simplest possible situation for this submodel which consists of a single plant in a field without shade due to surrounding plants step 2 in fig 1 once identified this method was then applied to more realistic but more complex occurrences relevant for the submodel i e target plants surrounded by neighbour plants step 3 in fig 1 3 1 simplified case study with single target plants step 2 this section aims 1 to test the effect of the range of variation in inputs 2 to test the effect of correlations between inputs 3 to analyse the sensitivity indices for unshaded single plants and 4 to evaluate the metamodels predicting the radiation interception variables for unshaded plants 3 1 1 testing the sensitivity to the range of the inputs step 2 i two input range sizes were tested following a plackett burman experimental design plackett and burman 1946 with 12 combinations of the two extreme ranges for the 11 inputs with latin hypercube sampling lhs designs of 29 200 rows supplementary material online s2 section 1 1 a small range corresponding to france focusing on spring and summer and the plant morphologies most common in fields and 2 a large range for all possible plant morphologies growing all year and all around the world except polar regions for each configuration of ranges the florsys radiation interception submodel was run with a single target plant located at the centre of the field sample and sobol sensitivity indices saltelli 2002 were estimated for the analysed outputs sobol indices are the most widely used sensitivity indices and are robust enough for complex models gauchi et al 2017 the sobol decomposition leads to decompose the variance of a non linear model output into percentages of variance which can be attributed to the different inputs discriminating the variance due to the main effect of a given input from the one resulting from interactions with other inputs the sobol indices based on these variance percentages can be directly interpreted as measures of sensitivity measured across the whole input space the main advantages is that sobol indices can deal with non linear responses and interactions in non additive systems this design gave a set of 12 sensitivity indices for each of the 11 inputs a linear regression of these sensitivity indices was fitted where the regression coefficients indicate the importance of the effect of the range absolute values and ranking of sensitivity indices of the various inputs changed for all outputs when a small input range was used instead of large one supplementary material online s2 section 1 not all inputs were though concerned depending on the analysed output e g the range of the voxel was important for the relative intercepted par pari but not for the shading index sid consequently for the subsequent steps the large input ranges were used to cover all the possible input situations and notably for novel combinations of species traits e g resulting from new crop varieties or invasive weed species 3 1 2 sensitivity indices estimation via sobol saltelli method and via polynomial chaos expansion the objective of this section was to compare the sobol sensitivity indices that we estimated in section 3 1 1 with a method that both estimates sensitivity indices and fits a metamodel the polynomial chaos expansion pce method uses the same principle as sobol sensitivity indices via ordinary least square regression sudret 2008 here shortened to pce ols for each input the sensitivity indices estimated by the polynomial chaos expansion are 1 the polynomial effect that accounts for the effect of the input only i e the main effect of the input and 2 the total effect i e quantifying all the interactions of this input with other inputs these indices are respectively comparable to the first order indices and the total effect indices of sobol indices the large range experimental design via latin hypercube sampling lhs mckay et al 2000 created in the previous section was used to estimate both indices pce ols indices were similar to sobol indices computed on the same dataset supplementary material online s2 section 2 the largest difference was of 0 13 for the total effect of the voxel on the radiation intercepted by the target plant rpariplant the ranking of the inputs was the same with both methods we thus preferred pce in the following steps since it both estimates sensitivity indices and fits a metamodel which is needed to simplify the radiation interception submodel 3 1 3 sensitivity indices with correlated inputs step 2 ii the method for estimating pce ols indices assumes that inputs are independent and uncorrelated however some inputs of the radiation interception submodel are correlated e g plant height and the total leaf area are strongly linked e g galium aparine l klem et al 2014 we thus tested the effect of including correlations amongst inputs on the estimation of the sensitivity indices and decided whether the method needed to be adapted this part was fully presented in gauchi et al 2017 and further details can be found in supplementary material online s2 in summary the space filling lhs design of section 3 1 1 was modified to include correlations amongst inputs following the iman and conover method iman and conover 1982 these correlations supplementary material online s2 section 3 were estimated on simulated plants occurring in 10 diverse cropping systems colbach et al 2016b a number of 10 000 runs were selected out of a total of 29 200 runs to avoid an excessive weight of outputs too close to the limit of the ranges we ensured that the experimental design remained orthogonal and that enough runs were kept to estimate the sensitivity indices adding correlations to the space filling design of the inputs changed absolute values of sensitivity indices pce ols for all outputs and gave deviant values 0 or 1 consequently it was essential to find a method better adapted to correlated inputs gauchi et al 2017 proposed to calculate the sensitivity indices i e polynomial effect and total effect by estimating the coefficients of polynomial chaos expansion using a partial least squares method namely a partial least squares regression pce pls see wold et al 2001 here the resulting pce metamodels were though too complex to speed up florsys computations we thus built more parsimonious and faster metamodels using a method developed by gauchi et al 2017 who tested it on a single florsys output these parsimonious faster metamodels were built with a lasso regression tibshirani 1996 to select monomials via glmselect sas with the selected monomials we performed a new pls regression for the final parsimonious metamodel hence fast metamodel this combination of methods was hence referred to as lasso pls the resulting single plant pce pls metamodels full and fast were evaluated via a pls specific criterion the q2 cum tenenhaus 1998 lazraq et al 2003 for fitting and prediction qualities we used the same principle and stopping rule as in gauchi et al 2017 giving a q2 cum h referred to as q2cum in this paper this cross validated fitting prediction criterion is bounded between 0 and 1 the closer to 1 it is the better the metamodel is in terms of prediction and fitting the prediction error was evaluated via the relative mean squared error in predicton rrmsep supplementary material online s5 section 1 this method was used for the sensitivity analysis and metamodelling of the single plant case sections 3 1 5 and then for the more complex case with target plants surrounded by neighbouring plants section 3 2 3 1 4 identifying the key inputs that drive radiation interception of single plants step 2 iii the sensitivity analysis based on pce pls showed that the most important inputs for the photosynthetically active radiation absorbed by the plant parap which drives plant growth were voxel size and plant width fig 3 the third most important inputs were the target plant characteristics driving potential leaf area absorption ability i e total plant leaf area and species extinction coefficient total leaf area and plant volume determined by its width and height affected parap more than leaf distribution rh50 and b the environmental variables latitude and day as well as field size had small but non negligible impacts all inputs strongly interacted with interactions making up between 46 voxel edge size and almost 100 of the total effect all others except plant width consequently the sign of the main regression coefficient of an input was useless to assess how an output varied with an input graphs of outputs vs inputs confirmed that interactions made it usually impossible to identify general tendencies except that parap tended to decrease with increasing plant height and width indicating a self shading effect supplementary material online s2 fig 2 in section 5 the same general tendencies as for parap were observed for the other outputs i e all inputs matter voxel edge size and target plant variables mattered more than physical variables and field size though voxel size could be less important for some outputs such as the shading index sid plant volume though the most relevant variable could be height rather than volume and leaf area mattered more than plant shape and leaf distribution supplementary material online s2 section 4 this analysis also showed that large voxel edge sizes i e 10 cm and above frequently led to weird outputs values such as an abnormal concentration of 0 5 values for the rpariplant supplementary material online s2 section 5 this is due to the computational effect of the voxel based algorithms notably when voxels are so large that they include the whole plant further details in supplementary material online s2 section 5 for small voxels this only occurs during the 1 2 days after plant emergence at a time when shading and light absorption have no influence on later plant growth because young plants do not respond to shading and their biomass accumulation only depends on temperature in florsys 3 1 5 metamodels for a single plant step 2 iv the metamodels for a single target plant in the field included all inputs as the sensitivity analysis indicated that all were influential albeit to varying degrees the full metamodels included 4367 monomials resulting in a good i e close to 1 q2cum 0 93 0 98 table 3 a lines 1 3 5 7 and a low prediction error rrmsep 0 15 0 25 mj mj 1 supplementary material online s5 section 3 lasso pls selection produced simpler and faster metamodels with only 25 to 27 monomials resulting in a quite good q2cum 0 70 0 90 but a slightly worse prediction error rrmsep 0 35 0 55 table 3 a lines 2 4 6 8 regardless of the metamodelling approach fast or full radiation interception at the base of the target plant rparibase a proxy for the total herbicide penetration into the canopy is the least well predicted output this was also the only output that was not calculated at the scale of the plant but at the field scale 3 1 6 summary for single target plants we tested different sensitivity analysis methods that increased our knowledge of the 3d radiation interception submodel this resulted in a more appropriate method that accounted for the correlated inputs we then proposed a handy solution for more parsimonious and faster metamodels part of the methods were developed in a previous study on a single output gauchi et al 2017 and were completed here before being applied to a larger set of outputs 3 2 case for a target plant inside a canopy step 3 fields or even field portions rarely only comprise a single plant step 4 thus focused on radiation interception of target plants surrounded by neighbouring plants the method developed in the previous step to analyse and metamodel radiation interception from target plant environmental and precision inputs was adapted to 1 include contrasting canopies representing the diversity in crop weed canopies in arable fields in the simulation plan while 2 limiting the amount of additional inputs needed to describe the canopy surrounding the target plant 3 2 1 simulation plan a canopy is a complex set of plants of different species sizes widths positions etc to set up diverse plant canopies in our virtual field we needed to vary many variables plant density crop density weed density amount of bare field area the position of weeds random or in patches number of patches in the field the position of crop plants row vs broadcast sown inter row width canopy structure e g presence and diameter of canopy gaps surrounding target plants the heterogeneity of plant morphology mean and variation coefficient of target plant characteristics weed populations being more heterogeneous than crop population i e presenting a larger range of variation see supplementary material online s3 these preliminary inputs were used in a lhs design of 20 440 rows correlations were added in the same way as for the single plant study with the iman and conover method iman and conover 1982 the diverse canopies were built by placing the plants on a virtual field and attributing morphologies and then radiation interception and absorption were simulated with the florsys radiation interception submodel cases with outlying values were removed as well as output values too close to the range limits i e 0 1 or 100 depending on the output to avoid side effects due to computation errors 2536 canopies remained after the sorting the pce pls method was used to metamodel and perform the sensitivity analysis 3 2 2 describing the canopy many detailed variables are needed to create contrasting canopies in florsys but only a limited number of inputs are allowed keeping the metamodel simple the detailed canopy variables were thus aggregated into five mean canopy inputs table 2 to account for the canopy effect in the metamodel the nearer the neighbours are to the target the more their characteristics contribute to the variables describing the average canopy characteristics here the example of the canopy height cm 1 m e a n h e i g h t i 1 n 1 d i 1 h e i g h t i i 1 n 1 d i 1 where di is the distance m of the target plant to the closest neighbour plant i 1 to account for a zero distance when the neighbour is located in the same voxel as the target h e i g h t i is the height cm of neighbour i and n the number of neighbour plants in the field sample for the equations of the other canopy variables see supplementary material online s3 section 4 in addition to these aggregated canopy inputs we added 1 the plant density and the maximum distance between the target plant and neighbour plants 2 target plant variables as in the single plant case and 3 two environmental variables latitude and day resulting in 15 metamodel inputs table 2 to reduce the number of inputs field dimensions xmax and ymax whose effect was shown to be slight in the single plant sensitivity analysis of the single plant section 3 1 4 were both fixed at 8 m which allowed having large plants in the virtual field sample the voxel size was shown to be important for most outputs section 3 1 4 but to simplify and accelerate the simulation plan we kept it constant additional simulations supplementary material online s2 section 6 showed that a voxel edge size of 4 cm was the best compromise between the precision of the radiation interception submodel output and the computation time 3 2 3 sensitivity indices step 3 i the sensitivity analysis of radiation interception outputs to inputs depicting target plant physical environment and neighbour plants showed that input effects were almost entirely due to interactions amongst inputs fig 4 globally target plant inputs had the most and neighbour plant inputs the least impact inputs of a given type had similar effects except for the relative par intercepted by the target plant rpariplant whose height effect was several times the effect of any other inputs as for the single plant scenario section 3 1 4 the interactions amongst inputs were generally too complex to identify general tendencies whether from the signs of the polynomial effects or from graphs supplementary material online s2 section 5 and again outputs were sensitive to all inputs via interactions with other inputs and none of latter could be set at a default value in the following metamodels 3 2 4 metamodels step 3 ii the metamodels for target plants surrounded by neighbour plants included all inputs i e for describing the target plant the physical environment and the biological environment due to the neighbour plants the polynomial degree of these metamodels was smaller than for the single plant ones except for the relative intercepted par rpari table 3 b lines 14 15 the q2cum was always lower and the prediction error higher table 3 b vs a further increasing the polynomial degree did not improve the q2cum or reduce the prediction error results not shown the need for a higher polynomial degree for the rpari points to more and more complex interactions amongst inputs the fast metamodels usually needed a higher polynomial degree and more complex monomials table 3 b than full metamodels to optimize the q2cum the latter though remained low 0 27 0 56 and prediction error was much larger than for single plants 0 85 and 0 65 radiation interception and absorption by a plant surrounded by neighbour plants is thus much harder to simplify via a small metamodel than for single plants 3 2 5 summary for plants in the canopy the metamodels for radiation interception and absorption by a plant surrounded by neighbour plants were simple enough to be implemented into florsys but with a poorer prediction quality than for a single plant the canopy creates a complex interaction with the radiation that cannot be easily simplified at a scale as large as the plant strong interactions between all inputs prevented us from setting the least important inputs to constants 4 combining the metamodels into a florsys submodel step 4 as we had developed metamodels for two situations i e single plant and plant in a canopy it was necessary to establish rules to determine when to use which metamodel in a simulation using the whole florsys including the metamodels hereafter called florsys ml this section presents how the metamodels were combined and what else was needed to cover all likely canopy scenarios with florsys ml 4 1 principle even when there is more than one plant in a field some of these plants can be considered as single if they do not interfere with each other s radiation interception which depends on plant sizes solar angle and distance between plants consequently each day for each target plant crop or weed rules are needed to determine whether a target plant can be considered as single or as surrounded by neighbour plants supplementary material online s4 section 2 when building the metamodels a large number of runs were eliminated because outputs were too close to the limits of the range or because their combination was biologically impossible and resulted in deviant values section 3 2 1 this also reduced the ranges accepted by the metamodels for several key inputs such as target leaf area making it impossible to predict radiation interception for newly emerged seedlings i e with almost nil height width and leaf area voluminous single plants having reached the maximum height and width possible for the species or mature plants with dried leaves with a near zero leaf area but such plant morphologies are frequent in any cropping system to remedy this further metamodels were built for the particular case of small seedlings and for the remaining outlying situations equations were added to predict radiation interception and absorption from ecophysiological knowledge or from likely constants section 4 3 fig 6 summarizes how the different rules equations and metamodels were aggregated finally the calculation loops over neighbour plants needed to calculate the aggregated canopy variables are often time consuming as a consequence alternative methods to compute aggregated neighbour were tested section 4 4 4 2 rules for deciding whether to use the single plant or plant in a canopy metamodel 4 2 1 method the par intercepted at the top of a target plant rparitop is relevant to identify whether radiation interception by the target plant is impacted by neighbour plants because this output is always 1 for single targets and decreases in the presence of shading neighbours to establish decision rules to discriminate these two situations a regression tree was built from the data sets of sections 3 1 and 3 2 using the inputs listed in table 2 as the metamodels in the previous sections showed that it was difficult to take account of all effects and interactions with these inputs some were transformed and others added in the present analysis the environmental variables were transformed to emphasize the effect related to solar angle latitude was transformed into degrees to the equator i e absolute latitude and julian days into days from the summer solstice to the winter solstice i e between solstice days the distance from target plant to its closest neighbour was also used as input with distances calculated between plant centres and all other inputs were weighted by the inverse of this distance to take into account that closer neighbours shade more than farther neighbours finally the target height relative to the canopy height overtaking percentage was integrated via the ratio of the difference between the two heights eq 6 supplementary material online s3 section 5 the cart method breiman et al 1984 was used to build a classification tree to determine the decision rules this method successively splits the data set into two subsets along a threshold value of an input e g distance to the closest neighbour in order to maximize the difference between subsets in terms of output branches are combinations of input values that lead to output predictions contained in leaf nodes cart also ranks the input according to their importance to explain the output the output analysed in the trees was not directly the rparitop but a binary variable indicating whether the target plant was considered single or inside canopy depending on whether its rparitop was respectively or a threshold value in addition to the theoretical value of 1 ten other thresholds were tested ranging from 0 90 to 0 99 incremented by 0 01 in order to increase the number of single plant cases compared to canopy cases and thus the robustness of the tree amongst the 11 trees the one corresponding to the 0 98 threshold was chosen this threshold is close to 1 i e the theoretical value of rparitop in single plants and it identified the most situations when to use the single plant metamodel the latter allows accelerating calculations because the single plant metamodels were simpler and did not need to calculate the aggregated canopy variables 4 2 2 decision tree to determine where a target is shaded by neighbours the rules determining whether a target plant can be considered as single are shown in fig 5 for example if the nearest neighbour is further than 1 6 m and the target plant is taller than the neighbouring canopy the target can be considered as single surrogates of the tree i e variables correlated to the variable in the tree that could also explain the segmentation but to a lesser degree and ranking of variables in their order of importance supplementary material online s3 section 6 showed that nearest neighbour distance either alone or in interaction with other variables are predominant to determine whether the target plant is single or within a canopy based on expertise we added a further logical rule if there are no neighbours whose height exceeds the distance separating the outer rims of the neighbour and target plants the target is considered as single in that case even if the sun is low on the horizon the closest neighbour is too far to shade the target supplementary material online s4 the combination of the decision tree and this additional rule constitute step a in fig 6 4 3 adding equations at the limits of the input ranges the input ranges of the metamodels missed small seedlings for which good prediction is essential as their initial growth determines which plants outgrow the others consequently we ran a further simulation plan to build a third metamodel focusing on small seedlings step c fig 6 using the method developed in section 3 supplementary material online s4 section 4 this additional metamodel was still inadequate for fresh seedlings whose leaf area was lower than the metamodel s accepted input range in that case as there is neither shading nor self shading the para absorbed by the plant is the product of the incident para the plant leaf area times its extinction coefficient based on beer s law monsi and saeki 1953 2005 step b in fig 6 this works fine for single plants that are unshaded by neighbours to include either small plants surrounded by neighbours or any plants by small neighbours outside the canopy metamodel range a linear combination of predictions for single plants either small or large and plants in canopy was used step g in fig 6 this was particularly true for canopy leaf area whose lower range limit was extremely high table 2 single plant predictions and target in canopy predictions were weighted by respectively 1 and the canopy leaf area and divided by the same of these weights supplementary material online s4 section 4 the metamodels do not include voluminous or mature leaf less plants either as these have finished their growth outputs were simply fixed either to a minimum or maximum value or linked with a simple regression if one input was out of range step fig 6 the values were based on graphs of outputs vs inputs from the complete data set including the outliers that were ousted during metamodel construction supplementary material online s4 section 4 if several inputs were out of range the output was estimated based on the analysis of the most influential input with the strongest polynomial effect in the sensitivity analysis supplementary material online s4 section 4 for example if a target plant surrounded by neighbours is taller than 254 8 cm then its relative intercepted par is 0 00649 mj mj 1 4 4 different methods to aggregate neighbour plants into canopy variables we proposed three different methods to calculate the aggregated neighbour variables of each target plants 1 all neighbours close to the target are used for the computation local neighbours 2 all plants in the field are averaged and the same aggregated variables were used for all target plants average neighbours 3 a mix between the previous two methods using average canopy variables when the plant density exceeds 500 plants m 2 and local neighbours otherwise the effect of the aggregation method on prediction error and simulation speed of the whole florsys ml was evaluated in section 5 5 evaluation of the simplified florsys ml with field observations step 5 5 1 objective sections 3 1 5 and 3 2 4 evaluated the prediction quality of the individual metamodels here the objective was to evaluate how good and fast the predictions produced by florsys ml compared to the process based florsys by comparing simulations to field observations following the methods developed in a previous paper colbach et al 2016b different voxel edge sizes and the three methods for aggregating neighbour plants were tested 5 2 material and methods 5 2 1 field observations and features common to all simulations observations were taken from the inrae long term field experiment at dijon epoisses burgundy chikowo et al 2009 where weed and crop variables plant and seed densities plant biomass yield were monitored from 1999 to 2012 details can be found in colbach et al 2016b this trial included ten fields with diverse crop rotations ranging from intensive herbicide based to herbicide free systems and varying degrees of tillage and mechanical weeding weed flora was assessed with species identification plant density above ground biomass and seed bank measurements crop yield was also estimated 5 2 2 simulation plan the simulation combined 1 the florsys version metamodelled or process based with 2 the voxel edge size 1 4 or 7 cm which determined the precision of plant location all florsys versions and plant morphology processed based version the florsys ml version moreover tested 3 different methods for aggregating neighbour plants local average or mixed see section 4 4 and the process based version tested 4 field sample areas 1 m 1 m 3 m 3 m and 6 m 3 m with a 7 cm voxel unless otherwise indicated field area was 6 m 3 m in total nine scenarios were run with the florsys ml version and six with the process based one each of the ten field histories was simulated over 13 years using the weather measured at the local weather station inrae climatik platform and starting with the weed seed bank observed at the onset of the field experiment each scenario was repeated ten times to account for stochastic effects outputs were produced for all the days where observations were carried out in the fields simulations were run with a computer with two 2 ghz processors and 16 gb ram and their simulation time was recorded and averaged over repetitions for the different methods 5 2 3 evaluation criteria simulations with the metamodelled florsys ml and process based florsys were compared to field observations prediction error was assessed with the relative root square mean squared error of prediction rrmsep corrected for variability in observations due to measurement errors and intra field variability and simulations due to stochasticity colbach et al 2016b this error was calculated relative to the range of variation of the observations details can be found in supplementary material online s5 section 1 outputs were analysed at two temporal scales either corresponding to the individual observation dates daily scale or values averaged over the simulation multiannual scale 5 3 results 5 3 1 mean simulation time the simulation time of the process based florsys for all cropping systems tested decreased with voxel edge size when voxel edge size increased from 1 to 4 cm simulation time was divided by approximately 20 fig 7 a increasing voxel size further from 4 to 7 cm decreased simulation time by an additional 43 increasing voxel size from 7 to 10 cm did not decrease simulation time any further the slowest scenario took 259 times more time than the fastest the fastest scenario with the 7 cm voxel edge size and 1 m² field sample took 4 minutes for a repetition of the 13 year long cropping system compared to more than 18 hours for the slowest with the 1 cm voxel and the 18 m² area conversely simulation time increased with field sample area supplementary material online s5 section 2 increasing area from 1 to 9 m² multiplied the simulation time by approximately 8 doubling the field sample area to 18 m² only increased the simulation time by a further 10 the field size multiplies the simulation time by 1 15 for every m² of a 13 year simulation the simulation time of florsys ml remained stable for all voxel sizes but it depended on the method for calculating neighbouring canopy variables fig 7 a the florsys ml with average neighbours was fastest and the one combining local and average neighbours was nearly as fast always using local neighbours made simulations considerably slower than with the process based model and simulation time even increased with voxel edge size indeed in florsys ml the voxel determines plant location and the larger the voxel is the more plants are in each voxel so when florsys ml searches through the voxels surrounding the target plant to compute the canopy inputs it must compute more plants which takes longer florsys ml was considerably faster than the process based model with small voxel edge sizes i e 28 times faster for florsys ml with average neighbours 5 3 2 prediction error in process based simulations the prediction error tended to increase slightly with increasing voxel size fig 7 b the same trend was observed for prediction error in florsys ml simulations with larger voxels suggesting a sensitivity to plant position which is less precise if the voxel is large simulations with a 1 m² field sample produced slightly better results than 18 m² and larger areas e g for the multiannual weed density for all species summed the rrmsep for 1 1 3 3 and 6 3 m² field samples was respectively 63 113 and 116 mj mj 1 details in supplementary material online s5 section 3 probably because it increased interspecific competition between weed species by increasing the probability of overlapping species patches however small fields potentially miss rare species and overestimate interspecific competition in case of high weed densities generally the error was larger for metamodel based vs process based simulations particularly for weed plant biomass table 4 and it varied more amongst repetitions supplementary material online s5 section 3 error was often smaller than the variability in observations pointing to a negligible prediction error and making it impossible to calculate the relative variation in error for metamodelled vs process based simulations table 4 conversely florsys ml was better than the process based florsys to predict multiannual weed plant densities usually florsys ml using either local or average neighbours respectively had the smallest and largest errors whereas errors were intermediate when using both average and local neighbours fig 7 b table 4 regardless of the evaluation criteria there was no model version process or metamodel based approach for calculating canopy variables in metamodels or precision level voxel size field sample area that optimized the precision of all model outputs 6 discussion 6 1 simplifying a complex process based model in this article we presented a method to accelerate and simplify a complex process based model the paper is of interest for non statisticians that want to metamodel complex models and are often baffled by statistical methods and how to apply them in their real life complicated situation another particularity of our work was that we did not use the metamodel as such but integrated it into a larger model and evaluated the latter with independent field data two steps that have to the best of our knowledge been rarely carried out in the past from a more technical point of view the originality of the approach lies in 1 the choice of metamodelling only the most time consuming part of the model i e the 3d light interception submodel 2 the choice of an innovative metamodelling method that handles correlated inputs and selects monomials 3 the integration of the metamodelled submodel into the complex model and 4 the description of the nearby canopy with a limited number of inputs this work did not compare different metamodelling methods villa vialaneix et al 2012 but provided practical guidelines for choosing and tuning metamodelling methods with respect to the complex model constraints e g correlated inputs it extended what was done in the previous paper gauchi et al 2017 by showing the whole approach to simplify a complex model usually metamodelling via polynomial chaos expansion allows reducing the number of inputs in the model by setting the inputs to average values luo et al 2013 rothenberg and wang 2016 here however no input could be omitted because all either influenced radiation interception outputs directly or in interaction with other inputs usually the whole model is metamodelled avoiding the need to integrate the metamodel into a larger model cohen and prinn 2011 luo et al 2013 here we metamodelled a single time consuming submodel in order to accelerate the simulations of the whole florsys model and we thus had to integrate the metamodels together with complementary equations into florsys in sirius brooks et al 2001 only a few equations were metamodelled no implementation of the metamodel was needed as the metamodel was as good as the whole sirius to predict the yield which was the study s goal the constraints of this approach were manageable for the 3d radiation interception of florsys even though the number of inputs needed to be decreased with the help of aggregated canopy variables but these constraints probably make it impossible to apply this metamodelling method to bigger models like the whole florsys with its many more inputs and correlations 6 2 experimental design for analysing a complex model the numerical space filling design latin hypercube sampling lhs is usually appropriate to explore the whole space of possible input combinations for our biological example we also used the iman and conover method iman and conover 1982 to apply a correlation matrix to the lhs to increase the biologically realistic plant variable combination it worked less well for the dynamic florsys model especially at the outer bounds of input ranges that were not sampled enough despite having tested the best minimum row number in the lhs design this was particularly problematic at the onset of the plants life cycle i e for small plants as imprecise early predictions would amplify the next days prediction errors thus setting off the plants growth and development in entirely the wrong direction we improved the metamodelling by using separate experimental sampling designs combining with a simplified process based approach discriminating three types of plants that differ in terms of light interception based on their age and size 1 a standard lhs and metamodel covering mostly large and older plants 2 a second lhs and metamodel specifically targeting younger smaller plants 3 a simplified ecophysiological equation for newly emerged tiny plants the latter approach was acceptable here as these plants do not self shade and are rarely shaded by neighbours no such effort was made at the other extreme of plant size range i e large adult plants with dried leaves indeed these do not photosynthesize anymore and misestimating their absorbed light would have little impact on their future colleagues aiming to similarly metamodel complex could use a similar approach i e keep a process based albeit simplified approach for the most sensitive stages components here the newly emerged tiny plants and combine separate sampling plants and metamodels to ensure that the more sensitive stages components are adequately covered here the small plants the inability of the metamodels to correctly predict small plants is explained by three combined reasons 1 we chose a broad input range to cover all possible plant morphologies in the field which reduced the probability of drawing many low input variables 2 as the simulated plants were the combination of several inputs the probability of drawing a small plant combining low values of all inputs e g low height width and leaf area was even lower particularly as the space filling design was balanced 3 the equilibrated design also drew plants combining high values for some inputs with low values for others resulting in biological impossible morphologies e g tiny plants with an enormous leaf area and non logical output values these plants had to be removed from the data set decreasing even more the occurrence of extreme input values used in the metamodels for models with a high number of inputs it is thus better to sample stepwise rather than have a unique sampling design surprisingly adding correlation to inputs did not help to ensure many small and plausible plants 6 3 which method for which application to metamodel and perform a sensitivity analysis many methods exists which have been assessed in comparative studies we thus decided to detail here the entire path when choosing and applying a method to transform a complex slow model into a faster metamodel polynomial chaos metamodelling accepts only a small number of inputs hence the aggregation of neighbour plant variables into a small number of synthetic canopy variables unfortunately it is the aggregation step particularly the loop computing the plants close to the target plant which cancelled out the simulation time saved thanks to the metamodels another way to speed up simulations would be to use the initial process based interception submodel and to decrease the precision of the canopy structure by increasing the voxel edge size which governs the precision of plant locations and volumes as well as leaf distribution along plant height this approach led to less precision loss than expected indeed florsys does not explicitly represent plant architecture in detail with each organ e g leaf stem simulated if that had been the case enlarging voxels would indeed decrease prediction quality considerably actually florsys distributes leaf area in voxel layers without considering leaf size position or inclination very small voxels do thus not necessarily place leaf area in the correct voxel layer and downsizing voxels cannot be simply approximated here to differential equations that govern light transmission we already discussed the fact that model quality does not decrease below a certain voxel size and is not best for the smallest voxel i e the highest precision in munier jolain et al 2013 moreover there are several stochastic functions in florsys particularly for plant location in the canopy this explains why differences between scenarios differing solely in terms of voxel size are not solely due to differences in voxel size we thus identified two ways to save simulation time depending on the simulation goal either by decreasing the precision of the plant and canopy description process based light interception submodel with a large voxel edge size or that of the light interception metamodelled submodel with a small voxel edge size choosing rapidity over precision can be appropriate for example when needing quick simulations for workshops with farmers to co design cropping systems bergez et al 2010 the choice of the approach then depends on the target output table 5 when plant location is essential e g when testing site specific weed management small sowing interrows row only nitrogen fertilization berge et al 2013 then a voxel size of 1 cm is needed and the metamodelled florsys ml would allow faster and thus more simulations than the process based florsys when both moderate simulation time and prediction quality are needed the process based florsys with a voxel size of 4 cm would be best for cropping system tests a quantitative precision is less essential as long as the management recommendations are correct renton 2011 6 4 what other solutions to speed up a complex model instead of only simplifying the process based approach for tiny newly emerged plants we also thought about using a simplifying process based light interception model this approach was used in early crop weed competition models graf et al 1990 soyweed wilkerson et al 1990 almanac kiniry et al 1992 e g intercom kropff and spitters 1992 kropff et al 1992 as well as in intercrop models gaudio et al 2019 however these models only work for homogeneous 2 species canopies and cannot grasp the complexity of heterogeneous multispecies crop weed canopies in terms of location emergence timing and morphology as shown by comparisons of simulations with such models to independent field observations debaeke et al 1997 deen et al 2003 consequently the recent trend in crop weed competition modelling goes towards more complexity rather than less renton 2013 a recent review of multispecies canopy models even concluded that the florsys approach was a good compromise between simplicity and accounting for canopy heterogeneity gaudio et al 2019 there are also technical solutions for speeding up simulations for instance parallelising the execution of the source code or using graphical processing units unfortunately these solutions make it difficult to maintain a unique source code for any type of computer or server a portable solution is to run multiple florsys clones simultaneously on a single computer or server either manually or automatically via scripts the speed gain then depends on the number of logical processors of the computer another avenue is similar to the large voxel solution i e reduce the size of the simulated field sample this solution was already assessed in a previous paper colbach et al 2016b where we determined the minimum acceptable size again the more complex e g many species large interrows the larger the field sample needs to be so there are several avenues for speeding up a complex model table 6 the best choice depends on the objective and situation of use and several solutions can be combined for an even better result 6 5 towards a larger simplification of florsys the simplification of the radiation interception was easier for a single plant in a bare field than for a plant located inside a canopy indeed 1 the interaction with the canopy is harder to metamodel and 2 the aggregated inputs simplify the canopy too much simplifying a complex model with many inputs is a principal issue when metamodelling the complexity of the relationship between inputs is also an issue for the 3d radiation interception even small variations in outputs need to be accurately predicted because small errors amplify over time as a result of the daily retro acting interactions of light interception and growth metamodels based on polynomials are efficient to model all the single variations of the function hussain et al 2002 hence were adapted for the submodel however for a general trend metamodelling based on polynomials cannot provide such a smooth answer the present study suggests that the polynomial chaos expansion metamodelling even when performed step by step and improved with expert knowledge would be inadequate to metamodel the whole florsys model with its many and diverse inputs to build a metamodel and estimate sensitivity indices this method was the most suitable as there is no method that can handle many inputs metamodelling and estimation of sensitivity indices at the same time consequently for a global emulation of florsys in order to synthesize and make available to farmers the knowledge comprised in florsys to help with decision making wilkerson et al 2002 other methods need to be considered in that case non parametric methods can be helpful villa vialaneix et al 2012 showed that metamodelling methods based on machine learning have good results for medium and large data sets this is particularly true for random forests breiman 2001 which provide the best trade off between speed and accuracy moreover non parametric methods can tolerate heterogeneous data sets this is crucial as florsys with its numerous inputs precludes building a suitable experimental design as the one needed for the present approach the global emulation of florsys will be a necessary step to make the model accessible for farmers and crop advisors particularly for a use in participatory workshops colas et al 2020 indeed none of the avenues proposed in table 6 will be fast enough or compatible with computers used in such as situation 7 conclusion the present study demonstrated that the frequent practice of developing statistical methods on rather simple case studies makes them difficult and sometimes impossible to apply to more complex real life situations latin hypercube sampling lhs was used for numerical space filling design followed by partial least squares regression combined with a polynomial expansion chaos model and selection of the most influential monomials to produce simple metamodels the individual methods used here had trouble handling all the constraints and the domain of validity needed they 1 eliminated many data close to the limits of the domain of validity of the metamodel e g tiny plants tiny with near zero leaf areas immediately after emergence from the simulated data set based on lhs in section 3 1 3 2 insufficiently accounted for correlations amongst inputs e g 2 m tall and 1 cm narrow plants do not exist despite using an adapted lhs sampling plan but both these extreme cases and correlations are frequent in real life and essential for correctly predicting the agroecosystem notably 3 the complexity of radiation transmission and interception inside crop weed canopies particularly due to shading by neighbour plants made it difficult to directly predict radiation absorption at the plant scale 4 this made it necessary to add functions here which slowed down simulations again considerably and made us lose most of the speed gain due to the metamodel so to simplify a complex process based weed dynamics model such as florsys is essential to combine different methods of sensitivity analysis and model simplification to cover the whole range of relevant stages morphologies and take account of the complex interactions between plant objects and the many feedbacks during their life cycle we used a hybrid approach using a process based albeit simplified approach for the most sensitive plant stage newly emerged tiny plants and separate sampling plans and metamodels to ensure that the more sensitive stages components were adequately covered small plants by evaluating the various approaches with independent field observations we assessed the trade off between prediction accuracy and simulation speed to identify which modelling approach was best depending on the objective of the model use declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the present work was funded by inrae ea and mia divisions the french project cosac anr 14 ce18 0007 and the burgundy region the cropping system trials were conducted at the inrae experimental station of dijon époisses and the weed observations were carried out by dominique meunier and colleagues inrae agroécologie dijon the paper was greatly improved thanks to the comments of an anonymous reviewer on an earlier version of the manuscript supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j ecolmodel 2021 109607 appendix supplementary materials image application 1 image application 2 image application 3 image application 4 image application 5 
24604,complex biological models such as mechanistic research models often need to extend their current use to a broader audience simplification and faster simulations would increase their use here a step by step methodology was developed and applied to partially metamodel hence accelerate the mechanistic model florsys this is a process based multiannual and multispecies model virtual field which simulates crop growth and weed dynamics and allows users to assess cropping systems for crop production and biodiversity the model is relatively slow which makes it difficult to test numerous and diverse cropping systems needed to identify those reconciling crop production and biodiversity here we 1 identified the slowest submodel of florsys i e the 3d voxelized light interception submodel 2 identified and applied a relevant methodology to metamodel this submodel in the simplest situation i e we predicted light interception and absorption directly at the scale of the plant instead of the voxel for a single plant in a field and 3 extrapolated the method to more complex situations i e a plant in diverse and heterogeneous crop weed canopies 4 replaced the original process based florsys submodel by the metamodels which required additional equations and decision rules 5 evaluated the metamodelled florsys with independent field observations showing an adequate prediction quality combined with an increased speed at fine grained scale since the metamodelled version was 28 times faster than the process based version for steps 2 and 3 we used the global sensitivity method based on a truncated legendre polynomial chaos expansion pce whose coefficients were estimated by partial least squares pls regression to simultaneously i rank inputs with respect to their polynomial and total effects on outputs via the so called pce pls sensitivity indices and ii provide metamodels predicting light interception and absorption at the plant level these metamodels were then shortened into parsimonious metamodels via a lasso pls method the study showed that there was a trade off between speed gain due to the metamodelled 3d light submodel and the speed loss due to the additional functions for neighbourhood effects the metamodelled version is best used for testing complex systems where plant location must be modelled precisley e g precision agriculture intercropping with precision sowing whereas the voxelized version with a large voxel size is better for simpler cropping systems the present step by step process may be helpful for investigating and speeding up other complex simulation models with interacting objects agents it notably uses a hybrid approach using a process based albeit simplified approach for the most sensitive plant stage newly emerged tiny plants and separate sampling plans and metamodels to ensure that the more sensitive stages components are adequately covered small plants keywords metamodel light interception photosynthetically active radiation par crop weed canopy sensitivity analysis simulation time 1 introduction the study of biological problems usually requires complex mechanistic models especially when dealing with weed dynamics holst et al 2007a colbach 2010 indeed even though weeds are considered to be the most harmful pest for crop production oerke 2006 national and european policies now increasingly focus on the role of weeds for biodiversity marshall et al 2003 petit et al 2011 and the need to reduce herbicide use because of health issues and environmental concerns stoate et al 2009 waggoner et al 2013 unfortunately to date no alternative weed control technique is alone as efficient as herbicides and thus several cultural techniques must be combined to control weeds liebman and gallandt 1997 many weed dynamics models exist to understand and predict weed dynamics see reviews by colbach and debaeke 1998 holst et al 2007b freckleton and stephens 2009 bagavathiannan et al 2020 only a few take into account the long term effects of the weed impacts on crops the multiplicity of weed species the complexity of cropping systems or the impact on crop production and biodiversity to date florsys gardarin et al 2012 munier jolain et al 2013 colbach et al 2014 colbach et al 2021 is the one model that answers all these requirements this is a process based virtual field model which simulates the effects of cropping systems on weed dynamics as well as on crop production and weed related biodiversity thus making possible a multiobjective design of cropping colbach et al 2017 colbach et al 2021 unfortunately models like florsys that are accurate enough to reproduce the effects of agricultural practices on weed dynamics are time consuming and complex colbach 2010 in order to use florsys to screen numerous cropping systems and identify sustainable herbicide sparse cropping systems the model must be accelerated and simplified this question is common to many other mechanistic models whose use is often limited by their complexity and slowness complex mechanistic models can be simplified by decreasing their precision level as some problems do not require the same high precision level kleijnen and sargent 2000 renton 2011 to simplify a model without losing precision is more difficult and requires different methods global sensitivity analyses can explore the model and understand its behaviour to identify which inputs change the outputs the most this allows developers to assign constant values to minor inputs and to simplify equations cox et al 2006 global sensitivity analyses thus help to find the correct level of complexity for a metamodel by identifying the non influential inputs faivre et al 2013 then metamodelling aims at emulating the original model linking inputs and outputs by less detailed but faster equations which simplifies model use for practical applications examples are metamodelling of the notg forest model marie and simioni 2014 phoma stem canker control hossard et al 2015 and the bio geo chemical dndc europe model villa vialaneix et al 2012 sometimes metamodelling a whole model can be impractical particularly if there are too many inputs and outputs if a model consists of several submodels as is the case of florsys a more practical solution is to perform a local metamodelling on the submodel using most of the computing time marie and simioni 2014 metamodelling requires several steps kleijnen and sargent 2000 that summarize as 1 what is the purpose of the metamodel i e what goal what is the accuracy needed 2 what do we know about the model to be metamodelled i e which inputs which domain of applicability which outputs 3 what method to use which type of metamodel to use which experimental design and 4 how to evaluate the metamodel i e what fitting which validity many sensitivity analysis and metamodelling methods exist like the widespread sobol indices or fast mahévas and iooss 2013 identified three criteria to select the best sensitivity analysis for a complex model 1 the number of possible simulation runs 2 the number and 3 type of inputs the feasible number of runs depending on the simulation time and the number of inputs are crucial to select the relevant methods table 1 when little is known about the model behaviour which is often the case for complex models performing early tests to increase the knowledge of the model is needed the objective of the present paper was to accelerate and simplify a mechanistic model by implementing efficient metamodels through 1 identification of the sensitivity analysis and metamodelling methods adapted to a slow complex model such as florsys 2 identification of the important inputs 3 simplification of the equations and reduction of the computing time we voluntarily excluded technical solutions such as parallel processing or graphical processing unit we focused here on the reasoning for choosing the sensitivity and metamodelling methods and how they were combined with the other steps needed to transform a metamodel into a simulation model the chosen method was fully developed in gauchi et al 2017 for a preliminary study this global sensitivity analysis method is able to deal with both dependant and independent inputs it is based on a truncated legendre polynomial chaos expansion pce whose coefficients are estimated by partial least squares pls regression gauchi et al 2017 aiming to simultaneously rank inputs as a function of their polynomial and total effects on outputs via the so called pce pls sensitivity indices and to provide precise and fast metamodels finally the metamodels were reduced into parsimonious metamodels via a lasso pls regression method the methodology to accelerate and simplify florsys involves several steps fig 1 section 2 presents the target model and its submodels in order to identify the most time consuming submodel i e the light interception submodel step 1 section 3 first presents the metamodelling approach per se with the tests that led to the choice of the most suitable method working with a simple case study i e a single plant in the field step 2 and then how we applied this method to cover all situations in the model i e target plants surrounded by neighbour plants step 3 finally section 4 demonstrates how the metamodels were integrated into florsys step 4 and section 5 uses field observations to investigate which model process based vs metamodel is the best in terms of simulation speed and precision depending on the model use step 5 2 identification of the model constraints 2 1 presentation of florsys florsys gardarin et al 2012 munier jolain et al 2013 colbach et al 2014 colbach et al 2021 is a mechanistic i e process based model which simulates multispecies weed dynamics depending on the cropping system and pedoclimate in a virtual field its purpose is to experiment numerous cropping systems to design sustainable weed management strategies that reconcile reduced herbicide use crop production and biodiversity florsys simulates the annual life cycle of crop and weed plants at a daily time step and is a combination of submodels such as plant emergence plant growth or radiation interception florsys inputs are daily weather soil characteristics initial weed seed bank and cropping system practices crop succession and detailed list of cultural operations outputs include crop yield daily weed seed bank plant densities and biomass for more information see supplementary materiel online s1 as florsys consists of a collection of submodels the simplification should not concern the whole model but individual submodels should be simplified individually to keep modularity and access to specific submodels outputs 2 2 identification of the most time consuming submodel in florsys step 1 the computing time for each florsys submodel was registered for a simulation with diverse crops and cultural practices over 13 years corresponding to a cropping system trial colbach et al 2016a code profiling of the c source code of florsys showed that the 3d radiation interception submodel was by far the most time consuming submodel this submodel predicts the photosynthetically active radiation par intercepted by each plant of the crop weed canopy volume discretised into voxels 3d pixels it used 57 64 and 99 of total simulation time with a voxel edge size of 7 4 and 1 cm respectively the second most time consuming submodel was the germination emergence submodel which used 20 7 and 0 04 of the computation time for the three voxel edge sizes consequently we will focus here on simplifying and accelerating the radiation interception submodel 2 3 a short presentation of the 3d radiation interception submodel the 3d radiation interception submodel munier jolain et al 2013 simulates a 3d sample of the virtual field where the space is discretised into voxels i e 3d pixels crop and weed plants are placed onto this field with plant position and morphology resulting from other florsys submodels crop plants can be sown in rows or broadcast i e random position in the field weeds can be positioned randomly or in species specific patches the radiation interception submodel calculates the amount of photosynthetically active radiation par that arrives on top of the crop weed canopy and that trickles down to the voxels in the underlying layers depending on plant leaf areas species radiation extinction coefficients and solar angle which depends on latitude and season in total 14 input variables can be modified in the submodel for five different outputs 2 3 1 3d radiation interception inputs plants are represented as cylinders delimited by their height and width fig 2 table 2 a the leaf area la of the plant is distributed across the successive voxel layers of the cylinder with 50 of the cumulative leaf area below relative median leaf height rh50 of the plant and its distribution governed by the shape parameter b the species radiation extinction coefficient k and the plant leaf area inside each voxel determine how much incident radiation of the voxel is absorbed by the plant s leaves the radiation absorbed by each plant para is the sum of the radiation absorbed by its leaves in the different voxels other inputs describe the location 1 the field sample i e dimensions in the north south and in the east west directions as well as the grain of the discretization i e the voxel edge size and 2 the position of the solar angle i e latitude of the simulated field and the julian day 2 3 2 3d radiation interception outputs outputs of this submodel table 2 b are used for different purposes in florsys the photosynthetically active radiation absorbed by a plant parap drives biomass accumulation in the growth submodel the daily shading intensity perceived by the plant sid drives etiolation in the morphology submodel the relative intercepted photosynthetically active radiation rpari is considered at three scales the top of a given plant rparitop over the whole plant rpariplant and the soil surface below all plants rparibase these are used as proxies for herbicide penetration and interception in the canopy in the herbicide treatment submodel as single plants are not shaded by neighbouring plants their relative par intercepted on the plant s top rparitop is always 1 thus for the single plant case only four outputs were studied i e parap sid rpariplant rparibase for the plant in a canopy step all five outputs are studied table 2 b the metamodels also predict para per cm² parac i e relative absorption efficiency for a given plant volume 3 simplification and acceleration of the 3d radiation interception submodel to find the best metamodelling and sensitivity analysis method for the radiation interception submodel we started with the simplest possible situation for this submodel which consists of a single plant in a field without shade due to surrounding plants step 2 in fig 1 once identified this method was then applied to more realistic but more complex occurrences relevant for the submodel i e target plants surrounded by neighbour plants step 3 in fig 1 3 1 simplified case study with single target plants step 2 this section aims 1 to test the effect of the range of variation in inputs 2 to test the effect of correlations between inputs 3 to analyse the sensitivity indices for unshaded single plants and 4 to evaluate the metamodels predicting the radiation interception variables for unshaded plants 3 1 1 testing the sensitivity to the range of the inputs step 2 i two input range sizes were tested following a plackett burman experimental design plackett and burman 1946 with 12 combinations of the two extreme ranges for the 11 inputs with latin hypercube sampling lhs designs of 29 200 rows supplementary material online s2 section 1 1 a small range corresponding to france focusing on spring and summer and the plant morphologies most common in fields and 2 a large range for all possible plant morphologies growing all year and all around the world except polar regions for each configuration of ranges the florsys radiation interception submodel was run with a single target plant located at the centre of the field sample and sobol sensitivity indices saltelli 2002 were estimated for the analysed outputs sobol indices are the most widely used sensitivity indices and are robust enough for complex models gauchi et al 2017 the sobol decomposition leads to decompose the variance of a non linear model output into percentages of variance which can be attributed to the different inputs discriminating the variance due to the main effect of a given input from the one resulting from interactions with other inputs the sobol indices based on these variance percentages can be directly interpreted as measures of sensitivity measured across the whole input space the main advantages is that sobol indices can deal with non linear responses and interactions in non additive systems this design gave a set of 12 sensitivity indices for each of the 11 inputs a linear regression of these sensitivity indices was fitted where the regression coefficients indicate the importance of the effect of the range absolute values and ranking of sensitivity indices of the various inputs changed for all outputs when a small input range was used instead of large one supplementary material online s2 section 1 not all inputs were though concerned depending on the analysed output e g the range of the voxel was important for the relative intercepted par pari but not for the shading index sid consequently for the subsequent steps the large input ranges were used to cover all the possible input situations and notably for novel combinations of species traits e g resulting from new crop varieties or invasive weed species 3 1 2 sensitivity indices estimation via sobol saltelli method and via polynomial chaos expansion the objective of this section was to compare the sobol sensitivity indices that we estimated in section 3 1 1 with a method that both estimates sensitivity indices and fits a metamodel the polynomial chaos expansion pce method uses the same principle as sobol sensitivity indices via ordinary least square regression sudret 2008 here shortened to pce ols for each input the sensitivity indices estimated by the polynomial chaos expansion are 1 the polynomial effect that accounts for the effect of the input only i e the main effect of the input and 2 the total effect i e quantifying all the interactions of this input with other inputs these indices are respectively comparable to the first order indices and the total effect indices of sobol indices the large range experimental design via latin hypercube sampling lhs mckay et al 2000 created in the previous section was used to estimate both indices pce ols indices were similar to sobol indices computed on the same dataset supplementary material online s2 section 2 the largest difference was of 0 13 for the total effect of the voxel on the radiation intercepted by the target plant rpariplant the ranking of the inputs was the same with both methods we thus preferred pce in the following steps since it both estimates sensitivity indices and fits a metamodel which is needed to simplify the radiation interception submodel 3 1 3 sensitivity indices with correlated inputs step 2 ii the method for estimating pce ols indices assumes that inputs are independent and uncorrelated however some inputs of the radiation interception submodel are correlated e g plant height and the total leaf area are strongly linked e g galium aparine l klem et al 2014 we thus tested the effect of including correlations amongst inputs on the estimation of the sensitivity indices and decided whether the method needed to be adapted this part was fully presented in gauchi et al 2017 and further details can be found in supplementary material online s2 in summary the space filling lhs design of section 3 1 1 was modified to include correlations amongst inputs following the iman and conover method iman and conover 1982 these correlations supplementary material online s2 section 3 were estimated on simulated plants occurring in 10 diverse cropping systems colbach et al 2016b a number of 10 000 runs were selected out of a total of 29 200 runs to avoid an excessive weight of outputs too close to the limit of the ranges we ensured that the experimental design remained orthogonal and that enough runs were kept to estimate the sensitivity indices adding correlations to the space filling design of the inputs changed absolute values of sensitivity indices pce ols for all outputs and gave deviant values 0 or 1 consequently it was essential to find a method better adapted to correlated inputs gauchi et al 2017 proposed to calculate the sensitivity indices i e polynomial effect and total effect by estimating the coefficients of polynomial chaos expansion using a partial least squares method namely a partial least squares regression pce pls see wold et al 2001 here the resulting pce metamodels were though too complex to speed up florsys computations we thus built more parsimonious and faster metamodels using a method developed by gauchi et al 2017 who tested it on a single florsys output these parsimonious faster metamodels were built with a lasso regression tibshirani 1996 to select monomials via glmselect sas with the selected monomials we performed a new pls regression for the final parsimonious metamodel hence fast metamodel this combination of methods was hence referred to as lasso pls the resulting single plant pce pls metamodels full and fast were evaluated via a pls specific criterion the q2 cum tenenhaus 1998 lazraq et al 2003 for fitting and prediction qualities we used the same principle and stopping rule as in gauchi et al 2017 giving a q2 cum h referred to as q2cum in this paper this cross validated fitting prediction criterion is bounded between 0 and 1 the closer to 1 it is the better the metamodel is in terms of prediction and fitting the prediction error was evaluated via the relative mean squared error in predicton rrmsep supplementary material online s5 section 1 this method was used for the sensitivity analysis and metamodelling of the single plant case sections 3 1 5 and then for the more complex case with target plants surrounded by neighbouring plants section 3 2 3 1 4 identifying the key inputs that drive radiation interception of single plants step 2 iii the sensitivity analysis based on pce pls showed that the most important inputs for the photosynthetically active radiation absorbed by the plant parap which drives plant growth were voxel size and plant width fig 3 the third most important inputs were the target plant characteristics driving potential leaf area absorption ability i e total plant leaf area and species extinction coefficient total leaf area and plant volume determined by its width and height affected parap more than leaf distribution rh50 and b the environmental variables latitude and day as well as field size had small but non negligible impacts all inputs strongly interacted with interactions making up between 46 voxel edge size and almost 100 of the total effect all others except plant width consequently the sign of the main regression coefficient of an input was useless to assess how an output varied with an input graphs of outputs vs inputs confirmed that interactions made it usually impossible to identify general tendencies except that parap tended to decrease with increasing plant height and width indicating a self shading effect supplementary material online s2 fig 2 in section 5 the same general tendencies as for parap were observed for the other outputs i e all inputs matter voxel edge size and target plant variables mattered more than physical variables and field size though voxel size could be less important for some outputs such as the shading index sid plant volume though the most relevant variable could be height rather than volume and leaf area mattered more than plant shape and leaf distribution supplementary material online s2 section 4 this analysis also showed that large voxel edge sizes i e 10 cm and above frequently led to weird outputs values such as an abnormal concentration of 0 5 values for the rpariplant supplementary material online s2 section 5 this is due to the computational effect of the voxel based algorithms notably when voxels are so large that they include the whole plant further details in supplementary material online s2 section 5 for small voxels this only occurs during the 1 2 days after plant emergence at a time when shading and light absorption have no influence on later plant growth because young plants do not respond to shading and their biomass accumulation only depends on temperature in florsys 3 1 5 metamodels for a single plant step 2 iv the metamodels for a single target plant in the field included all inputs as the sensitivity analysis indicated that all were influential albeit to varying degrees the full metamodels included 4367 monomials resulting in a good i e close to 1 q2cum 0 93 0 98 table 3 a lines 1 3 5 7 and a low prediction error rrmsep 0 15 0 25 mj mj 1 supplementary material online s5 section 3 lasso pls selection produced simpler and faster metamodels with only 25 to 27 monomials resulting in a quite good q2cum 0 70 0 90 but a slightly worse prediction error rrmsep 0 35 0 55 table 3 a lines 2 4 6 8 regardless of the metamodelling approach fast or full radiation interception at the base of the target plant rparibase a proxy for the total herbicide penetration into the canopy is the least well predicted output this was also the only output that was not calculated at the scale of the plant but at the field scale 3 1 6 summary for single target plants we tested different sensitivity analysis methods that increased our knowledge of the 3d radiation interception submodel this resulted in a more appropriate method that accounted for the correlated inputs we then proposed a handy solution for more parsimonious and faster metamodels part of the methods were developed in a previous study on a single output gauchi et al 2017 and were completed here before being applied to a larger set of outputs 3 2 case for a target plant inside a canopy step 3 fields or even field portions rarely only comprise a single plant step 4 thus focused on radiation interception of target plants surrounded by neighbouring plants the method developed in the previous step to analyse and metamodel radiation interception from target plant environmental and precision inputs was adapted to 1 include contrasting canopies representing the diversity in crop weed canopies in arable fields in the simulation plan while 2 limiting the amount of additional inputs needed to describe the canopy surrounding the target plant 3 2 1 simulation plan a canopy is a complex set of plants of different species sizes widths positions etc to set up diverse plant canopies in our virtual field we needed to vary many variables plant density crop density weed density amount of bare field area the position of weeds random or in patches number of patches in the field the position of crop plants row vs broadcast sown inter row width canopy structure e g presence and diameter of canopy gaps surrounding target plants the heterogeneity of plant morphology mean and variation coefficient of target plant characteristics weed populations being more heterogeneous than crop population i e presenting a larger range of variation see supplementary material online s3 these preliminary inputs were used in a lhs design of 20 440 rows correlations were added in the same way as for the single plant study with the iman and conover method iman and conover 1982 the diverse canopies were built by placing the plants on a virtual field and attributing morphologies and then radiation interception and absorption were simulated with the florsys radiation interception submodel cases with outlying values were removed as well as output values too close to the range limits i e 0 1 or 100 depending on the output to avoid side effects due to computation errors 2536 canopies remained after the sorting the pce pls method was used to metamodel and perform the sensitivity analysis 3 2 2 describing the canopy many detailed variables are needed to create contrasting canopies in florsys but only a limited number of inputs are allowed keeping the metamodel simple the detailed canopy variables were thus aggregated into five mean canopy inputs table 2 to account for the canopy effect in the metamodel the nearer the neighbours are to the target the more their characteristics contribute to the variables describing the average canopy characteristics here the example of the canopy height cm 1 m e a n h e i g h t i 1 n 1 d i 1 h e i g h t i i 1 n 1 d i 1 where di is the distance m of the target plant to the closest neighbour plant i 1 to account for a zero distance when the neighbour is located in the same voxel as the target h e i g h t i is the height cm of neighbour i and n the number of neighbour plants in the field sample for the equations of the other canopy variables see supplementary material online s3 section 4 in addition to these aggregated canopy inputs we added 1 the plant density and the maximum distance between the target plant and neighbour plants 2 target plant variables as in the single plant case and 3 two environmental variables latitude and day resulting in 15 metamodel inputs table 2 to reduce the number of inputs field dimensions xmax and ymax whose effect was shown to be slight in the single plant sensitivity analysis of the single plant section 3 1 4 were both fixed at 8 m which allowed having large plants in the virtual field sample the voxel size was shown to be important for most outputs section 3 1 4 but to simplify and accelerate the simulation plan we kept it constant additional simulations supplementary material online s2 section 6 showed that a voxel edge size of 4 cm was the best compromise between the precision of the radiation interception submodel output and the computation time 3 2 3 sensitivity indices step 3 i the sensitivity analysis of radiation interception outputs to inputs depicting target plant physical environment and neighbour plants showed that input effects were almost entirely due to interactions amongst inputs fig 4 globally target plant inputs had the most and neighbour plant inputs the least impact inputs of a given type had similar effects except for the relative par intercepted by the target plant rpariplant whose height effect was several times the effect of any other inputs as for the single plant scenario section 3 1 4 the interactions amongst inputs were generally too complex to identify general tendencies whether from the signs of the polynomial effects or from graphs supplementary material online s2 section 5 and again outputs were sensitive to all inputs via interactions with other inputs and none of latter could be set at a default value in the following metamodels 3 2 4 metamodels step 3 ii the metamodels for target plants surrounded by neighbour plants included all inputs i e for describing the target plant the physical environment and the biological environment due to the neighbour plants the polynomial degree of these metamodels was smaller than for the single plant ones except for the relative intercepted par rpari table 3 b lines 14 15 the q2cum was always lower and the prediction error higher table 3 b vs a further increasing the polynomial degree did not improve the q2cum or reduce the prediction error results not shown the need for a higher polynomial degree for the rpari points to more and more complex interactions amongst inputs the fast metamodels usually needed a higher polynomial degree and more complex monomials table 3 b than full metamodels to optimize the q2cum the latter though remained low 0 27 0 56 and prediction error was much larger than for single plants 0 85 and 0 65 radiation interception and absorption by a plant surrounded by neighbour plants is thus much harder to simplify via a small metamodel than for single plants 3 2 5 summary for plants in the canopy the metamodels for radiation interception and absorption by a plant surrounded by neighbour plants were simple enough to be implemented into florsys but with a poorer prediction quality than for a single plant the canopy creates a complex interaction with the radiation that cannot be easily simplified at a scale as large as the plant strong interactions between all inputs prevented us from setting the least important inputs to constants 4 combining the metamodels into a florsys submodel step 4 as we had developed metamodels for two situations i e single plant and plant in a canopy it was necessary to establish rules to determine when to use which metamodel in a simulation using the whole florsys including the metamodels hereafter called florsys ml this section presents how the metamodels were combined and what else was needed to cover all likely canopy scenarios with florsys ml 4 1 principle even when there is more than one plant in a field some of these plants can be considered as single if they do not interfere with each other s radiation interception which depends on plant sizes solar angle and distance between plants consequently each day for each target plant crop or weed rules are needed to determine whether a target plant can be considered as single or as surrounded by neighbour plants supplementary material online s4 section 2 when building the metamodels a large number of runs were eliminated because outputs were too close to the limits of the range or because their combination was biologically impossible and resulted in deviant values section 3 2 1 this also reduced the ranges accepted by the metamodels for several key inputs such as target leaf area making it impossible to predict radiation interception for newly emerged seedlings i e with almost nil height width and leaf area voluminous single plants having reached the maximum height and width possible for the species or mature plants with dried leaves with a near zero leaf area but such plant morphologies are frequent in any cropping system to remedy this further metamodels were built for the particular case of small seedlings and for the remaining outlying situations equations were added to predict radiation interception and absorption from ecophysiological knowledge or from likely constants section 4 3 fig 6 summarizes how the different rules equations and metamodels were aggregated finally the calculation loops over neighbour plants needed to calculate the aggregated canopy variables are often time consuming as a consequence alternative methods to compute aggregated neighbour were tested section 4 4 4 2 rules for deciding whether to use the single plant or plant in a canopy metamodel 4 2 1 method the par intercepted at the top of a target plant rparitop is relevant to identify whether radiation interception by the target plant is impacted by neighbour plants because this output is always 1 for single targets and decreases in the presence of shading neighbours to establish decision rules to discriminate these two situations a regression tree was built from the data sets of sections 3 1 and 3 2 using the inputs listed in table 2 as the metamodels in the previous sections showed that it was difficult to take account of all effects and interactions with these inputs some were transformed and others added in the present analysis the environmental variables were transformed to emphasize the effect related to solar angle latitude was transformed into degrees to the equator i e absolute latitude and julian days into days from the summer solstice to the winter solstice i e between solstice days the distance from target plant to its closest neighbour was also used as input with distances calculated between plant centres and all other inputs were weighted by the inverse of this distance to take into account that closer neighbours shade more than farther neighbours finally the target height relative to the canopy height overtaking percentage was integrated via the ratio of the difference between the two heights eq 6 supplementary material online s3 section 5 the cart method breiman et al 1984 was used to build a classification tree to determine the decision rules this method successively splits the data set into two subsets along a threshold value of an input e g distance to the closest neighbour in order to maximize the difference between subsets in terms of output branches are combinations of input values that lead to output predictions contained in leaf nodes cart also ranks the input according to their importance to explain the output the output analysed in the trees was not directly the rparitop but a binary variable indicating whether the target plant was considered single or inside canopy depending on whether its rparitop was respectively or a threshold value in addition to the theoretical value of 1 ten other thresholds were tested ranging from 0 90 to 0 99 incremented by 0 01 in order to increase the number of single plant cases compared to canopy cases and thus the robustness of the tree amongst the 11 trees the one corresponding to the 0 98 threshold was chosen this threshold is close to 1 i e the theoretical value of rparitop in single plants and it identified the most situations when to use the single plant metamodel the latter allows accelerating calculations because the single plant metamodels were simpler and did not need to calculate the aggregated canopy variables 4 2 2 decision tree to determine where a target is shaded by neighbours the rules determining whether a target plant can be considered as single are shown in fig 5 for example if the nearest neighbour is further than 1 6 m and the target plant is taller than the neighbouring canopy the target can be considered as single surrogates of the tree i e variables correlated to the variable in the tree that could also explain the segmentation but to a lesser degree and ranking of variables in their order of importance supplementary material online s3 section 6 showed that nearest neighbour distance either alone or in interaction with other variables are predominant to determine whether the target plant is single or within a canopy based on expertise we added a further logical rule if there are no neighbours whose height exceeds the distance separating the outer rims of the neighbour and target plants the target is considered as single in that case even if the sun is low on the horizon the closest neighbour is too far to shade the target supplementary material online s4 the combination of the decision tree and this additional rule constitute step a in fig 6 4 3 adding equations at the limits of the input ranges the input ranges of the metamodels missed small seedlings for which good prediction is essential as their initial growth determines which plants outgrow the others consequently we ran a further simulation plan to build a third metamodel focusing on small seedlings step c fig 6 using the method developed in section 3 supplementary material online s4 section 4 this additional metamodel was still inadequate for fresh seedlings whose leaf area was lower than the metamodel s accepted input range in that case as there is neither shading nor self shading the para absorbed by the plant is the product of the incident para the plant leaf area times its extinction coefficient based on beer s law monsi and saeki 1953 2005 step b in fig 6 this works fine for single plants that are unshaded by neighbours to include either small plants surrounded by neighbours or any plants by small neighbours outside the canopy metamodel range a linear combination of predictions for single plants either small or large and plants in canopy was used step g in fig 6 this was particularly true for canopy leaf area whose lower range limit was extremely high table 2 single plant predictions and target in canopy predictions were weighted by respectively 1 and the canopy leaf area and divided by the same of these weights supplementary material online s4 section 4 the metamodels do not include voluminous or mature leaf less plants either as these have finished their growth outputs were simply fixed either to a minimum or maximum value or linked with a simple regression if one input was out of range step fig 6 the values were based on graphs of outputs vs inputs from the complete data set including the outliers that were ousted during metamodel construction supplementary material online s4 section 4 if several inputs were out of range the output was estimated based on the analysis of the most influential input with the strongest polynomial effect in the sensitivity analysis supplementary material online s4 section 4 for example if a target plant surrounded by neighbours is taller than 254 8 cm then its relative intercepted par is 0 00649 mj mj 1 4 4 different methods to aggregate neighbour plants into canopy variables we proposed three different methods to calculate the aggregated neighbour variables of each target plants 1 all neighbours close to the target are used for the computation local neighbours 2 all plants in the field are averaged and the same aggregated variables were used for all target plants average neighbours 3 a mix between the previous two methods using average canopy variables when the plant density exceeds 500 plants m 2 and local neighbours otherwise the effect of the aggregation method on prediction error and simulation speed of the whole florsys ml was evaluated in section 5 5 evaluation of the simplified florsys ml with field observations step 5 5 1 objective sections 3 1 5 and 3 2 4 evaluated the prediction quality of the individual metamodels here the objective was to evaluate how good and fast the predictions produced by florsys ml compared to the process based florsys by comparing simulations to field observations following the methods developed in a previous paper colbach et al 2016b different voxel edge sizes and the three methods for aggregating neighbour plants were tested 5 2 material and methods 5 2 1 field observations and features common to all simulations observations were taken from the inrae long term field experiment at dijon epoisses burgundy chikowo et al 2009 where weed and crop variables plant and seed densities plant biomass yield were monitored from 1999 to 2012 details can be found in colbach et al 2016b this trial included ten fields with diverse crop rotations ranging from intensive herbicide based to herbicide free systems and varying degrees of tillage and mechanical weeding weed flora was assessed with species identification plant density above ground biomass and seed bank measurements crop yield was also estimated 5 2 2 simulation plan the simulation combined 1 the florsys version metamodelled or process based with 2 the voxel edge size 1 4 or 7 cm which determined the precision of plant location all florsys versions and plant morphology processed based version the florsys ml version moreover tested 3 different methods for aggregating neighbour plants local average or mixed see section 4 4 and the process based version tested 4 field sample areas 1 m 1 m 3 m 3 m and 6 m 3 m with a 7 cm voxel unless otherwise indicated field area was 6 m 3 m in total nine scenarios were run with the florsys ml version and six with the process based one each of the ten field histories was simulated over 13 years using the weather measured at the local weather station inrae climatik platform and starting with the weed seed bank observed at the onset of the field experiment each scenario was repeated ten times to account for stochastic effects outputs were produced for all the days where observations were carried out in the fields simulations were run with a computer with two 2 ghz processors and 16 gb ram and their simulation time was recorded and averaged over repetitions for the different methods 5 2 3 evaluation criteria simulations with the metamodelled florsys ml and process based florsys were compared to field observations prediction error was assessed with the relative root square mean squared error of prediction rrmsep corrected for variability in observations due to measurement errors and intra field variability and simulations due to stochasticity colbach et al 2016b this error was calculated relative to the range of variation of the observations details can be found in supplementary material online s5 section 1 outputs were analysed at two temporal scales either corresponding to the individual observation dates daily scale or values averaged over the simulation multiannual scale 5 3 results 5 3 1 mean simulation time the simulation time of the process based florsys for all cropping systems tested decreased with voxel edge size when voxel edge size increased from 1 to 4 cm simulation time was divided by approximately 20 fig 7 a increasing voxel size further from 4 to 7 cm decreased simulation time by an additional 43 increasing voxel size from 7 to 10 cm did not decrease simulation time any further the slowest scenario took 259 times more time than the fastest the fastest scenario with the 7 cm voxel edge size and 1 m² field sample took 4 minutes for a repetition of the 13 year long cropping system compared to more than 18 hours for the slowest with the 1 cm voxel and the 18 m² area conversely simulation time increased with field sample area supplementary material online s5 section 2 increasing area from 1 to 9 m² multiplied the simulation time by approximately 8 doubling the field sample area to 18 m² only increased the simulation time by a further 10 the field size multiplies the simulation time by 1 15 for every m² of a 13 year simulation the simulation time of florsys ml remained stable for all voxel sizes but it depended on the method for calculating neighbouring canopy variables fig 7 a the florsys ml with average neighbours was fastest and the one combining local and average neighbours was nearly as fast always using local neighbours made simulations considerably slower than with the process based model and simulation time even increased with voxel edge size indeed in florsys ml the voxel determines plant location and the larger the voxel is the more plants are in each voxel so when florsys ml searches through the voxels surrounding the target plant to compute the canopy inputs it must compute more plants which takes longer florsys ml was considerably faster than the process based model with small voxel edge sizes i e 28 times faster for florsys ml with average neighbours 5 3 2 prediction error in process based simulations the prediction error tended to increase slightly with increasing voxel size fig 7 b the same trend was observed for prediction error in florsys ml simulations with larger voxels suggesting a sensitivity to plant position which is less precise if the voxel is large simulations with a 1 m² field sample produced slightly better results than 18 m² and larger areas e g for the multiannual weed density for all species summed the rrmsep for 1 1 3 3 and 6 3 m² field samples was respectively 63 113 and 116 mj mj 1 details in supplementary material online s5 section 3 probably because it increased interspecific competition between weed species by increasing the probability of overlapping species patches however small fields potentially miss rare species and overestimate interspecific competition in case of high weed densities generally the error was larger for metamodel based vs process based simulations particularly for weed plant biomass table 4 and it varied more amongst repetitions supplementary material online s5 section 3 error was often smaller than the variability in observations pointing to a negligible prediction error and making it impossible to calculate the relative variation in error for metamodelled vs process based simulations table 4 conversely florsys ml was better than the process based florsys to predict multiannual weed plant densities usually florsys ml using either local or average neighbours respectively had the smallest and largest errors whereas errors were intermediate when using both average and local neighbours fig 7 b table 4 regardless of the evaluation criteria there was no model version process or metamodel based approach for calculating canopy variables in metamodels or precision level voxel size field sample area that optimized the precision of all model outputs 6 discussion 6 1 simplifying a complex process based model in this article we presented a method to accelerate and simplify a complex process based model the paper is of interest for non statisticians that want to metamodel complex models and are often baffled by statistical methods and how to apply them in their real life complicated situation another particularity of our work was that we did not use the metamodel as such but integrated it into a larger model and evaluated the latter with independent field data two steps that have to the best of our knowledge been rarely carried out in the past from a more technical point of view the originality of the approach lies in 1 the choice of metamodelling only the most time consuming part of the model i e the 3d light interception submodel 2 the choice of an innovative metamodelling method that handles correlated inputs and selects monomials 3 the integration of the metamodelled submodel into the complex model and 4 the description of the nearby canopy with a limited number of inputs this work did not compare different metamodelling methods villa vialaneix et al 2012 but provided practical guidelines for choosing and tuning metamodelling methods with respect to the complex model constraints e g correlated inputs it extended what was done in the previous paper gauchi et al 2017 by showing the whole approach to simplify a complex model usually metamodelling via polynomial chaos expansion allows reducing the number of inputs in the model by setting the inputs to average values luo et al 2013 rothenberg and wang 2016 here however no input could be omitted because all either influenced radiation interception outputs directly or in interaction with other inputs usually the whole model is metamodelled avoiding the need to integrate the metamodel into a larger model cohen and prinn 2011 luo et al 2013 here we metamodelled a single time consuming submodel in order to accelerate the simulations of the whole florsys model and we thus had to integrate the metamodels together with complementary equations into florsys in sirius brooks et al 2001 only a few equations were metamodelled no implementation of the metamodel was needed as the metamodel was as good as the whole sirius to predict the yield which was the study s goal the constraints of this approach were manageable for the 3d radiation interception of florsys even though the number of inputs needed to be decreased with the help of aggregated canopy variables but these constraints probably make it impossible to apply this metamodelling method to bigger models like the whole florsys with its many more inputs and correlations 6 2 experimental design for analysing a complex model the numerical space filling design latin hypercube sampling lhs is usually appropriate to explore the whole space of possible input combinations for our biological example we also used the iman and conover method iman and conover 1982 to apply a correlation matrix to the lhs to increase the biologically realistic plant variable combination it worked less well for the dynamic florsys model especially at the outer bounds of input ranges that were not sampled enough despite having tested the best minimum row number in the lhs design this was particularly problematic at the onset of the plants life cycle i e for small plants as imprecise early predictions would amplify the next days prediction errors thus setting off the plants growth and development in entirely the wrong direction we improved the metamodelling by using separate experimental sampling designs combining with a simplified process based approach discriminating three types of plants that differ in terms of light interception based on their age and size 1 a standard lhs and metamodel covering mostly large and older plants 2 a second lhs and metamodel specifically targeting younger smaller plants 3 a simplified ecophysiological equation for newly emerged tiny plants the latter approach was acceptable here as these plants do not self shade and are rarely shaded by neighbours no such effort was made at the other extreme of plant size range i e large adult plants with dried leaves indeed these do not photosynthesize anymore and misestimating their absorbed light would have little impact on their future colleagues aiming to similarly metamodel complex could use a similar approach i e keep a process based albeit simplified approach for the most sensitive stages components here the newly emerged tiny plants and combine separate sampling plants and metamodels to ensure that the more sensitive stages components are adequately covered here the small plants the inability of the metamodels to correctly predict small plants is explained by three combined reasons 1 we chose a broad input range to cover all possible plant morphologies in the field which reduced the probability of drawing many low input variables 2 as the simulated plants were the combination of several inputs the probability of drawing a small plant combining low values of all inputs e g low height width and leaf area was even lower particularly as the space filling design was balanced 3 the equilibrated design also drew plants combining high values for some inputs with low values for others resulting in biological impossible morphologies e g tiny plants with an enormous leaf area and non logical output values these plants had to be removed from the data set decreasing even more the occurrence of extreme input values used in the metamodels for models with a high number of inputs it is thus better to sample stepwise rather than have a unique sampling design surprisingly adding correlation to inputs did not help to ensure many small and plausible plants 6 3 which method for which application to metamodel and perform a sensitivity analysis many methods exists which have been assessed in comparative studies we thus decided to detail here the entire path when choosing and applying a method to transform a complex slow model into a faster metamodel polynomial chaos metamodelling accepts only a small number of inputs hence the aggregation of neighbour plant variables into a small number of synthetic canopy variables unfortunately it is the aggregation step particularly the loop computing the plants close to the target plant which cancelled out the simulation time saved thanks to the metamodels another way to speed up simulations would be to use the initial process based interception submodel and to decrease the precision of the canopy structure by increasing the voxel edge size which governs the precision of plant locations and volumes as well as leaf distribution along plant height this approach led to less precision loss than expected indeed florsys does not explicitly represent plant architecture in detail with each organ e g leaf stem simulated if that had been the case enlarging voxels would indeed decrease prediction quality considerably actually florsys distributes leaf area in voxel layers without considering leaf size position or inclination very small voxels do thus not necessarily place leaf area in the correct voxel layer and downsizing voxels cannot be simply approximated here to differential equations that govern light transmission we already discussed the fact that model quality does not decrease below a certain voxel size and is not best for the smallest voxel i e the highest precision in munier jolain et al 2013 moreover there are several stochastic functions in florsys particularly for plant location in the canopy this explains why differences between scenarios differing solely in terms of voxel size are not solely due to differences in voxel size we thus identified two ways to save simulation time depending on the simulation goal either by decreasing the precision of the plant and canopy description process based light interception submodel with a large voxel edge size or that of the light interception metamodelled submodel with a small voxel edge size choosing rapidity over precision can be appropriate for example when needing quick simulations for workshops with farmers to co design cropping systems bergez et al 2010 the choice of the approach then depends on the target output table 5 when plant location is essential e g when testing site specific weed management small sowing interrows row only nitrogen fertilization berge et al 2013 then a voxel size of 1 cm is needed and the metamodelled florsys ml would allow faster and thus more simulations than the process based florsys when both moderate simulation time and prediction quality are needed the process based florsys with a voxel size of 4 cm would be best for cropping system tests a quantitative precision is less essential as long as the management recommendations are correct renton 2011 6 4 what other solutions to speed up a complex model instead of only simplifying the process based approach for tiny newly emerged plants we also thought about using a simplifying process based light interception model this approach was used in early crop weed competition models graf et al 1990 soyweed wilkerson et al 1990 almanac kiniry et al 1992 e g intercom kropff and spitters 1992 kropff et al 1992 as well as in intercrop models gaudio et al 2019 however these models only work for homogeneous 2 species canopies and cannot grasp the complexity of heterogeneous multispecies crop weed canopies in terms of location emergence timing and morphology as shown by comparisons of simulations with such models to independent field observations debaeke et al 1997 deen et al 2003 consequently the recent trend in crop weed competition modelling goes towards more complexity rather than less renton 2013 a recent review of multispecies canopy models even concluded that the florsys approach was a good compromise between simplicity and accounting for canopy heterogeneity gaudio et al 2019 there are also technical solutions for speeding up simulations for instance parallelising the execution of the source code or using graphical processing units unfortunately these solutions make it difficult to maintain a unique source code for any type of computer or server a portable solution is to run multiple florsys clones simultaneously on a single computer or server either manually or automatically via scripts the speed gain then depends on the number of logical processors of the computer another avenue is similar to the large voxel solution i e reduce the size of the simulated field sample this solution was already assessed in a previous paper colbach et al 2016b where we determined the minimum acceptable size again the more complex e g many species large interrows the larger the field sample needs to be so there are several avenues for speeding up a complex model table 6 the best choice depends on the objective and situation of use and several solutions can be combined for an even better result 6 5 towards a larger simplification of florsys the simplification of the radiation interception was easier for a single plant in a bare field than for a plant located inside a canopy indeed 1 the interaction with the canopy is harder to metamodel and 2 the aggregated inputs simplify the canopy too much simplifying a complex model with many inputs is a principal issue when metamodelling the complexity of the relationship between inputs is also an issue for the 3d radiation interception even small variations in outputs need to be accurately predicted because small errors amplify over time as a result of the daily retro acting interactions of light interception and growth metamodels based on polynomials are efficient to model all the single variations of the function hussain et al 2002 hence were adapted for the submodel however for a general trend metamodelling based on polynomials cannot provide such a smooth answer the present study suggests that the polynomial chaos expansion metamodelling even when performed step by step and improved with expert knowledge would be inadequate to metamodel the whole florsys model with its many and diverse inputs to build a metamodel and estimate sensitivity indices this method was the most suitable as there is no method that can handle many inputs metamodelling and estimation of sensitivity indices at the same time consequently for a global emulation of florsys in order to synthesize and make available to farmers the knowledge comprised in florsys to help with decision making wilkerson et al 2002 other methods need to be considered in that case non parametric methods can be helpful villa vialaneix et al 2012 showed that metamodelling methods based on machine learning have good results for medium and large data sets this is particularly true for random forests breiman 2001 which provide the best trade off between speed and accuracy moreover non parametric methods can tolerate heterogeneous data sets this is crucial as florsys with its numerous inputs precludes building a suitable experimental design as the one needed for the present approach the global emulation of florsys will be a necessary step to make the model accessible for farmers and crop advisors particularly for a use in participatory workshops colas et al 2020 indeed none of the avenues proposed in table 6 will be fast enough or compatible with computers used in such as situation 7 conclusion the present study demonstrated that the frequent practice of developing statistical methods on rather simple case studies makes them difficult and sometimes impossible to apply to more complex real life situations latin hypercube sampling lhs was used for numerical space filling design followed by partial least squares regression combined with a polynomial expansion chaos model and selection of the most influential monomials to produce simple metamodels the individual methods used here had trouble handling all the constraints and the domain of validity needed they 1 eliminated many data close to the limits of the domain of validity of the metamodel e g tiny plants tiny with near zero leaf areas immediately after emergence from the simulated data set based on lhs in section 3 1 3 2 insufficiently accounted for correlations amongst inputs e g 2 m tall and 1 cm narrow plants do not exist despite using an adapted lhs sampling plan but both these extreme cases and correlations are frequent in real life and essential for correctly predicting the agroecosystem notably 3 the complexity of radiation transmission and interception inside crop weed canopies particularly due to shading by neighbour plants made it difficult to directly predict radiation absorption at the plant scale 4 this made it necessary to add functions here which slowed down simulations again considerably and made us lose most of the speed gain due to the metamodel so to simplify a complex process based weed dynamics model such as florsys is essential to combine different methods of sensitivity analysis and model simplification to cover the whole range of relevant stages morphologies and take account of the complex interactions between plant objects and the many feedbacks during their life cycle we used a hybrid approach using a process based albeit simplified approach for the most sensitive plant stage newly emerged tiny plants and separate sampling plans and metamodels to ensure that the more sensitive stages components were adequately covered small plants by evaluating the various approaches with independent field observations we assessed the trade off between prediction accuracy and simulation speed to identify which modelling approach was best depending on the objective of the model use declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the present work was funded by inrae ea and mia divisions the french project cosac anr 14 ce18 0007 and the burgundy region the cropping system trials were conducted at the inrae experimental station of dijon époisses and the weed observations were carried out by dominique meunier and colleagues inrae agroécologie dijon the paper was greatly improved thanks to the comments of an anonymous reviewer on an earlier version of the manuscript supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j ecolmodel 2021 109607 appendix supplementary materials image application 1 image application 2 image application 3 image application 4 image application 5 
