index,text
175,accurate two phase flow modeling has a crucial role in detecting pollution in aquifers and or in the simulating immiscible flow through porous media in this research a new hybrid numerical method based on the lower order non conforming finite element method ncfem and interior penalty discontinuous galerkin dg method is proposed to simulate two phase incompressible flow in heterogeneous porous media the pressure and transport saturation equations are discretized by using the non conforming crouzeix raviart cr finite element and the symmetric weighed interior penalty discontinuous galerkin swipm as a result of determining the degrees of freedom at the midpoint of neighboring element edges a consistent set of pressure and velocity fields is obtained via the ncfem an h div projection based on the raviart thomas rt element is implemented to improve the results resolution and preserve the continuity of the normal component of the velocity field besides the spurious numerical oscillations of the saturation solution at the end of each time step are removed by using a novel vertex based slope limiter named the modified chavent jaffre limiter the accuracy and performance of the proposed numerical method are assessed by solving the buckley leverett and mcwhorter sunada benchmark problems along with two test problems associated with highly heterogeneous porous media the numerical results indicate that the proposed scheme has a remarkable potential to accurately capture the shock front and sharp interface zone of immiscible phases in the heterogeneous aquifers and other porous media keywords non conforming finite element method two phase flow crouziex raviart element modified chavent jaffre slope limiter discontinuous galerkin method nomenclatures symbol variable definition description f size of each of the faces of the element f f h f h i a set of internal faces shared between two neighboring elements f t t f h b a set of boundary faces f t ω conforming with the boundary γ γ in γ out γ n f h f h i f h b a set of all the faces f α fractional flow function of the phase α w n k absolute permeability of the porous medium k rα relative permeability of the phase α w n nf normal vector on the face f directed from t to t pd entry pressure pa s α saturation of the phase α w n t h t i n h a compatible regular triangular subdomain in the ω domain consisting of nh the number of t elements in the two dimensional space of a triangular element t cross section of each of the triangular elements t t h u α velocity of the phase α w n s rα residual saturation of the phase α w n se normalized effective saturation ν test function greek ω computational domain ω external boundaries of the domain φ porosity μ dynamic viscosity pa s γ f harmonic average of diffusion coefficients abbreviations bl buckley leverett cr coruziex raviart dg discontinuous galerkin fem finite element method impes implicit pressure explicit saturation ms mcwhorter and sunada ncfem non conforming finite element rt raviart thomas swipm symmetric weighed interior penalty discontinuous galerkin swipm introduction nowadays mathematical models are known as the most powerful tool to investigate the behavior of multiphase flow through heterogeneous porous media for different applications such as the petroleum industry reservoir engineering groundwater resources management and environmental engineering jamei and ghafouri 2016 helmig et al 2013 bastian 2014 numerical simulation of two phase flow through heterogeneous porous media is a category of highly non linear problems with a system of inherently convection dominated governing equations where their solutions need to preserve the local conservation property the interior penalty discontinuous galerkin dg methods have been extensively used to simulate the convection dominant problems due to having a locally conservative property capable of capturing sharp fonts precisely and handling unstructured grids in complex cases geometries and employing high order polynomial approximation rivière 2008 riviere 2011 recently the non conforming finite element methods have been implemented to solve the second order elliptic equations e g the stokes and maxwell equations pinto and sonnendrücker 2017 jones and zhang 2021 zhou et al 2021 these methods have a set of outstanding properties including the ability to handle the hinge nodes consistent with the h div vector space and neglecting the continuity constrain at the interface of two neighboring elements zhou et al 2021 crouzeix and raviart 1973 the simplest type of non conforming elements is the coruziex raviart cr element which was initially used to solve the stokes equations crouzeix and raviart 1973 in this type of elements the continuity constraint of pressure at the interface of two neighboring elements is neglected due to its stability properties this method has received more attention than the classic finite element method zhang 2013 borio et al borio et al 2019 presented a numerical method for simulating single phase flow and transport in fractured media kwak and kyeong rannacher and turek 1992 used the non conforming immersed finite element method with the cr triangular and rannacher turek quad elements to solve elliptic equations rannacher and turek 1992 kwak et al 2017 lamichhane et al 14 solved the linear elastic equations associated with linear elastic homogeneous isotropic materials by using a technique to stabilize the crouzeix raviart elements shi and yang zhou et al 2021 employed a crouzeix raviart type ncfem with anisotropic meshes to solve the non stationary navier stokes equations younes et al younes et al 2014 combined a crouzeix raviart discontinuous galerkin method with a multi point flux approximation mpfa to solve the governing equations associated with buoyancy driven flows jo and kwak jo and kwak 2017 proposed an implicit pressure explicit saturation impes approach for simulating two phase flow through heterogeneous porous media represented by a structured computational grid they employed a combined method consisting of non conforming finite element and finite volume methods the motivation of implementing the hybrid schemes for modeling the convection dominant two phase flow in porous media arises from the fact that not only they are capable of reducing the time and cost of computation but also they can improve the results by providing a better consistency between the pressure and velocity fields brezzi and fortin 2012 fabien et al fabien et al 2018 simulated the incompressible two phase flow through porous media by using a semi implicit approach and the hybridizable discontinuous galerkin method by solving several test cases they showed the accuracy and robustness of the proposed method they indicated that this higher order method can preserve the local and global conservation with a lower number of degrees of freedom when compared with the classical interior penalty discontinuous galerkin methods fabien et al 2018 a non linear iterative implicit pressure explicit saturation concentration impes method was proposed by el amin et al el amin et al 2017 to solve the governing equations associated with the two phase flow in porous media in the presence of nanoparticles by using a cell centered finite difference method the governing equations were discretized the convergence of the proposed approach was studied through designing and solving two numerical test problems by considering the courant friedrichs lewy cfl condition and using a relaxation factor to simulate slightly compressible single phase flow in porous media costa solé et al costa solé et al 2021 proposed a new formulation based on a stable high order hybridizable discontinuous galerkin method and a high order diagonal implicit runge kuta method the authors indicated that the proposed approach can be implemented based on the unstructured grids by considering the heterogeneity of reservoirs besides the global linear system of equations can be reduced by using a hybridization procedure in another work costa solé costa solé 2020 costa solé et al 2021 proposed a stable and accurate approach based on a high order hybridizable discontinuous galerkin method coupled with an implicit runge kutta scheme to simulate the single and two phase flow through porous media the stabilization parameter was analytically expressed by utilizing the engquist osher monotone flux scheme cai et al duan and xie 2020 proposed a fully mass conservative stable and efficient method in which the pressure and saturation equations were sequentially solved to simulate the multi phase flow through fractured reservoirs numerically the robustness and efficiency of the proposed method were examined by solving two numerical examples with both homogeneous and heterogeneous permeability fields the compressible inviscid euler equations were solved by using the discontinuous galerkin finite element method and the multi level domain decomposition approach suggested by duan and xie duan and xie 2020 to enhance the parallel efficiency of the method they applied the total variation diminishing runge kutta scheme coupled with the multi grid strategy the presented numerical results indicated that the proposed method was proper for large scale computational test cases costa solé et al costa solé et al 2020 presented a locally conservative and high order hybridizable discontinuous galerkin method to solve single and two phase flow problems in porous media in two and three dimensions combining the hybridizable discontinuous galerkin with a high order diagonally implicit runge kutta dirk temporal schemes a convergence rate of p 2 with p being the polynomial degree in l2 norm for the pressure and saturation were obtained joshaghani et al dong et al 2019 presented a fully implicit stable discontinuous galerkin to solve the governing equation associated with immiscible incompressible two phase flow in porous media by considering the effects of gravity capillary pressure and heterogeneity of the medium the numerical results showed that the proposed approach is accurate and locally conservative satisfying the maximum principle park and kim 2022 dong et al dong et al 2019 proposed an adaptive enriched galerkin method to simulate the fractured carbonate reservoirs numerically in this work fractures were represented by a local grid refinement technique numerical results indicated that the proposed approach has a less numerical dispersion and is less sensitive to the grid orientation when compared with the standard cell center finite volume difference approaches in the present study a new hybrid method based on the linear lower order ncfem and the interior penalty discontinuous galerkin dg method is proposed to simulate two phase incompressible isothermal flow in heterogeneous porous media the pressure equation is discretized by using the non conforming crouzeix raviart finite element method cr fem the transport saturation equation is solved by using the symmetric weighted interior penalty discontinuous galerkin method swipm as a result of determining the degrees of freedom at the midpoint of neighboring element edges a consistent set of pressure and velocity fields is obtained by using the ncfem here stabilization techniques are used to solve the flow equation in an appropriate finite element space the h div projection was adopted to obtain the continuous velocity field a novel vertex based slope limiter was developed to remove the non physical oscillations in the saturation equation the proposed numerical method can be utilized to simulate the immiscible contaminants in the groundwater and oil secondary recovery processes in the following sections the problem definition and the related governing equations are first presented and numerical methods are thoroughly described then two benchmark problems are solved to validate the proposed method and some heterogenous test problems are simulated through different numerical methods and their performance are compared finally some conclusions are drawn problem definition and governing equations the governing equations describing the two phase immiscible incompressible fluid flow in a rigid porous medium in isothermal conditions consist of the fluid mass and momentum conservation equations the mass continuity equation is represented as helmig 1997 1 ϕ s α t u α q α here φ is the porosity of the medium and s α with α w n stands for saturation of the phase α the term qα refers to the volume flow rate of the phase α per unit volume it is here assumed that the pore volume of the porous medium is completely saturated with the existing phases i e sw sn 1 depending on the flow condition in the porous medium the darcy law as an alternative to the momentum equation can be used it represents the velocity of each phase α w n as 2 u α k k r α μ α p α λ α p α where u α denotes the darcy velocity of the phase α and k is the absolute permeability tensor of the porous medium in addition the variables k rα μα λ α and p α represent the relative permeability viscosity relative mobility and pressure of the phase α respectively the mentioned governing equations can be represented in different formulations based on the wetting phase pressure and saturation i e pw and sw by using the technique described in jamei et al 2019 one can manipulate the governing equations to obtain a pressure equation for the wetting phase as klieber and rivière 2006 3 k λ t p w k λ n p c s w q w q n the capillary pressure between phases is defined as 4 p c s w p n p w then the mass continuity equation is represented in terms of wetting phase saturation 5 ϕ s w t k p c λ w λ n λ t s w q w f w u t where fw is the fractional flow function the relative permeability and capillary pressure between the phases are calculated by using the brooks corey properties et al 1964 and van genuchten models van genuchten 1980 based on the brooks corey model the relative permeability of each phase along with the capillary pressure between the wetting and non wetting phases are given as klieber and rivière 2006 6 k r w s e s e 2 3 ζ ζ 7 k r n s e 1 s e 2 1 s e 2 ζ ζ 0 2 ζ 4 8 p c s e p d s e 1 ζ here ζ is the distribution coefficients of the porous medium in the van genuchten model the relative permeability of existing phases is represented by van genuchten 1980 9 k r w s e s e ϵ 1 1 s e 1 m m 2 10 k r n s e 1 s e γ 1 s e 1 m 2 where m ε and γ are empirical constants which are selected here as ε 1 2 and γ 1 3 in addition se is the normalized effective saturation defined as 11 s e s w s r w 1 s r w s r n the mentioned governing equations 3 and 5 need proper boundary conditions to be solved in the respective domain since different problems are considered here the required boundary conditions of each test problem are described at the beginning of each problem description section 4 solution methodology prerequisites in numerical simulation in this section the prerequisites of the numerical simulation and the used symbols are described in detail fig 1 schematically shows the definition of different types of faces and their normal vectors the whole computational domain and its boundaries not shown herein are represented by ω and ω respectively a compatible regular triangular subdomain in the domain ω is labeled as t h t i n h in addition t is the cross section area of each element t t h and f is the size of each element face f f h the set of adjacent internal faces between the two neighboring elements f t t is represented by f h i and the set of boundary faces f t ω coincides with γ γ in γ out γ n is shown by f h b in addition nf is the normal vector on the face f directed from t to t the term v r p ν h l 2 ω t t h ν h t p r d f f h i f ν h 0 shows the discrete hilbert discrete subspace of the ncfem for solving the pressure equation and v r s ψ h l 2 ω t t h ψ h t p r d indicates the discrete hilbert discrete subspace of the finite element method for solving the saturation equation via discontinuous galerkin methods p r d is the set of degrees of approximation with the maximum order r n the parameter hf t f is the diameter of the face f which is equal to the ratio of the area of the element to the length of the face park et al 2010 chen 2008 also if the diameter of each element is called ht the grid size parameter h m a x h t t t h is used to show whether the element grid is fine or coarse the parameter h is the maximum ht diameter of the elements in the domain t h the diameter of each element ht refers to the diameter of the circle surrounded by the element the concepts of jump and average are introduced based on the value in a common point of two neighboring elements t t with the interface f by using the following equations jamei and ghafouri 2022 18 ψ ψ f ψ f ψ ψ f ψ f 2 f f h i if ψ is a vector function then the jump and average operators are given by 19 ψ ψ f n ψ f n n f ψ f ψ f 20 ψ ψ f ψ f 2 f f h i in the jump expression the normal vector nf is directed outward of the current element t the jump and average of the scalar and vector functions ψ on the external boundary faces f f h b are respectively di pietro and ern 2012 jamei and ghafouri 2016 21 ψ ψ f ψ ψ f f f h b 22 ψ n f ψ f ψ ψ f f f h b in the present study rp 1 rs 1 and rt 0 are the approximation degrees of the pressure saturation and darcy equations respectively in addition the test functions of pressure and saturation equations are defined as ν z v r p t h v r s t h the sequential implicit non correlated non repetitive method is here used to solve the governing equations the non linear parameters of mobility and capillary pressure derivatives coefficients λ w n λ n n and p c n based on the saturation values at the previous time step are calculated and the pressure field p w n 1 is calculated at the new time level t n 1 due to the use of the first order implicit euler method in the temporal discretization of equations the stability of the method is always guaranteed and there is low sensitivity to the size of time steps as shown fig 2 the respective numerical algorithm consists of some main steps such as receiving the initial and boundary conditions allocating the physical properties generating computational grids solving the pressure and saturation equations applying slop limiters and determining the finishing criteria the most critical steps of the algorithm are thoroughly described in the following sections discretization of pressure equation discretization of the pressure equation is performed by using the non conforming discontinuous finite element method recently many improvements have been made in non conforming elements resulting in appropriate compatibility with some of the local conservative methods such as discontinuous galerkin unlike the lagrangian elements where degrees of freedom are defined on the vertices of the elements degrees of freedom are placed on the faces of these elements as mentioned in the introduction the most well known type of the triangular elements in the non conforming finite element method is the non conforming p1 or the crouziex raviart element denoted by v r p ν h fig 3 shows the crouziex raviart elements with the location of their degrees of freedom crouziex and thomas crouzeix and raviart 1973 first proposed this element and since then it has been applied widely to physics problems especially in solving the stokes equation zhou et al 2021 in these elements the constraint of continuity is generally neglected in the length of the faces of the element except at the element center this method is more widely used compared to classical finite element methods due to its better stability younes et al 2014 in fig 3 the number of common faces between elements in non conforming finite element subspace of the pressure equation v r p and the number of boundary elements is denoted by n e i f h i and n e b f h b respectively consequently ne nei neb shows all faces in t h ω for all elements t t h the local space of finite element v r p related to the pressure equation is defined as di pietro and ern 2012 23 v r p s p a n 1 x y t c r degrees of freedom on the faces of the non conforming element is generally noted in two ways in the first one the value of the function at the center of each face ν h mi corresponds to the degree of freedom in this way a test function and its derivatives are used according to the following equations 24 ν i 1 2 ϕ i ϕ i a i a 1 x 2 y 2 1 x 3 y 3 1 x y 1 x 1 y 1 1 x 2 y 2 1 x 3 y 3 ϕ i 0 25 ν 1 1 2 ϕ 1 ν 2 1 2 ϕ 2 ν 3 ϕ 1 ϕ 2 1 26 ν i f t n f t t h f f h 27 1 f e i ν j δ ij i j 1 2 3 ν j v r p t h in a second way the value of the degree of freedom is averaged by integration on each face 1 f e ν h d s in which f is the size of the face it should be noted that in the linear approximation using the low order elements cruzeix raviart p1 the values of the pressure function at the center of the face of the element ν h mi are equal to the average pressure integration on that face 1 e e p w d s note that this point is true for the quadrilateral rotational elements rivière 2008 in the wetting phase pressure equation the value of the quasi transport term k λ n p c s w is given and the diffusion term has to be continuous kλ t pw therefore the continuity of pressure and flux due to the pressure gradient has to be weakly maintained by the following equations arbogast et al 2013 28 p w f 0 p w p w on γ ω k λ t p w f 0 k λ t p w k λ t p w on γ ω 29 1 e e p w t 1 d s 1 e e p w t 2 d s in the present study a weighted average operator instead of the general jump and average operators is used in the spatial discretization in order to improve capturing sudden shocks caused by heterogeneity and hyperbolic property of the governing equations for each scalar function ψ defined smoothly on the common face f f h i of two neighboring elements the weighted average on face f is expressed as park et al 2010 chen 2008 30 ψ w w f ψ f w f ψ f where w f w f 1 w f 0 and it is also true for vector functions in heterogeneous media the weighted average operator for each element t f can simply be obtained as a function of the intrinsic permeability tensor 31 w f k t f k t f k t f w f k t f k t f k t f f t t where k t f n f t k n f is the normal component of the intrinsic permeability consequently when homogeneous media are investigated the weighted average operator is converted to the standard form w f w f 0 5 35 ψ ψ f ψ f 2 f f h i 32 ψ ψ f f f h b if ν v r p t h is a test function which is an interpolation function in non conforming discontinuous finite element space and dirichlet boundary conditions are applied by using a weak penalty allocation method the final spatial discretization of the pressure equation is given by 33 a p w v l v v v r p t h 34 a p w v t ϵ t h t k λ t s w n p w n 1 ν d t t f γ h γ d f k λ t s w n p w n 1 n f w ν d s f γ h γ d f k λ t s w n ν n f w p w n 1 d s f γ h γ d σ f γ f p f m e a n t t f ν p w n 1 d s 35 l v t ϵ t h t k λ n p c s w ν d t f γ h γ d f k λ n p c s w n f ν d s f γ d f k λ t s w n ν n f p d i r d s f γ d σ f γ f p f m e a n t t f ν p d i r d s t ϵ t h t q w n 1 q n n 1 ν d t 36 γ f 2 d f d f d f d f γ f 2 m i n d f d f f f h i γ f d f f f h b where γ f is the harmonic average of diffusion coefficients used to decrease the sensitivity of the model to the chosen penalty parameter the sensitivity reduction especially in heterogeneous cases is achieved by applying a weak form of the dirichlet boundary conditions and the stabilization of local discretization of pressure equation this coefficient for the pressure equation is shown by dfp kλ t in each face in order to increase the stability of discretization of the quasi transport term k λ n p c s w in boundary edges between elements the upwind form of this term is used for internal faces f f h i klieber and rivière 2006 f t t 37 k λ n p c s w k λ n p c s w u t n f 0 k λ n p c s w u t n f 0 discretization of saturation equation the swipm has been used to discretize the saturation equation which benefits a weighted average operator to enhance the stability of spatial discretization el amin et al 2017 it should be noted that for the penalty value σ f 0 the internal penalty method is known as the oden babuška baumann obb method rivière 2008 fig 4 shows how to discretize a classic finite element grid into a grid of discontinuous finite elements discontinuous galerkin which is regarded as the first step in the numerical algorithm fig 2 if z v r s t h is a discontinuous interpolation function test function of the saturation equation the saturation equation is represented by the dg method as the following bilinear form jamei and ghafouri 2016 rivière 2008 38 s w t z a s w z l z z v r s t h 39 s w x 0 s w i n i t i a l x x x x y where the time derivative term is of the first order euler method 40 s w t s w n 1 s w n t 41 t t h ϕ s w n 1 δ t zdt t t h e k p c λ w λ n λ w λ n s w n s w n 1 zdt f γ r f s w n 1 u t n 1 n f zds f γ h f γ z s w n 1 ds f γ h f z k p c λ w λ n λ w λ n s w n s w n 1 n f w ds t t h ϕ s w n δ t zds n h t t h u t n 1 f w n zds f γ h γ r γ f u t n 1 f w n n f zds f γ r f s in u t n 1 n f zds t t h e q w n 1 zdt f f h i γ f s 2 d f s d f s d f s d f s γ b 1 2 u t n f f f h b γ f s d f s 42 f f h i γ σ f γ f s f m e a n t t γ b in order to increase the discretization stability of the transport term fwut on the boundary faces between the elements the upwind form of this expression is used for the internal faces f f h i klieber and rivière 2006 43 f t t f w f w f w u t n f 0 f w u t n f 0 where γf is the harmonic average of the diffusion coefficients in the saturation equation d f s p c λ w λ n λ t which is utilized to reduce the sensitivity of the penalty value assigned to the transport equation reconstruction of the velocity field in low order space rt0 in the simulation of the fluid flow through porous media it is vital to determine the continuous velocity field to ensure the local conservation and the continuity of the normal flux vector over the computational domain however the problem solving strategies of correlated equations through the sequential methods and the methods without local conservation property always reduce the accuracy of the velocity field this can lead to non physical oscillations in the computed saturation fields one of the methods of retrieving the velocity field u t v is the projection and reconstruction of the this field in the vector spaces h div such as raviart thomas space rt boffi et al 2013 the low order raviart thomas and h div spaces with exceptional properties are respectively defined as di pietro and ern 2012 boffi et al 2013 44 v u t h div ω u t k r t 0 k t h r t 0 k u t u 1 u 2 u t 1 a b x u t 2 c b y a b c d r h div ω ψ l 2 ω 2 ψ l 2 ω ψ n f γ n 0 in the projection method in vector space h div the new velocity field can be processed in the low order raviart thomas space by a set of approximate values of the linear pressure field p w n 1 v r p t h and the wetting phase saturation s w n v r s t h according to fig 3 right side related to the raviart thomas space of order rt 0 the degree of freedom of the flux passing through each face is a constant value q t n 1 u t n 1 n f and q t r t 0 t h on each side can be obtained by which can be expanded as jamei et al 2019 45 q t n 1 1 f d 1 u t n 1 n f 1 t 46 q t n 1 f k λ t p w n 1 w n f k λ n p c s w n n f σ f γ f p f m e a n t t p w n 1 d s 47 p w n 1 p w n 1 f f h i p w n 1 p dir f f h b on γ d 49 δ t n 1 0 o n γ n by using the linear combination of degrees of freedom and the vector interpolation functions for placement at the gaussian points of the saturation equation the approximated velocity field with a continuous normal component on the shared faces between the elements f f h is given by jamei and ghafouri 2022 49 u t n 1 i 1 3 q t i n 1 ψ f i the vector interpolation function in the raviart thomas space of low order rt 0 is defined as fig 3 right side 50 ψ f f 2 t x x p where xp is the coordinate of the opposite vertex to node p the function ψ f must satisfy the property ψ f f n f δ f f in which f 1 2 3 n f and δ f f are the normal vector of the face f and the kronecker delta respectively to project the vector of the interpolation functions and their derivatives in the raviart thomas space the piola transform theory can be used in which the properties of the reference element t are transferred to the physical element t the methodology of piola transform is explained in appendix a elimination of non physical oscillations of saturation in the related literature there exist a number of multi dimensional slope limiter approaches for the unstructured grid e g the modified durlofsky osher engquist durlofsky et al 1992 generalized cockburn cockburn and shu 2001 and shu slope limiter shu 1987 which can be used to eliminate the non physical oscillations in the solution of the saturation equation these slope limiters are inherently edge based approaches since our dofs in the saturation equation are defined on the vertices of elements the use of an edge based slope limiter can lead to some local extrema jamei and ghafouri 2016 therefore a modified chavent jaffre slope limiter based on the dof places is here used to remove the non physical oscillations in the saturation field this slope limiter can also help to enhance the stability of the model concerning the kind of boundary conditions despite being more computationally expensive than other limiters this slope limiter has high accuracy in eliminating non physical oscillations this slope limiter is based on the maximum principle park and kim 2022 at the vertices of the element minimizing the difference between saturation values before s w i and after s w i the limiting process for this purpose a set of constraints is used to preserve the local conservation of the element and prevent the formation of local extrema hoteit et al 2004 fig 5 in each element t t h the set of elements surrounding each node i is represented by the symbol t h t t h i t here n t is the number of vertices of each element and m i j is the center of the face ij the slope limiting operator is defined as l s w s w in each element t before the constraint process the maximum s w m a x i the minimum s w m i n i and the average s w a v e of the elements surrounding node i in the set t t are defined as hoteit et al 2004 hoteit and firoozabadi 2008 51 s w a v e 1 t t s w i 1 n t i 1 n t s w i 52 s w m i n i m i n s w a v e t h 53 s w m a x i m a x s w a v e t h 54 o b j e c t f u n c t i o n min i 1 n t 1 2 s w i s w i 2 i 1 n t the local conservation in eq 55 is maintained by equating the average of the saturation computed on each element s w a v e with the average of this value after the constraint of s w a v e jamei and ghafouri 2016 55 s w a v e 1 n t i 1 n t s w i s w a v e s w a v e t t h as the heading of the local extremum elimination constraint the maximum s w m a x i and the average minimum s w m i n i of all the surrounding elements are controlled park et al 2010 56 s w m i n i s w i s w m a x i i 1 n t in the third constraint the average value on each face s w a v e m must be limited between the average value of the current element and its neighboring element s w a v e t 0 s w a v e to prevent a possible local extremum on the faces 57 min s w a v e s w a v e t 0 s w a v e m max s w a v e s w a v e t 0 numerical results and discussion in this section the proposed numerical method is first validated by comparing its results with the available analytic and semi analytic solutions associated with two benchmark problems including the buckley leverett bl and mcwhorter and sunada ms problems then the numerical results of two test problems with heterogeneous permeability fields are presented the physical properties of the fluid and the porous medium associated with all considered test problems are summarized in table 1 note that the variation range of the porosity and permeability fields is given for two heterogeneous test problems i and ii for all considered cases the capillary pressure is assessed and evaluated by using the van genuchten or brooks corey models morel seytoux et al 1996 r h b and corey 1964 in the following section the proposed numerical model is validated by presenting the solution of two benchmark problems validation of the proposed method buckley leverett benchmark problem in this section the buckley leverett bl benchmark problem is presented and solved to assess the accuracy and performance of the proposed numerical model in its basic form the bl problem represents an imbibition process where the non wetting phase is replaced by the wetting phase in a 1 d domain here the incompressible two phase fluid flow is numerically simulated for a 2 d global domain which is a rigid homogeneous porous medium with a uniform porosity value of φ 0 2 the boundary conditions of this 2 d problem are chosen in such a way that it is automatically reduced to our desired 1 d problem i e the bl problem while the upper and lower boundaries of the domain are impermeable two different pressure values pl and pr are imposed on the left and right boundaries of the domain fig 6 a for the numerical results these pressure values are constant and chosen in such a way that water enters the domain from the left for reporting purposes a dimensionless pressure is defined as p p pr pl pr in which pl and pr are the pressure values imposed on the left and right boundaries of the global domain respectively by neglecting the effects of capillary pressure and rock fluid compressibility the transport equation is rewritten as jamei et al 2019 59 ϕ s w t u t d f w d s w s w q w this hyperbolic equation is the buckley leverett bl water flooding problem the bl problem is solved in a one dimensional domain of horizontal length l as schematically shown in fig 6a the domain is initially saturated with fluids in such a way that the saturations of the wetting and non wetting phases are sw 0 75 and sn 0 25 respectively then the wetting phase is injected into the domain from the left under injection pressure of pl 1 0 and the existing phases are produced from the right at the constant pressure of pr 0 0 the numerical results are presented based on the pore volume injected pvi time defined as lee et al 2009 60 pvi μ l 2 ϕ 1 s r w s r n k p l p r where k and φ are the permeability and porosity of the porous medium and s rα stands for the residual saturation of the phase α respectively in the present study the obb dg with σf 100 is used to solve the bl problem and the obtained results are compared with those of a conservative form of the basic finite element fe method and also hybrid non conforming discontinuous galerkin finite element method h l 32 based on two approaches the free mesh method samimi and pak 2014 and the fully sequential dg scheme dg dg jamei and ghafouri 2016 in order to investigate the dependency of the results to the computational grid and the convergence factor assessment of the model different element divisions including l 32 l 64 and l 128 are employed as the analytic solution is not available in the case of fully coupled pressure saturation equations the numeral results associated with a very fine grid are considered as the reference solution and it is used to compute the error associated with each main variable h pw sw denoted by eh and defined as e h max n h n h h n rui and zhang 2017 besides the convergence rates associated with the pressure and saturation equation in the employed numerical method are labeled as c p w and c s w respectively by assuming error constant h rate each convergence rate ch with h pw sw is calculated as ch log e h1 e h2 log h 1 h 2 where eh1 and eh2 are the errors associated with the element size of h 1 and h 2 respectively rivière 2008 rui and zhang 2017 both pressure and saturation errors along with the convergence rate of different methods are calculated and presented in table 2 according to the results reported in table 2 the hybrid non conforming discontinuous galerkin cr dg method despite lower degrees of freedom in solving the pressure problem has a convergence rate close to the dg dg scheme with the same computational grid size besides it can be concluded that the non conforming finite element method is consistent with the reconstructed velocity field the variations of norm of error versus the element size in the logarithmic scale are shown in fig 7 c and 7d these results indicate that the proposed approach produces acceptable pressure and saturation distributions with convergence rates of 1 043 and 0 992 respectively mcwhorter and sunada benchmark problem as the second benchmark problem a diffusion dominant problem is considered to validate two phase flow numerical methods the mcwhorter and sunada ms benchmark problem mcwhorter and sunada 1990 represents an imbibition process associated with a bidirectional displacement in an infinite column with a no flux boundary at the end of the column the ms equation is a non linear hyperbolic equation obtained based on the assumption that the convective term can be neglected in comparison to the capillary term in the transport equation the ms equation is given by mcwhorter and sunada 1990 61 ϕ s w t x λ w λ n λ t p c k s w x 0 i n ω the medium is initially saturated with the existing phases in such a way that sw 0 1 as the boundary condition the pressure of the wetting phase at the inlet is always kept at pl 2 105pa the capillary and relative permeability values for this imbibition process are predicated based on the brooks corey model with the data presented in table 1 after a grid dependency study a uniform computational grid consisting of δx l 32 elements size and the time step of size δt 20 s are finally used to produce the numerical results the numerical results of different methods including the proposed hybrid approach and opengeosys an open source scientific platform for developing the numerical simulation of thermo hydro mechanical chemical processes through porous media kolditz et al 2012 are compared in fig 8 a besides fig 8b demonstrates the variation of the 2 norm error of saturation e s w versus the different element sizes i e δ x l 32 l 64 l 128 l 256 and l 512 in logarithmic scale in this problem the calculated convergence rate of the numerical method is 1 435 although a good agreement between these results is observed a difference exists between the semi analytic ms solution and the presented numerical results it should be mentioned that more accurate numerical results can be achieved by using another formulation based on the pressure of the non wetting phase and capillary pressure instead of saturation and pressure of the wetting phase as the main unknown variables amaziane 2008 the results of two benchmark problems i e the bl and ms problems indicated that the proposed numerical method can simulate the two phase flow in a porous medium with an acceptable accuracy in the following the performance of the proposed approach is investigated by solving two heterogeneous problems in two dimensions named test problems i and ii test problem i as the first case test problem i the imbibition process through a porous medium with a two scale heterogeneous permeability field is simulated the computational domain is considered as a simple rectangle of size 100 50 m with a number of circular obstacles of radius r 5m as shown in fig 9 the centers of these obstacles are located at the points 20 25 40 12 5 60 park and kim 2022 80 12 5 the absolute permeability and porosity of the obstacles are considered as 10 14 m2 and 0 2 respectively the wetting phase is injected into the domain from the left side of the rectangle under a dimensionless pressure of p 1 and the existing fluids leave the domain from the right side at a constant pressure of p 0 it is assumed that the saturation of the wetting phase is sw 0 25 at the beginning of the process the physical properties of the fluid phases and the porous medium are presented in table 1 this test problem is numerically solved by using different numerical methods including the cr dg dg dg and the basic conservative fe methods after performing a grid dependency study a computational grid consisting of the total number of 1777 triangular elements with 3402 nodes is constructed in the computational domain which is used to report the results of the cr dg method here the numerical results of the cr dg method are obtained based on the penalty factor of σf 100 and a constant time step of size δt 846 s the pressure and saturation equations are discretized by using a set of second order elements for the fe method a computational grid with 9701 triangular elements and 4996 vertices is utilized to obtain the grid independent results the wetting phase pressure and saturation contour plots at different times are shown in figs 10 and 11 respectively it can be observed that the proposed hybrid approach produces rational results without non physical peaks comparing the pressure distributions of different times one can easily keep that the pressure field changes versus time since the non linear permeability curves are used and the physical properties of the displacing phase e g viscosity differ from those of the displaced phase to quantitatively compare the results of the cr dg and dg dg methods the variations of pressure and saturation along the symmetry line i e y 25 m are presented in fig 12 for two different times i e t 5 day and t 10 day these results indicate that both cr dg and dg dg methods predict nearly the same solution for the considered times this means that the proposed numerical approach i e the cr dg method can precisely capture the sharp front of the injected phases by using a less dof when compared with the dg dg method compared with the fe method for this case one can observe that the results of the basic fe slightly differ from those of the cr dg and dg dg methods a computational grid with a larger number of elements is used for the fe method in addition both pressure and transport saturation equations are discretized by using the second order elements based on these facts it can be concluded that the cr dg is a more flexible method when compared with the considered methods this is mainly due to the logic of the placement of the dofs in solving non hyperbolic equations in the cr dg method by using a coarse computational grid with a less dof this approach can help to reach the results with an acceptable accuracy at less computational costs according to fig 12 the dg based models i e cr dg and dg dg is able to more efficiently capture the physical discontinuities than the fe model test problem ii the water injection into a highly heterogeneous oil reservoir is numerically simulated in two dimensions as the test problem ii it is assumed that water and oil are the wetting and non wetting phases respectively the computational grid representing the heterogeneous permeability and porosity fields and the imposed boundary conditions are shown in figs 13 a and 13b to recover the reservoir water is injected from the top of the global domain under the pressure of p 1 3 106 pa for a duration time of 50 days and the existing fluids leave the domain from the bottom at a constant pressure of p 6 0 105 the global domain is initially saturated with sw 0 10 and sn 0 90 the physical properties of the porous medium and the fluid phases are given in table 1 to simulate this test problem a computational grid consisting of 2640 elements with 1319 nodes the swipm with the penalty value of σ 100 and the time step of δt 1 60 day are used the contour plots of dimensionless pressure and saturation at times of 12 5 25 37 5 and 50 days are shown in figs 14 and 15 the dimensionless pressure is here defined as p pw p 0 with p 0 106 pa these results show the effects of heterogeneous structure of the medium on the pressure and saturation distributions in the reservoir from the saturation contour plots figs 15 it can be inferred that the phenomenon of fingering due to the high heterogeneity of the porous medium is well captured by the proposed method regarding to its beneficial properties these are the local conservation property the stabilization methods utilized in the spatial discretization of the governing equations and the non conforming elements used to solve the pressure equation in order to quantitatively investigate the performance of the cr dg method in comparison to the other methods i e the dg dg and fe methods the variations of the wetting phase saturation along two selected lines are presented in figs 16 a and 16b for the times t 12 5 25 37 5 50 days the first one says line 1 is a vertical line passing through the points at the positions 50 m 1 m and 50 m 135 m and the second line i e line 2 is horizontal one passing through the point 1 m 80 m and 1 m 80 m it should be mentioned that these results are obtained by using the same computational grid shown in fig 13a these plots indicate that the cr dg and dg dg methods produce almost the same results while the fe method predicts the relatively different saturation variations along the selected lines for different times figs 16a and 16b as is quite clear the cr dg and dg dg schemes are more efficient in capturing heterogeneities and discontinuities than the fe method which results in more reliable and logical solutions careful study shows that the fingering phenomenon in the cross section obtained by the first two models has a much better resolution than that of the fe scheme based on these results one can say that the proposed method can properly capture the effects of the heterogeneous structure of the absolute permeability porosity of the domain on the obtained saturation distributions compared with the dg dg method the cr dg produces the same results at a lower computational cost which is one of the main advantages of the suggested method conclusion a sequentially hybrid non conforming finite element method ncfem with symmetric weighted interior penalty discontinuous galerkin swipm was developed to simulate the two phase fluid flow through the heterogeneous porous medium in this regard the pressure equation was discretized by using the non conforming crouzeix raviart cr elements as a dominant convection equation the saturation equation was solved by using the swipm here the velocity field was computed at the midpoint of each element edge by using h div projection and the lowest order raviart thomas space to preserve the local conservation between two neighboring elements finally a novel slope limiter modified chavent jaffre slope limiter was designed to remove the non physical oscillations due to the heterogeneous structure of the porous medium the accuracy of the provided model was examined by comparing its results with the available semi analytic and numerical solutions of different tests cases in one and two dimensions besides two imbibition processes in the heterogeneous porous medium were simulated and discussed based on the obtained numerical results of the proposed method it can be concluded that a more accurate velocity field is obtained whenever the proposed hybrid approach solves the coupled pressure and saturation equations based on the bl problem results this prevents non physical variations of saturation values in regions adjacent to discontinuity and the heterogeneity of the porous medium by using non conforming elements and placing the degree of freedom on the edges of the elements in the pressure equation solution one can remove the continuity constraints at the vertices this helps to use unhanged nodes with different approximation degrees compared to the fully coupled discontinuous galerkin method for two phase flow in porous media the proposed hybrid scheme reduces the total computational costs of the simulation process it is beneficial to use spatial discretization schemes to improve the shocks observed in the heterogeneous regions applying a weighted average operator reduces the sensitivity of the choice of penalty values especially at the heterogeneity and discontinuities of the porous medium the results of the considered test problems showed that the proposed method with a minor degree of freedom in comparison with dg dg model results in an acceptable accuracy versus the semi analytical and analytical solutions the results of the test problem ii exhibited that the novel provided numerical scheme can properly capture shock waves and accurately model the water fingering phenomena in a highly heterogeneous porous media credit author statement mehdi jamei conceptualization code developer visualization writing review editing formal analysis and project leader mehdi mosharaf dehkordi investigation visualization software writing original draft formal analysis and writing review editing hamid reza ghafouri supervision and review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper funding no funding ethics approval not applicable appendix a piola transform methodology in the piola transform similar to the projection of the lagrange scalar functions all computational processes are performed based on the reference element in such a way that the piola transform function f p performs the projection from the t to t element fig a1 to express the functions and derivatives of the reference element in the vector space the components of surface coordinates φ i 1 3 are used zienkiewicz and taylor 2005 b1 f p x x 1 x 2 x 1 ϕ 2 x 3 x 1 ϕ 3 y y 1 y 2 y 1 ϕ 2 y 3 y 1 ϕ 3 b2 f p r 2 r 2 f p x b x b b x 1 y 1 b3 b t j t x 2 x 1 x 3 x 1 y 2 y 1 y 3 y 1 j t d e t j t here x x y i 1 3 are coordinates of the physical element and jt is the determinants of the jacobi matrix the piola transform theory for the q t vector interpolation function in the reference element is represented as ervin 2022 untersuchung and fakult 2022 b4 q q x p q x 1 j t j t q x for interpolation functions of the normal component on the faces of the q f element the following equation is established b5 q q x p q x 1 j t l f l f j t q x where lf and l f are the length of the physical and the reference elements respectively figure a1 illustrates the mapping of the reference element to a physical one 
175,accurate two phase flow modeling has a crucial role in detecting pollution in aquifers and or in the simulating immiscible flow through porous media in this research a new hybrid numerical method based on the lower order non conforming finite element method ncfem and interior penalty discontinuous galerkin dg method is proposed to simulate two phase incompressible flow in heterogeneous porous media the pressure and transport saturation equations are discretized by using the non conforming crouzeix raviart cr finite element and the symmetric weighed interior penalty discontinuous galerkin swipm as a result of determining the degrees of freedom at the midpoint of neighboring element edges a consistent set of pressure and velocity fields is obtained via the ncfem an h div projection based on the raviart thomas rt element is implemented to improve the results resolution and preserve the continuity of the normal component of the velocity field besides the spurious numerical oscillations of the saturation solution at the end of each time step are removed by using a novel vertex based slope limiter named the modified chavent jaffre limiter the accuracy and performance of the proposed numerical method are assessed by solving the buckley leverett and mcwhorter sunada benchmark problems along with two test problems associated with highly heterogeneous porous media the numerical results indicate that the proposed scheme has a remarkable potential to accurately capture the shock front and sharp interface zone of immiscible phases in the heterogeneous aquifers and other porous media keywords non conforming finite element method two phase flow crouziex raviart element modified chavent jaffre slope limiter discontinuous galerkin method nomenclatures symbol variable definition description f size of each of the faces of the element f f h f h i a set of internal faces shared between two neighboring elements f t t f h b a set of boundary faces f t ω conforming with the boundary γ γ in γ out γ n f h f h i f h b a set of all the faces f α fractional flow function of the phase α w n k absolute permeability of the porous medium k rα relative permeability of the phase α w n nf normal vector on the face f directed from t to t pd entry pressure pa s α saturation of the phase α w n t h t i n h a compatible regular triangular subdomain in the ω domain consisting of nh the number of t elements in the two dimensional space of a triangular element t cross section of each of the triangular elements t t h u α velocity of the phase α w n s rα residual saturation of the phase α w n se normalized effective saturation ν test function greek ω computational domain ω external boundaries of the domain φ porosity μ dynamic viscosity pa s γ f harmonic average of diffusion coefficients abbreviations bl buckley leverett cr coruziex raviart dg discontinuous galerkin fem finite element method impes implicit pressure explicit saturation ms mcwhorter and sunada ncfem non conforming finite element rt raviart thomas swipm symmetric weighed interior penalty discontinuous galerkin swipm introduction nowadays mathematical models are known as the most powerful tool to investigate the behavior of multiphase flow through heterogeneous porous media for different applications such as the petroleum industry reservoir engineering groundwater resources management and environmental engineering jamei and ghafouri 2016 helmig et al 2013 bastian 2014 numerical simulation of two phase flow through heterogeneous porous media is a category of highly non linear problems with a system of inherently convection dominated governing equations where their solutions need to preserve the local conservation property the interior penalty discontinuous galerkin dg methods have been extensively used to simulate the convection dominant problems due to having a locally conservative property capable of capturing sharp fonts precisely and handling unstructured grids in complex cases geometries and employing high order polynomial approximation rivière 2008 riviere 2011 recently the non conforming finite element methods have been implemented to solve the second order elliptic equations e g the stokes and maxwell equations pinto and sonnendrücker 2017 jones and zhang 2021 zhou et al 2021 these methods have a set of outstanding properties including the ability to handle the hinge nodes consistent with the h div vector space and neglecting the continuity constrain at the interface of two neighboring elements zhou et al 2021 crouzeix and raviart 1973 the simplest type of non conforming elements is the coruziex raviart cr element which was initially used to solve the stokes equations crouzeix and raviart 1973 in this type of elements the continuity constraint of pressure at the interface of two neighboring elements is neglected due to its stability properties this method has received more attention than the classic finite element method zhang 2013 borio et al borio et al 2019 presented a numerical method for simulating single phase flow and transport in fractured media kwak and kyeong rannacher and turek 1992 used the non conforming immersed finite element method with the cr triangular and rannacher turek quad elements to solve elliptic equations rannacher and turek 1992 kwak et al 2017 lamichhane et al 14 solved the linear elastic equations associated with linear elastic homogeneous isotropic materials by using a technique to stabilize the crouzeix raviart elements shi and yang zhou et al 2021 employed a crouzeix raviart type ncfem with anisotropic meshes to solve the non stationary navier stokes equations younes et al younes et al 2014 combined a crouzeix raviart discontinuous galerkin method with a multi point flux approximation mpfa to solve the governing equations associated with buoyancy driven flows jo and kwak jo and kwak 2017 proposed an implicit pressure explicit saturation impes approach for simulating two phase flow through heterogeneous porous media represented by a structured computational grid they employed a combined method consisting of non conforming finite element and finite volume methods the motivation of implementing the hybrid schemes for modeling the convection dominant two phase flow in porous media arises from the fact that not only they are capable of reducing the time and cost of computation but also they can improve the results by providing a better consistency between the pressure and velocity fields brezzi and fortin 2012 fabien et al fabien et al 2018 simulated the incompressible two phase flow through porous media by using a semi implicit approach and the hybridizable discontinuous galerkin method by solving several test cases they showed the accuracy and robustness of the proposed method they indicated that this higher order method can preserve the local and global conservation with a lower number of degrees of freedom when compared with the classical interior penalty discontinuous galerkin methods fabien et al 2018 a non linear iterative implicit pressure explicit saturation concentration impes method was proposed by el amin et al el amin et al 2017 to solve the governing equations associated with the two phase flow in porous media in the presence of nanoparticles by using a cell centered finite difference method the governing equations were discretized the convergence of the proposed approach was studied through designing and solving two numerical test problems by considering the courant friedrichs lewy cfl condition and using a relaxation factor to simulate slightly compressible single phase flow in porous media costa solé et al costa solé et al 2021 proposed a new formulation based on a stable high order hybridizable discontinuous galerkin method and a high order diagonal implicit runge kuta method the authors indicated that the proposed approach can be implemented based on the unstructured grids by considering the heterogeneity of reservoirs besides the global linear system of equations can be reduced by using a hybridization procedure in another work costa solé costa solé 2020 costa solé et al 2021 proposed a stable and accurate approach based on a high order hybridizable discontinuous galerkin method coupled with an implicit runge kutta scheme to simulate the single and two phase flow through porous media the stabilization parameter was analytically expressed by utilizing the engquist osher monotone flux scheme cai et al duan and xie 2020 proposed a fully mass conservative stable and efficient method in which the pressure and saturation equations were sequentially solved to simulate the multi phase flow through fractured reservoirs numerically the robustness and efficiency of the proposed method were examined by solving two numerical examples with both homogeneous and heterogeneous permeability fields the compressible inviscid euler equations were solved by using the discontinuous galerkin finite element method and the multi level domain decomposition approach suggested by duan and xie duan and xie 2020 to enhance the parallel efficiency of the method they applied the total variation diminishing runge kutta scheme coupled with the multi grid strategy the presented numerical results indicated that the proposed method was proper for large scale computational test cases costa solé et al costa solé et al 2020 presented a locally conservative and high order hybridizable discontinuous galerkin method to solve single and two phase flow problems in porous media in two and three dimensions combining the hybridizable discontinuous galerkin with a high order diagonally implicit runge kutta dirk temporal schemes a convergence rate of p 2 with p being the polynomial degree in l2 norm for the pressure and saturation were obtained joshaghani et al dong et al 2019 presented a fully implicit stable discontinuous galerkin to solve the governing equation associated with immiscible incompressible two phase flow in porous media by considering the effects of gravity capillary pressure and heterogeneity of the medium the numerical results showed that the proposed approach is accurate and locally conservative satisfying the maximum principle park and kim 2022 dong et al dong et al 2019 proposed an adaptive enriched galerkin method to simulate the fractured carbonate reservoirs numerically in this work fractures were represented by a local grid refinement technique numerical results indicated that the proposed approach has a less numerical dispersion and is less sensitive to the grid orientation when compared with the standard cell center finite volume difference approaches in the present study a new hybrid method based on the linear lower order ncfem and the interior penalty discontinuous galerkin dg method is proposed to simulate two phase incompressible isothermal flow in heterogeneous porous media the pressure equation is discretized by using the non conforming crouzeix raviart finite element method cr fem the transport saturation equation is solved by using the symmetric weighted interior penalty discontinuous galerkin method swipm as a result of determining the degrees of freedom at the midpoint of neighboring element edges a consistent set of pressure and velocity fields is obtained by using the ncfem here stabilization techniques are used to solve the flow equation in an appropriate finite element space the h div projection was adopted to obtain the continuous velocity field a novel vertex based slope limiter was developed to remove the non physical oscillations in the saturation equation the proposed numerical method can be utilized to simulate the immiscible contaminants in the groundwater and oil secondary recovery processes in the following sections the problem definition and the related governing equations are first presented and numerical methods are thoroughly described then two benchmark problems are solved to validate the proposed method and some heterogenous test problems are simulated through different numerical methods and their performance are compared finally some conclusions are drawn problem definition and governing equations the governing equations describing the two phase immiscible incompressible fluid flow in a rigid porous medium in isothermal conditions consist of the fluid mass and momentum conservation equations the mass continuity equation is represented as helmig 1997 1 ϕ s α t u α q α here φ is the porosity of the medium and s α with α w n stands for saturation of the phase α the term qα refers to the volume flow rate of the phase α per unit volume it is here assumed that the pore volume of the porous medium is completely saturated with the existing phases i e sw sn 1 depending on the flow condition in the porous medium the darcy law as an alternative to the momentum equation can be used it represents the velocity of each phase α w n as 2 u α k k r α μ α p α λ α p α where u α denotes the darcy velocity of the phase α and k is the absolute permeability tensor of the porous medium in addition the variables k rα μα λ α and p α represent the relative permeability viscosity relative mobility and pressure of the phase α respectively the mentioned governing equations can be represented in different formulations based on the wetting phase pressure and saturation i e pw and sw by using the technique described in jamei et al 2019 one can manipulate the governing equations to obtain a pressure equation for the wetting phase as klieber and rivière 2006 3 k λ t p w k λ n p c s w q w q n the capillary pressure between phases is defined as 4 p c s w p n p w then the mass continuity equation is represented in terms of wetting phase saturation 5 ϕ s w t k p c λ w λ n λ t s w q w f w u t where fw is the fractional flow function the relative permeability and capillary pressure between the phases are calculated by using the brooks corey properties et al 1964 and van genuchten models van genuchten 1980 based on the brooks corey model the relative permeability of each phase along with the capillary pressure between the wetting and non wetting phases are given as klieber and rivière 2006 6 k r w s e s e 2 3 ζ ζ 7 k r n s e 1 s e 2 1 s e 2 ζ ζ 0 2 ζ 4 8 p c s e p d s e 1 ζ here ζ is the distribution coefficients of the porous medium in the van genuchten model the relative permeability of existing phases is represented by van genuchten 1980 9 k r w s e s e ϵ 1 1 s e 1 m m 2 10 k r n s e 1 s e γ 1 s e 1 m 2 where m ε and γ are empirical constants which are selected here as ε 1 2 and γ 1 3 in addition se is the normalized effective saturation defined as 11 s e s w s r w 1 s r w s r n the mentioned governing equations 3 and 5 need proper boundary conditions to be solved in the respective domain since different problems are considered here the required boundary conditions of each test problem are described at the beginning of each problem description section 4 solution methodology prerequisites in numerical simulation in this section the prerequisites of the numerical simulation and the used symbols are described in detail fig 1 schematically shows the definition of different types of faces and their normal vectors the whole computational domain and its boundaries not shown herein are represented by ω and ω respectively a compatible regular triangular subdomain in the domain ω is labeled as t h t i n h in addition t is the cross section area of each element t t h and f is the size of each element face f f h the set of adjacent internal faces between the two neighboring elements f t t is represented by f h i and the set of boundary faces f t ω coincides with γ γ in γ out γ n is shown by f h b in addition nf is the normal vector on the face f directed from t to t the term v r p ν h l 2 ω t t h ν h t p r d f f h i f ν h 0 shows the discrete hilbert discrete subspace of the ncfem for solving the pressure equation and v r s ψ h l 2 ω t t h ψ h t p r d indicates the discrete hilbert discrete subspace of the finite element method for solving the saturation equation via discontinuous galerkin methods p r d is the set of degrees of approximation with the maximum order r n the parameter hf t f is the diameter of the face f which is equal to the ratio of the area of the element to the length of the face park et al 2010 chen 2008 also if the diameter of each element is called ht the grid size parameter h m a x h t t t h is used to show whether the element grid is fine or coarse the parameter h is the maximum ht diameter of the elements in the domain t h the diameter of each element ht refers to the diameter of the circle surrounded by the element the concepts of jump and average are introduced based on the value in a common point of two neighboring elements t t with the interface f by using the following equations jamei and ghafouri 2022 18 ψ ψ f ψ f ψ ψ f ψ f 2 f f h i if ψ is a vector function then the jump and average operators are given by 19 ψ ψ f n ψ f n n f ψ f ψ f 20 ψ ψ f ψ f 2 f f h i in the jump expression the normal vector nf is directed outward of the current element t the jump and average of the scalar and vector functions ψ on the external boundary faces f f h b are respectively di pietro and ern 2012 jamei and ghafouri 2016 21 ψ ψ f ψ ψ f f f h b 22 ψ n f ψ f ψ ψ f f f h b in the present study rp 1 rs 1 and rt 0 are the approximation degrees of the pressure saturation and darcy equations respectively in addition the test functions of pressure and saturation equations are defined as ν z v r p t h v r s t h the sequential implicit non correlated non repetitive method is here used to solve the governing equations the non linear parameters of mobility and capillary pressure derivatives coefficients λ w n λ n n and p c n based on the saturation values at the previous time step are calculated and the pressure field p w n 1 is calculated at the new time level t n 1 due to the use of the first order implicit euler method in the temporal discretization of equations the stability of the method is always guaranteed and there is low sensitivity to the size of time steps as shown fig 2 the respective numerical algorithm consists of some main steps such as receiving the initial and boundary conditions allocating the physical properties generating computational grids solving the pressure and saturation equations applying slop limiters and determining the finishing criteria the most critical steps of the algorithm are thoroughly described in the following sections discretization of pressure equation discretization of the pressure equation is performed by using the non conforming discontinuous finite element method recently many improvements have been made in non conforming elements resulting in appropriate compatibility with some of the local conservative methods such as discontinuous galerkin unlike the lagrangian elements where degrees of freedom are defined on the vertices of the elements degrees of freedom are placed on the faces of these elements as mentioned in the introduction the most well known type of the triangular elements in the non conforming finite element method is the non conforming p1 or the crouziex raviart element denoted by v r p ν h fig 3 shows the crouziex raviart elements with the location of their degrees of freedom crouziex and thomas crouzeix and raviart 1973 first proposed this element and since then it has been applied widely to physics problems especially in solving the stokes equation zhou et al 2021 in these elements the constraint of continuity is generally neglected in the length of the faces of the element except at the element center this method is more widely used compared to classical finite element methods due to its better stability younes et al 2014 in fig 3 the number of common faces between elements in non conforming finite element subspace of the pressure equation v r p and the number of boundary elements is denoted by n e i f h i and n e b f h b respectively consequently ne nei neb shows all faces in t h ω for all elements t t h the local space of finite element v r p related to the pressure equation is defined as di pietro and ern 2012 23 v r p s p a n 1 x y t c r degrees of freedom on the faces of the non conforming element is generally noted in two ways in the first one the value of the function at the center of each face ν h mi corresponds to the degree of freedom in this way a test function and its derivatives are used according to the following equations 24 ν i 1 2 ϕ i ϕ i a i a 1 x 2 y 2 1 x 3 y 3 1 x y 1 x 1 y 1 1 x 2 y 2 1 x 3 y 3 ϕ i 0 25 ν 1 1 2 ϕ 1 ν 2 1 2 ϕ 2 ν 3 ϕ 1 ϕ 2 1 26 ν i f t n f t t h f f h 27 1 f e i ν j δ ij i j 1 2 3 ν j v r p t h in a second way the value of the degree of freedom is averaged by integration on each face 1 f e ν h d s in which f is the size of the face it should be noted that in the linear approximation using the low order elements cruzeix raviart p1 the values of the pressure function at the center of the face of the element ν h mi are equal to the average pressure integration on that face 1 e e p w d s note that this point is true for the quadrilateral rotational elements rivière 2008 in the wetting phase pressure equation the value of the quasi transport term k λ n p c s w is given and the diffusion term has to be continuous kλ t pw therefore the continuity of pressure and flux due to the pressure gradient has to be weakly maintained by the following equations arbogast et al 2013 28 p w f 0 p w p w on γ ω k λ t p w f 0 k λ t p w k λ t p w on γ ω 29 1 e e p w t 1 d s 1 e e p w t 2 d s in the present study a weighted average operator instead of the general jump and average operators is used in the spatial discretization in order to improve capturing sudden shocks caused by heterogeneity and hyperbolic property of the governing equations for each scalar function ψ defined smoothly on the common face f f h i of two neighboring elements the weighted average on face f is expressed as park et al 2010 chen 2008 30 ψ w w f ψ f w f ψ f where w f w f 1 w f 0 and it is also true for vector functions in heterogeneous media the weighted average operator for each element t f can simply be obtained as a function of the intrinsic permeability tensor 31 w f k t f k t f k t f w f k t f k t f k t f f t t where k t f n f t k n f is the normal component of the intrinsic permeability consequently when homogeneous media are investigated the weighted average operator is converted to the standard form w f w f 0 5 35 ψ ψ f ψ f 2 f f h i 32 ψ ψ f f f h b if ν v r p t h is a test function which is an interpolation function in non conforming discontinuous finite element space and dirichlet boundary conditions are applied by using a weak penalty allocation method the final spatial discretization of the pressure equation is given by 33 a p w v l v v v r p t h 34 a p w v t ϵ t h t k λ t s w n p w n 1 ν d t t f γ h γ d f k λ t s w n p w n 1 n f w ν d s f γ h γ d f k λ t s w n ν n f w p w n 1 d s f γ h γ d σ f γ f p f m e a n t t f ν p w n 1 d s 35 l v t ϵ t h t k λ n p c s w ν d t f γ h γ d f k λ n p c s w n f ν d s f γ d f k λ t s w n ν n f p d i r d s f γ d σ f γ f p f m e a n t t f ν p d i r d s t ϵ t h t q w n 1 q n n 1 ν d t 36 γ f 2 d f d f d f d f γ f 2 m i n d f d f f f h i γ f d f f f h b where γ f is the harmonic average of diffusion coefficients used to decrease the sensitivity of the model to the chosen penalty parameter the sensitivity reduction especially in heterogeneous cases is achieved by applying a weak form of the dirichlet boundary conditions and the stabilization of local discretization of pressure equation this coefficient for the pressure equation is shown by dfp kλ t in each face in order to increase the stability of discretization of the quasi transport term k λ n p c s w in boundary edges between elements the upwind form of this term is used for internal faces f f h i klieber and rivière 2006 f t t 37 k λ n p c s w k λ n p c s w u t n f 0 k λ n p c s w u t n f 0 discretization of saturation equation the swipm has been used to discretize the saturation equation which benefits a weighted average operator to enhance the stability of spatial discretization el amin et al 2017 it should be noted that for the penalty value σ f 0 the internal penalty method is known as the oden babuška baumann obb method rivière 2008 fig 4 shows how to discretize a classic finite element grid into a grid of discontinuous finite elements discontinuous galerkin which is regarded as the first step in the numerical algorithm fig 2 if z v r s t h is a discontinuous interpolation function test function of the saturation equation the saturation equation is represented by the dg method as the following bilinear form jamei and ghafouri 2016 rivière 2008 38 s w t z a s w z l z z v r s t h 39 s w x 0 s w i n i t i a l x x x x y where the time derivative term is of the first order euler method 40 s w t s w n 1 s w n t 41 t t h ϕ s w n 1 δ t zdt t t h e k p c λ w λ n λ w λ n s w n s w n 1 zdt f γ r f s w n 1 u t n 1 n f zds f γ h f γ z s w n 1 ds f γ h f z k p c λ w λ n λ w λ n s w n s w n 1 n f w ds t t h ϕ s w n δ t zds n h t t h u t n 1 f w n zds f γ h γ r γ f u t n 1 f w n n f zds f γ r f s in u t n 1 n f zds t t h e q w n 1 zdt f f h i γ f s 2 d f s d f s d f s d f s γ b 1 2 u t n f f f h b γ f s d f s 42 f f h i γ σ f γ f s f m e a n t t γ b in order to increase the discretization stability of the transport term fwut on the boundary faces between the elements the upwind form of this expression is used for the internal faces f f h i klieber and rivière 2006 43 f t t f w f w f w u t n f 0 f w u t n f 0 where γf is the harmonic average of the diffusion coefficients in the saturation equation d f s p c λ w λ n λ t which is utilized to reduce the sensitivity of the penalty value assigned to the transport equation reconstruction of the velocity field in low order space rt0 in the simulation of the fluid flow through porous media it is vital to determine the continuous velocity field to ensure the local conservation and the continuity of the normal flux vector over the computational domain however the problem solving strategies of correlated equations through the sequential methods and the methods without local conservation property always reduce the accuracy of the velocity field this can lead to non physical oscillations in the computed saturation fields one of the methods of retrieving the velocity field u t v is the projection and reconstruction of the this field in the vector spaces h div such as raviart thomas space rt boffi et al 2013 the low order raviart thomas and h div spaces with exceptional properties are respectively defined as di pietro and ern 2012 boffi et al 2013 44 v u t h div ω u t k r t 0 k t h r t 0 k u t u 1 u 2 u t 1 a b x u t 2 c b y a b c d r h div ω ψ l 2 ω 2 ψ l 2 ω ψ n f γ n 0 in the projection method in vector space h div the new velocity field can be processed in the low order raviart thomas space by a set of approximate values of the linear pressure field p w n 1 v r p t h and the wetting phase saturation s w n v r s t h according to fig 3 right side related to the raviart thomas space of order rt 0 the degree of freedom of the flux passing through each face is a constant value q t n 1 u t n 1 n f and q t r t 0 t h on each side can be obtained by which can be expanded as jamei et al 2019 45 q t n 1 1 f d 1 u t n 1 n f 1 t 46 q t n 1 f k λ t p w n 1 w n f k λ n p c s w n n f σ f γ f p f m e a n t t p w n 1 d s 47 p w n 1 p w n 1 f f h i p w n 1 p dir f f h b on γ d 49 δ t n 1 0 o n γ n by using the linear combination of degrees of freedom and the vector interpolation functions for placement at the gaussian points of the saturation equation the approximated velocity field with a continuous normal component on the shared faces between the elements f f h is given by jamei and ghafouri 2022 49 u t n 1 i 1 3 q t i n 1 ψ f i the vector interpolation function in the raviart thomas space of low order rt 0 is defined as fig 3 right side 50 ψ f f 2 t x x p where xp is the coordinate of the opposite vertex to node p the function ψ f must satisfy the property ψ f f n f δ f f in which f 1 2 3 n f and δ f f are the normal vector of the face f and the kronecker delta respectively to project the vector of the interpolation functions and their derivatives in the raviart thomas space the piola transform theory can be used in which the properties of the reference element t are transferred to the physical element t the methodology of piola transform is explained in appendix a elimination of non physical oscillations of saturation in the related literature there exist a number of multi dimensional slope limiter approaches for the unstructured grid e g the modified durlofsky osher engquist durlofsky et al 1992 generalized cockburn cockburn and shu 2001 and shu slope limiter shu 1987 which can be used to eliminate the non physical oscillations in the solution of the saturation equation these slope limiters are inherently edge based approaches since our dofs in the saturation equation are defined on the vertices of elements the use of an edge based slope limiter can lead to some local extrema jamei and ghafouri 2016 therefore a modified chavent jaffre slope limiter based on the dof places is here used to remove the non physical oscillations in the saturation field this slope limiter can also help to enhance the stability of the model concerning the kind of boundary conditions despite being more computationally expensive than other limiters this slope limiter has high accuracy in eliminating non physical oscillations this slope limiter is based on the maximum principle park and kim 2022 at the vertices of the element minimizing the difference between saturation values before s w i and after s w i the limiting process for this purpose a set of constraints is used to preserve the local conservation of the element and prevent the formation of local extrema hoteit et al 2004 fig 5 in each element t t h the set of elements surrounding each node i is represented by the symbol t h t t h i t here n t is the number of vertices of each element and m i j is the center of the face ij the slope limiting operator is defined as l s w s w in each element t before the constraint process the maximum s w m a x i the minimum s w m i n i and the average s w a v e of the elements surrounding node i in the set t t are defined as hoteit et al 2004 hoteit and firoozabadi 2008 51 s w a v e 1 t t s w i 1 n t i 1 n t s w i 52 s w m i n i m i n s w a v e t h 53 s w m a x i m a x s w a v e t h 54 o b j e c t f u n c t i o n min i 1 n t 1 2 s w i s w i 2 i 1 n t the local conservation in eq 55 is maintained by equating the average of the saturation computed on each element s w a v e with the average of this value after the constraint of s w a v e jamei and ghafouri 2016 55 s w a v e 1 n t i 1 n t s w i s w a v e s w a v e t t h as the heading of the local extremum elimination constraint the maximum s w m a x i and the average minimum s w m i n i of all the surrounding elements are controlled park et al 2010 56 s w m i n i s w i s w m a x i i 1 n t in the third constraint the average value on each face s w a v e m must be limited between the average value of the current element and its neighboring element s w a v e t 0 s w a v e to prevent a possible local extremum on the faces 57 min s w a v e s w a v e t 0 s w a v e m max s w a v e s w a v e t 0 numerical results and discussion in this section the proposed numerical method is first validated by comparing its results with the available analytic and semi analytic solutions associated with two benchmark problems including the buckley leverett bl and mcwhorter and sunada ms problems then the numerical results of two test problems with heterogeneous permeability fields are presented the physical properties of the fluid and the porous medium associated with all considered test problems are summarized in table 1 note that the variation range of the porosity and permeability fields is given for two heterogeneous test problems i and ii for all considered cases the capillary pressure is assessed and evaluated by using the van genuchten or brooks corey models morel seytoux et al 1996 r h b and corey 1964 in the following section the proposed numerical model is validated by presenting the solution of two benchmark problems validation of the proposed method buckley leverett benchmark problem in this section the buckley leverett bl benchmark problem is presented and solved to assess the accuracy and performance of the proposed numerical model in its basic form the bl problem represents an imbibition process where the non wetting phase is replaced by the wetting phase in a 1 d domain here the incompressible two phase fluid flow is numerically simulated for a 2 d global domain which is a rigid homogeneous porous medium with a uniform porosity value of φ 0 2 the boundary conditions of this 2 d problem are chosen in such a way that it is automatically reduced to our desired 1 d problem i e the bl problem while the upper and lower boundaries of the domain are impermeable two different pressure values pl and pr are imposed on the left and right boundaries of the domain fig 6 a for the numerical results these pressure values are constant and chosen in such a way that water enters the domain from the left for reporting purposes a dimensionless pressure is defined as p p pr pl pr in which pl and pr are the pressure values imposed on the left and right boundaries of the global domain respectively by neglecting the effects of capillary pressure and rock fluid compressibility the transport equation is rewritten as jamei et al 2019 59 ϕ s w t u t d f w d s w s w q w this hyperbolic equation is the buckley leverett bl water flooding problem the bl problem is solved in a one dimensional domain of horizontal length l as schematically shown in fig 6a the domain is initially saturated with fluids in such a way that the saturations of the wetting and non wetting phases are sw 0 75 and sn 0 25 respectively then the wetting phase is injected into the domain from the left under injection pressure of pl 1 0 and the existing phases are produced from the right at the constant pressure of pr 0 0 the numerical results are presented based on the pore volume injected pvi time defined as lee et al 2009 60 pvi μ l 2 ϕ 1 s r w s r n k p l p r where k and φ are the permeability and porosity of the porous medium and s rα stands for the residual saturation of the phase α respectively in the present study the obb dg with σf 100 is used to solve the bl problem and the obtained results are compared with those of a conservative form of the basic finite element fe method and also hybrid non conforming discontinuous galerkin finite element method h l 32 based on two approaches the free mesh method samimi and pak 2014 and the fully sequential dg scheme dg dg jamei and ghafouri 2016 in order to investigate the dependency of the results to the computational grid and the convergence factor assessment of the model different element divisions including l 32 l 64 and l 128 are employed as the analytic solution is not available in the case of fully coupled pressure saturation equations the numeral results associated with a very fine grid are considered as the reference solution and it is used to compute the error associated with each main variable h pw sw denoted by eh and defined as e h max n h n h h n rui and zhang 2017 besides the convergence rates associated with the pressure and saturation equation in the employed numerical method are labeled as c p w and c s w respectively by assuming error constant h rate each convergence rate ch with h pw sw is calculated as ch log e h1 e h2 log h 1 h 2 where eh1 and eh2 are the errors associated with the element size of h 1 and h 2 respectively rivière 2008 rui and zhang 2017 both pressure and saturation errors along with the convergence rate of different methods are calculated and presented in table 2 according to the results reported in table 2 the hybrid non conforming discontinuous galerkin cr dg method despite lower degrees of freedom in solving the pressure problem has a convergence rate close to the dg dg scheme with the same computational grid size besides it can be concluded that the non conforming finite element method is consistent with the reconstructed velocity field the variations of norm of error versus the element size in the logarithmic scale are shown in fig 7 c and 7d these results indicate that the proposed approach produces acceptable pressure and saturation distributions with convergence rates of 1 043 and 0 992 respectively mcwhorter and sunada benchmark problem as the second benchmark problem a diffusion dominant problem is considered to validate two phase flow numerical methods the mcwhorter and sunada ms benchmark problem mcwhorter and sunada 1990 represents an imbibition process associated with a bidirectional displacement in an infinite column with a no flux boundary at the end of the column the ms equation is a non linear hyperbolic equation obtained based on the assumption that the convective term can be neglected in comparison to the capillary term in the transport equation the ms equation is given by mcwhorter and sunada 1990 61 ϕ s w t x λ w λ n λ t p c k s w x 0 i n ω the medium is initially saturated with the existing phases in such a way that sw 0 1 as the boundary condition the pressure of the wetting phase at the inlet is always kept at pl 2 105pa the capillary and relative permeability values for this imbibition process are predicated based on the brooks corey model with the data presented in table 1 after a grid dependency study a uniform computational grid consisting of δx l 32 elements size and the time step of size δt 20 s are finally used to produce the numerical results the numerical results of different methods including the proposed hybrid approach and opengeosys an open source scientific platform for developing the numerical simulation of thermo hydro mechanical chemical processes through porous media kolditz et al 2012 are compared in fig 8 a besides fig 8b demonstrates the variation of the 2 norm error of saturation e s w versus the different element sizes i e δ x l 32 l 64 l 128 l 256 and l 512 in logarithmic scale in this problem the calculated convergence rate of the numerical method is 1 435 although a good agreement between these results is observed a difference exists between the semi analytic ms solution and the presented numerical results it should be mentioned that more accurate numerical results can be achieved by using another formulation based on the pressure of the non wetting phase and capillary pressure instead of saturation and pressure of the wetting phase as the main unknown variables amaziane 2008 the results of two benchmark problems i e the bl and ms problems indicated that the proposed numerical method can simulate the two phase flow in a porous medium with an acceptable accuracy in the following the performance of the proposed approach is investigated by solving two heterogeneous problems in two dimensions named test problems i and ii test problem i as the first case test problem i the imbibition process through a porous medium with a two scale heterogeneous permeability field is simulated the computational domain is considered as a simple rectangle of size 100 50 m with a number of circular obstacles of radius r 5m as shown in fig 9 the centers of these obstacles are located at the points 20 25 40 12 5 60 park and kim 2022 80 12 5 the absolute permeability and porosity of the obstacles are considered as 10 14 m2 and 0 2 respectively the wetting phase is injected into the domain from the left side of the rectangle under a dimensionless pressure of p 1 and the existing fluids leave the domain from the right side at a constant pressure of p 0 it is assumed that the saturation of the wetting phase is sw 0 25 at the beginning of the process the physical properties of the fluid phases and the porous medium are presented in table 1 this test problem is numerically solved by using different numerical methods including the cr dg dg dg and the basic conservative fe methods after performing a grid dependency study a computational grid consisting of the total number of 1777 triangular elements with 3402 nodes is constructed in the computational domain which is used to report the results of the cr dg method here the numerical results of the cr dg method are obtained based on the penalty factor of σf 100 and a constant time step of size δt 846 s the pressure and saturation equations are discretized by using a set of second order elements for the fe method a computational grid with 9701 triangular elements and 4996 vertices is utilized to obtain the grid independent results the wetting phase pressure and saturation contour plots at different times are shown in figs 10 and 11 respectively it can be observed that the proposed hybrid approach produces rational results without non physical peaks comparing the pressure distributions of different times one can easily keep that the pressure field changes versus time since the non linear permeability curves are used and the physical properties of the displacing phase e g viscosity differ from those of the displaced phase to quantitatively compare the results of the cr dg and dg dg methods the variations of pressure and saturation along the symmetry line i e y 25 m are presented in fig 12 for two different times i e t 5 day and t 10 day these results indicate that both cr dg and dg dg methods predict nearly the same solution for the considered times this means that the proposed numerical approach i e the cr dg method can precisely capture the sharp front of the injected phases by using a less dof when compared with the dg dg method compared with the fe method for this case one can observe that the results of the basic fe slightly differ from those of the cr dg and dg dg methods a computational grid with a larger number of elements is used for the fe method in addition both pressure and transport saturation equations are discretized by using the second order elements based on these facts it can be concluded that the cr dg is a more flexible method when compared with the considered methods this is mainly due to the logic of the placement of the dofs in solving non hyperbolic equations in the cr dg method by using a coarse computational grid with a less dof this approach can help to reach the results with an acceptable accuracy at less computational costs according to fig 12 the dg based models i e cr dg and dg dg is able to more efficiently capture the physical discontinuities than the fe model test problem ii the water injection into a highly heterogeneous oil reservoir is numerically simulated in two dimensions as the test problem ii it is assumed that water and oil are the wetting and non wetting phases respectively the computational grid representing the heterogeneous permeability and porosity fields and the imposed boundary conditions are shown in figs 13 a and 13b to recover the reservoir water is injected from the top of the global domain under the pressure of p 1 3 106 pa for a duration time of 50 days and the existing fluids leave the domain from the bottom at a constant pressure of p 6 0 105 the global domain is initially saturated with sw 0 10 and sn 0 90 the physical properties of the porous medium and the fluid phases are given in table 1 to simulate this test problem a computational grid consisting of 2640 elements with 1319 nodes the swipm with the penalty value of σ 100 and the time step of δt 1 60 day are used the contour plots of dimensionless pressure and saturation at times of 12 5 25 37 5 and 50 days are shown in figs 14 and 15 the dimensionless pressure is here defined as p pw p 0 with p 0 106 pa these results show the effects of heterogeneous structure of the medium on the pressure and saturation distributions in the reservoir from the saturation contour plots figs 15 it can be inferred that the phenomenon of fingering due to the high heterogeneity of the porous medium is well captured by the proposed method regarding to its beneficial properties these are the local conservation property the stabilization methods utilized in the spatial discretization of the governing equations and the non conforming elements used to solve the pressure equation in order to quantitatively investigate the performance of the cr dg method in comparison to the other methods i e the dg dg and fe methods the variations of the wetting phase saturation along two selected lines are presented in figs 16 a and 16b for the times t 12 5 25 37 5 50 days the first one says line 1 is a vertical line passing through the points at the positions 50 m 1 m and 50 m 135 m and the second line i e line 2 is horizontal one passing through the point 1 m 80 m and 1 m 80 m it should be mentioned that these results are obtained by using the same computational grid shown in fig 13a these plots indicate that the cr dg and dg dg methods produce almost the same results while the fe method predicts the relatively different saturation variations along the selected lines for different times figs 16a and 16b as is quite clear the cr dg and dg dg schemes are more efficient in capturing heterogeneities and discontinuities than the fe method which results in more reliable and logical solutions careful study shows that the fingering phenomenon in the cross section obtained by the first two models has a much better resolution than that of the fe scheme based on these results one can say that the proposed method can properly capture the effects of the heterogeneous structure of the absolute permeability porosity of the domain on the obtained saturation distributions compared with the dg dg method the cr dg produces the same results at a lower computational cost which is one of the main advantages of the suggested method conclusion a sequentially hybrid non conforming finite element method ncfem with symmetric weighted interior penalty discontinuous galerkin swipm was developed to simulate the two phase fluid flow through the heterogeneous porous medium in this regard the pressure equation was discretized by using the non conforming crouzeix raviart cr elements as a dominant convection equation the saturation equation was solved by using the swipm here the velocity field was computed at the midpoint of each element edge by using h div projection and the lowest order raviart thomas space to preserve the local conservation between two neighboring elements finally a novel slope limiter modified chavent jaffre slope limiter was designed to remove the non physical oscillations due to the heterogeneous structure of the porous medium the accuracy of the provided model was examined by comparing its results with the available semi analytic and numerical solutions of different tests cases in one and two dimensions besides two imbibition processes in the heterogeneous porous medium were simulated and discussed based on the obtained numerical results of the proposed method it can be concluded that a more accurate velocity field is obtained whenever the proposed hybrid approach solves the coupled pressure and saturation equations based on the bl problem results this prevents non physical variations of saturation values in regions adjacent to discontinuity and the heterogeneity of the porous medium by using non conforming elements and placing the degree of freedom on the edges of the elements in the pressure equation solution one can remove the continuity constraints at the vertices this helps to use unhanged nodes with different approximation degrees compared to the fully coupled discontinuous galerkin method for two phase flow in porous media the proposed hybrid scheme reduces the total computational costs of the simulation process it is beneficial to use spatial discretization schemes to improve the shocks observed in the heterogeneous regions applying a weighted average operator reduces the sensitivity of the choice of penalty values especially at the heterogeneity and discontinuities of the porous medium the results of the considered test problems showed that the proposed method with a minor degree of freedom in comparison with dg dg model results in an acceptable accuracy versus the semi analytical and analytical solutions the results of the test problem ii exhibited that the novel provided numerical scheme can properly capture shock waves and accurately model the water fingering phenomena in a highly heterogeneous porous media credit author statement mehdi jamei conceptualization code developer visualization writing review editing formal analysis and project leader mehdi mosharaf dehkordi investigation visualization software writing original draft formal analysis and writing review editing hamid reza ghafouri supervision and review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper funding no funding ethics approval not applicable appendix a piola transform methodology in the piola transform similar to the projection of the lagrange scalar functions all computational processes are performed based on the reference element in such a way that the piola transform function f p performs the projection from the t to t element fig a1 to express the functions and derivatives of the reference element in the vector space the components of surface coordinates φ i 1 3 are used zienkiewicz and taylor 2005 b1 f p x x 1 x 2 x 1 ϕ 2 x 3 x 1 ϕ 3 y y 1 y 2 y 1 ϕ 2 y 3 y 1 ϕ 3 b2 f p r 2 r 2 f p x b x b b x 1 y 1 b3 b t j t x 2 x 1 x 3 x 1 y 2 y 1 y 3 y 1 j t d e t j t here x x y i 1 3 are coordinates of the physical element and jt is the determinants of the jacobi matrix the piola transform theory for the q t vector interpolation function in the reference element is represented as ervin 2022 untersuchung and fakult 2022 b4 q q x p q x 1 j t j t q x for interpolation functions of the normal component on the faces of the q f element the following equation is established b5 q q x p q x 1 j t l f l f j t q x where lf and l f are the length of the physical and the reference elements respectively figure a1 illustrates the mapping of the reference element to a physical one 
176,during drainage as a voxel of porous material is being actively invaded prior to percolation the invading nonwetting fluid cannot be transmitted to the neighboring downstream voxel until a critical nonwetting saturation s n c is reached this occurs when the invading fluid forms a percolating path across the voxel we present novel laboratory observations of gravitationally stable air water drainage in thin bead packs with 2d saturation fields monitored at high spatial and temporal resolution using transmitted light we also present invasion percolation simulations both show that s n c has a strong dependence on capillary number ca bond number bo and voxel size l z we propose a percolation model that describes the functional form of s n c bo ca l z we also produce a new theoretical model for the macroscopic capillary pressure function p c s w bo ca l z where s w is the saturation of wetting fluid in the voxel keywords multiphase flow porous media hydrogeology drainage 1 introduction a macroscopic porous continuum theory of multiphase immiscible flow in geological materials must provide equations for the spatial and temporal evolution of the saturations and average fluid pressures of each fluid as defined in macroscopic voxels averaging volumes that surround each point of the porous material a voxel or volume element is the 3d analog of a pixel or picture element experimental advances in observing meniscus dynamics e g reynolds et al 2017 and computational advances in pore scale interface resolving methods e g abu al saud et al 2017 demonstrate the complex pore scale interfacial dynamics occurring as immiscible fluids advance through a voxel an ongoing challenge is to capture at the macroscopic scale the pertinent averaged nature of the actual pore scale physics during immiscible invasion the standard porous continuum model of two phase immiscible flow in an isotropic material involves two statements of mass conservation where the index i w n denotes either the wetting w or nonwetting n fluid 1 t ϕ s i ρ i ρ i q i and two statements of momentum conservation that are written as darcy transport laws 2 q i k o κ i s w η i p i ρ i g where ϕ is porosity ρ i average mass density of fluid i in a voxel s i saturation of fluid i the volume of fluid i in a voxel divided by the volume of the pore space q i the darcy velocity of fluid i the average fluid i velocity relative to the solid framework of grains and multiplied by porosity p i the average fluid pressure in phase i k o the single phase permeability of the material and κ i s w the dimensionless relative permeability coefficients of each fluid which are assumed to be functions of saturation s w if porosity remains constant during flow once the darcy laws are inserted into the two mass conservation equations we have two equations for six unknowns s n s w ρ n ρ w p n and p w the remaining four equations are a statement that the pore space is entirely filled by both fluids 3 s w s n 1 equations of state for each phase which under isothermal flow conditions are the given monotonic functions ρ n p n and ρ w p w and last the assumption of a capillary pressure function 4 p n p w p c s w where p c s w is a given monotonic function of saturation the function p c s w is typically measured experimentally under equilibrium hydrostatic conditions where s w changes slowly by small increments in response to controlled p c changes our focus in this article is whether the above standard model of two phase flow at the continuum scale including commonly employed forms for the functions κ w s w κ n s w and p c s w can capture the way that a gas invades a liquid saturated porous material when the invasion is in the direction of the gravity field which results in stable drainage fronts there are several points of concern and alternative models have been developed to address some of them e g hassanizadeh and gray 1990 gray and miller 2014 a requirement for the validity of darcy s law in a given phase i is that the flow of phase i is laminar which requires that phase i is continuous across each voxel when a voxel is being drained for the first time prior to percolation however the nonwetting fluid is not continuous across the voxel rather it advances by discrete haines jumps in which the local pressure drop across a meniscus trapped at a constriction in the pore space exceeds a threshold value allowing the invading fluid to rush forward at relatively high reynolds number re 1 into downstream pores armstrong et al 2015 at each jump a single initial meniscus separates until all newly formed menisci become trapped at downstream capillary barriers where they remain until the drainage causes the pressure drop across one of them to exceed the threshold value for that constriction and another jump occurs a darcy law for the invading phase does not apply until percolation for that phase has occurred and laminar flow is taking place along the backbone of nonwetting fluid traversing the voxel when saturation reaches a steady state flow is laminar formally the relative permeability of the invading phase must be zero in a voxel undergoing invasion until the nonwetting saturation of that voxel reaches a critical value s n c which corresponds to the nonwetting saturation at the moment of nonwetting phase percolation across the voxel in a macroscopic description of drainage only once the nonwetting saturation is greater than s n c can we begin to allow nonwetting fluid to invade the next downstream voxel according to the newly emergent darcy s law here we will show that s n c is a function of the bond bo and capillary ca numbers and the voxel size l z and we will obtain an expression for the function s n c bo ca l z during invasion the defending wetting phase has a continuous path across the voxel and flows in a laminar manner between haines jumps as described by darcy s law the fractal nature of the invading fluid structure created in a voxel during the percolation process is incorporated into our model of s n c the concept of achieving a critical saturation prior to allowing nonwetting fluid to enter the next downstream voxel is not new it was initially proposed by corey 1954 and has been subsequently investigated by dury et al 1999 yortsos et al 2001 and ghanbarian et al 2016 among others in particular dury et al 1999 conclude an adequate description of the nonwetting phase relative permeability function by any model can only be expected if the emergence point of nonzero permeability is correctly represented we will show here that during drainage the one dimensional saturation profile s z within a voxel depends on the buoyancy force as quantified by the bond number bo on the rate of invasion or extraction as quantified by the capillary number ca and on the linear size of the voxel l z we will provide a model for the function s z that is consistent with invasion percolation concepts this model for s z is then shown to produce a new theoretical prediction for the macroscopic capillary pressure function p c s w ca bo l z experiments conducted in bead monolayers and microchannel networks e g lenormand et al 1988 birovljev et al 1991 frette et al 1997 løvoll et al 2005 cottin et al 2010 toussaint et al 2012 hoogland et al 2015 demonstrate that the morphology of a drainage front depends on the balance of buoyancy viscous and capillary forces the gravitational pressure drop over a characteristic entry pore size a 0 in the direction z ˆ of the average flow is given by δ p g a 0 z ˆ p g a 0 δ ρ z ˆ g where δ ρ ρ w ρ n is the difference in fluid density and g the acceleration of gravity dividing this pressure drop by the capillary pressure drop across a meniscus γ a 0 where γ is surface tension defines the bond number bo 5 bo a 0 2 δ ρ g z ˆ g ˆ γ the viscous pressure drop over the pore distance a 0 in the direction of flow z ˆ is given by δ p v a 0 z ˆ p v a 0 η w z ˆ q w k o where η w is the viscosity and q w the interstitial velocity of the wetting fluid at the tip of the front dividing this viscous pressure drop by the capillary pressure drop across a meniscus defines the capillary number ca 6 ca a 0 2 η w z ˆ q w γ k o when bo 0 the drainage front is stabilized and when bo 0 unstable gravitational fingers develop for the drainage case where the invading nonwetting fluid is less viscous than the defending wetting fluid even when bo 0 the tip of the invasion front becomes unstable when ca becomes sufficiently large compared to bo resulting in viscous fingers of similar morphology to gravitational fingers glass et al 2000 our work in this study is constrained by novel experimental measurements of gravity stabilized drainage in a thin 3d bead pack by continuously measuring light transmission across the thinnest dimension of the bead pack we obtain 2d maps of how the saturation varies through time and we compare these results to standard model numerical simulations using tough2 pruess 2004 when the van genuchten 1980 model for p c s w has parameters determined experimentally for our specific flow cell after demonstrating that the standard model does not accurately predict the observed saturation during invasion the rest of the paper is dedicated to making modifications to the standard model based on the pore scale physics of gravity stabilized drainage at variable bo and ca a table of symbols and notation is provided in appendix 2 experiments and associated simulations 2 1 laboratory experiments we perform drainage experiments in translucent acrylic cells with dimensions 152 mm height 76 mm width and 13 mm thickness the porous material is glass beads with screen size 20 30 0 59 to 0 84 mm d 50 0 72 mm which is similar to a coarse well sorted sand the beads are cleaned with distilled water prior to use we will characterize a typical entry pore size a 0 an effective pore diameter for the bead pack using a 0 d 50 3 0 24 mm prior to assembly a monolayer of beads is adhered to the inner walls of the cell with a clear inert glue to prevent preferential flow along bead wall interfaces to exclude minor preferential flow in the corners of the cell and entry exit effects we record observations over a central region of 65 mm width 115 mm height fig 1 shows the experimental setup and the inside of a flow cell we fill the cells by pouring beads rapidly through a randomizing screen to prevent continuous grain size sorting once full a vibration motor is attached to the cells and left running until the bead level stabilizes to 150 mm height which produces a dense stable and repeatable packing water flow into or out of the cell is regulated by a syringe pump connected to a manifold at the base prior to saturating with water several pore volumes of co 2 are passed through to displace air the high solubility of co 2 in water ensures that the chamber reaches full water saturation distilled water is then injected into the chamber at a slow flow rate and porosity ϕ is calculated by measuring the water level several times during filling yielding ϕ 0 31 once full with water the flow rate is slightly increased and several pore volumes of water are passed through to remove any debris or residual co 2 from the cell the single phase permeability k o of the bead pack was measured by the falling head method yielding k o 1 6 1 0 10 m 2 the air water surface tension at laboratory temperature is γ 0 072 pa m gravitationally stable drainage bo 7 4 1 0 3 was performed by mounting the cell vertically and imposing a water withdrawal rate at the lower boundary with an atmospheric upper boundary to observe any capillary number dependencies a range of drainage flow rates was explored 1 ml min ca 5 0 1 0 5 5 ml min ca 2 5 1 0 4 10 ml min ca 5 0 1 0 4 15 ml min ca 7 5 1 0 4 20 ml min ca 1 0 1 0 3 25 ml min ca 1 25 1 0 3 and 30 ml min ca 1 5 1 0 3 the largest flow rate corresponds to a reynolds number of re ρ w a 0 v w η w 0 37 which is close to the nonlinear advection regime re 1 where darcy s law is no longer a very good approximation drainage timing begins when the first haines jump occurs along the upper boundary all observations were made on a single cell that was not repacked between drainage runs we measure saturation with visible light transmission the light source is a diffused 7 5 w led panel a monochrome video camera redlake motionpro is mounted 1 meter from the cell and captures images continuously the amount of data that can be recorded during a drainage run is limited by the camera s internal buffer size we maintain a constant 25 frames per second at a resolution of 17 pixels per centimeter in both dimensions to relate measured light intensity i at a pixel to the average saturation s w across the cell at that pixel the model of tidwell and glass 1994 fits our measurements quite well conceptually if a beam of light of intensity i o is incident on a layer of glass beads saturated with water and air its intensity decreases by a transmittance factor each time it traverses from the solid beads into a pore and decreases exponentially with distance traveled in each phase due to absorption the absorption coefficients in solid air and water are denoted α s α a and α w the normal incidence transmittance factor at a planar solid air interface is 7 τ s a 4 n s n a n s n a 1 2 where n a is the refractive index of air n a 1 0 and n s is the refractive index of our glass beads n s 1 54 which yields τ s a 0 955 an identical expression exists for the transmittance factor τ s w at a solid water interface which with n w 1 33 yields τ s w 0 991 if there are an average of k pores traversed on a straight line across the cell such that k w s w k of them are saturated with water and k a 1 s w k are saturated with air the distance traveled through water is d w k w d p where d p d 50 is average pore diameter the distance through air is d a k a d p and the distance through solid is denoted d s since each pore experiences two transmittances from solid to pore we have the following model for the transmitted light intensity i 8 i i o e α s d s α w d w α a d a τ s a 2 k a τ s w 2 k w defining i a to be the transmitted intensity when s w 0 fully air saturated beads and i w to be the transmitted intensity when s w 1 we can rewrite the expression for i as 9 i i a e α w α a s w k d p τ s w τ s a 2 s w k assuming that α w α a and introducing the normalized intensity i defined as 10 i i i a i w i a these expressions can be inverted to obtain 11 s w ln i τ s w τ s a 2 k 1 1 2 k ln τ s w τ s a which is the tidwell and glass 1994 model the normalized intensity i consists entirely of measured quantities while the parameter k is formally the number of pores across the system but is taken to be a fitting parameter by measuring the average light intensity across all pixels covering our flow cell and fitting to the measured amount of water in the cell we find that k 26 fits the data best fig 2 which is larger as expected than a simple face centered cubic estimate given by k 13 mm d 50 18 fig 2 also shows that the volume measurement is repeatable in 5 ml increments and that accuracy is not affected by the position of the drainage front in the flow cell formally the tidwell and glass model of eq 11 corresponds to taking the actual distribution of solid air and water within the cell and redistributing these phases into k a 1 s w k layers of air embedded between layers of solid and k w s w k layers of water embedded between solid this planar model for converting measurements of light intensity at a pixel into measures of water saturation across the width of the cell behind that pixel is clearly an approximation the model will get worse as pixel size decreases relative to the size of the solid grains for a face centered cubic model some light rays would pass nearly entirely through solid and others almost entirely through pores the tidwell and glass model could not be expected to apply until enough transmitted rays passing through all combinations of solid air and water are recorded on a rectangular patch of the cell for our random packings we will have all such rays represented on patches that are a few times larger than the average grain diameter for our later purposes of comparing measurements to simulations we measure saturation s z as a function of height z in the cell by averaging the light intensity over rectangular patches that are one camera pixel high d cam 0 59 mm at finest resolution and have widths given by d width 56 mm wide even on such rectangular pixels at finest vertical resolution all ray paths through the solid air and water will be represented and eq 11 is expected to apply because eq 11 is a nonlinear relation between i and s w whenever a different patch size is used to determine saturation one should in principle calculate the average values of all of i a i w and i over the new patch size and then calculate the saturation behind the patch using eqs 10 and 11 considering this we performed saturation measurements at different resolutions both in this manner and by directly averaging the s z function obtained first at camera resolution i e on rectangular patches d cam d width and the results are not significantly different 2 2 standard model numerical simulations we test the standard model of drainage eqs 1 4 by performing 1d isothermal numerical simulations down the length of our homogeneous cell using the tough2 eos3 code pruess 2004 and comparing these results to experimental observations to accomplish this the capillary pressure curve used in the tough2 simulations is first determined experimentally under static non flowing equilibrium conditions water is drained from the cell slowly controlled by an external reservoir until most of it has been invaded from above by air and the equilibrium water saturation profile s w z is measured optically when the cell reaches steady state fig 3 shows the height above the phreatic surface versus the static equilibrium water saturation s w z as measured on rectangular patches of size d cam d width we fit this observation using the van genuchten model 12 p n p w p 0 s 1 λ 1 1 λ where s is the saturation normalized by residual saturation s w c such that 13 s s w s w c 1 s w c and where λ and p 0 are fit parameters note that λ is written as m in van genuchten s notation to convert p n p w into height z relative to the air entry point we use the static equilibrium result that 14 p n p w 4 γ cos θ a 0 ρ w ρ a g z where γ is the air water surface tension a 0 is the entry pore diameter uniform from top to bottom in the cell θ is the equilibrium contact angle and 4 γ cos θ a 0 is the entry pressure into an effective capillary tube of diameter a 0 equating eqs 12 and 14 and using eq 13 gives a model for hydrostatic s w z that is shown as the red curve in fig 3 with parameter values λ 0 94 and p 0 1100 pa the fit is slightly inaccurate as residual saturation is approached higher in the cell if h is the height of the cell we expect that residual saturation will occur at a height z h h where h scales with bo and ca and that the capillary pressure will be a finite constant 4 γ cos θ a 0 ρ w ρ a g h for all points z h in fig 3 h 8 cm the observed entry pressure of 863 pa indicates an equilibrium contact angle of approximately 45 degrees which we use throughout the relative permeability of water is given by the van genuchten mualem model which uses the same λ as the capillary pressure curve 15 κ w s 1 1 s 1 λ λ 2 for 0 s 1 0 for s 0 the water s relative permeability has no free fit parameters residual saturation s w c is experimentally observed and conceptually water is not allowed to flow if s w s w c in contrast we use a corey relative permeability curve for the air 16 κ n 1 s ˆ 2 1 s ˆ 2 for s ˆ 1 0 for s ˆ 1 where 17 s ˆ s w s w c 1 s n c s w c water saturation in the range 1 s n c s w 1 corresponds to s ˆ 1 which requires κ n 0 this model for κ n allows us to vary s n c from s n c 0 to s n c 0 9 in the simulations fig 4 shows some of the corresponding relative permeability curves finally the initial condition for the simulations is full static water saturation the upper boundary is maintained at atmospheric pressure air pressure is approximately atmospheric throughout the cell and the lower boundary has a constant water flux as imposed by the syringe pump because the side boundaries of the actual 3d cell have zero lateral flux conditions the entire cell is reasonably modeled as a 1d cell length system the discretization for the 1d simulations is a stack of identical 10 mm tall voxels fifteen in all implicitly having the same width and depth as the cell with two boundary voxels at the top and bottom 2 3 comparing experiments to standard model simulations fig 5 shows snapshots during drainage when gas begins to invade the bottom voxel of the field of study the plotted comparisons are between the tough2 simulations the optically measured saturation fields at the highest and lowest ca and hydrostatic conditions red horizontal lines denote the averaging voxels in the flow cell which are also the simulation voxels the gray images of optically determined saturation were determined on square pixels of size d cam d cam the black dots marked cell in the graphs are the saturations optically determined by averaging light intensity over the rectangular patches that correspond to the simulation voxels the red lines of size 10 mm d width the red dots marked simulation are the standard model simulation results first gas invasion occurs in the simulations when gas starts flowing out of the upstream voxel the black line in the graphs are the optically measured hydrostatic saturations which are equivalent to fig 3 but measured on patches of size d cam d width resolution the black round circles are the optically measured hydrostatic saturations on the simulation voxels 10 mm d width the simulations red dots were performed using a van genuchten model for p c s w and κ w s w that was fit to the measured equilibrium hydrostatic saturation profile according to standard practice we observe that for our voxel size l z 10 mm the average s n c is approximately 0 08 at ca 5 0 1 0 5 and 0 04 at ca 1 5 1 0 3 the fact that all parameters in the standard model simulations were measured independently prior to the gas invasion experiments and yet there remain significant differences between the simulation and optical measurements of saturation indicates that inappropriate assumptions are present in the standard model fig 6 demonstrates how the parameter s n c influences the air breakthrough time i e the time for air to traverse the length of the field of study from the first haines jump at the top to the final haines jump that allows air to first touch the bottom boundary in these simulations we used the same s n c for each of the 15 numerical voxels perhaps the most significant aspect of these results is that if s n c 0 for the gas phase the simulated breakthrough time is 3 7 times faster than the observed breakthrough time the simulated breakthrough times are influenced both by the capillary pressure function and the relative permeability functions for each phase the general trend that increasing s n c slows down simulated breakthrough times is expected because higher s n c requires more air to enter each voxel before desaturating the next one downstream however the result that the best s n c for predicting breakthrough times at ca 1 5 1 0 3 is roughly 0 72 while the optically measured s n c at this capillary number and voxel size is 0 08 may be a result of using the improper equilibrium p c s w relation at high capillary number as well as the fact that the van genuchten 1980 model for p c s w is problematic in the range of 1 s n c s w 1 how rapidly an individual simulation voxel achieves s n c is strongly influenced both by the p c s w function for that voxel in the range 1 s n c s w 1 and by the influence of the relative permeability model on pressure gradients the main conclusion of the present section in which laboratory measurements of saturation in a flow cell have been compared to numerical simulations based on the standard model of two phase flow with all free parameters independently measured is that the standard model does not adequately reproduce the experimentally observed drainage profiles two key features are missing from the standard model 1 rules for how s w varies in each voxel as it is being invaded for the first time based on the physics of gravity stabilized drainage and 2 once a voxel percolates with gas at s w 1 s n c new models for p c s w κ w s w and κ n s w must be used with dependence on ca as first illustrated in fig 5 and with dependencies on bo and l z as demonstrated in the following sections overall the standard model can only apply to voxels where both fluid phases percolate and does not address the actual capillary physics and associated saturation structures occurring in those voxels that are being actively invaded for the first time 3 saturation models for stable invasion to incorporate bo and ca into models for s n c and more broadly into models for how saturation varies behind the invasion front we turn to percolation theory most of our analysis will be motivated by the wilkinson 1984 invasion percolation ip algorithm in the presence of a buoyancy force and finite viscous flow our first goal is to obtain models for how nonwetting saturation varies with distance behind the front which will allow us to determine the dependencies within a s n c bo ca l z function in what follows we will not rederive all needed ip scaling results from the literature but will attempt to describe in words the physics involved further several of the scalings have exponents that we take from numerical simulations of ip and the models that follow are therefore not built entirely from theoretical analysis and are meant only to capture the scalings and trends observed in the laboratory measurements and ip numerical simulations 3 1 saturation model when bo 0 and ca 0 consider first that gravity is not present and that the invading fluid is moving slowly enough for the invasion percolation algorithm of wilkinson and willemsen 1983 to be valid the condition for invasion percolation to be a realistic model is that the viscosity controlled pressure drop across a voxel of length l z is small compared to the capillary pressure drop across a meniscus residing in an entry pore of radius a 0 which corresponds to the condition that ca a 0 l z if the voxel has lengths l x and l y both l z in the lateral directions we divide the voxel into cubes of volume l z 3 so that there will be l x l y l z l z 3 l x l y l z 2 such cubes in the voxel in this case the critical volume of injected fluid at percolation within a large invasion cluster is a fractal given by wilkinson and willemsen 1983 18 v n c ϕ a 0 3 l z a 0 d c l x l y l z 2 where ϕ is the porosity of the material and d c is the fractal dimension for ordinary capillary fingering without the influence of pressure gradients which in a 3d cubic lattice has the universal value d c 2 52 and d c 91 48 1 90 in 2d this result holds for the infinite cluster that is sampled in sufficiently large systems as denoted by the superscript the subscript n again denotes nonwetting while subscript c denotes the critical threshold at percolation the saturation associated with the invaded volume v n c is found by dividing by the total pore volume ϕ l x l y l z 19 s n c v n c ϕ l x l y l z l z a 0 d c d where d is the euclidean space dimension of the system because d c d is negative the saturation of invading nonwetting fluid at breakthrough is a decreasing function of the size of the voxel in the direction of flow note that if the smallest system voxel dimension was l x and not l z then the above argument would repeat by paving the saturation structure with cubes of volume l x d resulting in s n c l x a 0 d c d such slow invasion when bo 0 can begin to occur once the applied capillary pressure p c p n p w exceeds a threshold given by p c γ a 0 from the macroscopic porous continuum perspective in which the fluid pressure fluctuations due to haines jumps are not detected as long as each voxel has the same a 0 the slow invasion will proceed with p c uniform and with both fluids percolating across all invaded voxels to view the emergent nonwetting saturation profile s z for invasion occurring in the z direction with z 0 defining the tip of the invasion cluster we use the fast invasion percolation algorithm of masson 2016 which allows for trapping simulation is performed on a 3d system of size n x 400 n y 400 and n z 1600 that has periodic boundary conditions in the x and y direction with injection occurring from all points of the face z n z for this scenario the limiting maximum saturation along s z associated with the infinite cluster is given by s n c n x d c d 400 0 48 0 06 which holds for large enough z in fig 7 we plot the saturation profile s z obtained using the ip simulation as well as the expression 20 s z s n c z w o ε 1 ε 2 1 z w o ε 1 ε 2 with fit parameters w o 122 ε 1 1 2 and ε 2 2 1 this form is purely empirical and was chosen to match the sigmoidal shape that tends to the constant theoretical value of s n c n x d c d after passing through the inflection at z w where w is measured to be w 89 7 for the given fit parameters the saturation at the inflection point s w is thus 21 s w f w s n c where the parameter f w is defined 22 f w w w o ε 1 ε 2 1 w w o ε 1 ε 2 where w w o 0 74 and f w 0 15 in a finite system of size l z the saturation of nonwetting fluid at percolation is 23 s n c 1 l z 0 l z s z d z we then have lim l z s n c s n c in a sufficiently large system where the saturation near the injection boundary and the fall off in saturation toward the invasion tip do not occupy a significant fraction of the total system volume 3 2 saturation model when bo 0 and ca 0 wilkinson 1984 defines a variant of invasion percolation that incorporates variable p c due to gravity ip in a gradient field when the invasion is again occurring so slowly that viscosity may be neglected if bo is positive e g air invading water in the direction of gravity the invasion front is stabilized i e long fingers of invading fluid do not develop and further the region over which both phases percolate behind the front becomes compressed compared to when gravity does not act for a gas invading a liquid drainage with bo 0 downward gas jumps in the direction of gravity are somewhat less favored due to the increasing liquid pressure compared to horizontal jumps with the result that trapped clusters of defending fluid develop even in 3d however if bo 0 e g air invading water against the gravity field unstable gravitational fingers develop because upward gas jumps are favored relative to horizontal jumps due to the decreasing liquid pressure with upward distance for stable gas invasion in the direction of gravity the wilkinson 1984 model of ip results in a transition layer of thickness h behind the lead menisci which we continue to define as being located at z 0 that separates the capillary fingering occurring in the frontal region from a constant statistically homogeneous residual saturation region well behind the front across the region 0 z h behind the front in 3d both phases form connected paths above this region i e z h the liquid is below the percolation threshold the capillary pressure is at a maximum and all parts of the pore space originally occupied by liquid that can be invaded by gas have already been invaded any remaining liquid is in disconnected clusters of maximum size ξ that corresponds to the correlation length in the defending liquid as gas flows through this residual saturation region to get to the advancing menisci at the front no further jumps or changes to the saturation state occur the liquid does not flow in the residual saturation region in addition near the front where the gas phase first percolates at z 0 we can define a second correlation length w within the gas phase that effectively defines the width of the random capillary fingering region occurring immediately behind the front at the position of the lead miniscii z 0 there are capillary fingers probing the porous material for the smallest capillary pressure threshold to invade next this random capillary fingering structure immediately behind the lead menisci 0 z w transitions after an inflection point at z w into the region w z h where the increasing capillary pressure with increasing z is causing defending fluid to become pinched off in places until for distances z h the defending fluid is entirely disconnected into patches having maximum size ξ the three lengths w ξ and h can be viewed in the numerical snapshots of the saturation distribution shown in fig 8 these were made with the invasion percolation algorithm of masson 2016 on a 400 400 400 point grid in 3d and 400 400 in 2d the simulations are of a lighter fluid like air slowly invading downward in the direction of gravity into a denser defending fluid like water in 2d all three lengths are equivalent w ξ h while in 3d with a uniform gravitational pressure gradient we have w ξ h when variable viscous pressure gradients are present as considered later in 3d we will have w ξ h note that the definition of front width w in 3d is the inflection point of the s z curve while in 2d it is the maximum separation distance in z of the lead menisci a major goal of this work is to obtain an expression for the invading fluid saturation profile s z there are five key observables that scale with bo and serve as anchor values for the s z profiles these are 1 the width w bo of the capillary fingering region immediately behind the front 2 the invading fluid s saturation s w bo at z w 3 the slope of the saturation profile at z w defined as b w bo d s z d z z w 4 the width h bo of the entire dual percolation zone and 5 the saturation s h bo at z h additionally we require that at z h the slope is zero d s z d z 0 and the curvature is negative d 2 s z d z 2 0 we now go on to obtain the scaling laws for these five observables and then propose functional forms for the profile s z that are anchored by these values 3 2 1 observables at the front w s w and b w a first step is to establish how the width w of the frontal region scales with bo the argument is similar to that for how the maximum length ξ of the residual water clusters depends on bo all of wilkinson 1984 rosso et al 1985 birovljev et al 1991 and méheustt et al 2002 derive the scaling for ξ and we follow a similar argument for w here the width of the front w can be interpreted as a correlation length in the invading gas phase and addressed with ideas from ordinary percolation let q be the allowed occupation probability of the invading gas within voxels behind the front this is formally distinct from the gas saturation because not all pores initially filled with water can be invaded if that water is trapped i e surrounded by gas while the definition of q allows for all water filled pores to potentially be invaded by gas if the local capillary pressure exceeds the entry threshold of the water filled pore at the lead voxel just behind the front z 0 there is a percolation threshold q c that occurs at the capillary entry pressure p c z 0 γ a 0 for that voxel the relation for the occupation probabilities q z at a distance z behind the front can be written 24 q z q c p c 0 p c z π p d p where p γ a is the threshold capillary pressure for air to enter a water saturated pore of size a and π p is the probability distribution for these thresholds if π p is relatively flat with width w t γ 1 a min 1 a max we can approximate π p 1 w t and write 25 q z q c p c z p c 0 w t 1 w t 0 z p c z z d z we can then define a correlation length w from the usual percolation definition w q w q c ν or 26 w a 0 const 1 w t 0 w p c z z d z ν 27 const a 0 w t 1 w 0 w p c z z d z ν 1 ν where ν 0 875 in 3d and 4 3 in 2d we finally rewrite this as 28 w ℓ w a 0 2 γ 1 w 0 w p c z z d z μ where μ ν 1 ν 0 47 in 3d and 0 57 in 2d and the pressure independent length 29 ℓ w const a 0 a 0 w t γ μ is adjusted to fit data the dimensionless quantity a 0 w t γ only depends on the pore size distribution eq 28 for w is valid even if the capillary pressure gradient is variable behind the front as it will be at finite wetting phase velocity at small rates of extraction defined by ca a 0 l z the capillary pressure gradient is due to gravity alone which is uniform in space in this case eq 28 becomes 30 w ℓ w bo μ to test this prediction we use the fast algorithm of masson 2016 for invasion percolation in a gradient to perform numerical simulations on systems of size n x n y n z our flow cell experiments when measured in lattice units corresponding to the average distance between two pores constitute a system size of n x 18 n y 105 and n z 212 which we use in the numerical experiments to measure w numerically we define it as the inflection point in the nonwetting saturation profile s z for each bo we generate numerically an ip nonwetting saturation curve s z at the moment that the nonwetting invading fluid first percolates the system by taking a derivative d s z d z and identifying z w as the point where the derivative is maximized we obtain the front width w for each bo as well as the corresponding saturation s w s w and the maximum slope b w d s z d z z w at the point z w the results are plotted in figs 9 11 fig 9 shows that although at large bo there is indeed the predicted power law relation of w ℓ w bo μ with μ 0 47 3d there is a transition to the constant w 0 for bo bo t the model fit given in fig 9 is given by 31 w w 0 ℓ w bo μ w 0 1 bo bo t 2 taking a 0 1 and l x 18 for the ip simulations we have w 0 1 8 0 81 10 4 lattice units the two free fit parameters that are set to the ip generated observations of w bo are ℓ w 0 7 lattice units and bo t 2 1 0 4 for the saturation s w measured numerically at z w fig 10 again shows a power law at large bo transitioning for bo bo t to the constant s w 0 the exponent of the power law can be explained by recognizing that across 0 z w there are random capillary fingers that have a saturation that scale as in regular ip w a 0 d c d such that s w c s w bo β w where the exponent is 32 β w μ d d c or β w 0 22 in 3d this is precisely the slope seen in fig 10 allowing for the transition at bo t to constant s w 0 at low bond number the model fit is then given by 33 s w s w 0 c s w bo β w s w 0 1 bo bo t 2 the two free parameters that are set to the ip simulations of s w bo are s w 0 0 02 and c s w 0 63 last the maximum slope b w bo of the s z curve at the inflection point z w is given in fig 11 the model fit is given by 34 b w b w 0 c b w bo ω b w 0 1 bo bo t 2 where the exponent is observed to be ω 0 64 and b w 0 2 6 1 0 3 inverse lattice units and c b w 1 06 3 2 2 observables at the residual saturation transition ξ h and s h for the maximum size ξ of residual water clusters above z h we use an identical correlation length argument as was used for w and used by méheustt et al 2002 and others however this time we are focusing on the occupation probabilities p 1 q of the water phase and considering the correlation length of the water clusters near percolation of the water phase p c that takes place in the region z h corresponding to the residual water saturation s w c with capillary pressure p c h we find the following expression 35 ξ ℓ ξ a 0 2 γ 1 ξ h ξ h p c z z d z μ where the length ℓ ξ is adjusted to fit data when capillary pressure gradients are variable behind the front due to finite viscous flow ξ and w are distinct lengths because they involve distinct capillary pressure drops with w ξ for the case of gravity acting alone at small rates of extraction p c z z δ ρ g is a constant note that gravity is directed in the opposite direction to increasing z such that w ξ using the definition of bo then yields 36 ξ w ℓ ξ bo μ which birovljev et al 1991 found to fit their 2d measurements on flow through a layer of beads in a hele shaw cell with μ 0 57 as predicted in 2d wilkinson 1984 defines the transition length h by considering the capillary pressure drop across the distance h to obtain γ a h γ a 0 δ ρ g h where a h a 0 is the smaller pore size being invaded by air at z h at z h the capillary pressure is larger compared to at z 0 by an amount δ ρ g h this can be stated 37 h a 0 a 0 a h 1 bo to test the wilkinson 1984 prediction of h bo 1 we use the fast algorithm of masson 2016 and perform numerical ip experiments in a uniform gravity field when trapped clusters of defending fluid are not allowed to be invaded for simulations conducted on a 400 400 400 cubic lattice in 3d and a 400 400 square lattice in 2d with periodic boundary conditions in the directions lateral to average flow we observe a different scaling for h as shown in fig 12 with h bo 0 85 exponent 1 given these ip simulations we propose that the length h will satisfy a scaling of similar form to w and ξ but with a different exponent μ h i e h should depend on the difference in the capillary pressure across the dual percolation region so that 38 h ℓ h a 0 2 γ 1 h 0 h p c z z d z μ h where ℓ h is a pressure independent length that must be adjusted to fit data for the case of gravity alone we then have 39 h ℓ h bo μ h as shown in fig 12 we numerically measure h in both 2d and 3d and observe the scalings 40 h 0 48 bo 0 85 in 3d 1 19 bo 0 56 ξ in 2d in 2d we observe numerically that h ξ once the size of the fjords of defending fluid which extend from the front region into the invaded region become comparable to the correlation length ξ they are pinched off this results in the defending fluid becoming completely disconnected at distances ξ or greater behind the front with the result that w ξ h in 3d the additional spatial degree of freedom for the defending fluid allows the fjords to remain continuous into the invaded region even when the entrance to a fjord becomes pinched off in places only at a distance h ξ will a fjord finally become completely closed off in all three space dimensions and that distance h will increase with the decreasing influence of gravity in the absence of gravity in 3d the fjords are never entirely cut off h and the residual saturation of the defending fluid is close to zero while the saturation of the invading nonwetting fluid is s n c as given earlier for bo 0 determining the exponent μ h in the scaling h ℓ h bo μ h in terms of standard percolation critical exponents is not obvious and we settle for observing its value from the numerical ip experiments of fig 13 we could equivalently restate the above using the wilkinson 1984 result of eq 37 by saying that a h the size of pores being invaded at z h where defending fjords are being entirely pinched off in all directions is a function of bond number and given by 41 a h bo a 0 1 bo 1 μ h which behaves properly at bo 0 and results in eqs 37 and 39 being identical for an ip system of lateral dimensions 18 105 the dimensions of our laboratory flow cell flow length dimensions of 105 212 and 2 5 1 0 4 and no flow boundary conditions in the lateral directions we observe in fig 13 a slightly different scaling of h bo 0 89 the no flow versus periodic lateral boundary conditions may have a slight influence on the exponent in connecting to lab data we will use the h bo 0 89 scaling the saturation s h s h at the point z h where the residual saturation region begins has been estimated by wilkinson 1984 in his appendix to scale as 42 s h s h 0 c s h ξ a 0 1 β ν 43 s h 0 c s h bo 1 β 1 ν where the exponent β is a standard exponent of ordinary percolation that controls how the fraction of defending water sites belonging to the infinite cluster of water in regular percolation increases above the percolation threshold s h 0 in 3d β 0 418 ν 0 875 the correlation length exponent while for a cubic ip lattice s h 0 0 66 wilkinson 1984 note that the only place in the description of the drainage fronts being developed here where ξ is used is in the determination of the nonwetting saturation s h of the residual saturation region and we elect to work with eq 43 written as s h s h 0 c s h bo β h where 44 β h 1 β 1 ν or β h 0 756 3d 3 2 3 functional form of s z in 3d the local nonwetting fluid saturation profile s z observed in ip simulations is constrained by the five observables w s w s w b w d s d z z w h and s h s h all of these scale with bo according to the rules given in the previous subsections at the point z 0 we expect the slope to be zero and the local curvature to be positive with a monotonically increasing slope until the slope b w is attained at the inflection point z w between z w and z h the slope will monotonically decrease until it is zero at z h we thus separate the s z model into three regions behind the front 45 s z s a z for 0 z w s b z for w z h s h for z h a simple power law increase for s a z with increasing z does an excellent job matching the numerical ip and laboratory observations of the saturation profile 46 s a z s w z w b w w s w to find an appropriate functional form for s b z we first write 47 s b z s h s h s w f z and look for a function f z that has a slope d f z d z z w b w s h s w at z w and then monotonically transitions to zero slope at z h this function also must satisfy f w 1 and f h 0 there are an infinity of functions f z that can satisfy these constraints a challenge is that the shape of the saturation curve between z w and z h changes with decreasing bo we will give two functions for f z that do a reasonable job of matching the numerical and laboratory data a first possible functional form is 48 f 1 z h z h w b w h w s h s w α f 1 α f β f z w h w β f formally the exponents α f and β f can take any value and the constraints on f z will be satisfied we find that a good fit is obtained by taking β f 1 3 for all bo and taking α f to be a simple linear function of the dimensionless ratio w h which is a function of bo as given above 49 α f α f 0 1 α f 1 w h a good fit to the observations is obtained with α f 0 3 7 and α f 1 15 9 other more complicated nonlinear functions for α f w h may provide a better fit an alternative form with fitting exponents that are independent of bo is 50 f 2 z 1 c f δ f 1 w h β f τ f 1 z h β f τ f 1 c f z w α f δ f where the constant c f is defined in terms of another constant γ f as 51 c f γ f 1 γ f with 52 γ f 1 δ f α f w b w s h s w τ f β f w h β f 1 w h β f it is strictly required that τ f 1 in order for the slope to be zero at z h the other exponents α f β f and δ f have no constraints after exploring a range of possibilities we find that taking α f 0 8 β f δ f 5 and τ f 2 does an adequate job of fitting the ip data as a function of bo the fits to the ip data using the above f 1 z and f 2 z are shown in fig 14 in either of these two functions f 1 z and f 2 z all bo dependence of the shape of the curves is controlled by the bo dependence of w and h as given earlier there certainly exist other functions for f z that can fit the data better but they will have a more complicated form we will use f 2 z going forward due to its relative simplicity we implicitly assume that the f 2 z exponents α f 0 8 β f δ f 5 and τ f 2 are universal and applicable to any material when applying the above model for s z to different porous media the parameters expected to change from material to material are ℓ h ℓ w c s h c b w c s w s h 0 b w 0 and w 0 which all depend on the details of the network of pores involved conversely the exponents μ 0 467 μ h 0 845 ω 0 64 β w 0 87 and β h 1 62 are assumed to have universal values that apply to any 3d porous material in fig 14 we plot s z over a range of bo values in the vicinity of our experiment bo 7 4 1 0 3 the ip results in black are captured well by the models of s z in red and blue the hydrostatic curve observed in our experiment is re plotted from fig 3 in green and scaled to match the values of h and s h predicted by eqs 40 and 43 the values of h agree if the lattice spacing is equal to four times our mean grain diameter which suggests that the percolation node spacing represents the average distance traversed by a meniscus during a haines jump rather than the distance between adjacent pores as shown in fig 3 residual water saturation in the experiment is much lower than expected from the ip simulations which may indicate that thin film flows are an important drainage mechanism at lower water saturation e g nimmo 2010 recently ni et al 2021 coupled ip to a continuum percolation model of thin film flow to simulate cycles of drainage and imbibition 3 3 saturation models when bo 0 and ca 0 finally we address the more challenging problem of the capillary number dependence in s z when the defending liquid in stable drainage is being extracted from a voxel at a rate where the viscous pressure drop is no longer negligible compared to the capillary pressure drop across a meniscus wilkinson 1984 and later méheustt et al 2002 note that the gravitational pressure drop is partially undone by the viscous pressure drop the viscous pressure gradient is determined from darcy s law as 53 p v z q w η w k o κ w s w one challenge is that it will not be uniform throughout the region 0 z h due to varying saturation but it must in general be numerically determined as part of the dynamic modeling of eqs 1 and 2 however when considering the 1d experimental observations of s z we can estimate the viscous pressure gradient analytically in the following approximate manner assume that the saturation profile s z is simply advancing through the flow cell with the average flow speed v z controlled by the rate of water extraction from the bottom of the cell this is consistent with our observations and will generally be the case when the hydraulic conductivity is much larger than the darcy velocity hoogland et al 2015 if we denote the position of the advancing lead menisci at any instant as z o t the approximation is that the saturation profile evolves through time as s z t s z z o t where the function s z is again determined from the ip result of eq 45 but with w ξ and h now satisfying new ca dependent scalings the constant speed of the profile is given by 54 v z d z o t d t 1 ϕ k o η w p v z z z o t where the viscous pressure gradient is assumed to be uniform ahead of the front z z o t the rate at which the water saturation s w z t is changing can then be approximated as 55 ϕ s w z z o t t ϕ s w z z o t z d z o t d t k o η w p v z z z o t s w z from eq 1 for the conservation of water mass in 1d we also have 56 ϕ s w z t t q w z t z k o η w z κ w s w p v z t z which upon equating eqs 55 and 56 gives 57 p v z z z o t s w z t z z κ w s w p v z t z in order to determine how the viscous pressure gradient is varying with z we consider the moment in time when z o t 0 and integrate from a point z in the profile to h to obtain 58 p v z z 0 s w h s w z κ w s w h p v z z z h κ w s w z p v z z now at z h the relative permeability of the water goes to zero κ w s w h 0 while s w h s w c 1 s h is the residual water saturation in the region z h we then obtain the result for the viscous pressure gradient as 59 p v z z s w z s w c κ w s w z p v z z 0 the boundary condition at z h is that the water s darcy velocity goes to zero this is the requirement that κ w s w z p v z z 0 as z h which is satisfied by eq 59 at z 0 we would like p v z z z 0 p v z z 0 this can be achieved either by selecting s w 0 to have a particular value less than one or by assuming s w 0 1 and requiring the relative permeability to have the value κ w s w 0 1 s w c at z 0 either approach gives the same final result in the analysis that follows but we choose the second option to address how the scalings of w ξ and h depend on the viscous pressure gradient we note that flow and saturation distribution behind the front are controlled by the gradient in the capillary pressure p c z p n z p w z p w z which in the presence of both gravity and finite viscous flow is 60 p c z z δ ρ g s w z s w c κ w s w z p v z z 0 defining the capillary number ca as that in the pure liquid ahead of the front 61 ca a 0 2 γ p v z z 0 the earlier scaling rules of eqs 28 36 and 38 for w ξ and h now become 62 w ℓ w bo a w ca μ 63 ξ ℓ ξ bo a ξ ca μ 64 h ℓ h bo a h ca μ h where the dimensionless capillary number amplification factors are defined as 65 a w 1 w 0 w s w z s w c κ w s w z d z 66 a ξ 1 ξ h ξ h s w z s w c κ w s w z d z 67 a h w 1 h w w h s w z s w c κ w s w z d z 68 a h w h a w 1 w h a h w inserting eqs 65 68 into eqs 62 64 provides a set of three coupled nonlinear equations that must be solved iteratively to find the roots w ξ and h that are functions of bo and ca to proceed we need a particular model for the water s relative permeability although the earlier models of van genuchten and corey for the water and gas phase relative permeability can certainly be employed it is more consistent to take a percolation perspective e g kirkpatrick 1973 degennes 1983 and write the relative permeability function for water in the percolation form 69 κ w z s w z s w c t w 1 s w c t w 1 for s w c s w 1 and κ w 0 when s w s w c a similar form can be assumed for the gas phase this particular expression gives κ s w 0 1 s w c if we take s w 0 1 which insures that eq 59 reduces to the correct expression at z 0 the conductivity exponent t w has a universal 3d value that has been reported in the range 3 2 t w 2 stauffer and aharony 1992 but is generally considered to be close to 2 the residual water saturation has the predicted value of s w c 1 s h where s h was given earlier by the scaling of eq 43 in order to use the function s z of eq 45 in the determination of the amplification factors we write s w z 1 s z to give the integrand of each amplification factor as 70 s w z s w c κ w s w z s h t w 1 s h s z t w 1 which shows that t w must be less than 2 in order for the amplification factors a ξ and a h to remain integrable at z h the closer that t w is to 2 the larger the amplification factors will become one approach for obtaining the lengths w ξ and h is to use successive approximations beginning with a first guess for a w a ξ and a h w use eqs 62 64 to make a first estimate of w ξ and h and then use these first estimates in eqs 65 68 to update the amplification factors repeating in this manner until the lengths do not change 3 4 comparison to laboratory observations we now compare the above saturation profile model with the saturation profiles measured optically in our flow cell to do so we first determine how the amplification factors and lengths vary with ca for parameters corresponding to the laboratory experiments as such we take bo 7 4 1 0 3 and we set the other free parameters of the model according to the ca 0 values of section 3 2 fig 15 shows the results of this calculation with permeability exponent t w 1 5 and t w 1 6 and with each length normalized by its low ca limit we find the expected result that increasing t w though not exceeding 2 increases lengths at any given ca and causes the lengths to diverge at smaller ca we also find that h is more sensitive to ca than w and that ξ diverges at relatively small ca in fig 16 we use the ca dependence of w and h to predict the water saturation profiles observed in our flow cell which are scatter plotted at 1 cm intervals these observations were obtained by performing a moving average of s z across all video frames for the duration of the flows each at a unique ca for clarity we show a subset of the experiments ca 5 1 0 5 ca 2 5 1 0 4 ca 7 5 1 0 4 ca 1 5 1 0 3 the sensitivity of s z to small increments of ca is another good indicator of repeatability we fit our s z model from eq 45 to the lowest ca experiment ca 5 0 1 0 5 and keeping s h fixed adjust w and h according to the results of fig 15 with t w 1 5 3 5 the capillary pressure vs saturation relation we now obtain the macroscopic relation between the average capillary pressure of a voxel of size l z located at the point z behind the front 71 p c z 1 l z z z l z p c z 0 d z 0 and the average wetting saturation of the same voxel 72 s w z 1 1 l z z z l z s z 0 d z 0 these are thus parametric relations i e letting z run from 0 to h we obtain the entire range of how p c is related to s w during stable drainage in a gravity field when viscous pressure gradients cannot be neglected we begin by using the definitions of the bond number bo a p 2 γ δ ρ g and capillary number ca a p 2 γ p v z z 0 to write the fine scale non averaged capillary pressure gradient of eq 60 as 73 p c z z γ a p 2 bo ca s h s h s z t w 1 integrating from the front position z 0 to a distance z and using that at z 0 the entry pressure goes as p c 0 γ a p where a p is appropriately defined from the young laplace equation a p a 0 4 cos θ we obtain the fine scale capillary pressure which we write in dimensionless form 74 p c z a p γ 1 z a p bo ca z 0 z s h s h s z 0 t w 1 d z 0 which holds over the range 0 z h to obtain p c and s w at each value of z use the earlier model of eq 45 with the lengths w h and ξ all functions of bo and ca to perform the integrals of the combined eqs 71 72 and 74 using the parameter values corresponding to the flow cell experiments we obtain the capillary pressure relation shown in fig 17 in this example we used the local saturation and capillary pressure values and did not average them over intervals l z in fig 17 the end points to the left at highest capillary pressure correspond to points z h and have normalized capillary pressure given by 75 p c h a p γ 1 h a p bo ca a h where a h is the amplification factor of eq 68 the capillary pressure at the inflection point z w denoted by the squares in the figure occur at 76 p c w a p γ 1 w a p bo ca a w the p c s w relation of the present model of gravity stabilized drainage as depicted in fig 17 is distinct from the van genuchten model in that the end point corresponding z h represents the residual saturation values that cannot be surpassed while the end point at z 0 corresponds to the entry pressure γ a p the key points denoted as circular and square dots depend on bo and ca as given above which is also distinct from van genuchten when averaging voxels l z are of finite size a final consideration is the relation between p c and s w in a voxel that is being penetrated by the front but has not yet been percolated if the front has penetrated a distance ζ into a voxel we define the top of the voxel being penetrated as z ζ the lead menisci at the front as z 0 so that the bottom of the voxel is at z l z ζ in the region 0 z ζ both phases percolate and the local water saturation varies as p w z p n p c z with p c z given by eq 74 in the region l z ζ z 0 there is only water and the water pressure varies linearly with z as 77 p w z p n γ a p γ z a p 2 bo ca thus by averaging over the voxel being penetrated we obtain the parametric relation for how p c is related to s w in the lead voxel prior to s w 1 s n c being attained 78 p c ζ a p γ 1 1 l z l z ζ 0 d z z a p bo ca 0 ζ d z z bo a p ca a p 0 z d z 0 s h s h s z 0 t w 1 and 79 s w ζ 1 1 l z 0 ζ s z d z by letting ζ vary from 0 to l z we obtain the entire range of the p c s w relation appropriate to a lead voxel that is being penetrated prior to percolation further the critical percolation value of the invading non wetting fluid when a voxel of length l z is first traversed is 80 s n c 1 l z 0 l z s z d z and has dependence on bo and ca as prescribed earlier in our model for s z last in the limit as bo 0 and ca 0 for example slow horizontal flow in a thin 2d flow cell we find that p c s w γ a p which is a simple constant and distinct from the van genuchten prediction this has also been predicted and experimentally verified by moura et al 2015 for horizontal flow through a cell of single bead thickness in this case the saturation left behind in each voxel at percolation is then the s n c of eq 19 implicit in the above is that the pore size a p is not systematically varying across the length of the flow cell or local voxel if there is a gradient in a p there will be a simple corresponding gradient in p c γ a p even when bo 0 and ca 0 4 conclusion stable drainage experiments have been performed air invading water saturated glass beads in a 3d flow cell while optically measuring the 2d spatial distribution of saturation the optical transmission measurements averaged over the width of the cell the measurements show that the saturation profile s z is dependent on the capillary number ca with larger ca producing more extended saturation profiles invasion percolation simulations demonstrate the effect of variable bo on s z in order to explain these observations a percolation based model was developed a scaling form for the saturation versus distance relation was proposed with profile shape exponents determined from invasion percolation numerical experiments this form has explicit dependence on two key lengths w the width of the invasion front defined here as the inflection point where the saturation profile goes from positive to negative curvature and h the width of the entire region behind the front where both fluid phases percolate a third length ξ defined as the maximum size of trapped water clusters in the residual saturation region z h more weakly influences the residual water saturation all three lengths w h and ξ are shown to have both bo and ca dependence the critical nonwetting saturation s n c at which a voxel at the front is first percolated was optically measured and shown to depend on the size of the voxel l z as well as on bo and ca the main contribution of this work is a model for s z which can be used to determine s n c bo ca l z it applies to stable drainage scenarios and will be useful for macroscopic porous continuum modeling of two phase flow we also show how the theoretical model for s z produces the macroscopic capillary pressure function p c s w bo ca for use in macroscopic flow modeling declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this material is based upon work supported by the u s department of energy office of science united states office of basic energy sciences chemical sciences geosciences and biosciences division under contract de ac 2 5ch11231 the second author srp would like to thank renaud toussaint for interesting conversations on these topics over the years the work of yder masson was partially supported by the consortium i site e2s uppa thermapp appendix see table a 1 
176,during drainage as a voxel of porous material is being actively invaded prior to percolation the invading nonwetting fluid cannot be transmitted to the neighboring downstream voxel until a critical nonwetting saturation s n c is reached this occurs when the invading fluid forms a percolating path across the voxel we present novel laboratory observations of gravitationally stable air water drainage in thin bead packs with 2d saturation fields monitored at high spatial and temporal resolution using transmitted light we also present invasion percolation simulations both show that s n c has a strong dependence on capillary number ca bond number bo and voxel size l z we propose a percolation model that describes the functional form of s n c bo ca l z we also produce a new theoretical model for the macroscopic capillary pressure function p c s w bo ca l z where s w is the saturation of wetting fluid in the voxel keywords multiphase flow porous media hydrogeology drainage 1 introduction a macroscopic porous continuum theory of multiphase immiscible flow in geological materials must provide equations for the spatial and temporal evolution of the saturations and average fluid pressures of each fluid as defined in macroscopic voxels averaging volumes that surround each point of the porous material a voxel or volume element is the 3d analog of a pixel or picture element experimental advances in observing meniscus dynamics e g reynolds et al 2017 and computational advances in pore scale interface resolving methods e g abu al saud et al 2017 demonstrate the complex pore scale interfacial dynamics occurring as immiscible fluids advance through a voxel an ongoing challenge is to capture at the macroscopic scale the pertinent averaged nature of the actual pore scale physics during immiscible invasion the standard porous continuum model of two phase immiscible flow in an isotropic material involves two statements of mass conservation where the index i w n denotes either the wetting w or nonwetting n fluid 1 t ϕ s i ρ i ρ i q i and two statements of momentum conservation that are written as darcy transport laws 2 q i k o κ i s w η i p i ρ i g where ϕ is porosity ρ i average mass density of fluid i in a voxel s i saturation of fluid i the volume of fluid i in a voxel divided by the volume of the pore space q i the darcy velocity of fluid i the average fluid i velocity relative to the solid framework of grains and multiplied by porosity p i the average fluid pressure in phase i k o the single phase permeability of the material and κ i s w the dimensionless relative permeability coefficients of each fluid which are assumed to be functions of saturation s w if porosity remains constant during flow once the darcy laws are inserted into the two mass conservation equations we have two equations for six unknowns s n s w ρ n ρ w p n and p w the remaining four equations are a statement that the pore space is entirely filled by both fluids 3 s w s n 1 equations of state for each phase which under isothermal flow conditions are the given monotonic functions ρ n p n and ρ w p w and last the assumption of a capillary pressure function 4 p n p w p c s w where p c s w is a given monotonic function of saturation the function p c s w is typically measured experimentally under equilibrium hydrostatic conditions where s w changes slowly by small increments in response to controlled p c changes our focus in this article is whether the above standard model of two phase flow at the continuum scale including commonly employed forms for the functions κ w s w κ n s w and p c s w can capture the way that a gas invades a liquid saturated porous material when the invasion is in the direction of the gravity field which results in stable drainage fronts there are several points of concern and alternative models have been developed to address some of them e g hassanizadeh and gray 1990 gray and miller 2014 a requirement for the validity of darcy s law in a given phase i is that the flow of phase i is laminar which requires that phase i is continuous across each voxel when a voxel is being drained for the first time prior to percolation however the nonwetting fluid is not continuous across the voxel rather it advances by discrete haines jumps in which the local pressure drop across a meniscus trapped at a constriction in the pore space exceeds a threshold value allowing the invading fluid to rush forward at relatively high reynolds number re 1 into downstream pores armstrong et al 2015 at each jump a single initial meniscus separates until all newly formed menisci become trapped at downstream capillary barriers where they remain until the drainage causes the pressure drop across one of them to exceed the threshold value for that constriction and another jump occurs a darcy law for the invading phase does not apply until percolation for that phase has occurred and laminar flow is taking place along the backbone of nonwetting fluid traversing the voxel when saturation reaches a steady state flow is laminar formally the relative permeability of the invading phase must be zero in a voxel undergoing invasion until the nonwetting saturation of that voxel reaches a critical value s n c which corresponds to the nonwetting saturation at the moment of nonwetting phase percolation across the voxel in a macroscopic description of drainage only once the nonwetting saturation is greater than s n c can we begin to allow nonwetting fluid to invade the next downstream voxel according to the newly emergent darcy s law here we will show that s n c is a function of the bond bo and capillary ca numbers and the voxel size l z and we will obtain an expression for the function s n c bo ca l z during invasion the defending wetting phase has a continuous path across the voxel and flows in a laminar manner between haines jumps as described by darcy s law the fractal nature of the invading fluid structure created in a voxel during the percolation process is incorporated into our model of s n c the concept of achieving a critical saturation prior to allowing nonwetting fluid to enter the next downstream voxel is not new it was initially proposed by corey 1954 and has been subsequently investigated by dury et al 1999 yortsos et al 2001 and ghanbarian et al 2016 among others in particular dury et al 1999 conclude an adequate description of the nonwetting phase relative permeability function by any model can only be expected if the emergence point of nonzero permeability is correctly represented we will show here that during drainage the one dimensional saturation profile s z within a voxel depends on the buoyancy force as quantified by the bond number bo on the rate of invasion or extraction as quantified by the capillary number ca and on the linear size of the voxel l z we will provide a model for the function s z that is consistent with invasion percolation concepts this model for s z is then shown to produce a new theoretical prediction for the macroscopic capillary pressure function p c s w ca bo l z experiments conducted in bead monolayers and microchannel networks e g lenormand et al 1988 birovljev et al 1991 frette et al 1997 løvoll et al 2005 cottin et al 2010 toussaint et al 2012 hoogland et al 2015 demonstrate that the morphology of a drainage front depends on the balance of buoyancy viscous and capillary forces the gravitational pressure drop over a characteristic entry pore size a 0 in the direction z ˆ of the average flow is given by δ p g a 0 z ˆ p g a 0 δ ρ z ˆ g where δ ρ ρ w ρ n is the difference in fluid density and g the acceleration of gravity dividing this pressure drop by the capillary pressure drop across a meniscus γ a 0 where γ is surface tension defines the bond number bo 5 bo a 0 2 δ ρ g z ˆ g ˆ γ the viscous pressure drop over the pore distance a 0 in the direction of flow z ˆ is given by δ p v a 0 z ˆ p v a 0 η w z ˆ q w k o where η w is the viscosity and q w the interstitial velocity of the wetting fluid at the tip of the front dividing this viscous pressure drop by the capillary pressure drop across a meniscus defines the capillary number ca 6 ca a 0 2 η w z ˆ q w γ k o when bo 0 the drainage front is stabilized and when bo 0 unstable gravitational fingers develop for the drainage case where the invading nonwetting fluid is less viscous than the defending wetting fluid even when bo 0 the tip of the invasion front becomes unstable when ca becomes sufficiently large compared to bo resulting in viscous fingers of similar morphology to gravitational fingers glass et al 2000 our work in this study is constrained by novel experimental measurements of gravity stabilized drainage in a thin 3d bead pack by continuously measuring light transmission across the thinnest dimension of the bead pack we obtain 2d maps of how the saturation varies through time and we compare these results to standard model numerical simulations using tough2 pruess 2004 when the van genuchten 1980 model for p c s w has parameters determined experimentally for our specific flow cell after demonstrating that the standard model does not accurately predict the observed saturation during invasion the rest of the paper is dedicated to making modifications to the standard model based on the pore scale physics of gravity stabilized drainage at variable bo and ca a table of symbols and notation is provided in appendix 2 experiments and associated simulations 2 1 laboratory experiments we perform drainage experiments in translucent acrylic cells with dimensions 152 mm height 76 mm width and 13 mm thickness the porous material is glass beads with screen size 20 30 0 59 to 0 84 mm d 50 0 72 mm which is similar to a coarse well sorted sand the beads are cleaned with distilled water prior to use we will characterize a typical entry pore size a 0 an effective pore diameter for the bead pack using a 0 d 50 3 0 24 mm prior to assembly a monolayer of beads is adhered to the inner walls of the cell with a clear inert glue to prevent preferential flow along bead wall interfaces to exclude minor preferential flow in the corners of the cell and entry exit effects we record observations over a central region of 65 mm width 115 mm height fig 1 shows the experimental setup and the inside of a flow cell we fill the cells by pouring beads rapidly through a randomizing screen to prevent continuous grain size sorting once full a vibration motor is attached to the cells and left running until the bead level stabilizes to 150 mm height which produces a dense stable and repeatable packing water flow into or out of the cell is regulated by a syringe pump connected to a manifold at the base prior to saturating with water several pore volumes of co 2 are passed through to displace air the high solubility of co 2 in water ensures that the chamber reaches full water saturation distilled water is then injected into the chamber at a slow flow rate and porosity ϕ is calculated by measuring the water level several times during filling yielding ϕ 0 31 once full with water the flow rate is slightly increased and several pore volumes of water are passed through to remove any debris or residual co 2 from the cell the single phase permeability k o of the bead pack was measured by the falling head method yielding k o 1 6 1 0 10 m 2 the air water surface tension at laboratory temperature is γ 0 072 pa m gravitationally stable drainage bo 7 4 1 0 3 was performed by mounting the cell vertically and imposing a water withdrawal rate at the lower boundary with an atmospheric upper boundary to observe any capillary number dependencies a range of drainage flow rates was explored 1 ml min ca 5 0 1 0 5 5 ml min ca 2 5 1 0 4 10 ml min ca 5 0 1 0 4 15 ml min ca 7 5 1 0 4 20 ml min ca 1 0 1 0 3 25 ml min ca 1 25 1 0 3 and 30 ml min ca 1 5 1 0 3 the largest flow rate corresponds to a reynolds number of re ρ w a 0 v w η w 0 37 which is close to the nonlinear advection regime re 1 where darcy s law is no longer a very good approximation drainage timing begins when the first haines jump occurs along the upper boundary all observations were made on a single cell that was not repacked between drainage runs we measure saturation with visible light transmission the light source is a diffused 7 5 w led panel a monochrome video camera redlake motionpro is mounted 1 meter from the cell and captures images continuously the amount of data that can be recorded during a drainage run is limited by the camera s internal buffer size we maintain a constant 25 frames per second at a resolution of 17 pixels per centimeter in both dimensions to relate measured light intensity i at a pixel to the average saturation s w across the cell at that pixel the model of tidwell and glass 1994 fits our measurements quite well conceptually if a beam of light of intensity i o is incident on a layer of glass beads saturated with water and air its intensity decreases by a transmittance factor each time it traverses from the solid beads into a pore and decreases exponentially with distance traveled in each phase due to absorption the absorption coefficients in solid air and water are denoted α s α a and α w the normal incidence transmittance factor at a planar solid air interface is 7 τ s a 4 n s n a n s n a 1 2 where n a is the refractive index of air n a 1 0 and n s is the refractive index of our glass beads n s 1 54 which yields τ s a 0 955 an identical expression exists for the transmittance factor τ s w at a solid water interface which with n w 1 33 yields τ s w 0 991 if there are an average of k pores traversed on a straight line across the cell such that k w s w k of them are saturated with water and k a 1 s w k are saturated with air the distance traveled through water is d w k w d p where d p d 50 is average pore diameter the distance through air is d a k a d p and the distance through solid is denoted d s since each pore experiences two transmittances from solid to pore we have the following model for the transmitted light intensity i 8 i i o e α s d s α w d w α a d a τ s a 2 k a τ s w 2 k w defining i a to be the transmitted intensity when s w 0 fully air saturated beads and i w to be the transmitted intensity when s w 1 we can rewrite the expression for i as 9 i i a e α w α a s w k d p τ s w τ s a 2 s w k assuming that α w α a and introducing the normalized intensity i defined as 10 i i i a i w i a these expressions can be inverted to obtain 11 s w ln i τ s w τ s a 2 k 1 1 2 k ln τ s w τ s a which is the tidwell and glass 1994 model the normalized intensity i consists entirely of measured quantities while the parameter k is formally the number of pores across the system but is taken to be a fitting parameter by measuring the average light intensity across all pixels covering our flow cell and fitting to the measured amount of water in the cell we find that k 26 fits the data best fig 2 which is larger as expected than a simple face centered cubic estimate given by k 13 mm d 50 18 fig 2 also shows that the volume measurement is repeatable in 5 ml increments and that accuracy is not affected by the position of the drainage front in the flow cell formally the tidwell and glass model of eq 11 corresponds to taking the actual distribution of solid air and water within the cell and redistributing these phases into k a 1 s w k layers of air embedded between layers of solid and k w s w k layers of water embedded between solid this planar model for converting measurements of light intensity at a pixel into measures of water saturation across the width of the cell behind that pixel is clearly an approximation the model will get worse as pixel size decreases relative to the size of the solid grains for a face centered cubic model some light rays would pass nearly entirely through solid and others almost entirely through pores the tidwell and glass model could not be expected to apply until enough transmitted rays passing through all combinations of solid air and water are recorded on a rectangular patch of the cell for our random packings we will have all such rays represented on patches that are a few times larger than the average grain diameter for our later purposes of comparing measurements to simulations we measure saturation s z as a function of height z in the cell by averaging the light intensity over rectangular patches that are one camera pixel high d cam 0 59 mm at finest resolution and have widths given by d width 56 mm wide even on such rectangular pixels at finest vertical resolution all ray paths through the solid air and water will be represented and eq 11 is expected to apply because eq 11 is a nonlinear relation between i and s w whenever a different patch size is used to determine saturation one should in principle calculate the average values of all of i a i w and i over the new patch size and then calculate the saturation behind the patch using eqs 10 and 11 considering this we performed saturation measurements at different resolutions both in this manner and by directly averaging the s z function obtained first at camera resolution i e on rectangular patches d cam d width and the results are not significantly different 2 2 standard model numerical simulations we test the standard model of drainage eqs 1 4 by performing 1d isothermal numerical simulations down the length of our homogeneous cell using the tough2 eos3 code pruess 2004 and comparing these results to experimental observations to accomplish this the capillary pressure curve used in the tough2 simulations is first determined experimentally under static non flowing equilibrium conditions water is drained from the cell slowly controlled by an external reservoir until most of it has been invaded from above by air and the equilibrium water saturation profile s w z is measured optically when the cell reaches steady state fig 3 shows the height above the phreatic surface versus the static equilibrium water saturation s w z as measured on rectangular patches of size d cam d width we fit this observation using the van genuchten model 12 p n p w p 0 s 1 λ 1 1 λ where s is the saturation normalized by residual saturation s w c such that 13 s s w s w c 1 s w c and where λ and p 0 are fit parameters note that λ is written as m in van genuchten s notation to convert p n p w into height z relative to the air entry point we use the static equilibrium result that 14 p n p w 4 γ cos θ a 0 ρ w ρ a g z where γ is the air water surface tension a 0 is the entry pore diameter uniform from top to bottom in the cell θ is the equilibrium contact angle and 4 γ cos θ a 0 is the entry pressure into an effective capillary tube of diameter a 0 equating eqs 12 and 14 and using eq 13 gives a model for hydrostatic s w z that is shown as the red curve in fig 3 with parameter values λ 0 94 and p 0 1100 pa the fit is slightly inaccurate as residual saturation is approached higher in the cell if h is the height of the cell we expect that residual saturation will occur at a height z h h where h scales with bo and ca and that the capillary pressure will be a finite constant 4 γ cos θ a 0 ρ w ρ a g h for all points z h in fig 3 h 8 cm the observed entry pressure of 863 pa indicates an equilibrium contact angle of approximately 45 degrees which we use throughout the relative permeability of water is given by the van genuchten mualem model which uses the same λ as the capillary pressure curve 15 κ w s 1 1 s 1 λ λ 2 for 0 s 1 0 for s 0 the water s relative permeability has no free fit parameters residual saturation s w c is experimentally observed and conceptually water is not allowed to flow if s w s w c in contrast we use a corey relative permeability curve for the air 16 κ n 1 s ˆ 2 1 s ˆ 2 for s ˆ 1 0 for s ˆ 1 where 17 s ˆ s w s w c 1 s n c s w c water saturation in the range 1 s n c s w 1 corresponds to s ˆ 1 which requires κ n 0 this model for κ n allows us to vary s n c from s n c 0 to s n c 0 9 in the simulations fig 4 shows some of the corresponding relative permeability curves finally the initial condition for the simulations is full static water saturation the upper boundary is maintained at atmospheric pressure air pressure is approximately atmospheric throughout the cell and the lower boundary has a constant water flux as imposed by the syringe pump because the side boundaries of the actual 3d cell have zero lateral flux conditions the entire cell is reasonably modeled as a 1d cell length system the discretization for the 1d simulations is a stack of identical 10 mm tall voxels fifteen in all implicitly having the same width and depth as the cell with two boundary voxels at the top and bottom 2 3 comparing experiments to standard model simulations fig 5 shows snapshots during drainage when gas begins to invade the bottom voxel of the field of study the plotted comparisons are between the tough2 simulations the optically measured saturation fields at the highest and lowest ca and hydrostatic conditions red horizontal lines denote the averaging voxels in the flow cell which are also the simulation voxels the gray images of optically determined saturation were determined on square pixels of size d cam d cam the black dots marked cell in the graphs are the saturations optically determined by averaging light intensity over the rectangular patches that correspond to the simulation voxels the red lines of size 10 mm d width the red dots marked simulation are the standard model simulation results first gas invasion occurs in the simulations when gas starts flowing out of the upstream voxel the black line in the graphs are the optically measured hydrostatic saturations which are equivalent to fig 3 but measured on patches of size d cam d width resolution the black round circles are the optically measured hydrostatic saturations on the simulation voxels 10 mm d width the simulations red dots were performed using a van genuchten model for p c s w and κ w s w that was fit to the measured equilibrium hydrostatic saturation profile according to standard practice we observe that for our voxel size l z 10 mm the average s n c is approximately 0 08 at ca 5 0 1 0 5 and 0 04 at ca 1 5 1 0 3 the fact that all parameters in the standard model simulations were measured independently prior to the gas invasion experiments and yet there remain significant differences between the simulation and optical measurements of saturation indicates that inappropriate assumptions are present in the standard model fig 6 demonstrates how the parameter s n c influences the air breakthrough time i e the time for air to traverse the length of the field of study from the first haines jump at the top to the final haines jump that allows air to first touch the bottom boundary in these simulations we used the same s n c for each of the 15 numerical voxels perhaps the most significant aspect of these results is that if s n c 0 for the gas phase the simulated breakthrough time is 3 7 times faster than the observed breakthrough time the simulated breakthrough times are influenced both by the capillary pressure function and the relative permeability functions for each phase the general trend that increasing s n c slows down simulated breakthrough times is expected because higher s n c requires more air to enter each voxel before desaturating the next one downstream however the result that the best s n c for predicting breakthrough times at ca 1 5 1 0 3 is roughly 0 72 while the optically measured s n c at this capillary number and voxel size is 0 08 may be a result of using the improper equilibrium p c s w relation at high capillary number as well as the fact that the van genuchten 1980 model for p c s w is problematic in the range of 1 s n c s w 1 how rapidly an individual simulation voxel achieves s n c is strongly influenced both by the p c s w function for that voxel in the range 1 s n c s w 1 and by the influence of the relative permeability model on pressure gradients the main conclusion of the present section in which laboratory measurements of saturation in a flow cell have been compared to numerical simulations based on the standard model of two phase flow with all free parameters independently measured is that the standard model does not adequately reproduce the experimentally observed drainage profiles two key features are missing from the standard model 1 rules for how s w varies in each voxel as it is being invaded for the first time based on the physics of gravity stabilized drainage and 2 once a voxel percolates with gas at s w 1 s n c new models for p c s w κ w s w and κ n s w must be used with dependence on ca as first illustrated in fig 5 and with dependencies on bo and l z as demonstrated in the following sections overall the standard model can only apply to voxels where both fluid phases percolate and does not address the actual capillary physics and associated saturation structures occurring in those voxels that are being actively invaded for the first time 3 saturation models for stable invasion to incorporate bo and ca into models for s n c and more broadly into models for how saturation varies behind the invasion front we turn to percolation theory most of our analysis will be motivated by the wilkinson 1984 invasion percolation ip algorithm in the presence of a buoyancy force and finite viscous flow our first goal is to obtain models for how nonwetting saturation varies with distance behind the front which will allow us to determine the dependencies within a s n c bo ca l z function in what follows we will not rederive all needed ip scaling results from the literature but will attempt to describe in words the physics involved further several of the scalings have exponents that we take from numerical simulations of ip and the models that follow are therefore not built entirely from theoretical analysis and are meant only to capture the scalings and trends observed in the laboratory measurements and ip numerical simulations 3 1 saturation model when bo 0 and ca 0 consider first that gravity is not present and that the invading fluid is moving slowly enough for the invasion percolation algorithm of wilkinson and willemsen 1983 to be valid the condition for invasion percolation to be a realistic model is that the viscosity controlled pressure drop across a voxel of length l z is small compared to the capillary pressure drop across a meniscus residing in an entry pore of radius a 0 which corresponds to the condition that ca a 0 l z if the voxel has lengths l x and l y both l z in the lateral directions we divide the voxel into cubes of volume l z 3 so that there will be l x l y l z l z 3 l x l y l z 2 such cubes in the voxel in this case the critical volume of injected fluid at percolation within a large invasion cluster is a fractal given by wilkinson and willemsen 1983 18 v n c ϕ a 0 3 l z a 0 d c l x l y l z 2 where ϕ is the porosity of the material and d c is the fractal dimension for ordinary capillary fingering without the influence of pressure gradients which in a 3d cubic lattice has the universal value d c 2 52 and d c 91 48 1 90 in 2d this result holds for the infinite cluster that is sampled in sufficiently large systems as denoted by the superscript the subscript n again denotes nonwetting while subscript c denotes the critical threshold at percolation the saturation associated with the invaded volume v n c is found by dividing by the total pore volume ϕ l x l y l z 19 s n c v n c ϕ l x l y l z l z a 0 d c d where d is the euclidean space dimension of the system because d c d is negative the saturation of invading nonwetting fluid at breakthrough is a decreasing function of the size of the voxel in the direction of flow note that if the smallest system voxel dimension was l x and not l z then the above argument would repeat by paving the saturation structure with cubes of volume l x d resulting in s n c l x a 0 d c d such slow invasion when bo 0 can begin to occur once the applied capillary pressure p c p n p w exceeds a threshold given by p c γ a 0 from the macroscopic porous continuum perspective in which the fluid pressure fluctuations due to haines jumps are not detected as long as each voxel has the same a 0 the slow invasion will proceed with p c uniform and with both fluids percolating across all invaded voxels to view the emergent nonwetting saturation profile s z for invasion occurring in the z direction with z 0 defining the tip of the invasion cluster we use the fast invasion percolation algorithm of masson 2016 which allows for trapping simulation is performed on a 3d system of size n x 400 n y 400 and n z 1600 that has periodic boundary conditions in the x and y direction with injection occurring from all points of the face z n z for this scenario the limiting maximum saturation along s z associated with the infinite cluster is given by s n c n x d c d 400 0 48 0 06 which holds for large enough z in fig 7 we plot the saturation profile s z obtained using the ip simulation as well as the expression 20 s z s n c z w o ε 1 ε 2 1 z w o ε 1 ε 2 with fit parameters w o 122 ε 1 1 2 and ε 2 2 1 this form is purely empirical and was chosen to match the sigmoidal shape that tends to the constant theoretical value of s n c n x d c d after passing through the inflection at z w where w is measured to be w 89 7 for the given fit parameters the saturation at the inflection point s w is thus 21 s w f w s n c where the parameter f w is defined 22 f w w w o ε 1 ε 2 1 w w o ε 1 ε 2 where w w o 0 74 and f w 0 15 in a finite system of size l z the saturation of nonwetting fluid at percolation is 23 s n c 1 l z 0 l z s z d z we then have lim l z s n c s n c in a sufficiently large system where the saturation near the injection boundary and the fall off in saturation toward the invasion tip do not occupy a significant fraction of the total system volume 3 2 saturation model when bo 0 and ca 0 wilkinson 1984 defines a variant of invasion percolation that incorporates variable p c due to gravity ip in a gradient field when the invasion is again occurring so slowly that viscosity may be neglected if bo is positive e g air invading water in the direction of gravity the invasion front is stabilized i e long fingers of invading fluid do not develop and further the region over which both phases percolate behind the front becomes compressed compared to when gravity does not act for a gas invading a liquid drainage with bo 0 downward gas jumps in the direction of gravity are somewhat less favored due to the increasing liquid pressure compared to horizontal jumps with the result that trapped clusters of defending fluid develop even in 3d however if bo 0 e g air invading water against the gravity field unstable gravitational fingers develop because upward gas jumps are favored relative to horizontal jumps due to the decreasing liquid pressure with upward distance for stable gas invasion in the direction of gravity the wilkinson 1984 model of ip results in a transition layer of thickness h behind the lead menisci which we continue to define as being located at z 0 that separates the capillary fingering occurring in the frontal region from a constant statistically homogeneous residual saturation region well behind the front across the region 0 z h behind the front in 3d both phases form connected paths above this region i e z h the liquid is below the percolation threshold the capillary pressure is at a maximum and all parts of the pore space originally occupied by liquid that can be invaded by gas have already been invaded any remaining liquid is in disconnected clusters of maximum size ξ that corresponds to the correlation length in the defending liquid as gas flows through this residual saturation region to get to the advancing menisci at the front no further jumps or changes to the saturation state occur the liquid does not flow in the residual saturation region in addition near the front where the gas phase first percolates at z 0 we can define a second correlation length w within the gas phase that effectively defines the width of the random capillary fingering region occurring immediately behind the front at the position of the lead miniscii z 0 there are capillary fingers probing the porous material for the smallest capillary pressure threshold to invade next this random capillary fingering structure immediately behind the lead menisci 0 z w transitions after an inflection point at z w into the region w z h where the increasing capillary pressure with increasing z is causing defending fluid to become pinched off in places until for distances z h the defending fluid is entirely disconnected into patches having maximum size ξ the three lengths w ξ and h can be viewed in the numerical snapshots of the saturation distribution shown in fig 8 these were made with the invasion percolation algorithm of masson 2016 on a 400 400 400 point grid in 3d and 400 400 in 2d the simulations are of a lighter fluid like air slowly invading downward in the direction of gravity into a denser defending fluid like water in 2d all three lengths are equivalent w ξ h while in 3d with a uniform gravitational pressure gradient we have w ξ h when variable viscous pressure gradients are present as considered later in 3d we will have w ξ h note that the definition of front width w in 3d is the inflection point of the s z curve while in 2d it is the maximum separation distance in z of the lead menisci a major goal of this work is to obtain an expression for the invading fluid saturation profile s z there are five key observables that scale with bo and serve as anchor values for the s z profiles these are 1 the width w bo of the capillary fingering region immediately behind the front 2 the invading fluid s saturation s w bo at z w 3 the slope of the saturation profile at z w defined as b w bo d s z d z z w 4 the width h bo of the entire dual percolation zone and 5 the saturation s h bo at z h additionally we require that at z h the slope is zero d s z d z 0 and the curvature is negative d 2 s z d z 2 0 we now go on to obtain the scaling laws for these five observables and then propose functional forms for the profile s z that are anchored by these values 3 2 1 observables at the front w s w and b w a first step is to establish how the width w of the frontal region scales with bo the argument is similar to that for how the maximum length ξ of the residual water clusters depends on bo all of wilkinson 1984 rosso et al 1985 birovljev et al 1991 and méheustt et al 2002 derive the scaling for ξ and we follow a similar argument for w here the width of the front w can be interpreted as a correlation length in the invading gas phase and addressed with ideas from ordinary percolation let q be the allowed occupation probability of the invading gas within voxels behind the front this is formally distinct from the gas saturation because not all pores initially filled with water can be invaded if that water is trapped i e surrounded by gas while the definition of q allows for all water filled pores to potentially be invaded by gas if the local capillary pressure exceeds the entry threshold of the water filled pore at the lead voxel just behind the front z 0 there is a percolation threshold q c that occurs at the capillary entry pressure p c z 0 γ a 0 for that voxel the relation for the occupation probabilities q z at a distance z behind the front can be written 24 q z q c p c 0 p c z π p d p where p γ a is the threshold capillary pressure for air to enter a water saturated pore of size a and π p is the probability distribution for these thresholds if π p is relatively flat with width w t γ 1 a min 1 a max we can approximate π p 1 w t and write 25 q z q c p c z p c 0 w t 1 w t 0 z p c z z d z we can then define a correlation length w from the usual percolation definition w q w q c ν or 26 w a 0 const 1 w t 0 w p c z z d z ν 27 const a 0 w t 1 w 0 w p c z z d z ν 1 ν where ν 0 875 in 3d and 4 3 in 2d we finally rewrite this as 28 w ℓ w a 0 2 γ 1 w 0 w p c z z d z μ where μ ν 1 ν 0 47 in 3d and 0 57 in 2d and the pressure independent length 29 ℓ w const a 0 a 0 w t γ μ is adjusted to fit data the dimensionless quantity a 0 w t γ only depends on the pore size distribution eq 28 for w is valid even if the capillary pressure gradient is variable behind the front as it will be at finite wetting phase velocity at small rates of extraction defined by ca a 0 l z the capillary pressure gradient is due to gravity alone which is uniform in space in this case eq 28 becomes 30 w ℓ w bo μ to test this prediction we use the fast algorithm of masson 2016 for invasion percolation in a gradient to perform numerical simulations on systems of size n x n y n z our flow cell experiments when measured in lattice units corresponding to the average distance between two pores constitute a system size of n x 18 n y 105 and n z 212 which we use in the numerical experiments to measure w numerically we define it as the inflection point in the nonwetting saturation profile s z for each bo we generate numerically an ip nonwetting saturation curve s z at the moment that the nonwetting invading fluid first percolates the system by taking a derivative d s z d z and identifying z w as the point where the derivative is maximized we obtain the front width w for each bo as well as the corresponding saturation s w s w and the maximum slope b w d s z d z z w at the point z w the results are plotted in figs 9 11 fig 9 shows that although at large bo there is indeed the predicted power law relation of w ℓ w bo μ with μ 0 47 3d there is a transition to the constant w 0 for bo bo t the model fit given in fig 9 is given by 31 w w 0 ℓ w bo μ w 0 1 bo bo t 2 taking a 0 1 and l x 18 for the ip simulations we have w 0 1 8 0 81 10 4 lattice units the two free fit parameters that are set to the ip generated observations of w bo are ℓ w 0 7 lattice units and bo t 2 1 0 4 for the saturation s w measured numerically at z w fig 10 again shows a power law at large bo transitioning for bo bo t to the constant s w 0 the exponent of the power law can be explained by recognizing that across 0 z w there are random capillary fingers that have a saturation that scale as in regular ip w a 0 d c d such that s w c s w bo β w where the exponent is 32 β w μ d d c or β w 0 22 in 3d this is precisely the slope seen in fig 10 allowing for the transition at bo t to constant s w 0 at low bond number the model fit is then given by 33 s w s w 0 c s w bo β w s w 0 1 bo bo t 2 the two free parameters that are set to the ip simulations of s w bo are s w 0 0 02 and c s w 0 63 last the maximum slope b w bo of the s z curve at the inflection point z w is given in fig 11 the model fit is given by 34 b w b w 0 c b w bo ω b w 0 1 bo bo t 2 where the exponent is observed to be ω 0 64 and b w 0 2 6 1 0 3 inverse lattice units and c b w 1 06 3 2 2 observables at the residual saturation transition ξ h and s h for the maximum size ξ of residual water clusters above z h we use an identical correlation length argument as was used for w and used by méheustt et al 2002 and others however this time we are focusing on the occupation probabilities p 1 q of the water phase and considering the correlation length of the water clusters near percolation of the water phase p c that takes place in the region z h corresponding to the residual water saturation s w c with capillary pressure p c h we find the following expression 35 ξ ℓ ξ a 0 2 γ 1 ξ h ξ h p c z z d z μ where the length ℓ ξ is adjusted to fit data when capillary pressure gradients are variable behind the front due to finite viscous flow ξ and w are distinct lengths because they involve distinct capillary pressure drops with w ξ for the case of gravity acting alone at small rates of extraction p c z z δ ρ g is a constant note that gravity is directed in the opposite direction to increasing z such that w ξ using the definition of bo then yields 36 ξ w ℓ ξ bo μ which birovljev et al 1991 found to fit their 2d measurements on flow through a layer of beads in a hele shaw cell with μ 0 57 as predicted in 2d wilkinson 1984 defines the transition length h by considering the capillary pressure drop across the distance h to obtain γ a h γ a 0 δ ρ g h where a h a 0 is the smaller pore size being invaded by air at z h at z h the capillary pressure is larger compared to at z 0 by an amount δ ρ g h this can be stated 37 h a 0 a 0 a h 1 bo to test the wilkinson 1984 prediction of h bo 1 we use the fast algorithm of masson 2016 and perform numerical ip experiments in a uniform gravity field when trapped clusters of defending fluid are not allowed to be invaded for simulations conducted on a 400 400 400 cubic lattice in 3d and a 400 400 square lattice in 2d with periodic boundary conditions in the directions lateral to average flow we observe a different scaling for h as shown in fig 12 with h bo 0 85 exponent 1 given these ip simulations we propose that the length h will satisfy a scaling of similar form to w and ξ but with a different exponent μ h i e h should depend on the difference in the capillary pressure across the dual percolation region so that 38 h ℓ h a 0 2 γ 1 h 0 h p c z z d z μ h where ℓ h is a pressure independent length that must be adjusted to fit data for the case of gravity alone we then have 39 h ℓ h bo μ h as shown in fig 12 we numerically measure h in both 2d and 3d and observe the scalings 40 h 0 48 bo 0 85 in 3d 1 19 bo 0 56 ξ in 2d in 2d we observe numerically that h ξ once the size of the fjords of defending fluid which extend from the front region into the invaded region become comparable to the correlation length ξ they are pinched off this results in the defending fluid becoming completely disconnected at distances ξ or greater behind the front with the result that w ξ h in 3d the additional spatial degree of freedom for the defending fluid allows the fjords to remain continuous into the invaded region even when the entrance to a fjord becomes pinched off in places only at a distance h ξ will a fjord finally become completely closed off in all three space dimensions and that distance h will increase with the decreasing influence of gravity in the absence of gravity in 3d the fjords are never entirely cut off h and the residual saturation of the defending fluid is close to zero while the saturation of the invading nonwetting fluid is s n c as given earlier for bo 0 determining the exponent μ h in the scaling h ℓ h bo μ h in terms of standard percolation critical exponents is not obvious and we settle for observing its value from the numerical ip experiments of fig 13 we could equivalently restate the above using the wilkinson 1984 result of eq 37 by saying that a h the size of pores being invaded at z h where defending fjords are being entirely pinched off in all directions is a function of bond number and given by 41 a h bo a 0 1 bo 1 μ h which behaves properly at bo 0 and results in eqs 37 and 39 being identical for an ip system of lateral dimensions 18 105 the dimensions of our laboratory flow cell flow length dimensions of 105 212 and 2 5 1 0 4 and no flow boundary conditions in the lateral directions we observe in fig 13 a slightly different scaling of h bo 0 89 the no flow versus periodic lateral boundary conditions may have a slight influence on the exponent in connecting to lab data we will use the h bo 0 89 scaling the saturation s h s h at the point z h where the residual saturation region begins has been estimated by wilkinson 1984 in his appendix to scale as 42 s h s h 0 c s h ξ a 0 1 β ν 43 s h 0 c s h bo 1 β 1 ν where the exponent β is a standard exponent of ordinary percolation that controls how the fraction of defending water sites belonging to the infinite cluster of water in regular percolation increases above the percolation threshold s h 0 in 3d β 0 418 ν 0 875 the correlation length exponent while for a cubic ip lattice s h 0 0 66 wilkinson 1984 note that the only place in the description of the drainage fronts being developed here where ξ is used is in the determination of the nonwetting saturation s h of the residual saturation region and we elect to work with eq 43 written as s h s h 0 c s h bo β h where 44 β h 1 β 1 ν or β h 0 756 3d 3 2 3 functional form of s z in 3d the local nonwetting fluid saturation profile s z observed in ip simulations is constrained by the five observables w s w s w b w d s d z z w h and s h s h all of these scale with bo according to the rules given in the previous subsections at the point z 0 we expect the slope to be zero and the local curvature to be positive with a monotonically increasing slope until the slope b w is attained at the inflection point z w between z w and z h the slope will monotonically decrease until it is zero at z h we thus separate the s z model into three regions behind the front 45 s z s a z for 0 z w s b z for w z h s h for z h a simple power law increase for s a z with increasing z does an excellent job matching the numerical ip and laboratory observations of the saturation profile 46 s a z s w z w b w w s w to find an appropriate functional form for s b z we first write 47 s b z s h s h s w f z and look for a function f z that has a slope d f z d z z w b w s h s w at z w and then monotonically transitions to zero slope at z h this function also must satisfy f w 1 and f h 0 there are an infinity of functions f z that can satisfy these constraints a challenge is that the shape of the saturation curve between z w and z h changes with decreasing bo we will give two functions for f z that do a reasonable job of matching the numerical and laboratory data a first possible functional form is 48 f 1 z h z h w b w h w s h s w α f 1 α f β f z w h w β f formally the exponents α f and β f can take any value and the constraints on f z will be satisfied we find that a good fit is obtained by taking β f 1 3 for all bo and taking α f to be a simple linear function of the dimensionless ratio w h which is a function of bo as given above 49 α f α f 0 1 α f 1 w h a good fit to the observations is obtained with α f 0 3 7 and α f 1 15 9 other more complicated nonlinear functions for α f w h may provide a better fit an alternative form with fitting exponents that are independent of bo is 50 f 2 z 1 c f δ f 1 w h β f τ f 1 z h β f τ f 1 c f z w α f δ f where the constant c f is defined in terms of another constant γ f as 51 c f γ f 1 γ f with 52 γ f 1 δ f α f w b w s h s w τ f β f w h β f 1 w h β f it is strictly required that τ f 1 in order for the slope to be zero at z h the other exponents α f β f and δ f have no constraints after exploring a range of possibilities we find that taking α f 0 8 β f δ f 5 and τ f 2 does an adequate job of fitting the ip data as a function of bo the fits to the ip data using the above f 1 z and f 2 z are shown in fig 14 in either of these two functions f 1 z and f 2 z all bo dependence of the shape of the curves is controlled by the bo dependence of w and h as given earlier there certainly exist other functions for f z that can fit the data better but they will have a more complicated form we will use f 2 z going forward due to its relative simplicity we implicitly assume that the f 2 z exponents α f 0 8 β f δ f 5 and τ f 2 are universal and applicable to any material when applying the above model for s z to different porous media the parameters expected to change from material to material are ℓ h ℓ w c s h c b w c s w s h 0 b w 0 and w 0 which all depend on the details of the network of pores involved conversely the exponents μ 0 467 μ h 0 845 ω 0 64 β w 0 87 and β h 1 62 are assumed to have universal values that apply to any 3d porous material in fig 14 we plot s z over a range of bo values in the vicinity of our experiment bo 7 4 1 0 3 the ip results in black are captured well by the models of s z in red and blue the hydrostatic curve observed in our experiment is re plotted from fig 3 in green and scaled to match the values of h and s h predicted by eqs 40 and 43 the values of h agree if the lattice spacing is equal to four times our mean grain diameter which suggests that the percolation node spacing represents the average distance traversed by a meniscus during a haines jump rather than the distance between adjacent pores as shown in fig 3 residual water saturation in the experiment is much lower than expected from the ip simulations which may indicate that thin film flows are an important drainage mechanism at lower water saturation e g nimmo 2010 recently ni et al 2021 coupled ip to a continuum percolation model of thin film flow to simulate cycles of drainage and imbibition 3 3 saturation models when bo 0 and ca 0 finally we address the more challenging problem of the capillary number dependence in s z when the defending liquid in stable drainage is being extracted from a voxel at a rate where the viscous pressure drop is no longer negligible compared to the capillary pressure drop across a meniscus wilkinson 1984 and later méheustt et al 2002 note that the gravitational pressure drop is partially undone by the viscous pressure drop the viscous pressure gradient is determined from darcy s law as 53 p v z q w η w k o κ w s w one challenge is that it will not be uniform throughout the region 0 z h due to varying saturation but it must in general be numerically determined as part of the dynamic modeling of eqs 1 and 2 however when considering the 1d experimental observations of s z we can estimate the viscous pressure gradient analytically in the following approximate manner assume that the saturation profile s z is simply advancing through the flow cell with the average flow speed v z controlled by the rate of water extraction from the bottom of the cell this is consistent with our observations and will generally be the case when the hydraulic conductivity is much larger than the darcy velocity hoogland et al 2015 if we denote the position of the advancing lead menisci at any instant as z o t the approximation is that the saturation profile evolves through time as s z t s z z o t where the function s z is again determined from the ip result of eq 45 but with w ξ and h now satisfying new ca dependent scalings the constant speed of the profile is given by 54 v z d z o t d t 1 ϕ k o η w p v z z z o t where the viscous pressure gradient is assumed to be uniform ahead of the front z z o t the rate at which the water saturation s w z t is changing can then be approximated as 55 ϕ s w z z o t t ϕ s w z z o t z d z o t d t k o η w p v z z z o t s w z from eq 1 for the conservation of water mass in 1d we also have 56 ϕ s w z t t q w z t z k o η w z κ w s w p v z t z which upon equating eqs 55 and 56 gives 57 p v z z z o t s w z t z z κ w s w p v z t z in order to determine how the viscous pressure gradient is varying with z we consider the moment in time when z o t 0 and integrate from a point z in the profile to h to obtain 58 p v z z 0 s w h s w z κ w s w h p v z z z h κ w s w z p v z z now at z h the relative permeability of the water goes to zero κ w s w h 0 while s w h s w c 1 s h is the residual water saturation in the region z h we then obtain the result for the viscous pressure gradient as 59 p v z z s w z s w c κ w s w z p v z z 0 the boundary condition at z h is that the water s darcy velocity goes to zero this is the requirement that κ w s w z p v z z 0 as z h which is satisfied by eq 59 at z 0 we would like p v z z z 0 p v z z 0 this can be achieved either by selecting s w 0 to have a particular value less than one or by assuming s w 0 1 and requiring the relative permeability to have the value κ w s w 0 1 s w c at z 0 either approach gives the same final result in the analysis that follows but we choose the second option to address how the scalings of w ξ and h depend on the viscous pressure gradient we note that flow and saturation distribution behind the front are controlled by the gradient in the capillary pressure p c z p n z p w z p w z which in the presence of both gravity and finite viscous flow is 60 p c z z δ ρ g s w z s w c κ w s w z p v z z 0 defining the capillary number ca as that in the pure liquid ahead of the front 61 ca a 0 2 γ p v z z 0 the earlier scaling rules of eqs 28 36 and 38 for w ξ and h now become 62 w ℓ w bo a w ca μ 63 ξ ℓ ξ bo a ξ ca μ 64 h ℓ h bo a h ca μ h where the dimensionless capillary number amplification factors are defined as 65 a w 1 w 0 w s w z s w c κ w s w z d z 66 a ξ 1 ξ h ξ h s w z s w c κ w s w z d z 67 a h w 1 h w w h s w z s w c κ w s w z d z 68 a h w h a w 1 w h a h w inserting eqs 65 68 into eqs 62 64 provides a set of three coupled nonlinear equations that must be solved iteratively to find the roots w ξ and h that are functions of bo and ca to proceed we need a particular model for the water s relative permeability although the earlier models of van genuchten and corey for the water and gas phase relative permeability can certainly be employed it is more consistent to take a percolation perspective e g kirkpatrick 1973 degennes 1983 and write the relative permeability function for water in the percolation form 69 κ w z s w z s w c t w 1 s w c t w 1 for s w c s w 1 and κ w 0 when s w s w c a similar form can be assumed for the gas phase this particular expression gives κ s w 0 1 s w c if we take s w 0 1 which insures that eq 59 reduces to the correct expression at z 0 the conductivity exponent t w has a universal 3d value that has been reported in the range 3 2 t w 2 stauffer and aharony 1992 but is generally considered to be close to 2 the residual water saturation has the predicted value of s w c 1 s h where s h was given earlier by the scaling of eq 43 in order to use the function s z of eq 45 in the determination of the amplification factors we write s w z 1 s z to give the integrand of each amplification factor as 70 s w z s w c κ w s w z s h t w 1 s h s z t w 1 which shows that t w must be less than 2 in order for the amplification factors a ξ and a h to remain integrable at z h the closer that t w is to 2 the larger the amplification factors will become one approach for obtaining the lengths w ξ and h is to use successive approximations beginning with a first guess for a w a ξ and a h w use eqs 62 64 to make a first estimate of w ξ and h and then use these first estimates in eqs 65 68 to update the amplification factors repeating in this manner until the lengths do not change 3 4 comparison to laboratory observations we now compare the above saturation profile model with the saturation profiles measured optically in our flow cell to do so we first determine how the amplification factors and lengths vary with ca for parameters corresponding to the laboratory experiments as such we take bo 7 4 1 0 3 and we set the other free parameters of the model according to the ca 0 values of section 3 2 fig 15 shows the results of this calculation with permeability exponent t w 1 5 and t w 1 6 and with each length normalized by its low ca limit we find the expected result that increasing t w though not exceeding 2 increases lengths at any given ca and causes the lengths to diverge at smaller ca we also find that h is more sensitive to ca than w and that ξ diverges at relatively small ca in fig 16 we use the ca dependence of w and h to predict the water saturation profiles observed in our flow cell which are scatter plotted at 1 cm intervals these observations were obtained by performing a moving average of s z across all video frames for the duration of the flows each at a unique ca for clarity we show a subset of the experiments ca 5 1 0 5 ca 2 5 1 0 4 ca 7 5 1 0 4 ca 1 5 1 0 3 the sensitivity of s z to small increments of ca is another good indicator of repeatability we fit our s z model from eq 45 to the lowest ca experiment ca 5 0 1 0 5 and keeping s h fixed adjust w and h according to the results of fig 15 with t w 1 5 3 5 the capillary pressure vs saturation relation we now obtain the macroscopic relation between the average capillary pressure of a voxel of size l z located at the point z behind the front 71 p c z 1 l z z z l z p c z 0 d z 0 and the average wetting saturation of the same voxel 72 s w z 1 1 l z z z l z s z 0 d z 0 these are thus parametric relations i e letting z run from 0 to h we obtain the entire range of how p c is related to s w during stable drainage in a gravity field when viscous pressure gradients cannot be neglected we begin by using the definitions of the bond number bo a p 2 γ δ ρ g and capillary number ca a p 2 γ p v z z 0 to write the fine scale non averaged capillary pressure gradient of eq 60 as 73 p c z z γ a p 2 bo ca s h s h s z t w 1 integrating from the front position z 0 to a distance z and using that at z 0 the entry pressure goes as p c 0 γ a p where a p is appropriately defined from the young laplace equation a p a 0 4 cos θ we obtain the fine scale capillary pressure which we write in dimensionless form 74 p c z a p γ 1 z a p bo ca z 0 z s h s h s z 0 t w 1 d z 0 which holds over the range 0 z h to obtain p c and s w at each value of z use the earlier model of eq 45 with the lengths w h and ξ all functions of bo and ca to perform the integrals of the combined eqs 71 72 and 74 using the parameter values corresponding to the flow cell experiments we obtain the capillary pressure relation shown in fig 17 in this example we used the local saturation and capillary pressure values and did not average them over intervals l z in fig 17 the end points to the left at highest capillary pressure correspond to points z h and have normalized capillary pressure given by 75 p c h a p γ 1 h a p bo ca a h where a h is the amplification factor of eq 68 the capillary pressure at the inflection point z w denoted by the squares in the figure occur at 76 p c w a p γ 1 w a p bo ca a w the p c s w relation of the present model of gravity stabilized drainage as depicted in fig 17 is distinct from the van genuchten model in that the end point corresponding z h represents the residual saturation values that cannot be surpassed while the end point at z 0 corresponds to the entry pressure γ a p the key points denoted as circular and square dots depend on bo and ca as given above which is also distinct from van genuchten when averaging voxels l z are of finite size a final consideration is the relation between p c and s w in a voxel that is being penetrated by the front but has not yet been percolated if the front has penetrated a distance ζ into a voxel we define the top of the voxel being penetrated as z ζ the lead menisci at the front as z 0 so that the bottom of the voxel is at z l z ζ in the region 0 z ζ both phases percolate and the local water saturation varies as p w z p n p c z with p c z given by eq 74 in the region l z ζ z 0 there is only water and the water pressure varies linearly with z as 77 p w z p n γ a p γ z a p 2 bo ca thus by averaging over the voxel being penetrated we obtain the parametric relation for how p c is related to s w in the lead voxel prior to s w 1 s n c being attained 78 p c ζ a p γ 1 1 l z l z ζ 0 d z z a p bo ca 0 ζ d z z bo a p ca a p 0 z d z 0 s h s h s z 0 t w 1 and 79 s w ζ 1 1 l z 0 ζ s z d z by letting ζ vary from 0 to l z we obtain the entire range of the p c s w relation appropriate to a lead voxel that is being penetrated prior to percolation further the critical percolation value of the invading non wetting fluid when a voxel of length l z is first traversed is 80 s n c 1 l z 0 l z s z d z and has dependence on bo and ca as prescribed earlier in our model for s z last in the limit as bo 0 and ca 0 for example slow horizontal flow in a thin 2d flow cell we find that p c s w γ a p which is a simple constant and distinct from the van genuchten prediction this has also been predicted and experimentally verified by moura et al 2015 for horizontal flow through a cell of single bead thickness in this case the saturation left behind in each voxel at percolation is then the s n c of eq 19 implicit in the above is that the pore size a p is not systematically varying across the length of the flow cell or local voxel if there is a gradient in a p there will be a simple corresponding gradient in p c γ a p even when bo 0 and ca 0 4 conclusion stable drainage experiments have been performed air invading water saturated glass beads in a 3d flow cell while optically measuring the 2d spatial distribution of saturation the optical transmission measurements averaged over the width of the cell the measurements show that the saturation profile s z is dependent on the capillary number ca with larger ca producing more extended saturation profiles invasion percolation simulations demonstrate the effect of variable bo on s z in order to explain these observations a percolation based model was developed a scaling form for the saturation versus distance relation was proposed with profile shape exponents determined from invasion percolation numerical experiments this form has explicit dependence on two key lengths w the width of the invasion front defined here as the inflection point where the saturation profile goes from positive to negative curvature and h the width of the entire region behind the front where both fluid phases percolate a third length ξ defined as the maximum size of trapped water clusters in the residual saturation region z h more weakly influences the residual water saturation all three lengths w h and ξ are shown to have both bo and ca dependence the critical nonwetting saturation s n c at which a voxel at the front is first percolated was optically measured and shown to depend on the size of the voxel l z as well as on bo and ca the main contribution of this work is a model for s z which can be used to determine s n c bo ca l z it applies to stable drainage scenarios and will be useful for macroscopic porous continuum modeling of two phase flow we also show how the theoretical model for s z produces the macroscopic capillary pressure function p c s w bo ca for use in macroscopic flow modeling declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this material is based upon work supported by the u s department of energy office of science united states office of basic energy sciences chemical sciences geosciences and biosciences division under contract de ac 2 5ch11231 the second author srp would like to thank renaud toussaint for interesting conversations on these topics over the years the work of yder masson was partially supported by the consortium i site e2s uppa thermapp appendix see table a 1 
177,we investigate the strong impact of adsorption thermodynamics and kinetics on particle dispersion using a robust numerical scheme lattice boltzmann simulation within the two relaxation time framework by modeling the transport of both non adsorbing and adsorbing molecules in simple pore structures we highlight the key role played by the adsorption desorption ratio k and the initial concentration c 0 for different adsorption models henry langmuir etc considering small k or c 0 leads to small or negligible adsorption impact on transport however for larger values adsorption significantly alters transport as it drastically increases the dispersion of the adsorbing particles within the confining geometry our results highlight the need to include a robust thermodynamic modeling framework in transport equations when considering complex pollutants as they display a rich and complex physicochemical behavior this includes surfactants which are at the core of the present work but also molecules of emerging concern such as heavy metals microplastics pharmaceuticals etc as illustrated here with complex interfacial effects large deviations can be observed in both the predicted adsorbed amounts and transport dispersion coefficients when compared to molecules with more conventional adsorption properties keywords dispersion adsorption kinetics transient regime cooperative adsorption lattice boltzmann trt 1 introduction transport in a porous medium is relevant to a large body of domains and applications such as reservoir engineering e g hydrocarbon transport in rocks geoscience e g pollutant transport in soil radioactive waste storage in the underground construction engineering e g moisture transport control hydrogeology e g water circulation in aquifers contaminant dispersion at the subsurface water treatment etc other applications are relevant to chemistry and physical chemistry such as in catalysis and chromatography but also in less expected fields such as bio nanomedicine e g drug delivery using encapsulating media fluid transport in porous media i e carrier fluids and mass transport i e pollutants bear and cheng 2010 surfactants kwok et al 1993 1995 through flowing fluids such as water oil and air are often impacted by different phenomena such as adsorption and chemical reactions rolle and le borgne 2019 for purification applications in particular understanding the transport of pollutants inside different porous media remains a complex task as pollutants can adsorb to the solid surface following specific underlying adsorption kinetics manoranjan and stauffer 1996 appadu 2016 if these adsorbates are in contact long enough with the adsorbent a local equilibrium is reached between the adsorbed molecules and the molecules transported in solution understanding such coupling between transport and adsorption kinetics is part of many research projects bear 2018 wu and zhang 2016 ichikawa and selvadurai 2012 coasne 2016 roque malherbe 2018 levesque et al 2012 2013 vanson et al 2015 2017b a but further understanding especially in the case of more complex molecules is crucially needed to develop and improve a large number of processes belonging to different domains regardless of the field and application envisaged rationalizing transport in porous media requires to better describe the link between the descriptors that characterize porous media and the fluid flow mechanisms including adsorption within their porosity beyond pioneering works particular attention should be paid to the specific adsorption behavior of complex pollutants in particular surfactants which are used to clean natural water polluted during oil extraction or to depollute industrial sites containing hydrocarbons are a non negligible water pollution source that leads to complex water treatment challenges among other complex compounds micropollutants which are the subject of increasing attention worldwide include microplastics eerkes medrano et al 2015 petersen and hubbart 2021 metals organic pharmaceutical molecules and persistent personal care pollutants all these systems have in common with surfactants to follow physico chemical behaviors that cannot be described using classical adsorption models henry langmuir wolanin et al 2020 2021 in particular they are characterized by aggregation effects and the ability to form structures at interfaces which strongly differ from their volumetric behavior without being fully understood this specific interfacial behavior is known to influence the transport properties of these molecule types in this work by focusing on the coupling between transport and adsorption we illustrate the importance of including this rich and complex behavior which cannot be predicted by conventional approaches in transport equations in porous media upon adding solutes e g surfactants pollutants to a flowing solvent e g water the former tend to disperse in the solid porosity dispersion is the phenomenon that results from the combination of advection and diffusion in porous media sahimi 2012 typically after injection in the long time limit solute particles in the flowing fluid will be dispersed homogeneously therefore understanding the time dependence of particle distributions provides a mean to better design engineering processes and particularly groundwater remediation fluid flow through a porous medium can exhibit a rich behavior as a result of the complexity of the porous structure collision with pore edges and changes in fluid pathways lead to the mixing and re arrangement of the moving particles such dispersion which manifests itself at the macroscopic level results from the simultaneous action of mechanical and macroscopic phenomena fried 1975 payne et al 2008 on the one hand mechanical dispersion results from the fact that the fluid is moving at both higher and lower velocities than the mean velocity fetter 1994 in particular the flowing fluid in the porous medium follows preferential pathways as its transport through small pores is slower than through large pores as a result since particles do not move at the same velocity everywhere significant dispersion is observed along the flow paths in turn such dispersion leads to a broad distribution of solute particles at the flow edge on the other hand macroscopic dispersion corresponds to the spreading of solute particles caused by the heterogeneity at the porous medium scale i e well beyond the pore scale such heterogeneity causes variations in the local permeability that lead to heterogeneous flows with significant spatial variations in the advective velocity field in summary dispersion in porous media is driven by physical parameters characterizing the transport properties of the complex fluid system but also by the main descriptors related to the host porous medium these parameters include the molecular diffusion coefficient of the particles the stokes velocity field of the flowing fluid the kinematic and rheological properties of the fluid in situ viscosity shear effect of the flow and the geometry of the porous medium in particular its porosity and its characteristic interstitial length in conclusion passive tracer transport in porous media is a complex phenomenon and still subject of ongoing research to disentangle the effects of pore structure from those due to a rich adsorption behavior as it is for example the case of pollutants we perform transport simulations of adsorbing molecules in simple pore channels of particular relevance to practical situations using an original numerical strategy transient regimes are thoroughly investigated using such a simple pore geometry their understanding is particularly important for transport in porous media as the effective taylor regime is rarely reached in porous structures understanding transport of these types of molecules in simplified structures allows gaining insights into the coupling between transport and particular adsorption kinetics considering transport processes involving advection diffusion and adsorption phenomena the mass conservation of the solutes transported by the flow in porous media can be described by the so called advection diffusion adsorption equation ada kwok et al 1995 1 c t u c d c 1 ϕ ϕ γ t 0 where c is the concentration of the adsorbing solutes in the liquid phase γ is the amount of adsorbed solutes ϕ is the average porosity u is the velocity vector and d is the dispersion tensor γ is related to the concentration c in the liquid phase under equilibrium and non equilibrium conditions following an underlying adsorption kinetics in the present work we are interested in the modeling of solute adsorption under dynamic conditions i e under flow conditions despite considering transport and adsorption of surfactants we emphasize that the results reported in this contribution can be extended well beyond this specific system in particular we aim at considering how flow transport couple with adsorption kinetics with key questions to be answered regarding the impact on particle dispersion of wall effects i e adsorption desorption phenomena surface diffusion etc berezhkovskii and skvortsov 2013 particularly understanding the coupling in complex porous media between the porous medium structure and adsorption kinetics still requires further understanding coasne et al 2013 galarneau et al 2016 boţan et al 2015 with this goal we use the lattice boltzmann method lbm as recently developed in our group to integrate adsorption kinetics into transport models and to consider different mechanisms involved mass transfer diffusion and adsorption zaafouri et al 2021 lbm which has already been used to simulate complex physical phenomena in porous media among many others gray et al 2016 gray and boek 2016 boek et al 2017 and particularly adsorption processes xu et al 2018 2019 ning et al 2015 sukop and or 2004 agarwal et al 2005 manjhi et al 2006 asta et al 2018 vanson et al 2015 2017b a levesque et al 2013 was shown to be an efficient and robust numerical method to simulate miscible transport of adsorbing molecules with different adsorption kinetics zaafouri et al 2021 in practice our numerical method relies on the two relaxation time scheme batôt et al 2016 ginzburg et al 2010 talon et al 2012 a simple channel geometry consisting of two parallel plates is used to simulate the dispersion of either non adsorbing or adsorbing tracers i e solutes this geometry having dimensions l x l is shown in fig 1 a where the white sites correspond to bulk like regions of the system and the black sites correspond to solid sites in the lbm simulations our geometry is exposed to a fluid flow that obeys a stokes flow u with an average flow rate u the peclet number which characterizes the ratio of advection diffusion phenomena is defined as p e u l d m where we recall that d m is the solute molecular diffusion coefficient at a time t 0 the tracer particles are injected with an initial concentration c 0 such concentration injection can be performed in several ways 1 a concentration is injected as dirac pulse at a specific time at a lateral position in the geometry or 2 a concentration is injected continuously for a fixed time period these two configurations consist in defining a lateral position x x 0 in the geometry and injecting the concentration at this position for a determined period of time δ t 0 n δ t thus as illustrated in fig 1 b according to the specific value of n used the situation refers to a continuous slug injection n 1 or a dirac pulse injection n 1 more precisely for a position r 0 x 0 y we inject tracer particles with the initial concentration c 0 such that c r 0 c 0 over a period δ t 0 n δ t for n 1 fig 1 a schematically illustrates the tracer concentration distribution as a function of time i e tracer dispersion we evaluate the impact of adsorption on the free tracer distribution by studying the displacement variance σ x 2 t along the flow direction x its derivative allows a direct estimation of the effective dispersion coefficient d t where d t d σ x 2 t 2 d t in practice we focus on two specific issues first we investigate the effect of system parameters such as the initial concentration c 0 and the adsorption desorption ratio k of different adsorption models on the transport regimes in this respect we note that while existing works have already considered to some extent such aspects we extend here this investigation to transient regimes such non stationary regimes are very important since as already stated many practical situations show that water and pollutants do not reach taylor dispersion also kahlen et al 2017 showed that the displacement distributions strongly depend on the symmetry or asymmetry of transition rates in a second step we focus on the cooperative adsorption of complex molecules and the resulting transport behavior such aspects are equally important since available works in the literature only consider simple adsorption regimes henry langmuir which fail to describe the adsorption of complex molecules such as micropollutants the remaining of this paper is structured as follows in section 2 we introduce the different adsorption models and present the most important features of the extended lattice boltzmann scheme further information can be found in the supplemental information in section 3 we describe our results for transport obtained upon dirac pulse injection in the case of henry and langmuir adsorption models different adsorption desorption ratios k and initial concentrations c 0 are considered then we compare the results obtained for the different adsorption models upon continuous injection in section 4 we summarize our findings and provide perspectives for further developments and applications 2 methods we are interested in the modeling of surfactant adsorption under dynamic i e flow conditions for certain parameter ranges adsorption considerably impacts the transport of these molecules to gain further insight into the coupling between adsorption and transport of such complex molecules we employ the lattice boltzmann approach introduced in zaafouri et al 2021 which allows considering different adsorption models in more detail we consider the following adsorption mechanisms the henry regime the langmuir regime which accounts for surface adsorption saturation and the cooperative model recently introduced to account for collective adsorption effects zaafouri et al 2020 in what follows we introduce the analytical form of the underlying adsorption kinetics as well as their corresponding lattice boltzmann equations for these different models henry langmuir and cooperative adsorption 2 1 adsorption kinetics henry model with this model the adsorbed amount is assumed to be proportional to the adsorbate concentration in the bulk solution from which adsorption occurs the underlying kinetics leading to the so called henry adsorption isotherm at equilibrium corresponds to 2 γ t k a c γ 0 k d γ where k a and k d are the adsorption and the desorption rates while γ 0 represents a characteristic adsorbed amount the solution resulting from henry adsorption kinetics in eq 2 is given by 3 γ t γ 0 1 e k d t k h c with k h k a k d which results in the following adsorption isotherm γ t γ 0 k h c langmuir model with this model it is assumed that the molecules are adsorbed on well defined sites at the adsorbent surface all sites are considered identical and only one molecule can be adsorbed in each site therefore leading to monomolecular layers only such surface saturation is characteristic of langmuir adsorption the dynamical equilibrium between the molecules that are adsorbed at the surface and those that desorb from the surface is described by the following kinetic equation 4 γ t k a c γ γ k d γ where γ represents the adsorbed amount at surface saturation the solution resulting from the langmuir kinetics in eq 4 is given by 5 γ t 1 e k d 1 k l c t γ k l c 1 k l c where k l k a k d at equilibrium i e in the limit of infinite time the adsorption isotherm becomes γ t γ k l c 1 k l c cooperative model this thermodynamic model captures the collective adsorption behavior of surfactants or any other molecules with strong cooperative effects leading to complex kinetics and structural re arrangement upon adsorption full details on this recent model can be found in zaafouri et al 2020 so that only key elements will be presented here we introduce a surface critical concentration c s below which only adsorption of individual monomers m occurs in this concentration range adsorption follows either the henry or the langmuir model above c s both individual monomers m and aggregated monomers m get adsorbed at the surface sites s as shown in zaafouri et al 2020 the underlying kinetics for the adsorption of aggregated monomers writes 6 γ m c t t k a γ m c γ γ m c β γ m c t k d γ m γ m c t where γ m c t is the surface concentration of aggregated monomers m and γ m c is the surface concentration of individually adsorbed monomers m β presents the fraction of the solid sites occupied by the aggregated monomers the parameters k a γ m and k d γ m are the adsorption and desorption rates depending on the actual surface concentration γ m the solution of this kinetic equation for a bulk concentration c is given by 7 γ m c γ γ m c k γ m c 1 β c k γ m where k γ m k a γ m k d γ m fig 2 shows the experimental adsorption isotherm for surfactant tx100 on silica taken from denoyel and rouquerol 1991 as well as the henry langmuir and cooperative langmuir adsorption isotherms which allow decomposing such adsorption data into individual and aggregated monomers for more detail see zaafouri et al 2020 the model parameters are given in the caption of fig 2 on the one hand for the langmuir model k l provides the best fit of the experimental data above c s on the other hand k h was obtained by fitting the experimental data for c c s data of k γ m is provided in the supplemental information fig s1 2 2 lattice boltzmann before introducing the technical details at the core of our lattice boltzmann scheme we present a quick state of the art on such methods applied to adsorption and transport in porous media among other methods e g appadu 2016 asta et al 2018 hlushkou et al 2014 lattice boltzmann schemes are very suitable for this type of computation as they are highly parallelizable indeed the investigation of transient and stationary transport regimes requires relatively large simulations in time and space guo et al 2016 applied a lattice boltzmann scheme to simulate adsorption characterized by different isotherms likewise xu et al 2018 2019 used a lattice boltzmann method to simulate gas adsorption in nanopores of shale however the latter studies only consider adsorption phenomena of particles transported by pure diffusion ning et al 2015 used a multiple relaxation time lattice boltzmann scheme extended to adsorption phenomena to simulate gas flow in nanopores they were particularly interested in the joint effect of adsorption and gas slippage on gas flow interactions between the adsorbate and the surface were modeled by the so called adsorptive force sukop and or 2004 agarwal et al 2005 and manjhi et al 2006 also investigated the coupling between adsorption and transport in a flowing fluid by considering first order adsorption kinetics simulations were only performed in the henry regime characterized by the proportionality of the bulk concentration and the adsorbed quantity and consequently at low concentrations manjhi et al 2006 used a constant dispersion coefficient in their lattice boltzmann method making the investigation of the effect of adsorption on the different transport regimes difficult further on rotenberg and coworkers levesque et al 2013 vanson et al 2015 asta et al 2018 proposed an extended lattice boltzmann scheme allowing the investigation of the adsorption impact on the behavior of solutes and solvent under flow conditions here adsorption takes place in fluid nodes in direct contact with the nodes of the solid interface they define free and adsorbed concentrations quantities to determine equilibrium properties after each simulation adsorption step their transport computations are based on the moment propagation method ladd and verberg 2001 merks et al 2002 and they introduced propagators for the adsorbed and free concentrations dynamic properties of solute dispersion in a flowing fluid can be determined in this way rotenberg and coworkers were particularly interested in the coupling between adsorption and fluid flow in the stationary long time limit regime once that the thermodynamic equilibrium is attained nevertheless further understanding of transient regimes where the timescale of adsorption might be comparable to the one of dispersion remains crucial particularly in the case of transport in porous media to this goal vanson et al 2017a b extended the numerical scheme proposed by levesque et al 2013 their method now includes langmuir kinetics and allows the simulation of the interplay between adsorption and transport in a kinetics regime however vanson et al do not perform a thorough investigation of the effect of adsorption and system parameters on the transient dispersion regimes also adsorption kinetics of complex molecules such as pollutants are not included in their extended lattice boltzmann approach consequently as mentioned above we focus in this article on two specific subjects the influence of system parameters on the transient regimes and the transport of complex molecules following cooperative adsorption we use a novel lattice boltzmann scheme which enables us to reproduce the thermodynamics and kinetics of adsorption this efficient numerical technique was shown to provide results in very good agreement with analytical solutions levesque et al 2012 detailed validation steps can be found in zaafouri et al 2021 in this article we consider in detail the influence of different adsorption models and their parameters on the interplay between adsorption and transport in porous media in short our lattice boltzmann simulations involve different steps after specification of the pore geometry we first compute stokes flow of the carrier fluid by means of an independent lattice boltzmann simulation in a second step we perform transport simulations of adsorbing molecules in what follows we detail the computational aspects of the adsorption kinetics of tracer molecules coupled to their transport for further information on the standard lattice boltzmann schemes to solve stokes equation and advection diffusion equation including the implementation of boundary conditions the reader is referred to the supplemental information file here we focus the content of this methods section on the main novel technical ingredients which allow including adsorption thermodynamics and kinetics tracers are injected at the beginning of the transport simulation at a specific time t 0 as presented in fig 1 considering these initial conditions we then proceed to the calculation of the adsorption kinetics and transport of the tracer molecules at each time step δ t we perform consecutively the following intermediate steps collision adsorption and propagation to redistribute the free and adsorbed tracers see fig s1 in the supplemental information the system is characterized by the free and adsorbed tracer concentrations respectively c r t and c a r t this means that if there is a solid fluid interface at position r the adsorbed quantity in this position corresponds to c a r t in practice the free tracer concentration is related to the distribution g q r t which corresponds to the free tracer density having a velocity v q along the direction q at time t and position r in all our simulations we use the d2q9 scheme classification whose velocity set includes four coordinate velocities v q 1 0 0 1 four diagonal velocities v q 1 1 and the immobile zero velocity throughout this document these velocity components are denoted v q with q 0 q m 8 the concentration is linked to the density distribution as c r t q g q r t we define the symbols and to refer to quantities obtained after the intermediate collision and adsorption steps consequently c r t q g q r t c r t q g q r t and c r t q g q r t correspond to the free tracer concentrations obtained after the collision adsorption and propagation steps respectively the collision and propagation steps are identical to those used for conventional lattice boltzmann simulations with the two relaxation time scheme to solve the advection diffusion equation as described in the si file free particles follow the classical bounce back boundary condition at the solid liquid interface corresponding to a no slip condition in what follows we will only consider the features related to the adsorption step as it depends on the specific adsorption kinetics under study the adsorption step obeys the first order kinetic equation leading to the adsorption isotherm at equilibrium in the present work as already stated we consider henry langmuir and cooperative adsorption models when performing the adsorption step for a given adsorption model c r t and c a r t vary according to the underlying kinetics equation in practice from the free and adsorbed tracer concentrations c r t and c a r t computed at time t after the collision step the adsorption step yields updated concentrations c r t and c a r t in what follows we provide the kinetic equations for the different adsorption models considered in this work henry adsorption the lattice boltzmann adsorption kinetics for henry adsorption can be written as 8 c a r t p a c r t 1 p d c a r t 9 c r t c r t p a c r t p d c a r t with p a and p d being the adsorption and desorption rates given in lattice boltzmann units values for p a and p d are obtained by mapping the above equation with the physical kinetic equation p a k a δ t δ x and p d k d δ t langmuir adsorption the langmuir adsorption model considers surface saturation as adsorption proceeds this implies that the adsorbed concentration c a r t is always lower than a characteristic surface concentration c a in this case eqs 8 and 9 are modified to take surface saturation into account 10 c a r t p a c r t 1 c a r t c a 1 p d c a r t 11 c r t c r t p a c r t 1 c a r t c a p d c a r t here the maximum surface concentration can be written as γ c a δ x with p a and p d defined as for the henry model p a k a δ t δ x and p d k d δ t cooperative adsorption this advanced model which allows considering the adsorption of complex molecules leading to collective surface effects considers two different adsorbed concentrations the concentration of adsorbed isolated monomers c a m r t and the concentration of adsorbed aggregated monomers c a m r t the overall surface concentration is then obtained by summing these two quantities c a r t c a m r t c a m r t furthermore we assume that the adsorption of isolated monomers is instantaneous compared to that of aggregated monomers c a m r t c a m r t this cooperative model can be implemented in the lattice boltzmann scheme by modifying eqs 8 and 9 12 c a m r t p a c r t 1 β c a m r t c a m r c a 1 p d c a m r t 13 c r t c r t p a c r t 1 β c a m r t c a m r c a p d c a m r t where c a γ δ x p a k a δ t δ x and p d k d δ t and γ m r t c a m r t δ x during the adsorption step unlike for the propagation and collision steps the fraction x q r t g q r t c r t remains constant i e x q r t x q r t x q r t g q r t c r t is the fraction of particles belonging to a velocity set v q at position r and time t based on the definition mentioned above i e c r t q g q r t the variation between the different g q components caused by the adsorption operator 14 a c c a δ c r t c r t c r t is redistributed in a proportional and homogeneous way this means that the molecule distributions g q r t after the adsorption step are given by 15 g q r t g q r t x q r t a c c a all details can be found in zaafouri et al 2021 3 results the present section is organized as follows by considering the injection of a dirac pulse of tracer molecules we will first compare the effect on transport phenomena of molecules adsorbing according to henry and langmuir models we will also treat more specific cases by considering large adsorption constants k h henry adsorption and large initial concentrations c 0 langmuir adsorption finally we will focus on continuous i e slug injection in combination with the different adsorption models 3 1 henry and langmuir adsorption adsorption and transport can be studied by monitoring the time evolution of the concentration fields and of the displacement distributions of the tracer molecules the so called propagators moreover the displacement variance σ x 2 t along the flow direction x allows gaining further information as it provides a direct measurement of the dispersion coefficient d t d σ x 2 t 2 d t the displacement variance scales as σ x 2 t t β the scaling exponent β is equal to one in the case of gaussian transport and β 1 in the transient regimes as shown in zaafouri et al 2021 henry adsorbing and non adsorbing molecules that are transported in a channel successively follow the same three transport regimes molecular diffusion advection dominated transport and taylor dispersion equivalent results can be observed for molecules adsorbing according to the langmuir model fig 3 provides the concentration profiles for the henry and langmuir model whereas fig 4 shows the corresponding propagators at different times t for both models the propagators have a gaussian shape for small t and large t corresponding respectively to the molecular diffusion and taylor dispersion regime owing to adsorption the normalized average displacement in the taylor regime is smaller than the normalized mean fluid displacement x x 0 u t 1 where u is the mean fluid velocity and decreases with time t in the intermediate advection dominated regime t 2 the propagators display a non gaussian shape with a higher probability for larger velocities while molecules following henry adsorption reach rapidly the taylor regime langmuir adsorbing molecules require more time to attain the asymptotic state t 3 this can also be seen in fig 5 where the normalized dispersion coefficient d t d m for the langmuir adsorbing molecules reaches a plateau at larger times corresponding to taylor dispersion we computed the scaling exponent β for both data sets of fig 5 as can be already deduced from the existence of a plateau β is equal to one in the long time limit in the intermediate transient regime it becomes β 1 75 for the henry adsorbing molecules and β 1 58 in the case of langmuir adsorption in this regime advection dominates and the displacement variance evolves faster than in the taylor regime 3 2 influence of k k a k d levesque et al 2012 provided an analytical solution for the effective dispersion coefficient d e f f a d s d m in the case of taylor dispersion of molecules adsorbing according to henry adsorption d e f f a d s d m is defined as the long time limit of d t d m see supplemental information for more details at this stage to our knowledge no analytical solution for taylor dispersion in case of langmuir adsorbing molecules is available fig 6 shows d t d m as predicted using our numerical approach for different adsorption ratios k both data for henry and langmuir adsorption are shown in all cases d t d m reaches a plateau in the long time limit which corresponds to the so called taylor dispersion regime moreover d e f f a d s d m increases with k as the resulting displacement difference between adsorbed and non adsorbed molecules leads to a larger variance d e f f a d s d m for both models which are very close to each other match very well the known analytical solution for henry adsorption however the duration of the intermediate advection dominated regime for the langmuir model increases for higher values of k this difference is due to the fact that the desorbed amount of molecules following the langmuir adsorption isotherm is not directly proportional to the variation in the concentration near the surface as it is the case for the henry adsorption isotherm such an effect is particularly important in the plateau region of the adsorption isotherm moreover while the difference observed between the two adsorption models is very small for small k it becomes more pronounced upon increasing k to large values 3 3 large adsorption desorption ratios as can be seen from fig 6 d t d m for the molecules obeying henry adsorption shows a slight overshoot at the end of the advection regime for k h 10 considering that this effect is not observed for the langmuir model we expect it to be related to the absence of adsorption induced surface saturation to gain insights into this phenomenon we performed simulations using henry s law with a constant initial concentration c 0 10 with various adsorption desorption ratios k h by modifying the adsorption rate parameter p a for constant p d more in detail a constant desorption rate p d 0 001 is used while performing simulations with k h 10 40 100 e g p a 0 01 0 04 0 1 respectively fig 7 shows the normalized time derivative of the displacement variance d t d m as a function of time t upon increasing k h d t d m displays a peak maximum before reaching the dispersive regime however regardless of the value of k h the three main transport regimes are still observed diffusion advection and dispersion the maximum observed in the time evolution of d t d m is specific to the use of adsorbing conditions without surface saturation allowing the adsorption of a very large quantity directly after injection on a time scale that is much shorter than a characteristic time of the transporting fluid moreover as the adsorption rate is much higher than the desorption rate desorption is a slower process to better illustrate this effect fig 8 shows the free and adsorbed tracer concentration fields for different k h the data obtained at t t 2 indicate that the free molecules are distributed according to the poiseuille velocity profile whereas a specific amount of molecules is adsorbed to the surface close to the inlet x 0 as expected the adsorbed amount increases with k h for larger t t t 4 t t 5 and k h 40 and k h 100 one observes two regions characterized by higher concentrations these specific regions correspond to 1 molecules in the center of the channel carried by the velocity field and 2 molecules having been adsorbed to the surface and then released due to the desorption process we note that this effect becomes more pronounced if k h increases as the impact of adsorption becomes more important the existence of these two spatially separated populations explains the overshoot observed in d t d m at larger times t t 6 t t 7 and t t 8 the contrast between the two populations fades out and the concentration in free molecules becomes more homogeneously distributed within the geometry in this asymptotic long time limit d t d m decreases and eventually reaches the plateau value that characterizes the dispersive regime fig 9 shows the normalized propagators p x x 0 u t t for the different systems at specific times t n for t t 2 the system is at the onset of the advective regime where the tracer concentration has been displaced by a small amount only therefore in this short time interval the influence of the adsorption ratio k h is not pronounced as most of the molecules are still located near the injection position x 0 in the advection dominated regime i e for t t 3 t 4 and t 5 the three data sets exhibit more pronounced differences when varying k h the propagators display a plateau for small normalized displacements and a peak for large x x 0 u t however for k h 40 and k h 100 the propagators show an additional peak close to x x 0 u t 0 these peaks at large and small normalized displacements correspond to two different subpopulations 1 non adsorbed molecules transported by the velocity field and 2 molecules adsorbed directly after injection and released later on for t t 4 the propagators obtained with k h 10 are of a quasi gaussian shape which suggests that the end of the advection dominated regime is reached however for k h 40 and k h 100 where d t d m is maximum at t t 4 the adsorption effect on the normalized propagators is still very pronounced for these cases the advection dominated regime ends at a larger time for t t 6 the data for k h 10 correspond to a propagator that has a nearly gaussian shape in contrast owing to more significant adsorption effects the data for k h 40 and 100 correspond to an asymmetric propagator which has not yet reached a gaussian shape for t t 7 all propagators become closer to ideal gaussian distributions but the differences observed between the data sets reflect the effect of the adsorption desorption ratio k h propagators are shifted to the left with respect to non adsorbing conditions with a shift that increases upon increasing the adsorption desorption ratio these results further indicate that adsorption drastically delays tracer dispersion in porous media 3 4 influence of initial concentration c 0 in this section we assess the influence of the initial concentration c 0 on the dispersion of molecules adsorbing according to the langmuir adsorption model as can be inferred from the known analytical solution d t d m of molecules adsorbing according to henry s law is independent of c 0 due to the fact that this simple model does not account for surface saturation in contrast with the langmuir adsorption model we expect an important impact of the initial concentration on tracer dispersion in adsorbing conditions in a first step we investigate the time evolution of d t d m for c 0 10 20 30 then we vary c 0 from 10 to 1000 to study the influence of higher initial concentrations on d t d m but also on the concentration fields and associated propagators fig 10 presents d t d m for molecules adsorbing according to henry and langmuir adsorption isotherms with different adsorption desorption rates k k l k h different initial concentrations c 0 10 20 30 were considered for the calculations with the langmuir adsorption isotherm as can be seen the dispersion of tracer molecules following the langmuir adsorption model shows a marked c 0 dependency such dependency becomes more pronounced for larger c 0 and k moreover for large k the difference between the langmuir and henry models becomes more important to disentangle the influence of the initial concentration c 0 from the effect of k we normalize d t with respect to its value in the infinite time limit d t we present d t in the supplemental information as obtained with k 0 5 and k 1 these results indicate that the difference between the henry model and the different langmuir adsorption models is more pronounced for k 1 than for k 0 5 therefore suggesting that the effect of the initial concentration c 0 on the langmuir adsorption is more pronounced when using a higher adsorption desorption ratio k finally it can be seen from fig 10 that d t d m for k 10 and c 0 10 20 30 does not reach the taylor dispersion plateau in the investigated time range fig 11 shows the time evolution of the free tracer concentration field along the normalized x axis x x 0 u t for molecules adsorbing according to the langmuir adsorption model we also show the corresponding normalized propagators for the following initial concentrations c 0 10 30 500 with k l 10 and γ 1 in fig 12 fig 11 shows that the concentration field for c 0 10 at t t 1 is strongly affected by adsorption as the two subpopulations corresponding to transported non adsorbed molecules and to adsorbed then released molecules can be observed as can be seen from these data a non negligible part of the molecules are delayed due to adsorption however for c 0 500 at t t 1 the concentration field is barely affected by the velocity field which obeys a poiseuille flow profile due to surface saturation only a certain amount of molecules independent of the initial concentration is adsorbed at the surface for t t 2 the spreading of the concentration around the mean position becomes more symmetrical particularly for c 0 10 and c 0 30 as can be seen from the propagators in fig 12 for t t 4 and t t 5 in the case of low initial concentrations the dispersion regime is reached as the propagators display a gaussian shape moreover the propagators are shifted towards smaller normalized displacements due to adsorption however for t t 3 when large initial concentrations c 0 are considered the onset of tailing of the concentration fields and propagators for smaller x x 0 u t can be observed tailing which corresponds to spreading of molecules far behind the tracer front is due to the desorption of the initially adsorbed molecules however at this instant the propagator center is located at x x 0 u t 1 with a nearly gaussian shape resulting from the fact that most molecules were not yet adsorbed due to adsorption limitations induced by surface saturation in contrast for larger t tailing becomes more pronounced and the propagator shape is clearly not gaussian to gain further insight into the influence of large c 0 on transport of adsorbing molecules we present in fig 13 the time evolution of d t d m for a large range of initial concentrations for low concentrations i e c 0 10 100 the typical transport regimes are observed upon increasing the initial concentration i e for c 0 75 and c 0 100 the advective regime extends over a longer time so that the time required to reach the dispersive regime becomes longer this effect is due to the shape of the langmuir adsorption isotherm which involves larger concentration variations leading to adsorption equilibrium for systems with larger initial concentrations i e for c 0 200 the time evolution of d t d m is different than at lower initial concentrations we notice that the advective regime is divided into two stages which are separated by a short stationary regime small plateau the latter regime which corresponds to the onset of the taylor dispersion regime can be explained by the fact that the concentration of free not yet adsorbed tracers in the bulk is very high with γ 1 the impact of the adsorbed molecules on the displacement variance of the free molecules is negligible at the beginning of the transport process at larger times the free tracers get dispersed in the channel so that their concentration becomes comparable to the concentration of molecules that were already adsorbed as a result the effect of adsorption on transport becomes more important and d t d m increases until reaching the asymptotic dispersion regime at very long times 3 5 cooperative model upon continuous injection in this section we compare the transport of molecules adsorbing according to the henry and langmuir models with that observed for molecules adsorbing according to the cooperative model to do so we consider an advanced thermodynamic model that was developed recently to describe adsorption of self aggregating molecules such as surfactants on silica zaafouri et al 2020 as described above this cooperative adsorption model allows describing the adsorption of individual and aggregated monomers on the one hand the adsorption of individual monomers follows henry s law with an adsorption desorption ratio k h maximal surface saturation of individual monomers is reached at the critical micellar concentration cmc above the cmc the adsorbed quantity of individual monomers remains constant if the concentration is higher than the so called critical surface concentration c s in the present case we have c s c m c aggregated monomers adsorb at the surface following a surface concentration dependent adsorption desorption ratio k γ m to avoid the drastic concentration decrease observed upon a dirac pulse injection we use here a continuous injection over a certain time as described before data for dirac pulse injection in combination with the henry and cooperative adsorption models are given in the supplemental information file in practice the peclet number is p e 100 and an initial concentration c 0 1000 is injected at a lateral position x 0 1 over a time period δ t 0 1 0 5 δ t the parameters for the henry langmuir and cooperative models are given in fig 2 and fig s1 supplemental information file fig 14 shows the adsorbed amount γ x as a function of the lateral position for the henry langmuir and cooperative models at different times as well as the surface and bulk concentrations γ x for the langmuir model already increases for very low surface concentrations due to the spreading of the concentration over time the total adsorbed amount x γ x t d x becomes very important in contrast to this model γ x for the cooperative model follows γ x observed for the henry model in the low concentration regime for c s u r f c s a strong increase in γ x can be observed due to the cooperative effect at play upon aggregated monomer adsorption then for even larger c s u r f the curve flattens following the plateau region of the adsorption isotherm the total amount of adsorbed molecules is lower than for the langmuir model fig 15 shows x γ x t d x for both models as can be seen x γ x t d x for the langmuir model increases rapidly and does not reach a constant limit fig 15 fig 16 shows the difference in bulk concentration between the to models c b u l k l c c b u l k l at different times whereas the bulk concentration of the cooperative model particularly decreases in the center of the concentration profile bulk concentration of the langmuir model decreases in the front and the tail of the concentration profile due to the adsorption at lower concentrations 4 conclusion we investigated the interplay between surfactant adsorption kinetics and transport using a lattice boltzmann method within the two relaxation time approach this method ensures that accurate results are obtained for molecule transport in simple and complex pore geometries we focused on two principal subjects first the different transport regimes and particularly the transient regimes whose understanding is crucial for the description and prediction of transport of adsorbing molecules in porous media to this goal we studied the influence of system parameters such as the initial concentration c 0 and the adsorption desorption ratio k on the temporal coupling between transport and adsorption second we presented transport of complex molecules as for example micropollutants and surfactants whose adsorption behavior is dominated by cooperative effects transient regimes and their dependence on system parameters in the pore geometry the dispersion of adsorbing molecules that obey the henry adsorption model follows the same qualitative evolution for d t d m as that for non adsorbing molecules more in detail the three following regimes are observed diffusion advection dominated transport and dispersion interestingly the transport of adsorbing molecules leads to a dispersive regime with an effective dispersion coefficient that is larger than that for non adsorbing molecules this is due to adsorption conditions at the surface of the parallel plate geometry which leads to an increase in the displacement variance σ x 2 t in the x direction flow direction moreover the adsorption desorption ratio k h is found to significantly affect the observed transport regimes since large k h yield strong adsorption effects near the lateral injection position due to the linearity between the concentration and the adsorbed quantity in the henry model the corresponding large adsorbed amount remains trapped at the surface over long residence times in practice this leads to the appearance of an additional step during the advection dominated regime the increase in the displacement variance d t d m reaches a maximum before decreasing to its asymptotic value as adsorbed and free molecules get redistributed exchanged to study the influence of surface saturation we modeled in a second part the transport of molecules obeying the langmuir adsorption model the results show that the initial concentration c 0 has an important effect on the transport regimes moreover we also found that this dependence on initial concentration is more pronounced as the adsorption desorption ratio k increases this effect arises during the advection dominated regime which extends over longer times with a significant increase in the effective dispersion coefficient using large initial concentrations c 0 200 the advection regime consists of two stages which are connected by a stationary regime during the first stage the free molecule distribution is not affected by adsorption as an intermediate stationary regime is reached for d t d m this regime corresponds to the taylor dispersion regime then during the second stage d t d m increases until it reaches the dispersion regime with a value characteristic of the transport of the molecules adsorbing according to the langmuir adsorption model this effect is due to the strong contrast between the free and adsorbed tracer concentrations cooperative adsorption finally considering dirac pulse injection with a cooperative adsorption model we studied the influence of such a collective behavior at concentrations larger than the critical surface concentration c s however even for a large initial concentration c 0 owing to such cooperative adsorption the bulk concentration decreases quickly after injection so that the surface concentration is always in the henry regime where only monomer adsorption occurs to extend our study to more relevant regimes we therefore performed simulations with continuous concentration injection by monitoring the evolution of the adsorbed amounts corresponding to isolated and aggregated monomers γ m x t and γ m x t we checked the accuracy validity of the kinetics implementation for the cooperative adsorption model in the lbm trt algorithm important differences between the adsorption models could be observed in the temporal evolution of the concentration profiles and the total adsorbed amount indeed the total amount of adsorbed molecules estimated by the langmuir model is much larger than the one of the cooperative model as it does not account for separated monomer and aggregate adsorption in this case spreading of the tracer distribution due to dispersion leads to very large adsorbed amounts in conclusion our findings illustrate the stringent need to include specific adsorption modeling including system parameters coherent with experimental data into transport models to obtain a physically consistent adsorption transport behavior indeed we have shown that system parameters as well as the type of adsorption model strongly influence the transient transport regimes and hence the temporal and spatial concentration distribution such understanding provides crucial help to rationalize transport behavior of molecules subject to adsorption in porous media consequently in the context of water remediation simulations in the presence of surfactants and or micro pollutants microplastics metals pharmaceutical molecules and ppcp it is crucial to include a robust thermodynamic adsorption model specific for each molecule which allows taking into account the rich and complex physicochemical behavior of these molecules in future works a challenging task will consist of investigating the coupling between transport and adsorption in more complex porous structures indeed the heterogeneity of the porous medium induces a specific velocity field with high and low velocity zones and hence a more complex dispersion behavior that influences adsorption in practice this implies that different characteristic times in the velocity field compete with relevant adsorption rates the knowledge of the macroscopic transport equations therefore becomes crucial in the context of the description of pollutant transport in porous media declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper appendix a supplementary data supplementary material related to this article can be found online at https doi org 10 1016 j advwatres 2022 104143 appendix a supplementary data the following is the supplementary material related to this article fig s1 the si file provides data of the cooperative model lbm schemes to solve stokes and ad equations and further adsorption simulation results 
177,we investigate the strong impact of adsorption thermodynamics and kinetics on particle dispersion using a robust numerical scheme lattice boltzmann simulation within the two relaxation time framework by modeling the transport of both non adsorbing and adsorbing molecules in simple pore structures we highlight the key role played by the adsorption desorption ratio k and the initial concentration c 0 for different adsorption models henry langmuir etc considering small k or c 0 leads to small or negligible adsorption impact on transport however for larger values adsorption significantly alters transport as it drastically increases the dispersion of the adsorbing particles within the confining geometry our results highlight the need to include a robust thermodynamic modeling framework in transport equations when considering complex pollutants as they display a rich and complex physicochemical behavior this includes surfactants which are at the core of the present work but also molecules of emerging concern such as heavy metals microplastics pharmaceuticals etc as illustrated here with complex interfacial effects large deviations can be observed in both the predicted adsorbed amounts and transport dispersion coefficients when compared to molecules with more conventional adsorption properties keywords dispersion adsorption kinetics transient regime cooperative adsorption lattice boltzmann trt 1 introduction transport in a porous medium is relevant to a large body of domains and applications such as reservoir engineering e g hydrocarbon transport in rocks geoscience e g pollutant transport in soil radioactive waste storage in the underground construction engineering e g moisture transport control hydrogeology e g water circulation in aquifers contaminant dispersion at the subsurface water treatment etc other applications are relevant to chemistry and physical chemistry such as in catalysis and chromatography but also in less expected fields such as bio nanomedicine e g drug delivery using encapsulating media fluid transport in porous media i e carrier fluids and mass transport i e pollutants bear and cheng 2010 surfactants kwok et al 1993 1995 through flowing fluids such as water oil and air are often impacted by different phenomena such as adsorption and chemical reactions rolle and le borgne 2019 for purification applications in particular understanding the transport of pollutants inside different porous media remains a complex task as pollutants can adsorb to the solid surface following specific underlying adsorption kinetics manoranjan and stauffer 1996 appadu 2016 if these adsorbates are in contact long enough with the adsorbent a local equilibrium is reached between the adsorbed molecules and the molecules transported in solution understanding such coupling between transport and adsorption kinetics is part of many research projects bear 2018 wu and zhang 2016 ichikawa and selvadurai 2012 coasne 2016 roque malherbe 2018 levesque et al 2012 2013 vanson et al 2015 2017b a but further understanding especially in the case of more complex molecules is crucially needed to develop and improve a large number of processes belonging to different domains regardless of the field and application envisaged rationalizing transport in porous media requires to better describe the link between the descriptors that characterize porous media and the fluid flow mechanisms including adsorption within their porosity beyond pioneering works particular attention should be paid to the specific adsorption behavior of complex pollutants in particular surfactants which are used to clean natural water polluted during oil extraction or to depollute industrial sites containing hydrocarbons are a non negligible water pollution source that leads to complex water treatment challenges among other complex compounds micropollutants which are the subject of increasing attention worldwide include microplastics eerkes medrano et al 2015 petersen and hubbart 2021 metals organic pharmaceutical molecules and persistent personal care pollutants all these systems have in common with surfactants to follow physico chemical behaviors that cannot be described using classical adsorption models henry langmuir wolanin et al 2020 2021 in particular they are characterized by aggregation effects and the ability to form structures at interfaces which strongly differ from their volumetric behavior without being fully understood this specific interfacial behavior is known to influence the transport properties of these molecule types in this work by focusing on the coupling between transport and adsorption we illustrate the importance of including this rich and complex behavior which cannot be predicted by conventional approaches in transport equations in porous media upon adding solutes e g surfactants pollutants to a flowing solvent e g water the former tend to disperse in the solid porosity dispersion is the phenomenon that results from the combination of advection and diffusion in porous media sahimi 2012 typically after injection in the long time limit solute particles in the flowing fluid will be dispersed homogeneously therefore understanding the time dependence of particle distributions provides a mean to better design engineering processes and particularly groundwater remediation fluid flow through a porous medium can exhibit a rich behavior as a result of the complexity of the porous structure collision with pore edges and changes in fluid pathways lead to the mixing and re arrangement of the moving particles such dispersion which manifests itself at the macroscopic level results from the simultaneous action of mechanical and macroscopic phenomena fried 1975 payne et al 2008 on the one hand mechanical dispersion results from the fact that the fluid is moving at both higher and lower velocities than the mean velocity fetter 1994 in particular the flowing fluid in the porous medium follows preferential pathways as its transport through small pores is slower than through large pores as a result since particles do not move at the same velocity everywhere significant dispersion is observed along the flow paths in turn such dispersion leads to a broad distribution of solute particles at the flow edge on the other hand macroscopic dispersion corresponds to the spreading of solute particles caused by the heterogeneity at the porous medium scale i e well beyond the pore scale such heterogeneity causes variations in the local permeability that lead to heterogeneous flows with significant spatial variations in the advective velocity field in summary dispersion in porous media is driven by physical parameters characterizing the transport properties of the complex fluid system but also by the main descriptors related to the host porous medium these parameters include the molecular diffusion coefficient of the particles the stokes velocity field of the flowing fluid the kinematic and rheological properties of the fluid in situ viscosity shear effect of the flow and the geometry of the porous medium in particular its porosity and its characteristic interstitial length in conclusion passive tracer transport in porous media is a complex phenomenon and still subject of ongoing research to disentangle the effects of pore structure from those due to a rich adsorption behavior as it is for example the case of pollutants we perform transport simulations of adsorbing molecules in simple pore channels of particular relevance to practical situations using an original numerical strategy transient regimes are thoroughly investigated using such a simple pore geometry their understanding is particularly important for transport in porous media as the effective taylor regime is rarely reached in porous structures understanding transport of these types of molecules in simplified structures allows gaining insights into the coupling between transport and particular adsorption kinetics considering transport processes involving advection diffusion and adsorption phenomena the mass conservation of the solutes transported by the flow in porous media can be described by the so called advection diffusion adsorption equation ada kwok et al 1995 1 c t u c d c 1 ϕ ϕ γ t 0 where c is the concentration of the adsorbing solutes in the liquid phase γ is the amount of adsorbed solutes ϕ is the average porosity u is the velocity vector and d is the dispersion tensor γ is related to the concentration c in the liquid phase under equilibrium and non equilibrium conditions following an underlying adsorption kinetics in the present work we are interested in the modeling of solute adsorption under dynamic conditions i e under flow conditions despite considering transport and adsorption of surfactants we emphasize that the results reported in this contribution can be extended well beyond this specific system in particular we aim at considering how flow transport couple with adsorption kinetics with key questions to be answered regarding the impact on particle dispersion of wall effects i e adsorption desorption phenomena surface diffusion etc berezhkovskii and skvortsov 2013 particularly understanding the coupling in complex porous media between the porous medium structure and adsorption kinetics still requires further understanding coasne et al 2013 galarneau et al 2016 boţan et al 2015 with this goal we use the lattice boltzmann method lbm as recently developed in our group to integrate adsorption kinetics into transport models and to consider different mechanisms involved mass transfer diffusion and adsorption zaafouri et al 2021 lbm which has already been used to simulate complex physical phenomena in porous media among many others gray et al 2016 gray and boek 2016 boek et al 2017 and particularly adsorption processes xu et al 2018 2019 ning et al 2015 sukop and or 2004 agarwal et al 2005 manjhi et al 2006 asta et al 2018 vanson et al 2015 2017b a levesque et al 2013 was shown to be an efficient and robust numerical method to simulate miscible transport of adsorbing molecules with different adsorption kinetics zaafouri et al 2021 in practice our numerical method relies on the two relaxation time scheme batôt et al 2016 ginzburg et al 2010 talon et al 2012 a simple channel geometry consisting of two parallel plates is used to simulate the dispersion of either non adsorbing or adsorbing tracers i e solutes this geometry having dimensions l x l is shown in fig 1 a where the white sites correspond to bulk like regions of the system and the black sites correspond to solid sites in the lbm simulations our geometry is exposed to a fluid flow that obeys a stokes flow u with an average flow rate u the peclet number which characterizes the ratio of advection diffusion phenomena is defined as p e u l d m where we recall that d m is the solute molecular diffusion coefficient at a time t 0 the tracer particles are injected with an initial concentration c 0 such concentration injection can be performed in several ways 1 a concentration is injected as dirac pulse at a specific time at a lateral position in the geometry or 2 a concentration is injected continuously for a fixed time period these two configurations consist in defining a lateral position x x 0 in the geometry and injecting the concentration at this position for a determined period of time δ t 0 n δ t thus as illustrated in fig 1 b according to the specific value of n used the situation refers to a continuous slug injection n 1 or a dirac pulse injection n 1 more precisely for a position r 0 x 0 y we inject tracer particles with the initial concentration c 0 such that c r 0 c 0 over a period δ t 0 n δ t for n 1 fig 1 a schematically illustrates the tracer concentration distribution as a function of time i e tracer dispersion we evaluate the impact of adsorption on the free tracer distribution by studying the displacement variance σ x 2 t along the flow direction x its derivative allows a direct estimation of the effective dispersion coefficient d t where d t d σ x 2 t 2 d t in practice we focus on two specific issues first we investigate the effect of system parameters such as the initial concentration c 0 and the adsorption desorption ratio k of different adsorption models on the transport regimes in this respect we note that while existing works have already considered to some extent such aspects we extend here this investigation to transient regimes such non stationary regimes are very important since as already stated many practical situations show that water and pollutants do not reach taylor dispersion also kahlen et al 2017 showed that the displacement distributions strongly depend on the symmetry or asymmetry of transition rates in a second step we focus on the cooperative adsorption of complex molecules and the resulting transport behavior such aspects are equally important since available works in the literature only consider simple adsorption regimes henry langmuir which fail to describe the adsorption of complex molecules such as micropollutants the remaining of this paper is structured as follows in section 2 we introduce the different adsorption models and present the most important features of the extended lattice boltzmann scheme further information can be found in the supplemental information in section 3 we describe our results for transport obtained upon dirac pulse injection in the case of henry and langmuir adsorption models different adsorption desorption ratios k and initial concentrations c 0 are considered then we compare the results obtained for the different adsorption models upon continuous injection in section 4 we summarize our findings and provide perspectives for further developments and applications 2 methods we are interested in the modeling of surfactant adsorption under dynamic i e flow conditions for certain parameter ranges adsorption considerably impacts the transport of these molecules to gain further insight into the coupling between adsorption and transport of such complex molecules we employ the lattice boltzmann approach introduced in zaafouri et al 2021 which allows considering different adsorption models in more detail we consider the following adsorption mechanisms the henry regime the langmuir regime which accounts for surface adsorption saturation and the cooperative model recently introduced to account for collective adsorption effects zaafouri et al 2020 in what follows we introduce the analytical form of the underlying adsorption kinetics as well as their corresponding lattice boltzmann equations for these different models henry langmuir and cooperative adsorption 2 1 adsorption kinetics henry model with this model the adsorbed amount is assumed to be proportional to the adsorbate concentration in the bulk solution from which adsorption occurs the underlying kinetics leading to the so called henry adsorption isotherm at equilibrium corresponds to 2 γ t k a c γ 0 k d γ where k a and k d are the adsorption and the desorption rates while γ 0 represents a characteristic adsorbed amount the solution resulting from henry adsorption kinetics in eq 2 is given by 3 γ t γ 0 1 e k d t k h c with k h k a k d which results in the following adsorption isotherm γ t γ 0 k h c langmuir model with this model it is assumed that the molecules are adsorbed on well defined sites at the adsorbent surface all sites are considered identical and only one molecule can be adsorbed in each site therefore leading to monomolecular layers only such surface saturation is characteristic of langmuir adsorption the dynamical equilibrium between the molecules that are adsorbed at the surface and those that desorb from the surface is described by the following kinetic equation 4 γ t k a c γ γ k d γ where γ represents the adsorbed amount at surface saturation the solution resulting from the langmuir kinetics in eq 4 is given by 5 γ t 1 e k d 1 k l c t γ k l c 1 k l c where k l k a k d at equilibrium i e in the limit of infinite time the adsorption isotherm becomes γ t γ k l c 1 k l c cooperative model this thermodynamic model captures the collective adsorption behavior of surfactants or any other molecules with strong cooperative effects leading to complex kinetics and structural re arrangement upon adsorption full details on this recent model can be found in zaafouri et al 2020 so that only key elements will be presented here we introduce a surface critical concentration c s below which only adsorption of individual monomers m occurs in this concentration range adsorption follows either the henry or the langmuir model above c s both individual monomers m and aggregated monomers m get adsorbed at the surface sites s as shown in zaafouri et al 2020 the underlying kinetics for the adsorption of aggregated monomers writes 6 γ m c t t k a γ m c γ γ m c β γ m c t k d γ m γ m c t where γ m c t is the surface concentration of aggregated monomers m and γ m c is the surface concentration of individually adsorbed monomers m β presents the fraction of the solid sites occupied by the aggregated monomers the parameters k a γ m and k d γ m are the adsorption and desorption rates depending on the actual surface concentration γ m the solution of this kinetic equation for a bulk concentration c is given by 7 γ m c γ γ m c k γ m c 1 β c k γ m where k γ m k a γ m k d γ m fig 2 shows the experimental adsorption isotherm for surfactant tx100 on silica taken from denoyel and rouquerol 1991 as well as the henry langmuir and cooperative langmuir adsorption isotherms which allow decomposing such adsorption data into individual and aggregated monomers for more detail see zaafouri et al 2020 the model parameters are given in the caption of fig 2 on the one hand for the langmuir model k l provides the best fit of the experimental data above c s on the other hand k h was obtained by fitting the experimental data for c c s data of k γ m is provided in the supplemental information fig s1 2 2 lattice boltzmann before introducing the technical details at the core of our lattice boltzmann scheme we present a quick state of the art on such methods applied to adsorption and transport in porous media among other methods e g appadu 2016 asta et al 2018 hlushkou et al 2014 lattice boltzmann schemes are very suitable for this type of computation as they are highly parallelizable indeed the investigation of transient and stationary transport regimes requires relatively large simulations in time and space guo et al 2016 applied a lattice boltzmann scheme to simulate adsorption characterized by different isotherms likewise xu et al 2018 2019 used a lattice boltzmann method to simulate gas adsorption in nanopores of shale however the latter studies only consider adsorption phenomena of particles transported by pure diffusion ning et al 2015 used a multiple relaxation time lattice boltzmann scheme extended to adsorption phenomena to simulate gas flow in nanopores they were particularly interested in the joint effect of adsorption and gas slippage on gas flow interactions between the adsorbate and the surface were modeled by the so called adsorptive force sukop and or 2004 agarwal et al 2005 and manjhi et al 2006 also investigated the coupling between adsorption and transport in a flowing fluid by considering first order adsorption kinetics simulations were only performed in the henry regime characterized by the proportionality of the bulk concentration and the adsorbed quantity and consequently at low concentrations manjhi et al 2006 used a constant dispersion coefficient in their lattice boltzmann method making the investigation of the effect of adsorption on the different transport regimes difficult further on rotenberg and coworkers levesque et al 2013 vanson et al 2015 asta et al 2018 proposed an extended lattice boltzmann scheme allowing the investigation of the adsorption impact on the behavior of solutes and solvent under flow conditions here adsorption takes place in fluid nodes in direct contact with the nodes of the solid interface they define free and adsorbed concentrations quantities to determine equilibrium properties after each simulation adsorption step their transport computations are based on the moment propagation method ladd and verberg 2001 merks et al 2002 and they introduced propagators for the adsorbed and free concentrations dynamic properties of solute dispersion in a flowing fluid can be determined in this way rotenberg and coworkers were particularly interested in the coupling between adsorption and fluid flow in the stationary long time limit regime once that the thermodynamic equilibrium is attained nevertheless further understanding of transient regimes where the timescale of adsorption might be comparable to the one of dispersion remains crucial particularly in the case of transport in porous media to this goal vanson et al 2017a b extended the numerical scheme proposed by levesque et al 2013 their method now includes langmuir kinetics and allows the simulation of the interplay between adsorption and transport in a kinetics regime however vanson et al do not perform a thorough investigation of the effect of adsorption and system parameters on the transient dispersion regimes also adsorption kinetics of complex molecules such as pollutants are not included in their extended lattice boltzmann approach consequently as mentioned above we focus in this article on two specific subjects the influence of system parameters on the transient regimes and the transport of complex molecules following cooperative adsorption we use a novel lattice boltzmann scheme which enables us to reproduce the thermodynamics and kinetics of adsorption this efficient numerical technique was shown to provide results in very good agreement with analytical solutions levesque et al 2012 detailed validation steps can be found in zaafouri et al 2021 in this article we consider in detail the influence of different adsorption models and their parameters on the interplay between adsorption and transport in porous media in short our lattice boltzmann simulations involve different steps after specification of the pore geometry we first compute stokes flow of the carrier fluid by means of an independent lattice boltzmann simulation in a second step we perform transport simulations of adsorbing molecules in what follows we detail the computational aspects of the adsorption kinetics of tracer molecules coupled to their transport for further information on the standard lattice boltzmann schemes to solve stokes equation and advection diffusion equation including the implementation of boundary conditions the reader is referred to the supplemental information file here we focus the content of this methods section on the main novel technical ingredients which allow including adsorption thermodynamics and kinetics tracers are injected at the beginning of the transport simulation at a specific time t 0 as presented in fig 1 considering these initial conditions we then proceed to the calculation of the adsorption kinetics and transport of the tracer molecules at each time step δ t we perform consecutively the following intermediate steps collision adsorption and propagation to redistribute the free and adsorbed tracers see fig s1 in the supplemental information the system is characterized by the free and adsorbed tracer concentrations respectively c r t and c a r t this means that if there is a solid fluid interface at position r the adsorbed quantity in this position corresponds to c a r t in practice the free tracer concentration is related to the distribution g q r t which corresponds to the free tracer density having a velocity v q along the direction q at time t and position r in all our simulations we use the d2q9 scheme classification whose velocity set includes four coordinate velocities v q 1 0 0 1 four diagonal velocities v q 1 1 and the immobile zero velocity throughout this document these velocity components are denoted v q with q 0 q m 8 the concentration is linked to the density distribution as c r t q g q r t we define the symbols and to refer to quantities obtained after the intermediate collision and adsorption steps consequently c r t q g q r t c r t q g q r t and c r t q g q r t correspond to the free tracer concentrations obtained after the collision adsorption and propagation steps respectively the collision and propagation steps are identical to those used for conventional lattice boltzmann simulations with the two relaxation time scheme to solve the advection diffusion equation as described in the si file free particles follow the classical bounce back boundary condition at the solid liquid interface corresponding to a no slip condition in what follows we will only consider the features related to the adsorption step as it depends on the specific adsorption kinetics under study the adsorption step obeys the first order kinetic equation leading to the adsorption isotherm at equilibrium in the present work as already stated we consider henry langmuir and cooperative adsorption models when performing the adsorption step for a given adsorption model c r t and c a r t vary according to the underlying kinetics equation in practice from the free and adsorbed tracer concentrations c r t and c a r t computed at time t after the collision step the adsorption step yields updated concentrations c r t and c a r t in what follows we provide the kinetic equations for the different adsorption models considered in this work henry adsorption the lattice boltzmann adsorption kinetics for henry adsorption can be written as 8 c a r t p a c r t 1 p d c a r t 9 c r t c r t p a c r t p d c a r t with p a and p d being the adsorption and desorption rates given in lattice boltzmann units values for p a and p d are obtained by mapping the above equation with the physical kinetic equation p a k a δ t δ x and p d k d δ t langmuir adsorption the langmuir adsorption model considers surface saturation as adsorption proceeds this implies that the adsorbed concentration c a r t is always lower than a characteristic surface concentration c a in this case eqs 8 and 9 are modified to take surface saturation into account 10 c a r t p a c r t 1 c a r t c a 1 p d c a r t 11 c r t c r t p a c r t 1 c a r t c a p d c a r t here the maximum surface concentration can be written as γ c a δ x with p a and p d defined as for the henry model p a k a δ t δ x and p d k d δ t cooperative adsorption this advanced model which allows considering the adsorption of complex molecules leading to collective surface effects considers two different adsorbed concentrations the concentration of adsorbed isolated monomers c a m r t and the concentration of adsorbed aggregated monomers c a m r t the overall surface concentration is then obtained by summing these two quantities c a r t c a m r t c a m r t furthermore we assume that the adsorption of isolated monomers is instantaneous compared to that of aggregated monomers c a m r t c a m r t this cooperative model can be implemented in the lattice boltzmann scheme by modifying eqs 8 and 9 12 c a m r t p a c r t 1 β c a m r t c a m r c a 1 p d c a m r t 13 c r t c r t p a c r t 1 β c a m r t c a m r c a p d c a m r t where c a γ δ x p a k a δ t δ x and p d k d δ t and γ m r t c a m r t δ x during the adsorption step unlike for the propagation and collision steps the fraction x q r t g q r t c r t remains constant i e x q r t x q r t x q r t g q r t c r t is the fraction of particles belonging to a velocity set v q at position r and time t based on the definition mentioned above i e c r t q g q r t the variation between the different g q components caused by the adsorption operator 14 a c c a δ c r t c r t c r t is redistributed in a proportional and homogeneous way this means that the molecule distributions g q r t after the adsorption step are given by 15 g q r t g q r t x q r t a c c a all details can be found in zaafouri et al 2021 3 results the present section is organized as follows by considering the injection of a dirac pulse of tracer molecules we will first compare the effect on transport phenomena of molecules adsorbing according to henry and langmuir models we will also treat more specific cases by considering large adsorption constants k h henry adsorption and large initial concentrations c 0 langmuir adsorption finally we will focus on continuous i e slug injection in combination with the different adsorption models 3 1 henry and langmuir adsorption adsorption and transport can be studied by monitoring the time evolution of the concentration fields and of the displacement distributions of the tracer molecules the so called propagators moreover the displacement variance σ x 2 t along the flow direction x allows gaining further information as it provides a direct measurement of the dispersion coefficient d t d σ x 2 t 2 d t the displacement variance scales as σ x 2 t t β the scaling exponent β is equal to one in the case of gaussian transport and β 1 in the transient regimes as shown in zaafouri et al 2021 henry adsorbing and non adsorbing molecules that are transported in a channel successively follow the same three transport regimes molecular diffusion advection dominated transport and taylor dispersion equivalent results can be observed for molecules adsorbing according to the langmuir model fig 3 provides the concentration profiles for the henry and langmuir model whereas fig 4 shows the corresponding propagators at different times t for both models the propagators have a gaussian shape for small t and large t corresponding respectively to the molecular diffusion and taylor dispersion regime owing to adsorption the normalized average displacement in the taylor regime is smaller than the normalized mean fluid displacement x x 0 u t 1 where u is the mean fluid velocity and decreases with time t in the intermediate advection dominated regime t 2 the propagators display a non gaussian shape with a higher probability for larger velocities while molecules following henry adsorption reach rapidly the taylor regime langmuir adsorbing molecules require more time to attain the asymptotic state t 3 this can also be seen in fig 5 where the normalized dispersion coefficient d t d m for the langmuir adsorbing molecules reaches a plateau at larger times corresponding to taylor dispersion we computed the scaling exponent β for both data sets of fig 5 as can be already deduced from the existence of a plateau β is equal to one in the long time limit in the intermediate transient regime it becomes β 1 75 for the henry adsorbing molecules and β 1 58 in the case of langmuir adsorption in this regime advection dominates and the displacement variance evolves faster than in the taylor regime 3 2 influence of k k a k d levesque et al 2012 provided an analytical solution for the effective dispersion coefficient d e f f a d s d m in the case of taylor dispersion of molecules adsorbing according to henry adsorption d e f f a d s d m is defined as the long time limit of d t d m see supplemental information for more details at this stage to our knowledge no analytical solution for taylor dispersion in case of langmuir adsorbing molecules is available fig 6 shows d t d m as predicted using our numerical approach for different adsorption ratios k both data for henry and langmuir adsorption are shown in all cases d t d m reaches a plateau in the long time limit which corresponds to the so called taylor dispersion regime moreover d e f f a d s d m increases with k as the resulting displacement difference between adsorbed and non adsorbed molecules leads to a larger variance d e f f a d s d m for both models which are very close to each other match very well the known analytical solution for henry adsorption however the duration of the intermediate advection dominated regime for the langmuir model increases for higher values of k this difference is due to the fact that the desorbed amount of molecules following the langmuir adsorption isotherm is not directly proportional to the variation in the concentration near the surface as it is the case for the henry adsorption isotherm such an effect is particularly important in the plateau region of the adsorption isotherm moreover while the difference observed between the two adsorption models is very small for small k it becomes more pronounced upon increasing k to large values 3 3 large adsorption desorption ratios as can be seen from fig 6 d t d m for the molecules obeying henry adsorption shows a slight overshoot at the end of the advection regime for k h 10 considering that this effect is not observed for the langmuir model we expect it to be related to the absence of adsorption induced surface saturation to gain insights into this phenomenon we performed simulations using henry s law with a constant initial concentration c 0 10 with various adsorption desorption ratios k h by modifying the adsorption rate parameter p a for constant p d more in detail a constant desorption rate p d 0 001 is used while performing simulations with k h 10 40 100 e g p a 0 01 0 04 0 1 respectively fig 7 shows the normalized time derivative of the displacement variance d t d m as a function of time t upon increasing k h d t d m displays a peak maximum before reaching the dispersive regime however regardless of the value of k h the three main transport regimes are still observed diffusion advection and dispersion the maximum observed in the time evolution of d t d m is specific to the use of adsorbing conditions without surface saturation allowing the adsorption of a very large quantity directly after injection on a time scale that is much shorter than a characteristic time of the transporting fluid moreover as the adsorption rate is much higher than the desorption rate desorption is a slower process to better illustrate this effect fig 8 shows the free and adsorbed tracer concentration fields for different k h the data obtained at t t 2 indicate that the free molecules are distributed according to the poiseuille velocity profile whereas a specific amount of molecules is adsorbed to the surface close to the inlet x 0 as expected the adsorbed amount increases with k h for larger t t t 4 t t 5 and k h 40 and k h 100 one observes two regions characterized by higher concentrations these specific regions correspond to 1 molecules in the center of the channel carried by the velocity field and 2 molecules having been adsorbed to the surface and then released due to the desorption process we note that this effect becomes more pronounced if k h increases as the impact of adsorption becomes more important the existence of these two spatially separated populations explains the overshoot observed in d t d m at larger times t t 6 t t 7 and t t 8 the contrast between the two populations fades out and the concentration in free molecules becomes more homogeneously distributed within the geometry in this asymptotic long time limit d t d m decreases and eventually reaches the plateau value that characterizes the dispersive regime fig 9 shows the normalized propagators p x x 0 u t t for the different systems at specific times t n for t t 2 the system is at the onset of the advective regime where the tracer concentration has been displaced by a small amount only therefore in this short time interval the influence of the adsorption ratio k h is not pronounced as most of the molecules are still located near the injection position x 0 in the advection dominated regime i e for t t 3 t 4 and t 5 the three data sets exhibit more pronounced differences when varying k h the propagators display a plateau for small normalized displacements and a peak for large x x 0 u t however for k h 40 and k h 100 the propagators show an additional peak close to x x 0 u t 0 these peaks at large and small normalized displacements correspond to two different subpopulations 1 non adsorbed molecules transported by the velocity field and 2 molecules adsorbed directly after injection and released later on for t t 4 the propagators obtained with k h 10 are of a quasi gaussian shape which suggests that the end of the advection dominated regime is reached however for k h 40 and k h 100 where d t d m is maximum at t t 4 the adsorption effect on the normalized propagators is still very pronounced for these cases the advection dominated regime ends at a larger time for t t 6 the data for k h 10 correspond to a propagator that has a nearly gaussian shape in contrast owing to more significant adsorption effects the data for k h 40 and 100 correspond to an asymmetric propagator which has not yet reached a gaussian shape for t t 7 all propagators become closer to ideal gaussian distributions but the differences observed between the data sets reflect the effect of the adsorption desorption ratio k h propagators are shifted to the left with respect to non adsorbing conditions with a shift that increases upon increasing the adsorption desorption ratio these results further indicate that adsorption drastically delays tracer dispersion in porous media 3 4 influence of initial concentration c 0 in this section we assess the influence of the initial concentration c 0 on the dispersion of molecules adsorbing according to the langmuir adsorption model as can be inferred from the known analytical solution d t d m of molecules adsorbing according to henry s law is independent of c 0 due to the fact that this simple model does not account for surface saturation in contrast with the langmuir adsorption model we expect an important impact of the initial concentration on tracer dispersion in adsorbing conditions in a first step we investigate the time evolution of d t d m for c 0 10 20 30 then we vary c 0 from 10 to 1000 to study the influence of higher initial concentrations on d t d m but also on the concentration fields and associated propagators fig 10 presents d t d m for molecules adsorbing according to henry and langmuir adsorption isotherms with different adsorption desorption rates k k l k h different initial concentrations c 0 10 20 30 were considered for the calculations with the langmuir adsorption isotherm as can be seen the dispersion of tracer molecules following the langmuir adsorption model shows a marked c 0 dependency such dependency becomes more pronounced for larger c 0 and k moreover for large k the difference between the langmuir and henry models becomes more important to disentangle the influence of the initial concentration c 0 from the effect of k we normalize d t with respect to its value in the infinite time limit d t we present d t in the supplemental information as obtained with k 0 5 and k 1 these results indicate that the difference between the henry model and the different langmuir adsorption models is more pronounced for k 1 than for k 0 5 therefore suggesting that the effect of the initial concentration c 0 on the langmuir adsorption is more pronounced when using a higher adsorption desorption ratio k finally it can be seen from fig 10 that d t d m for k 10 and c 0 10 20 30 does not reach the taylor dispersion plateau in the investigated time range fig 11 shows the time evolution of the free tracer concentration field along the normalized x axis x x 0 u t for molecules adsorbing according to the langmuir adsorption model we also show the corresponding normalized propagators for the following initial concentrations c 0 10 30 500 with k l 10 and γ 1 in fig 12 fig 11 shows that the concentration field for c 0 10 at t t 1 is strongly affected by adsorption as the two subpopulations corresponding to transported non adsorbed molecules and to adsorbed then released molecules can be observed as can be seen from these data a non negligible part of the molecules are delayed due to adsorption however for c 0 500 at t t 1 the concentration field is barely affected by the velocity field which obeys a poiseuille flow profile due to surface saturation only a certain amount of molecules independent of the initial concentration is adsorbed at the surface for t t 2 the spreading of the concentration around the mean position becomes more symmetrical particularly for c 0 10 and c 0 30 as can be seen from the propagators in fig 12 for t t 4 and t t 5 in the case of low initial concentrations the dispersion regime is reached as the propagators display a gaussian shape moreover the propagators are shifted towards smaller normalized displacements due to adsorption however for t t 3 when large initial concentrations c 0 are considered the onset of tailing of the concentration fields and propagators for smaller x x 0 u t can be observed tailing which corresponds to spreading of molecules far behind the tracer front is due to the desorption of the initially adsorbed molecules however at this instant the propagator center is located at x x 0 u t 1 with a nearly gaussian shape resulting from the fact that most molecules were not yet adsorbed due to adsorption limitations induced by surface saturation in contrast for larger t tailing becomes more pronounced and the propagator shape is clearly not gaussian to gain further insight into the influence of large c 0 on transport of adsorbing molecules we present in fig 13 the time evolution of d t d m for a large range of initial concentrations for low concentrations i e c 0 10 100 the typical transport regimes are observed upon increasing the initial concentration i e for c 0 75 and c 0 100 the advective regime extends over a longer time so that the time required to reach the dispersive regime becomes longer this effect is due to the shape of the langmuir adsorption isotherm which involves larger concentration variations leading to adsorption equilibrium for systems with larger initial concentrations i e for c 0 200 the time evolution of d t d m is different than at lower initial concentrations we notice that the advective regime is divided into two stages which are separated by a short stationary regime small plateau the latter regime which corresponds to the onset of the taylor dispersion regime can be explained by the fact that the concentration of free not yet adsorbed tracers in the bulk is very high with γ 1 the impact of the adsorbed molecules on the displacement variance of the free molecules is negligible at the beginning of the transport process at larger times the free tracers get dispersed in the channel so that their concentration becomes comparable to the concentration of molecules that were already adsorbed as a result the effect of adsorption on transport becomes more important and d t d m increases until reaching the asymptotic dispersion regime at very long times 3 5 cooperative model upon continuous injection in this section we compare the transport of molecules adsorbing according to the henry and langmuir models with that observed for molecules adsorbing according to the cooperative model to do so we consider an advanced thermodynamic model that was developed recently to describe adsorption of self aggregating molecules such as surfactants on silica zaafouri et al 2020 as described above this cooperative adsorption model allows describing the adsorption of individual and aggregated monomers on the one hand the adsorption of individual monomers follows henry s law with an adsorption desorption ratio k h maximal surface saturation of individual monomers is reached at the critical micellar concentration cmc above the cmc the adsorbed quantity of individual monomers remains constant if the concentration is higher than the so called critical surface concentration c s in the present case we have c s c m c aggregated monomers adsorb at the surface following a surface concentration dependent adsorption desorption ratio k γ m to avoid the drastic concentration decrease observed upon a dirac pulse injection we use here a continuous injection over a certain time as described before data for dirac pulse injection in combination with the henry and cooperative adsorption models are given in the supplemental information file in practice the peclet number is p e 100 and an initial concentration c 0 1000 is injected at a lateral position x 0 1 over a time period δ t 0 1 0 5 δ t the parameters for the henry langmuir and cooperative models are given in fig 2 and fig s1 supplemental information file fig 14 shows the adsorbed amount γ x as a function of the lateral position for the henry langmuir and cooperative models at different times as well as the surface and bulk concentrations γ x for the langmuir model already increases for very low surface concentrations due to the spreading of the concentration over time the total adsorbed amount x γ x t d x becomes very important in contrast to this model γ x for the cooperative model follows γ x observed for the henry model in the low concentration regime for c s u r f c s a strong increase in γ x can be observed due to the cooperative effect at play upon aggregated monomer adsorption then for even larger c s u r f the curve flattens following the plateau region of the adsorption isotherm the total amount of adsorbed molecules is lower than for the langmuir model fig 15 shows x γ x t d x for both models as can be seen x γ x t d x for the langmuir model increases rapidly and does not reach a constant limit fig 15 fig 16 shows the difference in bulk concentration between the to models c b u l k l c c b u l k l at different times whereas the bulk concentration of the cooperative model particularly decreases in the center of the concentration profile bulk concentration of the langmuir model decreases in the front and the tail of the concentration profile due to the adsorption at lower concentrations 4 conclusion we investigated the interplay between surfactant adsorption kinetics and transport using a lattice boltzmann method within the two relaxation time approach this method ensures that accurate results are obtained for molecule transport in simple and complex pore geometries we focused on two principal subjects first the different transport regimes and particularly the transient regimes whose understanding is crucial for the description and prediction of transport of adsorbing molecules in porous media to this goal we studied the influence of system parameters such as the initial concentration c 0 and the adsorption desorption ratio k on the temporal coupling between transport and adsorption second we presented transport of complex molecules as for example micropollutants and surfactants whose adsorption behavior is dominated by cooperative effects transient regimes and their dependence on system parameters in the pore geometry the dispersion of adsorbing molecules that obey the henry adsorption model follows the same qualitative evolution for d t d m as that for non adsorbing molecules more in detail the three following regimes are observed diffusion advection dominated transport and dispersion interestingly the transport of adsorbing molecules leads to a dispersive regime with an effective dispersion coefficient that is larger than that for non adsorbing molecules this is due to adsorption conditions at the surface of the parallel plate geometry which leads to an increase in the displacement variance σ x 2 t in the x direction flow direction moreover the adsorption desorption ratio k h is found to significantly affect the observed transport regimes since large k h yield strong adsorption effects near the lateral injection position due to the linearity between the concentration and the adsorbed quantity in the henry model the corresponding large adsorbed amount remains trapped at the surface over long residence times in practice this leads to the appearance of an additional step during the advection dominated regime the increase in the displacement variance d t d m reaches a maximum before decreasing to its asymptotic value as adsorbed and free molecules get redistributed exchanged to study the influence of surface saturation we modeled in a second part the transport of molecules obeying the langmuir adsorption model the results show that the initial concentration c 0 has an important effect on the transport regimes moreover we also found that this dependence on initial concentration is more pronounced as the adsorption desorption ratio k increases this effect arises during the advection dominated regime which extends over longer times with a significant increase in the effective dispersion coefficient using large initial concentrations c 0 200 the advection regime consists of two stages which are connected by a stationary regime during the first stage the free molecule distribution is not affected by adsorption as an intermediate stationary regime is reached for d t d m this regime corresponds to the taylor dispersion regime then during the second stage d t d m increases until it reaches the dispersion regime with a value characteristic of the transport of the molecules adsorbing according to the langmuir adsorption model this effect is due to the strong contrast between the free and adsorbed tracer concentrations cooperative adsorption finally considering dirac pulse injection with a cooperative adsorption model we studied the influence of such a collective behavior at concentrations larger than the critical surface concentration c s however even for a large initial concentration c 0 owing to such cooperative adsorption the bulk concentration decreases quickly after injection so that the surface concentration is always in the henry regime where only monomer adsorption occurs to extend our study to more relevant regimes we therefore performed simulations with continuous concentration injection by monitoring the evolution of the adsorbed amounts corresponding to isolated and aggregated monomers γ m x t and γ m x t we checked the accuracy validity of the kinetics implementation for the cooperative adsorption model in the lbm trt algorithm important differences between the adsorption models could be observed in the temporal evolution of the concentration profiles and the total adsorbed amount indeed the total amount of adsorbed molecules estimated by the langmuir model is much larger than the one of the cooperative model as it does not account for separated monomer and aggregate adsorption in this case spreading of the tracer distribution due to dispersion leads to very large adsorbed amounts in conclusion our findings illustrate the stringent need to include specific adsorption modeling including system parameters coherent with experimental data into transport models to obtain a physically consistent adsorption transport behavior indeed we have shown that system parameters as well as the type of adsorption model strongly influence the transient transport regimes and hence the temporal and spatial concentration distribution such understanding provides crucial help to rationalize transport behavior of molecules subject to adsorption in porous media consequently in the context of water remediation simulations in the presence of surfactants and or micro pollutants microplastics metals pharmaceutical molecules and ppcp it is crucial to include a robust thermodynamic adsorption model specific for each molecule which allows taking into account the rich and complex physicochemical behavior of these molecules in future works a challenging task will consist of investigating the coupling between transport and adsorption in more complex porous structures indeed the heterogeneity of the porous medium induces a specific velocity field with high and low velocity zones and hence a more complex dispersion behavior that influences adsorption in practice this implies that different characteristic times in the velocity field compete with relevant adsorption rates the knowledge of the macroscopic transport equations therefore becomes crucial in the context of the description of pollutant transport in porous media declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper appendix a supplementary data supplementary material related to this article can be found online at https doi org 10 1016 j advwatres 2022 104143 appendix a supplementary data the following is the supplementary material related to this article fig s1 the si file provides data of the cooperative model lbm schemes to solve stokes and ad equations and further adsorption simulation results 
178,non invasive geo electrical tools are widely used to monitor vadose zone processes at the core of these methods is the assumption that the obtained subsurface s electrical conductivity maps can be translated to hydrological state variables via site specific hydro electrical relations calibrated with laboratory or field data however the common practice that assumes spatially homogeneous hydro electrical relations neglects the impact of soil heterogeneity on those relations and can cause significant errors in translating the electrical measurements to the hydraulic state variables in this work numerical simulations conducted on synthetic soil samples with different permeability structures were used to examine the fine scale heterogeneous structure impact on the hydro electrical relations calibrated at different measurement scales results have shown that the soil s mm scale heterogeneous structure significantly impacts the effective hydro electrical relations scale dependency where even for a weakly heterogeneous structure the calibrated hydro electrical relations can vary by almost 20 between the 10 and 50 cm measurement scales such differences can highly influence the inferred saturation degree where errors can extend to more than 5 furthermore a stochastic inversion technique was developed based on approximated bayesian computation to confine the soil s geostatistical parameters the proposed approach was tested against two synthetic cases and one realistic case based on experimental data results have shown that the proposed approach could detect the actual permeability structure statistical parameters by calibrating the effective hydro electrical properties at only three different measurement scales keywords hydro electrical relations scale dependency fine scale heterogeneity stochastic inversion geostatistics hydro geophysics table of notations c a archie s cementation exponent f archie s formation factor i correlation length j electrical current l domain s length p c capillary pressure r 2 goodness of the fit s a archie s saturation exponent s w water saturation s w i residual saturation s w effective saturation ef superscript indicating effective parameter in superscript indicating intrinsic parameter k permeability m van genuchten second empirical parameter n porosity x spatial location vector y obs observed data y sim simulated data δ x measurement scale α leverett scaling parameter α bc brooks and corey first empirical parameter α v g van genuchten first empirical parameter β brooks and corey second empirical parameter π probability distribution ρ distance metric σ y 2 log permeability variance σ b bulk electrical conductivity σ s soil surface electrical conductivity σ w pore water electrical conductivity ϕ electric potential 1 introduction monitoring the subsurface hydrological state i e water content and solute concentrations is highly important for various agronomical hydrological and environmental applications e g efficient use of water and agro nutrients in agronomical practices green and clothier 1995 nadler et al 2003 quantifying groundwater recharge and evapotranspiration rates entin et al 2000 jiménez martínez et al 2009 scanlon et al 2002 monitoring contaminants leaching into groundwater böhlke 2002 corwin et al 1997 zhang et al 2000 and tracking contaminants migration in aquifers maxwell et al 1998 moreno and paster 2018 2017 moreover spatial hydraulic measurements are the keystone in constructing and calibrating numerical models that allow predictions of water flow and solute transport in the subsurface e g ala aho et al 2015 nocchi and salleolini 2013 pool et al 2015 moreno et al 2015 however due to the heterogeneous nature of soils and data scarcity those predictions are subject to large uncertainties arora et al 2020 dagan 2012 non invasive geophysical tools have widely been used to monitor vadose zone processes binley et al 2015 singha et al 2015 romero ruiz et al 2018 the simplicity cost effectiveness and the relatively large spatial extent that is covered make electrical conductivity ec tomography and electro magnetic induction emi appealing and popular methods to monitor the hydrological state of the subsurface binley et al 2015 doolittle and brevik 2014 garré et al 2021 blanchy et al 2020 in ec tomography an altering electrical current with low frequency is injected into the soil through two current electrodes and voltage is measured between two different electrodes keller and frischknecht 1966 for emi a primary magnetic field interacts with the soil and a receiver coil measures secondary electrical currents keller and frischknecht 1966 in both methods the soil s electrical conductivity is obtained and it is later translated to water content or pore water salinity via empirical hydro electrical relations see reviews at cai et al 2017 friedman 2005 recent applications of ec tomography and emi were able to detect preferential flow paths brindt et al 2019 rahav et al 2017 calibrate effective hydraulic properties at irrigated fields moreno et al 2015 and the shallow sub surface tran et al 2016 characterize wetting and drying patterns under different irrigation scenarios vanella et al 2021 quantify irrigation efficiency vargas et al 2021 and monitor water extraction by roots and available water at the root zone moghadas et al 2017 ortuani et al 2019 shanahan et al 2015 nevertheless the sensitivity of the electrical signal to a wide range of parameters mainly water content and pore water salinity friedman 2005 and the non uniqueness and errors associated with the inverse procedure applied to obtain ec maps from raw measurements can lead to inaccurate hydrological interpretations binley et al 2015 tarantola 2005 tikhonov et al 2013 also it is a common practice to translate the obtained ec maps to hydraulic state parameters via hydro electrical relations calibrated either with field or laboratory data this procedure assumes that the obtained relations between the measured ec and the soil state parameters can be applied to measurements at various spatial scales several examples for such an assumption can be found at beff et al 2013 doetsch et al 2012 michot et al 2003 moreno et al 2015 nasta et al 2019 robinet et al 2018 shanahan et al 2015 however previous investigations have shown that this noted assumption can cause considerable errors in mass recovery that can reach up to an order of magnitude binley et al 2002 jougnot et al 2018 laloy et al 2012 müller et al 2010 singha and gorelick 2005 this work focuses on this assumption and studies the fine scale heterogeneous structure impact on the effective hydro electrical relations measured at larger scales considering fine scale heterogeneity in hydro geophysical properties to upscale the hydro electrical relations has been previously considered day lewis et al 2005 moysey et al 2005 nussbaumer et al 2019 singha and gorelick 2006 however to the best of the author s knowledge capillary heterogeneity i e fine scale capillary pressure fluctuations with permeability was never considered a cause for the hydro electrical scale dependency recent investigations focused on co 2 sequestration have shown that fine scale capillary heterogeneity has a significant impact on the effective properties that are being measured at larger scales jackson et al 2018 krause 2012 krause and benson 2015 moreno et al 2021 with respect to a single phase flow a recent study conducted by visentini et al 2020 had shown that the measured effective electrical conductivity is related to the fine scale heterogeneous structure of the soil moreover visentini et al 2020 have used this dependency in order to confine the soil s geostatistical parameters via a tracer experiment by measuring the effective electrical conductivity at different time lapses from the tracer injection stage however visentini et al 2020 have used a 2d domain and a fully saturated environment for their experiments reducing the domain to 2d cannot capture the heterogeneity impact on the entire 3d domain in addition in an unsaturated environment capillary heterogeneity can cause high spatial variability in the water content thus altering the electrical flow paths concerning the measured domain as a result the hydro electrical relations can alter significantly between different measurement scales as long as ergodicity is not fulfilled this work aims to examine the fine scale heterogeneous structure impact on the larger scale effective hydro electrical relations at unsaturated conditions the basic assumption in this study is that spatially invariant intrinsic hydro electrical relations exist at the fine mm scale furthermore a method to confine the soil s heterogeneous structure statistical parameters based on measurement of the effective electrical conductivity at different spatial scales is developed and tested on two synthetic cases and one realistic case which is based on a simultaneous injection of co 2 and brine i e a coreflooding experiment it is also emphasized here that although this study was conducted solely with numerical simulations a framework for conducting actual laboratory experiments to measure the hydro electrical relations scale dependency is proposed in the problem description section the paper is organized as follows the method section is divided into two subsections the first part section 2 1 describes the general problem governing equations assumptions and basic procedure applied to obtain the hydro electrical relations at different measurement scales i e a forward approach the second part of the methods section section 2 2 describes a stochastic inversion technique to confine the soil s heterogeneous structure statistical parameters from ec measurements at altering spatial scales i e an inverse approach results for each of the different procedures i e forward and inverse modelling are shown and discussed in section 3 a summary of the work and main conclusions are presented in the last section of this paper 2 methods the method section is divided into two subsections the first section describes the general procedure that was considered and the governing equations that were used for forward modelling i e obtaining scale dependent hydro electrical relations for known heterogeneous structures the second part of the methods section focuses on inverse modelling where a stochastic inversion technique to confine the heterogeneous soil structure by calibrating the effective hydro electrical relations at different measurement scales is proposed and described 2 1 problem description the general experiment contained a pre washed soil sample with a heterogeneous permeability field the sample is packed in an apparatus placed horizontally and an enforced capillary pressure p c ef is applied until hydrostatic equilibrium is obtained at this point an electrical current is injected between the inlet and outlet faces j o and the resulting electric potential is measured at different locations along the electrical flow direction ϕ i fig 1 shows a schematic sketch of the model domain for a rectangular cuboid apparatus this basic procedure is being repeated with altering suctions i e different p c ef values thus providing a large spectrum of the effective electrical measurements vs the mean saturation at different spatial scales since the presented study was conducted on synthetic soil samples i e structures were generated via geostatistical methods the procedure described above was conducted using numerical simulations mimicking the electric potential resulting from dc injection at different soil structures and saturation conditions the following describes the applied procedures capillary heterogeneity was modelled by applying the leverett j function relationship leverett 1941 scaling the applied effective capillary pressure p c ef to the fine scale heterogeneous properties as follows 1 p c s w k n α n x k x p c ef s w where α is the scaling parameter n is the porosity k is the permeability x x y z is the spatial location vector s w s w s w i 1 s w i is the effective water saturation where s w is the water saturation and s w i is the residual water saturation assumed to be 0 unless stated otherwise and p c ef s w is the soil s effective water retention curve used in this study as either the van genuchten model van genuchten 1980 eq 2 a or brooks and corey model brooks and corey 1966 eq 2 b 2a p c ef s w α v g s w 1 m 1 1 m 2b p c ef s w α bc s w 1 β where α v g and m are van genuchten empirical parameters and α bc and β are brooks and corey empirical parameters the fine scale water saturation at altering p c ef is obtained by substituting eq 2 a or 2 b in eq 1 once obtained the water saturation maps were translated to local scale electrical conductivity maps σ b x by adopting archie s law archie 1942 with known intrinsic hydro electrical relations 3 σ b x σ w n x c a in s w x s a in where σ w is the pore water electrical conductivity assumed to be constant and c a and s a are archie s cementation and saturation exponents the superscript in stands for intrinsic relations in this study the intrinsic hydro electrical relations were assumed to be 1 3 and 1 5 for the cementation and saturation exponents the adopted values were considered based on prior investigations conducted on homogeneous sandy soils friedman 2005 it is noted here that for a more general expression of the hydro electrical relations one also needs to account for soil s surface conductivity σ s laloy et al 2011 samouëlian et al 2005 in this study σ s was neglected this noted assumption can be valid when considering coarse grain soils samouëlian et al 2005 friedman 2005 or high pore water electrical conductivity friedman 1998 following the electric potential was obtained by solving the laplace equation numerically with a finite differences scheme 4 σ b x ϕ x σ b x 2 ϕ x 0 boundary conditions for eq 4 were taken as constant electric potential at the inlet face i e ϕ 0 y z ϕ 0 constant electrical current scaled to the cell s electrical conductivity at the outlet face i e j l y z j o and zero electrical flux for the remaining boundaries the effective electrical conductivity at different measurements scales was calculated by using ohm s law 5 j o σ b ef δ x i ϕ i ϕ 0 x i where ϕ i is the areal mean value of ϕ on the y z plain at location x i ϕ 0 is the areal mean value of ϕ at the inlet face the superscript ef stands for effective property and δ x is the volume of the sampled domain normalized to the electrical flow cross sectional area in the x direction i e δ x i x i referred to as the measurement scale hereafter in this study three measurement scales were considered where ϕ was measured at x 1 x 2 and x 3 the applied procedure was repeated with different p c ef and a new effective hydro electrical relations were calibrated for each measurement scale it is noted here that porosity heterogeneity had little impact on the effective archie s cementation exponent i e c a ef c a in at different measurement scales thus allowing the use of a constant average porosity with insignificant impact on the obtained results by adopting a homogeneous porosity the term n x c a in in eq 3 can be replaced with a constant archie s formation factor f thus only calibrating archie s effective saturation exponent i e s a ef nevertheless the heterogeneous porosity structure was considered for a realistic case presented in section 2 2 1 where the fine scale porosity and saturation distributions were obtained via ct images fig 2 shows a schematic diagram of the overall described procedure 2 1 1 model domain and scenarios used for forward modelling the basic procedure described above was performed on several synthetic soil samples to inspect the heterogeneity impact on the effective hydro electrical relations at altering measurement scales for that purpose a rectangular cuboid domain with a grid of 101 51 51 cells in the x y and z directions was generated with a cell size of δ y δ z 2 δ x 1 cm which is sufficiently large to be accepted as a representative elementary volume ni et al 2019 pini and madonna 2016 haruzi et al 2021 the numerical cells were populated with permeability values using sequential gaussian simulations pyrcz and deutsch 2014 deutsch et al 1992 with an arithmetic mean of the permeability of k 100 md and altering log permeability variances σ y 2 where y l n k and l n is the natural logarithm and correlation lengths i table 1 summarizes the statistical parameters that were considered where structure names indicate their heterogeneity degree and normalized correlation range e g structure v1r20 has a log permeability variance of σ y 2 1 and normalized correlation range of 3 i l 20 where l 50 cm is the total domain s length for all of the generated structures a constant porosity of n 0 3 was assigned and a van genuchten model eq 2 a was used for retention with α α α v g 155 kpa md and m 0 75 the applied capillary pressure i e p c ef was modified in an iterative procedure to provide a total amount of 9 mean saturation values ranging from 0 1 to 0 9 with equal spacing of δ s w 0 1 electric potential was evaluated at 3 locations along the electrical current flow direction located at x 1 l 0 2 x 2 l 0 5 and x 3 l 1 and the effective electrical conductivity for each saturation map was evaluated at the corresponding sampled volume via eq 5 it is indicated here that the applied capillary pressure was modified for each measurement scale individually in this approach 27 p c ef values were considered for each structure i e nine values for each of the three measurement scales this process ensures that the average saturation will be invariant of the measurement scale as a final step for each soil structure the effective hydro electrical relations were fitted to produce the measured effective electrical conductivity for the corresponding mean saturation i e s a ef as a function of the measurement scale δ x it is noted here that since the generated permeability fields were isotropic no trend in saturation along the electrical current flow direction should occur for example fig 3 shows the average saturation value along the electrical current flow direction and the overall mean saturation of the soil for the low heterogeneous structures at altering p c ef as shown in fig 3 all saturation profiles do not exhibit any trend with the electrical flow direction however fluctuations around the mean values can be noticed the observed fluctuations are minimal for the poorly correlated case i e v1r10 structure fig 3a and increase with the permeability correlation length i e v1r20 fig 3b and v1r40 fig 3c nevertheless the fluctuations do not show any trend with the electrical current flow direction 2 2 a stochastic inversion for confining the soil s geostatistical properties from effective ec measurements in this section a stochastic inversion technique to infer the soil s heterogeneous structure is proposed it is noted here that the overall goal of the proposed approach is not to obtain the complete permeability structure but to evaluate its geostatistical parameters i e the log permeability variance σ y 2 and correlation length i in addition it had been observed that different structures with similar geostatistical properties could result in different s a ef at different measurement scales hence the approach considered here is aimed to confine the geostatistical properties of the soil thus resulting in probability density functions of the geostatistical properties that mostly capture s a ef at different measurement scales the applied approach was tested on three different cases two synthetic soil samples where experimental measurements were mimicked by numerical simulations solely and one realistic case where numerical simulations of the electrical flow were conducted on laboratory experimental data and results were compared with a calibrated permeability field 2 2 1 overall procedure confining the soil s geostatistical parameters was conducted by applying a stochastic inversion technique based on an iterative approximated bayesian computation abc the basic concept of the bayesian approach is that a prior probability distribution π is modified to a posterior distribution after considering the observed data via a likelihood function 6 π θ y obs π y obs θ π θ where π θ y obs is the posterior distribution of the considered parameter θ σ y 2 and i in our case given the observed data y obs s a ef δ x in this case π θ is the prior distribution of θ and π y obs θ is the likelihood of the observed data gelman et al 1995 in the proposed approach the posterior distribution is characterized by drawing samples from the prior distribution and accepting or rejecting those samples according to their agreement with observations furthermore the posterior distribution is built based on a weighted kernel density function where the weights are assigned according to a distance metric sisson et al 2018 visentini et al 2020 7 ρ y sim y obs 1 n 1 n y i sim y i obs where n is the total number of observations domain sizes in our case here the posterior distribution is modified iteratively thus that the prior distribution of the next iteration is taken as the posterior of the current iteration i e π θ j 1 π θ y obs j where j is the iteration number final distribution is considered when the posterior converged to a constant distribution between two following iterations i e π θ j 1 π θ j it is noted here that since the distance metric is computed via calibrated values obtained from several independent measurements measurement errors impact is likely to reduce as the number of measurements increases nevertheless to account for measurement errors the distance metric was rescaled based on the goodness of the fit i e r 2 of the observed and simulated data as follows 8 ρ y sim y obs 1 n 1 n y i sim y i obs r i 2 obs r i 2 sim in this scaling approach the acceptance criterion for a valid sample increases for a poorly fitted observation and samples are more likely to be rejected when exhibiting high deviations from the calibrated hydro electrical model it is also noted here that although all of the tested scenarios were sterile i e measurement errors were not included an example of the applied approach capabilities to handle contaminated data is provided in appendix moreover since the effective hydro electrical relations measured at larger spatial scales are highly dependent on the measured relations at smaller domains a memory function is employed to reduce the computational effort in this procedure an initial m 1 realizations are generated based on the posterior distribution of the previous iteration for initializing the procedure i e for the first iteration an initial distribution is considered here the initial distribution was uniform with 0 and 4 as the limits for σ y 2 and 0 and 1 for the normalized correlation range 3 i l the effective hydro electrical relations are fitted for the smallest scale that was considered s a ef δ x 1 the distance metric is calculated for each realization via eq 8 and the realizations are ranked based on their performance and m 2 realizations with the lowest ρ are accepted where m 1 m 2 the permeability structure of the m 2 realizations between the smallest and the next domain size considered i e between x 1 and x 2 is generated conditioned on the m 1 realizations the m 2 realizations are ranked again according to eq 8 to generate m 3 realizations at the higher domain level conditioned on the m 2 structures where m 2 m 3 this process is repeated until all domain sizes are considered and the posterior distribution of the current iteration i e π θ j is generated via a weighted kernel distribution function with a reflection method to constrain the posterior to positive values bowman and azzalini 1997 jones 1993 in this work only three domain levels were considered where m 1 500 m 2 250 and m 3 100 were used furthermore two operators from heuristic approaches genetic algorithms were adopted to encourage convergence on the one hand and avoid local minimum traps on the other the two operators involve e l i t i s e m where the m 3 generated structures of the current iteration were moved to the next iteration intact and m i g r a t i o n where several realizations of the m 1 population are generated with values drawn from the initial distribution i e σ y 2 u 0 4 and 3 i l u 0 1 goldberg 1989 in this work the migration population was taken as 1 p m 1 m 3 where p 0 8 therefore at each iteration excluding the first 400 new realizations are generated i e 320 individuals from the posterior of the previous iteration and 80 individuals from the initial distribution a schematic sketch of the overall procedure is provided in fig 4 2 2 2 tested scenarios for the stochastic inversion approach the procedure described above was tested on two synthetic cases and one realistic case the two synthetic cases consist of a similar model setup containing a rectangular cuboid domain with a grid of 41 21 21 cells in the x y and z directions and a cell size of δ y δ z 2 δ x 1 cm the numerical cells were populated with permeability values using sequential gaussian simulations pyrcz and deutsch 2014 deutsch et al 1992 with an arithmetic mean of the permeability of k 100 md and a log permeability variances of σ y 2 0 72 and 2 74 and a normalized correlation range of 3 i l 0 11 and 0 29 for case i and case ii respectively table 2 summarizes the tested cases geostatistical parameters for both cases a constant porosity of n 0 3 was assigned and a van genuchten model eq 2 a was used for retention with α α α v g 155 kpa md and m 0 75 fig 5 shows the two synthetic permeability structures that were considered the procedure described at section 2 1 and schematically shown in fig 2 was applied for both structures adopting intrinsic relations of 1 3 and 1 5 for the cementation and saturation exponents respectively the effective archie s saturation exponent was calibrated at three domain sizes located at δ x 1 l 0 25 δ x 2 l 0 625 and δ x 3 l 1 in addition to the synthetic cases considered the proposed method was also tested on a third case which is based on real experimental data i e case iii following is a brief summary of the conducted experiment full information on the experimental design is provided at ni et al 2019 for the realistic case 3d saturation maps obtained from a co 2 water coreflooding experiment were used the experiments were conducted on a sandstone shezaf rock sample extracted from the upper part of the arqov formation in israel the core had a diameter of 4 9 cm and a total length of 6 6 cm co injection of super critical co 2 and water was carried out with a total injection rate of 3 ml min and altering fractional flows of 50 80 90 95 99 and 100 where the fractional flow is with respect to the co 2 injection rate e g for the fractional flow of 100 only co 2 was injected both phases i e co 2 and water were pre equilibrated with each other to prevent the dissolution of co 2 into water the core s 3d porosity and water saturation for each experiment were obtained from a ct image the 3d saturation for each experiment and porosity maps were translated to bulk electrical conductivity σ b x by applying archie s law eq 3 and by considering the co 2 as a non conductive phase and the intrinsic hydro electrical relations were taken as 1 3 and 1 5 for the cementation and saturation exponents respectively the electric potential for each saturation map ϕ x was obtained numerically using a finite differences scheme and a cylindrical domain containing 25 21 21 cells in the x y and z directions with a cell size of δ x 2 5 mm δ y δ z 2 mm it is mentioned here that the coreflooding experiment conducted on shezaf sandstone showed an increase in saturation near the core s outlet face due to capillary end effects huang et al 1996 hence to avoid capillary end effects impact on the inferred permeability field the effective hydro electrical relations were fitted for domain sizes at δ x 1 l 0 42 δ x 2 l 0 63 and δ x 3 l 0 83 where saturation fluctuations were stable up to the distance of x 0 85 see appendix at moreno and rabinovich 2021 the procedure described at section 2 2 1 and shown schematically at fig 4 was used to confine the core s geostatistical parameters for that purpose a brooks and corey model eq 2 b was used with s w i 0 05 α α bc α 436 kpa and β 0 35 the retention parameters used for this case were adopted from a previous work that fitted the core s retention properties anto darkwah et al 2021 furthermore for the sake of comparison a 3d permeability field that was obtained by an iterative procedure matching the simulated saturation and overall wetting phase pressure gradient with experimental measurements was adopted and is presented at fig 6a anto darkwah et al 2021 a further analysis was conducted fitting an exponential variogram kitanidis 1997 to the true permeability structure the fitted geostatistical parameters are shown in fig 6b and are listed at table 2 3 results and discussion similarly to the methods section the results and discussion section is also divided into two subsections first the results obtained from forward modelling described in section 2 1 are presented and discussed the second part presents and discusses the results obtained from the stochastic inversion technique applied to the different scenarios considered in this study 3 1 effective hydro electrical relations scale dependency for the sake of illustrating the effective hydro electrical relations scale dependency fig 7b shows the effective electrical conductivity calculated and fitted as a function of the mean saturation at the three measurement scales that were considered for the v1r40 structure the permeability structure is provided in fig 7a and its geostatistical parameters are listed in table 1 a strong dependency between the effective hydro electrical relations and the measurement scale can clearly be noticed in this structure where s a ef vary from 1 65 to 1 78 and 1 90 between the 10 25 and 50 cm measurement scales this strong dependency implies that even for a weakly heterogeneous structure i e σ y 2 1 applying hydro electrical relations calibrated with a single measurement scale can result in significant errors in the hydrological interpretations such misinterpretations can result in a 5 difference in the estimated water saturation when transforming the measured electrical conductivity to water saturation via hydro electrical relations calibrated at the 50 cm scale to a 10 cm sample and vice versa this misinterpretation increases with the log permeability variance and reaches 6 for σ y 2 2 structure v2r40 and 7 for σ y 2 4 structure v4r40 in addition and as can be noticed in fig 7b such misinterpretations in the estimated water saturation are more pronounced at low to intermediate saturation degrees thus having an even further implication in estimating relative permeability or capillary pressure with severe consequences in evaluating water and solutes dynamics at the subsurface a further inspection of the fine scale heterogeneous structure on the effective hydro electrical scale dependency was carried out with nine different permeability structures fig 8 and table 3 summarizes the fitted effective hydro electrical relations i e s a ef for the different structures at different scales it is noted here that the goodness of the fit i e r 2 was greater than 0 99 for all of the calibrated s a ef the obtained effective hydro electrical relations at different measurement scales illustrate the scale dependency of such relations and their relationship to the inner sub core scale capillary heterogeneity it can be seen that this dependency can even reach a ratio of 1 6 between the 50 cm and the 5 mm scales as can be seen for structure v4r40 yellow line in fig 8c also it can be noticed that the log permeability variance is mostly related to a sharp increase in s a ef from the mm scale intrinsic relations to the larger cm scale as seen by the differences between the blue red and yellow lines in fig 8 for all correlation lengths at δ x 10 cm for example s a ef calibrated for a highly heterogeneous structure σ y 2 4 at a measurement scale of δ x 10 cm is 15 larger than the one calibrated for a weakly heterogeneous structure σ y 2 1 with a similar correlation length further the permeability structure correlation length mostly influences s a ef at larger measurement scales i e from the cm to the 10 s cm scales an example for such dependency can be seen by the increase in s a ef from the 10 cm to the 50 cm scales of the highly heterogeneous structures σ y 2 4 at different correlation lengths where s a ef increased by 21 8 and 6 for correlation lengths of i 6 67 3 33 and 1 67 cm respectively those two observations can be explained by the fact that a more connected permeability body i e large correlation length will result in long preferential electrical flow paths connecting the inlet and outlet faces for smaller domains however such connected bodies are more likely to be interrupted and will be disconnected at larger domains thus increasing the tortuosity of the electric flow with the increase in the domain size resulting in larger variability in s a ef between the different measurement scales in addition the log permeability variance encourages inner structure disorders thus straightening the contrast between electrical conductive bodies resulting from spatial variabilities in the saturation degree this phenomenon can also be translated to higher variability in s a ef at different measurement scales an analogue to this phenomenon can be drawn from solute transport behaviour where the macro dispersivity increases when introducing additional levels of heterogeneity due to the increase of the sampled domain dagan 2012 such dependency implies that misinterpretation in the saturation degree increases with the correlation length and log permeability variance furthermore it can also be noticed in fig 8c that for the high correlated structures s a ef increases with a relatively high slope and thus errors in the interpreted saturation are likely to increase even further for larger sampled domains in addition it can also be noticed that for weakly correlated structures fig 8a s a ef starts to converge at larger measurement scales this observation can imply ergodic behaviour meaning that calibrating the hydro electrical relations at a sufficient sample volume can accurately capture the hydro electrical relations at larger domains however when such relations are applied to smaller domains it can still result in some bias for example even for the most weakly heterogeneous and correlated case that was considered v1r10 structure s a ef at the 50 cm scale is greater by 4 than s a ef at the 10 cm scale such differences in s a ef can result in a 2 error in the inferred saturation moreover it can also be noticed that this ergodicity is hard to obtain and requires a sample volume 30 times greater than the correlation length an effective medium approximation ema friedman et al 1995 kirkpatrick 1973 can be used to estimate the differences between the weakly correlated cases and ergodic conditions 9 σ b x σ b ef e m a σ b x 2 σ b ef e m a d σ b 0 where σ b ef e m a is the effective electrical conductivity at ergodic conditions fig 9 shows the effective electrical conductivity at the largest domain size i e σ b ef δ x 50 cm and the estimated values considering ergodicity σ b ef e m a for the weakly correlated cases i e v1r10 v2r10 and v4r10 as can be seen for the weakly heterogeneous case v1r10 the ema is in good agreement with the calculated effective electrical conductivity however the ema accuracy reduces with the structure variance i e for the v2r10 and v4r10 cases the drop in the ema accuracy for high heterogeneous structure means that ergodicity for the high and medium heterogeneous structures have not reached even for a sample volume 30 times greater than the correlation length this observation can also be seen in fig 8 where s a ef increases with the sampled domain size nevertheless it can still be noticed that each permeability structure has a unique signature on the effective hydro electrical relations calibrated at different measurement scales such observation can be beneficial in inferring the heterogeneous permeability structure i e σ y 2 and i from measuring the effective hydro electrical relations at altering measurement scales 3 2 inferring the soil s structure geostatistical parameters the stochastic inversion procedure described in section 2 2 1 and illustrated in fig 4 was applied for the three cases presented in section 2 2 2 in order to confine the structures geostatistical parameters table 4 summarizes the fitted archie s saturation exponents at different measurement scales for the different scenarios which were used as the observation data and were obtained by applying the forward approach described in section 2 1 it can be noticed by comparing tables 3 and 4 that both of the synthetic structures i e case i and ii obey the general observation obtained at section 3 1 i e case i weakly heterogeneous and poorly correlated case shows a slight increase in s a ef at different measurement scales and case ii moderately correlated and heterogeneous structure exhibits more significant deviations in s a ef at the different measurement scales nevertheless to test the robustness of the proposed approach prior assumptions and limitations on the hydraulic structure were not included and a uniform distribution of σ y 2 u 0 4 and 3 i l u 0 1 were used for the initial distributions fig 10 shows the posterior distributions of both σ y 2 and 3 i l at the different iterations as well as the initial distribution for reference for the weakly heterogeneous and poorly correlated case i e case i from fig 10 it can be seen how the posterior distribution of both parameters i e σ y 2 and i narrows down with each iteration and converge towards the true values that were considered indicated with vertical red dashed lines for the final distribution shown with a continuous blue line it can be inferred that the probability for 0 30 σ y 2 1 65 and 0 06 3 i l 0 58 is 90 70 for 0 41 σ y 2 1 03 and 0 09 3 i l 0 34 and 50 for 0 48 σ y 2 0 87 and 0 10 3 i l 0 26 it is indicated that the true values were σ y 2 0 72 and 3 i l 0 11 furthermore fig 11a shows a box plot of the final posterior distribution for the case in hand i e case i from fig 11a it can be seen that the estimated posterior capture the true values that were considered with good accuracy moreover the posterior distribution required 32 iterations to converge meaning that a total number of 12 900 realizations were generated for a further inspection fig 12 shows the inner sub core log permeability distribution in terms of normalized histograms for 20 individuals drawn from the final posterior distribution grey lines the actual log permeability distribution dashed red line and the ensemble mean of the posterior distribution dotted blue line fig 12 shows the variability of the log permeability distribution of each realization and exhibits additional confinement of the permeability structure it can also be noticed that the ensemble mean is in good agreement with the actual permeability distribution fig 13 shows the posterior distributions at different iterations for the moderately heterogeneous and correlated case i e case ii similarly to case i it can be noticed that the applied approach captures quite well the two geostatistical parameters that were considered also here the posterior distribution is more confined with each iteration and converged towards the true geostatistical parameters that were used as opposed to the first tested case the final posterior distribution is wider showing larger uncertainties in the estimated geostatistical parameters nevertheless the considered parameters are still well confined and the ensemble agrees with the true values for example from the final distribution it can be inferred that the probability of 1 58 σ y 2 3 72 and 0 08 3 i l 0 54 is 90 70 for 1 96 σ y 2 3 34 and 0 13 3 i l 0 40 and 50 for 2 26 σ y 2 3 12 and 0 16 3 i l 0 34 where the true values were σ y 2 2 74 and 3 i l 0 29 this observation can also be noticed in fig 11b which shows the box plot of the final posterior distribution for case ii in addition fig 14 shows the inner log permeability distribution for 20 individual realizations and the ensemble mean vs the true structure also here it can be seen that the ensemble well confines the true permeability structure and the overall mean is with an excellent agreement with the true permeability structure that was considered also it is important to note that the posterior distribution for this scenario converged after 27 iterations resulting in a total number of 10 900 generated realizations fig 15 shows the posterior distribution at different iterations for both σ y 2 and 3 i l for the realistic case i e case iii similarly to both of the synthetic cases it can be noticed that the posterior distribution converged towards a more confined distribution for both geostatistical parameters however it can be seen that the final distribution is wider than the synthetic cases that were considered nevertheless probability peaks still fairly agree with the true permeability field used for comparison this observation can also be noticed in fig 11c which shows the posterior box plot of the realistic case it can also be seen in both figs 11 and 15c that the correlation range is with a better agreement to the true permeability structure than the heterogeneity degree i e σ y 2 examining the core s true effective properties listed in table 4 it can be seen that s a ef δ x reduces with the size of the sampled domain this observation is in contrast to prior observations see table 3 and the 2 synthetic cases in table 4 the low s a ef values smaller than the intrinsic value can be a result of a highly conductive skeleton that spans across the entire domain this conductive skeleton will be translated to a relatively high spatial correlation in the permeability structure thus reducing the heterogeneity level impact on the effective electrical conductivity the applied stochastic inversion approach captures this phenomenon quite well where the ensemble mean of s a ef resulted in s a ef δ x 1 1 365 s a ef δ x 2 1 312 s a ef δ x 3 1 294 where the true values were 1 366 1 311 and 1 293 respectively distributions of the permeability inner structure for 20 individual realizations the final posterior ensemble mean and the true structure are provided in fig 16 as opposed to the two synthetic cases examined the true permeability structure exhibits a different distribution than the estimated structures the observed misfit is mainly located at low permeability values l n k 2 75 where the estimated structures show a considerable amount of cells with low permeability where l n k 2 75 for the true structure does not exist one of the causes for this misfit relies on the gaussian structure assumption used to estimate the permeability structure the noted gaussian structure assumption also causes a larger estimated σ y 2 than the one exhibited by the true structure which can be seen in both figs 11 and 15c nevertheless due to the ability of the estimated structures to capture the effective hydro electrical relations it can be stated that such low permeability cells have a negligible impact on the electric flow this negligible affect can be explained by the low mean saturation obtained in the coreflooding experiments where s w 0 73 for the 100 fractional flow experiment such low saturation resulted in full water saturated cells or near full saturation for permeability values of l n k 2 75 hence permeability values below this threshold are redundant since s w l n k 2 75 1 when considering all low permeability cells as equivalent to l n k 2 75 due to the insignificance of values below that point it can be stated that the ensemble mean structure is in a reasonable agreement with the true structure furthermore it is important to point out that the true permeability structure was not considered in the inversion process the estimated permeability fields were generated solely from porosity and water saturation maps obtained directly from 3d ct scans at different fractional flows 4 summary and conclusions this work inspected the fine scale capillary heterogeneity impact on the effective hydro electrical relations calibrated at different measurement scales a procedure to measure those properties was suggested and numerical experiments conducted on synthetic soil samples with different permeability structures were performed in addition a novel stochastic inversion technique was developed in order to confine the soil s permeability stochastic parameters i e log permeability variance σ y 2 and correlation length i results have shown that the hydro electrical relations scale dependency is highly influenced by the sub core mm scale heterogeneous structure and that even for homogeneous intrinsic relations archie s saturation exponent can almost be doubled when calibrated at different measurement scales such dependency can cause a severe misinterpretation in the hydrological state of the soil and can extend to more than a 5 error when translating the electrical signal to water saturation levels moreover it was observed that the significant errors are more pronounced at low to intermediate saturation values due to the non linear relation between the water saturation and capillary pressure and relative permeability this observation has even further implications when drawing conclusions regarding water and solutes dynamics at the subsurface however it is important to note that results were obtained by assuming that the soil surface conductivity can be neglected in several cases neglecting the surface conductivity can be a valid assumption e g when considering coarse texture soils or when the pore water electrical conductivity is sufficiently high nevertheless additional future work will include fine scale heterogeneities in surface conductivity and pore water electrical conductivity impact on the effective hydro electrical relations at different measurement scales the hydro electrical scale dependency was set as the basis for a novel stochastic inversion technique that confines the soil s geostatistical parameters the proposed approach was tested on three cases two synthetic soils with a known structure and one realistic case for the realistic case 3d saturation and porosity maps obtained from ct images during a two phase co 2 and brine injection at altering fractional flows served as the input data and a calibrated permeability field was adopted for comparison for the two synthetic cases it was shown that the proposed approach was able to confine the soil s geostatistical parameters with high accuracy and a relatively narrow distribution around the true values moreover it was shown that the ensemble mean structure distribution is with a high agreement to the true structure for the realistic case it was also shown that the considered approach is capable of confining the core s geostatistical parameters although uncertainties were higher than the synthetic samples considered nevertheless the posterior distribution for the realistic case agreed with the referenced permeability field geostatistical parameters important implications of this work are related to the application of geo electrical methods used in the field for hydrological and agricultural pursuits e g ec tomography and electro magnetic induction since both methods provide a spatially variable electrical conductivity at altering spatial resolution it was shown here that the hydro electrical relations are highly influenced by the soil s heterogeneous structure at the local scale and therefore this structure should be considered when translating the electrical signal to the soil s hydraulic state parameters in addition further investigation should include an approach to upscale or downscale the hydro electrical relations to the desired scale while considering the local scale capillary heterogeneity moreover the capability of the stochastic inversion approach to confine the permeability structure statistical parameters can be applied in order to generate different realizations of the permeability field at the investigated site which can be used for probabilistic predictions of the subsurface water flow and solute transport with a limited amount of spatial measurements furthermore it is also recommended to measure the effective electrical conductivity at different spatial scales when conducting a two phase flow coreflooding experiment the additional measurements can be used to confine the calibrated permeability field of the core or for directly upscaling the permeability structure to larger scales as was shown in moreno and rabinovich 2021 in addition since coreflooding experiments already contain 3d ct scans to measure saturation and porosity distributions at the sub core level adding electrical measurements at different spatial scales can also be used to calibrate and validate the local scale intrinsic hydro electrical relations credit authorship contribution statement ziv moreno writing original draft writing review editing methodology conceptualization software formal analysis resources investigation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the author would like to thank the editor and the two anonymous reviewers for their comments on an early version of this manuscript which helped to improve it considerably the author would also like to acknowledge shmulik friedman for his constructive comments regarding this manuscript appendix applying the stochastic inversion technique on contaminated data the following section illustrates the capabilities of the stochastic inversion technique described in section 2 2 to handle contaminated data the two synthetic cases were adopted for that purpose i e cases i and ii measurements errors were added to the true measured values by adding white noise with a normal distribution of zero mean and a standard deviation of 3 from the true values fig a 1 shows the effective electrical conductivity as a function of the mean saturation at different measurement scales for both cases considering the sterile data blue pluses and the contaminated data red crosses as a result of contaminating the data archie s effective saturation exponents were slightly modified table a 1 shows the contaminated s a ef as a function of the measurement scale for both cases the stochastic inversion technique was applied for both of the contaminated cases figs a 2 and a 3 show the posterior distribution at different iterations for case i and case ii respectively as can be seen the final posterior distribution was able to confine the soil s geostatistical parameters with a narrow distribution around the true values for both of the contaminated cases suggesting that it can also be used to handle contaminated data 
178,non invasive geo electrical tools are widely used to monitor vadose zone processes at the core of these methods is the assumption that the obtained subsurface s electrical conductivity maps can be translated to hydrological state variables via site specific hydro electrical relations calibrated with laboratory or field data however the common practice that assumes spatially homogeneous hydro electrical relations neglects the impact of soil heterogeneity on those relations and can cause significant errors in translating the electrical measurements to the hydraulic state variables in this work numerical simulations conducted on synthetic soil samples with different permeability structures were used to examine the fine scale heterogeneous structure impact on the hydro electrical relations calibrated at different measurement scales results have shown that the soil s mm scale heterogeneous structure significantly impacts the effective hydro electrical relations scale dependency where even for a weakly heterogeneous structure the calibrated hydro electrical relations can vary by almost 20 between the 10 and 50 cm measurement scales such differences can highly influence the inferred saturation degree where errors can extend to more than 5 furthermore a stochastic inversion technique was developed based on approximated bayesian computation to confine the soil s geostatistical parameters the proposed approach was tested against two synthetic cases and one realistic case based on experimental data results have shown that the proposed approach could detect the actual permeability structure statistical parameters by calibrating the effective hydro electrical properties at only three different measurement scales keywords hydro electrical relations scale dependency fine scale heterogeneity stochastic inversion geostatistics hydro geophysics table of notations c a archie s cementation exponent f archie s formation factor i correlation length j electrical current l domain s length p c capillary pressure r 2 goodness of the fit s a archie s saturation exponent s w water saturation s w i residual saturation s w effective saturation ef superscript indicating effective parameter in superscript indicating intrinsic parameter k permeability m van genuchten second empirical parameter n porosity x spatial location vector y obs observed data y sim simulated data δ x measurement scale α leverett scaling parameter α bc brooks and corey first empirical parameter α v g van genuchten first empirical parameter β brooks and corey second empirical parameter π probability distribution ρ distance metric σ y 2 log permeability variance σ b bulk electrical conductivity σ s soil surface electrical conductivity σ w pore water electrical conductivity ϕ electric potential 1 introduction monitoring the subsurface hydrological state i e water content and solute concentrations is highly important for various agronomical hydrological and environmental applications e g efficient use of water and agro nutrients in agronomical practices green and clothier 1995 nadler et al 2003 quantifying groundwater recharge and evapotranspiration rates entin et al 2000 jiménez martínez et al 2009 scanlon et al 2002 monitoring contaminants leaching into groundwater böhlke 2002 corwin et al 1997 zhang et al 2000 and tracking contaminants migration in aquifers maxwell et al 1998 moreno and paster 2018 2017 moreover spatial hydraulic measurements are the keystone in constructing and calibrating numerical models that allow predictions of water flow and solute transport in the subsurface e g ala aho et al 2015 nocchi and salleolini 2013 pool et al 2015 moreno et al 2015 however due to the heterogeneous nature of soils and data scarcity those predictions are subject to large uncertainties arora et al 2020 dagan 2012 non invasive geophysical tools have widely been used to monitor vadose zone processes binley et al 2015 singha et al 2015 romero ruiz et al 2018 the simplicity cost effectiveness and the relatively large spatial extent that is covered make electrical conductivity ec tomography and electro magnetic induction emi appealing and popular methods to monitor the hydrological state of the subsurface binley et al 2015 doolittle and brevik 2014 garré et al 2021 blanchy et al 2020 in ec tomography an altering electrical current with low frequency is injected into the soil through two current electrodes and voltage is measured between two different electrodes keller and frischknecht 1966 for emi a primary magnetic field interacts with the soil and a receiver coil measures secondary electrical currents keller and frischknecht 1966 in both methods the soil s electrical conductivity is obtained and it is later translated to water content or pore water salinity via empirical hydro electrical relations see reviews at cai et al 2017 friedman 2005 recent applications of ec tomography and emi were able to detect preferential flow paths brindt et al 2019 rahav et al 2017 calibrate effective hydraulic properties at irrigated fields moreno et al 2015 and the shallow sub surface tran et al 2016 characterize wetting and drying patterns under different irrigation scenarios vanella et al 2021 quantify irrigation efficiency vargas et al 2021 and monitor water extraction by roots and available water at the root zone moghadas et al 2017 ortuani et al 2019 shanahan et al 2015 nevertheless the sensitivity of the electrical signal to a wide range of parameters mainly water content and pore water salinity friedman 2005 and the non uniqueness and errors associated with the inverse procedure applied to obtain ec maps from raw measurements can lead to inaccurate hydrological interpretations binley et al 2015 tarantola 2005 tikhonov et al 2013 also it is a common practice to translate the obtained ec maps to hydraulic state parameters via hydro electrical relations calibrated either with field or laboratory data this procedure assumes that the obtained relations between the measured ec and the soil state parameters can be applied to measurements at various spatial scales several examples for such an assumption can be found at beff et al 2013 doetsch et al 2012 michot et al 2003 moreno et al 2015 nasta et al 2019 robinet et al 2018 shanahan et al 2015 however previous investigations have shown that this noted assumption can cause considerable errors in mass recovery that can reach up to an order of magnitude binley et al 2002 jougnot et al 2018 laloy et al 2012 müller et al 2010 singha and gorelick 2005 this work focuses on this assumption and studies the fine scale heterogeneous structure impact on the effective hydro electrical relations measured at larger scales considering fine scale heterogeneity in hydro geophysical properties to upscale the hydro electrical relations has been previously considered day lewis et al 2005 moysey et al 2005 nussbaumer et al 2019 singha and gorelick 2006 however to the best of the author s knowledge capillary heterogeneity i e fine scale capillary pressure fluctuations with permeability was never considered a cause for the hydro electrical scale dependency recent investigations focused on co 2 sequestration have shown that fine scale capillary heterogeneity has a significant impact on the effective properties that are being measured at larger scales jackson et al 2018 krause 2012 krause and benson 2015 moreno et al 2021 with respect to a single phase flow a recent study conducted by visentini et al 2020 had shown that the measured effective electrical conductivity is related to the fine scale heterogeneous structure of the soil moreover visentini et al 2020 have used this dependency in order to confine the soil s geostatistical parameters via a tracer experiment by measuring the effective electrical conductivity at different time lapses from the tracer injection stage however visentini et al 2020 have used a 2d domain and a fully saturated environment for their experiments reducing the domain to 2d cannot capture the heterogeneity impact on the entire 3d domain in addition in an unsaturated environment capillary heterogeneity can cause high spatial variability in the water content thus altering the electrical flow paths concerning the measured domain as a result the hydro electrical relations can alter significantly between different measurement scales as long as ergodicity is not fulfilled this work aims to examine the fine scale heterogeneous structure impact on the larger scale effective hydro electrical relations at unsaturated conditions the basic assumption in this study is that spatially invariant intrinsic hydro electrical relations exist at the fine mm scale furthermore a method to confine the soil s heterogeneous structure statistical parameters based on measurement of the effective electrical conductivity at different spatial scales is developed and tested on two synthetic cases and one realistic case which is based on a simultaneous injection of co 2 and brine i e a coreflooding experiment it is also emphasized here that although this study was conducted solely with numerical simulations a framework for conducting actual laboratory experiments to measure the hydro electrical relations scale dependency is proposed in the problem description section the paper is organized as follows the method section is divided into two subsections the first part section 2 1 describes the general problem governing equations assumptions and basic procedure applied to obtain the hydro electrical relations at different measurement scales i e a forward approach the second part of the methods section section 2 2 describes a stochastic inversion technique to confine the soil s heterogeneous structure statistical parameters from ec measurements at altering spatial scales i e an inverse approach results for each of the different procedures i e forward and inverse modelling are shown and discussed in section 3 a summary of the work and main conclusions are presented in the last section of this paper 2 methods the method section is divided into two subsections the first section describes the general procedure that was considered and the governing equations that were used for forward modelling i e obtaining scale dependent hydro electrical relations for known heterogeneous structures the second part of the methods section focuses on inverse modelling where a stochastic inversion technique to confine the heterogeneous soil structure by calibrating the effective hydro electrical relations at different measurement scales is proposed and described 2 1 problem description the general experiment contained a pre washed soil sample with a heterogeneous permeability field the sample is packed in an apparatus placed horizontally and an enforced capillary pressure p c ef is applied until hydrostatic equilibrium is obtained at this point an electrical current is injected between the inlet and outlet faces j o and the resulting electric potential is measured at different locations along the electrical flow direction ϕ i fig 1 shows a schematic sketch of the model domain for a rectangular cuboid apparatus this basic procedure is being repeated with altering suctions i e different p c ef values thus providing a large spectrum of the effective electrical measurements vs the mean saturation at different spatial scales since the presented study was conducted on synthetic soil samples i e structures were generated via geostatistical methods the procedure described above was conducted using numerical simulations mimicking the electric potential resulting from dc injection at different soil structures and saturation conditions the following describes the applied procedures capillary heterogeneity was modelled by applying the leverett j function relationship leverett 1941 scaling the applied effective capillary pressure p c ef to the fine scale heterogeneous properties as follows 1 p c s w k n α n x k x p c ef s w where α is the scaling parameter n is the porosity k is the permeability x x y z is the spatial location vector s w s w s w i 1 s w i is the effective water saturation where s w is the water saturation and s w i is the residual water saturation assumed to be 0 unless stated otherwise and p c ef s w is the soil s effective water retention curve used in this study as either the van genuchten model van genuchten 1980 eq 2 a or brooks and corey model brooks and corey 1966 eq 2 b 2a p c ef s w α v g s w 1 m 1 1 m 2b p c ef s w α bc s w 1 β where α v g and m are van genuchten empirical parameters and α bc and β are brooks and corey empirical parameters the fine scale water saturation at altering p c ef is obtained by substituting eq 2 a or 2 b in eq 1 once obtained the water saturation maps were translated to local scale electrical conductivity maps σ b x by adopting archie s law archie 1942 with known intrinsic hydro electrical relations 3 σ b x σ w n x c a in s w x s a in where σ w is the pore water electrical conductivity assumed to be constant and c a and s a are archie s cementation and saturation exponents the superscript in stands for intrinsic relations in this study the intrinsic hydro electrical relations were assumed to be 1 3 and 1 5 for the cementation and saturation exponents the adopted values were considered based on prior investigations conducted on homogeneous sandy soils friedman 2005 it is noted here that for a more general expression of the hydro electrical relations one also needs to account for soil s surface conductivity σ s laloy et al 2011 samouëlian et al 2005 in this study σ s was neglected this noted assumption can be valid when considering coarse grain soils samouëlian et al 2005 friedman 2005 or high pore water electrical conductivity friedman 1998 following the electric potential was obtained by solving the laplace equation numerically with a finite differences scheme 4 σ b x ϕ x σ b x 2 ϕ x 0 boundary conditions for eq 4 were taken as constant electric potential at the inlet face i e ϕ 0 y z ϕ 0 constant electrical current scaled to the cell s electrical conductivity at the outlet face i e j l y z j o and zero electrical flux for the remaining boundaries the effective electrical conductivity at different measurements scales was calculated by using ohm s law 5 j o σ b ef δ x i ϕ i ϕ 0 x i where ϕ i is the areal mean value of ϕ on the y z plain at location x i ϕ 0 is the areal mean value of ϕ at the inlet face the superscript ef stands for effective property and δ x is the volume of the sampled domain normalized to the electrical flow cross sectional area in the x direction i e δ x i x i referred to as the measurement scale hereafter in this study three measurement scales were considered where ϕ was measured at x 1 x 2 and x 3 the applied procedure was repeated with different p c ef and a new effective hydro electrical relations were calibrated for each measurement scale it is noted here that porosity heterogeneity had little impact on the effective archie s cementation exponent i e c a ef c a in at different measurement scales thus allowing the use of a constant average porosity with insignificant impact on the obtained results by adopting a homogeneous porosity the term n x c a in in eq 3 can be replaced with a constant archie s formation factor f thus only calibrating archie s effective saturation exponent i e s a ef nevertheless the heterogeneous porosity structure was considered for a realistic case presented in section 2 2 1 where the fine scale porosity and saturation distributions were obtained via ct images fig 2 shows a schematic diagram of the overall described procedure 2 1 1 model domain and scenarios used for forward modelling the basic procedure described above was performed on several synthetic soil samples to inspect the heterogeneity impact on the effective hydro electrical relations at altering measurement scales for that purpose a rectangular cuboid domain with a grid of 101 51 51 cells in the x y and z directions was generated with a cell size of δ y δ z 2 δ x 1 cm which is sufficiently large to be accepted as a representative elementary volume ni et al 2019 pini and madonna 2016 haruzi et al 2021 the numerical cells were populated with permeability values using sequential gaussian simulations pyrcz and deutsch 2014 deutsch et al 1992 with an arithmetic mean of the permeability of k 100 md and altering log permeability variances σ y 2 where y l n k and l n is the natural logarithm and correlation lengths i table 1 summarizes the statistical parameters that were considered where structure names indicate their heterogeneity degree and normalized correlation range e g structure v1r20 has a log permeability variance of σ y 2 1 and normalized correlation range of 3 i l 20 where l 50 cm is the total domain s length for all of the generated structures a constant porosity of n 0 3 was assigned and a van genuchten model eq 2 a was used for retention with α α α v g 155 kpa md and m 0 75 the applied capillary pressure i e p c ef was modified in an iterative procedure to provide a total amount of 9 mean saturation values ranging from 0 1 to 0 9 with equal spacing of δ s w 0 1 electric potential was evaluated at 3 locations along the electrical current flow direction located at x 1 l 0 2 x 2 l 0 5 and x 3 l 1 and the effective electrical conductivity for each saturation map was evaluated at the corresponding sampled volume via eq 5 it is indicated here that the applied capillary pressure was modified for each measurement scale individually in this approach 27 p c ef values were considered for each structure i e nine values for each of the three measurement scales this process ensures that the average saturation will be invariant of the measurement scale as a final step for each soil structure the effective hydro electrical relations were fitted to produce the measured effective electrical conductivity for the corresponding mean saturation i e s a ef as a function of the measurement scale δ x it is noted here that since the generated permeability fields were isotropic no trend in saturation along the electrical current flow direction should occur for example fig 3 shows the average saturation value along the electrical current flow direction and the overall mean saturation of the soil for the low heterogeneous structures at altering p c ef as shown in fig 3 all saturation profiles do not exhibit any trend with the electrical flow direction however fluctuations around the mean values can be noticed the observed fluctuations are minimal for the poorly correlated case i e v1r10 structure fig 3a and increase with the permeability correlation length i e v1r20 fig 3b and v1r40 fig 3c nevertheless the fluctuations do not show any trend with the electrical current flow direction 2 2 a stochastic inversion for confining the soil s geostatistical properties from effective ec measurements in this section a stochastic inversion technique to infer the soil s heterogeneous structure is proposed it is noted here that the overall goal of the proposed approach is not to obtain the complete permeability structure but to evaluate its geostatistical parameters i e the log permeability variance σ y 2 and correlation length i in addition it had been observed that different structures with similar geostatistical properties could result in different s a ef at different measurement scales hence the approach considered here is aimed to confine the geostatistical properties of the soil thus resulting in probability density functions of the geostatistical properties that mostly capture s a ef at different measurement scales the applied approach was tested on three different cases two synthetic soil samples where experimental measurements were mimicked by numerical simulations solely and one realistic case where numerical simulations of the electrical flow were conducted on laboratory experimental data and results were compared with a calibrated permeability field 2 2 1 overall procedure confining the soil s geostatistical parameters was conducted by applying a stochastic inversion technique based on an iterative approximated bayesian computation abc the basic concept of the bayesian approach is that a prior probability distribution π is modified to a posterior distribution after considering the observed data via a likelihood function 6 π θ y obs π y obs θ π θ where π θ y obs is the posterior distribution of the considered parameter θ σ y 2 and i in our case given the observed data y obs s a ef δ x in this case π θ is the prior distribution of θ and π y obs θ is the likelihood of the observed data gelman et al 1995 in the proposed approach the posterior distribution is characterized by drawing samples from the prior distribution and accepting or rejecting those samples according to their agreement with observations furthermore the posterior distribution is built based on a weighted kernel density function where the weights are assigned according to a distance metric sisson et al 2018 visentini et al 2020 7 ρ y sim y obs 1 n 1 n y i sim y i obs where n is the total number of observations domain sizes in our case here the posterior distribution is modified iteratively thus that the prior distribution of the next iteration is taken as the posterior of the current iteration i e π θ j 1 π θ y obs j where j is the iteration number final distribution is considered when the posterior converged to a constant distribution between two following iterations i e π θ j 1 π θ j it is noted here that since the distance metric is computed via calibrated values obtained from several independent measurements measurement errors impact is likely to reduce as the number of measurements increases nevertheless to account for measurement errors the distance metric was rescaled based on the goodness of the fit i e r 2 of the observed and simulated data as follows 8 ρ y sim y obs 1 n 1 n y i sim y i obs r i 2 obs r i 2 sim in this scaling approach the acceptance criterion for a valid sample increases for a poorly fitted observation and samples are more likely to be rejected when exhibiting high deviations from the calibrated hydro electrical model it is also noted here that although all of the tested scenarios were sterile i e measurement errors were not included an example of the applied approach capabilities to handle contaminated data is provided in appendix moreover since the effective hydro electrical relations measured at larger spatial scales are highly dependent on the measured relations at smaller domains a memory function is employed to reduce the computational effort in this procedure an initial m 1 realizations are generated based on the posterior distribution of the previous iteration for initializing the procedure i e for the first iteration an initial distribution is considered here the initial distribution was uniform with 0 and 4 as the limits for σ y 2 and 0 and 1 for the normalized correlation range 3 i l the effective hydro electrical relations are fitted for the smallest scale that was considered s a ef δ x 1 the distance metric is calculated for each realization via eq 8 and the realizations are ranked based on their performance and m 2 realizations with the lowest ρ are accepted where m 1 m 2 the permeability structure of the m 2 realizations between the smallest and the next domain size considered i e between x 1 and x 2 is generated conditioned on the m 1 realizations the m 2 realizations are ranked again according to eq 8 to generate m 3 realizations at the higher domain level conditioned on the m 2 structures where m 2 m 3 this process is repeated until all domain sizes are considered and the posterior distribution of the current iteration i e π θ j is generated via a weighted kernel distribution function with a reflection method to constrain the posterior to positive values bowman and azzalini 1997 jones 1993 in this work only three domain levels were considered where m 1 500 m 2 250 and m 3 100 were used furthermore two operators from heuristic approaches genetic algorithms were adopted to encourage convergence on the one hand and avoid local minimum traps on the other the two operators involve e l i t i s e m where the m 3 generated structures of the current iteration were moved to the next iteration intact and m i g r a t i o n where several realizations of the m 1 population are generated with values drawn from the initial distribution i e σ y 2 u 0 4 and 3 i l u 0 1 goldberg 1989 in this work the migration population was taken as 1 p m 1 m 3 where p 0 8 therefore at each iteration excluding the first 400 new realizations are generated i e 320 individuals from the posterior of the previous iteration and 80 individuals from the initial distribution a schematic sketch of the overall procedure is provided in fig 4 2 2 2 tested scenarios for the stochastic inversion approach the procedure described above was tested on two synthetic cases and one realistic case the two synthetic cases consist of a similar model setup containing a rectangular cuboid domain with a grid of 41 21 21 cells in the x y and z directions and a cell size of δ y δ z 2 δ x 1 cm the numerical cells were populated with permeability values using sequential gaussian simulations pyrcz and deutsch 2014 deutsch et al 1992 with an arithmetic mean of the permeability of k 100 md and a log permeability variances of σ y 2 0 72 and 2 74 and a normalized correlation range of 3 i l 0 11 and 0 29 for case i and case ii respectively table 2 summarizes the tested cases geostatistical parameters for both cases a constant porosity of n 0 3 was assigned and a van genuchten model eq 2 a was used for retention with α α α v g 155 kpa md and m 0 75 fig 5 shows the two synthetic permeability structures that were considered the procedure described at section 2 1 and schematically shown in fig 2 was applied for both structures adopting intrinsic relations of 1 3 and 1 5 for the cementation and saturation exponents respectively the effective archie s saturation exponent was calibrated at three domain sizes located at δ x 1 l 0 25 δ x 2 l 0 625 and δ x 3 l 1 in addition to the synthetic cases considered the proposed method was also tested on a third case which is based on real experimental data i e case iii following is a brief summary of the conducted experiment full information on the experimental design is provided at ni et al 2019 for the realistic case 3d saturation maps obtained from a co 2 water coreflooding experiment were used the experiments were conducted on a sandstone shezaf rock sample extracted from the upper part of the arqov formation in israel the core had a diameter of 4 9 cm and a total length of 6 6 cm co injection of super critical co 2 and water was carried out with a total injection rate of 3 ml min and altering fractional flows of 50 80 90 95 99 and 100 where the fractional flow is with respect to the co 2 injection rate e g for the fractional flow of 100 only co 2 was injected both phases i e co 2 and water were pre equilibrated with each other to prevent the dissolution of co 2 into water the core s 3d porosity and water saturation for each experiment were obtained from a ct image the 3d saturation for each experiment and porosity maps were translated to bulk electrical conductivity σ b x by applying archie s law eq 3 and by considering the co 2 as a non conductive phase and the intrinsic hydro electrical relations were taken as 1 3 and 1 5 for the cementation and saturation exponents respectively the electric potential for each saturation map ϕ x was obtained numerically using a finite differences scheme and a cylindrical domain containing 25 21 21 cells in the x y and z directions with a cell size of δ x 2 5 mm δ y δ z 2 mm it is mentioned here that the coreflooding experiment conducted on shezaf sandstone showed an increase in saturation near the core s outlet face due to capillary end effects huang et al 1996 hence to avoid capillary end effects impact on the inferred permeability field the effective hydro electrical relations were fitted for domain sizes at δ x 1 l 0 42 δ x 2 l 0 63 and δ x 3 l 0 83 where saturation fluctuations were stable up to the distance of x 0 85 see appendix at moreno and rabinovich 2021 the procedure described at section 2 2 1 and shown schematically at fig 4 was used to confine the core s geostatistical parameters for that purpose a brooks and corey model eq 2 b was used with s w i 0 05 α α bc α 436 kpa and β 0 35 the retention parameters used for this case were adopted from a previous work that fitted the core s retention properties anto darkwah et al 2021 furthermore for the sake of comparison a 3d permeability field that was obtained by an iterative procedure matching the simulated saturation and overall wetting phase pressure gradient with experimental measurements was adopted and is presented at fig 6a anto darkwah et al 2021 a further analysis was conducted fitting an exponential variogram kitanidis 1997 to the true permeability structure the fitted geostatistical parameters are shown in fig 6b and are listed at table 2 3 results and discussion similarly to the methods section the results and discussion section is also divided into two subsections first the results obtained from forward modelling described in section 2 1 are presented and discussed the second part presents and discusses the results obtained from the stochastic inversion technique applied to the different scenarios considered in this study 3 1 effective hydro electrical relations scale dependency for the sake of illustrating the effective hydro electrical relations scale dependency fig 7b shows the effective electrical conductivity calculated and fitted as a function of the mean saturation at the three measurement scales that were considered for the v1r40 structure the permeability structure is provided in fig 7a and its geostatistical parameters are listed in table 1 a strong dependency between the effective hydro electrical relations and the measurement scale can clearly be noticed in this structure where s a ef vary from 1 65 to 1 78 and 1 90 between the 10 25 and 50 cm measurement scales this strong dependency implies that even for a weakly heterogeneous structure i e σ y 2 1 applying hydro electrical relations calibrated with a single measurement scale can result in significant errors in the hydrological interpretations such misinterpretations can result in a 5 difference in the estimated water saturation when transforming the measured electrical conductivity to water saturation via hydro electrical relations calibrated at the 50 cm scale to a 10 cm sample and vice versa this misinterpretation increases with the log permeability variance and reaches 6 for σ y 2 2 structure v2r40 and 7 for σ y 2 4 structure v4r40 in addition and as can be noticed in fig 7b such misinterpretations in the estimated water saturation are more pronounced at low to intermediate saturation degrees thus having an even further implication in estimating relative permeability or capillary pressure with severe consequences in evaluating water and solutes dynamics at the subsurface a further inspection of the fine scale heterogeneous structure on the effective hydro electrical scale dependency was carried out with nine different permeability structures fig 8 and table 3 summarizes the fitted effective hydro electrical relations i e s a ef for the different structures at different scales it is noted here that the goodness of the fit i e r 2 was greater than 0 99 for all of the calibrated s a ef the obtained effective hydro electrical relations at different measurement scales illustrate the scale dependency of such relations and their relationship to the inner sub core scale capillary heterogeneity it can be seen that this dependency can even reach a ratio of 1 6 between the 50 cm and the 5 mm scales as can be seen for structure v4r40 yellow line in fig 8c also it can be noticed that the log permeability variance is mostly related to a sharp increase in s a ef from the mm scale intrinsic relations to the larger cm scale as seen by the differences between the blue red and yellow lines in fig 8 for all correlation lengths at δ x 10 cm for example s a ef calibrated for a highly heterogeneous structure σ y 2 4 at a measurement scale of δ x 10 cm is 15 larger than the one calibrated for a weakly heterogeneous structure σ y 2 1 with a similar correlation length further the permeability structure correlation length mostly influences s a ef at larger measurement scales i e from the cm to the 10 s cm scales an example for such dependency can be seen by the increase in s a ef from the 10 cm to the 50 cm scales of the highly heterogeneous structures σ y 2 4 at different correlation lengths where s a ef increased by 21 8 and 6 for correlation lengths of i 6 67 3 33 and 1 67 cm respectively those two observations can be explained by the fact that a more connected permeability body i e large correlation length will result in long preferential electrical flow paths connecting the inlet and outlet faces for smaller domains however such connected bodies are more likely to be interrupted and will be disconnected at larger domains thus increasing the tortuosity of the electric flow with the increase in the domain size resulting in larger variability in s a ef between the different measurement scales in addition the log permeability variance encourages inner structure disorders thus straightening the contrast between electrical conductive bodies resulting from spatial variabilities in the saturation degree this phenomenon can also be translated to higher variability in s a ef at different measurement scales an analogue to this phenomenon can be drawn from solute transport behaviour where the macro dispersivity increases when introducing additional levels of heterogeneity due to the increase of the sampled domain dagan 2012 such dependency implies that misinterpretation in the saturation degree increases with the correlation length and log permeability variance furthermore it can also be noticed in fig 8c that for the high correlated structures s a ef increases with a relatively high slope and thus errors in the interpreted saturation are likely to increase even further for larger sampled domains in addition it can also be noticed that for weakly correlated structures fig 8a s a ef starts to converge at larger measurement scales this observation can imply ergodic behaviour meaning that calibrating the hydro electrical relations at a sufficient sample volume can accurately capture the hydro electrical relations at larger domains however when such relations are applied to smaller domains it can still result in some bias for example even for the most weakly heterogeneous and correlated case that was considered v1r10 structure s a ef at the 50 cm scale is greater by 4 than s a ef at the 10 cm scale such differences in s a ef can result in a 2 error in the inferred saturation moreover it can also be noticed that this ergodicity is hard to obtain and requires a sample volume 30 times greater than the correlation length an effective medium approximation ema friedman et al 1995 kirkpatrick 1973 can be used to estimate the differences between the weakly correlated cases and ergodic conditions 9 σ b x σ b ef e m a σ b x 2 σ b ef e m a d σ b 0 where σ b ef e m a is the effective electrical conductivity at ergodic conditions fig 9 shows the effective electrical conductivity at the largest domain size i e σ b ef δ x 50 cm and the estimated values considering ergodicity σ b ef e m a for the weakly correlated cases i e v1r10 v2r10 and v4r10 as can be seen for the weakly heterogeneous case v1r10 the ema is in good agreement with the calculated effective electrical conductivity however the ema accuracy reduces with the structure variance i e for the v2r10 and v4r10 cases the drop in the ema accuracy for high heterogeneous structure means that ergodicity for the high and medium heterogeneous structures have not reached even for a sample volume 30 times greater than the correlation length this observation can also be seen in fig 8 where s a ef increases with the sampled domain size nevertheless it can still be noticed that each permeability structure has a unique signature on the effective hydro electrical relations calibrated at different measurement scales such observation can be beneficial in inferring the heterogeneous permeability structure i e σ y 2 and i from measuring the effective hydro electrical relations at altering measurement scales 3 2 inferring the soil s structure geostatistical parameters the stochastic inversion procedure described in section 2 2 1 and illustrated in fig 4 was applied for the three cases presented in section 2 2 2 in order to confine the structures geostatistical parameters table 4 summarizes the fitted archie s saturation exponents at different measurement scales for the different scenarios which were used as the observation data and were obtained by applying the forward approach described in section 2 1 it can be noticed by comparing tables 3 and 4 that both of the synthetic structures i e case i and ii obey the general observation obtained at section 3 1 i e case i weakly heterogeneous and poorly correlated case shows a slight increase in s a ef at different measurement scales and case ii moderately correlated and heterogeneous structure exhibits more significant deviations in s a ef at the different measurement scales nevertheless to test the robustness of the proposed approach prior assumptions and limitations on the hydraulic structure were not included and a uniform distribution of σ y 2 u 0 4 and 3 i l u 0 1 were used for the initial distributions fig 10 shows the posterior distributions of both σ y 2 and 3 i l at the different iterations as well as the initial distribution for reference for the weakly heterogeneous and poorly correlated case i e case i from fig 10 it can be seen how the posterior distribution of both parameters i e σ y 2 and i narrows down with each iteration and converge towards the true values that were considered indicated with vertical red dashed lines for the final distribution shown with a continuous blue line it can be inferred that the probability for 0 30 σ y 2 1 65 and 0 06 3 i l 0 58 is 90 70 for 0 41 σ y 2 1 03 and 0 09 3 i l 0 34 and 50 for 0 48 σ y 2 0 87 and 0 10 3 i l 0 26 it is indicated that the true values were σ y 2 0 72 and 3 i l 0 11 furthermore fig 11a shows a box plot of the final posterior distribution for the case in hand i e case i from fig 11a it can be seen that the estimated posterior capture the true values that were considered with good accuracy moreover the posterior distribution required 32 iterations to converge meaning that a total number of 12 900 realizations were generated for a further inspection fig 12 shows the inner sub core log permeability distribution in terms of normalized histograms for 20 individuals drawn from the final posterior distribution grey lines the actual log permeability distribution dashed red line and the ensemble mean of the posterior distribution dotted blue line fig 12 shows the variability of the log permeability distribution of each realization and exhibits additional confinement of the permeability structure it can also be noticed that the ensemble mean is in good agreement with the actual permeability distribution fig 13 shows the posterior distributions at different iterations for the moderately heterogeneous and correlated case i e case ii similarly to case i it can be noticed that the applied approach captures quite well the two geostatistical parameters that were considered also here the posterior distribution is more confined with each iteration and converged towards the true geostatistical parameters that were used as opposed to the first tested case the final posterior distribution is wider showing larger uncertainties in the estimated geostatistical parameters nevertheless the considered parameters are still well confined and the ensemble agrees with the true values for example from the final distribution it can be inferred that the probability of 1 58 σ y 2 3 72 and 0 08 3 i l 0 54 is 90 70 for 1 96 σ y 2 3 34 and 0 13 3 i l 0 40 and 50 for 2 26 σ y 2 3 12 and 0 16 3 i l 0 34 where the true values were σ y 2 2 74 and 3 i l 0 29 this observation can also be noticed in fig 11b which shows the box plot of the final posterior distribution for case ii in addition fig 14 shows the inner log permeability distribution for 20 individual realizations and the ensemble mean vs the true structure also here it can be seen that the ensemble well confines the true permeability structure and the overall mean is with an excellent agreement with the true permeability structure that was considered also it is important to note that the posterior distribution for this scenario converged after 27 iterations resulting in a total number of 10 900 generated realizations fig 15 shows the posterior distribution at different iterations for both σ y 2 and 3 i l for the realistic case i e case iii similarly to both of the synthetic cases it can be noticed that the posterior distribution converged towards a more confined distribution for both geostatistical parameters however it can be seen that the final distribution is wider than the synthetic cases that were considered nevertheless probability peaks still fairly agree with the true permeability field used for comparison this observation can also be noticed in fig 11c which shows the posterior box plot of the realistic case it can also be seen in both figs 11 and 15c that the correlation range is with a better agreement to the true permeability structure than the heterogeneity degree i e σ y 2 examining the core s true effective properties listed in table 4 it can be seen that s a ef δ x reduces with the size of the sampled domain this observation is in contrast to prior observations see table 3 and the 2 synthetic cases in table 4 the low s a ef values smaller than the intrinsic value can be a result of a highly conductive skeleton that spans across the entire domain this conductive skeleton will be translated to a relatively high spatial correlation in the permeability structure thus reducing the heterogeneity level impact on the effective electrical conductivity the applied stochastic inversion approach captures this phenomenon quite well where the ensemble mean of s a ef resulted in s a ef δ x 1 1 365 s a ef δ x 2 1 312 s a ef δ x 3 1 294 where the true values were 1 366 1 311 and 1 293 respectively distributions of the permeability inner structure for 20 individual realizations the final posterior ensemble mean and the true structure are provided in fig 16 as opposed to the two synthetic cases examined the true permeability structure exhibits a different distribution than the estimated structures the observed misfit is mainly located at low permeability values l n k 2 75 where the estimated structures show a considerable amount of cells with low permeability where l n k 2 75 for the true structure does not exist one of the causes for this misfit relies on the gaussian structure assumption used to estimate the permeability structure the noted gaussian structure assumption also causes a larger estimated σ y 2 than the one exhibited by the true structure which can be seen in both figs 11 and 15c nevertheless due to the ability of the estimated structures to capture the effective hydro electrical relations it can be stated that such low permeability cells have a negligible impact on the electric flow this negligible affect can be explained by the low mean saturation obtained in the coreflooding experiments where s w 0 73 for the 100 fractional flow experiment such low saturation resulted in full water saturated cells or near full saturation for permeability values of l n k 2 75 hence permeability values below this threshold are redundant since s w l n k 2 75 1 when considering all low permeability cells as equivalent to l n k 2 75 due to the insignificance of values below that point it can be stated that the ensemble mean structure is in a reasonable agreement with the true structure furthermore it is important to point out that the true permeability structure was not considered in the inversion process the estimated permeability fields were generated solely from porosity and water saturation maps obtained directly from 3d ct scans at different fractional flows 4 summary and conclusions this work inspected the fine scale capillary heterogeneity impact on the effective hydro electrical relations calibrated at different measurement scales a procedure to measure those properties was suggested and numerical experiments conducted on synthetic soil samples with different permeability structures were performed in addition a novel stochastic inversion technique was developed in order to confine the soil s permeability stochastic parameters i e log permeability variance σ y 2 and correlation length i results have shown that the hydro electrical relations scale dependency is highly influenced by the sub core mm scale heterogeneous structure and that even for homogeneous intrinsic relations archie s saturation exponent can almost be doubled when calibrated at different measurement scales such dependency can cause a severe misinterpretation in the hydrological state of the soil and can extend to more than a 5 error when translating the electrical signal to water saturation levels moreover it was observed that the significant errors are more pronounced at low to intermediate saturation values due to the non linear relation between the water saturation and capillary pressure and relative permeability this observation has even further implications when drawing conclusions regarding water and solutes dynamics at the subsurface however it is important to note that results were obtained by assuming that the soil surface conductivity can be neglected in several cases neglecting the surface conductivity can be a valid assumption e g when considering coarse texture soils or when the pore water electrical conductivity is sufficiently high nevertheless additional future work will include fine scale heterogeneities in surface conductivity and pore water electrical conductivity impact on the effective hydro electrical relations at different measurement scales the hydro electrical scale dependency was set as the basis for a novel stochastic inversion technique that confines the soil s geostatistical parameters the proposed approach was tested on three cases two synthetic soils with a known structure and one realistic case for the realistic case 3d saturation and porosity maps obtained from ct images during a two phase co 2 and brine injection at altering fractional flows served as the input data and a calibrated permeability field was adopted for comparison for the two synthetic cases it was shown that the proposed approach was able to confine the soil s geostatistical parameters with high accuracy and a relatively narrow distribution around the true values moreover it was shown that the ensemble mean structure distribution is with a high agreement to the true structure for the realistic case it was also shown that the considered approach is capable of confining the core s geostatistical parameters although uncertainties were higher than the synthetic samples considered nevertheless the posterior distribution for the realistic case agreed with the referenced permeability field geostatistical parameters important implications of this work are related to the application of geo electrical methods used in the field for hydrological and agricultural pursuits e g ec tomography and electro magnetic induction since both methods provide a spatially variable electrical conductivity at altering spatial resolution it was shown here that the hydro electrical relations are highly influenced by the soil s heterogeneous structure at the local scale and therefore this structure should be considered when translating the electrical signal to the soil s hydraulic state parameters in addition further investigation should include an approach to upscale or downscale the hydro electrical relations to the desired scale while considering the local scale capillary heterogeneity moreover the capability of the stochastic inversion approach to confine the permeability structure statistical parameters can be applied in order to generate different realizations of the permeability field at the investigated site which can be used for probabilistic predictions of the subsurface water flow and solute transport with a limited amount of spatial measurements furthermore it is also recommended to measure the effective electrical conductivity at different spatial scales when conducting a two phase flow coreflooding experiment the additional measurements can be used to confine the calibrated permeability field of the core or for directly upscaling the permeability structure to larger scales as was shown in moreno and rabinovich 2021 in addition since coreflooding experiments already contain 3d ct scans to measure saturation and porosity distributions at the sub core level adding electrical measurements at different spatial scales can also be used to calibrate and validate the local scale intrinsic hydro electrical relations credit authorship contribution statement ziv moreno writing original draft writing review editing methodology conceptualization software formal analysis resources investigation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the author would like to thank the editor and the two anonymous reviewers for their comments on an early version of this manuscript which helped to improve it considerably the author would also like to acknowledge shmulik friedman for his constructive comments regarding this manuscript appendix applying the stochastic inversion technique on contaminated data the following section illustrates the capabilities of the stochastic inversion technique described in section 2 2 to handle contaminated data the two synthetic cases were adopted for that purpose i e cases i and ii measurements errors were added to the true measured values by adding white noise with a normal distribution of zero mean and a standard deviation of 3 from the true values fig a 1 shows the effective electrical conductivity as a function of the mean saturation at different measurement scales for both cases considering the sterile data blue pluses and the contaminated data red crosses as a result of contaminating the data archie s effective saturation exponents were slightly modified table a 1 shows the contaminated s a ef as a function of the measurement scale for both cases the stochastic inversion technique was applied for both of the contaminated cases figs a 2 and a 3 show the posterior distribution at different iterations for case i and case ii respectively as can be seen the final posterior distribution was able to confine the soil s geostatistical parameters with a narrow distribution around the true values for both of the contaminated cases suggesting that it can also be used to handle contaminated data 
179,geologic heterogeneity is one of the important factors controlling migration and distribution of nonaqueous phase liquids in the subsurface heterogeneity such as fractures complicates the effectiveness of environmental remediation and uncharacterized aquifer heterogeneity causes significant uncertainties in the removal of nonaqueous phase liquids foaming an injection gas is an effective method to alleviate the challenges in accessing heterogeneous media during remediation processes because foam is nonnewtonian and redirects gas and liquid flow foamed gas may also assist in increasing the storage of carbon dioxide in saline formations this paper investigates foam flow behavior in microscale fractures and develops a mechanistic transient foam flow model using the population balance method microscale experiments in fractures with apertures of 25 and 88 μ m are used to validate the model for pressure drop gas saturation and bubble texture key differences related to modeling foam in fractures are the potential for continuously varying gas liquid curvature in fractures and the relationship of this curvature to apparent foam viscosity incorporation of a local foam flow resistance factor is important to representing flow physics accurately hence the results of this study provide foundational understanding for upscaling foam rheology in different sized fractures to ensure successful operations in soil aquifer remediation and co2 storage in saline formations keywords foam fractures microscale population balance flow resistance nomenclature α effective viscosity constant pa s 2 3 m 10 3 α m a x maximum effective viscosity constant pa s 2 3 m 10 3 α m i n minimum effective viscosity constant pa s 2 3 m 10 3 γ foam quality fraction μ f foam apparent viscosity pa s μ g gas viscosity pa s μ p phase viscosity pa s μ w water viscosity pa s ω exponent in foam generation coefficient ϕ porosity ψ proportionality constant for flowing foam fraction calculation ρ p phase density kg m 3 σ interfacial tension n m a proportionality constant a proportionality constant that varies between 0 and 1 b aperture size m c s surfactant concentration wt c s reference surfactant concentration wt g percolation exponent g c gravitational constant k permeability d k 1 0 foam coalescence rate constant m 1 k 1 0 foam generation rate constant s 1 3 m 13 3 k r g gas relative permeability k r g 0 end point of gas relative permeability k r p phase relative permeability k r w water relative permeability k r w 0 end point of water relative permeability l s slug length m n f flowing foam texture m 3 n f limiting foam texture m 3 n l dimensionless length of the thin film portion of bubble n l number of lamellae per unit length m 1 n s dimensionless number for surface tension gradient effect n t trapped foam texture m 3 p pressure pa p 0 proportionality constant for capillary pressure calculation p c m a x maximum value for p c pa p c capillary pressure pa p c limiting capillary pressure pa q b sink source term for bubbles r capillary radius m r b foam bubbles radius m r c radius of curvature m s f foam saturation s g f flowing gas saturation s g t trapped gas saturation s g gas saturation s w c connate water saturation s w water saturation t time u g gas darcy velocity v f foam interstitial velocity m s v g gas interstitial velocity m s v w water interstitial velocity m s x f flowing foam fraction z depth 1 introduction subsurface contaminant migration is a complex problem caused by fluid fluid and rock fluid interactions and by rock heterogeneities the contaminants may remain in porous media as a free phase or may bind to the soil rock interface wang and mulligan 2004 some nonaqueous phase liquids napls have densities greater than the resident water referred to as dnapls and therefore they migrate below the water table and may be immobilized at the bottom of the aquifer hirasaki et al 1997a as a result dnapls may serve as long term sources of contamination impacting both groundwater and surface water large interfacial tension between napls and water and insolubility and immiscibility of the napls in water makes traditional remediation efforts difficult wang and mulligan 2004 hirasaki et al 1997a oolman et al 1995 pope and wade 1995 estimating napl mass and removal from source zones is difficult due to lack of information on the extent or timing of spills complex napl entrapment configurations created by fingering geologic heterogeneity and lack of characterization techniques for recognizing heterogeneity as well as uncertainty in locating source zones saenton and illangasekare 2013 geologic heterogeneity is an important factor affecting and controlling migration and distribution of napl in the subsurface kueper et al 1989 kueper and frind 1991 kueper and gerhard 1995 illangasekare et al 1995 dekker and abriola 2000 bradford et al 2000 heterogeneity makes source zone characterization nelson et al 1999 and the effectiveness of napl remediation meinardus et al 2002 saenton et al 2002 significantly complicated uncharacterized aquifer heterogeneity causes significant uncertainties in the removal of napl from source zones saenton et al 2002 saenton et al 2002 studied the effectiveness of surfactant enhanced aquifer remediation sear for soil decontamination in heterogeneous formations and observed that surfactant as a treatment agent completely bypassed low permeability zones and hence the ability to deliver fully these agents is hindered by this bypassing effect therefore remediation processes are now focused on using high viscosity agents e g foams enhanced bioremediation in situ chemical oxidation co solvent flushing and sear saenton and illangasekare 2013 foam is a special colloidal dispersion consisting of a gas dispersed in a liquid and stabilized by a foaming agent lord 1981 smith 1996 foaming an injection gas is an effective method to alleviate the challenges of bypassing faced during remediation processes and to assist in the storage of carbon dioxide in saline formations eide et al 2020 the reduced mobility of foamed gas as compared to continuous gas makes storage more effective by immobilizing the gas and trapping it in the high permeability layers and thereby diverting the gas to the lower permeability zones tang and kovscek 2006 almajid et al 2021 the flow of thin liquid films separating gas bubbles across pore walls results in a much larger apparent viscosity for foams hirasaki and lawson 1985 foam also diverts aqueous injectants to low permeability zones during aquifer soil remediation jobs improving the drainage of contaminants out of the affected areas hirasaki et al 1997b 1 1 remediation with foam in a case study by hirasaki et al 1997b the effectiveness of foam for aquifer remediation processes was field tested in a heterogeneous dual permeability 40 and 100 darcy aquifer contaminated with dnapl they tested foamed surfactant solution to clean the dnapl from the aquifer the napl was trapped in the tighter zones toward the bottom of the aquifer introducing an additional challenge for the remediation process hirasaki et al 1997b their results showed that the injected foam removed almost 97 of the napl from the swept pore volume szafranski et al 1998 the air injection rate for foam generation was low and the required pressure gradient for foam propagation was kept small hirasaki et al 1997b szafranski et al 1998 additionally foam diverted the injected surfactant solution from high permeability zones to low permeability zones and hence improved the sweep efficiency mamun et al 2002 confirmed that the high quality and low quality regimes observed in petroleum applications also apply during the small pressure gradient that is applied in environmental remediation furthermore multiple studies tang and kovscek 2006 kharabaf and yortsos 1998 showed that several factors including pressure gradient permeability and bubble density influence the trapped foam fraction in porous media 1 2 remediation in fractured rocks several factors including geometry of the fracture network such as fracture orientations apertures interconnectivity densities and wall roughness capillary pressure and the properties of the napl including viscosity density and interfacial tension govern the movement of napls in fractured aquifers mackay and cherry 1989 mercer and cohen 1990 hardisty et al 1998 wealthall et al 2001 fractures assist in migration of dnapls to significant depths if large volumes of spilled dnapl pass through fractures with interconnectivity dnapls invade progressively smaller aperture fractures with depth kueper and mcwhorter 1991 and the fluid pressure increases as a result lower permeability matrix may be invaded hardisty and ozdemiroglu 2006 the vertical migration of lnapls light non aqueous phase liquid in fractured aquifers is blocked by the water table however lateral invasion can occur in any direction independent of the hydraulic gradient hardisty et al 1998 characterization and remediation of napls in fractured systems is difficult and expensive due to the heterogeneous nature of fractured systems and inherent complexity of multiphase flow in them hardisty and ozdemiroglu 2006 traditional napl removal methods including focused pumping and high vacuum extraction perform acceptably in unconsolidated aquifers however they generally perform poorly in heterogeneous media and fractured systems hardisty and ozdemiroglu 2006 therefore more promising techniques such as steam assisted recovery and sear are applied rigorously for removal of napls in fractured systems and heterogeneous media 1 3 foam in heterogeneous media fractured porous media have complicated single and multiphase flows due to their complex structures a contributing factor is the difference in permeability of the fractures and unfractured matrix in order to improve the efficiency and increase the fraction of napl recovered the gas mobility may be controlled by foam injection pancharoen et al 2012 nazari et al 2017a 2018 kovscek et al 1995a studied foam flow behavior through a transparent replica of a natural rough walled fracture with a 30 μ m wide aperture they showed that foam exhibits effective control of gas mobility kovscek et al 1995a because foam flow resistances were approximately 100 540 times greater than those of single phase nitrogen for a wide range of foam qualities spanning from 0 60 to 0 99 kovscek et al 1995a additionally they showed that foam rheology in fractured media was a function of bubble shape and size changes in flow behavior depend on transitions in bubble morphology kovscek et al 1995a shojaei et al 2019 the effect of foam on controlling the gas mobility in heterogeneous porous media was investigated by different groups alquaimi and rossen 2019 nazari et al 2017b 2020 multiple studies llave et al 1990 casteel and djabbarah 1988 alquaimi and rossen 2019 reported that injecting foam improved sweep efficiency in the field by diverting foam flow to the lower permeability zones elsewhere the importance of capillary communication among different permeability media was highlighted bertin et al 1999 in thin heterogeneous layers where cross flow occurs due to capillarity foam fronts move at nearly identical rates in each layer limiting or eliminating cross flow leads to high permeability zones filling with foam and diversion of flow into low permeability media it was found that foam moves through low permeability media more rapidly in comparison to the high permeability region a later study showed that increasing liquid velocity results in decreasing foam mobility significantly as a result there was a possibility of complete gas blockage especially in the high permeability zones kovscek and bertin 2003 due to complexity of foam properties and fractures several studies were conducted to study foam mechanisms in fractures yan et al 2006 studied the effect of foam to improve the efficiency of a surfactant flooding process they proved that improving foam texture corresponds to increasing the apparent viscosity of the foam buchgraber et al 2012a conducted experiments in silicon micromodels with different fractures and showed that foam even at low qualities of 20 30 significantly reduces the mobility of gas the mobility reduction factor reported was as great as 400 500 in rough fracture models and it increased linearly with foam quality furthermore they reported that foam coalescence occurs in the fractures at high foam qualities of 90 95 pancharoen et al 2012 investigated foam flow in a linear fracture with variable aperture along the fracture length the characteristics of foam flow through heterogeneous fractures was investigated numerically to include the effect of gas trapping and gravity they concluded that the underlying physics of foam flow resistance generation and coalescence are similar among fractured and unfractured media in fractured media however capillary pressure is smaller in comparison to matrix and it is more difficult to reach the limiting capillary pressure regime accordingly foam coalescence occurs slowly in fractures they showed that the fracture aperture plays an important role in foam flow characterization in fractures with rough walls propagating foam through the most permeable paths results in great flow resistance furthermore modeling confirmed that the role of curvature on foam effective viscosity is necessary for mechanistic prediction of foam characteristics in fractures the novelty of this work is to advance experimental and numerical understanding of foam propagation in fractured systems we report the design and fabrication of a new micromodel with a representative planar fracture that permits direct observation of bubbles and withstands pressures up to 100 psi 690 kpa we conducted our structural design optimization analysis in solidworks to maximize the internal pressure that the micromodel can withstand significant new foam flow resistance data was collected in fractures of different aperture then we developed and implemented a population balance model for foam in fractures the model was implemented in the modular multiphysics framework of the automatic differentiation general purpose research simulator ad gprs with a new foam simulation option for foam flow behavior through fractures this population balance model was validated using pressure drop and foam texture data in fractures with apertures of 25 and 88 μ m 2 methodology 2 1 design optimization the microscopic flow of foam is visualized using a micromodel instrumented to allow pressure drop measurements here we fabricated a new micromodel with an optimized design that withstands relatively high pressure conditions for microfluidic studies a stress analysis conducted using finite element methods solidworks evaluated the amount of stress applied on the fracture over a wide range of pressure differences between the inside and outside of the micromodel we created two different fracture designs shown in fig 1 by changing the geometry of the boundaries of the micromodel and adding more round grains that simulate asperities in the fracture plane to support the bonding of a coverplate to the micromodel porosity is calculated to be 98 22 and 86 93 for the initial and final designs respectively the finite element analysis resulted in simulated stress distributions for the two designs fig 2 increasing the number of islands and eliminating the sharp edges decreases the maximum stress from 798 psi to 150 psi our optimized design is a 2 cm wide by 7 75 cm long fracture that includes 25 posts to anchor the glass cover plate and provide more structural support during bonding the depth of the fractures are 25 1 μ m and 88 2 μ m for the two sets of experiments and the porosity of the channel is 87 a sandstone pattern buchgraber 2013 with porosity of 46 is printed and etched on the base of the fracture to generate the desired rough surface the printed matrix has 12 2 μ m depth and covers the entire length of the fracture fig 3 shows the sandstone pattern the topography of the etching and the cross section of the etched fracture 2 2 micromodel fabrication we fabricated our etched silicon micromodels at the stanford nanofabrication facility snf silicon wafers are k prime type wrs materials their diameter and thickness are 100 0 5 mm and 500 550 μ m respectively to start the process wafers are dehydrated in a prime oven at 150 c for 30 min the oven primed the wafers using hexamethyldisilazane hmds to establish better coverage and adhesion between oxides and resists then we coated the primed wafers with photoresist using the svg silicon valley group coater and an automated track system for dispensing photoresist on 4 silicon wafers buchgraber et al 2012b yun and kovscek 2015 next we employed a heidelberg mla 150 maskless system to print designs on the wafers designs were made using autocad a blank silicon wafer underwent direct write lithography in the heidelberg machine thereafter the wafers were processed through the svg developer and post baked to expose photoresist to create the topography on the developed wafers a two step etching process was conducted first they were etched either 25 1 or 88 2 μ m using an inductive charged plasma deep reactive ion etcher then the remaining photoresist on the wafers was removed by soaking the wafers in a chemical bath of piranha 90 sulfuric acid hydrogen peroxide for 20 min after drying the wafers in a spin dryer machine we baked and coated the wafers using hmds vapor prime oven and svg coater respectively in this stage we used the karl suss ma 6 contact aligner system to perform precision mask to wafer back side alignment and near uv photoresist exposure on the prepared wafer using soft contact configuration then we etched them for 12 2 μ m to create the roughness thereafter we used a diamond coated drill bit to perforate the two ports fig 1 shows the initial and final micromodel designs and location of the ports after drilling the ports the remaining photoresist on the wafers was then removed by soaking the wafers in a chemical bath of piranha for 20 min finally we bonded an optically flat borofloat glass wafer s i howard to the top of a clean wafer using anodic bonding at 1045 v and 300 c for 1 h buchgraber et al 2012b yun and kovscek 2015 subsequently we placed the micromodel inside a micromodel holder and conducted our experiments 3 experimental fig 4 is a schematic of the experimental system the microscale setup allows the simultaneous injection of nitrogen gas and foamer solution as well as the measurement of flow parameters specifically pressure drop along the model bubble texture and the in situ fluid saturations the foamer solution was prepared by mixing stepan bioterg alpha olefin sulfonate as 40 surfactant in nacl brine solution the final concentration of the active surfactant was 0 5 wt in a 0 5 wt brine the nacl was purchased from thermo fisher chemicals inc the brine was prepared by dissolving nacl in house deionized water followed by addition of surfactant we controlled the nitrogen injection using a mass flow controller bronkhorst el flow select while the liquid injection was controlled by a syringe pump harvard foam quality was obtained by measuring the injected gas and liquid volumes to start the experiments 90 foam quality was generated by coinjecting the foamer solution and nitrogen through the micromodels the rate of injecting gaseous and aqueous phases were chosen to be 6 73 and 0 75 μ l min respectively these rates are computed at our desired back pressure a 15 psi backpressure was applied during all experiments using a backpressure regulator after generating foam through the micromodel we allowed it to come to steady state a z16ap model leica microscope with a photo tube that connects to a video camera was employed to visualize the flow pattern at the pore level in the micromodel the silicon wafer micromodels are opaque and their inside flow was monitored using reflected light from the internal microscope light source simultaneously we measured the pressure drop across the micromodel during the entire experiment to measure the pressure changes we used a quickstart m6 pressure sensor evaluation kit i2c ps200m6 eval idex health science llc the sensitivity of the pressure sensors is 0 21 mbar 0 003 psi finally macroscopic images and videos showing foam quality and texture were captured and analyzed to calculate the bubble texture and the aqueous phase saturation along the micromodel 4 mechanistic model the underpinnings of this model are the mass conservation equations of the gaseous and aqueous phases as described by aziz 1979 due to the absence of foamer solution in porous media we add an additional mass conservation equation for the surfactant almajid et al 2021 the mass balance equations were adopted from almajid et al 2021 in addition to the mass balance equations many foam models emphasize the importance of tracking foam texture for the accurate prediction of foam flow through the porous medium hirasaki and lawson 1985 patzek 1988 friedmann and jensen 1986 falls et al 1988 1989 ettinger and radke 1992 kovscek et al 1995b chen et al 2010 the population balance model for foam was introduced by patzek 1988 the capability of a population balance model to address the evolution of foam texture and as a result reducing the gas mobility makes it a good candidate to study foam behavior in porous media kovscek et al 1997 this method provides a comprehensive framework to cover all relevant physics of foam generation and transport furthermore in this method the pore level events in foam generation coalescence and constitutive relations are well depicted kovscek et al 1997 additionally this method generally represents the mass and energy balance equations similar to reservoir simulation approaches kovscek et al 1995b this model covers the foam texture changes created by capillary snap off bubble division coalescence diffusion evaporation or condensation patzek 1988 in addition this model accounts for bubble trapping and mobilization patzek 1988 eq 1 shows the transient balance of foam texture kovscek et al 1997 1 t ϕ s g f n f s g t n t u g n f ϕ s g r g r c q b where subscripts f and t denote the flowing and trapped gas respectively the first term on the left accounts for bubble accumulation and the second shows that foam bubbles convect with the gas phase the first and second terms on the right hand represent the net generation and coalescence respectively the last term on the right is the bubble source term foam texture n f is the number density of foam bubbles per unit volume of flowing gas n t is the trapped bubble density per unit volume of the trapped gas and s f is the saturation of flowing gas the total gas saturation s g is obtained by adding the flowing gas saturation s g f and the trapped gas saturation s g t various expressions were used by other researchers falls et al 1988 kovscek et al 1995b kam and rossen 2013 to express the foam generation and coalescence mechanisms represented by this method including snap off lamella division and leave behind ransohoff and radke 1988 we adopted the rate of generation r g used by chen et al 2010 and almajid et al 2019 in our problem formulation 2 r g k 1 0 1 n f n ω v w v f 1 3 where k 1 0 is the generation rate constant n is an upper limit for foam texture set by the porous medium ω is a constant representing the shape of inverse proportionality of foam generation sites to preexisting gas bubbles and is set to 3 based on the results from chen et al 2010 v w and v f are interstitial velocities of aqueous phase and flowing foam that are local vector quantities and depend on local saturation and total potential gradient including gravity and capillary pressure note that subscript 1 stands for the generation rate of the foam in the medium different mechanisms lead to foam coalescence among them gas diffusion and capillary suction lead to foam breakdown capillary suction is considered here to be the main mechanisms for the coalescence of foam kovscek and radke lamella stability is a function of surfactant properties surfactant concentration rock type liquid saturation and how fast the bubbles move through the pore space khatib et al 1988 aronson et al 1994 jiménez and radke kahrobaei and farajzadeh 2019 therefore the rate of coalescence is defined by 3 r c k 1 0 p c p c c s p c 2 v g n f where k 1 0 is the coalescence rate constant and p c is the limiting capillary pressure for foam suction coalescence the coalescence rate constant reflects the number of active termination sites and depends on surfactant concentration the wetting liquid content and the limiting capillary pressure p c the local capillary pressure p c is computed from the leverett j function kovscek et al 1995b and defined as 4 p c p 0 σ a s w s w c b where p 0 ϕ k ϕ is the porosity of the rock k is the absolute permeability of the rock σ is the surface tension and a is taken as a constant that varies between 0 and 1 for this study we choose a and b to be 0 022 and 0 2 respectively the limiting capillary pressure p c in porous media varies with surfactant formulation and concentration a large concentration of surfactant leads to large values of p c a study by aronson et al 1994 suggests the following functional form for p c 5 p c c s p c m a x t a n h c c c s where p c m a x is a maximum value for p c and c s is a reference surfactant concentration for strong net foam generation throughout this study u w and u f are darcy velocities for the aqueous phase and foam respectively they are local vector quantities and depend on local saturation and total potential gradient including gravity and capillary pressure kovscek et al 1997 and defined by 6 u p k k r p μ p p p ρ p g c z where subscripts p is interchangeable between aqueous w and foam phases f respectively also k r is relative permeability μ is viscosity ρ is density p is pressure g is gravitational constant and z is depth the details of relative permeability of surfactant solution and foam are described in kovscek and radke the foam effective viscosity is greatly determined by foam texture gas liquid bubble curvature gas fractional flow and capillary pressure as foam with high quality travels in capillaries the liquid phase flows as a thin film within foam lamella khatib et al 1988 as well as along the walls of the capillary lamella stability depends on local capillary pressure de vries and wit 1990 the surfactant type and concentration a study by de vries and wit 1990 showed that foam can only exist below a certain quality that exists at limiting capillary pressure p c to picture foam flow in fractures we need to consider a chain of gas bubbles separated by thin liquid films to classify foam flow in capillaries we need to consider the ratio between the radius of the bubbles and the radius of the capillary based on this ratio foam can be considered as bulk foam or individual lamella if the radius of the bubbles r b is smaller than the radius of the capillary r then foam is characterized as bulk foam on the other hand if the bubble radius is greater than the capillary radius then foam is characterized as individual lamella according to hirasaki and lawson 1985 the individual lamella exists if r 2 r b by touching the bubbles in the plateau border the meniscus radius of curvature decreases a smaller radius of curvature results in increasing the drag force acting on the bubbles according to hirasaki and lawson 1985 total apparent viscosity of foam in capillaries is obtained by 7 μ f μ l s n l 0 85 n l r r c r 3 μ v w σ 1 3 r c r 2 1 n l r 3 μ v w σ 1 3 n s 1 e n l 1 e n l the first term is the liquid slug contribution to viscosity calculation l s is the liquid slug s length and n l is the number of lamella per unit length the second term is the contribution of bubble shape deformation where r c is the radius of curvature at the interface between gas and liquid the last term is the viscosity contributed by the surface tension gradient where n s and n l are dimensionless numbers that are functions of radius of curvature bubble length and capillary number subsequently the viscosity of flowing foam is defined as 8 μ f μ g α n f v f 1 3 where μ g and v f is the gas viscosity and velocity respectively and α is a function of gas liquid interfacial curvature and surfactant formulation hirasaki and lawson 1985 the magnitude of alpha is obtained by comparing eqs 7 and 8 as follows 9 α μ 2 3 r 3 σ 3 1 3 0 85 1 r c r r c r 2 1 n s 1 e n l 1 e n l according to eq 9 α is tightly connected to the radius of curvature r c and hence depends on bubble size distribution and foam quality while r c is smaller than capillary radius r c r the gas bubbles are touching in this condition r c is defined as 10 r c r 1 3 1 π 4 1 γ γ 1 2 r b r 3 2 where γ is the foam quality r b is the equivalent bubble radius and r is the capillary radius a study by pancharoen et al 2012 presents the relationship between α and γ in fractures according to this study increasing gas fraction corresponds to increasing the foam texture this changes the value of r c and as a result the magnitude of α increases until it reaches a constant at very high gas fractions this phenomenon happens as a result of the limiting capillary pressure it is reported that the foam quality in fractures can be as high as 99 95 pancharoen et al 2012 fig 5 schematically displays the relationship between flow resistance and gas fractional flow in a fracture considering the study by pancharoen et al 2012 we define this relationship to be 11 α a α m i n α m a x γ 25 where a is the proportionality constant and α m i n and α m a x are minimum and maximum values of α obtained experimentally by pancharoen et al 2012 the α m i n is the value of α for the wet foam low gas fractional flow where the radius of the curvature is equal to fracture aperture consequently the α m a x is obtained at very high fractional flow that is sometimes as large as f g 0 9999 pancharoen et al 2012 the gas bubbles can move freely or get trapped depending on their sizes the amount of trapped gas in the matrix can be as high as 80 100 of the injected gas tang and kovscek 2006 kharabaf and yortsos 1998 radke and gillis 1990 cohen et al 1997 almajid and kovscek 2020 for fractures however gas trapping is not as great as the matrix and 20 is acceptable the trapped gas fraction depends on pressure gradient foam texture and the permeability as tang and kovscek 2006 12 x f ψ p g n f k f 1 2 g where ψ is a constant of proportionality and g is the percolation exponent equal to 0 4 the relative permeability of flowing gas is described as a corey type function almajid et al 2021 the relative permeability of the aqueous phase is unaffected by the presence of foam 5 implementation within ad gprs we used the automatic differentiation general purpose research simulator framework zhou et al 2011 zhou 2012 voskov and tchelepi 2012 to implement our foam model the capability of ad gprs in solving multiphysics problems provided us a platform to solve a foam subproblem this subproblem was initiated by almajid et al 2021 to solve for foam flow in matrix for this work the foam submodule almajid et al 2021 was revised significantly and the required equations from hirasaki and lawson 1985 pancharoen et al 2012 and fernø et al 2015 added to solve for foam flow in fractures similar to almajid et al 2021 we use a fully implicit method fim for time approximation in the work by almajid et al 2021 they first solve the flow problem alone while holding the bubble density constant and then they used the solution from the flow problem as a constant and solved for bubble density alone and finally they combined the two problems to find the solution we do not use the sequential approach but rather solve for flow and foam problems simultaneously as a fully coupled problem 5 1 gas apparent viscosity computation the primary variables for the foam problem are pressure water saturation and bubble density we use the bisection method to compute foam apparent viscosity as a function of our primary variables as 13 f p s w n f μ f μ g α n f μ g 1 3 v g 1 3 μ g 1 3 μ f 0 therefore the effective viscosity of gas phase is computed by 14 μ f v a l u e p s w n f b i s e c t i o n f p s w n f μ f after computing the viscosity the derivatives are computed using the inverse function theorem as 15 d y d x d y d x 1 d f d x where f x y 0 in order to calculate the effective viscosity of gas we need to apply this theorem for y μ f x p s w n f and 16 f x y f p s w n f m p s w n f μ f 0 after computing the effective viscosity of gas and obtaining the derivatives we evaluate all of our properties 6 results and discussion 6 1 experiments and model microscale experiments of foam behavior in ideal fractures provide data for model verification and subsequent use of the model at larger scale injecting foam into the fractures requires applying back pressure in order to compress the gas and reduce the velocities to be more comparable to field conditions for this study we applied 0 1034 mpa back pressure on our system the velocities of the injected gas and water are 19 386 m day and 2 154 m day for the 25 μ m deep fracture and 5 507 m day and 0 612 m day for the 88 μ m deep fracture respectively the resultant foam quality was 90 in two linear fractures with variable aperture sizes that are initially saturated with water the capillary numbers for these conditions are about 1 10 5 for the 25 μ m aperture and 2 5 10 6 for the 88 μ m aperture shojaei et al 2019 argued that in the horizontal orientation lamella generation and mobilization was not large at a capillary number below 10 6 and strong foam was not generated the capillary numbers here are greater than this threshold and we were able to generate foam in our planar fracture micromodel thereafter we investigated pressure gradient water saturation and bubble textures along the length of the fracture tables 1 and 2 list the parameters that we used in our model for 25 μ m and 88 μ m deep fractures respectively fig 6 shows examples of bubble texture along the fracture length for the 88 μ m deep fracture after our primary analysis the direction of injection is from the left to the right of the model the gas bubbles are separated by lamellae in bold black lines this figure shows the gradual changes of the bubble size distribution along the fracture we do not see independent regions filled only with liquid phase flowing at these injection conditions we divided the fracture area into 5 areas and found an equivalent bubble texture for each area and used them for history matching our model figs 7 to 9 show pressure gradient water saturation and bubble texture across the length of the fracture respectively we monitor the pressure before and after the micromodel using two pressure gauges over the duration of the experiments increasing the fracture aperture from 25 to 88 μ m resulted in a decreased pressure drop from 38 to 12 kpa refer to fig 7 this is due to the finer foam texture in fractures with smaller aperture refer to fig 9 the foam strength is not only gauged by the resultant aqueous phase saturation but also by the resultant pressure gradient it builds the model predicts early times the times in between and steady state very well for variables p s w and n f 6 2 flow resistance factor liquid slugs separate the foam bubbles flowing in capillaries at small gas fractions this is due to the fact that the radius of curvature is constant and it is smaller than or equal to the fracture aperture hirasaki and lawson 1985 according to eq 16 because the ratio of r c r is constant the flow resistance does not change pancharoen et al 2012 by increasing gas fractional flow gas bubbles are pushed closer and hence this results in decreasing the radius of curvature decreasing the radius of curvature results in increasing the value of α and therefore increasing the flow resistance of the system flow through fractures is very sensitive to saturation changes small changes in water saturation influence the flow significantly however such changes may not affect the flow in porous media capillary states within the fracture control the fluid saturation and foam texture and capillary pressure changes are more important through fractures eq 9 was used to estimate the value of α as a function of gas fractional flow pancharoen et al 2012 similar to pancharoen et al 2012 we used the exponent of 25 to fit our model to the experimental data additionally we capped the values of α for gas fractional flow values of greater than 95 fig 10 shows the values of α for the fracture apertures of 25 and 88 μ m the differences between the experimental data and the model are relatively small the model expression for α is a strong function of the gas saturation and the foam quality eq 11 this expression represents α over a broad range of conditions and is not adjusted case by case hence slight differences occur between model prediction and experimental results as the fracture aperture varies by a factor greater than 3 the results in fig 10 show larger values of α for the fracture with greater aperture this is in agreement with the results from casteel and djabbarah 1988 and kovscek and bertin 2002 stating that increasing permeability wider aperture corresponds to increasing the flow resistance due to this phenomenon and because of the effect of resistance in high permeability zones foam diverts injected fluid to lower permeability porous media and enhances the efficiency of recovery processes we validated our α values by combining eq 15 and the poiseuille equation to enable us to use the total apparent viscosity from the measured pressure difference across the model and evaluate α as 17 μ a p p b 2 p 12 u comparing the two plots in fig 10 shows that the values of α increases as the fracture aperture increases according to fig 10 as bubbles are pushed closer and the radius of curvature decreases a larger resistance to flow results and foam diverts to lower permeability zones apaydin et al 1998 7 conclusion this paper develops and implements a mechanistic model in a research simulator ad gprs to study foam flow behavior in fractures ad gprs provides a framework to represent all relevant physics of foam flow within fractures of μ m sized apertures the existing population balance approach was modified and extended substantially to represent foam flow in fractures the model was validated using extensive experimental data and good agreement was found between model and measurement the model developed covers a wide range of fracture apertures and areas as well as matrix fracture combinations the underlying physics of foam generation and coalescence exhibit similar aspects in both fractured and unfractured media foam coalescence is induced at the limiting capillary pressure that varies with surfactant type and concentration because the capillary pressure is generally much smaller in fractures compared to the matrix reaching the limiting capillary pressure within a fracture s is not always possible and foam flow resistance must be adjusted accordingly pancharoen et al 2012 hence we modified an existing model for bubble flow in fractures to include local calculation of the flow resistance factor we were able to validate the values of the flow resistance factor obtained from the numerical model with the experimental observations this parameter incorporates valuable insights about the relationship of gas liquid curvature with foam apparent viscosity as gas flow rate and foam quality change the model developed along with the microscale experiments of foam behavior in ideal fractures provide inputs for simulation studies and can be used for predictions at larger scale extension of foam modeling capabilities to fractures incorporates one of the most extreme forms of heterogeneity and shows utility for predictions in complex heterogeneous media credit authorship contribution statement negar nazari conceptualization methodology software writing original draft editing muhammad m almajid conceptualization methodology review anthony r kovscek conceptualization supervision funding acquisition writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments we thank chevron for financial support through core as well as the supri a industrial affiliates work was performed in part in the nano stanford labs which are supported by the national science foundation usa as part of the national nanotechnology coordinated infrastructure under award eccs 1542152 
179,geologic heterogeneity is one of the important factors controlling migration and distribution of nonaqueous phase liquids in the subsurface heterogeneity such as fractures complicates the effectiveness of environmental remediation and uncharacterized aquifer heterogeneity causes significant uncertainties in the removal of nonaqueous phase liquids foaming an injection gas is an effective method to alleviate the challenges in accessing heterogeneous media during remediation processes because foam is nonnewtonian and redirects gas and liquid flow foamed gas may also assist in increasing the storage of carbon dioxide in saline formations this paper investigates foam flow behavior in microscale fractures and develops a mechanistic transient foam flow model using the population balance method microscale experiments in fractures with apertures of 25 and 88 μ m are used to validate the model for pressure drop gas saturation and bubble texture key differences related to modeling foam in fractures are the potential for continuously varying gas liquid curvature in fractures and the relationship of this curvature to apparent foam viscosity incorporation of a local foam flow resistance factor is important to representing flow physics accurately hence the results of this study provide foundational understanding for upscaling foam rheology in different sized fractures to ensure successful operations in soil aquifer remediation and co2 storage in saline formations keywords foam fractures microscale population balance flow resistance nomenclature α effective viscosity constant pa s 2 3 m 10 3 α m a x maximum effective viscosity constant pa s 2 3 m 10 3 α m i n minimum effective viscosity constant pa s 2 3 m 10 3 γ foam quality fraction μ f foam apparent viscosity pa s μ g gas viscosity pa s μ p phase viscosity pa s μ w water viscosity pa s ω exponent in foam generation coefficient ϕ porosity ψ proportionality constant for flowing foam fraction calculation ρ p phase density kg m 3 σ interfacial tension n m a proportionality constant a proportionality constant that varies between 0 and 1 b aperture size m c s surfactant concentration wt c s reference surfactant concentration wt g percolation exponent g c gravitational constant k permeability d k 1 0 foam coalescence rate constant m 1 k 1 0 foam generation rate constant s 1 3 m 13 3 k r g gas relative permeability k r g 0 end point of gas relative permeability k r p phase relative permeability k r w water relative permeability k r w 0 end point of water relative permeability l s slug length m n f flowing foam texture m 3 n f limiting foam texture m 3 n l dimensionless length of the thin film portion of bubble n l number of lamellae per unit length m 1 n s dimensionless number for surface tension gradient effect n t trapped foam texture m 3 p pressure pa p 0 proportionality constant for capillary pressure calculation p c m a x maximum value for p c pa p c capillary pressure pa p c limiting capillary pressure pa q b sink source term for bubbles r capillary radius m r b foam bubbles radius m r c radius of curvature m s f foam saturation s g f flowing gas saturation s g t trapped gas saturation s g gas saturation s w c connate water saturation s w water saturation t time u g gas darcy velocity v f foam interstitial velocity m s v g gas interstitial velocity m s v w water interstitial velocity m s x f flowing foam fraction z depth 1 introduction subsurface contaminant migration is a complex problem caused by fluid fluid and rock fluid interactions and by rock heterogeneities the contaminants may remain in porous media as a free phase or may bind to the soil rock interface wang and mulligan 2004 some nonaqueous phase liquids napls have densities greater than the resident water referred to as dnapls and therefore they migrate below the water table and may be immobilized at the bottom of the aquifer hirasaki et al 1997a as a result dnapls may serve as long term sources of contamination impacting both groundwater and surface water large interfacial tension between napls and water and insolubility and immiscibility of the napls in water makes traditional remediation efforts difficult wang and mulligan 2004 hirasaki et al 1997a oolman et al 1995 pope and wade 1995 estimating napl mass and removal from source zones is difficult due to lack of information on the extent or timing of spills complex napl entrapment configurations created by fingering geologic heterogeneity and lack of characterization techniques for recognizing heterogeneity as well as uncertainty in locating source zones saenton and illangasekare 2013 geologic heterogeneity is an important factor affecting and controlling migration and distribution of napl in the subsurface kueper et al 1989 kueper and frind 1991 kueper and gerhard 1995 illangasekare et al 1995 dekker and abriola 2000 bradford et al 2000 heterogeneity makes source zone characterization nelson et al 1999 and the effectiveness of napl remediation meinardus et al 2002 saenton et al 2002 significantly complicated uncharacterized aquifer heterogeneity causes significant uncertainties in the removal of napl from source zones saenton et al 2002 saenton et al 2002 studied the effectiveness of surfactant enhanced aquifer remediation sear for soil decontamination in heterogeneous formations and observed that surfactant as a treatment agent completely bypassed low permeability zones and hence the ability to deliver fully these agents is hindered by this bypassing effect therefore remediation processes are now focused on using high viscosity agents e g foams enhanced bioremediation in situ chemical oxidation co solvent flushing and sear saenton and illangasekare 2013 foam is a special colloidal dispersion consisting of a gas dispersed in a liquid and stabilized by a foaming agent lord 1981 smith 1996 foaming an injection gas is an effective method to alleviate the challenges of bypassing faced during remediation processes and to assist in the storage of carbon dioxide in saline formations eide et al 2020 the reduced mobility of foamed gas as compared to continuous gas makes storage more effective by immobilizing the gas and trapping it in the high permeability layers and thereby diverting the gas to the lower permeability zones tang and kovscek 2006 almajid et al 2021 the flow of thin liquid films separating gas bubbles across pore walls results in a much larger apparent viscosity for foams hirasaki and lawson 1985 foam also diverts aqueous injectants to low permeability zones during aquifer soil remediation jobs improving the drainage of contaminants out of the affected areas hirasaki et al 1997b 1 1 remediation with foam in a case study by hirasaki et al 1997b the effectiveness of foam for aquifer remediation processes was field tested in a heterogeneous dual permeability 40 and 100 darcy aquifer contaminated with dnapl they tested foamed surfactant solution to clean the dnapl from the aquifer the napl was trapped in the tighter zones toward the bottom of the aquifer introducing an additional challenge for the remediation process hirasaki et al 1997b their results showed that the injected foam removed almost 97 of the napl from the swept pore volume szafranski et al 1998 the air injection rate for foam generation was low and the required pressure gradient for foam propagation was kept small hirasaki et al 1997b szafranski et al 1998 additionally foam diverted the injected surfactant solution from high permeability zones to low permeability zones and hence improved the sweep efficiency mamun et al 2002 confirmed that the high quality and low quality regimes observed in petroleum applications also apply during the small pressure gradient that is applied in environmental remediation furthermore multiple studies tang and kovscek 2006 kharabaf and yortsos 1998 showed that several factors including pressure gradient permeability and bubble density influence the trapped foam fraction in porous media 1 2 remediation in fractured rocks several factors including geometry of the fracture network such as fracture orientations apertures interconnectivity densities and wall roughness capillary pressure and the properties of the napl including viscosity density and interfacial tension govern the movement of napls in fractured aquifers mackay and cherry 1989 mercer and cohen 1990 hardisty et al 1998 wealthall et al 2001 fractures assist in migration of dnapls to significant depths if large volumes of spilled dnapl pass through fractures with interconnectivity dnapls invade progressively smaller aperture fractures with depth kueper and mcwhorter 1991 and the fluid pressure increases as a result lower permeability matrix may be invaded hardisty and ozdemiroglu 2006 the vertical migration of lnapls light non aqueous phase liquid in fractured aquifers is blocked by the water table however lateral invasion can occur in any direction independent of the hydraulic gradient hardisty et al 1998 characterization and remediation of napls in fractured systems is difficult and expensive due to the heterogeneous nature of fractured systems and inherent complexity of multiphase flow in them hardisty and ozdemiroglu 2006 traditional napl removal methods including focused pumping and high vacuum extraction perform acceptably in unconsolidated aquifers however they generally perform poorly in heterogeneous media and fractured systems hardisty and ozdemiroglu 2006 therefore more promising techniques such as steam assisted recovery and sear are applied rigorously for removal of napls in fractured systems and heterogeneous media 1 3 foam in heterogeneous media fractured porous media have complicated single and multiphase flows due to their complex structures a contributing factor is the difference in permeability of the fractures and unfractured matrix in order to improve the efficiency and increase the fraction of napl recovered the gas mobility may be controlled by foam injection pancharoen et al 2012 nazari et al 2017a 2018 kovscek et al 1995a studied foam flow behavior through a transparent replica of a natural rough walled fracture with a 30 μ m wide aperture they showed that foam exhibits effective control of gas mobility kovscek et al 1995a because foam flow resistances were approximately 100 540 times greater than those of single phase nitrogen for a wide range of foam qualities spanning from 0 60 to 0 99 kovscek et al 1995a additionally they showed that foam rheology in fractured media was a function of bubble shape and size changes in flow behavior depend on transitions in bubble morphology kovscek et al 1995a shojaei et al 2019 the effect of foam on controlling the gas mobility in heterogeneous porous media was investigated by different groups alquaimi and rossen 2019 nazari et al 2017b 2020 multiple studies llave et al 1990 casteel and djabbarah 1988 alquaimi and rossen 2019 reported that injecting foam improved sweep efficiency in the field by diverting foam flow to the lower permeability zones elsewhere the importance of capillary communication among different permeability media was highlighted bertin et al 1999 in thin heterogeneous layers where cross flow occurs due to capillarity foam fronts move at nearly identical rates in each layer limiting or eliminating cross flow leads to high permeability zones filling with foam and diversion of flow into low permeability media it was found that foam moves through low permeability media more rapidly in comparison to the high permeability region a later study showed that increasing liquid velocity results in decreasing foam mobility significantly as a result there was a possibility of complete gas blockage especially in the high permeability zones kovscek and bertin 2003 due to complexity of foam properties and fractures several studies were conducted to study foam mechanisms in fractures yan et al 2006 studied the effect of foam to improve the efficiency of a surfactant flooding process they proved that improving foam texture corresponds to increasing the apparent viscosity of the foam buchgraber et al 2012a conducted experiments in silicon micromodels with different fractures and showed that foam even at low qualities of 20 30 significantly reduces the mobility of gas the mobility reduction factor reported was as great as 400 500 in rough fracture models and it increased linearly with foam quality furthermore they reported that foam coalescence occurs in the fractures at high foam qualities of 90 95 pancharoen et al 2012 investigated foam flow in a linear fracture with variable aperture along the fracture length the characteristics of foam flow through heterogeneous fractures was investigated numerically to include the effect of gas trapping and gravity they concluded that the underlying physics of foam flow resistance generation and coalescence are similar among fractured and unfractured media in fractured media however capillary pressure is smaller in comparison to matrix and it is more difficult to reach the limiting capillary pressure regime accordingly foam coalescence occurs slowly in fractures they showed that the fracture aperture plays an important role in foam flow characterization in fractures with rough walls propagating foam through the most permeable paths results in great flow resistance furthermore modeling confirmed that the role of curvature on foam effective viscosity is necessary for mechanistic prediction of foam characteristics in fractures the novelty of this work is to advance experimental and numerical understanding of foam propagation in fractured systems we report the design and fabrication of a new micromodel with a representative planar fracture that permits direct observation of bubbles and withstands pressures up to 100 psi 690 kpa we conducted our structural design optimization analysis in solidworks to maximize the internal pressure that the micromodel can withstand significant new foam flow resistance data was collected in fractures of different aperture then we developed and implemented a population balance model for foam in fractures the model was implemented in the modular multiphysics framework of the automatic differentiation general purpose research simulator ad gprs with a new foam simulation option for foam flow behavior through fractures this population balance model was validated using pressure drop and foam texture data in fractures with apertures of 25 and 88 μ m 2 methodology 2 1 design optimization the microscopic flow of foam is visualized using a micromodel instrumented to allow pressure drop measurements here we fabricated a new micromodel with an optimized design that withstands relatively high pressure conditions for microfluidic studies a stress analysis conducted using finite element methods solidworks evaluated the amount of stress applied on the fracture over a wide range of pressure differences between the inside and outside of the micromodel we created two different fracture designs shown in fig 1 by changing the geometry of the boundaries of the micromodel and adding more round grains that simulate asperities in the fracture plane to support the bonding of a coverplate to the micromodel porosity is calculated to be 98 22 and 86 93 for the initial and final designs respectively the finite element analysis resulted in simulated stress distributions for the two designs fig 2 increasing the number of islands and eliminating the sharp edges decreases the maximum stress from 798 psi to 150 psi our optimized design is a 2 cm wide by 7 75 cm long fracture that includes 25 posts to anchor the glass cover plate and provide more structural support during bonding the depth of the fractures are 25 1 μ m and 88 2 μ m for the two sets of experiments and the porosity of the channel is 87 a sandstone pattern buchgraber 2013 with porosity of 46 is printed and etched on the base of the fracture to generate the desired rough surface the printed matrix has 12 2 μ m depth and covers the entire length of the fracture fig 3 shows the sandstone pattern the topography of the etching and the cross section of the etched fracture 2 2 micromodel fabrication we fabricated our etched silicon micromodels at the stanford nanofabrication facility snf silicon wafers are k prime type wrs materials their diameter and thickness are 100 0 5 mm and 500 550 μ m respectively to start the process wafers are dehydrated in a prime oven at 150 c for 30 min the oven primed the wafers using hexamethyldisilazane hmds to establish better coverage and adhesion between oxides and resists then we coated the primed wafers with photoresist using the svg silicon valley group coater and an automated track system for dispensing photoresist on 4 silicon wafers buchgraber et al 2012b yun and kovscek 2015 next we employed a heidelberg mla 150 maskless system to print designs on the wafers designs were made using autocad a blank silicon wafer underwent direct write lithography in the heidelberg machine thereafter the wafers were processed through the svg developer and post baked to expose photoresist to create the topography on the developed wafers a two step etching process was conducted first they were etched either 25 1 or 88 2 μ m using an inductive charged plasma deep reactive ion etcher then the remaining photoresist on the wafers was removed by soaking the wafers in a chemical bath of piranha 90 sulfuric acid hydrogen peroxide for 20 min after drying the wafers in a spin dryer machine we baked and coated the wafers using hmds vapor prime oven and svg coater respectively in this stage we used the karl suss ma 6 contact aligner system to perform precision mask to wafer back side alignment and near uv photoresist exposure on the prepared wafer using soft contact configuration then we etched them for 12 2 μ m to create the roughness thereafter we used a diamond coated drill bit to perforate the two ports fig 1 shows the initial and final micromodel designs and location of the ports after drilling the ports the remaining photoresist on the wafers was then removed by soaking the wafers in a chemical bath of piranha for 20 min finally we bonded an optically flat borofloat glass wafer s i howard to the top of a clean wafer using anodic bonding at 1045 v and 300 c for 1 h buchgraber et al 2012b yun and kovscek 2015 subsequently we placed the micromodel inside a micromodel holder and conducted our experiments 3 experimental fig 4 is a schematic of the experimental system the microscale setup allows the simultaneous injection of nitrogen gas and foamer solution as well as the measurement of flow parameters specifically pressure drop along the model bubble texture and the in situ fluid saturations the foamer solution was prepared by mixing stepan bioterg alpha olefin sulfonate as 40 surfactant in nacl brine solution the final concentration of the active surfactant was 0 5 wt in a 0 5 wt brine the nacl was purchased from thermo fisher chemicals inc the brine was prepared by dissolving nacl in house deionized water followed by addition of surfactant we controlled the nitrogen injection using a mass flow controller bronkhorst el flow select while the liquid injection was controlled by a syringe pump harvard foam quality was obtained by measuring the injected gas and liquid volumes to start the experiments 90 foam quality was generated by coinjecting the foamer solution and nitrogen through the micromodels the rate of injecting gaseous and aqueous phases were chosen to be 6 73 and 0 75 μ l min respectively these rates are computed at our desired back pressure a 15 psi backpressure was applied during all experiments using a backpressure regulator after generating foam through the micromodel we allowed it to come to steady state a z16ap model leica microscope with a photo tube that connects to a video camera was employed to visualize the flow pattern at the pore level in the micromodel the silicon wafer micromodels are opaque and their inside flow was monitored using reflected light from the internal microscope light source simultaneously we measured the pressure drop across the micromodel during the entire experiment to measure the pressure changes we used a quickstart m6 pressure sensor evaluation kit i2c ps200m6 eval idex health science llc the sensitivity of the pressure sensors is 0 21 mbar 0 003 psi finally macroscopic images and videos showing foam quality and texture were captured and analyzed to calculate the bubble texture and the aqueous phase saturation along the micromodel 4 mechanistic model the underpinnings of this model are the mass conservation equations of the gaseous and aqueous phases as described by aziz 1979 due to the absence of foamer solution in porous media we add an additional mass conservation equation for the surfactant almajid et al 2021 the mass balance equations were adopted from almajid et al 2021 in addition to the mass balance equations many foam models emphasize the importance of tracking foam texture for the accurate prediction of foam flow through the porous medium hirasaki and lawson 1985 patzek 1988 friedmann and jensen 1986 falls et al 1988 1989 ettinger and radke 1992 kovscek et al 1995b chen et al 2010 the population balance model for foam was introduced by patzek 1988 the capability of a population balance model to address the evolution of foam texture and as a result reducing the gas mobility makes it a good candidate to study foam behavior in porous media kovscek et al 1997 this method provides a comprehensive framework to cover all relevant physics of foam generation and transport furthermore in this method the pore level events in foam generation coalescence and constitutive relations are well depicted kovscek et al 1997 additionally this method generally represents the mass and energy balance equations similar to reservoir simulation approaches kovscek et al 1995b this model covers the foam texture changes created by capillary snap off bubble division coalescence diffusion evaporation or condensation patzek 1988 in addition this model accounts for bubble trapping and mobilization patzek 1988 eq 1 shows the transient balance of foam texture kovscek et al 1997 1 t ϕ s g f n f s g t n t u g n f ϕ s g r g r c q b where subscripts f and t denote the flowing and trapped gas respectively the first term on the left accounts for bubble accumulation and the second shows that foam bubbles convect with the gas phase the first and second terms on the right hand represent the net generation and coalescence respectively the last term on the right is the bubble source term foam texture n f is the number density of foam bubbles per unit volume of flowing gas n t is the trapped bubble density per unit volume of the trapped gas and s f is the saturation of flowing gas the total gas saturation s g is obtained by adding the flowing gas saturation s g f and the trapped gas saturation s g t various expressions were used by other researchers falls et al 1988 kovscek et al 1995b kam and rossen 2013 to express the foam generation and coalescence mechanisms represented by this method including snap off lamella division and leave behind ransohoff and radke 1988 we adopted the rate of generation r g used by chen et al 2010 and almajid et al 2019 in our problem formulation 2 r g k 1 0 1 n f n ω v w v f 1 3 where k 1 0 is the generation rate constant n is an upper limit for foam texture set by the porous medium ω is a constant representing the shape of inverse proportionality of foam generation sites to preexisting gas bubbles and is set to 3 based on the results from chen et al 2010 v w and v f are interstitial velocities of aqueous phase and flowing foam that are local vector quantities and depend on local saturation and total potential gradient including gravity and capillary pressure note that subscript 1 stands for the generation rate of the foam in the medium different mechanisms lead to foam coalescence among them gas diffusion and capillary suction lead to foam breakdown capillary suction is considered here to be the main mechanisms for the coalescence of foam kovscek and radke lamella stability is a function of surfactant properties surfactant concentration rock type liquid saturation and how fast the bubbles move through the pore space khatib et al 1988 aronson et al 1994 jiménez and radke kahrobaei and farajzadeh 2019 therefore the rate of coalescence is defined by 3 r c k 1 0 p c p c c s p c 2 v g n f where k 1 0 is the coalescence rate constant and p c is the limiting capillary pressure for foam suction coalescence the coalescence rate constant reflects the number of active termination sites and depends on surfactant concentration the wetting liquid content and the limiting capillary pressure p c the local capillary pressure p c is computed from the leverett j function kovscek et al 1995b and defined as 4 p c p 0 σ a s w s w c b where p 0 ϕ k ϕ is the porosity of the rock k is the absolute permeability of the rock σ is the surface tension and a is taken as a constant that varies between 0 and 1 for this study we choose a and b to be 0 022 and 0 2 respectively the limiting capillary pressure p c in porous media varies with surfactant formulation and concentration a large concentration of surfactant leads to large values of p c a study by aronson et al 1994 suggests the following functional form for p c 5 p c c s p c m a x t a n h c c c s where p c m a x is a maximum value for p c and c s is a reference surfactant concentration for strong net foam generation throughout this study u w and u f are darcy velocities for the aqueous phase and foam respectively they are local vector quantities and depend on local saturation and total potential gradient including gravity and capillary pressure kovscek et al 1997 and defined by 6 u p k k r p μ p p p ρ p g c z where subscripts p is interchangeable between aqueous w and foam phases f respectively also k r is relative permeability μ is viscosity ρ is density p is pressure g is gravitational constant and z is depth the details of relative permeability of surfactant solution and foam are described in kovscek and radke the foam effective viscosity is greatly determined by foam texture gas liquid bubble curvature gas fractional flow and capillary pressure as foam with high quality travels in capillaries the liquid phase flows as a thin film within foam lamella khatib et al 1988 as well as along the walls of the capillary lamella stability depends on local capillary pressure de vries and wit 1990 the surfactant type and concentration a study by de vries and wit 1990 showed that foam can only exist below a certain quality that exists at limiting capillary pressure p c to picture foam flow in fractures we need to consider a chain of gas bubbles separated by thin liquid films to classify foam flow in capillaries we need to consider the ratio between the radius of the bubbles and the radius of the capillary based on this ratio foam can be considered as bulk foam or individual lamella if the radius of the bubbles r b is smaller than the radius of the capillary r then foam is characterized as bulk foam on the other hand if the bubble radius is greater than the capillary radius then foam is characterized as individual lamella according to hirasaki and lawson 1985 the individual lamella exists if r 2 r b by touching the bubbles in the plateau border the meniscus radius of curvature decreases a smaller radius of curvature results in increasing the drag force acting on the bubbles according to hirasaki and lawson 1985 total apparent viscosity of foam in capillaries is obtained by 7 μ f μ l s n l 0 85 n l r r c r 3 μ v w σ 1 3 r c r 2 1 n l r 3 μ v w σ 1 3 n s 1 e n l 1 e n l the first term is the liquid slug contribution to viscosity calculation l s is the liquid slug s length and n l is the number of lamella per unit length the second term is the contribution of bubble shape deformation where r c is the radius of curvature at the interface between gas and liquid the last term is the viscosity contributed by the surface tension gradient where n s and n l are dimensionless numbers that are functions of radius of curvature bubble length and capillary number subsequently the viscosity of flowing foam is defined as 8 μ f μ g α n f v f 1 3 where μ g and v f is the gas viscosity and velocity respectively and α is a function of gas liquid interfacial curvature and surfactant formulation hirasaki and lawson 1985 the magnitude of alpha is obtained by comparing eqs 7 and 8 as follows 9 α μ 2 3 r 3 σ 3 1 3 0 85 1 r c r r c r 2 1 n s 1 e n l 1 e n l according to eq 9 α is tightly connected to the radius of curvature r c and hence depends on bubble size distribution and foam quality while r c is smaller than capillary radius r c r the gas bubbles are touching in this condition r c is defined as 10 r c r 1 3 1 π 4 1 γ γ 1 2 r b r 3 2 where γ is the foam quality r b is the equivalent bubble radius and r is the capillary radius a study by pancharoen et al 2012 presents the relationship between α and γ in fractures according to this study increasing gas fraction corresponds to increasing the foam texture this changes the value of r c and as a result the magnitude of α increases until it reaches a constant at very high gas fractions this phenomenon happens as a result of the limiting capillary pressure it is reported that the foam quality in fractures can be as high as 99 95 pancharoen et al 2012 fig 5 schematically displays the relationship between flow resistance and gas fractional flow in a fracture considering the study by pancharoen et al 2012 we define this relationship to be 11 α a α m i n α m a x γ 25 where a is the proportionality constant and α m i n and α m a x are minimum and maximum values of α obtained experimentally by pancharoen et al 2012 the α m i n is the value of α for the wet foam low gas fractional flow where the radius of the curvature is equal to fracture aperture consequently the α m a x is obtained at very high fractional flow that is sometimes as large as f g 0 9999 pancharoen et al 2012 the gas bubbles can move freely or get trapped depending on their sizes the amount of trapped gas in the matrix can be as high as 80 100 of the injected gas tang and kovscek 2006 kharabaf and yortsos 1998 radke and gillis 1990 cohen et al 1997 almajid and kovscek 2020 for fractures however gas trapping is not as great as the matrix and 20 is acceptable the trapped gas fraction depends on pressure gradient foam texture and the permeability as tang and kovscek 2006 12 x f ψ p g n f k f 1 2 g where ψ is a constant of proportionality and g is the percolation exponent equal to 0 4 the relative permeability of flowing gas is described as a corey type function almajid et al 2021 the relative permeability of the aqueous phase is unaffected by the presence of foam 5 implementation within ad gprs we used the automatic differentiation general purpose research simulator framework zhou et al 2011 zhou 2012 voskov and tchelepi 2012 to implement our foam model the capability of ad gprs in solving multiphysics problems provided us a platform to solve a foam subproblem this subproblem was initiated by almajid et al 2021 to solve for foam flow in matrix for this work the foam submodule almajid et al 2021 was revised significantly and the required equations from hirasaki and lawson 1985 pancharoen et al 2012 and fernø et al 2015 added to solve for foam flow in fractures similar to almajid et al 2021 we use a fully implicit method fim for time approximation in the work by almajid et al 2021 they first solve the flow problem alone while holding the bubble density constant and then they used the solution from the flow problem as a constant and solved for bubble density alone and finally they combined the two problems to find the solution we do not use the sequential approach but rather solve for flow and foam problems simultaneously as a fully coupled problem 5 1 gas apparent viscosity computation the primary variables for the foam problem are pressure water saturation and bubble density we use the bisection method to compute foam apparent viscosity as a function of our primary variables as 13 f p s w n f μ f μ g α n f μ g 1 3 v g 1 3 μ g 1 3 μ f 0 therefore the effective viscosity of gas phase is computed by 14 μ f v a l u e p s w n f b i s e c t i o n f p s w n f μ f after computing the viscosity the derivatives are computed using the inverse function theorem as 15 d y d x d y d x 1 d f d x where f x y 0 in order to calculate the effective viscosity of gas we need to apply this theorem for y μ f x p s w n f and 16 f x y f p s w n f m p s w n f μ f 0 after computing the effective viscosity of gas and obtaining the derivatives we evaluate all of our properties 6 results and discussion 6 1 experiments and model microscale experiments of foam behavior in ideal fractures provide data for model verification and subsequent use of the model at larger scale injecting foam into the fractures requires applying back pressure in order to compress the gas and reduce the velocities to be more comparable to field conditions for this study we applied 0 1034 mpa back pressure on our system the velocities of the injected gas and water are 19 386 m day and 2 154 m day for the 25 μ m deep fracture and 5 507 m day and 0 612 m day for the 88 μ m deep fracture respectively the resultant foam quality was 90 in two linear fractures with variable aperture sizes that are initially saturated with water the capillary numbers for these conditions are about 1 10 5 for the 25 μ m aperture and 2 5 10 6 for the 88 μ m aperture shojaei et al 2019 argued that in the horizontal orientation lamella generation and mobilization was not large at a capillary number below 10 6 and strong foam was not generated the capillary numbers here are greater than this threshold and we were able to generate foam in our planar fracture micromodel thereafter we investigated pressure gradient water saturation and bubble textures along the length of the fracture tables 1 and 2 list the parameters that we used in our model for 25 μ m and 88 μ m deep fractures respectively fig 6 shows examples of bubble texture along the fracture length for the 88 μ m deep fracture after our primary analysis the direction of injection is from the left to the right of the model the gas bubbles are separated by lamellae in bold black lines this figure shows the gradual changes of the bubble size distribution along the fracture we do not see independent regions filled only with liquid phase flowing at these injection conditions we divided the fracture area into 5 areas and found an equivalent bubble texture for each area and used them for history matching our model figs 7 to 9 show pressure gradient water saturation and bubble texture across the length of the fracture respectively we monitor the pressure before and after the micromodel using two pressure gauges over the duration of the experiments increasing the fracture aperture from 25 to 88 μ m resulted in a decreased pressure drop from 38 to 12 kpa refer to fig 7 this is due to the finer foam texture in fractures with smaller aperture refer to fig 9 the foam strength is not only gauged by the resultant aqueous phase saturation but also by the resultant pressure gradient it builds the model predicts early times the times in between and steady state very well for variables p s w and n f 6 2 flow resistance factor liquid slugs separate the foam bubbles flowing in capillaries at small gas fractions this is due to the fact that the radius of curvature is constant and it is smaller than or equal to the fracture aperture hirasaki and lawson 1985 according to eq 16 because the ratio of r c r is constant the flow resistance does not change pancharoen et al 2012 by increasing gas fractional flow gas bubbles are pushed closer and hence this results in decreasing the radius of curvature decreasing the radius of curvature results in increasing the value of α and therefore increasing the flow resistance of the system flow through fractures is very sensitive to saturation changes small changes in water saturation influence the flow significantly however such changes may not affect the flow in porous media capillary states within the fracture control the fluid saturation and foam texture and capillary pressure changes are more important through fractures eq 9 was used to estimate the value of α as a function of gas fractional flow pancharoen et al 2012 similar to pancharoen et al 2012 we used the exponent of 25 to fit our model to the experimental data additionally we capped the values of α for gas fractional flow values of greater than 95 fig 10 shows the values of α for the fracture apertures of 25 and 88 μ m the differences between the experimental data and the model are relatively small the model expression for α is a strong function of the gas saturation and the foam quality eq 11 this expression represents α over a broad range of conditions and is not adjusted case by case hence slight differences occur between model prediction and experimental results as the fracture aperture varies by a factor greater than 3 the results in fig 10 show larger values of α for the fracture with greater aperture this is in agreement with the results from casteel and djabbarah 1988 and kovscek and bertin 2002 stating that increasing permeability wider aperture corresponds to increasing the flow resistance due to this phenomenon and because of the effect of resistance in high permeability zones foam diverts injected fluid to lower permeability porous media and enhances the efficiency of recovery processes we validated our α values by combining eq 15 and the poiseuille equation to enable us to use the total apparent viscosity from the measured pressure difference across the model and evaluate α as 17 μ a p p b 2 p 12 u comparing the two plots in fig 10 shows that the values of α increases as the fracture aperture increases according to fig 10 as bubbles are pushed closer and the radius of curvature decreases a larger resistance to flow results and foam diverts to lower permeability zones apaydin et al 1998 7 conclusion this paper develops and implements a mechanistic model in a research simulator ad gprs to study foam flow behavior in fractures ad gprs provides a framework to represent all relevant physics of foam flow within fractures of μ m sized apertures the existing population balance approach was modified and extended substantially to represent foam flow in fractures the model was validated using extensive experimental data and good agreement was found between model and measurement the model developed covers a wide range of fracture apertures and areas as well as matrix fracture combinations the underlying physics of foam generation and coalescence exhibit similar aspects in both fractured and unfractured media foam coalescence is induced at the limiting capillary pressure that varies with surfactant type and concentration because the capillary pressure is generally much smaller in fractures compared to the matrix reaching the limiting capillary pressure within a fracture s is not always possible and foam flow resistance must be adjusted accordingly pancharoen et al 2012 hence we modified an existing model for bubble flow in fractures to include local calculation of the flow resistance factor we were able to validate the values of the flow resistance factor obtained from the numerical model with the experimental observations this parameter incorporates valuable insights about the relationship of gas liquid curvature with foam apparent viscosity as gas flow rate and foam quality change the model developed along with the microscale experiments of foam behavior in ideal fractures provide inputs for simulation studies and can be used for predictions at larger scale extension of foam modeling capabilities to fractures incorporates one of the most extreme forms of heterogeneity and shows utility for predictions in complex heterogeneous media credit authorship contribution statement negar nazari conceptualization methodology software writing original draft editing muhammad m almajid conceptualization methodology review anthony r kovscek conceptualization supervision funding acquisition writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments we thank chevron for financial support through core as well as the supri a industrial affiliates work was performed in part in the nano stanford labs which are supported by the national science foundation usa as part of the national nanotechnology coordinated infrastructure under award eccs 1542152 
