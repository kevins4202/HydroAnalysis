index,text
490,investigation of seepage law of fluid flow through a self affine rough fracture has attracted broad attention because of its fundamental importance for complex hydrodynamic problems although it is natural to assume that permeability value depends on aperture size it is hard to determine which is the appropriate relationship between them because of the large number of parameters related to the multi scale geometries and mismatched behaviors in internal surfaces moreover those parameters are hard to obtain by field observation or laboratory tests for these we focused on synthesising mismatched composite topography of natural fractures and numerical simulation of fluid flow through them at pore scale firstly the control mechanism of self affine property was clarified and a novel weierstrass mandelbrot w m function was proposed to model self affine profile as per fractal topography theory afterwards a weighting algorithm was developed to construct the composite topography of fractures accounting for the mismatched behavior finally the effects of mismatched behavior hydraulic and surface tortuosities on fracture flow were systematically analyzed by numerical simulations using lattice boltzmann methods lbm at pore scale our investigation indicates that the aperture distribution is dominated by the mismatched range between internal surfaces however the hydraulic and surface tortuosity effects are approximately scaled by 2 h 1 h is the hurst exponent with the mean aperture despite of its distribution moreover it was found that the local surface roughness factor accounting for effects from surface geometries with size smaller than the value of mean aperture is stationary at long range and inversely proportional to fracture permeability based on above discussions the validity of triple effect model for permeability prediction of mismatched self affine fractures was established keywords self affine property mismatched behavior weierstrass mandelbrot function fractal topography triple effect model 1 introduction fractures extensively exist in fissured rocks and gas reservoirs and the presence of which would affect the mechanical properties of rocks brown and scholz 1985b glover et al 1998 zhong et al 2019 and the heat and mass transfer pan and connell 2012 vujević et al 2014 sebben et al 2015 luo et al 2016 zidane and firoozabadi 2018 koohbor et al 2019 significantly therefore the study of the underlying mechanism of fluid flow through a single fracture is of fundamental importance for the accurate evaluation of the flow capacity of gas or liquid in natural reservoirs in the early stage flow capacity in fractures was usually expressed as a function of the mean aperture δ with the widely accepted model called cubic law cl lomize 1951 however due to divers effects the internal surfaces of natural fracture are extremely rough with the geometries might appear self affine properties mandelbrot et al 1984 brown and scholz 1985a schmittbuhl et al 1993 turcotte and newman 1996 ponson et al 2006 bares et al 2015 and increasing evidence indicated that extremely rough geometries would affect the flow capacity significantly tsang and witherspoon 1983 zimmerman and bodvarsson 1996 luo et al 2016 ju et al 2019 and make cl failed to work tsang 1984 brown 1987a skjetne et al 1999 drazer and koplik 2000 auradou et al 2001 raimbay et al 2017 therefore numerous efforts were attracted to modify classical cl model or try to establish new models for fluid flow in self affine fractures for examples zhang et al 1996 found that the effective permeability k of a rough fracture follows a power law relationship of k δ β with β a dependent parameter of surface roughness ranged in 2 6 drazer and koplik 2000 developed an asymptotic expression of k based on their own definition of effective aperture subsequently the results of the comparative study of madadi 2003 indicated that it was not sufficient to predict k by a single δ for fractures with rough surfaces almost at the same time murata and saito 2003 pointed out hydraulic tortuosity would affect the flow capacity of rough fracture significantly talon et al 2010a also proposed an effective permeability model by extending the bottleneck effect and later concluded that the permeability in different regimes should be described by different scaling laws according to the ratios of roughness to minimum aperture talon et al 2010b all these investigations indicated that the effective permeability of self affine fractures could be expressed as a power law model of the mean aperture with exponent β being an h independent function of β h madadi and sahimi 2003 however no definitive expressions of function β h were proposed which should be attributed to the absence of a detailed understanding of physical implications from geometrical components recently jin et al 2017a analyzed the effects of surface geometries on fluid flow and catalogued them into stationary local roughness surface tortuosity and hydraulic tortuosity effects according to their physical implications as a consequence the permeability model of cl was modified into a triple effect form that including local stationary roughness effect hydraulic tortuosity effect and surface tortuosity effect jin et al 2014 and then the triple effect model was reformulated into a scaling form by considering scale and size effects in self affine geometries jin et al 2015 2017a theoretical analysis denotes that triple effect model can generalize several traditional and newly developed models from the literature jin et al 2017a and its validity was progressively approved zhu and cheng 2018 jin et al 2019b ju et al 2019 roslin et al 2019 however the geometries in two internal surfaces might appear mismatched behavior at some scale brown 1995 in details while above some particular length scale these two surfaces would be mated with one another otherwise they would be mismatched consequently brown 1995 defined this length scale as mismatched length scale mls by the power spectral density psd of fracture apertures specifically the psd follows a power law which holds only for wavelength smaller than mls while at larger wavelengths the psd is almost constant apparently the mismatched behavior between the fracture surfaces will result in a non uniform distribution of the aperture brown et al 1998 which will affect fracture s transport properties significantly talon et al 2010a consequently whether the triple effect model is competent for the evaluation of flow capacity in mismatched fractures is not guaranteed for that additional investigations should be conducted however it is hard if not impossible to obtain detailed information by field observation or laboratory tests because of the scale invariance geometries with size spanned several magnitude orders yu and li 2001 to address these issues most efforts have been devoted to numerical modeling and simulations chen et al 2009 jin et al 2017a not only because of the comprehensive modeling capabilities but also the low cost of numerical experiments that makes the independent manipulation of concerning properties possible therefore effective modeling of real composite topography in natural fractures is the precondition to mechanistically understand the hydrodynamic property previously several methods have been proposed to generate mismatched self affine rough fractures brown 1995 glover et al 1998 matsuki et al 2006 as the pioneer brown 1995 introduced the concept of mismatched behavior in self affine fracture and proposed a simple triple parameter model to describe the composite topography of natural fractures later glover et al 1998 pointed out that the mismatched degree should not be a sudden behavior which should develop gradually from a small scale to a large scale and then they modified brown s model brown 1995 to synthesize the composite topography and found which was statistically identical to the natural ones recently matsuki et al 2006 proposed a spectral synthesis method based on fractal brownian motion to construct rough fractures with the mismatched degree more independent and natural than those in previous works brown 1995 glover et al 1998 however these processes are too complicated to be efficient approaches and the physical implications to self affine geometries were not fully verified in addition abundant evidence indicates that the aperture distribution follows a normal distribution approximately brown 1995 matsuki et al 2006 rather than a power law one taking all these together one is easy to confirm that mismatched behavior should be a kind of stochastic process which is independent of the scale invariance properties in surface geometries therefore to effectively represent the real composite topography of fractures two key ingredients are required 1 each surface must be rough self affine which are consistent with the experimental evidence described above 2 the correlation degree increases with the wavelength due to spatial correlation of surface height matheron 2019 in this work we started from the characterization of self affine properties in surface geometries as per fractal topography theory newly emerged jin et al 2017b 2019a then a weighting algorithm was proposed to model mismatched behavior existing in the composite topography of self affine fractures the effects on fracture flow including self affine properties and mismatched behaviors were analyzed comprehensively via lbm simulations finally the validity of triple effect model for permeability estimation of mismatched self affine rough fractures was comparatively verified by lbm simulations and other models 2 self affine properties and flow methodology 2 1 geometric properties in natural fractures it has been proved that the undulation heights of the natural surfaces possess statistical self affine properties cox and wang 1993 for convenience the height of the fracture surface is defined as z x y at location x y which is a single valued function and yields 1 z x y μ h z μ x μ y where μ is the rescaling factor in the x and y directions while μ h is that in z direction h is the hurst exponent and h d d with d the euclidean dimension and d the fractal dimension of a rough surface meanwhile brown et al 1986 found that the two surfaces constituting a fracture are not completely correlated but show mutual match in the long wavelength region and mutual independence in the short wavelength region as demonstrated in fig 1 reference lines of a b c and d in fig 1 determine the height of the fracture surfaces the height difference between a and b and that between c and d are both equal to h the height of the upper surface relative to a is h 1 and that of the lower surface relative to b is h 2 the heights of the composite topography of the fracture relative to c and d are h c h 1 h 2 and δ h h c respectively thus the composite topography of the fracture is equivalent to the distribution curve of the aperture expect for their different reference lines of height for fully matched surfaces the composite topography will be a smooth straight line otherwise an abnormally undulating rough curve as aforementioned the flow capacity would be affected by the self affine geometries and the composite topography significantly brown 1995 jin et al 2017a therefore effective characterizations of these geometric properties are of fundamental importance for the complex hydrodynamic problems previously probability density function pdf and psd were always used to describe the statistical characteristics of random processes in the surface heights of fractures brown 1995 the power spectrum could be computed by breaking the surface profile into a sum of sinusoidal components each with its own wavelength amplitude and phase numerous investigations indicated that the relationship between wavenumber related to wavelength and psd follows a power law model brown 1995 as 2 s n c n ε where c is a constant and wavenumber n 2 π λ with λ being the wavelength s n is the psd with wavenumber n when the wave velocity equals 1 n takes the value of frequency f with the exponent ε varying between 2 and 3 the fractal dimension of the internal surfaces yields d 5 ε 2 brown and scholz 1985a in addition brown et al 1986 pointed out that the psd of the composite topography is different from that of internal surfaces in a fracture as fig 2 demonstrates therefore the scale invariance property possibly existing in the composite topography arisen from mismatched behavior between two surfaces could be ignored at the measurement scale of the mean aperture due to the size effect 2 2 flow mechanism and lbm simulations 2 2 1 triple effect model and its scale invariance form as we all know cl is the most famous model in fracture flows however the defect of cl is conspicuous in permeability estimation of rough fractures for instance the tortuosity and roughness resulted from the extremely complicated and rough surfaces have a significant influence on the permeability but unfortunately they were not reflected in the cl to accurately predict the permeability for this reason jin et al 2017a modified the classical cl by introducing hydraulic tortuosity τ and surface tortuosity τs on the basis of previous studies as 3 k r 1 12 φ δ 2 f σ τ 2 τ s 2 where k r is the effective permeability of a fracture model δ is the mean aperture φ is the effective porosity of the model fσ is the surface roughness factor srf which is semi empirically defined by f σ 1 α σ δ β witherspoon et al 1980 wherein σ quantifies the root mean square of the roughness height on the assumption that a rough surface can be expected to be a mean flat plane and α and β are the fitted parameters dependent on the surface geometry eq 3 quantitatively demonstrates the three controlled factors of fracture permeability that correspond to the three types of effects surface local roughness hydraulic tortuosity and surface tortuosity on the flow from surface geometries therefore eq 3 was defined by jin et al 2017a as the triple effect model for permeability estimation of fractures whereafter according to self affine scale invariance properties of the internal geometry of the natural fracture surface and the relationship between the fractal scale and tortuosity the fractal scaling form of triple effect model was deduced as 4 k r φ δ 2 12 f σ δ l c 4 1 h where fσ is the mean of local stationary srf l c is the characteristic length of a self affine rough surface chen et al 2009 jin et al 2017a for more details of the calculation and determination of α β l c τ and τs please consult the literature jin et al 2017a 2 2 2 lbm simulations lbm which adopts a bottom up approach is actually a mesoscopic description of microscopic physics it has been widely used to study the microstructural effects on fluid flow at pore scale in the lbm framework based on the principle of effective conversion between physical and lattice systems the real fracture space is discretized in terms of a regular lattice with spacing δx time t in terms of a time step r and velocity space in terms of a small set of velocities c i to ensure that c i r is a vector connecting two adjacent lattice sites succi 2001 as demonstrated in fig 3 in this work lbm is used to simulate fluid flow in two dimensional fractures for simplicity and convenience a two dimensional d2q9 lattice structure is used to present the description of the model and the simulations of the fluids thus the local mass density ρ x t and velocity u x t at each lattice position x and time t are given by 5 ρ x t i 0 8 f i x t u x t i 0 8 f i x t c i ρ x t the corresponding lattice boltzmann equation lbe can be expressed as 6 f i x c i r t r f i x t ω i f x t where fi is the particle mass distribution function after collision and ω i is the collision operator according to the mass and momentum conservation requirements ω i ω i c i according to the bgk model chen and doolen 1998 qian et al 1992 the collision operator takes the single relaxation time approximation 7 ω i f x t r τ lbm f i eq x t f i x t where τ lbm is a dimensionless relaxation time and f i eq x t is a quasi equilibrium distribution function its discrete velocities c i are then defined as 8 c i c 0 0 i 0 cos θ sin θ i 1 4 θ i 1 2 π 2 cos θ sin θ i 5 8 θ 2 i 9 4 π to recover the navier stokes ns equations for the fluid flow f i eq is constructed using eq 9 and the kinetic viscosity of the fluid ν is given by eq 10 9 f i eq x t ω i ρ x t 1 c i u c s 2 c i u 2 2 c s 4 u 2 2 c s 2 10 ν c s 2 τ lbm 1 2 δ x 2 r where c s 1 3 is the lattice sound speed ωi is the weight coefficient in the corresponding direction and c i is the discrete velocity there is no net fluid motion at solid boundaries due to the high irregularity of the surface geometry succi 2001 thus a no slip boundary condition is approximately adopted at the solid fluid interfaces as fig 4 demonstrates for simplicity and without loss of generality the complete bounce back scheme is used in our flow simulations the reynolds number re 1 is held to guarantee that the flow fits darcy s law the permeability in lattice dimension was calculated by 11 k lbm ν u δ p where u is the lattice average velocity δp is the pressure gradient between the input and output boundaries of the fracture space the conversion between k lbm and physical permeability k ns follows 12 k ns k lbm l physical l lbm 2 where l physical is the physical size of fractures l lbm is the corresponding lattice number 3 fractal topography to characterize mismatched self affine fractures 3 1 fractal topography theory recently a new concept called fractal topography was proposed by jin et al 2017b 2019a as per fractal topography a fractal was identified to be a dual complexity system which contains two independent complexities only respectively to be original complexity and behavioral complexity jin et al 2019a 2020 in details the original complexity determines the scaling type of single or multi scale phase type while the behavioral complexity controls the scale invariance properties such as self similarity self affinity or multifractality more importantly the behavioral complexity is uniquely defined by the fractal behavior of ω p f where p and f are both dimensionless parameters and denominated as scaling lacunarity sl and scaling coverage sc respectively the scale invariance definitions of sl and sc are expressed by 13 p l i l i 1 f n g l i 1 n g l i where g l represents a scaling object with characteristic size of l n g l represents its number consequently p and f are the size and number ratio of two successive scaling objects respectively together with the classical number size relationship and eq 13 a scale invariance definition of fractal dimension d was proposed for self similarities as 14 d lg f lg p which indicates a fractal behavior uniquely determines d and independent of the scaling object g for two dimensional self affinities the sls in the x and y direction are respective to be p x 1 μ and p y 1 μ h as per eq 1 consequently the hurst exponent h was identified to be a scale invariance parameter that characterizes the power law relationship between sls in two different directions jin et al 2017b as 15 h x y log p x log p y where hxy is the general hurst exponent together with eqs 14 and 15 a general definition of fractal dimension was proposed as eq 16 for the derivation of eq 16 interesting readers can consult ref jin et al 2019a 16 d d d i j 1 d h j i which indicates the relationship of d d h is not satisfied 3 2 mathematical definition of mismatched self affine behavior in natural fractures the weierstrass mandelbrot w m function has been widely used to model natural profiles to preserve characteristics such as randomness self affinity and continuity jin et al 2017a which was mathematically defined as 17 z x n n l n h γ n d d cos ϕ cos 2 π γ n x l ϕ where z x is the height of fracture surface in horizontal position x γ is the scaling factor determining the sampling density of frequency which usually takes the value of 1 5 d 2 in two dimensional context ϕ is a random phase in the range of 0 2π and l is the sample length eq 17 indicates that the scaling lacunarities of px and py are equal to γ and γ d d respectively according to eq 15 py should be γh as aforementioned however the relationship of d h d is not satisfied therefore to effective characterize the internal surfaces of a self affine fractures w m function must be redefined according to the theory of fractal topography jin et al 2017b 2019a as 18 z x n n l n h γ n h cos ϕ cos 2 π γ n x l ϕ next the efforts should be devoted to incorporating mismatched behavior between two self affine surfaces as noted before such a behavior could be considered as a stochastic process approximately for simplicity but without loss of generality a weighting algorithm to model mismatched self affine fractures was proposed as follows 1 generate two independent random phase sets ϕ 1 n and ϕ 2 n 2 construct upper surface surf 1 based on ϕ 1 n and eq 18 3 determine the random phase set ϕm of the lower surface in terms of the mismatched feature of fracture surfaces with different ranges of wavenumbers 4 construct the lower surface surf 2 at this point ϕ ϕ m by eq 18 and then generate a fracture that composed by surf 1 and surf 2 according to the preset mean aperture 5 discretize the fracture space into a lattice system for lbm simulations in step 3 the random phase set ϕm is determined by 19 ϕ m ϕ 1 n n l n n t ω 2 ϕ 1 n ω 1 ϕ 2 n n t n n c ϕ 2 n n c n n h where n t and n c are the wavenumbers in the range of n l n h and n t n c the weight coefficients of ω 1 0 ω 1 1 and ω 2 0 ω 2 1 are required to satisfy the relationship of ω 1 ω 2 1 with ω 1 calculated by eq 20 in terms of fig 5 20 ω 1 0 n l n n t n n t n c n t n t n n c 1 n c n n h at the very beginning of transition from mismatched to matched behavior ω 1 1 and ω 2 0 and then ω 1 decreases as the wavenumber decreases while ω 2 increases gradually once ω 2 reaches the maximum value of 1 with the wavenumber being n t the mismatched behavior is terminated and the transition stops 4 results and discussion following the weighting algorithm and new w m model a number of mismatched self affine fractures were synthesized with n l 0 and n h 50 but different δ h n t and n c in the lbm simulations the physical scale of 1 µm was discretized into 2048 lu lattice unit to guarantee numerical precision the pressure gradient δp between the input and output boundaries of the fracture was set to 10 5 pa m and the dimensionless relaxation time τ lbm was set to 1 0 to ensure the stability of lbm simulations sheikholeslami et al 2013 4 1 validation of the novel algorithm for mismatched self affine fractures a fracture model with h of 0 8 δ of 70 lu n t of 5 and n c of 30 was used to verify the validity of our algorithm the psds of surface heights and fracture apertures and their ratios were calculated the results were plotted in fig 6 the psd of surface heights varies with frequency f following a power law relationship which is clearly different from the psd of δ as shown in fig 6 a while f is larger than fc similar to that demonstrated in fig 2 the trend curves of the two psds would share same ε as their slopes demonstrated otherwise the trend curve of the psd of the aperture would gradually become flat the results are consistent with those in previous work brown 1987b 1995 to clearly demonstrate the differences of evolutionary trends between these two psds their ratio was visualized in fig 6 b in addition the pdf of the fracture aperture was plotted in fig 7 the result indicates that the apertures satisfy a gauss normal distribution which is consistent with previous work brown 1995 matsuki et al 2006 instantaneously the validity of our algorithm was verified irrespective or respect to spatial information in a statistical sense 4 2 aperture distribution controlled by mismatched range fig 8 delineated the implications of mismatched behavior on the spatial arrangement of apertures it is evident that the aperture distribution is dominated by mismatched wavenumber range of n t n c short as w t and denoted by transition window in details 1 the narrower the w t is the more rapid the transition from mismatched to matched conditions is with aperture distribution being more stationary 2 the smaller the n t and n c are the stronger the fluctuation of aperture is and vice versa and 3 a smaller n t and a wider w t would lead to a higher residence of scale invariance property in the spatial arrangement of fracture apertures in addition the size of fracture apertures generally follows the bell normal distribution but with different shapes attributed to the control from w t described above as fig 9 demonstrates 4 3 effects on fluid flow from mismatched behavior for a fracture represented by the space constrained by two parallel flat plates the distribution of fluid velocity in the cross section profile follows the parabola like shape as 21 υ y υ max 1 4 y 2 δ 2 where y is the vertical distance from the center line of the fracture namely δ 2 y δ 2 υ max is the maximum velocity of fluid in the vertical direction due to roughness and size effects fluid flow in fully matched rough fractures is tortuous with the fluid velocity approximately satisfying normal distribution or partial normal distribution jin et al 2015 as for mismatched rough fractures fluid flow would be simultaneously affected by surface roughness and non uniform distribution of apertures to better understand fluid flow in such a composite topography lbm simulations were conducted to reproduce fluid dynamics at pore scale some results were presented in fig 10 as fluid flow reaches a steady state the results indicate that flow velocity depends on mean aperture δ hurst exponent h of the internal surfaces and mismatched behavior determined by w t generally the velocity distribution is complex and irregular as those demonstrated in fig 11 from some representative cross section profiles in terms of the velocity distribution the tortuosity effects were clearly revealed due to the difference between total flow velocity υ and its horizontal component υ x υ and υ x almost follow partial normal distributions with the latter being more irregular apparently the result is attributed to the mismatched behavior existing in composite topography 4 4 validity of triple effect model in mismatched self affine fractures as aforementioned the aperture distribution in a mismatched fracture is not stationary by using of mean aperture δ as the measurement scale it would lead to an overestimation of local stationary srf but an underestimation of tortuosity effect in small aperture regions where δ δ or an opposite result in large aperture regions where δ δ as demonstrated in fig 12 as a consequence the prediction accuracy of eq 4 would be affected to some extern because the tortuosity effects might not strictly follow the scaling form defined in the fractal triple effect model however there should be very little affection to the prediction accuracy of eq 3 from the mismatched behavior due to its independence of the fracture aperture for validation we compared numerical permeability k ns and analytical permeability k as by eqs 3 and 4 respectively the good agreements between k ns and k as fig 13 approve the validity of triple effect model and its fractal form comparatively the divergence degree between k ns and k as by eq 4 appears a slight larger than that by eq 3 undoubtedly it is attributed to the mismatched behavior in terms of the discussion above therefore the validity of triple effect model was verified furthermore we compared the prediction accuracy between the triple effect model and others including classic cl using arithmetic mean aperture or geometric mean aperture and the model proposed by zimmerman and bodvarrson m zb zimmerman and bodvarsson 1996 the relationships between k ns and analytical ones were demonstrated in fig 14 comparative results indicate that the analytical permeability by triple effect model is in good agreement with k ns but there is a large deviation between k ns and the analytical permeability by cl or m zb our results manifest that the permeability of rough fractures would be overestimated by cl or m zb the comparative analysis indicates that the prediction accuracy of triple effect model is apparently higher than that of cl or m zb and the main reason should be ascribed to essential understanding of effects from surface geometries and quantitative characterizations of them taking the discussion here and above together the validity of triple effect model for permeability prediction of mismatched self affine fractures was established 5 conclusions in this work the main objective is to develop a novel algorithm for modeling mismatched self affine behaviors and then to establish the validity of triple effect model in predicting the flow capacity for fluid flow in mismatched self affine fractures to accurately describe the self affine geometry with scale invariance property in natural fractures the w m function was corrected as per fractal topography theory and then used to generate self affine rough surfaces afterwards a novel algorithm using weight thought was developed to construct mismatched fractures based on the synthetic fractures the control effect of mismatched behavior on aperture distribution was identified that the mismatched range dominated the aperture distribution with different shapes of bell normal curve finally the influence characteristics of mismatched behavior hydraulic and surface tortuosities on fluid transport law were discussed and clarified by the analysis of lbm simulation results the results indicated that despite of aperture distribution the triple effect model could be used to approximately predict the permeability of rough fractures with mismatched geometries and has a higher accuracy than other existing models in literature consequently the validity of triple effect model in evaluating and predicting the penetrating quality of natural reservoirs was established credit authorship contribution statement junling zheng conceptualization investigation methodology writing original draft yi jin supervision writing review editing funding acquisition xianhe liu visualization formal analysis cheng wang validation xiaokun liu data curation declaration of competing interest this manuscript has not been published or presented elsewhere in part or in entirety and is not under consideration by another journal we have read and understood your journal s policies and we believe that neither the manuscript nor the study violates any of these there are no conflicts of interest to declare acknowledgements this work was supported by the science and technology major project of shanxi province china grant no 20181101013 1 national natural science foundation of china grant no 41972175 cbm union foundation of shanxi province china grant no 2015012010 and national science and technology major project of china grant no 2016zx05067006 002 supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103585 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
490,investigation of seepage law of fluid flow through a self affine rough fracture has attracted broad attention because of its fundamental importance for complex hydrodynamic problems although it is natural to assume that permeability value depends on aperture size it is hard to determine which is the appropriate relationship between them because of the large number of parameters related to the multi scale geometries and mismatched behaviors in internal surfaces moreover those parameters are hard to obtain by field observation or laboratory tests for these we focused on synthesising mismatched composite topography of natural fractures and numerical simulation of fluid flow through them at pore scale firstly the control mechanism of self affine property was clarified and a novel weierstrass mandelbrot w m function was proposed to model self affine profile as per fractal topography theory afterwards a weighting algorithm was developed to construct the composite topography of fractures accounting for the mismatched behavior finally the effects of mismatched behavior hydraulic and surface tortuosities on fracture flow were systematically analyzed by numerical simulations using lattice boltzmann methods lbm at pore scale our investigation indicates that the aperture distribution is dominated by the mismatched range between internal surfaces however the hydraulic and surface tortuosity effects are approximately scaled by 2 h 1 h is the hurst exponent with the mean aperture despite of its distribution moreover it was found that the local surface roughness factor accounting for effects from surface geometries with size smaller than the value of mean aperture is stationary at long range and inversely proportional to fracture permeability based on above discussions the validity of triple effect model for permeability prediction of mismatched self affine fractures was established keywords self affine property mismatched behavior weierstrass mandelbrot function fractal topography triple effect model 1 introduction fractures extensively exist in fissured rocks and gas reservoirs and the presence of which would affect the mechanical properties of rocks brown and scholz 1985b glover et al 1998 zhong et al 2019 and the heat and mass transfer pan and connell 2012 vujević et al 2014 sebben et al 2015 luo et al 2016 zidane and firoozabadi 2018 koohbor et al 2019 significantly therefore the study of the underlying mechanism of fluid flow through a single fracture is of fundamental importance for the accurate evaluation of the flow capacity of gas or liquid in natural reservoirs in the early stage flow capacity in fractures was usually expressed as a function of the mean aperture δ with the widely accepted model called cubic law cl lomize 1951 however due to divers effects the internal surfaces of natural fracture are extremely rough with the geometries might appear self affine properties mandelbrot et al 1984 brown and scholz 1985a schmittbuhl et al 1993 turcotte and newman 1996 ponson et al 2006 bares et al 2015 and increasing evidence indicated that extremely rough geometries would affect the flow capacity significantly tsang and witherspoon 1983 zimmerman and bodvarsson 1996 luo et al 2016 ju et al 2019 and make cl failed to work tsang 1984 brown 1987a skjetne et al 1999 drazer and koplik 2000 auradou et al 2001 raimbay et al 2017 therefore numerous efforts were attracted to modify classical cl model or try to establish new models for fluid flow in self affine fractures for examples zhang et al 1996 found that the effective permeability k of a rough fracture follows a power law relationship of k δ β with β a dependent parameter of surface roughness ranged in 2 6 drazer and koplik 2000 developed an asymptotic expression of k based on their own definition of effective aperture subsequently the results of the comparative study of madadi 2003 indicated that it was not sufficient to predict k by a single δ for fractures with rough surfaces almost at the same time murata and saito 2003 pointed out hydraulic tortuosity would affect the flow capacity of rough fracture significantly talon et al 2010a also proposed an effective permeability model by extending the bottleneck effect and later concluded that the permeability in different regimes should be described by different scaling laws according to the ratios of roughness to minimum aperture talon et al 2010b all these investigations indicated that the effective permeability of self affine fractures could be expressed as a power law model of the mean aperture with exponent β being an h independent function of β h madadi and sahimi 2003 however no definitive expressions of function β h were proposed which should be attributed to the absence of a detailed understanding of physical implications from geometrical components recently jin et al 2017a analyzed the effects of surface geometries on fluid flow and catalogued them into stationary local roughness surface tortuosity and hydraulic tortuosity effects according to their physical implications as a consequence the permeability model of cl was modified into a triple effect form that including local stationary roughness effect hydraulic tortuosity effect and surface tortuosity effect jin et al 2014 and then the triple effect model was reformulated into a scaling form by considering scale and size effects in self affine geometries jin et al 2015 2017a theoretical analysis denotes that triple effect model can generalize several traditional and newly developed models from the literature jin et al 2017a and its validity was progressively approved zhu and cheng 2018 jin et al 2019b ju et al 2019 roslin et al 2019 however the geometries in two internal surfaces might appear mismatched behavior at some scale brown 1995 in details while above some particular length scale these two surfaces would be mated with one another otherwise they would be mismatched consequently brown 1995 defined this length scale as mismatched length scale mls by the power spectral density psd of fracture apertures specifically the psd follows a power law which holds only for wavelength smaller than mls while at larger wavelengths the psd is almost constant apparently the mismatched behavior between the fracture surfaces will result in a non uniform distribution of the aperture brown et al 1998 which will affect fracture s transport properties significantly talon et al 2010a consequently whether the triple effect model is competent for the evaluation of flow capacity in mismatched fractures is not guaranteed for that additional investigations should be conducted however it is hard if not impossible to obtain detailed information by field observation or laboratory tests because of the scale invariance geometries with size spanned several magnitude orders yu and li 2001 to address these issues most efforts have been devoted to numerical modeling and simulations chen et al 2009 jin et al 2017a not only because of the comprehensive modeling capabilities but also the low cost of numerical experiments that makes the independent manipulation of concerning properties possible therefore effective modeling of real composite topography in natural fractures is the precondition to mechanistically understand the hydrodynamic property previously several methods have been proposed to generate mismatched self affine rough fractures brown 1995 glover et al 1998 matsuki et al 2006 as the pioneer brown 1995 introduced the concept of mismatched behavior in self affine fracture and proposed a simple triple parameter model to describe the composite topography of natural fractures later glover et al 1998 pointed out that the mismatched degree should not be a sudden behavior which should develop gradually from a small scale to a large scale and then they modified brown s model brown 1995 to synthesize the composite topography and found which was statistically identical to the natural ones recently matsuki et al 2006 proposed a spectral synthesis method based on fractal brownian motion to construct rough fractures with the mismatched degree more independent and natural than those in previous works brown 1995 glover et al 1998 however these processes are too complicated to be efficient approaches and the physical implications to self affine geometries were not fully verified in addition abundant evidence indicates that the aperture distribution follows a normal distribution approximately brown 1995 matsuki et al 2006 rather than a power law one taking all these together one is easy to confirm that mismatched behavior should be a kind of stochastic process which is independent of the scale invariance properties in surface geometries therefore to effectively represent the real composite topography of fractures two key ingredients are required 1 each surface must be rough self affine which are consistent with the experimental evidence described above 2 the correlation degree increases with the wavelength due to spatial correlation of surface height matheron 2019 in this work we started from the characterization of self affine properties in surface geometries as per fractal topography theory newly emerged jin et al 2017b 2019a then a weighting algorithm was proposed to model mismatched behavior existing in the composite topography of self affine fractures the effects on fracture flow including self affine properties and mismatched behaviors were analyzed comprehensively via lbm simulations finally the validity of triple effect model for permeability estimation of mismatched self affine rough fractures was comparatively verified by lbm simulations and other models 2 self affine properties and flow methodology 2 1 geometric properties in natural fractures it has been proved that the undulation heights of the natural surfaces possess statistical self affine properties cox and wang 1993 for convenience the height of the fracture surface is defined as z x y at location x y which is a single valued function and yields 1 z x y μ h z μ x μ y where μ is the rescaling factor in the x and y directions while μ h is that in z direction h is the hurst exponent and h d d with d the euclidean dimension and d the fractal dimension of a rough surface meanwhile brown et al 1986 found that the two surfaces constituting a fracture are not completely correlated but show mutual match in the long wavelength region and mutual independence in the short wavelength region as demonstrated in fig 1 reference lines of a b c and d in fig 1 determine the height of the fracture surfaces the height difference between a and b and that between c and d are both equal to h the height of the upper surface relative to a is h 1 and that of the lower surface relative to b is h 2 the heights of the composite topography of the fracture relative to c and d are h c h 1 h 2 and δ h h c respectively thus the composite topography of the fracture is equivalent to the distribution curve of the aperture expect for their different reference lines of height for fully matched surfaces the composite topography will be a smooth straight line otherwise an abnormally undulating rough curve as aforementioned the flow capacity would be affected by the self affine geometries and the composite topography significantly brown 1995 jin et al 2017a therefore effective characterizations of these geometric properties are of fundamental importance for the complex hydrodynamic problems previously probability density function pdf and psd were always used to describe the statistical characteristics of random processes in the surface heights of fractures brown 1995 the power spectrum could be computed by breaking the surface profile into a sum of sinusoidal components each with its own wavelength amplitude and phase numerous investigations indicated that the relationship between wavenumber related to wavelength and psd follows a power law model brown 1995 as 2 s n c n ε where c is a constant and wavenumber n 2 π λ with λ being the wavelength s n is the psd with wavenumber n when the wave velocity equals 1 n takes the value of frequency f with the exponent ε varying between 2 and 3 the fractal dimension of the internal surfaces yields d 5 ε 2 brown and scholz 1985a in addition brown et al 1986 pointed out that the psd of the composite topography is different from that of internal surfaces in a fracture as fig 2 demonstrates therefore the scale invariance property possibly existing in the composite topography arisen from mismatched behavior between two surfaces could be ignored at the measurement scale of the mean aperture due to the size effect 2 2 flow mechanism and lbm simulations 2 2 1 triple effect model and its scale invariance form as we all know cl is the most famous model in fracture flows however the defect of cl is conspicuous in permeability estimation of rough fractures for instance the tortuosity and roughness resulted from the extremely complicated and rough surfaces have a significant influence on the permeability but unfortunately they were not reflected in the cl to accurately predict the permeability for this reason jin et al 2017a modified the classical cl by introducing hydraulic tortuosity τ and surface tortuosity τs on the basis of previous studies as 3 k r 1 12 φ δ 2 f σ τ 2 τ s 2 where k r is the effective permeability of a fracture model δ is the mean aperture φ is the effective porosity of the model fσ is the surface roughness factor srf which is semi empirically defined by f σ 1 α σ δ β witherspoon et al 1980 wherein σ quantifies the root mean square of the roughness height on the assumption that a rough surface can be expected to be a mean flat plane and α and β are the fitted parameters dependent on the surface geometry eq 3 quantitatively demonstrates the three controlled factors of fracture permeability that correspond to the three types of effects surface local roughness hydraulic tortuosity and surface tortuosity on the flow from surface geometries therefore eq 3 was defined by jin et al 2017a as the triple effect model for permeability estimation of fractures whereafter according to self affine scale invariance properties of the internal geometry of the natural fracture surface and the relationship between the fractal scale and tortuosity the fractal scaling form of triple effect model was deduced as 4 k r φ δ 2 12 f σ δ l c 4 1 h where fσ is the mean of local stationary srf l c is the characteristic length of a self affine rough surface chen et al 2009 jin et al 2017a for more details of the calculation and determination of α β l c τ and τs please consult the literature jin et al 2017a 2 2 2 lbm simulations lbm which adopts a bottom up approach is actually a mesoscopic description of microscopic physics it has been widely used to study the microstructural effects on fluid flow at pore scale in the lbm framework based on the principle of effective conversion between physical and lattice systems the real fracture space is discretized in terms of a regular lattice with spacing δx time t in terms of a time step r and velocity space in terms of a small set of velocities c i to ensure that c i r is a vector connecting two adjacent lattice sites succi 2001 as demonstrated in fig 3 in this work lbm is used to simulate fluid flow in two dimensional fractures for simplicity and convenience a two dimensional d2q9 lattice structure is used to present the description of the model and the simulations of the fluids thus the local mass density ρ x t and velocity u x t at each lattice position x and time t are given by 5 ρ x t i 0 8 f i x t u x t i 0 8 f i x t c i ρ x t the corresponding lattice boltzmann equation lbe can be expressed as 6 f i x c i r t r f i x t ω i f x t where fi is the particle mass distribution function after collision and ω i is the collision operator according to the mass and momentum conservation requirements ω i ω i c i according to the bgk model chen and doolen 1998 qian et al 1992 the collision operator takes the single relaxation time approximation 7 ω i f x t r τ lbm f i eq x t f i x t where τ lbm is a dimensionless relaxation time and f i eq x t is a quasi equilibrium distribution function its discrete velocities c i are then defined as 8 c i c 0 0 i 0 cos θ sin θ i 1 4 θ i 1 2 π 2 cos θ sin θ i 5 8 θ 2 i 9 4 π to recover the navier stokes ns equations for the fluid flow f i eq is constructed using eq 9 and the kinetic viscosity of the fluid ν is given by eq 10 9 f i eq x t ω i ρ x t 1 c i u c s 2 c i u 2 2 c s 4 u 2 2 c s 2 10 ν c s 2 τ lbm 1 2 δ x 2 r where c s 1 3 is the lattice sound speed ωi is the weight coefficient in the corresponding direction and c i is the discrete velocity there is no net fluid motion at solid boundaries due to the high irregularity of the surface geometry succi 2001 thus a no slip boundary condition is approximately adopted at the solid fluid interfaces as fig 4 demonstrates for simplicity and without loss of generality the complete bounce back scheme is used in our flow simulations the reynolds number re 1 is held to guarantee that the flow fits darcy s law the permeability in lattice dimension was calculated by 11 k lbm ν u δ p where u is the lattice average velocity δp is the pressure gradient between the input and output boundaries of the fracture space the conversion between k lbm and physical permeability k ns follows 12 k ns k lbm l physical l lbm 2 where l physical is the physical size of fractures l lbm is the corresponding lattice number 3 fractal topography to characterize mismatched self affine fractures 3 1 fractal topography theory recently a new concept called fractal topography was proposed by jin et al 2017b 2019a as per fractal topography a fractal was identified to be a dual complexity system which contains two independent complexities only respectively to be original complexity and behavioral complexity jin et al 2019a 2020 in details the original complexity determines the scaling type of single or multi scale phase type while the behavioral complexity controls the scale invariance properties such as self similarity self affinity or multifractality more importantly the behavioral complexity is uniquely defined by the fractal behavior of ω p f where p and f are both dimensionless parameters and denominated as scaling lacunarity sl and scaling coverage sc respectively the scale invariance definitions of sl and sc are expressed by 13 p l i l i 1 f n g l i 1 n g l i where g l represents a scaling object with characteristic size of l n g l represents its number consequently p and f are the size and number ratio of two successive scaling objects respectively together with the classical number size relationship and eq 13 a scale invariance definition of fractal dimension d was proposed for self similarities as 14 d lg f lg p which indicates a fractal behavior uniquely determines d and independent of the scaling object g for two dimensional self affinities the sls in the x and y direction are respective to be p x 1 μ and p y 1 μ h as per eq 1 consequently the hurst exponent h was identified to be a scale invariance parameter that characterizes the power law relationship between sls in two different directions jin et al 2017b as 15 h x y log p x log p y where hxy is the general hurst exponent together with eqs 14 and 15 a general definition of fractal dimension was proposed as eq 16 for the derivation of eq 16 interesting readers can consult ref jin et al 2019a 16 d d d i j 1 d h j i which indicates the relationship of d d h is not satisfied 3 2 mathematical definition of mismatched self affine behavior in natural fractures the weierstrass mandelbrot w m function has been widely used to model natural profiles to preserve characteristics such as randomness self affinity and continuity jin et al 2017a which was mathematically defined as 17 z x n n l n h γ n d d cos ϕ cos 2 π γ n x l ϕ where z x is the height of fracture surface in horizontal position x γ is the scaling factor determining the sampling density of frequency which usually takes the value of 1 5 d 2 in two dimensional context ϕ is a random phase in the range of 0 2π and l is the sample length eq 17 indicates that the scaling lacunarities of px and py are equal to γ and γ d d respectively according to eq 15 py should be γh as aforementioned however the relationship of d h d is not satisfied therefore to effective characterize the internal surfaces of a self affine fractures w m function must be redefined according to the theory of fractal topography jin et al 2017b 2019a as 18 z x n n l n h γ n h cos ϕ cos 2 π γ n x l ϕ next the efforts should be devoted to incorporating mismatched behavior between two self affine surfaces as noted before such a behavior could be considered as a stochastic process approximately for simplicity but without loss of generality a weighting algorithm to model mismatched self affine fractures was proposed as follows 1 generate two independent random phase sets ϕ 1 n and ϕ 2 n 2 construct upper surface surf 1 based on ϕ 1 n and eq 18 3 determine the random phase set ϕm of the lower surface in terms of the mismatched feature of fracture surfaces with different ranges of wavenumbers 4 construct the lower surface surf 2 at this point ϕ ϕ m by eq 18 and then generate a fracture that composed by surf 1 and surf 2 according to the preset mean aperture 5 discretize the fracture space into a lattice system for lbm simulations in step 3 the random phase set ϕm is determined by 19 ϕ m ϕ 1 n n l n n t ω 2 ϕ 1 n ω 1 ϕ 2 n n t n n c ϕ 2 n n c n n h where n t and n c are the wavenumbers in the range of n l n h and n t n c the weight coefficients of ω 1 0 ω 1 1 and ω 2 0 ω 2 1 are required to satisfy the relationship of ω 1 ω 2 1 with ω 1 calculated by eq 20 in terms of fig 5 20 ω 1 0 n l n n t n n t n c n t n t n n c 1 n c n n h at the very beginning of transition from mismatched to matched behavior ω 1 1 and ω 2 0 and then ω 1 decreases as the wavenumber decreases while ω 2 increases gradually once ω 2 reaches the maximum value of 1 with the wavenumber being n t the mismatched behavior is terminated and the transition stops 4 results and discussion following the weighting algorithm and new w m model a number of mismatched self affine fractures were synthesized with n l 0 and n h 50 but different δ h n t and n c in the lbm simulations the physical scale of 1 µm was discretized into 2048 lu lattice unit to guarantee numerical precision the pressure gradient δp between the input and output boundaries of the fracture was set to 10 5 pa m and the dimensionless relaxation time τ lbm was set to 1 0 to ensure the stability of lbm simulations sheikholeslami et al 2013 4 1 validation of the novel algorithm for mismatched self affine fractures a fracture model with h of 0 8 δ of 70 lu n t of 5 and n c of 30 was used to verify the validity of our algorithm the psds of surface heights and fracture apertures and their ratios were calculated the results were plotted in fig 6 the psd of surface heights varies with frequency f following a power law relationship which is clearly different from the psd of δ as shown in fig 6 a while f is larger than fc similar to that demonstrated in fig 2 the trend curves of the two psds would share same ε as their slopes demonstrated otherwise the trend curve of the psd of the aperture would gradually become flat the results are consistent with those in previous work brown 1987b 1995 to clearly demonstrate the differences of evolutionary trends between these two psds their ratio was visualized in fig 6 b in addition the pdf of the fracture aperture was plotted in fig 7 the result indicates that the apertures satisfy a gauss normal distribution which is consistent with previous work brown 1995 matsuki et al 2006 instantaneously the validity of our algorithm was verified irrespective or respect to spatial information in a statistical sense 4 2 aperture distribution controlled by mismatched range fig 8 delineated the implications of mismatched behavior on the spatial arrangement of apertures it is evident that the aperture distribution is dominated by mismatched wavenumber range of n t n c short as w t and denoted by transition window in details 1 the narrower the w t is the more rapid the transition from mismatched to matched conditions is with aperture distribution being more stationary 2 the smaller the n t and n c are the stronger the fluctuation of aperture is and vice versa and 3 a smaller n t and a wider w t would lead to a higher residence of scale invariance property in the spatial arrangement of fracture apertures in addition the size of fracture apertures generally follows the bell normal distribution but with different shapes attributed to the control from w t described above as fig 9 demonstrates 4 3 effects on fluid flow from mismatched behavior for a fracture represented by the space constrained by two parallel flat plates the distribution of fluid velocity in the cross section profile follows the parabola like shape as 21 υ y υ max 1 4 y 2 δ 2 where y is the vertical distance from the center line of the fracture namely δ 2 y δ 2 υ max is the maximum velocity of fluid in the vertical direction due to roughness and size effects fluid flow in fully matched rough fractures is tortuous with the fluid velocity approximately satisfying normal distribution or partial normal distribution jin et al 2015 as for mismatched rough fractures fluid flow would be simultaneously affected by surface roughness and non uniform distribution of apertures to better understand fluid flow in such a composite topography lbm simulations were conducted to reproduce fluid dynamics at pore scale some results were presented in fig 10 as fluid flow reaches a steady state the results indicate that flow velocity depends on mean aperture δ hurst exponent h of the internal surfaces and mismatched behavior determined by w t generally the velocity distribution is complex and irregular as those demonstrated in fig 11 from some representative cross section profiles in terms of the velocity distribution the tortuosity effects were clearly revealed due to the difference between total flow velocity υ and its horizontal component υ x υ and υ x almost follow partial normal distributions with the latter being more irregular apparently the result is attributed to the mismatched behavior existing in composite topography 4 4 validity of triple effect model in mismatched self affine fractures as aforementioned the aperture distribution in a mismatched fracture is not stationary by using of mean aperture δ as the measurement scale it would lead to an overestimation of local stationary srf but an underestimation of tortuosity effect in small aperture regions where δ δ or an opposite result in large aperture regions where δ δ as demonstrated in fig 12 as a consequence the prediction accuracy of eq 4 would be affected to some extern because the tortuosity effects might not strictly follow the scaling form defined in the fractal triple effect model however there should be very little affection to the prediction accuracy of eq 3 from the mismatched behavior due to its independence of the fracture aperture for validation we compared numerical permeability k ns and analytical permeability k as by eqs 3 and 4 respectively the good agreements between k ns and k as fig 13 approve the validity of triple effect model and its fractal form comparatively the divergence degree between k ns and k as by eq 4 appears a slight larger than that by eq 3 undoubtedly it is attributed to the mismatched behavior in terms of the discussion above therefore the validity of triple effect model was verified furthermore we compared the prediction accuracy between the triple effect model and others including classic cl using arithmetic mean aperture or geometric mean aperture and the model proposed by zimmerman and bodvarrson m zb zimmerman and bodvarsson 1996 the relationships between k ns and analytical ones were demonstrated in fig 14 comparative results indicate that the analytical permeability by triple effect model is in good agreement with k ns but there is a large deviation between k ns and the analytical permeability by cl or m zb our results manifest that the permeability of rough fractures would be overestimated by cl or m zb the comparative analysis indicates that the prediction accuracy of triple effect model is apparently higher than that of cl or m zb and the main reason should be ascribed to essential understanding of effects from surface geometries and quantitative characterizations of them taking the discussion here and above together the validity of triple effect model for permeability prediction of mismatched self affine fractures was established 5 conclusions in this work the main objective is to develop a novel algorithm for modeling mismatched self affine behaviors and then to establish the validity of triple effect model in predicting the flow capacity for fluid flow in mismatched self affine fractures to accurately describe the self affine geometry with scale invariance property in natural fractures the w m function was corrected as per fractal topography theory and then used to generate self affine rough surfaces afterwards a novel algorithm using weight thought was developed to construct mismatched fractures based on the synthetic fractures the control effect of mismatched behavior on aperture distribution was identified that the mismatched range dominated the aperture distribution with different shapes of bell normal curve finally the influence characteristics of mismatched behavior hydraulic and surface tortuosities on fluid transport law were discussed and clarified by the analysis of lbm simulation results the results indicated that despite of aperture distribution the triple effect model could be used to approximately predict the permeability of rough fractures with mismatched geometries and has a higher accuracy than other existing models in literature consequently the validity of triple effect model in evaluating and predicting the penetrating quality of natural reservoirs was established credit authorship contribution statement junling zheng conceptualization investigation methodology writing original draft yi jin supervision writing review editing funding acquisition xianhe liu visualization formal analysis cheng wang validation xiaokun liu data curation declaration of competing interest this manuscript has not been published or presented elsewhere in part or in entirety and is not under consideration by another journal we have read and understood your journal s policies and we believe that neither the manuscript nor the study violates any of these there are no conflicts of interest to declare acknowledgements this work was supported by the science and technology major project of shanxi province china grant no 20181101013 1 national natural science foundation of china grant no 41972175 cbm union foundation of shanxi province china grant no 2015012010 and national science and technology major project of china grant no 2016zx05067006 002 supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103585 appendix a supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 supplementary data s1 
491,the immiscible fluid displacement pattern controlled by the balance of viscous and capillary forces has a significant effect on the recovery or storage efficiency in subsurface processes the phase diagram of displacement patterns has been extensively studied for the two dimensional 2d micromodel however that of the three dimensional 3d porous media has received little attention this work experimentally studied the immiscible drainage displacement in an unconsolidated packed bed at the pore scale with a wide range of capillary number ca and viscosity ratio m using x ray micro tomography three typical displacement patterns namely viscous fingering capillary fingering and stable displacement were observed in 3d porous media the rough location of three displacement patterns on the ca m diagram was consistent with previous studies in 2d micromodel the boundaries for three regimes were determined based on the quantitative analyses of the saturation distribution as functions of ca and m compared with the result in 2d micromodel a broader transition zone between different regimes was found in 3d porous media the characterizations of finger structures e g fractal dimension and finger width were applied to reveal the mechanism of how the injected fluid invades the pores and throats inside porous media for different displacement patterns the average fractal dimension of capillary fingerings was 2 58 0 05 which agrees with the 2 55 defined by the invasion percolation theory for the viscous fingering where the viscous force dominates the invasion process the invading fluid follows a several preferential flow paths in the same direction as the injection and the finger width was only 1 to 2 pore bodies besides the invasion dynamics under continuous injection conditions were compared for typical viscous and capillary fingerings this study may improve our understanding of the dynamics of displacement processes jointly governed by the viscous capillary forces in 3d porous media furthermore the phase diagram under various conditions i e a wide range of ca and m can help to find a suitable reservoir conditions for subsurface processes keywords displacement patterns phase diagram porous media drainage micro tomography 1 introduction the immiscible fluid fluid displacement in porous media is of great importance in many natural and technological processes including geological carbon sequestration shaffer 2010 hosseini and nicot 2012 soltanian et al 2017 bakhshian and sahimi 2017 enhanced oil recovery iglauer et al 2013 simjoo et al 2013 and remediation of non aqueous phase liquids porter et al 2010 nambi and powers 2000 when a lower viscosity fluid is injected to displace a higher viscosity fluid the displacement patterns of the two fluid interphases always presents a non compact structure that affects the recovery or storage efficiency wang et al 2013 nobakht et al 2007 therefore qualitative and quantitative analyses on the displacement patterns in porous media are therefore essential for optimizing subsurface processes extensive work has been implemented in the literature to investigate the immiscible displacement in porous media according to the pioneering work of lenormand et al lenormand et al 1988 in two dimensional 2d micromodels the fluid fluid displacement is governed by the competition of viscous and capillary forces the effect of these forces on displacement processes can be characterized by the two most important parameters the capillary number ca μ i vi σ where μ i vi and σ are the viscosity velocity of invading phase and the interfacial tension respectively and the viscosity ratio m μ i μ d where μ d is the viscosity of the defending phase experimental and numerical results in the pore network were mapped on a phase diagram with three typical displacement patterns namely viscous fingering capillary fingering and stable displacement where the axes are the capillary number ca and the viscosity ratio m similar works were supplemented to improve the accuracy of the phase diagram with a micromodel experiment and a numerical simulation zhang et al 2011 liu et al 2013 in addition to micromodel chen et al 2017 2018 experimentally investigated the two flow in rough fractured media and proposed a full phase diagram from unfavorable logm 0 to favorable displacement logm 0 conditions although many other reservoir parameters including interfacial tension surface roughness wettability and heterogeneity of media also play a significant role on the displacement patterns zhao et al 2016 hu et al 2017 hu et al 2017 jiang et al 2014 wang et al 2018 the phase diagram proposed by lenormand et al 1988 and zhang et al 2011 generally provides researchers a pithily and reliable reference to define immiscible fluid fluid displacement patterns in 2d porous media in these literatures lenormand et al 1988 zhang et al 2011 liu et al 2013 chen et al 2017 chen et al 2018 zhao et al 2016 hu et al 2017 hu et al 2017 the two dimensional micromodel was treated as the porous media to directly observe the dynamic behavior of the invading fluid where only the viscous and capillary forces were considered however the situation will become more complex in three dimensional 3d porous media such as natural sandstones and packed beds in 3d porous media when the density difference of the invading and defending fluid is large the buoyancy force has a significant effect on the displacement processes wilkinson 1984 berkowitz and ewing 1998 muharrik et al 2018 bolster et al 2011 the inherent pore structures e g pore size distribution and connectivity are influenced by the system dimension which further affect the fluid behaviors in porous media the penetration process is mainly controlled by the pore size and pore connectivity for two fluids of immiscible displacement the displacement efficiency in the heterogeneous pore networks is lower than in the homogeneous one this is because heterogeneity weakens the displacement stability liu et al 2015 the mechanism of immiscible fluid displacement process for a highly heterogeneous 3d porous media have not been fully understood the numerical methods such as lattice boltzmann method lbm smoothed particle hydrodynamics sph and finite volume method fvm provide a high temporal and spatial resolution to investigate the pore scale events such as haines jumps snap off and pore filling events hu et al 2017 zacharoudiou and boek 2016 bandara et al 2013 many researchers have recently applied the numerical method to simulate the immiscible fluid displacement process in digital rocks yamabe et al 2015 tsuji et al 2016 zacharoudiou et al 2018 bakhshian et al 2019 tsuji et al 2016 performed a series of simulations on the two phase fluid displacement patterns in a three dimensional natural sandstone under various reservoir conditions stable displacement was not observed in the 3d porous media while it could be found in the 2d homogeneous model under the same condition this may have resulted from the pore connectivity and a higher coordination number in of 3d system however the computation source limits the scale of porous media to hundreds of microns which are even far smaller than the laboratory scale for a model with a length of 1 2 mm sometimes the calculation must be terminated in advance to save the computing resources tsuji et al 2016 from literatures on immiscible displacement in 3d porous media yamabe et al 2015 tsuji et al 2016 zacharoudiou et al 2018 bakhshian et al 2019 the capillary number and the viscosity ratio only reached a relatively small range compared with the laboratory experiments e g logm 4 7 2 9 in lenormand et al s work lenormand et al 1988 thus it is of paramount importance to study the immiscible fluid fluid displacement patterns of the 3d porous media with a broad range of ca and m besides most researches conducted on the 3d drainage process were on numerical simulation yamabe et al 2015 tsuji et al 2016 zacharoudiou et al 2018 bakhshian et al 2019 and few experimental studies have been reported in the last decades non intrusive measurement techniques such as confocal microscopy magnetic resonance imaging and x ray ct micro tomography micro ct have been applied to investigate the multiphase flow in 3d porous media pore scale visualization of gas trapping zhou et al 2011 zhou et al 2010 scanziani et al 2018 gas dissolution exsolution patmonoaji and suekane 2017 zuo et al 2017 jiang et al 2019 and immiscible fluid fluid displacements berg et al 2013 provided a novel insight to investigate the multiphase flow and extended the understanding of the multiphase flow mechanism inside the porous media this study presents a series of immiscible fluid fluid displacement experiments in 3d packed beds with a wide range of capillary numbers and viscosity ratios using the high resolution micro ct for the drainage displacement the porous media is initially saturated with a wetting phase then displaced by a non wetting phase different displacement patterns including viscous fingering capillary fingering and stable displacement are identified based on the displacement process for the first time these patterns are mapped on the phase diagram logca logm for 3d porous media including the unfavorable logm 0 and favorable logm 0 displacements to quantify the boundaries for different regimes the effect of the displacement patterns on the saturation of the invading phase was estimated the result is expected to improve the accuracy of the phase diagram for the drainage displacement process in 3d porous media the finger structure morphology such as the fractal dimension and the finger width is quantitatively analyzed based on the high resolution obtained images furthermore the invasion dynamic of the invading phase for the typical viscous fingering and capillary fingering is recorded the result can help reveal the mechanism of the invasion process with different displacement patterns which affects the displacement efficiency in the enhanced oil recovery and the storage efficiency in the geological carbon sequestration 2 material and methods 2 1 porous media an unconsolidated packed bed was chosen as a porous medium for the drainage displacements glass beads fabricated with soda lime glass have an oil wet surface bz 04 as one inc japan the typical diameters of the particle pore and throat are 400 µm 300 µm and 100 µm respectively fig 1 the permeability of the porous media was measured by a water flooding experiment k 1 4 10 10 m2 as expected k 4 5 10 10 m2 estimated by the kozeny carman relation the same glass beads washed with toluene ethanol and then water to remove the coating were used as the water wet porous medium for the favorable displacement setiawan et al 2014 the packed bed was assembled by pouring the particles into an acrylic resin cylinder with an inner diameter of 10 mm over a height of 16 mm fig 2 during particle pouring the cylinder was kept shaken to make the packed bed more compact tiny glass beads were packed near the inner tube forming a low permeable layer with the thickness of a 0 4 mm to avoid the invading fluid from preferably passing through near the tube wall two 1 mm thick sintered glass filters were placed at the bottom and top of the packed bed which not only can provide a uniform fluid distribution but also support the unconsolidated structure the sintered glass filters with low permeability will lead to a large flow residence and limit the injection flow rates for the high viscosity conditions thus for the highest viscosity oil case the sintered glass filter was replaced by multilayers of particles with different diameters ranging from 4 mm to 0 6 mm 2 2 fluid pairs water and silicone oil were chosen as the fluid pairs to investigate the immiscible fluid fluid displacement in the porous media silicone oil is available with a broad range of viscosity from 0 65 10 6 to 1 0 m2 s depending on the polymer length barca et al 2014 five kinds of silicone oil were selected herein kf 0 65 kf 10 kf 100 kf 1 000 and kf 10 000 shin etsu chemical co ltd the corresponding density ranged from 760 to 975 kg m3 to eliminate the buoyancy effect a proportionate of tetrachloroethylene pce was mixed with the silicone oil to match the density of water 1 iododecane was added to the silicone oil to enhance the contrast with water during the micro ct scan table 1 presents the mass fraction of the three components and the mixture density the largest density difference between water and mixture is 40 kg m3 corresponding to bo 1 18 10 3 bo gl 2δρ σ where g is the gravitational acceleration l is the characteristic pore size δρ is the fluid density difference and σ is the interfacial tension the buoyancy effect on the displacement patterns could be ignored in this study deionized water and five kinds of mixtures were selected with viscosity ratio ranging seven orders of magnitude table 2 presents the physical properties of these fluid pairs 2 3 experimental process prior to each experiment the sample was placed into the vacuum chamber forming the initial situation that the packed bed was completely saturated by the defending phase the outlet of the sample was blocked up and the inlet was immersed in the defending phase fluid the vacuum chamber valve was opened after no bubble could be observed in the defending phase fluid for 10 min the pressure difference between inside and outside the sample pushed the fluid into the pore before the invading fluid was introduced through the inlet the packed bed saturation was carefully checked according to the ct images the atmospheric pressure was not enough to overcome the entry pressure and the initial saturation cannot reach 100 when the silicone oil viscosity is larger than 1 0 10 3 m2 s in this case a relatively high injection flow rate was applied to saturate the packed bed the invading fluid was upwardly injected with a syringe pump ic3100 kd scientific inc and the corresponding capillary number varied from logca 8 to logca 2 at high ca condition a breakthrough occurs after a very short injection time it is hard to catch the 3d images of breakthrough time under continuous injection conditions due to the limitation in our micro tomography thus a discontinuous injection method was implemented where an interval volume fluid was injected then stopped and scanned the process was repeated until the invading phase reached the outlet and this is referred as the breakthrough time in some cases the injection process was continued after breakthrough to investigate the invasion dynamics of the typical viscous and capillary fingerings under continuous flow condition the saturation of the invading fluid increases until reaches a steady state which is referred to as the equilibrium state 2 4 image processing micro tomography with a micro ct scanxmate rb090ss comscantechno co ltd was used to visualize the fluid morphology during the displacement process each scan captured 1000 images along a 360 rotation in approximately 125 s enabling the production of a 3d image of the packed bed with an image resolution of 992 992 992 voxels 16 491 µm pixel all images were collected after the invading phase was injected this image resolution corresponds to 16 36 16 36 16 36 mm3 which is enough to capture the whole packed bed region the same x ray intensity 8 12 w i 116 µa v 70 kv was used for all the experiments the packed bed sample remained vertical during the scanning while the x ray source and detector rotated horizontally the raw images were filtered to remove the noise and preserve the edges using a non local means filter buades et al 2011 a simple gray scale segmentation algorithm according to the 2d histogram was used in this case the simple segmentation method was enough to separate the solid phase and fluid phases because the particle shape was regular after being filtered the pore and the solid were first separated and the threshold value was set to match the porosity measured with the weighing method ε 0 37 the watershed algorithm was used to define the individual pore and particle patmonoaji et al 2020 the diameter of the pores and the particles were then described by way of the equivalent sphere diameter with the same volume fig 1 presents detailed information on the packed bed including the probability density function of the pore throat and particle accurately segmenting the two fluid phases from the pore space was quite difficult especially when the image resolution was not very high andrew 2014 the gray value in the acquired images increased from water silicone oil to particles because of the difference absorption of x ray a pseudo interface was found between the particles and the water like the oil film covering the particles andrew 2014 the captured images resolution 16 491 µm pixel was not enough to observe the thin oil film 1 µm krummel et al 2013 thus the pseudo interface was treated as water using the followed procedure an automated calculated threshold value was introduced to separate the water and oil phases in imagej programs nih image the water and particle regions were then dilated twice following a boolean intersection and the pseudo interface was obtained the boolean result was added to the primary water region after that the particle image was taken as a reference to remove overvaluation using a boolean subtraction the saturation of the invading phase was measured from these images obtained then the spatial structure reconstructed from images stack was applied to estimate the fractal dimension and the finger width the detailed estimation method will be discussed in sections 3 1 3 and 3 1 4 3 results and discussion 3 1 characterization of the displacement patterns at breakthrough time 3 1 1 displacement patterns fig 3 shows the visualization of the displacement patterns at breakthrough time for a wide range of capillary number and viscosity ratio including favorable and unfavorable displacements the capillary number decreased from the top row to the down row with seven orders of magnitude logca ranges from 8 to 2 and the viscosity ratio increased from the left column to the right column with seven orders of magnitude logm ranges from 4 to 2 three typical displacement patterns namely viscous fingering capillary fingering and stable displacement were observed viscous fingering the displacement of the defending phase by the invading phase is widely recognized to exhibit viscous fingering under high ca and low m condition because of the competition between the capillary and viscous forces in the regime of vicious fingering upper left in fig 3 the thin fingers followed a number of preferential flow path in the same direction as the injection and no backward movement to note many invading phase discrete ganglions were observed at the lowest viscosity ratio logm 4 with a relatively high capillary number logca 6 5 and 4 the snap off event during drainage process leads to these discrete ganglions which can also be found in 3d simulation and experimental results yamabe et al 2015 li et al 2009 the behavior of viscous fingering is principally controlled by viscous forces due to the viscosity of the defending phase lenormand et al 1988 when the velocity of the invading phase is high the front of the displacement advances very fast and soon reaches the outlet thus the saturation of viscous fingering is usually lower than capillary fingering and stable displacement as shown in fig 4 capillary fingering in the regime of capillary fingering bottom in fig 3 the injected non wetting fluid invaded not only along the outlet but also to radial direction and even the inlet direction the flow paths merged to a main stout finger hence the invading phase saturation was higher at low ca the viscous forces are negligible in both the defending and the invading fluid and the principal force is due to capillarity the invasion process of the capillary fingering can be described with the invasion percolation theory dias and wilkinson 1986 the invading fluid only passed through the largest throat where the capillary entry pressure was the lowest thus the average throat size invaded by the invading phase for capillary fingering was larger than that for viscous fingering this also contributed to the higher invading phase saturation for capillary fingering stable displacement in the regime of stable displacement upper right in fig 3 the defending phase was almost completely displaced by the invading phase however the near outlet presented some irregularities at high ca and high m the principal force is due to the viscosity of the invading fluid the stable displacement occurs at the unfavorable condition logm 0 where the lower viscosity defending fluid is displaced by a higher viscosity fluid during the invasion process of the invading phase some unstable fingers occurred at the main flow front these fingers would be overtaken by the subsequent main flow since the fingers have a lower pressure than the main flow front zhang et al 2011 therefore the stable displacement with compact structure usually has a very high saturation e g 94 at logca 2 logm 2 3 1 2 saturation and phase diagram fig 4a shows the saturation distribution of the invading phase on the diagram of ca and m generally the invading phase saturation at breakthrough time increase from viscous fingering to capillary fingering then to stable displacement to quantify the boundaries of the three regimes in ca m diagram we estimated the effect of the three displacement patterns on the saturation at breakthrough time fig 4b shows the effect of the viscosity ratio on the invading phase saturation which can be used to distinguish the boundaries from viscous fingering to stable displacement lines a and b fig 5 the saturation curve as a function of the viscosity ratio consisting of two plateaus and a sharply growing middle segment qualitatively agrees with the simulation result proposed by lenormand et al 1988 the two plateaus represent two distinct regimes the viscous fingering with low saturation and close stable displacement with high saturation an increasing stage with a constant slope occurred from logm 2 to 0 2 for a high ca condition i e logca 4 and 5 indicating a transition zone from viscous fingering to close stable displacement lines a and b fig 5 fig s 4c and d depict the effect of the capillary number on the invading phase saturation for unfavorable logm 0 and favorable displacements logm 0 respectively the non wetting phase saturation generally decreased with the increasing capillary number for the unfavorable displacement reflecting a transition zone from viscous fingering to capillary fingering but increased for the favorable displacement reflecting a transition zone from capillary fingering to stable displacement from the green dotted line in fig 4c at logm 2 the curve consists of two plateaus and a descending segment the two plateaus represent two distinct regimes the capillary fingering with high saturation and viscous fingering with low saturation a decreasing stage with a constant slope occurred from logca 7 to 5 indicating a transition zone from capillary fingering to viscous fingering lines e and f fig 5 for the two lowest m i e logm 3 and 4 only one plateau with low saturation exists at high ca condition which represents the viscous fingering regime to note the capillary number of decrement stage remains in two orders of magnitude it indicates that the width of the transition zone is stable about 2 orders of magnitude under different m conditions for the higher value of m i e logm 1 the invading phase saturation changes slightly from logca 8 to 6 indicating a capillary fingering regime line d fig 5 as shown in fig 4d the invading phase saturation increases with the capillary number under favorable displacement at low ca the invading phase saturation ranges from 30 to 60 which is higher than 20 of the viscous fingering when the capillary number increase the role of viscous forces of displacing fluid become more important therefore the invading phase saturation increases with the increase in the capillary from logca 6 to 3 which is referred to as a transition zone from capillary fingering to stable displacement lines d and c fig 5 at a high ca i e logca 3 and 2 the invading phase saturation is close to 90 suggesting that stable displacements have taken place and only near outlet has some irregularities the boundaries of the three displacement regimes on the phase diagram for 3d unconsolidated porous media were determined based on the 35 experimental results as shown in fig 5 the shape of the three regimes was similar with the result obtained in the 2d periodic homogenous pore model lenormand et al 1988 zhang et al 2011 two parallel lines e and f with a slop of 1 represent the boundaries of the transition zone from viscous fingering to capillary fingering this indicates that the displacement process in 3d porous media is also controlled by the competition between the viscous forces and the capillary forces lenormand et al 1988 however the locations of these boundaries are different from the 2d micromodel experiment results zhang et al 2011 a broader transition zone between any two regimes could be found in 3d heterogeneous porous media the heterogeneity primarily contributes to the observed differences as shown in fig 1b the pore and throat size distributions in the 3d porous media show a very wide range where the multiple displacement patterns easily occurred simultaneously chen et al 2017 liu et al 2015 the system dimension affects the inherent connectivity of porous media the coordination number of the pore is 4 and 4 6 for the 2d homogenous micromodel zhang et al 2011 and the 3d packed bed respectively in a highly connected porous media the fingers easily merge with adjacent fingers and show a multiple displacement pattern as shown in fig 3 even for viscous fingering the thin finger is connected with the neighboring one at some pores 3 1 3 fractal dimension the observation in fig 3 shows that the finger structure exhibits complex spatial distribution for three typical displacement patterns to estimate the complexity of finger structures the fractal dimension was introduced using the standard box counting method li et al 2009 the 3d structure of the invading phase was separated into several parts based on the size of the box s each box was verified for the presence or absence of a displacing fluid the data of the number of boxes that contained the displacing fluid n s and the length of boxes 1 s were used to calculate the fractal dimension as shown in fig 6 a the estimate slop of lnn s ln1 s is the fractal dimension value fig 6b d depict the effects of the capillary number and the viscosity ratio on the fractal number of the invading phase including the favorable and unfavorable displacements the curves of the fractal dimension as a function of ca and m show a similar tendency with the curves of the invading phase saturation the fractal dimension increases from viscous fingering to capillary fingering and a transition zone exists between them six cases were selected as the typical capillary fingering inside of the capillary fingering regime in fig 5 the average fractal dimensions for the six typical capillary fingerings equaled 2 58 0 05 the value was in a reasonable agreement with the value of 2 55 in the simulation results when invasion percolation theory was considered dias and wilkinson 1986 for the lowest viscosity ratio logm 4 the fractal dimensions of the viscous fingering which were very close to 2 00 were 2 05 and 2 07 for the capillary numbers of logca 4 and logca 5 in the extreme condition lower m and higher ca the viscous fingering structures could be looser and corresponding lower fractal dimension the lower limit of fractal dimension predicted by the diffusion limited cluster aggregation dlca is 1 80 eggersdorfer et al 2011 mandelbrot 1983 the single pore filled by the invading phase was treated as the cluster in the dlca method 3 1 4 finger width the finger width is a more relevant distinguishing feature for different displacement patterns e g viscous fingering and capillary fingering stokes et al 1986 løvoll et al 2004 when viscous fingering occurs loosely connected or disconnected flow paths progress forward toward the outlet it is difficult to directly measure the width of a three dimensional finger due to its complex spatial structure here we presented a statistical averaging method to estimate the finger width of these 3d fingerings firstly the fingering structure was divided into several parts n along the vertical direction as shown inset in fig 7 n 4 then the 3d object count method was applied to detect all individual objects which were treated as the cross sectional of a finger the information of these objects including volume v height h and numbering j was stored in a matrix each object was assumed as a cylinder of diameter d and the value of d could be calculated by dj 4 π vj hj 1 2 after a volume weighted average was used to estimate the average diameter d v j d j v j finally the average diameter was divided by the pore diameter dpore to get the dimensionless finger width w fig 7 shows two different trends of w as a function of n for the viscous fingering logm 3 logca 5 and capillary fingering logm 3 logca 7 for viscous fingering the average finger width is uniform and equals to the single flow path width the average width does not change with the increasing n and each object has the same finger width for capillary fingering the average finger width decreases rapidly n 20 and then tends to be constant at low n the average finger width is overestimated due to the interconnected flow path the height of each part decreases with increasing n when the height is smaller than the size of trapped blobs a single flow path without trapped blobs are detected the average width of this single flow path is selected to evaluate the finger width of capillary fingering the effective finger width w for each displacement pattern was defined by further averaging the average finger width w between n 20 and 30 trojer et al 2015 fig 8 presents the effective finger width w as a function of the capillary number and viscosity ratio as shown in fig 8a with the increase in the capillary number the effective finger width slightly decreases from 2 to 1 75 at logm 3 although a transition from capillary fingering to capillary fingering is expected the effective finger width remains at a small value under all condition the capillary fingering still presents some features of viscous fingering under low m condition at a fixed capillary number logca 6 the effective finger width changes significantly with the increase in capillary number from 2 to 7 it indicates that the displacement patterns changes from viscous fingering to capillary fingering which qualitatively agrees with the prediction of phase diagram generally the effective finger of viscous fingering is 1 2 pore bodies while capillary fingering is 6 7 pore bodies 3 2 invasion dynamic of the invading phase fig 9 presents the growth behavior of the invading phase logm 3 to gain an insight into how the competition between the capillary and viscous forces affects the invasion dynamic the displacement pattern in the middle v v br 1 00 represents the breakthrough time when the invading phase first reached the top of the porous media according to the phase diagram in fig 4 with the capillary number of ca 1 0 10 4 and 1 0 10 8 the displacement patterns indicate typical viscous and capillary fingering respectively the invading phase invasion processes are mainly controlled by the viscous force for viscous fingering fig 9a before the breakthrough thin figures with 1 2 pore bodies followed a number of preferential flow paths along the injection direction tsuji et al 2016 ferer et al 2004 the invading phase rapidly grew at the front position while the bulk of the invading fluid at the near inlet area grew forward with a relatively lower speed after the main flow reached to the outlet of the porous medium its structure remained stable and other fingers at the front of the bulk fluid shown an accelerate growth as shown in fig 10 a the saturation of invading phase increased rapidly at the front than that at the bottom after breakthrough decreasing four orders of magnitude of the capillary number to ca 1 0 10 8 the capillary forces overpassed the viscous forces and controlled the invasion dynamic in drainage process the iconic backward structure of the invading phase and the defending phase trapping occurred during the whole invasion process before the breakthrough time v v br 1 0 the main finger front was not strictly grow along the injection direction fig 9b a lot of invasion processes were also observed at the bulk fluid bottom region once the invading phase reached the outlet continue to inject no new fingers could be observed either at the front or at the bottom as shown in fig 10b the invading phase saturation profiles almost fixed after breakthrough v v br 1 0 except slight different at the bottom compared with that at breakthrough time v v br 1 0 for the capillary fingering the imposed pressure was not sufficient to invade new throats and pores after breakthrough therefore the fluid could only flowed through the formed displacement pathways and the invading phase saturation remained constant it indicated that the displacement efficiency cannot be further improved by injecting excessive volume of invading phase for capillary fingering conditions fig 4c shows that the displacement efficiency at the breakthrough time increased with the decreasing the injection flow rate thereby agreeing with the previous numerical results lenormand et al 1988 tsuji et al 2016 however a reverse trend could be found at the equilibrium state zhang et al 2011 the invasion dynamics of the invading phase provides an explanation as to this phenomenon after the breakthrough time the invading phase saturation continued to linearly increase with the injection volume for the high capillary number cases fig s 11 a b meanwhile no further increase was observed at the low flow rate condition fig 11e thus si of the viscous fingering will be larger than that of the capillary fingering at the same viscosity ratio when the displacement pattern achieves an equilibrium state the difference between δ s i b r at the breakthrough time and s i e q at the equilibrium state was measured to classify the displacement patterns i e δ s i s i e q δ s i b r fig 11 illustrates that the δsi value is larger than 13 for the viscous fingering but is almost equal to zero for the capillary fingering at the transition zone the invading phase saturation linearly increased with the injection volume after the breakthrough and then trended to a constant value fig s 11c d subsequently δsi roughly increased with the increasing of capillary number which can also be found in rough fracture and natural sandstone chen et al 2018 bakhshian et al 2019 4 conclusions the fluid fluid immiscible displacement in the 3d porous media was experimentally studied herein using micro ct an unconsolidated packed bed with glass beads was chosen as the porous media seven fluid pairs were selected as the defending and invading phases to provide a wide range of viscosity ratio ranging from logm 4 to 2 including favorable and unfavorable displacements the invading phase was injected to displace the initial saturated defending phase under different flow rates and the capillary number ranged from logca 8 to 2 the displacement patterns at the breakthrough time and the invasion dynamic during the drainage process were visualized the main findings in this study include 1 all 35 displacement patterns obtained at the breakthrough time were mapped on a ca m diagram including unfavorable logm 0 and favorable displacement logm 0 three typical displacement patterns namely viscous fingering capillary fingering and stable displacement were observed in 3d porous media the rough location of three displacement patterns was consistent with previous studies in 2d micromodel viscous fingering was observed at high ca and low m and capillary fingering occurred at low ca condition at a high ca and m the compact displacement is referred to as stable displacement 2 the corresponding saturation distribution for different patterns was also mapped on a ca m diagram with the increase in the capillary number the saturation of the invading phase decreases for unfavorable displacement and increases for favorable displacement based on the quantitative analyses of the saturation distribution as a function of ca and m the boundaries for three regimes namely viscous fingering capillary fingering and stable displacement were determined we then for the first time proposed a phase diagram for 3d porous media describing the displacement patterns as a function of capillary number and viscosity ratio compared to zhang et al s result in 2d micromodel zhang et al 2011 a broader transition zone between the viscous fingering capillary fingering and stable displacement was found in 3d porous media 3 the characterization of finger structures e g fractal dimension and finger width were carried out to reveal how the displacing fluid invades the pores and throats inside porous media for different displacement patterns the average fractal dimension of capillary fingering is 2 58 0 05 which is in reasonable agreement with 2 55 defined by the invasion percolation ip theory this indicates that ip theory can be used to describe the invasion process of capillary fingering in 3d porous media the finger width increases from viscous fingering 1 2 pore bodies to capillary fingering 6 7 pore bodies reflecting that the invasion process is more controlled by capillary forces than viscous forces 4 the invasion dynamic during the drainage process from a pore scale view was illuminated for typical viscous and capillary fingering under a continuous injection condition the saturation of the invading phase continues to increase after breakthrough for viscous fingering but remains stable for capillary fingering the experimental observation reveals that new pores and throats would be invaded by the subsequent flow and formed several flow paths for viscous fingering at a low ca capillary fingering the subsequent fluid would only flow along the previous flow path once the breakthrough occurred credit authorship contribution statement yingxue hu investigation writing original draft anindityo patmonoaji writing review editing chunwei zhang investigation data curation tetsuya suekane conceptualization supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment this work was supported by the jsps kakenhi with grand numbers 17h00790 y x hu also acknowledges the fellowship support from the china scholarship council 201806280029 for study at tokyo institute of technology supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103584 appendix supplementary materials image application 1 
491,the immiscible fluid displacement pattern controlled by the balance of viscous and capillary forces has a significant effect on the recovery or storage efficiency in subsurface processes the phase diagram of displacement patterns has been extensively studied for the two dimensional 2d micromodel however that of the three dimensional 3d porous media has received little attention this work experimentally studied the immiscible drainage displacement in an unconsolidated packed bed at the pore scale with a wide range of capillary number ca and viscosity ratio m using x ray micro tomography three typical displacement patterns namely viscous fingering capillary fingering and stable displacement were observed in 3d porous media the rough location of three displacement patterns on the ca m diagram was consistent with previous studies in 2d micromodel the boundaries for three regimes were determined based on the quantitative analyses of the saturation distribution as functions of ca and m compared with the result in 2d micromodel a broader transition zone between different regimes was found in 3d porous media the characterizations of finger structures e g fractal dimension and finger width were applied to reveal the mechanism of how the injected fluid invades the pores and throats inside porous media for different displacement patterns the average fractal dimension of capillary fingerings was 2 58 0 05 which agrees with the 2 55 defined by the invasion percolation theory for the viscous fingering where the viscous force dominates the invasion process the invading fluid follows a several preferential flow paths in the same direction as the injection and the finger width was only 1 to 2 pore bodies besides the invasion dynamics under continuous injection conditions were compared for typical viscous and capillary fingerings this study may improve our understanding of the dynamics of displacement processes jointly governed by the viscous capillary forces in 3d porous media furthermore the phase diagram under various conditions i e a wide range of ca and m can help to find a suitable reservoir conditions for subsurface processes keywords displacement patterns phase diagram porous media drainage micro tomography 1 introduction the immiscible fluid fluid displacement in porous media is of great importance in many natural and technological processes including geological carbon sequestration shaffer 2010 hosseini and nicot 2012 soltanian et al 2017 bakhshian and sahimi 2017 enhanced oil recovery iglauer et al 2013 simjoo et al 2013 and remediation of non aqueous phase liquids porter et al 2010 nambi and powers 2000 when a lower viscosity fluid is injected to displace a higher viscosity fluid the displacement patterns of the two fluid interphases always presents a non compact structure that affects the recovery or storage efficiency wang et al 2013 nobakht et al 2007 therefore qualitative and quantitative analyses on the displacement patterns in porous media are therefore essential for optimizing subsurface processes extensive work has been implemented in the literature to investigate the immiscible displacement in porous media according to the pioneering work of lenormand et al lenormand et al 1988 in two dimensional 2d micromodels the fluid fluid displacement is governed by the competition of viscous and capillary forces the effect of these forces on displacement processes can be characterized by the two most important parameters the capillary number ca μ i vi σ where μ i vi and σ are the viscosity velocity of invading phase and the interfacial tension respectively and the viscosity ratio m μ i μ d where μ d is the viscosity of the defending phase experimental and numerical results in the pore network were mapped on a phase diagram with three typical displacement patterns namely viscous fingering capillary fingering and stable displacement where the axes are the capillary number ca and the viscosity ratio m similar works were supplemented to improve the accuracy of the phase diagram with a micromodel experiment and a numerical simulation zhang et al 2011 liu et al 2013 in addition to micromodel chen et al 2017 2018 experimentally investigated the two flow in rough fractured media and proposed a full phase diagram from unfavorable logm 0 to favorable displacement logm 0 conditions although many other reservoir parameters including interfacial tension surface roughness wettability and heterogeneity of media also play a significant role on the displacement patterns zhao et al 2016 hu et al 2017 hu et al 2017 jiang et al 2014 wang et al 2018 the phase diagram proposed by lenormand et al 1988 and zhang et al 2011 generally provides researchers a pithily and reliable reference to define immiscible fluid fluid displacement patterns in 2d porous media in these literatures lenormand et al 1988 zhang et al 2011 liu et al 2013 chen et al 2017 chen et al 2018 zhao et al 2016 hu et al 2017 hu et al 2017 the two dimensional micromodel was treated as the porous media to directly observe the dynamic behavior of the invading fluid where only the viscous and capillary forces were considered however the situation will become more complex in three dimensional 3d porous media such as natural sandstones and packed beds in 3d porous media when the density difference of the invading and defending fluid is large the buoyancy force has a significant effect on the displacement processes wilkinson 1984 berkowitz and ewing 1998 muharrik et al 2018 bolster et al 2011 the inherent pore structures e g pore size distribution and connectivity are influenced by the system dimension which further affect the fluid behaviors in porous media the penetration process is mainly controlled by the pore size and pore connectivity for two fluids of immiscible displacement the displacement efficiency in the heterogeneous pore networks is lower than in the homogeneous one this is because heterogeneity weakens the displacement stability liu et al 2015 the mechanism of immiscible fluid displacement process for a highly heterogeneous 3d porous media have not been fully understood the numerical methods such as lattice boltzmann method lbm smoothed particle hydrodynamics sph and finite volume method fvm provide a high temporal and spatial resolution to investigate the pore scale events such as haines jumps snap off and pore filling events hu et al 2017 zacharoudiou and boek 2016 bandara et al 2013 many researchers have recently applied the numerical method to simulate the immiscible fluid displacement process in digital rocks yamabe et al 2015 tsuji et al 2016 zacharoudiou et al 2018 bakhshian et al 2019 tsuji et al 2016 performed a series of simulations on the two phase fluid displacement patterns in a three dimensional natural sandstone under various reservoir conditions stable displacement was not observed in the 3d porous media while it could be found in the 2d homogeneous model under the same condition this may have resulted from the pore connectivity and a higher coordination number in of 3d system however the computation source limits the scale of porous media to hundreds of microns which are even far smaller than the laboratory scale for a model with a length of 1 2 mm sometimes the calculation must be terminated in advance to save the computing resources tsuji et al 2016 from literatures on immiscible displacement in 3d porous media yamabe et al 2015 tsuji et al 2016 zacharoudiou et al 2018 bakhshian et al 2019 the capillary number and the viscosity ratio only reached a relatively small range compared with the laboratory experiments e g logm 4 7 2 9 in lenormand et al s work lenormand et al 1988 thus it is of paramount importance to study the immiscible fluid fluid displacement patterns of the 3d porous media with a broad range of ca and m besides most researches conducted on the 3d drainage process were on numerical simulation yamabe et al 2015 tsuji et al 2016 zacharoudiou et al 2018 bakhshian et al 2019 and few experimental studies have been reported in the last decades non intrusive measurement techniques such as confocal microscopy magnetic resonance imaging and x ray ct micro tomography micro ct have been applied to investigate the multiphase flow in 3d porous media pore scale visualization of gas trapping zhou et al 2011 zhou et al 2010 scanziani et al 2018 gas dissolution exsolution patmonoaji and suekane 2017 zuo et al 2017 jiang et al 2019 and immiscible fluid fluid displacements berg et al 2013 provided a novel insight to investigate the multiphase flow and extended the understanding of the multiphase flow mechanism inside the porous media this study presents a series of immiscible fluid fluid displacement experiments in 3d packed beds with a wide range of capillary numbers and viscosity ratios using the high resolution micro ct for the drainage displacement the porous media is initially saturated with a wetting phase then displaced by a non wetting phase different displacement patterns including viscous fingering capillary fingering and stable displacement are identified based on the displacement process for the first time these patterns are mapped on the phase diagram logca logm for 3d porous media including the unfavorable logm 0 and favorable logm 0 displacements to quantify the boundaries for different regimes the effect of the displacement patterns on the saturation of the invading phase was estimated the result is expected to improve the accuracy of the phase diagram for the drainage displacement process in 3d porous media the finger structure morphology such as the fractal dimension and the finger width is quantitatively analyzed based on the high resolution obtained images furthermore the invasion dynamic of the invading phase for the typical viscous fingering and capillary fingering is recorded the result can help reveal the mechanism of the invasion process with different displacement patterns which affects the displacement efficiency in the enhanced oil recovery and the storage efficiency in the geological carbon sequestration 2 material and methods 2 1 porous media an unconsolidated packed bed was chosen as a porous medium for the drainage displacements glass beads fabricated with soda lime glass have an oil wet surface bz 04 as one inc japan the typical diameters of the particle pore and throat are 400 µm 300 µm and 100 µm respectively fig 1 the permeability of the porous media was measured by a water flooding experiment k 1 4 10 10 m2 as expected k 4 5 10 10 m2 estimated by the kozeny carman relation the same glass beads washed with toluene ethanol and then water to remove the coating were used as the water wet porous medium for the favorable displacement setiawan et al 2014 the packed bed was assembled by pouring the particles into an acrylic resin cylinder with an inner diameter of 10 mm over a height of 16 mm fig 2 during particle pouring the cylinder was kept shaken to make the packed bed more compact tiny glass beads were packed near the inner tube forming a low permeable layer with the thickness of a 0 4 mm to avoid the invading fluid from preferably passing through near the tube wall two 1 mm thick sintered glass filters were placed at the bottom and top of the packed bed which not only can provide a uniform fluid distribution but also support the unconsolidated structure the sintered glass filters with low permeability will lead to a large flow residence and limit the injection flow rates for the high viscosity conditions thus for the highest viscosity oil case the sintered glass filter was replaced by multilayers of particles with different diameters ranging from 4 mm to 0 6 mm 2 2 fluid pairs water and silicone oil were chosen as the fluid pairs to investigate the immiscible fluid fluid displacement in the porous media silicone oil is available with a broad range of viscosity from 0 65 10 6 to 1 0 m2 s depending on the polymer length barca et al 2014 five kinds of silicone oil were selected herein kf 0 65 kf 10 kf 100 kf 1 000 and kf 10 000 shin etsu chemical co ltd the corresponding density ranged from 760 to 975 kg m3 to eliminate the buoyancy effect a proportionate of tetrachloroethylene pce was mixed with the silicone oil to match the density of water 1 iododecane was added to the silicone oil to enhance the contrast with water during the micro ct scan table 1 presents the mass fraction of the three components and the mixture density the largest density difference between water and mixture is 40 kg m3 corresponding to bo 1 18 10 3 bo gl 2δρ σ where g is the gravitational acceleration l is the characteristic pore size δρ is the fluid density difference and σ is the interfacial tension the buoyancy effect on the displacement patterns could be ignored in this study deionized water and five kinds of mixtures were selected with viscosity ratio ranging seven orders of magnitude table 2 presents the physical properties of these fluid pairs 2 3 experimental process prior to each experiment the sample was placed into the vacuum chamber forming the initial situation that the packed bed was completely saturated by the defending phase the outlet of the sample was blocked up and the inlet was immersed in the defending phase fluid the vacuum chamber valve was opened after no bubble could be observed in the defending phase fluid for 10 min the pressure difference between inside and outside the sample pushed the fluid into the pore before the invading fluid was introduced through the inlet the packed bed saturation was carefully checked according to the ct images the atmospheric pressure was not enough to overcome the entry pressure and the initial saturation cannot reach 100 when the silicone oil viscosity is larger than 1 0 10 3 m2 s in this case a relatively high injection flow rate was applied to saturate the packed bed the invading fluid was upwardly injected with a syringe pump ic3100 kd scientific inc and the corresponding capillary number varied from logca 8 to logca 2 at high ca condition a breakthrough occurs after a very short injection time it is hard to catch the 3d images of breakthrough time under continuous injection conditions due to the limitation in our micro tomography thus a discontinuous injection method was implemented where an interval volume fluid was injected then stopped and scanned the process was repeated until the invading phase reached the outlet and this is referred as the breakthrough time in some cases the injection process was continued after breakthrough to investigate the invasion dynamics of the typical viscous and capillary fingerings under continuous flow condition the saturation of the invading fluid increases until reaches a steady state which is referred to as the equilibrium state 2 4 image processing micro tomography with a micro ct scanxmate rb090ss comscantechno co ltd was used to visualize the fluid morphology during the displacement process each scan captured 1000 images along a 360 rotation in approximately 125 s enabling the production of a 3d image of the packed bed with an image resolution of 992 992 992 voxels 16 491 µm pixel all images were collected after the invading phase was injected this image resolution corresponds to 16 36 16 36 16 36 mm3 which is enough to capture the whole packed bed region the same x ray intensity 8 12 w i 116 µa v 70 kv was used for all the experiments the packed bed sample remained vertical during the scanning while the x ray source and detector rotated horizontally the raw images were filtered to remove the noise and preserve the edges using a non local means filter buades et al 2011 a simple gray scale segmentation algorithm according to the 2d histogram was used in this case the simple segmentation method was enough to separate the solid phase and fluid phases because the particle shape was regular after being filtered the pore and the solid were first separated and the threshold value was set to match the porosity measured with the weighing method ε 0 37 the watershed algorithm was used to define the individual pore and particle patmonoaji et al 2020 the diameter of the pores and the particles were then described by way of the equivalent sphere diameter with the same volume fig 1 presents detailed information on the packed bed including the probability density function of the pore throat and particle accurately segmenting the two fluid phases from the pore space was quite difficult especially when the image resolution was not very high andrew 2014 the gray value in the acquired images increased from water silicone oil to particles because of the difference absorption of x ray a pseudo interface was found between the particles and the water like the oil film covering the particles andrew 2014 the captured images resolution 16 491 µm pixel was not enough to observe the thin oil film 1 µm krummel et al 2013 thus the pseudo interface was treated as water using the followed procedure an automated calculated threshold value was introduced to separate the water and oil phases in imagej programs nih image the water and particle regions were then dilated twice following a boolean intersection and the pseudo interface was obtained the boolean result was added to the primary water region after that the particle image was taken as a reference to remove overvaluation using a boolean subtraction the saturation of the invading phase was measured from these images obtained then the spatial structure reconstructed from images stack was applied to estimate the fractal dimension and the finger width the detailed estimation method will be discussed in sections 3 1 3 and 3 1 4 3 results and discussion 3 1 characterization of the displacement patterns at breakthrough time 3 1 1 displacement patterns fig 3 shows the visualization of the displacement patterns at breakthrough time for a wide range of capillary number and viscosity ratio including favorable and unfavorable displacements the capillary number decreased from the top row to the down row with seven orders of magnitude logca ranges from 8 to 2 and the viscosity ratio increased from the left column to the right column with seven orders of magnitude logm ranges from 4 to 2 three typical displacement patterns namely viscous fingering capillary fingering and stable displacement were observed viscous fingering the displacement of the defending phase by the invading phase is widely recognized to exhibit viscous fingering under high ca and low m condition because of the competition between the capillary and viscous forces in the regime of vicious fingering upper left in fig 3 the thin fingers followed a number of preferential flow path in the same direction as the injection and no backward movement to note many invading phase discrete ganglions were observed at the lowest viscosity ratio logm 4 with a relatively high capillary number logca 6 5 and 4 the snap off event during drainage process leads to these discrete ganglions which can also be found in 3d simulation and experimental results yamabe et al 2015 li et al 2009 the behavior of viscous fingering is principally controlled by viscous forces due to the viscosity of the defending phase lenormand et al 1988 when the velocity of the invading phase is high the front of the displacement advances very fast and soon reaches the outlet thus the saturation of viscous fingering is usually lower than capillary fingering and stable displacement as shown in fig 4 capillary fingering in the regime of capillary fingering bottom in fig 3 the injected non wetting fluid invaded not only along the outlet but also to radial direction and even the inlet direction the flow paths merged to a main stout finger hence the invading phase saturation was higher at low ca the viscous forces are negligible in both the defending and the invading fluid and the principal force is due to capillarity the invasion process of the capillary fingering can be described with the invasion percolation theory dias and wilkinson 1986 the invading fluid only passed through the largest throat where the capillary entry pressure was the lowest thus the average throat size invaded by the invading phase for capillary fingering was larger than that for viscous fingering this also contributed to the higher invading phase saturation for capillary fingering stable displacement in the regime of stable displacement upper right in fig 3 the defending phase was almost completely displaced by the invading phase however the near outlet presented some irregularities at high ca and high m the principal force is due to the viscosity of the invading fluid the stable displacement occurs at the unfavorable condition logm 0 where the lower viscosity defending fluid is displaced by a higher viscosity fluid during the invasion process of the invading phase some unstable fingers occurred at the main flow front these fingers would be overtaken by the subsequent main flow since the fingers have a lower pressure than the main flow front zhang et al 2011 therefore the stable displacement with compact structure usually has a very high saturation e g 94 at logca 2 logm 2 3 1 2 saturation and phase diagram fig 4a shows the saturation distribution of the invading phase on the diagram of ca and m generally the invading phase saturation at breakthrough time increase from viscous fingering to capillary fingering then to stable displacement to quantify the boundaries of the three regimes in ca m diagram we estimated the effect of the three displacement patterns on the saturation at breakthrough time fig 4b shows the effect of the viscosity ratio on the invading phase saturation which can be used to distinguish the boundaries from viscous fingering to stable displacement lines a and b fig 5 the saturation curve as a function of the viscosity ratio consisting of two plateaus and a sharply growing middle segment qualitatively agrees with the simulation result proposed by lenormand et al 1988 the two plateaus represent two distinct regimes the viscous fingering with low saturation and close stable displacement with high saturation an increasing stage with a constant slope occurred from logm 2 to 0 2 for a high ca condition i e logca 4 and 5 indicating a transition zone from viscous fingering to close stable displacement lines a and b fig 5 fig s 4c and d depict the effect of the capillary number on the invading phase saturation for unfavorable logm 0 and favorable displacements logm 0 respectively the non wetting phase saturation generally decreased with the increasing capillary number for the unfavorable displacement reflecting a transition zone from viscous fingering to capillary fingering but increased for the favorable displacement reflecting a transition zone from capillary fingering to stable displacement from the green dotted line in fig 4c at logm 2 the curve consists of two plateaus and a descending segment the two plateaus represent two distinct regimes the capillary fingering with high saturation and viscous fingering with low saturation a decreasing stage with a constant slope occurred from logca 7 to 5 indicating a transition zone from capillary fingering to viscous fingering lines e and f fig 5 for the two lowest m i e logm 3 and 4 only one plateau with low saturation exists at high ca condition which represents the viscous fingering regime to note the capillary number of decrement stage remains in two orders of magnitude it indicates that the width of the transition zone is stable about 2 orders of magnitude under different m conditions for the higher value of m i e logm 1 the invading phase saturation changes slightly from logca 8 to 6 indicating a capillary fingering regime line d fig 5 as shown in fig 4d the invading phase saturation increases with the capillary number under favorable displacement at low ca the invading phase saturation ranges from 30 to 60 which is higher than 20 of the viscous fingering when the capillary number increase the role of viscous forces of displacing fluid become more important therefore the invading phase saturation increases with the increase in the capillary from logca 6 to 3 which is referred to as a transition zone from capillary fingering to stable displacement lines d and c fig 5 at a high ca i e logca 3 and 2 the invading phase saturation is close to 90 suggesting that stable displacements have taken place and only near outlet has some irregularities the boundaries of the three displacement regimes on the phase diagram for 3d unconsolidated porous media were determined based on the 35 experimental results as shown in fig 5 the shape of the three regimes was similar with the result obtained in the 2d periodic homogenous pore model lenormand et al 1988 zhang et al 2011 two parallel lines e and f with a slop of 1 represent the boundaries of the transition zone from viscous fingering to capillary fingering this indicates that the displacement process in 3d porous media is also controlled by the competition between the viscous forces and the capillary forces lenormand et al 1988 however the locations of these boundaries are different from the 2d micromodel experiment results zhang et al 2011 a broader transition zone between any two regimes could be found in 3d heterogeneous porous media the heterogeneity primarily contributes to the observed differences as shown in fig 1b the pore and throat size distributions in the 3d porous media show a very wide range where the multiple displacement patterns easily occurred simultaneously chen et al 2017 liu et al 2015 the system dimension affects the inherent connectivity of porous media the coordination number of the pore is 4 and 4 6 for the 2d homogenous micromodel zhang et al 2011 and the 3d packed bed respectively in a highly connected porous media the fingers easily merge with adjacent fingers and show a multiple displacement pattern as shown in fig 3 even for viscous fingering the thin finger is connected with the neighboring one at some pores 3 1 3 fractal dimension the observation in fig 3 shows that the finger structure exhibits complex spatial distribution for three typical displacement patterns to estimate the complexity of finger structures the fractal dimension was introduced using the standard box counting method li et al 2009 the 3d structure of the invading phase was separated into several parts based on the size of the box s each box was verified for the presence or absence of a displacing fluid the data of the number of boxes that contained the displacing fluid n s and the length of boxes 1 s were used to calculate the fractal dimension as shown in fig 6 a the estimate slop of lnn s ln1 s is the fractal dimension value fig 6b d depict the effects of the capillary number and the viscosity ratio on the fractal number of the invading phase including the favorable and unfavorable displacements the curves of the fractal dimension as a function of ca and m show a similar tendency with the curves of the invading phase saturation the fractal dimension increases from viscous fingering to capillary fingering and a transition zone exists between them six cases were selected as the typical capillary fingering inside of the capillary fingering regime in fig 5 the average fractal dimensions for the six typical capillary fingerings equaled 2 58 0 05 the value was in a reasonable agreement with the value of 2 55 in the simulation results when invasion percolation theory was considered dias and wilkinson 1986 for the lowest viscosity ratio logm 4 the fractal dimensions of the viscous fingering which were very close to 2 00 were 2 05 and 2 07 for the capillary numbers of logca 4 and logca 5 in the extreme condition lower m and higher ca the viscous fingering structures could be looser and corresponding lower fractal dimension the lower limit of fractal dimension predicted by the diffusion limited cluster aggregation dlca is 1 80 eggersdorfer et al 2011 mandelbrot 1983 the single pore filled by the invading phase was treated as the cluster in the dlca method 3 1 4 finger width the finger width is a more relevant distinguishing feature for different displacement patterns e g viscous fingering and capillary fingering stokes et al 1986 løvoll et al 2004 when viscous fingering occurs loosely connected or disconnected flow paths progress forward toward the outlet it is difficult to directly measure the width of a three dimensional finger due to its complex spatial structure here we presented a statistical averaging method to estimate the finger width of these 3d fingerings firstly the fingering structure was divided into several parts n along the vertical direction as shown inset in fig 7 n 4 then the 3d object count method was applied to detect all individual objects which were treated as the cross sectional of a finger the information of these objects including volume v height h and numbering j was stored in a matrix each object was assumed as a cylinder of diameter d and the value of d could be calculated by dj 4 π vj hj 1 2 after a volume weighted average was used to estimate the average diameter d v j d j v j finally the average diameter was divided by the pore diameter dpore to get the dimensionless finger width w fig 7 shows two different trends of w as a function of n for the viscous fingering logm 3 logca 5 and capillary fingering logm 3 logca 7 for viscous fingering the average finger width is uniform and equals to the single flow path width the average width does not change with the increasing n and each object has the same finger width for capillary fingering the average finger width decreases rapidly n 20 and then tends to be constant at low n the average finger width is overestimated due to the interconnected flow path the height of each part decreases with increasing n when the height is smaller than the size of trapped blobs a single flow path without trapped blobs are detected the average width of this single flow path is selected to evaluate the finger width of capillary fingering the effective finger width w for each displacement pattern was defined by further averaging the average finger width w between n 20 and 30 trojer et al 2015 fig 8 presents the effective finger width w as a function of the capillary number and viscosity ratio as shown in fig 8a with the increase in the capillary number the effective finger width slightly decreases from 2 to 1 75 at logm 3 although a transition from capillary fingering to capillary fingering is expected the effective finger width remains at a small value under all condition the capillary fingering still presents some features of viscous fingering under low m condition at a fixed capillary number logca 6 the effective finger width changes significantly with the increase in capillary number from 2 to 7 it indicates that the displacement patterns changes from viscous fingering to capillary fingering which qualitatively agrees with the prediction of phase diagram generally the effective finger of viscous fingering is 1 2 pore bodies while capillary fingering is 6 7 pore bodies 3 2 invasion dynamic of the invading phase fig 9 presents the growth behavior of the invading phase logm 3 to gain an insight into how the competition between the capillary and viscous forces affects the invasion dynamic the displacement pattern in the middle v v br 1 00 represents the breakthrough time when the invading phase first reached the top of the porous media according to the phase diagram in fig 4 with the capillary number of ca 1 0 10 4 and 1 0 10 8 the displacement patterns indicate typical viscous and capillary fingering respectively the invading phase invasion processes are mainly controlled by the viscous force for viscous fingering fig 9a before the breakthrough thin figures with 1 2 pore bodies followed a number of preferential flow paths along the injection direction tsuji et al 2016 ferer et al 2004 the invading phase rapidly grew at the front position while the bulk of the invading fluid at the near inlet area grew forward with a relatively lower speed after the main flow reached to the outlet of the porous medium its structure remained stable and other fingers at the front of the bulk fluid shown an accelerate growth as shown in fig 10 a the saturation of invading phase increased rapidly at the front than that at the bottom after breakthrough decreasing four orders of magnitude of the capillary number to ca 1 0 10 8 the capillary forces overpassed the viscous forces and controlled the invasion dynamic in drainage process the iconic backward structure of the invading phase and the defending phase trapping occurred during the whole invasion process before the breakthrough time v v br 1 0 the main finger front was not strictly grow along the injection direction fig 9b a lot of invasion processes were also observed at the bulk fluid bottom region once the invading phase reached the outlet continue to inject no new fingers could be observed either at the front or at the bottom as shown in fig 10b the invading phase saturation profiles almost fixed after breakthrough v v br 1 0 except slight different at the bottom compared with that at breakthrough time v v br 1 0 for the capillary fingering the imposed pressure was not sufficient to invade new throats and pores after breakthrough therefore the fluid could only flowed through the formed displacement pathways and the invading phase saturation remained constant it indicated that the displacement efficiency cannot be further improved by injecting excessive volume of invading phase for capillary fingering conditions fig 4c shows that the displacement efficiency at the breakthrough time increased with the decreasing the injection flow rate thereby agreeing with the previous numerical results lenormand et al 1988 tsuji et al 2016 however a reverse trend could be found at the equilibrium state zhang et al 2011 the invasion dynamics of the invading phase provides an explanation as to this phenomenon after the breakthrough time the invading phase saturation continued to linearly increase with the injection volume for the high capillary number cases fig s 11 a b meanwhile no further increase was observed at the low flow rate condition fig 11e thus si of the viscous fingering will be larger than that of the capillary fingering at the same viscosity ratio when the displacement pattern achieves an equilibrium state the difference between δ s i b r at the breakthrough time and s i e q at the equilibrium state was measured to classify the displacement patterns i e δ s i s i e q δ s i b r fig 11 illustrates that the δsi value is larger than 13 for the viscous fingering but is almost equal to zero for the capillary fingering at the transition zone the invading phase saturation linearly increased with the injection volume after the breakthrough and then trended to a constant value fig s 11c d subsequently δsi roughly increased with the increasing of capillary number which can also be found in rough fracture and natural sandstone chen et al 2018 bakhshian et al 2019 4 conclusions the fluid fluid immiscible displacement in the 3d porous media was experimentally studied herein using micro ct an unconsolidated packed bed with glass beads was chosen as the porous media seven fluid pairs were selected as the defending and invading phases to provide a wide range of viscosity ratio ranging from logm 4 to 2 including favorable and unfavorable displacements the invading phase was injected to displace the initial saturated defending phase under different flow rates and the capillary number ranged from logca 8 to 2 the displacement patterns at the breakthrough time and the invasion dynamic during the drainage process were visualized the main findings in this study include 1 all 35 displacement patterns obtained at the breakthrough time were mapped on a ca m diagram including unfavorable logm 0 and favorable displacement logm 0 three typical displacement patterns namely viscous fingering capillary fingering and stable displacement were observed in 3d porous media the rough location of three displacement patterns was consistent with previous studies in 2d micromodel viscous fingering was observed at high ca and low m and capillary fingering occurred at low ca condition at a high ca and m the compact displacement is referred to as stable displacement 2 the corresponding saturation distribution for different patterns was also mapped on a ca m diagram with the increase in the capillary number the saturation of the invading phase decreases for unfavorable displacement and increases for favorable displacement based on the quantitative analyses of the saturation distribution as a function of ca and m the boundaries for three regimes namely viscous fingering capillary fingering and stable displacement were determined we then for the first time proposed a phase diagram for 3d porous media describing the displacement patterns as a function of capillary number and viscosity ratio compared to zhang et al s result in 2d micromodel zhang et al 2011 a broader transition zone between the viscous fingering capillary fingering and stable displacement was found in 3d porous media 3 the characterization of finger structures e g fractal dimension and finger width were carried out to reveal how the displacing fluid invades the pores and throats inside porous media for different displacement patterns the average fractal dimension of capillary fingering is 2 58 0 05 which is in reasonable agreement with 2 55 defined by the invasion percolation ip theory this indicates that ip theory can be used to describe the invasion process of capillary fingering in 3d porous media the finger width increases from viscous fingering 1 2 pore bodies to capillary fingering 6 7 pore bodies reflecting that the invasion process is more controlled by capillary forces than viscous forces 4 the invasion dynamic during the drainage process from a pore scale view was illuminated for typical viscous and capillary fingering under a continuous injection condition the saturation of the invading phase continues to increase after breakthrough for viscous fingering but remains stable for capillary fingering the experimental observation reveals that new pores and throats would be invaded by the subsequent flow and formed several flow paths for viscous fingering at a low ca capillary fingering the subsequent fluid would only flow along the previous flow path once the breakthrough occurred credit authorship contribution statement yingxue hu investigation writing original draft anindityo patmonoaji writing review editing chunwei zhang investigation data curation tetsuya suekane conceptualization supervision declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgment this work was supported by the jsps kakenhi with grand numbers 17h00790 y x hu also acknowledges the fellowship support from the china scholarship council 201806280029 for study at tokyo institute of technology supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2020 103584 appendix supplementary materials image application 1 
492,in the present work a novel dot ader numerical solver capable of handling porosity and bottom discontinuities in the framework of the 1d porous shallow water equations swes is presented in order to ensure the preservation of the water at rest condition a new set of well balanced governing equations based on the isotropic porosity parameter is derived the effects exerted by the bed slope and porosity variation source terms are accurately accounted for inside the riemann solver to this purpose an augmented riemann problem is created by adding two fictitious equations stating the invariance of porosity and bottom in time to the swes system with the aim of computing the non conservative fluxes which in the augmented system replace the original source terms meanwhile ensuring robustness stability and accuracy a novel approximate numerical scheme based on the entropy satisfying dot family is introduced the extension of the novel riemann solver which strictly conserves mass to a second order of accuracy in both space and time is addressed in the ader framework the fulfillment of the c property condition i e the exact preservation of an initial quiescent flow in the presence of a discontinuous porosity field and over a non flat bottom with abrupt variation is theoretically proved and numerically verified the capability of the proposed numerical scheme to simulate some riemann problems developing across porosity discontinuities and bed steps is finally assessed keywords shallow water equations with porosity augmented riemann problems dot ader porosity discontinuity bed step 1 introduction the modeling of flooding events in urban areas represents a crucial task dealing with hazard and risk assessment in this framework the shallow water equations swes with porosity are a promising tool to account for the effects exerted by buildings without impacting on the mesh resolution and hence on the computational times in fact the storage isotropic porosity is defined as the volume fraction of the urban area available for mass and momentum storage defina et al 1994 firstly introduced this concept in the swes to deal with partially dry areas since then several differential isotropic formulations have been presented in order to consider both the reduced storage and the additional resistances that buildings exert on the flow guinot and soares frazão 2006 soares frazão et al 2008 cea and vázquez cendón 2010 finaud guyot et al 2010 benkhaldoun et al 2016 ferrari et al 2017 velickovic et al 2017 cozzolino et al 2018 ferrari et al 2019 viero 2019 other works derived the equations in integral form and adopted additionally to the storage porosity a conveyance parameter to account for the connectivity of the urban medium sanders et al 2008 özgen et al 2016a özgen et al 2016b bruwier et al 2017 guinot et al 2017 guinot et al 2018 since porosity schemes aim at simulating flood events on real urban layouts beyond the formulation derivation and the chosen porosity parameter the free surface modeling has to ensure a stable treatment of discontinuities that are commonly present in porous fields and bathymetries an accurate way to fix this issue is to account for the effects of the source terms inside the riemann solver creating an augmented riemann problem where the variables appearing in the source terms are added to the list of the conserved variables and the source terms are substituted by non conservative fluxes in this framework some works focused on the bed slope source term bernetti et al 2008 george 2008 murillo and garcía navarro 2010 rosatti and begnudelli 2010 cozzolino et al 2011 murillo and garcía navarro 2012 navas montilla and murillo 2015 caleffi et al 2016 among others with regard to the treatment of the porosity source term by means of augmented riemann problems benkhaldoun et al 2016 proposed a nonhomogeneous solver based on a predictor corrector procedure for unstructured triangular grids whereas ferrari et al 2017 derived an augmented 2d roe solver capable of handling porous abrupt variations on cartesian grids the scheme of ferrari et al 2017 was developed according to some physical assumptions concerning the porosity variation and neglecting the bottom reaction moreover dealing with a roe scheme an entropy fix procedure was required furthermore that scheme did not exactly preserve the condition of quiescent flow as the adopted governing equations did not inherently guarantee this condition and finally it was limited to first order of accuracy this paper aims at deriving in a 1d framework a novel high order approximate riemann solver capable of treating porous and bottom jumps meanwhile ensuring the exact preservation of the water at rest condition to this purpose a new set of well balanced governing equations based on the isotropic porosity parameter is derived and an augmented riemann solver is created to solve these non conservative equations a novel numerical solver based on the path conservative dot dumbser and toro 2011 scheme is developed in order to obtain a robust general and entropy satisfying approximate riemann solver capable of treating the non conservative products due to porosity discontinuities and bed steps without requiring computationally expensive entropy fix procedure typical of the roe based ones the numerical scheme is then extended to second order following the ader approach toro et al 2001 titarev and toro 2002 toro and titarev 2002 the reminder of the paper is organized as follows in section 2 the new set of the well balanced governing equations is derived section 3 is dedicated to the augmented riemann problem definition and to the study of its eigenstructure the first order dot numerical solver is described in section 4 meanwhile the extension to the second order in the framework of the ader approach is described in section 5 in section 6 the exact preservation of the water at rest condition is theoretically proved and numerically verified then the dot ader solver is applied to test the order of convergence and to simulate some riemann problems developing across porosity discontinuities and bed steps in section 7 finally the conclusions of the work and insights into the future developments are outlined in section 8 2 governing equations in this work the original formulation of the 2d swes with a single storage porosity parameter guinot and soares frazão 2006 is considered assuming a frictionless bed and neglecting the head loss terms due to obstructions in a 1d framework the governing equations written in conservation form become 1 ϕ h t ϕ u h x 0 ϕ u h t x ϕ u 2 h 1 2 g ϕ h 2 1 2 g h 2 ϕ x g ϕ h z x where h represents the water depth ϕ the porosity u the velocity g the gravitational acceleration and z the bottom elevation the source terms at the right hand of the momentum equation represent the reaction due to the porosity variation first term and to the bed slope second term respectively with the aim of obtaining a well balanced scheme and following the idea originally proposed by liang and borthwick 2009 for the classical swes the water depth h in system 1 is substituted by the water surface elevation η recalling that η h z 2 ϕ η z t ϕ u h x 0 ϕ u h t x ϕ u 2 h 1 2 g ϕ η 2 2 η z z 2 1 2 g h 2 ϕ x g ϕ h z x then considering both porosity and bottom variables constant in time after simple manipulations the new set of the governing equations results 3 ϕ η t ϕ u h x 0 ϕ u h t x ϕ u 2 h 1 2 g ϕ η 2 2 η z 1 2 g η 2 2 η z ϕ x g ϕ η z x as will be theoretically proved and numerically verified in section 6 system 3 guarantees the c property i e the exact preservation of the water at rest condition 3 the mathematical model with the aim of taking into account the effects of both porosity and bed elevation discontinuities inside the riemann solver ϕ and z are considered as additional fictitious conserved variables as the original idea of leroux 1998 for the bed slope term this means that two equations stating the invariance of porosity and bed elevation in time are added to system 3 resulting in the following augmented riemann problem written in compact form 4 u t f x h u x 0 where the vectors of the conserved variables u and of the fluxes f and the matrix of the non conservative fluxes h originated by the non conservative products whose presence deserves special attention abgrall and karni 2010 are defined as 5 u ϕ η ϕ u h ϕ z f ϕ u h ϕ u 2 h 1 2 g ϕ η 2 2 η z 0 0 h 0 0 0 0 0 0 1 2 g η 2 2 η z g ϕ η 0 0 0 0 0 0 0 0 the definition of the generalized riemann problem in system 4 implies that the original source terms now influence the eigenstructure of the problem particularly the eigenvalues and eigenvectors of the 1d porous swes in eq 1 which correspond to those of the classical swes guinot and soares frazão 2006 may not coincide with those of system 4 in order to study the eigenstructure of the augmented problem system 4 is rewritten in the following quasi linear form 6 u t a u x 0 where the matrix a represents the sum of the jacobian matrix of the flux vector f and the non conservative one h 7 a d f d u h 0 1 0 0 g h u 2 2 u u 2 z g η 2 g η z u 2 ϕ 0 0 0 0 0 0 0 0 the computation of the roots of the characteristic polynomial a λ i 0 toro 2001 allows for the definition of the following eigenvalues λ 1 λ 2 λ 3 and λ 4 8 λ 1 u g h λ 2 0 λ 3 0 λ 4 u g h since the eigenvalues are real and distinct the augmented system 4 is hyperbolic even if not stricly hyperbolic the characteristic fields λ 1 and λ 4 which correspond to those of the swes without porosity are genuinely non linear and they are associated with rarefactions and shocks while λ 2 and λ 3 are linearly degenerate and they are associated with contact waves once the eigenvalues are defined the right eigenvectors are calculated according to the relation ar λ r toro 2001 that associates a given eigenvector r to each eigenvalue λ of matrix a thus the set of the right eigenvectors results 9 r 1 1 u g h 0 0 r 2 u 2 z g η 2 g η z g h u 2 0 1 0 r 3 u 2 ϕ g h u 2 0 0 1 r 4 1 u g h 0 0 4 the dot riemann solver following the formalism of path conservative schemes dal maso et al 1995 parés 2006 castro et al 2007 dumbser and toro 2011 extended the osher solomon riemann solver osher and solomon 1982 to non conservative hyperbolic systems leading to the dot riemann solver which is robust complete and entropy satisfiying in the framework of finite volume schemes the spatial and temporal integration of eq 6 in the control volume x i 1 2 x i 1 2 t n t n 1 leads to the following formula for updating the solution to next time step parés 2006 castro et al 2006 canestrelli et al 2009 stecca et al 2016 10 u i n 1 u i n 1 δ x t n t n 1 x i 1 2 x i 1 2 a u i x u i d x d t δ t δ x d i 1 2 d i 1 2 where i denotes the considered cell n the current time level tn u i n and u i n 1 the cell averaged values of the conserved variable at time tn and t n 1 respectively δx the cell size and δt the time step in a first order scheme the integral term in eq 10 vanishes since constant cell averaged values are assumed x u i 0 and the values at the cell interfaces correspond to the cell averaged values u i 1 2 u i 1 n u i 1 2 u i n the fluctuations jump terms d i 1 2 d i 1 2 which depend on the discontinuous values at the cell interface are computed in the dot riemann solver as dumbser and toro 2011 11 d i 1 2 1 2 0 1 a ψ s a ψ s ψ s d s where the matrix a is defined according to eq 7 and the matrix absolute value a is evaluated as 12 a r λ r 1 λ d i a g λ 1 λ 2 λ 3 λ 4 with r the matrix of the right eigenvectors of a r 1 its inverse and λ the diagonal matrix of the eigenvalues absolute values the matrices a and a are evaluated along the path ψ s that is a lipschitz continuous function connecting the left u i 1 2 and right u i 1 2 states at the interface i 1 2 in phase space particularly the conserved variables appearing in matrices a and a are defined in the interval s 0 1 according to the following linear relation 13 ψ s u i 1 2 s u i 1 2 u i 1 2 once ψ s and then the matrices a and a are evaluated the jump terms in eq 11 are computed by means of a g point gauss legendre quadrature rule dumbser and toro 2011 with positions sj and weights ωj in the interval 0 1 recalling that ψ s u i 1 2 u i 1 2 the approximated formula of eq 11 becomes 14 d i 1 2 1 2 j 1 g ω j a ψ s j a ψ s j u i 1 2 u i 1 2 in this work a three point gauss legendre quadrature with the following positions and weights is adopted 15 s 1 5 15 10 s 2 1 2 s 3 5 15 10 ω 1 5 18 ω 2 8 18 ω 3 5 18 apart from the dot scheme the velocity variable u which is derived from the updated conserved variables as u ϕ u h ϕ η ϕ z is here corrected in order to avoid the division by very small water depths as follows kurganov and petrova 2007 16 u 2 h u h h 4 m a x h 4 ε where ε is a small threshold ε δ x 4 the water depth and the specific discharge to be used in eq 16 are evaluated as h ϕ η ϕ z and u h ϕ u h ϕ respectively finally it is noteworthy that the absence of source terms in the set of the augmented governing equations eq 4 and the adoption of a finite volume scheme automatically ensures the mass conservation hirsch 2007 5 extension to high order the ader scheme the numerical scheme in eq 10 is extended to a second order of accuracy in both space and time by adopting the ader approach toro et al 2001 titarev and toro 2002 toro and titarev 2002 the core of this technique is to use a space time taylor series expansion and a cauchy kowalewski procedure in order to solve high order riemann problems at the element boundaries stecca et al 2016 particularly the ader framework allows for the extension to high order in a one step by adopting a temporal evolution of the spatial reconstructed polynomial present in each cell reconstruction the first step of the ader approach is to compute a piecewise linear reconstruction polynomial p i of the conserved variables for each cell since a k order accurate scheme requires a k 1 degree polynomial a linear data reconstruction is sufficient for a second order accurate scheme moreover in order to avoid the occurrence of spurious oscillations near discontinuous solutions a total variation diminishing tvd scheme is considered tvd schemes are frequently used for a second order of accuracy therefore the following first order degree polynomial is adopted 17 p i x u i n δ i x x i where δ i is the limited reconstruction slope defined as toro 2013 18 δ i ξ i δ i δ x with ξi and δ i denoting the slope limiter and the slope vector respectively this last term is evaluated as follows toro 2013 19 δ i 1 2 1 γ δ i 1 2 1 2 1 γ δ i 1 2 with δ i 1 2 u i n u i 1 n δ i 1 2 u i 1 n u i n and γ is a free parameter in the interval 1 1 in this work γ 1 was adopted and thus δ i δ i 1 2 among the different formulations available for the slope limiter computation toro 2013 the van leer type slope limiter is here adopted toro 2013 20 ξ r 0 r 0 min 2 r 1 r ξ r r r 0 where terms r and ξr r are defined as 21 r δ i 1 2 δ i 1 2 ξ r r 2 β 1 γ 1 γ r β 2 1 c f l with cfl the courant friedrichs lewy number space time taylor series expansion the space time evolution of each non oscillatory polynomial previously reconstructed at time tn is calculated according to the following first order taylor series expansion with respect to the barycentre xi 22 u i x t u i n x x i x u t t n t u the time derivative in eq 22 is calculated as a function of space derivative adopting the cauchy kowaleski procedure that allows 23 t u a x u therefore by substituting eq 23 in 22 the taylor series expansion results 24 u i x t u i n x x i x u a t t n x u finally the variables expanded at each cell interfaces are evaluated by replacing the spatial derivatives in eq 24 with the derivative of the reconstruction polynomial eq 17 25 u i 1 2 u i x i 1 2 t n 1 2 u i n δ x i δ t a 1 2 δ i u i 1 2 u i 1 x i 1 2 t n 1 2 u i 1 n δ x i δ t a 1 2 δ i update of the conserved variables dealing with the high order extension of a numerical scheme that solves a non conservative set of governing equations the integral term in the explicit update formula 10 cannot be neglected due to the presence of a not constant value inside each cell therefore the space time integral is approximated with a gauss quadrature lee et al 2013 26 1 δ x t n t n 1 x i 1 2 x i 1 2 a u i x u i dxdt δ t δ x j 1 g ω j a ψ u i 1 2 u i 1 2 s j u i 1 2 u i 1 2 the taylor expansion previously described allows for the knowledge of the interface values in eq 25 that are then adopted to compute the integral term in eq 26 and the fluctuations in eq 14 finally these quantities are introduced in the explicit formula in eq 10 and the update of the solution to the next time step is performed 6 c property the fulfillment of the c property with a non uniform porosity field and over a non flat bottom is assessed in this section firstly the water at rest condition is proved by showing that in this case the fluctuations in eq 14 are null assuming a one point gauss legendre quadrature with weight ω 1 and position s 0 5 and recalling that u i 1 2 u i 1 2 0 and η i 1 2 η i 1 2 η the path in eq 13 results 27 ψ 0 5 1 2 η ϕ i 1 2 ϕ i 1 2 0 1 2 ϕ i 1 2 ϕ i 1 2 1 2 z i 1 2 z i 1 2 η ϕ 0 ϕ z the conserved variables resulted from eq 27 which for sake of clarity have been marked with the overline symbol are then used to compute the matrices a and a particularly the water surface elevation is evaluated from eq 27 as η η ϕ ϕ and the water depth as h η z therefore the matrices a and a are evaluated from eqs 7 and 12 respectively considering null velocity and substituting the path values of eq 27 28 a 0 1 0 0 g h 0 g η 2 g η z 0 0 0 0 0 0 0 0 0 a g h 0 η g h 0 0 g h 0 0 0 0 0 0 0 0 0 0 finally the fluctuations d i 1 2 and d i 1 2 become 29 d i 1 2 1 2 a ψ s a ψ s u i 1 2 u i 1 2 1 2 g h 1 η g h 0 g h g h g η 2 g η z 0 0 0 0 0 0 0 0 0 η ϕ i 1 2 ϕ i 1 2 0 ϕ i 1 2 ϕ i 1 2 z i 1 2 z i 1 2 0 0 0 0 30 d i 1 2 1 2 a ψ s a ψ s u i 1 2 u i 1 2 1 2 g h 1 η g h 0 g h g h g η 2 g η z 0 0 0 0 0 0 0 0 0 η ϕ i 1 2 ϕ i 1 2 0 ϕ i 1 2 ϕ i 1 2 z i 1 2 z i 1 2 0 0 0 0 after having proved that the jump terms are null and hence the derived dot riemann solver theoretically guaranties the quiescent flow condition the exact c property preservation is numerically verified following xing and shu 2005 the bottom topography z is described in the range 0 x 10 by both a smooth function 31 z x 5 e 2 5 x 5 2 and a discontinuos function 32 z x 4 4 x 8 0 o t h e r w i s e as initial condition of the two bottom configurations a constant free surface elevation η z h 10 m is assumed the domain is discretized with n 500 computational cells and the solution is computed until t 0 5 s additionally the original test case has been here modified by including a variable porosity field in order to test the presence of discontinuities a random porosity field in the range 0 1 is considered the setup of these tests is shown in fig 1 a and b for the smooth and discontinuous bottom respectively the presence of wet and dry interfaces has been also tested by considering the smooth bottom and a free surface elevation η 3 m fig 1c for both water surface elevation and specific discharge variables the l 1 and l error norms were computed in order to quantify the misfit between the numerical and the exact initial solution table 1 shows that the c property is exactly preserved up to the machine precision 7 numerical results in this section the order of accuracy is firstly verified and then the numerical model is validated performing some riemann problems characterized by bottom or porosity discontinuities 7 1 convergence the second order of accuracy of the implemented numerical scheme is verified by performing the following quasi stationary test leveque 1998 where the bottom topography fig 2 presents a bump that is described as 33 z x 0 25 cos 10 π x 1 5 1 i f 1 4 x 1 6 0 o t h e r w i s e at the beginning of the test the flow is at rest with the water surface elevation shown in fig 2 and described as 34 η x 1 2 i f 1 1 x 1 2 1 o t h e r w i s e the simulation is carried on until time t 0 2 s when the water pulse travelling downstream has already overstepped the bump at this time the water surface elevation and the specific discharge are as shown in fig 3 a and b respectively as numerical reference solution for testing the order of accuracy a very fine mesh discretizing the domain with n 3200 cells was adopted meanwhile the remaining simulations were performed with coarser meshes from n 100 up to n 800 cells in fig 3 the reference solution and the one obtained with n 200 cells are shown no spurious oscillations arise thus confirming that the proposed scheme is capable of accurately reproducing the perturbation of a quiescent state over a smooth bottom the error norms l 1 and l 2 computed for both water surface elevation and specific discharge and reported in table 2 confirm that the scheme guarantees a second order of accuracy 7 2 riemann problems the capability of the proposed numerical scheme to reproduce some riemann problems characterized by discontinuities is investigated in this section the exact solutions used to compare the numerical results are obtained by means of the exact riemann solvers ad hoc derived to treat porosity ferrari et al 2017 and bottom rosatti and begnudelli 2010 discontinuities respectively in all the tests the domain is 100 m long and discretized with n 600 cells and the discontinuity in the initial values is located at x 50 m in order to test different wave configurations the initial conditions reported in table 3 are considered the first test rarefaction porosity shock rps is a stoker riemann problem which at t 0 presents still water with different depths at both sides of x 50 m where a porosity discontinuity is located the dam break generates a left rarefaction propagating to the left of the porous discontinuity a stationary step at x 50 m and a shock wave at the right fig 4 shows that the numerical results obtained with both first and second order accurate schemes well agree with the exact solution both for water depth and velocity in the second riemann problem rarefaction porosity rarefaction rpr two rarefactions origin from the discontinuity one left moving and the other right going the comparison showed in fig 5 highlights that the numerical scheme well captures the wave pattern and the intermediate state values of this divergent flow as pointed out in the introduction one of the main advantages of the dot riemann solver is to be entropy satisfying that means that it does not require any special procedure e g the solution of non linear system of equations in the roe solvers to ensure the lax entropy condition also in the presence of transonic rarefactions therefore the third riemann problem rarefaction rarefaction porosity rarefaction rrpr concerns the passage through the critical state at the discontinuity location two rarefactions depart at the left of the middle contact wave one left going and the other right facing meanwhile at the right of the discontinuity a right rarefaction develops the numerical model is capable of capturing the wave configurations even if the right intermediate state of this severe test is slightly underestimated fig 6 in the following the numerical model is tested considering at x 50 m a bottom step instead of a porous discontinuity this bed step generates the three wave configurations previously described figs 7 9 display the results at time t 1 s for the rarefaction bottom shock rbs rarefaction bottom rarefaction rbr and rarefaction rarefaction bottom rarefaction rrbr test respectively in all the tests the numerical model well agree with the exact solver the contact wave across which the bed elevation varies is captured as well as the wave pattern and the intermediate values the last tested configuration rb presents a still column of water collapsing on a dry bed step at right fig 10 compares the numerical solution at time t 0 4 s with the exact solution presented in han and warnecke 2014 both order of accuracy well reproduce the rarefaction wave travelling at the left side of the step and the dry bed state at right as expected the results of the second order scheme better approximate the wave on the dry bed fig 10b 8 conclusions and future work this work focused on the derivation of a new well balanced numerical scheme capable of treating discontinuities in the framework of the shallow water equations with porosity to this purpose an augmented riemann solver accounting for both porosity and bottom non conservative products has been introduced and its eigenstructure has been studied moreover an entropy satisfying dot riemann solver which strictly conserves mass has been developed and the numerical scheme has been then extended to high order in the ader framework as confirmed by the convergence analysis a second order of accuracy based on the tvd reconstruction has been achieved and higher order can be addressed in the future as theoretically and numerically verified the numerical model preserves the exact c property over a non flat bottom and with a discontinuous porosity field finally the numerical model has been validated against a selection of riemann problems including also transonic waves and wet and dry fronts the investigation of the influence of the integration path on the numerical solver caleffi and valiani 2017 the extension of the 1d proposed numerical model to two dimensions and the application to real test cases are left to future works declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors are grateful to the editor and the reviewers for their valuable suggestions 
492,in the present work a novel dot ader numerical solver capable of handling porosity and bottom discontinuities in the framework of the 1d porous shallow water equations swes is presented in order to ensure the preservation of the water at rest condition a new set of well balanced governing equations based on the isotropic porosity parameter is derived the effects exerted by the bed slope and porosity variation source terms are accurately accounted for inside the riemann solver to this purpose an augmented riemann problem is created by adding two fictitious equations stating the invariance of porosity and bottom in time to the swes system with the aim of computing the non conservative fluxes which in the augmented system replace the original source terms meanwhile ensuring robustness stability and accuracy a novel approximate numerical scheme based on the entropy satisfying dot family is introduced the extension of the novel riemann solver which strictly conserves mass to a second order of accuracy in both space and time is addressed in the ader framework the fulfillment of the c property condition i e the exact preservation of an initial quiescent flow in the presence of a discontinuous porosity field and over a non flat bottom with abrupt variation is theoretically proved and numerically verified the capability of the proposed numerical scheme to simulate some riemann problems developing across porosity discontinuities and bed steps is finally assessed keywords shallow water equations with porosity augmented riemann problems dot ader porosity discontinuity bed step 1 introduction the modeling of flooding events in urban areas represents a crucial task dealing with hazard and risk assessment in this framework the shallow water equations swes with porosity are a promising tool to account for the effects exerted by buildings without impacting on the mesh resolution and hence on the computational times in fact the storage isotropic porosity is defined as the volume fraction of the urban area available for mass and momentum storage defina et al 1994 firstly introduced this concept in the swes to deal with partially dry areas since then several differential isotropic formulations have been presented in order to consider both the reduced storage and the additional resistances that buildings exert on the flow guinot and soares frazão 2006 soares frazão et al 2008 cea and vázquez cendón 2010 finaud guyot et al 2010 benkhaldoun et al 2016 ferrari et al 2017 velickovic et al 2017 cozzolino et al 2018 ferrari et al 2019 viero 2019 other works derived the equations in integral form and adopted additionally to the storage porosity a conveyance parameter to account for the connectivity of the urban medium sanders et al 2008 özgen et al 2016a özgen et al 2016b bruwier et al 2017 guinot et al 2017 guinot et al 2018 since porosity schemes aim at simulating flood events on real urban layouts beyond the formulation derivation and the chosen porosity parameter the free surface modeling has to ensure a stable treatment of discontinuities that are commonly present in porous fields and bathymetries an accurate way to fix this issue is to account for the effects of the source terms inside the riemann solver creating an augmented riemann problem where the variables appearing in the source terms are added to the list of the conserved variables and the source terms are substituted by non conservative fluxes in this framework some works focused on the bed slope source term bernetti et al 2008 george 2008 murillo and garcía navarro 2010 rosatti and begnudelli 2010 cozzolino et al 2011 murillo and garcía navarro 2012 navas montilla and murillo 2015 caleffi et al 2016 among others with regard to the treatment of the porosity source term by means of augmented riemann problems benkhaldoun et al 2016 proposed a nonhomogeneous solver based on a predictor corrector procedure for unstructured triangular grids whereas ferrari et al 2017 derived an augmented 2d roe solver capable of handling porous abrupt variations on cartesian grids the scheme of ferrari et al 2017 was developed according to some physical assumptions concerning the porosity variation and neglecting the bottom reaction moreover dealing with a roe scheme an entropy fix procedure was required furthermore that scheme did not exactly preserve the condition of quiescent flow as the adopted governing equations did not inherently guarantee this condition and finally it was limited to first order of accuracy this paper aims at deriving in a 1d framework a novel high order approximate riemann solver capable of treating porous and bottom jumps meanwhile ensuring the exact preservation of the water at rest condition to this purpose a new set of well balanced governing equations based on the isotropic porosity parameter is derived and an augmented riemann solver is created to solve these non conservative equations a novel numerical solver based on the path conservative dot dumbser and toro 2011 scheme is developed in order to obtain a robust general and entropy satisfying approximate riemann solver capable of treating the non conservative products due to porosity discontinuities and bed steps without requiring computationally expensive entropy fix procedure typical of the roe based ones the numerical scheme is then extended to second order following the ader approach toro et al 2001 titarev and toro 2002 toro and titarev 2002 the reminder of the paper is organized as follows in section 2 the new set of the well balanced governing equations is derived section 3 is dedicated to the augmented riemann problem definition and to the study of its eigenstructure the first order dot numerical solver is described in section 4 meanwhile the extension to the second order in the framework of the ader approach is described in section 5 in section 6 the exact preservation of the water at rest condition is theoretically proved and numerically verified then the dot ader solver is applied to test the order of convergence and to simulate some riemann problems developing across porosity discontinuities and bed steps in section 7 finally the conclusions of the work and insights into the future developments are outlined in section 8 2 governing equations in this work the original formulation of the 2d swes with a single storage porosity parameter guinot and soares frazão 2006 is considered assuming a frictionless bed and neglecting the head loss terms due to obstructions in a 1d framework the governing equations written in conservation form become 1 ϕ h t ϕ u h x 0 ϕ u h t x ϕ u 2 h 1 2 g ϕ h 2 1 2 g h 2 ϕ x g ϕ h z x where h represents the water depth ϕ the porosity u the velocity g the gravitational acceleration and z the bottom elevation the source terms at the right hand of the momentum equation represent the reaction due to the porosity variation first term and to the bed slope second term respectively with the aim of obtaining a well balanced scheme and following the idea originally proposed by liang and borthwick 2009 for the classical swes the water depth h in system 1 is substituted by the water surface elevation η recalling that η h z 2 ϕ η z t ϕ u h x 0 ϕ u h t x ϕ u 2 h 1 2 g ϕ η 2 2 η z z 2 1 2 g h 2 ϕ x g ϕ h z x then considering both porosity and bottom variables constant in time after simple manipulations the new set of the governing equations results 3 ϕ η t ϕ u h x 0 ϕ u h t x ϕ u 2 h 1 2 g ϕ η 2 2 η z 1 2 g η 2 2 η z ϕ x g ϕ η z x as will be theoretically proved and numerically verified in section 6 system 3 guarantees the c property i e the exact preservation of the water at rest condition 3 the mathematical model with the aim of taking into account the effects of both porosity and bed elevation discontinuities inside the riemann solver ϕ and z are considered as additional fictitious conserved variables as the original idea of leroux 1998 for the bed slope term this means that two equations stating the invariance of porosity and bed elevation in time are added to system 3 resulting in the following augmented riemann problem written in compact form 4 u t f x h u x 0 where the vectors of the conserved variables u and of the fluxes f and the matrix of the non conservative fluxes h originated by the non conservative products whose presence deserves special attention abgrall and karni 2010 are defined as 5 u ϕ η ϕ u h ϕ z f ϕ u h ϕ u 2 h 1 2 g ϕ η 2 2 η z 0 0 h 0 0 0 0 0 0 1 2 g η 2 2 η z g ϕ η 0 0 0 0 0 0 0 0 the definition of the generalized riemann problem in system 4 implies that the original source terms now influence the eigenstructure of the problem particularly the eigenvalues and eigenvectors of the 1d porous swes in eq 1 which correspond to those of the classical swes guinot and soares frazão 2006 may not coincide with those of system 4 in order to study the eigenstructure of the augmented problem system 4 is rewritten in the following quasi linear form 6 u t a u x 0 where the matrix a represents the sum of the jacobian matrix of the flux vector f and the non conservative one h 7 a d f d u h 0 1 0 0 g h u 2 2 u u 2 z g η 2 g η z u 2 ϕ 0 0 0 0 0 0 0 0 the computation of the roots of the characteristic polynomial a λ i 0 toro 2001 allows for the definition of the following eigenvalues λ 1 λ 2 λ 3 and λ 4 8 λ 1 u g h λ 2 0 λ 3 0 λ 4 u g h since the eigenvalues are real and distinct the augmented system 4 is hyperbolic even if not stricly hyperbolic the characteristic fields λ 1 and λ 4 which correspond to those of the swes without porosity are genuinely non linear and they are associated with rarefactions and shocks while λ 2 and λ 3 are linearly degenerate and they are associated with contact waves once the eigenvalues are defined the right eigenvectors are calculated according to the relation ar λ r toro 2001 that associates a given eigenvector r to each eigenvalue λ of matrix a thus the set of the right eigenvectors results 9 r 1 1 u g h 0 0 r 2 u 2 z g η 2 g η z g h u 2 0 1 0 r 3 u 2 ϕ g h u 2 0 0 1 r 4 1 u g h 0 0 4 the dot riemann solver following the formalism of path conservative schemes dal maso et al 1995 parés 2006 castro et al 2007 dumbser and toro 2011 extended the osher solomon riemann solver osher and solomon 1982 to non conservative hyperbolic systems leading to the dot riemann solver which is robust complete and entropy satisfiying in the framework of finite volume schemes the spatial and temporal integration of eq 6 in the control volume x i 1 2 x i 1 2 t n t n 1 leads to the following formula for updating the solution to next time step parés 2006 castro et al 2006 canestrelli et al 2009 stecca et al 2016 10 u i n 1 u i n 1 δ x t n t n 1 x i 1 2 x i 1 2 a u i x u i d x d t δ t δ x d i 1 2 d i 1 2 where i denotes the considered cell n the current time level tn u i n and u i n 1 the cell averaged values of the conserved variable at time tn and t n 1 respectively δx the cell size and δt the time step in a first order scheme the integral term in eq 10 vanishes since constant cell averaged values are assumed x u i 0 and the values at the cell interfaces correspond to the cell averaged values u i 1 2 u i 1 n u i 1 2 u i n the fluctuations jump terms d i 1 2 d i 1 2 which depend on the discontinuous values at the cell interface are computed in the dot riemann solver as dumbser and toro 2011 11 d i 1 2 1 2 0 1 a ψ s a ψ s ψ s d s where the matrix a is defined according to eq 7 and the matrix absolute value a is evaluated as 12 a r λ r 1 λ d i a g λ 1 λ 2 λ 3 λ 4 with r the matrix of the right eigenvectors of a r 1 its inverse and λ the diagonal matrix of the eigenvalues absolute values the matrices a and a are evaluated along the path ψ s that is a lipschitz continuous function connecting the left u i 1 2 and right u i 1 2 states at the interface i 1 2 in phase space particularly the conserved variables appearing in matrices a and a are defined in the interval s 0 1 according to the following linear relation 13 ψ s u i 1 2 s u i 1 2 u i 1 2 once ψ s and then the matrices a and a are evaluated the jump terms in eq 11 are computed by means of a g point gauss legendre quadrature rule dumbser and toro 2011 with positions sj and weights ωj in the interval 0 1 recalling that ψ s u i 1 2 u i 1 2 the approximated formula of eq 11 becomes 14 d i 1 2 1 2 j 1 g ω j a ψ s j a ψ s j u i 1 2 u i 1 2 in this work a three point gauss legendre quadrature with the following positions and weights is adopted 15 s 1 5 15 10 s 2 1 2 s 3 5 15 10 ω 1 5 18 ω 2 8 18 ω 3 5 18 apart from the dot scheme the velocity variable u which is derived from the updated conserved variables as u ϕ u h ϕ η ϕ z is here corrected in order to avoid the division by very small water depths as follows kurganov and petrova 2007 16 u 2 h u h h 4 m a x h 4 ε where ε is a small threshold ε δ x 4 the water depth and the specific discharge to be used in eq 16 are evaluated as h ϕ η ϕ z and u h ϕ u h ϕ respectively finally it is noteworthy that the absence of source terms in the set of the augmented governing equations eq 4 and the adoption of a finite volume scheme automatically ensures the mass conservation hirsch 2007 5 extension to high order the ader scheme the numerical scheme in eq 10 is extended to a second order of accuracy in both space and time by adopting the ader approach toro et al 2001 titarev and toro 2002 toro and titarev 2002 the core of this technique is to use a space time taylor series expansion and a cauchy kowalewski procedure in order to solve high order riemann problems at the element boundaries stecca et al 2016 particularly the ader framework allows for the extension to high order in a one step by adopting a temporal evolution of the spatial reconstructed polynomial present in each cell reconstruction the first step of the ader approach is to compute a piecewise linear reconstruction polynomial p i of the conserved variables for each cell since a k order accurate scheme requires a k 1 degree polynomial a linear data reconstruction is sufficient for a second order accurate scheme moreover in order to avoid the occurrence of spurious oscillations near discontinuous solutions a total variation diminishing tvd scheme is considered tvd schemes are frequently used for a second order of accuracy therefore the following first order degree polynomial is adopted 17 p i x u i n δ i x x i where δ i is the limited reconstruction slope defined as toro 2013 18 δ i ξ i δ i δ x with ξi and δ i denoting the slope limiter and the slope vector respectively this last term is evaluated as follows toro 2013 19 δ i 1 2 1 γ δ i 1 2 1 2 1 γ δ i 1 2 with δ i 1 2 u i n u i 1 n δ i 1 2 u i 1 n u i n and γ is a free parameter in the interval 1 1 in this work γ 1 was adopted and thus δ i δ i 1 2 among the different formulations available for the slope limiter computation toro 2013 the van leer type slope limiter is here adopted toro 2013 20 ξ r 0 r 0 min 2 r 1 r ξ r r r 0 where terms r and ξr r are defined as 21 r δ i 1 2 δ i 1 2 ξ r r 2 β 1 γ 1 γ r β 2 1 c f l with cfl the courant friedrichs lewy number space time taylor series expansion the space time evolution of each non oscillatory polynomial previously reconstructed at time tn is calculated according to the following first order taylor series expansion with respect to the barycentre xi 22 u i x t u i n x x i x u t t n t u the time derivative in eq 22 is calculated as a function of space derivative adopting the cauchy kowaleski procedure that allows 23 t u a x u therefore by substituting eq 23 in 22 the taylor series expansion results 24 u i x t u i n x x i x u a t t n x u finally the variables expanded at each cell interfaces are evaluated by replacing the spatial derivatives in eq 24 with the derivative of the reconstruction polynomial eq 17 25 u i 1 2 u i x i 1 2 t n 1 2 u i n δ x i δ t a 1 2 δ i u i 1 2 u i 1 x i 1 2 t n 1 2 u i 1 n δ x i δ t a 1 2 δ i update of the conserved variables dealing with the high order extension of a numerical scheme that solves a non conservative set of governing equations the integral term in the explicit update formula 10 cannot be neglected due to the presence of a not constant value inside each cell therefore the space time integral is approximated with a gauss quadrature lee et al 2013 26 1 δ x t n t n 1 x i 1 2 x i 1 2 a u i x u i dxdt δ t δ x j 1 g ω j a ψ u i 1 2 u i 1 2 s j u i 1 2 u i 1 2 the taylor expansion previously described allows for the knowledge of the interface values in eq 25 that are then adopted to compute the integral term in eq 26 and the fluctuations in eq 14 finally these quantities are introduced in the explicit formula in eq 10 and the update of the solution to the next time step is performed 6 c property the fulfillment of the c property with a non uniform porosity field and over a non flat bottom is assessed in this section firstly the water at rest condition is proved by showing that in this case the fluctuations in eq 14 are null assuming a one point gauss legendre quadrature with weight ω 1 and position s 0 5 and recalling that u i 1 2 u i 1 2 0 and η i 1 2 η i 1 2 η the path in eq 13 results 27 ψ 0 5 1 2 η ϕ i 1 2 ϕ i 1 2 0 1 2 ϕ i 1 2 ϕ i 1 2 1 2 z i 1 2 z i 1 2 η ϕ 0 ϕ z the conserved variables resulted from eq 27 which for sake of clarity have been marked with the overline symbol are then used to compute the matrices a and a particularly the water surface elevation is evaluated from eq 27 as η η ϕ ϕ and the water depth as h η z therefore the matrices a and a are evaluated from eqs 7 and 12 respectively considering null velocity and substituting the path values of eq 27 28 a 0 1 0 0 g h 0 g η 2 g η z 0 0 0 0 0 0 0 0 0 a g h 0 η g h 0 0 g h 0 0 0 0 0 0 0 0 0 0 finally the fluctuations d i 1 2 and d i 1 2 become 29 d i 1 2 1 2 a ψ s a ψ s u i 1 2 u i 1 2 1 2 g h 1 η g h 0 g h g h g η 2 g η z 0 0 0 0 0 0 0 0 0 η ϕ i 1 2 ϕ i 1 2 0 ϕ i 1 2 ϕ i 1 2 z i 1 2 z i 1 2 0 0 0 0 30 d i 1 2 1 2 a ψ s a ψ s u i 1 2 u i 1 2 1 2 g h 1 η g h 0 g h g h g η 2 g η z 0 0 0 0 0 0 0 0 0 η ϕ i 1 2 ϕ i 1 2 0 ϕ i 1 2 ϕ i 1 2 z i 1 2 z i 1 2 0 0 0 0 after having proved that the jump terms are null and hence the derived dot riemann solver theoretically guaranties the quiescent flow condition the exact c property preservation is numerically verified following xing and shu 2005 the bottom topography z is described in the range 0 x 10 by both a smooth function 31 z x 5 e 2 5 x 5 2 and a discontinuos function 32 z x 4 4 x 8 0 o t h e r w i s e as initial condition of the two bottom configurations a constant free surface elevation η z h 10 m is assumed the domain is discretized with n 500 computational cells and the solution is computed until t 0 5 s additionally the original test case has been here modified by including a variable porosity field in order to test the presence of discontinuities a random porosity field in the range 0 1 is considered the setup of these tests is shown in fig 1 a and b for the smooth and discontinuous bottom respectively the presence of wet and dry interfaces has been also tested by considering the smooth bottom and a free surface elevation η 3 m fig 1c for both water surface elevation and specific discharge variables the l 1 and l error norms were computed in order to quantify the misfit between the numerical and the exact initial solution table 1 shows that the c property is exactly preserved up to the machine precision 7 numerical results in this section the order of accuracy is firstly verified and then the numerical model is validated performing some riemann problems characterized by bottom or porosity discontinuities 7 1 convergence the second order of accuracy of the implemented numerical scheme is verified by performing the following quasi stationary test leveque 1998 where the bottom topography fig 2 presents a bump that is described as 33 z x 0 25 cos 10 π x 1 5 1 i f 1 4 x 1 6 0 o t h e r w i s e at the beginning of the test the flow is at rest with the water surface elevation shown in fig 2 and described as 34 η x 1 2 i f 1 1 x 1 2 1 o t h e r w i s e the simulation is carried on until time t 0 2 s when the water pulse travelling downstream has already overstepped the bump at this time the water surface elevation and the specific discharge are as shown in fig 3 a and b respectively as numerical reference solution for testing the order of accuracy a very fine mesh discretizing the domain with n 3200 cells was adopted meanwhile the remaining simulations were performed with coarser meshes from n 100 up to n 800 cells in fig 3 the reference solution and the one obtained with n 200 cells are shown no spurious oscillations arise thus confirming that the proposed scheme is capable of accurately reproducing the perturbation of a quiescent state over a smooth bottom the error norms l 1 and l 2 computed for both water surface elevation and specific discharge and reported in table 2 confirm that the scheme guarantees a second order of accuracy 7 2 riemann problems the capability of the proposed numerical scheme to reproduce some riemann problems characterized by discontinuities is investigated in this section the exact solutions used to compare the numerical results are obtained by means of the exact riemann solvers ad hoc derived to treat porosity ferrari et al 2017 and bottom rosatti and begnudelli 2010 discontinuities respectively in all the tests the domain is 100 m long and discretized with n 600 cells and the discontinuity in the initial values is located at x 50 m in order to test different wave configurations the initial conditions reported in table 3 are considered the first test rarefaction porosity shock rps is a stoker riemann problem which at t 0 presents still water with different depths at both sides of x 50 m where a porosity discontinuity is located the dam break generates a left rarefaction propagating to the left of the porous discontinuity a stationary step at x 50 m and a shock wave at the right fig 4 shows that the numerical results obtained with both first and second order accurate schemes well agree with the exact solution both for water depth and velocity in the second riemann problem rarefaction porosity rarefaction rpr two rarefactions origin from the discontinuity one left moving and the other right going the comparison showed in fig 5 highlights that the numerical scheme well captures the wave pattern and the intermediate state values of this divergent flow as pointed out in the introduction one of the main advantages of the dot riemann solver is to be entropy satisfying that means that it does not require any special procedure e g the solution of non linear system of equations in the roe solvers to ensure the lax entropy condition also in the presence of transonic rarefactions therefore the third riemann problem rarefaction rarefaction porosity rarefaction rrpr concerns the passage through the critical state at the discontinuity location two rarefactions depart at the left of the middle contact wave one left going and the other right facing meanwhile at the right of the discontinuity a right rarefaction develops the numerical model is capable of capturing the wave configurations even if the right intermediate state of this severe test is slightly underestimated fig 6 in the following the numerical model is tested considering at x 50 m a bottom step instead of a porous discontinuity this bed step generates the three wave configurations previously described figs 7 9 display the results at time t 1 s for the rarefaction bottom shock rbs rarefaction bottom rarefaction rbr and rarefaction rarefaction bottom rarefaction rrbr test respectively in all the tests the numerical model well agree with the exact solver the contact wave across which the bed elevation varies is captured as well as the wave pattern and the intermediate values the last tested configuration rb presents a still column of water collapsing on a dry bed step at right fig 10 compares the numerical solution at time t 0 4 s with the exact solution presented in han and warnecke 2014 both order of accuracy well reproduce the rarefaction wave travelling at the left side of the step and the dry bed state at right as expected the results of the second order scheme better approximate the wave on the dry bed fig 10b 8 conclusions and future work this work focused on the derivation of a new well balanced numerical scheme capable of treating discontinuities in the framework of the shallow water equations with porosity to this purpose an augmented riemann solver accounting for both porosity and bottom non conservative products has been introduced and its eigenstructure has been studied moreover an entropy satisfying dot riemann solver which strictly conserves mass has been developed and the numerical scheme has been then extended to high order in the ader framework as confirmed by the convergence analysis a second order of accuracy based on the tvd reconstruction has been achieved and higher order can be addressed in the future as theoretically and numerically verified the numerical model preserves the exact c property over a non flat bottom and with a discontinuous porosity field finally the numerical model has been validated against a selection of riemann problems including also transonic waves and wet and dry fronts the investigation of the influence of the integration path on the numerical solver caleffi and valiani 2017 the extension of the 1d proposed numerical model to two dimensions and the application to real test cases are left to future works declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments the authors are grateful to the editor and the reviewers for their valuable suggestions 
493,pore scale modeling is a rapidly evolving area of research because modeling multiphase flow directly on 3d pore geometries is of utmost importance in wide variety of research areas including oil and gas development hydrology and material sciences although there are numerous methods to model flow only so called pore network models are computationally effective enough to perform simulations in large modeling domains and they are orders of magnitude faster than direct modeling approaches however pore network models require a simplification of the 3d pore geometry to perform simulations which are usually referred to as pore network extraction such extraction poses a separate problem because it must provide an accurate description of the pore space geometry and topology different methods have been proposed in the literature recently watershed based approaches have been popular due to their effectiveness in working with porous media images of any porosity a watershed algorithm requires seed placement to segment the space into distinct pores we propose a hybrid algorithm combining the power of watersheds in finding intersections between pores with the advantages of the maximum inscribed ball technique which is very effective in finding pore centers we rigorously verify and test our novel methodology on artificial and x ray microtomography images of wide variety of porous materials sphere packings carbonate soil ceramic and sandstone samples comparison against a purely watershed based method and results based solely on the maximum inscribed balls based method in terms of pore throat total number pore size distributions and connection statistics and multiphase flow properties including capillary curves and relative permeabilities revealed the accuracy of our novel technique consistency with existing classical techniques and great potential in analysing 3d pore images of any complexity on the other hand comparison of extracted pore network topology as based on euler number revealed significant differences between different methodologies which is rather surprising considering the similarities in two phase flow properties while analysing permeability results we also compared two popular pore throat partitioning models and advocated in favor of the weight model usually utilized within watershed based extracted pore networks our results illuminate problems in current pore network models and outline some potential ways to improve their accuracy in future research keywords pore network extraction pore scale modeling stokes flow solver x ray micro tomography xmt pore to throat partitioning watershed maximum inscribed ball 1 introduction an exact description of pore scale flow physics is of great interest in numerous scientific and industrial fields petroleum engineering sahimi 2011 blunt 2017 hydrology helmig 1997 godinho et al 2016 gerke et al 2015a soil science gerke 2006 fuel cell development tranter et al 2017 and food engineering derossi et al 2019 to name just a few such pore level description is not only useful to understand what happens in the porous media under given flow boundary conditions but also allows us to optimize and design different aspects in real world applications upscale physical properties from pore to continuum scale and overcome some of the limitations typical of laboratory measurements in recent decades pore scale modeling techniques reached a development level enough to complement conventional core tests and measurements on undisturbed porous media samples this progress is partially a result of the significant advance in 3d structural information acquisition e g x ray computed tomography xct imaging wildenschild and sheppard 2013 cnudde and boone 2013 gerke et al 2012 stochastic reconstructions based on limited input data adler et al 1990 yeong and torquato 1998 thovert and adler 2011 jiao and chawla 2014 gerke et al 2014 gerke and karsanina 2015 karsanina and gerke 2018 or their combination li et al 2014 2017 pore scale simulations are a powerful addition to conventional measurements because they help to go beyond laboratory capabilities in numerous aspects and help in avoiding 1 measurement errors diamond 2000 čapek et al 2014 2 changes to the physical properties of samples by cracking self filtration and other processes dikinya et al 2008 zeinijahromi et al 2016 3 distortion by boundary effects duwig et al 2008 scheibe et al 2015 gerke et al 2019 4 difficulties to measure on irregular shapes or small sizes gerke et al 2013 2015b 5 inability to determine dynamic structure influences on permeability coppola et al 2012 6 limitations on measuring directional or tensorial dependencies renard et al 2001 guibert et al 2016 thibodeaux et al 2015 gerke et al 2018a 7 core sizes being smaller than the representative elemental volume rev moreover allows us to 8 work with synthetic digital images to solve porous media design issues karsanina et al 2015 xu et al 2017 9 apply any dynamic inflow and pressure boundary conditions 10 directly integrate pore scale simulations into darcian scale models sheng and thompson 2013 and incorporate geostatistics and uncertainty analysis for pore to continuum upscaling mariethoz and caers 2014 especially without distinct rev all aforementioned benefits justify that vast effort invested into pore scale techniques development observed over the last 20 years a great number of different computational methods exist to model single and multiphase fluid flow within heterogeneous pore spaces among the most popular are the 1 lattice boltzmann method khirevich et al 2015 dashtian et al 2019 bakhshian et al 2019 2 finite element finite volume and volume of fluid methods raeini et al 2012 bilger et al 2017 3 smoothed particle hydrodynamics holmes et al 2016 4 finite difference and laplace stokes equation solvers shabro et al 2012 gerke et al 2018b 5 level set bilger et al 2017 verma et al 2018 and 6 phase field method demianov et al 2011 rokhforouz and amiri 2017 however all these computational techniques to model laminar fluid flow are computationally intensive which limits the size of the pore network domain that can be evaluated to a very limited volume of usually up to 7003 voxels while the time needed with hpc resources easily reaches several weeks because of the need to work on as large as possible 3d pore geometries to capture the rev of a porous medium or to work on fused images resulting from a number of multiscale images for complex hierarchical porous samples such as carbonates bultreys et al 2015 gerke et al 2017 or soils karsanina et al 2015b karsanina et al 2018 in other words such direct pore scale modeling techniques are too computationally expensive to routinely process revs of real rock samples the only practical option is to utilize indirect modeling methods such as pore network models pnm fatt 1956a b c xiong et al 2016 which can actually be effectively parameterized using direct pore scale simulations by any method s from above miao et al 2017 raeini et al 2017 although pnms allow a very efficient computational framework to simulate single two and even three phase pereira et al 1996 van dijke and sorbie 2002 piri and blunt 2005 filtration one first needs to extract pore network representation from a 3d image of the porous medium under study a great variety of different pnm extraction methods have been proposed for a brief yet very informative overview see table 1 in the work of rabbani et al 2014 here we shall summarize only some key methodologies that motivated the study reported here the three classical approaches that work with 3d binary divided into pores and solids voxelized images include 1 median axis ma also called skeletonization based methods lindquist et al 2000 prodanović et al 2007 jiang et al 2007 2 maximum inscribed ball sphere mib method silin and patzek 2006 dong and blunt 2009 arand and hesser 2017 3 watershed based methods sheppard et al 2005 rabbani et al 2014 gostick 2017 bakhshian and hosseini 2019 a great number of recently published upgrades and hybrids e g yi et al 2017 miao et al 2017 raeini et al 2017 still utilize the classical methods or their combinations each methodology has its advantages and flaws watershed based methods are usually praised for robust throat cross section determination computational efficiency and ability to work with highly porous samples ideal extraction methodology would preserve topology of the pore space while at the same time finding an optimal trade off in geometry simplification to facilitate fast computations without loss in accuracy miao et al 2017 a number of studies pointed out that current pnms do not provide necessary accuracy comparable to direct voxel based simulations bondino et al 2013 miao et al 2017 in particular due to insufficient geometry topology preservation baychev et al 2019 for example current simulators are incapable of dealing explicitly with pores connected by more than one throat see an example of such case below thus improvements of pnm extraction techniques can be an important step towards creating better pnm simulators our current work was to a large extent inspired by the paper of gostick 2017 who presented a significantly improved version of the watershed methodology in particular the snow algorithm however we saw several disadvantages in his implementation especially in determining seeds for watershed growth of pore bodies technically watersheds are very efficient in finding pore to pore connections and in a way mimic fluid displacement within pore space sheppard et al 2005 but are very sensitive to initial seed placement the major problem is in choosing pore body positions from distance transform local maxima points rabbani et al 2014 and gostick 2017 utilize several additional procedures to improve seed localization e g maximum and gaussian blur filters of distance map transform of the pore space and removal of the saddle points such procedures require the choice of additional parameters and only partially solve the seed difficulty our novel hybrid method solves this issue inherent in classical watershed based methods in a robust and efficient manner the objective of this paper is to present a robust and still computationally efficient hybrid watershed and mib methodology to extract pnms from voxelized 3d pore geometries the idea behind our approach is simple the problem of pore body seed placement for watershed algorithm is solved by analysis of inscribed spheres moreover our solution renders saddle point maximum and gaussian blur filtering on distance maps obsolete we thoroughly verified our methodology on different porous media geometries and compared our results against other popular classic methods which included pore network geometrical pore throat size distributions topological coordination number distributions and euler numbers and multiphase flow properties capillary curves and relative permeabilities single phase permeabilities were compared against voxel based modeling approach 2 materials and methods 2 1 3d images of porous media and their preprocessing to verify and test the proposed methodology we extract pnms from a variety of porous media samples there are two types of 3d images we utilize for these purposes artificial sphere packings and real geometries of sandstone carbonate soil and ceramic obtained using xct imaging the former is good for verification because positions and parameters for pore bodies and pore throats in these packings can be determined analytically the latter is necessary to test the pnm extraction methodology on realistic natural geometries with wide variety of genesis and complexity real porous media samples were obtained using an xct bruker skyscan 1172 desktop device the details of carbonate and sandstone sample acquisition are given in miao et al 2017 for soil and ceramic samples these details are provided in karsanina et al 2018 and gerke et al 2015c respectively original stacks of images were subcropped to obtain a cubic domain of interest with the size of 500 7003 voxels to convert grey scale into binary images with distinguished pore and solid phases we utilized two conventional local segmentation techniques indicator kriging oh and lindquist 1999 and converging active contours sheppard et al 2004 as opposed to global segmentation approaches local methods require two thresholds for binarization which in our case were chosen manually based on trial and error segmentation attempts all image processing was performed using in house code developed by our group the binary structure of all natural samples utilized in this study is shown in fig 1 major 3d image characteristics are provided in table 1 the variety of samples is wide enough to cover different geological genesis e g sandstone and carbonate rocks studied in petrophysical applications soil as a regular object in soil sciences and hydrology and artificial porous media ceramic sample which are important for industrial applications moreover the porosity of the chosen sample collection varies between 5 and 37 thus providing a possibility to test the pnm extraction methodology on both tight and highly porous examples some of the published methods altered the original 3d pore geometry namely rabbani et al 2014 utilized different forms of the distance transform function computed from a binary image and arand and hesser 2017 developed this concept further and computed the distance transform on grey scale images on one hand this helps to work with distance map which is now much easier to filter and remove unnecessary seeds but works only under the assumption of binary composition of the sample under study on the other hand we believe that the 3d binary image should be taken as a ground truth pore geometry this will be true if for example a much better resolution will be achieved in the future with improved imaging technology or by other related methods karsanina and gerke 2018 because the proposed methodology effectively addresses the problem of seeds we avoided any alteration of pore solid interface geometry and our algorithms work exclusively with an as is input 3d binary image 2 2 details of the pnm extraction algorithm the pnm extraction is initiated by loading the 3d binary image into the ram memory the general framework can be divided into a number of well defined parts 1 distance map transform 2 building inscribed ball hierarchy using the precomputed distance map and placing pore bodies 3 dividing pore space into distinct pore volumes by applying watershed segmentation from seeds pore body centers 4 finding pore to pore intersections and parameterizing pore throats and 5 partitioning 3d pore space into pore bodies and pore throats with their characteristics relevant to future single multiphase flow simulations into a single pore network structure after completing these steps the resulting pnm can be visualized using the so called ball and stick diagram which is useful in observing pore network s topology and some geometry specifications e g pore body and pore throat sizes the general scheme of this framework and illustrations of the key algorithms are shown in fig 2 we now describe all involved procedures in more detail at first the 3d distance map is computed for all pore voxels closely following a recently published fast algorithm felzenszwalb and huttenloche 2012 as a result at each pore voxel we obtain a single float i e subvoxel resolution due to diagonal connections of voxels value representing its closest distance to the pore solid interface after the distance map is available we start inscribing maximum balls spheres at selected pore voxels the idea of mib and their hierarchy for pnm extraction was first proposed by silin and patzek 2006 and later improved by dong and blunt 2009 in their implementation the balls were found by inflation deflation at a given pore voxel as was noted later by numerous researchers e g yi et al 2017 raeini et al 2017 arand and hesser 2017 the distance map transform value itself provides a robust basis for ball inscribing i e provides local mib radii our definition of the mib thus is the same as in the work of arand and hesser 2017 we inscribe balls in selected pore voxels by first ranking all pore voxels by their distance transform value in descending order starting from the such a list we start inscribing and check if each next pore voxel within the list is already contained within the previously inscribed sphere while performing this step we somewhat loosen the condition of the inclusion compared to mib and methodology of arand and hesser 2017 by subtracting one voxel from each radius of the containing ball during this check this still speeds up mib positioning compared to their placement at each pore voxel silin and patzek 2006 but increases the sensitivity of ball placement see fig 3 in arand and hesser 2017 for a very nice graphical explanation of the concept by additional checking for possible constrictions between closer maximal balls after all mibs are placed they are clustered in a hierarchy in a manner closely following the original idea of masters and slaves by silin and patzek 2006 or ancestors and descendants by dong and blunt 2009 we start by sorting the list of inscribed balls in the radii descending order starting from the top of the list we check if the mib has intersections with balls of the same radii or larger all voxels serving as centers of the locally largest balls are marked as pore body centers if a master ancestor ball has an intersection with one or more balls of the same radii the proximity to their center of mass defines the leading ball that becomes the pore body center as the result of this part of the algorithm we marked the voxels that represent the centers of pore bodies we now utilize a marker based watershed algorithm six connectivity variation of barnes et al 2014 which uses pore body centers as seeds to separate pores from each other as a result we not only mark each pore volume in 3d but also obtain intersections between pores i e interfaces between watersheds representing separated pores this part of the algorithm is conventional and closely follows the works of rabbani et al 2014 and gostick 2017 the interfaces between each separated pore serve as good approximations for pore throat cross sections sheppard et al 2005 gostick 2017 however obtained this way most of the interfaces are not 2d plane faces and are generally represented by curved surfaces for example see fig 14 in rabbani et al 2014 to utilize the conventional circle triangle square c t s pnm flow modeling framework patzek and silin 2001 valvatne and blunt 2004 we approximate such curved surfaces with 2d planar surfaces to do so we first mark all unique pore to pore watershed connections with cantor s hash function unlike map in c or dictionary in python or julia hashing that uniquely relates two quantities cantor s hash function can reversibly and uniquely hash multiple positive integers with another integer which allows relating the identification numbers of two pores and a throat in between them if at any time during processing the watershed intersections a new pore to pore connection is observed it gets its own hash function assigned if the intersection is not unique the midpoint between voxels belonging to different pore watersheds is marked with an existing hash after all watershed intersections are processed this way we compute the area of the intersection and its inscribed radius next for each cloud of points representing midpoints of an intersection we create a projection to the plane which is found using the least squares method the resulting 2d projection is analyzed for the number of resulting pore space clusters the reason why the projection can be represented by separate pore clusters will be discussed later if the 2d plane of the watershed intersection is not a single pore cluster more than one throat between two pores as shown in fig 2 step 4 we combine two or more clusters into a single throat for each throat cross section obtained in this fashion we determine several important parameters area perimeter conventional shape factor computed as the ratio of area to perimeter squared and inscribed radius if the inscribed radius of the resulting 2d plane is larger than the maximum distance map value on the watershed interface the latter is used as the radius of the resulting throat finally we now partition each pore as the result of the watershed pore space segmentation into pore body and pore throat s according to two different approaches 1 the methodology of dong and blunt 2009 but originally proposed by oren et al 1998 which we shall call the α model and 2 the approach of sholokhova et al 2009 which will be referred to as the w model 2 3 pore throat pore partitioning models and their respective hydraulic conductance calculations the basis of flow both single phase and multiphase simulations in pnms is the hagen poiseuille model for hydraulic conductance between two pores 1 q g element l element δ p where q is flux between pores connected via throat g element is the fluid conductance of the pore throat pore and l element is the length of path between pore body centers and p is pressure difference between pores the computation of the hydraulic conductance for any 2d cross section or fluid menisci for multiphase flow g is based on the dimensionless conductance model of patzek and silin 2001 2 g a 2 g μ f where a is the area of a cross section g is dimensionless hydraulic conductance rigorously established for circle square and triangle within c t s model and μ f is fluid viscosity based on the α model we analyze each pore throat pore connection in the following manner 2a l e l e m e n t l t h r o a t l p o r e 1 l p o r e 2 l p o r e 1 l p o r e 1 t h r o a t 1 α r t h r o a t r p o r e 1 l p o r e 2 l p o r e 2 t h r o a t 1 α r t h r o a t r p o r e 2 where α is the partitioning coefficient l pore1 throat and l pore2 throat are euclidian distances between pore body centers of pore 1 and pore 2 and center of the throat between them lthroat is the partitioned length of the throat andrthroat r pore1 and r pore2 are inscribed radii of throat pore 1 and pore 2 respectively in this work we consider α parameter to be within 0 1 range as it is physically bounded by unity from above if we take the limit of r thro at r pore 1 after this partitioning volumes and surface areas for pore bodies and the pore throat can be easily computed voxel based the hydraulic conductance of the pore throat pore element gelement is then influenced by the partitioning and is computed as harmonic mean 3 l e l e m e n t g e l e m e n t l p o r e 1 g p o r e 1 l t h r o a t g t h r o a t l p o r e 2 g p o r e 2 where g pore1 g pore2 and gthroat are hydraulic conductances of pore 1 pore 2 and a throat that connects them respectively in the w model the paritioning is performed indirectly and calculation of the hydraulic conductance is done based on pores and the throat watershed intersection between them 4 l e l e m e n t g e l e m e n t w l p o r e 1 p o r e 2 g t h r o a t 1 w l p o r e 1 t h r o a t g p o r e 1 l p o r e 2 t h r o a t g p o r e 2 where w is the weight partitioning coefficient different from α l pore1 pore2 l pore1 throat l pore2 throat the parameters of pore bodies are computed in the same manner for both partitioning models as in dong and blunt 2009 i e according to c t s framework using conventional shape factor 5 g p o r e b o d y v l v a v 2 where v is the volume of the pore lv is twice the distance between the center of the pore body and its most remote voxel and av is the surface area of the pore area and volume are estimated by counting voxels and the state of their neighbors pore or solid the accuracy of this simple method depends especially for area on the quality resolution of the 3d images other important c t s formulation parameters of the pore body such as insribed sphere radius are already known from the distance map transform and pore body positioning procedures note that sholokhova et al 2009 used a slightly different parameter of maximum principle diameter of the pore body in eq 5 instead of lv yet the background of their approximation for shape factor is still very similar to that utilized here in the c t s the dimensionless hydraulic conductance of the pores and throats g g pore1 g pore2 and gthroat is approximated based on the shape factor g computed according to eq 5 for gpore body or as gthroat a p 2 according to mason and marrow 1991 and patzek and silin 2001 where a is the area of throat cross section and p is its perimeter 6 g 0 6 g i f 0 g 3 36 t r i a n g l e 0 5623 g i f 3 36 g 1 16 s q u a r e 0 5 g i f 1 16 g 1 4 π c i r c l e as all subsequent single phase and multiphase flow modeling is performed using the freely available valvatne s code we save all pore network crucial parameters topology in the form of pore throat pore connections and geometry in the c t s framework in the so called statoil format that was adopted by valvatne and blunt 2004 the whole methodology was encapsulated into in house code written in c and a shell prototype developed with the help of a qt library the program reads pore geometry in raw format and produces the pnm model in statoil format with only two parameters 3d image resolution in µm and an α w partitioning parameter in addition to that it saves the coordinates for the ball and stick diagram to be rendered as inspired by the dong and blunt 2009 implementation of this visualization approach our novel method was used to extract pnm models from all 3d images described previously fig 1 and selected sphere packings from now on we refer to it simply as our method 2 4 other pnm extraction methods employed to verify the quality of our novel pnm extraction methodology we compare it against conventional and state of the art published algorithms 1 conventional mib based method described in classical work of dong and blunt 2009 referred to as mib from now on and 2 the watershed based method of gostick 2017 ws all important details about each method can be found in the respective references there is an important difference between mib extraction and processing single voxel pore elements mib extraction randomizes the parameters of the extracted element whereas the ws and our methods retain the original 3d pore geometry the implications of this difference will be presented and discussed below for each porous media sample described above fig 1 we extracted pnm models using all aforementioned methods 2 5 flow modeling for extracted pnm models except ws see below we simulate single phase permeability in three major directions and two phase in form of capillary and relative permeability curves flow using valvatne s code this code is based on the c t s framework and is too involved to be briefly described here thus for all computational details beyond eqs 1 2 and 6 we refer to valvatne and blunt s 2004 seminal work two important aspects however require explanation for directional permeability computations inlet and outlet faces are assigned with known pressures to create a gradient whereas the other four faces are treated as closed walls in the case of two phase simulations we simulated drainage of water by oil assuming perfectly water wet conditions the ws method of gostick 2017 which is actually a part of the openpnm initiative gostick et al 2016 does not yet support pnm model export in statoil format for this reason we did not perform single phase simulations as this would require to implement partitioning for any meaningful comparison the only modification we had to introduce into openpnm python code was the addition to account for unconnected porosity that was necessary to produce comparable drainage curves for carbonate and soil samples two phase flow properties were simulated within the openpnm framework under the same boundary conditions as those used in valvatne s code it is important to note that these two simulation codes differ in physics and thus provide additional comparative statistics however because the main aim of this paper is to establish a pnm extraction technique a detailed survey of different methods and simulation frameworks is beyond its scope we mainly focus on general consistency with already established techniques to further test the accuracy of pnm based simulations we also utilize the voxel based flow simulation approach to compute directional permeabilities using the fdmss software package gerke et al 2018b for all porous media samples fig 1 during these computations impermeable wall boundary conditions were applied on all four faces parallel to pressure gradient between inlet and outlet faces to replicate the conditions in pnm based simulations 2 6 tools to test compare extraction results to verify pnm extraction using our method and to effectively compare the resulting pnm model against existing extraction algorithms we employ a wide variety of metrics first we qualitatively compare the topology in terms of coordination number statistics of the extracted pnms against voxelized pore geometry for sphere packings and next qualitatively between different methods based on coordination number statistics number of connections for each pore body next we compute euler numbers for each pore network extracted with the help of the aforementioned methods the numbers are computed according to a simple formula following from the graph theory as described in the work of vogel and roth 2001 see their eq 11 one should be careful in generalizing its content because most equations in their paper are relevant to lattice based pore networks only 7 e u l e r n u m b e r n u m b e r o f p o r e s n u m b e r o f t h r o a t s geometrical comparison is based on essential pnm model characteristics total number of pores and throats and pore body and pore throat size distributions finally to quantify the performance of extracted pnm based flow simulations the primary goal of pore scale modeling including pnm models we compare permeabilities against a voxel based stokes solver and two phase flow properties between all employed extraction methods moreover pnm extractions from sphere packings allow comparison of extracted pnm topology and major geometrical characteristics to be verified against analytically known values i e each parameter can be verified locally or globally via implemented system of automatic test numerous additional details about methodological steps and simulations are presented in the supplementary materials 3 results and discussion 3 1 verification on sphere packings similarly to numerous researchers before us we first verify the pnm extraction methodology on regular sphere packings the results for two different packings are shown in fig 3 notably the topology of pore space is well preserved the pnm elements on the sides are different from the bulk volume due to domain walls the throat cross sections number of pores and throats their volumes that sum up to a porosity of the 3d pore geometry and coordination numbers within the bulk volume are all similar to analytical ones the body centered cubic bcc packing on fig 3a is actually nontrivial to work with due to slight nonsymmetry of sphere walls visible on the visualization as this packing represents noninteger discretization khirevich et al 2015 relevant to benchmarking of flow simulations gerke et al 2018b another important observation from the cross sections and intersecting watersheds visualization is that for bcc packing our algorithm produced intersecting throats as was first noted by kim et al 2013 note that although such throats were found with our algorithm when saving into statoil format they were if possible i e without introducing extra superfluous connections represented by regular throats thus their influence on flow was ignored during modeling as will be discussed below in this section we simply conclude that the methodology produces accurate results for sphere packings and move on to verify it using more complex real 3d pore geometries 3 2 morphology comparison the results of pnm extraction from real 3d porous media images shown in fig 1 represented as conventional ball and stick diagrams are shown in fig 4 in general it seems that overall topology of the pore space is preserved because each pnm visually agrees with its 3d pore geometry counterpart fig 1 to further elucidate the quality of the extracted pnms in terms of topology and geometry we compare important statistics against two other methods mib and ws note that for all results presented below our pore networks were extracted using the α model with α 0 6 to make the comparison with mib in terms of throat length and radii to length ratio meaningful number of pores throats coordination numbers and pore throat sizes are not affected by partitioning coefficients the choice of α 0 6 in the original mib paper of dong and blunt 2009 was facilitated by comparison against permeabilities simulated using the lattice boltzmann method the total number of pores and throats as well some other important additional parameters for each pnm are reported in table 2 topology is represented by coordination number distribution i e how many connections each pore body has and by euler number geometrical pore network characteristics include pore body radii distribution pore throat radii distribution and throat length distribution all distributions were normalized to account for different number of pores and throats in pnm extracted by each methodology the summary of all aforementioned statistics for four samples of carbonate ceramic soil and sandstone is shown in figs 5 8 the number of pores and throats is always larger in pnms extracted using our method whereas ws produces the smallest number of elements compared to mib our methodology has looser criterion to maximum ball placement as was explained in the methodology section this results in more sensitivity of our approach to all local pore narrowing and in turn leads to larger total number of pore bodies the ws method places pore body centers based on distance map transform filtering and by doing so merges pores into single element compared to mib based methods the increase in pore number leads to increase in throat count yet the increment is not linear and depends on the local pore geometry for each sample all three extraction methodologies produced more pores than throats for the ultralow porosity carbonate sample whereas for all other samples the number of throats exceeded the pore body count and the proportion between pores throats decreased with increasing sample porosity the median throat length to radius ratio for our method was always lower compared to mib which could be attributed to two different reasons 1 due to different number of pores throats because a larger number of pores leads to shorter distances between their centers or 2 due to randomization of throat sizes between two inflated inscribed ball radii in mib see fig 2 in dong and blunt 2009 for details and especially for single voxel throats discriminating between these two would require additional computations not relevant to our current study the proportion between c t s shapes in our and mib pnms is very similar on one hand this may lead to thinking that finding explicit throat cross sections as in our method is not necessary because mib approximates throat cross sections with inscribed sphere radius and shape factors are estimated from partitioned 3d throat geometry similar to eq 5 or are assigned with random shape factor value for single voxel size elements on the other hand as was shown by miao et al 2017 accurate prediction of hydraulic conductivity of the throat may not be possible without its careful analysis connectivity of three different pnms varies depending on the sample as evident from figs 5 to 8a in the carbonate sample connectivity of our and mib methods is very similar whereas ws is significantly less connected a similar picture is observed for ceramic and soil samples yet our method is slightly more connected than the two other pnms for sandstone the ws is the most connected pore network followed by our method the mib is the least connected this is closely related to the pore throat number in each pnm as for the very low porosity and loosely connected soil and carbonate samples the ws has many disconnected or pores with connectivity from 1 to 3 for the much more porous and connected sandstone and ceramic samples this extraction method develops more pores with connection 10 this interplay between 3d pore geometry connectivity narrowing and expansion of pore walls and number of pores throats is complex and nontrivial to interpret but logical if one carefully explores the values in table 2 and distributions on figs 5 8a euler numbers as computed from the total number of pores and throats for each pnm according to eq 7 showed a significant difference between the extraction methods for the carbonate sample ws showed the largest positive characteristic which is most likely due to pore merging due to filtering of the distance map the mib method showed a relatively close value whereas our method showed the smallest euler characteristic this is the only sample for which numbers were all positive low connectivity of the 3d pore geometry as also evidenced from fig 5a for all networks for the highly connected ceramic sample mib and our methods produce quite similar topologies whereas mib is higher but still negative for the soil sample all methods show significant scatter finally for the sandstone sample again all euler numbers are different with mib showing the highest and ws the lowest values pore and throat radii are discrete in our and ws networks whereas distributions are nearly continuous for the mib method the agreement between ws based approaches in these distributions is very good except for slight deviations in the radii values because unlike in our approach ws does not find 2d cross sections and uses approximations based on watershed intersections we claim that our methodology is more accurate in this respect pore radii for pore bodies are larger in ws compared to two other methods as can be easily explained by smaller total number of pores i e merging pore bodies produces a longer tail in the respective distribution pore throats in mib are smaller among other possible reasons this is due to randomization of radii which is more pronounced for smaller radii values later we shall observe why the mib approach can be useful because it produces smoother capillary curves what is a better approach to utilize 3d image analysis smoothing radii randomization as in dong and blunt 2009 and arand and hesser 2017 or to follow closely the 3d pore geometry as gostick 2017 or is done our method is still an open question and may depend on the problem at hand for low quality input 3d xct data the first approach may be of advantage whereas for high quality scans or statistically fused gerke et al 2015b or hierarchical karsanina et al 2018 images our method is better as expected due to the usage of the α model with α 0 6 the throat length distributions obtained using our and mib methods are very close and all differences can be easily explained due to discrepancy in total pore throat numbers for ws the throats lengths are three to seven times longer for all samples this is due to 1 absence of partitioning so that lengths on figs 5 8d are the distances between pore centers which should increase the length by approximately two to four times compared to our and mib methods and 2 smaller number of pores by approximately one fourth which also increases the distance between pores the superposition of these two reasons explains observed differences for the ws methodology to further demonstrate that there is actually a very good agreement between throat lengths on figs 5 8 we calculated the total lengths of all throats 0 48 m for our 0 44 m for mib and 1 1 m for ws methods respectively considering the influence of partitioning on the throat length eq 2 in case of our and mib methods and no partition for ws extractions these values make perfect sense one can easily spot that mib and our methods produce numerous throat lengths well below image resolution multiplied by partitioning coefficient this is due to partitioning of the pore throat pore elements with close inscribed radii in case of mib this number is further amplified by the randomization of the single voxel size elements although geometrical characteristics for different methods did not agree we can conclude that such observed discrepancies can be explained due to the connectivity of the pore space differences in throat cross section evaluations and sensitivity of the methodology to local pore wall fluctuations in the sense of pore body placements in this regard connectivity statistics also agreed quite well contrary to that all pore networks had highly variable depending on the sample and significantly different euler numbers this suggests that although figs 5 8a are visually showing some agreement the topology of the networks differs considerably and cannot be explained by sensitivity to local pore narrowing alone at the same time this may mean that pore merging at junctions with more than two pores may alter the topology as suggested from ws characteristics 3 3 permeability results fig 9 summarizes in the graphical form all permeability computations performed using pnms extracted using the our and mib methods as well as voxel based fdmss software computations that we assume to be an accurate voxel based estimation gerke et al 2018b here based on our pore network extraction method we scanned α and w values in the range from 0 1 to 0 99 to explore the influence of partitioning parameters on permeability for three out of four samples both α model and w model scanning curves intersected the fdmss voxel based solution which means that it is possible to find a partitioning parameter within each model to obtain an accurate permeability value for the carbonate sample both curves lie above the fdmss solution except for the ceramic sample all mib solutions lie below the accuracy line let us consider each sample in more detail now in the case of the carbonate sample the 3d image quality is relatively low in terms of resolution and the main flow paths within the sample are controlled by very small throats consisting of a couple of voxels as was evident from simulated flow velocity fields see figures in supplementary materials for miao et al 2017 this could result in underestimations of permeability by voxel based fdmss simulations gerke et al 2018b in such case current observations would confirm the previous finding of miao et al 2017 and raeini et al 2017 that mib underpredicts permeability for low porosity samples our method seems to be less affected by low resolution than the other approach tested the voxel based fdmss simulations for the well resolved ceramic sample were previously found to be very accurate by comparison against laboratory measurements on this highly homogeneous artificial material gerke et al 2015c the permeability values of mib for this sample are higher than those of fdmss this agrees well with findings of raeini et al 2017 and general observations that mib underpredicts single phase flow properties for low porosity samples and overpredicts for highly porous images the accurate solution using w model partitioning in our method is achieved for w between 0 4 and 0 6 depending on the direction of the flow simulations in the α model the intersection with fdmss takes place for α between 0 8 and 0 9 for the soil and sandstone samples the situation with our results is similar to that of ceramic both partitioning models provide accurate permeability values for w between 0 3 and 0 6 sweet spot w moves slightly to the left for sandstone whereas α is solid between 0 8 and 0 9 in their recent work baychev et al 2019 found w 0 6 to agree best with voxel based simulations for their watershed based extraction approach which is slightly different from ws the mib method significantly underpredicts the permeability most notably mib permeabilities are always below the α curve for our method this could be explained by smaller throats that are not explicitly found as in our approach but estimated from inscribed sphere diameter and shape factor evaluated from surface area of the entire throat dong and blunt 2009 noting this and the shape of the α curve on fig 9 it seems that potentially mib based permeabilities could be matched to fdmss by simply decreasing α during mib extraction this idea is actually not new and was first shown for the w model by sholokhova et al 2009 but not for the α model for example based on fig 9 it is easy to see that the mib method with α 0 3 0 4 would produce permeabilities similar to fdmss for soil and sandstone samples for our method α 0 9 usually provides an accurate solution compared to the voxel based simulation value on the other hand the throat itself can be an element with say an hourglass shape harmonic mean approximation based on either the α or w model may work much better if we consider additional 2d planes along the median axis connecting two pore bodies but making such slices is computationally expensive it then appears that α or w parameters should not be fixed but rather depend on the overall pore shapes and aspect length ratios at the same time these could vary significantly within the same sample and it is an open question if a single partition parameter is good enough for a variety of pores according to our previous discussion in this case merging dividing of pores based on sensitivity to pore wall constrictions can affect permeability calculations because that changes partitioning and thus the hydraulic conductances the immediate question one could pose here is which partition is better the α or w model to address this question we begin by analysing hydraulic conductances predicted by these two models for pores of different shapes fig 10 note that supplementary materials contain the code in julia language bezanson et al 2017 which allows interactive exploration of these two models by changing pore throat parameters as explained in fig 2 we first note that both models produce the same results in case α w 0 this case can be interpreted as one where throat is nonexistent or very close to the size of the pores as can be verified by a tube like pore on fig 10a the small difference between conductances between 0 α w 1 is due to the rthroat 4 95 µm as models are nondefined for the case rthroat rpore1 rpore2 and in the limit of rthroat rpore1 rpore2 the hydraulic conductance is the same as analytical value for a circular capillary the case of α w 0 was not included in the analysis on fig 9 because this case is not represented in pore network models during extraction we locate throats as constricted connections between larger pores for parameters 0 the models deviate the length of the pores affects the value of the hydraulic conductances for both models but leaves their shapes intact at the point w 1 the throat fully controls the flow and thus represents all possible conductance variations the α model asymptotically converges to the w model in the limit of α this means that both models are actually similar in this limit but the w model is better for two reasons it is bounded by 1 from above and it does not require performing physical partitioning of voxels between pores and throats as in for example dong and blunt 2009 3 4 two phase flow results we now compare the results of two phase flow drainage simulations on pnms extracted with all three methods the resulting capillary curves and relative permeabilities for oil and water for four samples are shown in fig 11 note that in the case of our method α model with α 0 6 was used for simulations for comparison against the mib method the results provide some interesting insights on the difference between the discrete and continuous randomization pore size treatment inherent in these two methods first we note that capillary curves for low porosity carbonate and soil modeling using our pnm lie below mib curves and reach much lower capillary pressure the same is for ws curves this is easily explained by the pore throat size distributions figs 5 8 for these samples these two xct images have many small pores that get randomized radii within the mib framework whereas all original pore throat sizes preserve their radii within our and ws methodologies the same result was observed by gostick 2017 who compared capillary curves for berea sandstone on pnms extracted by ws and mib methods see fig 11 in his paper gostick 2017 also found that the capillary curve modeled using the voxel based morphological approach was almost the same as his ws based curve for the ceramic sample the match is perfect between all three methods because this sample contains only highly resolved pores that are closer to circular shape than in other samples for the other three samples carbonate soil and sandstone the curve based on pnm extracted using our method is sandwiched between ws below and mib above this is again easily explained by the throat radii statistics because current openpnm simulations do not track defending phase explicitly i e model mercury intrusion porosimetry the ws extracted networks all drain to zero saturation after accounting for unconnected porosity the agreement between irreducible saturations for carbonate and soil samples became quite close see slight disagreement for sandstone sample which was simulated by unmodified openpnm code the differences between termination capillary pressures for three pnms is due to randomization in the mib method and differences between the simulation stopping criteria in valvatne s and openpnm codes the ws method and our method that closely follow original 3d geometry and do not randomize pore throat sizes as in mib provide a ground truth simulation specific to quality and resolution of the image at hand the advantage of the randomization approach lies with more realistic looking capillary curves that drain to higher capillary pressures as real porous media samples may have complex hierarchical pore structure that cannot be captured by a single xct scan gerke et al 2015b karsanina et al 2018 we consider this to be a double edged sword on the one hand randomization adds information that is not available in the image and makes it more appealing especially when compared to experimental data a topic beyond the scope of this paper on the other hand randomization may mask extraction simulation inaccuracies and prevent progress in method development which requires multiscale image fusion or multiscale pnm modeling if now we look at relative permeabilities we observe qualitative similarity between our approach and mib regardless of similarity in capillary curves still one trend is obvious mib relative permeabilities for oil and water are generally lower than those for our pnms this highlights an important flaw of the continuous pore throat randomization approach it makes pore and throats smaller than in the ground truth 3d pore geometry and results in a significant difference in two phase flow properties in darcian scale applications depending on the absolute permeability of the sample we believe this effect to take place not purely due to element radii reduction which should affect permeability but not relative permeabilities but mainly due to changes in computed shape factors which degrade with resolution although randomization may artificially improve the overall look of the capillary curve and smoothness of all simulated curves in our opinion obtaining accurate results is more important this justifies the discrete approach of our methodology or of gostick 2017 which is even more relevant if simulations are performed on multiscale fused rock images gerke et al 2017 relative permeability curves for ws networks are very close to those of other two methods for the ceramic and sandstone samples but deviate for carbonate and soil the latter is mainly due to circular capillaries the success with two former samples actually suggests that the shape factor provides only marginal addition to modeling accuracy with valvatne s code which we attribute to insufficient development of current pnm models bondino et al 2013 baychev et al 2019 all in all here we conclude that two phase flow properties simulated on our ws and mib pnms agree surprisingly well considering very different pnm topology as revealed by euler number analysis and fully understood differences in pore throat sizes at the same time the deviations were explained due to discrete and randomization approaches or differences in pnm simulators openpnm ws framework currently treats all throats as circles and does not track entrapment for the defending phase the influence of the α parameter on the resulting two phase flow was found to be negligible due to insignificant difference in pore to throat volumes and thus not shown here see supplementary materials because the w model is a virtual partitioning for hydraulic conductance manipulations changing of w does not affect simulated capillary or relative permeability curves for the same reasons as for the α model 3 5 computational efficiency while extracting pore networks with three different methods we had an opportunity to compare computational efficiency of these algorithms this task however was complicated because different methods performed very differently for various samples porosities and domain sizes we were not able to obtain any meaningful quantitative picture e g fig 7 in gostick 2017 where he presented the time needed to perform major filtering morphological operation of the 3d image needed for pnm extraction thus we shall present very briefly a mainly qualitative comparison for very low porosity 3d images with small pores in voxels mib outperforms all other methods tested in cpu time needed on the mid range porosity pore size images all three algorithms show more or less similar results in terms of cpu time for highly porous samples 0 3 or images with large pores ws based methods start to outperform mib due to sphere inflation deflation based ball placement our maximal ball placement based on the distance map is much faster so potentially the computational efficiency of mib could be improved compared to ws our method starts to take more cpu time for larger 3d images due to numerous additional procedures e g cross section projections and analysis on average it took 1 2 h per sample in fig 1 in terms of ram mib is the most effective and scales less than watershed based methods with increasing domain volume our and ws methods are quite similar in ram requirements the extraction time and ram requirements can be significantly reduced by the use of a domain decomposition technique sizonenko et al 2017 all testing was performed using a regular desktop workstation with 128 gb of ram 3 6 general discussion and outlook in our quest to verify the hybrid inscribed balls watersheds extraction method we found that conventional metrics usually utilized for this purpose are not necessarily enough for the task in particular it turned out that a simple metric in the form of euler number computed for each pnm clearly indicated that all studied pore networks were different in terms of their topology this finding was not originally evident from the connectivity statistics alone it seems that all geometrical and topological parameters during pnm extraction are nontrivially interconnected and such connections were hard to uncover for complex porous media samples studied here a potentially useful approach is to create artificial pore geometries with known topological and geometrical measures with complexity beyond sphere packings as was recently proposed by baychev et al 2019 comparison against the ws extraction method poses an important question that we are not able to answer here can we effectively merge pore network elements to reduce the total number of pores throat without or with insignificant loss of flow modeling accuracy it may be quite so at least for quasi static simulations where the smallest throats will define the shape of all curves however if we imagine simulations in highly inhomogeneous wettability conditions the answer to the question may change radically the same is true for dynamic pore network models where simultaneous drainage imbibition processes can be influenced significantly even by relatively small bumps in pore wall geometry another interesting observation immediately following from eq 7 is that adding additional pore and throat due to sensitivity of our algorithm to small bumps on the pore walls should not change the topology of the pore network this topic is well beyond the scope of this work but this is an area to explore in future one interesting observation from simulations for ws networks on fig 11 is that merging of pore bodies due to filtering of watershedding seeds reduces the resolution of simulations simulation points are far apart within intermediate saturation range for sandstone and ceramic samples which happens due to cumulative filling of larger pores of the same size this may be also affected by the circular capillaries in ws extracted pnms they do not drain incrementally as for example triangular capillaries do but if this does not affect modeling accuracy much merging can reduce computational effort whether a trade off between accuracy and accelerated computations can be found for pore merging is still an open question other future work may target exploring permeability prediction accuracy based on direct flow simulations and artificial intelligence in 3d to predict pore network element conductances as was recently proposed by miao et al 2017 it seems to be very important to rigorously verify or reject harmonic mean approximation especially considering its dependence on the partition model and potential dependence of partition parameters on local pore geometry it is still an open question if we can predict conductances based on 2d cross sections or we need to perform 3d simulations sholokhova et al al 2009 rabbani and babaei 2019 in our pore network extraction results we clearly observed intersecting throats kim et al 2013 although this demonstrates that our extraction methodology is quite advanced to account for such intersecting throats would require considerable additional development of the multiphase flow pore network codes to our knowledge no such code exists at the moment such improvements in pnm technology will clearly require a substantial effort in future research our study has four obvious drawbacks first although we covered a wide variety of materials relevant to earth sciences we did not explore high porosity porous media such as foams fibrous materials and such gostick 2017 we hope to consider applications to such materials in future the second drawback is the problem of merging throats which we do when two pores are connected by more than two throats see example on fig 2 we adopted this simple merging shortcut because valvatne s code is unable to handle such situations we believe a more evolved pore network simulator is needed to be developed to account for intersecting throats and numerous connections between pores because modifying valvatne s code does not seem to be a reasonable alternative bondino et al 2013 miao et al 2017 raeini et al 2018 baychev et al 2019 third we were unable to explicitly explain the differences in topology between different pnm extraction methodologies as was revealed by euler number analysis as connectivity distributions showed visual similarity finally we did not explore median axis based algorithms in our previous work we developed a hybrid mib ma algorithm miao et al 2017 but we observed some topological artefacts with this approach this is pretty much in line with the mib and ma comparison presented by silin and patzek 2006 or observations of prodanović et al 2007 this may be due to the fact that the majority of ma based algorithms utilized thinning algorithms to establish the median axis lee et al 1994 it may be possible to improve the topology of the ma extraction by utilizing persistent homology instead delgado friedrichs et al 2014 a rigorous pore network extraction survey as a result of a collaboration of researchers developing different methods may be needed to shed some light on possible topological issues 4 summary in this contribution we developed a novel hybrid pore network extraction method based on maximal inscribed balls and watershed segmentation this hybrid method allowed placing seeds necessary for the watershed algorithm into exact pore body positions which we think improves the geometrical sensitivity and fidelity of the pore network extraction and which enables avoiding saddle point maximum and gaussian blur filtering on distance maps prior to watershedding we rigorously verified our new method on artificial sphere packings with analytically known pore network parameters moreover we compared our pnms against two other popular approaches based purely on maximal balls and watersheds during intercomparison with other extraction methods some large differences were observed between pnms based on numerous geometrical and topological characteristics such as pore throat size euler numbers and connection number distributions although it is possible to explain some of the observed variations as related to 3d pore geometry connectivity differences in how the three methods analyse pore cross sections and the sensitivity of the method to local narrowing of the pore walls our intercomparison of extraction techniques highlighted some major problems with the metrics utilized for such studies simulated two phase flow parameters were found to be in surprisingly good agreement between different pnms for single phase flow we observed the possibility of obtaining good predictions with any methodology but this would require tuning the pore throat partitioning approach the severe topological differences between studied extraction methodologies in terms of euler characteristics may indicate that current multiphase flow physics in pore network simulators is insufficient to describe all relevant processes our finding highlights the necessity to develop robust geometry and topology verification standards beyond simple sphere packings to make sure that current and future extraction techniques do provide adequate simplifications of the pore space we compared two existing pore to throat partitioning models for the first time and concluded that although they are essentially the same the w model is physically more rigorous because it is bounded not only from below but also from above 0 w 1 α model asymptotically converges to w 1 at α and does not require actual partitioning i e does not have explicit throat length author contributions k m g and v v a conceived this research k m g and t o s developed the methodology idea and design t o s m v k and k m g implemented this methodology into c code d v k performed xct scanning k m g processed all xct images e v l performed all openpnm extractions and simulations and processed its results k m g performed most of the simulation and data processing and wrote the manuscript k m g m v k and t o s prepared graphical results all authors reviewed the final version of the paper declaration of competing interest authors declare no conflict of interests acknowledgments the authors thank schlumberger moscow research for the permission to publish this research we are grateful to susan duffield for improving the readability of this manuscript we are indebted to prof jeff gostick for the help with establishing openpnm simulations k m g thanks prof hans jörg vogel and dr ulrich weller for very fruitful discussions on pore network topology issues four anonymous reviewers especially reviewer 2 are gratefully acknowledged for insightful and very useful comments which helped in improving this paper 
493,pore scale modeling is a rapidly evolving area of research because modeling multiphase flow directly on 3d pore geometries is of utmost importance in wide variety of research areas including oil and gas development hydrology and material sciences although there are numerous methods to model flow only so called pore network models are computationally effective enough to perform simulations in large modeling domains and they are orders of magnitude faster than direct modeling approaches however pore network models require a simplification of the 3d pore geometry to perform simulations which are usually referred to as pore network extraction such extraction poses a separate problem because it must provide an accurate description of the pore space geometry and topology different methods have been proposed in the literature recently watershed based approaches have been popular due to their effectiveness in working with porous media images of any porosity a watershed algorithm requires seed placement to segment the space into distinct pores we propose a hybrid algorithm combining the power of watersheds in finding intersections between pores with the advantages of the maximum inscribed ball technique which is very effective in finding pore centers we rigorously verify and test our novel methodology on artificial and x ray microtomography images of wide variety of porous materials sphere packings carbonate soil ceramic and sandstone samples comparison against a purely watershed based method and results based solely on the maximum inscribed balls based method in terms of pore throat total number pore size distributions and connection statistics and multiphase flow properties including capillary curves and relative permeabilities revealed the accuracy of our novel technique consistency with existing classical techniques and great potential in analysing 3d pore images of any complexity on the other hand comparison of extracted pore network topology as based on euler number revealed significant differences between different methodologies which is rather surprising considering the similarities in two phase flow properties while analysing permeability results we also compared two popular pore throat partitioning models and advocated in favor of the weight model usually utilized within watershed based extracted pore networks our results illuminate problems in current pore network models and outline some potential ways to improve their accuracy in future research keywords pore network extraction pore scale modeling stokes flow solver x ray micro tomography xmt pore to throat partitioning watershed maximum inscribed ball 1 introduction an exact description of pore scale flow physics is of great interest in numerous scientific and industrial fields petroleum engineering sahimi 2011 blunt 2017 hydrology helmig 1997 godinho et al 2016 gerke et al 2015a soil science gerke 2006 fuel cell development tranter et al 2017 and food engineering derossi et al 2019 to name just a few such pore level description is not only useful to understand what happens in the porous media under given flow boundary conditions but also allows us to optimize and design different aspects in real world applications upscale physical properties from pore to continuum scale and overcome some of the limitations typical of laboratory measurements in recent decades pore scale modeling techniques reached a development level enough to complement conventional core tests and measurements on undisturbed porous media samples this progress is partially a result of the significant advance in 3d structural information acquisition e g x ray computed tomography xct imaging wildenschild and sheppard 2013 cnudde and boone 2013 gerke et al 2012 stochastic reconstructions based on limited input data adler et al 1990 yeong and torquato 1998 thovert and adler 2011 jiao and chawla 2014 gerke et al 2014 gerke and karsanina 2015 karsanina and gerke 2018 or their combination li et al 2014 2017 pore scale simulations are a powerful addition to conventional measurements because they help to go beyond laboratory capabilities in numerous aspects and help in avoiding 1 measurement errors diamond 2000 čapek et al 2014 2 changes to the physical properties of samples by cracking self filtration and other processes dikinya et al 2008 zeinijahromi et al 2016 3 distortion by boundary effects duwig et al 2008 scheibe et al 2015 gerke et al 2019 4 difficulties to measure on irregular shapes or small sizes gerke et al 2013 2015b 5 inability to determine dynamic structure influences on permeability coppola et al 2012 6 limitations on measuring directional or tensorial dependencies renard et al 2001 guibert et al 2016 thibodeaux et al 2015 gerke et al 2018a 7 core sizes being smaller than the representative elemental volume rev moreover allows us to 8 work with synthetic digital images to solve porous media design issues karsanina et al 2015 xu et al 2017 9 apply any dynamic inflow and pressure boundary conditions 10 directly integrate pore scale simulations into darcian scale models sheng and thompson 2013 and incorporate geostatistics and uncertainty analysis for pore to continuum upscaling mariethoz and caers 2014 especially without distinct rev all aforementioned benefits justify that vast effort invested into pore scale techniques development observed over the last 20 years a great number of different computational methods exist to model single and multiphase fluid flow within heterogeneous pore spaces among the most popular are the 1 lattice boltzmann method khirevich et al 2015 dashtian et al 2019 bakhshian et al 2019 2 finite element finite volume and volume of fluid methods raeini et al 2012 bilger et al 2017 3 smoothed particle hydrodynamics holmes et al 2016 4 finite difference and laplace stokes equation solvers shabro et al 2012 gerke et al 2018b 5 level set bilger et al 2017 verma et al 2018 and 6 phase field method demianov et al 2011 rokhforouz and amiri 2017 however all these computational techniques to model laminar fluid flow are computationally intensive which limits the size of the pore network domain that can be evaluated to a very limited volume of usually up to 7003 voxels while the time needed with hpc resources easily reaches several weeks because of the need to work on as large as possible 3d pore geometries to capture the rev of a porous medium or to work on fused images resulting from a number of multiscale images for complex hierarchical porous samples such as carbonates bultreys et al 2015 gerke et al 2017 or soils karsanina et al 2015b karsanina et al 2018 in other words such direct pore scale modeling techniques are too computationally expensive to routinely process revs of real rock samples the only practical option is to utilize indirect modeling methods such as pore network models pnm fatt 1956a b c xiong et al 2016 which can actually be effectively parameterized using direct pore scale simulations by any method s from above miao et al 2017 raeini et al 2017 although pnms allow a very efficient computational framework to simulate single two and even three phase pereira et al 1996 van dijke and sorbie 2002 piri and blunt 2005 filtration one first needs to extract pore network representation from a 3d image of the porous medium under study a great variety of different pnm extraction methods have been proposed for a brief yet very informative overview see table 1 in the work of rabbani et al 2014 here we shall summarize only some key methodologies that motivated the study reported here the three classical approaches that work with 3d binary divided into pores and solids voxelized images include 1 median axis ma also called skeletonization based methods lindquist et al 2000 prodanović et al 2007 jiang et al 2007 2 maximum inscribed ball sphere mib method silin and patzek 2006 dong and blunt 2009 arand and hesser 2017 3 watershed based methods sheppard et al 2005 rabbani et al 2014 gostick 2017 bakhshian and hosseini 2019 a great number of recently published upgrades and hybrids e g yi et al 2017 miao et al 2017 raeini et al 2017 still utilize the classical methods or their combinations each methodology has its advantages and flaws watershed based methods are usually praised for robust throat cross section determination computational efficiency and ability to work with highly porous samples ideal extraction methodology would preserve topology of the pore space while at the same time finding an optimal trade off in geometry simplification to facilitate fast computations without loss in accuracy miao et al 2017 a number of studies pointed out that current pnms do not provide necessary accuracy comparable to direct voxel based simulations bondino et al 2013 miao et al 2017 in particular due to insufficient geometry topology preservation baychev et al 2019 for example current simulators are incapable of dealing explicitly with pores connected by more than one throat see an example of such case below thus improvements of pnm extraction techniques can be an important step towards creating better pnm simulators our current work was to a large extent inspired by the paper of gostick 2017 who presented a significantly improved version of the watershed methodology in particular the snow algorithm however we saw several disadvantages in his implementation especially in determining seeds for watershed growth of pore bodies technically watersheds are very efficient in finding pore to pore connections and in a way mimic fluid displacement within pore space sheppard et al 2005 but are very sensitive to initial seed placement the major problem is in choosing pore body positions from distance transform local maxima points rabbani et al 2014 and gostick 2017 utilize several additional procedures to improve seed localization e g maximum and gaussian blur filters of distance map transform of the pore space and removal of the saddle points such procedures require the choice of additional parameters and only partially solve the seed difficulty our novel hybrid method solves this issue inherent in classical watershed based methods in a robust and efficient manner the objective of this paper is to present a robust and still computationally efficient hybrid watershed and mib methodology to extract pnms from voxelized 3d pore geometries the idea behind our approach is simple the problem of pore body seed placement for watershed algorithm is solved by analysis of inscribed spheres moreover our solution renders saddle point maximum and gaussian blur filtering on distance maps obsolete we thoroughly verified our methodology on different porous media geometries and compared our results against other popular classic methods which included pore network geometrical pore throat size distributions topological coordination number distributions and euler numbers and multiphase flow properties capillary curves and relative permeabilities single phase permeabilities were compared against voxel based modeling approach 2 materials and methods 2 1 3d images of porous media and their preprocessing to verify and test the proposed methodology we extract pnms from a variety of porous media samples there are two types of 3d images we utilize for these purposes artificial sphere packings and real geometries of sandstone carbonate soil and ceramic obtained using xct imaging the former is good for verification because positions and parameters for pore bodies and pore throats in these packings can be determined analytically the latter is necessary to test the pnm extraction methodology on realistic natural geometries with wide variety of genesis and complexity real porous media samples were obtained using an xct bruker skyscan 1172 desktop device the details of carbonate and sandstone sample acquisition are given in miao et al 2017 for soil and ceramic samples these details are provided in karsanina et al 2018 and gerke et al 2015c respectively original stacks of images were subcropped to obtain a cubic domain of interest with the size of 500 7003 voxels to convert grey scale into binary images with distinguished pore and solid phases we utilized two conventional local segmentation techniques indicator kriging oh and lindquist 1999 and converging active contours sheppard et al 2004 as opposed to global segmentation approaches local methods require two thresholds for binarization which in our case were chosen manually based on trial and error segmentation attempts all image processing was performed using in house code developed by our group the binary structure of all natural samples utilized in this study is shown in fig 1 major 3d image characteristics are provided in table 1 the variety of samples is wide enough to cover different geological genesis e g sandstone and carbonate rocks studied in petrophysical applications soil as a regular object in soil sciences and hydrology and artificial porous media ceramic sample which are important for industrial applications moreover the porosity of the chosen sample collection varies between 5 and 37 thus providing a possibility to test the pnm extraction methodology on both tight and highly porous examples some of the published methods altered the original 3d pore geometry namely rabbani et al 2014 utilized different forms of the distance transform function computed from a binary image and arand and hesser 2017 developed this concept further and computed the distance transform on grey scale images on one hand this helps to work with distance map which is now much easier to filter and remove unnecessary seeds but works only under the assumption of binary composition of the sample under study on the other hand we believe that the 3d binary image should be taken as a ground truth pore geometry this will be true if for example a much better resolution will be achieved in the future with improved imaging technology or by other related methods karsanina and gerke 2018 because the proposed methodology effectively addresses the problem of seeds we avoided any alteration of pore solid interface geometry and our algorithms work exclusively with an as is input 3d binary image 2 2 details of the pnm extraction algorithm the pnm extraction is initiated by loading the 3d binary image into the ram memory the general framework can be divided into a number of well defined parts 1 distance map transform 2 building inscribed ball hierarchy using the precomputed distance map and placing pore bodies 3 dividing pore space into distinct pore volumes by applying watershed segmentation from seeds pore body centers 4 finding pore to pore intersections and parameterizing pore throats and 5 partitioning 3d pore space into pore bodies and pore throats with their characteristics relevant to future single multiphase flow simulations into a single pore network structure after completing these steps the resulting pnm can be visualized using the so called ball and stick diagram which is useful in observing pore network s topology and some geometry specifications e g pore body and pore throat sizes the general scheme of this framework and illustrations of the key algorithms are shown in fig 2 we now describe all involved procedures in more detail at first the 3d distance map is computed for all pore voxels closely following a recently published fast algorithm felzenszwalb and huttenloche 2012 as a result at each pore voxel we obtain a single float i e subvoxel resolution due to diagonal connections of voxels value representing its closest distance to the pore solid interface after the distance map is available we start inscribing maximum balls spheres at selected pore voxels the idea of mib and their hierarchy for pnm extraction was first proposed by silin and patzek 2006 and later improved by dong and blunt 2009 in their implementation the balls were found by inflation deflation at a given pore voxel as was noted later by numerous researchers e g yi et al 2017 raeini et al 2017 arand and hesser 2017 the distance map transform value itself provides a robust basis for ball inscribing i e provides local mib radii our definition of the mib thus is the same as in the work of arand and hesser 2017 we inscribe balls in selected pore voxels by first ranking all pore voxels by their distance transform value in descending order starting from the such a list we start inscribing and check if each next pore voxel within the list is already contained within the previously inscribed sphere while performing this step we somewhat loosen the condition of the inclusion compared to mib and methodology of arand and hesser 2017 by subtracting one voxel from each radius of the containing ball during this check this still speeds up mib positioning compared to their placement at each pore voxel silin and patzek 2006 but increases the sensitivity of ball placement see fig 3 in arand and hesser 2017 for a very nice graphical explanation of the concept by additional checking for possible constrictions between closer maximal balls after all mibs are placed they are clustered in a hierarchy in a manner closely following the original idea of masters and slaves by silin and patzek 2006 or ancestors and descendants by dong and blunt 2009 we start by sorting the list of inscribed balls in the radii descending order starting from the top of the list we check if the mib has intersections with balls of the same radii or larger all voxels serving as centers of the locally largest balls are marked as pore body centers if a master ancestor ball has an intersection with one or more balls of the same radii the proximity to their center of mass defines the leading ball that becomes the pore body center as the result of this part of the algorithm we marked the voxels that represent the centers of pore bodies we now utilize a marker based watershed algorithm six connectivity variation of barnes et al 2014 which uses pore body centers as seeds to separate pores from each other as a result we not only mark each pore volume in 3d but also obtain intersections between pores i e interfaces between watersheds representing separated pores this part of the algorithm is conventional and closely follows the works of rabbani et al 2014 and gostick 2017 the interfaces between each separated pore serve as good approximations for pore throat cross sections sheppard et al 2005 gostick 2017 however obtained this way most of the interfaces are not 2d plane faces and are generally represented by curved surfaces for example see fig 14 in rabbani et al 2014 to utilize the conventional circle triangle square c t s pnm flow modeling framework patzek and silin 2001 valvatne and blunt 2004 we approximate such curved surfaces with 2d planar surfaces to do so we first mark all unique pore to pore watershed connections with cantor s hash function unlike map in c or dictionary in python or julia hashing that uniquely relates two quantities cantor s hash function can reversibly and uniquely hash multiple positive integers with another integer which allows relating the identification numbers of two pores and a throat in between them if at any time during processing the watershed intersections a new pore to pore connection is observed it gets its own hash function assigned if the intersection is not unique the midpoint between voxels belonging to different pore watersheds is marked with an existing hash after all watershed intersections are processed this way we compute the area of the intersection and its inscribed radius next for each cloud of points representing midpoints of an intersection we create a projection to the plane which is found using the least squares method the resulting 2d projection is analyzed for the number of resulting pore space clusters the reason why the projection can be represented by separate pore clusters will be discussed later if the 2d plane of the watershed intersection is not a single pore cluster more than one throat between two pores as shown in fig 2 step 4 we combine two or more clusters into a single throat for each throat cross section obtained in this fashion we determine several important parameters area perimeter conventional shape factor computed as the ratio of area to perimeter squared and inscribed radius if the inscribed radius of the resulting 2d plane is larger than the maximum distance map value on the watershed interface the latter is used as the radius of the resulting throat finally we now partition each pore as the result of the watershed pore space segmentation into pore body and pore throat s according to two different approaches 1 the methodology of dong and blunt 2009 but originally proposed by oren et al 1998 which we shall call the α model and 2 the approach of sholokhova et al 2009 which will be referred to as the w model 2 3 pore throat pore partitioning models and their respective hydraulic conductance calculations the basis of flow both single phase and multiphase simulations in pnms is the hagen poiseuille model for hydraulic conductance between two pores 1 q g element l element δ p where q is flux between pores connected via throat g element is the fluid conductance of the pore throat pore and l element is the length of path between pore body centers and p is pressure difference between pores the computation of the hydraulic conductance for any 2d cross section or fluid menisci for multiphase flow g is based on the dimensionless conductance model of patzek and silin 2001 2 g a 2 g μ f where a is the area of a cross section g is dimensionless hydraulic conductance rigorously established for circle square and triangle within c t s model and μ f is fluid viscosity based on the α model we analyze each pore throat pore connection in the following manner 2a l e l e m e n t l t h r o a t l p o r e 1 l p o r e 2 l p o r e 1 l p o r e 1 t h r o a t 1 α r t h r o a t r p o r e 1 l p o r e 2 l p o r e 2 t h r o a t 1 α r t h r o a t r p o r e 2 where α is the partitioning coefficient l pore1 throat and l pore2 throat are euclidian distances between pore body centers of pore 1 and pore 2 and center of the throat between them lthroat is the partitioned length of the throat andrthroat r pore1 and r pore2 are inscribed radii of throat pore 1 and pore 2 respectively in this work we consider α parameter to be within 0 1 range as it is physically bounded by unity from above if we take the limit of r thro at r pore 1 after this partitioning volumes and surface areas for pore bodies and the pore throat can be easily computed voxel based the hydraulic conductance of the pore throat pore element gelement is then influenced by the partitioning and is computed as harmonic mean 3 l e l e m e n t g e l e m e n t l p o r e 1 g p o r e 1 l t h r o a t g t h r o a t l p o r e 2 g p o r e 2 where g pore1 g pore2 and gthroat are hydraulic conductances of pore 1 pore 2 and a throat that connects them respectively in the w model the paritioning is performed indirectly and calculation of the hydraulic conductance is done based on pores and the throat watershed intersection between them 4 l e l e m e n t g e l e m e n t w l p o r e 1 p o r e 2 g t h r o a t 1 w l p o r e 1 t h r o a t g p o r e 1 l p o r e 2 t h r o a t g p o r e 2 where w is the weight partitioning coefficient different from α l pore1 pore2 l pore1 throat l pore2 throat the parameters of pore bodies are computed in the same manner for both partitioning models as in dong and blunt 2009 i e according to c t s framework using conventional shape factor 5 g p o r e b o d y v l v a v 2 where v is the volume of the pore lv is twice the distance between the center of the pore body and its most remote voxel and av is the surface area of the pore area and volume are estimated by counting voxels and the state of their neighbors pore or solid the accuracy of this simple method depends especially for area on the quality resolution of the 3d images other important c t s formulation parameters of the pore body such as insribed sphere radius are already known from the distance map transform and pore body positioning procedures note that sholokhova et al 2009 used a slightly different parameter of maximum principle diameter of the pore body in eq 5 instead of lv yet the background of their approximation for shape factor is still very similar to that utilized here in the c t s the dimensionless hydraulic conductance of the pores and throats g g pore1 g pore2 and gthroat is approximated based on the shape factor g computed according to eq 5 for gpore body or as gthroat a p 2 according to mason and marrow 1991 and patzek and silin 2001 where a is the area of throat cross section and p is its perimeter 6 g 0 6 g i f 0 g 3 36 t r i a n g l e 0 5623 g i f 3 36 g 1 16 s q u a r e 0 5 g i f 1 16 g 1 4 π c i r c l e as all subsequent single phase and multiphase flow modeling is performed using the freely available valvatne s code we save all pore network crucial parameters topology in the form of pore throat pore connections and geometry in the c t s framework in the so called statoil format that was adopted by valvatne and blunt 2004 the whole methodology was encapsulated into in house code written in c and a shell prototype developed with the help of a qt library the program reads pore geometry in raw format and produces the pnm model in statoil format with only two parameters 3d image resolution in µm and an α w partitioning parameter in addition to that it saves the coordinates for the ball and stick diagram to be rendered as inspired by the dong and blunt 2009 implementation of this visualization approach our novel method was used to extract pnm models from all 3d images described previously fig 1 and selected sphere packings from now on we refer to it simply as our method 2 4 other pnm extraction methods employed to verify the quality of our novel pnm extraction methodology we compare it against conventional and state of the art published algorithms 1 conventional mib based method described in classical work of dong and blunt 2009 referred to as mib from now on and 2 the watershed based method of gostick 2017 ws all important details about each method can be found in the respective references there is an important difference between mib extraction and processing single voxel pore elements mib extraction randomizes the parameters of the extracted element whereas the ws and our methods retain the original 3d pore geometry the implications of this difference will be presented and discussed below for each porous media sample described above fig 1 we extracted pnm models using all aforementioned methods 2 5 flow modeling for extracted pnm models except ws see below we simulate single phase permeability in three major directions and two phase in form of capillary and relative permeability curves flow using valvatne s code this code is based on the c t s framework and is too involved to be briefly described here thus for all computational details beyond eqs 1 2 and 6 we refer to valvatne and blunt s 2004 seminal work two important aspects however require explanation for directional permeability computations inlet and outlet faces are assigned with known pressures to create a gradient whereas the other four faces are treated as closed walls in the case of two phase simulations we simulated drainage of water by oil assuming perfectly water wet conditions the ws method of gostick 2017 which is actually a part of the openpnm initiative gostick et al 2016 does not yet support pnm model export in statoil format for this reason we did not perform single phase simulations as this would require to implement partitioning for any meaningful comparison the only modification we had to introduce into openpnm python code was the addition to account for unconnected porosity that was necessary to produce comparable drainage curves for carbonate and soil samples two phase flow properties were simulated within the openpnm framework under the same boundary conditions as those used in valvatne s code it is important to note that these two simulation codes differ in physics and thus provide additional comparative statistics however because the main aim of this paper is to establish a pnm extraction technique a detailed survey of different methods and simulation frameworks is beyond its scope we mainly focus on general consistency with already established techniques to further test the accuracy of pnm based simulations we also utilize the voxel based flow simulation approach to compute directional permeabilities using the fdmss software package gerke et al 2018b for all porous media samples fig 1 during these computations impermeable wall boundary conditions were applied on all four faces parallel to pressure gradient between inlet and outlet faces to replicate the conditions in pnm based simulations 2 6 tools to test compare extraction results to verify pnm extraction using our method and to effectively compare the resulting pnm model against existing extraction algorithms we employ a wide variety of metrics first we qualitatively compare the topology in terms of coordination number statistics of the extracted pnms against voxelized pore geometry for sphere packings and next qualitatively between different methods based on coordination number statistics number of connections for each pore body next we compute euler numbers for each pore network extracted with the help of the aforementioned methods the numbers are computed according to a simple formula following from the graph theory as described in the work of vogel and roth 2001 see their eq 11 one should be careful in generalizing its content because most equations in their paper are relevant to lattice based pore networks only 7 e u l e r n u m b e r n u m b e r o f p o r e s n u m b e r o f t h r o a t s geometrical comparison is based on essential pnm model characteristics total number of pores and throats and pore body and pore throat size distributions finally to quantify the performance of extracted pnm based flow simulations the primary goal of pore scale modeling including pnm models we compare permeabilities against a voxel based stokes solver and two phase flow properties between all employed extraction methods moreover pnm extractions from sphere packings allow comparison of extracted pnm topology and major geometrical characteristics to be verified against analytically known values i e each parameter can be verified locally or globally via implemented system of automatic test numerous additional details about methodological steps and simulations are presented in the supplementary materials 3 results and discussion 3 1 verification on sphere packings similarly to numerous researchers before us we first verify the pnm extraction methodology on regular sphere packings the results for two different packings are shown in fig 3 notably the topology of pore space is well preserved the pnm elements on the sides are different from the bulk volume due to domain walls the throat cross sections number of pores and throats their volumes that sum up to a porosity of the 3d pore geometry and coordination numbers within the bulk volume are all similar to analytical ones the body centered cubic bcc packing on fig 3a is actually nontrivial to work with due to slight nonsymmetry of sphere walls visible on the visualization as this packing represents noninteger discretization khirevich et al 2015 relevant to benchmarking of flow simulations gerke et al 2018b another important observation from the cross sections and intersecting watersheds visualization is that for bcc packing our algorithm produced intersecting throats as was first noted by kim et al 2013 note that although such throats were found with our algorithm when saving into statoil format they were if possible i e without introducing extra superfluous connections represented by regular throats thus their influence on flow was ignored during modeling as will be discussed below in this section we simply conclude that the methodology produces accurate results for sphere packings and move on to verify it using more complex real 3d pore geometries 3 2 morphology comparison the results of pnm extraction from real 3d porous media images shown in fig 1 represented as conventional ball and stick diagrams are shown in fig 4 in general it seems that overall topology of the pore space is preserved because each pnm visually agrees with its 3d pore geometry counterpart fig 1 to further elucidate the quality of the extracted pnms in terms of topology and geometry we compare important statistics against two other methods mib and ws note that for all results presented below our pore networks were extracted using the α model with α 0 6 to make the comparison with mib in terms of throat length and radii to length ratio meaningful number of pores throats coordination numbers and pore throat sizes are not affected by partitioning coefficients the choice of α 0 6 in the original mib paper of dong and blunt 2009 was facilitated by comparison against permeabilities simulated using the lattice boltzmann method the total number of pores and throats as well some other important additional parameters for each pnm are reported in table 2 topology is represented by coordination number distribution i e how many connections each pore body has and by euler number geometrical pore network characteristics include pore body radii distribution pore throat radii distribution and throat length distribution all distributions were normalized to account for different number of pores and throats in pnm extracted by each methodology the summary of all aforementioned statistics for four samples of carbonate ceramic soil and sandstone is shown in figs 5 8 the number of pores and throats is always larger in pnms extracted using our method whereas ws produces the smallest number of elements compared to mib our methodology has looser criterion to maximum ball placement as was explained in the methodology section this results in more sensitivity of our approach to all local pore narrowing and in turn leads to larger total number of pore bodies the ws method places pore body centers based on distance map transform filtering and by doing so merges pores into single element compared to mib based methods the increase in pore number leads to increase in throat count yet the increment is not linear and depends on the local pore geometry for each sample all three extraction methodologies produced more pores than throats for the ultralow porosity carbonate sample whereas for all other samples the number of throats exceeded the pore body count and the proportion between pores throats decreased with increasing sample porosity the median throat length to radius ratio for our method was always lower compared to mib which could be attributed to two different reasons 1 due to different number of pores throats because a larger number of pores leads to shorter distances between their centers or 2 due to randomization of throat sizes between two inflated inscribed ball radii in mib see fig 2 in dong and blunt 2009 for details and especially for single voxel throats discriminating between these two would require additional computations not relevant to our current study the proportion between c t s shapes in our and mib pnms is very similar on one hand this may lead to thinking that finding explicit throat cross sections as in our method is not necessary because mib approximates throat cross sections with inscribed sphere radius and shape factors are estimated from partitioned 3d throat geometry similar to eq 5 or are assigned with random shape factor value for single voxel size elements on the other hand as was shown by miao et al 2017 accurate prediction of hydraulic conductivity of the throat may not be possible without its careful analysis connectivity of three different pnms varies depending on the sample as evident from figs 5 to 8a in the carbonate sample connectivity of our and mib methods is very similar whereas ws is significantly less connected a similar picture is observed for ceramic and soil samples yet our method is slightly more connected than the two other pnms for sandstone the ws is the most connected pore network followed by our method the mib is the least connected this is closely related to the pore throat number in each pnm as for the very low porosity and loosely connected soil and carbonate samples the ws has many disconnected or pores with connectivity from 1 to 3 for the much more porous and connected sandstone and ceramic samples this extraction method develops more pores with connection 10 this interplay between 3d pore geometry connectivity narrowing and expansion of pore walls and number of pores throats is complex and nontrivial to interpret but logical if one carefully explores the values in table 2 and distributions on figs 5 8a euler numbers as computed from the total number of pores and throats for each pnm according to eq 7 showed a significant difference between the extraction methods for the carbonate sample ws showed the largest positive characteristic which is most likely due to pore merging due to filtering of the distance map the mib method showed a relatively close value whereas our method showed the smallest euler characteristic this is the only sample for which numbers were all positive low connectivity of the 3d pore geometry as also evidenced from fig 5a for all networks for the highly connected ceramic sample mib and our methods produce quite similar topologies whereas mib is higher but still negative for the soil sample all methods show significant scatter finally for the sandstone sample again all euler numbers are different with mib showing the highest and ws the lowest values pore and throat radii are discrete in our and ws networks whereas distributions are nearly continuous for the mib method the agreement between ws based approaches in these distributions is very good except for slight deviations in the radii values because unlike in our approach ws does not find 2d cross sections and uses approximations based on watershed intersections we claim that our methodology is more accurate in this respect pore radii for pore bodies are larger in ws compared to two other methods as can be easily explained by smaller total number of pores i e merging pore bodies produces a longer tail in the respective distribution pore throats in mib are smaller among other possible reasons this is due to randomization of radii which is more pronounced for smaller radii values later we shall observe why the mib approach can be useful because it produces smoother capillary curves what is a better approach to utilize 3d image analysis smoothing radii randomization as in dong and blunt 2009 and arand and hesser 2017 or to follow closely the 3d pore geometry as gostick 2017 or is done our method is still an open question and may depend on the problem at hand for low quality input 3d xct data the first approach may be of advantage whereas for high quality scans or statistically fused gerke et al 2015b or hierarchical karsanina et al 2018 images our method is better as expected due to the usage of the α model with α 0 6 the throat length distributions obtained using our and mib methods are very close and all differences can be easily explained due to discrepancy in total pore throat numbers for ws the throats lengths are three to seven times longer for all samples this is due to 1 absence of partitioning so that lengths on figs 5 8d are the distances between pore centers which should increase the length by approximately two to four times compared to our and mib methods and 2 smaller number of pores by approximately one fourth which also increases the distance between pores the superposition of these two reasons explains observed differences for the ws methodology to further demonstrate that there is actually a very good agreement between throat lengths on figs 5 8 we calculated the total lengths of all throats 0 48 m for our 0 44 m for mib and 1 1 m for ws methods respectively considering the influence of partitioning on the throat length eq 2 in case of our and mib methods and no partition for ws extractions these values make perfect sense one can easily spot that mib and our methods produce numerous throat lengths well below image resolution multiplied by partitioning coefficient this is due to partitioning of the pore throat pore elements with close inscribed radii in case of mib this number is further amplified by the randomization of the single voxel size elements although geometrical characteristics for different methods did not agree we can conclude that such observed discrepancies can be explained due to the connectivity of the pore space differences in throat cross section evaluations and sensitivity of the methodology to local pore wall fluctuations in the sense of pore body placements in this regard connectivity statistics also agreed quite well contrary to that all pore networks had highly variable depending on the sample and significantly different euler numbers this suggests that although figs 5 8a are visually showing some agreement the topology of the networks differs considerably and cannot be explained by sensitivity to local pore narrowing alone at the same time this may mean that pore merging at junctions with more than two pores may alter the topology as suggested from ws characteristics 3 3 permeability results fig 9 summarizes in the graphical form all permeability computations performed using pnms extracted using the our and mib methods as well as voxel based fdmss software computations that we assume to be an accurate voxel based estimation gerke et al 2018b here based on our pore network extraction method we scanned α and w values in the range from 0 1 to 0 99 to explore the influence of partitioning parameters on permeability for three out of four samples both α model and w model scanning curves intersected the fdmss voxel based solution which means that it is possible to find a partitioning parameter within each model to obtain an accurate permeability value for the carbonate sample both curves lie above the fdmss solution except for the ceramic sample all mib solutions lie below the accuracy line let us consider each sample in more detail now in the case of the carbonate sample the 3d image quality is relatively low in terms of resolution and the main flow paths within the sample are controlled by very small throats consisting of a couple of voxels as was evident from simulated flow velocity fields see figures in supplementary materials for miao et al 2017 this could result in underestimations of permeability by voxel based fdmss simulations gerke et al 2018b in such case current observations would confirm the previous finding of miao et al 2017 and raeini et al 2017 that mib underpredicts permeability for low porosity samples our method seems to be less affected by low resolution than the other approach tested the voxel based fdmss simulations for the well resolved ceramic sample were previously found to be very accurate by comparison against laboratory measurements on this highly homogeneous artificial material gerke et al 2015c the permeability values of mib for this sample are higher than those of fdmss this agrees well with findings of raeini et al 2017 and general observations that mib underpredicts single phase flow properties for low porosity samples and overpredicts for highly porous images the accurate solution using w model partitioning in our method is achieved for w between 0 4 and 0 6 depending on the direction of the flow simulations in the α model the intersection with fdmss takes place for α between 0 8 and 0 9 for the soil and sandstone samples the situation with our results is similar to that of ceramic both partitioning models provide accurate permeability values for w between 0 3 and 0 6 sweet spot w moves slightly to the left for sandstone whereas α is solid between 0 8 and 0 9 in their recent work baychev et al 2019 found w 0 6 to agree best with voxel based simulations for their watershed based extraction approach which is slightly different from ws the mib method significantly underpredicts the permeability most notably mib permeabilities are always below the α curve for our method this could be explained by smaller throats that are not explicitly found as in our approach but estimated from inscribed sphere diameter and shape factor evaluated from surface area of the entire throat dong and blunt 2009 noting this and the shape of the α curve on fig 9 it seems that potentially mib based permeabilities could be matched to fdmss by simply decreasing α during mib extraction this idea is actually not new and was first shown for the w model by sholokhova et al 2009 but not for the α model for example based on fig 9 it is easy to see that the mib method with α 0 3 0 4 would produce permeabilities similar to fdmss for soil and sandstone samples for our method α 0 9 usually provides an accurate solution compared to the voxel based simulation value on the other hand the throat itself can be an element with say an hourglass shape harmonic mean approximation based on either the α or w model may work much better if we consider additional 2d planes along the median axis connecting two pore bodies but making such slices is computationally expensive it then appears that α or w parameters should not be fixed but rather depend on the overall pore shapes and aspect length ratios at the same time these could vary significantly within the same sample and it is an open question if a single partition parameter is good enough for a variety of pores according to our previous discussion in this case merging dividing of pores based on sensitivity to pore wall constrictions can affect permeability calculations because that changes partitioning and thus the hydraulic conductances the immediate question one could pose here is which partition is better the α or w model to address this question we begin by analysing hydraulic conductances predicted by these two models for pores of different shapes fig 10 note that supplementary materials contain the code in julia language bezanson et al 2017 which allows interactive exploration of these two models by changing pore throat parameters as explained in fig 2 we first note that both models produce the same results in case α w 0 this case can be interpreted as one where throat is nonexistent or very close to the size of the pores as can be verified by a tube like pore on fig 10a the small difference between conductances between 0 α w 1 is due to the rthroat 4 95 µm as models are nondefined for the case rthroat rpore1 rpore2 and in the limit of rthroat rpore1 rpore2 the hydraulic conductance is the same as analytical value for a circular capillary the case of α w 0 was not included in the analysis on fig 9 because this case is not represented in pore network models during extraction we locate throats as constricted connections between larger pores for parameters 0 the models deviate the length of the pores affects the value of the hydraulic conductances for both models but leaves their shapes intact at the point w 1 the throat fully controls the flow and thus represents all possible conductance variations the α model asymptotically converges to the w model in the limit of α this means that both models are actually similar in this limit but the w model is better for two reasons it is bounded by 1 from above and it does not require performing physical partitioning of voxels between pores and throats as in for example dong and blunt 2009 3 4 two phase flow results we now compare the results of two phase flow drainage simulations on pnms extracted with all three methods the resulting capillary curves and relative permeabilities for oil and water for four samples are shown in fig 11 note that in the case of our method α model with α 0 6 was used for simulations for comparison against the mib method the results provide some interesting insights on the difference between the discrete and continuous randomization pore size treatment inherent in these two methods first we note that capillary curves for low porosity carbonate and soil modeling using our pnm lie below mib curves and reach much lower capillary pressure the same is for ws curves this is easily explained by the pore throat size distributions figs 5 8 for these samples these two xct images have many small pores that get randomized radii within the mib framework whereas all original pore throat sizes preserve their radii within our and ws methodologies the same result was observed by gostick 2017 who compared capillary curves for berea sandstone on pnms extracted by ws and mib methods see fig 11 in his paper gostick 2017 also found that the capillary curve modeled using the voxel based morphological approach was almost the same as his ws based curve for the ceramic sample the match is perfect between all three methods because this sample contains only highly resolved pores that are closer to circular shape than in other samples for the other three samples carbonate soil and sandstone the curve based on pnm extracted using our method is sandwiched between ws below and mib above this is again easily explained by the throat radii statistics because current openpnm simulations do not track defending phase explicitly i e model mercury intrusion porosimetry the ws extracted networks all drain to zero saturation after accounting for unconnected porosity the agreement between irreducible saturations for carbonate and soil samples became quite close see slight disagreement for sandstone sample which was simulated by unmodified openpnm code the differences between termination capillary pressures for three pnms is due to randomization in the mib method and differences between the simulation stopping criteria in valvatne s and openpnm codes the ws method and our method that closely follow original 3d geometry and do not randomize pore throat sizes as in mib provide a ground truth simulation specific to quality and resolution of the image at hand the advantage of the randomization approach lies with more realistic looking capillary curves that drain to higher capillary pressures as real porous media samples may have complex hierarchical pore structure that cannot be captured by a single xct scan gerke et al 2015b karsanina et al 2018 we consider this to be a double edged sword on the one hand randomization adds information that is not available in the image and makes it more appealing especially when compared to experimental data a topic beyond the scope of this paper on the other hand randomization may mask extraction simulation inaccuracies and prevent progress in method development which requires multiscale image fusion or multiscale pnm modeling if now we look at relative permeabilities we observe qualitative similarity between our approach and mib regardless of similarity in capillary curves still one trend is obvious mib relative permeabilities for oil and water are generally lower than those for our pnms this highlights an important flaw of the continuous pore throat randomization approach it makes pore and throats smaller than in the ground truth 3d pore geometry and results in a significant difference in two phase flow properties in darcian scale applications depending on the absolute permeability of the sample we believe this effect to take place not purely due to element radii reduction which should affect permeability but not relative permeabilities but mainly due to changes in computed shape factors which degrade with resolution although randomization may artificially improve the overall look of the capillary curve and smoothness of all simulated curves in our opinion obtaining accurate results is more important this justifies the discrete approach of our methodology or of gostick 2017 which is even more relevant if simulations are performed on multiscale fused rock images gerke et al 2017 relative permeability curves for ws networks are very close to those of other two methods for the ceramic and sandstone samples but deviate for carbonate and soil the latter is mainly due to circular capillaries the success with two former samples actually suggests that the shape factor provides only marginal addition to modeling accuracy with valvatne s code which we attribute to insufficient development of current pnm models bondino et al 2013 baychev et al 2019 all in all here we conclude that two phase flow properties simulated on our ws and mib pnms agree surprisingly well considering very different pnm topology as revealed by euler number analysis and fully understood differences in pore throat sizes at the same time the deviations were explained due to discrete and randomization approaches or differences in pnm simulators openpnm ws framework currently treats all throats as circles and does not track entrapment for the defending phase the influence of the α parameter on the resulting two phase flow was found to be negligible due to insignificant difference in pore to throat volumes and thus not shown here see supplementary materials because the w model is a virtual partitioning for hydraulic conductance manipulations changing of w does not affect simulated capillary or relative permeability curves for the same reasons as for the α model 3 5 computational efficiency while extracting pore networks with three different methods we had an opportunity to compare computational efficiency of these algorithms this task however was complicated because different methods performed very differently for various samples porosities and domain sizes we were not able to obtain any meaningful quantitative picture e g fig 7 in gostick 2017 where he presented the time needed to perform major filtering morphological operation of the 3d image needed for pnm extraction thus we shall present very briefly a mainly qualitative comparison for very low porosity 3d images with small pores in voxels mib outperforms all other methods tested in cpu time needed on the mid range porosity pore size images all three algorithms show more or less similar results in terms of cpu time for highly porous samples 0 3 or images with large pores ws based methods start to outperform mib due to sphere inflation deflation based ball placement our maximal ball placement based on the distance map is much faster so potentially the computational efficiency of mib could be improved compared to ws our method starts to take more cpu time for larger 3d images due to numerous additional procedures e g cross section projections and analysis on average it took 1 2 h per sample in fig 1 in terms of ram mib is the most effective and scales less than watershed based methods with increasing domain volume our and ws methods are quite similar in ram requirements the extraction time and ram requirements can be significantly reduced by the use of a domain decomposition technique sizonenko et al 2017 all testing was performed using a regular desktop workstation with 128 gb of ram 3 6 general discussion and outlook in our quest to verify the hybrid inscribed balls watersheds extraction method we found that conventional metrics usually utilized for this purpose are not necessarily enough for the task in particular it turned out that a simple metric in the form of euler number computed for each pnm clearly indicated that all studied pore networks were different in terms of their topology this finding was not originally evident from the connectivity statistics alone it seems that all geometrical and topological parameters during pnm extraction are nontrivially interconnected and such connections were hard to uncover for complex porous media samples studied here a potentially useful approach is to create artificial pore geometries with known topological and geometrical measures with complexity beyond sphere packings as was recently proposed by baychev et al 2019 comparison against the ws extraction method poses an important question that we are not able to answer here can we effectively merge pore network elements to reduce the total number of pores throat without or with insignificant loss of flow modeling accuracy it may be quite so at least for quasi static simulations where the smallest throats will define the shape of all curves however if we imagine simulations in highly inhomogeneous wettability conditions the answer to the question may change radically the same is true for dynamic pore network models where simultaneous drainage imbibition processes can be influenced significantly even by relatively small bumps in pore wall geometry another interesting observation immediately following from eq 7 is that adding additional pore and throat due to sensitivity of our algorithm to small bumps on the pore walls should not change the topology of the pore network this topic is well beyond the scope of this work but this is an area to explore in future one interesting observation from simulations for ws networks on fig 11 is that merging of pore bodies due to filtering of watershedding seeds reduces the resolution of simulations simulation points are far apart within intermediate saturation range for sandstone and ceramic samples which happens due to cumulative filling of larger pores of the same size this may be also affected by the circular capillaries in ws extracted pnms they do not drain incrementally as for example triangular capillaries do but if this does not affect modeling accuracy much merging can reduce computational effort whether a trade off between accuracy and accelerated computations can be found for pore merging is still an open question other future work may target exploring permeability prediction accuracy based on direct flow simulations and artificial intelligence in 3d to predict pore network element conductances as was recently proposed by miao et al 2017 it seems to be very important to rigorously verify or reject harmonic mean approximation especially considering its dependence on the partition model and potential dependence of partition parameters on local pore geometry it is still an open question if we can predict conductances based on 2d cross sections or we need to perform 3d simulations sholokhova et al al 2009 rabbani and babaei 2019 in our pore network extraction results we clearly observed intersecting throats kim et al 2013 although this demonstrates that our extraction methodology is quite advanced to account for such intersecting throats would require considerable additional development of the multiphase flow pore network codes to our knowledge no such code exists at the moment such improvements in pnm technology will clearly require a substantial effort in future research our study has four obvious drawbacks first although we covered a wide variety of materials relevant to earth sciences we did not explore high porosity porous media such as foams fibrous materials and such gostick 2017 we hope to consider applications to such materials in future the second drawback is the problem of merging throats which we do when two pores are connected by more than two throats see example on fig 2 we adopted this simple merging shortcut because valvatne s code is unable to handle such situations we believe a more evolved pore network simulator is needed to be developed to account for intersecting throats and numerous connections between pores because modifying valvatne s code does not seem to be a reasonable alternative bondino et al 2013 miao et al 2017 raeini et al 2018 baychev et al 2019 third we were unable to explicitly explain the differences in topology between different pnm extraction methodologies as was revealed by euler number analysis as connectivity distributions showed visual similarity finally we did not explore median axis based algorithms in our previous work we developed a hybrid mib ma algorithm miao et al 2017 but we observed some topological artefacts with this approach this is pretty much in line with the mib and ma comparison presented by silin and patzek 2006 or observations of prodanović et al 2007 this may be due to the fact that the majority of ma based algorithms utilized thinning algorithms to establish the median axis lee et al 1994 it may be possible to improve the topology of the ma extraction by utilizing persistent homology instead delgado friedrichs et al 2014 a rigorous pore network extraction survey as a result of a collaboration of researchers developing different methods may be needed to shed some light on possible topological issues 4 summary in this contribution we developed a novel hybrid pore network extraction method based on maximal inscribed balls and watershed segmentation this hybrid method allowed placing seeds necessary for the watershed algorithm into exact pore body positions which we think improves the geometrical sensitivity and fidelity of the pore network extraction and which enables avoiding saddle point maximum and gaussian blur filtering on distance maps prior to watershedding we rigorously verified our new method on artificial sphere packings with analytically known pore network parameters moreover we compared our pnms against two other popular approaches based purely on maximal balls and watersheds during intercomparison with other extraction methods some large differences were observed between pnms based on numerous geometrical and topological characteristics such as pore throat size euler numbers and connection number distributions although it is possible to explain some of the observed variations as related to 3d pore geometry connectivity differences in how the three methods analyse pore cross sections and the sensitivity of the method to local narrowing of the pore walls our intercomparison of extraction techniques highlighted some major problems with the metrics utilized for such studies simulated two phase flow parameters were found to be in surprisingly good agreement between different pnms for single phase flow we observed the possibility of obtaining good predictions with any methodology but this would require tuning the pore throat partitioning approach the severe topological differences between studied extraction methodologies in terms of euler characteristics may indicate that current multiphase flow physics in pore network simulators is insufficient to describe all relevant processes our finding highlights the necessity to develop robust geometry and topology verification standards beyond simple sphere packings to make sure that current and future extraction techniques do provide adequate simplifications of the pore space we compared two existing pore to throat partitioning models for the first time and concluded that although they are essentially the same the w model is physically more rigorous because it is bounded not only from below but also from above 0 w 1 α model asymptotically converges to w 1 at α and does not require actual partitioning i e does not have explicit throat length author contributions k m g and v v a conceived this research k m g and t o s developed the methodology idea and design t o s m v k and k m g implemented this methodology into c code d v k performed xct scanning k m g processed all xct images e v l performed all openpnm extractions and simulations and processed its results k m g performed most of the simulation and data processing and wrote the manuscript k m g m v k and t o s prepared graphical results all authors reviewed the final version of the paper declaration of competing interest authors declare no conflict of interests acknowledgments the authors thank schlumberger moscow research for the permission to publish this research we are grateful to susan duffield for improving the readability of this manuscript we are indebted to prof jeff gostick for the help with establishing openpnm simulations k m g thanks prof hans jörg vogel and dr ulrich weller for very fruitful discussions on pore network topology issues four anonymous reviewers especially reviewer 2 are gratefully acknowledged for insightful and very useful comments which helped in improving this paper 
494,the estimation of drag exerted by vegetation is of great interest because of its importance in assessing the impact of vegetation on the hydrodynamic processes in aquatic environments in the current research genetic programming gp a machine learning ml technique based on natural selection was adopted to search for a robust relationship between the bulk drag coefficient cd for arrays of rigid circular cylinders representing emergent vegetation with blockage ratio ψ vegetation density λ and pore reynolds number rep based on published data we utilize a data set covering a wide range of each parameter involved to cover all possible dependencies a new predictor which shares the same form with the ergun derived formula was obtained without any pre specified forms before searching the dependence of the two parameters in ergun equation on vegetation characteristics was also estimated by gp this new cd predictor for emergent vegetation with a relatively concise form exhibits a considerable improvement in terms of prediction ability relative to existing predictors keywords drag coefficient genetic programming vegetated flows estimating drag cylinder arrays 1 introduction aquatic vegetation plays an important role in river ecosystems and greatly influences hydrodynamics processes within aquatic environments because of the additional resistance exerted by emergent and submerged vegetation etminan et al 2017 green 2006 huai et al 2012 nepf 1999 stoesser et al 2010 the additional drag caused by vegetation may considerably reduce the flow velocity of the river raise the water level and increase the risk of flooding moreover by modifying the velocity profiles and turbulence structures in vegetated channels the aquatic vegetation helps to reduce sediment erosion and suspended transport thus a comprehensive understanding of vegetation resistance is essential to the assessment of the impact of vegetation on these hydrodynamic processes in aquatic environments many researchers have a strong interest in the estimation of the drag generated by vegetation because of its great significance in ecological and environmental engineering mattis et al 2012 tang et al 2014 in the past few decades research on vegetation drag has mostly been carried out in laboratories given the complex geometry of real vegetation in the field aquatic plants are usually modeled as an array of rigid circular cylinders with uniform diameter d this simplified geometry of real vegetation has been widely recognized by most researchers hamidifar et al 2016 li et al 2018 li and zeng 2009 liu et al 2008 the effect of canopies on the flow is mainly determined by the additional resistance which can be quantified by the drag coefficient defined as 1 c d f d 1 2 ρ a u r e f 2 where fd is the vegetation induced drag ρ is the water density a is the frontal area of the vegetation stems in the case of an isolated circular cylinder a dl l is the length of the cylinder immersed in water and uref is a reference flow velocity usually the mean velocity approaching the cylinders is used as the reference velocity which is equal to the upstream free flow velocity in the case of an isolated cylinder for emergent vegetation given the impact of vegetation distribution using upstream free flow velocity herein referred as bulk flow velocity u as the reference velocity may be reasonable only for very sparse vegetation however the mean pore velocity up u p u 1 λ q w h 1 λ is closer to the flow velocity that is actually approaching the vegetation stems than the bulk flow velocity because the time averaged longitudinal flow velocity is almost uniform in the vertical direction within emergent vegetation liu et al 2008 here w is the width of the channel q is the channel flow rate λ is the dimensionless vegetation density λ π n d 2 4 where d is cylinder diameter and n is the number of cylinders per unit bed area therefore in most studies the mean pore velocity up is typically used as the reference flow velocity kothyari et al 2009 tanino 2012 tanino and nepf 2008 1 1 existing measurements of cd usually the drag coefficient cd for emergent vegetation is obtained from laboratory experiments either by directly measuring the drag forces using load cells strain gauges or by equating driving forces with resistance caused by cylinders the first method includes two forms in one form the drag force generated by the hole cylinder array is directly measured with a drag plate tinoco and cowen 2013 see fig 1 b which can better reflect the bulk drag characteristics of the array obviously the resistance measured by this method includes vegetation and bed resistance in the numerical simulation results of stoesser et al 2010 bed shear stress only accounts for approximately 0 82 6 of the total flow resistance thus bed resistance can be completely ignored however the disadvantage of this method is the relatively high requirement for experimental equipment a simpler alternative method is to measure the drag force generated by a single cylinder in the array ishikawa et al 2000 kothyari et al 2009 van rooijen et al 2018 see fig 1 a that is we only need to select one cylinder in the area where the flow is fully developed to measure its drag and use it to represent the drag characteristic of the entire cylinder array more details about these two different methods can be found in tinoco and cowen 2013 and kothyari et al 2009 respectively when the drag force is measured cd can be obtained from eq 1 when the experimental conditions do not allow the direct measurement of the drag force cd can be derived from the force balance per fluid mass within the vegetated channel which can be expressed as nepf 1999 2 1 λ c b u p 2 1 2 c d a h u p 2 g h 1 λ η x where the first term on the left is the resistance exerted by the channel bed with a bed friction coefficient cb the second term on the left is the drag force contributed by the vegetation stems λ is vegetation density a is frontal facing area for circular cylinders λ π a d 4 and a nd h is flow depth g is acceleration due to gravity up is mean pore velocity x is the streamwise direction and η is water surface elevation as mentioned above the bed shear stress only accounts for 0 82 6 of the total flow resistance therefore the first term on the left of eq 2 can be omitted then cd can be written as 3 c d 2 g s 1 λ a u p 2 where s is the energy slope s η x obviously when the uniform flow condition is reached in the experiment s is just equal to the bottom slope of the channel e g cheng and nguyen 2011 james et al 2001 2004 kim and stoesser 2011 for non uniform flow when the channel bed is horizontal s is equal to h x e g ferreira et al 2009 meftah and mossa 2013 nepf 1999 tanino and nepf 2008 tanino 2012 moreover drag coefficient can also be obtained directly from high resolution numerical simulations such as wall resolving large eddy simulation les and direct numerical simulation dns chang et al 2018 etminan et al 2017 nicolle and eames 2011 stoesser et al 2010 1 2 existing predictors of cd however physical measurements and numerical simulation approaches are often unavailable or infeasible for the practical application of ecological and environmental engineering therefore cd must be estimated researchers have approached the study of estimating drag coefficient for emergent vegetation from different angles pure theoretical derivation meftah and mossa 2013 regression analysis on the basis of a pre given form obtained from theoretical derivation sonnenwald et al 2017 2018 tanino and nepf 2008 and multi parameter regression analysis without any physical basis kothyari et al 2009 the drag coefficient predictor for an isolated cylinder is well established which can be expressed as white 1991 4 c d 1 10 r e 2 3 where the cylinder reynolds number is r e ρ u d μ μ is dynamic viscosity note that for an isolated cylinder λ 0 i e u up however the flow structure in a multi cylinder array is much more complicated than the flow structure around a single isolated cylinder because of the strong wake wake interaction and wake cylinder interaction especially when the vegetation density is not very small thus eq 4 may not be directly used to estimate the drag coefficient of the multi cylinder array based on eq 4 different cd predictors for cylinder array can be obtained by defining reynolds number and drag coefficient with various velocity and length scales i e reference velocity and reference length in emergent canopies as mentioned above previous researches have chosen the reference velocity scale to be the mean pore velocity up however through les etminan et al 2017 found that the constriction cross section velocity uc is the velocity scale that actually governs wake pressure and thus vegetation resistance therefore etminan et al 2017 and van rooijen et al 2018 expressed the canopy drag coefficient using the new velocity scale as 5 c d c 1 10 r e c 2 3 where cd c and rec are the canopy drag coefficient and cylinder reynolds number based on uc u c 1 λ u p 1 4 λ β π u 1 d l y β is the ratio of the lateral distance between adjacent stems at the same streamwise location ly to the distance between two rows of vegetation stems in the streamwise direction lx as is shown in fig 5 further cheng 2013 re fitted the empirical formula of the cd for an isolated circular cylinder using the available experimental data subsequently a pseudofluid model is developed to define a non dimensional cylinder diameter d 2 c d r e p 2 π 1 3 with this new dimensionless cylinder diameter cheng 2013 extended the drag coefficient formula that was used for an isolated cylinder to the cylinder array finally the drag coefficient formula for cylinder array can be written as 6 c d 11 1 s r e p 1 80 λ 0 75 0 9 1 exp 1000 1 80 λ 1 s r e p 1 2 1 exp 1 s r e p 4500 1 80 λ 0 7 1 s 1 λ where rep is cylinder reynolds number based on the mean pore velocity up and cylinder diameter d i e r e p ρ u p d μ as mentioned above by using different velocity and length scales to define reynolds number and drag coefficient different cd predictors can be obtained etminan et al 2017 and van rooijen et al 2018 redefined reynolds number and cd using a new velocity scale uc and obtained eq 5 similarly cheng and nguyen 2011 proposed a new length scale vegetation related hydraulic radius rv to characterize vegetated channels the new reynolds number defined with the new length scale is written as 7 r e v ρ u p r v μ π 1 λ 4 λ r e p where r v π 1 λ d 4 λ with this new reynolds number rev cheng and nguyen 2011 proposed a best fit function to empirically describe the relationship of cd and rev based on existing experimental data of cd the best fit function can be expressed as 8 c d 50 r e v 0 43 0 7 1 exp r e v 15000 ergun 1952 proposed an expression for pressure drop in packed columns and tanino and nepf 2008 related this expression to drag coefficient giving 9 c d 2 α 0 r e p α 1 where α 0 and α 1 are coefficients describing the viscous contribution that arises from the viscous shear stress on the cylinder surface and the inertial contribution that arises from the pressure loss in the cylinder wake respectively sonnenwald et al 2018 re parametrized α 0 and α 1 in terms of λ and d based on least squares curve fitting using available experimental data then they obtained a new function for estimating cd 10 c d 2 6475 d 32 r e p 17 d 3 2 λ 0 5 where the coefficients of the d terms must have units m 1 to retain dimensionless tanino and nepf 2008 tinoco and cowen 2013 and sonnenwald et al 2017 obtained different expressions with similar forms which are not listed here kothyari et al 2009 using their experimental data proposed a cd predictor by multi parameter regression analysis without considering any physical background written as 11 c d 1 53 1 0 45 ln 1 100 λ r e p 3 50 obviously all drag coefficient predictors mentioned above were developed with data driven methods such as regression analysis or curve fitting with pre specified forms however they were obtained with a relatively limited variable space and not physically sound so they can only perform well in some certain cases as discussed in section 3 2 when extrapolated to conditions outside the sampled parameter space it often produces absurd drag coefficient values or makes the predictors meaningless e g eqs 8 and 10 generally researchers analyze the dependence of drag force on flow parameters and vegetation geometry and then subjectively suggest the variables that may affect cd and even further subjectively suggest an analytical expression i e giving a pre specified form of cd predictor sonnenwald e al 2017 2018 this means that the predictive ability of the model is closely related to the reasonableness of the subjective suggestion for instance sonnenwald et al 2018 pre specified that the cd predictor has the ergun like form and considered that α 0 was linearly related to d and α 1 was linearly related to d and λ then a drag coefficient model with mixed dimensional and non dimensional parameters was obtained however it may lead to ridiculous cd values considering a large cylinder with 1 m diameter which is dangerous moreover several predictors developed by traditional multi parameter regression methods are very complicated and not physically interpretable e g eqs 6 8 and 10 which is not conducive to our further understanding of the influence mechanism of flow variables and vegetation geometry on drag force however a more advanced data driven method machine learning ml technique enables the exploration of all possible relationships among variables in complicated phenomena on the basis of a provided data set in present research we utilize genetic programming gp an ml technique based on natural selection to develop a predictor of drag coefficient for emergent vegetation directly from the experimental data that have been published before compared with the conventional data driven methods mentioned above gp does not require researchers to make relatively subjective analysis of the data set it is based on the principle of natural selection to automatically find all possible relations between the variables and only retains the solutions with higher accuracy in the evolving process instead of needing researchers to subjectively suggest a possible expression of drag coefficient on flow variables and vegetation features at the same time the gp algorithm can take all variables into the development of a predictor while leaving the task of identifying related variables to the program wang et al 2017 in contrast as mentioned above the conventional regression methods usually rely on the researchers subjective suggesting nevertheless the current understanding of the influence mechanism of drag force is not yet sufficient as a result these subjective suggestions will lead to a poor predictor while the gp algorithm can well avoid the subjective suggesting from researchers furthermore since the time used to analysis the data set manually is greatly reduced in gp more time can be devoted to explore the physical background of cd tinoco et al 2015 wang et al 2017 thus the solution given by gp is simple in form and physically sound thus having good performance in this study a well documented and widely tested gp software eureqa schmidt and lipson 2013 which has been successfully applied to the studies of vegetated flow huai et al 2018 tinoco et al 2015 wang et al 2017 is used to find a new predictor without any pre specified forms in contrast to previous data driven methods which pre specify a form and proceed to find the optimal relationship through regression analysis e g sonnenwald et al 2017 2018 tanino and nepf 2008 tinoco and cowen 2013 2 methods 2 1 data pre processing laboratory experiments usually cannot explore a wide range of variables in a single research due to the limitations of cost and experimental conditions in order to avoid the common problem of developing a new predictor calibrated to a single data set which performs better than other models on that single data we use multiple data sets we collected a large number of observed data from 10 researches to cover a spacious parameter space as seen in table 1 and fig 2 in all studies smooth rigid circular cylinders were used to represent the emergent vegetation several data points from cheng and nguyen 2011 were removed because of abnormal cd values cheng and nguyen 2011 and cheng 2013 also omitted these odd data finally 475 data points were actually used in present study according to previous studies the major parameters affecting the drag coefficient of emergent vegetation cd are 12 f 1 c d d l x l y u p μ ρ λ ξ 0 where lx is the distance between two rows of vegetation stems in the streamwise direction ly is the lateral distance between adjacent stems at the same streamwise location ξ is a dimensionless coefficient representing the cylinder distribution pattern and f is function note that for random arrays as can be found in nature lx and ly may vary significantly within the array we just assume that lx is equal to ly in the whole random cylinder array that is lx and ly are array averaged values in eq 12 this treatment has also been adopted by etminan et al 2017 and van rooijen et al 2018 here by choosing d ρ and up as fundamental variables the following functional relationship is obtained 13 f 2 c d d l x d l y ρ u p d μ λ ξ 0 note the fact that the fourth parameter is the cylinder reynolds number rep and the second parameter can be obtained by combining the third parameter with the vegetation density λ here we define the blockage ratio ψ d l y which reflects the blockage effect in a multi cylinder array etminan et al 2017 linder 1982 van rooijen et al 2018 cheng and nguyen 2011 showed that the drag coefficients of randomly distributed cylinders slightly differed from those of staggered cylinders at the same rev i e for the same λ and rep however at similar vegetation fraction and cylinder reynolds number large cd values are expected in a staggered distribution than square distribution when vegetation stems are square arranged the downstream stem directly locates in the wake of the upstream stem thereby making the sheltering effect stronger than that of the staggered distributed stems and lowering the drag etminan et al 2017 nepf 1999 however as shown in table 1 the experimental data used in present research only include random and staggered distribution therefore just like cheng 2013 and sonnenwald et al 2018 the effect of vegetation configuration on cd is not considered here then eq 13 reduces to 14 c d f 3 ψ λ r e p as can be seen from fig 2 the data bank used in present research covers a broader range of the parameter space especially the vegetation density than the data banks in previous studies it is worth emphasizing that 1 cd and rep in our study use mean pore velocity up as reference velocity and 2 the gp routine is used in our study to find possible relationships between cd and ψ λ and rep without any pre specified forms 2 2 data selection similar to other gp based software eureqa requires the classification of our 475 experimental data into three separate groups training validation and testing set training set was used to generate individual subexpressions which are compared against the validation data according to the fitness function i e the specified error metric the testing data served as an independent group to test the new formula against other existing predictors and remained unseen by the gp algorithm given that a subset of data must be selected to feed the gp algorithm as training and validation there is an inherent risk of leaving out data that are representative of certain regions of the parameter space consequently an appropriate selection method is necessary to the development of a new predictor here the maximum dissimilarity algorithm mda developed by camus et al 2011 was used to select the training set tinoco et al 2015 riahi madvar et al 2019 huai et al 2018 and wang et al 2017 also used mda in their studies of vegetated flow the detailed steps of mda can be found in wang et al 2017 to the best of our knowledge a unique standard for the number of data points in each group is not yet available as long as the training set can well represent the full parameter space however it should be noted that a lower precision formula will outcome because of noise when the training set is extremely small conversely an extremely large training group may render the formula complicated and results in over fitting therefore we selected 20 of the data set for training 40 of the data set for validation and 40 of the data set for testing the same grouping strategy was also used by tinoco et al 2015 once the training data bank was selected by mda data selection for the validation and testing groups follows a random distribution using a random permutation algorithm the modern version of fisher yates shuffle algorithm was used to generate the validation and testing groups fig 3 shows the selection results for each group as seen in fig 3 the selected data in the training group can effectively cover the densest regions as well as the periphery of the space when the mda algorithm was used to select 20 of the data bank as the training group meanwhile it shows that cd is positively correlated with ψ and λ but negatively correlated with rep 2 3 gp algorithm eureqa was used to find formulas with the mda selected data each candidate solution was evaluated by using the fitness functions during formula searching we evaluated formulas according to their ability to minimize mean square error mse and mean absolute error mae between the observed and predicted values in addition eureqa considers a complexity criterion the complexity of the formula increases with the number of variables coefficients and types of numerical operation the formula contains in the searching process only the predictor with a smaller error will survive when the complexity is the same therefore the result of eureqa is a series of solutions that vary in complexity and have different errors usually error decreases as the complexity increases nonetheless extremely complex formulas have no physical meaning whereas extremely simple formulas have large errors the final solution must be selected from all surviving solutions through balancing the complexity performance and physical meaning in this study the following criteria were used for the selection of the final solution from the formulas provided by eureqa 1 the accuracy of the selected formula does not increase significantly at increased complexity 2 complexity should not be extremely large otherwise it does not have clear physical meaning and more like the result of over fitting thus it cannot be extended to the data outside the data bank used in gp algorithm 3 no matter what parameters values i e ψ λ and rep are input as long as they are reasonable the values of cd should not be negative or infinite 3 results and discussion 3 1 results after evaluating 4 6 1011 formulas only 7 formulas survived with 1 as the smallest size and 37 as the largest size table 2 subsequent runs showed that even when more formulas were evaluated solutions with the same forms were obtained though their coefficients may vary slightly as shown in table 2 the most complicated formula with a complexity of 37 is the best drag coefficient predictor in terms of mae and mse however its high complexity is likely to be the result of statistical artifacts and without any clear physical meaning the formula with a complexity of 26 generates a negative cd value when vegetation density is large than 0 7 meanwhile when λ 0 the fifth term on the right side of the formula with a complexity of 26 has no meaning although the data bank we used does not contain drag coefficient values for the isolated cylinder cases λ 0 the formula should remain meaningful when λ 0 because zero is a physically reasonable λ value fig 4 shows the pareto front where the relationship between accuracy and complexity is described in general accuracy increases with complexity and the increasing rate decreases as the complexity increases however the increase becomes inconsiderable when the complexity is greater than 14 at the same time it also can be seen from table 2 that the complexity of the formulas significantly increases only when the complexity is larger than 14 that is when the two formulas with complexities of 26 and 37 are discarded accuracy becomes the primary consideration in the selection of the final predictor thus we selected the formula with a complexity of 14 as the final predictor 3 2 discussion the final formula we chose is written as 15 c d 189 r e p 0 82 ψ 2 6 02 λ interestingly the expression given by eureqa has the same form as that given by ergun 1952 eq 9 although there were no pre specified forms before the searching for solutions in fact the solutions given by the gp algorithm all have ergun forms when the complexity is greater than 5 see table 2 accordingly α 0 and α 1 can be expressed as 16 α 0 94 5 17 α 1 0 41 0 5 ψ 2 3 01 λ the viscous term α 0 is constant and appears to be independent of cylinder array characteristics and this observation is consistent with the conclusions of tanino and nepf 2008 the value of α 0 given by the gp algorithm is close to that of tanino and nepf 2008 α 0 85 15 in their research moreover α 1 increases linearly with λ and this increase means that the inertial contribution inertial drag effect increases with λ at a given rep this dependence is consistent with tanino and nepf 2008 tinoco and cowen 2013 and sonnenwald et al 2017 2018 according to tanino 2012 the observed increase in α 1 with increasing λ can be attributed in part to the increasing spatial variance of time averaged longitudinal velocity with increasing λ unlike previous researches eq 17 shows that α 1 is not only related to λ but also to the blockage ratio ψ that is the inertial drag increases with the increase of blockage ratio at a given λ this dependence of α 1 on ψ is not surprising we just consider the two different cylinder array distribution patterns as shown in fig 5 obviously the two distributions share the same λ whereas the blockage ratio of pattern a is much larger than that of pattern b then the blockage ration ψ affects the inertial resistance from the following two aspects on one hand the local flow velocity around the cylinders significantly increases and a jet like rapid flow forms between two laterally adjacent cylinders because the presence of the obstacles reduces the cross sectional area the jet like rapid flow outside the wake not only confines the widening of the cylinder wake but also reduces the pressure within the wake thus significantly increases the inertial drag this is the so called blockage effect and it is obvious that this effect is stronger as the blockage ratio increases on the other hand when the vegetation density λ is fixed the larger ψ the larger lx as a result the downstream cylinder is less affected by the wake of the upstream cylinder that is the sheltering effect is weaker thus the drag force is greater in fact the cd predictors of etminan et al 2017 and van rooijen et al 2018 also show that cd is positively correlated to ψ in general the new predictor obtained from eureqa has good physical meaning fig 6 shows the predicted cd from the existing predictors described in section 1 2 and eq 15 plotted for a range of rep a representative selection of λ for each density eq 15 was used to estimate cd with a small ψ value as well as a large ψ value to show the effect of ψ on cd at λ 0 02 and rep 300 two ergun based predictors i e eqs 10 and 15 give relative large cd values while other predictors produce smaller cd however all functions provide similar cd values for rep 300 as λ increases λ 0 05 in fig 6 the differences between the cd values estimated by each function become smaller at rep 200 while greater at rep 200 especially for eqs 15 and 8 cheng and nguyen 2011 it should be noted that eqs 5 and 11 van rooijen et al 2018 kothyari et al 2009 still produce similar underestimates of cd even at λ 0 1 conversely cheng s 2013 formula overestimates cd values than other formulas for the gp model i e eq 15 it can be seen that the ψ value has a smaller effect on cd when λ 0 05 at the same time for the same λ the effect of ψ on cd increases with the increase of rep this is because when λ is small the flow structure within the multi cylinder array is similar to the flow around an isolated cylinder that is the blockage effect and the sheltering effect are relatively weak for the same λ the contribution of inertial resistance increases with rep so the effect of ψ on cd also increases with rep 3 3 comparison of the predicted cd values against experimental results given that the selection of error metrics may affect the evaluation results of model performance that is a formula that performs well when a certain error metric is used which may perform poorly when other error metrics are used we used multiple error criteria to evaluate the predictive ability of each cd predictor accuracy metrics including the mse mean relative error mre mae coefficient of determination r2 and discrepancy ratios dr were used to evaluate the performance of the new predictor obtained from eureqa and previous formulas meanwhile model performance was assessed with the taylor diagram taylor 2001 which presented the standard deviation std centered root mean square difference rmsd and correlation coefficient r between the measured and estimated cd values zeng and huai 2014 suggested to use the percentage of dr values between 0 3 and 0 3 to evaluate the performance of a predictor table 3 shows the comparison of the accuracy of eq 15 with those of predictors from other researches described in section 1 2 the comparison of predicted versus observed cd is also shown in fig 7 note that the drag coefficient values of van rooijen et al 2018 cd c have been converted to cd based on the relationship between up and uc as can be seen from table 3 and fig 7 the predictor obtained from the gp algorithm in this study performs better than other formulas regardless of which metric was used for each group all other predictors however failed to do so for instance the predictive ability of cheng s 2013 formula was better than the formulas by sonnenwald et al 2018 van rooijen et al 2018 and kothyari et al 2009 in terms of mre however it yielded low accuracy in terms of mae and mse fig 7 shows that in addition to eq 15 previous predictors have no ability to predict the cd values for idealized emergent vegetation accurately at low reynolds number as can be seen from fig 3 the low reynolds number corresponds to a larger cd value sonnenwald et al 2018 van rooijen et al 2018 and kothyari et al 2009 underestimated cd whereas cheng 2013 and cheng and nguyen 2011 overestimated which is consistent with fig 6 the poor performance of these formulas at low reynolds number was also reported by sonnenwald et al 2018 conversely given that the data bank used in current research contains a large number of data points at low rep see fig 2 the predictor generated by the gp algorithm can better estimate the drag coefficient for the low rep case the r2 for all formulas are insufficiently high because the measurement of cd in laboratory experiments has great uncertainties taylor diagrams fig 8 are usually used to evaluate the performance of multiple predictors riahi madvar et al 2019 taylor 2001 the azimuth angle in taylor diagram indicates the correlation coefficient r between the observed and estimated values the radial distance between estimates and the origin represents std while the distance from the observations to the estimates shows rmsd the implication of taylor diagram is that the closer model predictor accuracy indices to the observations the better the predictor performance fig 8 shows the taylor diagram based on training validation testing and all data groups which indicates that the gp predictor has a significant improvement in the cd prediction for idealized emergent vegetation especially compared with the formulas of cheng 2013 van rooijen et al 2018 and kothyari et al 2009 as shown in figs 7 and 8 the predictors provided by cheng and nguyen 2011 and sonnenwald et al 2018 nearly have the same performance as the predictor provided by eureqa when certain error criteria were used such as mre r2 and rmsd however the performance of the formulas of sonnenwald et al 2018 and cheng and nguyen 2011 may not be as good as those shown above in practical application because most of the data points contained in the present study have been used to fit the cd predictors of those studies i e eqs 8 and 10 for instance 57 and 88 of the data in the testing set were used by sonnenwald et al 2018 and cheng and nguyen 2011 respectively whereas the entire testing group were unseen by the gp algorithm even so the gp formula still has an obvious advantage in terms of mae mse and dr for testing set in general the cd predictor for idealized emergent vegetation obtained by the gp algorithm in current study has better prediction ability than the existing predictors however the new predictor has only been tested in the range of 0 003 λ 0 35 0 044 ψ 0 66 and 25 rep 4000 and care should be taken applying it outside of this range although a wide parameter space has been included in our data set especially it should be noted that nepf 1999 reports the opposite λ dependence of cd at rep 4000 4 summary and conclusion in the present study the genetic programming gp algorithm was used to develop a new predictor of drag coefficient for idealized emergent vegetation on the basis of existing experimental data among all the solutions provided by the gp software eureqa the final expression of cd was selected by balancing the complexity accuracy and physical meaning although without any pre specified forms before searching a solution that agrees with ergun s 1952 formula in form was obtained the method used differs from previous data driven methods which pre specify a form and proceed to determine the optimal relationship through regression analysis the inertial contribution to cd α 1 increases not only with λ but also with ψ because of the blockage effect and the sheltering effect however the viscous contribution α 0 is constant and appears to be independent of cylinder array characteristics this new predictor of cd for emergent vegetation with a physical basement exhibits a considerable improvement in terms of prediction ability compared with the existing predictors regardless of which error metric was used meanwhile it also has a relatively concise form and is easy to use declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper credit authorship contribution statement meng yang liu conceptualization methodology software validation formal analysis investigation writing original draft writing review editing visualization wen xin huai conceptualization methodology writing review editing supervision project administration funding acquisition zhong hua yang writing review editing supervision yu hong zeng writing review editing acknowledgements the authors would like to thank y tanino and a van rooijen for providing the drag coefficient data from their experiments comments and suggestions made by the editor dr g c sander associate editor dr r ferreira and reviewers have greatly improved the quality of the paper the work was supported by the national natural science foundation of china grant numbers 11872285 and 11672213 
494,the estimation of drag exerted by vegetation is of great interest because of its importance in assessing the impact of vegetation on the hydrodynamic processes in aquatic environments in the current research genetic programming gp a machine learning ml technique based on natural selection was adopted to search for a robust relationship between the bulk drag coefficient cd for arrays of rigid circular cylinders representing emergent vegetation with blockage ratio ψ vegetation density λ and pore reynolds number rep based on published data we utilize a data set covering a wide range of each parameter involved to cover all possible dependencies a new predictor which shares the same form with the ergun derived formula was obtained without any pre specified forms before searching the dependence of the two parameters in ergun equation on vegetation characteristics was also estimated by gp this new cd predictor for emergent vegetation with a relatively concise form exhibits a considerable improvement in terms of prediction ability relative to existing predictors keywords drag coefficient genetic programming vegetated flows estimating drag cylinder arrays 1 introduction aquatic vegetation plays an important role in river ecosystems and greatly influences hydrodynamics processes within aquatic environments because of the additional resistance exerted by emergent and submerged vegetation etminan et al 2017 green 2006 huai et al 2012 nepf 1999 stoesser et al 2010 the additional drag caused by vegetation may considerably reduce the flow velocity of the river raise the water level and increase the risk of flooding moreover by modifying the velocity profiles and turbulence structures in vegetated channels the aquatic vegetation helps to reduce sediment erosion and suspended transport thus a comprehensive understanding of vegetation resistance is essential to the assessment of the impact of vegetation on these hydrodynamic processes in aquatic environments many researchers have a strong interest in the estimation of the drag generated by vegetation because of its great significance in ecological and environmental engineering mattis et al 2012 tang et al 2014 in the past few decades research on vegetation drag has mostly been carried out in laboratories given the complex geometry of real vegetation in the field aquatic plants are usually modeled as an array of rigid circular cylinders with uniform diameter d this simplified geometry of real vegetation has been widely recognized by most researchers hamidifar et al 2016 li et al 2018 li and zeng 2009 liu et al 2008 the effect of canopies on the flow is mainly determined by the additional resistance which can be quantified by the drag coefficient defined as 1 c d f d 1 2 ρ a u r e f 2 where fd is the vegetation induced drag ρ is the water density a is the frontal area of the vegetation stems in the case of an isolated circular cylinder a dl l is the length of the cylinder immersed in water and uref is a reference flow velocity usually the mean velocity approaching the cylinders is used as the reference velocity which is equal to the upstream free flow velocity in the case of an isolated cylinder for emergent vegetation given the impact of vegetation distribution using upstream free flow velocity herein referred as bulk flow velocity u as the reference velocity may be reasonable only for very sparse vegetation however the mean pore velocity up u p u 1 λ q w h 1 λ is closer to the flow velocity that is actually approaching the vegetation stems than the bulk flow velocity because the time averaged longitudinal flow velocity is almost uniform in the vertical direction within emergent vegetation liu et al 2008 here w is the width of the channel q is the channel flow rate λ is the dimensionless vegetation density λ π n d 2 4 where d is cylinder diameter and n is the number of cylinders per unit bed area therefore in most studies the mean pore velocity up is typically used as the reference flow velocity kothyari et al 2009 tanino 2012 tanino and nepf 2008 1 1 existing measurements of cd usually the drag coefficient cd for emergent vegetation is obtained from laboratory experiments either by directly measuring the drag forces using load cells strain gauges or by equating driving forces with resistance caused by cylinders the first method includes two forms in one form the drag force generated by the hole cylinder array is directly measured with a drag plate tinoco and cowen 2013 see fig 1 b which can better reflect the bulk drag characteristics of the array obviously the resistance measured by this method includes vegetation and bed resistance in the numerical simulation results of stoesser et al 2010 bed shear stress only accounts for approximately 0 82 6 of the total flow resistance thus bed resistance can be completely ignored however the disadvantage of this method is the relatively high requirement for experimental equipment a simpler alternative method is to measure the drag force generated by a single cylinder in the array ishikawa et al 2000 kothyari et al 2009 van rooijen et al 2018 see fig 1 a that is we only need to select one cylinder in the area where the flow is fully developed to measure its drag and use it to represent the drag characteristic of the entire cylinder array more details about these two different methods can be found in tinoco and cowen 2013 and kothyari et al 2009 respectively when the drag force is measured cd can be obtained from eq 1 when the experimental conditions do not allow the direct measurement of the drag force cd can be derived from the force balance per fluid mass within the vegetated channel which can be expressed as nepf 1999 2 1 λ c b u p 2 1 2 c d a h u p 2 g h 1 λ η x where the first term on the left is the resistance exerted by the channel bed with a bed friction coefficient cb the second term on the left is the drag force contributed by the vegetation stems λ is vegetation density a is frontal facing area for circular cylinders λ π a d 4 and a nd h is flow depth g is acceleration due to gravity up is mean pore velocity x is the streamwise direction and η is water surface elevation as mentioned above the bed shear stress only accounts for 0 82 6 of the total flow resistance therefore the first term on the left of eq 2 can be omitted then cd can be written as 3 c d 2 g s 1 λ a u p 2 where s is the energy slope s η x obviously when the uniform flow condition is reached in the experiment s is just equal to the bottom slope of the channel e g cheng and nguyen 2011 james et al 2001 2004 kim and stoesser 2011 for non uniform flow when the channel bed is horizontal s is equal to h x e g ferreira et al 2009 meftah and mossa 2013 nepf 1999 tanino and nepf 2008 tanino 2012 moreover drag coefficient can also be obtained directly from high resolution numerical simulations such as wall resolving large eddy simulation les and direct numerical simulation dns chang et al 2018 etminan et al 2017 nicolle and eames 2011 stoesser et al 2010 1 2 existing predictors of cd however physical measurements and numerical simulation approaches are often unavailable or infeasible for the practical application of ecological and environmental engineering therefore cd must be estimated researchers have approached the study of estimating drag coefficient for emergent vegetation from different angles pure theoretical derivation meftah and mossa 2013 regression analysis on the basis of a pre given form obtained from theoretical derivation sonnenwald et al 2017 2018 tanino and nepf 2008 and multi parameter regression analysis without any physical basis kothyari et al 2009 the drag coefficient predictor for an isolated cylinder is well established which can be expressed as white 1991 4 c d 1 10 r e 2 3 where the cylinder reynolds number is r e ρ u d μ μ is dynamic viscosity note that for an isolated cylinder λ 0 i e u up however the flow structure in a multi cylinder array is much more complicated than the flow structure around a single isolated cylinder because of the strong wake wake interaction and wake cylinder interaction especially when the vegetation density is not very small thus eq 4 may not be directly used to estimate the drag coefficient of the multi cylinder array based on eq 4 different cd predictors for cylinder array can be obtained by defining reynolds number and drag coefficient with various velocity and length scales i e reference velocity and reference length in emergent canopies as mentioned above previous researches have chosen the reference velocity scale to be the mean pore velocity up however through les etminan et al 2017 found that the constriction cross section velocity uc is the velocity scale that actually governs wake pressure and thus vegetation resistance therefore etminan et al 2017 and van rooijen et al 2018 expressed the canopy drag coefficient using the new velocity scale as 5 c d c 1 10 r e c 2 3 where cd c and rec are the canopy drag coefficient and cylinder reynolds number based on uc u c 1 λ u p 1 4 λ β π u 1 d l y β is the ratio of the lateral distance between adjacent stems at the same streamwise location ly to the distance between two rows of vegetation stems in the streamwise direction lx as is shown in fig 5 further cheng 2013 re fitted the empirical formula of the cd for an isolated circular cylinder using the available experimental data subsequently a pseudofluid model is developed to define a non dimensional cylinder diameter d 2 c d r e p 2 π 1 3 with this new dimensionless cylinder diameter cheng 2013 extended the drag coefficient formula that was used for an isolated cylinder to the cylinder array finally the drag coefficient formula for cylinder array can be written as 6 c d 11 1 s r e p 1 80 λ 0 75 0 9 1 exp 1000 1 80 λ 1 s r e p 1 2 1 exp 1 s r e p 4500 1 80 λ 0 7 1 s 1 λ where rep is cylinder reynolds number based on the mean pore velocity up and cylinder diameter d i e r e p ρ u p d μ as mentioned above by using different velocity and length scales to define reynolds number and drag coefficient different cd predictors can be obtained etminan et al 2017 and van rooijen et al 2018 redefined reynolds number and cd using a new velocity scale uc and obtained eq 5 similarly cheng and nguyen 2011 proposed a new length scale vegetation related hydraulic radius rv to characterize vegetated channels the new reynolds number defined with the new length scale is written as 7 r e v ρ u p r v μ π 1 λ 4 λ r e p where r v π 1 λ d 4 λ with this new reynolds number rev cheng and nguyen 2011 proposed a best fit function to empirically describe the relationship of cd and rev based on existing experimental data of cd the best fit function can be expressed as 8 c d 50 r e v 0 43 0 7 1 exp r e v 15000 ergun 1952 proposed an expression for pressure drop in packed columns and tanino and nepf 2008 related this expression to drag coefficient giving 9 c d 2 α 0 r e p α 1 where α 0 and α 1 are coefficients describing the viscous contribution that arises from the viscous shear stress on the cylinder surface and the inertial contribution that arises from the pressure loss in the cylinder wake respectively sonnenwald et al 2018 re parametrized α 0 and α 1 in terms of λ and d based on least squares curve fitting using available experimental data then they obtained a new function for estimating cd 10 c d 2 6475 d 32 r e p 17 d 3 2 λ 0 5 where the coefficients of the d terms must have units m 1 to retain dimensionless tanino and nepf 2008 tinoco and cowen 2013 and sonnenwald et al 2017 obtained different expressions with similar forms which are not listed here kothyari et al 2009 using their experimental data proposed a cd predictor by multi parameter regression analysis without considering any physical background written as 11 c d 1 53 1 0 45 ln 1 100 λ r e p 3 50 obviously all drag coefficient predictors mentioned above were developed with data driven methods such as regression analysis or curve fitting with pre specified forms however they were obtained with a relatively limited variable space and not physically sound so they can only perform well in some certain cases as discussed in section 3 2 when extrapolated to conditions outside the sampled parameter space it often produces absurd drag coefficient values or makes the predictors meaningless e g eqs 8 and 10 generally researchers analyze the dependence of drag force on flow parameters and vegetation geometry and then subjectively suggest the variables that may affect cd and even further subjectively suggest an analytical expression i e giving a pre specified form of cd predictor sonnenwald e al 2017 2018 this means that the predictive ability of the model is closely related to the reasonableness of the subjective suggestion for instance sonnenwald et al 2018 pre specified that the cd predictor has the ergun like form and considered that α 0 was linearly related to d and α 1 was linearly related to d and λ then a drag coefficient model with mixed dimensional and non dimensional parameters was obtained however it may lead to ridiculous cd values considering a large cylinder with 1 m diameter which is dangerous moreover several predictors developed by traditional multi parameter regression methods are very complicated and not physically interpretable e g eqs 6 8 and 10 which is not conducive to our further understanding of the influence mechanism of flow variables and vegetation geometry on drag force however a more advanced data driven method machine learning ml technique enables the exploration of all possible relationships among variables in complicated phenomena on the basis of a provided data set in present research we utilize genetic programming gp an ml technique based on natural selection to develop a predictor of drag coefficient for emergent vegetation directly from the experimental data that have been published before compared with the conventional data driven methods mentioned above gp does not require researchers to make relatively subjective analysis of the data set it is based on the principle of natural selection to automatically find all possible relations between the variables and only retains the solutions with higher accuracy in the evolving process instead of needing researchers to subjectively suggest a possible expression of drag coefficient on flow variables and vegetation features at the same time the gp algorithm can take all variables into the development of a predictor while leaving the task of identifying related variables to the program wang et al 2017 in contrast as mentioned above the conventional regression methods usually rely on the researchers subjective suggesting nevertheless the current understanding of the influence mechanism of drag force is not yet sufficient as a result these subjective suggestions will lead to a poor predictor while the gp algorithm can well avoid the subjective suggesting from researchers furthermore since the time used to analysis the data set manually is greatly reduced in gp more time can be devoted to explore the physical background of cd tinoco et al 2015 wang et al 2017 thus the solution given by gp is simple in form and physically sound thus having good performance in this study a well documented and widely tested gp software eureqa schmidt and lipson 2013 which has been successfully applied to the studies of vegetated flow huai et al 2018 tinoco et al 2015 wang et al 2017 is used to find a new predictor without any pre specified forms in contrast to previous data driven methods which pre specify a form and proceed to find the optimal relationship through regression analysis e g sonnenwald et al 2017 2018 tanino and nepf 2008 tinoco and cowen 2013 2 methods 2 1 data pre processing laboratory experiments usually cannot explore a wide range of variables in a single research due to the limitations of cost and experimental conditions in order to avoid the common problem of developing a new predictor calibrated to a single data set which performs better than other models on that single data we use multiple data sets we collected a large number of observed data from 10 researches to cover a spacious parameter space as seen in table 1 and fig 2 in all studies smooth rigid circular cylinders were used to represent the emergent vegetation several data points from cheng and nguyen 2011 were removed because of abnormal cd values cheng and nguyen 2011 and cheng 2013 also omitted these odd data finally 475 data points were actually used in present study according to previous studies the major parameters affecting the drag coefficient of emergent vegetation cd are 12 f 1 c d d l x l y u p μ ρ λ ξ 0 where lx is the distance between two rows of vegetation stems in the streamwise direction ly is the lateral distance between adjacent stems at the same streamwise location ξ is a dimensionless coefficient representing the cylinder distribution pattern and f is function note that for random arrays as can be found in nature lx and ly may vary significantly within the array we just assume that lx is equal to ly in the whole random cylinder array that is lx and ly are array averaged values in eq 12 this treatment has also been adopted by etminan et al 2017 and van rooijen et al 2018 here by choosing d ρ and up as fundamental variables the following functional relationship is obtained 13 f 2 c d d l x d l y ρ u p d μ λ ξ 0 note the fact that the fourth parameter is the cylinder reynolds number rep and the second parameter can be obtained by combining the third parameter with the vegetation density λ here we define the blockage ratio ψ d l y which reflects the blockage effect in a multi cylinder array etminan et al 2017 linder 1982 van rooijen et al 2018 cheng and nguyen 2011 showed that the drag coefficients of randomly distributed cylinders slightly differed from those of staggered cylinders at the same rev i e for the same λ and rep however at similar vegetation fraction and cylinder reynolds number large cd values are expected in a staggered distribution than square distribution when vegetation stems are square arranged the downstream stem directly locates in the wake of the upstream stem thereby making the sheltering effect stronger than that of the staggered distributed stems and lowering the drag etminan et al 2017 nepf 1999 however as shown in table 1 the experimental data used in present research only include random and staggered distribution therefore just like cheng 2013 and sonnenwald et al 2018 the effect of vegetation configuration on cd is not considered here then eq 13 reduces to 14 c d f 3 ψ λ r e p as can be seen from fig 2 the data bank used in present research covers a broader range of the parameter space especially the vegetation density than the data banks in previous studies it is worth emphasizing that 1 cd and rep in our study use mean pore velocity up as reference velocity and 2 the gp routine is used in our study to find possible relationships between cd and ψ λ and rep without any pre specified forms 2 2 data selection similar to other gp based software eureqa requires the classification of our 475 experimental data into three separate groups training validation and testing set training set was used to generate individual subexpressions which are compared against the validation data according to the fitness function i e the specified error metric the testing data served as an independent group to test the new formula against other existing predictors and remained unseen by the gp algorithm given that a subset of data must be selected to feed the gp algorithm as training and validation there is an inherent risk of leaving out data that are representative of certain regions of the parameter space consequently an appropriate selection method is necessary to the development of a new predictor here the maximum dissimilarity algorithm mda developed by camus et al 2011 was used to select the training set tinoco et al 2015 riahi madvar et al 2019 huai et al 2018 and wang et al 2017 also used mda in their studies of vegetated flow the detailed steps of mda can be found in wang et al 2017 to the best of our knowledge a unique standard for the number of data points in each group is not yet available as long as the training set can well represent the full parameter space however it should be noted that a lower precision formula will outcome because of noise when the training set is extremely small conversely an extremely large training group may render the formula complicated and results in over fitting therefore we selected 20 of the data set for training 40 of the data set for validation and 40 of the data set for testing the same grouping strategy was also used by tinoco et al 2015 once the training data bank was selected by mda data selection for the validation and testing groups follows a random distribution using a random permutation algorithm the modern version of fisher yates shuffle algorithm was used to generate the validation and testing groups fig 3 shows the selection results for each group as seen in fig 3 the selected data in the training group can effectively cover the densest regions as well as the periphery of the space when the mda algorithm was used to select 20 of the data bank as the training group meanwhile it shows that cd is positively correlated with ψ and λ but negatively correlated with rep 2 3 gp algorithm eureqa was used to find formulas with the mda selected data each candidate solution was evaluated by using the fitness functions during formula searching we evaluated formulas according to their ability to minimize mean square error mse and mean absolute error mae between the observed and predicted values in addition eureqa considers a complexity criterion the complexity of the formula increases with the number of variables coefficients and types of numerical operation the formula contains in the searching process only the predictor with a smaller error will survive when the complexity is the same therefore the result of eureqa is a series of solutions that vary in complexity and have different errors usually error decreases as the complexity increases nonetheless extremely complex formulas have no physical meaning whereas extremely simple formulas have large errors the final solution must be selected from all surviving solutions through balancing the complexity performance and physical meaning in this study the following criteria were used for the selection of the final solution from the formulas provided by eureqa 1 the accuracy of the selected formula does not increase significantly at increased complexity 2 complexity should not be extremely large otherwise it does not have clear physical meaning and more like the result of over fitting thus it cannot be extended to the data outside the data bank used in gp algorithm 3 no matter what parameters values i e ψ λ and rep are input as long as they are reasonable the values of cd should not be negative or infinite 3 results and discussion 3 1 results after evaluating 4 6 1011 formulas only 7 formulas survived with 1 as the smallest size and 37 as the largest size table 2 subsequent runs showed that even when more formulas were evaluated solutions with the same forms were obtained though their coefficients may vary slightly as shown in table 2 the most complicated formula with a complexity of 37 is the best drag coefficient predictor in terms of mae and mse however its high complexity is likely to be the result of statistical artifacts and without any clear physical meaning the formula with a complexity of 26 generates a negative cd value when vegetation density is large than 0 7 meanwhile when λ 0 the fifth term on the right side of the formula with a complexity of 26 has no meaning although the data bank we used does not contain drag coefficient values for the isolated cylinder cases λ 0 the formula should remain meaningful when λ 0 because zero is a physically reasonable λ value fig 4 shows the pareto front where the relationship between accuracy and complexity is described in general accuracy increases with complexity and the increasing rate decreases as the complexity increases however the increase becomes inconsiderable when the complexity is greater than 14 at the same time it also can be seen from table 2 that the complexity of the formulas significantly increases only when the complexity is larger than 14 that is when the two formulas with complexities of 26 and 37 are discarded accuracy becomes the primary consideration in the selection of the final predictor thus we selected the formula with a complexity of 14 as the final predictor 3 2 discussion the final formula we chose is written as 15 c d 189 r e p 0 82 ψ 2 6 02 λ interestingly the expression given by eureqa has the same form as that given by ergun 1952 eq 9 although there were no pre specified forms before the searching for solutions in fact the solutions given by the gp algorithm all have ergun forms when the complexity is greater than 5 see table 2 accordingly α 0 and α 1 can be expressed as 16 α 0 94 5 17 α 1 0 41 0 5 ψ 2 3 01 λ the viscous term α 0 is constant and appears to be independent of cylinder array characteristics and this observation is consistent with the conclusions of tanino and nepf 2008 the value of α 0 given by the gp algorithm is close to that of tanino and nepf 2008 α 0 85 15 in their research moreover α 1 increases linearly with λ and this increase means that the inertial contribution inertial drag effect increases with λ at a given rep this dependence is consistent with tanino and nepf 2008 tinoco and cowen 2013 and sonnenwald et al 2017 2018 according to tanino 2012 the observed increase in α 1 with increasing λ can be attributed in part to the increasing spatial variance of time averaged longitudinal velocity with increasing λ unlike previous researches eq 17 shows that α 1 is not only related to λ but also to the blockage ratio ψ that is the inertial drag increases with the increase of blockage ratio at a given λ this dependence of α 1 on ψ is not surprising we just consider the two different cylinder array distribution patterns as shown in fig 5 obviously the two distributions share the same λ whereas the blockage ratio of pattern a is much larger than that of pattern b then the blockage ration ψ affects the inertial resistance from the following two aspects on one hand the local flow velocity around the cylinders significantly increases and a jet like rapid flow forms between two laterally adjacent cylinders because the presence of the obstacles reduces the cross sectional area the jet like rapid flow outside the wake not only confines the widening of the cylinder wake but also reduces the pressure within the wake thus significantly increases the inertial drag this is the so called blockage effect and it is obvious that this effect is stronger as the blockage ratio increases on the other hand when the vegetation density λ is fixed the larger ψ the larger lx as a result the downstream cylinder is less affected by the wake of the upstream cylinder that is the sheltering effect is weaker thus the drag force is greater in fact the cd predictors of etminan et al 2017 and van rooijen et al 2018 also show that cd is positively correlated to ψ in general the new predictor obtained from eureqa has good physical meaning fig 6 shows the predicted cd from the existing predictors described in section 1 2 and eq 15 plotted for a range of rep a representative selection of λ for each density eq 15 was used to estimate cd with a small ψ value as well as a large ψ value to show the effect of ψ on cd at λ 0 02 and rep 300 two ergun based predictors i e eqs 10 and 15 give relative large cd values while other predictors produce smaller cd however all functions provide similar cd values for rep 300 as λ increases λ 0 05 in fig 6 the differences between the cd values estimated by each function become smaller at rep 200 while greater at rep 200 especially for eqs 15 and 8 cheng and nguyen 2011 it should be noted that eqs 5 and 11 van rooijen et al 2018 kothyari et al 2009 still produce similar underestimates of cd even at λ 0 1 conversely cheng s 2013 formula overestimates cd values than other formulas for the gp model i e eq 15 it can be seen that the ψ value has a smaller effect on cd when λ 0 05 at the same time for the same λ the effect of ψ on cd increases with the increase of rep this is because when λ is small the flow structure within the multi cylinder array is similar to the flow around an isolated cylinder that is the blockage effect and the sheltering effect are relatively weak for the same λ the contribution of inertial resistance increases with rep so the effect of ψ on cd also increases with rep 3 3 comparison of the predicted cd values against experimental results given that the selection of error metrics may affect the evaluation results of model performance that is a formula that performs well when a certain error metric is used which may perform poorly when other error metrics are used we used multiple error criteria to evaluate the predictive ability of each cd predictor accuracy metrics including the mse mean relative error mre mae coefficient of determination r2 and discrepancy ratios dr were used to evaluate the performance of the new predictor obtained from eureqa and previous formulas meanwhile model performance was assessed with the taylor diagram taylor 2001 which presented the standard deviation std centered root mean square difference rmsd and correlation coefficient r between the measured and estimated cd values zeng and huai 2014 suggested to use the percentage of dr values between 0 3 and 0 3 to evaluate the performance of a predictor table 3 shows the comparison of the accuracy of eq 15 with those of predictors from other researches described in section 1 2 the comparison of predicted versus observed cd is also shown in fig 7 note that the drag coefficient values of van rooijen et al 2018 cd c have been converted to cd based on the relationship between up and uc as can be seen from table 3 and fig 7 the predictor obtained from the gp algorithm in this study performs better than other formulas regardless of which metric was used for each group all other predictors however failed to do so for instance the predictive ability of cheng s 2013 formula was better than the formulas by sonnenwald et al 2018 van rooijen et al 2018 and kothyari et al 2009 in terms of mre however it yielded low accuracy in terms of mae and mse fig 7 shows that in addition to eq 15 previous predictors have no ability to predict the cd values for idealized emergent vegetation accurately at low reynolds number as can be seen from fig 3 the low reynolds number corresponds to a larger cd value sonnenwald et al 2018 van rooijen et al 2018 and kothyari et al 2009 underestimated cd whereas cheng 2013 and cheng and nguyen 2011 overestimated which is consistent with fig 6 the poor performance of these formulas at low reynolds number was also reported by sonnenwald et al 2018 conversely given that the data bank used in current research contains a large number of data points at low rep see fig 2 the predictor generated by the gp algorithm can better estimate the drag coefficient for the low rep case the r2 for all formulas are insufficiently high because the measurement of cd in laboratory experiments has great uncertainties taylor diagrams fig 8 are usually used to evaluate the performance of multiple predictors riahi madvar et al 2019 taylor 2001 the azimuth angle in taylor diagram indicates the correlation coefficient r between the observed and estimated values the radial distance between estimates and the origin represents std while the distance from the observations to the estimates shows rmsd the implication of taylor diagram is that the closer model predictor accuracy indices to the observations the better the predictor performance fig 8 shows the taylor diagram based on training validation testing and all data groups which indicates that the gp predictor has a significant improvement in the cd prediction for idealized emergent vegetation especially compared with the formulas of cheng 2013 van rooijen et al 2018 and kothyari et al 2009 as shown in figs 7 and 8 the predictors provided by cheng and nguyen 2011 and sonnenwald et al 2018 nearly have the same performance as the predictor provided by eureqa when certain error criteria were used such as mre r2 and rmsd however the performance of the formulas of sonnenwald et al 2018 and cheng and nguyen 2011 may not be as good as those shown above in practical application because most of the data points contained in the present study have been used to fit the cd predictors of those studies i e eqs 8 and 10 for instance 57 and 88 of the data in the testing set were used by sonnenwald et al 2018 and cheng and nguyen 2011 respectively whereas the entire testing group were unseen by the gp algorithm even so the gp formula still has an obvious advantage in terms of mae mse and dr for testing set in general the cd predictor for idealized emergent vegetation obtained by the gp algorithm in current study has better prediction ability than the existing predictors however the new predictor has only been tested in the range of 0 003 λ 0 35 0 044 ψ 0 66 and 25 rep 4000 and care should be taken applying it outside of this range although a wide parameter space has been included in our data set especially it should be noted that nepf 1999 reports the opposite λ dependence of cd at rep 4000 4 summary and conclusion in the present study the genetic programming gp algorithm was used to develop a new predictor of drag coefficient for idealized emergent vegetation on the basis of existing experimental data among all the solutions provided by the gp software eureqa the final expression of cd was selected by balancing the complexity accuracy and physical meaning although without any pre specified forms before searching a solution that agrees with ergun s 1952 formula in form was obtained the method used differs from previous data driven methods which pre specify a form and proceed to determine the optimal relationship through regression analysis the inertial contribution to cd α 1 increases not only with λ but also with ψ because of the blockage effect and the sheltering effect however the viscous contribution α 0 is constant and appears to be independent of cylinder array characteristics this new predictor of cd for emergent vegetation with a physical basement exhibits a considerable improvement in terms of prediction ability compared with the existing predictors regardless of which error metric was used meanwhile it also has a relatively concise form and is easy to use declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper credit authorship contribution statement meng yang liu conceptualization methodology software validation formal analysis investigation writing original draft writing review editing visualization wen xin huai conceptualization methodology writing review editing supervision project administration funding acquisition zhong hua yang writing review editing supervision yu hong zeng writing review editing acknowledgements the authors would like to thank y tanino and a van rooijen for providing the drag coefficient data from their experiments comments and suggestions made by the editor dr g c sander associate editor dr r ferreira and reviewers have greatly improved the quality of the paper the work was supported by the national natural science foundation of china grant numbers 11872285 and 11672213 
