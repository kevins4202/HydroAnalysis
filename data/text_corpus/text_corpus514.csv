index,text
2570,vegetation plays an important role in gully headcut erosion processes however it is still unclear how vegetation in the upstream area affects gully headcut erosion processes by changing the hydraulics a series of in situ inflow scouring experiments were conducted on bare land plots and vegetation plots including the upstream area headwall and gully bed planted with bothriochloa ischaemum bi agropyron cristatum ac and medicago sativa ms with clustered stems and artemisia gmelinii ag with erect stems to investigate the influence of vegetation on the hydrodynamic parameters involved in gully headcut erosion processes the results showed that compared with bare land vegetation increased the manning roughness coefficient n and darcy weisbach friction factor f in the upstream area by 0 2 2 5 times and 0 9 9 6 times respectively but reduced the runoff velocity in the upstream area and gully brink however the jet flow velocity at entry into the plunge pool increased rapidly after passing through the gully head the influence of vegetation with clustered stems on roughness and runoff velocity was greater than that of vegetation with branched stems at 3 6 m3 h inflow discharge vegetation can increase the runoff shear stress of the upstream area the energy consumption of the gully head upstream area and gully bed accounted for 74 to 76 19 to 21 and 4 to 7 of the total energy consumption respectively the four vegetation treatments reduced the gully headcut soil loss by 31 to 81 among which ms exhibited the highest reduction the soil loss rate was positively correlated with the jet flow velocity and its kinetic energy and the correlation was the best r 2 of 0 934 and 0 935 respectively p 0 01 presenting a logarithmic trend these results are helpful to deepen the understanding of the roles of vegetation in regulating runoff hydraulic action during gully headcut erosion keywords gully headcut erosion vegetation hydraulic characteristic soil loss data availability the authors do not have permission to share data 1 introduction gully erosion is one of the most serious environmental problems worldwide leading to high sediment yields and severe land degradation oostwoud wijdenes et al 2000 poesen et al 2003 dotterweich et al 2012 babazade et al 2017 the soil loss driven by gully erosion contributes 10 to 94 of the total sediment caused by water erosion poesen et al 2003 gully headcut erosion is one of the important subprocesses of gully erosion robinson and hanson 1995 oostwoud wijdenes bryan 2001 poesen et al 2003 on a global scale linear gully head retreat rates vary between 0 01 and 135 m year 1 vanmaercke et al 2016 vegetation is one of the most important factors influencing gully erosion according to previous studies vegetation can significantly curb the development of gully erosion chen and cai 2006 wang et al 2016 but vegetation covered gully heads still retreat guo et al 2019 kang et al 2021 therefore it is necessary to explore gully headcut erosion under vegetation cover gully headcut erosion occurs via the erosion of several landform units including hydraulic shearing by overland runoff in the upstream area headwall and gully bed jet flow splashing and vortex erosion and mass wasting movement erosion oostwoud wijdenes bryan 2001 zhang et al 2018 guo et al 2021 kang et al 2021 in the process of gully headcut erosion runoff first erodes the upstream area then is divided into on wall flow and jet flow at the gully brink to erode the gully headwall and gully bed and then the two flow types merge at the gully bed to erode the gully bed together oostwoud wijdenes bryan 2001 shi et al 2020 guo et al 2021 kang et al 2022 the gully headcut erosion process changes periodically and includes the soil stress release stress release hollow formation tension crack development gully head collapse collapse debris removal by erosion cycle fig 1 collison 2001 in the process although gravity erosion occurs sediment transport is caused by hydraulic action some studies have found that this phenomenon is different for different land uses covers chen et al 2013 guo et al 2019 kang et al 2021 however it is unclear which erosion process is dominant in gully headcut erosion in different land use cover types gully headcut erosion is mainly affected by many factors such as rainfall topography soil properties vegetation and land use types valentin et al 2005 vanwalleghem et al 2005 babazade et al 2017 shi et al 2020 kang et al 2021 rainfall runoff plays a critical role in the gully headcut erosion process poesen et al 2003 li et al 2015 the runoff from rainstorms is the original force driving gully headcut erosion robinson and hanson 1995 guo et al 2021 research shows that rainfall must exceed a certain threshold to cause gully headcut erosion poesen et al 2003 hayas et al 2019 vegetation is also an important factor affecting gully headcut erosion processes gyssels et al 2005 li et al 2015 wang et al 2016 mukai 2017 my et al 2020 guo et al 2021 it has been shown that vegetation can effectively curb gully development by affecting the erosion resistance of soil and surface runoff hydraulics dong et al 2018 wilkinson et al 2018 some studies indicate that plant roots can effectively increase soil cohesion and consolidate soil reducing soil erodibility and enhancing the soil stability of the gully head chen and cai 2006 morgan and mngomezulu 2003 wang et al 2016 guo et al 2018 guo et al 2020 vegetation can reduce surface runoff volume and velocity by increasing the infiltration and surface roughness of the catchment area and or gully bottom nachtergaele et al 2002 tebebu et al 2010 which largely weakens runoff scouring dong et al 2018 moreover vegetation can intercept runoff reduce the down cutting of gully beds and intercept sediment from catchments and gully heads dong et al 2018 although plants have been found to be an effective means of gully erosion control the role of vegetation in extreme rainfall remains to be further explored moreover it is still unclear how vegetation affects gully headcut erosion by changing the hydraulic conditions of the upstream area it is important to analyze the effect of vegetation on the characteristics of hydraulic parameters to reveal the influence mechanism of vegetation on hydraulic action during gully headcut erosion given these issues a series of in situ runoff scouring experiments under different vegetation types were carried out in the tableland region of the loess plateau china the objectives of this study were to a investigate the effects of different vegetation types on the hydrodynamic parameters involved in gully headcut erosion processes b illustrate the spatial variation in energy consumption and soil loss of the gully headcut system and c reveal the influence of vegetation on hydraulic erosion during gully headcut erosion 2 materials and methods 2 1 study area the experiments were conducted at the nanxiaohegou watershed of xifeng soil and water conservation scientific experimental station of the yellow river water conservancy commission china n35 41 35 44 e107 30 107 31 the station is located in eastern gansu province china situated in the hinterland of the loess plateau and belongs to a semiarid continental climate the mean annual precipitation is 546 8 mm with a large annual variation the rainfall is mainly concentrated in summer when high intensity rainstorms occur the soil types in this area are mainly black loam soil and yellow loam soil gully erosion accounts for 86 3 of the total soil erosion in this area guo et al 2018 under the implementation of large scale ecological restoration soil erosion has been well controlled in the study area fu et al 2011 the main herbaceous vegetation types include medicago sativa l setaria viridis l beauv agropyron cristatum l gaertn artemisia gmelinii artemisia stechmanniana bess bothriochloa ischaemum l keng and stipa bungeana trin 2 2 experimental design 2 2 1 experimental plot design and construction the experimental plots built on a platform of the experimental station were composed of an upstream area gully head and gully bed fig 2 a preliminary experiment showed that when the length of the upstream area is 5 0 m runoff can meet the requirements of stability furthermore the average width height ratio of gully heads in the region is 1 66 che 2012 guo et al 2019 shi et al 2020 the width of the plot was set to 1 5 m and thus the gully head height was calculated to be 0 9 m based on the average width height ratio of the gully heads in the region the length of the gully bed was 1 0 m the slope of the upstream and gully bed was designed as 3 and the slope gradient of the gully headwall was designed as 90 to ensure consistent conditions for each plot the original vegetation roots and rocks were removed from the soil during the construction of the experimental plots then the soil was backfilled layer by layer 20 cm for each layer and attention was given to the consistency of the same soil layer in different plots during filling a steady flow tank was set at the top of the plot for water release and a sampling pool was set at the bottom for collecting sediment samples each plot was surrounded by a 15 cm high ceramic tiles to ensure that the runoff within the plot did not overflow in the upstream area of each plot different vegetation was planted at 10 10 cm spacing and the bare land plot was constructed as a control a total of eight vegetation plots and two bare land plots were built 2 2 2 flow discharge design according to the rainstorm intensity and duration in the study area the rainstorm return period and rainstorm duration were designed as a 30 year return period and 180 min respectively the range of the surface runoff coefficient in the study area was approximately 0 001 0 363 on grassland it was 0 06 and the catchment area at the gully head was mainly concentrated in the range of 0 15 2 0 km2 che 2012 according to the statistical equation between rainstorm events and duration zhang 1983 the rainstorm intensity was calculated by formula 1 1 ri 5 09 n 0 379 t 1 4 0 74 where ri is the rainfall intensity mm min 1 n is the rainstorm recurrence period year and t is the rainfall duration min in this study the calculated rainstorm intensity was 0 39 mm min 1 the inflow discharge can be calculated as follows kang et al 2022 2 q 0 06 λ r i a where q is the inflow discharge m3 h a is the upstream area km2 and λ is the runoff coefficient on the upstream area kang et al 2022 showed that the natural gully head area of 168 m2 at the study area is approximately 200 times the area of the simulated plot headwall then the inflow discharge was calculated to be in the range of 1 05 to 14 04 m3 h according to the preliminary experimental results the flow discharges were finally chosen as a lower flow rate of 3 6 m3 h and a higher flow rate of 8 4 m3 h in this study the purpose was to compare the differences in vegetation effects under lower and higher flow rates a sketch of the gully headcut system simulation experimental plot and the test process are shown in fig 1 2 2 3 vegetation cover design based on a detailed field survey of vegetation types in the study area bothriochloa ischaemum l keng bi agropyron cristatum l gaertn ac artemisia gmelinii ag and medicago sativa l ms were selected as the typical vegetation types in this area bare land bl was used as a control the stems of bi and ac were clustered type and sparse clustered type respectively the stems of ag were multibranched and those of ms were erect and clustered to recumbent each experimental plot was built almost at the same time seeds for sowing were planted in each plot in the upstream area at the same time the plants were thinned 20 days after seed germination to ensure that the row spacing was 10 10 cm during the management and protection of the plots all plots were managed in the same way and plants other than the target vegetation were timely removed each plot was irrigated with the same volume of water the experiment was carried out after 2 years of vegetation growth the detailed information of each plot is shown in table 1 photos of each vegetation are shown in fig 3 2 2 4 experimental procedures and measurements before the experiment the vegetation in the plot was trimmed and the aboveground part was kept at a height of 5 cm to better measure the hydraulic parameters of the upstream area the discharge rate was adjusted to reach the target inflow discharge rate during the experiment the runoff and sediment samples were collected at the outlet of the plot every 2 min the dry sediment quality was obtained by the constant drying method at 105 c after the experiment in addition four observation sections were set up on the upstream area and one observation section on the gully bed the flow velocity v m s of each section was measured by the dyeing tracer method and the runoff depth m and width m at each section and the height of the jet flow were measured by a scale a portable flow velocity meter was used to measure the flow velocity of the jet flow at the gully brink the occurrence time of gravity erosion was recorded 2 3 data analysis 2 3 1 hydrodynamic parameters in the upstream area and gully bed the reynolds number re froude number fr manning roughness coefficient n darcy weisbach friction factor f and shear stress τ pa were calculated as follows 3 re vr v 4 v 1 775 10 6 1 0 0337 t 0 000221 t 2 5 f r v rg 6 n r 2 3 j 1 2 v 7 f 8 g r j v 2 8 τ ρ w r j g where r is the hydraulic radius m v is the runoff velocity m s v is the water kinematic viscosity coefficient m2 s t is the temperature of water c g is the gravitational constant g 9 8 n kg 1 j is the hydraulic gradient and ρw is the water density kg m3 2 3 2 jet flow at the gully head the jet flow velocity at the gully brink and its angle into the plunge pool were calculated as follows alonso et al 2002 dey and sarkar 2006 flores cervantes et al 2006 zhang et al 2016 9 v b qg 3 0 715 f r 1 v j f r 2 0 4 f r 2 f r 1 10 fr v j g d b 11 v β v h c o s β 12 β a r c t a n 2 g d h v j 13 τ v β 0 025 v q 0 2 ρ w v β 2 where q is the runoff rate m3 s vb m s is the runoff velocity at the gully brink vβ is the jet flow velocity at the plunge pool m s β is the angle of the jet flow into the plunge pool db is the runoff depth m dh is the height of the jet flow m and τ vβ is the shear stress of jet flow 2 3 3 flow energy and its consumption in the gully headcut system gully headcut erosion is closely associated to the transformation and consumption of runoff energy zhang et al 2016 shi et al 2020 guo et al 2021 the plot runoff outlet was taken as the reference surface of zero gravitational potential energy the total runoff energy et j s runoff energy at the gully brink eu j s runoff energy when the runoff flows out of the plunge pool eh j s and runoff energy when the runoff flows out of the gully bed eb j s were calculated as follows guo et al 2021 14 e t ρ w g q l u l b s i n θ h 15 e u ρ w g q l h l b s i n θ h 1 2 ρ w q v j 2 16 e h ρ w g q l h l b v b 2 h g s i n θ 1 2 ρ w q v p 2 17 e b 1 2 ρ w q v b 2 where lu lg and lh are the length of the upstream area length of the gully bed and gully head retreat distance respectively θ is the upstream area slope and the gully bed slope and h is the original gully head height 0 9 m vp m s and vb m s are the runoff velocities of the runoff out of the plunge pool and out of the gully bed respectively the total runoff energy consumption δet runoff energy consumption of the upstream area δel runoff energy consumption of the gully head δeh and runoff energy consumption of the gully head δeb were calculated as follows 18 δ e t e t e b 19 δ e u e t e u 20 δ e h e u e h 21 δ e b e h e b the soil water infiltration rate l min 1 is equal to the difference between the input flow and outflow flow pearson correlation analysis was performed to analyze the correlations between soil loss rate and hydraulic characteristics relationships between soil loss rate and jet velocity and runoff kinetics were analyzed in a simple regression method the data were preliminarily processed in microsoft excel 2019 further analyses were conducted in spss 25 0 figures were plotted using origin 2021 software and powerpoint 2019 software 3 results 3 1 effects of vegetation on spatiotemporal changes in hydraulic characteristics 3 1 1 runoff characteristics and regime in the upstream area the runoff rate q runoff depth h runoff velocity vu reynolds number re and froude number fr of the upstream area are provided in table 2 the result illustrate that vegetation can effectively reduce the runoff velocity and flow turbulence of the upstream area and that the vegetation with branched stems ac had less effect on velocity than that with clustered stems bi and ms the q of bi was 0 6 6 0 and 1 4 2 8 less than that of the other plots at 3 6 m3 h and 8 4 m3 h respectively at 3 6 m3 h the h of the vegetation plots was larger than that of bl and the h of the vegetation plots was 1 39 to 2 49 times that of bl however at 8 4 m3 h h was the largest in bl and 1 40 to 2 22 times those in the vegetation plots the h of ag was the smallest among the different vegetation types compared with bl the vu of the vegetation plots was significantly reduced by 15 6 68 2 the re was greater than 2000 and bl had the largest re 17210 at 8 4 m3 h for fr the fr of bl was greater than 1 while the fr ranged from 0 39 to 0 88 in the vegetation plots of which that of ag was the largest 3 1 2 manning roughness coefficient and darcy weisbach friction factor vegetation increased the manning roughness coefficient n and darcy weisbach friction factor f of the upstream area fig 4 the n of the upstream area was ranked in order of highest to lowest under ms bi ac ag and bl the average n of ms bi ac and ag was 1 2 to 3 5 times that of bl compared with bl the vegetation increases the f by 9 6 to 0 9 times the results showed that the vegetation in the upstream area can greatly increase surface roughness and runoff resistance and ms had the greatest effect while ac had a minimal impact 3 1 3 jet flow velocity at the gully head vegetation significantly reduced the jet flow velocity at the gully brink vb but had little effect on the jet flow velocity into the plunge pool vβ fig 5 the difference in vb among the different vegetation types was small fig 5 a c compared with bl vegetation can reduce vb by 33 3 35 6 and 53 5 54 4 at 3 6 m3 h and 8 4 m3 h respectively the vβ ranged from 2 44 to 4 27 m s 1 the runoff velocity increased rapidly after passing through the gully head vβ was 5 to 14 times that of vb and there was no obvious difference in the vβ under different vegetation conditions these results imply that vegetation can significantly reduce the jet velocity at the headcut brinkpoint but the velocity is not significantly affected by the vegetation types and the gully head would rapidly increase the jet velocity at the entry of the plunge pool and weaken the influence of vegetation on the jet velocity 3 1 4 runoff shear stress of the gully headcut system fig 6 shows the variations in runoff shear stress in the upstream area τup gully bed τbed and jet flow τvβ at 3 6 m3 h and 8 4 m3 h respectively at 3 6 m3 h there was no significant difference in τup among ms bi and ac whose τup values were greater than those of ag and bl the average τup of the two groups were 9 36 to 4 03 pa respectively at 8 4 m3 h there was no significant difference in τup among the plots which ranged from 12 82 to 13 95 pa τvβ was significantly higher than τup and τbed which ranged from 54 87 to 75 37 pa and 60 37 to 75 90 pa respectively the τbed ranged from 2 74 to 8 59 pa τbed was smaller than τup and τvβ and ag had the maximum shear force these results illustrate that vegetation can increase the runoff shear stress of the upstream area to a certain extent at small inflow discharges and its increase under bi ac and ms clustered stem was greater than that under ag multibranched stem the gully head can significantly increase the flow shear stress 3 2 runoff energy characteristics of the gully headcut system the runoff kinetic energy of the upstream area ekup runoff kinetic energy at the headcut brink point ekvb runoff kinetic energy of jet entry into the plunge pool ekvβ and runoff kinetic energy of the gully bed ekbed were all higher under 8 4 m3 h than under 3 6 m3 h inflow discharge fig 7 by 2 6 to 9 1 times 3 8 to 8 7 times 2 1 to 3 0 times and 2 3 to 3 9 times respectively vegetation can reduce ek up and the ek up was ranked in order of highest to lowest as bl ag ac bi and ms which ranged from 0 0131 to 0 0477 j s 1 and 0 0641 0 4336 j s 1 at 3 6 m3 h and 8 4 m3 h respectively the ek vb was 125 to 399 higher in the bl than in the vegetation area but there was no significant difference among the different vegetation plots the ek vβ varied between 6 69 and 7 72 j s 1 and 16 34 to 20 37 j s 1 at the 3 6 m3 h and 8 4 m3 h inflow discharges respectively at 3 6 m3 h the ekbed of bl was the highest followed by those of ac and ms and that of ag was the lowest whereas at 8 4 m3 h the ekbed of bl and ms were the highest the total energy consumption and proportion of energy consumed in the different topographic units were significantly different fig 8 the total energy consumption varied from 10 31 to 11 45 j s 1 and 25 32 to 26 77 j s 1 under 3 6 m3 h and 8 4 m3 h and the total energy consumption under 8 4 m3 h was 2 2 to 2 6 times that of 3 6 m3 h under the same inflow discharge there was no significant difference in the energy consumption the different plots the rank of the different topographic units in order of highest to lowest proportion of energy consumed was gully head upstream area and gully bed which accounted for 74 to 76 19 to 21 and 4 to 7 of the total energy consumption respectively these results showed that the runoff energy was mainly consumed at the gully head and upstream area which can reach more than 94 of the total energy consumption 3 3 effect of vegetation on the soil erosion process of gully headcut erosion the soil loss rate showed a multipeak change trend over time and vegetation significantly reduced the soil loss rate fig 9 the soil loss rate varied over the ranges of 1 19 to 142 65 g s 1 and 13 59 to 394 32 g s 1 at 3 6 m3 h and 8 4 m3 h respectively the average soil loss rates of bl were 1 5 to 5 3 times and 1 8 to 2 4 times those of the vegetation plots at 3 6 m3 h and 8 4 m3 h respectively vegetation reduced the soil loss rates by 31 to 81 and 44 to 58 under 3 6 m3 h and 8 4 m3 h respectively furthermore almost every mass movement corresponds to a mutation point of the soil loss rate and the mutation point of soil loss has a certain hysteretic nature the above results indicate that vegetation can restrain the soil loss rate well and the difference in the soil loss rate control among the different vegetation types was decreased under the large flow condition 3 4 correlations between gully headcut system soil loss and hydraulic parameters the soil loss rate had a negative correlation with n and f and a positive correlation with other hydraulic characteristics table 3 the soil loss rate was significantly positively correlated with vb ekup ekvb ekvβ and ekbed p 0 05 or p 0 01 and had a high correlation coefficient with the velocity and kinetic energy of jet flow at the headcut brink point 0 934 and 0 935 respectively a logarithmic trend was obtained for the correlation of soil loss rate with vb and runoff kinetic energy ekup ekvb ekvβ and ekbed fig 10 4 discussion 4 1 vegetation regulation of runoff in gully headcut erosion processes this study showed that vegetation can significantly improve the n and f of the upstream area and reduce the runoff velocity of the upstream area and the jet flow velocity at the gully brink fig 4 compared with bare land the n of vegetation increased by 2 5 to 0 2 times and the f by 9 6 to 0 9 times and ms had the largest values while ag had the smallest vegetation reduced vu by 15 6 68 2 and vb by 33 3 54 4 these results were mainly caused by vegetation effectively increasing the surface roughness and runoff resistance coefficient and reducing the flow velocity prosser and soufi 1998 dunkerley et al 2001 järvelä 2002 muoz carpena and parsons 2004 liu et al 2010 shen et al 2021 duan et al 2022 it has been reported that compared to bare slopes 30 plant stem cover reduced overland flow velocity up to 90 mu et al 2019 the differences in n and f among the different vegetation types were attributed to differences in the morphological characteristics of vegetation duan et al 2022 regarding the morphology of aboveground vegetation stems compared to ag stems bi and ac stems are clustered and ms stems are clustered to recumbent and form a relatively dense grassland table 1 it has been shown that with increasing stem density the surface resistance increases and the flow velocity decreases kervroëdan et al 2019 liu and zhao 2020 therefore the n and f found for the different vegetation types were the largest for ms the smallest for ag based on the above it can be inferred that clustered stem plants increase the roughness and runoff resistance coefficient of the slope more than branched stem plants duan et al 2022 the vegetation significantly reduced the runoff velocity in the upstream area and the jet velocity at the gully brink table 2 fig 5 a similar finding to that reported by kang et al 2021 that the runoff velocity on the upstream slope for bare land was greater than that for grassland this was mainly due to the interception of runoff by plants in the catchment area nachtergaele et al 2002 tebebu et al 2010 wang et al 2021 however the influence of vegetation on the flow velocity of runoff into the plunge pool seems to be small due to the instantaneous gravity acting on runoff through the gully head which probably weakens the influence of vegetation on the jet flow velocity of runoff moreover in the process of gully headcut erosion when runoff flows to the gully head brink the runoff separates into jet flow and on wall flow under the action of inertia and gravity chen et al 2013 kang et al 2022 the higher the velocity of runoff is the greater its kinetic energy which will cause more runoff to form jet flow nan 2011 conversely in this study vegetation stems significantly reduced the runoff velocity and kinetic energy in the upstream area and the reduction in runoff kinetic energy may lead to an increase in the proportion of on wall flow thus increasing the erosion of the gully headwall it is worth mentioning that the vegetation in the upstream area can increase shear stress under the small inflow discharge while under the large inflow discharge there was no apparent difference between the shear stress of vegetation plots and that of bl fig 6a this does not mean that the impact of vegetation was reduced but rather that the shear stress of bare land increases under the small inflow condition the runoff velocity of the vegetation plots was slow and the runoff depth was increased table 2 while under the large inflow condition due to the cutting of runoff the gully was narrowed and the water depth was increased and had larger shear stress bare land is prone to concentrated flow becoming narrower and runoff becoming deeper with time knapen et al 2007 guo et al 2019 kang et al 2021 especially under larger flows increasing the runoff shear stress of bare land 4 2 effect of vegetation on hydraulic erosion in gully headcut erosion processes the soil loss rate showed a multipeak change trend over time especially in the vegetation plots fig 10 this is the result of collapse and guo et al 2019 and kang et al 2021 found that the erosion process of vegetated land was different from that of bare land this is closely associated with the collapse of the headcut s hanging soil root matrix su et al 2015 guo et al 2019 vegetation roots increase the erosion resistance of the upper soil at the gully head and the erosion rate of the bottom of the gully headwall is fast forming a collapse cantilever chen et al 2013 therefore vegetation changes the process of headcut erosion on bare land runoff incisions are dominant processes in gully head retreat while on vegetated land overhanging layers collapse predominantly resulting in gully head retreat guo et al 2019 kang et al 2021 furthermore the mutation point of soil loss has a certain hysteretic nature compared with the collapse time fig 10 the gully head collapses and temporarily obstructs the flow path when the flow forms the runoff path again the sediment transport rapidly increases guo et al 2019 vegetation was able to reduce soil loss rates by 31 to 81 and ms reduced soil loss the most fig 10 the average soil loss rates of bl were 1 5 to 5 3 times those of the vegetation plots under the lower flow 3 6 m3 h the average soil loss rate ranked in order of lowest to highest was ms bi ac and ag while the difference among vegetation types especially ac ag and ms was weakened under higher flow medicago sativa ms has a fine dense root system that performs well in erosion reduction li and pan 2018 and the importance of recumbent grass stolons in reducing sediment yield is greater than that of erect grass stems duan et al 2022 vegetation roots and stems play different roles in the process of runoff erosion increasing soil erosion resistance and altering the runoff process respectively zhou shangguan 2007 duan et al 2022 it is argued that under vegetated conditions the stems and root mat of grass provide high resistance to scour and that fluvial sediment transport is effectively prevented prosser and soufi 1998 duan et al 2022 it was found that under rainfall conditions during slope erosion stems can reduce sediment yield with efficiencies of 59 79 duan et al 2022 previous studies have shown that the soil loss rate is strongly positively related to root system characteristics during gully headcut erosion processes guo et al 2019 the plant root system can increase water infiltration and improve resistance to erosion gyssels et al 2005 allen et al 2018 and the grass root system can decrease soil loss by 45 64 68 45 under gully headcut erosion guo et al 2019 a different pattern was found in this study the soil loss rate of the ms vegetation plot was the largest followed by bi fig 9a however according to table 1 the root length density and root surface area density of bi were the largest followed by ms thus the root characteristics and erosion reduction effects were not consistent this is due to increased soil water content being more likely to lead to gully erosion occurrence tebebu et al 2010 table 1 shows that the runoff rate of ms was lower than that of bi that is the soil infiltration rate of bi was higher which may be the reason why the soil loss rate of ms was lower than that of bi the soil loss rate was positively correlated with runoff kinetic energy and the correlation with jet flow velocity and its kinetic energy was the best r 2 of 0 934 and 0 935 respectively p 0 01 table 3 a logarithmic trend was obtained for the correlation of soil loss rate with vb and its kinetic energy fig 10 runoff energy was the basic driving force of landform change and erosion sediment yield zhang et al 2015 it was shown that energy consumption was accompanied by energy transformation in the gully headcut erosion process zhang et al 2015 previous studies have shown that jet flow kinetic energy is the main driving mechanism of headcut erosion and can be used to predict the sediment yield rate of gully headcut erosion de ploey 1989 su et al 2015 this study also shows that vegetation can reduce the runoff velocity and kinetic energy of the jet flow therefore it can be concluded that vegetation weakens the runoff velocity and kinetic energy of jet flow thus reducing the sediment yield of gully headcut erosion 4 3 limitations implication and significance of this study vegetation can significantly curb gully erosion but vegetation covered gully heads still retreat in a peculiar way and the impact of vegetation on the hydraulic erosion process is unclear given this this research clarified the effects of vegetation on the hydrodynamic parameters involved in the gully headcut erosion process and determined the relationships between soil loss and hydraulic parameters and kinetic energy however there are some potential limitations in our study first the erosion of the plunge pool and the headwall overhanging collapse have a great impact on the gully headcut erosion process but our research has not analyzed their respective occurrence mechanism and sediment yield contribution therefore further research should be carried out on plunge pool erosion and gully head collapse in the future secondly vegetation has a certain influence on the proportion of jet flow and on wall flow but our study has not conducted an in depth analysis therefore the influence of vegetation on jet flow and on wall flow in the gully headcut erosion process will be further studied in the future in addition we need to further verify the experimental results and the actual situation so that the research results can be applied in the actual rainfall conditions although the above imperfections represent the limitations of our study we clearly revealed the effect of vegetation on hydraulic erosion control in the gully headcut erosion process which is of great significance to the optimization of vegetation control measures for gully headcut erosion this study showed that key parameters of the gully erosion sediment yield mechanism such as energy consumption are best characterized which provides a reliable parameter basis for the construction of a process based gully erosion prediction model in addition our results showed that bothriochloa ischaemum bi and medicago sativa ms are the most effective vegetation types for gully headcut erosion containment in the loess tableland and we suggest selecting them to control gully headcut erosion 5 conclusions this study investigated how vegetation influences hydraulic erosion in gully headcut erosion compared with bare land vegetation can effectively reduce the runoff velocity and flow turbulence of the upstream area reducing runoff velocity by 15 6 68 2 and maintaining fr in the range of 0 39 0 88 vegetation can increase the manning roughness coefficient by 0 2 2 5 times and increase the darcy weisbach friction factor by 0 9 9 6 times in the upstream area and the effect of the clustered stem type plants was stronger than that of the branched stem type plants vegetation significantly reduced the jet velocity at the gully brink by 33 3 54 4 the gully head rapidly increased the jet velocity at the entry into the plunge pool and vβ was 5 to 14 times vb at 3 6 m3 h inflow discharge vegetation can increase the runoff shear stress of the upstream area the highest proportion of energy was consumed at the gully head 74 76 followed by the upstream area 19 21 and gully bed 4 7 vegetation reduced soil loss rates by 31 to 81 and medicago sativa had the greatest reduction effect and thus can be used as the preferred vegetation for controlling gully headcut erosion a logarithmic trend was obtained for the correlation of soil loss rate with the vb and runoff kinetic energy this study revealed that vegetation had an important influence on hydrodynamics during gully headcut erosion and deepened the understanding of the process and mechanism of gully headcut erosion credit authorship contribution statement yibao lou conceptualization validation investigation writing original draft writing review editing wenlong wang conceptualization methodology writing review editing supervision project administration funding acquisition mingming guo methodology software formal analysis data curation writing review editing wenzhao guo conceptualization resources data curation methodology hongliang kang formal analysis methodology supervision lanqian feng conceptualization investigation yanan zhu data curation formal analysis investigation hao yang data curation software declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was funded through the national natural science foundation of china 42077079 42107356 the china postdoctoral science foundation 2021t140663 and 2020m681062 and the heilongjiang provincial natural science foundation of china yq2021c036 the authors would like to express extreme gratitude to professor xudong peng and professor hai xiao for the help and revision of the article 
2570,vegetation plays an important role in gully headcut erosion processes however it is still unclear how vegetation in the upstream area affects gully headcut erosion processes by changing the hydraulics a series of in situ inflow scouring experiments were conducted on bare land plots and vegetation plots including the upstream area headwall and gully bed planted with bothriochloa ischaemum bi agropyron cristatum ac and medicago sativa ms with clustered stems and artemisia gmelinii ag with erect stems to investigate the influence of vegetation on the hydrodynamic parameters involved in gully headcut erosion processes the results showed that compared with bare land vegetation increased the manning roughness coefficient n and darcy weisbach friction factor f in the upstream area by 0 2 2 5 times and 0 9 9 6 times respectively but reduced the runoff velocity in the upstream area and gully brink however the jet flow velocity at entry into the plunge pool increased rapidly after passing through the gully head the influence of vegetation with clustered stems on roughness and runoff velocity was greater than that of vegetation with branched stems at 3 6 m3 h inflow discharge vegetation can increase the runoff shear stress of the upstream area the energy consumption of the gully head upstream area and gully bed accounted for 74 to 76 19 to 21 and 4 to 7 of the total energy consumption respectively the four vegetation treatments reduced the gully headcut soil loss by 31 to 81 among which ms exhibited the highest reduction the soil loss rate was positively correlated with the jet flow velocity and its kinetic energy and the correlation was the best r 2 of 0 934 and 0 935 respectively p 0 01 presenting a logarithmic trend these results are helpful to deepen the understanding of the roles of vegetation in regulating runoff hydraulic action during gully headcut erosion keywords gully headcut erosion vegetation hydraulic characteristic soil loss data availability the authors do not have permission to share data 1 introduction gully erosion is one of the most serious environmental problems worldwide leading to high sediment yields and severe land degradation oostwoud wijdenes et al 2000 poesen et al 2003 dotterweich et al 2012 babazade et al 2017 the soil loss driven by gully erosion contributes 10 to 94 of the total sediment caused by water erosion poesen et al 2003 gully headcut erosion is one of the important subprocesses of gully erosion robinson and hanson 1995 oostwoud wijdenes bryan 2001 poesen et al 2003 on a global scale linear gully head retreat rates vary between 0 01 and 135 m year 1 vanmaercke et al 2016 vegetation is one of the most important factors influencing gully erosion according to previous studies vegetation can significantly curb the development of gully erosion chen and cai 2006 wang et al 2016 but vegetation covered gully heads still retreat guo et al 2019 kang et al 2021 therefore it is necessary to explore gully headcut erosion under vegetation cover gully headcut erosion occurs via the erosion of several landform units including hydraulic shearing by overland runoff in the upstream area headwall and gully bed jet flow splashing and vortex erosion and mass wasting movement erosion oostwoud wijdenes bryan 2001 zhang et al 2018 guo et al 2021 kang et al 2021 in the process of gully headcut erosion runoff first erodes the upstream area then is divided into on wall flow and jet flow at the gully brink to erode the gully headwall and gully bed and then the two flow types merge at the gully bed to erode the gully bed together oostwoud wijdenes bryan 2001 shi et al 2020 guo et al 2021 kang et al 2022 the gully headcut erosion process changes periodically and includes the soil stress release stress release hollow formation tension crack development gully head collapse collapse debris removal by erosion cycle fig 1 collison 2001 in the process although gravity erosion occurs sediment transport is caused by hydraulic action some studies have found that this phenomenon is different for different land uses covers chen et al 2013 guo et al 2019 kang et al 2021 however it is unclear which erosion process is dominant in gully headcut erosion in different land use cover types gully headcut erosion is mainly affected by many factors such as rainfall topography soil properties vegetation and land use types valentin et al 2005 vanwalleghem et al 2005 babazade et al 2017 shi et al 2020 kang et al 2021 rainfall runoff plays a critical role in the gully headcut erosion process poesen et al 2003 li et al 2015 the runoff from rainstorms is the original force driving gully headcut erosion robinson and hanson 1995 guo et al 2021 research shows that rainfall must exceed a certain threshold to cause gully headcut erosion poesen et al 2003 hayas et al 2019 vegetation is also an important factor affecting gully headcut erosion processes gyssels et al 2005 li et al 2015 wang et al 2016 mukai 2017 my et al 2020 guo et al 2021 it has been shown that vegetation can effectively curb gully development by affecting the erosion resistance of soil and surface runoff hydraulics dong et al 2018 wilkinson et al 2018 some studies indicate that plant roots can effectively increase soil cohesion and consolidate soil reducing soil erodibility and enhancing the soil stability of the gully head chen and cai 2006 morgan and mngomezulu 2003 wang et al 2016 guo et al 2018 guo et al 2020 vegetation can reduce surface runoff volume and velocity by increasing the infiltration and surface roughness of the catchment area and or gully bottom nachtergaele et al 2002 tebebu et al 2010 which largely weakens runoff scouring dong et al 2018 moreover vegetation can intercept runoff reduce the down cutting of gully beds and intercept sediment from catchments and gully heads dong et al 2018 although plants have been found to be an effective means of gully erosion control the role of vegetation in extreme rainfall remains to be further explored moreover it is still unclear how vegetation affects gully headcut erosion by changing the hydraulic conditions of the upstream area it is important to analyze the effect of vegetation on the characteristics of hydraulic parameters to reveal the influence mechanism of vegetation on hydraulic action during gully headcut erosion given these issues a series of in situ runoff scouring experiments under different vegetation types were carried out in the tableland region of the loess plateau china the objectives of this study were to a investigate the effects of different vegetation types on the hydrodynamic parameters involved in gully headcut erosion processes b illustrate the spatial variation in energy consumption and soil loss of the gully headcut system and c reveal the influence of vegetation on hydraulic erosion during gully headcut erosion 2 materials and methods 2 1 study area the experiments were conducted at the nanxiaohegou watershed of xifeng soil and water conservation scientific experimental station of the yellow river water conservancy commission china n35 41 35 44 e107 30 107 31 the station is located in eastern gansu province china situated in the hinterland of the loess plateau and belongs to a semiarid continental climate the mean annual precipitation is 546 8 mm with a large annual variation the rainfall is mainly concentrated in summer when high intensity rainstorms occur the soil types in this area are mainly black loam soil and yellow loam soil gully erosion accounts for 86 3 of the total soil erosion in this area guo et al 2018 under the implementation of large scale ecological restoration soil erosion has been well controlled in the study area fu et al 2011 the main herbaceous vegetation types include medicago sativa l setaria viridis l beauv agropyron cristatum l gaertn artemisia gmelinii artemisia stechmanniana bess bothriochloa ischaemum l keng and stipa bungeana trin 2 2 experimental design 2 2 1 experimental plot design and construction the experimental plots built on a platform of the experimental station were composed of an upstream area gully head and gully bed fig 2 a preliminary experiment showed that when the length of the upstream area is 5 0 m runoff can meet the requirements of stability furthermore the average width height ratio of gully heads in the region is 1 66 che 2012 guo et al 2019 shi et al 2020 the width of the plot was set to 1 5 m and thus the gully head height was calculated to be 0 9 m based on the average width height ratio of the gully heads in the region the length of the gully bed was 1 0 m the slope of the upstream and gully bed was designed as 3 and the slope gradient of the gully headwall was designed as 90 to ensure consistent conditions for each plot the original vegetation roots and rocks were removed from the soil during the construction of the experimental plots then the soil was backfilled layer by layer 20 cm for each layer and attention was given to the consistency of the same soil layer in different plots during filling a steady flow tank was set at the top of the plot for water release and a sampling pool was set at the bottom for collecting sediment samples each plot was surrounded by a 15 cm high ceramic tiles to ensure that the runoff within the plot did not overflow in the upstream area of each plot different vegetation was planted at 10 10 cm spacing and the bare land plot was constructed as a control a total of eight vegetation plots and two bare land plots were built 2 2 2 flow discharge design according to the rainstorm intensity and duration in the study area the rainstorm return period and rainstorm duration were designed as a 30 year return period and 180 min respectively the range of the surface runoff coefficient in the study area was approximately 0 001 0 363 on grassland it was 0 06 and the catchment area at the gully head was mainly concentrated in the range of 0 15 2 0 km2 che 2012 according to the statistical equation between rainstorm events and duration zhang 1983 the rainstorm intensity was calculated by formula 1 1 ri 5 09 n 0 379 t 1 4 0 74 where ri is the rainfall intensity mm min 1 n is the rainstorm recurrence period year and t is the rainfall duration min in this study the calculated rainstorm intensity was 0 39 mm min 1 the inflow discharge can be calculated as follows kang et al 2022 2 q 0 06 λ r i a where q is the inflow discharge m3 h a is the upstream area km2 and λ is the runoff coefficient on the upstream area kang et al 2022 showed that the natural gully head area of 168 m2 at the study area is approximately 200 times the area of the simulated plot headwall then the inflow discharge was calculated to be in the range of 1 05 to 14 04 m3 h according to the preliminary experimental results the flow discharges were finally chosen as a lower flow rate of 3 6 m3 h and a higher flow rate of 8 4 m3 h in this study the purpose was to compare the differences in vegetation effects under lower and higher flow rates a sketch of the gully headcut system simulation experimental plot and the test process are shown in fig 1 2 2 3 vegetation cover design based on a detailed field survey of vegetation types in the study area bothriochloa ischaemum l keng bi agropyron cristatum l gaertn ac artemisia gmelinii ag and medicago sativa l ms were selected as the typical vegetation types in this area bare land bl was used as a control the stems of bi and ac were clustered type and sparse clustered type respectively the stems of ag were multibranched and those of ms were erect and clustered to recumbent each experimental plot was built almost at the same time seeds for sowing were planted in each plot in the upstream area at the same time the plants were thinned 20 days after seed germination to ensure that the row spacing was 10 10 cm during the management and protection of the plots all plots were managed in the same way and plants other than the target vegetation were timely removed each plot was irrigated with the same volume of water the experiment was carried out after 2 years of vegetation growth the detailed information of each plot is shown in table 1 photos of each vegetation are shown in fig 3 2 2 4 experimental procedures and measurements before the experiment the vegetation in the plot was trimmed and the aboveground part was kept at a height of 5 cm to better measure the hydraulic parameters of the upstream area the discharge rate was adjusted to reach the target inflow discharge rate during the experiment the runoff and sediment samples were collected at the outlet of the plot every 2 min the dry sediment quality was obtained by the constant drying method at 105 c after the experiment in addition four observation sections were set up on the upstream area and one observation section on the gully bed the flow velocity v m s of each section was measured by the dyeing tracer method and the runoff depth m and width m at each section and the height of the jet flow were measured by a scale a portable flow velocity meter was used to measure the flow velocity of the jet flow at the gully brink the occurrence time of gravity erosion was recorded 2 3 data analysis 2 3 1 hydrodynamic parameters in the upstream area and gully bed the reynolds number re froude number fr manning roughness coefficient n darcy weisbach friction factor f and shear stress τ pa were calculated as follows 3 re vr v 4 v 1 775 10 6 1 0 0337 t 0 000221 t 2 5 f r v rg 6 n r 2 3 j 1 2 v 7 f 8 g r j v 2 8 τ ρ w r j g where r is the hydraulic radius m v is the runoff velocity m s v is the water kinematic viscosity coefficient m2 s t is the temperature of water c g is the gravitational constant g 9 8 n kg 1 j is the hydraulic gradient and ρw is the water density kg m3 2 3 2 jet flow at the gully head the jet flow velocity at the gully brink and its angle into the plunge pool were calculated as follows alonso et al 2002 dey and sarkar 2006 flores cervantes et al 2006 zhang et al 2016 9 v b qg 3 0 715 f r 1 v j f r 2 0 4 f r 2 f r 1 10 fr v j g d b 11 v β v h c o s β 12 β a r c t a n 2 g d h v j 13 τ v β 0 025 v q 0 2 ρ w v β 2 where q is the runoff rate m3 s vb m s is the runoff velocity at the gully brink vβ is the jet flow velocity at the plunge pool m s β is the angle of the jet flow into the plunge pool db is the runoff depth m dh is the height of the jet flow m and τ vβ is the shear stress of jet flow 2 3 3 flow energy and its consumption in the gully headcut system gully headcut erosion is closely associated to the transformation and consumption of runoff energy zhang et al 2016 shi et al 2020 guo et al 2021 the plot runoff outlet was taken as the reference surface of zero gravitational potential energy the total runoff energy et j s runoff energy at the gully brink eu j s runoff energy when the runoff flows out of the plunge pool eh j s and runoff energy when the runoff flows out of the gully bed eb j s were calculated as follows guo et al 2021 14 e t ρ w g q l u l b s i n θ h 15 e u ρ w g q l h l b s i n θ h 1 2 ρ w q v j 2 16 e h ρ w g q l h l b v b 2 h g s i n θ 1 2 ρ w q v p 2 17 e b 1 2 ρ w q v b 2 where lu lg and lh are the length of the upstream area length of the gully bed and gully head retreat distance respectively θ is the upstream area slope and the gully bed slope and h is the original gully head height 0 9 m vp m s and vb m s are the runoff velocities of the runoff out of the plunge pool and out of the gully bed respectively the total runoff energy consumption δet runoff energy consumption of the upstream area δel runoff energy consumption of the gully head δeh and runoff energy consumption of the gully head δeb were calculated as follows 18 δ e t e t e b 19 δ e u e t e u 20 δ e h e u e h 21 δ e b e h e b the soil water infiltration rate l min 1 is equal to the difference between the input flow and outflow flow pearson correlation analysis was performed to analyze the correlations between soil loss rate and hydraulic characteristics relationships between soil loss rate and jet velocity and runoff kinetics were analyzed in a simple regression method the data were preliminarily processed in microsoft excel 2019 further analyses were conducted in spss 25 0 figures were plotted using origin 2021 software and powerpoint 2019 software 3 results 3 1 effects of vegetation on spatiotemporal changes in hydraulic characteristics 3 1 1 runoff characteristics and regime in the upstream area the runoff rate q runoff depth h runoff velocity vu reynolds number re and froude number fr of the upstream area are provided in table 2 the result illustrate that vegetation can effectively reduce the runoff velocity and flow turbulence of the upstream area and that the vegetation with branched stems ac had less effect on velocity than that with clustered stems bi and ms the q of bi was 0 6 6 0 and 1 4 2 8 less than that of the other plots at 3 6 m3 h and 8 4 m3 h respectively at 3 6 m3 h the h of the vegetation plots was larger than that of bl and the h of the vegetation plots was 1 39 to 2 49 times that of bl however at 8 4 m3 h h was the largest in bl and 1 40 to 2 22 times those in the vegetation plots the h of ag was the smallest among the different vegetation types compared with bl the vu of the vegetation plots was significantly reduced by 15 6 68 2 the re was greater than 2000 and bl had the largest re 17210 at 8 4 m3 h for fr the fr of bl was greater than 1 while the fr ranged from 0 39 to 0 88 in the vegetation plots of which that of ag was the largest 3 1 2 manning roughness coefficient and darcy weisbach friction factor vegetation increased the manning roughness coefficient n and darcy weisbach friction factor f of the upstream area fig 4 the n of the upstream area was ranked in order of highest to lowest under ms bi ac ag and bl the average n of ms bi ac and ag was 1 2 to 3 5 times that of bl compared with bl the vegetation increases the f by 9 6 to 0 9 times the results showed that the vegetation in the upstream area can greatly increase surface roughness and runoff resistance and ms had the greatest effect while ac had a minimal impact 3 1 3 jet flow velocity at the gully head vegetation significantly reduced the jet flow velocity at the gully brink vb but had little effect on the jet flow velocity into the plunge pool vβ fig 5 the difference in vb among the different vegetation types was small fig 5 a c compared with bl vegetation can reduce vb by 33 3 35 6 and 53 5 54 4 at 3 6 m3 h and 8 4 m3 h respectively the vβ ranged from 2 44 to 4 27 m s 1 the runoff velocity increased rapidly after passing through the gully head vβ was 5 to 14 times that of vb and there was no obvious difference in the vβ under different vegetation conditions these results imply that vegetation can significantly reduce the jet velocity at the headcut brinkpoint but the velocity is not significantly affected by the vegetation types and the gully head would rapidly increase the jet velocity at the entry of the plunge pool and weaken the influence of vegetation on the jet velocity 3 1 4 runoff shear stress of the gully headcut system fig 6 shows the variations in runoff shear stress in the upstream area τup gully bed τbed and jet flow τvβ at 3 6 m3 h and 8 4 m3 h respectively at 3 6 m3 h there was no significant difference in τup among ms bi and ac whose τup values were greater than those of ag and bl the average τup of the two groups were 9 36 to 4 03 pa respectively at 8 4 m3 h there was no significant difference in τup among the plots which ranged from 12 82 to 13 95 pa τvβ was significantly higher than τup and τbed which ranged from 54 87 to 75 37 pa and 60 37 to 75 90 pa respectively the τbed ranged from 2 74 to 8 59 pa τbed was smaller than τup and τvβ and ag had the maximum shear force these results illustrate that vegetation can increase the runoff shear stress of the upstream area to a certain extent at small inflow discharges and its increase under bi ac and ms clustered stem was greater than that under ag multibranched stem the gully head can significantly increase the flow shear stress 3 2 runoff energy characteristics of the gully headcut system the runoff kinetic energy of the upstream area ekup runoff kinetic energy at the headcut brink point ekvb runoff kinetic energy of jet entry into the plunge pool ekvβ and runoff kinetic energy of the gully bed ekbed were all higher under 8 4 m3 h than under 3 6 m3 h inflow discharge fig 7 by 2 6 to 9 1 times 3 8 to 8 7 times 2 1 to 3 0 times and 2 3 to 3 9 times respectively vegetation can reduce ek up and the ek up was ranked in order of highest to lowest as bl ag ac bi and ms which ranged from 0 0131 to 0 0477 j s 1 and 0 0641 0 4336 j s 1 at 3 6 m3 h and 8 4 m3 h respectively the ek vb was 125 to 399 higher in the bl than in the vegetation area but there was no significant difference among the different vegetation plots the ek vβ varied between 6 69 and 7 72 j s 1 and 16 34 to 20 37 j s 1 at the 3 6 m3 h and 8 4 m3 h inflow discharges respectively at 3 6 m3 h the ekbed of bl was the highest followed by those of ac and ms and that of ag was the lowest whereas at 8 4 m3 h the ekbed of bl and ms were the highest the total energy consumption and proportion of energy consumed in the different topographic units were significantly different fig 8 the total energy consumption varied from 10 31 to 11 45 j s 1 and 25 32 to 26 77 j s 1 under 3 6 m3 h and 8 4 m3 h and the total energy consumption under 8 4 m3 h was 2 2 to 2 6 times that of 3 6 m3 h under the same inflow discharge there was no significant difference in the energy consumption the different plots the rank of the different topographic units in order of highest to lowest proportion of energy consumed was gully head upstream area and gully bed which accounted for 74 to 76 19 to 21 and 4 to 7 of the total energy consumption respectively these results showed that the runoff energy was mainly consumed at the gully head and upstream area which can reach more than 94 of the total energy consumption 3 3 effect of vegetation on the soil erosion process of gully headcut erosion the soil loss rate showed a multipeak change trend over time and vegetation significantly reduced the soil loss rate fig 9 the soil loss rate varied over the ranges of 1 19 to 142 65 g s 1 and 13 59 to 394 32 g s 1 at 3 6 m3 h and 8 4 m3 h respectively the average soil loss rates of bl were 1 5 to 5 3 times and 1 8 to 2 4 times those of the vegetation plots at 3 6 m3 h and 8 4 m3 h respectively vegetation reduced the soil loss rates by 31 to 81 and 44 to 58 under 3 6 m3 h and 8 4 m3 h respectively furthermore almost every mass movement corresponds to a mutation point of the soil loss rate and the mutation point of soil loss has a certain hysteretic nature the above results indicate that vegetation can restrain the soil loss rate well and the difference in the soil loss rate control among the different vegetation types was decreased under the large flow condition 3 4 correlations between gully headcut system soil loss and hydraulic parameters the soil loss rate had a negative correlation with n and f and a positive correlation with other hydraulic characteristics table 3 the soil loss rate was significantly positively correlated with vb ekup ekvb ekvβ and ekbed p 0 05 or p 0 01 and had a high correlation coefficient with the velocity and kinetic energy of jet flow at the headcut brink point 0 934 and 0 935 respectively a logarithmic trend was obtained for the correlation of soil loss rate with vb and runoff kinetic energy ekup ekvb ekvβ and ekbed fig 10 4 discussion 4 1 vegetation regulation of runoff in gully headcut erosion processes this study showed that vegetation can significantly improve the n and f of the upstream area and reduce the runoff velocity of the upstream area and the jet flow velocity at the gully brink fig 4 compared with bare land the n of vegetation increased by 2 5 to 0 2 times and the f by 9 6 to 0 9 times and ms had the largest values while ag had the smallest vegetation reduced vu by 15 6 68 2 and vb by 33 3 54 4 these results were mainly caused by vegetation effectively increasing the surface roughness and runoff resistance coefficient and reducing the flow velocity prosser and soufi 1998 dunkerley et al 2001 järvelä 2002 muoz carpena and parsons 2004 liu et al 2010 shen et al 2021 duan et al 2022 it has been reported that compared to bare slopes 30 plant stem cover reduced overland flow velocity up to 90 mu et al 2019 the differences in n and f among the different vegetation types were attributed to differences in the morphological characteristics of vegetation duan et al 2022 regarding the morphology of aboveground vegetation stems compared to ag stems bi and ac stems are clustered and ms stems are clustered to recumbent and form a relatively dense grassland table 1 it has been shown that with increasing stem density the surface resistance increases and the flow velocity decreases kervroëdan et al 2019 liu and zhao 2020 therefore the n and f found for the different vegetation types were the largest for ms the smallest for ag based on the above it can be inferred that clustered stem plants increase the roughness and runoff resistance coefficient of the slope more than branched stem plants duan et al 2022 the vegetation significantly reduced the runoff velocity in the upstream area and the jet velocity at the gully brink table 2 fig 5 a similar finding to that reported by kang et al 2021 that the runoff velocity on the upstream slope for bare land was greater than that for grassland this was mainly due to the interception of runoff by plants in the catchment area nachtergaele et al 2002 tebebu et al 2010 wang et al 2021 however the influence of vegetation on the flow velocity of runoff into the plunge pool seems to be small due to the instantaneous gravity acting on runoff through the gully head which probably weakens the influence of vegetation on the jet flow velocity of runoff moreover in the process of gully headcut erosion when runoff flows to the gully head brink the runoff separates into jet flow and on wall flow under the action of inertia and gravity chen et al 2013 kang et al 2022 the higher the velocity of runoff is the greater its kinetic energy which will cause more runoff to form jet flow nan 2011 conversely in this study vegetation stems significantly reduced the runoff velocity and kinetic energy in the upstream area and the reduction in runoff kinetic energy may lead to an increase in the proportion of on wall flow thus increasing the erosion of the gully headwall it is worth mentioning that the vegetation in the upstream area can increase shear stress under the small inflow discharge while under the large inflow discharge there was no apparent difference between the shear stress of vegetation plots and that of bl fig 6a this does not mean that the impact of vegetation was reduced but rather that the shear stress of bare land increases under the small inflow condition the runoff velocity of the vegetation plots was slow and the runoff depth was increased table 2 while under the large inflow condition due to the cutting of runoff the gully was narrowed and the water depth was increased and had larger shear stress bare land is prone to concentrated flow becoming narrower and runoff becoming deeper with time knapen et al 2007 guo et al 2019 kang et al 2021 especially under larger flows increasing the runoff shear stress of bare land 4 2 effect of vegetation on hydraulic erosion in gully headcut erosion processes the soil loss rate showed a multipeak change trend over time especially in the vegetation plots fig 10 this is the result of collapse and guo et al 2019 and kang et al 2021 found that the erosion process of vegetated land was different from that of bare land this is closely associated with the collapse of the headcut s hanging soil root matrix su et al 2015 guo et al 2019 vegetation roots increase the erosion resistance of the upper soil at the gully head and the erosion rate of the bottom of the gully headwall is fast forming a collapse cantilever chen et al 2013 therefore vegetation changes the process of headcut erosion on bare land runoff incisions are dominant processes in gully head retreat while on vegetated land overhanging layers collapse predominantly resulting in gully head retreat guo et al 2019 kang et al 2021 furthermore the mutation point of soil loss has a certain hysteretic nature compared with the collapse time fig 10 the gully head collapses and temporarily obstructs the flow path when the flow forms the runoff path again the sediment transport rapidly increases guo et al 2019 vegetation was able to reduce soil loss rates by 31 to 81 and ms reduced soil loss the most fig 10 the average soil loss rates of bl were 1 5 to 5 3 times those of the vegetation plots under the lower flow 3 6 m3 h the average soil loss rate ranked in order of lowest to highest was ms bi ac and ag while the difference among vegetation types especially ac ag and ms was weakened under higher flow medicago sativa ms has a fine dense root system that performs well in erosion reduction li and pan 2018 and the importance of recumbent grass stolons in reducing sediment yield is greater than that of erect grass stems duan et al 2022 vegetation roots and stems play different roles in the process of runoff erosion increasing soil erosion resistance and altering the runoff process respectively zhou shangguan 2007 duan et al 2022 it is argued that under vegetated conditions the stems and root mat of grass provide high resistance to scour and that fluvial sediment transport is effectively prevented prosser and soufi 1998 duan et al 2022 it was found that under rainfall conditions during slope erosion stems can reduce sediment yield with efficiencies of 59 79 duan et al 2022 previous studies have shown that the soil loss rate is strongly positively related to root system characteristics during gully headcut erosion processes guo et al 2019 the plant root system can increase water infiltration and improve resistance to erosion gyssels et al 2005 allen et al 2018 and the grass root system can decrease soil loss by 45 64 68 45 under gully headcut erosion guo et al 2019 a different pattern was found in this study the soil loss rate of the ms vegetation plot was the largest followed by bi fig 9a however according to table 1 the root length density and root surface area density of bi were the largest followed by ms thus the root characteristics and erosion reduction effects were not consistent this is due to increased soil water content being more likely to lead to gully erosion occurrence tebebu et al 2010 table 1 shows that the runoff rate of ms was lower than that of bi that is the soil infiltration rate of bi was higher which may be the reason why the soil loss rate of ms was lower than that of bi the soil loss rate was positively correlated with runoff kinetic energy and the correlation with jet flow velocity and its kinetic energy was the best r 2 of 0 934 and 0 935 respectively p 0 01 table 3 a logarithmic trend was obtained for the correlation of soil loss rate with vb and its kinetic energy fig 10 runoff energy was the basic driving force of landform change and erosion sediment yield zhang et al 2015 it was shown that energy consumption was accompanied by energy transformation in the gully headcut erosion process zhang et al 2015 previous studies have shown that jet flow kinetic energy is the main driving mechanism of headcut erosion and can be used to predict the sediment yield rate of gully headcut erosion de ploey 1989 su et al 2015 this study also shows that vegetation can reduce the runoff velocity and kinetic energy of the jet flow therefore it can be concluded that vegetation weakens the runoff velocity and kinetic energy of jet flow thus reducing the sediment yield of gully headcut erosion 4 3 limitations implication and significance of this study vegetation can significantly curb gully erosion but vegetation covered gully heads still retreat in a peculiar way and the impact of vegetation on the hydraulic erosion process is unclear given this this research clarified the effects of vegetation on the hydrodynamic parameters involved in the gully headcut erosion process and determined the relationships between soil loss and hydraulic parameters and kinetic energy however there are some potential limitations in our study first the erosion of the plunge pool and the headwall overhanging collapse have a great impact on the gully headcut erosion process but our research has not analyzed their respective occurrence mechanism and sediment yield contribution therefore further research should be carried out on plunge pool erosion and gully head collapse in the future secondly vegetation has a certain influence on the proportion of jet flow and on wall flow but our study has not conducted an in depth analysis therefore the influence of vegetation on jet flow and on wall flow in the gully headcut erosion process will be further studied in the future in addition we need to further verify the experimental results and the actual situation so that the research results can be applied in the actual rainfall conditions although the above imperfections represent the limitations of our study we clearly revealed the effect of vegetation on hydraulic erosion control in the gully headcut erosion process which is of great significance to the optimization of vegetation control measures for gully headcut erosion this study showed that key parameters of the gully erosion sediment yield mechanism such as energy consumption are best characterized which provides a reliable parameter basis for the construction of a process based gully erosion prediction model in addition our results showed that bothriochloa ischaemum bi and medicago sativa ms are the most effective vegetation types for gully headcut erosion containment in the loess tableland and we suggest selecting them to control gully headcut erosion 5 conclusions this study investigated how vegetation influences hydraulic erosion in gully headcut erosion compared with bare land vegetation can effectively reduce the runoff velocity and flow turbulence of the upstream area reducing runoff velocity by 15 6 68 2 and maintaining fr in the range of 0 39 0 88 vegetation can increase the manning roughness coefficient by 0 2 2 5 times and increase the darcy weisbach friction factor by 0 9 9 6 times in the upstream area and the effect of the clustered stem type plants was stronger than that of the branched stem type plants vegetation significantly reduced the jet velocity at the gully brink by 33 3 54 4 the gully head rapidly increased the jet velocity at the entry into the plunge pool and vβ was 5 to 14 times vb at 3 6 m3 h inflow discharge vegetation can increase the runoff shear stress of the upstream area the highest proportion of energy was consumed at the gully head 74 76 followed by the upstream area 19 21 and gully bed 4 7 vegetation reduced soil loss rates by 31 to 81 and medicago sativa had the greatest reduction effect and thus can be used as the preferred vegetation for controlling gully headcut erosion a logarithmic trend was obtained for the correlation of soil loss rate with the vb and runoff kinetic energy this study revealed that vegetation had an important influence on hydrodynamics during gully headcut erosion and deepened the understanding of the process and mechanism of gully headcut erosion credit authorship contribution statement yibao lou conceptualization validation investigation writing original draft writing review editing wenlong wang conceptualization methodology writing review editing supervision project administration funding acquisition mingming guo methodology software formal analysis data curation writing review editing wenzhao guo conceptualization resources data curation methodology hongliang kang formal analysis methodology supervision lanqian feng conceptualization investigation yanan zhu data curation formal analysis investigation hao yang data curation software declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgments this research was funded through the national natural science foundation of china 42077079 42107356 the china postdoctoral science foundation 2021t140663 and 2020m681062 and the heilongjiang provincial natural science foundation of china yq2021c036 the authors would like to express extreme gratitude to professor xudong peng and professor hai xiao for the help and revision of the article 
2571,fluid flow through filled rock fractures is relevant to numerous engineering applications and geophysical processes however a proper understanding of the flow behaviors in filled fractures is still far from being completed to investigate the fluid flow in a rough walled fracture filled with a porous medium we systematically compare the micro and macroscopic flow behaviors within filled fractures and corresponding open fractures and porous media based on a series of pore scale simulation results we find that the filling medium has a dual role in altering the flow regime as the filling particles can not only cut the flow domain into several pore channels and thus limit the generation of large span eddies but also force the fluid to flow around them and promote the generation of local eddies compared with porous media the fluid flow within filled fractures is confined by fracture walls which greatly alters the media permeability and the flow nonlinearity therein by introducing the hydraulic radius and darcy weisbach equation we develop a new semi empirical model to estimate the fluid flow through filled fractures using phenomenological coefficients of corresponding open fractures and porous media the proposed model satisfying dimensional consistency shows high fidelity in predicting water flow through filled fractures more importantly this model can be successfully reduced to the typical form of the forchheimer equation applied to open fractures and porous media the results and findings are expected to be useful in predicting and evaluating the fluid flow in complex geological setting keywords filled fracture confined porous medium non darcian flow semi empirical model data availability no data was used for the research described in the article 1 introduction compared with the tight and intact rock matrix the fractures or discontinuities widely existing in the rock mass provide main flow channels and potential failure planes the flow process in rock fractures plays a crucial role in numerous industrial and scientific applications such as oil or natural gas exploration christensen and tanino 2017 contaminant pollution control noiriel et al 2013 and geothermal energy extraction wang et al 2021 such flow is also relevant to the understanding and prediction of the landslide geological hazards induced by reservoir water fluctuations and rainfall li et al 2019 tang et al 2019 therefore the flow behavior through rock fractures has been considered as an important research subject by many scholars from different disciplines over the decades zimmerman and bodvarsson 1996 nowamooz et al 2009 javadi et al 2014 zou et al 2015 lee et al 2015 wang et al 2020 xing et al 2021 luo et al 2022 however most of these studies only focused on open fractures without any filling material by not doing so the more realistic flow behaviors in filled fractures remains poorly understood after long term water scouring chemical erosion and gravitational settlement natural rock fractures in many geological environments are often filled with sands sediment clay gouge or other materials song and yanful 2010 crawford et al 2008 khosravi et al 2016 wang et al 2016 liu et al 2017 sui et al 2022 many field geology surveys have found that filled fractures are widely present in mountain and subsurface rock masses scanlon et al 1997 elder 1997 wealthall et al 2001 kemp and pearce 2003 hough et al 2006 jiao et al 2014 tang et al 2015 chen et al 2021 hu et al 2021 these natural fillings usually have a large porosity and low frictional properties and thus tend to produce the weakest planes available for the initiation of sliding indraratna et al 2005 jiao et al 2014 tang et al 2015 wang et al 2016 in addition to natural fillings rock fractures are often artificially filled by grouting to improve the mechanical and hydraulic properties of rock masses in many infrastructure projects li et al 2016 zhou et al 2020 the permeability of these grout filled fractures is greatly associated with water leakage or water inrush disasters encountered in these practical rock engineering understanding the fluid flow in filled fractures is therefore essential for accurately evaluating the hydraulic properties of fractured rock aquifers and ensuring the safety and operational performance of rock engineering essentially a filled fracture can be regarded both as a fracture medium containing filling material and as a thin layer of a granular porous medium confined by two fracture walls qian et al 2011 such analogies throw up a series of open questions about the evaluation of the fluid flow in filled fractures compared with the fracture medium how do the filling materials contained affect the fluid flow therein similarly what roles do the confined walls play in the flow behaviors compared with ideal unrestricted porous media how should the influence of the filling material or the confined walls be evaluated quantitatively a large body of evidence has confirmed that the presence of filling material significantly alters the fluid flow in the fracture wealthall et al 2001 investigated the potential pathways for pollutant transport in permo triassic sandstone aquifers and found that filled fractures were less likely to act as preferential pathways than open fractures kemp and pearce 2003 believe that the permeability of the filling relative to the aquifer matrix is an important parameter for determining whether the fractures could form pathways or barriers to contaminant migration which could fundamentally change the conceptual model of flow in these aquifers lunati 2000 and lunati et al 2003 investigated the fluid flow and solute transport through individual fractures filled with glass beads and observed that the propagating front in filled fractures appeared much smoother than that in open fractures indicating that the presence of the filling materials resulted in a more uniform flow distribution within the fracture for a more intuitive understanding of the effect of filling material on fracture flow numerous laboratory studies have been carried out to investigate the permeability of filled fractures with different filling and stress conditions considered in recent years crawford et al 2008 wang et al 2016 liu et al 2017 2019 zhou et al 2020 sui et al 2022 it is concluded that the permeability of filled fractures is closely related to the particle size and porosity of the granular materials contained in general the larger the porosity or particle size of the filling material is the greater the permeability of the filled fractures will be similar conclusions were also drawn in studies on the effect of proppant on fracture permeability in the fields of oil and gas exploitation zheng et al 2017 bandara et al 2020 suri et al 2020 these above mentioned studies provide an important guidance for understanding the flow behaviors in filled fractures but still fall far short of solving the questions thrown to summarize current studies have the following two shortcomings due to the complexity of this issue firstly most of current studies was limited to speculating the effect of filling materials on fracture flow through changes in macroscopic permeability and the microscopic influencing mechanism behind it remains unclear in addition these studies most often assume that fluid flow in filled fractures obeys the linear darcy s law with the flow nonlinearity ignored arbitrarily even for the few works that consider the effect of fracture surfaces roughness obviously such an assumption does not hold true for realistic filled fractures on one hand there is a broad consensus that heterogeneous fracture geometries would result in non negligible flow nonlinearity in the fracture kohl et al 1997 zimmerman et al 2004 ranjith and darlington 2007 quinn et al 2011 lee et al 2014 zou et al 2017 cunningham et al 2020 xing et al 2021 luo et al 2022 on the other hand the non darcian i e nonlinear flow behavior in porous media has been widely observed with increasing pressure gradient or flux which is associated with the granulometric composition of the granular materials and its porosity zeng and grigg 2006 sidiropoulou et al 2007 eck et al 2012 li et al 2019 under the combined action of the fracture walls and filling materials would the filled fracture be more or less prone to non darcian flow which influencing factor is more dominant and under what conditions how can it be evaluated quantitatively all these are open questions aiming to shed insight on the aforementioned questions we conduct a series of pore scale simulations of fluid flow through open fractures porous media and corresponding filled fractures based on these numerical simulations the micro and macroscopic flow behaviors through filled fractures with different filling conditions and geometrical features are systematically compared and the influence mechanisms of filling materials on fracture flow is analyzed and discussed furthermore we quantitatively evaluate the effect of confined walls on the hydraulic properties of porous media and propose a semi empirical model to characterize the non darcian flow behaviors in filled fractures the results and methods in this study are expected to provide new insights and ideas for assessing the fluid flow in complex geological environments 2 methodology 2 1 physical model setup limited by the challenging computational capacity this study focuses on the case of fluid flow in two dimensional 2d fracture models with 40 mm in length and 1 mm in average aperture which would serve as an exploratory step for a deep understanding of the flow behaviors in filled fractures the fracture model considered is generalized to a rough walled fracture filled with a porous medium specifically we adopt a total of five 2d fractures with varying degree of heterogeneity each of which includes different filling combinations of eight porosities from 0 2 to 0 9 and five particle sizes from 0 08 mm to 0 12 mm table 1 to this end we start with a three dimensional 3d artificial fracture with rough walls and variable apertures fig 1 a obtained by splitting an intact cubic granite sample via brazilian splitting technique and then reconstructing it according to pre marked reference positions a 3d morphology scanner system is utilized to measure the surfaces topography and aperture distributions of the fracture more details regarding the brazilian splitting technique the 3d morphology scanner system and the measuring steps can be found in tan et al 2020 the fracture plane i e the x y plane has a dimension around 200 mm 100 mm and the topographical data of each surface are obtained with an interval of 0 1 mm in both and y directions with a maximum resolution of 10 µm the scanned data is further processed to reconstruct the fracture morphology from which four longitudinal cross sections labeled from s1 to s4 are extracted and served as the parent for generating 2d fractures with different geometries fig 1b since the fluid flow in rock fractures is associated with many geometric factors including the surface roughness and aperture distribution zou et al 2017 cunningham et al 2020 xing et al 2021 it is difficult to delineate the fracture heterogeneity by a specific geometric parameter given this the main criterion for determining the desired fractures in this study is the difference in permeability of individual fractures instead of a particular fracture geometry parameter apparently under the same mean aperture the smaller the permeability of the fracture is the stronger heterogeneity the fracture will have zimmerman and bodvarsson 1996 tan et al 2020 this ensures that the different fracture geometries adopted do have different degrees of influence on the fluid flow to accomplish this we first take a series of 2d fractures with a length of 40 mm according to the surface roughness then adjust the average aperture of all these fractures taken to 1 mm by vertically shifting the upper fracture surfaces subsequently we conduct a series of numerical flow experiments through these extracted 2d fractures the numerical simulation method used here will be illustrated in the following section by comparing the permeability and the flow process in these fractures five fractures labeled as fractures 1 2 3 4 and 5 respectively are finally taken fig 1b and table 1 which serve as the geometric input for generating the fracture model with a porous medium filling the detailed geometric and flow characteristics of these five representative fractures taken are presented in table 1 meanwhile the numerical results for these five fractures correspond to the unfilled cases in this study and will serve as a benchmark to evaluate the effect of filling on the micro and macroscopic flow behaviors in fractures in this study the porous medium filling the rough walled fractures is considered to be homogeneous and isotropic and for simplicity is generalized as a hexagonal array of impermeable circles packed at an equal interval δd fig 1c in this case different combinations of porosity and particle sizes of porous media can be implemented by setting the diameter of these circles and the interval between them the same generalization method for porous media is also widely adopted in many numerical and theoretical studies on the fluid flow in porous media reynolds et al 2000 hill and koch 2002 kim and kang 2020 given that the fluid in porous media can only flow through the pore channels formed by the particle interstices therefore the porous media model for fluid flow simulation can be implemented by subtracting these impermeable particles from the overall domain via boolean operations for the 2d filled fracture model considered in this study this overall domain is the closed domain formed by the upper and lower fracture walls note that to ensure the accuracy of the filling porosity assigned those solid particles across the fracture walls will be sheared off retaining only the portion inside the fracture fig 1c for each filled fracture model described above we construct its corresponding ideal unrestricted porous media model to elucidate the effects of the confined walls the construction method is similar to filled fracture model except that the upper and lower walls used here are smooth flat plates apparently the larger the width of the model is the weaker the confining effect of the wall on the fluid between them is and the closer the model will be to true porous media as for the length of the model the hydraulic properties of porous media should be independent of its length if the size effect is neglected finally based on a prior sensitivity analysis of the model size the square porous media model with a length and width of 5 mm is chosen for flow simulations in this study to achieve a balance between sufficient characterization performance and computational cost fig 1d 2 2 direct numerical simulation for water flow the motion of an incompressible newtonian viscous fluid at steady state is governed by the navier stokes equations nse supplemented by the continuity equation which represent momentum and mass conservations and can be written as 1 p μ 2 u ρ u u 2 u 0 where u is velocity vector ρ is fluid density p is pressure and μ is dynamic viscosity coefficient note that here we ignore the gravity term considering that the contribution of gravitation forces to water pressure is negligible for water flow through small aperture fractures in the near horizontal direction in this study we consider the fluid flow through filled fracture and porous media models from left to right fig 1 for each simulation we assign a constant flow rate at the inlet of the model such the inflow condition allows the fluid to enter the domain freely thus reducing the boundary effect and improving the convergence rate zou et al 2017 the outlet boundary of flow is set as a constant zero pressure p 0 in addition the fracture walls and the outer edges of impermeable circles constituting the porous media are assumed as no slip boundaries to investigate the flow regimes evolution in filled fractures and porous media a series of inflow conditions with different reynolds numbers re across two orders of magnitude are applied for each physical model re 1 10 20 40 60 80 100 here a commonly used definition of re in rock mechanics and geophysics communities is adopted to ensure consistent boundary conditions for fracture and porous media models given as 3 re ρ u e 0 μ where u q w is the specific flux volumetric flux per area where q is the volumetric flow rate per unit width w is the cross sectional width where flow passes through for fluid flow in 2d fractures u q e 0 where e 0 is the mean mechanical aperture standard water properties with ρ 1000 kg m3 and μ 0 001 pa s are adopted for simplicity the commercial finite element software package comsol multiphysics is employed to conduct the numerical flow experiments by solving the governing equations with the boundary conditions set above in the simulation a small relative tolerance 0 001 of mean velocity difference at adjacent iteration steps is chosen for stopping the simulation and evaluating the results to overcome the solver convergence issues widely encountered in solving nse including the inertial term we implement a scheme of progressively and incrementally increasing the inlet flow rate to reach specified flow conditions where a preceding solution with the last prescribed low flow rate is set to be the initial guess for the computational case with next prescribed flow rate for numerical simulations the 2d flow domain is discretized into around 15 million lagrange triangular elements in general the smaller the porosity is the narrower the flow path is accordingly the finer the mesh required will be therefore relatively coarser meshes 10 6 mm 10 2 mm are used for the models with large porosity ϕ 0 4 while much finer meshes 10 7 mm 10 3 mm are adopted for the models with small porosity ϕ 0 4 in this study for each simulation the final number of elements is determined through a prior sensitivity analysis of mesh size to ensure mesh independency of the results the flow simulations are run on a high performance workstation with 128 gb memory with up to 70 gb of memory being used during each run 3 results 3 1 microscale flow process in filled fractures since fracture filling particles inevitably changes the flow paths and the effective advective space within the fracture the microscopic or local flow behaviors in filled fractures are predictably different from those in open ones without loss of generality the numerical results for open fracture fracture 1 and corresponding filled fracture with a filling porosity ϕ 0 5 and a particle size d 0 1 mm are exemplified to dictate this difference fig 2 fig 2a and c shows the velocity fields and the streamline distributions in these two fracture models at re 100 in which the view of the entire fractures represents the norm of the combined velocity field while the accompanying magnified section shows the streamline distributions and the x component velocity fields of a representative segment defined by the interval of x 34 mm 36 mm theoretically the flow velocity of the section with a smaller aperture in 2d fractures is higher than that of the section with a larger aperture to maintain the conservation of mass dou et al 2019 tan et al 2021 however we see that low velocity zones or eddies also form and develop at the abruptly changing large aperture segments which leads to the formation of main flow channel with a relatively high flow velocity in these sections the low velocity zone described in this paper refers to the region where the flow velocity is less than one order of magnitude of the maximum flow velocity in the flow domain blue parts in figs 2 and 3 the eddies could be regarded as a special case of low velocity zone note that as a result of the no slip boundary conditions at the fracture walls there are low velocity zones near the fracture walls and high velocity zones usually near the fracture center plane in each cross section within the open fracture but the low velocity zones or eddies caused by the fracture geometry have larger spans making the channeling flow phenomenon more prominent in contrast the flow velocity distribution in the filled fracture is quite homogeneous although the overall flow velocities at segments with different apertures also differ under the requirement of mass conservation the transition of flow velocities at different regions within the filled fracture is smooth and almost no visible mainstream channels with a relatively high flow velocity are present in addition the average value and range of flow velocity in the filled fractures are significantly larger than that in the corresponding open ones this is because the filling particles squeeze the original fracture space making it required to maintain the same flow rate at a higher rate for filled fracture compared to the corresponding open fracture from the local flow behaviors shown in the magnified section of fig 2a and c one can see that a clear eddy is generated near the lower wall surface of the open fracture and accordingly the negative x component velocity also marks the presence of the eddy flow or backflow regions in contrast the presence of filling appears to weaken the dominant role of fracture walls on fluid flow processes we see that the streamlines in the corresponding filled fractures are uniformly distributed in the interstices of the filling particles which prevents the generation of large span eddies and is responsible for the more uniform flow velocity fields in this case local eddies and backflows can only develop on the backside of the particles due to boundary layer separation which corresponds to the negative x component velocity shown in fig 2c and is an important cause of flow nonlinearity in filled fractures and porous media hill and koch 2002 sidiropoulou et al 2007 in addition we see that the flow velocity in pore conduits parallel to the fracture walls is significantly greater than that in the conduit toward the other directions indicating that the effect of the fracture walls on fluid flow in filled fractures is not negligible on the contrary the fracture walls still dominate the overall flow velocity magnitude and flow direction in filled fractures to further compare the local flow behaviors within filled and open fractures the x component velocity profiles at a representative cross section x 35 mm labeled with a a in fig 2a and c with different re numbers is presented in fig 2b and d we see that the cross sectional flow velocity distribution within the open fracture is significantly different from that of the corresponding filled one for the open fracture the flow velocity magnitude varies continuously along the cross sectional line with zero velocity being at the upper and lower ends as a result of the no slip boundary conditions with the increasing re the maximum value of flow velocity in the fracture increases and the flow velocity near the bottom surface of the fracture appears negative which responds to the generation of eddy and backflow observed in fig 2a in addition the velocity profiles located in both the positive and negative flow regions where the x component flow velocity is positive and negative respectively obey the parabolic function in shape in contrast the velocity profiles along the cross section within the filled fracture is separated into what appears to be several independent parts indicating that the flow process in a filled fracture can be considered as a combination of fluid flow in several conduits this is consistent with what blick 1966 generalized for the flow process within porous media we see that the velocity profiles in each conduit also obey the parabolic function in shape the ratio of the standard deviation σu of the mean flow velocity among these conduits to the mean flow velocity ux of the entire cross section is used to quantitatively evaluate the heterogeneity of the velocity fields within the fracture we calculate the ratios σu ux for the filled fracture and open fracture to be 0 135 and 0 556 respectively indicating that the velocity profile along the cross section in the filled fracture is more uniform than that in the corresponding open one above comparison fully illustrates how the local flow behavior within open fractures differs from that of the corresponding filled ones it is concluded that the porous medium filling and the fracture walls together influence the fluid flow in filled fractures as a result the fluid flow in a filled fracture resembles that in a porous medium but the freedom of flow is bounded by two fracture walls qian et al 2011 to further evaluate the effects of filling conditions on the flow behaviors within the fracture we compare the normalized x component velocity fields of the fluid flowing through the hexagonal array of impermeable circles with different particle size and porosity at re 100 fig 3 which is the basic building unit of the porous medium considered in this study note that the color contour map here only covers the regions with positive flow velocity while the negative velocity zones are represented by blank areas theoretically when the fluid bypasses the solid particle low flow velocity or even eddies regions would form on the backwater side of the particle as a result of the shear stress action on the fluid we see that for the case of small porosity the low velocity region exists only in a small extent near the particle walls indicating that the closely packed particles limit the generation of large span eddies and making the flow process more uniform in the fracture with the increase of porosity the range of low velocity zone on the backwater side of particles increases significantly which would enhance the heterogeneity of velocity field in the fracture and thus induce the non darcian effect when the porosity is large enough the fluid boundary layer may even separate from the particle surface to the point of visible local eddies blank areas on the backwater side of the particle in fig 3 which as mentioned before is responsible for flow nonlinearity within porous media in addition the increase in particle size is accompanied by an increase in the water facing area resulting in an increase in the extent of low velocity and eddy zone on the backwater side of the particle however compared with the filling porosity the flow within the filled fracture is less sensitive to the change of the filling particle size especially when the porosity is small in summary the filling medium greatly affect the flow characteristics of the fracture via two competing mechanisms on one hand the filling medium cuts the flow channel into several pore channels limiting the generation of large span eddies and making the flow process more uniform in the fracture on the other hand the fluid in filled fractures has to flow around these impermeable particles thus promoting the generation of local eddies and enhancing the flow complexity when the filling porosity is small this effect of homogenizing the fluid flow dominates and with the increase in porosity and particle size the effect of complicating the flow process gradually becomes significant 3 2 macroscale flow behavior of filled fractures the microscale flow process manifests through impacting the macroscopic flow behaviors of the fracture over the past decades numerous empirical and theoretical equations have been proposed to characterize the macroscopic non darcian flow behaviors in porous and fractured media among which the forchheimer equation is most widely used one due to its simple form and well defined physical significance zimmerman et al 2004 sidiropoulou et al 2007 zhou et al 2019 it reads as 4 p μ k v u ρ k i u 2 where k v and k i are the intrinsic permeability and inertial permeability respectively depending only on the geometries of the media the forchheimer equation characterizes the energy losses in fluid flow process due to viscous and inertial effects respectively when the inertial effects are negligible compared with the viscous effect the forchheimer equation reduces to darcy s law that is p μ k v u without loss of generality the relation between the pressure gradient and specific flux for water flow through a representative fracture fracture 1 with different filling conditions are presented in fig 4 where the dashed line represents the predicted curve using linear darcy s law and the solid line is the best fitting curves using the forchheimer equation eq 4 as expected the filling conditions largely determine the macroscopic flow behaviors of the fracture with the increase of the filling porosity and particle size the pressure gradient required to maintain the same flux decreases sharply indicating a dramatic increase in the fracture permeability this can essentially be attributed to the decreased fluid solid interfacial area within the fracture which significantly increases the effective permeability we see that the permeability of fractures with different filling porosity can vary by orders of magnitude in addition the linear darcy s law can better characterize the relationship between the pressure gradient and specific flux for fractures with smaller filling porosity but for the case with larger filling porosity the curve gradually deviates from the linear pattern with the increasing flow rate this is because that the porous medium filling with larger porosity contributes to the generation of low velocity region and eddies induced by boundary layer separation as the fluid bypasses the solid particles thus enhancing the flow nonlinearity fig 3 in any case the forchheimer equation can characterize the macroscopic flow behaviors well for all filling scenarios the effective permeability k e calculated from the darcy s law μu p is a key hydraulic property of rock fractures for macroscopically characterizing the nonlinear flow behavior and the evolution in flow resistance within the fracture combining with forchheimer equation eq 5 it is clear that when the viscous force dominates the flow process within the fracture the value of k e would remain constant and the flow in the fracture is in a linear regime with the increasing inertial force a decreasing pattern of k e would be observed and the flow enters a nonlinear stage to facilitate comparison of the relative variation in k e of different filled fractures k e for each filling scenario is normalized by the intrinsic permeability k v with the low re case re 1 is adopted here when inertial effects are trivial the normalized permeability k e k v of a representative fracture fracture 1 with different filling conditions is plotted against re in fig 5 for a general evaluation the normalized permeability k e k v for all cases monotonically decrease with re but the decreasing magnitude is closely associated with the filling conditions when the filling porosity is small enough ϕ 0 4 in our study the normalized permeability almost remains a constant of 1 with only a small decrease at very large re indicating that the viscous force dominates the flow process and the flow in the filled fracture follows the linear darcy s law fig 4 as the filling porosity increases from 0 2 to 0 9 the decrease in k e k v becomes increasingly notable specifically the value of k e k v at re 100 decreases from 0 99 to 0 72 this indicates that inertial forces become increasingly non negligible compared to the viscous forces and the flow nonlinearity enhances gradually in addition to filling porosity filling particle size also affects the relation between k e k v and re we see that the larger the particle size is the more significant the decrease in k e k v with re will be the value of k e k v decreases from 0 95 to 0 90 as the particle size increases from 0 08 mm to 0 12 mm at re 100 this indicates that the increase in particle size also somewhat enhances the flow nonlinearity which is consistent with the results revealed by the microscopic flow behavior in this study fig 3 recalling the forchheimer equation eq 5 the inertial effect is the essential cause of flow nonlinearity given this the ratio α of nonlinear pressure drop the second term of eq 5 ρu 2 k i to total pressure loss μu k v ρu 2 k i during fluid flow is usually introduced to evaluate the degree of flow nonlinearity zeng and grigg 2006 with reference to previous studies the ratio α 10 is adopted in this study to delineate the critical point between the linear and nonlinear flow combining with eq 3 and using the relation α 10 the critical reynolds number re c can be formulated as 5 re c e 0 k i 9 k v as one can see re c depends only on the intrinsic permeability and inertial permeability of the media and quantifies the onset of non darcian flow fig 6 shows the variation of re c of filled fractures with different filling porosity and particle size we see that with the increasing porosity and particle size re c of filled fractures gradually decreases via a power law which support the above argument that the fluid flow in filled fractures with greater filling porosity and particle size is more prone to transition into the non darcian flow regime interestingly when the filling porosity is large enough re c of filled fractures could even be smaller than that of corresponding open ones indicating that the ability of the filling medium to complicate the fluid flow is stronger than that to homogenize the fluid flow in this case in addition re c of different filled fractures with the same filling conditions is distinct as a result of the fracture geometry but the difference among them decreases with the increasing filling porosity and particle size in particular the increase in porosity and particle size reduces the maximum difference in re c among different filled fractures by 191 and 25 respectively this indicates that the flow nonlinearity is caused by both the fracture geometry and the filling contained with the increasing filling porosity and particle size the flow nonlinearity caused by the filling gradually increases and accordingly the contribution of the fracture geometry to the flow nonlinearity gradually decreases 4 discussions 4 1 quantitative evaluation of the effects of confined walls the results above shows that the fluid flow within filled fractures is greatly governed by the porous medium filling the fractures resulting in a significant difference from the fluid flow within the open fracture meanwhile compared with porous media the fluid flow within filled fractures is confined by two fracture walls resulting in different flow behaviors to quantitatively evaluate the effects of confined walls on the fluid flow in filled fractures the relative error characterizing the difference in hydraulic properties between filled fractures and the corresponding porous media is defined as 6 e h h f h p h p where h p and h f represent the hydraulic parameters characterizing the hydraulic properties of filled fractures and corresponding porous media respectively for example the effects of confined walls on the intrinsic permeability can be quantified by e k v k v f k v p k v p where k v f and k v p represent the intrinsic permeability of filled fractures and corresponding porous media respectively a positive value of this relative error indicates that the presence of confined walls would increase the intrinsic permeability and vice versa as mentioned above the effects of confined walls are greatly associated with the geometric structure of the porous medium filling the fracture represented by the case with the filling particle size d 0 1 mm fig 7 shows the dependence of the relative error in intrinsic permeability k v and inertial permeability k i induced by confined walls with different heterogeneity on the filling porosity we see that the presence of confined walls would result in a decrease in both k v and k i compared with the porous media with the increasing porosity the relative errors in intrinsic permeability k v and inertial permeability k i show a decreasing and increasing trend respectively this indicates that the larger the filling porosity the greater the contribution of confined walls to intrinsic permeability and the smaller the contribution to inertial permeability in addition the effect of confined walls on fluid flow in filled fractures is associated with the fracture heterogeneity the stronger the heterogeneity of the fracture is the more significant this effect will be in particular the smaller the intrinsic and inertial permeability of the open fractures fabricated by these fracture walls see table 1 the more pronounced the reduction of the corresponding parameters of the porous media they cause to further quantitatively evaluate the effects of confined walls on flow nonlinearity within filled fractures we calculated the relative error in the critical reynolds number re c for different filled fractures with the particle size d 0 1 mm fig 8 in general for most filling cases the relative error values of re c are negative indicating that the existence of the confined walls would enhance the flow nonlinearity however with the increase of filling porosity the effects of confined walls on flow nonlinearity gradually weakens when the porosity is large enough the relative error value may change from negative to positive which means that the confined walls instead lead to an attenuation of the flow nonlinearity this is due to the fact that the loose porous structure significantly enhances the flow complexity in which case the confined walls instead restrict the flow expansion in the lateral direction thus weakening the heterogeneity of velocity field and the flow nonlinearity in the filled fracture in addition the effect of individual confined walls on flow nonlinearity varies due to different heterogeneity when the filling porosity is small ϕ 0 5 in our study the more heterogeneous the confined wall is i e corresponding open fractures have smaller intrinsic and inertial permeability the more pronounced the enhancement of the flow nonlinearity will be however as the filling porosity increases the cluster of e re c ϕ curves for different fracture walls show a converging trend to intersect each other suggesting that the change in flow nonlinearity induced by confined walls no longer corresponds to its heterogeneity if the filling porosity is sufficiently large this is due to the fact that as the filling porosity increases the flow nonlinearity is gradually dominated by the filling medium and the effects of the confined walls become increasingly less important the evaluation of effective permeability of geologic media is a key task associated with many practical applications and related work has been carried out intensively in geological porous and fractured media the above analysis results show that the existence of confined walls makes the hydraulic properties of filled fractures significantly distinct from those of the corresponding porous media predictably the confined walls would also play an important role in the permeability evaluation of filled fractures without loss of generality the numerical results for a representative filled fracture fracture 1 with the particle size d 0 1 mm are exemplified for comparison the possible relative error of the effective permeability ke induced by the confined walls is calculated and illustrated in fig 9 we see that the relative error value is always negative for all scenarios indicating that ignoring the fracture walls would largely overestimate the effective permeability of filled fractures the dependence of the relative error value on the re is associated with the change in the flow nonlinearity of the porous media with the increasing porosity the relationship between relative error value and re gradually changes from negative to positive correlation which corresponds to the transition from enhanced to reduced effect of the confined walls on flow nonlinearity in addition compared with re the relative error is more sensitive to the structural characteristics of the filling medium overall the larger the filling porosity the larger the magnitude of the relative error and accordingly the stronger the effect of the confined walls to reduce the effective permeability of the media the effective permeability can be reduced by up to 36 4 2 a nonlinear flow model for filled fractures the above analysis fully confirms the necessity of considering the role of both the filling medium and the confined walls when evaluating the flow behavior of filled fractures essentially the solid particles constituting the filling medium and the confined walls affect the flow process by forming the flow boundaries between the fluid and the solid these boundaries constrain the flow path and change the flow velocity distribution thus causing variations in the flow resistance and the macroscopic flow characteristics of the media to quantitatively evaluate the effect of these flow boundaries on the fluid flow the hydraulic radius r defined as the ratio of pores volume within the media to the fluid solid interfacial area is commonly incorporated into flow models for porous and fractured media costa 2006 for the 2d fracture model filled with circular particles considered in this study pores volume within the media is the product of total fracture volume and porosity 7 v p l e 0 ϕ where l and e 0 are the length and mean mechanical aperture of the fracture respectively accordingly the fluid solid interfacial area should be the sum of the surface area of filled circular particles and two fracture walls area 8 s n π d 2 l 4 l e 0 1 ϕ d 2 l where n is the number of filled particles note that here we ignore the contribution of the fracture walls undulation to the hydraulic radius which is integrated into the other coefficients in flow models shown blow combining eqs 7 and 8 the hydraulic radius r considered in this study can be expressed as 9 r v p s ϕ 4 1 ϕ d 2 e 0 where e0 is the mean mechanical aperture of the fracture when ϕ 1 eq 9 reduces to the expression for the hydraulic radius of the open fracture that is r e 0 2 by considering the porous material as an assembly of pore conduits the pressure loss during flow in filled fractures can be characterized by the darcy weisbach equation with r being the characteristic length 10 p f ρ v 2 r where v u ϕ is the characteristic flow velocity f is the friction factor and can be generalized as a function of characteristic reynolds number re for porous and fracture flow zhou et al 2016 ma et al 2022 11 f f re a re b where a and b are the coefficients depending on the geometrical properties of the media note that the here re characterizes the water flow in the actual pore conduits and is defined as re 2ρvr μ to enable its reduction to eq 3 at ϕ 1 the above treatment for fluid flow in porous materials is also widely adopted in the classical kozeny carman kc equation and in many subsequent modified models kozeny 1927 carman 1937 ergun 1952 costa 2006 combining eqs 10 and 11 we can arrive at a universal expression to describe the macroscopic flow behaviors of the open fractures porous media and filled fractures 12 p α μ r 2 ϕ u β ρ r ϕ 2 u 2 note that the dimensionless coefficients α and β here lump together the constant terms in the formula derivation and are only associated with the geometry of filled fractures we see that the formula form of the model is consistent with forchheimer equation eq 5 and therefore has the same physical significance when ϕ 1 substituting eq 9 into eq 12 yields the expression of pressure gradient for open fractures 13 p 4 α 1 e 0 2 μ u 2 β 1 e 0 ρ u 2 where α 1 and β 1 are the integrated coefficients characterizing the effects of fracture geometry on the inherent permeability and inertial permeability respectively combining eqs 4 and 13 α 1 e 0 2 2 k v and β 1 e 0 2 2 k i can be obtained similarly when e0 tends to infinity substituting eq 9 into eq 12 yields the expression of pressure gradient for porous media 14 p α 2 4 1 ϕ d 2 ϕ 3 μ u β 2 4 1 ϕ d ϕ 3 ρ u 2 where α 2 and β 2 are coefficients depending on the geometry of the porous media it is worth noting that the form of eq 14 is consistent with most flow models proposed to describe the flow behavior in porous media ergun 1952 kovács 1980 moutsopoulos et al 2009 li et al 2019 apparently to incorporate eq 12 in the prediction and evaluation of non darcy flow through actual filled fractures the determination of the phenomenological coefficients α and β in the equation becomes indispensable for filled fractures the coefficients α and β should be the result of the joint action of the fracture walls and the porous filling medium given that the above mentioned coefficients α 1 β 1 α 2 β 2 strongly depends on and encapsulates the intrinsic geometry properties of open fractures and porous media thus the coefficients α and β should be functions of α 1 and α 2 β 1 and β 2 respectively in view of this we obtain these coefficients α 1 β 1 α 2 and β 2 by performing a best fit regression of the forchheimer equation on the numerical results for the corresponding open fractures and porous media and demonstrate their relationships with α and β fig 10 note that fig 10 only shows the results for particle sizes of 0 08 mm 0 1 mm and 0 12 mm to establish the flow model while the rest of the simulation data will be used subsequently for model validation we see that α and β are well correlated with their corresponding coefficients for open fractures and porous media according to the trends of the data points in fig 10 the following functions are adopted to characterize the dependence of α on α 1 and α 2 and β on β 1 and β 2 15 α m 1 α 1 m 2 α 2 m 3 β n 1 β 1 n 2 β 2 n 3 where m 1 m 2 m 3 n 1 n 2 and n 3 are dimensionless regression coefficients a regression analysis is performed for all the data using the levenberg marquardt lm optimization algorithm which yields the best fitted values of the dimensionless coefficients in eq 15 m 1 0 89 m 2 0 21 m 3 0 99 n 1 1 36 n 2 0 12 and n 3 0 73 with high coefficients of determination r 2 of 0 93 and 0 97 respectively this indicates the proposed equations can be used to accurately estimate the variation in α and β we should note that the study of fluid flow in porous media and open fractures as opposed to filled fractures has been conducted extensively in the last several decades and numerous theoretical and empirical expressions have been developed for their phenomenological coefficients i e α 1 β 1 α 2 β 2 sidiropoulou et al 2007 zhou et al 2015 li et al 2019 rong et al 2020 tan et al 2020 this makes the predictive model viable and promising for predicting the water flow of filled fractures in a true field setting combining eqs 9 12 and 15 a new semi empirical model can be finally developed for predicting fluid flow through filled fractures based on phenomenological coefficients describing the flow properties of corresponding open fractures and porous media given as 16 p α 4 1 ϕ d 2 e 0 2 ϕ 3 μ u β 4 1 ϕ d 2 e 0 ϕ 3 ρ u 2 α m 1 α 1 m 2 α 2 m 3 α 1 ϕ 1 α 2 e 0 β n 1 β 1 n 2 β 2 n 3 β 1 ϕ 1 β 2 e 0 this semi empirical flow model adequately considers the influences of the filling medium and the fracture walls on fluid flow in filled fractures and has the advantage of dimensional consistency importantly it can be successfully reduced to the typical form of the forchheimer equation applied to open fractures and porous media when ϕ 1 and e 0 tends to infinity respectively to synthetically verify the performance of this semi empirical model the comparison between the calculated pressure gradient with eq 16 and numerical results for scenarios with particle sizes of 0 8 mm and 0 11 mm 560 data points in total which are not previously used for fitting are presented in fig 11 the solid line in the figure indicates that the theoretical value is equal to the measured results we see almost all data points are located near the solid line indicating the high fidelity of the proposed model in addition the average estimation error is introduced to further quantitatively evaluate the prediction accuracy of the flow model and defined as 17 e ave 1 n j 1 n p cal j p mea j p mea j 100 where p mea j is the measured pressure gradient p cal j is the calculated pressure gradient and j represents the j th data point and n is the total number of the data points n 560 in this study based on the numerical results an average estimation error of 4 6 is obtained this high accuracy proves the validity of the developed model again 4 3 implication and limitation as mentioned above the filled fracture consists of the confined walls and the filling medium contained therein by means of a comparison of the flow behaviors within the filled fracture and the corresponding open ones we illustrate how the filling medium affects the fluid flow therein similarly the effects of the confined walls on fluid flow are quantitatively evaluated by comparing the flow characteristics in filled fractures with those of porous media finally we develop a semi empirical model which can accurately predict non darcian flow behaviors through filled fractures based on phenomenological coefficients describing the flow properties of the corresponding open fractures and porous media considering that previous studies have yielded many fruitful equations for predicting the phenomenological coefficients of open fractures and porous media the semi empirical model proposed is a continuation of these studies and can be promisingly applied to practical problems associated with water flow through filled fractures to the best of our knowledge this study presents the first attempt to conduct such a detailed analysis and quantitative evaluation on the fluid flow in filled fractures one can see that the proposed model takes into account the effect of fracture aperture which means that the model holds promise for evaluating water flow in more generalized filled fractures or confined porous media such as pressurized aquifers faults and shear zones therefore our results and findings not only contribute to a proper understanding of flow behaviors through filled fractures but also provide theoretical guidance for predicting and evaluating the water flow in complex geological environments despite of its considerable contributions this study still has some limitations in terms of the computational model adopted in this study due to the difficulties in solving nse for modeling flow in complex fracture and pore structures with an extremely fine representation of geometries this study only focuses on 2d small scale models the fluid flow in realistic 3d filled fractures would be more complex than in 2d cases considering that the 2d simulations cannot capture the channeling flow and transverse flow in other horizontal directions therefore the proposed model in this study needs to be further calibrated and improved by considering the effect of dimensionality before being applied to more complex 3d situations in addition given the main focus of this study is the joint effect of fracture walls and filling conditions on the non darcian flow at steady state the particles that form the porous medium filling are assumed to be rigid and stationary such an assumption holds true when the fluid shear stress in the fracture is not sufficient to overcome the grain friction in fact the particles in fractures are not always stationary and can be transported in many cases hu et al 2021 the mutual feedback between non darcian flow and particle transport in filled fractures is still an outstanding research topic that remains to be further explored nevertheless these simplifications adopted in this study would not change the physical laws which govern the fluid flow in filled fractures as an exploratory work the findings of this study may provide significant foundation for investigating these complex flow and transport problems in the near future 5 conclusion in this study a series of high resolution numerical simulations of water flow through open fractures porous media and corresponding filled fractures are conducted mainly for evaluating the non darcian flow behaviors in rough walled fractures filled with a porous medium comparison of the flow behaviors within the filled fractures and the corresponding open ones shows that the filling medium greatly affect the flow characteristics in the fracture via two competing mechanisms on one hand the filling medium cuts the flow channel into several pore channels limiting the generation of large span eddies and making the flow process more uniform in the fracture on the other hand the fluid in filled fractures has to flow around these impermeable particles thus promoting the generation of local eddies and enhancing the flow complexity with the increasing filling porosity and particle size the effect of homogenizing the flow is weakened and the effect of complicating the flow process gradually becomes significant compared with porous media the fluid flow within the filled fracture is confined by fracture walls which could both enhance and attenuate flow nonlinearity therein depending on the fracture heterogeneity and the filling conditions neglecting the presence of fracture walls would largely overestimate the permeability of filled fractures by introducing the hydraulic radius and darcy weisbach equation a new semi empirical model for describing the fluid flow through filled fractures based on phenomenological coefficients describing the flow properties of corresponding open fractures and porous media is successfully established and verified this proposed semi empirical model bears a concise expression following dimensional consistency and can be successfully reduced to the typical form of the forchheimer equation applied to open fractures and porous media our methods and results are expected to be useful to geologists and hydrologists who are concerned with fluid flow in complex geological environments declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work was supported by the national natural science fund of china 42090054 41922055 51909247 41931295 and 42207179 the key research and development program of hubei province of china 2020bcb079 and fundamental research funds for the central universities china university of geosciences wuhan cuggc09 we thank the editors and two anonymous reviewers for their constructive comments which help us greatly improve the quality of the manuscript appendix a to ensure the rationality of the size selection for porous media model construction the sensitivity analyses of simulation results with respect to model size is performed at the maximum re value for this purpose two sets of porous media models are constructed for flow simulations one with 5 mm width and different lengths and the other with 5 mm length and different widths taking the porous media model with the particle size d 1 mm and porosity ϕ 0 5 as an example fig a1 shows the dependence of the normalized pressure gradient p p 0 on model length l and width w at re 100 where p 0 is pressure gradient for a sufficiently large model l 40 mm or w 10 mm in which the boundary effects can be neglected we find that the normalized pressure gradient converges to a constant 1 with only subtle fluctuation when the model length or width exceeds 5 mm indicating that a square model with a side length of 5 mm is adequate to characterize an ideal unrestricted porous medium 
2571,fluid flow through filled rock fractures is relevant to numerous engineering applications and geophysical processes however a proper understanding of the flow behaviors in filled fractures is still far from being completed to investigate the fluid flow in a rough walled fracture filled with a porous medium we systematically compare the micro and macroscopic flow behaviors within filled fractures and corresponding open fractures and porous media based on a series of pore scale simulation results we find that the filling medium has a dual role in altering the flow regime as the filling particles can not only cut the flow domain into several pore channels and thus limit the generation of large span eddies but also force the fluid to flow around them and promote the generation of local eddies compared with porous media the fluid flow within filled fractures is confined by fracture walls which greatly alters the media permeability and the flow nonlinearity therein by introducing the hydraulic radius and darcy weisbach equation we develop a new semi empirical model to estimate the fluid flow through filled fractures using phenomenological coefficients of corresponding open fractures and porous media the proposed model satisfying dimensional consistency shows high fidelity in predicting water flow through filled fractures more importantly this model can be successfully reduced to the typical form of the forchheimer equation applied to open fractures and porous media the results and findings are expected to be useful in predicting and evaluating the fluid flow in complex geological setting keywords filled fracture confined porous medium non darcian flow semi empirical model data availability no data was used for the research described in the article 1 introduction compared with the tight and intact rock matrix the fractures or discontinuities widely existing in the rock mass provide main flow channels and potential failure planes the flow process in rock fractures plays a crucial role in numerous industrial and scientific applications such as oil or natural gas exploration christensen and tanino 2017 contaminant pollution control noiriel et al 2013 and geothermal energy extraction wang et al 2021 such flow is also relevant to the understanding and prediction of the landslide geological hazards induced by reservoir water fluctuations and rainfall li et al 2019 tang et al 2019 therefore the flow behavior through rock fractures has been considered as an important research subject by many scholars from different disciplines over the decades zimmerman and bodvarsson 1996 nowamooz et al 2009 javadi et al 2014 zou et al 2015 lee et al 2015 wang et al 2020 xing et al 2021 luo et al 2022 however most of these studies only focused on open fractures without any filling material by not doing so the more realistic flow behaviors in filled fractures remains poorly understood after long term water scouring chemical erosion and gravitational settlement natural rock fractures in many geological environments are often filled with sands sediment clay gouge or other materials song and yanful 2010 crawford et al 2008 khosravi et al 2016 wang et al 2016 liu et al 2017 sui et al 2022 many field geology surveys have found that filled fractures are widely present in mountain and subsurface rock masses scanlon et al 1997 elder 1997 wealthall et al 2001 kemp and pearce 2003 hough et al 2006 jiao et al 2014 tang et al 2015 chen et al 2021 hu et al 2021 these natural fillings usually have a large porosity and low frictional properties and thus tend to produce the weakest planes available for the initiation of sliding indraratna et al 2005 jiao et al 2014 tang et al 2015 wang et al 2016 in addition to natural fillings rock fractures are often artificially filled by grouting to improve the mechanical and hydraulic properties of rock masses in many infrastructure projects li et al 2016 zhou et al 2020 the permeability of these grout filled fractures is greatly associated with water leakage or water inrush disasters encountered in these practical rock engineering understanding the fluid flow in filled fractures is therefore essential for accurately evaluating the hydraulic properties of fractured rock aquifers and ensuring the safety and operational performance of rock engineering essentially a filled fracture can be regarded both as a fracture medium containing filling material and as a thin layer of a granular porous medium confined by two fracture walls qian et al 2011 such analogies throw up a series of open questions about the evaluation of the fluid flow in filled fractures compared with the fracture medium how do the filling materials contained affect the fluid flow therein similarly what roles do the confined walls play in the flow behaviors compared with ideal unrestricted porous media how should the influence of the filling material or the confined walls be evaluated quantitatively a large body of evidence has confirmed that the presence of filling material significantly alters the fluid flow in the fracture wealthall et al 2001 investigated the potential pathways for pollutant transport in permo triassic sandstone aquifers and found that filled fractures were less likely to act as preferential pathways than open fractures kemp and pearce 2003 believe that the permeability of the filling relative to the aquifer matrix is an important parameter for determining whether the fractures could form pathways or barriers to contaminant migration which could fundamentally change the conceptual model of flow in these aquifers lunati 2000 and lunati et al 2003 investigated the fluid flow and solute transport through individual fractures filled with glass beads and observed that the propagating front in filled fractures appeared much smoother than that in open fractures indicating that the presence of the filling materials resulted in a more uniform flow distribution within the fracture for a more intuitive understanding of the effect of filling material on fracture flow numerous laboratory studies have been carried out to investigate the permeability of filled fractures with different filling and stress conditions considered in recent years crawford et al 2008 wang et al 2016 liu et al 2017 2019 zhou et al 2020 sui et al 2022 it is concluded that the permeability of filled fractures is closely related to the particle size and porosity of the granular materials contained in general the larger the porosity or particle size of the filling material is the greater the permeability of the filled fractures will be similar conclusions were also drawn in studies on the effect of proppant on fracture permeability in the fields of oil and gas exploitation zheng et al 2017 bandara et al 2020 suri et al 2020 these above mentioned studies provide an important guidance for understanding the flow behaviors in filled fractures but still fall far short of solving the questions thrown to summarize current studies have the following two shortcomings due to the complexity of this issue firstly most of current studies was limited to speculating the effect of filling materials on fracture flow through changes in macroscopic permeability and the microscopic influencing mechanism behind it remains unclear in addition these studies most often assume that fluid flow in filled fractures obeys the linear darcy s law with the flow nonlinearity ignored arbitrarily even for the few works that consider the effect of fracture surfaces roughness obviously such an assumption does not hold true for realistic filled fractures on one hand there is a broad consensus that heterogeneous fracture geometries would result in non negligible flow nonlinearity in the fracture kohl et al 1997 zimmerman et al 2004 ranjith and darlington 2007 quinn et al 2011 lee et al 2014 zou et al 2017 cunningham et al 2020 xing et al 2021 luo et al 2022 on the other hand the non darcian i e nonlinear flow behavior in porous media has been widely observed with increasing pressure gradient or flux which is associated with the granulometric composition of the granular materials and its porosity zeng and grigg 2006 sidiropoulou et al 2007 eck et al 2012 li et al 2019 under the combined action of the fracture walls and filling materials would the filled fracture be more or less prone to non darcian flow which influencing factor is more dominant and under what conditions how can it be evaluated quantitatively all these are open questions aiming to shed insight on the aforementioned questions we conduct a series of pore scale simulations of fluid flow through open fractures porous media and corresponding filled fractures based on these numerical simulations the micro and macroscopic flow behaviors through filled fractures with different filling conditions and geometrical features are systematically compared and the influence mechanisms of filling materials on fracture flow is analyzed and discussed furthermore we quantitatively evaluate the effect of confined walls on the hydraulic properties of porous media and propose a semi empirical model to characterize the non darcian flow behaviors in filled fractures the results and methods in this study are expected to provide new insights and ideas for assessing the fluid flow in complex geological environments 2 methodology 2 1 physical model setup limited by the challenging computational capacity this study focuses on the case of fluid flow in two dimensional 2d fracture models with 40 mm in length and 1 mm in average aperture which would serve as an exploratory step for a deep understanding of the flow behaviors in filled fractures the fracture model considered is generalized to a rough walled fracture filled with a porous medium specifically we adopt a total of five 2d fractures with varying degree of heterogeneity each of which includes different filling combinations of eight porosities from 0 2 to 0 9 and five particle sizes from 0 08 mm to 0 12 mm table 1 to this end we start with a three dimensional 3d artificial fracture with rough walls and variable apertures fig 1 a obtained by splitting an intact cubic granite sample via brazilian splitting technique and then reconstructing it according to pre marked reference positions a 3d morphology scanner system is utilized to measure the surfaces topography and aperture distributions of the fracture more details regarding the brazilian splitting technique the 3d morphology scanner system and the measuring steps can be found in tan et al 2020 the fracture plane i e the x y plane has a dimension around 200 mm 100 mm and the topographical data of each surface are obtained with an interval of 0 1 mm in both and y directions with a maximum resolution of 10 µm the scanned data is further processed to reconstruct the fracture morphology from which four longitudinal cross sections labeled from s1 to s4 are extracted and served as the parent for generating 2d fractures with different geometries fig 1b since the fluid flow in rock fractures is associated with many geometric factors including the surface roughness and aperture distribution zou et al 2017 cunningham et al 2020 xing et al 2021 it is difficult to delineate the fracture heterogeneity by a specific geometric parameter given this the main criterion for determining the desired fractures in this study is the difference in permeability of individual fractures instead of a particular fracture geometry parameter apparently under the same mean aperture the smaller the permeability of the fracture is the stronger heterogeneity the fracture will have zimmerman and bodvarsson 1996 tan et al 2020 this ensures that the different fracture geometries adopted do have different degrees of influence on the fluid flow to accomplish this we first take a series of 2d fractures with a length of 40 mm according to the surface roughness then adjust the average aperture of all these fractures taken to 1 mm by vertically shifting the upper fracture surfaces subsequently we conduct a series of numerical flow experiments through these extracted 2d fractures the numerical simulation method used here will be illustrated in the following section by comparing the permeability and the flow process in these fractures five fractures labeled as fractures 1 2 3 4 and 5 respectively are finally taken fig 1b and table 1 which serve as the geometric input for generating the fracture model with a porous medium filling the detailed geometric and flow characteristics of these five representative fractures taken are presented in table 1 meanwhile the numerical results for these five fractures correspond to the unfilled cases in this study and will serve as a benchmark to evaluate the effect of filling on the micro and macroscopic flow behaviors in fractures in this study the porous medium filling the rough walled fractures is considered to be homogeneous and isotropic and for simplicity is generalized as a hexagonal array of impermeable circles packed at an equal interval δd fig 1c in this case different combinations of porosity and particle sizes of porous media can be implemented by setting the diameter of these circles and the interval between them the same generalization method for porous media is also widely adopted in many numerical and theoretical studies on the fluid flow in porous media reynolds et al 2000 hill and koch 2002 kim and kang 2020 given that the fluid in porous media can only flow through the pore channels formed by the particle interstices therefore the porous media model for fluid flow simulation can be implemented by subtracting these impermeable particles from the overall domain via boolean operations for the 2d filled fracture model considered in this study this overall domain is the closed domain formed by the upper and lower fracture walls note that to ensure the accuracy of the filling porosity assigned those solid particles across the fracture walls will be sheared off retaining only the portion inside the fracture fig 1c for each filled fracture model described above we construct its corresponding ideal unrestricted porous media model to elucidate the effects of the confined walls the construction method is similar to filled fracture model except that the upper and lower walls used here are smooth flat plates apparently the larger the width of the model is the weaker the confining effect of the wall on the fluid between them is and the closer the model will be to true porous media as for the length of the model the hydraulic properties of porous media should be independent of its length if the size effect is neglected finally based on a prior sensitivity analysis of the model size the square porous media model with a length and width of 5 mm is chosen for flow simulations in this study to achieve a balance between sufficient characterization performance and computational cost fig 1d 2 2 direct numerical simulation for water flow the motion of an incompressible newtonian viscous fluid at steady state is governed by the navier stokes equations nse supplemented by the continuity equation which represent momentum and mass conservations and can be written as 1 p μ 2 u ρ u u 2 u 0 where u is velocity vector ρ is fluid density p is pressure and μ is dynamic viscosity coefficient note that here we ignore the gravity term considering that the contribution of gravitation forces to water pressure is negligible for water flow through small aperture fractures in the near horizontal direction in this study we consider the fluid flow through filled fracture and porous media models from left to right fig 1 for each simulation we assign a constant flow rate at the inlet of the model such the inflow condition allows the fluid to enter the domain freely thus reducing the boundary effect and improving the convergence rate zou et al 2017 the outlet boundary of flow is set as a constant zero pressure p 0 in addition the fracture walls and the outer edges of impermeable circles constituting the porous media are assumed as no slip boundaries to investigate the flow regimes evolution in filled fractures and porous media a series of inflow conditions with different reynolds numbers re across two orders of magnitude are applied for each physical model re 1 10 20 40 60 80 100 here a commonly used definition of re in rock mechanics and geophysics communities is adopted to ensure consistent boundary conditions for fracture and porous media models given as 3 re ρ u e 0 μ where u q w is the specific flux volumetric flux per area where q is the volumetric flow rate per unit width w is the cross sectional width where flow passes through for fluid flow in 2d fractures u q e 0 where e 0 is the mean mechanical aperture standard water properties with ρ 1000 kg m3 and μ 0 001 pa s are adopted for simplicity the commercial finite element software package comsol multiphysics is employed to conduct the numerical flow experiments by solving the governing equations with the boundary conditions set above in the simulation a small relative tolerance 0 001 of mean velocity difference at adjacent iteration steps is chosen for stopping the simulation and evaluating the results to overcome the solver convergence issues widely encountered in solving nse including the inertial term we implement a scheme of progressively and incrementally increasing the inlet flow rate to reach specified flow conditions where a preceding solution with the last prescribed low flow rate is set to be the initial guess for the computational case with next prescribed flow rate for numerical simulations the 2d flow domain is discretized into around 15 million lagrange triangular elements in general the smaller the porosity is the narrower the flow path is accordingly the finer the mesh required will be therefore relatively coarser meshes 10 6 mm 10 2 mm are used for the models with large porosity ϕ 0 4 while much finer meshes 10 7 mm 10 3 mm are adopted for the models with small porosity ϕ 0 4 in this study for each simulation the final number of elements is determined through a prior sensitivity analysis of mesh size to ensure mesh independency of the results the flow simulations are run on a high performance workstation with 128 gb memory with up to 70 gb of memory being used during each run 3 results 3 1 microscale flow process in filled fractures since fracture filling particles inevitably changes the flow paths and the effective advective space within the fracture the microscopic or local flow behaviors in filled fractures are predictably different from those in open ones without loss of generality the numerical results for open fracture fracture 1 and corresponding filled fracture with a filling porosity ϕ 0 5 and a particle size d 0 1 mm are exemplified to dictate this difference fig 2 fig 2a and c shows the velocity fields and the streamline distributions in these two fracture models at re 100 in which the view of the entire fractures represents the norm of the combined velocity field while the accompanying magnified section shows the streamline distributions and the x component velocity fields of a representative segment defined by the interval of x 34 mm 36 mm theoretically the flow velocity of the section with a smaller aperture in 2d fractures is higher than that of the section with a larger aperture to maintain the conservation of mass dou et al 2019 tan et al 2021 however we see that low velocity zones or eddies also form and develop at the abruptly changing large aperture segments which leads to the formation of main flow channel with a relatively high flow velocity in these sections the low velocity zone described in this paper refers to the region where the flow velocity is less than one order of magnitude of the maximum flow velocity in the flow domain blue parts in figs 2 and 3 the eddies could be regarded as a special case of low velocity zone note that as a result of the no slip boundary conditions at the fracture walls there are low velocity zones near the fracture walls and high velocity zones usually near the fracture center plane in each cross section within the open fracture but the low velocity zones or eddies caused by the fracture geometry have larger spans making the channeling flow phenomenon more prominent in contrast the flow velocity distribution in the filled fracture is quite homogeneous although the overall flow velocities at segments with different apertures also differ under the requirement of mass conservation the transition of flow velocities at different regions within the filled fracture is smooth and almost no visible mainstream channels with a relatively high flow velocity are present in addition the average value and range of flow velocity in the filled fractures are significantly larger than that in the corresponding open ones this is because the filling particles squeeze the original fracture space making it required to maintain the same flow rate at a higher rate for filled fracture compared to the corresponding open fracture from the local flow behaviors shown in the magnified section of fig 2a and c one can see that a clear eddy is generated near the lower wall surface of the open fracture and accordingly the negative x component velocity also marks the presence of the eddy flow or backflow regions in contrast the presence of filling appears to weaken the dominant role of fracture walls on fluid flow processes we see that the streamlines in the corresponding filled fractures are uniformly distributed in the interstices of the filling particles which prevents the generation of large span eddies and is responsible for the more uniform flow velocity fields in this case local eddies and backflows can only develop on the backside of the particles due to boundary layer separation which corresponds to the negative x component velocity shown in fig 2c and is an important cause of flow nonlinearity in filled fractures and porous media hill and koch 2002 sidiropoulou et al 2007 in addition we see that the flow velocity in pore conduits parallel to the fracture walls is significantly greater than that in the conduit toward the other directions indicating that the effect of the fracture walls on fluid flow in filled fractures is not negligible on the contrary the fracture walls still dominate the overall flow velocity magnitude and flow direction in filled fractures to further compare the local flow behaviors within filled and open fractures the x component velocity profiles at a representative cross section x 35 mm labeled with a a in fig 2a and c with different re numbers is presented in fig 2b and d we see that the cross sectional flow velocity distribution within the open fracture is significantly different from that of the corresponding filled one for the open fracture the flow velocity magnitude varies continuously along the cross sectional line with zero velocity being at the upper and lower ends as a result of the no slip boundary conditions with the increasing re the maximum value of flow velocity in the fracture increases and the flow velocity near the bottom surface of the fracture appears negative which responds to the generation of eddy and backflow observed in fig 2a in addition the velocity profiles located in both the positive and negative flow regions where the x component flow velocity is positive and negative respectively obey the parabolic function in shape in contrast the velocity profiles along the cross section within the filled fracture is separated into what appears to be several independent parts indicating that the flow process in a filled fracture can be considered as a combination of fluid flow in several conduits this is consistent with what blick 1966 generalized for the flow process within porous media we see that the velocity profiles in each conduit also obey the parabolic function in shape the ratio of the standard deviation σu of the mean flow velocity among these conduits to the mean flow velocity ux of the entire cross section is used to quantitatively evaluate the heterogeneity of the velocity fields within the fracture we calculate the ratios σu ux for the filled fracture and open fracture to be 0 135 and 0 556 respectively indicating that the velocity profile along the cross section in the filled fracture is more uniform than that in the corresponding open one above comparison fully illustrates how the local flow behavior within open fractures differs from that of the corresponding filled ones it is concluded that the porous medium filling and the fracture walls together influence the fluid flow in filled fractures as a result the fluid flow in a filled fracture resembles that in a porous medium but the freedom of flow is bounded by two fracture walls qian et al 2011 to further evaluate the effects of filling conditions on the flow behaviors within the fracture we compare the normalized x component velocity fields of the fluid flowing through the hexagonal array of impermeable circles with different particle size and porosity at re 100 fig 3 which is the basic building unit of the porous medium considered in this study note that the color contour map here only covers the regions with positive flow velocity while the negative velocity zones are represented by blank areas theoretically when the fluid bypasses the solid particle low flow velocity or even eddies regions would form on the backwater side of the particle as a result of the shear stress action on the fluid we see that for the case of small porosity the low velocity region exists only in a small extent near the particle walls indicating that the closely packed particles limit the generation of large span eddies and making the flow process more uniform in the fracture with the increase of porosity the range of low velocity zone on the backwater side of particles increases significantly which would enhance the heterogeneity of velocity field in the fracture and thus induce the non darcian effect when the porosity is large enough the fluid boundary layer may even separate from the particle surface to the point of visible local eddies blank areas on the backwater side of the particle in fig 3 which as mentioned before is responsible for flow nonlinearity within porous media in addition the increase in particle size is accompanied by an increase in the water facing area resulting in an increase in the extent of low velocity and eddy zone on the backwater side of the particle however compared with the filling porosity the flow within the filled fracture is less sensitive to the change of the filling particle size especially when the porosity is small in summary the filling medium greatly affect the flow characteristics of the fracture via two competing mechanisms on one hand the filling medium cuts the flow channel into several pore channels limiting the generation of large span eddies and making the flow process more uniform in the fracture on the other hand the fluid in filled fractures has to flow around these impermeable particles thus promoting the generation of local eddies and enhancing the flow complexity when the filling porosity is small this effect of homogenizing the fluid flow dominates and with the increase in porosity and particle size the effect of complicating the flow process gradually becomes significant 3 2 macroscale flow behavior of filled fractures the microscale flow process manifests through impacting the macroscopic flow behaviors of the fracture over the past decades numerous empirical and theoretical equations have been proposed to characterize the macroscopic non darcian flow behaviors in porous and fractured media among which the forchheimer equation is most widely used one due to its simple form and well defined physical significance zimmerman et al 2004 sidiropoulou et al 2007 zhou et al 2019 it reads as 4 p μ k v u ρ k i u 2 where k v and k i are the intrinsic permeability and inertial permeability respectively depending only on the geometries of the media the forchheimer equation characterizes the energy losses in fluid flow process due to viscous and inertial effects respectively when the inertial effects are negligible compared with the viscous effect the forchheimer equation reduces to darcy s law that is p μ k v u without loss of generality the relation between the pressure gradient and specific flux for water flow through a representative fracture fracture 1 with different filling conditions are presented in fig 4 where the dashed line represents the predicted curve using linear darcy s law and the solid line is the best fitting curves using the forchheimer equation eq 4 as expected the filling conditions largely determine the macroscopic flow behaviors of the fracture with the increase of the filling porosity and particle size the pressure gradient required to maintain the same flux decreases sharply indicating a dramatic increase in the fracture permeability this can essentially be attributed to the decreased fluid solid interfacial area within the fracture which significantly increases the effective permeability we see that the permeability of fractures with different filling porosity can vary by orders of magnitude in addition the linear darcy s law can better characterize the relationship between the pressure gradient and specific flux for fractures with smaller filling porosity but for the case with larger filling porosity the curve gradually deviates from the linear pattern with the increasing flow rate this is because that the porous medium filling with larger porosity contributes to the generation of low velocity region and eddies induced by boundary layer separation as the fluid bypasses the solid particles thus enhancing the flow nonlinearity fig 3 in any case the forchheimer equation can characterize the macroscopic flow behaviors well for all filling scenarios the effective permeability k e calculated from the darcy s law μu p is a key hydraulic property of rock fractures for macroscopically characterizing the nonlinear flow behavior and the evolution in flow resistance within the fracture combining with forchheimer equation eq 5 it is clear that when the viscous force dominates the flow process within the fracture the value of k e would remain constant and the flow in the fracture is in a linear regime with the increasing inertial force a decreasing pattern of k e would be observed and the flow enters a nonlinear stage to facilitate comparison of the relative variation in k e of different filled fractures k e for each filling scenario is normalized by the intrinsic permeability k v with the low re case re 1 is adopted here when inertial effects are trivial the normalized permeability k e k v of a representative fracture fracture 1 with different filling conditions is plotted against re in fig 5 for a general evaluation the normalized permeability k e k v for all cases monotonically decrease with re but the decreasing magnitude is closely associated with the filling conditions when the filling porosity is small enough ϕ 0 4 in our study the normalized permeability almost remains a constant of 1 with only a small decrease at very large re indicating that the viscous force dominates the flow process and the flow in the filled fracture follows the linear darcy s law fig 4 as the filling porosity increases from 0 2 to 0 9 the decrease in k e k v becomes increasingly notable specifically the value of k e k v at re 100 decreases from 0 99 to 0 72 this indicates that inertial forces become increasingly non negligible compared to the viscous forces and the flow nonlinearity enhances gradually in addition to filling porosity filling particle size also affects the relation between k e k v and re we see that the larger the particle size is the more significant the decrease in k e k v with re will be the value of k e k v decreases from 0 95 to 0 90 as the particle size increases from 0 08 mm to 0 12 mm at re 100 this indicates that the increase in particle size also somewhat enhances the flow nonlinearity which is consistent with the results revealed by the microscopic flow behavior in this study fig 3 recalling the forchheimer equation eq 5 the inertial effect is the essential cause of flow nonlinearity given this the ratio α of nonlinear pressure drop the second term of eq 5 ρu 2 k i to total pressure loss μu k v ρu 2 k i during fluid flow is usually introduced to evaluate the degree of flow nonlinearity zeng and grigg 2006 with reference to previous studies the ratio α 10 is adopted in this study to delineate the critical point between the linear and nonlinear flow combining with eq 3 and using the relation α 10 the critical reynolds number re c can be formulated as 5 re c e 0 k i 9 k v as one can see re c depends only on the intrinsic permeability and inertial permeability of the media and quantifies the onset of non darcian flow fig 6 shows the variation of re c of filled fractures with different filling porosity and particle size we see that with the increasing porosity and particle size re c of filled fractures gradually decreases via a power law which support the above argument that the fluid flow in filled fractures with greater filling porosity and particle size is more prone to transition into the non darcian flow regime interestingly when the filling porosity is large enough re c of filled fractures could even be smaller than that of corresponding open ones indicating that the ability of the filling medium to complicate the fluid flow is stronger than that to homogenize the fluid flow in this case in addition re c of different filled fractures with the same filling conditions is distinct as a result of the fracture geometry but the difference among them decreases with the increasing filling porosity and particle size in particular the increase in porosity and particle size reduces the maximum difference in re c among different filled fractures by 191 and 25 respectively this indicates that the flow nonlinearity is caused by both the fracture geometry and the filling contained with the increasing filling porosity and particle size the flow nonlinearity caused by the filling gradually increases and accordingly the contribution of the fracture geometry to the flow nonlinearity gradually decreases 4 discussions 4 1 quantitative evaluation of the effects of confined walls the results above shows that the fluid flow within filled fractures is greatly governed by the porous medium filling the fractures resulting in a significant difference from the fluid flow within the open fracture meanwhile compared with porous media the fluid flow within filled fractures is confined by two fracture walls resulting in different flow behaviors to quantitatively evaluate the effects of confined walls on the fluid flow in filled fractures the relative error characterizing the difference in hydraulic properties between filled fractures and the corresponding porous media is defined as 6 e h h f h p h p where h p and h f represent the hydraulic parameters characterizing the hydraulic properties of filled fractures and corresponding porous media respectively for example the effects of confined walls on the intrinsic permeability can be quantified by e k v k v f k v p k v p where k v f and k v p represent the intrinsic permeability of filled fractures and corresponding porous media respectively a positive value of this relative error indicates that the presence of confined walls would increase the intrinsic permeability and vice versa as mentioned above the effects of confined walls are greatly associated with the geometric structure of the porous medium filling the fracture represented by the case with the filling particle size d 0 1 mm fig 7 shows the dependence of the relative error in intrinsic permeability k v and inertial permeability k i induced by confined walls with different heterogeneity on the filling porosity we see that the presence of confined walls would result in a decrease in both k v and k i compared with the porous media with the increasing porosity the relative errors in intrinsic permeability k v and inertial permeability k i show a decreasing and increasing trend respectively this indicates that the larger the filling porosity the greater the contribution of confined walls to intrinsic permeability and the smaller the contribution to inertial permeability in addition the effect of confined walls on fluid flow in filled fractures is associated with the fracture heterogeneity the stronger the heterogeneity of the fracture is the more significant this effect will be in particular the smaller the intrinsic and inertial permeability of the open fractures fabricated by these fracture walls see table 1 the more pronounced the reduction of the corresponding parameters of the porous media they cause to further quantitatively evaluate the effects of confined walls on flow nonlinearity within filled fractures we calculated the relative error in the critical reynolds number re c for different filled fractures with the particle size d 0 1 mm fig 8 in general for most filling cases the relative error values of re c are negative indicating that the existence of the confined walls would enhance the flow nonlinearity however with the increase of filling porosity the effects of confined walls on flow nonlinearity gradually weakens when the porosity is large enough the relative error value may change from negative to positive which means that the confined walls instead lead to an attenuation of the flow nonlinearity this is due to the fact that the loose porous structure significantly enhances the flow complexity in which case the confined walls instead restrict the flow expansion in the lateral direction thus weakening the heterogeneity of velocity field and the flow nonlinearity in the filled fracture in addition the effect of individual confined walls on flow nonlinearity varies due to different heterogeneity when the filling porosity is small ϕ 0 5 in our study the more heterogeneous the confined wall is i e corresponding open fractures have smaller intrinsic and inertial permeability the more pronounced the enhancement of the flow nonlinearity will be however as the filling porosity increases the cluster of e re c ϕ curves for different fracture walls show a converging trend to intersect each other suggesting that the change in flow nonlinearity induced by confined walls no longer corresponds to its heterogeneity if the filling porosity is sufficiently large this is due to the fact that as the filling porosity increases the flow nonlinearity is gradually dominated by the filling medium and the effects of the confined walls become increasingly less important the evaluation of effective permeability of geologic media is a key task associated with many practical applications and related work has been carried out intensively in geological porous and fractured media the above analysis results show that the existence of confined walls makes the hydraulic properties of filled fractures significantly distinct from those of the corresponding porous media predictably the confined walls would also play an important role in the permeability evaluation of filled fractures without loss of generality the numerical results for a representative filled fracture fracture 1 with the particle size d 0 1 mm are exemplified for comparison the possible relative error of the effective permeability ke induced by the confined walls is calculated and illustrated in fig 9 we see that the relative error value is always negative for all scenarios indicating that ignoring the fracture walls would largely overestimate the effective permeability of filled fractures the dependence of the relative error value on the re is associated with the change in the flow nonlinearity of the porous media with the increasing porosity the relationship between relative error value and re gradually changes from negative to positive correlation which corresponds to the transition from enhanced to reduced effect of the confined walls on flow nonlinearity in addition compared with re the relative error is more sensitive to the structural characteristics of the filling medium overall the larger the filling porosity the larger the magnitude of the relative error and accordingly the stronger the effect of the confined walls to reduce the effective permeability of the media the effective permeability can be reduced by up to 36 4 2 a nonlinear flow model for filled fractures the above analysis fully confirms the necessity of considering the role of both the filling medium and the confined walls when evaluating the flow behavior of filled fractures essentially the solid particles constituting the filling medium and the confined walls affect the flow process by forming the flow boundaries between the fluid and the solid these boundaries constrain the flow path and change the flow velocity distribution thus causing variations in the flow resistance and the macroscopic flow characteristics of the media to quantitatively evaluate the effect of these flow boundaries on the fluid flow the hydraulic radius r defined as the ratio of pores volume within the media to the fluid solid interfacial area is commonly incorporated into flow models for porous and fractured media costa 2006 for the 2d fracture model filled with circular particles considered in this study pores volume within the media is the product of total fracture volume and porosity 7 v p l e 0 ϕ where l and e 0 are the length and mean mechanical aperture of the fracture respectively accordingly the fluid solid interfacial area should be the sum of the surface area of filled circular particles and two fracture walls area 8 s n π d 2 l 4 l e 0 1 ϕ d 2 l where n is the number of filled particles note that here we ignore the contribution of the fracture walls undulation to the hydraulic radius which is integrated into the other coefficients in flow models shown blow combining eqs 7 and 8 the hydraulic radius r considered in this study can be expressed as 9 r v p s ϕ 4 1 ϕ d 2 e 0 where e0 is the mean mechanical aperture of the fracture when ϕ 1 eq 9 reduces to the expression for the hydraulic radius of the open fracture that is r e 0 2 by considering the porous material as an assembly of pore conduits the pressure loss during flow in filled fractures can be characterized by the darcy weisbach equation with r being the characteristic length 10 p f ρ v 2 r where v u ϕ is the characteristic flow velocity f is the friction factor and can be generalized as a function of characteristic reynolds number re for porous and fracture flow zhou et al 2016 ma et al 2022 11 f f re a re b where a and b are the coefficients depending on the geometrical properties of the media note that the here re characterizes the water flow in the actual pore conduits and is defined as re 2ρvr μ to enable its reduction to eq 3 at ϕ 1 the above treatment for fluid flow in porous materials is also widely adopted in the classical kozeny carman kc equation and in many subsequent modified models kozeny 1927 carman 1937 ergun 1952 costa 2006 combining eqs 10 and 11 we can arrive at a universal expression to describe the macroscopic flow behaviors of the open fractures porous media and filled fractures 12 p α μ r 2 ϕ u β ρ r ϕ 2 u 2 note that the dimensionless coefficients α and β here lump together the constant terms in the formula derivation and are only associated with the geometry of filled fractures we see that the formula form of the model is consistent with forchheimer equation eq 5 and therefore has the same physical significance when ϕ 1 substituting eq 9 into eq 12 yields the expression of pressure gradient for open fractures 13 p 4 α 1 e 0 2 μ u 2 β 1 e 0 ρ u 2 where α 1 and β 1 are the integrated coefficients characterizing the effects of fracture geometry on the inherent permeability and inertial permeability respectively combining eqs 4 and 13 α 1 e 0 2 2 k v and β 1 e 0 2 2 k i can be obtained similarly when e0 tends to infinity substituting eq 9 into eq 12 yields the expression of pressure gradient for porous media 14 p α 2 4 1 ϕ d 2 ϕ 3 μ u β 2 4 1 ϕ d ϕ 3 ρ u 2 where α 2 and β 2 are coefficients depending on the geometry of the porous media it is worth noting that the form of eq 14 is consistent with most flow models proposed to describe the flow behavior in porous media ergun 1952 kovács 1980 moutsopoulos et al 2009 li et al 2019 apparently to incorporate eq 12 in the prediction and evaluation of non darcy flow through actual filled fractures the determination of the phenomenological coefficients α and β in the equation becomes indispensable for filled fractures the coefficients α and β should be the result of the joint action of the fracture walls and the porous filling medium given that the above mentioned coefficients α 1 β 1 α 2 β 2 strongly depends on and encapsulates the intrinsic geometry properties of open fractures and porous media thus the coefficients α and β should be functions of α 1 and α 2 β 1 and β 2 respectively in view of this we obtain these coefficients α 1 β 1 α 2 and β 2 by performing a best fit regression of the forchheimer equation on the numerical results for the corresponding open fractures and porous media and demonstrate their relationships with α and β fig 10 note that fig 10 only shows the results for particle sizes of 0 08 mm 0 1 mm and 0 12 mm to establish the flow model while the rest of the simulation data will be used subsequently for model validation we see that α and β are well correlated with their corresponding coefficients for open fractures and porous media according to the trends of the data points in fig 10 the following functions are adopted to characterize the dependence of α on α 1 and α 2 and β on β 1 and β 2 15 α m 1 α 1 m 2 α 2 m 3 β n 1 β 1 n 2 β 2 n 3 where m 1 m 2 m 3 n 1 n 2 and n 3 are dimensionless regression coefficients a regression analysis is performed for all the data using the levenberg marquardt lm optimization algorithm which yields the best fitted values of the dimensionless coefficients in eq 15 m 1 0 89 m 2 0 21 m 3 0 99 n 1 1 36 n 2 0 12 and n 3 0 73 with high coefficients of determination r 2 of 0 93 and 0 97 respectively this indicates the proposed equations can be used to accurately estimate the variation in α and β we should note that the study of fluid flow in porous media and open fractures as opposed to filled fractures has been conducted extensively in the last several decades and numerous theoretical and empirical expressions have been developed for their phenomenological coefficients i e α 1 β 1 α 2 β 2 sidiropoulou et al 2007 zhou et al 2015 li et al 2019 rong et al 2020 tan et al 2020 this makes the predictive model viable and promising for predicting the water flow of filled fractures in a true field setting combining eqs 9 12 and 15 a new semi empirical model can be finally developed for predicting fluid flow through filled fractures based on phenomenological coefficients describing the flow properties of corresponding open fractures and porous media given as 16 p α 4 1 ϕ d 2 e 0 2 ϕ 3 μ u β 4 1 ϕ d 2 e 0 ϕ 3 ρ u 2 α m 1 α 1 m 2 α 2 m 3 α 1 ϕ 1 α 2 e 0 β n 1 β 1 n 2 β 2 n 3 β 1 ϕ 1 β 2 e 0 this semi empirical flow model adequately considers the influences of the filling medium and the fracture walls on fluid flow in filled fractures and has the advantage of dimensional consistency importantly it can be successfully reduced to the typical form of the forchheimer equation applied to open fractures and porous media when ϕ 1 and e 0 tends to infinity respectively to synthetically verify the performance of this semi empirical model the comparison between the calculated pressure gradient with eq 16 and numerical results for scenarios with particle sizes of 0 8 mm and 0 11 mm 560 data points in total which are not previously used for fitting are presented in fig 11 the solid line in the figure indicates that the theoretical value is equal to the measured results we see almost all data points are located near the solid line indicating the high fidelity of the proposed model in addition the average estimation error is introduced to further quantitatively evaluate the prediction accuracy of the flow model and defined as 17 e ave 1 n j 1 n p cal j p mea j p mea j 100 where p mea j is the measured pressure gradient p cal j is the calculated pressure gradient and j represents the j th data point and n is the total number of the data points n 560 in this study based on the numerical results an average estimation error of 4 6 is obtained this high accuracy proves the validity of the developed model again 4 3 implication and limitation as mentioned above the filled fracture consists of the confined walls and the filling medium contained therein by means of a comparison of the flow behaviors within the filled fracture and the corresponding open ones we illustrate how the filling medium affects the fluid flow therein similarly the effects of the confined walls on fluid flow are quantitatively evaluated by comparing the flow characteristics in filled fractures with those of porous media finally we develop a semi empirical model which can accurately predict non darcian flow behaviors through filled fractures based on phenomenological coefficients describing the flow properties of the corresponding open fractures and porous media considering that previous studies have yielded many fruitful equations for predicting the phenomenological coefficients of open fractures and porous media the semi empirical model proposed is a continuation of these studies and can be promisingly applied to practical problems associated with water flow through filled fractures to the best of our knowledge this study presents the first attempt to conduct such a detailed analysis and quantitative evaluation on the fluid flow in filled fractures one can see that the proposed model takes into account the effect of fracture aperture which means that the model holds promise for evaluating water flow in more generalized filled fractures or confined porous media such as pressurized aquifers faults and shear zones therefore our results and findings not only contribute to a proper understanding of flow behaviors through filled fractures but also provide theoretical guidance for predicting and evaluating the water flow in complex geological environments despite of its considerable contributions this study still has some limitations in terms of the computational model adopted in this study due to the difficulties in solving nse for modeling flow in complex fracture and pore structures with an extremely fine representation of geometries this study only focuses on 2d small scale models the fluid flow in realistic 3d filled fractures would be more complex than in 2d cases considering that the 2d simulations cannot capture the channeling flow and transverse flow in other horizontal directions therefore the proposed model in this study needs to be further calibrated and improved by considering the effect of dimensionality before being applied to more complex 3d situations in addition given the main focus of this study is the joint effect of fracture walls and filling conditions on the non darcian flow at steady state the particles that form the porous medium filling are assumed to be rigid and stationary such an assumption holds true when the fluid shear stress in the fracture is not sufficient to overcome the grain friction in fact the particles in fractures are not always stationary and can be transported in many cases hu et al 2021 the mutual feedback between non darcian flow and particle transport in filled fractures is still an outstanding research topic that remains to be further explored nevertheless these simplifications adopted in this study would not change the physical laws which govern the fluid flow in filled fractures as an exploratory work the findings of this study may provide significant foundation for investigating these complex flow and transport problems in the near future 5 conclusion in this study a series of high resolution numerical simulations of water flow through open fractures porous media and corresponding filled fractures are conducted mainly for evaluating the non darcian flow behaviors in rough walled fractures filled with a porous medium comparison of the flow behaviors within the filled fractures and the corresponding open ones shows that the filling medium greatly affect the flow characteristics in the fracture via two competing mechanisms on one hand the filling medium cuts the flow channel into several pore channels limiting the generation of large span eddies and making the flow process more uniform in the fracture on the other hand the fluid in filled fractures has to flow around these impermeable particles thus promoting the generation of local eddies and enhancing the flow complexity with the increasing filling porosity and particle size the effect of homogenizing the flow is weakened and the effect of complicating the flow process gradually becomes significant compared with porous media the fluid flow within the filled fracture is confined by fracture walls which could both enhance and attenuate flow nonlinearity therein depending on the fracture heterogeneity and the filling conditions neglecting the presence of fracture walls would largely overestimate the permeability of filled fractures by introducing the hydraulic radius and darcy weisbach equation a new semi empirical model for describing the fluid flow through filled fractures based on phenomenological coefficients describing the flow properties of corresponding open fractures and porous media is successfully established and verified this proposed semi empirical model bears a concise expression following dimensional consistency and can be successfully reduced to the typical form of the forchheimer equation applied to open fractures and porous media our methods and results are expected to be useful to geologists and hydrologists who are concerned with fluid flow in complex geological environments declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work was supported by the national natural science fund of china 42090054 41922055 51909247 41931295 and 42207179 the key research and development program of hubei province of china 2020bcb079 and fundamental research funds for the central universities china university of geosciences wuhan cuggc09 we thank the editors and two anonymous reviewers for their constructive comments which help us greatly improve the quality of the manuscript appendix a to ensure the rationality of the size selection for porous media model construction the sensitivity analyses of simulation results with respect to model size is performed at the maximum re value for this purpose two sets of porous media models are constructed for flow simulations one with 5 mm width and different lengths and the other with 5 mm length and different widths taking the porous media model with the particle size d 1 mm and porosity ϕ 0 5 as an example fig a1 shows the dependence of the normalized pressure gradient p p 0 on model length l and width w at re 100 where p 0 is pressure gradient for a sufficiently large model l 40 mm or w 10 mm in which the boundary effects can be neglected we find that the normalized pressure gradient converges to a constant 1 with only subtle fluctuation when the model length or width exceeds 5 mm indicating that a square model with a side length of 5 mm is adequate to characterize an ideal unrestricted porous medium 
2572,in recent years nonstationary flood frequency analysis nffa has become an active area of research it is crucial for water resources management and hydrologic engineering design to cope with the changing environment finding suitable and effective models could help perform better flood frequency analysis and make reliable estimates under the nonstationary environment this study assesses different modelling techniques for nonstationary flood frequency analysis including linear nonlinear parametric and nonparametric models using an extensive data set of 161 catchments across the uk it identifies that rejection rates are generally higher for precipitation informed nffa models than time varying nffa models for both time varying and precipitation informed nffa rejection rates for linear and cubic polynomial models are the highest the models with the fewest rejections are fractional polynomial models followed by cubic spline models because of the flexibility parsimony and user friendly features fractional polynomial models could be a potential alternative for modelling the nonstationary behaviour of flood series to investigate whether the seasonal flood variation and catchment characteristics influence the goodness of fit a quantified seasonality index was calculated to illustrate the degree of seasonal variation of flooding for each catchment it was found that the southeast of the uk has more significant seasonal flood variation than the northwest and most of the catchments with high seasonality indexes are close to the scotland and england border nevertheless the correlation analysis shows insufficient evidence to conclude that catchment characteristics and seasonal flood variation impact the goodness of fit of the nffa models keywords non stationarity flood frequency analysis nonparametric model regression seasonal flood variation data availability data will be made available on request 1 introduction flooding is one of the most common and destructive natural disasters because it affects more people than other environmental hazards and hinders sustainable development over recent decades changes in climate land use infrastructure and population growth have resulted in increased human vulnerability to floods and the proportion of the global population exposed to floods will increase further in the foreseeable future tellman et al 2021 najibi and devineni 2018 alfieri et al 2017 arnell and gosling 2016 winsemius et al 2016 jongman et al 2012 güneralp et al 2015 therefore a better understanding of flood risk variability can help reduce the physical and economic losses caused by floods flood frequency analysis ffa provides an estimate of the relationship between flood magnitude and the risk a cornerstone of flood risk management and water related infrastructure design salas et al 2018 conventional approaches to ffa are based on the assumption that hydrological time series are stationary and independent while exhibiting identical distributions over time the assumption of stationarity has long served as the basis for ffa and the design of hydraulic structures in different countries such as the united states iacwd 1982 usace 1993 the united kingdom institute of hydrology 1999 kjeldsen et al 2005 kjeldsen et al 2008 china mwr 2006 and australian pilgrim 1987 1998 however in reality the statistical characteristics of the hydrological process are influenced by multiple forms of non stationarities including natural non stationarity e g large scale climate variability and artificial non stationarities induced by anthropogenic activities such as climate change land use cover change e g prosdocimi et al 2015 e g blum et al 2020 river regulation e g lorenzo lacruz et al 2012 grill et al 2015 and thus the validity of the stationary assumption to ffa has been questioned and disputed over the last two decades e g khaliq et al 2006 milly et al 2008 2015 westra et al 2014 forzieri et al 2018 water related planning and design projects have always been dependent and always should depend on the analysis of past data to inform projections of future conditions through a stationary probability distribution however in a nonstationary environment conventional methods based on the stationary assumption may no longer provide reliable flood estimates for example an increasing trend in the mean of a flow series could result in underestimating flood quantiles and an increased risk of failure of hydraulic structures and flood prevention measures inversely a decreasing trend could overestimate the design quantiles and increase costs relating to the overdesign of infrastructures consequently the incorporation of non stationarity into ffa has been an active area of research in recent years and is considered crucial for flood risk management and hydrologic engineering design to cope with the changing environment e g villarini et al 2009a 2009b 2012 gilroy and mccuen 2012a gilroy and mccuen 2012b hall et al 2013 madsen et al 2014 bayazit 2015 serago and vogel 2018 salas et al 2018 faulkner et al 2020 for a general review of the literature on the nonstationary hydroclimatic extremes we recommend slater et al 2021 which provides a comprehensive review of the research progress of nonstationary weather and water extremes including methods for detection attribution prediction and projection despite the increasing attention given to nonstationary flood frequency analysis nffa there remains no consensus or generally agreed upon set of methods for performing nffa in fact there is not even a consensus on the actual need for nffa there is a lively debate in the research literature about whether a hydrological time series should be treated as nonstationary and whether stationary or nonstationary methods should be employed in practice e g serinaldi et al 2018 luke et al 2017 rehan and hall 2016 serinaldi and kilsby 2015 montanari and koutsoyiannis 2014 nevertheless it is recognised that the concept of non stationarity is valuable for engineering purposes villarini et al 2018 contend that the issue is not whether observations arise from a long term excursion from some underlying stationary process but rather whether the probability distribution of future floods will resemble the distribution that is obtained from fitting a probability distribution to observations over a historical record as such nonstationary methods have functional value when there are good reasons to suspect physically plausible drivers of change which in turn are somewhat predictable furthermore some government agencies are also making an effort to update their flood protection design guidelines to account for non stationarity e g hfawg 2017 madsen et al 2014 prosdocimi et al 2014 over the past two decades the increasing concern of non stationarity has led to numerous studies of ffa under nonstationary conditions one approach is to adjust a nonstationary river flow record to stationary conditions e g remove the trend from the data before the analysis an ffa can then be applied to the adjusted flow record to develop a stationary flood frequency model e g gilroy and mccuen 2012a gilroy and mccuen 2012b nevertheless this approach is more suitable for contexts where the increase in the rate and size of extreme events can be explained by a trend in the mean e g in sea level analysis a more convenient approach for nffa is to model the non stationarity in the probability distribution moments or parameters which assumes that the parameters of the distributions for frequency analysis can vary with time or with another covariate e g villarini et al 2012 prosdocimi et al 2014 in this approach the inference about the nature of the trend change is included in the model fitting rather than as a separate step increasingly distributional regression models are becoming popular and widely used for their flexibility in fitting nonstationary flood frequency distributions which allows the parameters of the probability distributions to vary as a function of time or other covariate explanatory variables e g rainfall or selected climate indices regression is a valuable and practical approach for characterising the nonstationary behaviour of floods and modelling trends serago and vogel 2018 and hecht and vogel 2020 outlined numerous advantages of using regression based models for nffa 1 regression is effective for communicating results as the goodness of fit of trend models can be expressed both quantitatively and qualitatively in a graphical image 2 unlike many nonparametric trend detection methods regression is a method for both trend detection and modelling 3 regression can provide decision relevant information including expressions of uncertainty i e confidence intervals and prediction intervals and enables hypothesis tests regarding the influence of covariates on changing floods e g helsel and hirsch 2002 4 in some cases changes in flood series may be abrupt due to human interventions in river basins such as reservoir construction e g lópez and francés 2013 to test hypothesised abrupt changes in flood series regression based models can include binary indicator variables bates et al 2012 5 multivariate regression can incorporate multiple covariates to model interacting impacts e g li et al 2018 condon et al 2015 prosdocimi et al 2014 6 regression also accommodates nonlinear relationships and smooth nonlinear functions as well as missing data slater and villarini 2017 and analytical corrections to the variance of regression coefficients inflated by short and long term persistence matalas and sankarasubramanian 2003 7 regression models can include estimates of the likelihood of type i and ii errors which can be important for quantifying the potential for under design and over design vogel et al 2013 those estimates can in turn be integrated into a risk based decision process rosner et al 2014 using regression models for nffa needs to meet two primary challenges selecting the covariates related to the response variable i e river flow and finding a suitable functional form to describe the relationship between the parameters and covariates this study focuses on the second question in general all regression based models in terms of fitting methods can be classified into two main categories parametric regression models and nonparametric regression models linear models generalised linear models and nonlinear models are examples of parametric regression models because the function that describes the relationship between the response variable and explanatory variables known as covariates or predictive factors in hydrologic problems is known parametric regression models are straightforward effective and the result can be easily interpreted but they are often not flexible enough to describe the data at hand with computer technology and statistical software progress nonparametric regression has received increased attention and recognition rigby et al 2013 fox and weisberg 2018 nonparametric regression differs from parametric regression the shape of the functional relationships between the response and the explanatory variables are not predetermined and can be adjusted to capture unusual or unexpected features of the data price 2018 much of the literature in the field of nffa has developed regression based models comprising distribution parameters that are linear functions of the covariate of interest e g faulkner et al 2020 serago and vogel 2018 villarini et al 2009a gilroy and mccuen 2012a gilroy and mccuen 2012b prosdocimi et al 2014 condon et al 2015 while linear models allow for the rapid interpretation of results and straightforward model fitting they may not always be suitable agilan and umamahesh 2017 reported that applying only the linear trend to model non stationarity may increase the bias of the nonstationary models in recent years nonparametric methods have received considerable attention in the field of nffa and a growing body of literature has implemented nonparametric models using splines to draw information on non stationarity from flood data series e g lópez and francés 2013 machado et al 2015 gu et al 2016 agilan and umamahesh 2017 nasri et al 2017 ray and goel 2019 qu et al 2020 chen et al 2021 nonparametric models where parameters are restricted to the covariate s smooth functions offer greater flexibility but reduced extrapolation capability to balance the complexity and accuracy it is worth assessing whether the nonparametric models are necessary and whether linear parametric models adequately capture the relationship between the flood series and covariates finding suitable and effective models could help practitioners hydrologists perform better flood frequency analysis and estimates within a nonstationary environment though this topic has been relatively under researched this study aims to examine and compare linear nonlinear parametric and nonparametric regression models for time varying and precipitation informed nffa using an extensive data set of 161 uk catchments and provide recommendations for the implementation of nffa in the present study the annual precipitation has been selected as the precipitation covariate since it constitutes a commonly used physically based covariate in nffa e g šraj et al 2016 yan et al 2017 in addition the influences of seasonal flood flow variability and catchment characteristics on the goodness of fit and their interaction are assessed 2 data and study area in this study we implemented two kinds of nffa for each selected catchment i a time varying model where the distribution parameters vary as a function of time and ii precipitation informed models where distribution parameters vary with annual precipitation the influence of seasonal flood flow variation and catchment characteristics on the goodness of fit of different models was also assessed therefore three dataset groups were needed for the analysis including annual and seasonal maximum flow series catchment average precipitation series and catchment descriptors 2 1 flow and precipitation data daily river flow series from 161 catchments across the uk including scotland england northern ireland and wales were used to extract the annual and seasonal maxima series the uk lies in the higher mid latitudes between 49 and 61 n and is well known for its unsettled weather due to its constant proximity to the path of the polar front jet stream there is a wide variety of climate and catchment types across the uk river flows can typically range through several orders of magnitude and low flows are generally very modest in most river basins relative to most parts of the world uk river flow patterns are less dominatingly affected by seasonal contrasts in precipitation or melt water contributions precipitation in the uk is generally evenly distributed throughout the year with a modest trend towards an autumn winter maximum particularly in western catchments the gauged daily flow data is provided by the national river flow archive nrfa 2021 the data has undergone a sequence of detailed quality control checks before being added to the national archive in addition the catchment averaged daily rainfall series were derived from ceh gear data tanguy et al 2016 a national gridded data set at 1 km resolution obtained by interpolating the observed values of a dense gauging network more information on the ceh gear rainfall dataset can be found in keller et al 2005 from the catchment daily rainfall dataset annual precipitation amounts were calculated to be used as a covariate for precipitation informed nonstationary models as a sufficient data record length is crucial for reliably estimating distribution parameters as time dependent the 161 selected catchments have at least 40 years of river flow and precipitation records from january 1923 to december 2017 the mean and median data lengths are 52 and 50 years respectively the catchment locations and available record lengths are indicated in fig 1 the apparent diversity of the selected catchments in terms of size and location allows for good spatial coverage of the whole country and can be considered representative of the range of catchment conditions encountered across the uk the catchment areas vary between 12 4 km2 and 7486 km2 to reduce the likelihood of any potentially large flood being missing from the analysed data sets all the catchments selected for the analysis have data completeness of record greater than 99 9 2 2 catchment descriptors a set of physical catchment descriptors including catchment size elevation geology and soil characteristics derived from the flood estimation handbook institute of hydrology 1999 were also supplied by the nrfa https nrfa ceh ac uk feh catchment descriptors six catchment descriptors used in the present study are listed in table 1 bfihost is a measure of catchment responsiveness derived using the 29 class hydrology of soil types host classification boorman et al 1995 bfihost indices vary between 0 and 1 with higher values indicating a more significant base flow contribution and therefore higher catchment storage or permeability sprhost is a measure of catchment responsiveness to rainfall in terms of the standard percentage of runoff this represents an average value for the percentage of rainfall that would be expected to exceed the infiltration capacity of underlying soils and geology leading to runoff dry soils tend to inhibit flood formation whilst in contrast saturated soil conditions precede and contribute to significant flood events propwet is a catchment wetness index that measures the proportion of time that catchment soils are defined as wet in this context when soil moisture deficits are less than 6 mm propwet values range from over 80 in the wettest catchments to less than 20 in the driest parts of the country any reservoirs or lakes within a catchment will tend to affect flood response but those directly linked to the stream network are most likely to produce an attenuation effect the farl index guides the degree of flood attenuation attributable to reservoirs and lakes in the catchment above a gauging station values close to unity indicate the absence of attenuation due to lakes and reservoirs whereas index values below 0 8 indicate a substantial influence on flood response these descriptors for each of the investigated catchments are provided in the supplementary material 3 methods 3 1 overview an overview of our analysis procedures is illustrated in a flow chart see fig 2 first the annual maximum flow data were extracted from the daily flow series as the response variable for modelling the annual precipitation amount was calculated from gridded catchment daily precipitation dataset as an external physical covariate for nffa models precipitation informed models second annual maximum flow data from 161 catchments were used to implement time varying nffa and precipitation informed nffa within the gamlss generalised additive models for location scale and shape framework using linear and nonlinear parametric and nonparametric models since the various commonly used distributions are not significantly different to this study we use the one with fewer parameters after testing a series of widely used two parameter distributions we chose the log normal distribution that works well with our data third a range of goodness of fit tests were applied to each nffa model to investigate which type of model best fitted the flow data in addition to the goodness of fit tests the influences of seasonal flow variation and catchment characteristics on the goodness of fit were investigated flow data series were extracted for each season to examine the seasonal variation of flood flow for each catchment winter december february spring march may summer june august and autumn september november 3 2 the gamlss framework in recent years nonparametric regression modelling using splines has become an attractive flexible and widely acceptable approach to nffa an important prerequisite for nonparametric spline modelling is the availability of user friendly well documented software packages the most widely used regression packages that can fit regression models using splines available in r software include generalised additive models gam generalized additive mixed models gamm vector generalized linear and additive models vglm vgam and generalised additive models for location scale and shape gamlss among them the gamlss package is currently the most popular and commonly used framework in nffa implementation as it provides a more flexible platform to model non stationarity than other additive models therefore the different nffa models in this study were developed based on the gamlss framework additionally we list more details about all these regression packages with spline techniques in the supplementary material to provide a guide for practitioners the gamlss approach was developed by rigby and stasinopoulos 2005 as a common coherent framework for parametric and nonparametric regression models although the gamlss framework is of general statistical use rather than being dedicated to hydrological problems it has been successfully used in the nonstationary frequency analysis of hydrologic series for many years a gamlss model assumes that independent observations y i for i 1 2 3 n have the probability density function f y i θ i of p parameters where θ i θ 1 i θ p i accounting for the location scale and shape of the random variable distribution the number of parameters p usually is less or equal to four since one two three and four parameter families guarantee sufficient flexibility for most applications in gamlss explanatory variables are introduced into the model through the predictors η k related to parameters by monotonic link functions g k including identity log inverse function and others let y t y 1 y 2 y n be the n length vector of the response variable also for k 1 2 p let g k be a known monotonic link function relating the distribution parameters to explanatory variables through 1 g k θ k η k x k β k j 1 j k z jk γ jk where θ k and η k are vectors of length n β k β 1 k β 2 k β j k k is a parameter vector of length j k x k is a known design matrix of order n j k z jk is a fixed known n q jk design matrix and γ jk is a q jk dimensional random variable eq 1 allows modelling of all the distribution parameters as linear parametric nonlinear parametric or nonparametric smooth functions of the explanatory variables as known as covariates or predictive factors in hydrologic problems 3 3 parametric and nonparametric terms five different model kinds for nffa developed based on the gamlss were assessed in this study the first is the nffa model where the distribution parameters vary linearly with the covariate x eq 2 the linear dependence within regressions is the most common and popular class of models they are simple but effective and were usually used as a benchmark 2 η k β 0 β 1 x where η is the predictor for the kth distribution parameter in this study k 1 2 since we use a two parameter log normal distribution the covariate x refers to the time in time varying nffa models and denotes the annual precipitation in precipitation informed nffa models secondly two nonlinear parametric terms were used the conventional cubic polynomials eq 3 and fractional polynomials eq 4 conventional polynomials are the simplest way of modelling nonlinear relationships in regression fractional polynomials royston and altman 1994 are an alternative to regular polynomials that provide more flexible parameterisation for continuous variables but it is relatively new in hydrologic statistics 3 η k β 0 β 1 x β 2 x 2 β 3 x 3 4 η k β 0 β 1 x p 1 β 2 x p 2 β 3 x p 3 where the power p 1 p 2 and p 3 are not necessarily positive integers they can take any value within the predetermined set 2 1 0 5 0 0 5 1 2 3 with x 0 denoting log x if two powers p j happen to be identical then the two terms β 1 j x pj and β 2 j x pj l o g x are fitted instead similarly if three powers are identical the terms fitted are β 1 j x pj and β 2 j x pj l o g x and β 3 j x pj log x 2 in addition we considered two nonparametric smoothing methods namely p splines and cubic splines p splines penalised b splines are a hybrid of regression splines and smoothing splines eilers and marx 1996 which are based on the cubic b spline basis and a large set of equidistant knots usually 10 40 cubic splines are a popular and flexible smoothing technique to describe complex nonlinear relationships which is created by using a piecewise cubic polynomial in an interval between two successive knots green and silverman 1993 to avoid overfitting with splines we use only a small number of effective degrees of freedom between 0 and 3 because the effective degrees of freedom in the splines are normally not greater than ln n when the effective degrees of freedom is zero i e the total degrees of freedom is two the fitted curve is a straight line for more details about these nonparametric smoothing techniques the reader is referred to the texts of wang 2011 and harrell 2015 3 4 testing the goodness of fit we used the normalised randomised quantile residuals to evaluate each nffa model s goodness of fit the main advantage of normalised quantile residuals is that whatever the distribution of the response variable the true residuals always have a standard normal distribution when the assumed model is correct there are several approaches to assessing the normalised quantile residuals in the statistical literature these methods can be categorised into three types graphical visual methods histograms boxplots q q plots and worm plots numerical methods skewness and kurtosis indices and formal normality tests shapiro wilk test kolmogorov smirnov test lilliefors test and anderson darling test graphical methods are the easiest way to check the goodness of fit of the fitted models and they were the most commonly used tools in evaluating regression based nonstationary hydrologic models in the literature e g villarini et al 2009a 2009b lópez and francés 2013 gu et al 2016 sun et al 2018 although the graphical methods can serve as a useful visual tool in checking normality for a sample of independent observations they are not sufficient to provide conclusive evidence that the normal assumption holds therefore a set of formal normality tests including the shapiro wilk sw test the anderson darling ad test and the lilliefors lf test were applied to evaluate the different types of nffa models in this study given an ordered random sample x 1 x 2 x n the sw test statistic shapiro and wilk 1965 is defined as 5 w i 1 n a i x i 2 i 1 n x i x 2 where x i is the i th order statistic x is the sample mean a i a 1 a n m t v 1 m t v 1 v 1 m 1 2 and m m 1 m n t are the expected values of the order statistics of independent and identically distributed random variables sampled from the standard normal distribution and v is the covariance matrix of those order statistics the ad statistic can be computed as arshad et al 2003 6 a 2 n 1 n 2 i 1 l o g f x i l o g 1 f x n 1 i where f x i is the cumulative distribution function of the specified distribution x i are the ordered data n is the sample size the lf statistic lilliefors 1967 is defined as 7 d max x f x s n x where s n x is the sample cumulative distribution function and f x is the cumulative normal distribution function with μ x the sample mean and s 2 the sample variance defined with denominator n 1 more information on the sw ad and lf tests can be found in razali and wah 2011 in this study the three goodness of fit tests were applied to each model at all the 161 catchments and the 5 significance level was chosen p value 0 05 for sw ad and lf tests 3 5 seasonality index and catchment characteristics the effects of seasonal flood variation and catchment characteristics on the goodness of fit were investigated using average p values from the sw ad and lf tests apart from the five different catchment descriptors discussed we calculated a quantified seasonality index to represent the degree of the seasonal variation of flooding for each catchment the seasonality index is quantified with the variance of the normalised seasonal peak flows calculated in eq 3 4 the normalised seasonal peak flood was calculated by dividing the seasonal maximum flow by each catchment s mean seasonal maximum flow 8 σ 2 i 1 i n x i μ 2 n 1 where σ 2 is the variance x i is the normalised seasonal peak flood μ is the mean and n is the number of seasons in this study n is 4 spring summer autumn and winter if a catchment shows significant seasonal flood variation the variance would be high while a small variance indicates less distinct seasonal variation in this catchment finally the quantified seasonality index for each catchment was used in a correlation analysis with the rejection rates and catchment descriptors because of the non normal distribution of some of the catchment descriptors correlations were estimated using the nonparametric spearman rank correlation and a 5 significance level was employed 4 results and discussion 4 1 goodness of fit the goodness of fit of the different model types for nonstationary flood frequency analysis was assessed and the results are presented in table 2 we also performed traditional stationary flood frequency analysis without covariates included for a better comparison table 2 shows the percentage of occurrences for which the model is rejected at the 5 significance level p value 0 05 by the series of tests sw ad and lf if any of these tests rejected a model then the model was treated as being rejected the rejection rates were summarised by stratifying the p values from the tests on values below and above 0 05 as expected the rejection rate for stationary models is the highest the stationary flood frequency analysis approach where no covariates are included in the model and the distribution parameters are constant with time is invalid in 29 8 of the catchments for both time varying and precipitation informed nffa the models rejected the fewest times are the fractional polynomial models with rejection rates of 13 and 14 3 followed by the cubic spline models with rejection rates of 15 5 and 18 in contrast the nonstationary models with a linear or cubic polynomial dependence have higher rejection rates for time varying nffa the linear model has the same rejection rate as the cubic polynomial model at 24 2 of cases 39 catchments more than 70 of rejected cases are overlapped 29 catchments for precipitation informed nffa the linear and the cubic polynomial models are rejected for 28 and 24 8 of the cases respectively cubic splines are one of the most popular smoothing techniques to model complex nonlinear relationships and have been frequently used in nonstationary frequency analysis of hydrologic series in recent years e g villarini and serinaldi 2012 machado et al 2015 ray and goel 2019 chen et al 2021 cubic splines offer greater flexibility and better performance than linear models but are unable to express the spline function as a simple mathematical formula so the interpretation ability is reduced the fractional polynomial models provide an alternative approach for modelling nonlinear relationships to splines and conventional polynomials and perform well with the lowest rejection rates in this assessment the fractional polynomial regression model is an emerging tool in applied research such as medical statistics and clinical research e g binder et al 2013 regier and parker 2015 although it is more flexible and robust than conventional polynomials it has received little attention in nffa modelling it is rarely used in the hydrology field compared to nonparametric smoothing splines and conventional polynomials we found fractional polynomials have attractive features for nffa modelling first low order fractional polynomials are more flexible than low order conventional polynomials since they can offer a wide variety of curve shapes in our test the cubic polynomial model shows high rejection rates and is incapable of providing a good fit this is perhaps because the cubic polynomial model is always symmetric about its local extreme values and requires an additional parameter for each fluctuation in the pattern of change second the parsimony of fractional polynomials can have advantages in applied analysis similar to the general regression case requiring fewer fixed effects can lead to parameter estimates that are more precise and predict more accurate values belsley et al 2004 parsimony can also increase efficiency in the form of statistical power furthermore fractional polynomials are easier to implement than splines and it is a parametric method that can be more easily interpreted than splines for the practical aspect the final purpose of nonstationary flood frequency analysis is to estimate design flood values for the design construction and management of water related infrastructure in the changing environment in this respect a parametric regression model that can be expressed as a mathematical formula would be more user friendly than nonparametric splines to practitioners overall the rejection rates are higher for precipitation informed nffa models than time varying models this is somewhat unexpected as several existing studies indicate that using physically based covariates especially rainfall related covariates for nffa can produce better model performance than time varying models e g faulkner et al 2020 yan et al 2017 we found that many of those studies only use the akaike information criterion aic akaike 1974 to select their models and identify the most significant covariates by comparing their corresponding aic values e g zhang et al 2015 gu et al 2016 sun et al 2018 however in practice the aic leads to overfitting in model selection stasinopoulos et al 2017 vrieze 2012 hurvich and tsai 1989 it is more likely that an overfitted model based on a single aic would be selected when using a nonparametric smoothing method that has already increased the complexity of the model thus to avoid overfitting and balance the accuracy and complexity solely depending on the aic for model selection or identifying the best covariate is not recommended to illustrate our argument one of the study catchments south tyne at haydon bridge station 23004 is selected as an example this station has a 58 year available flow record and its flow data shows a decreasing trend based on the mann kendall test nrfa 2021 compared with the aic values for each model at station 23 004 see table 3 the linear precipitation informed model has the lowest aic value followed by the p spline precipitation informed model also for each type of model the aic values for precipitation informed models are always lower than time varying models in this catchment so if only depending upon the aic for model selection precipitation would be selected as the suitable covariate however in our goodness of fit tests all these precipitation informed models were rejected at the 5 significance level the p value of the tests for each model at station 23 004 is shown in table 4 to display the goodness of fit visually worm plots of the residuals of these models are illustrated in fig 3 as can be seen from plots a to e the standard residuals of the five time varying models are seen to be within the 95 confidence boundary limit which indicates these models are adequate representations of the data while in plots f to j the fitted curves look like a u shape and the level of the worm plots is below the horizontal line at the origin indicating positive skewness in the residuals and the residual mean is too high thus for this case the precipitation informed nonstationary models are inadequate still it is reasonable to believe that using physically based covariates as the explanatory variables in nffa models has potential advantages such as explaining the drivers of the variation in flood frequency whereas when selecting suitable covariates for an nffa model we recommend using a stricter or more robust criterion instead of the classical aic such as the corrected akaike information criterion aicc hurvich and tsai 1989 or in combination with the bayesian information criterion bic also known as schwarz bayesian criterion sbc since the use of bic sbc would generally result in a model more parsimonious than one selected by using the aic it is worth noting that solely using the bic sbc could lead to under fitting furthermore model selection with respect to aic or bic does not provide information about the goodness of fit of the whole model additional inspections for assessing the normality and independence of the residuals of the models are also indispensable which could indicate whether the model can describe the systematic information while the remaining information is random noise finally one needs to be careful when selecting nffa models as the choice of physically based covariates might strongly influence the goodness of fit of the model this study has adopted annual precipitation as one modelling covariate since it constitutes a commonly used explanatory variable in nffa modelling selecting a shorter temporal resolution such as monthly or weekly precipitation might result in different results and provide a different picture of the goodness of fit assessment 4 2 effect of seasonality and catchment characteristics on goodness of fit catchments in the uk have an evident seasonal variation of river flow featuring the wet winter and dry summer seasons chen et al 2019 which provides an important motivation for looking at seasonal flood variation for each catchment and investigating whether a correlation between seasonality index and the goodness of fit exists the quantified seasonality index represents the degree of seasonal variation of flooding for each catchment fig 4 according to the frequency histogram most of the catchments have a seasonality index score between 0 2 and 0 6 only 7 catchments have an index lower than 0 2 which implies the seasonal flood flow variation in these 7 catchments is less distinct as can be seen on the map fig 4 one of them is located in the west of northern ireland another in cumbria northwest england and the remaining 5 catchments are all in southern england in contrast a number of catchments 23 catchments show significant seasonal flood variability with high index scores greater than 0 6 most of them are found in england especially in the south of england only two catchments are close to the southeast boundary of scotland and are close to each other these catchments have a more distinct seasonal variation of flood flow the wet season may be wetter and the dry season may be drier in these catchments during a water year changes in the magnitude and frequency of extreme events are significant symptoms of non stationarity hence the variation of the seasonality index with time could be an excellent way to detect whether a change in the magnitude of extreme weather in a catchment exists we aim to investigate this more analytically in a future study in this study we adopt the average value of the annual seasonality index series to represent the degree of seasonal flood flow variability in each catchment broadly according to the map in fig 4 the southeast of the uk has more significant seasonal flood variation than the northwest many of the catchments with high seasonality index are near the scotland and england border a higher prevalence of groundwater contributions to river flow in permeable catchments in the southeast uk may be important fig 5 shows a visualised correlation matrix for quantified seasonality indexes and the five catchment descriptors with the correlation coefficients and their significance levels according to fig 5 there is sufficient evidence to conclude that the seasonality index negatively correlates with propwet catchment soil wetness index and altbar mean catchment altitude indicating that the catchments with wet soils are more likely to have low seasonality index scores as are catchments in high altitude areas in the uk as many upland areas in the uk have peatlands and considerable capacity to store rainfall this is to be expected the correlation between seasonality index scores and catchment descriptors is primarily negative but not necessarily significant for sprhost and area although their p values are smaller than 0 05 in addition the propwet is strongly positively correlated with altbar and sprhost standard percentage runoff this may indicate that the catchments in high altitude areas are generally wetter than those in low altitude regions and confirms that wet catchments with saturated soils result in a high percentage of runoff while dry soils tend to inhibit flood formation accordingly altbar and sprhost are also positively correlated to each other moreover bfihost base flow index has a significant negative correlation with sprhost this is because a more significant base flow contribution indicates higher catchment permeability or storage and therefore leads to less runoff correlations between the average p value from the goodness of fit tests and different catchment descriptors and the seasonality index for each model are shown in table 5 catchment area and altitude show a weak positive correlation with the goodness of fit of time varying models as many rejected cases have a small catchment area of fewer than 100 km2 however the majority of the correlations are relatively weak and not significant at the 5 level particularly for the precipitation informed models overall there is little evidence to conclude that the degree of seasonal flood variation and catchment characteristics influence the goodness of fit of the nffa models 5 conclusions in the present study different regression modelling techniques were systematically studied for nonstationary flood frequency analysis including linear nonlinear parametric and nonparametric models using an extensive data set of 161 catchments across the whole of the uk the study aimed to investigate both time varying and precipitation informed nffa models for those tests it was identified that the traditional stationary model and linear nonstationary model rejection rates were higher the stationary model was found to be invalid in 30 of the catchments whilst linear time varying and linear precipitation informed models were rejected for 24 and 28 of the cases respectively for both time varying and precipitation informed nffa the model with the lowest rejection rate is the fractional polynomial model followed by the cubic spline models hence the fractional polynomial models could be a potential alternative method for nffa as they also offer straightforward functional forms that can be parametrised by physical or climatological parameters it is certainly not suggested that every flood series should be modelled with fractional polynomials in place of linear or other nonparametric splines examining a single statistical model in isolation might not be a good practice and any chosen model should be compared with alternative models for scrutiny however the fractional polynomials identified in this study can potentially offer practitioners an additional valuable tool at their disposal when modelling the nonstationary behaviour of flood series in contrast to the suggestions from a significant body of literature rejection rates were higher for precipitation informed models than time varying models through additional goodness of fit testing instead of solely relying on aic in this way the model and covariate selection process could be further enhanced and avoid decisions based on overfitting with a reasonable balance between accuracy and complexity finally although 23 catchments showed significant seasonal variations particularly in south england the correlation analysis of the quantified seasonality indexes was found to weakly correlate with the goodness of fit of all models and was statistically insignificant at a 95 confidence interval some catchment characteristics showed a relatively significant correlation with the seasonality indexes however it could not be sufficiently concluded that catchment descriptors and quantified seasonality indexes had a statistically significant impact on the goodness of fit apart from catchment characteristics and seasonality index additional potential factors related to the goodness of fit of the different models could be further explored in the future the findings of this study can potentially provide recommendations to hydrologists and engineers when choosing between the available nonstationary models for flood frequency analysis the results of nffa have potential implications for the design and or economic justification of flood risk reduction measures although nonstationary flood frequency analysis methods are widespread in research settings the practical application of nffa in engineering design and water resources management is in its infancy with very few implementations reported therefore to bridge the gap between theoretical research and practical application a more user friendly straightforward and generally agreed upon approach for nonstationary frequency analysis is worth investigating in the future additionally incomplete knowledge of nonstationary drivers remains an ongoing challenge investigation of compound underlying drivers of a nonstationary process is also needed to further research which is essential to physically based models and can help manage future extremes credit authorship contribution statement mengzhu chen conceptualization data curation formal analysis software investigation methodology writing original draft writing review editing konstantinos papadikis supervision writing original draft writing review editing changhyun jun supervision writing original draft funding acquisition neil macdonald supervision writing original draft declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the authors would like to thank the uk national river flow archive https nrfa ceh ac uk data for the river flow data and catchment descriptors and the met office https www metoffice gov uk for the precipitation data the authors thank the associate editor and two anonymous reviewers for their thoughtful and critical comments that improved the manuscript appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 128772 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
2572,in recent years nonstationary flood frequency analysis nffa has become an active area of research it is crucial for water resources management and hydrologic engineering design to cope with the changing environment finding suitable and effective models could help perform better flood frequency analysis and make reliable estimates under the nonstationary environment this study assesses different modelling techniques for nonstationary flood frequency analysis including linear nonlinear parametric and nonparametric models using an extensive data set of 161 catchments across the uk it identifies that rejection rates are generally higher for precipitation informed nffa models than time varying nffa models for both time varying and precipitation informed nffa rejection rates for linear and cubic polynomial models are the highest the models with the fewest rejections are fractional polynomial models followed by cubic spline models because of the flexibility parsimony and user friendly features fractional polynomial models could be a potential alternative for modelling the nonstationary behaviour of flood series to investigate whether the seasonal flood variation and catchment characteristics influence the goodness of fit a quantified seasonality index was calculated to illustrate the degree of seasonal variation of flooding for each catchment it was found that the southeast of the uk has more significant seasonal flood variation than the northwest and most of the catchments with high seasonality indexes are close to the scotland and england border nevertheless the correlation analysis shows insufficient evidence to conclude that catchment characteristics and seasonal flood variation impact the goodness of fit of the nffa models keywords non stationarity flood frequency analysis nonparametric model regression seasonal flood variation data availability data will be made available on request 1 introduction flooding is one of the most common and destructive natural disasters because it affects more people than other environmental hazards and hinders sustainable development over recent decades changes in climate land use infrastructure and population growth have resulted in increased human vulnerability to floods and the proportion of the global population exposed to floods will increase further in the foreseeable future tellman et al 2021 najibi and devineni 2018 alfieri et al 2017 arnell and gosling 2016 winsemius et al 2016 jongman et al 2012 güneralp et al 2015 therefore a better understanding of flood risk variability can help reduce the physical and economic losses caused by floods flood frequency analysis ffa provides an estimate of the relationship between flood magnitude and the risk a cornerstone of flood risk management and water related infrastructure design salas et al 2018 conventional approaches to ffa are based on the assumption that hydrological time series are stationary and independent while exhibiting identical distributions over time the assumption of stationarity has long served as the basis for ffa and the design of hydraulic structures in different countries such as the united states iacwd 1982 usace 1993 the united kingdom institute of hydrology 1999 kjeldsen et al 2005 kjeldsen et al 2008 china mwr 2006 and australian pilgrim 1987 1998 however in reality the statistical characteristics of the hydrological process are influenced by multiple forms of non stationarities including natural non stationarity e g large scale climate variability and artificial non stationarities induced by anthropogenic activities such as climate change land use cover change e g prosdocimi et al 2015 e g blum et al 2020 river regulation e g lorenzo lacruz et al 2012 grill et al 2015 and thus the validity of the stationary assumption to ffa has been questioned and disputed over the last two decades e g khaliq et al 2006 milly et al 2008 2015 westra et al 2014 forzieri et al 2018 water related planning and design projects have always been dependent and always should depend on the analysis of past data to inform projections of future conditions through a stationary probability distribution however in a nonstationary environment conventional methods based on the stationary assumption may no longer provide reliable flood estimates for example an increasing trend in the mean of a flow series could result in underestimating flood quantiles and an increased risk of failure of hydraulic structures and flood prevention measures inversely a decreasing trend could overestimate the design quantiles and increase costs relating to the overdesign of infrastructures consequently the incorporation of non stationarity into ffa has been an active area of research in recent years and is considered crucial for flood risk management and hydrologic engineering design to cope with the changing environment e g villarini et al 2009a 2009b 2012 gilroy and mccuen 2012a gilroy and mccuen 2012b hall et al 2013 madsen et al 2014 bayazit 2015 serago and vogel 2018 salas et al 2018 faulkner et al 2020 for a general review of the literature on the nonstationary hydroclimatic extremes we recommend slater et al 2021 which provides a comprehensive review of the research progress of nonstationary weather and water extremes including methods for detection attribution prediction and projection despite the increasing attention given to nonstationary flood frequency analysis nffa there remains no consensus or generally agreed upon set of methods for performing nffa in fact there is not even a consensus on the actual need for nffa there is a lively debate in the research literature about whether a hydrological time series should be treated as nonstationary and whether stationary or nonstationary methods should be employed in practice e g serinaldi et al 2018 luke et al 2017 rehan and hall 2016 serinaldi and kilsby 2015 montanari and koutsoyiannis 2014 nevertheless it is recognised that the concept of non stationarity is valuable for engineering purposes villarini et al 2018 contend that the issue is not whether observations arise from a long term excursion from some underlying stationary process but rather whether the probability distribution of future floods will resemble the distribution that is obtained from fitting a probability distribution to observations over a historical record as such nonstationary methods have functional value when there are good reasons to suspect physically plausible drivers of change which in turn are somewhat predictable furthermore some government agencies are also making an effort to update their flood protection design guidelines to account for non stationarity e g hfawg 2017 madsen et al 2014 prosdocimi et al 2014 over the past two decades the increasing concern of non stationarity has led to numerous studies of ffa under nonstationary conditions one approach is to adjust a nonstationary river flow record to stationary conditions e g remove the trend from the data before the analysis an ffa can then be applied to the adjusted flow record to develop a stationary flood frequency model e g gilroy and mccuen 2012a gilroy and mccuen 2012b nevertheless this approach is more suitable for contexts where the increase in the rate and size of extreme events can be explained by a trend in the mean e g in sea level analysis a more convenient approach for nffa is to model the non stationarity in the probability distribution moments or parameters which assumes that the parameters of the distributions for frequency analysis can vary with time or with another covariate e g villarini et al 2012 prosdocimi et al 2014 in this approach the inference about the nature of the trend change is included in the model fitting rather than as a separate step increasingly distributional regression models are becoming popular and widely used for their flexibility in fitting nonstationary flood frequency distributions which allows the parameters of the probability distributions to vary as a function of time or other covariate explanatory variables e g rainfall or selected climate indices regression is a valuable and practical approach for characterising the nonstationary behaviour of floods and modelling trends serago and vogel 2018 and hecht and vogel 2020 outlined numerous advantages of using regression based models for nffa 1 regression is effective for communicating results as the goodness of fit of trend models can be expressed both quantitatively and qualitatively in a graphical image 2 unlike many nonparametric trend detection methods regression is a method for both trend detection and modelling 3 regression can provide decision relevant information including expressions of uncertainty i e confidence intervals and prediction intervals and enables hypothesis tests regarding the influence of covariates on changing floods e g helsel and hirsch 2002 4 in some cases changes in flood series may be abrupt due to human interventions in river basins such as reservoir construction e g lópez and francés 2013 to test hypothesised abrupt changes in flood series regression based models can include binary indicator variables bates et al 2012 5 multivariate regression can incorporate multiple covariates to model interacting impacts e g li et al 2018 condon et al 2015 prosdocimi et al 2014 6 regression also accommodates nonlinear relationships and smooth nonlinear functions as well as missing data slater and villarini 2017 and analytical corrections to the variance of regression coefficients inflated by short and long term persistence matalas and sankarasubramanian 2003 7 regression models can include estimates of the likelihood of type i and ii errors which can be important for quantifying the potential for under design and over design vogel et al 2013 those estimates can in turn be integrated into a risk based decision process rosner et al 2014 using regression models for nffa needs to meet two primary challenges selecting the covariates related to the response variable i e river flow and finding a suitable functional form to describe the relationship between the parameters and covariates this study focuses on the second question in general all regression based models in terms of fitting methods can be classified into two main categories parametric regression models and nonparametric regression models linear models generalised linear models and nonlinear models are examples of parametric regression models because the function that describes the relationship between the response variable and explanatory variables known as covariates or predictive factors in hydrologic problems is known parametric regression models are straightforward effective and the result can be easily interpreted but they are often not flexible enough to describe the data at hand with computer technology and statistical software progress nonparametric regression has received increased attention and recognition rigby et al 2013 fox and weisberg 2018 nonparametric regression differs from parametric regression the shape of the functional relationships between the response and the explanatory variables are not predetermined and can be adjusted to capture unusual or unexpected features of the data price 2018 much of the literature in the field of nffa has developed regression based models comprising distribution parameters that are linear functions of the covariate of interest e g faulkner et al 2020 serago and vogel 2018 villarini et al 2009a gilroy and mccuen 2012a gilroy and mccuen 2012b prosdocimi et al 2014 condon et al 2015 while linear models allow for the rapid interpretation of results and straightforward model fitting they may not always be suitable agilan and umamahesh 2017 reported that applying only the linear trend to model non stationarity may increase the bias of the nonstationary models in recent years nonparametric methods have received considerable attention in the field of nffa and a growing body of literature has implemented nonparametric models using splines to draw information on non stationarity from flood data series e g lópez and francés 2013 machado et al 2015 gu et al 2016 agilan and umamahesh 2017 nasri et al 2017 ray and goel 2019 qu et al 2020 chen et al 2021 nonparametric models where parameters are restricted to the covariate s smooth functions offer greater flexibility but reduced extrapolation capability to balance the complexity and accuracy it is worth assessing whether the nonparametric models are necessary and whether linear parametric models adequately capture the relationship between the flood series and covariates finding suitable and effective models could help practitioners hydrologists perform better flood frequency analysis and estimates within a nonstationary environment though this topic has been relatively under researched this study aims to examine and compare linear nonlinear parametric and nonparametric regression models for time varying and precipitation informed nffa using an extensive data set of 161 uk catchments and provide recommendations for the implementation of nffa in the present study the annual precipitation has been selected as the precipitation covariate since it constitutes a commonly used physically based covariate in nffa e g šraj et al 2016 yan et al 2017 in addition the influences of seasonal flood flow variability and catchment characteristics on the goodness of fit and their interaction are assessed 2 data and study area in this study we implemented two kinds of nffa for each selected catchment i a time varying model where the distribution parameters vary as a function of time and ii precipitation informed models where distribution parameters vary with annual precipitation the influence of seasonal flood flow variation and catchment characteristics on the goodness of fit of different models was also assessed therefore three dataset groups were needed for the analysis including annual and seasonal maximum flow series catchment average precipitation series and catchment descriptors 2 1 flow and precipitation data daily river flow series from 161 catchments across the uk including scotland england northern ireland and wales were used to extract the annual and seasonal maxima series the uk lies in the higher mid latitudes between 49 and 61 n and is well known for its unsettled weather due to its constant proximity to the path of the polar front jet stream there is a wide variety of climate and catchment types across the uk river flows can typically range through several orders of magnitude and low flows are generally very modest in most river basins relative to most parts of the world uk river flow patterns are less dominatingly affected by seasonal contrasts in precipitation or melt water contributions precipitation in the uk is generally evenly distributed throughout the year with a modest trend towards an autumn winter maximum particularly in western catchments the gauged daily flow data is provided by the national river flow archive nrfa 2021 the data has undergone a sequence of detailed quality control checks before being added to the national archive in addition the catchment averaged daily rainfall series were derived from ceh gear data tanguy et al 2016 a national gridded data set at 1 km resolution obtained by interpolating the observed values of a dense gauging network more information on the ceh gear rainfall dataset can be found in keller et al 2005 from the catchment daily rainfall dataset annual precipitation amounts were calculated to be used as a covariate for precipitation informed nonstationary models as a sufficient data record length is crucial for reliably estimating distribution parameters as time dependent the 161 selected catchments have at least 40 years of river flow and precipitation records from january 1923 to december 2017 the mean and median data lengths are 52 and 50 years respectively the catchment locations and available record lengths are indicated in fig 1 the apparent diversity of the selected catchments in terms of size and location allows for good spatial coverage of the whole country and can be considered representative of the range of catchment conditions encountered across the uk the catchment areas vary between 12 4 km2 and 7486 km2 to reduce the likelihood of any potentially large flood being missing from the analysed data sets all the catchments selected for the analysis have data completeness of record greater than 99 9 2 2 catchment descriptors a set of physical catchment descriptors including catchment size elevation geology and soil characteristics derived from the flood estimation handbook institute of hydrology 1999 were also supplied by the nrfa https nrfa ceh ac uk feh catchment descriptors six catchment descriptors used in the present study are listed in table 1 bfihost is a measure of catchment responsiveness derived using the 29 class hydrology of soil types host classification boorman et al 1995 bfihost indices vary between 0 and 1 with higher values indicating a more significant base flow contribution and therefore higher catchment storage or permeability sprhost is a measure of catchment responsiveness to rainfall in terms of the standard percentage of runoff this represents an average value for the percentage of rainfall that would be expected to exceed the infiltration capacity of underlying soils and geology leading to runoff dry soils tend to inhibit flood formation whilst in contrast saturated soil conditions precede and contribute to significant flood events propwet is a catchment wetness index that measures the proportion of time that catchment soils are defined as wet in this context when soil moisture deficits are less than 6 mm propwet values range from over 80 in the wettest catchments to less than 20 in the driest parts of the country any reservoirs or lakes within a catchment will tend to affect flood response but those directly linked to the stream network are most likely to produce an attenuation effect the farl index guides the degree of flood attenuation attributable to reservoirs and lakes in the catchment above a gauging station values close to unity indicate the absence of attenuation due to lakes and reservoirs whereas index values below 0 8 indicate a substantial influence on flood response these descriptors for each of the investigated catchments are provided in the supplementary material 3 methods 3 1 overview an overview of our analysis procedures is illustrated in a flow chart see fig 2 first the annual maximum flow data were extracted from the daily flow series as the response variable for modelling the annual precipitation amount was calculated from gridded catchment daily precipitation dataset as an external physical covariate for nffa models precipitation informed models second annual maximum flow data from 161 catchments were used to implement time varying nffa and precipitation informed nffa within the gamlss generalised additive models for location scale and shape framework using linear and nonlinear parametric and nonparametric models since the various commonly used distributions are not significantly different to this study we use the one with fewer parameters after testing a series of widely used two parameter distributions we chose the log normal distribution that works well with our data third a range of goodness of fit tests were applied to each nffa model to investigate which type of model best fitted the flow data in addition to the goodness of fit tests the influences of seasonal flow variation and catchment characteristics on the goodness of fit were investigated flow data series were extracted for each season to examine the seasonal variation of flood flow for each catchment winter december february spring march may summer june august and autumn september november 3 2 the gamlss framework in recent years nonparametric regression modelling using splines has become an attractive flexible and widely acceptable approach to nffa an important prerequisite for nonparametric spline modelling is the availability of user friendly well documented software packages the most widely used regression packages that can fit regression models using splines available in r software include generalised additive models gam generalized additive mixed models gamm vector generalized linear and additive models vglm vgam and generalised additive models for location scale and shape gamlss among them the gamlss package is currently the most popular and commonly used framework in nffa implementation as it provides a more flexible platform to model non stationarity than other additive models therefore the different nffa models in this study were developed based on the gamlss framework additionally we list more details about all these regression packages with spline techniques in the supplementary material to provide a guide for practitioners the gamlss approach was developed by rigby and stasinopoulos 2005 as a common coherent framework for parametric and nonparametric regression models although the gamlss framework is of general statistical use rather than being dedicated to hydrological problems it has been successfully used in the nonstationary frequency analysis of hydrologic series for many years a gamlss model assumes that independent observations y i for i 1 2 3 n have the probability density function f y i θ i of p parameters where θ i θ 1 i θ p i accounting for the location scale and shape of the random variable distribution the number of parameters p usually is less or equal to four since one two three and four parameter families guarantee sufficient flexibility for most applications in gamlss explanatory variables are introduced into the model through the predictors η k related to parameters by monotonic link functions g k including identity log inverse function and others let y t y 1 y 2 y n be the n length vector of the response variable also for k 1 2 p let g k be a known monotonic link function relating the distribution parameters to explanatory variables through 1 g k θ k η k x k β k j 1 j k z jk γ jk where θ k and η k are vectors of length n β k β 1 k β 2 k β j k k is a parameter vector of length j k x k is a known design matrix of order n j k z jk is a fixed known n q jk design matrix and γ jk is a q jk dimensional random variable eq 1 allows modelling of all the distribution parameters as linear parametric nonlinear parametric or nonparametric smooth functions of the explanatory variables as known as covariates or predictive factors in hydrologic problems 3 3 parametric and nonparametric terms five different model kinds for nffa developed based on the gamlss were assessed in this study the first is the nffa model where the distribution parameters vary linearly with the covariate x eq 2 the linear dependence within regressions is the most common and popular class of models they are simple but effective and were usually used as a benchmark 2 η k β 0 β 1 x where η is the predictor for the kth distribution parameter in this study k 1 2 since we use a two parameter log normal distribution the covariate x refers to the time in time varying nffa models and denotes the annual precipitation in precipitation informed nffa models secondly two nonlinear parametric terms were used the conventional cubic polynomials eq 3 and fractional polynomials eq 4 conventional polynomials are the simplest way of modelling nonlinear relationships in regression fractional polynomials royston and altman 1994 are an alternative to regular polynomials that provide more flexible parameterisation for continuous variables but it is relatively new in hydrologic statistics 3 η k β 0 β 1 x β 2 x 2 β 3 x 3 4 η k β 0 β 1 x p 1 β 2 x p 2 β 3 x p 3 where the power p 1 p 2 and p 3 are not necessarily positive integers they can take any value within the predetermined set 2 1 0 5 0 0 5 1 2 3 with x 0 denoting log x if two powers p j happen to be identical then the two terms β 1 j x pj and β 2 j x pj l o g x are fitted instead similarly if three powers are identical the terms fitted are β 1 j x pj and β 2 j x pj l o g x and β 3 j x pj log x 2 in addition we considered two nonparametric smoothing methods namely p splines and cubic splines p splines penalised b splines are a hybrid of regression splines and smoothing splines eilers and marx 1996 which are based on the cubic b spline basis and a large set of equidistant knots usually 10 40 cubic splines are a popular and flexible smoothing technique to describe complex nonlinear relationships which is created by using a piecewise cubic polynomial in an interval between two successive knots green and silverman 1993 to avoid overfitting with splines we use only a small number of effective degrees of freedom between 0 and 3 because the effective degrees of freedom in the splines are normally not greater than ln n when the effective degrees of freedom is zero i e the total degrees of freedom is two the fitted curve is a straight line for more details about these nonparametric smoothing techniques the reader is referred to the texts of wang 2011 and harrell 2015 3 4 testing the goodness of fit we used the normalised randomised quantile residuals to evaluate each nffa model s goodness of fit the main advantage of normalised quantile residuals is that whatever the distribution of the response variable the true residuals always have a standard normal distribution when the assumed model is correct there are several approaches to assessing the normalised quantile residuals in the statistical literature these methods can be categorised into three types graphical visual methods histograms boxplots q q plots and worm plots numerical methods skewness and kurtosis indices and formal normality tests shapiro wilk test kolmogorov smirnov test lilliefors test and anderson darling test graphical methods are the easiest way to check the goodness of fit of the fitted models and they were the most commonly used tools in evaluating regression based nonstationary hydrologic models in the literature e g villarini et al 2009a 2009b lópez and francés 2013 gu et al 2016 sun et al 2018 although the graphical methods can serve as a useful visual tool in checking normality for a sample of independent observations they are not sufficient to provide conclusive evidence that the normal assumption holds therefore a set of formal normality tests including the shapiro wilk sw test the anderson darling ad test and the lilliefors lf test were applied to evaluate the different types of nffa models in this study given an ordered random sample x 1 x 2 x n the sw test statistic shapiro and wilk 1965 is defined as 5 w i 1 n a i x i 2 i 1 n x i x 2 where x i is the i th order statistic x is the sample mean a i a 1 a n m t v 1 m t v 1 v 1 m 1 2 and m m 1 m n t are the expected values of the order statistics of independent and identically distributed random variables sampled from the standard normal distribution and v is the covariance matrix of those order statistics the ad statistic can be computed as arshad et al 2003 6 a 2 n 1 n 2 i 1 l o g f x i l o g 1 f x n 1 i where f x i is the cumulative distribution function of the specified distribution x i are the ordered data n is the sample size the lf statistic lilliefors 1967 is defined as 7 d max x f x s n x where s n x is the sample cumulative distribution function and f x is the cumulative normal distribution function with μ x the sample mean and s 2 the sample variance defined with denominator n 1 more information on the sw ad and lf tests can be found in razali and wah 2011 in this study the three goodness of fit tests were applied to each model at all the 161 catchments and the 5 significance level was chosen p value 0 05 for sw ad and lf tests 3 5 seasonality index and catchment characteristics the effects of seasonal flood variation and catchment characteristics on the goodness of fit were investigated using average p values from the sw ad and lf tests apart from the five different catchment descriptors discussed we calculated a quantified seasonality index to represent the degree of the seasonal variation of flooding for each catchment the seasonality index is quantified with the variance of the normalised seasonal peak flows calculated in eq 3 4 the normalised seasonal peak flood was calculated by dividing the seasonal maximum flow by each catchment s mean seasonal maximum flow 8 σ 2 i 1 i n x i μ 2 n 1 where σ 2 is the variance x i is the normalised seasonal peak flood μ is the mean and n is the number of seasons in this study n is 4 spring summer autumn and winter if a catchment shows significant seasonal flood variation the variance would be high while a small variance indicates less distinct seasonal variation in this catchment finally the quantified seasonality index for each catchment was used in a correlation analysis with the rejection rates and catchment descriptors because of the non normal distribution of some of the catchment descriptors correlations were estimated using the nonparametric spearman rank correlation and a 5 significance level was employed 4 results and discussion 4 1 goodness of fit the goodness of fit of the different model types for nonstationary flood frequency analysis was assessed and the results are presented in table 2 we also performed traditional stationary flood frequency analysis without covariates included for a better comparison table 2 shows the percentage of occurrences for which the model is rejected at the 5 significance level p value 0 05 by the series of tests sw ad and lf if any of these tests rejected a model then the model was treated as being rejected the rejection rates were summarised by stratifying the p values from the tests on values below and above 0 05 as expected the rejection rate for stationary models is the highest the stationary flood frequency analysis approach where no covariates are included in the model and the distribution parameters are constant with time is invalid in 29 8 of the catchments for both time varying and precipitation informed nffa the models rejected the fewest times are the fractional polynomial models with rejection rates of 13 and 14 3 followed by the cubic spline models with rejection rates of 15 5 and 18 in contrast the nonstationary models with a linear or cubic polynomial dependence have higher rejection rates for time varying nffa the linear model has the same rejection rate as the cubic polynomial model at 24 2 of cases 39 catchments more than 70 of rejected cases are overlapped 29 catchments for precipitation informed nffa the linear and the cubic polynomial models are rejected for 28 and 24 8 of the cases respectively cubic splines are one of the most popular smoothing techniques to model complex nonlinear relationships and have been frequently used in nonstationary frequency analysis of hydrologic series in recent years e g villarini and serinaldi 2012 machado et al 2015 ray and goel 2019 chen et al 2021 cubic splines offer greater flexibility and better performance than linear models but are unable to express the spline function as a simple mathematical formula so the interpretation ability is reduced the fractional polynomial models provide an alternative approach for modelling nonlinear relationships to splines and conventional polynomials and perform well with the lowest rejection rates in this assessment the fractional polynomial regression model is an emerging tool in applied research such as medical statistics and clinical research e g binder et al 2013 regier and parker 2015 although it is more flexible and robust than conventional polynomials it has received little attention in nffa modelling it is rarely used in the hydrology field compared to nonparametric smoothing splines and conventional polynomials we found fractional polynomials have attractive features for nffa modelling first low order fractional polynomials are more flexible than low order conventional polynomials since they can offer a wide variety of curve shapes in our test the cubic polynomial model shows high rejection rates and is incapable of providing a good fit this is perhaps because the cubic polynomial model is always symmetric about its local extreme values and requires an additional parameter for each fluctuation in the pattern of change second the parsimony of fractional polynomials can have advantages in applied analysis similar to the general regression case requiring fewer fixed effects can lead to parameter estimates that are more precise and predict more accurate values belsley et al 2004 parsimony can also increase efficiency in the form of statistical power furthermore fractional polynomials are easier to implement than splines and it is a parametric method that can be more easily interpreted than splines for the practical aspect the final purpose of nonstationary flood frequency analysis is to estimate design flood values for the design construction and management of water related infrastructure in the changing environment in this respect a parametric regression model that can be expressed as a mathematical formula would be more user friendly than nonparametric splines to practitioners overall the rejection rates are higher for precipitation informed nffa models than time varying models this is somewhat unexpected as several existing studies indicate that using physically based covariates especially rainfall related covariates for nffa can produce better model performance than time varying models e g faulkner et al 2020 yan et al 2017 we found that many of those studies only use the akaike information criterion aic akaike 1974 to select their models and identify the most significant covariates by comparing their corresponding aic values e g zhang et al 2015 gu et al 2016 sun et al 2018 however in practice the aic leads to overfitting in model selection stasinopoulos et al 2017 vrieze 2012 hurvich and tsai 1989 it is more likely that an overfitted model based on a single aic would be selected when using a nonparametric smoothing method that has already increased the complexity of the model thus to avoid overfitting and balance the accuracy and complexity solely depending on the aic for model selection or identifying the best covariate is not recommended to illustrate our argument one of the study catchments south tyne at haydon bridge station 23004 is selected as an example this station has a 58 year available flow record and its flow data shows a decreasing trend based on the mann kendall test nrfa 2021 compared with the aic values for each model at station 23 004 see table 3 the linear precipitation informed model has the lowest aic value followed by the p spline precipitation informed model also for each type of model the aic values for precipitation informed models are always lower than time varying models in this catchment so if only depending upon the aic for model selection precipitation would be selected as the suitable covariate however in our goodness of fit tests all these precipitation informed models were rejected at the 5 significance level the p value of the tests for each model at station 23 004 is shown in table 4 to display the goodness of fit visually worm plots of the residuals of these models are illustrated in fig 3 as can be seen from plots a to e the standard residuals of the five time varying models are seen to be within the 95 confidence boundary limit which indicates these models are adequate representations of the data while in plots f to j the fitted curves look like a u shape and the level of the worm plots is below the horizontal line at the origin indicating positive skewness in the residuals and the residual mean is too high thus for this case the precipitation informed nonstationary models are inadequate still it is reasonable to believe that using physically based covariates as the explanatory variables in nffa models has potential advantages such as explaining the drivers of the variation in flood frequency whereas when selecting suitable covariates for an nffa model we recommend using a stricter or more robust criterion instead of the classical aic such as the corrected akaike information criterion aicc hurvich and tsai 1989 or in combination with the bayesian information criterion bic also known as schwarz bayesian criterion sbc since the use of bic sbc would generally result in a model more parsimonious than one selected by using the aic it is worth noting that solely using the bic sbc could lead to under fitting furthermore model selection with respect to aic or bic does not provide information about the goodness of fit of the whole model additional inspections for assessing the normality and independence of the residuals of the models are also indispensable which could indicate whether the model can describe the systematic information while the remaining information is random noise finally one needs to be careful when selecting nffa models as the choice of physically based covariates might strongly influence the goodness of fit of the model this study has adopted annual precipitation as one modelling covariate since it constitutes a commonly used explanatory variable in nffa modelling selecting a shorter temporal resolution such as monthly or weekly precipitation might result in different results and provide a different picture of the goodness of fit assessment 4 2 effect of seasonality and catchment characteristics on goodness of fit catchments in the uk have an evident seasonal variation of river flow featuring the wet winter and dry summer seasons chen et al 2019 which provides an important motivation for looking at seasonal flood variation for each catchment and investigating whether a correlation between seasonality index and the goodness of fit exists the quantified seasonality index represents the degree of seasonal variation of flooding for each catchment fig 4 according to the frequency histogram most of the catchments have a seasonality index score between 0 2 and 0 6 only 7 catchments have an index lower than 0 2 which implies the seasonal flood flow variation in these 7 catchments is less distinct as can be seen on the map fig 4 one of them is located in the west of northern ireland another in cumbria northwest england and the remaining 5 catchments are all in southern england in contrast a number of catchments 23 catchments show significant seasonal flood variability with high index scores greater than 0 6 most of them are found in england especially in the south of england only two catchments are close to the southeast boundary of scotland and are close to each other these catchments have a more distinct seasonal variation of flood flow the wet season may be wetter and the dry season may be drier in these catchments during a water year changes in the magnitude and frequency of extreme events are significant symptoms of non stationarity hence the variation of the seasonality index with time could be an excellent way to detect whether a change in the magnitude of extreme weather in a catchment exists we aim to investigate this more analytically in a future study in this study we adopt the average value of the annual seasonality index series to represent the degree of seasonal flood flow variability in each catchment broadly according to the map in fig 4 the southeast of the uk has more significant seasonal flood variation than the northwest many of the catchments with high seasonality index are near the scotland and england border a higher prevalence of groundwater contributions to river flow in permeable catchments in the southeast uk may be important fig 5 shows a visualised correlation matrix for quantified seasonality indexes and the five catchment descriptors with the correlation coefficients and their significance levels according to fig 5 there is sufficient evidence to conclude that the seasonality index negatively correlates with propwet catchment soil wetness index and altbar mean catchment altitude indicating that the catchments with wet soils are more likely to have low seasonality index scores as are catchments in high altitude areas in the uk as many upland areas in the uk have peatlands and considerable capacity to store rainfall this is to be expected the correlation between seasonality index scores and catchment descriptors is primarily negative but not necessarily significant for sprhost and area although their p values are smaller than 0 05 in addition the propwet is strongly positively correlated with altbar and sprhost standard percentage runoff this may indicate that the catchments in high altitude areas are generally wetter than those in low altitude regions and confirms that wet catchments with saturated soils result in a high percentage of runoff while dry soils tend to inhibit flood formation accordingly altbar and sprhost are also positively correlated to each other moreover bfihost base flow index has a significant negative correlation with sprhost this is because a more significant base flow contribution indicates higher catchment permeability or storage and therefore leads to less runoff correlations between the average p value from the goodness of fit tests and different catchment descriptors and the seasonality index for each model are shown in table 5 catchment area and altitude show a weak positive correlation with the goodness of fit of time varying models as many rejected cases have a small catchment area of fewer than 100 km2 however the majority of the correlations are relatively weak and not significant at the 5 level particularly for the precipitation informed models overall there is little evidence to conclude that the degree of seasonal flood variation and catchment characteristics influence the goodness of fit of the nffa models 5 conclusions in the present study different regression modelling techniques were systematically studied for nonstationary flood frequency analysis including linear nonlinear parametric and nonparametric models using an extensive data set of 161 catchments across the whole of the uk the study aimed to investigate both time varying and precipitation informed nffa models for those tests it was identified that the traditional stationary model and linear nonstationary model rejection rates were higher the stationary model was found to be invalid in 30 of the catchments whilst linear time varying and linear precipitation informed models were rejected for 24 and 28 of the cases respectively for both time varying and precipitation informed nffa the model with the lowest rejection rate is the fractional polynomial model followed by the cubic spline models hence the fractional polynomial models could be a potential alternative method for nffa as they also offer straightforward functional forms that can be parametrised by physical or climatological parameters it is certainly not suggested that every flood series should be modelled with fractional polynomials in place of linear or other nonparametric splines examining a single statistical model in isolation might not be a good practice and any chosen model should be compared with alternative models for scrutiny however the fractional polynomials identified in this study can potentially offer practitioners an additional valuable tool at their disposal when modelling the nonstationary behaviour of flood series in contrast to the suggestions from a significant body of literature rejection rates were higher for precipitation informed models than time varying models through additional goodness of fit testing instead of solely relying on aic in this way the model and covariate selection process could be further enhanced and avoid decisions based on overfitting with a reasonable balance between accuracy and complexity finally although 23 catchments showed significant seasonal variations particularly in south england the correlation analysis of the quantified seasonality indexes was found to weakly correlate with the goodness of fit of all models and was statistically insignificant at a 95 confidence interval some catchment characteristics showed a relatively significant correlation with the seasonality indexes however it could not be sufficiently concluded that catchment descriptors and quantified seasonality indexes had a statistically significant impact on the goodness of fit apart from catchment characteristics and seasonality index additional potential factors related to the goodness of fit of the different models could be further explored in the future the findings of this study can potentially provide recommendations to hydrologists and engineers when choosing between the available nonstationary models for flood frequency analysis the results of nffa have potential implications for the design and or economic justification of flood risk reduction measures although nonstationary flood frequency analysis methods are widespread in research settings the practical application of nffa in engineering design and water resources management is in its infancy with very few implementations reported therefore to bridge the gap between theoretical research and practical application a more user friendly straightforward and generally agreed upon approach for nonstationary frequency analysis is worth investigating in the future additionally incomplete knowledge of nonstationary drivers remains an ongoing challenge investigation of compound underlying drivers of a nonstationary process is also needed to further research which is essential to physically based models and can help manage future extremes credit authorship contribution statement mengzhu chen conceptualization data curation formal analysis software investigation methodology writing original draft writing review editing konstantinos papadikis supervision writing original draft writing review editing changhyun jun supervision writing original draft funding acquisition neil macdonald supervision writing original draft declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements the authors would like to thank the uk national river flow archive https nrfa ceh ac uk data for the river flow data and catchment descriptors and the met office https www metoffice gov uk for the precipitation data the authors thank the associate editor and two anonymous reviewers for their thoughtful and critical comments that improved the manuscript appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 128772 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
2573,soil moisture sm is a crucial variable in the hydrological cycle and several recent studies have been conducted to model it using a hybrid strategy integrating physical based and data driven approaches however such methods pay little attention to the flaws of the introduced physics constraints and the inherent nonlinearity of the soil flow process poses a challenge to their real world application in this study a new physics constrained scheme is proposed to exploit or avoid the adverse effects of the model error based on the reasonable assessment of model uncertainty traditional physical model simulations are dynamically weighted to fuse into a data driven framework based on gaussian process regression gpr to utilize the respective strengths of both paradigms for comparison we also implement a scheme that introduces the gradient from the data as an implicit constraint the effectiveness of the proposed paradigm is tested with a series of real world cases the results show that the physical model based on richards equation runs the risk of failing to guarantee even a basic water balance in real soil moisture simulations which raises a red flag about the introduction of physics constraints such as in the deep layers of the goodwell site the coefficient of determination r2 predicted by the physical model is even less than 0 2 due to the neglect of the preferential flow process in contrast the proposed hybrid scheme significantly improves the accuracy and robustness of the soil moisture retrieval by weighing the reliability of the prediction results with the r2 of the surface layer at las cruses site improving to 0 82 compared to 0 45 for the purely data driven model the comparison of the different forms of constraints further demonstrates the generalizability of our proposed constraint scheme keywords soil moisture physics constrained hybrid modeling gaussian process regression gradients information data availability data will be made available on request 1 introduction soil moisture is a key variable in the vadose zone as it governs the exchange of mass and energy between the subsurface and the atmosphere cassiani et al 2006 feddes et al 1988 in the past few decades numerous studies have been conducted on the simulation and prediction of soil moisture dynamics karandish and šimůnek 2016 martínez fernández and ceballos 2005 wang and qu 2009 two seemingly independent directions have been explored successively physics based models pbms and data driven models even though many soil hydrodynamic models based on richards equation richards 1931 have shown good performance in a variety of complex scenarios due to relatively reliable physical process descriptions freeze and harlan 1969 hills et al 1989 nimmo 2021 pagès et al 2012 the issue of uncertainty caused by model structural inadequacy remains a key and prominent challenge elkateb et al 2003 gupta et al 2012 huisman et al 2012 on the other hand machine learning approaches such as artificial neural networks anns support vector machines svms and long short term memory methods lstms have recently been utilized as alternatives to sm related physical models carranza et al 2021 karandish and šimůnek 2016 li et al 2021 li et al 2022 these methods directly establish the mapping relationship between the input and output through black box models to explore the spatiotemporal patterns hidden in the historical data moreover these methods do not require relevant priors and are highly data adaptive however due to the high reliance on data their predictive ability is limited by the scenario and prone to physically inconsistent results lamorski et al 2013 given the benefits and drawbacks of each that may complement one another both paradigms tend to develop towards intermediate modeling which is commonly referred to as a hybrid model or theory guided data science by karpatne et al 2017 while there is a general desire for pbms and machine learning methods to exist in a more synergistic manner the jury still seems to be out on how two integrate the two approaches to the best of our knowledge at least the following macro hybrid paradigms have recently received widespread attention the first paradigm attempts to modify known flawed physical models by introducing the data driven strategy box and draper 1987 in this line of thinking machine learning can be used to improve the parameterizations from observations to facilitate more dynamic and contextualized physical model parameters beck et al 2016 gentine et al 2018 han et al 2020 furthermore machine learning models can be used directly to replace subprocesses of classical physics models with the expectation of simultaneously retaining theoretical foundations and data adaptations brenowitz and bretherton 2018 de bézenac et al 2019 it is even possible to directly learn the physical model and real world deviations via a data driven approach of dynamic induction to address model observation mismatches pathiraja et al 2018 xu et al 2017 yin et al 2021 for example zhang et al 2019b integrated the gaussian process based error model into the physics based data assimilation framework in a dynamic harmonious manner by learning to identify model structural error from diverse data the framework generates more robust parameter estimates while correcting the original predictions this paradigm s downside is the excessive reliance on physical models although numerous studies have been performed on model uncertainty correctly quantifying the discrepancies between defective models and the real world is still difficult on the other hand the value of the dramatic increase in multi source data in promoting a re understanding of nature has been underappreciated reichstein et al 2019 another hybrid paradigm places a greater emphasis on data science and attempts to incorporate physical knowledge into data driven models some studies for example raissi et al 2017b have attempted to encode the structure of the physical differential equation pde into the kernel function of gpr raissi and karniadakis 2018 raissi et al 2017a additionally physics informed neural network pinn which was initially developed by raissi et al 2019 by fusing physical principles e g pde and or engineering theories e g expert knowledge into the loss function of neural networks is becoming increasingly common pinn and its variants have been widely employed in various sectors since the original proposal cai et al 2022 pang et al 2019 wang et al 2020 and recent pinn based research has been able to take uncertainty into account sun and wang 2020 yang et al 2021 yang and perdikaris 2019 for example zhang et al 2019a presented an nn apc method to quantify the parametric uncertainty due to the stochastic equation as well as the approximation uncertainty of the pinn however such studies rarely address the model uncertainty that is related to the imposed form of the pde yang et al 2021 i e the flaws of the introduced physical constraints notably the pinn is rarely employed in the real world of soil water tartakovsky et al 2020 attempted to estimate the unsaturated hydraulic conductivity by using the pinn but only basic steady state flow was considered which might be attributed to the strongly nonlinear behavior of the vadose zone broadbridge et al 2017 furthermore these approaches introduced physical constraints that are mostly based on the modification to the loss function thus exploring more possibilities is necessary there are also other paradigms that try to impose physical constraints directly from the data itself han et al 2013 wang et al 2021 but for more research aside from the aforementioned hybrid paradigms combining physical model simulation results with data driven methodologies can be a simple and effective strategy for example camps valls et al 2018 suggested a joint gaussian process gp approach to improve remote sensing hybrid inversion by introducing trainable parameters to trade off observations and radiative transfer model simulations berger et al 2020 proposed a hybrid aboveground crop nitrogen retrieval method based on a classic model simulation database and machine learning in the field of hydrology kornelsen and coulibaly 2014 used ann to simulate root zone soil moisture by forcing the hydrus 1d to generate a training set it is noted that the physical model simulations pmss in the above case largely serve to expand training data to compensate for the paucity of actual observations can pmss act as an implicit physics constraint and thus be of greater value in the data driven framework if so is it possible to avoid or exploit the inherent flaws of the physical model errors mentioned above this will be the focus of this study this work proposes a new physics constraint mechanism for soil moisture dynamics introducing traditional process based physical model i e phy ross a model based on the richards equation simulation dynamically into the gpr based rasmussen 2003 data driven architecture for the first time to improve its predictive power and also broaden the form of constraints unlike most previous research that directly integrates physical information raissi et al 2019 yang et al 2021 the proposed framework first quantifies the uncertainty of the physical model particularly due to model structure error on the basis of which physical simulations as constraints are dynamically weighted to fuse into the data driven model based on their reliability meanwhile we implement a spatially gradient enhanced version of the gpr based method ge gp where the gradient information as an additional physical constraint is directly excavated from the data itself instead of synthetic experiments we will comparatively analyze the performance of the pbm phy ross the purely gp based data driven method p gp and the proposed physics constrained notion pc p gp and pc ge gp via a series of real world cases we first attempt to reveal the drawbacks of the physical and data driven models in real soil moisture problems and preliminarily discuss the potential risks of introducing physics constraints in complex practical applications most importantly we will investigate whether the proposed physics constraint scheme can improve the predictive accuracy and robustness of the data driven approach in real world scenarios while considering the model uncertainty furthermore the differences in the enhancement effect of different forms or strengths of the physics constraints on soil moisture dynamics simulation will also be one of the focuses of this paper finally the possibility of model performance optimization will be explored to inspire further research work in the remainder of the manuscript section 2 presents the methods used in this work including the ensemble kalman filtering integrated with the physical model conventional sparse approximation and gradient enhanced gpr the physics constrained hybrid paradigm is also given in this section data and model setups are summarized in section 3 the results of the comparative analysis of the actual data are discussed in section 4 the final summary and conclusions are given in section 5 2 methodology aspects 2 1 physically based model one dimensional soil moisture flow model the one dimensional vertical motion of water flow soil water in the unsaturated zone is described in this study using richards equation richards 1931 1 θ h t z k h h z k h z s where h l is the soil water pressure head θ l 3 l 3 is the soil volumetric moisture content t t is the time z l is a spatial coordinate defined as positive downward k h lt 1 means the unsaturated hydraulic conductivity and s t 1 is the sink term the van genuchten muelem vg model van genuchten 1980 is employed to describe the relationship between θ h k h and h to solve richards equation 2 θ h θ r θ s θ r 1 α h n m h 0 θ s h 0 3 k h k s s e λ 1 1 s e 1 m m 2 h 0 k s h 0 where θ s l 3 l 3 and θ r l 3 l 3 represent the saturated and residual soil water contents respectively k s lt 1 is the saturated hydraulic conductivity α 1 l and n are the shape parameters related to the soil moisture characteristic curve m is generally taken according to n as m 1 1 n n 1 s e is the effective saturation and can be expressed as s e θ θ r θ s θ r and λ is another related shape parameter that is generally taken as 0 5 based on the experience we employ a noniterative numerical format to solve richards equation the ross method ross 2003 which can improve computational efficiency without sacrificing computational accuracy the core of this method is to switch the primary variable according to the state of the soil moisture and the extended study by zha et al 2013 further addressed the problem of discontinuities in the kirchhoff potential at heterogeneous soil interfaces 2 2 methods 2 2 1 ensemble kalman filter enkf integrated with the physical model enkf a widely applied sequential data assimilation method was developed based on the bayesian estimation method kalman filter kf evensen 1994 evensen 2003 in this study enkf will be primarily utilized as a model calibration method aanonsen et al 2009 in the hope of obtaining a more reasonable posterior distribution of the physical model parameters the forecast step of the enkf is implemented by the ross method mentioned above and we estimate the parameters and state variables of the soil water model simultaneously at any assimilation time step k the augmented state vector is expressed as 4 y k m i k t u i k t t where i is any member of an ensemble size of n e m i k is the parameter vector and u i k is the variable vector in this study u i k contains h i k pressure head and θ i k soil water content swc both of which are synchronously updated when observations are available the state vector of the ensemble i is updated according to the modeled and observed variables trade off at the given time step k 5 y k i a y k i f k k d obs k ε k i h k y k i f 6 k k c k f h k t h k c k f h k t r k 1 where the superscripts a and f represent the analysis and forecast phases respectively i e before and after assimilating the observation the role of h k is to map the model states to the observation space d obs k is the observation at the time step k ε k i is the observation error term with zero mean and covariance r k k k is the kalman gain and c k f is the prior error covariance matrix of the state vector which is approximately estimated in the enkf as 7 c k f 1 n e 1 i 1 n e y k i f y k f y k i f y k f t where stands for the ensemble average operation 2 2 2 data driven method gaussian process and its sparse approximation as a nonparametric bayesian kernel model liang et al 2007 gpr has been widely employed in various fields additionally this method facilitates our integration of physical constraints due to its characteristic of obtaining the complete posterior distribution which will be explained later to amplify the potential correlation between the model inputs and outputs especially in the deep layers we build a purely gp based data driven model hierarchically according to true observed depths considering the importance of the spatial connection of the sm and exploring the possibility of uncovering physical constraints from the data the other strategy is to build a spatially unified prediction model via the utilization of spatial gradient information for the spatially unified model the amount of training data increases significantly while gp is precisely unable to cope with the computational and memory requirements of large amounts of data liu et al 2019 thus we employ a sparse approximation of the gp which is also given in this subsection and the gradient enhanced version of the gp will be given in the next subsection regression is often formulated as follows predicting a scalar output θ relative to a d dimensional input x given a training set d x i θ i i 1 2 n with n pairs of input output mappings quinonero candela et al 2007 in general the output θ i can be thought of as being produced by a latent function g x corrupted by white noise ξ with variance σ noise 8 θ i g x i ξ i w h e r e ξ i n 0 σ noise 2 where σ noise is the observation error variance mentioned above σ noise 2 r the gp for inferring g x above is completely specified by a mean function m x and a covariance function k x x in this study we employ the widely used zero mean function m x 0 and isotropic squared exponential covariance function k x x 9 k x x σ 2 exp 1 2 l 2 x x x x t where σ 2 controls the prior variance and l is a length scale parameter that controls the rate of decay of the covariance all the hyperparameters involved in the above formula are represented by ϕ i e ϕ σ l which are generally inferred using the training data d that is learning by maximizing evidence or marginal likelihood rasmussen 2003 10 log p θ x ϕ 1 2 log σ n oise 2 i n 1 2 θ μ σ n oise 2 i n 1 θ μ n 2 log 2 π where μ is the prior mean vector i n is the identity matrix represents the covariance matrix of θ whose i th row and j th column element is calculated by ij k x i x j when there is a new input x for obtaining the predicted distribution p θ x d ϕ the prior joint distribution of the training and testing targets is expressed as follows 11 θ θ n μ μ σ σ noise 2 i n σ σ t σ where μ is the mean of θ σ is the covariance matrix between θ and θ with σ ij k x i x j and σ is the prior covariance of θ with σ ij k x i x j the posterior distribution can finally be obtained by conditioning the observed training outputs according to the bayesian inference box and tiao 2011 12 p θ x d ϕ n θ σ 2 where θ μ σ t σ σ n o i s e 2 i n 1 θ μ σ 2 σ σ t σ σ n o i s e 2 i n 1 σ where θ and σ 2 are the final posterior mean and variance respectively other symbols have the same implication as above a practical dilemma of the gp is that in the implementation to a training case of size n the computational and storage demands scale as o n 3 and o n 2 williams and rasmussen 2006 numerous sparse approximation methods for the gp based on the nyström approximation williams and seeger 2000 have been proposed which generate the latent inducing variable g m similar to the g above via introducing m inducing points in this paper variational free energy vfe titsias 2009 is adopted to reduce the computational and memory requirements to o n m 2 and o n m where m is much smaller than n vfe is a global posterior approximation method i e approximating inference but preserving the exact prior given a nyström notation q ab k am k mm 1 k mb the posterior p g g m θ will be approximated by minimizing the discrepancy between the free variational distribution q g g m θ and the posterior defined by the kullback leibler kl divergence 13 kl q g g m θ p g g m θ q g g m θ log q g g m θ p g g m θ d g d g m log p θ f q log p θ for a fixed log p θ minimizing the above eq 13 is equivalent to maximizing f q which is called the variational free energy by using calculus of variations the final bound of the vfe is defined as 14 f vfe 1 2 log q nn σ noise 2 i n 1 2 θ μ q nn σ noise 2 i n 1 θ μ n 2 log 2 π 1 2 σ noise 2 t r k nn q nn where tr denotes the trace of the matrix here we only present a brief introduction to the vfe more details can be found in liu et al 2019 and titsias 2009 in this study the implementation of the gp is based on the gpml matlab toolbox http www gaussianprocess org gpml code matlab doc 2 2 3 the spatially gradient enhanced gaussian process a direct gradient enhanced scheme forrester and keane 2009 han et al 2013 is used where the gradient information is embodied in the form of the augmented covariance matrix i e σ in subsection 2 2 2 if all n training outputs perform gradient enhancement on all d dimensional inputs the size of the output θ will be expanded from n in subsection 2 2 2 to n d 1 n n d this paper only considers the spatial gradient that is taking the partial derivative of the dimension that represents the spatial position in the input is needed thus the size of output is 2 n 15 θ θ 1 θ 2 θ n θ 1 x i θ 2 x i θ n x i t r n 1 1 where the subscript i represents the dimensional position of the observation depth in the input x correspondingly the size of the correlation matrix σ is also expanded from n n to 2 n 2 n where in addition to the correlation between the data itself the matrix also includes the correlation between the data and the gradients and between the gradients themselves wang et al 2021 defining the covariance gradient enhanced matrix as σ new then 16 σ new σ k x 1 x 1 x i k x 1 x 2 x i k x 1 x n x i k x 1 x 1 x i 2 k x 1 x 1 x i 2 2 k x 1 x 2 x i 2 2 k x 1 x n x i 2 k x 2 x 1 x i 2 k x 2 x 1 x i 2 2 k x 2 x 2 x i 2 2 k x 2 x n x i 2 k x n x 1 x i 2 k x n x 1 x i 2 2 k x n x 2 x i 2 2 k x n x n x i 2 in addition to the above covariance matrix the only difference between the spatially gradient enhanced and the regular gp is the predictor which is derived as follows 17 θ μ σ new t σ new σ noise 2 i n 1 θ 1 μ where 18 σ new k x 1 x k x 2 x k x n x k x 1 x x i k x 2 x x i k x n x x i t 19 1 1 1 1 0 0 0 where n ones are followed by n zeros 2 2 4 the framework of the physics constrained data driven model this subsection briefly describes the procedure of how to dynamically incorporate physical model simulations into the gpr based data driven framework as physics constraints the core of this idea lies in the weighted fusion of physics based and gpr based soil moisture simulations according to the prediction reliability reflected in the prediction uncertainty the flowchart of the hybrid framework is illustrated in fig 1 and the narrative description is shown in fig 2 the physical model data driven model and total time steps of the training period are defined as m gp m physics and k respectively then the soil water content fusion prediction is determined by the following product rule 20 p θ new p θ m gp p θ m physics the implicit assumption is that the ensemble prediction of the physical model fits a gaussian distribution hence 21 e θ new var θ new θ physics σ physics 2 θ gp σ gp 2 22 var θ new σ physics 2 σ gp 2 1 in the above eq 21 and eq 22 the weights of the physical and data driven models are w physics σ physics 2 σ physics 2 σ gp 2 and w gp σ gp 2 σ physics 2 σ gp 2 respectively which means that the model with large uncertainty about the predictions will automatically be given a smaller weight notably the outcome after automatic fusion is used as the input for the gpr model s next prediction time step which is dynamically executed accordingly the inspiration of this strategy comes from chen and ren 2009 but their purpose is to implement bagging applications to multiple pure gaussian processes 3 data descriptions and model setup 3 1 data source and site description to fully verify the performance of the proposed physics constraint scheme this study selects five sites with different soil properties and climate characteristics from the uscrn u s climate reference network https www ncei noaa gov access crn to build and validate the model which includes mercury 36 62 n 116 02 w las cruces 32 61 n 106 74 w goodwell 36 59 n 101 59 w gadsden 34 28 n 85 96 w and asheville 13 s 35 41 n 82 55 w hereafter referred to as asheville bell et al 2013 diamond et al 2013 these five stations basically cover the united states from west to east and their spatial locations are depicted in fig 3 the above five stations all use hydra probe ii soil sensor model sdi 12 to measure the soil moisture at depths of 0 05 m 0 10 m 0 20 m 0 50 m and 1 00 m the uscrn provides detailed soil property information at each depth of the site ftp ftp atdd noaa gov pub wilson and we roughly stratify the soil accordingly the properties of each layer seen in table 1 are obtained by averaging the relevant depths 3 2 data preprocessing this study selects the uscrn day scale dataset which includes the air temperature rainfall radiation humidity and soil water content etc to ensure the reliability of the dataset we screened the original data by considering the adverse effects of the inconsistency of snowfall and snowmelt time and the soil icing on the simulation the time nodes with excessively negative air and soil temperatures were excluded additionally we removed periods with continuously missing meteorological and soil monitoring data and guaranteed data integrity for two consecutive days finally the data of the above sites from 1 january 2011 to 31 december 2018 were selected to construct the dataset for a total of eight years of which the first six years served as the training set for the data driven model and also used to calibrate the physical model the final two years were used to test the proposed hybrid paradigm the precipitation and reference evapotranspiration time series of the five stations are presented in fig 4 3 3 model setup 3 3 1 physical model and enkf setups the soil stratification is determined by the physical properties of the soil profile see table 1 to avoid the influence of the unknown lower boundary the depth of the soil profile is extended to 150 cm and uniformly discretized into 66 nodes with 1 cm intervals for the top 10 cm 2 cm intervals for the middle 90 cm and 5 cm intervals for the lower 50 cm zhang et al 2019b as stated in eqs 2 3 there are five physical parameters required by the van genuchten muelem model of which the values of θ r and θ s are set according to the soil water observations the other three parameters expressed as m α n k s are assumed to follow the logarithmic normal distribution the prior mean is obtained based on the neural network of rosetta lite schaap et al 2001 and the prior variance is estimated by referring to carsel and parrish 1988 the initialization distribution of the parameters is shown in table 2 the upper and lower boundaries of the physical model are set as the atmospheric boundary and the free drainage boundary respectively the average daily reference evapotranspiration shown in fig 4 is calculated using the penman monteith equation allen et al 1998 and assuming that the potential evapotranspiration is equal to the reference evapotranspiration according to the field data from the uscrn the vegetation at these sites is mostly grassland so the root depth is deliberately assumed to be consistently 30 cm as mentioned earlier the enkf is integrated with the physical model for model error evaluation in this study the ensemble size is set to 500 and the soil moisture measurement error is set to 0 02 cm3 cm3 according to the technical specifications of the sensor furthermore in our real case the ensemble simulation is prone to collapse due to excessive parameter updates that are caused by the interference of the model error thus we adopted a damping factor of 0 3 as suggested by erdal et al 2014 applying on the kalman gain k k to limit parameter updates this setup works very well for our practice as seen from the above set conditions the physical model inevitably introduces various rough assumptions in practical applications including boundary conditions vegetation information and soil properties which will undoubtedly affect the final simulation accuracy 3 3 2 gaussian process model setups the hierarchical gpr model predicts the swc of the i th layer i 1 5 on the t day by considering the water content of the t 1 day and the meteorological data of the day i e inpu t i t we a t θ i t 1 in the training period the water content profile is time continuous and known while in the prediction period the previous day s water content θ t 1 in the input is obtained by the model prediction except for the soil water content on the first day as the initial condition rainfall average air temperature relative humidity and solar radiation are used as meteorological inputs to the gpr model to be as consistent as possible with the pbm compared with the hierarchical prediction model the input of the spatially unified model will add the observation depth i e inpu t t we a t θ t 1 z i and the output will correspondingly include the spatial gradient information specifically the vertical spatial gradient value g i of the i th layer is calculated as follows wang et al 2021 23 g i θ i 1 θ i z i 1 z i i 1 θ i θ i 1 z i z i 1 i 5 θ i 1 θ i 1 z i 1 z i 1 else in addition given the lagged effect of rainfall infiltration and the strong correlation between the soil moisture dynamics and rainfall we will use the accumulated precipitation for the historical 4 days including the day as input and the impact of cumulative rainfall days will be briefly discussed later the data of winter soil freezing or snowfall for some sites were excluded during data preprocessing hence the two year prediction period of all five sites will be projected separately for uniformity as will the physical model notably all inputs to the data driven model are normalized to 0 1 to eliminate the effects of data magnitude 3 3 3 performance metrics setup in this work the performance of different models is evaluated mainly by using the coefficient of determination r2 the time averaged root mean square error rmse and the mean absolute relative error mare between the estimated and observed soil moisture in addition the nash sutcliffe efficiency nse nash and sutcliffe 1970 the mean absolute error mae and the absolute values of bias are used as auxiliary metrics mare nse and the absolute values of bias are defined as follows 24 mare 1 n t k 1 n t θ k obs θ k est θ k obs 25 nse 1 k 1 n t θ k obs θ k est 2 k 1 n t θ k obs θ obs 2 26 b i a s k θ k obs θ k est where θ k obs and θ k est represent the observed and estimated soil moisture values at time k respectively θ obs is the time averaged observed soil moisture at all time points and n t is the total prediction time step 3 4 summary of the model design as mentioned earlier we implement the process based physical model and use the ross method as a solver simultaneously we hierarchically establish a purely gpr based data driven model and further introduce the implicit constraint gradient information contained in the observation data to construct a spatially unified gradient enhanced gpr model more meaningfully a feasible physics constraint scheme is proposed with considering the model uncertainty a summary of the model design is displayed in table 3 through a series of comparative analyses of the model performance we attempt to elucidate the distinctions between the physical model and gpr methods that incorporate different forms of physical constraints in soil moisture simulation as well as the larger utility of conventional model simulation as a constraint in data science 4 results and discussion 4 1 comparison of the pbm phy ross and the purely data driven method p gp we first examine the performance differences between the traditional physical model and the purely gpr based method corresponding to phy ross and p gp respectively at the five sites with different soil moisture flow and meteorological characteristics fig 5 shows the coefficient of determination between the observed and estimated soil moisture from the two models during the prediction period for comparison the resulting time averaged rmse values for all five models are shown in table 4 table s1 and s2 also depict the results for nse and mae fig 5 and table 4 indicate that the p gp generally outperforms the phy ross and the superiority of the data driven model becomes more obvious as the simulation depth increases at the vast majority of sites and depths the p gp leads to a lower rmse and a higher r 2 with the exception of the superficial layer of las cruses z 0 05 m although the p gp has a lower r 2 at z 0 50 m its rmse is reduced from 0 0179 to 0 0097 in contrast to the phy ross and deep layers of mercury z 0 50 m 1 00 m specifically as shown in fig 6 d the time series of the surface swc predicted at las cruses is quite unstable with multiple abnormal jumps as highlighted in the purple dashed rectangle this phenomenon might be explained by the fact that the site belongs to an arid region average annual rainfall of approximately 200 mm with intense but infrequent alternation of wetting and drying on the surface rainfall as a major driver of soil moisture movement has large inter annual and intra annual variability fig 4 b especially during the forecast period when its intensity is significantly higher than that in the past six years which makes the training set unable to contain enough valid scenarios for example an extreme precipitation event occurred on october 23 2018 with a single day rainfall of 48 6 mm and considering the historical maximum single day rainfall of less than 30 mm the p gp unsurprisingly shows a large deviation which also directly leads to the failure of the subsequent simulations the main reason for the poor performance of the p gp in the deep layer of mercury is due to the soil texture as presented in table 2 although the soil profile of mercury is uniform the sand content is as high as 76 18 indicating extremely poor soil water retention properties for the data itself a rich scenario diversity implies a larger range and magnitude of data variation zook et al 2012 however the maximum value of the deep swc observations is less than 0 08 cm3 cm3 and the fluctuation range is less than 0 04 cm3 cm3 compared with the surface of mercury fig 6 a c which greatly limits the predictive power of the p gp in addition the p gp achieves a more obvious advantage in the deep layer s prediction see fig 6 i 6 l 6o which is related to our strategy of hierarchically building a data driving model that is the hysteresis effect of the soil profile will be alleviated by directly establishing the mapping relationship for the phy ross its performance is mediocre but relatively robust except at z 0 50 m 1 00 m for the goodwill that almost collapses fig 6 h 6i we notice that the soil stratification at goodwell is clear and the lower layer is more viscous table 2 which is reflected in the consistent trend of swc at z 0 05 m 0 10 m 0 20 m moreover the swc variability in the deep layers seems to be irregular with overall drastic changes and higher peak values through further analysis we find that the site is likely to exhibit a preferential flow phenomenon allaire et al 2009 taking the rainfall event from october 6 2018 to october 9 2018 as an example the total rainfall on these four days is 110 6 mm if the 100 cm soil profile is stratified according to the principle of centering the observation nodes the thicknesses of the five layers are 7 5 cm 7 5 cm 20 cm 40 cm and 25 cm respectively and the swc variation amplitudes of each layer are 0 308 cm3 cm3 0 236 cm3 cm3 0 267 cm3 cm3 0 306 cm3 cm3 and 0 248 cm3 cm3 respectively the total water volume of the soil profile increased by 278 6 mm before and after precipitation which is significantly larger than the actual rainfall 110 6 mm indicating that the precipitation may preferentially reach 50 cm and 100 cm along the macrospore channels furthermore the phy ross generally overestimated the surface swc and underestimated the bottom such as the gadsden and las cruses see fig 6 d 6j 6l which may stem from improper assumptions about the root system and boundary settings the above analysis enlightens us that in the one dimensional model based on the assumption of uniform flow the most fundamental water balance may be difficult to guarantee due to the simplified representations or omission of the model structures and processes in this case additional errors are likely to be introduced if the single phase richard s equation is incorporated directly into the data driven model overall in real soil moisture simulations the performance of a purely data driven model is highly dependent on the richness of the historical scenario diversity the physical model is more robust but it is risky once faced with serious structural errors no matter whether it is directly applied or as a physics constraint even the water balance constraint these results suggest the necessity of developing a hybrid model based on the assessment of model uncertainty 4 2 using physical constraints to improve the robustness of the data driven model the above real cases have demonstrated the potential collapse of the pbm and the purely gp based data driven method in the presence of unknown structural errors and insufficient historical scenarios respectively in this section we integrate physical model simulations as constraints into the p gp and ge gp to investigate whether the hybrid paradigm can combine their respective advantages of high robustness and accurate capture of data characteristics to obtain a boost by weighing the uncertainties 4 2 1 the phy ross vs the p gp vs the pc p gp fig 5 and fig s1 present the coefficient of determination and absolute value of bias between the estimated and observed swc from the phy ross p gp and pc p gp respectively table 5 shows the mare values for all five models simultaneously these results show that by introducing physical constraints the soil moisture dynamics estimation of the data driven method improved with a significant reduction in biases and larger r 2 except in the deep layers of goodwell z 0 50 m 1 00 m it is noted that this significant improvement in estimating the swc has also shown considerable robustness our hybrid scheme maintains the advantage for depths where the purely gp based method has achieved fairly good results such as at the gadsden asheville surface layers of mercury goodwell and at z 0 10 0 20 0 50 1 00 m of las cruces fig 7 a c take some typical depths as an example to further present the time series of swc achieved by the p gp and pc p gp models in these locations the pbm simulations act as auxiliary constraints to correct the few triggered unreliable extrapolations as highlighted in the purple dashed rectangle in fig 7 a and 7b while maintaining the strong predictive power of the p gp which results in a more accurate prediction on the other hand at z 0 05 m of las cruses and z 0 50 m 1 00 m of mercury where the purely gp based model mentioned above has a large deviation the simulation accuracy is improved after adding physics constraints even surpassing the phy ross and achieving the best results among the three models see the first and second columns of fig s1 fig 5 a b the temporal evolution of las cruces at z 0 05 m is presented in fig 7 d the abovementioned anomalous jumps of the p gp are shown to be perfectly avoided and compared to fig 6 d the problem of overestimating the surface swc caused by the improper assumptions in the pbm building process has also been corrected the accurate quantification of the prediction uncertainties is the key reason why our proposed physics constrained gpr model can fully exploit the respective advantages of the pbm and gp based model fig 8 presents the predicted variance for several representative depths that correspond to fig 7 the following observations are determined 1 the prediction variance of the p gp is much smaller than that of the phy ross at the depths where it has achieved an evident superiority fig 8 b and c which implies that the constraint scheme will give extremely high weight to the data driven model furthermore at a few unstable time points for the p gp e g day 376 at z 0 05 m at mercury shown by the purple dashed box in fig 7 b the estimated variance unsurprisingly peaks as high as 0 00162 not fully displayed in fig 8 b due to coordinate scaling and hence the hybrid method will rely largely on the pbm to obtain a satisfactory result 2 similar prediction variances are achieved at depths where the two models perform almost equally well e g at gadsden site see fig 7 a but the asynchronous fluctuations of the variance play a good role in restricting each other fig 8 a 3 at las cruces with poor p gp performance the unreasonable jumps of the p gp prediction and the peak fluctuations of the variance are highly synchronized compare fig 7 d and fig 8 d and it is at these time points that the hybrid framework effectively improves the robustness of the purely data driven method by introducing physical model simulations with less uncertainty overall the predicted variance of the physics constrained gpr model is the smallest implying the most reliable simulation results unfortunately at the deep layers of goodwell z 0 50 m 1 00 m even though our implicit physics constrained scheme has given an absolute reliance on the p gp referring to fig 8 e for the predicted variance the extremely deteriorated pbm still restricts the potential of the hybrid model and ultimately fails to optimize the data driven model fig 7 e this result further suggests that we should be more cautious about the introduction of physical constraints in complex real world problems 4 2 2 the phy ross vs the ge gp vs the pc ge gp one of the main purposes of our implementation of the ge gp is to test whether the proposed hybrid notion can adapt to different data driven modeling strategies i e the universality of the framework fig 9 and fig s2 present the coefficient of determination between the predicted and observed soil moisture at all five sites and the corresponding spatial temporal patterns of absolute values of soil moisture bias using the phy ross ge gp and pc ge gp respectively although the ge gp is quite different from p gp in modeling details it shows similar results to fig 5 and fig s1 in that a robust improvement is also achieved by introducing the same physical model simulations as constraints this result demonstrates the generality of this preliminary hybrid paradigm in assisting the reconstruction of soil moisture dynamics and its potential to be applied to other research questions 4 3 comparison of physics constraints in different forms as mentioned earlier we implement a spatially gradient enhanced version of the purely gp based model to build a spatially unified model the vertical gradient can essentially be interpreted as a physical boundary constraint excavated directly from the data itself which represents the driving force of rainfall infiltration compared with the proposed hybrid model that introduces physical model simulations as constraints a thought provoking question arises what is the difference in the performance of the constraint scheme mined from data itself ge gp or from the physical model pc p gp does stacking the two give better outcomes pc ge gp as shown in fig 5 fig 9 and especially the rmses in table 4 the ge gp has improved the estimation accuracy of the surface swc in contrast to the p gp for example the coefficient of determination of the ge gp r 2 0 827 even exceeds that of the pc p gp r 2 0 820 at z 0 05 m of las cruces however the gradient enhanced p gp generally deteriorates the deep estimation which is in line with the findings by wang et al 2021 there are two main reasons for this phenomenon the first is that compared with the hierarchically established p gp the unified ge gp constructed by directly adding position information to the input will unsurprisingly further weaken the bottom swc s feeble response to the upper boundary the second reason is that due to soil heterogeneity the variations in the swc in the surface and deep layers are not consistent and the fusion of the drastically varying surface gradients will disrupt the temporal evolution of the deep swc this result indicates that although mining physical knowledge from data and applying it to a data driven method is an appealing notion and it is even feasible to derive governing equation from the observations ghorbani et al 2021 the complexity of practical issues poses more challenges to its performance compared to introducing the constraints from an existing physical model furthermore since the performance of the proposed hybrid method is affected by the predictive capability of the data driven model itself the pc ge gp does not achieve a significant advantage over the pc gp 4 4 further discussion on the possibility of model performance optimization we recall that the vfe algorithm is used to execute a sparse approximation gpr in the ge gp and pc ge gp to circumvent the computational load problem caused by the rising data volume of the spatially unified model when we apply this sparse approximation algorithm to the hierarchical models p gp and pc p gp denoted as p gps and pc p gps a surprising improvement in the model performance is achieved while improving the computational efficiency at the gadsden site for example the cpu times spent for the p gp and pc p gp are approximately 15 min on a 2 40 ghz intel xeon e5 2630 cpu and 64 gb ram pc platform the ge gp and pc ge gp take about 14 min the p gps and pc p gps take about 1 min as shown in fig 10 only three representative sites are presented the r 2 of the p gps has been significantly improved in contrast to the p gp especially for soil surfaces where the p gp are vulnerable to the limitations of inadequate historical scenarios moreover our physics constrained scheme pc p gps still shows considerable robustness a variational gaussian process that performs approximate inference has been proven to be equivalent to a deep gaussian process dgp with one layer svendsen et al 2020 the dgp is a cascade of gp analogous to the structure of deep neural networks damianou 2015 and this stacked hierarchical composition helps to capture complex patterns from data while automatically quantifying uncertainty and may outperform neural networks in certain scenarios camps valls et al 2011 this explains why the performance of the p gp in fig 10 improves after implementing sparse approximation and suggests that in our real world case even for these sites with insufficient historical scenarios the profound worth inherent in the input data is not fully revealed it is also noteworthy that given the strong scalability of our hybrid paradigm i e similar to the dgp other data driven methods that can assess prediction uncertainty and have stronger data fitting capabilities e g lstm fang et al 2020 could potentially substitute the gpr model here to achieve superior hybrid performance soil moisture simulation around the dgp and other neural networks capable of evaluating uncertainty and their physical constraint mechanisms will be investigated in future studies moreover cumulative 4 day rainfall rather than single day average rainfall is employed as a data driven model input in our modeling strategy which helps to alleviate the hysteretic response of deep swc to precipitation fig 11 takes gadsden as an example to further demonstrate the impact of accumulated days of rainfall on the p gp model s performance the rainfall input with more cumulative days is more advantageous for estimating deeper swc which is in line with our intuitive cognition this simple example aims to demonstrate that it still seems necessary to consider the effect of the soil structure e g spatial heterogeneity in real soil moisture data driven modeling rather than merely establishing a mapping link between meteorology and swc and hierarchical or categorical modeling based on soil properties seems to be feasible 5 conclusions in this study a physics constrained gpr scheme is proposed for the reconstruction of real world soil moisture dynamics where physical model simulations are dynamically weighted and fused into the gp based data driven forecasting framework based on the accurate quantification of model uncertainties this hybrid model is expected to cleverly exploit the complementary advantages of the two conventional modeling paradigms for more reliable swc estimates to fully verify the universality of the proposed constraint scheme and further understand the differences in the enhancement of model performance by physics constraint forms a spatially gradient enhanced gp is also constructed through comparative analysis the following conclusions can be drawn 1 the overall performance of the gp based model is better than that of the physics based model in soil moisture profile retrieval however in our real cases both show evident limitations the data driven model is strongly reliant on the richness of the historical scenario diversity with varying meteorological circumstances e g extreme rainfall and differences in the soil texture challenge its robustness the physical model is relatively stable but the unknown soil structure may even make maintaining the most basic water balance impossible warning against sufficient caution in developing physics constraint schemes in real world applications 2 by evaluating the reliability of the prediction outcomes of both process based and gp based models the proposed weighted constraint paradigm properly integrates their respective advantages of robustness and flexibly capturing data trends meanwhile the generalizability of the hybrid approach is demonstrated by applying it to different modeling strategies hierarchical and spatially unified and sites with varying climatic conditions 3 although mining physical constraints e g gradient information from data is tempting it is still challenging for complex practical problems e g the effect of soil heterogeneity in contrast to introducing constraints from mature physical model systems adopting more expressive deep gaussian process and other neural networks that can quantify predictive uncertainty to model and taking the soil structure into account may assist in further improving the suggested hybrid scheme credit authorship contribution statement leilei he conceptualization methodology software writing original draft qiuru zhang conceptualization software writing review editing liangsheng shi writing review editing supervision yakun wang methodology lijun wang supervision xiaolong hu writing review editing yuanyuan zha data curation methodology kai huang data curation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work was supported by the national key research and development program of china 2021yfc3201203 the open research fund of guangxi key laboratory of water engineering materials and structures grant gxhri wems 2020 06 and the national natural science foundation of china grants 51979200 and 52179038 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 128779 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
2573,soil moisture sm is a crucial variable in the hydrological cycle and several recent studies have been conducted to model it using a hybrid strategy integrating physical based and data driven approaches however such methods pay little attention to the flaws of the introduced physics constraints and the inherent nonlinearity of the soil flow process poses a challenge to their real world application in this study a new physics constrained scheme is proposed to exploit or avoid the adverse effects of the model error based on the reasonable assessment of model uncertainty traditional physical model simulations are dynamically weighted to fuse into a data driven framework based on gaussian process regression gpr to utilize the respective strengths of both paradigms for comparison we also implement a scheme that introduces the gradient from the data as an implicit constraint the effectiveness of the proposed paradigm is tested with a series of real world cases the results show that the physical model based on richards equation runs the risk of failing to guarantee even a basic water balance in real soil moisture simulations which raises a red flag about the introduction of physics constraints such as in the deep layers of the goodwell site the coefficient of determination r2 predicted by the physical model is even less than 0 2 due to the neglect of the preferential flow process in contrast the proposed hybrid scheme significantly improves the accuracy and robustness of the soil moisture retrieval by weighing the reliability of the prediction results with the r2 of the surface layer at las cruses site improving to 0 82 compared to 0 45 for the purely data driven model the comparison of the different forms of constraints further demonstrates the generalizability of our proposed constraint scheme keywords soil moisture physics constrained hybrid modeling gaussian process regression gradients information data availability data will be made available on request 1 introduction soil moisture is a key variable in the vadose zone as it governs the exchange of mass and energy between the subsurface and the atmosphere cassiani et al 2006 feddes et al 1988 in the past few decades numerous studies have been conducted on the simulation and prediction of soil moisture dynamics karandish and šimůnek 2016 martínez fernández and ceballos 2005 wang and qu 2009 two seemingly independent directions have been explored successively physics based models pbms and data driven models even though many soil hydrodynamic models based on richards equation richards 1931 have shown good performance in a variety of complex scenarios due to relatively reliable physical process descriptions freeze and harlan 1969 hills et al 1989 nimmo 2021 pagès et al 2012 the issue of uncertainty caused by model structural inadequacy remains a key and prominent challenge elkateb et al 2003 gupta et al 2012 huisman et al 2012 on the other hand machine learning approaches such as artificial neural networks anns support vector machines svms and long short term memory methods lstms have recently been utilized as alternatives to sm related physical models carranza et al 2021 karandish and šimůnek 2016 li et al 2021 li et al 2022 these methods directly establish the mapping relationship between the input and output through black box models to explore the spatiotemporal patterns hidden in the historical data moreover these methods do not require relevant priors and are highly data adaptive however due to the high reliance on data their predictive ability is limited by the scenario and prone to physically inconsistent results lamorski et al 2013 given the benefits and drawbacks of each that may complement one another both paradigms tend to develop towards intermediate modeling which is commonly referred to as a hybrid model or theory guided data science by karpatne et al 2017 while there is a general desire for pbms and machine learning methods to exist in a more synergistic manner the jury still seems to be out on how two integrate the two approaches to the best of our knowledge at least the following macro hybrid paradigms have recently received widespread attention the first paradigm attempts to modify known flawed physical models by introducing the data driven strategy box and draper 1987 in this line of thinking machine learning can be used to improve the parameterizations from observations to facilitate more dynamic and contextualized physical model parameters beck et al 2016 gentine et al 2018 han et al 2020 furthermore machine learning models can be used directly to replace subprocesses of classical physics models with the expectation of simultaneously retaining theoretical foundations and data adaptations brenowitz and bretherton 2018 de bézenac et al 2019 it is even possible to directly learn the physical model and real world deviations via a data driven approach of dynamic induction to address model observation mismatches pathiraja et al 2018 xu et al 2017 yin et al 2021 for example zhang et al 2019b integrated the gaussian process based error model into the physics based data assimilation framework in a dynamic harmonious manner by learning to identify model structural error from diverse data the framework generates more robust parameter estimates while correcting the original predictions this paradigm s downside is the excessive reliance on physical models although numerous studies have been performed on model uncertainty correctly quantifying the discrepancies between defective models and the real world is still difficult on the other hand the value of the dramatic increase in multi source data in promoting a re understanding of nature has been underappreciated reichstein et al 2019 another hybrid paradigm places a greater emphasis on data science and attempts to incorporate physical knowledge into data driven models some studies for example raissi et al 2017b have attempted to encode the structure of the physical differential equation pde into the kernel function of gpr raissi and karniadakis 2018 raissi et al 2017a additionally physics informed neural network pinn which was initially developed by raissi et al 2019 by fusing physical principles e g pde and or engineering theories e g expert knowledge into the loss function of neural networks is becoming increasingly common pinn and its variants have been widely employed in various sectors since the original proposal cai et al 2022 pang et al 2019 wang et al 2020 and recent pinn based research has been able to take uncertainty into account sun and wang 2020 yang et al 2021 yang and perdikaris 2019 for example zhang et al 2019a presented an nn apc method to quantify the parametric uncertainty due to the stochastic equation as well as the approximation uncertainty of the pinn however such studies rarely address the model uncertainty that is related to the imposed form of the pde yang et al 2021 i e the flaws of the introduced physical constraints notably the pinn is rarely employed in the real world of soil water tartakovsky et al 2020 attempted to estimate the unsaturated hydraulic conductivity by using the pinn but only basic steady state flow was considered which might be attributed to the strongly nonlinear behavior of the vadose zone broadbridge et al 2017 furthermore these approaches introduced physical constraints that are mostly based on the modification to the loss function thus exploring more possibilities is necessary there are also other paradigms that try to impose physical constraints directly from the data itself han et al 2013 wang et al 2021 but for more research aside from the aforementioned hybrid paradigms combining physical model simulation results with data driven methodologies can be a simple and effective strategy for example camps valls et al 2018 suggested a joint gaussian process gp approach to improve remote sensing hybrid inversion by introducing trainable parameters to trade off observations and radiative transfer model simulations berger et al 2020 proposed a hybrid aboveground crop nitrogen retrieval method based on a classic model simulation database and machine learning in the field of hydrology kornelsen and coulibaly 2014 used ann to simulate root zone soil moisture by forcing the hydrus 1d to generate a training set it is noted that the physical model simulations pmss in the above case largely serve to expand training data to compensate for the paucity of actual observations can pmss act as an implicit physics constraint and thus be of greater value in the data driven framework if so is it possible to avoid or exploit the inherent flaws of the physical model errors mentioned above this will be the focus of this study this work proposes a new physics constraint mechanism for soil moisture dynamics introducing traditional process based physical model i e phy ross a model based on the richards equation simulation dynamically into the gpr based rasmussen 2003 data driven architecture for the first time to improve its predictive power and also broaden the form of constraints unlike most previous research that directly integrates physical information raissi et al 2019 yang et al 2021 the proposed framework first quantifies the uncertainty of the physical model particularly due to model structure error on the basis of which physical simulations as constraints are dynamically weighted to fuse into the data driven model based on their reliability meanwhile we implement a spatially gradient enhanced version of the gpr based method ge gp where the gradient information as an additional physical constraint is directly excavated from the data itself instead of synthetic experiments we will comparatively analyze the performance of the pbm phy ross the purely gp based data driven method p gp and the proposed physics constrained notion pc p gp and pc ge gp via a series of real world cases we first attempt to reveal the drawbacks of the physical and data driven models in real soil moisture problems and preliminarily discuss the potential risks of introducing physics constraints in complex practical applications most importantly we will investigate whether the proposed physics constraint scheme can improve the predictive accuracy and robustness of the data driven approach in real world scenarios while considering the model uncertainty furthermore the differences in the enhancement effect of different forms or strengths of the physics constraints on soil moisture dynamics simulation will also be one of the focuses of this paper finally the possibility of model performance optimization will be explored to inspire further research work in the remainder of the manuscript section 2 presents the methods used in this work including the ensemble kalman filtering integrated with the physical model conventional sparse approximation and gradient enhanced gpr the physics constrained hybrid paradigm is also given in this section data and model setups are summarized in section 3 the results of the comparative analysis of the actual data are discussed in section 4 the final summary and conclusions are given in section 5 2 methodology aspects 2 1 physically based model one dimensional soil moisture flow model the one dimensional vertical motion of water flow soil water in the unsaturated zone is described in this study using richards equation richards 1931 1 θ h t z k h h z k h z s where h l is the soil water pressure head θ l 3 l 3 is the soil volumetric moisture content t t is the time z l is a spatial coordinate defined as positive downward k h lt 1 means the unsaturated hydraulic conductivity and s t 1 is the sink term the van genuchten muelem vg model van genuchten 1980 is employed to describe the relationship between θ h k h and h to solve richards equation 2 θ h θ r θ s θ r 1 α h n m h 0 θ s h 0 3 k h k s s e λ 1 1 s e 1 m m 2 h 0 k s h 0 where θ s l 3 l 3 and θ r l 3 l 3 represent the saturated and residual soil water contents respectively k s lt 1 is the saturated hydraulic conductivity α 1 l and n are the shape parameters related to the soil moisture characteristic curve m is generally taken according to n as m 1 1 n n 1 s e is the effective saturation and can be expressed as s e θ θ r θ s θ r and λ is another related shape parameter that is generally taken as 0 5 based on the experience we employ a noniterative numerical format to solve richards equation the ross method ross 2003 which can improve computational efficiency without sacrificing computational accuracy the core of this method is to switch the primary variable according to the state of the soil moisture and the extended study by zha et al 2013 further addressed the problem of discontinuities in the kirchhoff potential at heterogeneous soil interfaces 2 2 methods 2 2 1 ensemble kalman filter enkf integrated with the physical model enkf a widely applied sequential data assimilation method was developed based on the bayesian estimation method kalman filter kf evensen 1994 evensen 2003 in this study enkf will be primarily utilized as a model calibration method aanonsen et al 2009 in the hope of obtaining a more reasonable posterior distribution of the physical model parameters the forecast step of the enkf is implemented by the ross method mentioned above and we estimate the parameters and state variables of the soil water model simultaneously at any assimilation time step k the augmented state vector is expressed as 4 y k m i k t u i k t t where i is any member of an ensemble size of n e m i k is the parameter vector and u i k is the variable vector in this study u i k contains h i k pressure head and θ i k soil water content swc both of which are synchronously updated when observations are available the state vector of the ensemble i is updated according to the modeled and observed variables trade off at the given time step k 5 y k i a y k i f k k d obs k ε k i h k y k i f 6 k k c k f h k t h k c k f h k t r k 1 where the superscripts a and f represent the analysis and forecast phases respectively i e before and after assimilating the observation the role of h k is to map the model states to the observation space d obs k is the observation at the time step k ε k i is the observation error term with zero mean and covariance r k k k is the kalman gain and c k f is the prior error covariance matrix of the state vector which is approximately estimated in the enkf as 7 c k f 1 n e 1 i 1 n e y k i f y k f y k i f y k f t where stands for the ensemble average operation 2 2 2 data driven method gaussian process and its sparse approximation as a nonparametric bayesian kernel model liang et al 2007 gpr has been widely employed in various fields additionally this method facilitates our integration of physical constraints due to its characteristic of obtaining the complete posterior distribution which will be explained later to amplify the potential correlation between the model inputs and outputs especially in the deep layers we build a purely gp based data driven model hierarchically according to true observed depths considering the importance of the spatial connection of the sm and exploring the possibility of uncovering physical constraints from the data the other strategy is to build a spatially unified prediction model via the utilization of spatial gradient information for the spatially unified model the amount of training data increases significantly while gp is precisely unable to cope with the computational and memory requirements of large amounts of data liu et al 2019 thus we employ a sparse approximation of the gp which is also given in this subsection and the gradient enhanced version of the gp will be given in the next subsection regression is often formulated as follows predicting a scalar output θ relative to a d dimensional input x given a training set d x i θ i i 1 2 n with n pairs of input output mappings quinonero candela et al 2007 in general the output θ i can be thought of as being produced by a latent function g x corrupted by white noise ξ with variance σ noise 8 θ i g x i ξ i w h e r e ξ i n 0 σ noise 2 where σ noise is the observation error variance mentioned above σ noise 2 r the gp for inferring g x above is completely specified by a mean function m x and a covariance function k x x in this study we employ the widely used zero mean function m x 0 and isotropic squared exponential covariance function k x x 9 k x x σ 2 exp 1 2 l 2 x x x x t where σ 2 controls the prior variance and l is a length scale parameter that controls the rate of decay of the covariance all the hyperparameters involved in the above formula are represented by ϕ i e ϕ σ l which are generally inferred using the training data d that is learning by maximizing evidence or marginal likelihood rasmussen 2003 10 log p θ x ϕ 1 2 log σ n oise 2 i n 1 2 θ μ σ n oise 2 i n 1 θ μ n 2 log 2 π where μ is the prior mean vector i n is the identity matrix represents the covariance matrix of θ whose i th row and j th column element is calculated by ij k x i x j when there is a new input x for obtaining the predicted distribution p θ x d ϕ the prior joint distribution of the training and testing targets is expressed as follows 11 θ θ n μ μ σ σ noise 2 i n σ σ t σ where μ is the mean of θ σ is the covariance matrix between θ and θ with σ ij k x i x j and σ is the prior covariance of θ with σ ij k x i x j the posterior distribution can finally be obtained by conditioning the observed training outputs according to the bayesian inference box and tiao 2011 12 p θ x d ϕ n θ σ 2 where θ μ σ t σ σ n o i s e 2 i n 1 θ μ σ 2 σ σ t σ σ n o i s e 2 i n 1 σ where θ and σ 2 are the final posterior mean and variance respectively other symbols have the same implication as above a practical dilemma of the gp is that in the implementation to a training case of size n the computational and storage demands scale as o n 3 and o n 2 williams and rasmussen 2006 numerous sparse approximation methods for the gp based on the nyström approximation williams and seeger 2000 have been proposed which generate the latent inducing variable g m similar to the g above via introducing m inducing points in this paper variational free energy vfe titsias 2009 is adopted to reduce the computational and memory requirements to o n m 2 and o n m where m is much smaller than n vfe is a global posterior approximation method i e approximating inference but preserving the exact prior given a nyström notation q ab k am k mm 1 k mb the posterior p g g m θ will be approximated by minimizing the discrepancy between the free variational distribution q g g m θ and the posterior defined by the kullback leibler kl divergence 13 kl q g g m θ p g g m θ q g g m θ log q g g m θ p g g m θ d g d g m log p θ f q log p θ for a fixed log p θ minimizing the above eq 13 is equivalent to maximizing f q which is called the variational free energy by using calculus of variations the final bound of the vfe is defined as 14 f vfe 1 2 log q nn σ noise 2 i n 1 2 θ μ q nn σ noise 2 i n 1 θ μ n 2 log 2 π 1 2 σ noise 2 t r k nn q nn where tr denotes the trace of the matrix here we only present a brief introduction to the vfe more details can be found in liu et al 2019 and titsias 2009 in this study the implementation of the gp is based on the gpml matlab toolbox http www gaussianprocess org gpml code matlab doc 2 2 3 the spatially gradient enhanced gaussian process a direct gradient enhanced scheme forrester and keane 2009 han et al 2013 is used where the gradient information is embodied in the form of the augmented covariance matrix i e σ in subsection 2 2 2 if all n training outputs perform gradient enhancement on all d dimensional inputs the size of the output θ will be expanded from n in subsection 2 2 2 to n d 1 n n d this paper only considers the spatial gradient that is taking the partial derivative of the dimension that represents the spatial position in the input is needed thus the size of output is 2 n 15 θ θ 1 θ 2 θ n θ 1 x i θ 2 x i θ n x i t r n 1 1 where the subscript i represents the dimensional position of the observation depth in the input x correspondingly the size of the correlation matrix σ is also expanded from n n to 2 n 2 n where in addition to the correlation between the data itself the matrix also includes the correlation between the data and the gradients and between the gradients themselves wang et al 2021 defining the covariance gradient enhanced matrix as σ new then 16 σ new σ k x 1 x 1 x i k x 1 x 2 x i k x 1 x n x i k x 1 x 1 x i 2 k x 1 x 1 x i 2 2 k x 1 x 2 x i 2 2 k x 1 x n x i 2 k x 2 x 1 x i 2 k x 2 x 1 x i 2 2 k x 2 x 2 x i 2 2 k x 2 x n x i 2 k x n x 1 x i 2 k x n x 1 x i 2 2 k x n x 2 x i 2 2 k x n x n x i 2 in addition to the above covariance matrix the only difference between the spatially gradient enhanced and the regular gp is the predictor which is derived as follows 17 θ μ σ new t σ new σ noise 2 i n 1 θ 1 μ where 18 σ new k x 1 x k x 2 x k x n x k x 1 x x i k x 2 x x i k x n x x i t 19 1 1 1 1 0 0 0 where n ones are followed by n zeros 2 2 4 the framework of the physics constrained data driven model this subsection briefly describes the procedure of how to dynamically incorporate physical model simulations into the gpr based data driven framework as physics constraints the core of this idea lies in the weighted fusion of physics based and gpr based soil moisture simulations according to the prediction reliability reflected in the prediction uncertainty the flowchart of the hybrid framework is illustrated in fig 1 and the narrative description is shown in fig 2 the physical model data driven model and total time steps of the training period are defined as m gp m physics and k respectively then the soil water content fusion prediction is determined by the following product rule 20 p θ new p θ m gp p θ m physics the implicit assumption is that the ensemble prediction of the physical model fits a gaussian distribution hence 21 e θ new var θ new θ physics σ physics 2 θ gp σ gp 2 22 var θ new σ physics 2 σ gp 2 1 in the above eq 21 and eq 22 the weights of the physical and data driven models are w physics σ physics 2 σ physics 2 σ gp 2 and w gp σ gp 2 σ physics 2 σ gp 2 respectively which means that the model with large uncertainty about the predictions will automatically be given a smaller weight notably the outcome after automatic fusion is used as the input for the gpr model s next prediction time step which is dynamically executed accordingly the inspiration of this strategy comes from chen and ren 2009 but their purpose is to implement bagging applications to multiple pure gaussian processes 3 data descriptions and model setup 3 1 data source and site description to fully verify the performance of the proposed physics constraint scheme this study selects five sites with different soil properties and climate characteristics from the uscrn u s climate reference network https www ncei noaa gov access crn to build and validate the model which includes mercury 36 62 n 116 02 w las cruces 32 61 n 106 74 w goodwell 36 59 n 101 59 w gadsden 34 28 n 85 96 w and asheville 13 s 35 41 n 82 55 w hereafter referred to as asheville bell et al 2013 diamond et al 2013 these five stations basically cover the united states from west to east and their spatial locations are depicted in fig 3 the above five stations all use hydra probe ii soil sensor model sdi 12 to measure the soil moisture at depths of 0 05 m 0 10 m 0 20 m 0 50 m and 1 00 m the uscrn provides detailed soil property information at each depth of the site ftp ftp atdd noaa gov pub wilson and we roughly stratify the soil accordingly the properties of each layer seen in table 1 are obtained by averaging the relevant depths 3 2 data preprocessing this study selects the uscrn day scale dataset which includes the air temperature rainfall radiation humidity and soil water content etc to ensure the reliability of the dataset we screened the original data by considering the adverse effects of the inconsistency of snowfall and snowmelt time and the soil icing on the simulation the time nodes with excessively negative air and soil temperatures were excluded additionally we removed periods with continuously missing meteorological and soil monitoring data and guaranteed data integrity for two consecutive days finally the data of the above sites from 1 january 2011 to 31 december 2018 were selected to construct the dataset for a total of eight years of which the first six years served as the training set for the data driven model and also used to calibrate the physical model the final two years were used to test the proposed hybrid paradigm the precipitation and reference evapotranspiration time series of the five stations are presented in fig 4 3 3 model setup 3 3 1 physical model and enkf setups the soil stratification is determined by the physical properties of the soil profile see table 1 to avoid the influence of the unknown lower boundary the depth of the soil profile is extended to 150 cm and uniformly discretized into 66 nodes with 1 cm intervals for the top 10 cm 2 cm intervals for the middle 90 cm and 5 cm intervals for the lower 50 cm zhang et al 2019b as stated in eqs 2 3 there are five physical parameters required by the van genuchten muelem model of which the values of θ r and θ s are set according to the soil water observations the other three parameters expressed as m α n k s are assumed to follow the logarithmic normal distribution the prior mean is obtained based on the neural network of rosetta lite schaap et al 2001 and the prior variance is estimated by referring to carsel and parrish 1988 the initialization distribution of the parameters is shown in table 2 the upper and lower boundaries of the physical model are set as the atmospheric boundary and the free drainage boundary respectively the average daily reference evapotranspiration shown in fig 4 is calculated using the penman monteith equation allen et al 1998 and assuming that the potential evapotranspiration is equal to the reference evapotranspiration according to the field data from the uscrn the vegetation at these sites is mostly grassland so the root depth is deliberately assumed to be consistently 30 cm as mentioned earlier the enkf is integrated with the physical model for model error evaluation in this study the ensemble size is set to 500 and the soil moisture measurement error is set to 0 02 cm3 cm3 according to the technical specifications of the sensor furthermore in our real case the ensemble simulation is prone to collapse due to excessive parameter updates that are caused by the interference of the model error thus we adopted a damping factor of 0 3 as suggested by erdal et al 2014 applying on the kalman gain k k to limit parameter updates this setup works very well for our practice as seen from the above set conditions the physical model inevitably introduces various rough assumptions in practical applications including boundary conditions vegetation information and soil properties which will undoubtedly affect the final simulation accuracy 3 3 2 gaussian process model setups the hierarchical gpr model predicts the swc of the i th layer i 1 5 on the t day by considering the water content of the t 1 day and the meteorological data of the day i e inpu t i t we a t θ i t 1 in the training period the water content profile is time continuous and known while in the prediction period the previous day s water content θ t 1 in the input is obtained by the model prediction except for the soil water content on the first day as the initial condition rainfall average air temperature relative humidity and solar radiation are used as meteorological inputs to the gpr model to be as consistent as possible with the pbm compared with the hierarchical prediction model the input of the spatially unified model will add the observation depth i e inpu t t we a t θ t 1 z i and the output will correspondingly include the spatial gradient information specifically the vertical spatial gradient value g i of the i th layer is calculated as follows wang et al 2021 23 g i θ i 1 θ i z i 1 z i i 1 θ i θ i 1 z i z i 1 i 5 θ i 1 θ i 1 z i 1 z i 1 else in addition given the lagged effect of rainfall infiltration and the strong correlation between the soil moisture dynamics and rainfall we will use the accumulated precipitation for the historical 4 days including the day as input and the impact of cumulative rainfall days will be briefly discussed later the data of winter soil freezing or snowfall for some sites were excluded during data preprocessing hence the two year prediction period of all five sites will be projected separately for uniformity as will the physical model notably all inputs to the data driven model are normalized to 0 1 to eliminate the effects of data magnitude 3 3 3 performance metrics setup in this work the performance of different models is evaluated mainly by using the coefficient of determination r2 the time averaged root mean square error rmse and the mean absolute relative error mare between the estimated and observed soil moisture in addition the nash sutcliffe efficiency nse nash and sutcliffe 1970 the mean absolute error mae and the absolute values of bias are used as auxiliary metrics mare nse and the absolute values of bias are defined as follows 24 mare 1 n t k 1 n t θ k obs θ k est θ k obs 25 nse 1 k 1 n t θ k obs θ k est 2 k 1 n t θ k obs θ obs 2 26 b i a s k θ k obs θ k est where θ k obs and θ k est represent the observed and estimated soil moisture values at time k respectively θ obs is the time averaged observed soil moisture at all time points and n t is the total prediction time step 3 4 summary of the model design as mentioned earlier we implement the process based physical model and use the ross method as a solver simultaneously we hierarchically establish a purely gpr based data driven model and further introduce the implicit constraint gradient information contained in the observation data to construct a spatially unified gradient enhanced gpr model more meaningfully a feasible physics constraint scheme is proposed with considering the model uncertainty a summary of the model design is displayed in table 3 through a series of comparative analyses of the model performance we attempt to elucidate the distinctions between the physical model and gpr methods that incorporate different forms of physical constraints in soil moisture simulation as well as the larger utility of conventional model simulation as a constraint in data science 4 results and discussion 4 1 comparison of the pbm phy ross and the purely data driven method p gp we first examine the performance differences between the traditional physical model and the purely gpr based method corresponding to phy ross and p gp respectively at the five sites with different soil moisture flow and meteorological characteristics fig 5 shows the coefficient of determination between the observed and estimated soil moisture from the two models during the prediction period for comparison the resulting time averaged rmse values for all five models are shown in table 4 table s1 and s2 also depict the results for nse and mae fig 5 and table 4 indicate that the p gp generally outperforms the phy ross and the superiority of the data driven model becomes more obvious as the simulation depth increases at the vast majority of sites and depths the p gp leads to a lower rmse and a higher r 2 with the exception of the superficial layer of las cruses z 0 05 m although the p gp has a lower r 2 at z 0 50 m its rmse is reduced from 0 0179 to 0 0097 in contrast to the phy ross and deep layers of mercury z 0 50 m 1 00 m specifically as shown in fig 6 d the time series of the surface swc predicted at las cruses is quite unstable with multiple abnormal jumps as highlighted in the purple dashed rectangle this phenomenon might be explained by the fact that the site belongs to an arid region average annual rainfall of approximately 200 mm with intense but infrequent alternation of wetting and drying on the surface rainfall as a major driver of soil moisture movement has large inter annual and intra annual variability fig 4 b especially during the forecast period when its intensity is significantly higher than that in the past six years which makes the training set unable to contain enough valid scenarios for example an extreme precipitation event occurred on october 23 2018 with a single day rainfall of 48 6 mm and considering the historical maximum single day rainfall of less than 30 mm the p gp unsurprisingly shows a large deviation which also directly leads to the failure of the subsequent simulations the main reason for the poor performance of the p gp in the deep layer of mercury is due to the soil texture as presented in table 2 although the soil profile of mercury is uniform the sand content is as high as 76 18 indicating extremely poor soil water retention properties for the data itself a rich scenario diversity implies a larger range and magnitude of data variation zook et al 2012 however the maximum value of the deep swc observations is less than 0 08 cm3 cm3 and the fluctuation range is less than 0 04 cm3 cm3 compared with the surface of mercury fig 6 a c which greatly limits the predictive power of the p gp in addition the p gp achieves a more obvious advantage in the deep layer s prediction see fig 6 i 6 l 6o which is related to our strategy of hierarchically building a data driving model that is the hysteresis effect of the soil profile will be alleviated by directly establishing the mapping relationship for the phy ross its performance is mediocre but relatively robust except at z 0 50 m 1 00 m for the goodwill that almost collapses fig 6 h 6i we notice that the soil stratification at goodwell is clear and the lower layer is more viscous table 2 which is reflected in the consistent trend of swc at z 0 05 m 0 10 m 0 20 m moreover the swc variability in the deep layers seems to be irregular with overall drastic changes and higher peak values through further analysis we find that the site is likely to exhibit a preferential flow phenomenon allaire et al 2009 taking the rainfall event from october 6 2018 to october 9 2018 as an example the total rainfall on these four days is 110 6 mm if the 100 cm soil profile is stratified according to the principle of centering the observation nodes the thicknesses of the five layers are 7 5 cm 7 5 cm 20 cm 40 cm and 25 cm respectively and the swc variation amplitudes of each layer are 0 308 cm3 cm3 0 236 cm3 cm3 0 267 cm3 cm3 0 306 cm3 cm3 and 0 248 cm3 cm3 respectively the total water volume of the soil profile increased by 278 6 mm before and after precipitation which is significantly larger than the actual rainfall 110 6 mm indicating that the precipitation may preferentially reach 50 cm and 100 cm along the macrospore channels furthermore the phy ross generally overestimated the surface swc and underestimated the bottom such as the gadsden and las cruses see fig 6 d 6j 6l which may stem from improper assumptions about the root system and boundary settings the above analysis enlightens us that in the one dimensional model based on the assumption of uniform flow the most fundamental water balance may be difficult to guarantee due to the simplified representations or omission of the model structures and processes in this case additional errors are likely to be introduced if the single phase richard s equation is incorporated directly into the data driven model overall in real soil moisture simulations the performance of a purely data driven model is highly dependent on the richness of the historical scenario diversity the physical model is more robust but it is risky once faced with serious structural errors no matter whether it is directly applied or as a physics constraint even the water balance constraint these results suggest the necessity of developing a hybrid model based on the assessment of model uncertainty 4 2 using physical constraints to improve the robustness of the data driven model the above real cases have demonstrated the potential collapse of the pbm and the purely gp based data driven method in the presence of unknown structural errors and insufficient historical scenarios respectively in this section we integrate physical model simulations as constraints into the p gp and ge gp to investigate whether the hybrid paradigm can combine their respective advantages of high robustness and accurate capture of data characteristics to obtain a boost by weighing the uncertainties 4 2 1 the phy ross vs the p gp vs the pc p gp fig 5 and fig s1 present the coefficient of determination and absolute value of bias between the estimated and observed swc from the phy ross p gp and pc p gp respectively table 5 shows the mare values for all five models simultaneously these results show that by introducing physical constraints the soil moisture dynamics estimation of the data driven method improved with a significant reduction in biases and larger r 2 except in the deep layers of goodwell z 0 50 m 1 00 m it is noted that this significant improvement in estimating the swc has also shown considerable robustness our hybrid scheme maintains the advantage for depths where the purely gp based method has achieved fairly good results such as at the gadsden asheville surface layers of mercury goodwell and at z 0 10 0 20 0 50 1 00 m of las cruces fig 7 a c take some typical depths as an example to further present the time series of swc achieved by the p gp and pc p gp models in these locations the pbm simulations act as auxiliary constraints to correct the few triggered unreliable extrapolations as highlighted in the purple dashed rectangle in fig 7 a and 7b while maintaining the strong predictive power of the p gp which results in a more accurate prediction on the other hand at z 0 05 m of las cruses and z 0 50 m 1 00 m of mercury where the purely gp based model mentioned above has a large deviation the simulation accuracy is improved after adding physics constraints even surpassing the phy ross and achieving the best results among the three models see the first and second columns of fig s1 fig 5 a b the temporal evolution of las cruces at z 0 05 m is presented in fig 7 d the abovementioned anomalous jumps of the p gp are shown to be perfectly avoided and compared to fig 6 d the problem of overestimating the surface swc caused by the improper assumptions in the pbm building process has also been corrected the accurate quantification of the prediction uncertainties is the key reason why our proposed physics constrained gpr model can fully exploit the respective advantages of the pbm and gp based model fig 8 presents the predicted variance for several representative depths that correspond to fig 7 the following observations are determined 1 the prediction variance of the p gp is much smaller than that of the phy ross at the depths where it has achieved an evident superiority fig 8 b and c which implies that the constraint scheme will give extremely high weight to the data driven model furthermore at a few unstable time points for the p gp e g day 376 at z 0 05 m at mercury shown by the purple dashed box in fig 7 b the estimated variance unsurprisingly peaks as high as 0 00162 not fully displayed in fig 8 b due to coordinate scaling and hence the hybrid method will rely largely on the pbm to obtain a satisfactory result 2 similar prediction variances are achieved at depths where the two models perform almost equally well e g at gadsden site see fig 7 a but the asynchronous fluctuations of the variance play a good role in restricting each other fig 8 a 3 at las cruces with poor p gp performance the unreasonable jumps of the p gp prediction and the peak fluctuations of the variance are highly synchronized compare fig 7 d and fig 8 d and it is at these time points that the hybrid framework effectively improves the robustness of the purely data driven method by introducing physical model simulations with less uncertainty overall the predicted variance of the physics constrained gpr model is the smallest implying the most reliable simulation results unfortunately at the deep layers of goodwell z 0 50 m 1 00 m even though our implicit physics constrained scheme has given an absolute reliance on the p gp referring to fig 8 e for the predicted variance the extremely deteriorated pbm still restricts the potential of the hybrid model and ultimately fails to optimize the data driven model fig 7 e this result further suggests that we should be more cautious about the introduction of physical constraints in complex real world problems 4 2 2 the phy ross vs the ge gp vs the pc ge gp one of the main purposes of our implementation of the ge gp is to test whether the proposed hybrid notion can adapt to different data driven modeling strategies i e the universality of the framework fig 9 and fig s2 present the coefficient of determination between the predicted and observed soil moisture at all five sites and the corresponding spatial temporal patterns of absolute values of soil moisture bias using the phy ross ge gp and pc ge gp respectively although the ge gp is quite different from p gp in modeling details it shows similar results to fig 5 and fig s1 in that a robust improvement is also achieved by introducing the same physical model simulations as constraints this result demonstrates the generality of this preliminary hybrid paradigm in assisting the reconstruction of soil moisture dynamics and its potential to be applied to other research questions 4 3 comparison of physics constraints in different forms as mentioned earlier we implement a spatially gradient enhanced version of the purely gp based model to build a spatially unified model the vertical gradient can essentially be interpreted as a physical boundary constraint excavated directly from the data itself which represents the driving force of rainfall infiltration compared with the proposed hybrid model that introduces physical model simulations as constraints a thought provoking question arises what is the difference in the performance of the constraint scheme mined from data itself ge gp or from the physical model pc p gp does stacking the two give better outcomes pc ge gp as shown in fig 5 fig 9 and especially the rmses in table 4 the ge gp has improved the estimation accuracy of the surface swc in contrast to the p gp for example the coefficient of determination of the ge gp r 2 0 827 even exceeds that of the pc p gp r 2 0 820 at z 0 05 m of las cruces however the gradient enhanced p gp generally deteriorates the deep estimation which is in line with the findings by wang et al 2021 there are two main reasons for this phenomenon the first is that compared with the hierarchically established p gp the unified ge gp constructed by directly adding position information to the input will unsurprisingly further weaken the bottom swc s feeble response to the upper boundary the second reason is that due to soil heterogeneity the variations in the swc in the surface and deep layers are not consistent and the fusion of the drastically varying surface gradients will disrupt the temporal evolution of the deep swc this result indicates that although mining physical knowledge from data and applying it to a data driven method is an appealing notion and it is even feasible to derive governing equation from the observations ghorbani et al 2021 the complexity of practical issues poses more challenges to its performance compared to introducing the constraints from an existing physical model furthermore since the performance of the proposed hybrid method is affected by the predictive capability of the data driven model itself the pc ge gp does not achieve a significant advantage over the pc gp 4 4 further discussion on the possibility of model performance optimization we recall that the vfe algorithm is used to execute a sparse approximation gpr in the ge gp and pc ge gp to circumvent the computational load problem caused by the rising data volume of the spatially unified model when we apply this sparse approximation algorithm to the hierarchical models p gp and pc p gp denoted as p gps and pc p gps a surprising improvement in the model performance is achieved while improving the computational efficiency at the gadsden site for example the cpu times spent for the p gp and pc p gp are approximately 15 min on a 2 40 ghz intel xeon e5 2630 cpu and 64 gb ram pc platform the ge gp and pc ge gp take about 14 min the p gps and pc p gps take about 1 min as shown in fig 10 only three representative sites are presented the r 2 of the p gps has been significantly improved in contrast to the p gp especially for soil surfaces where the p gp are vulnerable to the limitations of inadequate historical scenarios moreover our physics constrained scheme pc p gps still shows considerable robustness a variational gaussian process that performs approximate inference has been proven to be equivalent to a deep gaussian process dgp with one layer svendsen et al 2020 the dgp is a cascade of gp analogous to the structure of deep neural networks damianou 2015 and this stacked hierarchical composition helps to capture complex patterns from data while automatically quantifying uncertainty and may outperform neural networks in certain scenarios camps valls et al 2011 this explains why the performance of the p gp in fig 10 improves after implementing sparse approximation and suggests that in our real world case even for these sites with insufficient historical scenarios the profound worth inherent in the input data is not fully revealed it is also noteworthy that given the strong scalability of our hybrid paradigm i e similar to the dgp other data driven methods that can assess prediction uncertainty and have stronger data fitting capabilities e g lstm fang et al 2020 could potentially substitute the gpr model here to achieve superior hybrid performance soil moisture simulation around the dgp and other neural networks capable of evaluating uncertainty and their physical constraint mechanisms will be investigated in future studies moreover cumulative 4 day rainfall rather than single day average rainfall is employed as a data driven model input in our modeling strategy which helps to alleviate the hysteretic response of deep swc to precipitation fig 11 takes gadsden as an example to further demonstrate the impact of accumulated days of rainfall on the p gp model s performance the rainfall input with more cumulative days is more advantageous for estimating deeper swc which is in line with our intuitive cognition this simple example aims to demonstrate that it still seems necessary to consider the effect of the soil structure e g spatial heterogeneity in real soil moisture data driven modeling rather than merely establishing a mapping link between meteorology and swc and hierarchical or categorical modeling based on soil properties seems to be feasible 5 conclusions in this study a physics constrained gpr scheme is proposed for the reconstruction of real world soil moisture dynamics where physical model simulations are dynamically weighted and fused into the gp based data driven forecasting framework based on the accurate quantification of model uncertainties this hybrid model is expected to cleverly exploit the complementary advantages of the two conventional modeling paradigms for more reliable swc estimates to fully verify the universality of the proposed constraint scheme and further understand the differences in the enhancement of model performance by physics constraint forms a spatially gradient enhanced gp is also constructed through comparative analysis the following conclusions can be drawn 1 the overall performance of the gp based model is better than that of the physics based model in soil moisture profile retrieval however in our real cases both show evident limitations the data driven model is strongly reliant on the richness of the historical scenario diversity with varying meteorological circumstances e g extreme rainfall and differences in the soil texture challenge its robustness the physical model is relatively stable but the unknown soil structure may even make maintaining the most basic water balance impossible warning against sufficient caution in developing physics constraint schemes in real world applications 2 by evaluating the reliability of the prediction outcomes of both process based and gp based models the proposed weighted constraint paradigm properly integrates their respective advantages of robustness and flexibly capturing data trends meanwhile the generalizability of the hybrid approach is demonstrated by applying it to different modeling strategies hierarchical and spatially unified and sites with varying climatic conditions 3 although mining physical constraints e g gradient information from data is tempting it is still challenging for complex practical problems e g the effect of soil heterogeneity in contrast to introducing constraints from mature physical model systems adopting more expressive deep gaussian process and other neural networks that can quantify predictive uncertainty to model and taking the soil structure into account may assist in further improving the suggested hybrid scheme credit authorship contribution statement leilei he conceptualization methodology software writing original draft qiuru zhang conceptualization software writing review editing liangsheng shi writing review editing supervision yakun wang methodology lijun wang supervision xiaolong hu writing review editing yuanyuan zha data curation methodology kai huang data curation declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this work was supported by the national key research and development program of china 2021yfc3201203 the open research fund of guangxi key laboratory of water engineering materials and structures grant gxhri wems 2020 06 and the national natural science foundation of china grants 51979200 and 52179038 appendix a supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 128779 appendix a supplementary data the following are the supplementary data to this article supplementary data 1 
2574,operating rules play an important role in enhancing the water utilization of reservoirs previous studies on hedging investigated the operating rules between water release r and available water aw based on minimizing the normalized shortage index and applied the rules to optimization however seldom considered a realistic economic objective function to form a more general supply demand relationship to address this issue this study formulated a theoretical function by a two period reservoir operation model with the goal of minimizing the sum of economic loss from the current release and carryover storage targets the derived function that guides the water supply was numerically validated to obtain the optimal time varying hedging rules by non dominated sorting genetic algorithm ⅱ the water supply system of dongwushi reservoir in hebei province china was selected as a case study the results show that 1 the derived function depicts the relationship between r aw ratio and d aw ratio which is consistent with the budyko supply demand framework 2 the optimized results using the derived budyko hedging function outperform those using two point hedging rule tph and standard operating policy sop 3 the derived function depicts a general non linear supply demand relationship rather than the linear one contained in commonly used tph the derived function could be used for varied demands indicating broader applications than tph keywords reservoir operations hedging rules budyko framework water supply supply demand relationship data availability data will be made available on request 1 introduction water resources are indispensable for economy and society s long term development rapid population growth as well as the sustainable development of agriculture and industry has resulted in a rise in demand for water potentially putting additional pressure on the long term usage and conservation of water resources ahmadianfar and zamani 2020 vörösmarty 2000 to provide stable water supplies for domestic agricultural and industrial uses fluctuating streamflow needs to be regulated gong et al 2022 li et al 2022 shiau 2009 however prolonged droughts may cause water supply systems to be inadequate to meet preestablished demands this is considered a normal part of climate variability and its occurrence is inevitable chanda and maity 2017 guo et al 2013 yang et al 2022 yuan et al 2018 during the period 1950 2008 the global proportion of arid areas increased considerably dai 2010 gerken et al 2018 yuan et al 2019 reservoirs play an important role in the sustainable management of water resources by altering the temporal and spatial distribution of runoff operating rules are crucial in enhancing the water utilization of reservoirs since the 1960s a series of release available water aw operating rules have been proposed lund and guzman 1999 tan et al 2017 these include pack rule maass 1962 space rule bower et al 1966 standard operating policy sop hashimoto et al 1982 loucks et al 1981 maass 1962 linear decision rule revelle 1969 joeres 1981 and hedging rule hr bayazit and ünal 1990 hu et al 2016 srinivasan and philipose 1996 the sop is introduced as the simplest rule for reservoir operation bayazit and ünal 1990 water demand is fully satisfied when aw is less than the demand water that exceeds the desired volume is kept in the reservoir until the capacity is full at which point it begins to spill to avoid severe shortages in the future it would be better to adopt hr which accepts current slight deficits with effective use of the existing infrastructure previous studies on hedging have focused on two issues 1 when to hedge and 2 how to hedge draper and lund 2004 derived two period theoretical optimal hedging rules for various value functions you and cai 2008 introduced inflow uncertainty and zhao et al 2011 discussed the effects of constraints on optimality conditions of a two stage reservoir operation problem these researches imply that hr is the optimal operating policy when the marginal utility of next period release is more than that of the current supply a variety of studies obtained the parameters of hr using mathematical programming models shih and revelle 1994 tu et al 2008 simulation models bayazit and ünal 1990 srinivasan and philipose 1996 or simulation optimization models hu et al 2016 ji et al 2016 shiau 2009 taghian et al 2014 these studies investigated the operating rules between water release r and aw based on minimizing the normalized shortage index shiau 2011 when the water demand d was fixed seldom considered a realistic economic objective function which can form a general supply demand relationship in general water demand drives reservoir supply while actual available water limits supply as well sankarasubramanian et al 2020 evolved budyko s framework for the natural and human altered watersheds the budyko framework was primarily used to estimate the actual hydroclimatic variable e g evapotranspiration given the available demand and supply mass or energy e g potential evapotranspiration and precipitation respectively for example wang et al 2015 formulated a budyko function by solving the equation derived from the proportionality hypothesis and maximum entropy production theory this supply demand actual budyko framework could be extended to the reservoir operation in this view aw water demand and water release could be rewritten as supply demand and actual respectively previous actual supply r aw relationship turned into actual to supply ratio demand to supply ratio r aw d aw the sop gives the asymptote and the upper bound given that this framework is non dimensional it provides a new perspective to deal with reservoir operation and hedging problems however few studies have derived a functional form for the hedging policy using the budyko supply demand framework thus the main objectives of this study were 1 to theoretically derive a function of hedging rules and interpret it with the budyko supply demand framework 2 to test the performance of the function through a case study and 3 to investigate the differences between the derived function and commonly used hedging rules the overall structure of the study takes the form of the remaining five chapters including methodology in section 2 the case study in section 3 results in section 4 discussions in section 5 and finally conclusions in section 6 2 methodology the structure of the methodology in this study is illustrated in fig 1 2 1 hedging rule under the budyko supply demand framework the hedging function is constructed for a water supply system with two types of demands the basic demand and general demand the basic demand could be domestic industrial water demand environmental flow or shipping flow demand this kind of demand is considered as crucial and should be satisfied first the basic demand will be fully satisfied unless the available water is limited the general demand usually corresponds to a quantifiable benefit which has a diminishing marginal benefit or increasing marginal loss function unlike the loss function of the normalized shortage index in shiau 2011 economic loss of the shortage is used as the loss function in this study which is a more realistic economic indicator the loss function of the water release at the current period can be assumed as follows 1 b r t w b max s m m 1 where b is the loss function rt is the water release not including the spill of the reservoir at time t w is the weighting factor assigned to the loss function of release target 0 w 1 bmax is the maximum economic loss of water supply deficit s is the shortage ratio of the water supply system 0 s 1 m is an exponent to describe the shape of the loss function m should exceed 1 to formulate a convex function b rt reaches the maximum value when s 1 as mentioned above the shortage of basic demand is disastrous and unquantifiable whose economic loss is not considered in the loss function the maximum economic loss bmax can be regarded as the value of water demand excluding basic demand dt dm to include the value per unit of water at the current period bmax is calculated as the average price plus water demand volume p1 dt dm as a result the loss function eq 1 can be written as 2 b r t w b max d t r t d t d m m w p 1 d t d m d t r t d t d m m d m r d m 1 where rt is the water release not including the spill of the reservoir at time t dt is the water demand for the water supply system at time t dm is the basic demand p1 is the average price per unit of water demand here the maximum economic loss is represented by the product of the average price p1 and water demand volume dt dm eqs 1 and 2 could be verified using the data of zhang et al 2013 which investigated the relationship between the irrigation benefit and water supply volume in a case study details in supplementary material 1 draper and lund 2004 suggested that a convex economic loss function concave benefit function is generally formulated due to water supplying institutions and consumers typically the benefit function is concave with the marginal benefits usually decreasing with the increasing use eqs 1 and 2 are such convex economic loss functions as water release rt increases the economic loss b rt decreases i e the first order derivative of economic loss b rt 0 meanwhile the first order derivative of economic loss b rt increases i e the second order derivative of economic loss b rt 0 similarly the loss function of the water stored in the reservoir st 1 due to deviation from the desired carryover target s t 1 t at time t can be assumed as follows shiau 2011 3 c s t 1 1 w p 2 s t 1 t s t 1 t s t 1 s t 1 t m s t 1 t s max 4 c s t 1 1 w p 2 a w t d m a w t d m s t 1 a w t d m m a w t s max d m where p2 is the average price of per unit carryover target deficit s t 1 t is the desired carryover storage target at time t which can be a desired operational level or the reservoir maximum storage i e capacity smax s t 1 t smax st 1 is the water stored in the reservoir at the beginning of time t 1 awt dm denotes the maximum carryover target that can be dominated at time t this problem of reservoir operation can be solved by a two period model for it only takes periods t and t 1 into consideration the objective function is to minimize the sum of economic loss b rt and c st 1 which can be written as follows 5 min z b r t c s t 1 s t a w t r t s t 1 a w t s max d m d m r d 0 s t 1 a w t this two period problem can be solved by the lagrange multiplier method as suggested by draper and lund 2004 the lagrangian for this problem is 6 l b r t c s t 1 λ a w t r t s t 1 where l is the lagrange function and λ is the lagrange multiplier the first order conditions of the problem are 7 l r t b r t r t λ 0 l s t 1 c s t 1 s t 1 λ 0 l λ a w t r t s t 1 0 based on eq 7 the relationship between variables can be written as 8 r d t r t d t d m a w t d m s t 1 a w t d m where r w p 1 1 w p 2 1 m 1 r is the ratio of price and weighting factor between current period and future which denotes the relative importance of current water release and that in the future using eq 5 and 8 the equation can be obtained as follows 9 r d t r t 1 ε d t r t ε d t a w t ε d t 10 r d t r t a w t ε d t 1 ε d t r t ε d t where ε is the ratio between dm and dt which is a parameter of the function from eq 10 the optimal hedging condition leads to the relationship as 11 when r 1 ε r t a w t r d t a w t ε 1 ε r d t a w t 2 1 ε ε r d t a w t r d t a w t 1 ε r t a w t 1 r t a w t 1 ε when r 1 ε r t a w t r d t a w t ε 1 ε r d t a w t 2 1 ε ε r d t a w t r d t a w t r 1 ε r r t a w t 1 d t a w t min r 1 ε r 1 ε ε and r are two parameters of the equation when r 1 the function can be simplified as 12 r t a w t d t a w t ε 2 d t a w t 2 1 2 ε d t a w t 1 d t a w t 1 ε r t a w t 1 d t a w t 1 ε the detailed derivation is shown in appendix b the derived hedging function curves are shown in fig 2 which reflects the relationships in eqs 11 and 12 a greater ε indicates a smaller interval to operate according to the value of current water release and that in the future r represents the relative value of water at two periods and a smaller r denotes that the water stored for the future leads to less economic loss than released at the current period consequently the curve e g light green and grey curves in fig 2b with greater r is closer to the asymptotes sop and vice versa as above based on minimizing the sum of economic loss at the current period and the future period this study obtains the relationship among water release water demand and available water and formulates it into hedging function as can be seen this derived function depicts the relationship between the supply ratio rt awt and demand ratio dt awt which is in line with the budyko supply demand framework the commonly used two point hedging rule tph reflects the relationship between rt and awt fig 3 a which is shown in appendix a based on the budyko supply demand framework the supply ratio rt awt and demand ratio dt awt can be briefly expressed as fig 3b 2 2 optimization model 2 2 1 objective functions for the water supply operation system in this study minimum economic loss is used as the objective function the objective function in the optimization model is as 13 min f t 1 t p 1 d t d m t d t r t d t d m t m where dt rt and dm t are the water demand water supply and basic demand at period t respectively the basic demand is typically considered as crucial and should be satisfied first however due to the continuous dryness the basic demand could not always be fully satisfied as a result the total deficit of basic demand needs to be considered in the optimization model the total deficit of basic demand is calculated as 14 g t 1 t d m t r t when r t d m t in the optimization awt will be primarily supplied for basic demand unless there is no extra available water the optimal solutions of the objective function 13 are computed at different levels of the total basic demand deficit 2 2 2 constraints the following constraints should be included in the model 1 water balance constraint 15 s t 1 s t q in t r t 2 water storage constraint 16 s dead s t 1 s max non flood season s dead s t 1 s flood flood season 3 water supply constraint 17 d m t r t d t w h e n a w t d m t 4 flow constraint 18 r t min r t r t max where sdead is the dead storage capacity sflood is the flood control storage capacity dm t is the basic demand at period t rt min and rt max are the upper and lower limits of water release of the reservoir at period t respectively 2 2 3 optimization procedure the reservoir storage state can be decided by the supply decision in a certain period which simultaneously affects the supply decision in the next period and eventually influences the overall periods in the reservoir operation ji et al 2016 to obtain a certain operation scheme with the minimum economic loss the parameters need to be optimized by the simulation and optimization models the steps are 1 randomly generating the parameters 2 calculating the objective function based on the long series operation process of the two period model as mentioned above 3 selecting the sets of parameters and adjusting parameters by the optimization algorithm 4 calculating the objective function of new parameters 5 repeating the steps above until the objective is satisfied here the dynamic programming dp is used to obtain the optimal operation trajectory if the data points of the best trajectory are clustered around a specific line or curve it will provide more possibility for optimization of the hedging rules non dominated sorting genetic algorithm ⅱ nsga ⅱ is used in the optimization of the hedging rules the parameters are starting water availability swa ending water availability ewa of eq a2 for tph and r ε of eq 11 for budyko hedging rule the parameters in the hedging rule are assumed to remain the same from year to year but vary among the 12 months in a year considering the variability of monthly demands and inflows 3 case study the study area is dongwushi reservoir located in cixian city hebei province of china fig 4 this area is in haihe river basin with a semi humid climate the main purpose of the dongwushi reservoir is the water supply for agricultural irrigation as well as the domestic and industrial use in handan city the reservoir is also used for flood control and hydropower generation in this study we don t consider hydropower generation the basic parameters of the reservoir are shown in table 1 where the flood season lasts from june to september zhang et al 2017 dongwushi reservoir irrigates a total area of 4 267 104 ha with a rotation of summer maize june to september and winter wheat september to june the annual irrigation water demand is 200 55 million m3 supplementary material 1 and the annual basic water demand domestic and industrial water demand is set as 120 00 million m3 according to data from the dongwushi reservoir management agency the monthly demand data is shown in fig 5 to investigate how the basic demands impact on hedging rules this study sets three schemes with the basic demands of 80 96 00 million m3 100 120 00 million m3 and 120 144 00 million m3 historical monthly inflow data of the dongwushi reservoir was gathered over 35 years from january 1980 to december 2014 to simulate the operation of the reservoir the data from 1980 to 2004 is used as a training set while the remaining from 2005 to 2014 was used to validate as shown in fig 6 the average annual inflow is 188 00 million m3 which is unevenly distributed in both intra annual and inter annual scales the annual average inflow is less than the two thirds of annual water demand in the region where the hedging policy is necessary table 2 in the case study p1 and m are obtained from the function fitting from the data in zhang et al 2013 which is discussed in supplementary material 1 the value of p1 in the objective function 13 is set as 3 4987 of which the unit is yuan m3 m is set as 1 5 4 results 4 1 the optimal operation trajectory of dp dp is a technique used when solving an optimization problem by decomposing it into several simpler subproblems by using dp the optimal solution with the best operation trajectory can be obtained by searching in the discretized state space feng et al 2020 zhang and liu 2021 in this study the objective is to minimize irrigation economic loss with the deficit of basic demand acting as a penalty function a series of optimal solutions can be obtained by setting various penalty weighing factors in real life the scheme with no deficit of the basic demand should be paid more attention the optimal operation data points under this scheme are drawn in the r aw coordinate fig 7 and r aw d aw fig 8 to detect the optimal operation rule except for the results from dec to feb the points in the r aw coordinate fig 7 do not converge around a line like that depicted in fig 3a this deviation indicates that the function under r aw coordinate is unable to adequately capture an appropriate relationship the conventional r aw relationship is not good for implementing the hedging strategy however the points in the r aw d aw framework indicate a general nonlinear relationship this gives the confidence to use the nonlinear function under the budyko framework to implement the hedging strategy 4 2 comparison among various operation rules fig 9 depicts the comparison of optimization results among various operation rules in the training period the budyko hedging function and tph optimization results are shown as irrigation economic loss at different levels of total basic demand deficit the orange star represents the result of sop while the purple star indicates the result of the one parameter budyko hedging function without optimization which merely uses the fixed parameter calculated by the ratio of actual basic demand and total demand data the budyko hedging function performs better than tph and much better than sop as seen in the fig 9 the irrigation economic loss is reduced by 1 3 about 100 300 million yuan utilizing the budyko hedging function with the same basic demand deficit when the irrigation economic loss is fixed the shortage of basic demand decreases by 4 30 the budyko function and tph produce comparable outcomes when the deficit of basic demand is great under this condition possible solutions can scatter across a broader area for both hedging functions the solution with no shortage of basic demand can be found by the budyko hedging function while tph is unable to this is due to the budyko hedging function s ability to provide a larger optimization space for searching solutions under this condition in practice the loss caused by a lack of basic demand is usually more severe than the irrigation loss which might lead to disastrous consequences as a result greater emphasis should be placed on the condition of no basic demand shortage the results of the various operation rules in the testing period are shown in table 1 the scheme corresponding to point b in fig 9 outperforms that of point d with reduced irrigation economic loss and deficit of basic demand point e and g provide comparable results the best scheme among a to d is dp point a whereas the worst among e to i is sop point i 4 3 results of various basic demand schemes fig 10 and fig 11 demonstrate the optimization results of various operation rules when basic demand increases and decreases by 20 similar to the findings presented in fig 9 the hedging function under the budyko framework performs better than tph and much better than sop in both schemes for schemes of increased basic demand the irrigation economic loss of the budyko hedging function is 2 4 about 200 400 million yuan less than tph with the same deficit of basic demand when the irrigation economic loss remains constant the shortage of basic demand decreases by 14 30 budyko hedging function can find the solution when there is no lack of basic demand whereas tph is unable to for schemes of decreased basic demand the irrigation economic loss of the budyko hedging function is 1 2 about 50 150 million yuan less than tph with a fixed deficit of basic demand solutions can be found using both the budyko hedging function and tph when there is no basic demand deficit in comparison to drought periods hedging policy is less significant in relative wet periods as stated previously there is an advantage to include the budyko hedging function rather than tph in reservoir operation especially for the drier scheme however this advantage appears limited in a wet period since the optimization space of such a scheme is generally smaller 5 discussion 5 1 rationality of the supply demand relationship embodied in the operation functions as stated previously eqs a2 and 11 describe two operation functions under different frameworks eq a2 not included the overlaps with sop could be viewed as a simple linear function as 19 r t a a w t b where a is the slope of the line and b is the intercept then the function can be transformed as 20 r t a w t a b 1 a w t let b 1 b d the function can be written as follows 21 r t a w t b 1 d a w t a it can be noticed that the tph function eq 20 is a straight line under the budyko framework shown as line ac in fig 12 however the relationship behind this straight line is not reasonable the slope of the line is constant that is the supply ratio will rise at the same rate as the demand ratio increases in fact when the demand ratio is low most of the demand should be satisfied as the demand ratio increases the growth rate of the supply ratio should gradually slow down until the demand ratio reaches a certain value the budyko hedging function consequently reflects such a general non linear relationship eq 11 is a function with the negative second order derivative supplementary material 3 shown as line od in fig 12 in summary a function with a declining marginal supply ratio supply ratio growth slows down as the demand ratio rises could be formulated using the convex benefit loss function eq 1 this general non linear supply demand relationship makes more sense than the linear one contained in commonly used tph now turn to the tph line shiau 2011 investigated another type of tph in which swa lies on the horizontal axis og in fig 3 a in this case none of the water will be released unless the aw reaches swa the supply ratio keeps zero unless the aw is greater than swa the supply demand relationship reflected in this type of tph is rather disappointing considering the possible effect this type of tph is also included in this study fig 13 in comparison to the previous fig 9 b and fig 10 b the solution of no basic demand deficit could be identified for tph however the tph still performs worse than the budyko hedging function when the other type is considered overall the budyko hedging function developed in this study with reasonable supply demand relationships outperforms the tph rules for various schemes 5 2 applicability of operation functions under varied demand conditions another interesting feature is the applicability of various operations functions under varying demand conditions as shown in eq a2 dt is a key component of the tph function which is assumed to remain constant in the same month of each year in the application of tph consequently the tph function could not be built when dt varies over time the budyko hedging framework however could still be applied when the basic demand total demand ratio dm dt remains constant or similar in the same month of each year this study also includes a scheme in which the irrigation demand and basic demand are expected to rise continuously from 1980 to 2004 the demand in 1980 is assumed to be 75 of the actual demand in the case study section 3 and the demand in 2005 is increased to 125 besides the demand for these years is assumed to rise linearly the budyko hedging function is utilized to operate under the varying demand condition as shown in fig 14 from the graph it can be detected that the budyko hedging function is better than sop and 7 14 worse than dp theoretical optimal scheme when the deficit of basic demand is 0 the minimal loss of irrigation benefit for the budyko function is 92 62 108 this loss is slightly smaller than that in the constant demand scheme fig 9 b one possible explanation for this is that in the varying demand scheme the inflow of later years with higher demand is greater than the inflow of earlier years with lower demand the requirement for hedging has been alleviated in this scheme this suggests that the budyko hedging function developed in this work has broader applications under varied demand conditions 6 conclusions this study developed a hedging function consistent with the budyko framework for water supply which is based on the objective function of minimum total economic loss the function was used to operate in the dongwushi reservoir from 1980 to 2014 compared to the commonly used two point hedging rule the following conclusions are obtained 1 a theoretical hedging function could be formulated by a two period reservoir operation model with the goal of minimizing the sum of economic loss from the current release and carryover storage targets the derived function depicts the relationship between r aw ratio and d aw ratio which is consistent with budyko supply demand framework 2 the optimized results of the derived budyko hedging function outperform those of tph and sop the irrigation economic loss is reduced by 1 3 about 100 300 million yuan utilizing the budyko hedging function with the same basic demand deficit when the irrigation economic loss is fixed the shortage of basic demand decreases by 4 30 for drought schemes the budyko hedging function can find the solution when there is no basic demand deficit whereas tph is unable to 3 based on the perspective of the supply demand framework and function curves the derived function depicts a general non linear supply demand relationship which is theoretically more rational than the linear one contained in the commonly used hedging rule the derived function could be used for varied demands indicating a broader application than tph in practice the formulated function could be applied in the optimization when the average price of water resources is estimated utilizing the economic data and the shape parameter of the loss function is approximately determined although the work focuses on a certain study of water demand for the irrigation and city the function might well be applied in other hedging schemes such as reservoir operations that incorporate environmental flow and shipping flow furthermore this budyko supply demand relationship could also be employed in power generation operations considering a concave benefit function of the generated electricity this work might offer a fresh viewpoint for solving real world reservoir operating problems credit authorship contribution statement weibo liu conceptualization methodology software writing original draft writing review editing pan liu writing review editing conceptualization supervision lei cheng supervision writing review editing yu gong methodology kangdi huang software xinran luo methodology xiao li validation qian cheng writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this study was supported by the national science fund for distinguished young scholars of china grant no 52225901 the joint funds of the national natural science foundation of china grant no u1865201 national natural science foundation of china grant no 51861125102 and innovation team in key field of the ministry of science and technology grant no 2018ra4014 appendix a the commonly used two point hedging rule the commonly used two point hedging rule tph is as follows for the water supply operation of a reservoir the vertical and horizontal ordinates indicate r and aw respectively the key point of the hedging mechanism is to define a target area once decision variables fall into the target area a hedging policy will be triggered to conserve water two point hedging rule tph has been commonly used in reservoir operation studies ji et al 2016 kumar and kasthurirengan 2018 tan et al 2017 exactly as the name tph includes two inflection points starting water availability swa and ending water availability ewa fig 3a the sop will be used unless aw falls between swa and ewa the available water of the reservoir is defined as a1 a w t s t q in t where awt is the available water of the reservoir at time t st is the water stored in the reservoir at the beginning of time t qin t is the inflow at time t here the evaporation loss and leakage of the reservoir are neglected in this study the functional form of tph can be written as follows a2 r t a w t if a w t s w a t d t d t s w a t ew a t a w t ew a t s w a t if s w a t a w t e w a t d t if a w t e w a t a3 s p t 0 if a w t d t s max a w t s max if a w t d t s max where rt is the water release not including the spill of the reservoir at time t swat and ewat are starting water availability and ending water availability at time t respectively dt is the water demand for the water supply system at time t spt is the spill from the reservoir at time t smax is the maximum storage i e capacity of the reservoir appendix b the derivation process of the budyko hedging function the derivation process of section 2 2 is shown as follows a4 b r t w b max d t r t d t d m m w p 1 d t d m d t r t d t d m m d m r d m 1 a5 c s t 1 1 w p 2 a w t d m a w t d m s t 1 a w t d m m a w t s max d m a6 min z b r t c s t 1 s t a w t r t s t 1 a w t s max d m d m r d 0 s t 1 a w t the lagrangian for this problem is a7 l b r t c s t 1 λ a w t r t s t 1 the first order conditions of the problem are a8 l r t 0 b r t r t λ l s t 1 0 c s t 1 s t 1 λ l λ 0 a w t r t s t 1 based on the eq a8 the relationship of marginal benefit loss can be derived as a9 b r t r t c s t 1 s t 1 let r w p 1 1 w p 2 1 m 1 the relationship between variables can be written as a10 r d t r t d t d m a w t d m s t 1 a w t d m from eq a6 st 1 awt rt eq a10 can be transformed as follows a11 r d t r t d t d m r t d m a w t d m let ε dm dt the equation can be written as a12 r d t r t 1 ε d t r t ε d t a w t ε d t let the left and right terms of eq a12 divided by awt at the same time a13 r d t a w t r r t a w t 1 ε d t a w t r t a w t ε d t a w t 1 ε d t a w t eq a13 can be organized as a14 r d t a w t r t a w t 1 ε d t a w t 1 ε d t a w t r t a w t ε d t a w t a15 r t a w t 1 ε ε r d t a w t r r d t a w t ε 1 ε r d t a w t 2 a16 r t a w t r d t a w t ε 1 ε r d t a w t 2 1 ε ε r d t a w t r when r 1 eq a16 can be simplified as a17 r t a w t d t a w t ε 2 d t a w t 2 1 2 ε d t a w t 1 the range of dt awt is discussed in supplementary material 2 appendix c supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 128788 appendix c supplementary data the following are the supplementary data to this article supplementary data 1 
2574,operating rules play an important role in enhancing the water utilization of reservoirs previous studies on hedging investigated the operating rules between water release r and available water aw based on minimizing the normalized shortage index and applied the rules to optimization however seldom considered a realistic economic objective function to form a more general supply demand relationship to address this issue this study formulated a theoretical function by a two period reservoir operation model with the goal of minimizing the sum of economic loss from the current release and carryover storage targets the derived function that guides the water supply was numerically validated to obtain the optimal time varying hedging rules by non dominated sorting genetic algorithm ⅱ the water supply system of dongwushi reservoir in hebei province china was selected as a case study the results show that 1 the derived function depicts the relationship between r aw ratio and d aw ratio which is consistent with the budyko supply demand framework 2 the optimized results using the derived budyko hedging function outperform those using two point hedging rule tph and standard operating policy sop 3 the derived function depicts a general non linear supply demand relationship rather than the linear one contained in commonly used tph the derived function could be used for varied demands indicating broader applications than tph keywords reservoir operations hedging rules budyko framework water supply supply demand relationship data availability data will be made available on request 1 introduction water resources are indispensable for economy and society s long term development rapid population growth as well as the sustainable development of agriculture and industry has resulted in a rise in demand for water potentially putting additional pressure on the long term usage and conservation of water resources ahmadianfar and zamani 2020 vörösmarty 2000 to provide stable water supplies for domestic agricultural and industrial uses fluctuating streamflow needs to be regulated gong et al 2022 li et al 2022 shiau 2009 however prolonged droughts may cause water supply systems to be inadequate to meet preestablished demands this is considered a normal part of climate variability and its occurrence is inevitable chanda and maity 2017 guo et al 2013 yang et al 2022 yuan et al 2018 during the period 1950 2008 the global proportion of arid areas increased considerably dai 2010 gerken et al 2018 yuan et al 2019 reservoirs play an important role in the sustainable management of water resources by altering the temporal and spatial distribution of runoff operating rules are crucial in enhancing the water utilization of reservoirs since the 1960s a series of release available water aw operating rules have been proposed lund and guzman 1999 tan et al 2017 these include pack rule maass 1962 space rule bower et al 1966 standard operating policy sop hashimoto et al 1982 loucks et al 1981 maass 1962 linear decision rule revelle 1969 joeres 1981 and hedging rule hr bayazit and ünal 1990 hu et al 2016 srinivasan and philipose 1996 the sop is introduced as the simplest rule for reservoir operation bayazit and ünal 1990 water demand is fully satisfied when aw is less than the demand water that exceeds the desired volume is kept in the reservoir until the capacity is full at which point it begins to spill to avoid severe shortages in the future it would be better to adopt hr which accepts current slight deficits with effective use of the existing infrastructure previous studies on hedging have focused on two issues 1 when to hedge and 2 how to hedge draper and lund 2004 derived two period theoretical optimal hedging rules for various value functions you and cai 2008 introduced inflow uncertainty and zhao et al 2011 discussed the effects of constraints on optimality conditions of a two stage reservoir operation problem these researches imply that hr is the optimal operating policy when the marginal utility of next period release is more than that of the current supply a variety of studies obtained the parameters of hr using mathematical programming models shih and revelle 1994 tu et al 2008 simulation models bayazit and ünal 1990 srinivasan and philipose 1996 or simulation optimization models hu et al 2016 ji et al 2016 shiau 2009 taghian et al 2014 these studies investigated the operating rules between water release r and aw based on minimizing the normalized shortage index shiau 2011 when the water demand d was fixed seldom considered a realistic economic objective function which can form a general supply demand relationship in general water demand drives reservoir supply while actual available water limits supply as well sankarasubramanian et al 2020 evolved budyko s framework for the natural and human altered watersheds the budyko framework was primarily used to estimate the actual hydroclimatic variable e g evapotranspiration given the available demand and supply mass or energy e g potential evapotranspiration and precipitation respectively for example wang et al 2015 formulated a budyko function by solving the equation derived from the proportionality hypothesis and maximum entropy production theory this supply demand actual budyko framework could be extended to the reservoir operation in this view aw water demand and water release could be rewritten as supply demand and actual respectively previous actual supply r aw relationship turned into actual to supply ratio demand to supply ratio r aw d aw the sop gives the asymptote and the upper bound given that this framework is non dimensional it provides a new perspective to deal with reservoir operation and hedging problems however few studies have derived a functional form for the hedging policy using the budyko supply demand framework thus the main objectives of this study were 1 to theoretically derive a function of hedging rules and interpret it with the budyko supply demand framework 2 to test the performance of the function through a case study and 3 to investigate the differences between the derived function and commonly used hedging rules the overall structure of the study takes the form of the remaining five chapters including methodology in section 2 the case study in section 3 results in section 4 discussions in section 5 and finally conclusions in section 6 2 methodology the structure of the methodology in this study is illustrated in fig 1 2 1 hedging rule under the budyko supply demand framework the hedging function is constructed for a water supply system with two types of demands the basic demand and general demand the basic demand could be domestic industrial water demand environmental flow or shipping flow demand this kind of demand is considered as crucial and should be satisfied first the basic demand will be fully satisfied unless the available water is limited the general demand usually corresponds to a quantifiable benefit which has a diminishing marginal benefit or increasing marginal loss function unlike the loss function of the normalized shortage index in shiau 2011 economic loss of the shortage is used as the loss function in this study which is a more realistic economic indicator the loss function of the water release at the current period can be assumed as follows 1 b r t w b max s m m 1 where b is the loss function rt is the water release not including the spill of the reservoir at time t w is the weighting factor assigned to the loss function of release target 0 w 1 bmax is the maximum economic loss of water supply deficit s is the shortage ratio of the water supply system 0 s 1 m is an exponent to describe the shape of the loss function m should exceed 1 to formulate a convex function b rt reaches the maximum value when s 1 as mentioned above the shortage of basic demand is disastrous and unquantifiable whose economic loss is not considered in the loss function the maximum economic loss bmax can be regarded as the value of water demand excluding basic demand dt dm to include the value per unit of water at the current period bmax is calculated as the average price plus water demand volume p1 dt dm as a result the loss function eq 1 can be written as 2 b r t w b max d t r t d t d m m w p 1 d t d m d t r t d t d m m d m r d m 1 where rt is the water release not including the spill of the reservoir at time t dt is the water demand for the water supply system at time t dm is the basic demand p1 is the average price per unit of water demand here the maximum economic loss is represented by the product of the average price p1 and water demand volume dt dm eqs 1 and 2 could be verified using the data of zhang et al 2013 which investigated the relationship between the irrigation benefit and water supply volume in a case study details in supplementary material 1 draper and lund 2004 suggested that a convex economic loss function concave benefit function is generally formulated due to water supplying institutions and consumers typically the benefit function is concave with the marginal benefits usually decreasing with the increasing use eqs 1 and 2 are such convex economic loss functions as water release rt increases the economic loss b rt decreases i e the first order derivative of economic loss b rt 0 meanwhile the first order derivative of economic loss b rt increases i e the second order derivative of economic loss b rt 0 similarly the loss function of the water stored in the reservoir st 1 due to deviation from the desired carryover target s t 1 t at time t can be assumed as follows shiau 2011 3 c s t 1 1 w p 2 s t 1 t s t 1 t s t 1 s t 1 t m s t 1 t s max 4 c s t 1 1 w p 2 a w t d m a w t d m s t 1 a w t d m m a w t s max d m where p2 is the average price of per unit carryover target deficit s t 1 t is the desired carryover storage target at time t which can be a desired operational level or the reservoir maximum storage i e capacity smax s t 1 t smax st 1 is the water stored in the reservoir at the beginning of time t 1 awt dm denotes the maximum carryover target that can be dominated at time t this problem of reservoir operation can be solved by a two period model for it only takes periods t and t 1 into consideration the objective function is to minimize the sum of economic loss b rt and c st 1 which can be written as follows 5 min z b r t c s t 1 s t a w t r t s t 1 a w t s max d m d m r d 0 s t 1 a w t this two period problem can be solved by the lagrange multiplier method as suggested by draper and lund 2004 the lagrangian for this problem is 6 l b r t c s t 1 λ a w t r t s t 1 where l is the lagrange function and λ is the lagrange multiplier the first order conditions of the problem are 7 l r t b r t r t λ 0 l s t 1 c s t 1 s t 1 λ 0 l λ a w t r t s t 1 0 based on eq 7 the relationship between variables can be written as 8 r d t r t d t d m a w t d m s t 1 a w t d m where r w p 1 1 w p 2 1 m 1 r is the ratio of price and weighting factor between current period and future which denotes the relative importance of current water release and that in the future using eq 5 and 8 the equation can be obtained as follows 9 r d t r t 1 ε d t r t ε d t a w t ε d t 10 r d t r t a w t ε d t 1 ε d t r t ε d t where ε is the ratio between dm and dt which is a parameter of the function from eq 10 the optimal hedging condition leads to the relationship as 11 when r 1 ε r t a w t r d t a w t ε 1 ε r d t a w t 2 1 ε ε r d t a w t r d t a w t 1 ε r t a w t 1 r t a w t 1 ε when r 1 ε r t a w t r d t a w t ε 1 ε r d t a w t 2 1 ε ε r d t a w t r d t a w t r 1 ε r r t a w t 1 d t a w t min r 1 ε r 1 ε ε and r are two parameters of the equation when r 1 the function can be simplified as 12 r t a w t d t a w t ε 2 d t a w t 2 1 2 ε d t a w t 1 d t a w t 1 ε r t a w t 1 d t a w t 1 ε the detailed derivation is shown in appendix b the derived hedging function curves are shown in fig 2 which reflects the relationships in eqs 11 and 12 a greater ε indicates a smaller interval to operate according to the value of current water release and that in the future r represents the relative value of water at two periods and a smaller r denotes that the water stored for the future leads to less economic loss than released at the current period consequently the curve e g light green and grey curves in fig 2b with greater r is closer to the asymptotes sop and vice versa as above based on minimizing the sum of economic loss at the current period and the future period this study obtains the relationship among water release water demand and available water and formulates it into hedging function as can be seen this derived function depicts the relationship between the supply ratio rt awt and demand ratio dt awt which is in line with the budyko supply demand framework the commonly used two point hedging rule tph reflects the relationship between rt and awt fig 3 a which is shown in appendix a based on the budyko supply demand framework the supply ratio rt awt and demand ratio dt awt can be briefly expressed as fig 3b 2 2 optimization model 2 2 1 objective functions for the water supply operation system in this study minimum economic loss is used as the objective function the objective function in the optimization model is as 13 min f t 1 t p 1 d t d m t d t r t d t d m t m where dt rt and dm t are the water demand water supply and basic demand at period t respectively the basic demand is typically considered as crucial and should be satisfied first however due to the continuous dryness the basic demand could not always be fully satisfied as a result the total deficit of basic demand needs to be considered in the optimization model the total deficit of basic demand is calculated as 14 g t 1 t d m t r t when r t d m t in the optimization awt will be primarily supplied for basic demand unless there is no extra available water the optimal solutions of the objective function 13 are computed at different levels of the total basic demand deficit 2 2 2 constraints the following constraints should be included in the model 1 water balance constraint 15 s t 1 s t q in t r t 2 water storage constraint 16 s dead s t 1 s max non flood season s dead s t 1 s flood flood season 3 water supply constraint 17 d m t r t d t w h e n a w t d m t 4 flow constraint 18 r t min r t r t max where sdead is the dead storage capacity sflood is the flood control storage capacity dm t is the basic demand at period t rt min and rt max are the upper and lower limits of water release of the reservoir at period t respectively 2 2 3 optimization procedure the reservoir storage state can be decided by the supply decision in a certain period which simultaneously affects the supply decision in the next period and eventually influences the overall periods in the reservoir operation ji et al 2016 to obtain a certain operation scheme with the minimum economic loss the parameters need to be optimized by the simulation and optimization models the steps are 1 randomly generating the parameters 2 calculating the objective function based on the long series operation process of the two period model as mentioned above 3 selecting the sets of parameters and adjusting parameters by the optimization algorithm 4 calculating the objective function of new parameters 5 repeating the steps above until the objective is satisfied here the dynamic programming dp is used to obtain the optimal operation trajectory if the data points of the best trajectory are clustered around a specific line or curve it will provide more possibility for optimization of the hedging rules non dominated sorting genetic algorithm ⅱ nsga ⅱ is used in the optimization of the hedging rules the parameters are starting water availability swa ending water availability ewa of eq a2 for tph and r ε of eq 11 for budyko hedging rule the parameters in the hedging rule are assumed to remain the same from year to year but vary among the 12 months in a year considering the variability of monthly demands and inflows 3 case study the study area is dongwushi reservoir located in cixian city hebei province of china fig 4 this area is in haihe river basin with a semi humid climate the main purpose of the dongwushi reservoir is the water supply for agricultural irrigation as well as the domestic and industrial use in handan city the reservoir is also used for flood control and hydropower generation in this study we don t consider hydropower generation the basic parameters of the reservoir are shown in table 1 where the flood season lasts from june to september zhang et al 2017 dongwushi reservoir irrigates a total area of 4 267 104 ha with a rotation of summer maize june to september and winter wheat september to june the annual irrigation water demand is 200 55 million m3 supplementary material 1 and the annual basic water demand domestic and industrial water demand is set as 120 00 million m3 according to data from the dongwushi reservoir management agency the monthly demand data is shown in fig 5 to investigate how the basic demands impact on hedging rules this study sets three schemes with the basic demands of 80 96 00 million m3 100 120 00 million m3 and 120 144 00 million m3 historical monthly inflow data of the dongwushi reservoir was gathered over 35 years from january 1980 to december 2014 to simulate the operation of the reservoir the data from 1980 to 2004 is used as a training set while the remaining from 2005 to 2014 was used to validate as shown in fig 6 the average annual inflow is 188 00 million m3 which is unevenly distributed in both intra annual and inter annual scales the annual average inflow is less than the two thirds of annual water demand in the region where the hedging policy is necessary table 2 in the case study p1 and m are obtained from the function fitting from the data in zhang et al 2013 which is discussed in supplementary material 1 the value of p1 in the objective function 13 is set as 3 4987 of which the unit is yuan m3 m is set as 1 5 4 results 4 1 the optimal operation trajectory of dp dp is a technique used when solving an optimization problem by decomposing it into several simpler subproblems by using dp the optimal solution with the best operation trajectory can be obtained by searching in the discretized state space feng et al 2020 zhang and liu 2021 in this study the objective is to minimize irrigation economic loss with the deficit of basic demand acting as a penalty function a series of optimal solutions can be obtained by setting various penalty weighing factors in real life the scheme with no deficit of the basic demand should be paid more attention the optimal operation data points under this scheme are drawn in the r aw coordinate fig 7 and r aw d aw fig 8 to detect the optimal operation rule except for the results from dec to feb the points in the r aw coordinate fig 7 do not converge around a line like that depicted in fig 3a this deviation indicates that the function under r aw coordinate is unable to adequately capture an appropriate relationship the conventional r aw relationship is not good for implementing the hedging strategy however the points in the r aw d aw framework indicate a general nonlinear relationship this gives the confidence to use the nonlinear function under the budyko framework to implement the hedging strategy 4 2 comparison among various operation rules fig 9 depicts the comparison of optimization results among various operation rules in the training period the budyko hedging function and tph optimization results are shown as irrigation economic loss at different levels of total basic demand deficit the orange star represents the result of sop while the purple star indicates the result of the one parameter budyko hedging function without optimization which merely uses the fixed parameter calculated by the ratio of actual basic demand and total demand data the budyko hedging function performs better than tph and much better than sop as seen in the fig 9 the irrigation economic loss is reduced by 1 3 about 100 300 million yuan utilizing the budyko hedging function with the same basic demand deficit when the irrigation economic loss is fixed the shortage of basic demand decreases by 4 30 the budyko function and tph produce comparable outcomes when the deficit of basic demand is great under this condition possible solutions can scatter across a broader area for both hedging functions the solution with no shortage of basic demand can be found by the budyko hedging function while tph is unable to this is due to the budyko hedging function s ability to provide a larger optimization space for searching solutions under this condition in practice the loss caused by a lack of basic demand is usually more severe than the irrigation loss which might lead to disastrous consequences as a result greater emphasis should be placed on the condition of no basic demand shortage the results of the various operation rules in the testing period are shown in table 1 the scheme corresponding to point b in fig 9 outperforms that of point d with reduced irrigation economic loss and deficit of basic demand point e and g provide comparable results the best scheme among a to d is dp point a whereas the worst among e to i is sop point i 4 3 results of various basic demand schemes fig 10 and fig 11 demonstrate the optimization results of various operation rules when basic demand increases and decreases by 20 similar to the findings presented in fig 9 the hedging function under the budyko framework performs better than tph and much better than sop in both schemes for schemes of increased basic demand the irrigation economic loss of the budyko hedging function is 2 4 about 200 400 million yuan less than tph with the same deficit of basic demand when the irrigation economic loss remains constant the shortage of basic demand decreases by 14 30 budyko hedging function can find the solution when there is no lack of basic demand whereas tph is unable to for schemes of decreased basic demand the irrigation economic loss of the budyko hedging function is 1 2 about 50 150 million yuan less than tph with a fixed deficit of basic demand solutions can be found using both the budyko hedging function and tph when there is no basic demand deficit in comparison to drought periods hedging policy is less significant in relative wet periods as stated previously there is an advantage to include the budyko hedging function rather than tph in reservoir operation especially for the drier scheme however this advantage appears limited in a wet period since the optimization space of such a scheme is generally smaller 5 discussion 5 1 rationality of the supply demand relationship embodied in the operation functions as stated previously eqs a2 and 11 describe two operation functions under different frameworks eq a2 not included the overlaps with sop could be viewed as a simple linear function as 19 r t a a w t b where a is the slope of the line and b is the intercept then the function can be transformed as 20 r t a w t a b 1 a w t let b 1 b d the function can be written as follows 21 r t a w t b 1 d a w t a it can be noticed that the tph function eq 20 is a straight line under the budyko framework shown as line ac in fig 12 however the relationship behind this straight line is not reasonable the slope of the line is constant that is the supply ratio will rise at the same rate as the demand ratio increases in fact when the demand ratio is low most of the demand should be satisfied as the demand ratio increases the growth rate of the supply ratio should gradually slow down until the demand ratio reaches a certain value the budyko hedging function consequently reflects such a general non linear relationship eq 11 is a function with the negative second order derivative supplementary material 3 shown as line od in fig 12 in summary a function with a declining marginal supply ratio supply ratio growth slows down as the demand ratio rises could be formulated using the convex benefit loss function eq 1 this general non linear supply demand relationship makes more sense than the linear one contained in commonly used tph now turn to the tph line shiau 2011 investigated another type of tph in which swa lies on the horizontal axis og in fig 3 a in this case none of the water will be released unless the aw reaches swa the supply ratio keeps zero unless the aw is greater than swa the supply demand relationship reflected in this type of tph is rather disappointing considering the possible effect this type of tph is also included in this study fig 13 in comparison to the previous fig 9 b and fig 10 b the solution of no basic demand deficit could be identified for tph however the tph still performs worse than the budyko hedging function when the other type is considered overall the budyko hedging function developed in this study with reasonable supply demand relationships outperforms the tph rules for various schemes 5 2 applicability of operation functions under varied demand conditions another interesting feature is the applicability of various operations functions under varying demand conditions as shown in eq a2 dt is a key component of the tph function which is assumed to remain constant in the same month of each year in the application of tph consequently the tph function could not be built when dt varies over time the budyko hedging framework however could still be applied when the basic demand total demand ratio dm dt remains constant or similar in the same month of each year this study also includes a scheme in which the irrigation demand and basic demand are expected to rise continuously from 1980 to 2004 the demand in 1980 is assumed to be 75 of the actual demand in the case study section 3 and the demand in 2005 is increased to 125 besides the demand for these years is assumed to rise linearly the budyko hedging function is utilized to operate under the varying demand condition as shown in fig 14 from the graph it can be detected that the budyko hedging function is better than sop and 7 14 worse than dp theoretical optimal scheme when the deficit of basic demand is 0 the minimal loss of irrigation benefit for the budyko function is 92 62 108 this loss is slightly smaller than that in the constant demand scheme fig 9 b one possible explanation for this is that in the varying demand scheme the inflow of later years with higher demand is greater than the inflow of earlier years with lower demand the requirement for hedging has been alleviated in this scheme this suggests that the budyko hedging function developed in this work has broader applications under varied demand conditions 6 conclusions this study developed a hedging function consistent with the budyko framework for water supply which is based on the objective function of minimum total economic loss the function was used to operate in the dongwushi reservoir from 1980 to 2014 compared to the commonly used two point hedging rule the following conclusions are obtained 1 a theoretical hedging function could be formulated by a two period reservoir operation model with the goal of minimizing the sum of economic loss from the current release and carryover storage targets the derived function depicts the relationship between r aw ratio and d aw ratio which is consistent with budyko supply demand framework 2 the optimized results of the derived budyko hedging function outperform those of tph and sop the irrigation economic loss is reduced by 1 3 about 100 300 million yuan utilizing the budyko hedging function with the same basic demand deficit when the irrigation economic loss is fixed the shortage of basic demand decreases by 4 30 for drought schemes the budyko hedging function can find the solution when there is no basic demand deficit whereas tph is unable to 3 based on the perspective of the supply demand framework and function curves the derived function depicts a general non linear supply demand relationship which is theoretically more rational than the linear one contained in the commonly used hedging rule the derived function could be used for varied demands indicating a broader application than tph in practice the formulated function could be applied in the optimization when the average price of water resources is estimated utilizing the economic data and the shape parameter of the loss function is approximately determined although the work focuses on a certain study of water demand for the irrigation and city the function might well be applied in other hedging schemes such as reservoir operations that incorporate environmental flow and shipping flow furthermore this budyko supply demand relationship could also be employed in power generation operations considering a concave benefit function of the generated electricity this work might offer a fresh viewpoint for solving real world reservoir operating problems credit authorship contribution statement weibo liu conceptualization methodology software writing original draft writing review editing pan liu writing review editing conceptualization supervision lei cheng supervision writing review editing yu gong methodology kangdi huang software xinran luo methodology xiao li validation qian cheng writing review editing declaration of competing interest the authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper acknowledgements this study was supported by the national science fund for distinguished young scholars of china grant no 52225901 the joint funds of the national natural science foundation of china grant no u1865201 national natural science foundation of china grant no 51861125102 and innovation team in key field of the ministry of science and technology grant no 2018ra4014 appendix a the commonly used two point hedging rule the commonly used two point hedging rule tph is as follows for the water supply operation of a reservoir the vertical and horizontal ordinates indicate r and aw respectively the key point of the hedging mechanism is to define a target area once decision variables fall into the target area a hedging policy will be triggered to conserve water two point hedging rule tph has been commonly used in reservoir operation studies ji et al 2016 kumar and kasthurirengan 2018 tan et al 2017 exactly as the name tph includes two inflection points starting water availability swa and ending water availability ewa fig 3a the sop will be used unless aw falls between swa and ewa the available water of the reservoir is defined as a1 a w t s t q in t where awt is the available water of the reservoir at time t st is the water stored in the reservoir at the beginning of time t qin t is the inflow at time t here the evaporation loss and leakage of the reservoir are neglected in this study the functional form of tph can be written as follows a2 r t a w t if a w t s w a t d t d t s w a t ew a t a w t ew a t s w a t if s w a t a w t e w a t d t if a w t e w a t a3 s p t 0 if a w t d t s max a w t s max if a w t d t s max where rt is the water release not including the spill of the reservoir at time t swat and ewat are starting water availability and ending water availability at time t respectively dt is the water demand for the water supply system at time t spt is the spill from the reservoir at time t smax is the maximum storage i e capacity of the reservoir appendix b the derivation process of the budyko hedging function the derivation process of section 2 2 is shown as follows a4 b r t w b max d t r t d t d m m w p 1 d t d m d t r t d t d m m d m r d m 1 a5 c s t 1 1 w p 2 a w t d m a w t d m s t 1 a w t d m m a w t s max d m a6 min z b r t c s t 1 s t a w t r t s t 1 a w t s max d m d m r d 0 s t 1 a w t the lagrangian for this problem is a7 l b r t c s t 1 λ a w t r t s t 1 the first order conditions of the problem are a8 l r t 0 b r t r t λ l s t 1 0 c s t 1 s t 1 λ l λ 0 a w t r t s t 1 based on the eq a8 the relationship of marginal benefit loss can be derived as a9 b r t r t c s t 1 s t 1 let r w p 1 1 w p 2 1 m 1 the relationship between variables can be written as a10 r d t r t d t d m a w t d m s t 1 a w t d m from eq a6 st 1 awt rt eq a10 can be transformed as follows a11 r d t r t d t d m r t d m a w t d m let ε dm dt the equation can be written as a12 r d t r t 1 ε d t r t ε d t a w t ε d t let the left and right terms of eq a12 divided by awt at the same time a13 r d t a w t r r t a w t 1 ε d t a w t r t a w t ε d t a w t 1 ε d t a w t eq a13 can be organized as a14 r d t a w t r t a w t 1 ε d t a w t 1 ε d t a w t r t a w t ε d t a w t a15 r t a w t 1 ε ε r d t a w t r r d t a w t ε 1 ε r d t a w t 2 a16 r t a w t r d t a w t ε 1 ε r d t a w t 2 1 ε ε r d t a w t r when r 1 eq a16 can be simplified as a17 r t a w t d t a w t ε 2 d t a w t 2 1 2 ε d t a w t 1 the range of dt awt is discussed in supplementary material 2 appendix c supplementary data supplementary data to this article can be found online at https doi org 10 1016 j jhydrol 2022 128788 appendix c supplementary data the following are the supplementary data to this article supplementary data 1 
