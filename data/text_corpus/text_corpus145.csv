index,text
725,a systematic understanding of hyporheic flux hf and residence times rt is important as they are a major control of biogeochemical processing in streambeds previous studies addressing the effect of heterogeneity in streambed hydraulic conductivity k on hf and rt have come to deviating conclusions depending on the specific study design and the selection of heterogeneity cases being investigated to more systematically evaluate the effects of conductivity heterogeneity on hf and rt we simulated hyporheic exchange induced by idealized streambed ripples over a large range of heterogeneities conductivity heterogeneity was represented in the simulations in terms of 10 000 different heterogeneity realizations from a geostatistical model based on continuous gaussian and discrete indicator random fields we demonstrate that any isotropic homogeneous k field as an average of a heterogeneous k field can only match rt or hf of the respective heterogeneous k field but never both we found exponential correlations of rt and hf with the variance of heterogeneous conductivity based on these correlations an equivalent anisotropic homogeneous conductivity tensor k can be derived this equivalent anisotropic k efficiently accounts for the effects of small scale heterogeneity on hf and rt it can be calculated from the median and variance of the hydraulic conductivity distribution of the targeted heterogeneous sediment without explicitly characterizing the sediment texture keywords conductivity heterogeneity hyporheic exchange residence time 1 introduction river networks play an important role in the processing of nutrients and pollutants battin et al 2008 seitzinger et al 2006 advective transport of solutes into the riverbed fuels this biogeochemical processing e g newcomer et al 2018 triska et al 1989 such advective transport is facilitated where pressure variations at the surface water sediment interface occur elliott and brooks 1997 the bedform induced flow of surface water through the sediments is called hyporheic exchange and the zone the surface water flows through the hyporheic zone hz which fundamentally controls stream ecosystem functions such as the processing of solutes see for example boano et al 2014 and references therein bedform driven hyporheic exchange occurs along a continuum of scales of geomorphic features ranging from mm to dm sized ripples dunes dm to m pool riffle structures m to tens of m and across meanders tens to hundreds of m boano et al 2014 the spatial scale of features controls flow path lengths the volume of the hyporheic zone and the residence time in the hyporheic zone stonedahl et al 2013 existing studies on effects of morphology on hyporheic exchange have either focused on understanding the effects of individual features e g cardenas et al 2008 hester et al 2013 trauth et al 2013 or the combined effects of multiscale morphological structures e g azizian et al 2017 morén et al 2017 stonedahl et al 2010 wörman et al 2006 many studies that analyze hyporheic exchange have assumed homogeneous sediments either for simplicity or to isolate the effects of morphology and hydraulic conditions from effects of sediment heterogeneity the hydraulic properties of the sediment however exert a strong control on hyporheic exchange hydraulic conductivity k can vary over orders of magnitude and in turn controls the magnitude of hyporheic exchange flux hf natural sediments are practically never homogeneous heterogenity has been shown to affect hf and hyporheic rt bardini et al 2013 cardenas et al 2004 gomez velez et al 2014 hester et al 2013 liu and chui 2017 pryshlak et al 2015 salehin et al 2004 sawyer and cardenas 2009 tonina et al 2016 zhou et al 2013 and the geometry of hyporheic flowpaths bardini et al 2013 cardenas et al 2004 fox et al 2016 salehin et al 2004 sawyer and cardenas 2009 understanding how heterogeneity affects hf rt or both is particularly important because a full characterization of sediment heterogeneity is hardly possible especially in complex field settings thus accounting for the effects of heterogeneity can help to reduce uncertainties in quantifying hf and rt arising from the assumption of homogeneity previous studies which have analyzed the effects of heterogeneity mostly reported increased hf and decreased rt with increasing heterogeneity which translates into an increased homogeneous equivalent k bardini et al 2013 cardenas et al 2004 fox et al 2016 hester et al 2013 liu and chui 2017 pryshlak et al 2015 salehin et al 2004 sawyer and cardenas 2009 zhou et al 2013 this general observation was independent of the underlying heterogeneity representation used in the studies whether discrete or continuous random or stratified the magnitude of the reported effect varied from dominant e g zhou et al 2013 to negligible e g salehin et al 2004 in a few cases also opposing effects have been reported with heterogeneity causing a decrease in hf and an increase in rt e g hf and median rt in tonina et al 2016 and the weakly heterogeneous massilon case in sawyer and cardenas 2009 different from other studies with randomized heterogeneity sawyer and cardenas 2009 looked at one specific case of heterogeneity based on an outcrop analog with a low log k variance massilon σ ln k 2 0 148 and a thoughtfully placed dependence between bedform morphology and depositional structures tonina et al 2016 used different realizations of one multigaussian heterogeneity model but did not systematically evaluate other non gaussian heterogeneity models this highlights the importance of evaluating a larger variety of different heterogeneity types as well as different realizations to also account for potential anomalies in the results the assessment of effects of heterogeneity potentially also depends on the choice of an appropriate homogeneous reference case which the heterogeneous case can be compared to e g pryshlak et al 2015 sawyer and cardenas 2009 it is commonly taken from an equivalent homogeneous representation of hydraulic conductivity which aims to reflect the effective conductivity of the heterogeneous domain simple statistical averages such as the arithmetic geometric or harmonic mean or variants of these statistical measures have been applied to estimate an effective hyraulic conductivity based on stochastic flow theory e g salehin et al 2004 zhang et al 2006 to account for structural anisotropy an anisotropic equivalent k has been used durlofsky 1991 salehin et al 2004 sawyer and cardenas 2009 however the true equivalent hydraulic conductivity can be quite different from those statistical measures particularly for strongly heterogeneous structured conductivity fields e g fleckenstein and fogg 2008 furthermore equivalent hydraulic conductivities derived on the basis of heads and bulk flow may be quite different from those derived based on transport characteristics such as water residence times or solute arrival times knudby and carrera 2005 scheibe and yabusaki 1998 in homogeneous media mass continuity requires that bedform driven hyporheic flux and mean rt are inversely proportional as long as the shape of the morphological features does not change elliott and brooks 1997 higher hydraulic conductivity generally promotes higher hf and shorter rt in heterogeneous sediments however hyporheic zone volume and the geometry of flow paths can vary significantly with sediment structure which differently affects rt and hf and hence the relationship between the two finding an equivalent homogeneous case based on statistics of the heterogeneity field which adequately accounts for heterogeneity effects on both hf and rt would therefore be helpful for an improved evaluation of hf and rt in complex field settings this paper contributes to this effort streambed heterogeneity has been characterized using different techniques ranging from deterministic representations based on detailed field assessments chen 2000 genereux et al 2008 or outcrop analogs sawyer and cardenas 2009 over geophysical techniques crook et al 2008 mclachlan et al 2017 to geostatistical representations using smoothly or more discretely varying continuous or indicator random fields fleckenstein et al 2006 hester et al 2013 irvine et al 2012 tonina et al 2016 or more complex geostatistical models that account for explicit structural elements in the sediments zhou et al 2013 all of these methods have their specific merits but given the vast range of different field conditions it is beyond the scope of this paper to evaluate which ones are best suited to represent a specific type of streambed geostatistical simulations are generally well suited to systematically evaluate sediment heterogeneities in a monte carlo framework as they allow to create multiple realizations of heterogeneity as well as different types this approach is chosen here as we want to systematically evaluate the combined effects of sediment heterogeneity on hf and rt we focus on streambed ripples as these smaller morphological features are the most relevant for total hyporheic exchange pryshlak et al 2015 stonedahl et al 2013 bedform driven hyporheic exchange with stochastically generated hydraulic conductivity fields is numerically simulated the model setup is intentionally kept simple 2d domain idealized bedforms and pressure variations at the streambed surface in order to allow for a large number of scenarios and comparability to analytical solutions which is in line with other systematic investigations on hyporheic exchange and residence times boano et al 2009 cardenas and wilson 2006 hester et al 2013 tonina et al 2016 in total 10 000 different geostatistical realizations of heterogeneous k fields where simulated with a 2d model setup representing a segment of a streambed with ripple induced pressure variations at the sediment water interface an analytical solution of hyporheic exchange fluxes and hyporheic residence time is derived for an anisotropic homogeneous sediment in this way the effects of heterogeneity on hf and rt can be evaluated against a set of homogeneous reference cases statistical analysis of these effects and systematic evaluation of the closed form solution of anisotropy allow for the development of an equivalent anisotropic k tensor we show an equivalent k tensor that is estimated from statistical moments without specific knowledge of the heterogeneous texture and imitates its heterogeneous target with respect to hf and median rt 2 methods 2 1 representation of heterogeneous sediments the streambed conductivity heterogeneity is represented by multiple realizations of different types of random fields and their transformations all based on sequential gaussian simulations sgsim all fields were calculated by the stanford geostatistical modeling software sgems remy et al 2011 the five methods differ in the variogram model exponential gaussian spherical and in the distribution transformation applied to it binary log normal zinn harvey more specifically the combinations gaussian log normal exponential log normal spherical log normal gaussian binary and gaussian zinn harvey were used as shown in fig 1 the distribution transformations aim to change the conductivity distribution of the random fields from gaussian as provided by sgsim to a specified distribution while preserving the original spatial correlation and visual appearance the binary transformation assigns a predefined high or low conductivity value to the cells using their median as threshold this creates a representation of two discrete hydrofacies with independent deposits and thus non continuous k distributions such independent hydrofacies can be formed by channel and bedform migration lunt et al 2004 the log normal transformation is commonly known as score transformation knudby and carrera 2005 or histogram transformation remy et al 2011 targeting a log normal distribution more specifically the cells are ranked by their conductivity values based on these ranks corresponding conductivity values are calculated from the quantile function of a log normal distribution this transformation ensures that all fields adhere to the same statistical distribution fig 1 lower right panel a prerequisite for comparison between different fields the zinn harvey transformation also known as absolute value transformation was developed by zinn and harvey 2003 and successfully used by knudby and carrera 2005 in order to obtain a better connected random field than the regular gaussian random field it was based on the idea that gaussian random fields usually consist of poorly connected high low conductivity areas embedded in a highly connected medium value matrix consequently zinn and harvey developed a transformation that turns medium values into high values more technically the negative absolute values are taken from a normally distributed gaussian random field hence turning high values to low values this transform shifts the values which had previously been in the medium range to higher values at the upper end of the new distribution a log normal transformation transforms this distribution to the targeted log normal distribution of conductivity values see knudby and carrera 2005 fig 5 for an illustration of the method the resulting fields have enhanced high k connectivity which is common in many natural geologic media e g alluvial sediments zheng and gorelick 2003 the random fields are parametrized by the mean μ ln k of the natural logarithm of the hydraulic conductivity k its standard deviation σ ln k 2 the two correlation lengths lx ly i e the ranges of the underlying variograms and the azimuth of the variogram α which allows the creation of cross bedding structures note that some of the aforementioned transformations alter the correlation lengths of the random fields gong et al 2013 zinn and harvey 2003 therefore lx and ly can not directly be compared between different transformations but only between fields transformed with the same method for each of the five random field methods 2000 realizations were created each with an individual randomized set of σ ln k 2 lx ly and α which sums up to the total of 10 000 different heterogeneity fields being modeled the parameter ranges were selected to cover the range of values reported in the literature μ ln k was kept constant in all realizations at 8 9548 σ ln k 2 was sampled from 0 σ ln k 2 6 76 according to the values provided by σ ln k 2 0 148 and σ ln k 2 0 937 bardini et al 2013 sawyer and cardenas 2009 σ ln k 2 1 0 and σ ln k 2 2 0 salehin et al 2004 up to σ ln k 2 6 65 zhou et al 2013 the case with the highest σ ln k 2 6 76 corresponds roughly to a binary composition of silty loam k 10 5 m s and medium to coarse gravel k 1 7 10 3 m s gelhar 1993 reported 0 24 σ ln k 2 4 6 to be commonly found in glacial groundwater bodies formed by fluvial or alluvial processes the intervals of the remaining randomized parameters can be found in table s1 in the supporting information 2 2 hydraulic model the subsurface model was set up as a 2d rectangular grid and discretized into 2001 501 cells in horizontal and vertical direction respectively a sinusoidal hydraulic head distribution was applied at the sediment water interface representing a rippled riverbed fig 2 the fully saturated steady state flow field within the domain was calculated using the finite volume model min3p mayer et al 2002 the hydraulic head distribution at the interface and at the up and downstream boundary is calculated as 1 h z 0 0 28 u 2 2 g h 0 34 d 3 8 sin 2 π λ x s x according to elliott and brooks 1997 where u is the stream velocity g is the gravity h is the bedform height d is the stream depth λ is the length of a virtual bedform s is the slope and x is the coordinate in flow direction starting at the upstream boundary of the domain eq 1 was originally developed from experimental data of dunes λ 3 ft fehlman 1985 but has since then successfully been used to model also head distributions of shorter wavelengths e g λ 15 cm fox et al 2014 in order to minimize effects of the upstream and downstream boundaries the head distribution of p 10 bedforms was applied to the domain of 2 m length and 0 5 m depth all other hydraulic and geometric parameters representing the stream and the bedforms were selected based upon the massillon case from sawyer and cardenas 2009 and can be found in table s2 in the supporting information as restrictions to the depth of the streambed were not part of this study an infinite depth domain was desirable such an infinite domain depth was used in the analytical solution section 2 3 the simulation domain however needs a bottom boundary we chose a no flow boundary at a depth of 0 5 m which we tested to be sufficiently deep to avoid boundary effects all random field realizations were simulated using the same model setup for further information on the parameterization see the source code and min3p input file template in the supporting information 2 3 analytical solution for anisotropic homogeneous conductivity the effects of heterogeneity are evaluated with respect to both isotropic and anisotropic homogeneous sediments in order to effectively generate the homogeneous reference cases an analytical solution is developed to solve the flow field for an anisotropic homogeneous case isotropic homogeneity is a special case of this general anisotropic solution the residence time and hyporheic flux are derived using the method of elliott and brooks 1997 as shown in appendix a the most simple case of anisotropy with a diagonal conductivity tensor 2 k k x x 0 0 k z z and an anisotropy ratio of 3 r k x x k z z is used to compare homogeneous anisotropic homogeneous isotropic r 1 and heterogeneous sediments it is shown in eq a 3 that for a semi infinite domain without slope the head field 4 h x z h 0 e r 2 π λ z sin 2 π λ x develops with the maximum boundary head amplitude h 0 it can be seen that anisotropy affects the vertical expansion of the hyporheic zone i e a lower vertical conductivity leads to a shallower hyporheic zone from this head field the seepage velocity uz of a hyporheic streamtrace infiltrating the sediment at point x 0 z 0 0 is derived in eq a 12 as 5 u z x 0 h 0 2 π λ k x x r sin 2 π λ x 0 the magnitude of the volumetric flow is inversely proportional to the square root of the anisotropy ratio r the exfiltration time te of a single particle infiltrating the sediment at x 0 z 0 0 is derived in a 11 as 6 t e x 0 φ λ k x x h 0 π x 0 cos 2 π λ x 0 with the porosity φ te is independent from r which allows for the choice of arbitrary uz to te ratios through changes in r the calculation of anisotropic qh and flux weighted r t from eqs 5 and 6 yields rather complex equations without generating any more insight towards the general behavior of anisotropic hyporheic flux and residence time that could not be derived from eqs 5 and 6 for a mutual validation of both the analytical solution and the numerical simulations selected homogeneous cases were calculated and simulated to test for equal behavior with respect to changes in kxx and kzz by calculating and simulating three homogeneous cases with ln k 8 95 8 95 ln k 8 95 10 95 and ln k 10 95 10 95 to check for equal behavior with regard to changes in overall conductivity and anisotropy 2 4 post processing hyporheic residence times were evaluated using stream traces calculated from the steady state flow field using paraview ayachit and avila 2015 seeds of the stream traces were placed in the cell centers of the uppermost layer in the analysis were considered only those stream traces that both enter and exit the domain via the sediment water interface hence ignoring flow over the up and downstream boundaries of the domain hyporheic fluxes were calculated from the seepage velocity at the infiltration points of the hyporheic stream traces the flux weighted median of the travel times of the stream traces r t and the total hyporheic volumetric flow rate qh were used as dependent variables to evaluate the influence of heterogeneity on hyporheic exchange additionally to evaluate the heterogeneity induced variations of hyporheic flowpaths the equivalent volume veq was calculated from r t and qh the underlying idea of veq is based on the fact that volume conservation requires 7 v q r t for an arbitrary streamtube where v is the volume enclosed by the tube q is the volumetric flow rate and rt is the residence time similarly the equivalent volume is calculated as 8 v e q q h r t if the flowpath geometries were invariant between different realizations qh and r t would be related inversely proportional and thus veq stayed constant in contrast if a constant volumetric flow was focused on a decreasing volume fraction of the domain the rt distribution and thus r t shifted towards shorter residence times independent from qh consequently veq decreased in studies that have targeted aquifer heterogeneity in the context of stream aquifer exchange the importance of the uppermost sediment layer represented by the top layer of the modeling domain has been emphasized kalbus et al 2009 similarly for hyporheic exchange hydraulic conductivities in the uppermost sediment layers are most decisive for net hyporheic flux qh and median residence time r t as head gradients h are largest there and decline exponentially with depth z according to eq 4 9a h h x 2 h z 2 9b h h 0 2 π λ e r 2 π λ z cos 2 2 π λ x r sin 2 2 π λ x to evaluate this effect the conductivity parameters μ n ln k and σ n ln k were additionally calculated for the upper layer of 1 2 4 6 8 10 20 40 100 400 mm thickness measured from the interface for scale independent comparability those sections of the uppermost layers were named by fractions of the bedform wavelength λ i e n 0 5 1 2 3 4 5 10 20 50 100 200 λ those upper layer statistics have merely been recorded in post processing not modified in pre processing because the large variety of random fields provided sufficient variations in these upper layer statistics with the additional upper layer statistics the influence of a total of 29 different predictor variables namely μ n 0 5 200 σ n 0 5 200 μ ln k σ ln k σ ln k 2 α lx ly and randomfield method on the three response variables r t qh and veq can be evaluated in order to sort those predictors by their relative importance a forward stepwise regression model was used james et al 2013 such a model starts with a linear regression without any predictors and then one at a time adds the predictor that improves the model most this method ultimately yields 30 linear regressions per response variable based on 0 1 2 29 predictors by the nature of this method each additional predictor improves the fit to the training data set but not necessarily to an unseen validation data set this leads to an overfit of the training data with additional predictor variables that are irrelevant when used with an unseen data set this raises the need for an evaluation of the regressions on a test data set we performed such an evaluation via cross validation which divides the data set in several combinations of training and test sets and calculates the actual improvement of the regressions on unseen data allowing the selection of the most important predictors and omitting the less important ones 3 results streambed heterogeneity generally increased qh and decreased r t compared to an isotropic homogeneous streambed of equal μ ln k we found a decaying exponential relationship between r t and σ ln k 2 and a positive exponential correlation between qh and σ ln k 2 a linear regression between ln r t and ln qh with σ ln k 2 yielded 10 r t h e t e 0 89 σ ln k 2 r t h o m r 2 0 75 for log normal distributed k e 0 47 σ ln k 2 r t h o m r 2 0 89 for binary distributed k and 11 q h h e t e 0 36 σ ln k 2 q h h o m r 2 0 67 for log normal distributed k e 0 24 σ ln k 2 q h h o m r 2 0 79 for binary distributed k which results in the linear dependencies shown in log linear space in fig 3 a and b the coefficients of determination r 2 in eqs 10 and 11 were calculated from logarithmic data as shown in fig 3 we found a decreasing relationship between veq and σ ln k 2 fig 3 c which indicates changes in the geometry of flowpaths between different scenarios more specifically in sediments characterized by strong heterogeneity the volumetric flow is restricted to a smaller portion of the domain at higher flow velocities this does not necessarily imply that the flowpaths are shallower instead a visual inspection of the flow fields e g fig 2 suggests that the hyporheic flux is focused on highly conductive zones which provide efficient preferential flow paths e g chen and zeng 2015 fox et al 2016 salehin et al 2004 scheibe and yabusaki 1998 in homogeneous sediments veq obtained from eqs 5 and 6 does not change with conductivity but is only sensitive to changes in anisotropy that means anisotropic homogeneous sediments would have the same veq as long as the ratio r k x x k z z is constant because the hyporheic flowpaths are equally long and deep with changes in r flowpaths are deeper r r 0 or shallower r r 0 than the original r 0 flowpaths and thus veq increases or decreases with v e q 1 r fig 3c is color coded by the different random field methods and indicates that all methods but the binary showed similar behavior of veq which was also found for r t and qh not shown here scenarios with the binary random field method showed a similar trend but a lower exponential coefficient between r t qh and veq and σ ln k 2 another perspective on this data is shown in fig 4 where r t is plotted over qh in log log space for both heterogeneous and homogeneous realizations we found that 12 r t q h 1 for homogeneous k of constant anisotropy r q h 2 33 for heterogeneous k i e r t tended to be significantly lower for a given qh under heterogeneous conditions than under isotropic homogeneous conditions which again shows that a large part of the hf is restricted to a smaller part of the domain in heterogeneous sediments on the same figure a family of curves describing various anisotropic homogeneous scenarios is plotted it should be noted from eq 6 that the exfiltration time and thus the median residence time r t depends solely on the horizontal conductivity kxx not on the vertical conductivity kzz and thus not on the anisotropy of the homogeneous conductivity this allows the design of any desired qh to r t ratio by changing either kxx for changes in both qh and r t or kzz for adjustments in qh only weighting the residence time by the volumetric flow of the streamtraces as it is done in section 2 4 will not affect this independence of the residence time of the vertical conductivity because only the magnitude of the flow is affected by r which therefore will be canceled out in the weighting process this independence of r t of kzz is shown by the horizontal dotted lines in 4 which show the r t to qh ratios for homogeneous sediments of equal kxx but varying kzz we have tested the importance of the hydraulic conductivity of the upper sediment layer because it is known to have a strong influence on exchange processes see section 2 4 as expected from eq 9 the results of the stepwise regression model suggest that both r t and qh were mainly controlled by conductivity properties of the uppermost zone to be precise the model selected σ 2 λ μ 1 λ and σ 5 λ μ 5 λ to be the two most important predictors for r t and qh respectively further predictors such as random field method lx ly or α had almost no relevance regarding model prediction performance table s3 s4 supporting information the importance of the upper layer is illustrated by fig 5 which shows the prediction performance of various models for r t and qh given the conductivity metrics μ n ln k and σ n ln k of upper layers of different thicknesses the figure shows that calculating μ n ln k and σ n ln k from very thick layers reduces model performance by averaging the effect of the important upper layer conductivity information with less important lower layer information similarly calculating those metrics from very thin layers drops too much information and again decreases model performance although the decline in model performance was not as strong as for large layers within the boundaries of our investigations the best prediction of r t and qh is obtained from conductivity metrics calculated from an average of 1 5 λ which is equivalent to 2 10 mm or 2 10 cells in this case finally it has to be noted that the upper layer of a gaussian random field is not independent of the layer underneath which raises the need for further investigations on the importance of the upper layer of the hz 4 discussion the exponential relationship between r t qh and σ ln k 2 as shown in eqs 10 and 11 is in good agreement with prior studies that investigated a variety of heterogeneity scenarios fig 6 for example zhou et al 2013 reported an increase of qh of almost one order of magnitude 9 2 in a bimodally distributed heterogeneous streambed of σ ln k 2 6 65 compared to a homogeneous streambed of equal μ ln k similarly eq 11 yields an increase of q h h e t 11 0 q h h o m and q h h e t 4 9 q h h o m for log normal distributed and binary distributed conductivity respectively given the same σ ln k 2 in contrast to this strongly heterogeneous case sawyer and cardenas 2009 and bardini et al 2013 assumed much lower variances of k σ ln k 2 0 148 and σ ln k 2 0 937 for the streambeds they investigated they argued that their streambeds were part of one depositional facies for which hydraulic conductivity tends to vary less than for sediments consisting of different depositional facies sawyer and cardenas 2009 concluded that heterogeneity had a minor effect due to small changes in rt and qh qh was found to vary only by factors of 0 8 and 1 2 compared to the homogeneous case which is in good agreement with the factor 1 05 and 1 4 calculated from eq 11 for σ ln k 2 0 148 and σ ln k 2 0 937 respectively similarly r t was found to vary by factors of 1 36 and 0 47 which is an acceptable agreement with the factor 0 88 and 0 43 calculated from eq 10 note that sawyer and cardenas 2009 use an advanced anisotropic equivalent homogeneous case based on flux simulations rather than a simple statistical equivalent like the geometric mean this and the fact that sawyer and cardenas 2009 simulated only one selectively placed heterogeneous field might explain the anomaly of the weakly heterogeneous massilon case in addition to these studies salehin et al 2004 investigated both rt and qh in discrete heterogeneous streambeds with σ ln k 2 1 0 and σ ln k 2 2 0 for σ ln k 2 1 0 salehin et al 2004 found r t to decrease in heterogeneous sediments by a factor 0 65 which agrees well with r t h e t 0 63 r t h o m and r t h e t 0 41 r t h o m from eq 10 for binary and log normal distributed conductivity respectively however the ratio between r t for the heterogeneous and homogeneous cases was found to be almost equal 0 64 under σ ln k 2 2 0 which is contradictory to our general findings but a good example of how variable qh and r t may be for single experiments this variability is indicated by the increase in qh and r t variance with σ ln k 2 in fig 3 and emphasizes that our findings are most useful for large scale or upscaling techniques whereas single small domains that do not behave ergodic may show a different behavior the importance of the uppermost layer which is shown in fig 5 and was previously reported by kalbus et al 2009 is a possible explanation for the unexpected similarity between the two heterogeneous experiments by salehin et al 2004 in both experiments a layer of homogeneous sand was added to the top of the heterogeneous sediment to shape the bedforms consequently both experiments had equal hydraulic conductivity of the uppermost zone which might have overruled the effects of the different heterogeneous structures underneath pryshlak et al 2015 investigated hyporheic exchange comparing a large variety of both high contrast 7 6 σ ln k 2 11 9 and low contrast 0 84 σ ln k 2 1 32 binary heterogeneous sediments to homogeneous sediments of equal μ ln k pryshlak et al 2015 provides a data set of 20 rtds and hf for different heterogeneous and homogeneous scenarios which allowed the evaluation of eqs 11 and 10 on a relatively large data basis we found the data to be in good agreement with our model given that the variance of both rt and qh tends to increase with variance in k note that the original article was corrected for an erratum concerning the relevant data in april 2018 similar to our approach tonina et al 2016 conducted monte carlo simulations of heterogeneous hyporheic sediments but their results do not agree with our findings contrary to our findings they predicted weakly declining qh and increasing median rt with σ ln k 2 the data basis of both our study and tonina et al 2016 is large enough to rule out stochastic deviations i e the difference of their results must be systematically based on the different study design one potential reason for the different results is the effect of gaining groundwater flux which has been included in tonina et al 2016 however fox et al 2016 conducted similar simulations including both gaining and losing conditions without finding such an effect other than that the domain size and shape the stream trace analysis or the random field generation might play a role but we could not identify the most decisive factor for the observed discrepancies with absolute certainty finally fox et al 2016 investigated the effect of ternary clustered heterogeneity and concluded that the isotropic homogeneous geometric mean conductivity needs to be corrected by a factor of e 0 183 σ 2 to match heterogeneous qh which is close to the factor of e 0 24 σ 2 for binary fields in eq 11 cardenas et al 2004 introduced the dimensionless number nh to quantify the influence of heterogeneity compared to external forcing mechanisms denoted as ne on the geometry of the hz nh was defined as 13 n h σ ln k 2 l v z h z and ne was defined as 14 n e 4 h 0 λ s with the vertical extend of the homogeneous hz zhz and the vertical correlation length lv which is calculated from lx ly and α in this case nh was used in studies that focused on hf and hyporheic rt e g sawyer and cardenas 2009 zhou et al 2013 however both cardenas et al 2004 and zhou et al 2013 emphasized the need for confirmation of its definition and significance because of the weak influence of correlation lengths and angles on hyporheic processes found in this study we suggest cutting the geometric variables from the dimensionless number and use 15 n h n e w e σ ln k 2 instead of the original nh n h new is linearly correlated with ln r t ln qh and ln veq we found that n h new shows a significantly stronger correlation than nh when used to predict any of the aforementioned hf measures in fact a linear regression of our data using nh as a predictor yielded the coefficients of determination r q h 2 0 53 r r t 2 0 49 and r v e q 2 0 39 compared to r q h 2 0 66 r r t 2 0 71 and r v e q 2 0 64 when using n h new eq 12 and fig 4 demonstrate that there is no isotropic homogeneous sediment that represents a heterogeneous sediment with respect to both r t and qh be it based on the geometric mean the arithmetic mean or any other isotropic conductivity when fitting an isotropic homogeneous conductivity to match qh the homogeneous r t will be overestimating the corresponding r t of a heterogeneous sediment and vice versa the strength of this deviation depends on σ ln k 2 as shown by the color scale in fig 4 and by v e q q h r t in fig 3 c for example a homogeneous model that was fitted to match qh of a moderately heterogeneous sediment with σ ln k 2 1 would show a r t that is about 1 7 times longer than the corresponding heterogeneous one however an isotropic homogeneous model that was fitted to qh of a heterogeneous sediment with σ ln k 2 6 65 as in zhou et al 2013 would overestimate r t by about a factor of 36 an equivalent homogeneous case can be obtained by choosing an anisotropic homogeneous conductivity tensor that generates equivalent results in both residence times and hyporheic exchange such an equivalent anisotropic conductivity tensor can be obtained from eqs 5 6 10 and 11 16a r t h e t e a σ ln k 2 r t h o m i s o e μ ln k k x x e q r t h o m i s o 16b k x x e q e μ ln k a σ ln k 2 and 17a q h h e t e b σ ln k 2 q h h o m i s o k x x e q k z z e q e μ ln k q h h o m i s o 17b k z z e q e μ ln k 2 b a σ ln k 2 with a 0 89 b 0 36 for log normal distributed heterogeneity and a 0 47 b 0 24 for binary distributed heterogeneity as an example eqs 16b and 17b can be used to calculate equivalent anisotropic conductivity vectors for the moderate and the extreme heterogeneous cases of sawyer and cardenas 2009 and zhou et al 2013 the equivalent anisotropic conductivity vector for the moderate log normal distributed heterogeneity of μ ln k 8 95 and σ ln k 2 1 0 yields l n k x x 8 06 and l n k z z 9 12 or an anisotropy ratio of r 2 9 for the more extreme binary heterogeneity of equal μ ln k but higher variance σ ln k 2 6 65 the equivalent anisotropic conductivity yields l n k x x 5 82 and l n k z z 8 88 or an anisotropy ratio r 21 3 to give an additional field study based example pryor 1973 reported a conductivity distribution of μ ln k 7 195 and σ ln k 2 0 39 from measurements on the whitewater river bar assuming a lognormal conductivity distribution we expect r t to decrease by 29 and qh to increase by 15 due to heterogeneity the river bar could be represented by an anisotropic sediment of l n k x x 6 85 and l n k z z 7 26 i e an anisotropy ratio of r 1 5 it should be noted that these equivalent anisotropic homogeneous cases do not reflect the actual anisotropy of the heterogeneous fields in fact the independence of the heterogeneous results of correlation lengths and correlation angles indicates that the heterogeneous fields chosen in this study have little local anisotropy at all which is most likely due to the fact that the integral scales of the fields are of similar dimension as the hyporheic flow cells instead the hyporheic flow cells of the heterogeneous and the equivalent anisotropic homogeneous cases might have completely different shape but a similar equivalent volume the heterogeneous flow cells evolve along highly conductive areas that might be deep or shallow whereas the anisotropic flow cells develop in shallower areas however this uniform reduction of flow cell depths adequately reflects the behavior of heterogeneous fields with respect to hyporheic r t and qh this simplification is useful if the sediment is treated as an ideal reactor that is solely controlled by reaction times and concentrations neglecting the potential need for spatial information like reaction volume or exchange depth the fact that it can be easily calculated from just the variance and median of the heterogeneous conductivity distribution makes it an ideal tool for combined field and simulation studies as spatial information is difficult to obtain point wise conductivity measurements could be used to calculate the required statistical metrics and improve an accompanying numerical model by using an equivalent anisotropic conductivity to simulate hf and rt 5 conclusions our results demonstrate that there is no unique but yet a systematic effect of heterogeneity on hyporheic flux hf and residence times rt thus we conclude that heterogeneity is neither generally important zhou et al 2013 nor negligible bardini et al 2013 the effect of heterogeneity on hf and rt depends mainly on the variance of k in fact r t decreases exponentially while qh increases exponentially with σ ln k 2 this exponential relationship can be seen in both discrete and continuous heterogeneity fields yet exponential coefficients vary slightly between the two types hf is focused on smaller high conductive well connected fractions of the domain in heterogeneous sediments this reduction of effective seepage volume promotes faster focused flow and hence lower rt compared to homogeneous sediment of equal hf as a consequence of this focusing of flow paths there exists no equivalent isotropic homogeneous sediment that matches both hf and rt of the respective heterogeneous one anisotropic homogeneous sediments however reduce the seepage volume in a similar fashion and consequently affect hf and rt in a similar way compared to heterogeneous sediments the anisotropic conductivity tensor presented can be used to account for the effects of heterogeneity on hf and rt without detailed knowledge of the spatial arrangement of hydrofacies and purely on the basis of statistical moments of the conductivity distribution both numerical and analytical models that target hyporheic exchange may benefit from this simplification which removes the necessity to characterize the full complexity of heterogeneity and instead allows to quantify the integral impact of heterogeneity on hf and rt by means of the moments of the heterogeneity distribution acknowledgements preprocessed simulation data and the source code that was used to generate and process the data can be found in the supporting information this research was supported by a grant nr 1158 132 8 2011 from the gif the german israeli foundation for scientific research and development we thank audrey sawyer and one anonymous reviewer whose critical and constructive comments significantly helped to improve the article appendix a anisotropic hyporheic exchange the method shown in this section was developed by elliott and brooks 1997 here it is expanded to describe also anisotropic conductivities which has been done in a similar fashion by zlotnik et al 2011 for a closed form solution of hyporheic exchange in an anisotropic medium the domain of fig 2 is simplified to a 2d semi infinite plane furthermore the head boundary condition of eq 1 is simplified to a sinusoidal head without slope yielding a 1a h z 0 h 0 sin x a 1b h z 0 a 1c h x h x 2 π with x 2 π λ x and z 2 π λ z both of these simplifications allow an easier solution of the flow field and are believed to have minor effects on the conclusions drawn from the results on this domain the anisotropic laplace equation a 2 k x x 2 h x 2 k z z 2 h z 2 0 with a diagonal conductivity tensor is solved with respect to the boundary conditions in eq a 1 by a 3 h x z h 0 e r z sin x thus darcy s law u u x u z t k h results in the vertical and horizontal seepage velocities a 4a u x φ d x d t k x x h 0 2 π λ e r z cos x a 4b u z φ d z d t k z z h 0 2 π λ r e r z sin x with porosity φ and time t defining u 0 k x x h 0 2 π λ yields a 5a u x u 0 e r z cos x a 5b u z u 0 r e r z sin x from this velocity field streamtraces can be defined by the set of points with dimensionless coordinates x and z that follow the velocity field a 6 d z d x u z u x 1 r tan x and thus for a given infiltration point 0 x 0 π 2 z 0 0 t 0 a 7 z 1 r l n cos x cos x 0 from a 4 a 5 and a 7 we can derive the respective x coordinate via a 8a φ λ 2 π d x d t u 0 exp ln cos x cos x 0 cos x a 8b φ λ 2 π d x d t u 0 cos x 0 a 8c x x 0 u 0 φ 2 π λ t cos x 0 for completeness but not used here the z coordinate of a streamtrace can be derived via a 9 z 1 r l n cos x 0 u 0 φ 2 π λ t cos x 0 cos x 0 from the symmetry of the problem we know that a streamtrace that infiltrates at x 0 exfiltrates at x 0 the respective exfiltration time t r t x 0 can be calculated by eq a 8 as a 10 t e x 0 φ λ u 0 π x 0 cos x 0 or a 11 t e x 0 φ λ k x x h 0 π x 0 cos 2 π λ x 0 the volumetric flow of a hyporheic streamtrace can simply be derived by its vertical seepage velocity in eq a 4 at its infiltration point a 12 u z x 0 z 0 h 0 2 π λ k x x r sin 2 π λ x 0 supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2018 10 003 appendix b supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 https data mendeley com submissions evise edit xt8xkvwjk3 submission id s0309 1708 18 30172 6 token 6fd5c956 d771 41a3 90b4 21e85306b209 supplementary data s1 ayachit avila 2015 u ayachit l s avila the paraview guide updated for paraview version 4 3 2015 kitware inc azizian boano cook detwiler rippy grant 2017 m azizian f boano p l cook r l detwiler m a rippy s b grant ambient groundwater flow diminishes nitrate processing in the hyporheic zone of streams water resour res 2017 10 1002 2016wr020048 bardini boano cardenas sawyer revelli ridolfi 2013 l bardini f boano m cardenas a sawyer r revelli l ridolfi small scale permeability heterogeneity has negligible effects on nutrient cycling in streambeds geophys res lett 40 2013 1118 1122 10 1002 grl 50224 battin kaplan findlay hopkinson marti packman newbold sabater 2008 t j battin l a kaplan s findlay c s hopkinson e marti a i packman j d newbold f sabater biophysical controls on organic carbon fluxes in fluvial networks nat geosci 1 2008 95 100 10 1038 ngeo101 boano harvey marion packman revelli ridolfi wörman 2014 f boano j w harvey a marion a i packman r revelli l ridolfi a wörman hyporheic flow and transport processes mechanisms models and biogeochemical implications rev geophys 52 2014 603 679 10 1002 2012rg000417 boano poggi revelli ridolfi 2009 f boano d poggi r revelli l ridolfi gravity driven water exchange between streams and hyporheic zones geophys res lett 36 2009 10 1029 2009gl040147 cardenas wilson cardenas m b wilson j 2006 hydrodynamics of coupled flow above and below a sediment water interface with triangular bedforms ftp spacegrant hawaii edu glazer chen 20
725,a systematic understanding of hyporheic flux hf and residence times rt is important as they are a major control of biogeochemical processing in streambeds previous studies addressing the effect of heterogeneity in streambed hydraulic conductivity k on hf and rt have come to deviating conclusions depending on the specific study design and the selection of heterogeneity cases being investigated to more systematically evaluate the effects of conductivity heterogeneity on hf and rt we simulated hyporheic exchange induced by idealized streambed ripples over a large range of heterogeneities conductivity heterogeneity was represented in the simulations in terms of 10 000 different heterogeneity realizations from a geostatistical model based on continuous gaussian and discrete indicator random fields we demonstrate that any isotropic homogeneous k field as an average of a heterogeneous k field can only match rt or hf of the respective heterogeneous k field but never both we found exponential correlations of rt and hf with the variance of heterogeneous conductivity based on these correlations an equivalent anisotropic homogeneous conductivity tensor k can be derived this equivalent anisotropic k efficiently accounts for the effects of small scale heterogeneity on hf and rt it can be calculated from the median and variance of the hydraulic conductivity distribution of the targeted heterogeneous sediment without explicitly characterizing the sediment texture keywords conductivity heterogeneity hyporheic exchange residence time 1 introduction river networks play an important role in the processing of nutrients and pollutants battin et al 2008 seitzinger et al 2006 advective transport of solutes into the riverbed fuels this biogeochemical processing e g newcomer et al 2018 triska et al 1989 such advective transport is facilitated where pressure variations at the surface water sediment interface occur elliott and brooks 1997 the bedform induced flow of surface water through the sediments is called hyporheic exchange and the zone the surface water flows through the hyporheic zone hz which fundamentally controls stream ecosystem functions such as the processing of solutes see for example boano et al 2014 and references therein bedform driven hyporheic exchange occurs along a continuum of scales of geomorphic features ranging from mm to dm sized ripples dunes dm to m pool riffle structures m to tens of m and across meanders tens to hundreds of m boano et al 2014 the spatial scale of features controls flow path lengths the volume of the hyporheic zone and the residence time in the hyporheic zone stonedahl et al 2013 existing studies on effects of morphology on hyporheic exchange have either focused on understanding the effects of individual features e g cardenas et al 2008 hester et al 2013 trauth et al 2013 or the combined effects of multiscale morphological structures e g azizian et al 2017 morén et al 2017 stonedahl et al 2010 wörman et al 2006 many studies that analyze hyporheic exchange have assumed homogeneous sediments either for simplicity or to isolate the effects of morphology and hydraulic conditions from effects of sediment heterogeneity the hydraulic properties of the sediment however exert a strong control on hyporheic exchange hydraulic conductivity k can vary over orders of magnitude and in turn controls the magnitude of hyporheic exchange flux hf natural sediments are practically never homogeneous heterogenity has been shown to affect hf and hyporheic rt bardini et al 2013 cardenas et al 2004 gomez velez et al 2014 hester et al 2013 liu and chui 2017 pryshlak et al 2015 salehin et al 2004 sawyer and cardenas 2009 tonina et al 2016 zhou et al 2013 and the geometry of hyporheic flowpaths bardini et al 2013 cardenas et al 2004 fox et al 2016 salehin et al 2004 sawyer and cardenas 2009 understanding how heterogeneity affects hf rt or both is particularly important because a full characterization of sediment heterogeneity is hardly possible especially in complex field settings thus accounting for the effects of heterogeneity can help to reduce uncertainties in quantifying hf and rt arising from the assumption of homogeneity previous studies which have analyzed the effects of heterogeneity mostly reported increased hf and decreased rt with increasing heterogeneity which translates into an increased homogeneous equivalent k bardini et al 2013 cardenas et al 2004 fox et al 2016 hester et al 2013 liu and chui 2017 pryshlak et al 2015 salehin et al 2004 sawyer and cardenas 2009 zhou et al 2013 this general observation was independent of the underlying heterogeneity representation used in the studies whether discrete or continuous random or stratified the magnitude of the reported effect varied from dominant e g zhou et al 2013 to negligible e g salehin et al 2004 in a few cases also opposing effects have been reported with heterogeneity causing a decrease in hf and an increase in rt e g hf and median rt in tonina et al 2016 and the weakly heterogeneous massilon case in sawyer and cardenas 2009 different from other studies with randomized heterogeneity sawyer and cardenas 2009 looked at one specific case of heterogeneity based on an outcrop analog with a low log k variance massilon σ ln k 2 0 148 and a thoughtfully placed dependence between bedform morphology and depositional structures tonina et al 2016 used different realizations of one multigaussian heterogeneity model but did not systematically evaluate other non gaussian heterogeneity models this highlights the importance of evaluating a larger variety of different heterogeneity types as well as different realizations to also account for potential anomalies in the results the assessment of effects of heterogeneity potentially also depends on the choice of an appropriate homogeneous reference case which the heterogeneous case can be compared to e g pryshlak et al 2015 sawyer and cardenas 2009 it is commonly taken from an equivalent homogeneous representation of hydraulic conductivity which aims to reflect the effective conductivity of the heterogeneous domain simple statistical averages such as the arithmetic geometric or harmonic mean or variants of these statistical measures have been applied to estimate an effective hyraulic conductivity based on stochastic flow theory e g salehin et al 2004 zhang et al 2006 to account for structural anisotropy an anisotropic equivalent k has been used durlofsky 1991 salehin et al 2004 sawyer and cardenas 2009 however the true equivalent hydraulic conductivity can be quite different from those statistical measures particularly for strongly heterogeneous structured conductivity fields e g fleckenstein and fogg 2008 furthermore equivalent hydraulic conductivities derived on the basis of heads and bulk flow may be quite different from those derived based on transport characteristics such as water residence times or solute arrival times knudby and carrera 2005 scheibe and yabusaki 1998 in homogeneous media mass continuity requires that bedform driven hyporheic flux and mean rt are inversely proportional as long as the shape of the morphological features does not change elliott and brooks 1997 higher hydraulic conductivity generally promotes higher hf and shorter rt in heterogeneous sediments however hyporheic zone volume and the geometry of flow paths can vary significantly with sediment structure which differently affects rt and hf and hence the relationship between the two finding an equivalent homogeneous case based on statistics of the heterogeneity field which adequately accounts for heterogeneity effects on both hf and rt would therefore be helpful for an improved evaluation of hf and rt in complex field settings this paper contributes to this effort streambed heterogeneity has been characterized using different techniques ranging from deterministic representations based on detailed field assessments chen 2000 genereux et al 2008 or outcrop analogs sawyer and cardenas 2009 over geophysical techniques crook et al 2008 mclachlan et al 2017 to geostatistical representations using smoothly or more discretely varying continuous or indicator random fields fleckenstein et al 2006 hester et al 2013 irvine et al 2012 tonina et al 2016 or more complex geostatistical models that account for explicit structural elements in the sediments zhou et al 2013 all of these methods have their specific merits but given the vast range of different field conditions it is beyond the scope of this paper to evaluate which ones are best suited to represent a specific type of streambed geostatistical simulations are generally well suited to systematically evaluate sediment heterogeneities in a monte carlo framework as they allow to create multiple realizations of heterogeneity as well as different types this approach is chosen here as we want to systematically evaluate the combined effects of sediment heterogeneity on hf and rt we focus on streambed ripples as these smaller morphological features are the most relevant for total hyporheic exchange pryshlak et al 2015 stonedahl et al 2013 bedform driven hyporheic exchange with stochastically generated hydraulic conductivity fields is numerically simulated the model setup is intentionally kept simple 2d domain idealized bedforms and pressure variations at the streambed surface in order to allow for a large number of scenarios and comparability to analytical solutions which is in line with other systematic investigations on hyporheic exchange and residence times boano et al 2009 cardenas and wilson 2006 hester et al 2013 tonina et al 2016 in total 10 000 different geostatistical realizations of heterogeneous k fields where simulated with a 2d model setup representing a segment of a streambed with ripple induced pressure variations at the sediment water interface an analytical solution of hyporheic exchange fluxes and hyporheic residence time is derived for an anisotropic homogeneous sediment in this way the effects of heterogeneity on hf and rt can be evaluated against a set of homogeneous reference cases statistical analysis of these effects and systematic evaluation of the closed form solution of anisotropy allow for the development of an equivalent anisotropic k tensor we show an equivalent k tensor that is estimated from statistical moments without specific knowledge of the heterogeneous texture and imitates its heterogeneous target with respect to hf and median rt 2 methods 2 1 representation of heterogeneous sediments the streambed conductivity heterogeneity is represented by multiple realizations of different types of random fields and their transformations all based on sequential gaussian simulations sgsim all fields were calculated by the stanford geostatistical modeling software sgems remy et al 2011 the five methods differ in the variogram model exponential gaussian spherical and in the distribution transformation applied to it binary log normal zinn harvey more specifically the combinations gaussian log normal exponential log normal spherical log normal gaussian binary and gaussian zinn harvey were used as shown in fig 1 the distribution transformations aim to change the conductivity distribution of the random fields from gaussian as provided by sgsim to a specified distribution while preserving the original spatial correlation and visual appearance the binary transformation assigns a predefined high or low conductivity value to the cells using their median as threshold this creates a representation of two discrete hydrofacies with independent deposits and thus non continuous k distributions such independent hydrofacies can be formed by channel and bedform migration lunt et al 2004 the log normal transformation is commonly known as score transformation knudby and carrera 2005 or histogram transformation remy et al 2011 targeting a log normal distribution more specifically the cells are ranked by their conductivity values based on these ranks corresponding conductivity values are calculated from the quantile function of a log normal distribution this transformation ensures that all fields adhere to the same statistical distribution fig 1 lower right panel a prerequisite for comparison between different fields the zinn harvey transformation also known as absolute value transformation was developed by zinn and harvey 2003 and successfully used by knudby and carrera 2005 in order to obtain a better connected random field than the regular gaussian random field it was based on the idea that gaussian random fields usually consist of poorly connected high low conductivity areas embedded in a highly connected medium value matrix consequently zinn and harvey developed a transformation that turns medium values into high values more technically the negative absolute values are taken from a normally distributed gaussian random field hence turning high values to low values this transform shifts the values which had previously been in the medium range to higher values at the upper end of the new distribution a log normal transformation transforms this distribution to the targeted log normal distribution of conductivity values see knudby and carrera 2005 fig 5 for an illustration of the method the resulting fields have enhanced high k connectivity which is common in many natural geologic media e g alluvial sediments zheng and gorelick 2003 the random fields are parametrized by the mean μ ln k of the natural logarithm of the hydraulic conductivity k its standard deviation σ ln k 2 the two correlation lengths lx ly i e the ranges of the underlying variograms and the azimuth of the variogram α which allows the creation of cross bedding structures note that some of the aforementioned transformations alter the correlation lengths of the random fields gong et al 2013 zinn and harvey 2003 therefore lx and ly can not directly be compared between different transformations but only between fields transformed with the same method for each of the five random field methods 2000 realizations were created each with an individual randomized set of σ ln k 2 lx ly and α which sums up to the total of 10 000 different heterogeneity fields being modeled the parameter ranges were selected to cover the range of values reported in the literature μ ln k was kept constant in all realizations at 8 9548 σ ln k 2 was sampled from 0 σ ln k 2 6 76 according to the values provided by σ ln k 2 0 148 and σ ln k 2 0 937 bardini et al 2013 sawyer and cardenas 2009 σ ln k 2 1 0 and σ ln k 2 2 0 salehin et al 2004 up to σ ln k 2 6 65 zhou et al 2013 the case with the highest σ ln k 2 6 76 corresponds roughly to a binary composition of silty loam k 10 5 m s and medium to coarse gravel k 1 7 10 3 m s gelhar 1993 reported 0 24 σ ln k 2 4 6 to be commonly found in glacial groundwater bodies formed by fluvial or alluvial processes the intervals of the remaining randomized parameters can be found in table s1 in the supporting information 2 2 hydraulic model the subsurface model was set up as a 2d rectangular grid and discretized into 2001 501 cells in horizontal and vertical direction respectively a sinusoidal hydraulic head distribution was applied at the sediment water interface representing a rippled riverbed fig 2 the fully saturated steady state flow field within the domain was calculated using the finite volume model min3p mayer et al 2002 the hydraulic head distribution at the interface and at the up and downstream boundary is calculated as 1 h z 0 0 28 u 2 2 g h 0 34 d 3 8 sin 2 π λ x s x according to elliott and brooks 1997 where u is the stream velocity g is the gravity h is the bedform height d is the stream depth λ is the length of a virtual bedform s is the slope and x is the coordinate in flow direction starting at the upstream boundary of the domain eq 1 was originally developed from experimental data of dunes λ 3 ft fehlman 1985 but has since then successfully been used to model also head distributions of shorter wavelengths e g λ 15 cm fox et al 2014 in order to minimize effects of the upstream and downstream boundaries the head distribution of p 10 bedforms was applied to the domain of 2 m length and 0 5 m depth all other hydraulic and geometric parameters representing the stream and the bedforms were selected based upon the massillon case from sawyer and cardenas 2009 and can be found in table s2 in the supporting information as restrictions to the depth of the streambed were not part of this study an infinite depth domain was desirable such an infinite domain depth was used in the analytical solution section 2 3 the simulation domain however needs a bottom boundary we chose a no flow boundary at a depth of 0 5 m which we tested to be sufficiently deep to avoid boundary effects all random field realizations were simulated using the same model setup for further information on the parameterization see the source code and min3p input file template in the supporting information 2 3 analytical solution for anisotropic homogeneous conductivity the effects of heterogeneity are evaluated with respect to both isotropic and anisotropic homogeneous sediments in order to effectively generate the homogeneous reference cases an analytical solution is developed to solve the flow field for an anisotropic homogeneous case isotropic homogeneity is a special case of this general anisotropic solution the residence time and hyporheic flux are derived using the method of elliott and brooks 1997 as shown in appendix a the most simple case of anisotropy with a diagonal conductivity tensor 2 k k x x 0 0 k z z and an anisotropy ratio of 3 r k x x k z z is used to compare homogeneous anisotropic homogeneous isotropic r 1 and heterogeneous sediments it is shown in eq a 3 that for a semi infinite domain without slope the head field 4 h x z h 0 e r 2 π λ z sin 2 π λ x develops with the maximum boundary head amplitude h 0 it can be seen that anisotropy affects the vertical expansion of the hyporheic zone i e a lower vertical conductivity leads to a shallower hyporheic zone from this head field the seepage velocity uz of a hyporheic streamtrace infiltrating the sediment at point x 0 z 0 0 is derived in eq a 12 as 5 u z x 0 h 0 2 π λ k x x r sin 2 π λ x 0 the magnitude of the volumetric flow is inversely proportional to the square root of the anisotropy ratio r the exfiltration time te of a single particle infiltrating the sediment at x 0 z 0 0 is derived in a 11 as 6 t e x 0 φ λ k x x h 0 π x 0 cos 2 π λ x 0 with the porosity φ te is independent from r which allows for the choice of arbitrary uz to te ratios through changes in r the calculation of anisotropic qh and flux weighted r t from eqs 5 and 6 yields rather complex equations without generating any more insight towards the general behavior of anisotropic hyporheic flux and residence time that could not be derived from eqs 5 and 6 for a mutual validation of both the analytical solution and the numerical simulations selected homogeneous cases were calculated and simulated to test for equal behavior with respect to changes in kxx and kzz by calculating and simulating three homogeneous cases with ln k 8 95 8 95 ln k 8 95 10 95 and ln k 10 95 10 95 to check for equal behavior with regard to changes in overall conductivity and anisotropy 2 4 post processing hyporheic residence times were evaluated using stream traces calculated from the steady state flow field using paraview ayachit and avila 2015 seeds of the stream traces were placed in the cell centers of the uppermost layer in the analysis were considered only those stream traces that both enter and exit the domain via the sediment water interface hence ignoring flow over the up and downstream boundaries of the domain hyporheic fluxes were calculated from the seepage velocity at the infiltration points of the hyporheic stream traces the flux weighted median of the travel times of the stream traces r t and the total hyporheic volumetric flow rate qh were used as dependent variables to evaluate the influence of heterogeneity on hyporheic exchange additionally to evaluate the heterogeneity induced variations of hyporheic flowpaths the equivalent volume veq was calculated from r t and qh the underlying idea of veq is based on the fact that volume conservation requires 7 v q r t for an arbitrary streamtube where v is the volume enclosed by the tube q is the volumetric flow rate and rt is the residence time similarly the equivalent volume is calculated as 8 v e q q h r t if the flowpath geometries were invariant between different realizations qh and r t would be related inversely proportional and thus veq stayed constant in contrast if a constant volumetric flow was focused on a decreasing volume fraction of the domain the rt distribution and thus r t shifted towards shorter residence times independent from qh consequently veq decreased in studies that have targeted aquifer heterogeneity in the context of stream aquifer exchange the importance of the uppermost sediment layer represented by the top layer of the modeling domain has been emphasized kalbus et al 2009 similarly for hyporheic exchange hydraulic conductivities in the uppermost sediment layers are most decisive for net hyporheic flux qh and median residence time r t as head gradients h are largest there and decline exponentially with depth z according to eq 4 9a h h x 2 h z 2 9b h h 0 2 π λ e r 2 π λ z cos 2 2 π λ x r sin 2 2 π λ x to evaluate this effect the conductivity parameters μ n ln k and σ n ln k were additionally calculated for the upper layer of 1 2 4 6 8 10 20 40 100 400 mm thickness measured from the interface for scale independent comparability those sections of the uppermost layers were named by fractions of the bedform wavelength λ i e n 0 5 1 2 3 4 5 10 20 50 100 200 λ those upper layer statistics have merely been recorded in post processing not modified in pre processing because the large variety of random fields provided sufficient variations in these upper layer statistics with the additional upper layer statistics the influence of a total of 29 different predictor variables namely μ n 0 5 200 σ n 0 5 200 μ ln k σ ln k σ ln k 2 α lx ly and randomfield method on the three response variables r t qh and veq can be evaluated in order to sort those predictors by their relative importance a forward stepwise regression model was used james et al 2013 such a model starts with a linear regression without any predictors and then one at a time adds the predictor that improves the model most this method ultimately yields 30 linear regressions per response variable based on 0 1 2 29 predictors by the nature of this method each additional predictor improves the fit to the training data set but not necessarily to an unseen validation data set this leads to an overfit of the training data with additional predictor variables that are irrelevant when used with an unseen data set this raises the need for an evaluation of the regressions on a test data set we performed such an evaluation via cross validation which divides the data set in several combinations of training and test sets and calculates the actual improvement of the regressions on unseen data allowing the selection of the most important predictors and omitting the less important ones 3 results streambed heterogeneity generally increased qh and decreased r t compared to an isotropic homogeneous streambed of equal μ ln k we found a decaying exponential relationship between r t and σ ln k 2 and a positive exponential correlation between qh and σ ln k 2 a linear regression between ln r t and ln qh with σ ln k 2 yielded 10 r t h e t e 0 89 σ ln k 2 r t h o m r 2 0 75 for log normal distributed k e 0 47 σ ln k 2 r t h o m r 2 0 89 for binary distributed k and 11 q h h e t e 0 36 σ ln k 2 q h h o m r 2 0 67 for log normal distributed k e 0 24 σ ln k 2 q h h o m r 2 0 79 for binary distributed k which results in the linear dependencies shown in log linear space in fig 3 a and b the coefficients of determination r 2 in eqs 10 and 11 were calculated from logarithmic data as shown in fig 3 we found a decreasing relationship between veq and σ ln k 2 fig 3 c which indicates changes in the geometry of flowpaths between different scenarios more specifically in sediments characterized by strong heterogeneity the volumetric flow is restricted to a smaller portion of the domain at higher flow velocities this does not necessarily imply that the flowpaths are shallower instead a visual inspection of the flow fields e g fig 2 suggests that the hyporheic flux is focused on highly conductive zones which provide efficient preferential flow paths e g chen and zeng 2015 fox et al 2016 salehin et al 2004 scheibe and yabusaki 1998 in homogeneous sediments veq obtained from eqs 5 and 6 does not change with conductivity but is only sensitive to changes in anisotropy that means anisotropic homogeneous sediments would have the same veq as long as the ratio r k x x k z z is constant because the hyporheic flowpaths are equally long and deep with changes in r flowpaths are deeper r r 0 or shallower r r 0 than the original r 0 flowpaths and thus veq increases or decreases with v e q 1 r fig 3c is color coded by the different random field methods and indicates that all methods but the binary showed similar behavior of veq which was also found for r t and qh not shown here scenarios with the binary random field method showed a similar trend but a lower exponential coefficient between r t qh and veq and σ ln k 2 another perspective on this data is shown in fig 4 where r t is plotted over qh in log log space for both heterogeneous and homogeneous realizations we found that 12 r t q h 1 for homogeneous k of constant anisotropy r q h 2 33 for heterogeneous k i e r t tended to be significantly lower for a given qh under heterogeneous conditions than under isotropic homogeneous conditions which again shows that a large part of the hf is restricted to a smaller part of the domain in heterogeneous sediments on the same figure a family of curves describing various anisotropic homogeneous scenarios is plotted it should be noted from eq 6 that the exfiltration time and thus the median residence time r t depends solely on the horizontal conductivity kxx not on the vertical conductivity kzz and thus not on the anisotropy of the homogeneous conductivity this allows the design of any desired qh to r t ratio by changing either kxx for changes in both qh and r t or kzz for adjustments in qh only weighting the residence time by the volumetric flow of the streamtraces as it is done in section 2 4 will not affect this independence of the residence time of the vertical conductivity because only the magnitude of the flow is affected by r which therefore will be canceled out in the weighting process this independence of r t of kzz is shown by the horizontal dotted lines in 4 which show the r t to qh ratios for homogeneous sediments of equal kxx but varying kzz we have tested the importance of the hydraulic conductivity of the upper sediment layer because it is known to have a strong influence on exchange processes see section 2 4 as expected from eq 9 the results of the stepwise regression model suggest that both r t and qh were mainly controlled by conductivity properties of the uppermost zone to be precise the model selected σ 2 λ μ 1 λ and σ 5 λ μ 5 λ to be the two most important predictors for r t and qh respectively further predictors such as random field method lx ly or α had almost no relevance regarding model prediction performance table s3 s4 supporting information the importance of the upper layer is illustrated by fig 5 which shows the prediction performance of various models for r t and qh given the conductivity metrics μ n ln k and σ n ln k of upper layers of different thicknesses the figure shows that calculating μ n ln k and σ n ln k from very thick layers reduces model performance by averaging the effect of the important upper layer conductivity information with less important lower layer information similarly calculating those metrics from very thin layers drops too much information and again decreases model performance although the decline in model performance was not as strong as for large layers within the boundaries of our investigations the best prediction of r t and qh is obtained from conductivity metrics calculated from an average of 1 5 λ which is equivalent to 2 10 mm or 2 10 cells in this case finally it has to be noted that the upper layer of a gaussian random field is not independent of the layer underneath which raises the need for further investigations on the importance of the upper layer of the hz 4 discussion the exponential relationship between r t qh and σ ln k 2 as shown in eqs 10 and 11 is in good agreement with prior studies that investigated a variety of heterogeneity scenarios fig 6 for example zhou et al 2013 reported an increase of qh of almost one order of magnitude 9 2 in a bimodally distributed heterogeneous streambed of σ ln k 2 6 65 compared to a homogeneous streambed of equal μ ln k similarly eq 11 yields an increase of q h h e t 11 0 q h h o m and q h h e t 4 9 q h h o m for log normal distributed and binary distributed conductivity respectively given the same σ ln k 2 in contrast to this strongly heterogeneous case sawyer and cardenas 2009 and bardini et al 2013 assumed much lower variances of k σ ln k 2 0 148 and σ ln k 2 0 937 for the streambeds they investigated they argued that their streambeds were part of one depositional facies for which hydraulic conductivity tends to vary less than for sediments consisting of different depositional facies sawyer and cardenas 2009 concluded that heterogeneity had a minor effect due to small changes in rt and qh qh was found to vary only by factors of 0 8 and 1 2 compared to the homogeneous case which is in good agreement with the factor 1 05 and 1 4 calculated from eq 11 for σ ln k 2 0 148 and σ ln k 2 0 937 respectively similarly r t was found to vary by factors of 1 36 and 0 47 which is an acceptable agreement with the factor 0 88 and 0 43 calculated from eq 10 note that sawyer and cardenas 2009 use an advanced anisotropic equivalent homogeneous case based on flux simulations rather than a simple statistical equivalent like the geometric mean this and the fact that sawyer and cardenas 2009 simulated only one selectively placed heterogeneous field might explain the anomaly of the weakly heterogeneous massilon case in addition to these studies salehin et al 2004 investigated both rt and qh in discrete heterogeneous streambeds with σ ln k 2 1 0 and σ ln k 2 2 0 for σ ln k 2 1 0 salehin et al 2004 found r t to decrease in heterogeneous sediments by a factor 0 65 which agrees well with r t h e t 0 63 r t h o m and r t h e t 0 41 r t h o m from eq 10 for binary and log normal distributed conductivity respectively however the ratio between r t for the heterogeneous and homogeneous cases was found to be almost equal 0 64 under σ ln k 2 2 0 which is contradictory to our general findings but a good example of how variable qh and r t may be for single experiments this variability is indicated by the increase in qh and r t variance with σ ln k 2 in fig 3 and emphasizes that our findings are most useful for large scale or upscaling techniques whereas single small domains that do not behave ergodic may show a different behavior the importance of the uppermost layer which is shown in fig 5 and was previously reported by kalbus et al 2009 is a possible explanation for the unexpected similarity between the two heterogeneous experiments by salehin et al 2004 in both experiments a layer of homogeneous sand was added to the top of the heterogeneous sediment to shape the bedforms consequently both experiments had equal hydraulic conductivity of the uppermost zone which might have overruled the effects of the different heterogeneous structures underneath pryshlak et al 2015 investigated hyporheic exchange comparing a large variety of both high contrast 7 6 σ ln k 2 11 9 and low contrast 0 84 σ ln k 2 1 32 binary heterogeneous sediments to homogeneous sediments of equal μ ln k pryshlak et al 2015 provides a data set of 20 rtds and hf for different heterogeneous and homogeneous scenarios which allowed the evaluation of eqs 11 and 10 on a relatively large data basis we found the data to be in good agreement with our model given that the variance of both rt and qh tends to increase with variance in k note that the original article was corrected for an erratum concerning the relevant data in april 2018 similar to our approach tonina et al 2016 conducted monte carlo simulations of heterogeneous hyporheic sediments but their results do not agree with our findings contrary to our findings they predicted weakly declining qh and increasing median rt with σ ln k 2 the data basis of both our study and tonina et al 2016 is large enough to rule out stochastic deviations i e the difference of their results must be systematically based on the different study design one potential reason for the different results is the effect of gaining groundwater flux which has been included in tonina et al 2016 however fox et al 2016 conducted similar simulations including both gaining and losing conditions without finding such an effect other than that the domain size and shape the stream trace analysis or the random field generation might play a role but we could not identify the most decisive factor for the observed discrepancies with absolute certainty finally fox et al 2016 investigated the effect of ternary clustered heterogeneity and concluded that the isotropic homogeneous geometric mean conductivity needs to be corrected by a factor of e 0 183 σ 2 to match heterogeneous qh which is close to the factor of e 0 24 σ 2 for binary fields in eq 11 cardenas et al 2004 introduced the dimensionless number nh to quantify the influence of heterogeneity compared to external forcing mechanisms denoted as ne on the geometry of the hz nh was defined as 13 n h σ ln k 2 l v z h z and ne was defined as 14 n e 4 h 0 λ s with the vertical extend of the homogeneous hz zhz and the vertical correlation length lv which is calculated from lx ly and α in this case nh was used in studies that focused on hf and hyporheic rt e g sawyer and cardenas 2009 zhou et al 2013 however both cardenas et al 2004 and zhou et al 2013 emphasized the need for confirmation of its definition and significance because of the weak influence of correlation lengths and angles on hyporheic processes found in this study we suggest cutting the geometric variables from the dimensionless number and use 15 n h n e w e σ ln k 2 instead of the original nh n h new is linearly correlated with ln r t ln qh and ln veq we found that n h new shows a significantly stronger correlation than nh when used to predict any of the aforementioned hf measures in fact a linear regression of our data using nh as a predictor yielded the coefficients of determination r q h 2 0 53 r r t 2 0 49 and r v e q 2 0 39 compared to r q h 2 0 66 r r t 2 0 71 and r v e q 2 0 64 when using n h new eq 12 and fig 4 demonstrate that there is no isotropic homogeneous sediment that represents a heterogeneous sediment with respect to both r t and qh be it based on the geometric mean the arithmetic mean or any other isotropic conductivity when fitting an isotropic homogeneous conductivity to match qh the homogeneous r t will be overestimating the corresponding r t of a heterogeneous sediment and vice versa the strength of this deviation depends on σ ln k 2 as shown by the color scale in fig 4 and by v e q q h r t in fig 3 c for example a homogeneous model that was fitted to match qh of a moderately heterogeneous sediment with σ ln k 2 1 would show a r t that is about 1 7 times longer than the corresponding heterogeneous one however an isotropic homogeneous model that was fitted to qh of a heterogeneous sediment with σ ln k 2 6 65 as in zhou et al 2013 would overestimate r t by about a factor of 36 an equivalent homogeneous case can be obtained by choosing an anisotropic homogeneous conductivity tensor that generates equivalent results in both residence times and hyporheic exchange such an equivalent anisotropic conductivity tensor can be obtained from eqs 5 6 10 and 11 16a r t h e t e a σ ln k 2 r t h o m i s o e μ ln k k x x e q r t h o m i s o 16b k x x e q e μ ln k a σ ln k 2 and 17a q h h e t e b σ ln k 2 q h h o m i s o k x x e q k z z e q e μ ln k q h h o m i s o 17b k z z e q e μ ln k 2 b a σ ln k 2 with a 0 89 b 0 36 for log normal distributed heterogeneity and a 0 47 b 0 24 for binary distributed heterogeneity as an example eqs 16b and 17b can be used to calculate equivalent anisotropic conductivity vectors for the moderate and the extreme heterogeneous cases of sawyer and cardenas 2009 and zhou et al 2013 the equivalent anisotropic conductivity vector for the moderate log normal distributed heterogeneity of μ ln k 8 95 and σ ln k 2 1 0 yields l n k x x 8 06 and l n k z z 9 12 or an anisotropy ratio of r 2 9 for the more extreme binary heterogeneity of equal μ ln k but higher variance σ ln k 2 6 65 the equivalent anisotropic conductivity yields l n k x x 5 82 and l n k z z 8 88 or an anisotropy ratio r 21 3 to give an additional field study based example pryor 1973 reported a conductivity distribution of μ ln k 7 195 and σ ln k 2 0 39 from measurements on the whitewater river bar assuming a lognormal conductivity distribution we expect r t to decrease by 29 and qh to increase by 15 due to heterogeneity the river bar could be represented by an anisotropic sediment of l n k x x 6 85 and l n k z z 7 26 i e an anisotropy ratio of r 1 5 it should be noted that these equivalent anisotropic homogeneous cases do not reflect the actual anisotropy of the heterogeneous fields in fact the independence of the heterogeneous results of correlation lengths and correlation angles indicates that the heterogeneous fields chosen in this study have little local anisotropy at all which is most likely due to the fact that the integral scales of the fields are of similar dimension as the hyporheic flow cells instead the hyporheic flow cells of the heterogeneous and the equivalent anisotropic homogeneous cases might have completely different shape but a similar equivalent volume the heterogeneous flow cells evolve along highly conductive areas that might be deep or shallow whereas the anisotropic flow cells develop in shallower areas however this uniform reduction of flow cell depths adequately reflects the behavior of heterogeneous fields with respect to hyporheic r t and qh this simplification is useful if the sediment is treated as an ideal reactor that is solely controlled by reaction times and concentrations neglecting the potential need for spatial information like reaction volume or exchange depth the fact that it can be easily calculated from just the variance and median of the heterogeneous conductivity distribution makes it an ideal tool for combined field and simulation studies as spatial information is difficult to obtain point wise conductivity measurements could be used to calculate the required statistical metrics and improve an accompanying numerical model by using an equivalent anisotropic conductivity to simulate hf and rt 5 conclusions our results demonstrate that there is no unique but yet a systematic effect of heterogeneity on hyporheic flux hf and residence times rt thus we conclude that heterogeneity is neither generally important zhou et al 2013 nor negligible bardini et al 2013 the effect of heterogeneity on hf and rt depends mainly on the variance of k in fact r t decreases exponentially while qh increases exponentially with σ ln k 2 this exponential relationship can be seen in both discrete and continuous heterogeneity fields yet exponential coefficients vary slightly between the two types hf is focused on smaller high conductive well connected fractions of the domain in heterogeneous sediments this reduction of effective seepage volume promotes faster focused flow and hence lower rt compared to homogeneous sediment of equal hf as a consequence of this focusing of flow paths there exists no equivalent isotropic homogeneous sediment that matches both hf and rt of the respective heterogeneous one anisotropic homogeneous sediments however reduce the seepage volume in a similar fashion and consequently affect hf and rt in a similar way compared to heterogeneous sediments the anisotropic conductivity tensor presented can be used to account for the effects of heterogeneity on hf and rt without detailed knowledge of the spatial arrangement of hydrofacies and purely on the basis of statistical moments of the conductivity distribution both numerical and analytical models that target hyporheic exchange may benefit from this simplification which removes the necessity to characterize the full complexity of heterogeneity and instead allows to quantify the integral impact of heterogeneity on hf and rt by means of the moments of the heterogeneity distribution acknowledgements preprocessed simulation data and the source code that was used to generate and process the data can be found in the supporting information this research was supported by a grant nr 1158 132 8 2011 from the gif the german israeli foundation for scientific research and development we thank audrey sawyer and one anonymous reviewer whose critical and constructive comments significantly helped to improve the article appendix a anisotropic hyporheic exchange the method shown in this section was developed by elliott and brooks 1997 here it is expanded to describe also anisotropic conductivities which has been done in a similar fashion by zlotnik et al 2011 for a closed form solution of hyporheic exchange in an anisotropic medium the domain of fig 2 is simplified to a 2d semi infinite plane furthermore the head boundary condition of eq 1 is simplified to a sinusoidal head without slope yielding a 1a h z 0 h 0 sin x a 1b h z 0 a 1c h x h x 2 π with x 2 π λ x and z 2 π λ z both of these simplifications allow an easier solution of the flow field and are believed to have minor effects on the conclusions drawn from the results on this domain the anisotropic laplace equation a 2 k x x 2 h x 2 k z z 2 h z 2 0 with a diagonal conductivity tensor is solved with respect to the boundary conditions in eq a 1 by a 3 h x z h 0 e r z sin x thus darcy s law u u x u z t k h results in the vertical and horizontal seepage velocities a 4a u x φ d x d t k x x h 0 2 π λ e r z cos x a 4b u z φ d z d t k z z h 0 2 π λ r e r z sin x with porosity φ and time t defining u 0 k x x h 0 2 π λ yields a 5a u x u 0 e r z cos x a 5b u z u 0 r e r z sin x from this velocity field streamtraces can be defined by the set of points with dimensionless coordinates x and z that follow the velocity field a 6 d z d x u z u x 1 r tan x and thus for a given infiltration point 0 x 0 π 2 z 0 0 t 0 a 7 z 1 r l n cos x cos x 0 from a 4 a 5 and a 7 we can derive the respective x coordinate via a 8a φ λ 2 π d x d t u 0 exp ln cos x cos x 0 cos x a 8b φ λ 2 π d x d t u 0 cos x 0 a 8c x x 0 u 0 φ 2 π λ t cos x 0 for completeness but not used here the z coordinate of a streamtrace can be derived via a 9 z 1 r l n cos x 0 u 0 φ 2 π λ t cos x 0 cos x 0 from the symmetry of the problem we know that a streamtrace that infiltrates at x 0 exfiltrates at x 0 the respective exfiltration time t r t x 0 can be calculated by eq a 8 as a 10 t e x 0 φ λ u 0 π x 0 cos x 0 or a 11 t e x 0 φ λ k x x h 0 π x 0 cos 2 π λ x 0 the volumetric flow of a hyporheic streamtrace can simply be derived by its vertical seepage velocity in eq a 4 at its infiltration point a 12 u z x 0 z 0 h 0 2 π λ k x x r sin 2 π λ x 0 supplementary material supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2018 10 003 appendix b supplementary materials supplementary data s1 supplementary raw research data this is open data under the cc by license http creativecommons org licenses by 4 0 https data mendeley com submissions evise edit xt8xkvwjk3 submission id s0309 1708 18 30172 6 token 6fd5c956 d771 41a3 90b4 21e85306b209 supplementary data s1 ayachit avila 2015 u ayachit l s avila the paraview guide updated for paraview version 4 3 2015 kitware inc azizian boano cook detwiler rippy grant 2017 m azizian f boano p l cook r l detwiler m a rippy s b grant ambient groundwater flow diminishes nitrate processing in the hyporheic zone of streams water resour res 2017 10 1002 2016wr020048 bardini boano cardenas sawyer revelli ridolfi 2013 l bardini f boano m cardenas a sawyer r revelli l ridolfi small scale permeability heterogeneity has negligible effects on nutrient cycling in streambeds geophys res lett 40 2013 1118 1122 10 1002 grl 50224 battin kaplan findlay hopkinson marti packman newbold sabater 2008 t j battin l a kaplan s findlay c s hopkinson e marti a i packman j d newbold f sabater biophysical controls on organic carbon fluxes in fluvial networks nat geosci 1 2008 95 100 10 1038 ngeo101 boano harvey marion packman revelli ridolfi wörman 2014 f boano j w harvey a marion a i packman r revelli l ridolfi a wörman hyporheic flow and transport processes mechanisms models and biogeochemical implications rev geophys 52 2014 603 679 10 1002 2012rg000417 boano poggi revelli ridolfi 2009 f boano d poggi r revelli l ridolfi gravity driven water exchange between streams and hyporheic zones geophys res lett 36 2009 10 1029 2009gl040147 cardenas wilson cardenas m b wilson j 2006 hydrodynamics of coupled flow above and below a sediment water interface with triangular bedforms ftp spacegrant hawaii edu glazer chen 20
726,a mixed discretization approach is proposed to accurately and efficiently resolve coupled multiphase flow and geomechanics in fractured porous media an extended finite element method xfem is applied to approximate the displacement field and a projection based embedded discrete fracture method pedfm is used to model the multiphase flow the proposed scheme resolves arbitrary intersections between fractures and the matrix the proposed discrete fracture treatment allows for embedded meshes where the matrix mesh need not conform to the geometry of the fractures it is demonstrated that the proposed xfem pedfm scheme is accurate for multiphase flow and geomechanics moreover the computational efficiency and robustness of linear and nonlinear solution methods is assessed it is demonstrated that the proposed scheme requires specialized solution methods in order to attain favorable computational efficiency keywords coupled hydro mechanics fractured porous media extended finite element method embedded discrete fracture method 1 introduction the dynamics of numerous systems at the nexus of water energy and the environment are governed by coupled multiphase flow and mechanics in fractured porous media in settings where the underlying fracture geometry offers no clear scale separation accurate models using homogenized multi continuum representations e g berryman and wang 1995 kim and moridis 2015 warren and root 1963 may be intractable as demonstrated in moinfar et al 2011 for example in such cases explicit representations of the fractures and the matrix are necessary fractured domains may be modeled explicitly in a variety of manners including by the application of phase field indicator methods e g heister et al 2015 lee et al 2016 miehe et al 2010 or by the inclusion of immersed boundaries e g karimi fard et al 2004 li and lee 2008 moinfar et al 2014 monteagudo and firoozabadi 2004 schwenck et al 2015 in the phase field method a phase indicator introduces a thin diffusive transition band between the damaged and undamaged material in such models local mesh refinement along the fracture paths may be used to more accurately resolve the coupled flow and geomechanics on the other hand a common variant of the immersed boundary approach that is applied to systems scale modeling uses lower dimensional representations e g a surface within a volume of fractures with an associated implicit aperture this representation considers the fracture aperture to be asymptotically small compared to the system s characteristic length scale and is consistent with for example the limiting assumptions of lubrication flow theory within fractures e g oron and berkowitz 1998 in such lower dimensional immersed boundary representations the discrete computational domain maybe be fitted or embedded in fitted approaches e g for flow juanes et al 2002 karimi fard et al 2004 monteagudo and firoozabadi 2004 and for mechanics goodman et al 1968 schellekens and de borst 1993 xie and waas 2006 the mesh representing the matrix is fitted to that of the fracture surfaces this is depicted in fig 1 a where edges of the triangular elements represent fractures with implied aperture since fracture geometry may not be regular fitted methods often employ unstructured mesh topologies subsequently the availability of a quality mesh generator is necessary and in the case of fracture propagation models the mesh generator must be used repetitively during the course of a simulation alternatively embedded methods superpose lower dimensional discrete fracture representations with a discrete matrix representation without requiring the two to coincide as depicted in fig 1 b in embedded representations the choice of mesh topology for the discrete matrix representation is not constrained by the fracture geometry embedded methods hold the promise of enabling fracture propagation models that utilize an entirely static underlying representation of the matrix domain this work focuses on the development of an accurate and computationally efficient numerical discretization scheme for coupled multiphase flow and mechanics in fractured porous media using embedded immersed boundary representations 1 1 review on embedded methods for geomechanics finite element methods fem accommodate embedded fractures by the introduction of elemental enrichment or nodal enrichment for the discontinuous displacement modes in the finite element method with embedded discontinuities referred to as e fem the finite elements are enhanced with local degrees of freedom to capture the displacement jumps across the discontinuity for example linder and armero 2007 and armero and linder 2008 alternatively in the extended finite element method referred to as xfem the theory of partition of unity melenk and babuška 1996 is applied and specific basis functions could be designed for the enriched nodes to capture different features of the discontinuity for example moës et al 1999 wells and sluys 2001 generally these formulations result in the similar solutions at similar convergence rates in oliver et al 2006 a comparison between e fem and xfem is reported with an emphasis on accuracy and computational cost in deb and jenny 2017 a finite volume discretization is proposed referred to as xfvm whereby enriched nodes are placed along the discontinuity to account for shear slip displacement in this scheme enrichment functions similar to those utilized by xfem are applied 1 2 review on embedded methods for multiphase flow xfem schemes can be applied to model flow in fractured porous media flemisch et al 2018 schwenck et al 2015 solve the single phase incompressible fluid problem while fumagalli and scotti 2013 deals with the two phase system using xfem additional degrees of freedom for each physical unknown may be placed at the center of matrix cells that are intersected by fractures and they may be enriched by discontinuous basis functions specifically in embedded meshes however the discretization of the interface problems must be enhanced to avoid sub optimal convergence behavior hansbo and hansbo 2002 the embedded discrete fracture method edfm proposed by lee et al 2001 and extended by li and lee 2008 hajibeygi et al 2011 moinfar et al 2014 jiang and younis 2016 employs a geometric static transmissibility to approximate the fluid exchange between fracture segments and the matrix edfm was originally proposed in the context of models for hydrocarbon recovery from unconventional fractured reservoirs in these applications primary depletion is the principal flow mechanism and multiphase flow effects are not as pronounced in ţene et al 2017 it is reported that edfm is not accurate in cases where the discontinuity acts as a barrier to flow e g sealing faults an improvement called the projection based edfm pedfm was proposed to address discrete fractures with a wide range of permeability in jiang and younis 2017 it is reported that edfm introduces large errors in the context of multiphase flow and an extension to the pedfm scheme was shown to provide accurate solutions in these scenarios 1 3 review on embedded methods for coupled flow and geomechanics the embedded methods for the coupled flow and geomechanics could be combinations of separate techniques mentioned in the previous two sections several typical coupling schemes between flow and geomechanics among literature are listed in the table 1 no literature has been published investigating the coupling between the finite element discretization using xfem for geomechanics and the finite volume discretization using pedfm for flow the coupled xfem pedfm addresses the accuracy in the multiphase transport problems inherited in the original formulation of the edfm as well as the interaction between the fluid flow and rock deformation the manuscript is formulated in this way the mathematical formulation of the flow and geomechanics problems investigated are stated in the first section the constitutive relationships used in the coupled model are introduced in the second section in the third section the discretization for flow and geomechanics is described in two separate parts the algorithm of the pedfm is briefly introduced in the first part the discretization of the xfem is elaborated in the next after that the nonlinear and linear solution strategies for the coupled system are illustrated numerical results regarding to the accuracy of the xfem and the coupled xfem and pedfm system are shown the results generated by pedfm xfem are compared to those by the fitted method unstructured discrete fracture method udfm in the last section the nonlinear and linear solver s performance are investigated 2 governing equations consider the closed and bounded spatial domain ω r n n 2 3 with external boundary γ γ n γ d γ n γ d and an associated outward oriented unit normal n γ suppose there are nf fractures in the domain the cracked region therefore is defined as c i c i i 1 2 n f r n c i denotes each separate fracture in the domain with an aperture d the fracture intersections λ i j c i c j i j 1 2 n f r n the intact porous media unbroken domain is denoted as ω r ω c the interface γ c c ω r r n 1 has a outward unit normal vector n c in this article assuming that d is asymptotically small compared to the characteristics length scale of the ω the fracture region c hence is reduced to an n 1 dimensional interface γc with the unit norm n c n c n c the intersection λ is correspondingly reduced to the space r n 2 which is a point in two dimension a curve in three dimension if we introduce the interval of time i t 0 t the space time domains are defined as ω i t 2 1 flow in the porous media and fracture we consider two immiscible fluid phases denoted by the subscript κ w n for the wetting phase and non wetting phase respectively the equations that describe the two phase flow considering the geomechanics effects are formulated for intact domain denoted as subscript m and fracture domain denoted as subscript f separately the primary unknowns are p κ m ω r i t r p κ f c i t r s κ m ω r i t r and s κ f c i t r the projection matrices n n c n c and t i n are introduced such that given i ω r and j ω r n the tangential gradient and tangential divergence operators on a curve or a surface are defined as γ i t i and γ j t j hence the flow equation in the matrix is 1 t ϕ m ρ κ s κ m ρ κ u κ m q κ m w q κ m f on ω r i t the flow equation in the fracture is 2 t ϕ f ρ x s κ f γ ρ κ u κ f q κ f w q κ f i q κ m f on c i i t the boundary conditions are 3a p κ m f p on γ d i t 3b u κ m n γ 0 on γ n i t either wetting phase or nonwetting phase pressure is prescribed on the dirichlet boundary γd the pressure function is f p γ d r the flux is set at zero on the neumman boundary γn furthermore the saturation satisfies the constrain σ s κ m 1 and σ s κ f 1 ρκ is the wetting or non wetting phase density q κ m w q κ f w are the source sink term in the rock matrix and fracture respectively q κ f i is the source sink term associated with the intersections q κ m f is the fluid flowing from matrix to fracture q κ f i and q κ m f are defined in the numerical discretization section ϕ m and ϕ f are defined as the lagrangian porosity which is quantified in the reference initial coordinate darcy velocity u of the phase κ is defined as in matrix 4 u κ m k m k r κ μ κ p κ m ρ κ g d h d z in fracture 5 u κ f k f k r κ μ κ γ p κ f ρ κ g d h d z where p κ m p κ f represents pressure for all phases in the rock matrix or fracture k m k f is the second order permeability tensor krκ is the relative permeability in each phase κ μκ is the phase viscousity g is the gravitational force d h d z is the evaluation gradient along z direction 2 2 geomechanics the primary unknown for the geomechanics is the rock displacement u ω i t r n the p m κ w n s κ m p κ m and p f κ w n s κ f p κ f are the average fluid pressure of wetting and non wetting phases the strong form of the momentum balance under the quasi static state is 6 σ u p m ρ b f 0 on ω i t 7a σ n γ t on γ n i t 7b u u on γ d i t 7c σ n c σ n c p f n c on c i t where σ is the second order stress tensor which is a function of the pressure and displacement ρb is the material bulk density f is the body force density the traction function is t γ n r n the prescribed displacement is u γ d r n 3 constitutive relationships in this section several constitutive relationships used in the flow and geomechanics are listed the biot s poroelastic theory is considered in the geomechanics model the modification of the permeability due to the aperture variation in the fracture is derived by an upscaling technique the relative permeability as well as fluid density correlations adopted in this manuscript are listed 3 1 biot s poroelastic theory the biot s theory biot and willis 1957 terzaghi 1960 characterizes the interaction between the stress and pore pressure in the single porosity system the effective stress law based on the single phase biot s poroelasticty theory could be written as 8 σ σ α p m i where σ is the total stress tensor σ is the effective stress tensor α 0 1 is the biotâs coefficient i is the identity tensor the effective stress σ is calculated based on the linear elastic theory 9 σ λ u i 2 g ɛ u where λ g 0 are lam e coefficients evaluated from properties of the matrix skeleton strain ε is a second order tensor infinitesimal deformation is considered and the strain tensor is a function of displacement 10 ɛ 1 2 t u u the volumetric strain is then defined as the trace of the strain 11 ϵ tr ɛ the lagrange porosity in matrix under linear poroelastic infinitesimal deformation is offered by dean et al 2006 12 ϕ m ϕ 0 α ϵ ϵ 0 1 m p m p 0 the lagrangian porosity in fracture under infinitesimal deformation reads 13 ϕ f ϕ 0 1 ϵ ϵ 0 where ϕ 0 ϵ0 and p 0 are the reference porosity volumetric strain and pressure respectively α and 1 m are biot s parameters 3 2 important fluid and rock properties the fracture aperture is considered to be the most influential factor of the flow in fractures the lubrication law can provide a simple relationship between the aperture and its permeability daneshy et al 1971 the derivation of the lubrication law assumes fluid flow in the parallel plate and the navier stokes solution shows that fluid velocity is proportional to the square of plate distance under the laminar flow consequently the fracture permeability could be 14 k f k f 0 w w 0 2 where k f 0 and w 0 are the reference fracture permeability and aperture we assume darcy s law is still applicable in the fracture through the correction term on the permeability the relative permeability for the wetting and non wetting phases in matrix is calibrated by the corey relationship 15a k r n k r n e n d s n s n r 1 s n r s w r n n 15b k r w k r w e n d s w s w r 1 s n r s w r n w a linear relationship is in fracture 16a k r n s n s n r 16b k r w 1 s n where k r w e n d k r n e n d are the end points of the wetting and non wetting phase relative permeability s w r and s n r are the residual saturation of the wetting and non wetting phases nn and nw are the exponential numbers the density of the fluid phase can be a function of its pressure the x in the following equation is defined as c r κ p κ m p 0 or c r κ p κ f p 0 then the density is approximated by the following 17 ρ κ ρ κ 0 1 x 0 5 x 2 where c r κ is the compressibility of the fluid phase κ p 0 and ρ κ 0 are the reference pressure and density respectively 4 numerical discretization we consider the mesh t h is a subdivision of the domain ω into disjoint elements k i e triangle or quadrilateral in two dimension and tetrahedron or cubic in three dimension therefore ω is the union set of all disjoint elements k t h k the diameter of element k t h is denoted by h moreover let t h be the mesh of fracture c t h i c i ω i 1 2 n f are the set of intersections between fracture and mesh grid similarly c is the union set of all fracture elements k k t h k the set of fracture fracture intersections in the discrete domain remain the same λ λ we introduce a partition of the time interval i t n t n t n 1 with δ t n i t n such that i t n i t n for n 0 n t in order to accurately capture the physical phenomenon of the fracture system in terms of the both fluid flow and geomechanics the pedfm xfem is proposed in the fluid flow simulation we use the pedfm model developed by jiang and younis 2017 the simulation of the geomechanics is handled by the xfem in the following part the pedfm is briefly introduced the methodology of the xfem is reviewed and the details of discretization of the geomechanics equation are given subsequently 4 1 introduction to the pedfm in the multiphase flow problems li and lee 2008 proposed the edfm model which employs the concept of the well index is designed for the single well depletion problem jiamin and younis shows large inaccuracies from edfm occur when there are asymmetries around the fractures and zero order of the saturation convergence rate based on the recent proposed pedfm method jiang and younis 2017 ţene et al 2017 improved and extended it to the multiphase phase displacement problems in addition to the regular flux between matrices pedfm handles the extra flux between matrix fracture and fracture fracture the discretized forms of the flux and souce sink terms present in eqs 1 and 2 are listed in the table 2 in the f f connections two circumstances occur first the flux through the face connecting two cells on a fracture second the flux through intersections connecting cells on two different fractures the intersection is treated as a zero volume point in other words no mass is stored here in the m f connections flux is conserved between matrix and fracture in the table 2 λκ ρκkrκ μκ is the fluid mobility and the fluid property associated with the sκ is dealt with the first order upwinding strategy φ κ m f p κ m f ρ κ g h is the fluid phase potential the key aspect of pedfm compared to edfm is the introduction of the additional fracture matrix m f connections in the fig 3 the blue arrows are the standard edfm connection lists the green arrows which make up additional connections force the flux directly into out of the fracture between m 2 m 1 and f the yellow lines in the figure shows the projected area a 13 p x and a 23 p y from the fracture to the edge of the grid block in x and y direction respectively the projected area is counted as the effect flow region from the neighboring matrix to the fracture the occurrence of the extra fracture and matrix connections blocks a fraction of the area yellow line for the flow between matrix connections therefore it is necessary to subtract the blocked area and update the m m connection transmissibility in the fig 4 the schematics of the connection list dependency shows the difference between the standard edfm and pedfm the tables 3 and 4 show the calculation of the connection transmissibility in the scenario of fig 3 ti is the half transmissibility for tij between matrix i and j t m i and tf are the half transmissibility for t f m i between matrix mi and fracture f di denotes the distance from the center of cell i to the interface aij is the interface area between gridblock i and j in the standard edfm d f m i is the average norm distance from the fracture in the gidblock i while in the extended f m connections d f m i is the distance from the center of the cell i to the center of the fracture segment af and ωf are the fracture surface area and fracture aperture respectively the transmissibility takes the value of the harmonic average of the half transmissibility in addition a physical way of the calculation of extended f m connections is the harmonic average of three items for the performance of the pedfm the author recommends interested readers to the jiang and younis 2017 4 2 xfem formulation in order to model discontinuity fields enriched basis fem is commonly applied the enrichment is realized through the basic mathematical foundation of the partition of unity finite element method pufem as proposed by melenk and babuška 1996 application specific ψ function can be included so that discontinuity can be handled without the need for the discontinuous surfaces to be aligned with the finite element mesh the global solution of pufem has been the theoretical basis of the extended finite element method in fig 5 different types of elements standard blending enriched and nodes standard heaviside enriched tip function enriched and junction enriched are shown we define the element set that contains the heaviside enriched node as ω h the tip enriched node as ω t the junction enriched nodes as ω j for xfem moës et al 1999 proposed an equation that can model crack surfaces and tips by step functions and asymptotic near tip fields later belytschko et al 2001 proposed the enrichment function for intersecting discontinuities consider there are multiple intersecting fractures present in the computational domain based on the classification we define the following four node sets and mapping functions which govern the enrichment i the set of all nodes in the region ω l i the set of nodes in the region ω h the mapping f l n n returns a set containing all the fracture c j that requires the enrichment of node i l k i the set of nodes in the region ω t the mapping f k n n returns a set containing all the fracture c j that requires the enrichment of node i k m i the set of nodes in the region ω j the mapping f m n n 2 returns a pair of fractures that requires the enrichment of node i m we denote f m 1 as the master fracture f m 2 as the slave fracture the displacement approximation is 18 u h i i n i u i i l j f l i n i h j h j i a i j i m j f m i n i j j j j i c i j i k j f k i l 1 4 n i f j l f j l i b i j l where ni is the basis function associated with node i u i is the regular displacement a i j is the displacement of heaviside enriched nodes the c i j is the displacement of junction enriched nodes b i j l l 1 4 are the displacement of tip enriched nodes remark 1 instead of the direct application of the hj jj and fjl as enrichment functions we shift the enrichment functions around the node of interest h j i j j i and f j l i are taken their values at the coordinates of the node i therefore the solution for the nodal value is exactly the displacement at the position moreover this formulation can avoid the blending elements enriched by the heaviside function given the node i find a fracture c j j f l i the signed distance function returns a positive or negative distance according to the position and its definition is 19 ξ j x min x x γ sign n c x x γ on c j where x γ is a projection of x onto a fracture c j the heaviside distribution is then defined by 20 h j x h ξ j x 1 ξ j 0 1 ξ j 0 finding a pair of fractures c j 1 and c j 2 j 1 f m 1 i and j 2 f m 2 i the junction function is defined as 21 j j x j ξ j 1 x ξ j 2 x 1 ξ j 1 ξ j 2 0 0 ξ j 1 ξ j 2 0 1 ξ j 1 ξ j 2 0 finding a fracture c j j f k i the tip enrichment functions are defined in terms of a polar coordinate system r θ located at the fracture j s tip where θ starts from the tangent line at the fracture tip counterclockwise note that only the first function in eq 22 is discontinuous across the surface π whereas the other three functions are continuous 22 f j l r θ r sin θ 2 r cos θ 2 r sin θ 2 sin θ r cos θ 2 sin θ 4 3 weak form and discretization the discretization of the strong form of the geomechanics eq 6 is based on the standard galerkin finite element method the weak form equation contains the interaction of different scales of fractures fluid pressure the trial functional space s and the test functional space v are defined as 23 s ω δ u δ u h 0 1 ω δ u 0 on γ u 24 v ω u u h 1 ω u u on γ u where the h 1 ω is the soblev space and the h 0 1 ω is the sobolev space which vanishes on the dirichlet boundary condition the weak form is to find the δ u s ω and u v ω such that 25 ω δ ɛ d ɛ d ω ω δ ɛ α p m i d ω γ n δ u t d γ n c δ u p f n c d c where d is a elastic tensor δ ε δ u is the variational form of the strain tensor ε in the last term on the right hand side the fluid pressure applied on the fracture surface is considered by the eq 18 the jump of the displacements on fracture c in terms of the discrete form can be 26 u h u h x u h x 2 i l j f l i n i a i j 2 i k j f k i n i f j 1 b i j 1 i m j f m i n i j j x j j x c i j on c where sign means the associated physical quantity on the fracture upper and lower surfaces separately therefore the crack opening displacement w h of fracture which is the projection of the displacement jump onto the fracture surface c could be 27 w h n u h given a scalar or a vector b ω r p p 1 n we define the jump of b b b over the fracture region c the n is the projection matrix defined in the previous section and the norm w w h is defined as the fracture aperture the discretized weak form can be expressed as the matrix vector form eventually the resultant linear system of geomechanics equation is 28 k u h f with k be the global stiffness matrix and f be the force vector the global stiffness matrix is assembled from the elementary level k and k in each element node i and j are the vertices element stiffness matrix k i j r s and force vectors f i u f i a f i c f i b l are 29 k i j r s k b i r t d b j s d k r s u a c b l i j 1 4 30 f i u γ n n i t d γ n k b i u t α p m d k 31 f i a γ n n i h f l i h f l i i t d γ n k 2 n i p f n c d k k b i a t α p m d k 32 f i c γ n n i j f m i j f m i i t d γ n k n i j f m i x j f m i x p f n c d k k b i c t α p m d k 33 f i b l γ n n i f f k i l f f k i l i t d γ n k n i f f k i l x f f k i l x p f n c d k k b i b l t α p m d k 34 b i u n i x 0 0 n i y n i y n i x 35 b i a n i h f l i h f l i i x 0 0 n i h f l i h f l i i y n i h f l i h f l i i y n i h f l i h f l i i x 36 b i c n i j f m i j f m i i x 0 0 n i j f m i j f m i i y n i j f m i j f m i i y n i j f m i j f m i i x 37 b i b l n i f f k i l f f k i l i x 0 0 n i f f k i l f f k i l i y n i f f k i l f f k i l i y n i f f k i l f f k i l i x where r s stands for different standard and enriched node types the linear quadrilateral element is applied in this manuscript we neglect the shear stress of the fluid so that the pressure tensor is simplified into a vector p m pm pm 0 t the gaussian quadrature rule is of good accuracy when applied to the element not cut by the fracture however the gaussian quadrature rule on the element cut by the fracture results in a poor accuracy due to the discontinuity in the integrand instead the element is subdivided into a bunch of triangles and the seven point triangular quadrature rule is adopted on each sub domain a special care should be taken for the integration in the element including the fracture tip the element subdivision plus gauss integration algorithm in each sub element will yield an inadequate precision by reason of the singularity in the first order derivative of the branch enrichment functions fjl a remedy is to enrich the integration points around the fracture tip the tensor product type gaussian quadrature rule transforms the standard triangular element t s t ξ η 0 ξ η ξ η 1 to the standard quadrilateral element rst and then apply the gaussian quadrature rule for r s t x y 1 x y one advantage is that a large number of quadrature points will be concentrated in a relatively small region near one vertex the transform is defined as 38 ξ 1 x 1 y η 1 y 2 5 solution strategy in this section we investigate the nonlinear solver employing the fully coupled scheme with iterative linear solvers for the full problem coupled methods are preferable regarding stability however this comes at the necessity of a linear solver that can deal with the scale differences between mechanics and flow as well as the cross couplings in between in contrast to this sequentially coupled methods kim et al 2011 have been widely used for solving the coupled flow and geomechanics problems fixed stress and fixed strain methods for instance solve the flow system first considering either stress or strain changes are constrained to zero the obtained pressure solutions are substituted into the geomechanics system in the second step the two steps above are performed iteratively till both systems are converged one of attractions of this method is that each system can take advantage of its own preconditioned linear solver however the sequentially coupled methods are conditionally stable and do not guarantee the convergence or take more iterations than the fully coupled methods a special preconditioner should be designed for the linear solver for the fully coupled method so as to improve the efficiency and speed solving the coupled matrix system the couplings between mechanics and flow which are affected by scale differences have to be dealt with the linear solver challenges that the result from cross coupling terms can hardly be erased completely the modifications of the coupling terms raises questions regarding its improvement on the solver s convergence speed as well as its effect on matrix properties and condition in general the sequentially coupled method modifies the coupling terms on the level of the nonlinear solver stage in the danger of sacrifice of the nonlinear convergence speed the fully coupled method using a preconditioned iterative linear solver modifies coupling term in the full matrix at the expense of possible failures of the linear solver in the second part of this section a good preconditioner for the coupled system is investigated 5 1 nonlinear solver in this work we use a mixed space finite volume and finite element discretization a finite volume method with two point flux approximation tpfa is used to discretize the fluid flow problem and the extended finite element method for the geomechanics simulation the primary variables are fluid pressure p w which encompasses the matrix and fracture pressures water saturation s n which consists of the matrix and fracture saturations as well and the displacement u which are set at the cell center cell center and corner point respectively the first order backward euler along with fully implicit scheme are used for the time discretization the resultant linear matrix is a fully coupled system which is solved iteratively by the newton raphson method 39 a p p c p s c p u c s p a s s c s u c u p c u s a u u δ p w δ s n δ u r p r s r u where the matrix is unsymmetrical and off diagonal terms are the coupling ones among primary variables the definition of the submatrices in the jacobian could be found in the appendix a the following solution algorithm is carried out at the time step n 1 remark 2 the initial state t 0 of the reservoir is determined by assuming a drained condition where fluids are free to flow in and out the system boundary therefore fluid pressure and saturation are remaining constant and only poromechanical deformation occurs at this step the related reservoir properties e g fracture permeability matrix porosity are updated as soon as the displacement field is obtained 5 2 linear solver we apply two different types of preconditioners for the investigation of a possible iterative linear solver the first one is the well known black box incomplete lu factorization ilu another famous preconditioner widely being used in scientific computation domain is the algebraic multigrid method amg griebel et al 2017 stüben et al 2017 tests to solve the coupled system are compared among ilu 0 threshold of ilu ilut and amg the software we use in the amg test is samg oil developed by the fraunhofer scai st augustin germany 5 2 1 ilu type preconditioners a preconditioned generalized minimal residual gmres method is used to solve the system the right precondioner is 40 j p 1 δ y r where δ y p δ x δ x is the true update ilu is used here to construct the preconditioner and defined as 41 a l u r where r elements that are dropped during the incomplete elimination process ilu0 takes the zero pattern to be precisely the zero pattern of jacobian matrix j however the ilut may outperform the ilu 0 by allowing more fill ins and improve the precondtioner accuracy when encountering a very complex linear system reverse cuthill mckee rcm is used to shrink the bandwidth of the linear matrix in order to reduce the fill in during the gaussian elimination moreover as more fill ins are allowed the beneficial effect of reordering become compilling saad 2003 rcm is a breadth first search algorithm every time finding the lowest degree node and sort its adjacency and append them to the result in fig 6 there is a significant reduction in the bandwidth of the linear system after applying rcm the original linear system is badly scaled because of the different unit system used in the flow and poromechanics problems rescaling the jacobian matrix is necessary to accelerate the convergence speed here each number in the matrix is divided by its diagonal term specifically 42 j i j i j i i and j j j j j i i therefore the algorithm is simply the following apply the rescale algorithm to the original jacobian matrix apply the rcm to the scaled jacobian matrix and store the permutation matrix only if ilut is used solve the linear system by the gmres combined with the ilu preconditioner till the convergence revert back the update vector to its original ordering by the stored permuation matrix only if ilut is used scale back the solution 5 2 2 system amg accelerated by the gmres the used system amg approach for the fully implicit system preconditions a flexible gmres to achieve a better performance and improve the robustness as the coupled system is considered amg needs to distinguish different groups of variables to apply an appropriate coarsening in the jacobian matrix the variables are pressure p saturation sw standard node displacement u heaviside enriched node displacement a tip enriched node displacement b and junction enriched node displacement c among them p sw sharing the same grid location are tied together as a point from amg perspective also each different types of node displacement in x and y direction at the same position form another separate point thus assuming that there are npts points system amg will consider the point based jacobian system 43 a 1 1 a 1 n p t s a n p t s 1 a n p t s n p t s u 1 u n p t s r 1 r n p t s where each submatrix a is a coupled one between different variables at a point u is the update of a point wrapping up different variables system amg is applied to the full linear system from the linearization process it combines a pre processing with the amg based solution process with techniques such as the drs scaling the pre processing aims at ensuring a robust applicability of amg despite the challenging physics the system amg solver then exploits the provided information on the different types of unknowns and points to construct an amg hierarchy based on those unknowns where the hierarchical solution process is beneficial in the used setting this amg setup is based on the unknown wise amg approach system amg also adjusts the smoother on the different levels to the amg setup since conventional smoothing techniques might be ineffective the conventional smoothing techniques might be ineffective on the coupled system due to the drastic scale difference between the flow and mechanical sub problems system amg here uses the remedy of an uzawa type smoother that employs incomplete factorization at the finest level and gauss seidel at the other levels for details of system amg we refer to gries 2015 whereas details regarding uzawa smoothing with algebraic multigrid are given by elman and golub 1994 and metsch 2013 6 results to benchmark the performance of the xfem pedfm we perform the tests through the following aspects compare xfem to udfm in pure mechanics cases test the model accuracy through examination of the convergence rates of the proposed xfem pedfm compare the results of xfem pedfm model to the udfm in coupled flow and geomechanics problems investigate the performance of the linear and nonlinear solvers for the xfem pedfm in the first case we generate pure mechanics problems showing the performance and efficiency of the xfem in comparison to udfm in the second case we show the convergence rates of pressure saturation and displacement fields in different fracture patterns in the third case the solutions of coupled fluid flow and geomechanics problems are compared between the pedfm xfem and udfm in terms of the distribution of the physical quantities pressure saturation displacement aperture and production rates in the last section the performance of preconditioners ilu 0 ilut and samg oil are compared in aspects of different mesh and time step sizes the nonlinear convergence speed is also recorded against different mesh sizes and time steps 6 1 pure mechanics test in order to calibrate the xfem accuracy we compare the xfem result to the udfm single inclined fracture and intersected fractures are tested in both cases as shown in the fig 7 e 0 5 gpa ν 0 3 and plane stress is assumed the boundary conditions of both cases are 44a u x 0 u y 0 on y 0 44b σ n n 5 e 10 6 pa on y l y the cpu time is normalized by the run time of the udfm the aperture difference δ is defined as 45 δ max w w ref w ref where the w is the aperture obtained by xfem solution and w ref considers udfm solution on a very refined mesh as the true in the single fracture case two different rectangular meshes 17 17 and 177 187 504 nodes and 33464 nodes are compared to the refined unstructured mesh with 862110 nodes xfem could get a good match with the udfm moreover much fewer elements along with reduced cpu time are required for xfem to get a satisfied result as we refine the mesh the aperture difference is decreasing and converges to the correct result in the case with two intersecting fractures xfem with the help of the junction enrichment function can predict the aperture jump at the intersection point the same as the udfm s result additionally a small number of nodes needed in xfem 9221 nodes can reach a satisfactory accuracy 6 2 accuracy test we will present three test cases with different fracture distributions in fig 10 to benchmark the performance of the coupled xfem pedfm simulation for multiphase flow convergence rate studies of unknowns i e pressure saturation and displacement are performed to show the numerical accuracy in the following tests the solution on coarse grids are compared to that on the finest grid assuming it is the most accurate one l 2 norm is calculated and its equation is 46a u 2 j 1 n ref i 1 n dim u i j h u i j 2 j 1 n dof i 1 n dim u i j 2 46b x 2 j 1 n ref x j h x j 2 j 1 n ref x j 2 where x represents for pressure p or saturation snw u i j and x j are the reference solutions n dim is the total number of dimensions i loops different dimensions in space j loops the number of reference points n ref chosen on the domain here the l 2 norm is calculated for the p and snw located in the matrix grid intact domain as well as only the standard displacement nodes u in the following tests the time step is chosen by maintaining the courant friedrichs lewy cfl number constant 47 δ t δ x 2 constant we generate three different fracture patterns to test the convergence rate of the xfem pedfm scheme the specification of the 2d sythetic case is shown in the table 5 oil o and water w consist of the two phase system the boundary conditions are 48a p x 0 u x u y 0 on x 0 48b p x 0 σ n n 10 7 pa on x l x 48c p 3 10 7 pa s 0 8 u y 0 on y 0 48d p 8 10 6 pa σ n n 10 7 pa on y l y no flow boundary conditions are applied at the left and right boundary the pressure is fixed at the top and bottom boundaries the saturation is maintained constant at the bottom second order approximations of dirichlet and neumann boundary conditions are implemented the details of implementation are given by aziz and settari 1979 the compressive force is applied onto the top and right of the domain the displacement is set as zero on the left and bottom boundaries in figs 11 13 the error of the matrix pressure matrix saturation and displacement are plotted versus mesh sizes in the single inclined fracture case the convergence rate of pressure is the second order which reaches the optimal saturation also shows the first order accuracy which agrees with the results shown in the jiang and younis 2017 in the pattern of single crossing and two crossing fractures the displacement and saturation maintained first order rate there is a degrade in the convergence rate of the pressure but a bit higher than first order ideally the fvm discretization is able to yield pressure second oder convergence rates saturation first order rates however the presence of fractures might degrade the optimal convergence rate in the classical xfem scheme a partition of unity is satisfied in standard and enriched elements even though the blending element is no longer a partition of unity it has little direct effect on the approximation when there is no singular point in the element the appearance of blending elements with singular points could decrease the convergence rate of xfem fries and belytschko 2010 the order of the convergence rate u 2 remains to o h for all types of elements second order or even higher order elements due to the loss of the partition of unity in the blending elements that have both tip enriched and non tip enriched nodes fries 2008 laborde et al 2005 béchet et al 2005 proposed a fixed area enrichment scheme instead of the topological tip enrichment shown in the previous section to improve the convergence rate besides the element containing the tip is enriched elements nodes within a prescribed geometry are enriched by the tip enrichment functions however the extra cost is the significant increase of the condition number of the linear matrix in this manuscript we adopt the topological scheme in order to release the extra burden from the linear solver side 6 3 comparison to udfm the accuracy of the xfem pedfm model is checked from another view with the comparison to the fitted method udfm the injection production type of multiphase flow and geomechanics problems are studied in fig 14 two different fracture patterns with wells located at corners of the domain are considered the input parameters are shown in the table 5 the well injection pressure is 3 107 pa and the well production pressure is 6 106 pa the boundary conditions are listed in eq 49 we compared two sets of the permeability contrast between fracture matrix the value is listed in the table 6 the purpose is to verify that the proposed model is accurate in different scales of permeability contrasts 49a p x 0 u x 0 on x 0 49b p x 0 σ n n 5 10 6 pa on x l x 49c p y 0 u y 0 on y 0 49d p y 0 σ n n 5 10 6 pa on y l y the distribution of primary unknowns matrix pressure matrix saturation and the magnitude of displacement are compared in figs 15 18 and 19 the results show that they all agree with each other well in two different models especially the saturation field near the fracture area reflects using the pedfm honor the true physical process fracture aperture is affected by two factors displacement of enriched nodes and fracture pressure the agreement of fracture aperture between two different methods validates the accuracy of the fracture pressure and geomechanics solver oil and water production rates get matched between two methods except a little discrepancy at early times 6 4 linear and nonlinear solver in this section we test the linear solver ilu 0 ilut n fill in ε and amg preconditioners and nonlinear solver for the xfem pedfm scheme in terms of various time step sizes and grid sizes the schematic of the domain is shown in fig 22 the input and boundary conditions are the same as case a of the comparison to the udfm the general setup of the linear solver used in this section is the following the outer krylov solver operating with a global coupled matrix is right preconditioned gmres the outer iteration runs with a convergence criteria of relative residual reduction of τ 10 8 in addition an overall limit of 5000 iterations is set the fill in level n fill in is defined as the half of the preconditioner bandwidth and the item will be dropped during gaussian elimination if smaller than the tolerance ε we also define the memory used to set up the ilu type preconditioners in the following equation 50 consumed memory in setup nnz l nnz u nnz a nnz means the total number of nonzero items in the matrix l and u are the upper and lower diagonal matrix of the ilu factorization of a matrix receptively similarly in samg oil the memory consumed is defined as the ratio between the total number of matrix entries summed over all amg levels and the number of entries in the matrix nnz a in the following test cases the memory consumed by ilut 50 1e 6 is about 5 times the memory of ilu 0 samg oil used roughly 2 5 times the memory of ilu 0 the performance of the linear and nonlinear solver is in the table 7 nl means the number of nonlinear iterations ln nl means the number of linear iterations per nonlinear iteration na means the total number of linear iterations exceeds the maximum from the results we find out nonlinear iterations increase with the growth of the time step the nonlinear solver can ensure the system converge even for a 10 000 time increase in the time step samg oil is less sensitive to the time step compared to ilu 0 and ilut at the finest mesh size 293 297 when the time step increases by 10 000 times the average linear iteration for δ t 10 is only 22 percentage larger than that for δ t 0 001 however the case with ilu 0 and ilut do not converge with larger δt at the fine mesh as time step decreases all three preconditioners converges with less iterations this is due to the fact that smaller time step could increase the extent of the diagonal dominanance samg oil shows better scalability than the ilu 0 and ilut when the mesh is refined a significant linear iteration growth is observed in the ilu type preconditioners generally speaking the samg oil and rcm ilut needs much fewer iterations than the ilu 0 however ilut needs roughly 5 times memory than that required in ilu 0 samg only requests half of the memory consumed by ilut therefore ilut reaches a decent convergence speed at the cost of extra memory additional research is performed with the samg team especially regarding the handling of fracture intersections to further improve the convergence speed conclusion in this manuscript we develop a fully coupled flow and geomechanics xfem pedfm suited for the multiphase flow problems we first verify the accuracy and efficiency of the xfem in pure mechanics problems next the accuracy tests are performed and the convergence rates of the pressure are a bit larger than the first order while convergence rates of the saturation and displacement are as expected first order the xfem pedfm also shows good agreement with the solution by the udfm nonlinear solver tests show that the nonlinear iteration steps increase but not significantly with the growth of mesh sizes and time steps generally speaking samg oil outperforms the gmres with ilu 0 and ilut preconditioners samg oil compared to ilu has better scalability in terms of the mesh size and time step ilu 0 takes the same sparsity pattern of the original linear system but fails with fine grids and large time steps ilut utilizes extra memory but gain a bit more stability in each linear solve samg oil converges for all test cases and only half of the memory is requested compared to the ilut 50 1e 6 acknowledgment this work was funded by tu future reservoir simulation systems technology fursst research consortium the authors would like to thank dr sebastian gries from fraunhofer scai for his help with the application of samg oil appendix a the definitions of matrix terms in the eq 39 are illustrated in details here the operator ij and i takes terms in the row i and column j of a matrix or the ith value of a vector respectively a 1 a p p i j r p i p w j 1 δ t ϕ ρ w s w i n 1 p w j k t μ w i k 2 k r w n 1 p w i p w k p w j a 2 a s s i j r s i s n j 1 δ t ϕ ρ n s n i n 1 s n j k t μ n i k 2 k r n n 1 p w i p w k s n j a 3 a u u i j r u i u j k i k u k f i u j a 4 c p s i j r p i s n j 1 δ t ϕ ρ w s w i n 1 s n j k t μ w i k 2 k r w n 1 p w i p w k s n j a 5 c p u i j r p i u j 1 δ t ϕ ρ w s w i n 1 u j k t μ w i k 2 k r w n 1 p w i p w k u j a 6 c s p i j r s i p w j 1 δ t ϕ ρ n s n i n 1 p w j k t μ n i k 2 k r n n 1 p w i p w k p w j a 7 c s u i j r s i u j 1 δ t ϕ ρ n s n i n 1 u j k t μ n i k 2 k r n n 1 p w i p w k u j a 8 c u p i j r u i p w j k i k u k f i p w j a 9 c u s i j r u i s n j 0 
726,a mixed discretization approach is proposed to accurately and efficiently resolve coupled multiphase flow and geomechanics in fractured porous media an extended finite element method xfem is applied to approximate the displacement field and a projection based embedded discrete fracture method pedfm is used to model the multiphase flow the proposed scheme resolves arbitrary intersections between fractures and the matrix the proposed discrete fracture treatment allows for embedded meshes where the matrix mesh need not conform to the geometry of the fractures it is demonstrated that the proposed xfem pedfm scheme is accurate for multiphase flow and geomechanics moreover the computational efficiency and robustness of linear and nonlinear solution methods is assessed it is demonstrated that the proposed scheme requires specialized solution methods in order to attain favorable computational efficiency keywords coupled hydro mechanics fractured porous media extended finite element method embedded discrete fracture method 1 introduction the dynamics of numerous systems at the nexus of water energy and the environment are governed by coupled multiphase flow and mechanics in fractured porous media in settings where the underlying fracture geometry offers no clear scale separation accurate models using homogenized multi continuum representations e g berryman and wang 1995 kim and moridis 2015 warren and root 1963 may be intractable as demonstrated in moinfar et al 2011 for example in such cases explicit representations of the fractures and the matrix are necessary fractured domains may be modeled explicitly in a variety of manners including by the application of phase field indicator methods e g heister et al 2015 lee et al 2016 miehe et al 2010 or by the inclusion of immersed boundaries e g karimi fard et al 2004 li and lee 2008 moinfar et al 2014 monteagudo and firoozabadi 2004 schwenck et al 2015 in the phase field method a phase indicator introduces a thin diffusive transition band between the damaged and undamaged material in such models local mesh refinement along the fracture paths may be used to more accurately resolve the coupled flow and geomechanics on the other hand a common variant of the immersed boundary approach that is applied to systems scale modeling uses lower dimensional representations e g a surface within a volume of fractures with an associated implicit aperture this representation considers the fracture aperture to be asymptotically small compared to the system s characteristic length scale and is consistent with for example the limiting assumptions of lubrication flow theory within fractures e g oron and berkowitz 1998 in such lower dimensional immersed boundary representations the discrete computational domain maybe be fitted or embedded in fitted approaches e g for flow juanes et al 2002 karimi fard et al 2004 monteagudo and firoozabadi 2004 and for mechanics goodman et al 1968 schellekens and de borst 1993 xie and waas 2006 the mesh representing the matrix is fitted to that of the fracture surfaces this is depicted in fig 1 a where edges of the triangular elements represent fractures with implied aperture since fracture geometry may not be regular fitted methods often employ unstructured mesh topologies subsequently the availability of a quality mesh generator is necessary and in the case of fracture propagation models the mesh generator must be used repetitively during the course of a simulation alternatively embedded methods superpose lower dimensional discrete fracture representations with a discrete matrix representation without requiring the two to coincide as depicted in fig 1 b in embedded representations the choice of mesh topology for the discrete matrix representation is not constrained by the fracture geometry embedded methods hold the promise of enabling fracture propagation models that utilize an entirely static underlying representation of the matrix domain this work focuses on the development of an accurate and computationally efficient numerical discretization scheme for coupled multiphase flow and mechanics in fractured porous media using embedded immersed boundary representations 1 1 review on embedded methods for geomechanics finite element methods fem accommodate embedded fractures by the introduction of elemental enrichment or nodal enrichment for the discontinuous displacement modes in the finite element method with embedded discontinuities referred to as e fem the finite elements are enhanced with local degrees of freedom to capture the displacement jumps across the discontinuity for example linder and armero 2007 and armero and linder 2008 alternatively in the extended finite element method referred to as xfem the theory of partition of unity melenk and babuška 1996 is applied and specific basis functions could be designed for the enriched nodes to capture different features of the discontinuity for example moës et al 1999 wells and sluys 2001 generally these formulations result in the similar solutions at similar convergence rates in oliver et al 2006 a comparison between e fem and xfem is reported with an emphasis on accuracy and computational cost in deb and jenny 2017 a finite volume discretization is proposed referred to as xfvm whereby enriched nodes are placed along the discontinuity to account for shear slip displacement in this scheme enrichment functions similar to those utilized by xfem are applied 1 2 review on embedded methods for multiphase flow xfem schemes can be applied to model flow in fractured porous media flemisch et al 2018 schwenck et al 2015 solve the single phase incompressible fluid problem while fumagalli and scotti 2013 deals with the two phase system using xfem additional degrees of freedom for each physical unknown may be placed at the center of matrix cells that are intersected by fractures and they may be enriched by discontinuous basis functions specifically in embedded meshes however the discretization of the interface problems must be enhanced to avoid sub optimal convergence behavior hansbo and hansbo 2002 the embedded discrete fracture method edfm proposed by lee et al 2001 and extended by li and lee 2008 hajibeygi et al 2011 moinfar et al 2014 jiang and younis 2016 employs a geometric static transmissibility to approximate the fluid exchange between fracture segments and the matrix edfm was originally proposed in the context of models for hydrocarbon recovery from unconventional fractured reservoirs in these applications primary depletion is the principal flow mechanism and multiphase flow effects are not as pronounced in ţene et al 2017 it is reported that edfm is not accurate in cases where the discontinuity acts as a barrier to flow e g sealing faults an improvement called the projection based edfm pedfm was proposed to address discrete fractures with a wide range of permeability in jiang and younis 2017 it is reported that edfm introduces large errors in the context of multiphase flow and an extension to the pedfm scheme was shown to provide accurate solutions in these scenarios 1 3 review on embedded methods for coupled flow and geomechanics the embedded methods for the coupled flow and geomechanics could be combinations of separate techniques mentioned in the previous two sections several typical coupling schemes between flow and geomechanics among literature are listed in the table 1 no literature has been published investigating the coupling between the finite element discretization using xfem for geomechanics and the finite volume discretization using pedfm for flow the coupled xfem pedfm addresses the accuracy in the multiphase transport problems inherited in the original formulation of the edfm as well as the interaction between the fluid flow and rock deformation the manuscript is formulated in this way the mathematical formulation of the flow and geomechanics problems investigated are stated in the first section the constitutive relationships used in the coupled model are introduced in the second section in the third section the discretization for flow and geomechanics is described in two separate parts the algorithm of the pedfm is briefly introduced in the first part the discretization of the xfem is elaborated in the next after that the nonlinear and linear solution strategies for the coupled system are illustrated numerical results regarding to the accuracy of the xfem and the coupled xfem and pedfm system are shown the results generated by pedfm xfem are compared to those by the fitted method unstructured discrete fracture method udfm in the last section the nonlinear and linear solver s performance are investigated 2 governing equations consider the closed and bounded spatial domain ω r n n 2 3 with external boundary γ γ n γ d γ n γ d and an associated outward oriented unit normal n γ suppose there are nf fractures in the domain the cracked region therefore is defined as c i c i i 1 2 n f r n c i denotes each separate fracture in the domain with an aperture d the fracture intersections λ i j c i c j i j 1 2 n f r n the intact porous media unbroken domain is denoted as ω r ω c the interface γ c c ω r r n 1 has a outward unit normal vector n c in this article assuming that d is asymptotically small compared to the characteristics length scale of the ω the fracture region c hence is reduced to an n 1 dimensional interface γc with the unit norm n c n c n c the intersection λ is correspondingly reduced to the space r n 2 which is a point in two dimension a curve in three dimension if we introduce the interval of time i t 0 t the space time domains are defined as ω i t 2 1 flow in the porous media and fracture we consider two immiscible fluid phases denoted by the subscript κ w n for the wetting phase and non wetting phase respectively the equations that describe the two phase flow considering the geomechanics effects are formulated for intact domain denoted as subscript m and fracture domain denoted as subscript f separately the primary unknowns are p κ m ω r i t r p κ f c i t r s κ m ω r i t r and s κ f c i t r the projection matrices n n c n c and t i n are introduced such that given i ω r and j ω r n the tangential gradient and tangential divergence operators on a curve or a surface are defined as γ i t i and γ j t j hence the flow equation in the matrix is 1 t ϕ m ρ κ s κ m ρ κ u κ m q κ m w q κ m f on ω r i t the flow equation in the fracture is 2 t ϕ f ρ x s κ f γ ρ κ u κ f q κ f w q κ f i q κ m f on c i i t the boundary conditions are 3a p κ m f p on γ d i t 3b u κ m n γ 0 on γ n i t either wetting phase or nonwetting phase pressure is prescribed on the dirichlet boundary γd the pressure function is f p γ d r the flux is set at zero on the neumman boundary γn furthermore the saturation satisfies the constrain σ s κ m 1 and σ s κ f 1 ρκ is the wetting or non wetting phase density q κ m w q κ f w are the source sink term in the rock matrix and fracture respectively q κ f i is the source sink term associated with the intersections q κ m f is the fluid flowing from matrix to fracture q κ f i and q κ m f are defined in the numerical discretization section ϕ m and ϕ f are defined as the lagrangian porosity which is quantified in the reference initial coordinate darcy velocity u of the phase κ is defined as in matrix 4 u κ m k m k r κ μ κ p κ m ρ κ g d h d z in fracture 5 u κ f k f k r κ μ κ γ p κ f ρ κ g d h d z where p κ m p κ f represents pressure for all phases in the rock matrix or fracture k m k f is the second order permeability tensor krκ is the relative permeability in each phase κ μκ is the phase viscousity g is the gravitational force d h d z is the evaluation gradient along z direction 2 2 geomechanics the primary unknown for the geomechanics is the rock displacement u ω i t r n the p m κ w n s κ m p κ m and p f κ w n s κ f p κ f are the average fluid pressure of wetting and non wetting phases the strong form of the momentum balance under the quasi static state is 6 σ u p m ρ b f 0 on ω i t 7a σ n γ t on γ n i t 7b u u on γ d i t 7c σ n c σ n c p f n c on c i t where σ is the second order stress tensor which is a function of the pressure and displacement ρb is the material bulk density f is the body force density the traction function is t γ n r n the prescribed displacement is u γ d r n 3 constitutive relationships in this section several constitutive relationships used in the flow and geomechanics are listed the biot s poroelastic theory is considered in the geomechanics model the modification of the permeability due to the aperture variation in the fracture is derived by an upscaling technique the relative permeability as well as fluid density correlations adopted in this manuscript are listed 3 1 biot s poroelastic theory the biot s theory biot and willis 1957 terzaghi 1960 characterizes the interaction between the stress and pore pressure in the single porosity system the effective stress law based on the single phase biot s poroelasticty theory could be written as 8 σ σ α p m i where σ is the total stress tensor σ is the effective stress tensor α 0 1 is the biotâs coefficient i is the identity tensor the effective stress σ is calculated based on the linear elastic theory 9 σ λ u i 2 g ɛ u where λ g 0 are lam e coefficients evaluated from properties of the matrix skeleton strain ε is a second order tensor infinitesimal deformation is considered and the strain tensor is a function of displacement 10 ɛ 1 2 t u u the volumetric strain is then defined as the trace of the strain 11 ϵ tr ɛ the lagrange porosity in matrix under linear poroelastic infinitesimal deformation is offered by dean et al 2006 12 ϕ m ϕ 0 α ϵ ϵ 0 1 m p m p 0 the lagrangian porosity in fracture under infinitesimal deformation reads 13 ϕ f ϕ 0 1 ϵ ϵ 0 where ϕ 0 ϵ0 and p 0 are the reference porosity volumetric strain and pressure respectively α and 1 m are biot s parameters 3 2 important fluid and rock properties the fracture aperture is considered to be the most influential factor of the flow in fractures the lubrication law can provide a simple relationship between the aperture and its permeability daneshy et al 1971 the derivation of the lubrication law assumes fluid flow in the parallel plate and the navier stokes solution shows that fluid velocity is proportional to the square of plate distance under the laminar flow consequently the fracture permeability could be 14 k f k f 0 w w 0 2 where k f 0 and w 0 are the reference fracture permeability and aperture we assume darcy s law is still applicable in the fracture through the correction term on the permeability the relative permeability for the wetting and non wetting phases in matrix is calibrated by the corey relationship 15a k r n k r n e n d s n s n r 1 s n r s w r n n 15b k r w k r w e n d s w s w r 1 s n r s w r n w a linear relationship is in fracture 16a k r n s n s n r 16b k r w 1 s n where k r w e n d k r n e n d are the end points of the wetting and non wetting phase relative permeability s w r and s n r are the residual saturation of the wetting and non wetting phases nn and nw are the exponential numbers the density of the fluid phase can be a function of its pressure the x in the following equation is defined as c r κ p κ m p 0 or c r κ p κ f p 0 then the density is approximated by the following 17 ρ κ ρ κ 0 1 x 0 5 x 2 where c r κ is the compressibility of the fluid phase κ p 0 and ρ κ 0 are the reference pressure and density respectively 4 numerical discretization we consider the mesh t h is a subdivision of the domain ω into disjoint elements k i e triangle or quadrilateral in two dimension and tetrahedron or cubic in three dimension therefore ω is the union set of all disjoint elements k t h k the diameter of element k t h is denoted by h moreover let t h be the mesh of fracture c t h i c i ω i 1 2 n f are the set of intersections between fracture and mesh grid similarly c is the union set of all fracture elements k k t h k the set of fracture fracture intersections in the discrete domain remain the same λ λ we introduce a partition of the time interval i t n t n t n 1 with δ t n i t n such that i t n i t n for n 0 n t in order to accurately capture the physical phenomenon of the fracture system in terms of the both fluid flow and geomechanics the pedfm xfem is proposed in the fluid flow simulation we use the pedfm model developed by jiang and younis 2017 the simulation of the geomechanics is handled by the xfem in the following part the pedfm is briefly introduced the methodology of the xfem is reviewed and the details of discretization of the geomechanics equation are given subsequently 4 1 introduction to the pedfm in the multiphase flow problems li and lee 2008 proposed the edfm model which employs the concept of the well index is designed for the single well depletion problem jiamin and younis shows large inaccuracies from edfm occur when there are asymmetries around the fractures and zero order of the saturation convergence rate based on the recent proposed pedfm method jiang and younis 2017 ţene et al 2017 improved and extended it to the multiphase phase displacement problems in addition to the regular flux between matrices pedfm handles the extra flux between matrix fracture and fracture fracture the discretized forms of the flux and souce sink terms present in eqs 1 and 2 are listed in the table 2 in the f f connections two circumstances occur first the flux through the face connecting two cells on a fracture second the flux through intersections connecting cells on two different fractures the intersection is treated as a zero volume point in other words no mass is stored here in the m f connections flux is conserved between matrix and fracture in the table 2 λκ ρκkrκ μκ is the fluid mobility and the fluid property associated with the sκ is dealt with the first order upwinding strategy φ κ m f p κ m f ρ κ g h is the fluid phase potential the key aspect of pedfm compared to edfm is the introduction of the additional fracture matrix m f connections in the fig 3 the blue arrows are the standard edfm connection lists the green arrows which make up additional connections force the flux directly into out of the fracture between m 2 m 1 and f the yellow lines in the figure shows the projected area a 13 p x and a 23 p y from the fracture to the edge of the grid block in x and y direction respectively the projected area is counted as the effect flow region from the neighboring matrix to the fracture the occurrence of the extra fracture and matrix connections blocks a fraction of the area yellow line for the flow between matrix connections therefore it is necessary to subtract the blocked area and update the m m connection transmissibility in the fig 4 the schematics of the connection list dependency shows the difference between the standard edfm and pedfm the tables 3 and 4 show the calculation of the connection transmissibility in the scenario of fig 3 ti is the half transmissibility for tij between matrix i and j t m i and tf are the half transmissibility for t f m i between matrix mi and fracture f di denotes the distance from the center of cell i to the interface aij is the interface area between gridblock i and j in the standard edfm d f m i is the average norm distance from the fracture in the gidblock i while in the extended f m connections d f m i is the distance from the center of the cell i to the center of the fracture segment af and ωf are the fracture surface area and fracture aperture respectively the transmissibility takes the value of the harmonic average of the half transmissibility in addition a physical way of the calculation of extended f m connections is the harmonic average of three items for the performance of the pedfm the author recommends interested readers to the jiang and younis 2017 4 2 xfem formulation in order to model discontinuity fields enriched basis fem is commonly applied the enrichment is realized through the basic mathematical foundation of the partition of unity finite element method pufem as proposed by melenk and babuška 1996 application specific ψ function can be included so that discontinuity can be handled without the need for the discontinuous surfaces to be aligned with the finite element mesh the global solution of pufem has been the theoretical basis of the extended finite element method in fig 5 different types of elements standard blending enriched and nodes standard heaviside enriched tip function enriched and junction enriched are shown we define the element set that contains the heaviside enriched node as ω h the tip enriched node as ω t the junction enriched nodes as ω j for xfem moës et al 1999 proposed an equation that can model crack surfaces and tips by step functions and asymptotic near tip fields later belytschko et al 2001 proposed the enrichment function for intersecting discontinuities consider there are multiple intersecting fractures present in the computational domain based on the classification we define the following four node sets and mapping functions which govern the enrichment i the set of all nodes in the region ω l i the set of nodes in the region ω h the mapping f l n n returns a set containing all the fracture c j that requires the enrichment of node i l k i the set of nodes in the region ω t the mapping f k n n returns a set containing all the fracture c j that requires the enrichment of node i k m i the set of nodes in the region ω j the mapping f m n n 2 returns a pair of fractures that requires the enrichment of node i m we denote f m 1 as the master fracture f m 2 as the slave fracture the displacement approximation is 18 u h i i n i u i i l j f l i n i h j h j i a i j i m j f m i n i j j j j i c i j i k j f k i l 1 4 n i f j l f j l i b i j l where ni is the basis function associated with node i u i is the regular displacement a i j is the displacement of heaviside enriched nodes the c i j is the displacement of junction enriched nodes b i j l l 1 4 are the displacement of tip enriched nodes remark 1 instead of the direct application of the hj jj and fjl as enrichment functions we shift the enrichment functions around the node of interest h j i j j i and f j l i are taken their values at the coordinates of the node i therefore the solution for the nodal value is exactly the displacement at the position moreover this formulation can avoid the blending elements enriched by the heaviside function given the node i find a fracture c j j f l i the signed distance function returns a positive or negative distance according to the position and its definition is 19 ξ j x min x x γ sign n c x x γ on c j where x γ is a projection of x onto a fracture c j the heaviside distribution is then defined by 20 h j x h ξ j x 1 ξ j 0 1 ξ j 0 finding a pair of fractures c j 1 and c j 2 j 1 f m 1 i and j 2 f m 2 i the junction function is defined as 21 j j x j ξ j 1 x ξ j 2 x 1 ξ j 1 ξ j 2 0 0 ξ j 1 ξ j 2 0 1 ξ j 1 ξ j 2 0 finding a fracture c j j f k i the tip enrichment functions are defined in terms of a polar coordinate system r θ located at the fracture j s tip where θ starts from the tangent line at the fracture tip counterclockwise note that only the first function in eq 22 is discontinuous across the surface π whereas the other three functions are continuous 22 f j l r θ r sin θ 2 r cos θ 2 r sin θ 2 sin θ r cos θ 2 sin θ 4 3 weak form and discretization the discretization of the strong form of the geomechanics eq 6 is based on the standard galerkin finite element method the weak form equation contains the interaction of different scales of fractures fluid pressure the trial functional space s and the test functional space v are defined as 23 s ω δ u δ u h 0 1 ω δ u 0 on γ u 24 v ω u u h 1 ω u u on γ u where the h 1 ω is the soblev space and the h 0 1 ω is the sobolev space which vanishes on the dirichlet boundary condition the weak form is to find the δ u s ω and u v ω such that 25 ω δ ɛ d ɛ d ω ω δ ɛ α p m i d ω γ n δ u t d γ n c δ u p f n c d c where d is a elastic tensor δ ε δ u is the variational form of the strain tensor ε in the last term on the right hand side the fluid pressure applied on the fracture surface is considered by the eq 18 the jump of the displacements on fracture c in terms of the discrete form can be 26 u h u h x u h x 2 i l j f l i n i a i j 2 i k j f k i n i f j 1 b i j 1 i m j f m i n i j j x j j x c i j on c where sign means the associated physical quantity on the fracture upper and lower surfaces separately therefore the crack opening displacement w h of fracture which is the projection of the displacement jump onto the fracture surface c could be 27 w h n u h given a scalar or a vector b ω r p p 1 n we define the jump of b b b over the fracture region c the n is the projection matrix defined in the previous section and the norm w w h is defined as the fracture aperture the discretized weak form can be expressed as the matrix vector form eventually the resultant linear system of geomechanics equation is 28 k u h f with k be the global stiffness matrix and f be the force vector the global stiffness matrix is assembled from the elementary level k and k in each element node i and j are the vertices element stiffness matrix k i j r s and force vectors f i u f i a f i c f i b l are 29 k i j r s k b i r t d b j s d k r s u a c b l i j 1 4 30 f i u γ n n i t d γ n k b i u t α p m d k 31 f i a γ n n i h f l i h f l i i t d γ n k 2 n i p f n c d k k b i a t α p m d k 32 f i c γ n n i j f m i j f m i i t d γ n k n i j f m i x j f m i x p f n c d k k b i c t α p m d k 33 f i b l γ n n i f f k i l f f k i l i t d γ n k n i f f k i l x f f k i l x p f n c d k k b i b l t α p m d k 34 b i u n i x 0 0 n i y n i y n i x 35 b i a n i h f l i h f l i i x 0 0 n i h f l i h f l i i y n i h f l i h f l i i y n i h f l i h f l i i x 36 b i c n i j f m i j f m i i x 0 0 n i j f m i j f m i i y n i j f m i j f m i i y n i j f m i j f m i i x 37 b i b l n i f f k i l f f k i l i x 0 0 n i f f k i l f f k i l i y n i f f k i l f f k i l i y n i f f k i l f f k i l i x where r s stands for different standard and enriched node types the linear quadrilateral element is applied in this manuscript we neglect the shear stress of the fluid so that the pressure tensor is simplified into a vector p m pm pm 0 t the gaussian quadrature rule is of good accuracy when applied to the element not cut by the fracture however the gaussian quadrature rule on the element cut by the fracture results in a poor accuracy due to the discontinuity in the integrand instead the element is subdivided into a bunch of triangles and the seven point triangular quadrature rule is adopted on each sub domain a special care should be taken for the integration in the element including the fracture tip the element subdivision plus gauss integration algorithm in each sub element will yield an inadequate precision by reason of the singularity in the first order derivative of the branch enrichment functions fjl a remedy is to enrich the integration points around the fracture tip the tensor product type gaussian quadrature rule transforms the standard triangular element t s t ξ η 0 ξ η ξ η 1 to the standard quadrilateral element rst and then apply the gaussian quadrature rule for r s t x y 1 x y one advantage is that a large number of quadrature points will be concentrated in a relatively small region near one vertex the transform is defined as 38 ξ 1 x 1 y η 1 y 2 5 solution strategy in this section we investigate the nonlinear solver employing the fully coupled scheme with iterative linear solvers for the full problem coupled methods are preferable regarding stability however this comes at the necessity of a linear solver that can deal with the scale differences between mechanics and flow as well as the cross couplings in between in contrast to this sequentially coupled methods kim et al 2011 have been widely used for solving the coupled flow and geomechanics problems fixed stress and fixed strain methods for instance solve the flow system first considering either stress or strain changes are constrained to zero the obtained pressure solutions are substituted into the geomechanics system in the second step the two steps above are performed iteratively till both systems are converged one of attractions of this method is that each system can take advantage of its own preconditioned linear solver however the sequentially coupled methods are conditionally stable and do not guarantee the convergence or take more iterations than the fully coupled methods a special preconditioner should be designed for the linear solver for the fully coupled method so as to improve the efficiency and speed solving the coupled matrix system the couplings between mechanics and flow which are affected by scale differences have to be dealt with the linear solver challenges that the result from cross coupling terms can hardly be erased completely the modifications of the coupling terms raises questions regarding its improvement on the solver s convergence speed as well as its effect on matrix properties and condition in general the sequentially coupled method modifies the coupling terms on the level of the nonlinear solver stage in the danger of sacrifice of the nonlinear convergence speed the fully coupled method using a preconditioned iterative linear solver modifies coupling term in the full matrix at the expense of possible failures of the linear solver in the second part of this section a good preconditioner for the coupled system is investigated 5 1 nonlinear solver in this work we use a mixed space finite volume and finite element discretization a finite volume method with two point flux approximation tpfa is used to discretize the fluid flow problem and the extended finite element method for the geomechanics simulation the primary variables are fluid pressure p w which encompasses the matrix and fracture pressures water saturation s n which consists of the matrix and fracture saturations as well and the displacement u which are set at the cell center cell center and corner point respectively the first order backward euler along with fully implicit scheme are used for the time discretization the resultant linear matrix is a fully coupled system which is solved iteratively by the newton raphson method 39 a p p c p s c p u c s p a s s c s u c u p c u s a u u δ p w δ s n δ u r p r s r u where the matrix is unsymmetrical and off diagonal terms are the coupling ones among primary variables the definition of the submatrices in the jacobian could be found in the appendix a the following solution algorithm is carried out at the time step n 1 remark 2 the initial state t 0 of the reservoir is determined by assuming a drained condition where fluids are free to flow in and out the system boundary therefore fluid pressure and saturation are remaining constant and only poromechanical deformation occurs at this step the related reservoir properties e g fracture permeability matrix porosity are updated as soon as the displacement field is obtained 5 2 linear solver we apply two different types of preconditioners for the investigation of a possible iterative linear solver the first one is the well known black box incomplete lu factorization ilu another famous preconditioner widely being used in scientific computation domain is the algebraic multigrid method amg griebel et al 2017 stüben et al 2017 tests to solve the coupled system are compared among ilu 0 threshold of ilu ilut and amg the software we use in the amg test is samg oil developed by the fraunhofer scai st augustin germany 5 2 1 ilu type preconditioners a preconditioned generalized minimal residual gmres method is used to solve the system the right precondioner is 40 j p 1 δ y r where δ y p δ x δ x is the true update ilu is used here to construct the preconditioner and defined as 41 a l u r where r elements that are dropped during the incomplete elimination process ilu0 takes the zero pattern to be precisely the zero pattern of jacobian matrix j however the ilut may outperform the ilu 0 by allowing more fill ins and improve the precondtioner accuracy when encountering a very complex linear system reverse cuthill mckee rcm is used to shrink the bandwidth of the linear matrix in order to reduce the fill in during the gaussian elimination moreover as more fill ins are allowed the beneficial effect of reordering become compilling saad 2003 rcm is a breadth first search algorithm every time finding the lowest degree node and sort its adjacency and append them to the result in fig 6 there is a significant reduction in the bandwidth of the linear system after applying rcm the original linear system is badly scaled because of the different unit system used in the flow and poromechanics problems rescaling the jacobian matrix is necessary to accelerate the convergence speed here each number in the matrix is divided by its diagonal term specifically 42 j i j i j i i and j j j j j i i therefore the algorithm is simply the following apply the rescale algorithm to the original jacobian matrix apply the rcm to the scaled jacobian matrix and store the permutation matrix only if ilut is used solve the linear system by the gmres combined with the ilu preconditioner till the convergence revert back the update vector to its original ordering by the stored permuation matrix only if ilut is used scale back the solution 5 2 2 system amg accelerated by the gmres the used system amg approach for the fully implicit system preconditions a flexible gmres to achieve a better performance and improve the robustness as the coupled system is considered amg needs to distinguish different groups of variables to apply an appropriate coarsening in the jacobian matrix the variables are pressure p saturation sw standard node displacement u heaviside enriched node displacement a tip enriched node displacement b and junction enriched node displacement c among them p sw sharing the same grid location are tied together as a point from amg perspective also each different types of node displacement in x and y direction at the same position form another separate point thus assuming that there are npts points system amg will consider the point based jacobian system 43 a 1 1 a 1 n p t s a n p t s 1 a n p t s n p t s u 1 u n p t s r 1 r n p t s where each submatrix a is a coupled one between different variables at a point u is the update of a point wrapping up different variables system amg is applied to the full linear system from the linearization process it combines a pre processing with the amg based solution process with techniques such as the drs scaling the pre processing aims at ensuring a robust applicability of amg despite the challenging physics the system amg solver then exploits the provided information on the different types of unknowns and points to construct an amg hierarchy based on those unknowns where the hierarchical solution process is beneficial in the used setting this amg setup is based on the unknown wise amg approach system amg also adjusts the smoother on the different levels to the amg setup since conventional smoothing techniques might be ineffective the conventional smoothing techniques might be ineffective on the coupled system due to the drastic scale difference between the flow and mechanical sub problems system amg here uses the remedy of an uzawa type smoother that employs incomplete factorization at the finest level and gauss seidel at the other levels for details of system amg we refer to gries 2015 whereas details regarding uzawa smoothing with algebraic multigrid are given by elman and golub 1994 and metsch 2013 6 results to benchmark the performance of the xfem pedfm we perform the tests through the following aspects compare xfem to udfm in pure mechanics cases test the model accuracy through examination of the convergence rates of the proposed xfem pedfm compare the results of xfem pedfm model to the udfm in coupled flow and geomechanics problems investigate the performance of the linear and nonlinear solvers for the xfem pedfm in the first case we generate pure mechanics problems showing the performance and efficiency of the xfem in comparison to udfm in the second case we show the convergence rates of pressure saturation and displacement fields in different fracture patterns in the third case the solutions of coupled fluid flow and geomechanics problems are compared between the pedfm xfem and udfm in terms of the distribution of the physical quantities pressure saturation displacement aperture and production rates in the last section the performance of preconditioners ilu 0 ilut and samg oil are compared in aspects of different mesh and time step sizes the nonlinear convergence speed is also recorded against different mesh sizes and time steps 6 1 pure mechanics test in order to calibrate the xfem accuracy we compare the xfem result to the udfm single inclined fracture and intersected fractures are tested in both cases as shown in the fig 7 e 0 5 gpa ν 0 3 and plane stress is assumed the boundary conditions of both cases are 44a u x 0 u y 0 on y 0 44b σ n n 5 e 10 6 pa on y l y the cpu time is normalized by the run time of the udfm the aperture difference δ is defined as 45 δ max w w ref w ref where the w is the aperture obtained by xfem solution and w ref considers udfm solution on a very refined mesh as the true in the single fracture case two different rectangular meshes 17 17 and 177 187 504 nodes and 33464 nodes are compared to the refined unstructured mesh with 862110 nodes xfem could get a good match with the udfm moreover much fewer elements along with reduced cpu time are required for xfem to get a satisfied result as we refine the mesh the aperture difference is decreasing and converges to the correct result in the case with two intersecting fractures xfem with the help of the junction enrichment function can predict the aperture jump at the intersection point the same as the udfm s result additionally a small number of nodes needed in xfem 9221 nodes can reach a satisfactory accuracy 6 2 accuracy test we will present three test cases with different fracture distributions in fig 10 to benchmark the performance of the coupled xfem pedfm simulation for multiphase flow convergence rate studies of unknowns i e pressure saturation and displacement are performed to show the numerical accuracy in the following tests the solution on coarse grids are compared to that on the finest grid assuming it is the most accurate one l 2 norm is calculated and its equation is 46a u 2 j 1 n ref i 1 n dim u i j h u i j 2 j 1 n dof i 1 n dim u i j 2 46b x 2 j 1 n ref x j h x j 2 j 1 n ref x j 2 where x represents for pressure p or saturation snw u i j and x j are the reference solutions n dim is the total number of dimensions i loops different dimensions in space j loops the number of reference points n ref chosen on the domain here the l 2 norm is calculated for the p and snw located in the matrix grid intact domain as well as only the standard displacement nodes u in the following tests the time step is chosen by maintaining the courant friedrichs lewy cfl number constant 47 δ t δ x 2 constant we generate three different fracture patterns to test the convergence rate of the xfem pedfm scheme the specification of the 2d sythetic case is shown in the table 5 oil o and water w consist of the two phase system the boundary conditions are 48a p x 0 u x u y 0 on x 0 48b p x 0 σ n n 10 7 pa on x l x 48c p 3 10 7 pa s 0 8 u y 0 on y 0 48d p 8 10 6 pa σ n n 10 7 pa on y l y no flow boundary conditions are applied at the left and right boundary the pressure is fixed at the top and bottom boundaries the saturation is maintained constant at the bottom second order approximations of dirichlet and neumann boundary conditions are implemented the details of implementation are given by aziz and settari 1979 the compressive force is applied onto the top and right of the domain the displacement is set as zero on the left and bottom boundaries in figs 11 13 the error of the matrix pressure matrix saturation and displacement are plotted versus mesh sizes in the single inclined fracture case the convergence rate of pressure is the second order which reaches the optimal saturation also shows the first order accuracy which agrees with the results shown in the jiang and younis 2017 in the pattern of single crossing and two crossing fractures the displacement and saturation maintained first order rate there is a degrade in the convergence rate of the pressure but a bit higher than first order ideally the fvm discretization is able to yield pressure second oder convergence rates saturation first order rates however the presence of fractures might degrade the optimal convergence rate in the classical xfem scheme a partition of unity is satisfied in standard and enriched elements even though the blending element is no longer a partition of unity it has little direct effect on the approximation when there is no singular point in the element the appearance of blending elements with singular points could decrease the convergence rate of xfem fries and belytschko 2010 the order of the convergence rate u 2 remains to o h for all types of elements second order or even higher order elements due to the loss of the partition of unity in the blending elements that have both tip enriched and non tip enriched nodes fries 2008 laborde et al 2005 béchet et al 2005 proposed a fixed area enrichment scheme instead of the topological tip enrichment shown in the previous section to improve the convergence rate besides the element containing the tip is enriched elements nodes within a prescribed geometry are enriched by the tip enrichment functions however the extra cost is the significant increase of the condition number of the linear matrix in this manuscript we adopt the topological scheme in order to release the extra burden from the linear solver side 6 3 comparison to udfm the accuracy of the xfem pedfm model is checked from another view with the comparison to the fitted method udfm the injection production type of multiphase flow and geomechanics problems are studied in fig 14 two different fracture patterns with wells located at corners of the domain are considered the input parameters are shown in the table 5 the well injection pressure is 3 107 pa and the well production pressure is 6 106 pa the boundary conditions are listed in eq 49 we compared two sets of the permeability contrast between fracture matrix the value is listed in the table 6 the purpose is to verify that the proposed model is accurate in different scales of permeability contrasts 49a p x 0 u x 0 on x 0 49b p x 0 σ n n 5 10 6 pa on x l x 49c p y 0 u y 0 on y 0 49d p y 0 σ n n 5 10 6 pa on y l y the distribution of primary unknowns matrix pressure matrix saturation and the magnitude of displacement are compared in figs 15 18 and 19 the results show that they all agree with each other well in two different models especially the saturation field near the fracture area reflects using the pedfm honor the true physical process fracture aperture is affected by two factors displacement of enriched nodes and fracture pressure the agreement of fracture aperture between two different methods validates the accuracy of the fracture pressure and geomechanics solver oil and water production rates get matched between two methods except a little discrepancy at early times 6 4 linear and nonlinear solver in this section we test the linear solver ilu 0 ilut n fill in ε and amg preconditioners and nonlinear solver for the xfem pedfm scheme in terms of various time step sizes and grid sizes the schematic of the domain is shown in fig 22 the input and boundary conditions are the same as case a of the comparison to the udfm the general setup of the linear solver used in this section is the following the outer krylov solver operating with a global coupled matrix is right preconditioned gmres the outer iteration runs with a convergence criteria of relative residual reduction of τ 10 8 in addition an overall limit of 5000 iterations is set the fill in level n fill in is defined as the half of the preconditioner bandwidth and the item will be dropped during gaussian elimination if smaller than the tolerance ε we also define the memory used to set up the ilu type preconditioners in the following equation 50 consumed memory in setup nnz l nnz u nnz a nnz means the total number of nonzero items in the matrix l and u are the upper and lower diagonal matrix of the ilu factorization of a matrix receptively similarly in samg oil the memory consumed is defined as the ratio between the total number of matrix entries summed over all amg levels and the number of entries in the matrix nnz a in the following test cases the memory consumed by ilut 50 1e 6 is about 5 times the memory of ilu 0 samg oil used roughly 2 5 times the memory of ilu 0 the performance of the linear and nonlinear solver is in the table 7 nl means the number of nonlinear iterations ln nl means the number of linear iterations per nonlinear iteration na means the total number of linear iterations exceeds the maximum from the results we find out nonlinear iterations increase with the growth of the time step the nonlinear solver can ensure the system converge even for a 10 000 time increase in the time step samg oil is less sensitive to the time step compared to ilu 0 and ilut at the finest mesh size 293 297 when the time step increases by 10 000 times the average linear iteration for δ t 10 is only 22 percentage larger than that for δ t 0 001 however the case with ilu 0 and ilut do not converge with larger δt at the fine mesh as time step decreases all three preconditioners converges with less iterations this is due to the fact that smaller time step could increase the extent of the diagonal dominanance samg oil shows better scalability than the ilu 0 and ilut when the mesh is refined a significant linear iteration growth is observed in the ilu type preconditioners generally speaking the samg oil and rcm ilut needs much fewer iterations than the ilu 0 however ilut needs roughly 5 times memory than that required in ilu 0 samg only requests half of the memory consumed by ilut therefore ilut reaches a decent convergence speed at the cost of extra memory additional research is performed with the samg team especially regarding the handling of fracture intersections to further improve the convergence speed conclusion in this manuscript we develop a fully coupled flow and geomechanics xfem pedfm suited for the multiphase flow problems we first verify the accuracy and efficiency of the xfem in pure mechanics problems next the accuracy tests are performed and the convergence rates of the pressure are a bit larger than the first order while convergence rates of the saturation and displacement are as expected first order the xfem pedfm also shows good agreement with the solution by the udfm nonlinear solver tests show that the nonlinear iteration steps increase but not significantly with the growth of mesh sizes and time steps generally speaking samg oil outperforms the gmres with ilu 0 and ilut preconditioners samg oil compared to ilu has better scalability in terms of the mesh size and time step ilu 0 takes the same sparsity pattern of the original linear system but fails with fine grids and large time steps ilut utilizes extra memory but gain a bit more stability in each linear solve samg oil converges for all test cases and only half of the memory is requested compared to the ilut 50 1e 6 acknowledgment this work was funded by tu future reservoir simulation systems technology fursst research consortium the authors would like to thank dr sebastian gries from fraunhofer scai for his help with the application of samg oil appendix a the definitions of matrix terms in the eq 39 are illustrated in details here the operator ij and i takes terms in the row i and column j of a matrix or the ith value of a vector respectively a 1 a p p i j r p i p w j 1 δ t ϕ ρ w s w i n 1 p w j k t μ w i k 2 k r w n 1 p w i p w k p w j a 2 a s s i j r s i s n j 1 δ t ϕ ρ n s n i n 1 s n j k t μ n i k 2 k r n n 1 p w i p w k s n j a 3 a u u i j r u i u j k i k u k f i u j a 4 c p s i j r p i s n j 1 δ t ϕ ρ w s w i n 1 s n j k t μ w i k 2 k r w n 1 p w i p w k s n j a 5 c p u i j r p i u j 1 δ t ϕ ρ w s w i n 1 u j k t μ w i k 2 k r w n 1 p w i p w k u j a 6 c s p i j r s i p w j 1 δ t ϕ ρ n s n i n 1 p w j k t μ n i k 2 k r n n 1 p w i p w k p w j a 7 c s u i j r s i u j 1 δ t ϕ ρ n s n i n 1 u j k t μ n i k 2 k r n n 1 p w i p w k u j a 8 c u p i j r u i p w j k i k u k f i p w j a 9 c u s i j r u i s n j 0 
727,soil moisture is a key parameter which governs the soil water balance and affects hydrologic processes such as water infiltration and evapotranspiration these processes are critical in several fields related to water resources including precision agriculture and drought management as such increasing attention is paid to field estimation of soil moisture indirect methods are generally preferred as they are non destructive and measures can be detected almost continuously in time among indirect methods here we focus on wireless underground communication networks wucns which is a promising technique based on the transmission of radio waves to a buried collector from measurements of the electromagnetic loss and based on either single path or two path models information on soil moisture can be retrieved in this context we perform global sensitivity analysis gsa to investigate how parametric uncertainty associated with soil texture plagues soil moisture predictions this is critical to identify which texture parameters require accurate estimation to narrow the uncertainty associated with predictions in practical applications in particular we study the influence of porosity and of sand and clay contents and found significantly different results for diverse soil types thus suggesting the importance of a preliminary gsa to guide the design of measurement campaigns on field keywords global sensitivity analysis soil moisture wireless underground communication networks soil texture subsurface hydrology 1 introduction 1 1 wireless underground communication networks soil moisture is a key quantity in the field of drought management and to close the soil water balance in hydrologic modeling it also plays a critical role in precision agriculture for enabling flexible and smart irrigation strategies e g ahmad et al 2018 huang et al 2017 martnez fernndez et al 2015 moghadas et al 2017 narasimhan and srinivasan 2005 sheffield and wood 2008 soil moisture can be measured directly through the gravimetric method which is however a destructive time consuming approach difficult to use in practical applications due to these limitations several indirect methods have been developed to provide a measure of another quantity that can be related to soil moisture through physically based and empirical equations a widely used technology focused on dielectric measurements is time domain reflectometry tdr which has shown to be more accurate and economical if compared to frequency domain reflectometry fdr however both these technologies provide local scale single point measures in order to move towards field scale measures one may resort to geophysical methods such as ground penetrating radar gpr that is however an expensive technology or electrical resistivity measurements with the disadvantage that data acquisition is periodic or requires regular field surveys for more details on indirect methods see e g bittelli 2011 dobriyal et al 2012 and references therein in this context a recent and promising monitoring technique consists in the basic configuration of two radio transceivers hereinafter denoted as devices buried underground that can exchange signals and make possible to provide indirect estimates of soil moisture without the need for an ad hoc device based on the idea that radio waves propagate through the soil with a loss rate which depends on the volumetric water content e g akyildiz and stuntebeck 2006 akyildiz et al 2009 dong et al 2013 vuran and silva 2009 and references therein in addition this approach provides an average estimate over the transmission volume instead of a single point measure soil moisture is measured locally and then transmitted by the receiving node to a surface gateway the latter will forward data to the internet through e g a uav repeater flying above the area measuring soil moisture at 30 100 cm depth through devices connected to the internet may provide critical real time information for several applications lora is a novel wireless technology for the iot internet of things even much more robust to power losses than its predecessors lora operates on ism bands that are available in the world on a region and country level basis in itu region 1 including europe the 863 mhz 870 mhz frequency range can be used by lora devices however in countries like italy the availability of the band is limited to the range 868 870 mhz in region 2 americas the available frequency range is 902 mhz 928 mhz from the viewpoint of the underground propagation channel it is expected that no major differences are found between these options the lora technology can provide successful detection of data pockets suffering a power loss of up to 151 db when very low data rates are needed theoretically such margin to loss enables to link zones of up to 10 m underground depending on soil texture and moisture and the antenna type 1 2 mathematical foundation em wave propagation in soil can be described with a link budget based on the friis equation with an additional term accounting for the attenuation induced by the soil with respect to free space propagation e g li et al 2007 and references therein the power of the received signal pr db is computed as follows 1 p r p t g r g t l 0 l s where pt db is the transmitted power gr db and gt db are the gains of the receiver and transmitter antennae respectively l 0 db is the path loss in free space and ls db the additional path loss due to the soil these losses are given by 2 l 0 20 log 4 π d λ 3 l s l β l α 20 log λ 0 λ e 2 α d where d m is the distance between devices lβ db is due to the difference of signal wavelength in soil λ 2 π β with respect to the same in free space λ 0 c f with β rad m the phase shifting constant and f hz the operating frequency lα db is the transmission loss caused by attenuation with attenuation constant α 1 m both α and β depend on the dielectric properties of soil the permeability μ h m the conductivity σ s m and the permittivity ε f m let s consider the helmholtz equations written in terms of phasor vector equations 4 2 e s γ 2 e s 0 2 h s γ 2 h s 0 where es is the phasor vector associated with the electric field e v m through the relationship e t i ω e s the same holds for hs which is the phasor vector associated with the magnetic field h a m balanis 2012 in 4 γ is the propagation constant which is defined as follows 5 γ i ω μ σ i ω ɛ where ω rad s is the angular frequency ω 2 π f by imposing γ α i β from 5 it is possible to derive the following expressions for α and β as functions of the dielectric soil properties 6 α β ω μ ɛ 2 1 σ ω ɛ 2 1 1 3 impact of soil texture on measurements given that the soil consists in a multiphase medium of air water both bound and free and bulk soil em wave propagation is generally facilitated in case of low soil density and high porosity combined with low water contents as the rate of air presence is larger under these conditions the volumetric moisture content provides a critical contribution to the em wave attenuation it includes information about the presence of bound and free water at a time soil texture analysis and specifically the quantity of clay in the soil allows one to distinguish among these two contributions frequency also affects the dielectric constants the range of frequencies used in practical applications is 0 3 1 ghz which is associated with reasonable dielectric constants for wireless communication and feasible sizes of the antenna from a geometrical point of view the distance between devices also plays a role as well as the burial depth in case of low depths underground generally 0 3 0 5 m the ground surface produces a reflection refraction effect which has to be considered in this case the received signal consists of two components a direct path from the transmitter to the receiver and a reflecting path due to the ground surface a two path model has to be preferred in this case with respect to the single path conceptualization see fig 1 the path loss increases with frequency and distance between devices and is affected by soil moisture and texture in turn if one uses wucns to estimate soil moisture it is critical to perform preliminary analysis to properly design measurement campaigns under specific field conditions in particular it is relevant to identify the influence of soil texture parameters on path loss values given the uncertainty which typically characterizes the subsurface environment and specifically the vadose zone e g assouline et al 2017 brandhorst et al 2017 tartakovsky 2013 as such in this paper we perform a variance based gsa through the computation of the sobol indices sobol 1993 2001 to provide an insight in how to reduce predictive uncertainty and properly adopt this monitoring approach in practical applications to perform gsa we resort to the equations introduced in section 1 2 and to a semi empirical model suggested by peplinski et al 1995 which provides expressions for the dielectric properties of soils as function of soil porosity and clay and sand percentages in the range 0 3 1 3ghz the resulting mathematical framework is then reduced by means of an efficient computational algorithm based on the polynomial chaos expansion pce technique ghanem and spanos 1991 sudret 2008 wiener 1938 with this method we approximate the response surface which is the path loss for diverse values of soil moisture and operating frequency in the random parameter space given by the joint pdf of the uncertain texture parameters this paper is arranged as follows in section 2 we present the mathematical model and its pce based reduction for the purposes of gsa in section 3 we provide maps of gsa metrics in the parameter space with a focus on three soil types namely clay loam cl loam l and sandy loam sl and on an operating frequency of either f 0 868 ghz lora or f 0 433 ghz ism band a discussion on practical implications of our results is also provided in this section major conclusions drawn from our study are presented in section 4 2 material and methods 2 1 equations we start considering a single path model to study em wave propagation through the soil at high burial depths typically 0 5m in this case from 2 to 3 it is possible to represent the overall path loss lp in db as follows vuran and silva 2009 7 l p l 0 l s 6 4 20 log d 20 log β 8 69 α d based on 5 and introducing the complex permittivity of the medium ɛ c ɛ 1 i σ ω ɛ ɛ i ɛ both ε and ε are in f m constants α and β can be rewritten as 8 α β ω μ ɛ 2 1 ɛ ɛ 2 1 we resort to the semi empirical model proposed by peplinski et al 1995 which provides expressions for ε and ε as 9 ɛ 1 15 1 ρ b ρ s ɛ s α 1 m v β ɛ f w α m v 1 α 0 68 10 ɛ m v β ɛ f w α 1 α where mv is the volumetric moisture content ρ s 2 66 g cm 3 is the specific density of solid soil particles and ρ b ρ s 1 n is the bulk density with n the soil porosity α 0 65 and ɛ s 4 7 f m which is the soil solid permittivity are empirically determined constants dobson et al 1985 while β and β are empirically determined as functions of soil texture based on mass fractions of sand s sand mass total dry mass and clay c clay mass total dry mass β 1 2748 0 519 s 0 152 c β 1 33797 0 603 s 0 166 c the quantities ɛ f w f m and ɛ f w f m are the real and imaginary parts of the relative dielectric constant of free water given by 11 ɛ f w ɛ w ɛ w 0 ɛ w 1 2 π f τ w 2 12 ɛ f w 2 π f τ w ɛ w 0 ɛ w 1 2 π f τ w 2 σ e f f ρ s ρ b 2 π f ɛ 0 ρ s m v where f hz is the frequency τw s is the relaxation time for water ɛ w 0 80 1 f m at20 c is the static dielectric constant for water ɛ w 4 9 f m is the high frequency limit of ɛ f w and ε0 f m is the permittivity of free space peplinski et al 1995 provide a value of 0 58 10 10 s for the product 2πτw and define for a range of low frequencies 0 3 1ghz an empirical equation to estimate the effective conductivity s m σ e f f 0 0467 0 2204 ρ b 0 4111 s 0 6614 in case of devices buried in proximity of the ground surface we need to consider a two path model to account for the reflection effect on the underground signal propagation li et al 2007 in this case the total path loss is defined in db as 13 l f l p v d b where v d b 10 l o g v 2 db is the attenuation factor due to the second path and v 2 1 γ e α δ r 2 2 γ e α δ r c o s π ϕ 2 π λ δ r δ r r d m is the difference between the two paths γ and ϕ the amplitude and phase angle of the reflection coefficients at the reflection point vuran and silva 2009 2 2 global sensitivity analysis most sensitivity analyses in literature are still local or one parameter at a time thus relying on the assumptions of model linearity and additivity ferretti et al 2016 here we employ a global approach to perform sensitivity analysis in order to overcome these limits and explore simultaneously the full range of variation of key texture parameters in this way it is possible to i handle interaction effects among input uncertainties and ii clearly identify how uncertainty in the output of a model can be apportioned to different sources of uncertainty in input among global approaches we resort to widely used variance based metrics the sobol indices which pinpoints for which sources of uncertainty additional data should be collected to narrow the variance associated with model predictions saltelli et al 2000 sobol 1993 variabilities of porosity n and sand and clay contents s c reflect the uncertainty in soil texture for the sake of simplicity and consistency with the model presented in section 2 1 we adopt a zonation approach ciriello et al 2017 and we assume that the soil consists of a single uniform stratum of either clay loam cl loam l or sandy loam sl we assign to each type of soil the mean and standard deviation identified by carsel and parrish 1988 as presented in table 1 we apply gsa to identify for each soil the regions of influence of soil texture parameters in the mv f d space to do this we derived a truncated polynomial chaos expansions pce wiener 1938 which approximates lp as 14 l p m v f d p j 0 n q 1 a j m v f d ψ j p n q n par n pol n par n pol where p n s c is the vector of uncertain texture parameters and ψj p denotes multivariate hermite polynomials we use the stochastic collocation sc method webster et al 1996 to compute the deterministic expansion coefficients aj the zero order coefficient a 0 mv f d corresponds to the mean of lp i e l p m v f d a 0 m v f d the variance of lp is computed as 15 σ l p 2 m v f d j 1 n q 1 a j 2 m v f d ψ j 2 p which is derived from 14 by accounting for the orthogonality of the hermite polynomials ψ i ψ k 0 for all i k the sc is well suited for the low dimensional probability spaces such as n par 3 considered in the present study e g ciriello et al 2013a 2015 2013b and the references therein the sobol indices sobol 1993 provide a metric of the relative impact of each parameter affected by uncertainty see table 1 on the overall predictive uncertainty as quantified by 15 the contribution of the ith parameter pi to the response variance is quantified by a principle sensitivity index s i which is defined based on the pce approximation by sudret 2008 16 s i m v f d σ l p i 2 σ l p 2 σ l p i 2 m v f d γ γ i a γ 2 m v f d ψ γ 2 p i where γ i γ 1 n q 1 ψ γ p i this definition can be easily extended to evaluate the joined influence of a subset of model parameters in case that principle sensitivity indices do not provide a full description of the response variance the sobol indices computed for all the possible subsets of parameters sum up to unity sobol 1993 global sensitivity metrics including the sobol indices are generally computed by means of monte carlo simulations sobol 2001 however depending on the complexity of model equations and the number of uncertain parameters the deriving computational cost may discourage the use of global approaches for sensitivity analysis in these cases metamodeling techniques among which pce is one option represent powerful tools to accelerate the computational cost associated with gsa and other onerous stochastic analyses for the purposes of this study the approximation of the response surface with pce is build upon soil texture uncertainty while leaving information on the variability of operating conditions d and f within the deterministic coefficients aj this is done to distinguish among epistemic uncertainty and response variability due to the design operating parameters 3 results and discussion here we provide results of gsa for the single path transmission mechanism based on a second order pce which provides an accurate approximation of the model response surface not shown and requires only 10 full model runs to be calibrated gsa results are presented in figs 2 4 for clay loam loam and sandy loam respectively these figures depict lp vs f in the range 0 3 1 ghz for constant values of mv between 0 05 and 0 5 within the area delimited by the curves correspondent to m v 0 05 and m v 0 5 we explore variation of sensitivity indices for the sake of brevity for each selected soil type we represent the case of two devices at a distance d 3 m this is a reasonable configuration for practical applications nevertheless we also performed gsa in case of d 1 6 m not shown and we observed that the sobol indices are not significantly affected by this parameter in case of clay loam the principal sensitivity indices associated with n s and c are depicted in fig 2 it is shown that generally the indices exhibit a negligible variation with f while it is relevant to analyze their behavior with respect to mv influence of n as denoted by sn values is always above 0 6 and increases with mv till about 0 85 when the water content tends to 0 5 regarding to at the principal sensitivity index associated with s an opposite behavior respect to mv variations is detected specifically the sand content is relevant ss 0 1 in case of low values of mv 0 15 with a maximum of about 0 25 for m v 0 05 the principal sensitivity index of c exhibits a very low variation with mv within the range 0 14 0 17 maximum values for sc are reached in a middle range of water content values between 0 1 and 0 3 in case of loam the principal sensitivity indices associated with n s and c are depicted in fig 3 also in this case the indices exhibit a low variation with f regarding to sn it varies within the range 0 3 0 4 and is maximum for high values of both mv and f when looking at ss it is possible to observe that the sand content is relevant ss 0 1 in case of low values of mv 0 1 with a maximum of about 0 2 for m v 0 05 the principal sensitivity index of c exhibits a low variation with mv within the range 0 44 0 53 maximum values for sc are reached in a middle range of water content values between 0 1 and 0 3 in case of sandy loam the principal sensitivity indices associated with n s and c are depicted in fig 4 regarding to sn its value is almost constant with respect to f and increases weakly with mv within the range 0 1 0 15 when looking at ss it is possible to observe a moderate decrease when f increases and that the sand content is relevant ss 0 1 in case of high values of mv 0 25 with a maximum of about 0 3 when mv tends to 0 5 the principal sensitivity index of c increases with f and exhibits a moderate variation with mv within the range 0 5 0 68 maximum values for sc are reached in the range of water content values 0 1 0 3 table 2 focuses on gsa results for two experimental settings in which the two devices at a distance d 3 m work with an operating frequency of either f 0 868 ghz lora or f 0 433 ghz ism band and are able to detect path losses lp 151 db under these conditions the range of measurable path loss increases with the grain size of the soil as already shown in figs 2 4 as a consequence for f 0 868 ghz in case of clay loam it is possible to have only an estimate of mv if 0 19 while for loam and sandy loam it is possible to estimate mv if 0 30 and 0 50 respectively for the selected frequency and within the detectable range of lp values we observe that for the clay loam the variability of n is responsible for the 58 79 of the uncertainty related to the estimate hence this parameter has to be estimated with high accuracy in order to reduce the predictive uncertainty while influence of c is almost constant and responsible in average for only the 15 of the predictive uncertainty influence of s varies significantly and only for the minimum detectable values of lp it is quite significant contributing for a maximum of 26 to the predictive uncertainty for a loamy soil n and c are both important with an average contribution of about 35 and 49 respectively again the influence of s is associated with the highest variability with a maximum contribution of 18 for the minimum detectable lp finally in case of sandy loam the most important parameter is c which is responsible in average for the 60 of the predictive uncertainty influence of n is low about 13 and almost constant while the contribution of s shows again a variability and in this case it has a maximum of 18 for the maximum measurable value of lp when considering f 0 433 ghz in case of clay loam it is possible to have an estimate of mv if 0 40 while for loam and sandy loam it is possible to estimate mv if 0 50 it is shown that the results do not exhibit significant differences with respect to the other operating frequency this is in line with the general observation that sensitivity indices vary more with mv than with f the main difference exists in the range of values of mv that can be estimated this range is wider since lp decreases with f the sensitivity metrics discussed above show how the predictive uncertainty can be apportioned to the different sources of uncertainty in the model input in order to quantify the predictive uncertainty for the three selected soil types fig 5 represents the map of variance associated with lp in the selected mv f domain and for d 3 m it is not shown but the variance always increases with d as expected σ l p 2 increases with f in case of clay loam and loam σ l p 2 also increases with mv the opposite is detected for sandy loam we also note that the variance decreases when the grain size increases in field scale applications when lp is available from device s reading it is possible to use figs 2 4 to determine mv and identify which texture parameters have to be more accurately estimated to reduce the predictive uncertainty in this sense results of gsa can be read with respect to soil moisture given the correspondence between mv and lp when texture and operating parameters are fixed note that results of gsa with respect to lp i e the device s reading may represent a basis for the application of other techniques such as data assimilation sensitivity based model calibration or model selection ciriello et al 2015 2013b in order to reduce the epistemic uncertainty and increase the reliability of mv estimations at the same time in case of a two path transmission mechanism results of gsa are very similar as shown in appendix a 4 conclusions in this work we characterize the predictive uncertainty associated with the path loss when adopting wucns to estimate soil moisture in particular we focus on uncertainty deriving from textural parameters which significantly influence the path loss of the signal transmitted to the receiver as expressed in the selected underlying mathematical framework we perform gsa and propagate texture uncertainty based on the pce technique to reduce the computational cost associated with the analysis we produce sensitivity and variance maps in order to fully characterize the predictive uncertainty as a guide for practical applications and we apply our methods to i different transmission mechanisms either single path or two path models ii different device distances 1 6 m and iii three soil types clay loam loam and sandy loam our study reveals that lp varies significantly with the operating parameters f and d for given soil texture and moisture and the same is true for the predictive uncertainty i e σ l p 2 at the same time the operating conditions have a negligible impact on the selected sensitivity indices this means that the most influential texture parameters which may deserve additional data collection vary only with soil type and moisture this is relevant in field scale applications where d and f are typically controlled by spatial and or technological constraints we also find that the transmission mechanism see appendix a does not impact significantly on gsa results and on the predictive uncertainty gsa reveals that if in case of clay loam variability on the porosity explains most of the predictive uncertainty in case of sandy loam the clay content is the parameter which requires the most accurate estimate when considering a loamy soil these two parameters are almost equally important influence of sand content is significantly variable for the three soil types it increases with mv in case of sandy loam while the opposite happens when considering the other two soils in general sensitivity indices exhibit significant variations with mv our findings can be easily extended to other soil types at the same time in a future analysis we want to extend our approach in order to consider alternative models respect to the one suggested by peplinski et al 1995 and evaluate their predictive capacity against measurements following the method suggested in ciriello et al 2015 2013b acknowledgments this work was supported in part by the european project brigaid project id 700699 there are no data sharing issues since all of the numerical information is provided in the figures produced by solving the equations in the paper appendix a influence of two path transmission results presented below refer to a couple of devices at a distance d 3 m and depth z 1 z 2 0 2 m in this configuration the ground surface is responsible for reflection of the signal towards the receiver figs a 6 a 8 depict the same results of figs 2 4 for the two path transmission mechanism the same holds for table a 3 and fig a 9 with respect to table 2 and fig 5 it is possible to observe that gsa results as well as the variance of the response are very similar to those derived for the single path model main differences involve the trend of lp f curves for constant mv especially for low path loss values given these results and considering that in the most of applications the single path mechanism holds it seems not relevant to analyze the effect of ground surface reflection if the aim is to understand which parameter influences more the predictive uncertainty furthermore the two path model includes a couple of additional parameters ϕ and γ thus making calibration challenging in practical applications as such it seems generally convenient to perform gsa and uncertainty quantification on the single path model in order to characterize and reduce the predictive uncertainty by addressing measurements towards the most significant parameters 
727,soil moisture is a key parameter which governs the soil water balance and affects hydrologic processes such as water infiltration and evapotranspiration these processes are critical in several fields related to water resources including precision agriculture and drought management as such increasing attention is paid to field estimation of soil moisture indirect methods are generally preferred as they are non destructive and measures can be detected almost continuously in time among indirect methods here we focus on wireless underground communication networks wucns which is a promising technique based on the transmission of radio waves to a buried collector from measurements of the electromagnetic loss and based on either single path or two path models information on soil moisture can be retrieved in this context we perform global sensitivity analysis gsa to investigate how parametric uncertainty associated with soil texture plagues soil moisture predictions this is critical to identify which texture parameters require accurate estimation to narrow the uncertainty associated with predictions in practical applications in particular we study the influence of porosity and of sand and clay contents and found significantly different results for diverse soil types thus suggesting the importance of a preliminary gsa to guide the design of measurement campaigns on field keywords global sensitivity analysis soil moisture wireless underground communication networks soil texture subsurface hydrology 1 introduction 1 1 wireless underground communication networks soil moisture is a key quantity in the field of drought management and to close the soil water balance in hydrologic modeling it also plays a critical role in precision agriculture for enabling flexible and smart irrigation strategies e g ahmad et al 2018 huang et al 2017 martnez fernndez et al 2015 moghadas et al 2017 narasimhan and srinivasan 2005 sheffield and wood 2008 soil moisture can be measured directly through the gravimetric method which is however a destructive time consuming approach difficult to use in practical applications due to these limitations several indirect methods have been developed to provide a measure of another quantity that can be related to soil moisture through physically based and empirical equations a widely used technology focused on dielectric measurements is time domain reflectometry tdr which has shown to be more accurate and economical if compared to frequency domain reflectometry fdr however both these technologies provide local scale single point measures in order to move towards field scale measures one may resort to geophysical methods such as ground penetrating radar gpr that is however an expensive technology or electrical resistivity measurements with the disadvantage that data acquisition is periodic or requires regular field surveys for more details on indirect methods see e g bittelli 2011 dobriyal et al 2012 and references therein in this context a recent and promising monitoring technique consists in the basic configuration of two radio transceivers hereinafter denoted as devices buried underground that can exchange signals and make possible to provide indirect estimates of soil moisture without the need for an ad hoc device based on the idea that radio waves propagate through the soil with a loss rate which depends on the volumetric water content e g akyildiz and stuntebeck 2006 akyildiz et al 2009 dong et al 2013 vuran and silva 2009 and references therein in addition this approach provides an average estimate over the transmission volume instead of a single point measure soil moisture is measured locally and then transmitted by the receiving node to a surface gateway the latter will forward data to the internet through e g a uav repeater flying above the area measuring soil moisture at 30 100 cm depth through devices connected to the internet may provide critical real time information for several applications lora is a novel wireless technology for the iot internet of things even much more robust to power losses than its predecessors lora operates on ism bands that are available in the world on a region and country level basis in itu region 1 including europe the 863 mhz 870 mhz frequency range can be used by lora devices however in countries like italy the availability of the band is limited to the range 868 870 mhz in region 2 americas the available frequency range is 902 mhz 928 mhz from the viewpoint of the underground propagation channel it is expected that no major differences are found between these options the lora technology can provide successful detection of data pockets suffering a power loss of up to 151 db when very low data rates are needed theoretically such margin to loss enables to link zones of up to 10 m underground depending on soil texture and moisture and the antenna type 1 2 mathematical foundation em wave propagation in soil can be described with a link budget based on the friis equation with an additional term accounting for the attenuation induced by the soil with respect to free space propagation e g li et al 2007 and references therein the power of the received signal pr db is computed as follows 1 p r p t g r g t l 0 l s where pt db is the transmitted power gr db and gt db are the gains of the receiver and transmitter antennae respectively l 0 db is the path loss in free space and ls db the additional path loss due to the soil these losses are given by 2 l 0 20 log 4 π d λ 3 l s l β l α 20 log λ 0 λ e 2 α d where d m is the distance between devices lβ db is due to the difference of signal wavelength in soil λ 2 π β with respect to the same in free space λ 0 c f with β rad m the phase shifting constant and f hz the operating frequency lα db is the transmission loss caused by attenuation with attenuation constant α 1 m both α and β depend on the dielectric properties of soil the permeability μ h m the conductivity σ s m and the permittivity ε f m let s consider the helmholtz equations written in terms of phasor vector equations 4 2 e s γ 2 e s 0 2 h s γ 2 h s 0 where es is the phasor vector associated with the electric field e v m through the relationship e t i ω e s the same holds for hs which is the phasor vector associated with the magnetic field h a m balanis 2012 in 4 γ is the propagation constant which is defined as follows 5 γ i ω μ σ i ω ɛ where ω rad s is the angular frequency ω 2 π f by imposing γ α i β from 5 it is possible to derive the following expressions for α and β as functions of the dielectric soil properties 6 α β ω μ ɛ 2 1 σ ω ɛ 2 1 1 3 impact of soil texture on measurements given that the soil consists in a multiphase medium of air water both bound and free and bulk soil em wave propagation is generally facilitated in case of low soil density and high porosity combined with low water contents as the rate of air presence is larger under these conditions the volumetric moisture content provides a critical contribution to the em wave attenuation it includes information about the presence of bound and free water at a time soil texture analysis and specifically the quantity of clay in the soil allows one to distinguish among these two contributions frequency also affects the dielectric constants the range of frequencies used in practical applications is 0 3 1 ghz which is associated with reasonable dielectric constants for wireless communication and feasible sizes of the antenna from a geometrical point of view the distance between devices also plays a role as well as the burial depth in case of low depths underground generally 0 3 0 5 m the ground surface produces a reflection refraction effect which has to be considered in this case the received signal consists of two components a direct path from the transmitter to the receiver and a reflecting path due to the ground surface a two path model has to be preferred in this case with respect to the single path conceptualization see fig 1 the path loss increases with frequency and distance between devices and is affected by soil moisture and texture in turn if one uses wucns to estimate soil moisture it is critical to perform preliminary analysis to properly design measurement campaigns under specific field conditions in particular it is relevant to identify the influence of soil texture parameters on path loss values given the uncertainty which typically characterizes the subsurface environment and specifically the vadose zone e g assouline et al 2017 brandhorst et al 2017 tartakovsky 2013 as such in this paper we perform a variance based gsa through the computation of the sobol indices sobol 1993 2001 to provide an insight in how to reduce predictive uncertainty and properly adopt this monitoring approach in practical applications to perform gsa we resort to the equations introduced in section 1 2 and to a semi empirical model suggested by peplinski et al 1995 which provides expressions for the dielectric properties of soils as function of soil porosity and clay and sand percentages in the range 0 3 1 3ghz the resulting mathematical framework is then reduced by means of an efficient computational algorithm based on the polynomial chaos expansion pce technique ghanem and spanos 1991 sudret 2008 wiener 1938 with this method we approximate the response surface which is the path loss for diverse values of soil moisture and operating frequency in the random parameter space given by the joint pdf of the uncertain texture parameters this paper is arranged as follows in section 2 we present the mathematical model and its pce based reduction for the purposes of gsa in section 3 we provide maps of gsa metrics in the parameter space with a focus on three soil types namely clay loam cl loam l and sandy loam sl and on an operating frequency of either f 0 868 ghz lora or f 0 433 ghz ism band a discussion on practical implications of our results is also provided in this section major conclusions drawn from our study are presented in section 4 2 material and methods 2 1 equations we start considering a single path model to study em wave propagation through the soil at high burial depths typically 0 5m in this case from 2 to 3 it is possible to represent the overall path loss lp in db as follows vuran and silva 2009 7 l p l 0 l s 6 4 20 log d 20 log β 8 69 α d based on 5 and introducing the complex permittivity of the medium ɛ c ɛ 1 i σ ω ɛ ɛ i ɛ both ε and ε are in f m constants α and β can be rewritten as 8 α β ω μ ɛ 2 1 ɛ ɛ 2 1 we resort to the semi empirical model proposed by peplinski et al 1995 which provides expressions for ε and ε as 9 ɛ 1 15 1 ρ b ρ s ɛ s α 1 m v β ɛ f w α m v 1 α 0 68 10 ɛ m v β ɛ f w α 1 α where mv is the volumetric moisture content ρ s 2 66 g cm 3 is the specific density of solid soil particles and ρ b ρ s 1 n is the bulk density with n the soil porosity α 0 65 and ɛ s 4 7 f m which is the soil solid permittivity are empirically determined constants dobson et al 1985 while β and β are empirically determined as functions of soil texture based on mass fractions of sand s sand mass total dry mass and clay c clay mass total dry mass β 1 2748 0 519 s 0 152 c β 1 33797 0 603 s 0 166 c the quantities ɛ f w f m and ɛ f w f m are the real and imaginary parts of the relative dielectric constant of free water given by 11 ɛ f w ɛ w ɛ w 0 ɛ w 1 2 π f τ w 2 12 ɛ f w 2 π f τ w ɛ w 0 ɛ w 1 2 π f τ w 2 σ e f f ρ s ρ b 2 π f ɛ 0 ρ s m v where f hz is the frequency τw s is the relaxation time for water ɛ w 0 80 1 f m at20 c is the static dielectric constant for water ɛ w 4 9 f m is the high frequency limit of ɛ f w and ε0 f m is the permittivity of free space peplinski et al 1995 provide a value of 0 58 10 10 s for the product 2πτw and define for a range of low frequencies 0 3 1ghz an empirical equation to estimate the effective conductivity s m σ e f f 0 0467 0 2204 ρ b 0 4111 s 0 6614 in case of devices buried in proximity of the ground surface we need to consider a two path model to account for the reflection effect on the underground signal propagation li et al 2007 in this case the total path loss is defined in db as 13 l f l p v d b where v d b 10 l o g v 2 db is the attenuation factor due to the second path and v 2 1 γ e α δ r 2 2 γ e α δ r c o s π ϕ 2 π λ δ r δ r r d m is the difference between the two paths γ and ϕ the amplitude and phase angle of the reflection coefficients at the reflection point vuran and silva 2009 2 2 global sensitivity analysis most sensitivity analyses in literature are still local or one parameter at a time thus relying on the assumptions of model linearity and additivity ferretti et al 2016 here we employ a global approach to perform sensitivity analysis in order to overcome these limits and explore simultaneously the full range of variation of key texture parameters in this way it is possible to i handle interaction effects among input uncertainties and ii clearly identify how uncertainty in the output of a model can be apportioned to different sources of uncertainty in input among global approaches we resort to widely used variance based metrics the sobol indices which pinpoints for which sources of uncertainty additional data should be collected to narrow the variance associated with model predictions saltelli et al 2000 sobol 1993 variabilities of porosity n and sand and clay contents s c reflect the uncertainty in soil texture for the sake of simplicity and consistency with the model presented in section 2 1 we adopt a zonation approach ciriello et al 2017 and we assume that the soil consists of a single uniform stratum of either clay loam cl loam l or sandy loam sl we assign to each type of soil the mean and standard deviation identified by carsel and parrish 1988 as presented in table 1 we apply gsa to identify for each soil the regions of influence of soil texture parameters in the mv f d space to do this we derived a truncated polynomial chaos expansions pce wiener 1938 which approximates lp as 14 l p m v f d p j 0 n q 1 a j m v f d ψ j p n q n par n pol n par n pol where p n s c is the vector of uncertain texture parameters and ψj p denotes multivariate hermite polynomials we use the stochastic collocation sc method webster et al 1996 to compute the deterministic expansion coefficients aj the zero order coefficient a 0 mv f d corresponds to the mean of lp i e l p m v f d a 0 m v f d the variance of lp is computed as 15 σ l p 2 m v f d j 1 n q 1 a j 2 m v f d ψ j 2 p which is derived from 14 by accounting for the orthogonality of the hermite polynomials ψ i ψ k 0 for all i k the sc is well suited for the low dimensional probability spaces such as n par 3 considered in the present study e g ciriello et al 2013a 2015 2013b and the references therein the sobol indices sobol 1993 provide a metric of the relative impact of each parameter affected by uncertainty see table 1 on the overall predictive uncertainty as quantified by 15 the contribution of the ith parameter pi to the response variance is quantified by a principle sensitivity index s i which is defined based on the pce approximation by sudret 2008 16 s i m v f d σ l p i 2 σ l p 2 σ l p i 2 m v f d γ γ i a γ 2 m v f d ψ γ 2 p i where γ i γ 1 n q 1 ψ γ p i this definition can be easily extended to evaluate the joined influence of a subset of model parameters in case that principle sensitivity indices do not provide a full description of the response variance the sobol indices computed for all the possible subsets of parameters sum up to unity sobol 1993 global sensitivity metrics including the sobol indices are generally computed by means of monte carlo simulations sobol 2001 however depending on the complexity of model equations and the number of uncertain parameters the deriving computational cost may discourage the use of global approaches for sensitivity analysis in these cases metamodeling techniques among which pce is one option represent powerful tools to accelerate the computational cost associated with gsa and other onerous stochastic analyses for the purposes of this study the approximation of the response surface with pce is build upon soil texture uncertainty while leaving information on the variability of operating conditions d and f within the deterministic coefficients aj this is done to distinguish among epistemic uncertainty and response variability due to the design operating parameters 3 results and discussion here we provide results of gsa for the single path transmission mechanism based on a second order pce which provides an accurate approximation of the model response surface not shown and requires only 10 full model runs to be calibrated gsa results are presented in figs 2 4 for clay loam loam and sandy loam respectively these figures depict lp vs f in the range 0 3 1 ghz for constant values of mv between 0 05 and 0 5 within the area delimited by the curves correspondent to m v 0 05 and m v 0 5 we explore variation of sensitivity indices for the sake of brevity for each selected soil type we represent the case of two devices at a distance d 3 m this is a reasonable configuration for practical applications nevertheless we also performed gsa in case of d 1 6 m not shown and we observed that the sobol indices are not significantly affected by this parameter in case of clay loam the principal sensitivity indices associated with n s and c are depicted in fig 2 it is shown that generally the indices exhibit a negligible variation with f while it is relevant to analyze their behavior with respect to mv influence of n as denoted by sn values is always above 0 6 and increases with mv till about 0 85 when the water content tends to 0 5 regarding to at the principal sensitivity index associated with s an opposite behavior respect to mv variations is detected specifically the sand content is relevant ss 0 1 in case of low values of mv 0 15 with a maximum of about 0 25 for m v 0 05 the principal sensitivity index of c exhibits a very low variation with mv within the range 0 14 0 17 maximum values for sc are reached in a middle range of water content values between 0 1 and 0 3 in case of loam the principal sensitivity indices associated with n s and c are depicted in fig 3 also in this case the indices exhibit a low variation with f regarding to sn it varies within the range 0 3 0 4 and is maximum for high values of both mv and f when looking at ss it is possible to observe that the sand content is relevant ss 0 1 in case of low values of mv 0 1 with a maximum of about 0 2 for m v 0 05 the principal sensitivity index of c exhibits a low variation with mv within the range 0 44 0 53 maximum values for sc are reached in a middle range of water content values between 0 1 and 0 3 in case of sandy loam the principal sensitivity indices associated with n s and c are depicted in fig 4 regarding to sn its value is almost constant with respect to f and increases weakly with mv within the range 0 1 0 15 when looking at ss it is possible to observe a moderate decrease when f increases and that the sand content is relevant ss 0 1 in case of high values of mv 0 25 with a maximum of about 0 3 when mv tends to 0 5 the principal sensitivity index of c increases with f and exhibits a moderate variation with mv within the range 0 5 0 68 maximum values for sc are reached in the range of water content values 0 1 0 3 table 2 focuses on gsa results for two experimental settings in which the two devices at a distance d 3 m work with an operating frequency of either f 0 868 ghz lora or f 0 433 ghz ism band and are able to detect path losses lp 151 db under these conditions the range of measurable path loss increases with the grain size of the soil as already shown in figs 2 4 as a consequence for f 0 868 ghz in case of clay loam it is possible to have only an estimate of mv if 0 19 while for loam and sandy loam it is possible to estimate mv if 0 30 and 0 50 respectively for the selected frequency and within the detectable range of lp values we observe that for the clay loam the variability of n is responsible for the 58 79 of the uncertainty related to the estimate hence this parameter has to be estimated with high accuracy in order to reduce the predictive uncertainty while influence of c is almost constant and responsible in average for only the 15 of the predictive uncertainty influence of s varies significantly and only for the minimum detectable values of lp it is quite significant contributing for a maximum of 26 to the predictive uncertainty for a loamy soil n and c are both important with an average contribution of about 35 and 49 respectively again the influence of s is associated with the highest variability with a maximum contribution of 18 for the minimum detectable lp finally in case of sandy loam the most important parameter is c which is responsible in average for the 60 of the predictive uncertainty influence of n is low about 13 and almost constant while the contribution of s shows again a variability and in this case it has a maximum of 18 for the maximum measurable value of lp when considering f 0 433 ghz in case of clay loam it is possible to have an estimate of mv if 0 40 while for loam and sandy loam it is possible to estimate mv if 0 50 it is shown that the results do not exhibit significant differences with respect to the other operating frequency this is in line with the general observation that sensitivity indices vary more with mv than with f the main difference exists in the range of values of mv that can be estimated this range is wider since lp decreases with f the sensitivity metrics discussed above show how the predictive uncertainty can be apportioned to the different sources of uncertainty in the model input in order to quantify the predictive uncertainty for the three selected soil types fig 5 represents the map of variance associated with lp in the selected mv f domain and for d 3 m it is not shown but the variance always increases with d as expected σ l p 2 increases with f in case of clay loam and loam σ l p 2 also increases with mv the opposite is detected for sandy loam we also note that the variance decreases when the grain size increases in field scale applications when lp is available from device s reading it is possible to use figs 2 4 to determine mv and identify which texture parameters have to be more accurately estimated to reduce the predictive uncertainty in this sense results of gsa can be read with respect to soil moisture given the correspondence between mv and lp when texture and operating parameters are fixed note that results of gsa with respect to lp i e the device s reading may represent a basis for the application of other techniques such as data assimilation sensitivity based model calibration or model selection ciriello et al 2015 2013b in order to reduce the epistemic uncertainty and increase the reliability of mv estimations at the same time in case of a two path transmission mechanism results of gsa are very similar as shown in appendix a 4 conclusions in this work we characterize the predictive uncertainty associated with the path loss when adopting wucns to estimate soil moisture in particular we focus on uncertainty deriving from textural parameters which significantly influence the path loss of the signal transmitted to the receiver as expressed in the selected underlying mathematical framework we perform gsa and propagate texture uncertainty based on the pce technique to reduce the computational cost associated with the analysis we produce sensitivity and variance maps in order to fully characterize the predictive uncertainty as a guide for practical applications and we apply our methods to i different transmission mechanisms either single path or two path models ii different device distances 1 6 m and iii three soil types clay loam loam and sandy loam our study reveals that lp varies significantly with the operating parameters f and d for given soil texture and moisture and the same is true for the predictive uncertainty i e σ l p 2 at the same time the operating conditions have a negligible impact on the selected sensitivity indices this means that the most influential texture parameters which may deserve additional data collection vary only with soil type and moisture this is relevant in field scale applications where d and f are typically controlled by spatial and or technological constraints we also find that the transmission mechanism see appendix a does not impact significantly on gsa results and on the predictive uncertainty gsa reveals that if in case of clay loam variability on the porosity explains most of the predictive uncertainty in case of sandy loam the clay content is the parameter which requires the most accurate estimate when considering a loamy soil these two parameters are almost equally important influence of sand content is significantly variable for the three soil types it increases with mv in case of sandy loam while the opposite happens when considering the other two soils in general sensitivity indices exhibit significant variations with mv our findings can be easily extended to other soil types at the same time in a future analysis we want to extend our approach in order to consider alternative models respect to the one suggested by peplinski et al 1995 and evaluate their predictive capacity against measurements following the method suggested in ciriello et al 2015 2013b acknowledgments this work was supported in part by the european project brigaid project id 700699 there are no data sharing issues since all of the numerical information is provided in the figures produced by solving the equations in the paper appendix a influence of two path transmission results presented below refer to a couple of devices at a distance d 3 m and depth z 1 z 2 0 2 m in this configuration the ground surface is responsible for reflection of the signal towards the receiver figs a 6 a 8 depict the same results of figs 2 4 for the two path transmission mechanism the same holds for table a 3 and fig a 9 with respect to table 2 and fig 5 it is possible to observe that gsa results as well as the variance of the response are very similar to those derived for the single path model main differences involve the trend of lp f curves for constant mv especially for low path loss values given these results and considering that in the most of applications the single path mechanism holds it seems not relevant to analyze the effect of ground surface reflection if the aim is to understand which parameter influences more the predictive uncertainty furthermore the two path model includes a couple of additional parameters ϕ and γ thus making calibration challenging in practical applications as such it seems generally convenient to perform gsa and uncertainty quantification on the single path model in order to characterize and reduce the predictive uncertainty by addressing measurements towards the most significant parameters 
728,this paper discusses development and validation of a 3 d non hydrostatic reynolds averaged navier stokes rans model using the volume of fluid vof approach to simulate flooding events in natural environments a series of validation simulations in simple and complex geometries are performed to test the different modules of the flow solver the paper also discusses the differences between simulation results obtained using the 3 d model and those obtained using a standard 2 d hydrostatic depth averaged model the predictions by the two models show fairly large differences in regions where 3 d effects are expected to be significant e g in regions containing highly curved river reaches and near hydraulic structures then the validated 3 d model is employed to investigate the efficiency of using flood protection walls to reduce adverse effects of flooding in the iowa river near iowa city iowa usa finally the propagation of a flood wave in a reach of the iowa river containing a bridge is simulated and the effects of the flow becoming pressurized beneath the bridge deck are discussed for such applications in which the regime can change locally between open channel and pressurized flow the use of fully 3 d non hydrostatic models may be the only viable option to accurately predict flow hydrodynamics and its effects on bed shear stresses and sediment entrainment potential especially around locations where the flow becomes pressurized keywords floods numerical simulations flood mitigation 1 introduction several studies have shown that the frequency of flooding will increase under current changing climatic conditions milly et al 2002 making flooding a crucial topic of research for future planning of cities and major industrial works mossa 2007 flooding can have great repercussions on urban environments and can damage almost all structures placed over the floodplain molinari et al 2017 being able to predict the flood extent and flood wave propagation is of great importance for hydrologists and urban planners the proliferation of high resolution digital elevation maps hydrographic data and rapid development of efficient numerical tools has resulted in the development of hydrodynamic models capable of producing quantitative assessments of flood risk at very fine spatial and temporal scales hunter et al 2007 numerical models can also play an important role in the management of flood hazard and in investigating the efficiency of different flood protection measures radice et al 2012 flooding in riverine environments is a very complex hydrodynamic phenomenon in particular because of the flow interaction between the channel and its floodplain strong curvature effects and because of complex river dynamics in cases when the river contains man made hydraulic structures as a result 3 d effects may be significant in many practical applications involving flood wave propagation at least over certain regions and at certain times and affect capacity of numerical models to accurately predict flood extent peak flood levels and time to peak information on flood extent and flood wave propagation is usually obtained from 1 d e g bates and de roo 2000 omer et al 2003 casas et al 2006 mohammed et al 2006 and 2 d e g wagner and mueller 2001 dhondia and stelling 2002 musser and dryer 2005 models that solve the st venant shallow water flow equations with bed roughness parameterization based either on chezy or manning s coefficient another popular approach is based on the use of hybrid 1 d 2 d models in which the 1 d equations are solved along the main streams and the 2 d equations are solved over the floodplains frank et al 2001 dhondia and stelling 2002 these models are subject to limitations associated with simplifications and assumptions inherent to depth averaging or section averaging the governing equations of motion for instance even 1 d models that solve the dynamic wave equation e g hec ras mike11 cannot accurately simulate lateral flow into the floodplain whereas 2 d hydrostatic models cannot accurately predict flow in regions e g around areas of high channel curvature bridge piers groynes large bottom depressions submerged islands where separation and strong adverse pressure gradients are present frank et al 2001 haque et al 2007 overall standard hydrostatic 1 d and 2 d models were shown to be successful in some cases but also to sometimes provide inaccurate predictions of the flood depth flooded area and flood wave propagation speed during the flood event see concerted action on dam break modeling final report 2000 consequently most often large safety factors have to be added when results of these simulations are used to develop strategies to mitigate adverse flood effects to alleviate some of these deficiencies and limitations of standard lower order models more advanced non linear versions of 2 d models were proposed to account for 3 d secondary cross stream motions induced by curvature effects e g vasquez et al 2011 gamry and steffler 2005 blanckaert and de vriend 2010 ottewanger 2013 and for non hydrostatic effects over irregular topography bristeau et al 2011 lu et al 2015 arico et al 2016 both types of corrections use additional modeling assumptions to approximatively account for 3 d effects for example all up to date non hydrostatic 2 d model corrections assume a linear distribution of the dynamic pressure and vertical velocity over the flow depth obviously the assumption of vertical velocity linear variation over the flow depth is violated in regions where secondary flow motions are strong and contain multiple cells or if motions near the free surface are violent lu et al 2015 still such models were found to accurately predict free surface dynamics in complex cases involving 1 wave propagation over a deformed bed containing a submerged or an emerged flow obstruction and 2 wave propagation associated with a dam break or solitary waves tsunamis arico et al 2016 in principle more complex assumptions are possible e g use of multiple layers in the vertical direction over which a linear profile with different slopes in each layer may be assumed that should further improve simulation of dispersive effects e g accurately capturing wave phase in such models see discussion in lu et al 2015 arico et al 2016 such models have yet to be proposed and tested in this regards data from 3 d non hydrostatic simulations can be depth averaged and used to test the performance of these corrections as well as that of the simplifying assumptions and modeling of different terms in the governing equations of these lower order models to our knowledge none of the afore mentioned non hydrostatic 2 d models were used to predict flood wave propagation over natural terrain containing one or multiple streams together with their floodplains and man made structures e g buildings hydraulic structures which is the main type of application of interest for the present study more importantly this type of non hydrostatic corrections for 2 d models cannot be applied for cases where the flow can locally change regime from open channel to pressurized a situation often encountered in real applications in which bridges culverts and other hydraulic structures are present over the flooded region another important point is that all types of 1 d and 2 d models require extensive calibration for different flow conditions 3 d models that use meshes that are fine enough to insure a grid independent solution and resolve the large scale topography features and the other structures present over the deformed terrain require much less calibration on the other hand the main advantage of 1 d and 2 d models is that they can be applied to predict flood propagation over relatively large domains e g tens of kilometers in each horizontal direction and over large periods of time e g flood hydrographs with a duration of months something that is not yet possible using fully 3 d models because of the high computational resources needed both in terms of physical time to obtain the solutions and in terms of data storage and data postprocessing a way to overcome the limitations of 2 d models to accurately predict flood wave propagation over natural terrain containing large scale man made structures complex domains that introduce strong non hydrostatic effects is the use of fully 3 d non hydrostatic models with free surface tracking capabilities ideally large eddy simulation les techniques should be used for such simulations rodi et al 2013 khosronejad et al 2016 but this approach will remain computationally too expensive for applications involving flood wave propagation over naturally deformed terrain for at least 1 2 decades however for steady flow conditions state of the art 3 d non hydrostatic rans models can predict mean flow hydrodynamics in channels with natural bathymetry with an accuracy that is comparable to that of les zeng et al 2008a 2010 keylock et al 2012 and 3 d unsteady rans is feasible for applications involving flood wave propagation at least for relatively short flood events the flow field increases its level of three dimensionality e g stronger vertical accelerations changes in the dominant flow orientation with the distance from the bed flow separation in vertical planes secondary cross flow motions during unsteady events such as floods this is why careful validation is needed before applying such 3 d models to highly unsteady problems over complex topography the availability of the 3 d flow fields allows a better understanding of the flow physics during the flood wave propagation and in particular how secondary flow develops in time how the flows over the floodplain and the deeper parts of the main channel interact how the streamwise momentum is redistributed and how the potential for sediment erosion changes during the flood event finally there is an important class on engineering applications in which the flow regime can change locally from open channel flow to pressurized flow example of such applications are flood wave propagation in domains containing culverts and bridges where accurate estimation of the interaction of the flow with the hydraulic structure prediction of bed shear stresses and pressure scour effects cannot be obtained even with state of the art 2 d models frank et al 2001 for such applications the use of 3 d non hydrostatic models is basically the only option to obtain accurate solutions though the use of 3 d non hydrostatic rans models with advanced turbulence models e g k ε k ω sst in hydraulics and river engineering has become very popular rodi 1984 olsen and stokseth 2010 their application to simulate flooding problems has been very scarce and mainly focused on dam break problems biscarini et al 2010 2016 yang et al 2010 for example biscarini et al 2010 found that predictions obtained using a 3 d model developed in openfoam were overall more accurate than those obtained using a state of the art 2 d model cche 2d for several dam break test cases for which validation data were available form laboratory experiments soares frazao 2002 soares frazao and zech 2002 the development of such 3 d models requires careful validation this is especially important for the deformable free surface module which is essential to any simulations involving the propagation of a flood wave though different methods can be used to track the free surface all methods are subject to errors and their performance for flooding problems is not clear another big challenge is to determine the minimum level of grid refinement needed to obtain accurate predictions of flood evolution in time the required level of mesh refinement is different in different parts of the domains using very fine meshes over the whole computational domain is not an option given the huge computational costs required to simulate flood propagation in 3 d even for relatively small regions the present paper describes the main features of a fully 3 d non hydrostatic rans model to predict flood propagation in natural domains the model uses the volume of fluid vof method to account for free surface deformations following validation for relevant simpler cases the capabilities of the model to predict flood wave propagation over natural bathymetry containing various types of large scale structures are illustrated for several important types of applications including for a case when the flow becomes pressurized over a limited region during high flow conditions 2 numerical model the engine of the present 3 d model to simulate flood wave propagation in complex domains is the pressure poisson solver in star ccm the governing equations solved in the rans approach are the continuity and momentum equations 1 u i x i 0 2 u i t u i u k x k 1 ρ x k μ μ t u i x i u k x i g δ i 3 where ui is the velocity component along the i direction ρ is the density of the fluid μ is the molecular dynamic viscosity μt is the eddy viscosity predicted by the rans model p is the pressure g is the gravity and i 3 corresponds to the vertical direction the realizable k ε turbulence model using the two layer formulation is used to calculate μt the transport equations for the turbulent kinetic energy k and the turbulent dissipation rate ε are 3 k t k u j x j 1 ρ x j μ μ t σ k k x j f c g k ρ ɛ 4 ɛ t ɛ u j x j 1 ρ x j μ μ t σ ɛ ɛ x j f c c ɛ 1 s ɛ ρ ɛ k μ ɛ ρ c ɛ 2 ɛ the eddy viscosity is then calculated as 5 μ t ρ c μ k 2 ɛ where fc is a curvature correction factor gk is the production of turbulent kinetic energy due to velocity gradients and cμ rather than being a constant as is the case in the standard k ε model is a function of the mean rate of strain tensor magnitude mean rate of rotation tensor magnitude k and ε the exact expression of these terms along with the values of the other model constants in eqs 3 4 and 5 can be found in wilcox 1998 the two layer approach allows the standard realizable k ε turbulence model to be applied inside the viscous sublayer if the mesh is fine enough to resolve this layer by dividing the computational domain into two regions one close to the wall and one away from it in the layer close to the wall ε and μt are defined as functions of the wall distance the values of ε obtained in the near wall layer are then blended smoothly with the values obtained in the outer region where eq 4 is solved the transport equation for k is solved everywhere in the domain details on the two layer k ε model can also be found in wilcox 1998 this version of the k ε model was shown to perform well compared to other state of the art rans models for complex turbulent flows constantinescu and patel 2000 kashyap et al 2012 the volume of fluid vof method is used to track the location of the deformable free surface a layer of air is present over the parts of the domain that contain or can contain water during the simulation the vof method is based on the advection of the volume fraction of water α for which a standard advection equation α t u j α x j 0 is solved in cells fully occupied by water α 1 while in cells containing only air α 0 the finite volume navier stokes code solves eqs 1 and 2 integrated over elementary control volumes the adjective terms are discretized using a second order accurate upwind scheme while the discretization of the transient unsteady term is second order accurate in time based on an implicit representation the diffusive and pressure gradient terms are discretized using the second order central differences scheme the simple algorithm is used for solving the discretized navier stokes equations in the simple algorithm an intermediate velocity is obtained by solving the momentum equations without the pressure gradient term the intermediate velocity field does not satisfy the continuity a pressure correction algorithm is employed to modify the pressure field and in turn modify the mass fluxes and velocity fields such that the corrected velocity field satisfies continuity eqs 3 and 4 are integrated in a similar way to the momentum equations but the first order upwind scheme is used to discretize the convective terms the temporal discretization is second order accurate in time the navier stokes solver was already successfully used to predict steady flow in complex domains basnet et al 2015 cheng et al 2018 the advection term in the vof equation is discretized using the second order upwind scheme the temporal discretization is second order accurate though the vof module of the code was validated for many applications predicting flood events requires additional validation given that the flow is very shallow over large parts of the domain and rapid changes in the free surface can occur in regions where hydraulic structures are present the viscous solver in starccm is parallelized using mpi and has shown good scalability on pc clusters up to 1000 processors mesh generation is a critical step in being able to perform accurate simulations of flood events in complex and large domains in a reasonable amount of time star ccm contains a very powerful meshing capability in which an initial surface geometry e g topography of the terrain can be imported then smoothed in such a way to improve computational efficiency use of relatively large time steps without any significant loss of resolution of the main terrain features for applications in natural environments containing river reaches the level of refinement decreases as one goes from regions situated close to hydraulic structures to the river channel and then to the floodplains and outer regions e g regions containing air away from the water air interface this is an important step since a surface mesh of the boundaries is needed before creating a volume mesh once the geometry has been processed a volume mesh is created the goal is to obtain a high quality mesh with a sufficient level of grid refinement in critical regions of the flow mesh topologies include tetrahedral hexahedral and polyhedral models with mesh refinement near the boundaries in the present simulations hexahedral meshes were generally chosen since the control over the size and number of cells becomes more intuitive and because the discretization errors are generally smaller for such meshes hexahedral meshes are created using a meshing module that generates cube like cells based on the specified cell size on the surface boundary mesh it is also possible to create cells with different edge sizes in each direction this feature makes the use of this meshing module highly suitable for domains containing river channels and their floodplains since the mesh can be refined in the vertical direction while maintaining relatively large edge sizes in the horizontal directions the anisotropic cells are created in the pre specified sub regions during the surface re meshing procedure making the surface mesh consistent with the volume mesh for applications in natural environments the horizontal mesh resolution near hydraulic structures is between one half to one fourth of the horizontal mesh resolution in the river channel while the horizontal mesh resolution over the floodplains is twice that of the river channel the vertical mesh resolution in the three previously mentioned regions is about the same the vertical mesh resolution in the regions containing air away from the water air interface is about one order of magnitude larger than the mesh size in the river channel additional mesh refinement is generally performed near solid boundaries by creating high aspect ratio highly skewed cells named prism layers parallel to the boundary s surface generally the size of the first prism layer is chosen to be close to 100 wall units in the wall normal direction unless an equivalent roughness height is specified in the latter case the desired wall spacing is equal to twice the roughness height local roughness elements larger than 3 cm are resolved by the mesh in the applications discussed in the present paper the outlet and top opened to air boundaries where specified as pressure outlets the desired pressure and volume fraction of water were directly specified on all outlet and top boundary surfaces specifying the distribution of the volume fraction of water is equivalent to imposing a free surface elevation at the outlet boundary in the case when air is present next to the outlet boundary or the top boundary the pressure outlet boundary was 0 pa and the volume fraction of water was set to α 0 the inlet was specified as a velocity inlet with a specified level of the free surface no slip zero velocity boundary conditions were specified at the walls channel surface floodplain and surfaces of hydraulic structures in some simulations of laboratory experiments the terrain boundaries were assumed to be smooth for applications in natural environments the terrain boundaries were assumed to be rough the roughness height was set to two times the median grain size in the corresponding main channel or floodplain region of the topography the 2 d simulations were performed using the srh 2d code lai 2008 2010 which solves the full st venant equations with a parabolic turbulence model roughness parameterization is accounted for by specifying different values for the manning s coefficient over the various parts of the topography all 2 d simulations in complex domains were performed with calibrated values of the manning coefficient determined for the iowa river reach 3 model validation 3 1 flow in an s shaped open channel this subsection compares the numerical solution with experimental data for steady flow in an open channel figs 1 and 2 which was investigated in the lab by yen 1967 the s shaped channel contains two identical 90 bends connected by a small straight reach fig 1 the channel has a trapezoidal cross sectional geometry with 1 1 side slopes the bottom width is bb 1 83 m the radius of curvature of each bend is 8 54 m the mean inlet velocity is u 0 692 m s and the water depth at the inlet is h 0 156 m using these variables the channel reynolds number is close to 105 and the froude number is equal to 0 6 the computational mesh contains 550 000 cells with a near wall refinement equivalent to 2 5 wall units fig 2 shows the measured and computed non dimensional streamwise velocity profiles over the depth at section s0 fig 1 results are plotted at five different locations along the transverse direction η b where η is measured from the center of the channel the largest differences between numerical predictions and the lab measured velocity profile is observed at η b 0 461 where the simulation underpredicts the measured velocity at all flow depths at the other locations the simulation results show good agreement with the experimental data figs 3 and 4 show the transverse free surface profiles at four cross sections and the longitudinal free surface profiles along the two banks of the channel respectively the free surface corresponds to the α 0 5 isosurface the transverse free surface profiles predicted by the simulation are in good agreement with experimental data at all the four cross sections shown in fig 3 in fig 4 a positive free surface deflection is observed at the outer bank while a negative deflection is observed at the inner bank this behavior is induced by centrifugal force effects induced by channel curvature the computed longitudinal free surface profiles show the same trend as the measured data a slight over prediction of the free surface elevation is observed at the outer bank and a slight under prediction is observed at the inner bank based on the longitudinal free surface deflection the observed level of agreement between the present 3 d simulation and the experimental data is comparable to the one observed for other 3 d rans models zeng et al 2008b the good agreement observed between predictions and measurements of the velocity and free surface profiles for this test case prove that the present numerical model is capable of accurately simulating open channel flow problems where curvature effects and the associated cross stream secondary flow are controlling the free surface deformations 3 2 dam break in a straight open channel in the hypothetical abrupt failure of a dam bordering a reservoir the blocked column of still water spreads suddenly into the adjacent region downstream of the reservoir the most idealized case that mimics such an event is the one in which a rectangular column of water collapses on a flat horizontal surface martin and moyce 1952 studied this problem experimentally by collapsing a square column of water of height a 5 7 cm into an 28 5 cm long by 7 2 cm high channel of rectangular cross section the parameters tracked during the experiment were the front surge position measured from the left wall x and the remaining water column height at the left wall η the length and height of the computational domain size were 5a and 1 25a respectively consistent with the computational domain employed by kelecy and pletcher 1997 and with the experiment the left right and bottom boundaries were no slip smooth walls a pressure outlet boundary condition was specified at the top boundary fig 5 a shows the general layout of the 2 d dam break test case results are presented for a simulation performed using 800 200 mesh points in the horizontal and vertical directions respectively the solution on this mesh was checked to be grid independent and also to conserve the total volume of water with an error of less than 2 during the duration of the simulation fig 5b and c show that the simulation accurately predicts the temporal evolution of the front position and the remaining water column height as a function of the non dimensional time t t0 where the time scale is t0 a ga 1 2 and g is the gravitational acceleration this is a very relevant test case for applications in which the hydrograph describing the flooding event is characterized by large and rapid variations in the stage 4 flood wave propagation in a domain containing an 18 km long reach of the iowa river this sections tests the model capabilities to simulate steady flow and a flood wave propagating in a reach of the iowa river containing hydraulic structures fig 6 shows the location and horizontal extent of the computational domain the computational domain starts right downstream of the flood control dam section 1 1 where a river gaging station is present section 1 1 the end of the computational domain is located some distance downstream of the second river dam section 2 2 which is close to iowa city usa both river dams are in fact weir like structures the arrow points at clear creek the main tributary feeding into the iowa river near iowa city the inclusion of clear creek is of great importance due to significant backwater effects from the iowa river into clear creek during high flow conditions a second river gaging station is situated approximately 100 m downstream of the second river dam section 4 4 the bathymetry topography information is also shown in fig 6 the bathymetry was collected using single and multi beam hydrographic surveys while the topography information was obtained from 1 m resolution lidar data also included are the locations of 29 cross sections that are used to analyze the solutions both 2 d and 3 d simulations were conducted for this test case fig 7 shows the mesh generated on the bottom boundary over part of the domain containing the main stream in the 3 d mesh the horizontal resolution inside the main channel is around 1 25 m with a progressive coarsening to 20 m over the floodplain the horizontal resolution is slightly lower inside the main channel in the 2 d simulation and similar to that used in the 3 d simulation over the floodplain the higher resolution inside and around the main channel in the 3 d mesh was needed to avoid the development of spurious oscillations in the 3 d solution the 3 d mesh was additionally refined in the vertical direction to resolve the bottom boundary layer and the flow features over the large scale features of the bottom surface the refinement procedure uses a trimmer cell procedure and prisms layers as illustrated in fig 8 the extent of the computational domain in the 2 d simulation was the same as the one used in the 3 d simulation the 2 d model lai 2008 was calibrated for both low and high flow conditions in the iowa river the outlet boundary condition in the 2 d model is based on a specified rating curve at the outlet boundary based on the available rating curve at section 4 4 in fig 6 in the 3 d simulation the solution was simply extrapolated at the outlet boundary the biggest difference between the two models is the geometry near the river dams the 3 d model takes into account the exact shape of the dams based on old construction blueprints while the 2 d model accounts for the presence of the dams by including a bump in the geometry with the same crest elevation as that of the constructed river dams during the june july 2008 time frame the iowa river experienced the biggest flood in its history causing significant damage to several cities including iowa city in the days before the flood event the flow in the iowa river reach analyzed here was quasi steady low flow conditions once the flooding event started the discharge in the iowa river was characterized by large temporal variations the first three days of the flooding event will be analyzed the hydrographs of three gaging stations located near the inlet section right downstream of the 2nd river dam and in the clear creek stream are shown in fig 9 b one hydrograph corresponds to the usgs gaging station located 100 m downstream of the 2nd river dam the other two gaging stations were used to specify the inlet boundary conditions for the iowa river and clear creek a first simulation was done corresponding to steady low flow conditions time 0 in fig 9b for which the river discharge was q 245 m3 s the froude number and the reynolds number defined with the mean velocity u 0 51 m s and mean water depth at the inlet section h 5 45 m were 0 07 and 2 8 106 respectively the time step was 0 5 s the total number of grid cells was close to 12 million in the 3 d and 0 7 million in the 2 d simulations as shown in fig 9b the 3 d model accurately predicts the temporal variation of the flowrate at the location of the usgs gaging station the times to peak for the two relative maxima flowrates present in the hydrograph during the simulated time are accurately captured fig 9a shows the free surface elevation along the centerline of the channel predicted by the two models at steady low flow conditions as well as field data measurements between the inlet boundary and the 1st river dam the 2 d model underestimates the free surface elevation with respect to field data whereas the 3 d model follows very closely the field data especially in regions close to the inlet around halfway in between the inlet boundary and the 1st river dam the 3 d model starts to underestimate the elevation of the free surface in between the 1st and the 2nd river dam it is unclear which model represents the best the position of the free surface finally downstream of the 2nd river dam the 3 d model predictions are more accurate the 2 d model consistently underestimates the free surface elevation in the same region in particular the 3 d model successfully captures the changes in the free surface elevation around the two dams where the flow regime changes from subcritical to supercritical and then back to subcritical no free surface measurements along the river reach were available once the flood event started as the unsteady wave passes through the domain and the flowrates increase the flow depths predicted by the 2 d model become eventually larger than the ones predicted by the 3 d model at the end of the simulation time time 11 in fig 9b the 2 d model is consistently overestimating the flow depths with respect to the 3 d model by 2 3 while the differences between the flow depth predictions of two models at the latest time are relative low the overall percentage change from time 0 to time 11 is relatively large being as high as 10 while accurately predicting the location of the free surface is of most importance for flood modeling an analysis of the velocity and unit discharge distributions is also relevant it was found that 22 out of the 29 cross sections showed very good agreement between the 3 d model and 2 d model unit discharge profiles cross sections 2 8 9 11 12 13 and 14 showed relatively large differences for example fig 10 a and b compare the unit discharge distributions at cross sections 11 and 12 situated toward the exit from the high curvature region see fig 10c where cross stream secondary flow effects are expected to be significant at both cross sections the 2 d model predictions for low flow conditions underestimate the redistribution of the streamwise momentum toward the outer bank this is not surprising because this redistribution is driven by the formation of the cross stream cells of secondary flow that cannot be captured by 2 d models the differences between the low flow unit discharge predictions at section 12 are even larger than those observed at section 11 this is in part because two relatively deep scour holes are present in the channel between sections 11 and 12 fig 10c when comparing the unit discharge profiles predicted by the two models during the flooding event it was found that cross sections that showed good agreement at low flow conditions also showed relatively good agreement throughout the duration of the simulation however at sections where the solutions showed significant differences at low flow conditions time 0 the agreement worsened as the flood wave started propagating through the domain this can be clearly shown in fig 10a and b that compare the unit discharge profiles at time 0 and time 8 for the 2 d and 3 d simulations at all times the 2 d model predicts a much more symmetric distribution of the unit discharge with respect to the centerline of the main channel compared to the 3 d model results moreover at these sections the 3 d model predicts that the region of high streamwise velocity moves toward the outer bank with increasing total discharge an effect that the 2 d model cannot capture 5 flood wave propagation in a domain containing a 7 km long reach of the iowa river to investigate the efficiency of flood protection measures a 7 km long iowa river sub reach of the 18 km long reach considered in the previous section was chosen to conduct a series of simulations the 7 km long reach starts upstream of the 1st river dam and extends some distance downstream of the 2nd river dam fig 11 as already mentioned the dams are in fact weir structures fig 12 shows the bathymetry topography inside the computational domain together with the location of the cross sections that will be used for a more detailed analysis of the solution as well as the hydrograph that was specified at the inlet of the domain the peak discharge was about 30 larger than the peak discharge during the 2008 flood such that the efficiency of flood protection measures can be fully tested in the 3 d simulations the average grid resolution in the horizontal directions was 5 m in the main channel and 20 m over the floodplain the 3 d mesh contained close to 10 million cells and the time step was 0 1 s the 2 d model used a mesh with similar level of grid resolution in the horizontal directions steady state conditions were simulated for a flowrate of approximately 1150 m3 s which corresponds to flow conditions close to the peak flowrate experienced during the flood of 2008 then a sinusoidal unsteady wave with a flowrate amplitude of 600 m3 s propagated into the domain the 3 d model is also used to assess the effectiveness of deployment of temporary floodwalls in regions that are important to be protected against flooding most of the 3 d simulations were run on 64 processors 16 cores of 2 6 ghz with 4 gb ram processor of a pc cluster with myrinet inter connection the 3 d simulations took about 150 h to complete by comparison the calibrated 2 d model simulation was run on a single processor and took 16 h to complete 5 1 comparison between the 3 d and 2 d model predictions for the base case fig 13 b and c compare the flooding extent predicted by the 3 d and 2 d simulations at the initial steady state time 0 also shown in fig 13a is an aerial photograph taken after the peak of the flood of 2008 at approximately the same discharge q 1150 m3 s corresponding to the initial steady state in fig 13b and c the solid black line denoting the extent of the flooded region in the field was superimposed on the plots showing the flooded regions predicted by the 3 d and 2 d simulations respectively overall very good agreement is observed between the flooded regions predicted by the numerical simulations and those observed in the field the 2 d model inundates slightly more than the 3 d model for example this happens between section 1 and the 1st dam and between sections 2 and 3 overall the 2 d model overestimates the flood extent by approximately 7 compared to the 3 d model results at steady state both the 3 d and 2 d simulations predict a free surface elevation value at the location of the usgs gage within 0 05 m of the value obtained using the usgs rating curve the usgs gage is located downstream of the 2nd dam close to section 12 in fig 13 over the whole reach the maximum difference between the free surface elevations predicted by the 3 d and 2 d simulations at the initial steady state is close 0 3 m on average the 2 d simulation predicts a higher free surface elevation compared to the 3 d simulation at time 0 h during the propagation of the unsteady wave the differences between the free surface elevations predicted by the 3 d and 2 d simulations become larger at peak flood extent time 3 5 h the maximum difference is close to 0 7 m the 3 d simulation predicts the size of the flooded region at time 3 5 h fig 13d to be about 9 larger than the one predicted by the 2 d simulation still overall good qualitative agreement is observed between the 3 d and 2 d predictions of the flooded area at peak flood extent more insight into the differences between the two solutions can be obtained by comparing the unit discharge distributions at selected cross sections fig 14 out of the 12 cross sections where the two solutions were compared only 3 cross sections showed significant differences between the unit discharge distributions at the initial state and at peak flood extent the first one is section 1 which is situated in a region of high channel curvature right before the 1st dam the second one is section 11 which is located in a straight reach upstream of the 2nd river dam where in principle one should not expect large differences between the two solutions a very shallow region is present on the east side of the cross section the 3 d model predicts a unit discharge distribution skewed towards the west side of the channel by contrast the 2 d model predicts a fairly symmetric and close to uniform unit discharge distribution away from the two banks these differences are observed at both the initial state and at peak flood extent section 12 is located downstream of the 2nd river dam where the flow is influenced by the hydraulic jump caused by the presence of the dam given that the flow is highly three dimensional around the hydraulic jump the 3 d and 2 d solutions are very different from each other in this region the 3 d model predicts a two peak distribution of the unit discharge at section 12 due to the way the plunging core of high velocities interacts with the bathymetry downstream of the dam whereas the 2 d model predicts a fairly uniform unit discharge distribution overall the differences between the distributions of the unit discharge in the selected cross sections at the initial steady state and those after the flooding wave enters the domain are comparable most of these differences occur in regions where 3 d effects are generated by large scale bathymetry features the presence of hydraulic structures or of high curvature regions see also horna munoz and constantinescu 2016 5 2 use of floodwalls as a flood protection measure common flood protection strategies for regions surrounding a river include building levees temporary flood protection walls flood prevention dams and construction of ponds in the case of the iowa river near iowa city the favored approach of reducing the effect of floods is the deployment of temporary floodwalls such floodwalls do not allow water to flow into certain areas but may severely constrict the available area for flow passage the 3 d model is used to assess the effectiveness of installing floodwalls as a flood protection strategy as summarized in table 1 several regions where floodwalls may be installed scenario 1 to scenario 4 are considered currently iowa city is ready to install temporary floodwalls that extend from halfway between sections 8 and 9 until section 12 once a large flood is forecast these floodwalls are called fw3 additional floodwalls are proposed to be installed to protect regions situated near section 1 and the 1st dam fw 1 and between section 3 and halfway between sections 5 and 6 fw 2 steady state and unsteady solutions were obtained for the same flow conditions considered for the base case no floodwalls in section 5 1 fig 15 shows the flooded region at peak flood extent for the cases where floodwalls were installed in the computational domain case scenario 1 4 and for the base case floodwalls fw 3 are shown in red whereas fw 1 and fw 2 are shown in blue comparison of fig 15a and b shows that floodwalls fw 3 can protect areas in their close vicinity from flooding at peak flood extent without increasing in a significant way the flooding area upstream of their location a slight increase of the flood extent is observed between section 1 and the 1st dam as well as between sections 2 and 3 for case scenario 1 compared to the base case the slight increase of the flood extent in the aforementioned regions is overshadowed by the large reduction of the flood extent in the vicinity of fw 3 the net flood extent reduction is approximately 8 at the initial steady state and at peak flood extent for case scenario 1 compared to the base case case scenario 2 can efficiently protect against flooding regions situated in between sections 1 and 2 at peak flood extent fig 15c these areas are flooded in the base case and in case scenario 1 protecting this region is important as several hospitals are located there at all times during the propagation of the flood wave the flood extent reduction is 18 19 in case scenario 2 compared to the base case case scenario 3 fig 15d significantly reduces flooding between sections 3 and 6 at both the initial steady state and at peak flood extent a major residential area is located in the neighborhood of sections 3and 6 the flood extent reduction for case scenario 3 is approximately 15 at the initial steady state and 14 at peak flood extent compared to the base case case scenario 4 includes all floodwalls deployed in the previous cases fig 15d as expected the regions situated in the neighborhoods of sections 1 and 2 and of sections 3 and 6 are well protected at peak flood conditions the predicted reduction of the flooded area is 25 at the initial steady state and 26 at peak flood extent compared to the base case thus for case scenarios 1 4 the reduction of the flood extent is about the same for both the initial steady state and at peak flood extent conditions moreover even for case scenario 4 that contains the largest number of floodwalls no significant flooding is predicted in regions situated away from the floodwalls compared to the base case the presence of the floodwalls modifies the unit discharge distribution in their vicinity with respect to the base case this is always the case in cross sections cutting through the floodwalls the overall effect is an increase of the mean velocity in the cross section with respect to the base case this is illustrated in fig 16 which compares the unit discharge distributions at section 5 the largest differences are observed for case scenarios 3 and 4 that contain the fw2 floodwall at the left bank fig 16b and c show how the streamwise velocity distribution change in the cross section as a result of the presence of the fw2 floodwall in case scenario 4 compared to the base case in particular the core of large streamwise velocities is pushed toward the right bank as the total cross sectional discharge is not very different in the five cases analyzed here the unit discharge values at a given time should be larger in between the extremity of the floodwall and the right bank for case scenarios 3 and 4 compared to the other cases this is confirmed by the unit discharge distributions in fig 16a that show that the peak unit discharge is about 10 15 larger in case scenarios 3 and 4 compared to the base case fig 17 shows the free surface elevation profile along the centerline for the five cases no significant differences are observed at both the initial steady state and at peak flood extent among the different simulations compared to the base case the maximum increase of the free surface elevation for the cases with floodwalls is about 0 3 m and occurs at peak flow conditions when lots of the floodplain is inundated and thus a large increase in the flow discharge results in a relatively small increase in the free surface elevation overall comparison of the simulations results in figs 15 and 17 shows that the proposed floodwall designs can effectively protect the critical regions situated in the vicinity of the iowa river while not increasing significantly flooding away from these regions with case scenario 4 offering a comprehensive protection of the critical regions situated in the vicinity of the river reach 6 flood wave propagation in a domain containing a 2 km long reach of the iowa river and a bridge deck that can become submerged at high flows this section focuses on the simulation of a flood wave advancing in a 2 km long reach of the iowa river near iowa city the computational domain and the bathymetry are visualized in fig 18 a the reach contains a river dam same as 2nd river dam in fig 12a and a bridge deck corresponding to a bridge situated in the immediate vicinity of the dam fig 18b the length width and thickness of the bridge deck were 60 m 20 m and 0 2 m respectively the bridge deck was situated at about 4 m above the bottom of the main river channel at that location the mesh was refined around the bridge deck and around the crest of the weir corresponding to the river dam fig 18c to resolve the flow structures generated by the interaction of the flow with the bridge deck and the river dam the mesh resolution was consistent with the one of the test cases discussed in the previous two sections the 3 d mesh contained close to 3 million cells the time step was 0 1 s a full unsteady solution took 70 h to complete when run on 64 processors of the same pc cluster used to perform the other simulations in complex domains the inflow hydrograph fig 18d was chosen such that the bridge deck becomes submerged when the flood wave reaches the bridge and will remain so for several hours as this happens the flow regime changes from open channel flow to pressurized flow before changing back to open channel flow after the flood starts receding occurrence of pressurized flow over an erodible bed is known to generate larger bed shear stresses and thus severe scour these effects are referred to as pressure scour effects while all previous test cases can also be calculated using 2 d models this is not the case for applications when the flow becomes pressurized around a hydraulic structure or a flow obstruction even non hydrostatic 2 d models cannot be applied for such cases as the main modeling assumptions are violated the same is true for hydrostatic 3 d models the only way to obtain meaningful information on flow hydrodynamics and the capacity of the flow to entrain sediment is via a fully 3 d non hydrostatic model simulation to better understand the flow modifications induced by the bridge deck once it becomes submerged an additional simulation in which the bridge deck was not present was performed with identical boundary conditions and inflow hydrograph at times when the bridge deck is not submerged e g before the flood wave arrives in the region where the bridge is situated the streamwise velocity distribution in spanwise cross sections cutting through the bridge deck e g at section 1 in fig 18a is qualitatively similar to that observed at cross sections situated upstream of the bridge deck e g at section 2 in fig 18a the core of high streamwise velocities penetrates more on the deeper half of the main channel but does not move far away the center of the two cross sections see fig 19 a and c at time 0 3 h as the region around the bridge starts being flooded and the bridge deck becomes submerged the free surface elevation increases and the core of high streamwise velocities moves even more toward the deepest part of section 2 see fig 19b at time 2 0 h the same is true for the region situated beneath the bridge deck where the flow becomes pressurized fig 19d at time 2 0 h though the discharge in section 1 in the pressurized flow region 1350 m3 s is less than the one at section 2 at the same time instant 1640 m3 s the bed shear stresses are considerably larger in section 1 this is because the core of high streamwise velocities moves closer to the bed at the cross sections where the flow is pressurized and also extends laterally significantly more toward the shallower side of the cross section see fig 19b and d one should also mention that the occurrence of pressurized flow can also act toward decreasing the bed shear stress in regions situated upstream e g due to backwater flow effects induced by the bridge deck obstruction or downstream of it this is mostly because once the flow becomes pressurized the submerged bridge deck changes the direction of the flow approaching the crest of the weir fig 20 offers more quantitative evidence of the effects the change in the flow regime has on the bed shear stresses and consequently on the sediment entrainment capability of the flow beneath the bridge deck to isolate pressurized flow effects the temporal variation of the width averaged bed shear stress in section 1 fig 18a in the simulation containing the bridge deck is compared with results from a simulation containing no bridge deck where the flow regime remains the same open channel flow during the propagation of the hydrograph as expected the bed shear stresses are basically identical until the time when the flow becomes pressurized in the simulation containing the bridge deck interestingly there are very little time history effects such that once the free surface elevation decreases below that of the bridge deck the bed shear stresses predicted in the two simulations are again close to identical during the time the flow is pressurized the increase in the bed shear stress is very significant up to 50 in section 1 the predicted spatio temporal distributions of the bed shear stress in the two simulations can be used to estimate sediment entrainment during the flood event in the region situated directly beneath the bridge deck e g using van rijn formula van rijn 1984 for the mean sediment size present in the main channel d50 1 mm the erosive capacity of the flow during the time interval when the flow is pressurized in the simulation with the bridge deck is close to two times larger than during the same time interval in the simulation without the bridge deck as most of the sediment entrainment at bridge sites occurs at high flow conditions being able to estimate the maximum sediment entrainment capacity of the flow during a flooding event is of great importance for cases when the flow changes regime locally such estimations can only be obtained using the type of numerical models used in this study 7 final discussion and conclusions a 3 d non hydrostatic rans model with deformable free surface capabilities was developed within an existing cfd code to simulate flood propagation in natural river environments containing man made structures this is one of the first applications of time accurate rans for this type of problems the 3 d model was first validated for several simpler cases that tested the different features of the model and in particular its ability to capture the free surface position for steady and unsteady problems it was found that the 3 d model was able to accurately reproduce results obtained in laboratory experiments the model was then applied to calculate steady flow and flood wave propagation in domains containing a reach of the iowa river of a length of up to 18 km to better understand the performance of the 3 d model simulations were also performed using a calibrated 2 d hydrostatic depth averaged code that is routinely used to obtain flood predictions in the iowa river not surprisingly the largest differences between 3 d and 2 d model predictions for these cases were observed in regions where 3 d effects e g strong secondary cross stream currents strong vertical nonuniformity of the flow are expected to be important in the case of the 18 km long river reach test case with steady low flow conditions the 3 d model was able to predict the free surface elevation more accurately compared to the 2 d model when an unsteady hydrograph was propagated into the domain the 3 d model was able to reproduce the hydrograph recorded by a gaging station located within the domain with small differences during the simulated hydrograph the differences between the 3 d and 2 d predictions of the free surface elevation were as high as 10 for the high flow conditions present in the 7 km long river reach test case the floodplain is flooded this adds an additional challenge for numerical models as 3 d effects can be relatively important at the interface between the main channel and its floodplains at certain times during the propagation of the flood wave in terms of the surface flooded the differences between the 2 d model and the 3 d model predictions were 7 and 9 at the initial steady state and at peak flood extent respectively the validated 3 d model was then used to test the effectiveness of placing flood protection walls at different critical locations that need to be protected in the case of a flood event finally the 3 d model was used to predict interaction of a flood wave with a bridge deck that becomes submerged during the time the peak flow passes the region containing the bridge such type of applications in which the flow regime changes locally from open channel flow to pressurized flow and back to open channel flow cannot be correctly simulated even using state of the art 2 d non hydrostatic models because the main assumptions in these models are severely violated for such applications 3 d models are the only option to accurately predict the interaction of the flood wave with the hydraulic structure and its effect on flow hydrodynamics e g backwater flow effects can be induced at large distances from the location where the flow becomes pressurized bed friction velocity distributions and sediment entrainment potential though not considered in the present study coupling of such a 3 d model with a morphodynamics model will allow studying pressure scour effects the main challenge of using 3 d models for routine predictions of flood propagation in natural systems is the associated computational cost and resources required to perform the simulations not surprisingly the computational resources and physical times needed to perform the 3 d simulations reported in the present study and to generate the data bases were much larger than those required by the 2 d simulations with the rapid increase of computational power access to large scale computational resources needed to perform such 3 d simulations in a reasonable amount of time will continue to decrease fast such that such computations will start being used to study real flood scenarios in diverse environments one important point is that the present 3 d simulations in complex domains natural bathymetry containing large scale man made structures were run only on 64 processors on the type of pc clusters used to perform the simulations reported in the present study the numerical solver scales well up to about 1 000 processors so if computational resources are widely available the physical time needed to obtain a 3 d solution can be decreased by about one order on magnitude this is an important point especially for flood problems that cannot be correctly predicted using lower order models and for which 3 d non hydrostatic models are the only option to numerically investigate the effects of flood wave propagation another important observation is that 3 d models that resolve most of the relevant bathymetry features requires basically no calibration by contrast the calibration step can be quite time consuming for lower order models for example calibrating the 2 d model for the iowa river region simulated in the various test cases discussed in the present study required several weeks another main application of 3 d models of the type developed in the present study is for performing simulations of short flood events over relatively short domains containing hydraulic structures and other geometrical complexities where one suspects that the flow associated with the flood wave propagation will be subject to strong 3 d effects a major problem with current application of 1 d and 2 d models to predict floods in complex domains is that one does not have good guidelines to know the range of problems that can be accurately solved with such models and which geometrical and flow complexities result in a sudden decrease of the accuracy of their predictions as shown by the present study 3 d simulations of smaller scale flood problems though computationally expensive are feasible as such they can be used as a numerical experiment based on which the predictive capabilities of lower order e g 2 d hydrostatic 2 d non hydrostatic and 1 d models can be better assessed and ideas to improve or to better calibrate them can be tested this is important given that even laboratory experiments of flood wave propagation generally provide only a limited amount of data for validation data obtained from observations of floods occurring in real environments are even scarcer because of the hazard associated with collecting data during the floods molinari et al 2017 acknowledgments the authors would like to acknowledge the iowa flood center for supporting this study the authors would also like to acknowledge high performance computing support project dd 2015 geo117 from the oak ridge leadership computing facility olcf and in particular dr j wells from the national center for computational science at the oak ridge national laboratory as well as from the high performance computing center at the university of iowa we would like to thank prof w krajewski and prof j odgaard for many insightful comments and for their support in completing this study 
728,this paper discusses development and validation of a 3 d non hydrostatic reynolds averaged navier stokes rans model using the volume of fluid vof approach to simulate flooding events in natural environments a series of validation simulations in simple and complex geometries are performed to test the different modules of the flow solver the paper also discusses the differences between simulation results obtained using the 3 d model and those obtained using a standard 2 d hydrostatic depth averaged model the predictions by the two models show fairly large differences in regions where 3 d effects are expected to be significant e g in regions containing highly curved river reaches and near hydraulic structures then the validated 3 d model is employed to investigate the efficiency of using flood protection walls to reduce adverse effects of flooding in the iowa river near iowa city iowa usa finally the propagation of a flood wave in a reach of the iowa river containing a bridge is simulated and the effects of the flow becoming pressurized beneath the bridge deck are discussed for such applications in which the regime can change locally between open channel and pressurized flow the use of fully 3 d non hydrostatic models may be the only viable option to accurately predict flow hydrodynamics and its effects on bed shear stresses and sediment entrainment potential especially around locations where the flow becomes pressurized keywords floods numerical simulations flood mitigation 1 introduction several studies have shown that the frequency of flooding will increase under current changing climatic conditions milly et al 2002 making flooding a crucial topic of research for future planning of cities and major industrial works mossa 2007 flooding can have great repercussions on urban environments and can damage almost all structures placed over the floodplain molinari et al 2017 being able to predict the flood extent and flood wave propagation is of great importance for hydrologists and urban planners the proliferation of high resolution digital elevation maps hydrographic data and rapid development of efficient numerical tools has resulted in the development of hydrodynamic models capable of producing quantitative assessments of flood risk at very fine spatial and temporal scales hunter et al 2007 numerical models can also play an important role in the management of flood hazard and in investigating the efficiency of different flood protection measures radice et al 2012 flooding in riverine environments is a very complex hydrodynamic phenomenon in particular because of the flow interaction between the channel and its floodplain strong curvature effects and because of complex river dynamics in cases when the river contains man made hydraulic structures as a result 3 d effects may be significant in many practical applications involving flood wave propagation at least over certain regions and at certain times and affect capacity of numerical models to accurately predict flood extent peak flood levels and time to peak information on flood extent and flood wave propagation is usually obtained from 1 d e g bates and de roo 2000 omer et al 2003 casas et al 2006 mohammed et al 2006 and 2 d e g wagner and mueller 2001 dhondia and stelling 2002 musser and dryer 2005 models that solve the st venant shallow water flow equations with bed roughness parameterization based either on chezy or manning s coefficient another popular approach is based on the use of hybrid 1 d 2 d models in which the 1 d equations are solved along the main streams and the 2 d equations are solved over the floodplains frank et al 2001 dhondia and stelling 2002 these models are subject to limitations associated with simplifications and assumptions inherent to depth averaging or section averaging the governing equations of motion for instance even 1 d models that solve the dynamic wave equation e g hec ras mike11 cannot accurately simulate lateral flow into the floodplain whereas 2 d hydrostatic models cannot accurately predict flow in regions e g around areas of high channel curvature bridge piers groynes large bottom depressions submerged islands where separation and strong adverse pressure gradients are present frank et al 2001 haque et al 2007 overall standard hydrostatic 1 d and 2 d models were shown to be successful in some cases but also to sometimes provide inaccurate predictions of the flood depth flooded area and flood wave propagation speed during the flood event see concerted action on dam break modeling final report 2000 consequently most often large safety factors have to be added when results of these simulations are used to develop strategies to mitigate adverse flood effects to alleviate some of these deficiencies and limitations of standard lower order models more advanced non linear versions of 2 d models were proposed to account for 3 d secondary cross stream motions induced by curvature effects e g vasquez et al 2011 gamry and steffler 2005 blanckaert and de vriend 2010 ottewanger 2013 and for non hydrostatic effects over irregular topography bristeau et al 2011 lu et al 2015 arico et al 2016 both types of corrections use additional modeling assumptions to approximatively account for 3 d effects for example all up to date non hydrostatic 2 d model corrections assume a linear distribution of the dynamic pressure and vertical velocity over the flow depth obviously the assumption of vertical velocity linear variation over the flow depth is violated in regions where secondary flow motions are strong and contain multiple cells or if motions near the free surface are violent lu et al 2015 still such models were found to accurately predict free surface dynamics in complex cases involving 1 wave propagation over a deformed bed containing a submerged or an emerged flow obstruction and 2 wave propagation associated with a dam break or solitary waves tsunamis arico et al 2016 in principle more complex assumptions are possible e g use of multiple layers in the vertical direction over which a linear profile with different slopes in each layer may be assumed that should further improve simulation of dispersive effects e g accurately capturing wave phase in such models see discussion in lu et al 2015 arico et al 2016 such models have yet to be proposed and tested in this regards data from 3 d non hydrostatic simulations can be depth averaged and used to test the performance of these corrections as well as that of the simplifying assumptions and modeling of different terms in the governing equations of these lower order models to our knowledge none of the afore mentioned non hydrostatic 2 d models were used to predict flood wave propagation over natural terrain containing one or multiple streams together with their floodplains and man made structures e g buildings hydraulic structures which is the main type of application of interest for the present study more importantly this type of non hydrostatic corrections for 2 d models cannot be applied for cases where the flow can locally change regime from open channel to pressurized a situation often encountered in real applications in which bridges culverts and other hydraulic structures are present over the flooded region another important point is that all types of 1 d and 2 d models require extensive calibration for different flow conditions 3 d models that use meshes that are fine enough to insure a grid independent solution and resolve the large scale topography features and the other structures present over the deformed terrain require much less calibration on the other hand the main advantage of 1 d and 2 d models is that they can be applied to predict flood propagation over relatively large domains e g tens of kilometers in each horizontal direction and over large periods of time e g flood hydrographs with a duration of months something that is not yet possible using fully 3 d models because of the high computational resources needed both in terms of physical time to obtain the solutions and in terms of data storage and data postprocessing a way to overcome the limitations of 2 d models to accurately predict flood wave propagation over natural terrain containing large scale man made structures complex domains that introduce strong non hydrostatic effects is the use of fully 3 d non hydrostatic models with free surface tracking capabilities ideally large eddy simulation les techniques should be used for such simulations rodi et al 2013 khosronejad et al 2016 but this approach will remain computationally too expensive for applications involving flood wave propagation over naturally deformed terrain for at least 1 2 decades however for steady flow conditions state of the art 3 d non hydrostatic rans models can predict mean flow hydrodynamics in channels with natural bathymetry with an accuracy that is comparable to that of les zeng et al 2008a 2010 keylock et al 2012 and 3 d unsteady rans is feasible for applications involving flood wave propagation at least for relatively short flood events the flow field increases its level of three dimensionality e g stronger vertical accelerations changes in the dominant flow orientation with the distance from the bed flow separation in vertical planes secondary cross flow motions during unsteady events such as floods this is why careful validation is needed before applying such 3 d models to highly unsteady problems over complex topography the availability of the 3 d flow fields allows a better understanding of the flow physics during the flood wave propagation and in particular how secondary flow develops in time how the flows over the floodplain and the deeper parts of the main channel interact how the streamwise momentum is redistributed and how the potential for sediment erosion changes during the flood event finally there is an important class on engineering applications in which the flow regime can change locally from open channel flow to pressurized flow example of such applications are flood wave propagation in domains containing culverts and bridges where accurate estimation of the interaction of the flow with the hydraulic structure prediction of bed shear stresses and pressure scour effects cannot be obtained even with state of the art 2 d models frank et al 2001 for such applications the use of 3 d non hydrostatic models is basically the only option to obtain accurate solutions though the use of 3 d non hydrostatic rans models with advanced turbulence models e g k ε k ω sst in hydraulics and river engineering has become very popular rodi 1984 olsen and stokseth 2010 their application to simulate flooding problems has been very scarce and mainly focused on dam break problems biscarini et al 2010 2016 yang et al 2010 for example biscarini et al 2010 found that predictions obtained using a 3 d model developed in openfoam were overall more accurate than those obtained using a state of the art 2 d model cche 2d for several dam break test cases for which validation data were available form laboratory experiments soares frazao 2002 soares frazao and zech 2002 the development of such 3 d models requires careful validation this is especially important for the deformable free surface module which is essential to any simulations involving the propagation of a flood wave though different methods can be used to track the free surface all methods are subject to errors and their performance for flooding problems is not clear another big challenge is to determine the minimum level of grid refinement needed to obtain accurate predictions of flood evolution in time the required level of mesh refinement is different in different parts of the domains using very fine meshes over the whole computational domain is not an option given the huge computational costs required to simulate flood propagation in 3 d even for relatively small regions the present paper describes the main features of a fully 3 d non hydrostatic rans model to predict flood propagation in natural domains the model uses the volume of fluid vof method to account for free surface deformations following validation for relevant simpler cases the capabilities of the model to predict flood wave propagation over natural bathymetry containing various types of large scale structures are illustrated for several important types of applications including for a case when the flow becomes pressurized over a limited region during high flow conditions 2 numerical model the engine of the present 3 d model to simulate flood wave propagation in complex domains is the pressure poisson solver in star ccm the governing equations solved in the rans approach are the continuity and momentum equations 1 u i x i 0 2 u i t u i u k x k 1 ρ x k μ μ t u i x i u k x i g δ i 3 where ui is the velocity component along the i direction ρ is the density of the fluid μ is the molecular dynamic viscosity μt is the eddy viscosity predicted by the rans model p is the pressure g is the gravity and i 3 corresponds to the vertical direction the realizable k ε turbulence model using the two layer formulation is used to calculate μt the transport equations for the turbulent kinetic energy k and the turbulent dissipation rate ε are 3 k t k u j x j 1 ρ x j μ μ t σ k k x j f c g k ρ ɛ 4 ɛ t ɛ u j x j 1 ρ x j μ μ t σ ɛ ɛ x j f c c ɛ 1 s ɛ ρ ɛ k μ ɛ ρ c ɛ 2 ɛ the eddy viscosity is then calculated as 5 μ t ρ c μ k 2 ɛ where fc is a curvature correction factor gk is the production of turbulent kinetic energy due to velocity gradients and cμ rather than being a constant as is the case in the standard k ε model is a function of the mean rate of strain tensor magnitude mean rate of rotation tensor magnitude k and ε the exact expression of these terms along with the values of the other model constants in eqs 3 4 and 5 can be found in wilcox 1998 the two layer approach allows the standard realizable k ε turbulence model to be applied inside the viscous sublayer if the mesh is fine enough to resolve this layer by dividing the computational domain into two regions one close to the wall and one away from it in the layer close to the wall ε and μt are defined as functions of the wall distance the values of ε obtained in the near wall layer are then blended smoothly with the values obtained in the outer region where eq 4 is solved the transport equation for k is solved everywhere in the domain details on the two layer k ε model can also be found in wilcox 1998 this version of the k ε model was shown to perform well compared to other state of the art rans models for complex turbulent flows constantinescu and patel 2000 kashyap et al 2012 the volume of fluid vof method is used to track the location of the deformable free surface a layer of air is present over the parts of the domain that contain or can contain water during the simulation the vof method is based on the advection of the volume fraction of water α for which a standard advection equation α t u j α x j 0 is solved in cells fully occupied by water α 1 while in cells containing only air α 0 the finite volume navier stokes code solves eqs 1 and 2 integrated over elementary control volumes the adjective terms are discretized using a second order accurate upwind scheme while the discretization of the transient unsteady term is second order accurate in time based on an implicit representation the diffusive and pressure gradient terms are discretized using the second order central differences scheme the simple algorithm is used for solving the discretized navier stokes equations in the simple algorithm an intermediate velocity is obtained by solving the momentum equations without the pressure gradient term the intermediate velocity field does not satisfy the continuity a pressure correction algorithm is employed to modify the pressure field and in turn modify the mass fluxes and velocity fields such that the corrected velocity field satisfies continuity eqs 3 and 4 are integrated in a similar way to the momentum equations but the first order upwind scheme is used to discretize the convective terms the temporal discretization is second order accurate in time the navier stokes solver was already successfully used to predict steady flow in complex domains basnet et al 2015 cheng et al 2018 the advection term in the vof equation is discretized using the second order upwind scheme the temporal discretization is second order accurate though the vof module of the code was validated for many applications predicting flood events requires additional validation given that the flow is very shallow over large parts of the domain and rapid changes in the free surface can occur in regions where hydraulic structures are present the viscous solver in starccm is parallelized using mpi and has shown good scalability on pc clusters up to 1000 processors mesh generation is a critical step in being able to perform accurate simulations of flood events in complex and large domains in a reasonable amount of time star ccm contains a very powerful meshing capability in which an initial surface geometry e g topography of the terrain can be imported then smoothed in such a way to improve computational efficiency use of relatively large time steps without any significant loss of resolution of the main terrain features for applications in natural environments containing river reaches the level of refinement decreases as one goes from regions situated close to hydraulic structures to the river channel and then to the floodplains and outer regions e g regions containing air away from the water air interface this is an important step since a surface mesh of the boundaries is needed before creating a volume mesh once the geometry has been processed a volume mesh is created the goal is to obtain a high quality mesh with a sufficient level of grid refinement in critical regions of the flow mesh topologies include tetrahedral hexahedral and polyhedral models with mesh refinement near the boundaries in the present simulations hexahedral meshes were generally chosen since the control over the size and number of cells becomes more intuitive and because the discretization errors are generally smaller for such meshes hexahedral meshes are created using a meshing module that generates cube like cells based on the specified cell size on the surface boundary mesh it is also possible to create cells with different edge sizes in each direction this feature makes the use of this meshing module highly suitable for domains containing river channels and their floodplains since the mesh can be refined in the vertical direction while maintaining relatively large edge sizes in the horizontal directions the anisotropic cells are created in the pre specified sub regions during the surface re meshing procedure making the surface mesh consistent with the volume mesh for applications in natural environments the horizontal mesh resolution near hydraulic structures is between one half to one fourth of the horizontal mesh resolution in the river channel while the horizontal mesh resolution over the floodplains is twice that of the river channel the vertical mesh resolution in the three previously mentioned regions is about the same the vertical mesh resolution in the regions containing air away from the water air interface is about one order of magnitude larger than the mesh size in the river channel additional mesh refinement is generally performed near solid boundaries by creating high aspect ratio highly skewed cells named prism layers parallel to the boundary s surface generally the size of the first prism layer is chosen to be close to 100 wall units in the wall normal direction unless an equivalent roughness height is specified in the latter case the desired wall spacing is equal to twice the roughness height local roughness elements larger than 3 cm are resolved by the mesh in the applications discussed in the present paper the outlet and top opened to air boundaries where specified as pressure outlets the desired pressure and volume fraction of water were directly specified on all outlet and top boundary surfaces specifying the distribution of the volume fraction of water is equivalent to imposing a free surface elevation at the outlet boundary in the case when air is present next to the outlet boundary or the top boundary the pressure outlet boundary was 0 pa and the volume fraction of water was set to α 0 the inlet was specified as a velocity inlet with a specified level of the free surface no slip zero velocity boundary conditions were specified at the walls channel surface floodplain and surfaces of hydraulic structures in some simulations of laboratory experiments the terrain boundaries were assumed to be smooth for applications in natural environments the terrain boundaries were assumed to be rough the roughness height was set to two times the median grain size in the corresponding main channel or floodplain region of the topography the 2 d simulations were performed using the srh 2d code lai 2008 2010 which solves the full st venant equations with a parabolic turbulence model roughness parameterization is accounted for by specifying different values for the manning s coefficient over the various parts of the topography all 2 d simulations in complex domains were performed with calibrated values of the manning coefficient determined for the iowa river reach 3 model validation 3 1 flow in an s shaped open channel this subsection compares the numerical solution with experimental data for steady flow in an open channel figs 1 and 2 which was investigated in the lab by yen 1967 the s shaped channel contains two identical 90 bends connected by a small straight reach fig 1 the channel has a trapezoidal cross sectional geometry with 1 1 side slopes the bottom width is bb 1 83 m the radius of curvature of each bend is 8 54 m the mean inlet velocity is u 0 692 m s and the water depth at the inlet is h 0 156 m using these variables the channel reynolds number is close to 105 and the froude number is equal to 0 6 the computational mesh contains 550 000 cells with a near wall refinement equivalent to 2 5 wall units fig 2 shows the measured and computed non dimensional streamwise velocity profiles over the depth at section s0 fig 1 results are plotted at five different locations along the transverse direction η b where η is measured from the center of the channel the largest differences between numerical predictions and the lab measured velocity profile is observed at η b 0 461 where the simulation underpredicts the measured velocity at all flow depths at the other locations the simulation results show good agreement with the experimental data figs 3 and 4 show the transverse free surface profiles at four cross sections and the longitudinal free surface profiles along the two banks of the channel respectively the free surface corresponds to the α 0 5 isosurface the transverse free surface profiles predicted by the simulation are in good agreement with experimental data at all the four cross sections shown in fig 3 in fig 4 a positive free surface deflection is observed at the outer bank while a negative deflection is observed at the inner bank this behavior is induced by centrifugal force effects induced by channel curvature the computed longitudinal free surface profiles show the same trend as the measured data a slight over prediction of the free surface elevation is observed at the outer bank and a slight under prediction is observed at the inner bank based on the longitudinal free surface deflection the observed level of agreement between the present 3 d simulation and the experimental data is comparable to the one observed for other 3 d rans models zeng et al 2008b the good agreement observed between predictions and measurements of the velocity and free surface profiles for this test case prove that the present numerical model is capable of accurately simulating open channel flow problems where curvature effects and the associated cross stream secondary flow are controlling the free surface deformations 3 2 dam break in a straight open channel in the hypothetical abrupt failure of a dam bordering a reservoir the blocked column of still water spreads suddenly into the adjacent region downstream of the reservoir the most idealized case that mimics such an event is the one in which a rectangular column of water collapses on a flat horizontal surface martin and moyce 1952 studied this problem experimentally by collapsing a square column of water of height a 5 7 cm into an 28 5 cm long by 7 2 cm high channel of rectangular cross section the parameters tracked during the experiment were the front surge position measured from the left wall x and the remaining water column height at the left wall η the length and height of the computational domain size were 5a and 1 25a respectively consistent with the computational domain employed by kelecy and pletcher 1997 and with the experiment the left right and bottom boundaries were no slip smooth walls a pressure outlet boundary condition was specified at the top boundary fig 5 a shows the general layout of the 2 d dam break test case results are presented for a simulation performed using 800 200 mesh points in the horizontal and vertical directions respectively the solution on this mesh was checked to be grid independent and also to conserve the total volume of water with an error of less than 2 during the duration of the simulation fig 5b and c show that the simulation accurately predicts the temporal evolution of the front position and the remaining water column height as a function of the non dimensional time t t0 where the time scale is t0 a ga 1 2 and g is the gravitational acceleration this is a very relevant test case for applications in which the hydrograph describing the flooding event is characterized by large and rapid variations in the stage 4 flood wave propagation in a domain containing an 18 km long reach of the iowa river this sections tests the model capabilities to simulate steady flow and a flood wave propagating in a reach of the iowa river containing hydraulic structures fig 6 shows the location and horizontal extent of the computational domain the computational domain starts right downstream of the flood control dam section 1 1 where a river gaging station is present section 1 1 the end of the computational domain is located some distance downstream of the second river dam section 2 2 which is close to iowa city usa both river dams are in fact weir like structures the arrow points at clear creek the main tributary feeding into the iowa river near iowa city the inclusion of clear creek is of great importance due to significant backwater effects from the iowa river into clear creek during high flow conditions a second river gaging station is situated approximately 100 m downstream of the second river dam section 4 4 the bathymetry topography information is also shown in fig 6 the bathymetry was collected using single and multi beam hydrographic surveys while the topography information was obtained from 1 m resolution lidar data also included are the locations of 29 cross sections that are used to analyze the solutions both 2 d and 3 d simulations were conducted for this test case fig 7 shows the mesh generated on the bottom boundary over part of the domain containing the main stream in the 3 d mesh the horizontal resolution inside the main channel is around 1 25 m with a progressive coarsening to 20 m over the floodplain the horizontal resolution is slightly lower inside the main channel in the 2 d simulation and similar to that used in the 3 d simulation over the floodplain the higher resolution inside and around the main channel in the 3 d mesh was needed to avoid the development of spurious oscillations in the 3 d solution the 3 d mesh was additionally refined in the vertical direction to resolve the bottom boundary layer and the flow features over the large scale features of the bottom surface the refinement procedure uses a trimmer cell procedure and prisms layers as illustrated in fig 8 the extent of the computational domain in the 2 d simulation was the same as the one used in the 3 d simulation the 2 d model lai 2008 was calibrated for both low and high flow conditions in the iowa river the outlet boundary condition in the 2 d model is based on a specified rating curve at the outlet boundary based on the available rating curve at section 4 4 in fig 6 in the 3 d simulation the solution was simply extrapolated at the outlet boundary the biggest difference between the two models is the geometry near the river dams the 3 d model takes into account the exact shape of the dams based on old construction blueprints while the 2 d model accounts for the presence of the dams by including a bump in the geometry with the same crest elevation as that of the constructed river dams during the june july 2008 time frame the iowa river experienced the biggest flood in its history causing significant damage to several cities including iowa city in the days before the flood event the flow in the iowa river reach analyzed here was quasi steady low flow conditions once the flooding event started the discharge in the iowa river was characterized by large temporal variations the first three days of the flooding event will be analyzed the hydrographs of three gaging stations located near the inlet section right downstream of the 2nd river dam and in the clear creek stream are shown in fig 9 b one hydrograph corresponds to the usgs gaging station located 100 m downstream of the 2nd river dam the other two gaging stations were used to specify the inlet boundary conditions for the iowa river and clear creek a first simulation was done corresponding to steady low flow conditions time 0 in fig 9b for which the river discharge was q 245 m3 s the froude number and the reynolds number defined with the mean velocity u 0 51 m s and mean water depth at the inlet section h 5 45 m were 0 07 and 2 8 106 respectively the time step was 0 5 s the total number of grid cells was close to 12 million in the 3 d and 0 7 million in the 2 d simulations as shown in fig 9b the 3 d model accurately predicts the temporal variation of the flowrate at the location of the usgs gaging station the times to peak for the two relative maxima flowrates present in the hydrograph during the simulated time are accurately captured fig 9a shows the free surface elevation along the centerline of the channel predicted by the two models at steady low flow conditions as well as field data measurements between the inlet boundary and the 1st river dam the 2 d model underestimates the free surface elevation with respect to field data whereas the 3 d model follows very closely the field data especially in regions close to the inlet around halfway in between the inlet boundary and the 1st river dam the 3 d model starts to underestimate the elevation of the free surface in between the 1st and the 2nd river dam it is unclear which model represents the best the position of the free surface finally downstream of the 2nd river dam the 3 d model predictions are more accurate the 2 d model consistently underestimates the free surface elevation in the same region in particular the 3 d model successfully captures the changes in the free surface elevation around the two dams where the flow regime changes from subcritical to supercritical and then back to subcritical no free surface measurements along the river reach were available once the flood event started as the unsteady wave passes through the domain and the flowrates increase the flow depths predicted by the 2 d model become eventually larger than the ones predicted by the 3 d model at the end of the simulation time time 11 in fig 9b the 2 d model is consistently overestimating the flow depths with respect to the 3 d model by 2 3 while the differences between the flow depth predictions of two models at the latest time are relative low the overall percentage change from time 0 to time 11 is relatively large being as high as 10 while accurately predicting the location of the free surface is of most importance for flood modeling an analysis of the velocity and unit discharge distributions is also relevant it was found that 22 out of the 29 cross sections showed very good agreement between the 3 d model and 2 d model unit discharge profiles cross sections 2 8 9 11 12 13 and 14 showed relatively large differences for example fig 10 a and b compare the unit discharge distributions at cross sections 11 and 12 situated toward the exit from the high curvature region see fig 10c where cross stream secondary flow effects are expected to be significant at both cross sections the 2 d model predictions for low flow conditions underestimate the redistribution of the streamwise momentum toward the outer bank this is not surprising because this redistribution is driven by the formation of the cross stream cells of secondary flow that cannot be captured by 2 d models the differences between the low flow unit discharge predictions at section 12 are even larger than those observed at section 11 this is in part because two relatively deep scour holes are present in the channel between sections 11 and 12 fig 10c when comparing the unit discharge profiles predicted by the two models during the flooding event it was found that cross sections that showed good agreement at low flow conditions also showed relatively good agreement throughout the duration of the simulation however at sections where the solutions showed significant differences at low flow conditions time 0 the agreement worsened as the flood wave started propagating through the domain this can be clearly shown in fig 10a and b that compare the unit discharge profiles at time 0 and time 8 for the 2 d and 3 d simulations at all times the 2 d model predicts a much more symmetric distribution of the unit discharge with respect to the centerline of the main channel compared to the 3 d model results moreover at these sections the 3 d model predicts that the region of high streamwise velocity moves toward the outer bank with increasing total discharge an effect that the 2 d model cannot capture 5 flood wave propagation in a domain containing a 7 km long reach of the iowa river to investigate the efficiency of flood protection measures a 7 km long iowa river sub reach of the 18 km long reach considered in the previous section was chosen to conduct a series of simulations the 7 km long reach starts upstream of the 1st river dam and extends some distance downstream of the 2nd river dam fig 11 as already mentioned the dams are in fact weir structures fig 12 shows the bathymetry topography inside the computational domain together with the location of the cross sections that will be used for a more detailed analysis of the solution as well as the hydrograph that was specified at the inlet of the domain the peak discharge was about 30 larger than the peak discharge during the 2008 flood such that the efficiency of flood protection measures can be fully tested in the 3 d simulations the average grid resolution in the horizontal directions was 5 m in the main channel and 20 m over the floodplain the 3 d mesh contained close to 10 million cells and the time step was 0 1 s the 2 d model used a mesh with similar level of grid resolution in the horizontal directions steady state conditions were simulated for a flowrate of approximately 1150 m3 s which corresponds to flow conditions close to the peak flowrate experienced during the flood of 2008 then a sinusoidal unsteady wave with a flowrate amplitude of 600 m3 s propagated into the domain the 3 d model is also used to assess the effectiveness of deployment of temporary floodwalls in regions that are important to be protected against flooding most of the 3 d simulations were run on 64 processors 16 cores of 2 6 ghz with 4 gb ram processor of a pc cluster with myrinet inter connection the 3 d simulations took about 150 h to complete by comparison the calibrated 2 d model simulation was run on a single processor and took 16 h to complete 5 1 comparison between the 3 d and 2 d model predictions for the base case fig 13 b and c compare the flooding extent predicted by the 3 d and 2 d simulations at the initial steady state time 0 also shown in fig 13a is an aerial photograph taken after the peak of the flood of 2008 at approximately the same discharge q 1150 m3 s corresponding to the initial steady state in fig 13b and c the solid black line denoting the extent of the flooded region in the field was superimposed on the plots showing the flooded regions predicted by the 3 d and 2 d simulations respectively overall very good agreement is observed between the flooded regions predicted by the numerical simulations and those observed in the field the 2 d model inundates slightly more than the 3 d model for example this happens between section 1 and the 1st dam and between sections 2 and 3 overall the 2 d model overestimates the flood extent by approximately 7 compared to the 3 d model results at steady state both the 3 d and 2 d simulations predict a free surface elevation value at the location of the usgs gage within 0 05 m of the value obtained using the usgs rating curve the usgs gage is located downstream of the 2nd dam close to section 12 in fig 13 over the whole reach the maximum difference between the free surface elevations predicted by the 3 d and 2 d simulations at the initial steady state is close 0 3 m on average the 2 d simulation predicts a higher free surface elevation compared to the 3 d simulation at time 0 h during the propagation of the unsteady wave the differences between the free surface elevations predicted by the 3 d and 2 d simulations become larger at peak flood extent time 3 5 h the maximum difference is close to 0 7 m the 3 d simulation predicts the size of the flooded region at time 3 5 h fig 13d to be about 9 larger than the one predicted by the 2 d simulation still overall good qualitative agreement is observed between the 3 d and 2 d predictions of the flooded area at peak flood extent more insight into the differences between the two solutions can be obtained by comparing the unit discharge distributions at selected cross sections fig 14 out of the 12 cross sections where the two solutions were compared only 3 cross sections showed significant differences between the unit discharge distributions at the initial state and at peak flood extent the first one is section 1 which is situated in a region of high channel curvature right before the 1st dam the second one is section 11 which is located in a straight reach upstream of the 2nd river dam where in principle one should not expect large differences between the two solutions a very shallow region is present on the east side of the cross section the 3 d model predicts a unit discharge distribution skewed towards the west side of the channel by contrast the 2 d model predicts a fairly symmetric and close to uniform unit discharge distribution away from the two banks these differences are observed at both the initial state and at peak flood extent section 12 is located downstream of the 2nd river dam where the flow is influenced by the hydraulic jump caused by the presence of the dam given that the flow is highly three dimensional around the hydraulic jump the 3 d and 2 d solutions are very different from each other in this region the 3 d model predicts a two peak distribution of the unit discharge at section 12 due to the way the plunging core of high velocities interacts with the bathymetry downstream of the dam whereas the 2 d model predicts a fairly uniform unit discharge distribution overall the differences between the distributions of the unit discharge in the selected cross sections at the initial steady state and those after the flooding wave enters the domain are comparable most of these differences occur in regions where 3 d effects are generated by large scale bathymetry features the presence of hydraulic structures or of high curvature regions see also horna munoz and constantinescu 2016 5 2 use of floodwalls as a flood protection measure common flood protection strategies for regions surrounding a river include building levees temporary flood protection walls flood prevention dams and construction of ponds in the case of the iowa river near iowa city the favored approach of reducing the effect of floods is the deployment of temporary floodwalls such floodwalls do not allow water to flow into certain areas but may severely constrict the available area for flow passage the 3 d model is used to assess the effectiveness of installing floodwalls as a flood protection strategy as summarized in table 1 several regions where floodwalls may be installed scenario 1 to scenario 4 are considered currently iowa city is ready to install temporary floodwalls that extend from halfway between sections 8 and 9 until section 12 once a large flood is forecast these floodwalls are called fw3 additional floodwalls are proposed to be installed to protect regions situated near section 1 and the 1st dam fw 1 and between section 3 and halfway between sections 5 and 6 fw 2 steady state and unsteady solutions were obtained for the same flow conditions considered for the base case no floodwalls in section 5 1 fig 15 shows the flooded region at peak flood extent for the cases where floodwalls were installed in the computational domain case scenario 1 4 and for the base case floodwalls fw 3 are shown in red whereas fw 1 and fw 2 are shown in blue comparison of fig 15a and b shows that floodwalls fw 3 can protect areas in their close vicinity from flooding at peak flood extent without increasing in a significant way the flooding area upstream of their location a slight increase of the flood extent is observed between section 1 and the 1st dam as well as between sections 2 and 3 for case scenario 1 compared to the base case the slight increase of the flood extent in the aforementioned regions is overshadowed by the large reduction of the flood extent in the vicinity of fw 3 the net flood extent reduction is approximately 8 at the initial steady state and at peak flood extent for case scenario 1 compared to the base case case scenario 2 can efficiently protect against flooding regions situated in between sections 1 and 2 at peak flood extent fig 15c these areas are flooded in the base case and in case scenario 1 protecting this region is important as several hospitals are located there at all times during the propagation of the flood wave the flood extent reduction is 18 19 in case scenario 2 compared to the base case case scenario 3 fig 15d significantly reduces flooding between sections 3 and 6 at both the initial steady state and at peak flood extent a major residential area is located in the neighborhood of sections 3and 6 the flood extent reduction for case scenario 3 is approximately 15 at the initial steady state and 14 at peak flood extent compared to the base case case scenario 4 includes all floodwalls deployed in the previous cases fig 15d as expected the regions situated in the neighborhoods of sections 1 and 2 and of sections 3 and 6 are well protected at peak flood conditions the predicted reduction of the flooded area is 25 at the initial steady state and 26 at peak flood extent compared to the base case thus for case scenarios 1 4 the reduction of the flood extent is about the same for both the initial steady state and at peak flood extent conditions moreover even for case scenario 4 that contains the largest number of floodwalls no significant flooding is predicted in regions situated away from the floodwalls compared to the base case the presence of the floodwalls modifies the unit discharge distribution in their vicinity with respect to the base case this is always the case in cross sections cutting through the floodwalls the overall effect is an increase of the mean velocity in the cross section with respect to the base case this is illustrated in fig 16 which compares the unit discharge distributions at section 5 the largest differences are observed for case scenarios 3 and 4 that contain the fw2 floodwall at the left bank fig 16b and c show how the streamwise velocity distribution change in the cross section as a result of the presence of the fw2 floodwall in case scenario 4 compared to the base case in particular the core of large streamwise velocities is pushed toward the right bank as the total cross sectional discharge is not very different in the five cases analyzed here the unit discharge values at a given time should be larger in between the extremity of the floodwall and the right bank for case scenarios 3 and 4 compared to the other cases this is confirmed by the unit discharge distributions in fig 16a that show that the peak unit discharge is about 10 15 larger in case scenarios 3 and 4 compared to the base case fig 17 shows the free surface elevation profile along the centerline for the five cases no significant differences are observed at both the initial steady state and at peak flood extent among the different simulations compared to the base case the maximum increase of the free surface elevation for the cases with floodwalls is about 0 3 m and occurs at peak flow conditions when lots of the floodplain is inundated and thus a large increase in the flow discharge results in a relatively small increase in the free surface elevation overall comparison of the simulations results in figs 15 and 17 shows that the proposed floodwall designs can effectively protect the critical regions situated in the vicinity of the iowa river while not increasing significantly flooding away from these regions with case scenario 4 offering a comprehensive protection of the critical regions situated in the vicinity of the river reach 6 flood wave propagation in a domain containing a 2 km long reach of the iowa river and a bridge deck that can become submerged at high flows this section focuses on the simulation of a flood wave advancing in a 2 km long reach of the iowa river near iowa city the computational domain and the bathymetry are visualized in fig 18 a the reach contains a river dam same as 2nd river dam in fig 12a and a bridge deck corresponding to a bridge situated in the immediate vicinity of the dam fig 18b the length width and thickness of the bridge deck were 60 m 20 m and 0 2 m respectively the bridge deck was situated at about 4 m above the bottom of the main river channel at that location the mesh was refined around the bridge deck and around the crest of the weir corresponding to the river dam fig 18c to resolve the flow structures generated by the interaction of the flow with the bridge deck and the river dam the mesh resolution was consistent with the one of the test cases discussed in the previous two sections the 3 d mesh contained close to 3 million cells the time step was 0 1 s a full unsteady solution took 70 h to complete when run on 64 processors of the same pc cluster used to perform the other simulations in complex domains the inflow hydrograph fig 18d was chosen such that the bridge deck becomes submerged when the flood wave reaches the bridge and will remain so for several hours as this happens the flow regime changes from open channel flow to pressurized flow before changing back to open channel flow after the flood starts receding occurrence of pressurized flow over an erodible bed is known to generate larger bed shear stresses and thus severe scour these effects are referred to as pressure scour effects while all previous test cases can also be calculated using 2 d models this is not the case for applications when the flow becomes pressurized around a hydraulic structure or a flow obstruction even non hydrostatic 2 d models cannot be applied for such cases as the main modeling assumptions are violated the same is true for hydrostatic 3 d models the only way to obtain meaningful information on flow hydrodynamics and the capacity of the flow to entrain sediment is via a fully 3 d non hydrostatic model simulation to better understand the flow modifications induced by the bridge deck once it becomes submerged an additional simulation in which the bridge deck was not present was performed with identical boundary conditions and inflow hydrograph at times when the bridge deck is not submerged e g before the flood wave arrives in the region where the bridge is situated the streamwise velocity distribution in spanwise cross sections cutting through the bridge deck e g at section 1 in fig 18a is qualitatively similar to that observed at cross sections situated upstream of the bridge deck e g at section 2 in fig 18a the core of high streamwise velocities penetrates more on the deeper half of the main channel but does not move far away the center of the two cross sections see fig 19 a and c at time 0 3 h as the region around the bridge starts being flooded and the bridge deck becomes submerged the free surface elevation increases and the core of high streamwise velocities moves even more toward the deepest part of section 2 see fig 19b at time 2 0 h the same is true for the region situated beneath the bridge deck where the flow becomes pressurized fig 19d at time 2 0 h though the discharge in section 1 in the pressurized flow region 1350 m3 s is less than the one at section 2 at the same time instant 1640 m3 s the bed shear stresses are considerably larger in section 1 this is because the core of high streamwise velocities moves closer to the bed at the cross sections where the flow is pressurized and also extends laterally significantly more toward the shallower side of the cross section see fig 19b and d one should also mention that the occurrence of pressurized flow can also act toward decreasing the bed shear stress in regions situated upstream e g due to backwater flow effects induced by the bridge deck obstruction or downstream of it this is mostly because once the flow becomes pressurized the submerged bridge deck changes the direction of the flow approaching the crest of the weir fig 20 offers more quantitative evidence of the effects the change in the flow regime has on the bed shear stresses and consequently on the sediment entrainment capability of the flow beneath the bridge deck to isolate pressurized flow effects the temporal variation of the width averaged bed shear stress in section 1 fig 18a in the simulation containing the bridge deck is compared with results from a simulation containing no bridge deck where the flow regime remains the same open channel flow during the propagation of the hydrograph as expected the bed shear stresses are basically identical until the time when the flow becomes pressurized in the simulation containing the bridge deck interestingly there are very little time history effects such that once the free surface elevation decreases below that of the bridge deck the bed shear stresses predicted in the two simulations are again close to identical during the time the flow is pressurized the increase in the bed shear stress is very significant up to 50 in section 1 the predicted spatio temporal distributions of the bed shear stress in the two simulations can be used to estimate sediment entrainment during the flood event in the region situated directly beneath the bridge deck e g using van rijn formula van rijn 1984 for the mean sediment size present in the main channel d50 1 mm the erosive capacity of the flow during the time interval when the flow is pressurized in the simulation with the bridge deck is close to two times larger than during the same time interval in the simulation without the bridge deck as most of the sediment entrainment at bridge sites occurs at high flow conditions being able to estimate the maximum sediment entrainment capacity of the flow during a flooding event is of great importance for cases when the flow changes regime locally such estimations can only be obtained using the type of numerical models used in this study 7 final discussion and conclusions a 3 d non hydrostatic rans model with deformable free surface capabilities was developed within an existing cfd code to simulate flood propagation in natural river environments containing man made structures this is one of the first applications of time accurate rans for this type of problems the 3 d model was first validated for several simpler cases that tested the different features of the model and in particular its ability to capture the free surface position for steady and unsteady problems it was found that the 3 d model was able to accurately reproduce results obtained in laboratory experiments the model was then applied to calculate steady flow and flood wave propagation in domains containing a reach of the iowa river of a length of up to 18 km to better understand the performance of the 3 d model simulations were also performed using a calibrated 2 d hydrostatic depth averaged code that is routinely used to obtain flood predictions in the iowa river not surprisingly the largest differences between 3 d and 2 d model predictions for these cases were observed in regions where 3 d effects e g strong secondary cross stream currents strong vertical nonuniformity of the flow are expected to be important in the case of the 18 km long river reach test case with steady low flow conditions the 3 d model was able to predict the free surface elevation more accurately compared to the 2 d model when an unsteady hydrograph was propagated into the domain the 3 d model was able to reproduce the hydrograph recorded by a gaging station located within the domain with small differences during the simulated hydrograph the differences between the 3 d and 2 d predictions of the free surface elevation were as high as 10 for the high flow conditions present in the 7 km long river reach test case the floodplain is flooded this adds an additional challenge for numerical models as 3 d effects can be relatively important at the interface between the main channel and its floodplains at certain times during the propagation of the flood wave in terms of the surface flooded the differences between the 2 d model and the 3 d model predictions were 7 and 9 at the initial steady state and at peak flood extent respectively the validated 3 d model was then used to test the effectiveness of placing flood protection walls at different critical locations that need to be protected in the case of a flood event finally the 3 d model was used to predict interaction of a flood wave with a bridge deck that becomes submerged during the time the peak flow passes the region containing the bridge such type of applications in which the flow regime changes locally from open channel flow to pressurized flow and back to open channel flow cannot be correctly simulated even using state of the art 2 d non hydrostatic models because the main assumptions in these models are severely violated for such applications 3 d models are the only option to accurately predict the interaction of the flood wave with the hydraulic structure and its effect on flow hydrodynamics e g backwater flow effects can be induced at large distances from the location where the flow becomes pressurized bed friction velocity distributions and sediment entrainment potential though not considered in the present study coupling of such a 3 d model with a morphodynamics model will allow studying pressure scour effects the main challenge of using 3 d models for routine predictions of flood propagation in natural systems is the associated computational cost and resources required to perform the simulations not surprisingly the computational resources and physical times needed to perform the 3 d simulations reported in the present study and to generate the data bases were much larger than those required by the 2 d simulations with the rapid increase of computational power access to large scale computational resources needed to perform such 3 d simulations in a reasonable amount of time will continue to decrease fast such that such computations will start being used to study real flood scenarios in diverse environments one important point is that the present 3 d simulations in complex domains natural bathymetry containing large scale man made structures were run only on 64 processors on the type of pc clusters used to perform the simulations reported in the present study the numerical solver scales well up to about 1 000 processors so if computational resources are widely available the physical time needed to obtain a 3 d solution can be decreased by about one order on magnitude this is an important point especially for flood problems that cannot be correctly predicted using lower order models and for which 3 d non hydrostatic models are the only option to numerically investigate the effects of flood wave propagation another important observation is that 3 d models that resolve most of the relevant bathymetry features requires basically no calibration by contrast the calibration step can be quite time consuming for lower order models for example calibrating the 2 d model for the iowa river region simulated in the various test cases discussed in the present study required several weeks another main application of 3 d models of the type developed in the present study is for performing simulations of short flood events over relatively short domains containing hydraulic structures and other geometrical complexities where one suspects that the flow associated with the flood wave propagation will be subject to strong 3 d effects a major problem with current application of 1 d and 2 d models to predict floods in complex domains is that one does not have good guidelines to know the range of problems that can be accurately solved with such models and which geometrical and flow complexities result in a sudden decrease of the accuracy of their predictions as shown by the present study 3 d simulations of smaller scale flood problems though computationally expensive are feasible as such they can be used as a numerical experiment based on which the predictive capabilities of lower order e g 2 d hydrostatic 2 d non hydrostatic and 1 d models can be better assessed and ideas to improve or to better calibrate them can be tested this is important given that even laboratory experiments of flood wave propagation generally provide only a limited amount of data for validation data obtained from observations of floods occurring in real environments are even scarcer because of the hazard associated with collecting data during the floods molinari et al 2017 acknowledgments the authors would like to acknowledge the iowa flood center for supporting this study the authors would also like to acknowledge high performance computing support project dd 2015 geo117 from the oak ridge leadership computing facility olcf and in particular dr j wells from the national center for computational science at the oak ridge national laboratory as well as from the high performance computing center at the university of iowa we would like to thank prof w krajewski and prof j odgaard for many insightful comments and for their support in completing this study 
729,one important component of continental scale hydrologic modeling is quantifying the level of uncertainty in long term hydrologic simulations and providing a range of possible simulated streamflow and or runoff values for gaged and ungaged locations in this paper uncertainty was quantified for simulated streamflow and runoff generated from a monthly water balance model mwbm at 1575 streamgages and 109 951 hydrologic response units hrus which span the conterminous united states conus a stochastic approach which incorporated the properties of modeled streamflow residuals back into the simulated model output was used to create time series of upper and lower uncertainty intervals uis around the simulated monthly time series this approach was applied to an existing hydrologic regionalization implementation metrics used to evaluate the uis across the conus the coverage ratio average width index and interval skill score indicated that on average the uis were reliable skillful and sharp in being able to both contain measured streamflow observations and reduce estimates of uncertainty based on expected model predictions these uncertainty evaluation metrics can complement each other in characterizing model skill and uncertainty over large scale domains keywords monthly water balance model runoff streamflow uncertainty 1 introduction a key research direction of the u s geological survey is to assess if the conterminous united states conus has enough freshwater to meet both future human and ecological needs evenson et al 2012 this requires the application of tools and methods that address water management challenges that span regional or continental domains archfield et al 2015 one set of tools that has been used with increasing frequency to attain these estimates are deterministic physically based hydrologic models newman et al 2015 maxwell et al 2015 bock et al 2016 the desire for consistency in model application workflow and availability of information at multiple spatial and temporal scales has driven the domain of hydrologic model applications to regional and continental domain archfield et al 2015 many of these large domain applications are developed for the purposes of mitigating risk or providing improved decision support for water resources management policy sikorska et al 2015 however it has been shown that simulated time series and environmental conditions derived by physically based deterministic hydrologic models often ignore the aleatory uncertainty inherent in natural systems montanari and koutsoyiannis 2012 calibrated well fit output in the form of simulated time series derived from these models are precisely calculated and defined 100 probability and cannot reproduce the variability and distributional characteristics of the physical processes the models are being used to understand and quantify montanari and koutsoyiannis 2012 farmer and vogel 2016 this is important as the differences between the simulated and measured fluxes can be magnified in the extreme parts of the distribution which are important areas for risk mitigation and descision support systems farmer and vogel 2016 the identification and quantification of sources of residuals that contribute to uncertainty of simulated time series derived from physically based hydrologic models have been well documented zhang et al 2008 matott et al 2009 wagener and montanari 2011 farmer and vogel 2016 there have been a number of efforts to quantify the contribution of different components of the modeling workflow to uncertainty this includes model inputs and measurement error such as forcing or calibration data parameters structural errors and model outputs yadav et al 2007 vrught et al 2008 zhang et al 2008 mcmillan et al 2011 montanari and koutsoyiannis 2012 while previous efforts have defined frameworks through which uncertainty can be quantified for different components of the modeling workflow beven and binley 1992 kapangaziwiri et al 2012 smith et al 2015 many of these efforts are data intensive or application specific and only a few of them quantify uncertainty for simulations in ungaged areas yadav et al 2007 bourgin et al 2015 which is important for applications of models over regional or continental domains for physically based hydrologic models applied seamlessly and consistently across large scale domains the individual contribution to uncertainty from each of the residual components inputs parameter model structure output may vary spatially or temporally based on availabilty and quality of forcing and measurement data kiang et al 2013 henn et al 2018 the ability of models to capture dominant processes newman et al 2015 markstrom et al 2016 and the specific algorithms used to calculate model fluxes and states mccabe et al 2015 in this paper we use a stochastic post processing framework developed by bourgin et al 2015 and farmer and vogel 2016 to quantify uncertainty in simulated monthly streamflow and runoff produced by a monthly water balance model mwbm mccabe and markstrom 2007 bock et al 2016 for gaged and ungaged areas across the conus bock et al 2016 the main goal is the conversion of a deterministic prediction or simulation at each monthly time step into a probabilistic one by providing uncertainty intervals ui around each simulated deterministic time step value sikorska et al 2015 as the model residuals contain traces of the measured phenomenon trying to be understood the post processing procedure incorporates information from the model residuals to build the uis from a single deterministically derived simulated time series farmer and vogel 2016 this approach previously developed at regional scales farmer and vogel 2016 farmer and levin 2017 was applied across the conus where there is large spatial variability in both hydroclimatic characteristics and the amount of measured information available to quantify uncertainty in model simulations kiang et al 2013 2 methods 2 1 the monthly water balance model the mwbm fig 1 is a modular accounting system that provides monthly estimates of components of the hydrologic cycle using concepts of water supply and demand mccabe and markstrom 2007 mccabe and wolock 2011 bock et al 2016 monthly mean temperature tave is used to compute potential evapotranspiration pet and to partition total monthly precipitation ppt into rain and snow fig 1 ppt that occurs as snow is accumulated in snow storage i e snowpack rainfall is used to compute direct runoff actual evapotranspiration aet soil moisture storage and surplus water which eventually becomes runoff fig 1 when rainfall for a month is less than pet aet is equal to the sum of rainfall snowmelt and the amount of moisture that can be removed from the soil the fraction of soil moisture storage that can be removed as aet decreases linearly with decreasing soil moisture storage that is water becomes more difficult to remove from the soil as the soil becomes drier and less moisture is available for aet in a given month if rainfall and snowmelt exceeds pet aet is equal to pet and water in excess of pet replenishes soil moisture storage when soil moisture storage reaches capacity during a given month the excess water becomes surplus and a fraction of the surplus becomes runoff while the remainder of the surplus is temporarily held in storage the mwbm was previously implemented across the conus using the methods described in bock et al 2016 the mwbm was configured for the conus for 109 951 hydrologic response units hrus from the geospatial fabric for national hydrologic modeling viger and bock 2014 a national database of hydrologic features for national hydrologic modeling applications the geospatial fabric discretization consists of hrus stream segments and points of interest along the stream network all of which were derived based on an aggregation of the national hydrography dataset plus dataset u s environmental protection agency and u s geological survey 2010 the sizes of the hrus range from less than 1 km2 up to 67 991 km2 with a median size of 33 km2 inputs to the mwbm are monthly ppt millimeters and monthly mean tave c latitude of the site decimal degrees soil moisture storage capacity millimeters and a monthly varying coefficient dimensionless for the computation of pet maurer et al 2002 wolock 1997 mccabe et al 2015 latitude for each hru was computed as the centroid of each hru soil moisture storage capacity was calculated for each hru using state soil geographic database data on a 1 km2 grid resolution wolock 1997 the mwbm was calibrated and regionalized across the conus by organizing hrus into 110 distinct regions across the conus based on similar parameter sensitivities fig 2 bock et al 2016 within each region the mwbm was calibrated in a group wise fashion using streamgages identified which fit a set of criteria and information for model calibration is shared between streamgages in the region this resulted in a single optimized deterministically derived set of mwbm parameters applied to all hrus gaged and ungaged within each region a single mwbm parameter set fig 1 table 1 bock et al 2016 was calibrated and applied to all hrus within each calibration region using the shuffled complex evolution global search optimization algorithm duan et al 1993 the multi term objective function used for calibration minimized the difference between measured and simulated streamflow at multiple time summaries and mwbm derived and modeled snow water equivalent national operational hydrologic remote sensing center 2004 there are some hydrological processes whose representations are limited by the mwbm due to monthly time steps and or the regionalization technique applied in bock et al 2016 for more information on these limitations and the geographic areas affected see the discussion in section 5 in bock et al 2016 and section 4 of bock et al 2018a 2 2 derivation of uncertainty intervals at streamgages the approach to deriving uis for simulated hydrologic model output has been laid out in several recent studies bourgin et al 2015 sikorska et al 2015 farmer and vogel 2016 of these bourgin et al 2015 presented a methodology that derived uis to be applied towards ungaged catchments this methodology is adopted and applied towards the mwbm across the conus using the same framework used for the mwbm calibration and regionalization bock et al 2016 within each of the 110 calibration regions the uncertainty intervals are first derived and validated at gaged catchments used for regionalized mwbm calibration within the calibration region section 2 3 before being applied to the ungaged hrus within each region section 2 4 this approach derives uis for gaged and ungaged catchments within each calibration region bock et al 2016 and differs from a nearest neigbor or donor basin approach used in previous ui applications bourgin et al 2015 farmer and levin 2017 to validate the ui approach that will eventually be applied towards ungaged hrus uis for simulated streamflow from the mwbm were first derived and validated for gaged catchments within each calibration region this approach uses a leave one out loo strategy to validate results at gaged catchments and includes information from all streamgages used for model calibration within each calibration region to derive the uis this approach utilized 1575 streamgages across the 110 calibration regions the number of streamgages and area of each calibration region varied across the conus figs 6 and 7 in bock et al 2016 within each calibration region relative streamflow residuals q were first calculated and pooled for all streamgages used for model calibration eq 1 1 q 1 t i 1 t q o t q s t where q is the relative residual for streamflow qo t is the measured streamflow and qs t is the simulated streamflow at each monthly time step for all months t in the period record for each streamgage g a subset of the pooled residuals was created by excluding residuals associated with the streamgage for which the uis are being derived the loo approach this approach results in a subset of q g with the brackets noting the exclusion of each streamgage s residuals within its own pool as in bourgin et al 2015 the resulting q g were organized into ten flow deciles of q i g with i ranging from 1 10 based on the ranks of the corresponding qs with q 1 g containing residuals derived from the lowest simulated flows and q 10 g containing residuals derived from the highest simulated flows other methods of binning the residuals such as organizing by month were investigated but considered inferior to the original decile organization the residuals ranked by the magnitude of qs t minimized the within group variability of qs t and prevented information from streamgages with large drainage areas high qs t from overwhelming information from streamgages with small drainage areas low qs t when deriving uis for a single calibration region next the 0 025 and 0 975 quantiles thereby reproducing a 95 interval of the each q i g were determined resulting in ten pairs of multiplicative constants for upper and lower bounds of the uis across the entire time series bounds for each time step were derived by calculating each qs by the upper and lower multiplicative constants of the decile group q i g that each qs is pooled with resulting in a time series of upper and lower uis for each time step qu t and ql t fig 3 a this method was then applied to the next streamgage within the calibration region until all streamgages were assessed the derived ui time series were inherited by all hrus within the catchment of each streamgage g 2 3 validation of uncertainty intervals at streamgages three previously defined metrics were used to evaluate the uis at the 1575 streamgages the coverage ratio cr average width index awi and the interval skill score iss table 1 details on the background and formulation of these metrics can be found in bourgin et al 2015 the properties of the ui and the measured and simulated time series used to calculate the three metrics are shown in fig 3b the cr quantifies the statistical reliability of the derived uis to contain the true measured streamflow value qo t eq 2 2 c 1 i f q o t q l t a n d q o t q u t 0 i f q o t q l t q o t q u t c r 1 t i 1 t c where c equals 1 at time step if the measured streamflow qo t is greater than ql t and less than qu t and 0 otherwise fig 3b the resulting series c is summed and divided by the number of time steps i e the total number of measured streamflow values to calculate the cr the cr provides a proportional measure ranging from 0 to 1 where 1 represents a perfect value uncertainty intervals contain all measured streamflow values and 0 indicates the uncertainty intervals have no reliability to contain any measured streamflow values the uis derived with the 95 quantiles of residuals which are appropriately narrow should be expected to contain 95 of the measured streamflow values cr values higher than the residual percentile range i e 95 used to derive the ui represent under confidence in the uis and intervals that are too wide and cr values that are lower than residual percentile used to derive the ui represent over confidence in ui and intervals that are too narrow the cr values greater than 0 95 can represent less reliable values for the evaluation of the uis especially if combined with low values of the other two metrics described in the following sections awi and iss for this study we define a range of acceptability for the cr to be between 0 925 and 0 975 and when possible highlight this range within the figures the awi is a measure of sharpness of the uis and quantifies the ability of the ui to capture the natural variability of the system and expected model simulations the awi is a measure of overlap between the width of the 95th percentiles of the simulated flow duration curve referred to as awclim and the average width aw of the uncertainty intervals which is calculated as the average of the absolute difference between the upper and lower uis across all time steps fig 3b this is calculated as eq 3 3 a w i 1 a w a w c l i m where aw is the average width index of the ui time series and awclim is the absolute difference width of the 0 025 and 0 975 quantiles of the simulated flow duration curve an awi value greater than 0 indicates that the derived ui reduces the uncertainty of the model output in comparison to the natural variability of the climatology represented by the 95th percentile of the simulated flow duration curve bourgin et al 2015 the third metric used to evaluate the ui is the iss gneiting and raftery 2007 which is a measure of the overall skill of the ui the iss is a composite of the previous two metrics and accounts for both the ability of the ui to capture the measured value and the width of the ui similar to aw in the calculation of the awi metric each time step is assigned an interval score s fig 3b with penalties imposed if the measured streamflow value for the time step deviates outside of the upper and lower bounds of the uis gneiting and rafferty 2007 the calculation of s for each time step is described in eq 6 of bourgin et al 2015 the iss is computed as eq 4 4 i s s 1 i s i s c l i m where is is the average value of s over the entire time series and isclim is the average value of the interval scores s calculated using the upper and lower values of the 95th percentiles of the simulated flow duration curve for each time step similar to the cr and awi high values of the iss indicate greater skill and precision of the ui in capturing measured streamflow weighted by the width of the ui wider uis should be expected to contain more measured streamflow values with positive scores indicating that the ui is more skillful than the natural variability of the flow duration curve and negative otherwise bourgin et al 2015 although each of the three metrics quantifies one aspect of the uis the values of the three metrics should be balanced against each other in aggregate farmer and levin 2017 2 4 application of the uncertainty intervals to ungaged hydrologic response units after evaluating the uis obtained by streamgages for each calibration region using the three metrics the derived uis could be applied to all ungaged areas within each calibration region this procedure is similar to that described in section 2 2 for the loo validation at individual streamgages except here the residuals from all streamgages within the calibration region were pooled to compute the deciles and uis whereas for the application to gaged catchments the loo strategy was used to validate results at individual streamgages the original uis computed for the hrus within gaged catchments were preserved because these streamgages serve as important validation and comparison points for multi model frameworks to evaluate the uis at hrus including inside and outside of gaged catchments the awi metric was calculated for all hrus across the conus both the cr and iss require measured streamflow information to compute the evaluation of the awi for ungaged areas is a measure of the precision and not the skill or accuracy of the uis in those locations false certainty may exist at locations with high awi values high precision where narrow widths contain high residual simulated estimates because the derivation and assignment of the uis used the same information and structure as the calibration and regionalization of the mwbm bock et al 2016 evaluation of the awi in ungaged areas provides a measure of consistency of the residuals across the conus 3 results 3 1 results by streamgage the spatial results by streamgage n 1575 bock et al 2018b are shown in three maps fig 4 a c and the range of values for the three metrics are shown in the boxplots in figs 5 and 6 values of the cr ranged from 0 42 to 1 0 with mean and median values of 0 93 and 0 95 respectively fig 5 on average the uis contained the expected number of measured monthly streamflow values based on the given residual percentiles 0 025 0 975 used to derive the uis the lowest values of the cr appear in regions of the country where there are both sparser networks of streamgages more complex topography and areas such as between 100 and 120 longitude fig 4a where monthly hydrologic models have low skill in replicating daily and sub daily processes that drive measured streamflow newman et al 2015 archfield et al 2015 bock et al 2016 there are five streamgages with cr values less than 0 50 black x fig 4a and 274 streamgages with cr values greater than 0 975 red dots fig 4a there were 774 streamgages with cr values between 0 925 and 0 975 values for awi range from 31 33 to 0 85 with mean and median values of 0 27 and 0 46 figs 5 and 6 awi values greater than 0 indicate the intervals reduced uncertainty as compared to the natural climatology for the residual percentiles used 0 025 0 975 fig 5 there are 149 streamgages across the conus with awi values less than 0 which are symbolized with a black x on fig 4b the awi values for approximately 97 of streamgages are contained within the interval 1 1 fig 5 the patterns and range of iss across the conus are more similar to awi than cr fig 4c and iss values ranged from 38 0 to 0 75 with mean and median values of 0 03 and 0 29 figs 5 and 6 there are 112 streamgages across the conus with iss values less than 0 as indicated by black xs fig 4c approximately 98 of streamgages occur within the interval 1 1 fig 5 with 35 streamgages having iss values less than 1 scatterplots of cr vs awi and iss are shown in fig 6 the horizontal axis ranges for fig 6a coverage ratio vs average width index with circles and 6b coverage ratio vs interval skill score with triangles match the same range used for the boxplots in fig 5 note that the vertical axis range is constrained from 0 4 to 1 based on the range of cr values 0 42 is the smallest cr value from the 1575 streamgages the smaller inset in fig 6c shows the horizontal axis with the full range of awi and iss values the area between the dashed red lines in fig 6a and b represent the range of acceptability for the cr 0 925 to 0 975 the single red line in fig 6c denotes the cr value of 0 95 as mentioned in section 2 3 validation of uncertainty intervals at streamgages the calculation of the awi metric does not include consideration of the site specific measured streamflow values in its calculation only the uncertainty intervals derived by the regionalized loo approach section 2 2 whereas the iss metric includes weighted penalties for how far measured streamflow values are outside the regionalized uis this difference in the calculations allows a streamgage to have high awi values the uis adequately describe the model and climatic uncertainty of the calibration region which contains the streamgage while also having low values cr and iss values the uis have less skill in capturing measured streamflow values at specific site than what is expected as is shown for streamgages in the lower right hand quadrants of fig 6a and b fig 7 depicts the cr of each of the streamgages for each of the flow deciles with a few exceptions the range of the cr among the streamgages decreases with increasing magnitude of streamflow flow deciles 1 to 10 the median cr among the streamgages also decreases with an increase in the magnitude of flow this is illustrated by the decrease in value of the median for each flow quantile relative to the location of the 0 95 cr red line behind boxes on the plot 3 2 results by calibration region the patterns between the three metrics cr awi and iss are examined for four different calibration regions across the conus fig 2 named for the discussion of the results as new england red the tennessee river orange platte river headwaters blue and the pacific coastal range green fig 8 is a replication of fig 6 with streamgages symbolized by color based on which calibration region they lie within in fig 2 for streamgages in the new england region red number of streamgages n 67 most of the streamgages cluster in the upper right hand quadrant of the fig 8a median cr awi iss 0 96 0 57 0 44 this pattern is similar for both tennessee river orange n 21 median cr awi iss 0 96 0 60 0 50 and pacific coastal range green n 33 median cr awi iss 0 96 0 66 0 60 regions however the platte headwaters region blue n 15 shows much different results for the ui application several streamgages register lower awi and iss values than the other three regions blue streamgages in fig 8b beyond the 1 1 x axis range shown in fig 8a note that for streamgages in the platte there are several streamgages with high but less acceptable cr values cr 0 975 and low awi iss values awi iss 0 in the upper left hand quadrant of fig 8a and the two streamgages in the region with highest awi in the platte region two streamgages in the lower right hand quadrant awi 0 6 also have the lowest cr 0 6 values within the region 3 3 average width index by hydrologic response unit the calculation of cr and iss both incorporate measured streamflow values and thus only the awi can be used to evaluate the uis in hrus that are located outside of gaged catchments the awi measures the ability of the uis to capture the variability of the system and the expected model simulations and is calculated based on the width of the interval of each time step as compared against the 95th percentile of the simulated flow duration curve using the framework suggested for applying the uis to ungaged areas section 2 4 the awi was calculated for all 109951 hrus across the conus fig 9 the results shown in fig 9 are similar to the spatial patterns of the awi results shown by streamgage in fig 4b the hrus in calibration regions with corresponding or nearby streamgages registered low awi values awi 0 and also have low awi values with a few exceptions these same calibration regions showed low model correspondence for measured streamflow in previous continental scale studies cited earlier newman et al 2015 bock et al 2016 in calibration regions of high density of streamgages west of 120 and east of 95 longitude south of 45 latitude in figs 4 and 9 the awi results are more seamless and spatially continuous in areas of sparser streamgage and drainage density between 120 and 105 longitude in figs 4 and 9 the awi results are more discrete and in some instances delineate the individual calibration region boundaries fig 2 3 4 performance of the uncertainty intervals the derived uis quantify the uncertainty of simulated streamflow at individual streamgages across the conus fig 4 section 3 1 however the application of uis at gaged and ungaged locations over large spatial domains can quantify uncertainty of the deterministic hydrologic model simulations and provide a more thorough evaluation of the hydrologic regionalization procedure that complements traditional goodness of fit measures of model performance used to initially evaluate the regionalized parameters sections 3 2 and 3 3 this is particularly useful in helping to identify the dominant individual contributors to uncertainty over continental scale domains that were addressed in the section 1 such as data scarcity model input errors and process representation within models the scatterplots in fig 10 show the log of the total area km2 of each calibration region fig 2 note that this is different from drainage area compared against the log of the number of streamgages within each calibration region the points representing each calibration region in the three plots are colored as in fig 4 based on the median cr fig 10a awi fig 10b and iss fig 10c calculated from streamgages used to calibrate the mwbm and derive the uis within each calibration region red triangles represent calibration regions with median cr values greater than 0 95 and awi and iss values less than zero no single region has a median cr value greater than 0 975 but 32 regions had median awi values greater than 0 95 while no obvious pattern exists for cr and total area or number of streamgages across the 110 calibration regions the majority of the calibration regions with negative median awi and iss values occur in the upper left hand quadrant of the scatterplots these low metric values occur in regions with a combination of low numbers of streamgages used to regionalize the mwbm parameters over larger areas some of the calibration regions with negative median awi and iss values black xs located between 120 and 100 longitude in fig 4b and c and red polygons at the same longitude range in fig 9 coincide with hydrologic regions two digit hydrologic unit code identified in kiang et al 2013 as lacking streamgage coverage for smaller to mid sized drainage basins table 1 fig 4 in kiang et al 2013 and include arid and semi arid areas where runoff processes and spatiotemporal variability in precipitation cannot be adequately represented by a monthly model wheater et al 2008 this limitation of the uis in these regions can be traced to several factors the uis are constructed using pooled residuals from the streamgages in each calibration region that were used to calibrate the mwbm section 2 2 a smaller number of streamgages results in a smaller set of residuals from which to construct the uis in calibration regions with smaller areas and more homogeneous climate and topography east of 90 longitude in fig 2 including new england red and tennessee river orange this may not affect the sharpness and skill of the uis as described by the awi and iss however despite the reliability of the uis in some of the larger calibration regions to capture the measured streamflow as described by the cr the size of the calibration regions and in some regions the complexity of terrain and climate limit the uis derived from the methodology presented here to adequately capture the climatic variability of the entire region with a smaller sample size of residuals fig 10 derived from sites situated over farther geographic distances two other limiting factors are the uncertainty of model forcing data such as grid based precipitation and the skill of the mwbm to replicate hydroclimatic processes in areas of conus these issues have been addressed in several sources newman et al 2015 bock et al 2016 markstrom et al 2016 considered together these factors indicate that in calibration regions with high cr values and low awi and iss values the model regionalization may adequately capture the central tendency mean and median of the regional streamflow behavior based on the cr but the uis derived for the calibration region fail to reduce the uncertainty associated with the simulated streamflow estimates in these areas based on the awi and iss 3 5 patterns of uncertainty interval performance by streamgage based on the information available for both streamgages figs 4 6 and calibration regions hrus figs 8 10 it is apparent that the performance of uis varies across the conus and that the performance of uis is likely related to the three factors discussed in the previous section data scarcity physical process representation and model regionalization structure to help identify spatial patterns in different performance thresholds among the 1575 streamgages 7 different categories were created to bin the streamgages that are defined by the three ui evaluation metrics from here on referred to as groups 1 through 7 table 2 fig 11 the first two columns of table 2 list the conditions for categorizing the streamgages based on the values of the three metrics the third column n lists the number of streamgages assigned to each group the fourth column interpretation of uis provides a brief interpretation of each group each streamgage is assigned to a group based on the value of the three ui evaluation metrics cr values that fall between 0 925 0 975 are considered reliable within the range of acceptability defined in section 2 2 in that the uis contain close to 95 of the measured streamflow values the quantiles of the residuals used to derive the uis for the purposes of the classification presented here streamgages with cr values higher lower than 0 975 0 925 are considered too wide narrow to be considered reliable awi and iss values greater than zero are considered to have reduced uncertainty awi or improved the skill iss of the uis as compared to the 95th percentile of simulated flow duration curve section 2 3 for the purposes of grouping described above the cr ui reliability is considered more important than either awi or iss which are equally weighted when considering the groupings of these seven groups group 1 n 713 is considered as the best performing group and group 6 n 39 is considered as the worst performing whereas groups 2 n 29 and 4 n 457 are considered adequate streamgages that are binned with group 1 and 4 coincide with areas where the mwbm performed well in previous conus wide applications fig 6 in hay and mccabe 2002 fig 9 in bock et al 2016 and capture the majority of the streamgages in the eastern part of the conus and the main belts of mountainous areas in the western conus group 3 n 32 results indicate streamgages that the cr is adequate but the uis do not improve the quantification of uncertainty outside of the information provided by the simulated flow duration curve and widely miss capturing measured monthly streamflow not accounted for within the cr the 31 streamgages in group 5 on the other hand scored adequately for only one of the three metrics streamgages in group 6 n 39 scored low for all three metrics group 7 represents a distinct group that is measured strictly by the cr 237 streamgages with awi and iss 0 and 37 with awi and iss 0 the uis for group 7 are considered too wide to effectively quantify uncertainty these results help illustrate which factors have the largest influence of ui performance in different parts of the conus in the eastern conus the streamgages from the groups with low metric values groups 2 3 and 6 cluster around the great lakes and ohio river valley area north of 40 latitude between 90 and 80 latitude in figs 4 9 and 11 which corresponds to the areas of hrus in red from fig 9 that have awi values less than 0 although the uis for streamgages in these regions fail to reduce uncertainty based on the three metrics these areas are surrounded by streamgages and hrus with high metric values fig 4 and except for the great lakes ohio river valley area identified in the previous sentence have adequate number of streamgages used in the regionalization procedure fig 4 it is hypothesized that the regionalized parameters derived in these areas do not adequately capture the variability of the regional hydrology as quantified by the uis in the western conus the spatial distribution of streamgages between these groups 2 3 and 6 are less clustered than those in the eastern conus considering the results shown in figs 4 and 11 this may indicate the three issues discussed in sections 3 3 and 3 4 larger size of the calibration regions data scarcity and poor replication of dominant hydrologic processes may limit the use of the uis in these areas 3 6 comparison with goodness of fit measures the results shown in section 3 5 bring up the question of how metrics used to describe the reliability sharpness and skill of the uis compare with traditional goodness of fit measures used for model evaluation a commonly applied goodness of fit measure is nash sutcliffe efficiency nse nash and sutcliffe 1970 do streamgages with adequate goodness of fit measures that measure model skill such as nse have uis that are reliable sharp and skillful based on the three metrics applied in this paper cr awi iss areas of the conus with streamgages that have low 0 awi and iss values black xs in fig 4b and c correspond to many of the same areas with streamgages that have low nse values in previous conus wide studies fig 4b in newman et al 2015 fig 8 in bock et al 2016 indicating low model skill using the nse as a measure may result in less sharp and skillful uis across geographic areas geographic areas that have clusters of gages with adequate cr but low awi and iss values group 3 in fig 11 may indicate that the hydrologic regionalization previously implemented in bock et al 2016 adequately replicates the measures of central tendency of streamflow and runoff in those areas as measured by the nse but cannot adequately capture the uncertainty of the streamflow and runoff in those portions of the conus based on the methodology presented here the range of nse cr awi and iss for the seven binned categories of streamgages table 2 fig 11 is shown in fig 12 the three top performing bins based on nse fig 12a are group 1 0 925 cr 0 975 awi and iss 0 group 4 cr 0 925 awi and iss 0 and group 7 cr 0 975 although direct comparison or identification of significant differences between the groups is not possible due to high variability in group sizes table 2 these results generally indicate that for many streamgages sites with high model skill based on a single goodness of fit measure such as nse generally have more reliable skillful and sharp uis when examining the values of the three ui evaluation metrics together the cr and iss metrics fig 12b and d relate the strongest to nse obviously because of their incorporation of measured streamflow information however several streamgages with low nse values nse 0 50 groups 1 4 and 5 in fig 12a have uis indicating good sharpness of the uncertainty estimates based on the awi results fig 12b this is an important consideration for application of the uis to ungaged areas as without direct measurement data to calibrate or validate against model input and parameter estimation uncertainty are the most important components of the uncertainty of simulated output in these areas although the work here used the awi to evaluate the uis in ungaged areas several other approaches are possible one complementary piece of information could be the development of a single confidence metric that describe model performance with measures of reliability sharpness and skill cr awi and iss of the uis from different sets of donor gages or catchments such as the calibration regions used in this paper 4 conclusion a stochastic approach to derive estimates of uncertainty was quantified for simulated streamflow and runoff from a monthly water balance model mwbm across the conterminous united states conus uncertainty intervals uis were derived based on model residuals that bounded simulated streamflow time series at 1575 streamgages and validated using existing metrics used in previous work that quantified the reliability coverage ratio cr sharpness average width index awi and skill interval skill score iss of the uis compared to measured and simulated data at each location the results showed that for the 1575 streamgages used in this study the uis contained the measured data the median cr was 0 95 among all 1575 streamgages and the cr calculated for all 765 814 time steps from all gages was 0 93 there are 774 of the 1575 streamgages with cr values between the range of 0 925 and 0 975 for most locations the uis were more reliable 1426 out of 1575 streamgages with awi 0 and skillful 1463 out of 1575 streamgages with iss 0 than constant uis developed using percentiles derived from the streamflow distribution awclim and isclim the evaluation of awi at ungaged areas hydrologic response units showed that for 24 of the land area of the conus approximately 19 000 hrus the uis did not reduce the uncertainty compared to using uis derived from the simulated flow duration curve awi 0 many of these areas coincided with regions where previously recognized limitations in model forcing data scarcity and quality have limited the application and utility of physically based hydrologic models the combined use of model goodness of fit measures such as the nash sutcliffe efficiency nse with the uncertainty interval evaluation metrics cr awi iss partitioned the 1575 streamgages across the conus into different groups based on differing levels of skill of the model and robustness of the uncertainty estimates operations to combine these metrics could provide quantitative measures of confidence for estimates of uncertainty in ungaged areas declaration of interests methods and data presented in this paper are from work funded by the u s geological survey usgs water availability and use science program and are part of regular duties performed acknowledgments funding and support for this work was provided by the u s geological survey water availability and use science program wausp the authors thank matt miller and two anonymous reviewers for their feedback in improving the manuscript any use of trade product or firm names is for descriptive purposes only and does not imply endorsement by the u s government supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2018 10 005 appendix supplementary materials image application 1 
729,one important component of continental scale hydrologic modeling is quantifying the level of uncertainty in long term hydrologic simulations and providing a range of possible simulated streamflow and or runoff values for gaged and ungaged locations in this paper uncertainty was quantified for simulated streamflow and runoff generated from a monthly water balance model mwbm at 1575 streamgages and 109 951 hydrologic response units hrus which span the conterminous united states conus a stochastic approach which incorporated the properties of modeled streamflow residuals back into the simulated model output was used to create time series of upper and lower uncertainty intervals uis around the simulated monthly time series this approach was applied to an existing hydrologic regionalization implementation metrics used to evaluate the uis across the conus the coverage ratio average width index and interval skill score indicated that on average the uis were reliable skillful and sharp in being able to both contain measured streamflow observations and reduce estimates of uncertainty based on expected model predictions these uncertainty evaluation metrics can complement each other in characterizing model skill and uncertainty over large scale domains keywords monthly water balance model runoff streamflow uncertainty 1 introduction a key research direction of the u s geological survey is to assess if the conterminous united states conus has enough freshwater to meet both future human and ecological needs evenson et al 2012 this requires the application of tools and methods that address water management challenges that span regional or continental domains archfield et al 2015 one set of tools that has been used with increasing frequency to attain these estimates are deterministic physically based hydrologic models newman et al 2015 maxwell et al 2015 bock et al 2016 the desire for consistency in model application workflow and availability of information at multiple spatial and temporal scales has driven the domain of hydrologic model applications to regional and continental domain archfield et al 2015 many of these large domain applications are developed for the purposes of mitigating risk or providing improved decision support for water resources management policy sikorska et al 2015 however it has been shown that simulated time series and environmental conditions derived by physically based deterministic hydrologic models often ignore the aleatory uncertainty inherent in natural systems montanari and koutsoyiannis 2012 calibrated well fit output in the form of simulated time series derived from these models are precisely calculated and defined 100 probability and cannot reproduce the variability and distributional characteristics of the physical processes the models are being used to understand and quantify montanari and koutsoyiannis 2012 farmer and vogel 2016 this is important as the differences between the simulated and measured fluxes can be magnified in the extreme parts of the distribution which are important areas for risk mitigation and descision support systems farmer and vogel 2016 the identification and quantification of sources of residuals that contribute to uncertainty of simulated time series derived from physically based hydrologic models have been well documented zhang et al 2008 matott et al 2009 wagener and montanari 2011 farmer and vogel 2016 there have been a number of efforts to quantify the contribution of different components of the modeling workflow to uncertainty this includes model inputs and measurement error such as forcing or calibration data parameters structural errors and model outputs yadav et al 2007 vrught et al 2008 zhang et al 2008 mcmillan et al 2011 montanari and koutsoyiannis 2012 while previous efforts have defined frameworks through which uncertainty can be quantified for different components of the modeling workflow beven and binley 1992 kapangaziwiri et al 2012 smith et al 2015 many of these efforts are data intensive or application specific and only a few of them quantify uncertainty for simulations in ungaged areas yadav et al 2007 bourgin et al 2015 which is important for applications of models over regional or continental domains for physically based hydrologic models applied seamlessly and consistently across large scale domains the individual contribution to uncertainty from each of the residual components inputs parameter model structure output may vary spatially or temporally based on availabilty and quality of forcing and measurement data kiang et al 2013 henn et al 2018 the ability of models to capture dominant processes newman et al 2015 markstrom et al 2016 and the specific algorithms used to calculate model fluxes and states mccabe et al 2015 in this paper we use a stochastic post processing framework developed by bourgin et al 2015 and farmer and vogel 2016 to quantify uncertainty in simulated monthly streamflow and runoff produced by a monthly water balance model mwbm mccabe and markstrom 2007 bock et al 2016 for gaged and ungaged areas across the conus bock et al 2016 the main goal is the conversion of a deterministic prediction or simulation at each monthly time step into a probabilistic one by providing uncertainty intervals ui around each simulated deterministic time step value sikorska et al 2015 as the model residuals contain traces of the measured phenomenon trying to be understood the post processing procedure incorporates information from the model residuals to build the uis from a single deterministically derived simulated time series farmer and vogel 2016 this approach previously developed at regional scales farmer and vogel 2016 farmer and levin 2017 was applied across the conus where there is large spatial variability in both hydroclimatic characteristics and the amount of measured information available to quantify uncertainty in model simulations kiang et al 2013 2 methods 2 1 the monthly water balance model the mwbm fig 1 is a modular accounting system that provides monthly estimates of components of the hydrologic cycle using concepts of water supply and demand mccabe and markstrom 2007 mccabe and wolock 2011 bock et al 2016 monthly mean temperature tave is used to compute potential evapotranspiration pet and to partition total monthly precipitation ppt into rain and snow fig 1 ppt that occurs as snow is accumulated in snow storage i e snowpack rainfall is used to compute direct runoff actual evapotranspiration aet soil moisture storage and surplus water which eventually becomes runoff fig 1 when rainfall for a month is less than pet aet is equal to the sum of rainfall snowmelt and the amount of moisture that can be removed from the soil the fraction of soil moisture storage that can be removed as aet decreases linearly with decreasing soil moisture storage that is water becomes more difficult to remove from the soil as the soil becomes drier and less moisture is available for aet in a given month if rainfall and snowmelt exceeds pet aet is equal to pet and water in excess of pet replenishes soil moisture storage when soil moisture storage reaches capacity during a given month the excess water becomes surplus and a fraction of the surplus becomes runoff while the remainder of the surplus is temporarily held in storage the mwbm was previously implemented across the conus using the methods described in bock et al 2016 the mwbm was configured for the conus for 109 951 hydrologic response units hrus from the geospatial fabric for national hydrologic modeling viger and bock 2014 a national database of hydrologic features for national hydrologic modeling applications the geospatial fabric discretization consists of hrus stream segments and points of interest along the stream network all of which were derived based on an aggregation of the national hydrography dataset plus dataset u s environmental protection agency and u s geological survey 2010 the sizes of the hrus range from less than 1 km2 up to 67 991 km2 with a median size of 33 km2 inputs to the mwbm are monthly ppt millimeters and monthly mean tave c latitude of the site decimal degrees soil moisture storage capacity millimeters and a monthly varying coefficient dimensionless for the computation of pet maurer et al 2002 wolock 1997 mccabe et al 2015 latitude for each hru was computed as the centroid of each hru soil moisture storage capacity was calculated for each hru using state soil geographic database data on a 1 km2 grid resolution wolock 1997 the mwbm was calibrated and regionalized across the conus by organizing hrus into 110 distinct regions across the conus based on similar parameter sensitivities fig 2 bock et al 2016 within each region the mwbm was calibrated in a group wise fashion using streamgages identified which fit a set of criteria and information for model calibration is shared between streamgages in the region this resulted in a single optimized deterministically derived set of mwbm parameters applied to all hrus gaged and ungaged within each region a single mwbm parameter set fig 1 table 1 bock et al 2016 was calibrated and applied to all hrus within each calibration region using the shuffled complex evolution global search optimization algorithm duan et al 1993 the multi term objective function used for calibration minimized the difference between measured and simulated streamflow at multiple time summaries and mwbm derived and modeled snow water equivalent national operational hydrologic remote sensing center 2004 there are some hydrological processes whose representations are limited by the mwbm due to monthly time steps and or the regionalization technique applied in bock et al 2016 for more information on these limitations and the geographic areas affected see the discussion in section 5 in bock et al 2016 and section 4 of bock et al 2018a 2 2 derivation of uncertainty intervals at streamgages the approach to deriving uis for simulated hydrologic model output has been laid out in several recent studies bourgin et al 2015 sikorska et al 2015 farmer and vogel 2016 of these bourgin et al 2015 presented a methodology that derived uis to be applied towards ungaged catchments this methodology is adopted and applied towards the mwbm across the conus using the same framework used for the mwbm calibration and regionalization bock et al 2016 within each of the 110 calibration regions the uncertainty intervals are first derived and validated at gaged catchments used for regionalized mwbm calibration within the calibration region section 2 3 before being applied to the ungaged hrus within each region section 2 4 this approach derives uis for gaged and ungaged catchments within each calibration region bock et al 2016 and differs from a nearest neigbor or donor basin approach used in previous ui applications bourgin et al 2015 farmer and levin 2017 to validate the ui approach that will eventually be applied towards ungaged hrus uis for simulated streamflow from the mwbm were first derived and validated for gaged catchments within each calibration region this approach uses a leave one out loo strategy to validate results at gaged catchments and includes information from all streamgages used for model calibration within each calibration region to derive the uis this approach utilized 1575 streamgages across the 110 calibration regions the number of streamgages and area of each calibration region varied across the conus figs 6 and 7 in bock et al 2016 within each calibration region relative streamflow residuals q were first calculated and pooled for all streamgages used for model calibration eq 1 1 q 1 t i 1 t q o t q s t where q is the relative residual for streamflow qo t is the measured streamflow and qs t is the simulated streamflow at each monthly time step for all months t in the period record for each streamgage g a subset of the pooled residuals was created by excluding residuals associated with the streamgage for which the uis are being derived the loo approach this approach results in a subset of q g with the brackets noting the exclusion of each streamgage s residuals within its own pool as in bourgin et al 2015 the resulting q g were organized into ten flow deciles of q i g with i ranging from 1 10 based on the ranks of the corresponding qs with q 1 g containing residuals derived from the lowest simulated flows and q 10 g containing residuals derived from the highest simulated flows other methods of binning the residuals such as organizing by month were investigated but considered inferior to the original decile organization the residuals ranked by the magnitude of qs t minimized the within group variability of qs t and prevented information from streamgages with large drainage areas high qs t from overwhelming information from streamgages with small drainage areas low qs t when deriving uis for a single calibration region next the 0 025 and 0 975 quantiles thereby reproducing a 95 interval of the each q i g were determined resulting in ten pairs of multiplicative constants for upper and lower bounds of the uis across the entire time series bounds for each time step were derived by calculating each qs by the upper and lower multiplicative constants of the decile group q i g that each qs is pooled with resulting in a time series of upper and lower uis for each time step qu t and ql t fig 3 a this method was then applied to the next streamgage within the calibration region until all streamgages were assessed the derived ui time series were inherited by all hrus within the catchment of each streamgage g 2 3 validation of uncertainty intervals at streamgages three previously defined metrics were used to evaluate the uis at the 1575 streamgages the coverage ratio cr average width index awi and the interval skill score iss table 1 details on the background and formulation of these metrics can be found in bourgin et al 2015 the properties of the ui and the measured and simulated time series used to calculate the three metrics are shown in fig 3b the cr quantifies the statistical reliability of the derived uis to contain the true measured streamflow value qo t eq 2 2 c 1 i f q o t q l t a n d q o t q u t 0 i f q o t q l t q o t q u t c r 1 t i 1 t c where c equals 1 at time step if the measured streamflow qo t is greater than ql t and less than qu t and 0 otherwise fig 3b the resulting series c is summed and divided by the number of time steps i e the total number of measured streamflow values to calculate the cr the cr provides a proportional measure ranging from 0 to 1 where 1 represents a perfect value uncertainty intervals contain all measured streamflow values and 0 indicates the uncertainty intervals have no reliability to contain any measured streamflow values the uis derived with the 95 quantiles of residuals which are appropriately narrow should be expected to contain 95 of the measured streamflow values cr values higher than the residual percentile range i e 95 used to derive the ui represent under confidence in the uis and intervals that are too wide and cr values that are lower than residual percentile used to derive the ui represent over confidence in ui and intervals that are too narrow the cr values greater than 0 95 can represent less reliable values for the evaluation of the uis especially if combined with low values of the other two metrics described in the following sections awi and iss for this study we define a range of acceptability for the cr to be between 0 925 and 0 975 and when possible highlight this range within the figures the awi is a measure of sharpness of the uis and quantifies the ability of the ui to capture the natural variability of the system and expected model simulations the awi is a measure of overlap between the width of the 95th percentiles of the simulated flow duration curve referred to as awclim and the average width aw of the uncertainty intervals which is calculated as the average of the absolute difference between the upper and lower uis across all time steps fig 3b this is calculated as eq 3 3 a w i 1 a w a w c l i m where aw is the average width index of the ui time series and awclim is the absolute difference width of the 0 025 and 0 975 quantiles of the simulated flow duration curve an awi value greater than 0 indicates that the derived ui reduces the uncertainty of the model output in comparison to the natural variability of the climatology represented by the 95th percentile of the simulated flow duration curve bourgin et al 2015 the third metric used to evaluate the ui is the iss gneiting and raftery 2007 which is a measure of the overall skill of the ui the iss is a composite of the previous two metrics and accounts for both the ability of the ui to capture the measured value and the width of the ui similar to aw in the calculation of the awi metric each time step is assigned an interval score s fig 3b with penalties imposed if the measured streamflow value for the time step deviates outside of the upper and lower bounds of the uis gneiting and rafferty 2007 the calculation of s for each time step is described in eq 6 of bourgin et al 2015 the iss is computed as eq 4 4 i s s 1 i s i s c l i m where is is the average value of s over the entire time series and isclim is the average value of the interval scores s calculated using the upper and lower values of the 95th percentiles of the simulated flow duration curve for each time step similar to the cr and awi high values of the iss indicate greater skill and precision of the ui in capturing measured streamflow weighted by the width of the ui wider uis should be expected to contain more measured streamflow values with positive scores indicating that the ui is more skillful than the natural variability of the flow duration curve and negative otherwise bourgin et al 2015 although each of the three metrics quantifies one aspect of the uis the values of the three metrics should be balanced against each other in aggregate farmer and levin 2017 2 4 application of the uncertainty intervals to ungaged hydrologic response units after evaluating the uis obtained by streamgages for each calibration region using the three metrics the derived uis could be applied to all ungaged areas within each calibration region this procedure is similar to that described in section 2 2 for the loo validation at individual streamgages except here the residuals from all streamgages within the calibration region were pooled to compute the deciles and uis whereas for the application to gaged catchments the loo strategy was used to validate results at individual streamgages the original uis computed for the hrus within gaged catchments were preserved because these streamgages serve as important validation and comparison points for multi model frameworks to evaluate the uis at hrus including inside and outside of gaged catchments the awi metric was calculated for all hrus across the conus both the cr and iss require measured streamflow information to compute the evaluation of the awi for ungaged areas is a measure of the precision and not the skill or accuracy of the uis in those locations false certainty may exist at locations with high awi values high precision where narrow widths contain high residual simulated estimates because the derivation and assignment of the uis used the same information and structure as the calibration and regionalization of the mwbm bock et al 2016 evaluation of the awi in ungaged areas provides a measure of consistency of the residuals across the conus 3 results 3 1 results by streamgage the spatial results by streamgage n 1575 bock et al 2018b are shown in three maps fig 4 a c and the range of values for the three metrics are shown in the boxplots in figs 5 and 6 values of the cr ranged from 0 42 to 1 0 with mean and median values of 0 93 and 0 95 respectively fig 5 on average the uis contained the expected number of measured monthly streamflow values based on the given residual percentiles 0 025 0 975 used to derive the uis the lowest values of the cr appear in regions of the country where there are both sparser networks of streamgages more complex topography and areas such as between 100 and 120 longitude fig 4a where monthly hydrologic models have low skill in replicating daily and sub daily processes that drive measured streamflow newman et al 2015 archfield et al 2015 bock et al 2016 there are five streamgages with cr values less than 0 50 black x fig 4a and 274 streamgages with cr values greater than 0 975 red dots fig 4a there were 774 streamgages with cr values between 0 925 and 0 975 values for awi range from 31 33 to 0 85 with mean and median values of 0 27 and 0 46 figs 5 and 6 awi values greater than 0 indicate the intervals reduced uncertainty as compared to the natural climatology for the residual percentiles used 0 025 0 975 fig 5 there are 149 streamgages across the conus with awi values less than 0 which are symbolized with a black x on fig 4b the awi values for approximately 97 of streamgages are contained within the interval 1 1 fig 5 the patterns and range of iss across the conus are more similar to awi than cr fig 4c and iss values ranged from 38 0 to 0 75 with mean and median values of 0 03 and 0 29 figs 5 and 6 there are 112 streamgages across the conus with iss values less than 0 as indicated by black xs fig 4c approximately 98 of streamgages occur within the interval 1 1 fig 5 with 35 streamgages having iss values less than 1 scatterplots of cr vs awi and iss are shown in fig 6 the horizontal axis ranges for fig 6a coverage ratio vs average width index with circles and 6b coverage ratio vs interval skill score with triangles match the same range used for the boxplots in fig 5 note that the vertical axis range is constrained from 0 4 to 1 based on the range of cr values 0 42 is the smallest cr value from the 1575 streamgages the smaller inset in fig 6c shows the horizontal axis with the full range of awi and iss values the area between the dashed red lines in fig 6a and b represent the range of acceptability for the cr 0 925 to 0 975 the single red line in fig 6c denotes the cr value of 0 95 as mentioned in section 2 3 validation of uncertainty intervals at streamgages the calculation of the awi metric does not include consideration of the site specific measured streamflow values in its calculation only the uncertainty intervals derived by the regionalized loo approach section 2 2 whereas the iss metric includes weighted penalties for how far measured streamflow values are outside the regionalized uis this difference in the calculations allows a streamgage to have high awi values the uis adequately describe the model and climatic uncertainty of the calibration region which contains the streamgage while also having low values cr and iss values the uis have less skill in capturing measured streamflow values at specific site than what is expected as is shown for streamgages in the lower right hand quadrants of fig 6a and b fig 7 depicts the cr of each of the streamgages for each of the flow deciles with a few exceptions the range of the cr among the streamgages decreases with increasing magnitude of streamflow flow deciles 1 to 10 the median cr among the streamgages also decreases with an increase in the magnitude of flow this is illustrated by the decrease in value of the median for each flow quantile relative to the location of the 0 95 cr red line behind boxes on the plot 3 2 results by calibration region the patterns between the three metrics cr awi and iss are examined for four different calibration regions across the conus fig 2 named for the discussion of the results as new england red the tennessee river orange platte river headwaters blue and the pacific coastal range green fig 8 is a replication of fig 6 with streamgages symbolized by color based on which calibration region they lie within in fig 2 for streamgages in the new england region red number of streamgages n 67 most of the streamgages cluster in the upper right hand quadrant of the fig 8a median cr awi iss 0 96 0 57 0 44 this pattern is similar for both tennessee river orange n 21 median cr awi iss 0 96 0 60 0 50 and pacific coastal range green n 33 median cr awi iss 0 96 0 66 0 60 regions however the platte headwaters region blue n 15 shows much different results for the ui application several streamgages register lower awi and iss values than the other three regions blue streamgages in fig 8b beyond the 1 1 x axis range shown in fig 8a note that for streamgages in the platte there are several streamgages with high but less acceptable cr values cr 0 975 and low awi iss values awi iss 0 in the upper left hand quadrant of fig 8a and the two streamgages in the region with highest awi in the platte region two streamgages in the lower right hand quadrant awi 0 6 also have the lowest cr 0 6 values within the region 3 3 average width index by hydrologic response unit the calculation of cr and iss both incorporate measured streamflow values and thus only the awi can be used to evaluate the uis in hrus that are located outside of gaged catchments the awi measures the ability of the uis to capture the variability of the system and the expected model simulations and is calculated based on the width of the interval of each time step as compared against the 95th percentile of the simulated flow duration curve using the framework suggested for applying the uis to ungaged areas section 2 4 the awi was calculated for all 109951 hrus across the conus fig 9 the results shown in fig 9 are similar to the spatial patterns of the awi results shown by streamgage in fig 4b the hrus in calibration regions with corresponding or nearby streamgages registered low awi values awi 0 and also have low awi values with a few exceptions these same calibration regions showed low model correspondence for measured streamflow in previous continental scale studies cited earlier newman et al 2015 bock et al 2016 in calibration regions of high density of streamgages west of 120 and east of 95 longitude south of 45 latitude in figs 4 and 9 the awi results are more seamless and spatially continuous in areas of sparser streamgage and drainage density between 120 and 105 longitude in figs 4 and 9 the awi results are more discrete and in some instances delineate the individual calibration region boundaries fig 2 3 4 performance of the uncertainty intervals the derived uis quantify the uncertainty of simulated streamflow at individual streamgages across the conus fig 4 section 3 1 however the application of uis at gaged and ungaged locations over large spatial domains can quantify uncertainty of the deterministic hydrologic model simulations and provide a more thorough evaluation of the hydrologic regionalization procedure that complements traditional goodness of fit measures of model performance used to initially evaluate the regionalized parameters sections 3 2 and 3 3 this is particularly useful in helping to identify the dominant individual contributors to uncertainty over continental scale domains that were addressed in the section 1 such as data scarcity model input errors and process representation within models the scatterplots in fig 10 show the log of the total area km2 of each calibration region fig 2 note that this is different from drainage area compared against the log of the number of streamgages within each calibration region the points representing each calibration region in the three plots are colored as in fig 4 based on the median cr fig 10a awi fig 10b and iss fig 10c calculated from streamgages used to calibrate the mwbm and derive the uis within each calibration region red triangles represent calibration regions with median cr values greater than 0 95 and awi and iss values less than zero no single region has a median cr value greater than 0 975 but 32 regions had median awi values greater than 0 95 while no obvious pattern exists for cr and total area or number of streamgages across the 110 calibration regions the majority of the calibration regions with negative median awi and iss values occur in the upper left hand quadrant of the scatterplots these low metric values occur in regions with a combination of low numbers of streamgages used to regionalize the mwbm parameters over larger areas some of the calibration regions with negative median awi and iss values black xs located between 120 and 100 longitude in fig 4b and c and red polygons at the same longitude range in fig 9 coincide with hydrologic regions two digit hydrologic unit code identified in kiang et al 2013 as lacking streamgage coverage for smaller to mid sized drainage basins table 1 fig 4 in kiang et al 2013 and include arid and semi arid areas where runoff processes and spatiotemporal variability in precipitation cannot be adequately represented by a monthly model wheater et al 2008 this limitation of the uis in these regions can be traced to several factors the uis are constructed using pooled residuals from the streamgages in each calibration region that were used to calibrate the mwbm section 2 2 a smaller number of streamgages results in a smaller set of residuals from which to construct the uis in calibration regions with smaller areas and more homogeneous climate and topography east of 90 longitude in fig 2 including new england red and tennessee river orange this may not affect the sharpness and skill of the uis as described by the awi and iss however despite the reliability of the uis in some of the larger calibration regions to capture the measured streamflow as described by the cr the size of the calibration regions and in some regions the complexity of terrain and climate limit the uis derived from the methodology presented here to adequately capture the climatic variability of the entire region with a smaller sample size of residuals fig 10 derived from sites situated over farther geographic distances two other limiting factors are the uncertainty of model forcing data such as grid based precipitation and the skill of the mwbm to replicate hydroclimatic processes in areas of conus these issues have been addressed in several sources newman et al 2015 bock et al 2016 markstrom et al 2016 considered together these factors indicate that in calibration regions with high cr values and low awi and iss values the model regionalization may adequately capture the central tendency mean and median of the regional streamflow behavior based on the cr but the uis derived for the calibration region fail to reduce the uncertainty associated with the simulated streamflow estimates in these areas based on the awi and iss 3 5 patterns of uncertainty interval performance by streamgage based on the information available for both streamgages figs 4 6 and calibration regions hrus figs 8 10 it is apparent that the performance of uis varies across the conus and that the performance of uis is likely related to the three factors discussed in the previous section data scarcity physical process representation and model regionalization structure to help identify spatial patterns in different performance thresholds among the 1575 streamgages 7 different categories were created to bin the streamgages that are defined by the three ui evaluation metrics from here on referred to as groups 1 through 7 table 2 fig 11 the first two columns of table 2 list the conditions for categorizing the streamgages based on the values of the three metrics the third column n lists the number of streamgages assigned to each group the fourth column interpretation of uis provides a brief interpretation of each group each streamgage is assigned to a group based on the value of the three ui evaluation metrics cr values that fall between 0 925 0 975 are considered reliable within the range of acceptability defined in section 2 2 in that the uis contain close to 95 of the measured streamflow values the quantiles of the residuals used to derive the uis for the purposes of the classification presented here streamgages with cr values higher lower than 0 975 0 925 are considered too wide narrow to be considered reliable awi and iss values greater than zero are considered to have reduced uncertainty awi or improved the skill iss of the uis as compared to the 95th percentile of simulated flow duration curve section 2 3 for the purposes of grouping described above the cr ui reliability is considered more important than either awi or iss which are equally weighted when considering the groupings of these seven groups group 1 n 713 is considered as the best performing group and group 6 n 39 is considered as the worst performing whereas groups 2 n 29 and 4 n 457 are considered adequate streamgages that are binned with group 1 and 4 coincide with areas where the mwbm performed well in previous conus wide applications fig 6 in hay and mccabe 2002 fig 9 in bock et al 2016 and capture the majority of the streamgages in the eastern part of the conus and the main belts of mountainous areas in the western conus group 3 n 32 results indicate streamgages that the cr is adequate but the uis do not improve the quantification of uncertainty outside of the information provided by the simulated flow duration curve and widely miss capturing measured monthly streamflow not accounted for within the cr the 31 streamgages in group 5 on the other hand scored adequately for only one of the three metrics streamgages in group 6 n 39 scored low for all three metrics group 7 represents a distinct group that is measured strictly by the cr 237 streamgages with awi and iss 0 and 37 with awi and iss 0 the uis for group 7 are considered too wide to effectively quantify uncertainty these results help illustrate which factors have the largest influence of ui performance in different parts of the conus in the eastern conus the streamgages from the groups with low metric values groups 2 3 and 6 cluster around the great lakes and ohio river valley area north of 40 latitude between 90 and 80 latitude in figs 4 9 and 11 which corresponds to the areas of hrus in red from fig 9 that have awi values less than 0 although the uis for streamgages in these regions fail to reduce uncertainty based on the three metrics these areas are surrounded by streamgages and hrus with high metric values fig 4 and except for the great lakes ohio river valley area identified in the previous sentence have adequate number of streamgages used in the regionalization procedure fig 4 it is hypothesized that the regionalized parameters derived in these areas do not adequately capture the variability of the regional hydrology as quantified by the uis in the western conus the spatial distribution of streamgages between these groups 2 3 and 6 are less clustered than those in the eastern conus considering the results shown in figs 4 and 11 this may indicate the three issues discussed in sections 3 3 and 3 4 larger size of the calibration regions data scarcity and poor replication of dominant hydrologic processes may limit the use of the uis in these areas 3 6 comparison with goodness of fit measures the results shown in section 3 5 bring up the question of how metrics used to describe the reliability sharpness and skill of the uis compare with traditional goodness of fit measures used for model evaluation a commonly applied goodness of fit measure is nash sutcliffe efficiency nse nash and sutcliffe 1970 do streamgages with adequate goodness of fit measures that measure model skill such as nse have uis that are reliable sharp and skillful based on the three metrics applied in this paper cr awi iss areas of the conus with streamgages that have low 0 awi and iss values black xs in fig 4b and c correspond to many of the same areas with streamgages that have low nse values in previous conus wide studies fig 4b in newman et al 2015 fig 8 in bock et al 2016 indicating low model skill using the nse as a measure may result in less sharp and skillful uis across geographic areas geographic areas that have clusters of gages with adequate cr but low awi and iss values group 3 in fig 11 may indicate that the hydrologic regionalization previously implemented in bock et al 2016 adequately replicates the measures of central tendency of streamflow and runoff in those areas as measured by the nse but cannot adequately capture the uncertainty of the streamflow and runoff in those portions of the conus based on the methodology presented here the range of nse cr awi and iss for the seven binned categories of streamgages table 2 fig 11 is shown in fig 12 the three top performing bins based on nse fig 12a are group 1 0 925 cr 0 975 awi and iss 0 group 4 cr 0 925 awi and iss 0 and group 7 cr 0 975 although direct comparison or identification of significant differences between the groups is not possible due to high variability in group sizes table 2 these results generally indicate that for many streamgages sites with high model skill based on a single goodness of fit measure such as nse generally have more reliable skillful and sharp uis when examining the values of the three ui evaluation metrics together the cr and iss metrics fig 12b and d relate the strongest to nse obviously because of their incorporation of measured streamflow information however several streamgages with low nse values nse 0 50 groups 1 4 and 5 in fig 12a have uis indicating good sharpness of the uncertainty estimates based on the awi results fig 12b this is an important consideration for application of the uis to ungaged areas as without direct measurement data to calibrate or validate against model input and parameter estimation uncertainty are the most important components of the uncertainty of simulated output in these areas although the work here used the awi to evaluate the uis in ungaged areas several other approaches are possible one complementary piece of information could be the development of a single confidence metric that describe model performance with measures of reliability sharpness and skill cr awi and iss of the uis from different sets of donor gages or catchments such as the calibration regions used in this paper 4 conclusion a stochastic approach to derive estimates of uncertainty was quantified for simulated streamflow and runoff from a monthly water balance model mwbm across the conterminous united states conus uncertainty intervals uis were derived based on model residuals that bounded simulated streamflow time series at 1575 streamgages and validated using existing metrics used in previous work that quantified the reliability coverage ratio cr sharpness average width index awi and skill interval skill score iss of the uis compared to measured and simulated data at each location the results showed that for the 1575 streamgages used in this study the uis contained the measured data the median cr was 0 95 among all 1575 streamgages and the cr calculated for all 765 814 time steps from all gages was 0 93 there are 774 of the 1575 streamgages with cr values between the range of 0 925 and 0 975 for most locations the uis were more reliable 1426 out of 1575 streamgages with awi 0 and skillful 1463 out of 1575 streamgages with iss 0 than constant uis developed using percentiles derived from the streamflow distribution awclim and isclim the evaluation of awi at ungaged areas hydrologic response units showed that for 24 of the land area of the conus approximately 19 000 hrus the uis did not reduce the uncertainty compared to using uis derived from the simulated flow duration curve awi 0 many of these areas coincided with regions where previously recognized limitations in model forcing data scarcity and quality have limited the application and utility of physically based hydrologic models the combined use of model goodness of fit measures such as the nash sutcliffe efficiency nse with the uncertainty interval evaluation metrics cr awi iss partitioned the 1575 streamgages across the conus into different groups based on differing levels of skill of the model and robustness of the uncertainty estimates operations to combine these metrics could provide quantitative measures of confidence for estimates of uncertainty in ungaged areas declaration of interests methods and data presented in this paper are from work funded by the u s geological survey usgs water availability and use science program and are part of regular duties performed acknowledgments funding and support for this work was provided by the u s geological survey water availability and use science program wausp the authors thank matt miller and two anonymous reviewers for their feedback in improving the manuscript any use of trade product or firm names is for descriptive purposes only and does not imply endorsement by the u s government supplementary materials supplementary material associated with this article can be found in the online version at doi 10 1016 j advwatres 2018 10 005 appendix supplementary materials image application 1 
